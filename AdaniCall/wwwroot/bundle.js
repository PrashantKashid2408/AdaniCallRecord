var callingPage = window.location.href;
/******/ (function (modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if (installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
            /******/
}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
            /******/
};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
        /******/
}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function (exports, name, getter) {
/******/ 		if (!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
            /******/
}
        /******/
};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function (exports) {
/******/ 		if (typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
            /******/
}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
        /******/
};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function (value, mode) {
/******/ 		if (mode & 1) value = __webpack_require__(value);
/******/ 		if (mode & 8) return value;
/******/ 		if ((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if (mode & 2 && typeof value != 'string') for (var key in value) __webpack_require__.d(ns, key, function (key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
        /******/
};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function (module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
        /******/
};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function (object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./client.js");
    /******/
})
/************************************************************************/
/******/({

/***/ "./client.js":
/*!*******************!*\
  !*** ./client.js ***!
  \*******************/
/*! no static exports found */
/***/ (function (module, exports, __webpack_require__) {

            eval("var strDomain = \"https://agcx.azurewebsites.net\";\r\nvar callID = \"\";\r\nvar callingPage = window.location.href;\r\n\r\n// Make sure to install the necessary dependencies\r\nconst {\r\n  CallClient,\r\n  VideoStreamRenderer,\r\n  LocalVideoStream,\r\n  Features,\r\n} = __webpack_require__(/*! @azure/communication-calling */ \"./node_modules/@azure/communication-calling/dist/sdk.bundle.js\");\r\nconst {\r\n  AzureCommunicationTokenCredential,\r\n} = __webpack_require__(/*! @azure/communication-common */ \"./node_modules/@azure/communication-common/dist-esm/src/index.js\");\r\nconst { AzureLogger, setLogLevel } = __webpack_require__(/*! @azure/logger */ \"./node_modules/@azure/logger/dist-esm/src/index.js\");\r\n// Set the log level and output\r\nsetLogLevel(\"verbose\");\r\nAzureLogger.log = (...args) => {\r\n  //  console.log(...args);\r\n};\r\n\r\n// Calling web sdk objects\r\n\r\nlet callAgent;\r\nlet deviceManager;\r\nlet call;\r\nlet incomingCall;\r\nlet outgoingCall;\r\nlet localVideoStream;\r\nlet localVideoStreamRenderer;\r\n\r\n// UI widgets\r\n\r\nlet userAccessToken = document.getElementById(\"user-access-token\");\r\nlet calleeAcsUserId = document.getElementById(\"callee-acs-user-id\");\r\nlet initializeCallAgentButton = document.getElementById(\r\n  \"initialize-call-agent\"\r\n);\r\nlet startCallButton = document.getElementById(\"start-call-button\");\r\nlet hangUpCallButton = document.getElementById(\"hangup-call-button\");\r\nlet hdnhangUpCallButton = document.getElementById(\"hdnhangup-call-button\");\r\nlet acceptCallButton = document.getElementById(\"accept-call-button\");\r\nlet startVideoButton = document.getElementById(\"start-video-button\");\r\nlet stopVideoButton = document.getElementById(\"stop-video-button\");\r\nlet connectedLabel = document.getElementById(\"connectedLabel\");\r\nlet remoteVideoContainer = document.getElementById(\"remoteVideoContainer\");\r\nlet localVideoContainer = document.getElementById(\"localVideoContainer\");\r\n\r\n/**\r\n * Using the CallClient, initialize a CallAgent instance with a CommunicationUserCredential which will enable us to make outgoing calls and receive incoming calls.\r\n * You can then use the CallClient.getDeviceManager() API instance to get the DeviceManager.\r\n */\r\ninitializeCallAgentButton.onclick = async () => {\r\n  try {\r\n    const callClient = new CallClient();\r\n    tokenCredential = new AzureCommunicationTokenCredential(\r\n      userAccessToken.value.trim()\r\n    );\r\n    callAgent = await callClient.createCallAgent(tokenCredential);\r\n    // Set up a camera device to use.\r\n    deviceManager = await callClient.getDeviceManager();\r\n    await deviceManager.askDevicePermission({ video: true });\r\n    await deviceManager.askDevicePermission({ audio: true });\r\n    // Listen for an incoming call to accept.\r\n    callAgent.on(\"incomingCall\", async (args) => {\r\n      try {\r\n        ShowRingMsg();\r\n        incomingCall = args.incomingCall;\r\n        acceptCallButton.disabled = false;\r\n        hangUpCallButton.disabled = false;\r\n        $(\"#accept-call-button\").removeClass(\"btn-disable\");\r\n        $(\"#hangup-call-button\").removeClass(\"btn-disable\");\r\n        startCallButton.disabled = true;\r\n        $(\"#start-call-button\").addClass(\"btn-disable\");\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    });\r\n    callAgent.on(\"callsUpdated\", (e) => {\r\n      //alert(e.added.length)\r\n      e.added.forEach((addedCall) => {\r\n        addedCall.on(\"stateChanged\", (f) => {\r\n          if (addedCall.state === \"Connected\") {\r\n            addedCall.info\r\n              .getServerCallId()\r\n              .then((result) => {\r\n                //dispatch(setServerCallId(result));\r\n                //alert(result)\r\n                if (result) {\r\n                  StartRecording(addedCall.id, result);\r\n                }\r\n              })\r\n              .catch((err) => {\r\n                console.log(err);\r\n                //alert(err)\r\n                //StartRecording(\":Error:\" + result);\r\n              });\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    //if (callingPage.toLowerCase().indexOf(\"call\") > -1) //{\r\n      //startCallButton.disabled = false;\r\n    //  $(\"#start-call-button\").removeClass(\"btn-disable\");\r\n      //closeAllBsDialogs();\r\n      //FreeAgent($(\"#callee-acs-user-id\").val())\r\n  //  }\r\n    initializeCallAgentButton.disabled = true;\r\n  } catch (error) {\r\n    console.error(\"initializeCallAgentButton:\" + error);\r\n  }\r\n};\r\n\r\n/**\r\n * Place a 1:1 outgoing video call to a user\r\n * Add an event listener to initiate a call when the `startCallButton` is clicked:\r\n * First you have to enumerate local cameras using the deviceManager `getCameraList` API.\r\n * In this quickstart we're using the first camera in the collection. Once the desired camera is selected, a\r\n * LocalVideoStream instance will be constructed and passed within `videoOptions` as an item within the\r\n * localVideoStream array to the call method. Once your call connects it will automatically start sending a video stream to the other participant.\r\n */\r\nstartCallButton.onclick = async () => {\r\n  try {\r\n    const localVideoStream = await createLocalVideoStream();\r\n    const videoOptions = localVideoStream\r\n      ? { localVideoStreams: [localVideoStream] }\r\n      : undefined;\r\n    call = callAgent.startCall(\r\n      [{ communicationUserId: calleeAcsUserId.value.trim() }],\r\n      { videoOptions }\r\n    );\r\n          // Subscribe to the call's properties and events.\r\n    subscribeToCall(call);\r\n  } catch (error) {\r\nwindow.location.href = \"/Home/Call\";\r\n console.error(error);\r\n  }\r\n};\r\n\r\n/**\r\n * Accepting an incoming call with video\r\n * Add an event listener to accept a call when the `acceptCallButton` is clicked:\r\n * After subscribing to the `CallAgent.on('incomingCall')` event, you can accept the incoming call.\r\n * You can pass the local video stream which you want to use to accept the call with.\r\n */\r\nacceptCallButton.onclick = async () => {\r\n  try {\r\n    const localVideoStream = await createLocalVideoStream();\r\n    const videoOptions = localVideoStream\r\n      ? { localVideoStreams: [localVideoStream] }\r\n      : undefined;\r\n    call = await incomingCall.accept({ videoOptions });\r\n    // Subscribe to the call's properties and events.\r\n    subscribeToCall(call);\r\n    ClearTimeOut();\r\n    ClearRefreshInterval();\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n};\r\n\r\n/**\r\n * Subscribe to a call obj.\r\n * Listen for property changes and collection updates.\r\n */\r\nsubscribeToCall = (call) => {\r\n  try {\r\n    // Inspect the initial call.id value.\r\n    //console.log(`Call Id: ${call.id}`);\r\n    //Subscribe to call's 'idChanged' event for value changes.\r\n    call.on(\"idChanged\", () => {\r\n      //console.log(`Call Id changed: ${call.id}`);\r\n    });\r\n\r\n    // Inspect the initial call.state value.\r\n    console.log(`Call state: ${call.state}`);\r\n    // Subscribe to call's 'stateChanged' event for value changes.\r\n    call.on(\"stateChanged\", async () => {\r\n      console.log(`Call state changed: ${call.state}`);\r\n      if (call.state === \"Connected\") {\r\n        wasCallConnected = true;\r\n        ClearTimeOut();\r\n        ClearNoFaceTimeOut();\r\n        setTimeout(function () {\r\n          const callRecordingApi = call.feature(Features.Recording);\r\n          const isRecordingActiveChangedHandler = () => {\r\n            console.log(\r\n              \"this is Recording started:\" + callRecordingApi.isRecordingActive\r\n            );\r\n          };\r\n          callRecordingApi.on(\r\n            \"isRecordingActiveChanged\",\r\n            isRecordingActiveChangedHandler\r\n          );\r\n        }, 1000);\r\n        $(\"#hdnCallStatus\").val(\"1\");\r\n        RemoveAllMsg();\r\n        InsertAccessMember(call.id, \"Connected\");\r\n        MakeCallTransaction(\r\n          call.id,\r\n          call.callerInfo.communicationUserId\r\n        );\r\n        connectedLabel.hidden = false;\r\n        acceptCallButton.disabled = true;\r\n        $(\"#accept-call-button\").addClass(\"btn-disable\");\r\n        startCallButton.disabled = true;\r\n        $(\"#start-call-button\").addClass(\"btn-disable\");\r\n        $(\"#start-call-button\").prop(\"disabled\", true);\r\n        hangUpCallButton.disabled = false;\r\n        $(\"#hangup-call-button\").removeClass(\"btn-disable\");\r\n        startVideoButton.disabled = false;\r\n        stopVideoButton.disabled = false;\r\n        $(\"#cnFaceDetect\").hide();\r\n        $(\"#callee-acs-user-id\").val(\"\");\r\n        //$(\"#start-call-button\").click();\r\n      } else if (call.state === \"Disconnected\") {\r\n        $(\"#hdnCallStatus\").val(\"0\");\r\n        ClearNoFaceTimeOut();\r\n        var CallLanguage = $(\"#hdnCallLanguage\").val();\r\n        if (CallLanguage === undefined || CallLanguage == \"\")\r\n          CallLanguage = \"3\";\r\n        UpdateCallTransactionsEndTime(call.id, CallLanguage);\r\n        connectedLabel.hidden = true;\r\n        if (callingPage.toLowerCase().indexOf(\"call\") > -1) {\r\n          if (wasCallConnected) {\r\n            $(\".all_steps\").find(\".all_steps_inner\").html(\"\");\r\n            ShowThankYouMsg();\r\n            wasCallConnected = false;\r\n          }\r\n          startCallButton.disabled = false;\r\n          $(\"#start-call-button\").removeClass(\"btn-disable\");\r\n          //closeAllBsDialogs();\r\n          FreeAgent($(\"#callee-acs-user-id\").val());\r\n          $(\"#callee-acs-user-id\").val(\"\");\r\n        } else if (callingPage.toLowerCase().indexOf(\"accept\") > -1) {\r\n          $(\"#callee-acs-user-id\").val(\"\");\r\n          FreeAgent(\"\");\r\n        }\r\n        hangUpCallButton.disabled = true;\r\n        $(\"#hangup-call-button\").addClass(\"btn-disable\");\r\n        startVideoButton.disabled = true;\r\n        stopVideoButton.disabled = true;\r\n        // connectedLabel.hidden = true;\r\n        // startCallButton.disabled = false;\r\n        // hangUpCallButton.disabled = true;\r\n        // startVideoButton.disabled = true;\r\n        // stopVideoButton.disabled = true;\r\n        //  console.log(`Call ended, call end reason={code=${call.callEndReason.code}, subCode=${call.callEndReason.subCode}}`);\r\n\r\n        try {\r\n          if (wasCallConnected) wasCallConnected = false;\r\n        } catch (e) {}\r\n      } else if (call.state === \"Ringing\") {\r\n        //if (callingPage.toLowerCase().indexOf(\"call\") > -1) {\r\n        $(\"#hdnCallStatus\").val(\"1\");\r\n        //}\r\n        //RemoveAllMsg();\r\n        ShowCallInitiationMsg();\r\n        ClearNoFaceTimeOut();\r\n      } else if (call.state === \"Connecting\") {\r\n        //if (callingPage.toLowerCase().indexOf(\"call\") > -1) {\r\n        $(\"#hdnCallStatus\").val(\"1\");\r\n        //}\r\n        //RemoveAllMsg();\r\n        ShowConnectingMsg(\"Connecting\");\r\n        ClearNoFaceTimeOut();\r\n      } else if (call.state === \"EarlyMedia\") {\r\n        //if (callingPage.toLowerCase().indexOf(\"call\") > -1) {\r\n        $(\"#hdnCallStatus\").val(\"1\");\r\n        //}\r\n        startCallButton.disabled = true;\r\n        $(\"#start-call-button\").addClass(\"btn-disable\");\r\n        $(\"#start-call-button\").prop(\"disabled\", true);\r\n        RemoveAllMsg();\r\n        ClearTimeOut();\r\n        ClearNoFaceTimeOut();\r\n      }\r\n    });\r\n\r\n    call.localVideoStreams.forEach(async (lvs) => {\r\n      localVideoStream = lvs;\r\n      await displayLocalVideoStream();\r\n    });\r\n    call.on(\"localVideoStreamsUpdated\", (e) => {\r\n      e.added.forEach(async (lvs) => {\r\n        localVideoStream = lvs;\r\n        await displayLocalVideoStream();\r\n      });\r\n      e.removed.forEach((lvs) => {\r\n        removeLocalVideoStream();\r\n      });\r\n    });\r\n\r\n    // Inspect the call's current remote participants and subscribe to them.\r\n    call.remoteParticipants.forEach((remoteParticipant) => {\r\n      subscribeToRemoteParticipant(remoteParticipant);\r\n    });\r\n    // Subscribe to the call's 'remoteParticipantsUpdated' event to be\r\n    // notified when new participants are added to the call or removed from the call.\r\n    call.on(\"remoteParticipantsUpdated\", (e) => {\r\n      // Subscribe to new remote participants that are added to the call.\r\n      e.added.forEach((remoteParticipant) => {\r\n        subscribeToRemoteParticipant(remoteParticipant);\r\n      });\r\n      // Unsubscribe from participants that are removed from the call\r\n      e.removed.forEach((remoteParticipant) => {\r\n        //   console.log('Remote participant removed from the call.');\r\n      });\r\n    });\r\n  } catch (error) {\r\n    console.error(\"subscribeToCall:\" + error);\r\n  }\r\n};\r\n\r\n/**\r\n * Subscribe to a remote participant obj.\r\n * Listen for property changes and collection udpates.\r\n */\r\nsubscribeToRemoteParticipant = (remoteParticipant) => {\r\n  try {\r\n    // Inspect the initial remoteParticipant.state value.\r\n    // console.log(`Remote participant state: ${remoteParticipant.state}`);\r\n    // Subscribe to remoteParticipant's 'stateChanged' event for value changes.\r\n    remoteParticipant.on(\"stateChanged\", () => {\r\n      // console.log(`Remote participant state changed: ${remoteParticipant.state}`);\r\n    });\r\n\r\n    // Inspect the remoteParticipants's current videoStreams and subscribe to them.\r\n    remoteParticipant.videoStreams.forEach((remoteVideoStream) => {\r\n      subscribeToRemoteVideoStream(remoteVideoStream);\r\n    });\r\n    // Subscribe to the remoteParticipant's 'videoStreamsUpdated' event to be\r\n    // notified when the remoteParticiapant adds new videoStreams and removes video streams.\r\n    remoteParticipant.on(\"videoStreamsUpdated\", (e) => {\r\n      // Subscribe to new remote participant's video streams that were added.\r\n      e.added.forEach((remoteVideoStream) => {\r\n        subscribeToRemoteVideoStream(remoteVideoStream);\r\n      });\r\n      // Unsubscribe from remote participant's video streams that were removed.\r\n      e.removed.forEach((remoteVideoStream) => {\r\n        //console.log('Remote participant video stream was removed.');\r\n      });\r\n    });\r\n  } catch (error) {\r\n    console.error(\"subscribeToRemoteParticipant:\" + error);\r\n  }\r\n};\r\n\r\n/**\r\n * Subscribe to a remote participant's remote video stream obj.\r\n * You have to subscribe to the 'isAvailableChanged' event to render the remoteVideoStream. If the 'isAvailable' property\r\n * changes to 'true', a remote participant is sending a stream. Whenever availability of a remote stream changes\r\n * you can choose to destroy the whole 'Renderer', a specific 'RendererView' or keep them, but this will result in displaying blank video frame.\r\n */\r\nsubscribeToRemoteVideoStream = async (remoteVideoStream) => {\r\n  // Create a video stream renderer for the remote video stream.\r\n  let videoStreamRenderer = new VideoStreamRenderer(remoteVideoStream);\r\n  let view;\r\n  const renderVideo = async () => {\r\n    try {\r\n      // Create a renderer view for the remote video stream.\r\n      view = await videoStreamRenderer.createView();\r\n      // Attach the renderer view to the UI.\r\n      remoteVideoContainer.hidden = false;\r\n      remoteVideoContainer.appendChild(view.target);\r\n    } catch (e) {\r\n      console.warn(`Failed to createView, reason=${e.message}, code=${e.code}`);\r\n      //document.writeln(`Failed to createView, reason=${e.message}, code=${e.code}`);\r\n    }\r\n  };\r\n  remoteVideoStream.on(\"isAvailableChanged\", async () => {\r\n    if (remoteVideoStream.isAvailable) {\r\n      await renderVideo();\r\n    } else {\r\n      if (view) {\r\n        view.dispose();\r\n        view = undefined;\r\n      }\r\n    }\r\n  });\r\n  // Participant has video on initially.\r\n  if (remoteVideoStream.isAvailable) {\r\n    await renderVideo();\r\n  }\r\n};\r\n\r\n/**\r\n * Start your local video stream.\r\n * This will send your local video stream to remote participants so they can view it.\r\n */\r\nstartVideoButton.onclick = async () => {\r\n  try {\r\n    const localVideoStream = await createLocalVideoStream();\r\n    await call.startVideo(localVideoStream);\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n};\r\n\r\n/**\r\n * Stop your local video stream.\r\n * This will stop your local video stream from being sent to remote participants.\r\n */\r\nstopVideoButton.onclick = async () => {\r\n  try {\r\n    await call.stopVideo(localVideoStream);\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n};\r\n\r\n/**\r\n * To render a LocalVideoStream, you need to create a new instance of VideoStreamRenderer, and then\r\n * create a new VideoStreamRendererView instance using the asynchronous createView() method.\r\n * You may then attach view.target to any UI element.\r\n */\r\ncreateLocalVideoStream = async () => {\r\n  const camera = (await deviceManager.getCameras())[0];\r\n  if (camera) {\r\n    return new LocalVideoStream(camera);\r\n  } else {\r\n    console.error(`No camera device found on the system`);\r\n  }\r\n};\r\n\r\n/**\r\n * Display your local video stream preview in your UI\r\n */\r\ndisplayLocalVideoStream = async () => {\r\n  try {\r\n    localVideoStreamRenderer = new VideoStreamRenderer(localVideoStream);\r\n    const view = await localVideoStreamRenderer.createView();\r\n    // localVideoContainer.hidden = false;\r\n    // localVideoContainer.appendChild(view.target);\r\n  } catch (error) {\r\n    console.error(\"displayLocalVideoStream:\" + error);\r\n  }\r\n};\r\n\r\n/**\r\n * Remove your local video stream preview from your UI\r\n */\r\nremoveLocalVideoStream = async () => {\r\n  try {\r\n    localVideoStreamRenderer.dispose();\r\n    localVideoContainer.hidden = true;\r\n  } catch (error) {\r\n    console.error(error);\r\n  }\r\n};\r\n\r\n/**\r\n * End current call\r\n */\r\nhangUpCallButton.addEventListener(\"click\", async () => {\r\n  if (wasCallConnected) hangtheCallLangPopup(3);\r\n  else $(\"#hdnhangup-call-button\").click();\r\n});\r\n\r\n//End the current call\r\nhdnhangUpCallButton.addEventListener(\"click\", async () => {\r\n  wasCallConnected = false;\r\n  ClearTimeOut();\r\n  ClearRefreshInterval();\r\n  // end the current call\r\n  FreeAgent($(\"#callee-acs-user-id\").val());\r\n  acceptCallButton.disabled = true;\r\n  $(\"#accept-call-button\").addClass(\"btn-disable\");\r\n  closeAllBsDialogs();\r\n  try {\r\n    var callingPage = window.location.href;\r\n    if (callingPage.toLowerCase().indexOf(\"call\") > -1) {\r\n      //ShowConnectingMsg('WaitTimeout')\r\n    } else if (callingPage.toLowerCase().indexOf(\"accept\") > -1) {\r\n      RemoveAllMsg();\r\n    }\r\n\r\n    await call.hangUp();\r\n    //hangtheCallLangPopup(3);\r\n    //await call.reject();\r\n  } catch (e) {\r\n    hangUpCallButton.disabled = true;\r\n    $(\"#hangup-call-button\").addClass(\"btn-disable\");\r\n  }\r\n});\n\n//# sourceURL=webpack:///./client.js?");

            /***/
}),

/***/ "./node_modules/@azure/abort-controller/dist-esm/src/AbortController.js":
/*!******************************************************************************!*\
  !*** ./node_modules/@azure/abort-controller/dist-esm/src/AbortController.js ***!
  \******************************************************************************/
/*! exports provided: AbortError, AbortController */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AbortError\", function() { return AbortError; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AbortController\", function() { return AbortController; });\n/* harmony import */ var _AbortSignal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./AbortSignal */ \"./node_modules/@azure/abort-controller/dist-esm/src/AbortSignal.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * This error is thrown when an asynchronous operation has been aborted.\n * Check for this error by testing the `name` that the name property of the\n * error matches `\"AbortError\"`.\n *\n * @example\n * ```ts\n * const controller = new AbortController();\n * controller.abort();\n * try {\n *   doAsyncWork(controller.signal)\n * } catch (e) {\n *   if (e.name === 'AbortError') {\n *     // handle abort error here.\n *   }\n * }\n * ```\n */\nclass AbortError extends Error {\n    constructor(message) {\n        super(message);\n        this.name = \"AbortError\";\n    }\n}\n/**\n * An AbortController provides an AbortSignal and the associated controls to signal\n * that an asynchronous operation should be aborted.\n *\n * @example\n * Abort an operation when another event fires\n * ```ts\n * const controller = new AbortController();\n * const signal = controller.signal;\n * doAsyncWork(signal);\n * button.addEventListener('click', () => controller.abort());\n * ```\n *\n * @example\n * Share aborter cross multiple operations in 30s\n * ```ts\n * // Upload the same data to 2 different data centers at the same time,\n * // abort another when any of them is finished\n * const controller = AbortController.withTimeout(30 * 1000);\n * doAsyncWork(controller.signal).then(controller.abort);\n * doAsyncWork(controller.signal).then(controller.abort);\n *```\n *\n * @example\n * Cascaded aborting\n * ```ts\n * // All operations can't take more than 30 seconds\n * const aborter = Aborter.timeout(30 * 1000);\n *\n * // Following 2 operations can't take more than 25 seconds\n * await doAsyncWork(aborter.withTimeout(25 * 1000));\n * await doAsyncWork(aborter.withTimeout(25 * 1000));\n * ```\n */\nclass AbortController {\n    // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n    constructor(parentSignals) {\n        this._signal = new _AbortSignal__WEBPACK_IMPORTED_MODULE_0__[\"AbortSignal\"]();\n        if (!parentSignals) {\n            return;\n        }\n        // coerce parentSignals into an array\n        if (!Array.isArray(parentSignals)) {\n            // eslint-disable-next-line prefer-rest-params\n            parentSignals = arguments;\n        }\n        for (const parentSignal of parentSignals) {\n            // if the parent signal has already had abort() called,\n            // then call abort on this signal as well.\n            if (parentSignal.aborted) {\n                this.abort();\n            }\n            else {\n                // when the parent signal aborts, this signal should as well.\n                parentSignal.addEventListener(\"abort\", () => {\n                    this.abort();\n                });\n            }\n        }\n    }\n    /**\n     * The AbortSignal associated with this controller that will signal aborted\n     * when the abort method is called on this controller.\n     *\n     * @readonly\n     */\n    get signal() {\n        return this._signal;\n    }\n    /**\n     * Signal that any operations passed this controller's associated abort signal\n     * to cancel any remaining work and throw an `AbortError`.\n     */\n    abort() {\n        Object(_AbortSignal__WEBPACK_IMPORTED_MODULE_0__[\"abortSignal\"])(this._signal);\n    }\n    /**\n     * Creates a new AbortSignal instance that will abort after the provided ms.\n     * @param ms - Elapsed time in milliseconds to trigger an abort.\n     */\n    static timeout(ms) {\n        const signal = new _AbortSignal__WEBPACK_IMPORTED_MODULE_0__[\"AbortSignal\"]();\n        const timer = setTimeout(_AbortSignal__WEBPACK_IMPORTED_MODULE_0__[\"abortSignal\"], ms, signal);\n        // Prevent the active Timer from keeping the Node.js event loop active.\n        if (typeof timer.unref === \"function\") {\n            timer.unref();\n        }\n        return signal;\n    }\n}\n//# sourceMappingURL=AbortController.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/abort-controller/dist-esm/src/AbortController.js?");

            /***/
}),

/***/ "./node_modules/@azure/abort-controller/dist-esm/src/AbortSignal.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@azure/abort-controller/dist-esm/src/AbortSignal.js ***!
  \**************************************************************************/
/*! exports provided: AbortSignal, abortSignal */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AbortSignal\", function() { return AbortSignal; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"abortSignal\", function() { return abortSignal; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/// <reference path=\"../shims-public.d.ts\" />\nconst listenersMap = new WeakMap();\nconst abortedMap = new WeakMap();\n/**\n * An aborter instance implements AbortSignal interface, can abort HTTP requests.\n *\n * - Call AbortSignal.none to create a new AbortSignal instance that cannot be cancelled.\n * Use `AbortSignal.none` when you are required to pass a cancellation token but the operation\n * cannot or will not ever be cancelled.\n *\n * @example\n * Abort without timeout\n * ```ts\n * await doAsyncWork(AbortSignal.none);\n * ```\n */\nclass AbortSignal {\n    constructor() {\n        /**\n         * onabort event listener.\n         */\n        this.onabort = null;\n        listenersMap.set(this, []);\n        abortedMap.set(this, false);\n    }\n    /**\n     * Status of whether aborted or not.\n     *\n     * @readonly\n     */\n    get aborted() {\n        if (!abortedMap.has(this)) {\n            throw new TypeError(\"Expected `this` to be an instance of AbortSignal.\");\n        }\n        return abortedMap.get(this);\n    }\n    /**\n     * Creates a new AbortSignal instance that will never be aborted.\n     *\n     * @readonly\n     */\n    static get none() {\n        return new AbortSignal();\n    }\n    /**\n     * Added new \"abort\" event listener, only support \"abort\" event.\n     *\n     * @param _type - Only support \"abort\" event\n     * @param listener - The listener to be added\n     */\n    addEventListener(\n    // tslint:disable-next-line:variable-name\n    _type, listener) {\n        if (!listenersMap.has(this)) {\n            throw new TypeError(\"Expected `this` to be an instance of AbortSignal.\");\n        }\n        const listeners = listenersMap.get(this);\n        listeners.push(listener);\n    }\n    /**\n     * Remove \"abort\" event listener, only support \"abort\" event.\n     *\n     * @param _type - Only support \"abort\" event\n     * @param listener - The listener to be removed\n     */\n    removeEventListener(\n    // tslint:disable-next-line:variable-name\n    _type, listener) {\n        if (!listenersMap.has(this)) {\n            throw new TypeError(\"Expected `this` to be an instance of AbortSignal.\");\n        }\n        const listeners = listenersMap.get(this);\n        const index = listeners.indexOf(listener);\n        if (index > -1) {\n            listeners.splice(index, 1);\n        }\n    }\n    /**\n     * Dispatches a synthetic event to the AbortSignal.\n     */\n    dispatchEvent(_event) {\n        throw new Error(\"This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.\");\n    }\n}\n/**\n * Helper to trigger an abort event immediately, the onabort and all abort event listeners will be triggered.\n * Will try to trigger abort event for all linked AbortSignal nodes.\n *\n * - If there is a timeout, the timer will be cancelled.\n * - If aborted is true, nothing will happen.\n *\n * @internal\n */\n// eslint-disable-next-line @azure/azure-sdk/ts-use-interface-parameters\nfunction abortSignal(signal) {\n    if (signal.aborted) {\n        return;\n    }\n    if (signal.onabort) {\n        signal.onabort.call(signal);\n    }\n    const listeners = listenersMap.get(signal);\n    if (listeners) {\n        // Create a copy of listeners so mutations to the array\n        // (e.g. via removeListener calls) don't affect the listeners\n        // we invoke.\n        listeners.slice().forEach((listener) => {\n            listener.call(signal, { type: \"abort\" });\n        });\n    }\n    abortedMap.set(signal, true);\n}\n//# sourceMappingURL=AbortSignal.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/abort-controller/dist-esm/src/AbortSignal.js?");

            /***/
}),

/***/ "./node_modules/@azure/abort-controller/dist-esm/src/index.js":
/*!********************************************************************!*\
  !*** ./node_modules/@azure/abort-controller/dist-esm/src/index.js ***!
  \********************************************************************/
/*! exports provided: AbortController, AbortError, AbortSignal */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _AbortController__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./AbortController */ \"./node_modules/@azure/abort-controller/dist-esm/src/AbortController.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"AbortController\", function() { return _AbortController__WEBPACK_IMPORTED_MODULE_0__[\"AbortController\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"AbortError\", function() { return _AbortController__WEBPACK_IMPORTED_MODULE_0__[\"AbortError\"]; });\n\n/* harmony import */ var _AbortSignal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./AbortSignal */ \"./node_modules/@azure/abort-controller/dist-esm/src/AbortSignal.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"AbortSignal\", function() { return _AbortSignal__WEBPACK_IMPORTED_MODULE_1__[\"AbortSignal\"]; });\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n// Changes to Aborter\n// * Rename Aborter to AbortSignal\n// * Remove withValue and getValue - async context should be solved differently/wholistically, not tied to cancellation\n// * Remove withTimeout, it's moved to the controller\n// * AbortSignal constructor no longer takes a parent. Cancellation graphs are created from the controller.\n// Potential changes to align with DOM Spec\n// * dispatchEvent on Signal\n\n\n//# sourceMappingURL=index.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/abort-controller/dist-esm/src/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-calling/dist/sdk.bundle.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@azure/communication-calling/dist/sdk.bundle.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function (module, exports, __webpack_require__) {

            eval("/* WEBPACK VAR INJECTION */(function(global, process, setImmediate) {// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the Microsoft Software License Terms for the Azure Communications Services, Azure CPaaS, AZURE COMMUNICATION SERVICES VOICE AND VIDEO CALLING CLIENT LIBRARY\r\n// See EULA.txt for license information.\r\n!function(l,d){ true?d(exports,__webpack_require__(/*! @azure/logger */ \"./node_modules/@azure/logger/dist-esm/src/index.js\"),__webpack_require__(/*! @azure/communication-common */ \"./node_modules/@azure/communication-common/dist-esm/src/index.js\")):undefined}(this,(function(l,d,u){\"use strict\";var p,h=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};function getDefaultExportFromCjs(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,\"default\")?l.default:l}function createCommonjsModule(l,d,u){return l(u={path:d,exports:{},require:function(l,d){return commonjsRequire(l,null==d?u.path:d)}},u.exports),u.exports}function getAugmentedNamespace(l){if(l.__esModule)return l;var d=Object.defineProperty({},\"__esModule\",{value:!0});return Object.keys(l).forEach((function(u){var p=Object.getOwnPropertyDescriptor(l,u);Object.defineProperty(d,u,p.get?p:{enumerable:!0,get:function(){return l[u]}})})),d}function commonjsRequire(){throw new Error(\"Dynamic requires are not currently supported by @rollup/plugin-commonjs\")}\r\n/*! *****************************************************************************\r\n\tCopyright (C) Microsoft. All rights reserved.\r\n\tLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n\tthis file except in compliance with the License. You may obtain a copy of the\r\n\tLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n\tTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n\tKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n\tWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n\tMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n\tSee the Apache Version 2.0 License for specific language governing permissions\r\n\tand limitations under the License.\r\n\t***************************************************************************** */!function(l){!function(d){var u=\"object\"==typeof h?h:\"object\"==typeof self?self:\"object\"==typeof this?this:Function(\"return this;\")(),p=makeExporter(l);function makeExporter(l,d){return function(u,p){\"function\"!=typeof l[u]&&Object.defineProperty(l,u,{configurable:!0,writable:!0,value:p}),d&&d(u,p)}}void 0===u.Reflect?u.Reflect=l:p=makeExporter(u.Reflect,p),d(p)}((function(l){var d=Object.prototype.hasOwnProperty,u=\"function\"==typeof Symbol,p=u&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:\"@@toPrimitive\",h=u&&void 0!==Symbol.iterator?Symbol.iterator:\"@@iterator\",g=\"function\"==typeof Object.create,f={__proto__:[]}instanceof Array,m=!g&&!f,v={create:g?function(){return MakeDictionary(Object.create(null))}:f?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:m?function(l,u){return d.call(l,u)}:function(l,d){return d in l},get:m?function(l,u){return d.call(l,u)?l[u]:void 0}:function(l,d){return l[d]}},y=Object.getPrototypeOf(Function),S=\"object\"==typeof process&&process.env&&\"true\"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,_=S||\"function\"!=typeof Map||\"function\"!=typeof Map.prototype.entries?CreateMapPolyfill():Map,C=S||\"function\"!=typeof Set||\"function\"!=typeof Set.prototype.entries?CreateSetPolyfill():Set,E=new(S||\"function\"!=typeof WeakMap?CreateWeakMapPolyfill():WeakMap);function decorate(l,d,u,p){if(IsUndefined(u)){if(!IsArray(l))throw new TypeError;if(!IsConstructor(d))throw new TypeError;return DecorateConstructor(l,d)}if(!IsArray(l))throw new TypeError;if(!IsObject(d))throw new TypeError;if(!IsObject(p)&&!IsUndefined(p)&&!IsNull(p))throw new TypeError;return IsNull(p)&&(p=void 0),DecorateProperty(l,d,u=ToPropertyKey(u),p)}function metadata(l,d){function decorator(u,p){if(!IsObject(u))throw new TypeError;if(!IsUndefined(p)&&!IsPropertyKey(p))throw new TypeError;OrdinaryDefineOwnMetadata(l,d,u,p)}return decorator}function defineMetadata(l,d,u,p){if(!IsObject(u))throw new TypeError;return IsUndefined(p)||(p=ToPropertyKey(p)),OrdinaryDefineOwnMetadata(l,d,u,p)}function hasMetadata(l,d,u){if(!IsObject(d))throw new TypeError;return IsUndefined(u)||(u=ToPropertyKey(u)),OrdinaryHasMetadata(l,d,u)}function hasOwnMetadata(l,d,u){if(!IsObject(d))throw new TypeError;return IsUndefined(u)||(u=ToPropertyKey(u)),OrdinaryHasOwnMetadata(l,d,u)}function getMetadata(l,d,u){if(!IsObject(d))throw new TypeError;return IsUndefined(u)||(u=ToPropertyKey(u)),OrdinaryGetMetadata(l,d,u)}function getOwnMetadata(l,d,u){if(!IsObject(d))throw new TypeError;return IsUndefined(u)||(u=ToPropertyKey(u)),OrdinaryGetOwnMetadata(l,d,u)}function getMetadataKeys(l,d){if(!IsObject(l))throw new TypeError;return IsUndefined(d)||(d=ToPropertyKey(d)),OrdinaryMetadataKeys(l,d)}function getOwnMetadataKeys(l,d){if(!IsObject(l))throw new TypeError;return IsUndefined(d)||(d=ToPropertyKey(d)),OrdinaryOwnMetadataKeys(l,d)}function deleteMetadata(l,d,u){if(!IsObject(d))throw new TypeError;IsUndefined(u)||(u=ToPropertyKey(u));var p=GetOrCreateMetadataMap(d,u,!1);if(IsUndefined(p))return!1;if(!p.delete(l))return!1;if(p.size>0)return!0;var h=E.get(d);return h.delete(u),h.size>0||E.delete(d),!0}function DecorateConstructor(l,d){for(var u=l.length-1;u>=0;--u){var p=(0,l[u])(d);if(!IsUndefined(p)&&!IsNull(p)){if(!IsConstructor(p))throw new TypeError;d=p}}return d}function DecorateProperty(l,d,u,p){for(var h=l.length-1;h>=0;--h){var g=(0,l[h])(d,u,p);if(!IsUndefined(g)&&!IsNull(g)){if(!IsObject(g))throw new TypeError;p=g}}return p}function GetOrCreateMetadataMap(l,d,u){var p=E.get(l);if(IsUndefined(p)){if(!u)return;p=new _,E.set(l,p)}var h=p.get(d);if(IsUndefined(h)){if(!u)return;h=new _,p.set(d,h)}return h}function OrdinaryHasMetadata(l,d,u){if(OrdinaryHasOwnMetadata(l,d,u))return!0;var p=OrdinaryGetPrototypeOf(d);return!IsNull(p)&&OrdinaryHasMetadata(l,p,u)}function OrdinaryHasOwnMetadata(l,d,u){var p=GetOrCreateMetadataMap(d,u,!1);return!IsUndefined(p)&&ToBoolean(p.has(l))}function OrdinaryGetMetadata(l,d,u){if(OrdinaryHasOwnMetadata(l,d,u))return OrdinaryGetOwnMetadata(l,d,u);var p=OrdinaryGetPrototypeOf(d);return IsNull(p)?void 0:OrdinaryGetMetadata(l,p,u)}function OrdinaryGetOwnMetadata(l,d,u){var p=GetOrCreateMetadataMap(d,u,!1);if(!IsUndefined(p))return p.get(l)}function OrdinaryDefineOwnMetadata(l,d,u,p){GetOrCreateMetadataMap(u,p,!0).set(l,d)}function OrdinaryMetadataKeys(l,d){var u=OrdinaryOwnMetadataKeys(l,d),p=OrdinaryGetPrototypeOf(l);if(null===p)return u;var h=OrdinaryMetadataKeys(p,d);if(h.length<=0)return u;if(u.length<=0)return h;for(var g=new C,f=[],m=0,v=u;m<v.length;m++){var y=v[m];g.has(y)||(g.add(y),f.push(y))}for(var S=0,_=h;S<_.length;S++){y=_[S];g.has(y)||(g.add(y),f.push(y))}return f}function OrdinaryOwnMetadataKeys(l,d){var u=[],p=GetOrCreateMetadataMap(l,d,!1);if(IsUndefined(p))return u;for(var h=GetIterator(p.keys()),g=0;;){var f=IteratorStep(h);if(!f)return u.length=g,u;var m=IteratorValue(f);try{u[g]=m}catch(l){try{IteratorClose(h)}finally{throw l}}g++}}function Type(l){if(null===l)return 1;switch(typeof l){case\"undefined\":return 0;case\"boolean\":return 2;case\"string\":return 3;case\"symbol\":return 4;case\"number\":return 5;case\"object\":return null===l?1:6;default:return 6}}function IsUndefined(l){return void 0===l}function IsNull(l){return null===l}function IsSymbol(l){return\"symbol\"==typeof l}function IsObject(l){return\"object\"==typeof l?null!==l:\"function\"==typeof l}function ToPrimitive(l,d){switch(Type(l)){case 0:case 1:case 2:case 3:case 4:case 5:return l}var u=3===d?\"string\":5===d?\"number\":\"default\",h=GetMethod(l,p);if(void 0!==h){var g=h.call(l,u);if(IsObject(g))throw new TypeError;return g}return OrdinaryToPrimitive(l,\"default\"===u?\"number\":u)}function OrdinaryToPrimitive(l,d){if(\"string\"===d){var u=l.toString;if(IsCallable(u))if(!IsObject(h=u.call(l)))return h;if(IsCallable(p=l.valueOf))if(!IsObject(h=p.call(l)))return h}else{var p;if(IsCallable(p=l.valueOf))if(!IsObject(h=p.call(l)))return h;var h,g=l.toString;if(IsCallable(g))if(!IsObject(h=g.call(l)))return h}throw new TypeError}function ToBoolean(l){return!!l}function ToString(l){return\"\"+l}function ToPropertyKey(l){var d=ToPrimitive(l,3);return IsSymbol(d)?d:ToString(d)}function IsArray(l){return Array.isArray?Array.isArray(l):l instanceof Object?l instanceof Array:\"[object Array]\"===Object.prototype.toString.call(l)}function IsCallable(l){return\"function\"==typeof l}function IsConstructor(l){return\"function\"==typeof l}function IsPropertyKey(l){switch(Type(l)){case 3:case 4:return!0;default:return!1}}function GetMethod(l,d){var u=l[d];if(null!=u){if(!IsCallable(u))throw new TypeError;return u}}function GetIterator(l){var d=GetMethod(l,h);if(!IsCallable(d))throw new TypeError;var u=d.call(l);if(!IsObject(u))throw new TypeError;return u}function IteratorValue(l){return l.value}function IteratorStep(l){var d=l.next();return!d.done&&d}function IteratorClose(l){var d=l.return;d&&d.call(l)}function OrdinaryGetPrototypeOf(l){var d=Object.getPrototypeOf(l);if(\"function\"!=typeof l||l===y)return d;if(d!==y)return d;var u=l.prototype,p=u&&Object.getPrototypeOf(u);if(null==p||p===Object.prototype)return d;var h=p.constructor;return\"function\"!=typeof h||h===l?d:h}function CreateMapPolyfill(){var l={},d=[],u=function(){function MapIterator(l,d,u){this._index=0,this._keys=l,this._values=d,this._selector=u}return MapIterator.prototype[\"@@iterator\"]=function(){return this},MapIterator.prototype[h]=function(){return this},MapIterator.prototype.next=function(){var l=this._index;if(l>=0&&l<this._keys.length){var u=this._selector(this._keys[l],this._values[l]);return l+1>=this._keys.length?(this._index=-1,this._keys=d,this._values=d):this._index++,{value:u,done:!1}}return{value:void 0,done:!0}},MapIterator.prototype.throw=function(l){throw this._index>=0&&(this._index=-1,this._keys=d,this._values=d),l},MapIterator.prototype.return=function(l){return this._index>=0&&(this._index=-1,this._keys=d,this._values=d),{value:l,done:!0}},MapIterator}();return function(){function Map(){this._keys=[],this._values=[],this._cacheKey=l,this._cacheIndex=-2}return Object.defineProperty(Map.prototype,\"size\",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.has=function(l){return this._find(l,!1)>=0},Map.prototype.get=function(l){var d=this._find(l,!1);return d>=0?this._values[d]:void 0},Map.prototype.set=function(l,d){var u=this._find(l,!0);return this._values[u]=d,this},Map.prototype.delete=function(d){var u=this._find(d,!1);if(u>=0){for(var p=this._keys.length,h=u+1;h<p;h++)this._keys[h-1]=this._keys[h],this._values[h-1]=this._values[h];return this._keys.length--,this._values.length--,d===this._cacheKey&&(this._cacheKey=l,this._cacheIndex=-2),!0}return!1},Map.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=l,this._cacheIndex=-2},Map.prototype.keys=function(){return new u(this._keys,this._values,getKey)},Map.prototype.values=function(){return new u(this._keys,this._values,getValue)},Map.prototype.entries=function(){return new u(this._keys,this._values,getEntry)},Map.prototype[\"@@iterator\"]=function(){return this.entries()},Map.prototype[h]=function(){return this.entries()},Map.prototype._find=function(l,d){return this._cacheKey!==l&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=l)),this._cacheIndex<0&&d&&(this._cacheIndex=this._keys.length,this._keys.push(l),this._values.push(void 0)),this._cacheIndex},Map}();function getKey(l,d){return l}function getValue(l,d){return d}function getEntry(l,d){return[l,d]}}function CreateSetPolyfill(){return function(){function Set(){this._map=new _}return Object.defineProperty(Set.prototype,\"size\",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set.prototype.has=function(l){return this._map.has(l)},Set.prototype.add=function(l){return this._map.set(l,l),this},Set.prototype.delete=function(l){return this._map.delete(l)},Set.prototype.clear=function(){this._map.clear()},Set.prototype.keys=function(){return this._map.keys()},Set.prototype.values=function(){return this._map.values()},Set.prototype.entries=function(){return this._map.entries()},Set.prototype[\"@@iterator\"]=function(){return this.keys()},Set.prototype[h]=function(){return this.keys()},Set}()}function CreateWeakMapPolyfill(){var l=16,u=v.create(),p=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}return WeakMap.prototype.has=function(l){var d=GetOrCreateWeakMapTable(l,!1);return void 0!==d&&v.has(d,this._key)},WeakMap.prototype.get=function(l){var d=GetOrCreateWeakMapTable(l,!1);return void 0!==d?v.get(d,this._key):void 0},WeakMap.prototype.set=function(l,d){return GetOrCreateWeakMapTable(l,!0)[this._key]=d,this},WeakMap.prototype.delete=function(l){var d=GetOrCreateWeakMapTable(l,!1);return void 0!==d&&delete d[this._key]},WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap}();function CreateUniqueKey(){var l;do{l=\"@@WeakMap@@\"+CreateUUID()}while(v.has(u,l));return u[l]=!0,l}function GetOrCreateWeakMapTable(l,u){if(!d.call(l,p)){if(!u)return;Object.defineProperty(l,p,{value:v.create()})}return l[p]}function FillRandomBytes(l,d){for(var u=0;u<d;++u)l[u]=255*Math.random()|0;return l}function GenRandomBytes(l){return\"function\"==typeof Uint8Array?\"undefined\"!=typeof crypto?crypto.getRandomValues(new Uint8Array(l)):\"undefined\"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(l)):FillRandomBytes(new Uint8Array(l),l):FillRandomBytes(new Array(l),l)}function CreateUUID(){var d=GenRandomBytes(l);d[6]=79&d[6]|64,d[8]=191&d[8]|128;for(var u=\"\",p=0;p<l;++p){var h=d[p];4!==p&&6!==p&&8!==p||(u+=\"-\"),h<16&&(u+=\"0\"),u+=h.toString(16).toLowerCase()}return u}}function MakeDictionary(l){return l.__=void 0,delete l.__,l}l(\"decorate\",decorate),l(\"metadata\",metadata),l(\"defineMetadata\",defineMetadata),l(\"hasMetadata\",hasMetadata),l(\"hasOwnMetadata\",hasOwnMetadata),l(\"getMetadata\",getMetadata),l(\"getOwnMetadata\",getOwnMetadata),l(\"getMetadataKeys\",getMetadataKeys),l(\"getOwnMetadataKeys\",getOwnMetadataKeys),l(\"deleteMetadata\",deleteMetadata)}))}(p||(p={}));\r\n/*! *****************************************************************************\r\n\tCopyright (c) Microsoft Corporation.\r\n\r\n\tPermission to use, copy, modify, and/or distribute this software for any\r\n\tpurpose with or without fee is hereby granted.\r\n\r\n\tTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n\tREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\n\tAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n\tINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\n\tLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\n\tOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\n\tPERFORMANCE OF THIS SOFTWARE.\r\n\t***************************************************************************** */\r\nvar extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};function __extends(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}var g=new WeakMap,f=new WeakMap,m=function(){function AbortSignal(){this.onabort=null,g.set(this,[]),f.set(this,!1)}return Object.defineProperty(AbortSignal.prototype,\"aborted\",{get:function(){if(!f.has(this))throw new TypeError(\"Expected `this` to be an instance of AbortSignal.\");return f.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(AbortSignal,\"none\",{get:function(){return new AbortSignal},enumerable:!1,configurable:!0}),AbortSignal.prototype.addEventListener=function(l,d){if(!g.has(this))throw new TypeError(\"Expected `this` to be an instance of AbortSignal.\");g.get(this).push(d)},AbortSignal.prototype.removeEventListener=function(l,d){if(!g.has(this))throw new TypeError(\"Expected `this` to be an instance of AbortSignal.\");var u=g.get(this),p=u.indexOf(d);p>-1&&u.splice(p,1)},AbortSignal.prototype.dispatchEvent=function(l){throw new Error(\"This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.\")},AbortSignal}();function abortSignal(l){if(!l.aborted){l.onabort&&l.onabort.call(l);var d=g.get(l);d&&d.slice().forEach((function(d){d.call(l,{type:\"abort\"})})),f.set(l,!0)}}!function(l){function AbortError(d){var u=l.call(this,d)||this;return u.name=\"AbortError\",u}__extends(AbortError,l)}(Error);var v=function(){function AbortController(l){var d=this;if(this._signal=new m,l){Array.isArray(l)||(l=arguments);for(var u=0,p=l;u<p.length;u++){var h=p[u];h.aborted?this.abort():h.addEventListener(\"abort\",(function(){d.abort()}))}}}return Object.defineProperty(AbortController.prototype,\"signal\",{get:function(){return this._signal},enumerable:!1,configurable:!0}),AbortController.prototype.abort=function(){abortSignal(this._signal)},AbortController.timeout=function(l){var d=new m,u=setTimeout(abortSignal,l,d);return\"function\"==typeof u.unref&&u.unref(),d},AbortController}(),y=createCommonjsModule((function(l,d){(function(){var u,p=\"4.17.21\",g=200,f=\"Unsupported core-js use. Try https://npms.io/search?q=ponyfill.\",m=\"Expected a function\",v=\"Invalid `variable` option passed into `_.template`\",y=\"__lodash_hash_undefined__\",S=500,_=\"__lodash_placeholder__\",C=1,E=2,T=4,b=1,I=2,A=1,R=2,P=4,O=8,M=16,w=32,N=64,D=128,L=256,k=512,x=30,F=\"...\",U=800,j=16,B=1,V=2,H=3,G=1/0,W=9007199254740991,q=17976931348623157e292,z=NaN,K=4294967295,J=K-1,Q=K>>>1,Y=[[\"ary\",D],[\"bind\",A],[\"bindKey\",R],[\"curry\",O],[\"curryRight\",M],[\"flip\",k],[\"partial\",w],[\"partialRight\",N],[\"rearg\",L]],$=\"[object Arguments]\",X=\"[object Array]\",Z=\"[object AsyncFunction]\",ee=\"[object Boolean]\",te=\"[object Date]\",ne=\"[object DOMException]\",ie=\"[object Error]\",re=\"[object Function]\",oe=\"[object GeneratorFunction]\",ae=\"[object Map]\",se=\"[object Number]\",ce=\"[object Null]\",le=\"[object Object]\",de=\"[object Promise]\",ue=\"[object Proxy]\",pe=\"[object RegExp]\",he=\"[object Set]\",ge=\"[object String]\",fe=\"[object Symbol]\",me=\"[object Undefined]\",ve=\"[object WeakMap]\",ye=\"[object WeakSet]\",Se=\"[object ArrayBuffer]\",_e=\"[object DataView]\",Ce=\"[object Float32Array]\",Ee=\"[object Float64Array]\",Te=\"[object Int8Array]\",be=\"[object Int16Array]\",Ie=\"[object Int32Array]\",Ae=\"[object Uint8Array]\",Re=\"[object Uint8ClampedArray]\",Pe=\"[object Uint16Array]\",Oe=\"[object Uint32Array]\",Me=/\\b__p \\+= '';/g,we=/\\b(__p \\+=) '' \\+/g,Ne=/(__e\\(.*?\\)|\\b__t\\)) \\+\\n'';/g,De=/&(?:amp|lt|gt|quot|#39);/g,Le=/[&<>\"']/g,ke=RegExp(De.source),xe=RegExp(Le.source),Fe=/<%-([\\s\\S]+?)%>/g,Ue=/<%([\\s\\S]+?)%>/g,je=/<%=([\\s\\S]+?)%>/g,Be=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,Ve=/^\\w*$/,He=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,Ge=/[\\\\^$.*+?()[\\]{}|]/g,We=RegExp(Ge.source),qe=/^\\s+/,ze=/\\s/,Ke=/\\{(?:\\n\\/\\* \\[wrapped with .+\\] \\*\\/)?\\n?/,Je=/\\{\\n\\/\\* \\[wrapped with (.+)\\] \\*/,Qe=/,? & /,Ye=/[^\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\x7f]+/g,$e=/[()=,{}\\[\\]\\/\\s]/,Xe=/\\\\(\\\\)?/g,Ze=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,et=/\\w*$/,tt=/^[-+]0x[0-9a-f]+$/i,nt=/^0b[01]+$/i,it=/^\\[object .+?Constructor\\]$/,rt=/^0o[0-7]+$/i,ot=/^(?:0|[1-9]\\d*)$/,at=/[\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\xff\\u0100-\\u017f]/g,st=/($^)/,ct=/['\\n\\r\\u2028\\u2029\\\\]/g,lt=\"\\\\ud800-\\\\udfff\",dt=\"\\\\u0300-\\\\u036f\"+\"\\\\ufe20-\\\\ufe2f\"+\"\\\\u20d0-\\\\u20ff\",ut=\"\\\\u2700-\\\\u27bf\",pt=\"a-z\\\\xdf-\\\\xf6\\\\xf8-\\\\xff\",ht=\"A-Z\\\\xc0-\\\\xd6\\\\xd8-\\\\xde\",gt=\"\\\\ufe0e\\\\ufe0f\",ft=\"\\\\xac\\\\xb1\\\\xd7\\\\xf7\"+\"\\\\x00-\\\\x2f\\\\x3a-\\\\x40\\\\x5b-\\\\x60\\\\x7b-\\\\xbf\"+\"\\\\u2000-\\\\u206f\"+\" \\\\t\\\\x0b\\\\f\\\\xa0\\\\ufeff\\\\n\\\\r\\\\u2028\\\\u2029\\\\u1680\\\\u180e\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200a\\\\u202f\\\\u205f\\\\u3000\",mt=\"[']\",vt=\"[\"+lt+\"]\",yt=\"[\"+ft+\"]\",St=\"[\"+dt+\"]\",_t=\"\\\\d+\",Ct=\"[\"+ut+\"]\",Et=\"[\"+pt+\"]\",Tt=\"[^\"+lt+ft+_t+ut+pt+ht+\"]\",bt=\"\\\\ud83c[\\\\udffb-\\\\udfff]\",It=\"[^\"+lt+\"]\",At=\"(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}\",Rt=\"[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]\",Pt=\"[\"+ht+\"]\",Ot=\"\\\\u200d\",Mt=\"(?:\"+Et+\"|\"+Tt+\")\",wt=\"(?:\"+Pt+\"|\"+Tt+\")\",Nt=\"(?:\"+mt+\"(?:d|ll|m|re|s|t|ve))?\",Dt=\"(?:\"+mt+\"(?:D|LL|M|RE|S|T|VE))?\",Lt=\"(?:\"+St+\"|\"+bt+\")\"+\"?\",kt=\"[\"+gt+\"]?\",xt=\"\\\\d*(?:1st|2nd|3rd|(?![123])\\\\dth)(?=\\\\b|[A-Z_])\",Ft=\"\\\\d*(?:1ST|2ND|3RD|(?![123])\\\\dTH)(?=\\\\b|[a-z_])\",Ut=kt+Lt+(\"(?:\"+Ot+\"(?:\"+[It,At,Rt].join(\"|\")+\")\"+kt+Lt+\")*\"),jt=\"(?:\"+[Ct,At,Rt].join(\"|\")+\")\"+Ut,Bt=\"(?:\"+[It+St+\"?\",St,At,Rt,vt].join(\"|\")+\")\",Vt=RegExp(mt,\"g\"),Ht=RegExp(St,\"g\"),Gt=RegExp(bt+\"(?=\"+bt+\")|\"+Bt+Ut,\"g\"),Wt=RegExp([Pt+\"?\"+Et+\"+\"+Nt+\"(?=\"+[yt,Pt,\"$\"].join(\"|\")+\")\",wt+\"+\"+Dt+\"(?=\"+[yt,Pt+Mt,\"$\"].join(\"|\")+\")\",Pt+\"?\"+Mt+\"+\"+Nt,Pt+\"+\"+Dt,Ft,xt,_t,jt].join(\"|\"),\"g\"),qt=RegExp(\"[\"+Ot+lt+dt+gt+\"]\"),zt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Kt=[\"Array\",\"Buffer\",\"DataView\",\"Date\",\"Error\",\"Float32Array\",\"Float64Array\",\"Function\",\"Int8Array\",\"Int16Array\",\"Int32Array\",\"Map\",\"Math\",\"Object\",\"Promise\",\"RegExp\",\"Set\",\"String\",\"Symbol\",\"TypeError\",\"Uint8Array\",\"Uint8ClampedArray\",\"Uint16Array\",\"Uint32Array\",\"WeakMap\",\"_\",\"clearTimeout\",\"isFinite\",\"parseInt\",\"setTimeout\"],Jt=-1,Qt={};Qt[Ce]=Qt[Ee]=Qt[Te]=Qt[be]=Qt[Ie]=Qt[Ae]=Qt[Re]=Qt[Pe]=Qt[Oe]=!0,Qt[$]=Qt[X]=Qt[Se]=Qt[ee]=Qt[_e]=Qt[te]=Qt[ie]=Qt[re]=Qt[ae]=Qt[se]=Qt[le]=Qt[pe]=Qt[he]=Qt[ge]=Qt[ve]=!1;var Yt={};Yt[$]=Yt[X]=Yt[Se]=Yt[_e]=Yt[ee]=Yt[te]=Yt[Ce]=Yt[Ee]=Yt[Te]=Yt[be]=Yt[Ie]=Yt[ae]=Yt[se]=Yt[le]=Yt[pe]=Yt[he]=Yt[ge]=Yt[fe]=Yt[Ae]=Yt[Re]=Yt[Pe]=Yt[Oe]=!0,Yt[ie]=Yt[re]=Yt[ve]=!1;var $t={\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"C\",\"\":\"c\",\"\":\"D\",\"\":\"d\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"N\",\"\":\"n\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"Y\",\"\":\"y\",\"\":\"y\",\"\":\"Ae\",\"\":\"ae\",\"\":\"Th\",\"\":\"th\",\"\":\"ss\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"D\",\"\":\"D\",\"\":\"d\",\"\":\"d\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"H\",\"\":\"H\",\"\":\"h\",\"\":\"h\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"J\",\"\":\"j\",\"\":\"K\",\"\":\"k\",\"\":\"k\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"W\",\"\":\"w\",\"\":\"Y\",\"\":\"y\",\"\":\"Y\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"IJ\",\"\":\"ij\",\"\":\"Oe\",\"\":\"oe\",\"\":\"'n\",\"\":\"s\"},Xt={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},Zt={\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"',\"&#39;\":\"'\"},en={\"\\\\\":\"\\\\\",\"'\":\"'\",\"\\n\":\"n\",\"\\r\":\"r\",\"\\u2028\":\"u2028\",\"\\u2029\":\"u2029\"},tn=parseFloat,nn=parseInt,rn=\"object\"==typeof h&&h&&h.Object===Object&&h,on=\"object\"==typeof self&&self&&self.Object===Object&&self,an=rn||on||Function(\"return this\")(),sn=d&&!d.nodeType&&d,cn=sn&&l&&!l.nodeType&&l,ln=cn&&cn.exports===sn,dn=ln&&rn.process,un=function(){try{var l=cn&&cn.require&&cn.require(\"util\").types;return l||dn&&dn.binding&&dn.binding(\"util\")}catch(l){}}(),pn=un&&un.isArrayBuffer,hn=un&&un.isDate,gn=un&&un.isMap,fn=un&&un.isRegExp,mn=un&&un.isSet,vn=un&&un.isTypedArray;function apply(l,d,u){switch(u.length){case 0:return l.call(d);case 1:return l.call(d,u[0]);case 2:return l.call(d,u[0],u[1]);case 3:return l.call(d,u[0],u[1],u[2])}return l.apply(d,u)}function arrayAggregator(l,d,u,p){for(var h=-1,g=null==l?0:l.length;++h<g;){var f=l[h];d(p,f,u(f),l)}return p}function arrayEach(l,d){for(var u=-1,p=null==l?0:l.length;++u<p&&!1!==d(l[u],u,l););return l}function arrayEachRight(l,d){for(var u=null==l?0:l.length;u--&&!1!==d(l[u],u,l););return l}function arrayEvery(l,d){for(var u=-1,p=null==l?0:l.length;++u<p;)if(!d(l[u],u,l))return!1;return!0}function arrayFilter(l,d){for(var u=-1,p=null==l?0:l.length,h=0,g=[];++u<p;){var f=l[u];d(f,u,l)&&(g[h++]=f)}return g}function arrayIncludes(l,d){return!!(null==l?0:l.length)&&baseIndexOf(l,d,0)>-1}function arrayIncludesWith(l,d,u){for(var p=-1,h=null==l?0:l.length;++p<h;)if(u(d,l[p]))return!0;return!1}function arrayMap(l,d){for(var u=-1,p=null==l?0:l.length,h=Array(p);++u<p;)h[u]=d(l[u],u,l);return h}function arrayPush(l,d){for(var u=-1,p=d.length,h=l.length;++u<p;)l[h+u]=d[u];return l}function arrayReduce(l,d,u,p){var h=-1,g=null==l?0:l.length;for(p&&g&&(u=l[++h]);++h<g;)u=d(u,l[h],h,l);return u}function arrayReduceRight(l,d,u,p){var h=null==l?0:l.length;for(p&&h&&(u=l[--h]);h--;)u=d(u,l[h],h,l);return u}function arraySome(l,d){for(var u=-1,p=null==l?0:l.length;++u<p;)if(d(l[u],u,l))return!0;return!1}var yn=baseProperty(\"length\");function asciiToArray(l){return l.split(\"\")}function asciiWords(l){return l.match(Ye)||[]}function baseFindKey(l,d,u){var p;return u(l,(function(l,u,h){if(d(l,u,h))return p=u,!1})),p}function baseFindIndex(l,d,u,p){for(var h=l.length,g=u+(p?1:-1);p?g--:++g<h;)if(d(l[g],g,l))return g;return-1}function baseIndexOf(l,d,u){return d==d?strictIndexOf(l,d,u):baseFindIndex(l,baseIsNaN,u)}function baseIndexOfWith(l,d,u,p){for(var h=u-1,g=l.length;++h<g;)if(p(l[h],d))return h;return-1}function baseIsNaN(l){return l!=l}function baseMean(l,d){var u=null==l?0:l.length;return u?baseSum(l,d)/u:z}function baseProperty(l){return function(d){return null==d?u:d[l]}}function basePropertyOf(l){return function(d){return null==l?u:l[d]}}function baseReduce(l,d,u,p,h){return h(l,(function(l,h,g){u=p?(p=!1,l):d(u,l,h,g)})),u}function baseSortBy(l,d){var u=l.length;for(l.sort(d);u--;)l[u]=l[u].value;return l}function baseSum(l,d){for(var p,h=-1,g=l.length;++h<g;){var f=d(l[h]);f!==u&&(p=p===u?f:p+f)}return p}function baseTimes(l,d){for(var u=-1,p=Array(l);++u<l;)p[u]=d(u);return p}function baseToPairs(l,d){return arrayMap(d,(function(d){return[d,l[d]]}))}function baseTrim(l){return l?l.slice(0,trimmedEndIndex(l)+1).replace(qe,\"\"):l}function baseUnary(l){return function(d){return l(d)}}function baseValues(l,d){return arrayMap(d,(function(d){return l[d]}))}function cacheHas(l,d){return l.has(d)}function charsStartIndex(l,d){for(var u=-1,p=l.length;++u<p&&baseIndexOf(d,l[u],0)>-1;);return u}function charsEndIndex(l,d){for(var u=l.length;u--&&baseIndexOf(d,l[u],0)>-1;);return u}function countHolders(l,d){for(var u=l.length,p=0;u--;)l[u]===d&&++p;return p}var Sn=basePropertyOf($t),_n=basePropertyOf(Xt);function escapeStringChar(l){return\"\\\\\"+en[l]}function getValue(l,d){return null==l?u:l[d]}function hasUnicode(l){return qt.test(l)}function hasUnicodeWord(l){return zt.test(l)}function iteratorToArray(l){for(var d,u=[];!(d=l.next()).done;)u.push(d.value);return u}function mapToArray(l){var d=-1,u=Array(l.size);return l.forEach((function(l,p){u[++d]=[p,l]})),u}function overArg(l,d){return function(u){return l(d(u))}}function replaceHolders(l,d){for(var u=-1,p=l.length,h=0,g=[];++u<p;){var f=l[u];f!==d&&f!==_||(l[u]=_,g[h++]=u)}return g}function setToArray(l){var d=-1,u=Array(l.size);return l.forEach((function(l){u[++d]=l})),u}function setToPairs(l){var d=-1,u=Array(l.size);return l.forEach((function(l){u[++d]=[l,l]})),u}function strictIndexOf(l,d,u){for(var p=u-1,h=l.length;++p<h;)if(l[p]===d)return p;return-1}function strictLastIndexOf(l,d,u){for(var p=u+1;p--;)if(l[p]===d)return p;return p}function stringSize(l){return hasUnicode(l)?unicodeSize(l):yn(l)}function stringToArray(l){return hasUnicode(l)?unicodeToArray(l):asciiToArray(l)}function trimmedEndIndex(l){for(var d=l.length;d--&&ze.test(l.charAt(d)););return d}var Cn=basePropertyOf(Zt);function unicodeSize(l){for(var d=Gt.lastIndex=0;Gt.test(l);)++d;return d}function unicodeToArray(l){return l.match(Gt)||[]}function unicodeWords(l){return l.match(Wt)||[]}var En=function runInContext(l){var d,h=(l=null==l?an:En.defaults(an.Object(),l,En.pick(an,Kt))).Array,ze=l.Date,Ye=l.Error,lt=l.Function,dt=l.Math,ut=l.Object,pt=l.RegExp,ht=l.String,gt=l.TypeError,ft=h.prototype,mt=lt.prototype,vt=ut.prototype,yt=l[\"__core-js_shared__\"],St=mt.toString,_t=vt.hasOwnProperty,Ct=0,Et=(d=/[^.]+$/.exec(yt&&yt.keys&&yt.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+d:\"\",Tt=vt.toString,bt=St.call(ut),It=an._,At=pt(\"^\"+St.call(_t).replace(Ge,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),Rt=ln?l.Buffer:u,Pt=l.Symbol,Ot=l.Uint8Array,Mt=Rt?Rt.allocUnsafe:u,wt=overArg(ut.getPrototypeOf,ut),Nt=ut.create,Dt=vt.propertyIsEnumerable,Lt=ft.splice,kt=Pt?Pt.isConcatSpreadable:u,xt=Pt?Pt.iterator:u,Ft=Pt?Pt.toStringTag:u,Ut=function(){try{var l=getNative(ut,\"defineProperty\");return l({},\"\",{}),l}catch(l){}}(),jt=l.clearTimeout!==an.clearTimeout&&l.clearTimeout,Bt=ze&&ze.now!==an.Date.now&&ze.now,Gt=l.setTimeout!==an.setTimeout&&l.setTimeout,Wt=dt.ceil,qt=dt.floor,zt=ut.getOwnPropertySymbols,$t=Rt?Rt.isBuffer:u,Xt=l.isFinite,Zt=ft.join,en=overArg(ut.keys,ut),rn=dt.max,on=dt.min,sn=ze.now,cn=l.parseInt,dn=dt.random,un=ft.reverse,yn=getNative(l,\"DataView\"),Tn=getNative(l,\"Map\"),bn=getNative(l,\"Promise\"),In=getNative(l,\"Set\"),An=getNative(l,\"WeakMap\"),Rn=getNative(ut,\"create\"),Pn=An&&new An,On={},Mn=toSource(yn),wn=toSource(Tn),Nn=toSource(bn),Dn=toSource(In),Ln=toSource(An),kn=Pt?Pt.prototype:u,xn=kn?kn.valueOf:u,Fn=kn?kn.toString:u;function lodash(l){if(isObjectLike(l)&&!Vi(l)&&!(l instanceof LazyWrapper)){if(l instanceof LodashWrapper)return l;if(_t.call(l,\"__wrapped__\"))return wrapperClone(l)}return new LodashWrapper(l)}var Un=function(){function object(){}return function(l){if(!isObject(l))return{};if(Nt)return Nt(l);object.prototype=l;var d=new object;return object.prototype=u,d}}();function baseLodash(){}function LodashWrapper(l,d){this.__wrapped__=l,this.__actions__=[],this.__chain__=!!d,this.__index__=0,this.__values__=u}function LazyWrapper(l){this.__wrapped__=l,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=K,this.__views__=[]}function lazyClone(){var l=new LazyWrapper(this.__wrapped__);return l.__actions__=copyArray(this.__actions__),l.__dir__=this.__dir__,l.__filtered__=this.__filtered__,l.__iteratees__=copyArray(this.__iteratees__),l.__takeCount__=this.__takeCount__,l.__views__=copyArray(this.__views__),l}function lazyReverse(){if(this.__filtered__){var l=new LazyWrapper(this);l.__dir__=-1,l.__filtered__=!0}else(l=this.clone()).__dir__*=-1;return l}function lazyValue(){var l=this.__wrapped__.value(),d=this.__dir__,u=Vi(l),p=d<0,h=u?l.length:0,g=getView(0,h,this.__views__),f=g.start,m=g.end,v=m-f,y=p?m:f-1,S=this.__iteratees__,_=S.length,C=0,E=on(v,this.__takeCount__);if(!u||!p&&h==v&&E==v)return baseWrapperValue(l,this.__actions__);var T=[];e:for(;v--&&C<E;){for(var b=-1,I=l[y+=d];++b<_;){var A=S[b],R=A.iteratee,P=A.type,O=R(I);if(P==V)I=O;else if(!O){if(P==B)continue e;break e}}T[C++]=I}return T}function Hash(l){var d=-1,u=null==l?0:l.length;for(this.clear();++d<u;){var p=l[d];this.set(p[0],p[1])}}function hashClear(){this.__data__=Rn?Rn(null):{},this.size=0}function hashDelete(l){var d=this.has(l)&&delete this.__data__[l];return this.size-=d?1:0,d}function hashGet(l){var d=this.__data__;if(Rn){var p=d[l];return p===y?u:p}return _t.call(d,l)?d[l]:u}function hashHas(l){var d=this.__data__;return Rn?d[l]!==u:_t.call(d,l)}function hashSet(l,d){var p=this.__data__;return this.size+=this.has(l)?0:1,p[l]=Rn&&d===u?y:d,this}function ListCache(l){var d=-1,u=null==l?0:l.length;for(this.clear();++d<u;){var p=l[d];this.set(p[0],p[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(l){var d=this.__data__,u=assocIndexOf(d,l);return!(u<0)&&(u==d.length-1?d.pop():Lt.call(d,u,1),--this.size,!0)}function listCacheGet(l){var d=this.__data__,p=assocIndexOf(d,l);return p<0?u:d[p][1]}function listCacheHas(l){return assocIndexOf(this.__data__,l)>-1}function listCacheSet(l,d){var u=this.__data__,p=assocIndexOf(u,l);return p<0?(++this.size,u.push([l,d])):u[p][1]=d,this}function MapCache(l){var d=-1,u=null==l?0:l.length;for(this.clear();++d<u;){var p=l[d];this.set(p[0],p[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Tn||ListCache),string:new Hash}}function mapCacheDelete(l){var d=getMapData(this,l).delete(l);return this.size-=d?1:0,d}function mapCacheGet(l){return getMapData(this,l).get(l)}function mapCacheHas(l){return getMapData(this,l).has(l)}function mapCacheSet(l,d){var u=getMapData(this,l),p=u.size;return u.set(l,d),this.size+=u.size==p?0:1,this}function SetCache(l){var d=-1,u=null==l?0:l.length;for(this.__data__=new MapCache;++d<u;)this.add(l[d])}function setCacheAdd(l){return this.__data__.set(l,y),this}function setCacheHas(l){return this.__data__.has(l)}function Stack(l){var d=this.__data__=new ListCache(l);this.size=d.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(l){var d=this.__data__,u=d.delete(l);return this.size=d.size,u}function stackGet(l){return this.__data__.get(l)}function stackHas(l){return this.__data__.has(l)}function stackSet(l,d){var u=this.__data__;if(u instanceof ListCache){var p=u.__data__;if(!Tn||p.length<g-1)return p.push([l,d]),this.size=++u.size,this;u=this.__data__=new MapCache(p)}return u.set(l,d),this.size=u.size,this}function arrayLikeKeys(l,d){var u=Vi(l),p=!u&&Bi(l),h=!u&&!p&&Gi(l),g=!u&&!p&&!h&&Ji(l),f=u||p||h||g,m=f?baseTimes(l.length,ht):[],v=m.length;for(var y in l)!d&&!_t.call(l,y)||f&&(\"length\"==y||h&&(\"offset\"==y||\"parent\"==y)||g&&(\"buffer\"==y||\"byteLength\"==y||\"byteOffset\"==y)||isIndex(y,v))||m.push(y);return m}function arraySample(l){var d=l.length;return d?l[baseRandom(0,d-1)]:u}function arraySampleSize(l,d){return shuffleSelf(copyArray(l),baseClamp(d,0,l.length))}function arrayShuffle(l){return shuffleSelf(copyArray(l))}function assignMergeValue(l,d,p){(p!==u&&!eq(l[d],p)||p===u&&!(d in l))&&baseAssignValue(l,d,p)}function assignValue(l,d,p){var h=l[d];_t.call(l,d)&&eq(h,p)&&(p!==u||d in l)||baseAssignValue(l,d,p)}function assocIndexOf(l,d){for(var u=l.length;u--;)if(eq(l[u][0],d))return u;return-1}function baseAggregator(l,d,u,p){return jn(l,(function(l,h,g){d(p,l,u(l),g)})),p}function baseAssign(l,d){return l&&copyObject(d,keys(d),l)}function baseAssignIn(l,d){return l&&copyObject(d,keysIn(d),l)}function baseAssignValue(l,d,u){\"__proto__\"==d&&Ut?Ut(l,d,{configurable:!0,enumerable:!0,value:u,writable:!0}):l[d]=u}function baseAt(l,d){for(var p=-1,g=d.length,f=h(g),m=null==l;++p<g;)f[p]=m?u:get(l,d[p]);return f}function baseClamp(l,d,p){return l==l&&(p!==u&&(l=l<=p?l:p),d!==u&&(l=l>=d?l:d)),l}function baseClone(l,d,p,h,g,f){var m,v=d&C,y=d&E,S=d&T;if(p&&(m=g?p(l,h,g,f):p(l)),m!==u)return m;if(!isObject(l))return l;var _=Vi(l);if(_){if(m=initCloneArray(l),!v)return copyArray(l,m)}else{var b=$n(l),I=b==re||b==oe;if(Gi(l))return cloneBuffer(l,v);if(b==le||b==$||I&&!g){if(m=y||I?{}:initCloneObject(l),!v)return y?copySymbolsIn(l,baseAssignIn(m,l)):copySymbols(l,baseAssign(m,l))}else{if(!Yt[b])return g?l:{};m=initCloneByTag(l,b,v)}}f||(f=new Stack);var A=f.get(l);if(A)return A;f.set(l,m),Ki(l)?l.forEach((function(u){m.add(baseClone(u,d,p,u,l,f))})):qi(l)&&l.forEach((function(u,h){m.set(h,baseClone(u,d,p,h,l,f))}));var R=_?u:(S?y?getAllKeysIn:getAllKeys:y?keysIn:keys)(l);return arrayEach(R||l,(function(u,h){R&&(u=l[h=u]),assignValue(m,h,baseClone(u,d,p,h,l,f))})),m}function baseConforms(l){var d=keys(l);return function(u){return baseConformsTo(u,l,d)}}function baseConformsTo(l,d,p){var h=p.length;if(null==l)return!h;for(l=ut(l);h--;){var g=p[h],f=d[g],m=l[g];if(m===u&&!(g in l)||!f(m))return!1}return!0}function baseDelay(l,d,p){if(\"function\"!=typeof l)throw new gt(m);return ei((function(){l.apply(u,p)}),d)}function baseDifference(l,d,u,p){var h=-1,f=arrayIncludes,m=!0,v=l.length,y=[],S=d.length;if(!v)return y;u&&(d=arrayMap(d,baseUnary(u))),p?(f=arrayIncludesWith,m=!1):d.length>=g&&(f=cacheHas,m=!1,d=new SetCache(d));e:for(;++h<v;){var _=l[h],C=null==u?_:u(_);if(_=p||0!==_?_:0,m&&C==C){for(var E=S;E--;)if(d[E]===C)continue e;y.push(_)}else f(d,C,p)||y.push(_)}return y}lodash.templateSettings={escape:Fe,evaluate:Ue,interpolate:je,variable:\"\",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=Un(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=Un(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var jn=createBaseEach(baseForOwn),Bn=createBaseEach(baseForOwnRight,!0);function baseEvery(l,d){var u=!0;return jn(l,(function(l,p,h){return u=!!d(l,p,h)})),u}function baseExtremum(l,d,p){for(var h=-1,g=l.length;++h<g;){var f=l[h],m=d(f);if(null!=m&&(v===u?m==m&&!isSymbol(m):p(m,v)))var v=m,y=f}return y}function baseFill(l,d,p,h){var g=l.length;for((p=toInteger(p))<0&&(p=-p>g?0:g+p),(h=h===u||h>g?g:toInteger(h))<0&&(h+=g),h=p>h?0:toLength(h);p<h;)l[p++]=d;return l}function baseFilter(l,d){var u=[];return jn(l,(function(l,p,h){d(l,p,h)&&u.push(l)})),u}function baseFlatten(l,d,u,p,h){var g=-1,f=l.length;for(u||(u=isFlattenable),h||(h=[]);++g<f;){var m=l[g];d>0&&u(m)?d>1?baseFlatten(m,d-1,u,p,h):arrayPush(h,m):p||(h[h.length]=m)}return h}var Vn=createBaseFor(),Hn=createBaseFor(!0);function baseForOwn(l,d){return l&&Vn(l,d,keys)}function baseForOwnRight(l,d){return l&&Hn(l,d,keys)}function baseFunctions(l,d){return arrayFilter(d,(function(d){return isFunction(l[d])}))}function baseGet(l,d){for(var p=0,h=(d=castPath(d,l)).length;null!=l&&p<h;)l=l[toKey(d[p++])];return p&&p==h?l:u}function baseGetAllKeys(l,d,u){var p=d(l);return Vi(l)?p:arrayPush(p,u(l))}function baseGetTag(l){return null==l?l===u?me:ce:Ft&&Ft in ut(l)?getRawTag(l):objectToString(l)}function baseGt(l,d){return l>d}function baseHas(l,d){return null!=l&&_t.call(l,d)}function baseHasIn(l,d){return null!=l&&d in ut(l)}function baseInRange(l,d,u){return l>=on(d,u)&&l<rn(d,u)}function baseIntersection(l,d,p){for(var g=p?arrayIncludesWith:arrayIncludes,f=l[0].length,m=l.length,v=m,y=h(m),S=1/0,_=[];v--;){var C=l[v];v&&d&&(C=arrayMap(C,baseUnary(d))),S=on(C.length,S),y[v]=!p&&(d||f>=120&&C.length>=120)?new SetCache(v&&C):u}C=l[0];var E=-1,T=y[0];e:for(;++E<f&&_.length<S;){var b=C[E],I=d?d(b):b;if(b=p||0!==b?b:0,!(T?cacheHas(T,I):g(_,I,p))){for(v=m;--v;){var A=y[v];if(!(A?cacheHas(A,I):g(l[v],I,p)))continue e}T&&T.push(I),_.push(b)}}return _}function baseInverter(l,d,u,p){return baseForOwn(l,(function(l,h,g){d(p,u(l),h,g)})),p}function baseInvoke(l,d,p){var h=null==(l=parent(l,d=castPath(d,l)))?l:l[toKey(last(d))];return null==h?u:apply(h,l,p)}function baseIsArguments(l){return isObjectLike(l)&&baseGetTag(l)==$}function baseIsArrayBuffer(l){return isObjectLike(l)&&baseGetTag(l)==Se}function baseIsDate(l){return isObjectLike(l)&&baseGetTag(l)==te}function baseIsEqual(l,d,u,p,h){return l===d||(null==l||null==d||!isObjectLike(l)&&!isObjectLike(d)?l!=l&&d!=d:baseIsEqualDeep(l,d,u,p,baseIsEqual,h))}function baseIsEqualDeep(l,d,u,p,h,g){var f=Vi(l),m=Vi(d),v=f?X:$n(l),y=m?X:$n(d),S=(v=v==$?le:v)==le,_=(y=y==$?le:y)==le,C=v==y;if(C&&Gi(l)){if(!Gi(d))return!1;f=!0,S=!1}if(C&&!S)return g||(g=new Stack),f||Ji(l)?equalArrays(l,d,u,p,h,g):equalByTag(l,d,v,u,p,h,g);if(!(u&b)){var E=S&&_t.call(l,\"__wrapped__\"),T=_&&_t.call(d,\"__wrapped__\");if(E||T){var I=E?l.value():l,A=T?d.value():d;return g||(g=new Stack),h(I,A,u,p,g)}}return!!C&&(g||(g=new Stack),equalObjects(l,d,u,p,h,g))}function baseIsMap(l){return isObjectLike(l)&&$n(l)==ae}function baseIsMatch(l,d,p,h){var g=p.length,f=g,m=!h;if(null==l)return!f;for(l=ut(l);g--;){var v=p[g];if(m&&v[2]?v[1]!==l[v[0]]:!(v[0]in l))return!1}for(;++g<f;){var y=(v=p[g])[0],S=l[y],_=v[1];if(m&&v[2]){if(S===u&&!(y in l))return!1}else{var C=new Stack;if(h)var E=h(S,_,y,l,d,C);if(!(E===u?baseIsEqual(_,S,b|I,h,C):E))return!1}}return!0}function baseIsNative(l){return!(!isObject(l)||isMasked(l))&&(isFunction(l)?At:it).test(toSource(l))}function baseIsRegExp(l){return isObjectLike(l)&&baseGetTag(l)==pe}function baseIsSet(l){return isObjectLike(l)&&$n(l)==he}function baseIsTypedArray(l){return isObjectLike(l)&&isLength(l.length)&&!!Qt[baseGetTag(l)]}function baseIteratee(l){return\"function\"==typeof l?l:null==l?identity:\"object\"==typeof l?Vi(l)?baseMatchesProperty(l[0],l[1]):baseMatches(l):property(l)}function baseKeys(l){if(!isPrototype(l))return en(l);var d=[];for(var u in ut(l))_t.call(l,u)&&\"constructor\"!=u&&d.push(u);return d}function baseKeysIn(l){if(!isObject(l))return nativeKeysIn(l);var d=isPrototype(l),u=[];for(var p in l)(\"constructor\"!=p||!d&&_t.call(l,p))&&u.push(p);return u}function baseLt(l,d){return l<d}function baseMap(l,d){var u=-1,p=isArrayLike(l)?h(l.length):[];return jn(l,(function(l,h,g){p[++u]=d(l,h,g)})),p}function baseMatches(l){var d=getMatchData(l);return 1==d.length&&d[0][2]?matchesStrictComparable(d[0][0],d[0][1]):function(u){return u===l||baseIsMatch(u,l,d)}}function baseMatchesProperty(l,d){return isKey(l)&&isStrictComparable(d)?matchesStrictComparable(toKey(l),d):function(p){var h=get(p,l);return h===u&&h===d?hasIn(p,l):baseIsEqual(d,h,b|I)}}function baseMerge(l,d,p,h,g){l!==d&&Vn(d,(function(f,m){if(g||(g=new Stack),isObject(f))baseMergeDeep(l,d,m,p,baseMerge,h,g);else{var v=h?h(safeGet(l,m),f,m+\"\",l,d,g):u;v===u&&(v=f),assignMergeValue(l,m,v)}}),keysIn)}function baseMergeDeep(l,d,p,h,g,f,m){var v=safeGet(l,p),y=safeGet(d,p),S=m.get(y);if(S)assignMergeValue(l,p,S);else{var _=f?f(v,y,p+\"\",l,d,m):u,C=_===u;if(C){var E=Vi(y),T=!E&&Gi(y),b=!E&&!T&&Ji(y);_=y,E||T||b?Vi(v)?_=v:isArrayLikeObject(v)?_=copyArray(v):T?(C=!1,_=cloneBuffer(y,!0)):b?(C=!1,_=cloneTypedArray(y,!0)):_=[]:isPlainObject(y)||Bi(y)?(_=v,Bi(v)?_=toPlainObject(v):isObject(v)&&!isFunction(v)||(_=initCloneObject(y))):C=!1}C&&(m.set(y,_),g(_,y,h,f,m),m.delete(y)),assignMergeValue(l,p,_)}}function baseNth(l,d){var p=l.length;if(p)return isIndex(d+=d<0?p:0,p)?l[d]:u}function baseOrderBy(l,d,u){d=d.length?arrayMap(d,(function(l){return Vi(l)?function(d){return baseGet(d,1===l.length?l[0]:l)}:l})):[identity];var p=-1;return d=arrayMap(d,baseUnary(getIteratee())),baseSortBy(baseMap(l,(function(l,u,h){return{criteria:arrayMap(d,(function(d){return d(l)})),index:++p,value:l}})),(function(l,d){return compareMultiple(l,d,u)}))}function basePick(l,d){return basePickBy(l,d,(function(d,u){return hasIn(l,u)}))}function basePickBy(l,d,u){for(var p=-1,h=d.length,g={};++p<h;){var f=d[p],m=baseGet(l,f);u(m,f)&&baseSet(g,castPath(f,l),m)}return g}function basePropertyDeep(l){return function(d){return baseGet(d,l)}}function basePullAll(l,d,u,p){var h=p?baseIndexOfWith:baseIndexOf,g=-1,f=d.length,m=l;for(l===d&&(d=copyArray(d)),u&&(m=arrayMap(l,baseUnary(u)));++g<f;)for(var v=0,y=d[g],S=u?u(y):y;(v=h(m,S,v,p))>-1;)m!==l&&Lt.call(m,v,1),Lt.call(l,v,1);return l}function basePullAt(l,d){for(var u=l?d.length:0,p=u-1;u--;){var h=d[u];if(u==p||h!==g){var g=h;isIndex(h)?Lt.call(l,h,1):baseUnset(l,h)}}return l}function baseRandom(l,d){return l+qt(dn()*(d-l+1))}function baseRange(l,d,u,p){for(var g=-1,f=rn(Wt((d-l)/(u||1)),0),m=h(f);f--;)m[p?f:++g]=l,l+=u;return m}function baseRepeat(l,d){var u=\"\";if(!l||d<1||d>W)return u;do{d%2&&(u+=l),(d=qt(d/2))&&(l+=l)}while(d);return u}function baseRest(l,d){return ti(overRest(l,d,identity),l+\"\")}function baseSample(l){return arraySample(values(l))}function baseSampleSize(l,d){var u=values(l);return shuffleSelf(u,baseClamp(d,0,u.length))}function baseSet(l,d,p,h){if(!isObject(l))return l;for(var g=-1,f=(d=castPath(d,l)).length,m=f-1,v=l;null!=v&&++g<f;){var y=toKey(d[g]),S=p;if(\"__proto__\"===y||\"constructor\"===y||\"prototype\"===y)return l;if(g!=m){var _=v[y];(S=h?h(_,y,v):u)===u&&(S=isObject(_)?_:isIndex(d[g+1])?[]:{})}assignValue(v,y,S),v=v[y]}return l}var Gn=Pn?function(l,d){return Pn.set(l,d),l}:identity,Wn=Ut?function(l,d){return Ut(l,\"toString\",{configurable:!0,enumerable:!1,value:constant(d),writable:!0})}:identity;function baseShuffle(l){return shuffleSelf(values(l))}function baseSlice(l,d,u){var p=-1,g=l.length;d<0&&(d=-d>g?0:g+d),(u=u>g?g:u)<0&&(u+=g),g=d>u?0:u-d>>>0,d>>>=0;for(var f=h(g);++p<g;)f[p]=l[p+d];return f}function baseSome(l,d){var u;return jn(l,(function(l,p,h){return!(u=d(l,p,h))})),!!u}function baseSortedIndex(l,d,u){var p=0,h=null==l?p:l.length;if(\"number\"==typeof d&&d==d&&h<=Q){for(;p<h;){var g=p+h>>>1,f=l[g];null!==f&&!isSymbol(f)&&(u?f<=d:f<d)?p=g+1:h=g}return h}return baseSortedIndexBy(l,d,identity,u)}function baseSortedIndexBy(l,d,p,h){var g=0,f=null==l?0:l.length;if(0===f)return 0;for(var m=(d=p(d))!=d,v=null===d,y=isSymbol(d),S=d===u;g<f;){var _=qt((g+f)/2),C=p(l[_]),E=C!==u,T=null===C,b=C==C,I=isSymbol(C);if(m)var A=h||b;else A=S?b&&(h||E):v?b&&E&&(h||!T):y?b&&E&&!T&&(h||!I):!T&&!I&&(h?C<=d:C<d);A?g=_+1:f=_}return on(f,J)}function baseSortedUniq(l,d){for(var u=-1,p=l.length,h=0,g=[];++u<p;){var f=l[u],m=d?d(f):f;if(!u||!eq(m,v)){var v=m;g[h++]=0===f?0:f}}return g}function baseToNumber(l){return\"number\"==typeof l?l:isSymbol(l)?z:+l}function baseToString(l){if(\"string\"==typeof l)return l;if(Vi(l))return arrayMap(l,baseToString)+\"\";if(isSymbol(l))return Fn?Fn.call(l):\"\";var d=l+\"\";return\"0\"==d&&1/l==-G?\"-0\":d}function baseUniq(l,d,u){var p=-1,h=arrayIncludes,f=l.length,m=!0,v=[],y=v;if(u)m=!1,h=arrayIncludesWith;else if(f>=g){var S=d?null:Kn(l);if(S)return setToArray(S);m=!1,h=cacheHas,y=new SetCache}else y=d?[]:v;e:for(;++p<f;){var _=l[p],C=d?d(_):_;if(_=u||0!==_?_:0,m&&C==C){for(var E=y.length;E--;)if(y[E]===C)continue e;d&&y.push(C),v.push(_)}else h(y,C,u)||(y!==v&&y.push(C),v.push(_))}return v}function baseUnset(l,d){return null==(l=parent(l,d=castPath(d,l)))||delete l[toKey(last(d))]}function baseUpdate(l,d,u,p){return baseSet(l,d,u(baseGet(l,d)),p)}function baseWhile(l,d,u,p){for(var h=l.length,g=p?h:-1;(p?g--:++g<h)&&d(l[g],g,l););return u?baseSlice(l,p?0:g,p?g+1:h):baseSlice(l,p?g+1:0,p?h:g)}function baseWrapperValue(l,d){var u=l;return u instanceof LazyWrapper&&(u=u.value()),arrayReduce(d,(function(l,d){return d.func.apply(d.thisArg,arrayPush([l],d.args))}),u)}function baseXor(l,d,u){var p=l.length;if(p<2)return p?baseUniq(l[0]):[];for(var g=-1,f=h(p);++g<p;)for(var m=l[g],v=-1;++v<p;)v!=g&&(f[g]=baseDifference(f[g]||m,l[v],d,u));return baseUniq(baseFlatten(f,1),d,u)}function baseZipObject(l,d,p){for(var h=-1,g=l.length,f=d.length,m={};++h<g;){var v=h<f?d[h]:u;p(m,l[h],v)}return m}function castArrayLikeObject(l){return isArrayLikeObject(l)?l:[]}function castFunction(l){return\"function\"==typeof l?l:identity}function castPath(l,d){return Vi(l)?l:isKey(l,d)?[l]:ni(toString(l))}var qn=baseRest;function castSlice(l,d,p){var h=l.length;return p=p===u?h:p,!d&&p>=h?l:baseSlice(l,d,p)}var zn=jt||function(l){return an.clearTimeout(l)};function cloneBuffer(l,d){if(d)return l.slice();var u=l.length,p=Mt?Mt(u):new l.constructor(u);return l.copy(p),p}function cloneArrayBuffer(l){var d=new l.constructor(l.byteLength);return new Ot(d).set(new Ot(l)),d}function cloneDataView(l,d){var u=d?cloneArrayBuffer(l.buffer):l.buffer;return new l.constructor(u,l.byteOffset,l.byteLength)}function cloneRegExp(l){var d=new l.constructor(l.source,et.exec(l));return d.lastIndex=l.lastIndex,d}function cloneSymbol(l){return xn?ut(xn.call(l)):{}}function cloneTypedArray(l,d){var u=d?cloneArrayBuffer(l.buffer):l.buffer;return new l.constructor(u,l.byteOffset,l.length)}function compareAscending(l,d){if(l!==d){var p=l!==u,h=null===l,g=l==l,f=isSymbol(l),m=d!==u,v=null===d,y=d==d,S=isSymbol(d);if(!v&&!S&&!f&&l>d||f&&m&&y&&!v&&!S||h&&m&&y||!p&&y||!g)return 1;if(!h&&!f&&!S&&l<d||S&&p&&g&&!h&&!f||v&&p&&g||!m&&g||!y)return-1}return 0}function compareMultiple(l,d,u){for(var p=-1,h=l.criteria,g=d.criteria,f=h.length,m=u.length;++p<f;){var v=compareAscending(h[p],g[p]);if(v)return p>=m?v:v*(\"desc\"==u[p]?-1:1)}return l.index-d.index}function composeArgs(l,d,u,p){for(var g=-1,f=l.length,m=u.length,v=-1,y=d.length,S=rn(f-m,0),_=h(y+S),C=!p;++v<y;)_[v]=d[v];for(;++g<m;)(C||g<f)&&(_[u[g]]=l[g]);for(;S--;)_[v++]=l[g++];return _}function composeArgsRight(l,d,u,p){for(var g=-1,f=l.length,m=-1,v=u.length,y=-1,S=d.length,_=rn(f-v,0),C=h(_+S),E=!p;++g<_;)C[g]=l[g];for(var T=g;++y<S;)C[T+y]=d[y];for(;++m<v;)(E||g<f)&&(C[T+u[m]]=l[g++]);return C}function copyArray(l,d){var u=-1,p=l.length;for(d||(d=h(p));++u<p;)d[u]=l[u];return d}function copyObject(l,d,p,h){var g=!p;p||(p={});for(var f=-1,m=d.length;++f<m;){var v=d[f],y=h?h(p[v],l[v],v,p,l):u;y===u&&(y=l[v]),g?baseAssignValue(p,v,y):assignValue(p,v,y)}return p}function copySymbols(l,d){return copyObject(l,Qn(l),d)}function copySymbolsIn(l,d){return copyObject(l,Yn(l),d)}function createAggregator(l,d){return function(u,p){var h=Vi(u)?arrayAggregator:baseAggregator,g=d?d():{};return h(u,l,getIteratee(p,2),g)}}function createAssigner(l){return baseRest((function(d,p){var h=-1,g=p.length,f=g>1?p[g-1]:u,m=g>2?p[2]:u;for(f=l.length>3&&\"function\"==typeof f?(g--,f):u,m&&isIterateeCall(p[0],p[1],m)&&(f=g<3?u:f,g=1),d=ut(d);++h<g;){var v=p[h];v&&l(d,v,h,f)}return d}))}function createBaseEach(l,d){return function(u,p){if(null==u)return u;if(!isArrayLike(u))return l(u,p);for(var h=u.length,g=d?h:-1,f=ut(u);(d?g--:++g<h)&&!1!==p(f[g],g,f););return u}}function createBaseFor(l){return function(d,u,p){for(var h=-1,g=ut(d),f=p(d),m=f.length;m--;){var v=f[l?m:++h];if(!1===u(g[v],v,g))break}return d}}function createBind(l,d,u){var p=d&A,h=createCtor(l);function wrapper(){return(this&&this!==an&&this instanceof wrapper?h:l).apply(p?u:this,arguments)}return wrapper}function createCaseFirst(l){return function(d){var p=hasUnicode(d=toString(d))?stringToArray(d):u,h=p?p[0]:d.charAt(0),g=p?castSlice(p,1).join(\"\"):d.slice(1);return h[l]()+g}}function createCompounder(l){return function(d){return arrayReduce(words(deburr(d).replace(Vt,\"\")),l,\"\")}}function createCtor(l){return function(){var d=arguments;switch(d.length){case 0:return new l;case 1:return new l(d[0]);case 2:return new l(d[0],d[1]);case 3:return new l(d[0],d[1],d[2]);case 4:return new l(d[0],d[1],d[2],d[3]);case 5:return new l(d[0],d[1],d[2],d[3],d[4]);case 6:return new l(d[0],d[1],d[2],d[3],d[4],d[5]);case 7:return new l(d[0],d[1],d[2],d[3],d[4],d[5],d[6])}var u=Un(l.prototype),p=l.apply(u,d);return isObject(p)?p:u}}function createCurry(l,d,p){var g=createCtor(l);function wrapper(){for(var f=arguments.length,m=h(f),v=f,y=getHolder(wrapper);v--;)m[v]=arguments[v];var S=f<3&&m[0]!==y&&m[f-1]!==y?[]:replaceHolders(m,y);return(f-=S.length)<p?createRecurry(l,d,createHybrid,wrapper.placeholder,u,m,S,u,u,p-f):apply(this&&this!==an&&this instanceof wrapper?g:l,this,m)}return wrapper}function createFind(l){return function(d,p,h){var g=ut(d);if(!isArrayLike(d)){var f=getIteratee(p,3);d=keys(d),p=function(l){return f(g[l],l,g)}}var m=l(d,p,h);return m>-1?g[f?d[m]:m]:u}}function createFlow(l){return flatRest((function(d){var p=d.length,h=p,g=LodashWrapper.prototype.thru;for(l&&d.reverse();h--;){var f=d[h];if(\"function\"!=typeof f)throw new gt(m);if(g&&!v&&\"wrapper\"==getFuncName(f))var v=new LodashWrapper([],!0)}for(h=v?h:p;++h<p;){var y=getFuncName(f=d[h]),S=\"wrapper\"==y?Jn(f):u;v=S&&isLaziable(S[0])&&S[1]==(D|O|w|L)&&!S[4].length&&1==S[9]?v[getFuncName(S[0])].apply(v,S[3]):1==f.length&&isLaziable(f)?v[y]():v.thru(f)}return function(){var l=arguments,u=l[0];if(v&&1==l.length&&Vi(u))return v.plant(u).value();for(var h=0,g=p?d[h].apply(this,l):u;++h<p;)g=d[h].call(this,g);return g}}))}function createHybrid(l,d,p,g,f,m,v,y,S,_){var C=d&D,E=d&A,T=d&R,b=d&(O|M),I=d&k,P=T?u:createCtor(l);function wrapper(){for(var u=arguments.length,A=h(u),R=u;R--;)A[R]=arguments[R];if(b)var O=getHolder(wrapper),M=countHolders(A,O);if(g&&(A=composeArgs(A,g,f,b)),m&&(A=composeArgsRight(A,m,v,b)),u-=M,b&&u<_){var w=replaceHolders(A,O);return createRecurry(l,d,createHybrid,wrapper.placeholder,p,A,w,y,S,_-u)}var N=E?p:this,D=T?N[l]:l;return u=A.length,y?A=reorder(A,y):I&&u>1&&A.reverse(),C&&S<u&&(A.length=S),this&&this!==an&&this instanceof wrapper&&(D=P||createCtor(D)),D.apply(N,A)}return wrapper}function createInverter(l,d){return function(u,p){return baseInverter(u,l,d(p),{})}}function createMathOperation(l,d){return function(p,h){var g;if(p===u&&h===u)return d;if(p!==u&&(g=p),h!==u){if(g===u)return h;\"string\"==typeof p||\"string\"==typeof h?(p=baseToString(p),h=baseToString(h)):(p=baseToNumber(p),h=baseToNumber(h)),g=l(p,h)}return g}}function createOver(l){return flatRest((function(d){return d=arrayMap(d,baseUnary(getIteratee())),baseRest((function(u){var p=this;return l(d,(function(l){return apply(l,p,u)}))}))}))}function createPadding(l,d){var p=(d=d===u?\" \":baseToString(d)).length;if(p<2)return p?baseRepeat(d,l):d;var h=baseRepeat(d,Wt(l/stringSize(d)));return hasUnicode(d)?castSlice(stringToArray(h),0,l).join(\"\"):h.slice(0,l)}function createPartial(l,d,u,p){var g=d&A,f=createCtor(l);function wrapper(){for(var d=-1,m=arguments.length,v=-1,y=p.length,S=h(y+m),_=this&&this!==an&&this instanceof wrapper?f:l;++v<y;)S[v]=p[v];for(;m--;)S[v++]=arguments[++d];return apply(_,g?u:this,S)}return wrapper}function createRange(l){return function(d,p,h){return h&&\"number\"!=typeof h&&isIterateeCall(d,p,h)&&(p=h=u),d=toFinite(d),p===u?(p=d,d=0):p=toFinite(p),baseRange(d,p,h=h===u?d<p?1:-1:toFinite(h),l)}}function createRelationalOperation(l){return function(d,u){return\"string\"==typeof d&&\"string\"==typeof u||(d=toNumber(d),u=toNumber(u)),l(d,u)}}function createRecurry(l,d,p,h,g,f,m,v,y,S){var _=d&O;d|=_?w:N,(d&=~(_?N:w))&P||(d&=~(A|R));var C=[l,d,g,_?f:u,_?m:u,_?u:f,_?u:m,v,y,S],E=p.apply(u,C);return isLaziable(l)&&Zn(E,C),E.placeholder=h,setWrapToString(E,l,d)}function createRound(l){var d=dt[l];return function(l,u){if(l=toNumber(l),(u=null==u?0:on(toInteger(u),292))&&Xt(l)){var p=(toString(l)+\"e\").split(\"e\");return+((p=(toString(d(p[0]+\"e\"+(+p[1]+u)))+\"e\").split(\"e\"))[0]+\"e\"+(+p[1]-u))}return d(l)}}var Kn=In&&1/setToArray(new In([,-0]))[1]==G?function(l){return new In(l)}:noop;function createToPairs(l){return function(d){var u=$n(d);return u==ae?mapToArray(d):u==he?setToPairs(d):baseToPairs(d,l(d))}}function createWrap(l,d,p,h,g,f,v,y){var S=d&R;if(!S&&\"function\"!=typeof l)throw new gt(m);var _=h?h.length:0;if(_||(d&=~(w|N),h=g=u),v=v===u?v:rn(toInteger(v),0),y=y===u?y:toInteger(y),_-=g?g.length:0,d&N){var C=h,E=g;h=g=u}var T=S?u:Jn(l),b=[l,d,p,h,g,C,E,f,v,y];if(T&&mergeData(b,T),l=b[0],d=b[1],p=b[2],h=b[3],g=b[4],!(y=b[9]=b[9]===u?S?0:l.length:rn(b[9]-_,0))&&d&(O|M)&&(d&=~(O|M)),d&&d!=A)I=d==O||d==M?createCurry(l,d,y):d!=w&&d!=(A|w)||g.length?createHybrid.apply(u,b):createPartial(l,d,p,h);else var I=createBind(l,d,p);return setWrapToString((T?Gn:Zn)(I,b),l,d)}function customDefaultsAssignIn(l,d,p,h){return l===u||eq(l,vt[p])&&!_t.call(h,p)?d:l}function customDefaultsMerge(l,d,p,h,g,f){return isObject(l)&&isObject(d)&&(f.set(d,l),baseMerge(l,d,u,customDefaultsMerge,f),f.delete(d)),l}function customOmitClone(l){return isPlainObject(l)?u:l}function equalArrays(l,d,p,h,g,f){var m=p&b,v=l.length,y=d.length;if(v!=y&&!(m&&y>v))return!1;var S=f.get(l),_=f.get(d);if(S&&_)return S==d&&_==l;var C=-1,E=!0,T=p&I?new SetCache:u;for(f.set(l,d),f.set(d,l);++C<v;){var A=l[C],R=d[C];if(h)var P=m?h(R,A,C,d,l,f):h(A,R,C,l,d,f);if(P!==u){if(P)continue;E=!1;break}if(T){if(!arraySome(d,(function(l,d){if(!cacheHas(T,d)&&(A===l||g(A,l,p,h,f)))return T.push(d)}))){E=!1;break}}else if(A!==R&&!g(A,R,p,h,f)){E=!1;break}}return f.delete(l),f.delete(d),E}function equalByTag(l,d,u,p,h,g,f){switch(u){case _e:if(l.byteLength!=d.byteLength||l.byteOffset!=d.byteOffset)return!1;l=l.buffer,d=d.buffer;case Se:return!(l.byteLength!=d.byteLength||!g(new Ot(l),new Ot(d)));case ee:case te:case se:return eq(+l,+d);case ie:return l.name==d.name&&l.message==d.message;case pe:case ge:return l==d+\"\";case ae:var m=mapToArray;case he:var v=p&b;if(m||(m=setToArray),l.size!=d.size&&!v)return!1;var y=f.get(l);if(y)return y==d;p|=I,f.set(l,d);var S=equalArrays(m(l),m(d),p,h,g,f);return f.delete(l),S;case fe:if(xn)return xn.call(l)==xn.call(d)}return!1}function equalObjects(l,d,p,h,g,f){var m=p&b,v=getAllKeys(l),y=v.length;if(y!=getAllKeys(d).length&&!m)return!1;for(var S=y;S--;){var _=v[S];if(!(m?_ in d:_t.call(d,_)))return!1}var C=f.get(l),E=f.get(d);if(C&&E)return C==d&&E==l;var T=!0;f.set(l,d),f.set(d,l);for(var I=m;++S<y;){var A=l[_=v[S]],R=d[_];if(h)var P=m?h(R,A,_,d,l,f):h(A,R,_,l,d,f);if(!(P===u?A===R||g(A,R,p,h,f):P)){T=!1;break}I||(I=\"constructor\"==_)}if(T&&!I){var O=l.constructor,M=d.constructor;O==M||!(\"constructor\"in l)||!(\"constructor\"in d)||\"function\"==typeof O&&O instanceof O&&\"function\"==typeof M&&M instanceof M||(T=!1)}return f.delete(l),f.delete(d),T}function flatRest(l){return ti(overRest(l,u,flatten),l+\"\")}function getAllKeys(l){return baseGetAllKeys(l,keys,Qn)}function getAllKeysIn(l){return baseGetAllKeys(l,keysIn,Yn)}var Jn=Pn?function(l){return Pn.get(l)}:noop;function getFuncName(l){for(var d=l.name+\"\",u=On[d],p=_t.call(On,d)?u.length:0;p--;){var h=u[p],g=h.func;if(null==g||g==l)return h.name}return d}function getHolder(l){return(_t.call(lodash,\"placeholder\")?lodash:l).placeholder}function getIteratee(){var l=lodash.iteratee||iteratee;return l=l===iteratee?baseIteratee:l,arguments.length?l(arguments[0],arguments[1]):l}function getMapData(l,d){var u=l.__data__;return isKeyable(d)?u[\"string\"==typeof d?\"string\":\"hash\"]:u.map}function getMatchData(l){for(var d=keys(l),u=d.length;u--;){var p=d[u],h=l[p];d[u]=[p,h,isStrictComparable(h)]}return d}function getNative(l,d){var p=getValue(l,d);return baseIsNative(p)?p:u}function getRawTag(l){var d=_t.call(l,Ft),p=l[Ft];try{l[Ft]=u;var h=!0}catch(l){}var g=Tt.call(l);return h&&(d?l[Ft]=p:delete l[Ft]),g}var Qn=zt?function(l){return null==l?[]:(l=ut(l),arrayFilter(zt(l),(function(d){return Dt.call(l,d)})))}:stubArray,Yn=zt?function(l){for(var d=[];l;)arrayPush(d,Qn(l)),l=wt(l);return d}:stubArray,$n=baseGetTag;function getView(l,d,u){for(var p=-1,h=u.length;++p<h;){var g=u[p],f=g.size;switch(g.type){case\"drop\":l+=f;break;case\"dropRight\":d-=f;break;case\"take\":d=on(d,l+f);break;case\"takeRight\":l=rn(l,d-f)}}return{start:l,end:d}}function getWrapDetails(l){var d=l.match(Je);return d?d[1].split(Qe):[]}function hasPath(l,d,u){for(var p=-1,h=(d=castPath(d,l)).length,g=!1;++p<h;){var f=toKey(d[p]);if(!(g=null!=l&&u(l,f)))break;l=l[f]}return g||++p!=h?g:!!(h=null==l?0:l.length)&&isLength(h)&&isIndex(f,h)&&(Vi(l)||Bi(l))}function initCloneArray(l){var d=l.length,u=new l.constructor(d);return d&&\"string\"==typeof l[0]&&_t.call(l,\"index\")&&(u.index=l.index,u.input=l.input),u}function initCloneObject(l){return\"function\"!=typeof l.constructor||isPrototype(l)?{}:Un(wt(l))}function initCloneByTag(l,d,u){var p=l.constructor;switch(d){case Se:return cloneArrayBuffer(l);case ee:case te:return new p(+l);case _e:return cloneDataView(l,u);case Ce:case Ee:case Te:case be:case Ie:case Ae:case Re:case Pe:case Oe:return cloneTypedArray(l,u);case ae:return new p;case se:case ge:return new p(l);case pe:return cloneRegExp(l);case he:return new p;case fe:return cloneSymbol(l)}}function insertWrapDetails(l,d){var u=d.length;if(!u)return l;var p=u-1;return d[p]=(u>1?\"& \":\"\")+d[p],d=d.join(u>2?\", \":\" \"),l.replace(Ke,\"{\\n/* [wrapped with \"+d+\"] */\\n\")}function isFlattenable(l){return Vi(l)||Bi(l)||!!(kt&&l&&l[kt])}function isIndex(l,d){var u=typeof l;return!!(d=null==d?W:d)&&(\"number\"==u||\"symbol\"!=u&&ot.test(l))&&l>-1&&l%1==0&&l<d}function isIterateeCall(l,d,u){if(!isObject(u))return!1;var p=typeof d;return!!(\"number\"==p?isArrayLike(u)&&isIndex(d,u.length):\"string\"==p&&d in u)&&eq(u[d],l)}function isKey(l,d){if(Vi(l))return!1;var u=typeof l;return!(\"number\"!=u&&\"symbol\"!=u&&\"boolean\"!=u&&null!=l&&!isSymbol(l))||(Ve.test(l)||!Be.test(l)||null!=d&&l in ut(d))}function isKeyable(l){var d=typeof l;return\"string\"==d||\"number\"==d||\"symbol\"==d||\"boolean\"==d?\"__proto__\"!==l:null===l}function isLaziable(l){var d=getFuncName(l),u=lodash[d];if(\"function\"!=typeof u||!(d in LazyWrapper.prototype))return!1;if(l===u)return!0;var p=Jn(u);return!!p&&l===p[0]}function isMasked(l){return!!Et&&Et in l}(yn&&$n(new yn(new ArrayBuffer(1)))!=_e||Tn&&$n(new Tn)!=ae||bn&&$n(bn.resolve())!=de||In&&$n(new In)!=he||An&&$n(new An)!=ve)&&($n=function(l){var d=baseGetTag(l),p=d==le?l.constructor:u,h=p?toSource(p):\"\";if(h)switch(h){case Mn:return _e;case wn:return ae;case Nn:return de;case Dn:return he;case Ln:return ve}return d});var Xn=yt?isFunction:stubFalse;function isPrototype(l){var d=l&&l.constructor;return l===(\"function\"==typeof d&&d.prototype||vt)}function isStrictComparable(l){return l==l&&!isObject(l)}function matchesStrictComparable(l,d){return function(p){return null!=p&&(p[l]===d&&(d!==u||l in ut(p)))}}function memoizeCapped(l){var d=memoize(l,(function(l){return u.size===S&&u.clear(),l})),u=d.cache;return d}function mergeData(l,d){var u=l[1],p=d[1],h=u|p,g=h<(A|R|D),f=p==D&&u==O||p==D&&u==L&&l[7].length<=d[8]||p==(D|L)&&d[7].length<=d[8]&&u==O;if(!g&&!f)return l;p&A&&(l[2]=d[2],h|=u&A?0:P);var m=d[3];if(m){var v=l[3];l[3]=v?composeArgs(v,m,d[4]):m,l[4]=v?replaceHolders(l[3],_):d[4]}return(m=d[5])&&(v=l[5],l[5]=v?composeArgsRight(v,m,d[6]):m,l[6]=v?replaceHolders(l[5],_):d[6]),(m=d[7])&&(l[7]=m),p&D&&(l[8]=null==l[8]?d[8]:on(l[8],d[8])),null==l[9]&&(l[9]=d[9]),l[0]=d[0],l[1]=h,l}function nativeKeysIn(l){var d=[];if(null!=l)for(var u in ut(l))d.push(u);return d}function objectToString(l){return Tt.call(l)}function overRest(l,d,p){return d=rn(d===u?l.length-1:d,0),function(){for(var u=arguments,g=-1,f=rn(u.length-d,0),m=h(f);++g<f;)m[g]=u[d+g];g=-1;for(var v=h(d+1);++g<d;)v[g]=u[g];return v[d]=p(m),apply(l,this,v)}}function parent(l,d){return d.length<2?l:baseGet(l,baseSlice(d,0,-1))}function reorder(l,d){for(var p=l.length,h=on(d.length,p),g=copyArray(l);h--;){var f=d[h];l[h]=isIndex(f,p)?g[f]:u}return l}function safeGet(l,d){if((\"constructor\"!==d||\"function\"!=typeof l[d])&&\"__proto__\"!=d)return l[d]}var Zn=shortOut(Gn),ei=Gt||function(l,d){return an.setTimeout(l,d)},ti=shortOut(Wn);function setWrapToString(l,d,u){var p=d+\"\";return ti(l,insertWrapDetails(p,updateWrapDetails(getWrapDetails(p),u)))}function shortOut(l){var d=0,p=0;return function(){var h=sn(),g=j-(h-p);if(p=h,g>0){if(++d>=U)return arguments[0]}else d=0;return l.apply(u,arguments)}}function shuffleSelf(l,d){var p=-1,h=l.length,g=h-1;for(d=d===u?h:d;++p<d;){var f=baseRandom(p,g),m=l[f];l[f]=l[p],l[p]=m}return l.length=d,l}var ni=memoizeCapped((function(l){var d=[];return 46===l.charCodeAt(0)&&d.push(\"\"),l.replace(He,(function(l,u,p,h){d.push(p?h.replace(Xe,\"$1\"):u||l)})),d}));function toKey(l){if(\"string\"==typeof l||isSymbol(l))return l;var d=l+\"\";return\"0\"==d&&1/l==-G?\"-0\":d}function toSource(l){if(null!=l){try{return St.call(l)}catch(l){}try{return l+\"\"}catch(l){}}return\"\"}function updateWrapDetails(l,d){return arrayEach(Y,(function(u){var p=\"_.\"+u[0];d&u[1]&&!arrayIncludes(l,p)&&l.push(p)})),l.sort()}function wrapperClone(l){if(l instanceof LazyWrapper)return l.clone();var d=new LodashWrapper(l.__wrapped__,l.__chain__);return d.__actions__=copyArray(l.__actions__),d.__index__=l.__index__,d.__values__=l.__values__,d}function chunk(l,d,p){d=(p?isIterateeCall(l,d,p):d===u)?1:rn(toInteger(d),0);var g=null==l?0:l.length;if(!g||d<1)return[];for(var f=0,m=0,v=h(Wt(g/d));f<g;)v[m++]=baseSlice(l,f,f+=d);return v}function compact(l){for(var d=-1,u=null==l?0:l.length,p=0,h=[];++d<u;){var g=l[d];g&&(h[p++]=g)}return h}function concat(){var l=arguments.length;if(!l)return[];for(var d=h(l-1),u=arguments[0],p=l;p--;)d[p-1]=arguments[p];return arrayPush(Vi(u)?copyArray(u):[u],baseFlatten(d,1))}var ii=baseRest((function(l,d){return isArrayLikeObject(l)?baseDifference(l,baseFlatten(d,1,isArrayLikeObject,!0)):[]})),ri=baseRest((function(l,d){var p=last(d);return isArrayLikeObject(p)&&(p=u),isArrayLikeObject(l)?baseDifference(l,baseFlatten(d,1,isArrayLikeObject,!0),getIteratee(p,2)):[]})),oi=baseRest((function(l,d){var p=last(d);return isArrayLikeObject(p)&&(p=u),isArrayLikeObject(l)?baseDifference(l,baseFlatten(d,1,isArrayLikeObject,!0),u,p):[]}));function drop(l,d,p){var h=null==l?0:l.length;return h?baseSlice(l,(d=p||d===u?1:toInteger(d))<0?0:d,h):[]}function dropRight(l,d,p){var h=null==l?0:l.length;return h?baseSlice(l,0,(d=h-(d=p||d===u?1:toInteger(d)))<0?0:d):[]}function dropRightWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3),!0,!0):[]}function dropWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3),!0):[]}function fill(l,d,u,p){var h=null==l?0:l.length;return h?(u&&\"number\"!=typeof u&&isIterateeCall(l,d,u)&&(u=0,p=h),baseFill(l,d,u,p)):[]}function findIndex(l,d,u){var p=null==l?0:l.length;if(!p)return-1;var h=null==u?0:toInteger(u);return h<0&&(h=rn(p+h,0)),baseFindIndex(l,getIteratee(d,3),h)}function findLastIndex(l,d,p){var h=null==l?0:l.length;if(!h)return-1;var g=h-1;return p!==u&&(g=toInteger(p),g=p<0?rn(h+g,0):on(g,h-1)),baseFindIndex(l,getIteratee(d,3),g,!0)}function flatten(l){return(null==l?0:l.length)?baseFlatten(l,1):[]}function flattenDeep(l){return(null==l?0:l.length)?baseFlatten(l,G):[]}function flattenDepth(l,d){return(null==l?0:l.length)?baseFlatten(l,d=d===u?1:toInteger(d)):[]}function fromPairs(l){for(var d=-1,u=null==l?0:l.length,p={};++d<u;){var h=l[d];p[h[0]]=h[1]}return p}function head(l){return l&&l.length?l[0]:u}function indexOf(l,d,u){var p=null==l?0:l.length;if(!p)return-1;var h=null==u?0:toInteger(u);return h<0&&(h=rn(p+h,0)),baseIndexOf(l,d,h)}function initial(l){return(null==l?0:l.length)?baseSlice(l,0,-1):[]}var ai=baseRest((function(l){var d=arrayMap(l,castArrayLikeObject);return d.length&&d[0]===l[0]?baseIntersection(d):[]})),si=baseRest((function(l){var d=last(l),p=arrayMap(l,castArrayLikeObject);return d===last(p)?d=u:p.pop(),p.length&&p[0]===l[0]?baseIntersection(p,getIteratee(d,2)):[]})),ci=baseRest((function(l){var d=last(l),p=arrayMap(l,castArrayLikeObject);return(d=\"function\"==typeof d?d:u)&&p.pop(),p.length&&p[0]===l[0]?baseIntersection(p,u,d):[]}));function join(l,d){return null==l?\"\":Zt.call(l,d)}function last(l){var d=null==l?0:l.length;return d?l[d-1]:u}function lastIndexOf(l,d,p){var h=null==l?0:l.length;if(!h)return-1;var g=h;return p!==u&&(g=(g=toInteger(p))<0?rn(h+g,0):on(g,h-1)),d==d?strictLastIndexOf(l,d,g):baseFindIndex(l,baseIsNaN,g,!0)}function nth(l,d){return l&&l.length?baseNth(l,toInteger(d)):u}var li=baseRest(pullAll);function pullAll(l,d){return l&&l.length&&d&&d.length?basePullAll(l,d):l}function pullAllBy(l,d,u){return l&&l.length&&d&&d.length?basePullAll(l,d,getIteratee(u,2)):l}function pullAllWith(l,d,p){return l&&l.length&&d&&d.length?basePullAll(l,d,u,p):l}var di=flatRest((function(l,d){var u=null==l?0:l.length,p=baseAt(l,d);return basePullAt(l,arrayMap(d,(function(l){return isIndex(l,u)?+l:l})).sort(compareAscending)),p}));function remove(l,d){var u=[];if(!l||!l.length)return u;var p=-1,h=[],g=l.length;for(d=getIteratee(d,3);++p<g;){var f=l[p];d(f,p,l)&&(u.push(f),h.push(p))}return basePullAt(l,h),u}function reverse(l){return null==l?l:un.call(l)}function slice(l,d,p){var h=null==l?0:l.length;return h?(p&&\"number\"!=typeof p&&isIterateeCall(l,d,p)?(d=0,p=h):(d=null==d?0:toInteger(d),p=p===u?h:toInteger(p)),baseSlice(l,d,p)):[]}function sortedIndex(l,d){return baseSortedIndex(l,d)}function sortedIndexBy(l,d,u){return baseSortedIndexBy(l,d,getIteratee(u,2))}function sortedIndexOf(l,d){var u=null==l?0:l.length;if(u){var p=baseSortedIndex(l,d);if(p<u&&eq(l[p],d))return p}return-1}function sortedLastIndex(l,d){return baseSortedIndex(l,d,!0)}function sortedLastIndexBy(l,d,u){return baseSortedIndexBy(l,d,getIteratee(u,2),!0)}function sortedLastIndexOf(l,d){if(null==l?0:l.length){var u=baseSortedIndex(l,d,!0)-1;if(eq(l[u],d))return u}return-1}function sortedUniq(l){return l&&l.length?baseSortedUniq(l):[]}function sortedUniqBy(l,d){return l&&l.length?baseSortedUniq(l,getIteratee(d,2)):[]}function tail(l){var d=null==l?0:l.length;return d?baseSlice(l,1,d):[]}function take(l,d,p){return l&&l.length?baseSlice(l,0,(d=p||d===u?1:toInteger(d))<0?0:d):[]}function takeRight(l,d,p){var h=null==l?0:l.length;return h?baseSlice(l,(d=h-(d=p||d===u?1:toInteger(d)))<0?0:d,h):[]}function takeRightWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3),!1,!0):[]}function takeWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3)):[]}var ui=baseRest((function(l){return baseUniq(baseFlatten(l,1,isArrayLikeObject,!0))})),pi=baseRest((function(l){var d=last(l);return isArrayLikeObject(d)&&(d=u),baseUniq(baseFlatten(l,1,isArrayLikeObject,!0),getIteratee(d,2))})),hi=baseRest((function(l){var d=last(l);return d=\"function\"==typeof d?d:u,baseUniq(baseFlatten(l,1,isArrayLikeObject,!0),u,d)}));function uniq(l){return l&&l.length?baseUniq(l):[]}function uniqBy(l,d){return l&&l.length?baseUniq(l,getIteratee(d,2)):[]}function uniqWith(l,d){return d=\"function\"==typeof d?d:u,l&&l.length?baseUniq(l,u,d):[]}function unzip(l){if(!l||!l.length)return[];var d=0;return l=arrayFilter(l,(function(l){if(isArrayLikeObject(l))return d=rn(l.length,d),!0})),baseTimes(d,(function(d){return arrayMap(l,baseProperty(d))}))}function unzipWith(l,d){if(!l||!l.length)return[];var p=unzip(l);return null==d?p:arrayMap(p,(function(l){return apply(d,u,l)}))}var gi=baseRest((function(l,d){return isArrayLikeObject(l)?baseDifference(l,d):[]})),fi=baseRest((function(l){return baseXor(arrayFilter(l,isArrayLikeObject))})),mi=baseRest((function(l){var d=last(l);return isArrayLikeObject(d)&&(d=u),baseXor(arrayFilter(l,isArrayLikeObject),getIteratee(d,2))})),vi=baseRest((function(l){var d=last(l);return d=\"function\"==typeof d?d:u,baseXor(arrayFilter(l,isArrayLikeObject),u,d)})),yi=baseRest(unzip);function zipObject(l,d){return baseZipObject(l||[],d||[],assignValue)}function zipObjectDeep(l,d){return baseZipObject(l||[],d||[],baseSet)}var Si=baseRest((function(l){var d=l.length,p=d>1?l[d-1]:u;return p=\"function\"==typeof p?(l.pop(),p):u,unzipWith(l,p)}));function chain(l){var d=lodash(l);return d.__chain__=!0,d}function tap(l,d){return d(l),l}function thru(l,d){return d(l)}var _i=flatRest((function(l){var d=l.length,p=d?l[0]:0,h=this.__wrapped__,interceptor=function(d){return baseAt(d,l)};return!(d>1||this.__actions__.length)&&h instanceof LazyWrapper&&isIndex(p)?((h=h.slice(p,+p+(d?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:u}),new LodashWrapper(h,this.__chain__).thru((function(l){return d&&!l.length&&l.push(u),l}))):this.thru(interceptor)}));function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){this.__values__===u&&(this.__values__=toArray(this.value()));var l=this.__index__>=this.__values__.length;return{done:l,value:l?u:this.__values__[this.__index__++]}}function wrapperToIterator(){return this}function wrapperPlant(l){for(var d,p=this;p instanceof baseLodash;){var h=wrapperClone(p);h.__index__=0,h.__values__=u,d?g.__wrapped__=h:d=h;var g=h;p=p.__wrapped__}return g.__wrapped__=l,d}function wrapperReverse(){var l=this.__wrapped__;if(l instanceof LazyWrapper){var d=l;return this.__actions__.length&&(d=new LazyWrapper(this)),(d=d.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:u}),new LodashWrapper(d,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var Ci=createAggregator((function(l,d,u){_t.call(l,u)?++l[u]:baseAssignValue(l,u,1)}));function every(l,d,p){var h=Vi(l)?arrayEvery:baseEvery;return p&&isIterateeCall(l,d,p)&&(d=u),h(l,getIteratee(d,3))}function filter(l,d){return(Vi(l)?arrayFilter:baseFilter)(l,getIteratee(d,3))}var Ei=createFind(findIndex),Ti=createFind(findLastIndex);function flatMap(l,d){return baseFlatten(map(l,d),1)}function flatMapDeep(l,d){return baseFlatten(map(l,d),G)}function flatMapDepth(l,d,p){return p=p===u?1:toInteger(p),baseFlatten(map(l,d),p)}function forEach(l,d){return(Vi(l)?arrayEach:jn)(l,getIteratee(d,3))}function forEachRight(l,d){return(Vi(l)?arrayEachRight:Bn)(l,getIteratee(d,3))}var bi=createAggregator((function(l,d,u){_t.call(l,u)?l[u].push(d):baseAssignValue(l,u,[d])}));function includes(l,d,u,p){l=isArrayLike(l)?l:values(l),u=u&&!p?toInteger(u):0;var h=l.length;return u<0&&(u=rn(h+u,0)),isString(l)?u<=h&&l.indexOf(d,u)>-1:!!h&&baseIndexOf(l,d,u)>-1}var Ii=baseRest((function(l,d,u){var p=-1,g=\"function\"==typeof d,f=isArrayLike(l)?h(l.length):[];return jn(l,(function(l){f[++p]=g?apply(d,l,u):baseInvoke(l,d,u)})),f})),Ai=createAggregator((function(l,d,u){baseAssignValue(l,u,d)}));function map(l,d){return(Vi(l)?arrayMap:baseMap)(l,getIteratee(d,3))}function orderBy(l,d,p,h){return null==l?[]:(Vi(d)||(d=null==d?[]:[d]),Vi(p=h?u:p)||(p=null==p?[]:[p]),baseOrderBy(l,d,p))}var Ri=createAggregator((function(l,d,u){l[u?0:1].push(d)}),(function(){return[[],[]]}));function reduce(l,d,u){var p=Vi(l)?arrayReduce:baseReduce,h=arguments.length<3;return p(l,getIteratee(d,4),u,h,jn)}function reduceRight(l,d,u){var p=Vi(l)?arrayReduceRight:baseReduce,h=arguments.length<3;return p(l,getIteratee(d,4),u,h,Bn)}function reject(l,d){return(Vi(l)?arrayFilter:baseFilter)(l,negate(getIteratee(d,3)))}function sample(l){return(Vi(l)?arraySample:baseSample)(l)}function sampleSize(l,d,p){return d=(p?isIterateeCall(l,d,p):d===u)?1:toInteger(d),(Vi(l)?arraySampleSize:baseSampleSize)(l,d)}function shuffle(l){return(Vi(l)?arrayShuffle:baseShuffle)(l)}function size(l){if(null==l)return 0;if(isArrayLike(l))return isString(l)?stringSize(l):l.length;var d=$n(l);return d==ae||d==he?l.size:baseKeys(l).length}function some(l,d,p){var h=Vi(l)?arraySome:baseSome;return p&&isIterateeCall(l,d,p)&&(d=u),h(l,getIteratee(d,3))}var Pi=baseRest((function(l,d){if(null==l)return[];var u=d.length;return u>1&&isIterateeCall(l,d[0],d[1])?d=[]:u>2&&isIterateeCall(d[0],d[1],d[2])&&(d=[d[0]]),baseOrderBy(l,baseFlatten(d,1),[])})),Oi=Bt||function(){return an.Date.now()};function after(l,d){if(\"function\"!=typeof d)throw new gt(m);return l=toInteger(l),function(){if(--l<1)return d.apply(this,arguments)}}function ary(l,d,p){return d=p?u:d,d=l&&null==d?l.length:d,createWrap(l,D,u,u,u,u,d)}function before(l,d){var p;if(\"function\"!=typeof d)throw new gt(m);return l=toInteger(l),function(){return--l>0&&(p=d.apply(this,arguments)),l<=1&&(d=u),p}}var Mi=baseRest((function(l,d,u){var p=A;if(u.length){var h=replaceHolders(u,getHolder(Mi));p|=w}return createWrap(l,p,d,u,h)})),wi=baseRest((function(l,d,u){var p=A|R;if(u.length){var h=replaceHolders(u,getHolder(wi));p|=w}return createWrap(d,p,l,u,h)}));function curry(l,d,p){var h=createWrap(l,O,u,u,u,u,u,d=p?u:d);return h.placeholder=curry.placeholder,h}function curryRight(l,d,p){var h=createWrap(l,M,u,u,u,u,u,d=p?u:d);return h.placeholder=curryRight.placeholder,h}function debounce(l,d,p){var h,g,f,v,y,S,_=0,C=!1,E=!1,T=!0;if(\"function\"!=typeof l)throw new gt(m);function invokeFunc(d){var p=h,f=g;return h=g=u,_=d,v=l.apply(f,p)}function leadingEdge(l){return _=l,y=ei(timerExpired,d),C?invokeFunc(l):v}function remainingWait(l){var u=d-(l-S);return E?on(u,f-(l-_)):u}function shouldInvoke(l){var p=l-S;return S===u||p>=d||p<0||E&&l-_>=f}function timerExpired(){var l=Oi();if(shouldInvoke(l))return trailingEdge(l);y=ei(timerExpired,remainingWait(l))}function trailingEdge(l){return y=u,T&&h?invokeFunc(l):(h=g=u,v)}function cancel(){y!==u&&zn(y),_=0,h=S=g=y=u}function flush(){return y===u?v:trailingEdge(Oi())}function debounced(){var l=Oi(),p=shouldInvoke(l);if(h=arguments,g=this,S=l,p){if(y===u)return leadingEdge(S);if(E)return zn(y),y=ei(timerExpired,d),invokeFunc(S)}return y===u&&(y=ei(timerExpired,d)),v}return d=toNumber(d)||0,isObject(p)&&(C=!!p.leading,f=(E=\"maxWait\"in p)?rn(toNumber(p.maxWait)||0,d):f,T=\"trailing\"in p?!!p.trailing:T),debounced.cancel=cancel,debounced.flush=flush,debounced}var Ni=baseRest((function(l,d){return baseDelay(l,1,d)})),Di=baseRest((function(l,d,u){return baseDelay(l,toNumber(d)||0,u)}));function flip(l){return createWrap(l,k)}function memoize(l,d){if(\"function\"!=typeof l||null!=d&&\"function\"!=typeof d)throw new gt(m);var memoized=function(){var u=arguments,p=d?d.apply(this,u):u[0],h=memoized.cache;if(h.has(p))return h.get(p);var g=l.apply(this,u);return memoized.cache=h.set(p,g)||h,g};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(l){if(\"function\"!=typeof l)throw new gt(m);return function(){var d=arguments;switch(d.length){case 0:return!l.call(this);case 1:return!l.call(this,d[0]);case 2:return!l.call(this,d[0],d[1]);case 3:return!l.call(this,d[0],d[1],d[2])}return!l.apply(this,d)}}function once(l){return before(2,l)}memoize.Cache=MapCache;var Li=qn((function(l,d){var u=(d=1==d.length&&Vi(d[0])?arrayMap(d[0],baseUnary(getIteratee())):arrayMap(baseFlatten(d,1),baseUnary(getIteratee()))).length;return baseRest((function(p){for(var h=-1,g=on(p.length,u);++h<g;)p[h]=d[h].call(this,p[h]);return apply(l,this,p)}))})),ki=baseRest((function(l,d){var p=replaceHolders(d,getHolder(ki));return createWrap(l,w,u,d,p)})),xi=baseRest((function(l,d){var p=replaceHolders(d,getHolder(xi));return createWrap(l,N,u,d,p)})),Fi=flatRest((function(l,d){return createWrap(l,L,u,u,u,d)}));function rest(l,d){if(\"function\"!=typeof l)throw new gt(m);return baseRest(l,d=d===u?d:toInteger(d))}function spread(l,d){if(\"function\"!=typeof l)throw new gt(m);return d=null==d?0:rn(toInteger(d),0),baseRest((function(u){var p=u[d],h=castSlice(u,0,d);return p&&arrayPush(h,p),apply(l,this,h)}))}function throttle(l,d,u){var p=!0,h=!0;if(\"function\"!=typeof l)throw new gt(m);return isObject(u)&&(p=\"leading\"in u?!!u.leading:p,h=\"trailing\"in u?!!u.trailing:h),debounce(l,d,{leading:p,maxWait:d,trailing:h})}function unary(l){return ary(l,1)}function wrap(l,d){return ki(castFunction(d),l)}function castArray(){if(!arguments.length)return[];var l=arguments[0];return Vi(l)?l:[l]}function clone(l){return baseClone(l,T)}function cloneWith(l,d){return baseClone(l,T,d=\"function\"==typeof d?d:u)}function cloneDeep(l){return baseClone(l,C|T)}function cloneDeepWith(l,d){return baseClone(l,C|T,d=\"function\"==typeof d?d:u)}function conformsTo(l,d){return null==d||baseConformsTo(l,d,keys(d))}function eq(l,d){return l===d||l!=l&&d!=d}var Ui=createRelationalOperation(baseGt),ji=createRelationalOperation((function(l,d){return l>=d})),Bi=baseIsArguments(function(){return arguments}())?baseIsArguments:function(l){return isObjectLike(l)&&_t.call(l,\"callee\")&&!Dt.call(l,\"callee\")},Vi=h.isArray,Hi=pn?baseUnary(pn):baseIsArrayBuffer;function isArrayLike(l){return null!=l&&isLength(l.length)&&!isFunction(l)}function isArrayLikeObject(l){return isObjectLike(l)&&isArrayLike(l)}function isBoolean(l){return!0===l||!1===l||isObjectLike(l)&&baseGetTag(l)==ee}var Gi=$t||stubFalse,Wi=hn?baseUnary(hn):baseIsDate;function isElement(l){return isObjectLike(l)&&1===l.nodeType&&!isPlainObject(l)}function isEmpty(l){if(null==l)return!0;if(isArrayLike(l)&&(Vi(l)||\"string\"==typeof l||\"function\"==typeof l.splice||Gi(l)||Ji(l)||Bi(l)))return!l.length;var d=$n(l);if(d==ae||d==he)return!l.size;if(isPrototype(l))return!baseKeys(l).length;for(var u in l)if(_t.call(l,u))return!1;return!0}function isEqual(l,d){return baseIsEqual(l,d)}function isEqualWith(l,d,p){var h=(p=\"function\"==typeof p?p:u)?p(l,d):u;return h===u?baseIsEqual(l,d,u,p):!!h}function isError(l){if(!isObjectLike(l))return!1;var d=baseGetTag(l);return d==ie||d==ne||\"string\"==typeof l.message&&\"string\"==typeof l.name&&!isPlainObject(l)}function isFinite(l){return\"number\"==typeof l&&Xt(l)}function isFunction(l){if(!isObject(l))return!1;var d=baseGetTag(l);return d==re||d==oe||d==Z||d==ue}function isInteger(l){return\"number\"==typeof l&&l==toInteger(l)}function isLength(l){return\"number\"==typeof l&&l>-1&&l%1==0&&l<=W}function isObject(l){var d=typeof l;return null!=l&&(\"object\"==d||\"function\"==d)}function isObjectLike(l){return null!=l&&\"object\"==typeof l}var qi=gn?baseUnary(gn):baseIsMap;function isMatch(l,d){return l===d||baseIsMatch(l,d,getMatchData(d))}function isMatchWith(l,d,p){return p=\"function\"==typeof p?p:u,baseIsMatch(l,d,getMatchData(d),p)}function isNaN(l){return isNumber(l)&&l!=+l}function isNative(l){if(Xn(l))throw new Ye(f);return baseIsNative(l)}function isNull(l){return null===l}function isNil(l){return null==l}function isNumber(l){return\"number\"==typeof l||isObjectLike(l)&&baseGetTag(l)==se}function isPlainObject(l){if(!isObjectLike(l)||baseGetTag(l)!=le)return!1;var d=wt(l);if(null===d)return!0;var u=_t.call(d,\"constructor\")&&d.constructor;return\"function\"==typeof u&&u instanceof u&&St.call(u)==bt}var zi=fn?baseUnary(fn):baseIsRegExp;function isSafeInteger(l){return isInteger(l)&&l>=-W&&l<=W}var Ki=mn?baseUnary(mn):baseIsSet;function isString(l){return\"string\"==typeof l||!Vi(l)&&isObjectLike(l)&&baseGetTag(l)==ge}function isSymbol(l){return\"symbol\"==typeof l||isObjectLike(l)&&baseGetTag(l)==fe}var Ji=vn?baseUnary(vn):baseIsTypedArray;function isUndefined(l){return l===u}function isWeakMap(l){return isObjectLike(l)&&$n(l)==ve}function isWeakSet(l){return isObjectLike(l)&&baseGetTag(l)==ye}var Qi=createRelationalOperation(baseLt),Yi=createRelationalOperation((function(l,d){return l<=d}));function toArray(l){if(!l)return[];if(isArrayLike(l))return isString(l)?stringToArray(l):copyArray(l);if(xt&&l[xt])return iteratorToArray(l[xt]());var d=$n(l);return(d==ae?mapToArray:d==he?setToArray:values)(l)}function toFinite(l){return l?(l=toNumber(l))===G||l===-G?(l<0?-1:1)*q:l==l?l:0:0===l?l:0}function toInteger(l){var d=toFinite(l),u=d%1;return d==d?u?d-u:d:0}function toLength(l){return l?baseClamp(toInteger(l),0,K):0}function toNumber(l){if(\"number\"==typeof l)return l;if(isSymbol(l))return z;if(isObject(l)){var d=\"function\"==typeof l.valueOf?l.valueOf():l;l=isObject(d)?d+\"\":d}if(\"string\"!=typeof l)return 0===l?l:+l;l=baseTrim(l);var u=nt.test(l);return u||rt.test(l)?nn(l.slice(2),u?2:8):tt.test(l)?z:+l}function toPlainObject(l){return copyObject(l,keysIn(l))}function toSafeInteger(l){return l?baseClamp(toInteger(l),-W,W):0===l?l:0}function toString(l){return null==l?\"\":baseToString(l)}var $i=createAssigner((function(l,d){if(isPrototype(d)||isArrayLike(d))copyObject(d,keys(d),l);else for(var u in d)_t.call(d,u)&&assignValue(l,u,d[u])})),Xi=createAssigner((function(l,d){copyObject(d,keysIn(d),l)})),Zi=createAssigner((function(l,d,u,p){copyObject(d,keysIn(d),l,p)})),er=createAssigner((function(l,d,u,p){copyObject(d,keys(d),l,p)})),tr=flatRest(baseAt);function create(l,d){var u=Un(l);return null==d?u:baseAssign(u,d)}var nr=baseRest((function(l,d){l=ut(l);var p=-1,h=d.length,g=h>2?d[2]:u;for(g&&isIterateeCall(d[0],d[1],g)&&(h=1);++p<h;)for(var f=d[p],m=keysIn(f),v=-1,y=m.length;++v<y;){var S=m[v],_=l[S];(_===u||eq(_,vt[S])&&!_t.call(l,S))&&(l[S]=f[S])}return l})),ir=baseRest((function(l){return l.push(u,customDefaultsMerge),apply(cr,u,l)}));function findKey(l,d){return baseFindKey(l,getIteratee(d,3),baseForOwn)}function findLastKey(l,d){return baseFindKey(l,getIteratee(d,3),baseForOwnRight)}function forIn(l,d){return null==l?l:Vn(l,getIteratee(d,3),keysIn)}function forInRight(l,d){return null==l?l:Hn(l,getIteratee(d,3),keysIn)}function forOwn(l,d){return l&&baseForOwn(l,getIteratee(d,3))}function forOwnRight(l,d){return l&&baseForOwnRight(l,getIteratee(d,3))}function functions(l){return null==l?[]:baseFunctions(l,keys(l))}function functionsIn(l){return null==l?[]:baseFunctions(l,keysIn(l))}function get(l,d,p){var h=null==l?u:baseGet(l,d);return h===u?p:h}function has(l,d){return null!=l&&hasPath(l,d,baseHas)}function hasIn(l,d){return null!=l&&hasPath(l,d,baseHasIn)}var rr=createInverter((function(l,d,u){null!=d&&\"function\"!=typeof d.toString&&(d=Tt.call(d)),l[d]=u}),constant(identity)),or=createInverter((function(l,d,u){null!=d&&\"function\"!=typeof d.toString&&(d=Tt.call(d)),_t.call(l,d)?l[d].push(u):l[d]=[u]}),getIteratee),ar=baseRest(baseInvoke);function keys(l){return isArrayLike(l)?arrayLikeKeys(l):baseKeys(l)}function keysIn(l){return isArrayLike(l)?arrayLikeKeys(l,!0):baseKeysIn(l)}function mapKeys(l,d){var u={};return d=getIteratee(d,3),baseForOwn(l,(function(l,p,h){baseAssignValue(u,d(l,p,h),l)})),u}function mapValues(l,d){var u={};return d=getIteratee(d,3),baseForOwn(l,(function(l,p,h){baseAssignValue(u,p,d(l,p,h))})),u}var sr=createAssigner((function(l,d,u){baseMerge(l,d,u)})),cr=createAssigner((function(l,d,u,p){baseMerge(l,d,u,p)})),lr=flatRest((function(l,d){var u={};if(null==l)return u;var p=!1;d=arrayMap(d,(function(d){return d=castPath(d,l),p||(p=d.length>1),d})),copyObject(l,getAllKeysIn(l),u),p&&(u=baseClone(u,C|E|T,customOmitClone));for(var h=d.length;h--;)baseUnset(u,d[h]);return u}));function omitBy(l,d){return pickBy(l,negate(getIteratee(d)))}var dr=flatRest((function(l,d){return null==l?{}:basePick(l,d)}));function pickBy(l,d){if(null==l)return{};var u=arrayMap(getAllKeysIn(l),(function(l){return[l]}));return d=getIteratee(d),basePickBy(l,u,(function(l,u){return d(l,u[0])}))}function result(l,d,p){var h=-1,g=(d=castPath(d,l)).length;for(g||(g=1,l=u);++h<g;){var f=null==l?u:l[toKey(d[h])];f===u&&(h=g,f=p),l=isFunction(f)?f.call(l):f}return l}function set(l,d,u){return null==l?l:baseSet(l,d,u)}function setWith(l,d,p,h){return h=\"function\"==typeof h?h:u,null==l?l:baseSet(l,d,p,h)}var ur=createToPairs(keys),pr=createToPairs(keysIn);function transform(l,d,u){var p=Vi(l),h=p||Gi(l)||Ji(l);if(d=getIteratee(d,4),null==u){var g=l&&l.constructor;u=h?p?new g:[]:isObject(l)&&isFunction(g)?Un(wt(l)):{}}return(h?arrayEach:baseForOwn)(l,(function(l,p,h){return d(u,l,p,h)})),u}function unset(l,d){return null==l||baseUnset(l,d)}function update(l,d,u){return null==l?l:baseUpdate(l,d,castFunction(u))}function updateWith(l,d,p,h){return h=\"function\"==typeof h?h:u,null==l?l:baseUpdate(l,d,castFunction(p),h)}function values(l){return null==l?[]:baseValues(l,keys(l))}function valuesIn(l){return null==l?[]:baseValues(l,keysIn(l))}function clamp(l,d,p){return p===u&&(p=d,d=u),p!==u&&(p=(p=toNumber(p))==p?p:0),d!==u&&(d=(d=toNumber(d))==d?d:0),baseClamp(toNumber(l),d,p)}function inRange(l,d,p){return d=toFinite(d),p===u?(p=d,d=0):p=toFinite(p),baseInRange(l=toNumber(l),d,p)}function random(l,d,p){if(p&&\"boolean\"!=typeof p&&isIterateeCall(l,d,p)&&(d=p=u),p===u&&(\"boolean\"==typeof d?(p=d,d=u):\"boolean\"==typeof l&&(p=l,l=u)),l===u&&d===u?(l=0,d=1):(l=toFinite(l),d===u?(d=l,l=0):d=toFinite(d)),l>d){var h=l;l=d,d=h}if(p||l%1||d%1){var g=dn();return on(l+g*(d-l+tn(\"1e-\"+((g+\"\").length-1))),d)}return baseRandom(l,d)}var hr=createCompounder((function(l,d,u){return d=d.toLowerCase(),l+(u?capitalize(d):d)}));function capitalize(l){return _r(toString(l).toLowerCase())}function deburr(l){return(l=toString(l))&&l.replace(at,Sn).replace(Ht,\"\")}function endsWith(l,d,p){l=toString(l),d=baseToString(d);var h=l.length,g=p=p===u?h:baseClamp(toInteger(p),0,h);return(p-=d.length)>=0&&l.slice(p,g)==d}function escape(l){return(l=toString(l))&&xe.test(l)?l.replace(Le,_n):l}function escapeRegExp(l){return(l=toString(l))&&We.test(l)?l.replace(Ge,\"\\\\$&\"):l}var gr=createCompounder((function(l,d,u){return l+(u?\"-\":\"\")+d.toLowerCase()})),fr=createCompounder((function(l,d,u){return l+(u?\" \":\"\")+d.toLowerCase()})),mr=createCaseFirst(\"toLowerCase\");function pad(l,d,u){l=toString(l);var p=(d=toInteger(d))?stringSize(l):0;if(!d||p>=d)return l;var h=(d-p)/2;return createPadding(qt(h),u)+l+createPadding(Wt(h),u)}function padEnd(l,d,u){l=toString(l);var p=(d=toInteger(d))?stringSize(l):0;return d&&p<d?l+createPadding(d-p,u):l}function padStart(l,d,u){l=toString(l);var p=(d=toInteger(d))?stringSize(l):0;return d&&p<d?createPadding(d-p,u)+l:l}function parseInt(l,d,u){return u||null==d?d=0:d&&(d=+d),cn(toString(l).replace(qe,\"\"),d||0)}function repeat(l,d,p){return d=(p?isIterateeCall(l,d,p):d===u)?1:toInteger(d),baseRepeat(toString(l),d)}function replace(){var l=arguments,d=toString(l[0]);return l.length<3?d:d.replace(l[1],l[2])}var vr=createCompounder((function(l,d,u){return l+(u?\"_\":\"\")+d.toLowerCase()}));function split(l,d,p){return p&&\"number\"!=typeof p&&isIterateeCall(l,d,p)&&(d=p=u),(p=p===u?K:p>>>0)?(l=toString(l))&&(\"string\"==typeof d||null!=d&&!zi(d))&&!(d=baseToString(d))&&hasUnicode(l)?castSlice(stringToArray(l),0,p):l.split(d,p):[]}var yr=createCompounder((function(l,d,u){return l+(u?\" \":\"\")+_r(d)}));function startsWith(l,d,u){return l=toString(l),u=null==u?0:baseClamp(toInteger(u),0,l.length),d=baseToString(d),l.slice(u,u+d.length)==d}function template(l,d,p){var h=lodash.templateSettings;p&&isIterateeCall(l,d,p)&&(d=u),l=toString(l),d=Zi({},d,h,customDefaultsAssignIn);var g,f,m=Zi({},d.imports,h.imports,customDefaultsAssignIn),y=keys(m),S=baseValues(m,y),_=0,C=d.interpolate||st,E=\"__p += '\",T=pt((d.escape||st).source+\"|\"+C.source+\"|\"+(C===je?Ze:st).source+\"|\"+(d.evaluate||st).source+\"|$\",\"g\"),b=\"//# sourceURL=\"+(_t.call(d,\"sourceURL\")?(d.sourceURL+\"\").replace(/\\s/g,\" \"):\"lodash.templateSources[\"+ ++Jt+\"]\")+\"\\n\";l.replace(T,(function(d,u,p,h,m,v){return p||(p=h),E+=l.slice(_,v).replace(ct,escapeStringChar),u&&(g=!0,E+=\"' +\\n__e(\"+u+\") +\\n'\"),m&&(f=!0,E+=\"';\\n\"+m+\";\\n__p += '\"),p&&(E+=\"' +\\n((__t = (\"+p+\")) == null ? '' : __t) +\\n'\"),_=v+d.length,d})),E+=\"';\\n\";var I=_t.call(d,\"variable\")&&d.variable;if(I){if($e.test(I))throw new Ye(v)}else E=\"with (obj) {\\n\"+E+\"\\n}\\n\";E=(f?E.replace(Me,\"\"):E).replace(we,\"$1\").replace(Ne,\"$1;\"),E=\"function(\"+(I||\"obj\")+\") {\\n\"+(I?\"\":\"obj || (obj = {});\\n\")+\"var __t, __p = ''\"+(g?\", __e = _.escape\":\"\")+(f?\", __j = Array.prototype.join;\\nfunction print() { __p += __j.call(arguments, '') }\\n\":\";\\n\")+E+\"return __p\\n}\";var A=Cr((function(){return lt(y,b+\"return \"+E).apply(u,S)}));if(A.source=E,isError(A))throw A;return A}function toLower(l){return toString(l).toLowerCase()}function toUpper(l){return toString(l).toUpperCase()}function trim(l,d,p){if((l=toString(l))&&(p||d===u))return baseTrim(l);if(!l||!(d=baseToString(d)))return l;var h=stringToArray(l),g=stringToArray(d);return castSlice(h,charsStartIndex(h,g),charsEndIndex(h,g)+1).join(\"\")}function trimEnd(l,d,p){if((l=toString(l))&&(p||d===u))return l.slice(0,trimmedEndIndex(l)+1);if(!l||!(d=baseToString(d)))return l;var h=stringToArray(l);return castSlice(h,0,charsEndIndex(h,stringToArray(d))+1).join(\"\")}function trimStart(l,d,p){if((l=toString(l))&&(p||d===u))return l.replace(qe,\"\");if(!l||!(d=baseToString(d)))return l;var h=stringToArray(l);return castSlice(h,charsStartIndex(h,stringToArray(d))).join(\"\")}function truncate(l,d){var p=x,h=F;if(isObject(d)){var g=\"separator\"in d?d.separator:g;p=\"length\"in d?toInteger(d.length):p,h=\"omission\"in d?baseToString(d.omission):h}var f=(l=toString(l)).length;if(hasUnicode(l)){var m=stringToArray(l);f=m.length}if(p>=f)return l;var v=p-stringSize(h);if(v<1)return h;var y=m?castSlice(m,0,v).join(\"\"):l.slice(0,v);if(g===u)return y+h;if(m&&(v+=y.length-v),zi(g)){if(l.slice(v).search(g)){var S,_=y;for(g.global||(g=pt(g.source,toString(et.exec(g))+\"g\")),g.lastIndex=0;S=g.exec(_);)var C=S.index;y=y.slice(0,C===u?v:C)}}else if(l.indexOf(baseToString(g),v)!=v){var E=y.lastIndexOf(g);E>-1&&(y=y.slice(0,E))}return y+h}function unescape(l){return(l=toString(l))&&ke.test(l)?l.replace(De,Cn):l}var Sr=createCompounder((function(l,d,u){return l+(u?\" \":\"\")+d.toUpperCase()})),_r=createCaseFirst(\"toUpperCase\");function words(l,d,p){return l=toString(l),(d=p?u:d)===u?hasUnicodeWord(l)?unicodeWords(l):asciiWords(l):l.match(d)||[]}var Cr=baseRest((function(l,d){try{return apply(l,u,d)}catch(l){return isError(l)?l:new Ye(l)}})),Er=flatRest((function(l,d){return arrayEach(d,(function(d){d=toKey(d),baseAssignValue(l,d,Mi(l[d],l))})),l}));function cond(l){var d=null==l?0:l.length,u=getIteratee();return l=d?arrayMap(l,(function(l){if(\"function\"!=typeof l[1])throw new gt(m);return[u(l[0]),l[1]]})):[],baseRest((function(u){for(var p=-1;++p<d;){var h=l[p];if(apply(h[0],this,u))return apply(h[1],this,u)}}))}function conforms(l){return baseConforms(baseClone(l,C))}function constant(l){return function(){return l}}function defaultTo(l,d){return null==l||l!=l?d:l}var Tr=createFlow(),br=createFlow(!0);function identity(l){return l}function iteratee(l){return baseIteratee(\"function\"==typeof l?l:baseClone(l,C))}function matches(l){return baseMatches(baseClone(l,C))}function matchesProperty(l,d){return baseMatchesProperty(l,baseClone(d,C))}var Ir=baseRest((function(l,d){return function(u){return baseInvoke(u,l,d)}})),Ar=baseRest((function(l,d){return function(u){return baseInvoke(l,u,d)}}));function mixin(l,d,u){var p=keys(d),h=baseFunctions(d,p);null!=u||isObject(d)&&(h.length||!p.length)||(u=d,d=l,l=this,h=baseFunctions(d,keys(d)));var g=!(isObject(u)&&\"chain\"in u&&!u.chain),f=isFunction(l);return arrayEach(h,(function(u){var p=d[u];l[u]=p,f&&(l.prototype[u]=function(){var d=this.__chain__;if(g||d){var u=l(this.__wrapped__);return(u.__actions__=copyArray(this.__actions__)).push({func:p,args:arguments,thisArg:l}),u.__chain__=d,u}return p.apply(l,arrayPush([this.value()],arguments))})})),l}function noConflict(){return an._===this&&(an._=It),this}function noop(){}function nthArg(l){return l=toInteger(l),baseRest((function(d){return baseNth(d,l)}))}var Rr=createOver(arrayMap),Pr=createOver(arrayEvery),Or=createOver(arraySome);function property(l){return isKey(l)?baseProperty(toKey(l)):basePropertyDeep(l)}function propertyOf(l){return function(d){return null==l?u:baseGet(l,d)}}var Mr=createRange(),wr=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}function stubObject(){return{}}function stubString(){return\"\"}function stubTrue(){return!0}function times(l,d){if((l=toInteger(l))<1||l>W)return[];var u=K,p=on(l,K);d=getIteratee(d),l-=K;for(var h=baseTimes(p,d);++u<l;)d(u);return h}function toPath(l){return Vi(l)?arrayMap(l,toKey):isSymbol(l)?[l]:copyArray(ni(toString(l)))}function uniqueId(l){var d=++Ct;return toString(l)+d}var Nr=createMathOperation((function(l,d){return l+d}),0),Dr=createRound(\"ceil\"),Lr=createMathOperation((function(l,d){return l/d}),1),kr=createRound(\"floor\");function max(l){return l&&l.length?baseExtremum(l,identity,baseGt):u}function maxBy(l,d){return l&&l.length?baseExtremum(l,getIteratee(d,2),baseGt):u}function mean(l){return baseMean(l,identity)}function meanBy(l,d){return baseMean(l,getIteratee(d,2))}function min(l){return l&&l.length?baseExtremum(l,identity,baseLt):u}function minBy(l,d){return l&&l.length?baseExtremum(l,getIteratee(d,2),baseLt):u}var xr,Fr=createMathOperation((function(l,d){return l*d}),1),Ur=createRound(\"round\"),jr=createMathOperation((function(l,d){return l-d}),0);function sum(l){return l&&l.length?baseSum(l,identity):0}function sumBy(l,d){return l&&l.length?baseSum(l,getIteratee(d,2)):0}return lodash.after=after,lodash.ary=ary,lodash.assign=$i,lodash.assignIn=Xi,lodash.assignInWith=Zi,lodash.assignWith=er,lodash.at=tr,lodash.before=before,lodash.bind=Mi,lodash.bindAll=Er,lodash.bindKey=wi,lodash.castArray=castArray,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.concat=concat,lodash.cond=cond,lodash.conforms=conforms,lodash.constant=constant,lodash.countBy=Ci,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=nr,lodash.defaultsDeep=ir,lodash.defer=Ni,lodash.delay=Di,lodash.difference=ii,lodash.differenceBy=ri,lodash.differenceWith=oi,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatMap=flatMap,lodash.flatMapDeep=flatMapDeep,lodash.flatMapDepth=flatMapDepth,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flattenDepth=flattenDepth,lodash.flip=flip,lodash.flow=Tr,lodash.flowRight=br,lodash.fromPairs=fromPairs,lodash.functions=functions,lodash.functionsIn=functionsIn,lodash.groupBy=bi,lodash.initial=initial,lodash.intersection=ai,lodash.intersectionBy=si,lodash.intersectionWith=ci,lodash.invert=rr,lodash.invertBy=or,lodash.invokeMap=Ii,lodash.iteratee=iteratee,lodash.keyBy=Ai,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=sr,lodash.mergeWith=cr,lodash.method=Ir,lodash.methodOf=Ar,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=nthArg,lodash.omit=lr,lodash.omitBy=omitBy,lodash.once=once,lodash.orderBy=orderBy,lodash.over=Rr,lodash.overArgs=Li,lodash.overEvery=Pr,lodash.overSome=Or,lodash.partial=ki,lodash.partialRight=xi,lodash.partition=Ri,lodash.pick=dr,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=li,lodash.pullAll=pullAll,lodash.pullAllBy=pullAllBy,lodash.pullAllWith=pullAllWith,lodash.pullAt=di,lodash.range=Mr,lodash.rangeRight=wr,lodash.rearg=Fi,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.reverse=reverse,lodash.sampleSize=sampleSize,lodash.set=set,lodash.setWith=setWith,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=Pi,lodash.sortedUniq=sortedUniq,lodash.sortedUniqBy=sortedUniqBy,lodash.split=split,lodash.spread=spread,lodash.tail=tail,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=ur,lodash.toPairsIn=pr,lodash.toPath=toPath,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.unary=unary,lodash.union=ui,lodash.unionBy=pi,lodash.unionWith=hi,lodash.uniq=uniq,lodash.uniqBy=uniqBy,lodash.uniqWith=uniqWith,lodash.unset=unset,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=update,lodash.updateWith=updateWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.without=gi,lodash.words=words,lodash.wrap=wrap,lodash.xor=fi,lodash.xorBy=mi,lodash.xorWith=vi,lodash.zip=yi,lodash.zipObject=zipObject,lodash.zipObjectDeep=zipObjectDeep,lodash.zipWith=Si,lodash.entries=ur,lodash.entriesIn=pr,lodash.extend=Xi,lodash.extendWith=Zi,mixin(lodash,lodash),lodash.add=Nr,lodash.attempt=Cr,lodash.camelCase=hr,lodash.capitalize=capitalize,lodash.ceil=Dr,lodash.clamp=clamp,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.cloneDeepWith=cloneDeepWith,lodash.cloneWith=cloneWith,lodash.conformsTo=conformsTo,lodash.deburr=deburr,lodash.defaultTo=defaultTo,lodash.divide=Lr,lodash.endsWith=endsWith,lodash.eq=eq,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=Ei,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=Ti,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.floor=kr,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.get=get,lodash.gt=Ui,lodash.gte=ji,lodash.has=has,lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.invoke=ar,lodash.isArguments=Bi,lodash.isArray=Vi,lodash.isArrayBuffer=Hi,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=isBoolean,lodash.isBuffer=Gi,lodash.isDate=Wi,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isEqualWith=isEqualWith,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=qi,lodash.isMatch=isMatch,lodash.isMatchWith=isMatchWith,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNil=isNil,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=zi,lodash.isSafeInteger=isSafeInteger,lodash.isSet=Ki,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=Ji,lodash.isUndefined=isUndefined,lodash.isWeakMap=isWeakMap,lodash.isWeakSet=isWeakSet,lodash.join=join,lodash.kebabCase=gr,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lowerCase=fr,lodash.lowerFirst=mr,lodash.lt=Qi,lodash.lte=Yi,lodash.max=max,lodash.maxBy=maxBy,lodash.mean=mean,lodash.meanBy=meanBy,lodash.min=min,lodash.minBy=minBy,lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=stubObject,lodash.stubString=stubString,lodash.stubTrue=stubTrue,lodash.multiply=Fr,lodash.nth=nth,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=Oi,lodash.pad=pad,lodash.padEnd=padEnd,lodash.padStart=padStart,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.replace=replace,lodash.result=result,lodash.round=Ur,lodash.runInContext=runInContext,lodash.sample=sample,lodash.size=size,lodash.snakeCase=vr,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedIndexBy=sortedIndexBy,lodash.sortedIndexOf=sortedIndexOf,lodash.sortedLastIndex=sortedLastIndex,lodash.sortedLastIndexBy=sortedLastIndexBy,lodash.sortedLastIndexOf=sortedLastIndexOf,lodash.startCase=yr,lodash.startsWith=startsWith,lodash.subtract=jr,lodash.sum=sum,lodash.sumBy=sumBy,lodash.template=template,lodash.times=times,lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=toLower,lodash.toNumber=toNumber,lodash.toSafeInteger=toSafeInteger,lodash.toString=toString,lodash.toUpper=toUpper,lodash.trim=trim,lodash.trimEnd=trimEnd,lodash.trimStart=trimStart,lodash.truncate=truncate,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.upperCase=Sr,lodash.upperFirst=_r,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(xr={},baseForOwn(lodash,(function(l,d){_t.call(lodash.prototype,d)||(xr[d]=l)})),xr),{chain:!1}),lodash.VERSION=p,arrayEach([\"bind\",\"bindKey\",\"curry\",\"curryRight\",\"partial\",\"partialRight\"],(function(l){lodash[l].placeholder=lodash})),arrayEach([\"drop\",\"take\"],(function(l,d){LazyWrapper.prototype[l]=function(p){p=p===u?1:rn(toInteger(p),0);var h=this.__filtered__&&!d?new LazyWrapper(this):this.clone();return h.__filtered__?h.__takeCount__=on(p,h.__takeCount__):h.__views__.push({size:on(p,K),type:l+(h.__dir__<0?\"Right\":\"\")}),h},LazyWrapper.prototype[l+\"Right\"]=function(d){return this.reverse()[l](d).reverse()}})),arrayEach([\"filter\",\"map\",\"takeWhile\"],(function(l,d){var u=d+1,p=u==B||u==H;LazyWrapper.prototype[l]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:getIteratee(l,3),type:u}),d.__filtered__=d.__filtered__||p,d}})),arrayEach([\"head\",\"last\"],(function(l,d){var u=\"take\"+(d?\"Right\":\"\");LazyWrapper.prototype[l]=function(){return this[u](1).value()[0]}})),arrayEach([\"initial\",\"tail\"],(function(l,d){var u=\"drop\"+(d?\"\":\"Right\");LazyWrapper.prototype[l]=function(){return this.__filtered__?new LazyWrapper(this):this[u](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(l){return this.filter(l).head()},LazyWrapper.prototype.findLast=function(l){return this.reverse().find(l)},LazyWrapper.prototype.invokeMap=baseRest((function(l,d){return\"function\"==typeof l?new LazyWrapper(this):this.map((function(u){return baseInvoke(u,l,d)}))})),LazyWrapper.prototype.reject=function(l){return this.filter(negate(getIteratee(l)))},LazyWrapper.prototype.slice=function(l,d){l=toInteger(l);var p=this;return p.__filtered__&&(l>0||d<0)?new LazyWrapper(p):(l<0?p=p.takeRight(-l):l&&(p=p.drop(l)),d!==u&&(p=(d=toInteger(d))<0?p.dropRight(-d):p.take(d-l)),p)},LazyWrapper.prototype.takeRightWhile=function(l){return this.reverse().takeWhile(l).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(K)},baseForOwn(LazyWrapper.prototype,(function(l,d){var p=/^(?:filter|find|map|reject)|While$/.test(d),h=/^(?:head|last)$/.test(d),g=lodash[h?\"take\"+(\"last\"==d?\"Right\":\"\"):d],f=h||/^find/.test(d);g&&(lodash.prototype[d]=function(){var d=this.__wrapped__,m=h?[1]:arguments,v=d instanceof LazyWrapper,y=m[0],S=v||Vi(d),interceptor=function(l){var d=g.apply(lodash,arrayPush([l],m));return h&&_?d[0]:d};S&&p&&\"function\"==typeof y&&1!=y.length&&(v=S=!1);var _=this.__chain__,C=!!this.__actions__.length,E=f&&!_,T=v&&!C;if(!f&&S){d=T?d:new LazyWrapper(this);var b=l.apply(d,m);return b.__actions__.push({func:thru,args:[interceptor],thisArg:u}),new LodashWrapper(b,_)}return E&&T?l.apply(this,m):(b=this.thru(interceptor),E?h?b.value()[0]:b.value():b)})})),arrayEach([\"pop\",\"push\",\"shift\",\"sort\",\"splice\",\"unshift\"],(function(l){var d=ft[l],u=/^(?:push|sort|unshift)$/.test(l)?\"tap\":\"thru\",p=/^(?:pop|shift)$/.test(l);lodash.prototype[l]=function(){var l=arguments;if(p&&!this.__chain__){var h=this.value();return d.apply(Vi(h)?h:[],l)}return this[u]((function(u){return d.apply(Vi(u)?u:[],l)}))}})),baseForOwn(LazyWrapper.prototype,(function(l,d){var u=lodash[d];if(u){var p=u.name+\"\";_t.call(On,p)||(On[p]=[]),On[p].push({name:d,func:u})}})),On[createHybrid(u,R).name]=[{name:\"wrapper\",func:u}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.at=_i,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.next=wrapperNext,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.first=lodash.prototype.head,xt&&(lodash.prototype[xt]=wrapperToIterator),lodash}();cn?((cn.exports=En)._=En,sn._=En):an._=En}).call(h)})),S=createCommonjsModule((function(l,d){function vsprintf(l,d){var u=0;return l.replace(/%[dixs%]/g,(function(l){var p=0;if(\"%\"!==l[p++])return\"\";var h=l[p++];return\"%\"===h?\"%\":\"s\"===h||\"d\"===h||\"i\"===h?d[u++]:\"x\"===h?d[u++].toString(16):l}))}function sprintf(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];return vsprintf(l,d)}\r\n/*!\r\n\t *  AufLog.ts\r\n\t *  AUF\r\n\t *\r\n\t *  Created by Johan Blumenberg on 2016-12-29\r\n\t *  Copyright 2016 Microsoft. All rights reserved.\r\n\t *\r\n\t */\r\nObject.defineProperty(d,\"__esModule\",{value:!0}),function(l){l[l.Trace=10]=\"Trace\",l[l.Debug6=16]=\"Debug6\",l[l.Debug5=18]=\"Debug5\",l[l.Debug4=20]=\"Debug4\",l[l.Debug3=30]=\"Debug3\",l[l.Debug2=40]=\"Debug2\",l[l.Debug1=50]=\"Debug1\",l[l.Warning=60]=\"Warning\",l[l.Error=70]=\"Error\",l[l.Fatal=80]=\"Fatal\",l[l.MetaData=90]=\"MetaData\"}(d.LogLevel||(d.LogLevel={})),function(l){l[l.UseDefault=0]=\"UseDefault\",l[l.Compress=1]=\"Compress\",l[l.Disabled=2]=\"Disabled\"}(d.LogFileCompression||(d.LogFileCompression={})),function(l){l[l.Raw=0]=\"Raw\",l[l.Base64=1]=\"Base64\"}(d.LogFileEncoding||(d.LogFileEncoding={})),function(l){l[l.Unencrypted=0]=\"Unencrypted\",l[l.Encrypted=1]=\"Encrypted\"}(d.LogFileEncryption||(d.LogFileEncryption={})),function(l){l[l.PEM=0]=\"PEM\",l[l.DER=1]=\"DER\",l[l.BER=2]=\"BER\"}(d.CertStoreFormat||(d.CertStoreFormat={})),function(l){l[l.InsertFront=8]=\"InsertFront\"}(d.AppenderFlags||(d.AppenderFlags={})),d.vsprintf=vsprintf,d.sprintf=sprintf})),_=createCommonjsModule((function(l,d){\r\n/*!\r\n\t *  LogFactory.ts\r\n\t *  AUF\r\n\t *\r\n\t *  Created by Johan Blumenberg on 2016-12-29\r\n\t *  Copyright 2016 Microsoft. All rights reserved.\r\n\t *\r\n\t */\r\nvar u,p=h&&h.__extends||function(){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])};return function(d,u){function __(){this.constructor=d}l(d,u),d.prototype=null===u?Object.create(u):(__.prototype=u.prototype,new __)}}();function hash(l){if(null===l)return-1;for(var d=0,u=l.length-1;u>=0;u--)d=37*d+l.charCodeAt(u)|0;var p=\"__auf_literal:\";for(u=p.length-1;u>=0;u--)d=37*d+p.charCodeAt(u)|0;return d}Object.defineProperty(d,\"__esModule\",{value:!0}),function(l){l[l.Unsafe=0]=\"Unsafe\",l[l.Safe=1]=\"Safe\",l[l.Inherited_Unsafe=2]=\"Inherited_Unsafe\",l[l.Inherited_Safe=3]=\"Inherited_Safe\",l[l.Blacklisted_Unsafe=4]=\"Blacklisted_Unsafe\"}(u||(u={}));var g,f=function(){function LogComponentImpl(l,d){this._level=S.LogLevel.Debug4,this._threshold=255,this._safe=u.Inherited_Unsafe,this._name=l,d&&(this._level=d.level(),this._safe=d.safe()?u.Inherited_Safe:u.Inherited_Unsafe,this._extendedInfo=d.extendedInfo())}return LogComponentImpl.prototype.name=function(){return this._name},LogComponentImpl.prototype.safe=function(){return this._safe===u.Safe||this._safe===u.Inherited_Safe},LogComponentImpl.prototype.safety=function(){return this._safe},LogComponentImpl.prototype.setSafety=function(l){this._safe=l},LogComponentImpl.prototype.description=function(){return this._desc},LogComponentImpl.prototype.setDescription=function(l){this._desc=l},LogComponentImpl.prototype.level=function(){return this._level},LogComponentImpl.prototype.setLevel=function(l){g.setLevel(this,l)},LogComponentImpl.prototype._setLevel=function(l){this._level=l},LogComponentImpl.prototype._setThreshold=function(l){this._threshold=l},LogComponentImpl.prototype.isEnabled=function(l){return this._threshold<=l},LogComponentImpl.prototype.setExtendedInfo=function(l){this._extendedInfo=l},LogComponentImpl.prototype.extendedInfo=function(){return this._extendedInfo},LogComponentImpl.prototype.trace=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Trace,hash(l),l].concat(d))},LogComponentImpl.prototype.debug6=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Debug6,hash(l),l].concat(d))},LogComponentImpl.prototype.debug5=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Debug5,hash(l),l].concat(d))},LogComponentImpl.prototype.debug4=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Debug4,hash(l),l].concat(d))},LogComponentImpl.prototype.debug3=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Debug3,hash(l),l].concat(d))},LogComponentImpl.prototype.debug2=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Debug2,hash(l),l].concat(d))},LogComponentImpl.prototype.debug1=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Debug1,hash(l),l].concat(d))},LogComponentImpl.prototype.warn=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Warning,hash(l),l].concat(d))},LogComponentImpl.prototype.error=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Error,hash(l),l].concat(d))},LogComponentImpl.prototype.fatal=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.Fatal,hash(l),l].concat(d))},LogComponentImpl.prototype.meta=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];g.log.apply(g,[this,S.LogLevel.MetaData,hash(l),l].concat(d))},LogComponentImpl}(),m=function(){function LogFactory(){}return LogFactory.instance=function(){return g},LogFactory.levelToString=function(l){return l<=S.LogLevel.Trace?\"TRACE\":l<=S.LogLevel.Debug6?\"DEBUG6\":l<=S.LogLevel.Debug5?\"DEBUG5\":l<=S.LogLevel.Debug4?\"DEBUG4\":l<=S.LogLevel.Debug3?\"DEBUG3\":l<=S.LogLevel.Debug2?\"DEBUG2\":l<=S.LogLevel.Debug1?\"DEBUG1\":l<=S.LogLevel.Warning?\"WARN\":l<=S.LogLevel.Error?\"ERROR\":l<=S.LogLevel.Fatal?\"FATAL\":(S.LogLevel.MetaData,\"META\")},LogFactory.levelFromString=function(l){return this._levelFromString[l]||parseInt(l,10)},LogFactory}();function findLevel(l,d){for(var u=d.name();u.length>0;){if(l[u])return l[u];var p=u.lastIndexOf(\".\");u=p<0?\"\":u.substr(0,p)}return l[\"\"]?l[\"\"]:S.LogLevel.Debug4}function findThreshold(l,d){var u=255;return d.forEach((function(d){var p=255;d.appender.levels()?p=Math.min(p,findLevel(d.appender.levels(),l)):d.appender.receiveAll()||(p=Math.min(p,l.level())),u=Math.min(u,p)})),u}function appenderMatches(l,d,u){return!!l.appender.receiveAll()||(l.appender.levels()?u>=findLevel(l.appender.levels(),d):u>=d.level())}m._levelFromString={TRACE:S.LogLevel.Trace,DEBUG6:S.LogLevel.Debug6,DEBUG5:S.LogLevel.Debug5,DEBUG4:S.LogLevel.Debug4,DEBUG3:S.LogLevel.Debug3,DEBUG2:S.LogLevel.Debug2,DEBUG1:S.LogLevel.Debug1,WARN:S.LogLevel.Warning,ERROR:S.LogLevel.Error,FATAL:S.LogLevel.Fatal,META:S.LogLevel.MetaData},d.LogFactory=m;var v=function(l){function LogFactoryImpl(){var d=l.call(this)||this;return d._nextId=0,d._appenders=[],d._components={},d._componentBlacklist=[],d._components[\"\"]=new f(\"\",null),d}return p(LogFactoryImpl,l),LogFactoryImpl.prototype.toHex=function(l){return(4294967296+l).toString(16).substr(-8)},LogFactoryImpl.prototype.addAppender=function(l,d){void 0===d&&(d=0);var u=this._nextId++;return d&S.AppenderFlags.InsertFront?this._appenders.unshift({appender:l,handle:u}):this._appenders.push({appender:l,handle:u}),this.recalcComponentThresholds(),u},LogFactoryImpl.prototype.removeAppender=function(l){for(var d=0;d<this._appenders.length;d++)if(this._appenders[d].handle===l){this._appenders.splice(d,1);break}this.recalcComponentThresholds()},LogFactoryImpl.prototype.log=function(l,d,u,p){for(var h=[],g=4;g<arguments.length;g++)h[g-4]=arguments[g];try{if(l.isEnabled(d)){var f={timestamp:(new Date).getTime(),component:l,level:d};this._appenders.forEach((function(g){appenderMatches(g,l,d)&&g.appender.log(f,u,p,h)}))}}catch(l){}},LogFactoryImpl.prototype.parent=function(l){for(;;){var d=l.lastIndexOf(\".\");if(l=d>=0?l.substr(0,d):\"\",this._components[l])return this._components[l]}},LogFactoryImpl.prototype.children=function(l){var d=[];for(var u in this._components)this.parent(u).name()===l&&d.push(this._components[u]);return d},LogFactoryImpl.prototype.component=function(l){if(this._components[l])return this._components[l];var d=new f(l,this.parent(l));this._components[l]=d;var u=findThreshold(d,this._appenders);return d._setThreshold(u),d},LogFactoryImpl.prototype.rootComponent=function(){return this.component(\"\")},LogFactoryImpl.prototype.setSafetyRecursive=function(l,d){var p=this;this.children(l).forEach((function(l){l.safety()!==u.Inherited_Safe&&l.safety()!==u.Inherited_Unsafe||(l.setSafety(d),p.setSafetyRecursive(l.name(),d))}))},LogFactoryImpl.prototype.declareComponentSafe=function(l,d){var p=this.component(l);-1!==this._componentBlacklist.indexOf(p.name())?p.setSafety(u.Blacklisted_Unsafe):p.setSafety(d?u.Safe:u.Unsafe),this.setSafetyRecursive(l,d?u.Inherited_Safe:u.Inherited_Unsafe)},LogFactoryImpl.prototype.declareComponentDescription=function(l,d){this.component(l).setDescription(d)},LogFactoryImpl.prototype.setExtendedInfoRecursive=function(l,d){var u=this;this.children(l).forEach((function(l){void 0===l.extendedInfo()&&(l.setExtendedInfo(d),u.setExtendedInfoRecursive(l.name(),d))}))},LogFactoryImpl.prototype.declareComponentExtendedInfo=function(l,d){var u=this.component(l);u.setExtendedInfo(d),this.setExtendedInfoRecursive(u.name(),d)},LogFactoryImpl.prototype.recalcComponentThresholds=function(){for(var l in this._components){var d=this._components[l],u=findThreshold(d,this._appenders);d._setThreshold(u)}},LogFactoryImpl.prototype.setLevel=function(l,d){if(\"\"===l.name())for(var u in this._components){(g=this._components[u])._setLevel(d);var p=findThreshold(g,this._appenders);g._setThreshold(p)}else{var h=l.name()+\".\";l._setLevel(d);p=findThreshold(l,this._appenders);for(var u in l._setThreshold(p),this._components){var g;if((g=this._components[u]).name().substr(0,h.length)===h){g._setLevel(d);var f=findThreshold(g,this._appenders);g._setThreshold(f)}}}},LogFactoryImpl.prototype.setComponentBlacklist=function(l){for(var d in this._componentBlacklist=l,this._components){var p=this._components[d];-1!==this._componentBlacklist.indexOf(p.name())&&p.setSafety(u.Blacklisted_Unsafe)}},LogFactoryImpl}(m);g=new v})),C=createCommonjsModule((function(l,d){function fromThenable(l){var d=Defer();return l.then((function(l){d.resolve(l)}),(function(l){d.reject(l)})),d.promise().thenAsync((function(l){return l}))}function isThenable(l){return null!=l&&\"function\"==typeof l.then}function isCancelable(l){return null!=l&&\"function\"==typeof l.cancel}function run(l,u){if(!d.config.catchExceptions)return l();try{return l()}catch(l){return u(l)}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(l){throw l}},d.fromThenable=fromThenable;var u,p=[],h=\"undefined\"!=typeof setImmediate;function asyncCallback(l){p.push(l),1===p.length&&(h?setImmediate(resolveAsyncCallbacks):setTimeout(resolveAsyncCallbacks,0))}function resolveAsyncCallbacks(){var l=p;p=[];for(var d=0;d<l.length;d++)l[d]()}function all(l){if(0===l.length)return Resolved([]);var d,p=Defer(),h=l.length,g=Array(l.length);p.onCancel((function(d){l.forEach((function(l){isCancelable(l)&&u.SyncTask.cancelOtherInternal(l,d)}))}));var checkFinish=function(){0==--h&&(void 0!==d?p.reject(d):p.resolve(g))};return l.forEach((function(l,u){isThenable(l)?l.then((function(l){g[u]=l,checkFinish()}),(function(l){void 0===d&&(d=void 0===l||l),checkFinish()})):(g[u]=l,checkFinish())})),p.promise()}function Defer(){return new u.SyncTask}function Resolved(l){return(new u.SyncTask).resolve(l).promise()}function Rejected(l){return(new u.SyncTask).reject(l).promise()}function race(l){var d=Defer(),p=!1;return d.onCancel((function(d){l.forEach((function(l){isCancelable(l)&&u.SyncTask.cancelOtherInternal(l,d)}))})),l.forEach((function(l){isThenable(l)?l.then((function(l){p||(p=!0,d.resolve(l))}),(function(l){p||(p=!0,d.reject(l))})):p||(p=!0,d.resolve(l))})),d.promise()}function raceTimer(l,d){var u=Defer(),p=setTimeout((function(){u.resolve({timedOut:!0})}),d);return race([l.then((function(l){return clearTimeout(p),{timedOut:!1,result:l}})),u.promise()])}d.asyncCallback=asyncCallback,function(l){var u=function(){function SyncTask(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return SyncTask.prototype._addCallbackSet=function(l,d){var u=this,p=new SyncTask;return p.onCancel((function(d){l.wasCanceled=!0,l.cancelContext=d,u._cancelInternal(d)})),l.task=p,this._storedCallbackSets.push(l),d?this._mustHandleError=!1:p._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),p.promise()},SyncTask.prototype.onCancel=function(l){return this._completedSuccess||this._completedFail||(this._wasCanceled?l(this._cancelContext):this._cancelCallbacks.push(l)),this},SyncTask.prototype.then=function(l,d){return this._addCallbackSet({successFunc:l,failFunc:d},!0)},SyncTask.prototype.thenAsync=function(l,d){return this._addCallbackSet({successFunc:l,failFunc:d,asyncCallback:!0},!0)},SyncTask.prototype.catch=function(l){return this._addCallbackSet({failFunc:l},!0)},SyncTask.prototype.always=function(l){return this._addCallbackSet({successFunc:l,failFunc:l},!0)},SyncTask.prototype.setTracingEnabled=function(l){return this._traceEnabled=l,this},SyncTask.prototype.finally=function(l){return this._addCallbackSet({successFunc:l,failFunc:l},!1),this},SyncTask.prototype.done=function(l){return this._addCallbackSet({successFunc:l},!1),this},SyncTask.prototype.fail=function(l){return this._addCallbackSet({failFunc:l},!1),this},SyncTask.prototype.resolve=function(l){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=l,this._cancelCallbacks=[],this._resolveSuccesses(),this},SyncTask.prototype.reject=function(l){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=l,this._cancelCallbacks=[],this._resolveFailures(),SyncTask._enforceErrorHandled(this),this},SyncTask.prototype._checkState=function(l){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var u=\"Failed to \"+(l?\"resolve\":\"reject\")+\": the task is already \"+(this._completedSuccess?\"resolved\":\"rejected\");throw new Error(u)}(d.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error(\"resolve\"))},SyncTask._enforceErrorHandled=function(l){l._mustHandleError&&(SyncTask._rejectedTasks.push(l),SyncTask._enforceErrorHandledTimer||(SyncTask._enforceErrorHandledTimer=setTimeout((function(){SyncTask._enforceErrorHandledTimer=void 0;var l=SyncTask._rejectedTasks;SyncTask._rejectedTasks=[],l.forEach((function(l,u){l._mustHandleError&&d.config.unhandledErrorHandler(l._storedErrResolution)}))}),0)))},SyncTask.prototype.cancel=function(l){if(this._wasExplicitlyCanceled)throw new Error(\"Already Canceled\");this._wasExplicitlyCanceled=!0,this._cancelInternal(l)},SyncTask.prototype._cancelInternal=function(l){var d=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=l;var u=this._cancelCallbacks;this._cancelCallbacks=[],u.length>0&&u.forEach((function(l){d._completedSuccess||d._completedFail||l(d._cancelContext)}))}},SyncTask.cancelOtherInternal=function(l,d){var u=l;u._storedCallbackSets&&u._cancelInternal?u._cancelInternal(d):l.cancel(d)},SyncTask.prototype.promise=function(){return this},SyncTask.prototype._resolveSuccesses=function(){var l=this;for(this._resolving=!0;this._storedCallbackSets.length;){var d=this._storedCallbackSets;this._storedCallbackSets=[],d.forEach((function(d){d.asyncCallback?asyncCallback((function(){return l._resolveSuccessCallback(d)})):l._resolveSuccessCallback(d)}))}this._resolving=!1},SyncTask.prototype._resolveSuccessCallback=function(l){var d=this;l.successFunc?run((function(){var u=l.successFunc(d._storedResolution);isCancelable(u)&&(l.wasCanceled?SyncTask.cancelOtherInternal(u,l.cancelContext):l.task.onCancel((function(l){return SyncTask.cancelOtherInternal(u,l)}))),isThenable(u)?u.then((function(d){l.task.resolve(d)}),(function(d){l.task.reject(d)})):l.task.resolve(u)}),(function(u){d._handleException(u,\"SyncTask caught exception in success block: \"+u.toString()),l.task.reject(u)})):l.task.resolve(this._storedResolution)},SyncTask.prototype._resolveFailures=function(){var l=this;for(this._resolving=!0;this._storedCallbackSets.length;){var d=this._storedCallbackSets;this._storedCallbackSets=[],d.forEach((function(d){d.asyncCallback?asyncCallback((function(){return l._resolveFailureCallback(d)})):l._resolveFailureCallback(d)}))}this._resolving=!1},SyncTask.prototype._resolveFailureCallback=function(l){var d=this;l.failFunc?run((function(){var u=l.failFunc(d._storedErrResolution);isCancelable(u)&&(l.wasCanceled?SyncTask.cancelOtherInternal(u,l.cancelContext):l.task.onCancel((function(l){return SyncTask.cancelOtherInternal(u,l)}))),isThenable(u)?u.then((function(d){l.task.resolve(d)}),(function(d){l.task.reject(d)})):l.task.resolve(u)}),(function(u){d._handleException(u,\"SyncTask caught exception in failure block: \"+u.toString()),l.task.reject(u)})):l.task.reject(this._storedErrResolution)},SyncTask.prototype._handleException=function(l,u){d.config.exceptionsToConsole&&console.error(u),d.config.exceptionHandler&&d.config.exceptionHandler(l)},SyncTask.prototype.toEs6Promise=function(){var l=this;return new Promise((function(d,u){return l.then(d,u)}))},SyncTask._rejectedTasks=[],SyncTask}();l.SyncTask=u}(u||(u={})),d.all=all,d.Defer=Defer,d.Resolved=Resolved,d.Rejected=Rejected,d.race=race,d.raceTimer=raceTimer})),E=createCommonjsModule((function(l,d){\r\n/*!\r\n\t *  Appenders.ts\r\n\t *  AUF\r\n\t *\r\n\t *  Created by Johan Blumenberg on 2016-12-29\r\n\t *  Copyright 2016 Microsoft. All rights reserved.\r\n\t *\r\n\t */\r\nvar u=h&&h.__extends||function(){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])};return function(d,u){function __(){this.constructor=d}l(d,u),d.prototype=null===u?Object.create(u):(__.prototype=u.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var p,g=function(){function AbstractLogAppender(l){this._formatter=l||new f}return AbstractLogAppender.prototype.formatter=function(){return this._formatter},AbstractLogAppender.prototype.receiveAll=function(){return!1},AbstractLogAppender.prototype.levels=function(){return null},AbstractLogAppender}();function toHex(l){return(4294967296+l).toString(16).substr(-8)}function pad(l,d){return(1e12+l).toString(10).substr(-d)}d.AbstractLogAppender=g,function(l){l[l.Timestamp=1]=\"Timestamp\",l[l.Component=4]=\"Component\",l[l.Level=8]=\"Level\",l[l.FullDate=32]=\"FullDate\",l[l.LogId=64]=\"LogId\"}(p=d.SLF_Flags||(d.SLF_Flags={}));var f=function(){function StandardLogFormatter(l){void 0===l&&(l=4294967295),this._flags=l}return StandardLogFormatter.prototype.format=function(l,d,u,h){var g=\"\";if(this._flags&p.FullDate)g+=new Date(l.timestamp).toISOString()+\" \";else if(this._flags&p.Timestamp){var f=new Date(l.timestamp);g+=pad(f.getHours(),2)+\":\"+pad(f.getMinutes(),2)+\":\"+pad(f.getSeconds(),2)+\".\"+pad(f.getMilliseconds(),2)+\" \"}return this._flags&p.LogId&&(g+=\"[#\"+toHex(d)+\"-\"+(l.component.safe()?\"S\":\"u\")+\"] \"),this._flags&p.Level&&(g+=\"[\"+_.LogFactory.levelToString(l.level)+\"] \"),this._flags&p.Component&&(g+=\"[\"+l.component.name()+\"] \"),u||\"\"===u?g+S.vsprintf(u,h):g+toHex(d)+\": \"+h.join(\" \")},StandardLogFormatter}();d.StandardLogFormatter=f;var m=console,v=console.log||function(){},y=console.info||v,C=console.warn||y,E=console.error||C,T=function(l){function ConsoleAppender(){return null!==l&&l.apply(this,arguments)||this}return u(ConsoleAppender,l),ConsoleAppender.prototype.log=function(l,d,u,p){p=p.slice(0);var h=l.level<=S.LogLevel.Debug3?v:l.level<=S.LogLevel.Debug1?y:l.level<=S.LogLevel.Warning?C:E;if(-1===d){var g=this.formatter().format(l,d,\"\",[]);\"string\"==typeof p[0]&&(g+=p.shift()),h.apply(m,[g].concat(p))}else{for(var f=void 0,_=[];f=u.match(/\\s*%@\\s*$/);)u=u.substr(0,u.length-f[0].length),_.unshift(p.pop());g=this.formatter().format(l,d,u,p);h.apply(m,[g].concat(_))}},ConsoleAppender}(g);d.ConsoleAppender=T;var b=function(){function ChainedLogAppender(l){this._chained=l}return ChainedLogAppender.prototype.log=function(l,d,u,p){this._chained.log(l,d,u,p)},ChainedLogAppender.prototype.receiveAll=function(){return this._chained.receiveAll()},ChainedLogAppender.prototype.levels=function(){return this._chained.levels()},ChainedLogAppender}();d.ChainedLogAppender=b;var I=function(l){function LevelWrappedAppender(d,u){var p=l.call(this,d)||this;return p._levels=u,p}return u(LevelWrappedAppender,l),LevelWrappedAppender.prototype.levels=function(){return this._levels},LevelWrappedAppender}(b);function wrapAppenderWithLogLevels(l,d){return new I(l,d)}d.wrapAppenderWithLogLevels=wrapAppenderWithLogLevels})),T=createCommonjsModule((function(l,d){\r\n/*!\r\n\t *  RootToolsManager.ts\r\n\t *  AUF\r\n\t *\r\n\t *  Created by Johan Blumenberg on 2016-12-29\r\n\t *  Copyright 2016 Microsoft. All rights reserved.\r\n\t *\r\n\t */\r\nvar u=h&&h.__extends||function(){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])};return function(d,u){function __(){this.constructor=d}l(d,u),d.prototype=null===u?Object.create(u):(__.prototype=u.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var p=_.LogFactory.instance().component(\"RootToolsManager\");_.LogFactory.instance().declareComponentSafe(\"RootToolsManager\",!0);var g,f=\"638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104\";!function(l){l[l.InternalBuild=0]=\"InternalBuild\",l[l.PublicBuild=1]=\"PublicBuild\"}(g=d.BuildType||(d.BuildType={}));var m=g.InternalBuild;function setBuildType(l){var d=m;return m=l,d}function toHex(l){return(4294967296+l).toString(16).substr(-8)}function map(l,d){var u=[];for(var p in l)u.push(d(p,l[p]));return u}function arrayEquals(l,d,u){if(null==l)return null==d||0===d.length;if(null==d)return null==l||0===l.length;if(l.length===d.length){for(var p=0;p<l.length;p++)if(!u(l[p],d[p]))return!1;return!0}return!1}function matcherEquals(l,d){return null==l?null==d:null==d?null==l:l.arg===d.arg&&l.op===d.op&&l.value===d.value}function conditionEquals(l,d){return null==l?null==d||0===d.logId:null==d?null==l||0===l.logId:l.logId===d.logId&&l.name===d.name&&arrayEquals(l.matchers,d.matchers,matcherEquals)}function filterEqualsToNativeFilter(l,d){return null==l?null==d:null==d?null==l:l.component===d.component&&l.parsedLevel===d.level}function filterEquals(l,d){return null==l?null==d:null==d?null==l:l.component===d.component&&l.level===d.level}function formatArgs(l){for(var d=[],u=0;u<l.length;u++)\"string\"==typeof l[u]||\"number\"==typeof l[u]?d.push(l[u]):d.push(JSON.stringify(l[u]));return d}d.setBuildType=setBuildType;var v=function(l){function Trigger(d,u,p){var h=l.call(this)||this;return h._unmetConditions=[],h._rtMan=d,h._triggerCallback=u,h._ecsConfig=p,h.resetConditions(),h}return u(Trigger,l),Trigger.prototype.config=function(){return this._ecsConfig},Trigger.prototype.configEquals=function(l){return this._ecsConfig.includeUnsafe===l.includeUnsafe&&this._ecsConfig.mutualSubmissionType===l.mutualSubmissionType&&this._ecsConfig.name===l.name&&this._ecsConfig.reenableAfterTriggering===l.reenableAfterTriggering&&this._ecsConfig.experimentTarget===l.experimentTarget&&conditionEquals(this._ecsConfig.resetCondition,l.resetCondition)&&arrayEquals(this._ecsConfig.conditions,l.conditions,conditionEquals)&&arrayEquals(this._ecsConfig.filters,l.filters,filterEquals)},Trigger.prototype.nativeConfigEquals=function(l){return this._ecsConfig.includeUnsafe===l.includeUnsafe&&this._ecsConfig.name===l.name&&this._ecsConfig.reenableAfterTriggering===l.reenableAfterTriggering&&conditionEquals(this._ecsConfig.resetCondition,l.resetCondition)&&arrayEquals(this._ecsConfig.conditions,l.conditions,conditionEquals)&&arrayEquals(this._ecsConfig.filters,l.filters,filterEqualsToNativeFilter)},Trigger.prototype.needReset=function(l){return!this.configEquals(l)},Trigger.prototype.resetConditions=function(){this._unmetConditions=[];for(var l=0;l<this._ecsConfig.conditions.length;l++)this._unmetConditions.push(l)},Trigger.prototype.matcherMatches=function(l,d){if(l.arg>=d.length)return!1;var u=d[l.arg],p=\"string\"==typeof u?l.value:parseInt(l.value,10);return\"=\"===l.op||\"==\"===l.op?u===p:\"!=\"===l.op?u!==p:\"<\"===l.op?u<p:\"<=\"===l.op?u<=p:\">\"===l.op?u>p:\">=\"===l.op?u>=p:\"CONTAINS\"===l.op.toUpperCase()&&(\"\"+u).indexOf(l.value)>=0},Trigger.prototype.conditionMatches=function(l,d,u){if(d!==l.logId)return!1;if(l.matchers)for(var p=0;p<l.matchers.length;p++)if(!this.matcherMatches(l.matchers[p],u))return!1;return!0},Trigger.prototype.log=function(l,d,u,h){if(0!==this._unmetConditions.length&&l.component!==p){var g=this._ecsConfig;g.resetCondition&&this.conditionMatches(g.resetCondition,d,h)&&(p.debug4(\"LogTrigger %s: resetCondition met\",g.name),this.resetConditions());for(var f=0;f<this._unmetConditions.length;f++){var m=this._unmetConditions[f];if(this.conditionMatches(g.conditions[m],d,h)){p.debug4(\"LogTrigger %s: condition %s met\",g.name,g.conditions[m].name),this._unmetConditions.splice(f,1);break}}0===this._unmetConditions.length&&(p.debug1(\"LogTrigger %s has triggered, trying to send the log\",g.name),this._triggerCallback.call(this._rtMan,g),g.reenableAfterTriggering&&this.resetConditions())}},Trigger.prototype.receiveAll=function(){return!0},Trigger}(E.AbstractLogAppender),y=function(l){function CircularBuffer(d,u,p){var h=l.call(this)||this;return h._circularBuffer=[],h._circularBufferMaxSize=0,h._onBufferOverflow=null,h._circularBuffer=[],h._circularBufferMaxSize=u,h._includeUnsafe=d,h._onBufferOverflow=p||function(){return h._circularBuffer.shift()},h}return u(CircularBuffer,l),CircularBuffer.prototype.log=function(l,d,u,p){if((this._includeUnsafe||l.component.safe())&&!(this._circularBuffer.length>this._circularBufferMaxSize)){var h={md:l,logId:d,messages:formatArgs(p)};this._circularBuffer.push(h),this._circularBuffer.length>this._circularBufferMaxSize&&this._onBufferOverflow()}},CircularBuffer.prototype.visitReverseOrder=function(l){for(var d=this._circularBuffer.length-1;d>=0;d--){var u=this._circularBuffer[d];if(!l(u.md,u.logId,u.messages))return}},CircularBuffer.prototype.visitForwardOrder=function(l){for(var d=0;d<this._circularBuffer.length;d++){var u=this._circularBuffer[d];if(!l(u.md,u.logId,u.messages))return}},CircularBuffer.prototype.needReset=function(l,d){return l!==this._includeUnsafe||d!==this._circularBufferMaxSize},CircularBuffer.prototype.dumpLogBuffer=function(l,d,u){var p=this,h=new T(l.reverse),g=l.filter.map((function(l){return{component:\"root\"===l.component?\"\":l.component,parsedLevel:l.level}})),f=u||{matchedLines:0,totalLines:0};return(l.reverse?this.visitReverseOrder:this.visitForwardOrder).apply(this,[function(l,u,m){return f.totalLines++,p.filterMatches(l,u,m,g)&&(f.matchedLines++,h.log(l.component,l.timestamp,l.level,u,m)),!d||h._data.length<d}]),h.close(),h.data()},CircularBuffer.prototype.filterMatches=function(l,d,u,p){for(var h=0;h<p.length;h++)if((\"\"===p[h].component||l.component.name()===p[h].component||l.component.name().substr(0,p[h].component.length)===p[h].component&&\".\"===l.component.name().charAt(p[h].component.length))&&l.level>=p[h].parsedLevel)return!0;return!1},CircularBuffer.prototype.clear=function(){this._circularBuffer=[]},CircularBuffer.prototype.size=function(){return this._circularBuffer.length},CircularBuffer.prototype.empty=function(){return 0===this.size()},CircularBuffer.prototype.capacity=function(){return this._circularBufferMaxSize},CircularBuffer}(E.AbstractLogAppender);d.CircularBuffer=y;var T=function(){function BinaryLogFormatter(l){this._reverse=l,this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",this._data=\"ULOG2\"+String.fromCharCode(33)+String.fromCharCode(32),this._data+=l?String.fromCharCode(34):String.fromCharCode(32),this._data+=String.fromCharCode(32)}return BinaryLogFormatter.prototype._add8=function(l){if(this._pending.push(255&l),3===this._pending.length){var d=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),u=this._base64chars[d>>18&63]+this._base64chars[d>>12&63]+this._base64chars[d>>6&63]+this._base64chars[d>>0&63];this._data+=u,this._pending=[]}},BinaryLogFormatter.prototype._add16=function(l){this._add8(l>>8&255),this._add8(l>>0&255)},BinaryLogFormatter.prototype._add32=function(l){this._add8(l>>24&255),this._add8(l>>16&255),this._add8(l>>8&255),this._add8(l>>0&255)},BinaryLogFormatter.prototype._add64=function(l){this._add32(l/4294967296|0),this._add32(0|l)},BinaryLogFormatter.prototype._addS=function(l){for(var d=0;d<l.length;d++)this._add8(l.charCodeAt(d));this._add8(0)},BinaryLogFormatter.prototype._close=function(){for(;this._pending.length;)this._add8(0)},BinaryLogFormatter.prototype.log=function(l,d,u,p,h){var g=this._components[l.name()];g||(g=++this._componentCount,this._components[l.name()]=g,this._add8(2),this._add16(g),this._addS(l.name()),this._addS(\"\"),this._addS(\"\"),this._add8(l.safe()?1:0));var f=128;this._first&&(f|=2);var m=d-this._lastts;this._lastts=d,m>-128&&m<128&&(f|=1),this._add8(f),1&f?this._add8(m):this._add64(1e3*d),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(g),this._add8(u),this._add32(p),this._add8(h.length);for(var v=0;v<h.length;v++)this._add8(8),this._addS(\"\"+h[v]);this._first=!1},BinaryLogFormatter.prototype.close=function(){this._add8(7),this._close()},BinaryLogFormatter.prototype.data=function(){return this._data},BinaryLogFormatter.prototype.empty=function(){return this._first},BinaryLogFormatter}(),b=function(l){function DumperBuffer(d,u,p,h){var g=l.call(this)||this;return g._capacity=d,g._onBufferOverflow=u,g._enableThrottling=p,g._maxVerbosityLevel=h,g._outputFormatter=new T(!1),g._linesStored=0,g._throttling=!1,g._linesThrottled=0,g}return u(DumperBuffer,l),DumperBuffer.prototype.log=function(l,d,u,p){this._maxVerbosityLevel&&l.level<this._maxVerbosityLevel||(this._throttling?this._linesThrottled++:(this._linesStored++,this._outputFormatter.log(l.component,l.timestamp,l.level,d,formatArgs(p))),this._linesStored>this._capacity&&(this._enableThrottling?this._throttling||(this._throttling=!0):this._onBufferOverflow()))},DumperBuffer.prototype.dumpAndReset=function(){if(this._outputFormatter.empty())return\"\";this._linesThrottled>0&&this._outputFormatter.log(p,(new Date).getTime(),S.LogLevel.Fatal,-1,[\"RooToolsManager: Log buffer overflow! \"+this._linesThrottled+\" lines thrown away\"]),this._outputFormatter.close();var l=this._outputFormatter.data();return this.clearBuffer(),l},DumperBuffer.prototype.empty=function(){return this._outputFormatter.empty()},DumperBuffer.prototype.clearBuffer=function(){this._outputFormatter=new T(!1),this._linesStored=0,this._linesThrottled=0,this._throttling=!1},DumperBuffer.prototype.capacity=function(){return this._capacity},DumperBuffer.prototype.throttlingEnabled=function(){return this._enableThrottling},DumperBuffer.prototype.size=function(){return this._linesStored},DumperBuffer.prototype.maxVerbosityLevel=function(){return this._maxVerbosityLevel},DumperBuffer}(E.AbstractLogAppender);function validateExperimentTarget(l){return\"Native\"===l||\"JavaScript\"===l||\"Mixed\"===l}d.DumperBuffer=b;var I=function(){function RootToolsManagerImpl(){this._maxUploadSize=0,this._jsToNativeBuffer=null,this._jsToNativeBufferHandle=null,this._jsToNativeFlushTimer=null,this._jsToNativeFlushInterval=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:S.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget=\"Mixed\",this._BRBCallback=null}return RootToolsManagerImpl.prototype.setDelegate=function(l){this._glue=l,this.registerListeners()},RootToolsManagerImpl.prototype.isDelegateSet=function(){return null!=this._glue},RootToolsManagerImpl.prototype.setNativeFunctions=function(l){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=l,this._native&&this._native.log_config.addLogTriggerListener(this)},RootToolsManagerImpl.prototype.applyLogLevels=function(){var l={};for(var d in this._localLogLevels)l[d]=this._localLogLevels[d];l[\"\"]=l.root||S.LogLevel.Debug4,delete l.root;var u=map(l,(function(l,d){return{component:l,level:d}}));u.sort((function(l,d){return l.component.length-d.component.length})),u.forEach((function(l){return _.LogFactory.instance().component(l.component).setLevel(l.level)})),this._native&&this._native.log_config.setLogLevelConfig(u)},RootToolsManagerImpl.prototype.setLocalLogLevelConfig=function(l){this._localLogLevels=l,this.applyLogLevels()},RootToolsManagerImpl.prototype.parseMatcher=function(l){return null==l||null==l.arg||null==l.op||null==l.value?null:{arg:l.arg,op:l.op,value:l.value}},RootToolsManagerImpl.prototype.parseCondition=function(l){if(null==l||null==l.logId)return null;if(l.matchers&&!(l.matchers instanceof Array))return null;var d={name:l.name||toHex(l.logId),logId:l.logId,matchers:[]};if(l.matchers&&l.matchers.length)for(var u=0,p=l.matchers;u<p.length;u++){var h=p[u],g=this.parseMatcher(h);g&&d.matchers.push(g)}return d},RootToolsManagerImpl.prototype.parseFilter=function(l){return null==l||null==l.component||0===l.component.length?null:{component:l.component,level:l.level,parsedLevel:_.LogFactory.levelFromString(l.level)}},RootToolsManagerImpl.prototype.parseConfig=function(l,d,u){if(null==l)return null;if(!(l.conditions instanceof Array)||0==l.conditions.length)return null;if(!(l.filters instanceof Array)||0==l.filters.length)return null;if(l.resetCondition&&!this.parseCondition(l.resetCondition))return null;for(var p={name:l.name||d+\"->\"+u,ecsNs:d,reenableAfterTriggering:l.reenableAfterTriggering||!1,mutualSubmissionType:l.mutualSubmissionType||\"\",includeUnsafe:m!==g.PublicBuild&&(l.includeUnsafe||!1),experimentTarget:validateExperimentTarget(l.experimentTarget)&&l.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==l.resetCondition?l.resetCondition:this.parseCondition(l.resetCondition),filters:[]},h=0,f=l.conditions;h<f.length;h++){var v=f[h],y=this.parseCondition(v);y&&p.conditions.push(y)}for(var S=0,_=l.filters;S<_.length;S++){var C=_[S],E=this.parseFilter(C);E&&p.filters.push(E)}return 0===p.conditions.length?null:p},RootToolsManagerImpl.prototype.isExperimentListed=function(l,d,u,p){return!!l&&(!(!p||!l.some((function(l){return\"*\"===l.namespace})))||l.some((function(l){return l.namespace===d&&(l.experiment===u||\"*\"==l.experiment)})))},RootToolsManagerImpl.prototype.isExperimentAllowed=function(l,d,u){return!this.isExperimentListed(l.blacklist,d,u,!0)||this.isExperimentListed(l.whitelist,d,u,!1)},RootToolsManagerImpl.prototype.findTrigger=function(l,d){for(var u in l)if(l[u].configEquals(d))return u;return null},RootToolsManagerImpl.prototype.findTriggerByNativeConfig=function(l,d){for(var u in l)if(l[u].nativeConfigEquals(d))return u;return null},RootToolsManagerImpl.prototype.OnEcsChange=function(){var l=this;function forEachAsync(l,d,u){return d<l.length?u(l[d]).then((function(){return forEachAsync(l,d+1,u)})):C.Resolved()}return null==this._glue?C.Resolved():this._glue.fetchEcsConfig(\"SkypeRootTools\",\"ULBaseline\").then((function(d){p.debug4(\"Reloading ULBaseline config - new config: %@\",d),d||(p.warn(\"No ULBaseline config\"),d={}),l._maxUploadSize=d.logUpload&&d.logUpload.maxSize||1024;var u=[],h=l._triggers;l._triggers={};var g=(d.logUpload&&d.logUpload.maxSize||1024)/100,f=d.circularBuffer&&d.circularBuffer.enabled,m=d.circularBuffer&&d.circularBuffer.buffers||l._defaultBuffers,C=d.circularBuffer&&d.circularBuffer.storeUnsafe;l._defaultExperimentTarget=validateExperimentTarget(d.defaultExperimentTarget)&&d.defaultExperimentTarget||\"Mixed\";var T=d.killswitch||l._defaultKillswitch,b=d.blacklists||l._defaultBlacklists;b.component.length>0&&_.LogFactory.instance().setComponentBlacklist(b.component);var I={};(d.componentLevels||[]).forEach((function(l){return I[l.component]=l.level})),forEachAsync(d.configPaths||[],0,(function(d){return l._glue.fetchEcsConfig(d.ns,d.key).then((function(g){var m=g instanceof Array?g:[g];p.debug4(\"Reloading ECS config for %s->%s - new config: %@\",d.ns,d.key,m);for(var v=0,y=m;v<y.length;v++){var S=y[v];if(null!=S){var _=l.parseConfig(S,d.ns,d.key);if(null!=_)if(\"JavaScript\"===_.experimentTarget||\"Mixed\"===_.experimentTarget)if(p.debug2(\"Parsed ECS config for %s->%s - %@\",d.ns,d.key,_),l.isExperimentAllowed(T,d.ns,_.name)){p.debug2(\"Allowing %s->%s:%s according to killswitch\",d.ns,d.key,_.name),f=!0;var E=l.findTrigger(h,_);null!=E?(p.debug2(\"Triggers updated, keeping trigger %s\",_.name),l._triggers[E]=h[E],delete h[E]):u.push(_),_.filters&&_.filters.forEach((function(l){return I[l.component]=Math.min(I[l.component]||255,l.parsedLevel)})),_.includeUnsafe&&(C=!0)}else p.debug2(\"Disallowing %s->%s according to killswitch\",d.ns,d.key);else p.debug4(\"Skipping %s->%s, targeted for %s\",d.ns,d.key,_);else p.error(\"Failed to parse ECS config for %s->%s\",d.ns,d.key)}}}))})).always((function(){for(var d in l.applyLogLevels(),h)p.debug2(\"Triggers updated, removing trigger %s\",h[d].config().name),_.LogFactory.instance().removeAppender(+d);if(u.forEach((function(d){p.debug2(\"Triggers updated, adding trigger %s\",d.name);var u=new v(l,l._triggered,d),h=_.LogFactory.instance().addAppender(u);l._triggers[String(h)]=u})),I[\"\"]=I.root||S.LogLevel.Debug4,delete I.root,!l._circularBuffer||f&&!l._circularBuffer.needReset(C,g)?l._circularBuffer&&(Object.keys(h).length>0||u.length>0?(p.debug2(\"Buffer updated, reapplying log levels, removing log levels wrapper\"),_.LogFactory.instance().removeAppender(l._circularBufferHandle),l._circularBufferHandle=null):p.debug2(\"Buffer updated, no change\")):(p.debug2(\"Buffer updated, removing existing buffer\"),_.LogFactory.instance().removeAppender(l._circularBufferHandle),l._circularBuffer=null,l._circularBufferHandle=null),f&&(l._circularBuffer||(p.debug2(\"Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)\",C,g),l._circularBuffer=new y(C,g)),null==l._circularBufferHandle&&(p.debug2(\"Creating log level wrapper\"),l._circularBufferHandle=_.LogFactory.instance().addAppender(E.wrapAppenderWithLogLevels(l._circularBuffer,I),S.AppenderFlags.InsertFront))),l._native){var T=map(I,(function(l,d){return{component:l,level:d}}));T.sort((function(l,d){return l.component.length-d.component.length})),l._native.log_config.setLogBufferConfig(f,{storeUnsafe:C,buffers:m},T);var b=[];for(var A in l._triggers){var R=l._triggers[A].config();b.push({name:R.name,ecsNs:R.ecsNs,conditions:R.conditions,resetCondition:R.resetCondition,includeUnsafe:R.includeUnsafe,reenableAfterTriggering:R.reenableAfterTriggering,filters:R.filters.map((function(l){return{component:l.component,level:l.parsedLevel}})),dumpFile:!1,metadata:{}})}l._native.log_config.setLogTriggerConfig(b,{})}}))}))},RootToolsManagerImpl.prototype._send=function(l,d){null!=this._glue&&(this._glue.sendTelemetry(f,{logTriggerName:l.name,logEcsNs:l.ecsNs,logdata:d}),p.debug4(\"LogSender::send, sent %d bytes\",d.length))},RootToolsManagerImpl.prototype.triggered=function(l,d){},RootToolsManagerImpl.prototype.triggeredPartially=function(l,d,u,p,h){var g=this.findTriggerByNativeConfig(this._triggers,l);if(g){var f={level:d.level,component:_.LogFactory.instance().component(d.component),timestamp:d.timestamp};this._triggers[g].log(f,u,p,h)}},RootToolsManagerImpl.prototype.reset=function(l){var d=this.findTriggerByNativeConfig(this._triggers,l);d&&this._triggers[d].resetConditions()},RootToolsManagerImpl.prototype.dumpLogBuffer=function(l,d){if(this._circularBuffer){var u={matchedLines:0,totalLines:0},h=this._circularBuffer.dumpLogBuffer(l,this._maxUploadSize,u);if(p.debug4(\"dumpLogBuffer: dumped %d of %d lines, size of payload: %d\",u.matchedLines,u.totalLines,null!=h?h.length:0),this._native){var g=C.Defer();return this._native.log_config.mergeAndDumpLogBuffer(h,l,d,(function(l){return g.resolve(l)})),g.promise()}return C.Resolved(h)}return p.warn(\"dumpLogBuffer: no log buffer enabled\"),C.Rejected()},RootToolsManagerImpl.prototype._triggered=function(l){var d=this,u={compression:S.LogFileCompression.Compress,encoding:S.LogFileEncoding.Base64,encryption:S.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},p={includeUnsafe:l.includeUnsafe,filter:l.filters.map((function(l){return{component:l.component,level:l.parsedLevel}})),reverse:!0};this.dumpLogBuffer(p,u).then((function(u){return d._send(l,u)}))},RootToolsManagerImpl.prototype.sendBRBEvent=function(l){try{if(p.debug2(\"sendBRBEvent %s\",JSON.stringify(l)),null!=this._glue&&\"function\"==typeof this._glue.sendLoggingEventToNative){var d={eventType:\"uploadBRB\",mutualSubmissionType:\"call\",payload:l};this._glue.sendLoggingEventToNative(JSON.stringify(d),\"\")}}catch(l){p.error(\"sendBRBEvent %s: %s\",l.name,l.message)}},RootToolsManagerImpl.prototype.setBRBCallback=function(l){p.debug2(\"setBRBCallback\"),null!=this._glue?\"function\"==typeof this._glue.setNativeLoggingEventCallback?this._BRBCallback=l:p.warn(\"setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method\"):p.warn(\"setBRBCallback: RootToolsManagerDelegate is not set\")},RootToolsManagerImpl.prototype.registerListeners=function(){var l=this;null!=this._glue&&\"function\"==typeof this._glue.setNativeLoggingEventCallback?this._glue.setNativeLoggingEventCallback((function(d,u){return l.handleNativeLoggingEvent(d,u)})):p.warn(\"registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method\")},RootToolsManagerImpl.prototype.handleNativeLoggingEvent=function(l,d){try{p.debug2(\"Native Log event message: %s aux: %s\",l,d);var u=JSON.parse(l);if(u.eventType&&\"uploadBRB\"===u.eventType){if(\"function\"!=typeof this._BRBCallback)return void p.warn(\"BRBCallback not set, ignoring native event\");p.debug4(\"Sending BRB callback: %@\",u.payload),this._BRBCallback(u.payload)}else u.eventType&&\"jsLogFileConfiguration\"===u.eventType&&this.handleLogFileConfigEvent(u)}catch(l){p.error(\"handleNativeLoggingEvent %s: %s\",l.name,l.message)}},RootToolsManagerImpl.prototype.handleLogFileConfigEvent=function(l){if(l.payload){var d=l.payload;if(d.enabled){if(d.chunkSize&&d.flushInterval){var u={chunkSize:d.chunkSize,flushInterval:d.flushInterval,enableThrottling:d.enableThrottling,maxVerbosityLevel:d.maxVerbosityLevel};this.startJsToNativeLogging(u)}}else this.flushDisableJsToNativeLogging()}},RootToolsManagerImpl.prototype.logExternalForDDL=function(l,d){try{if(p.debug2(\"logExternalForDDL %s %s\",l,d),null!=this._glue&&\"function\"==typeof this._glue.sendLoggingEventToNative){var u={eventType:\"logInSClog\",payload:{message:l,parameters:d}};this._glue.sendLoggingEventToNative(JSON.stringify(u),\"\")}else p.warn(\"ignoring logExternalForDDL, delegate misconfigured\")}catch(l){p.error(\"logExternalForDDL %s: %s\",l.name,l.message)}},RootToolsManagerImpl.prototype.startJsToNativeLogging=function(l){var d=this,u=l.chunkSize,h=l.flushInterval,g=l.enableThrottling,f=this._getVerbosityLevelFromConfig(l.maxVerbosityLevel);if(this._jsToNativeBuffer){if(this._jsToNativeBuffer.capacity()===u&&this._jsToNativeFlushInterval===h&&this._jsToNativeBuffer.throttlingEnabled()===g&&this._jsToNativeBuffer.maxVerbosityLevel()===f)return void p.debug1(\"Same JS2Native settings received - doing nothing\");p.debug1(\"Reapplying js to native settings\"),this.flushDisableJsToNativeLogging()}this._jsToNativeBuffer=new b(u,(function(){d.onJsToNativeBufferReady(d._jsToNativeBuffer)}),g,f),this.setJsToNativeFlushTimeout(h),this._jsToNativeFlushInterval=h,this._jsToNativeBufferHandle=_.LogFactory.instance().addAppender(this._jsToNativeBuffer)},RootToolsManagerImpl.prototype._getVerbosityLevelFromConfig=function(l){return l?_.LogFactory.levelFromString(l):null},RootToolsManagerImpl.prototype.flushDisableJsToNativeLogging=function(){this._jsToNativeBuffer&&this.onJsToNativeBufferReady(this._jsToNativeBuffer),this.plainDisableJsToNativeLogging()},RootToolsManagerImpl.prototype.plainDisableJsToNativeLogging=function(){this.clearJsToNativeFlushTimeout(),this._jsToNativeBufferHandle&&(_.LogFactory.instance().removeAppender(this._jsToNativeBufferHandle),this._jsToNativeBufferHandle=0,this._jsToNativeBuffer=null,p.debug1(\"Disabling forwarding JS logs to native\"))},RootToolsManagerImpl.prototype.onJsToNativeBufferReady=function(l){null!=this._glue&&\"function\"==typeof this._glue.sendLoggingEventToNative?(this.clearJsToNativeFlushTimeout(),this.dumpJsToNativeBuffer(l),this.setJsToNativeFlushTimeout(this._jsToNativeFlushInterval)):this.plainDisableJsToNativeLogging()},RootToolsManagerImpl.prototype.dumpJsToNativeBuffer=function(l){if(!l.empty()){var d=l.dumpAndReset(),u={eventType:\"writeLogData\"};this._glue.sendLoggingEventToNative(JSON.stringify(u),d)}},RootToolsManagerImpl.prototype.clearJsToNativeFlushTimeout=function(){this._jsToNativeFlushTimer&&(clearTimeout(this._jsToNativeFlushTimer),this._jsToNativeFlushTimer=null)},RootToolsManagerImpl.prototype.setJsToNativeFlushTimeout=function(l){var d=this;!this._jsToNativeFlushTimer&&l&&(this._jsToNativeFlushTimer=setTimeout((function(){d._jsToNativeFlushTimer=null,d.onJsToNativeBufferReady(d._jsToNativeBuffer)}),l))},RootToolsManagerImpl.prototype.stopAsyncOperations=function(){this.flushDisableJsToNativeLogging()},RootToolsManagerImpl}();d.RootToolsManager=new I})),b=createCommonjsModule((function(l,d){\r\n/*!\r\n\t *  pii.ts\r\n\t *  AUF\r\n\t *\r\n\t *  Created by Johan Blumenberg on 2017-01-16\r\n\t *  Copyright 2017 Microsoft. All rights reserved.\r\n\t *\r\n\t */\r\nObject.defineProperty(d,\"__esModule\",{value:!0});var DefaultTagger=function(l){return l},u=!0,p=DefaultTagger,h={},g=0;function addName(l){return h[l]=\"u\"+ ++g}var f,m=/^([0-9][0-9]?):([^<>\\*\\{\\}&'\\\"\\/\\\\?^`|~\\s]+)$/;!function(l){l[l.MSA=1]=\"MSA\",l[l.S4B_Bridge=2]=\"S4B_Bridge\",l[l.PSTN=4]=\"PSTN\",l[l.SkypeId=8]=\"SkypeId\",l[l.Thread=19]=\"Thread\",l[l.LegacyShortCircuit=20]=\"LegacyShortCircuit\",l[l.OneToOneTextMessage=21]=\"OneToOneTextMessage\",l[l.GroupTextMessage=22]=\"GroupTextMessage\",l[l.Bot=28]=\"Bot\",l[l.InternalSkype=48]=\"InternalSkype\"}(f||(f={}));var v=[f.Thread,f.InternalSkype,f.Bot];function enableAnonymization(l){u=l}function useTagger(l){p=l||DefaultTagger}d.enableAnonymization=enableAnonymization,d.useTagger=useTagger,function(l){function untaggedUserName(l){return u?l?h[l]||addName(l):null:l}function UserName(l){var d=untaggedUserName(l);return p(d)}function Mri(l){var d,u=l.match(m);if(u){var h=Number(u[1]),g=u[2];d=-1!=v.indexOf(h)?l:h+\":\"+untaggedUserName(g)}else d=untaggedUserName(l);return p(d)}function Omit(l){var d;return d=u?\"number\"==typeof l?19229:\"string\"==typeof l?l.charAt(0)+\"...\":null:l,p(d)}l.UserName=UserName,l.Mri=Mri,l.Omit=Omit}(d.pii||(d.pii={}))})),I=createCommonjsModule((function(l,d){\r\n/*!\r\n\t *  index.ts\r\n\t *  AUF\r\n\t *\r\n\t *  Created by Johan Blumenberg on 2016-12-29\r\n\t *  Copyright 2016 Microsoft. All rights reserved.\r\n\t *\r\n\t */\r\nfunction __export(l){for(var u in l)d.hasOwnProperty(u)||(d[u]=l[u])}Object.defineProperty(d,\"__esModule\",{value:!0}),__export(S),__export(_),__export(T),__export(E),__export(b)})),A=createCommonjsModule((function(l,d){!function webpackUniversalModuleDefinition(d,u){l.exports=u(y,I)}(window,(function(l,d){return function(l){var d={};function __webpack_require__(u){if(d[u])return d[u].exports;var p=d[u]={i:u,l:!1,exports:{}};return l[u].call(p.exports,p,p.exports,__webpack_require__),p.l=!0,p.exports}return __webpack_require__.m=l,__webpack_require__.c=d,__webpack_require__.d=function(l,d,u){__webpack_require__.o(l,d)||Object.defineProperty(l,d,{enumerable:!0,get:u})},__webpack_require__.r=function(l){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(l,\"__esModule\",{value:!0})},__webpack_require__.t=function(l,d){if(1&d&&(l=__webpack_require__(l)),8&d)return l;if(4&d&&\"object\"==typeof l&&l&&l.__esModule)return l;var u=Object.create(null);if(__webpack_require__.r(u),Object.defineProperty(u,\"default\",{enumerable:!0,value:l}),2&d&&\"string\"!=typeof l)for(var p in l)__webpack_require__.d(u,p,function(d){return l[d]}.bind(null,p));return u},__webpack_require__.n=function(l){var d=l&&l.__esModule?function getDefault(){return l.default}:function getModuleExports(){return l};return __webpack_require__.d(d,\"a\",d),d},__webpack_require__.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},__webpack_require__.p=\"\",__webpack_require__(__webpack_require__.s=180)}([function(l,d,u){u.d(d,\"w\",(function(){return isTypeof})),u.d(d,\"x\",(function(){return isUndefined})),u.d(d,\"r\",(function(){return isNullOrUndefined})),u.d(d,\"p\",(function(){return isNotNullOrUndefined})),u.d(d,\"j\",(function(){return hasOwnProperty})),u.d(d,\"t\",(function(){return isObject})),u.d(d,\"o\",(function(){return isFunction})),u.d(d,\"e\",(function(){return attachEvent})),u.d(d,\"g\",(function(){return detachEvent})),u.d(d,\"z\",(function(){return objForEachKey})),u.d(d,\"F\",(function(){return strEndsWith})),u.d(d,\"G\",(function(){return strStartsWith})),u.d(d,\"E\",(function(){return strContains})),u.d(d,\"m\",(function(){return isDate})),u.d(d,\"k\",(function(){return F})),u.d(d,\"n\",(function(){return isError})),u.d(d,\"u\",(function(){return isString})),u.d(d,\"s\",(function(){return isNumber})),u.d(d,\"l\",(function(){return isBoolean})),u.d(d,\"J\",(function(){return toISOString})),u.d(d,\"a\",(function(){return arrForEach})),u.d(d,\"b\",(function(){return arrIndexOf})),u.d(d,\"c\",(function(){return arrMap})),u.d(d,\"d\",(function(){return arrReduce})),u.d(d,\"H\",(function(){return strTrim})),u.d(d,\"B\",(function(){return objKeys})),u.d(d,\"y\",(function(){return objDefineAccessors})),u.d(d,\"A\",(function(){return B})),u.d(d,\"f\",(function(){return dateNow})),u.d(d,\"h\",(function(){return getExceptionName})),u.d(d,\"D\",(function(){return setValue})),u.d(d,\"i\",(function(){return getSetValue})),u.d(d,\"q\",(function(){return isNotTruthy})),u.d(d,\"v\",(function(){return isTruthy})),u.d(d,\"I\",(function(){return throwError})),u.d(d,\"C\",(function(){return optimizeObject}));var p=u(2),h=u(31),g=\"on\",f=\"attachEvent\",m=\"addEventListener\",v=\"detachEvent\",y=\"removeEventListener\",S=\"toISOString\",_=\"endsWith\",C=\"startsWith\",E=\"indexOf\",T=\"map\",b=\"reduce\",I=\"trim\",A=\"toString\",R=p.d,P=p.b.freeze,O=(p.b.seal,p.b.keys),M=String[p.k],w=M[I],N=M[_],D=M[C],L=Date[p.k][S],k=Array.isArray,x=p.f[A];p.e[A].call(p.b);function isTypeof(l,d){return typeof l===d}function isUndefined(l){return void 0===l||typeof l===p.l}function isNullOrUndefined(l){return null===l||isUndefined(l)}function isNotNullOrUndefined(l){return!isNullOrUndefined(l)}function hasOwnProperty(l,d){return!(!l||!p.e.call(l,d))}function isObject(l){return!(!l||typeof l!==p.j)}function isFunction(l){return!(!l||typeof l!==p.h)}function attachEvent(l,d,u,p){void 0===p&&(p=!1);var h=!1;if(!isNullOrUndefined(l))try{isNullOrUndefined(l[m])?isNullOrUndefined(l[f])||(l[f](g+d,u),h=!0):(l[m](d,u,p),h=!0)}catch(l){}return h}function detachEvent(l,d,u,p){if(void 0===p&&(p=!1),!isNullOrUndefined(l))try{isNullOrUndefined(l[y])?isNullOrUndefined(l[v])||l[v](g+d,u):l[y](d,u,p)}catch(l){}}function objForEachKey(l,d){if(l)for(var u in l)p.e.call(l,u)&&d.call(l,u,l[u])}function strEndsWith(l,d){var u=!1;return l&&d&&!(u=l===d)&&(u=N?l[_](d):_strEndsWithPoly(l,d)),u}function _strEndsWithPoly(l,d){var u=!1,p=d?d.length:0,h=l?l.length:0;if(p&&h&&h>=p&&!(u=l===d)){for(var g=h-1,f=p-1;f>=0;f--){if(l[g]!=d[f])return!1;g--}u=!0}return u}function strStartsWith(l,d){var u=!1;return l&&d&&!(u=l===d)&&(u=D?l[C](d):_strStartsWithPoly(l,d)),u}function _strStartsWithPoly(l,d){var u=!1,p=d?d.length:0;if(l&&p&&l.length>=p&&!(u=l===d)){for(var h=0;h<p;h++)if(l[h]!==d[h])return!1;u=!0}return u}function strContains(l,d){return!(!l||!d)&&-1!==l.indexOf(d)}function isDate(l){return!(!l||\"[object Date]\"!==x.call(l))}var F=k||_isArrayPoly;function _isArrayPoly(l){return!(!l||\"[object Array]\"!==x.call(l))}function isError(l){return!(!l||\"[object Error]\"!==x.call(l))}function isString(l){return\"string\"==typeof l}function isNumber(l){return\"number\"==typeof l}function isBoolean(l){return\"boolean\"==typeof l}function toISOString(l){if(l)return L?l[S]():_toISOStringPoly(l)}function _toISOStringPoly(l){if(l&&l.getUTCFullYear){var pad=function(l){var d=String(l);return 1===d.length&&(d=\"0\"+d),d};return l.getUTCFullYear()+\"-\"+pad(l.getUTCMonth()+1)+\"-\"+pad(l.getUTCDate())+\"T\"+pad(l.getUTCHours())+\":\"+pad(l.getUTCMinutes())+\":\"+pad(l.getUTCSeconds())+\".\"+String((l.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+\"Z\"}}function arrForEach(l,d,u){var p=l.length;try{for(var h=0;h<p&&(!(h in l)||-1!==d.call(u||l,l[h],h,l));h++);}catch(l){}}function arrIndexOf(l,d,u){if(l){if(l[E])return l[E](d,u);var p=l.length,h=u||0;try{for(var g=Math.max(h>=0?h:p-Math.abs(h),0);g<p;g++)if(g in l&&l[g]===d)return g}catch(l){}}return-1}function arrMap(l,d,u){var p;if(l){if(l[T])return l[T](d,u);var h=l.length,g=u||l;p=new Array(h);try{for(var f=0;f<h;f++)f in l&&(p[f]=d.call(g,l[f],l))}catch(l){}}return p}function arrReduce(l,d,u){var p;if(l){if(l[b])return l[b](d,u);var h=l.length,g=0;if(arguments.length>=3)p=arguments[2];else{for(;g<h&&!(g in l);)g++;p=l[g++]}for(;g<h;)g in l&&(p=d(p,l[g],g,l)),g++}return p}function strTrim(l){return l&&(l=w&&l[I]?l[I]():l.replace?l.replace(/^\\s+|\\s+$/g,\"\"):l),l}var U=!{toString:null}.propertyIsEnumerable(\"toString\"),j=[\"toString\",\"toLocaleString\",\"valueOf\",\"hasOwnProperty\",\"isPrototypeOf\",\"propertyIsEnumerable\",\"constructor\"];function objKeys(l){var d=typeof l;if(d===p.h||d===p.j&&null!==l||Object(h.c)(\"objKeys called on non-object\"),!U&&O)return O(l);var u=[];for(var g in l)l&&p.e.call(l,g)&&u.push(g);if(U)for(var f=j.length,m=0;m<f;m++)l&&p.e.call(l,j[m])&&u.push(j[m]);return u}function objDefineAccessors(l,d,u,p){if(R)try{var h={enumerable:!0,configurable:!0};return u&&(h.get=u),p&&(h.set=p),R(l,d,h),!0}catch(l){}return!1}function _doNothing(l){return l}var B=P||_doNothing;function dateNow(){var l=Date;return l.now?l.now():(new l).getTime()}function getExceptionName(l){return isError(l)?l.name:\"\"}function setValue(l,d,u,p,h){var g=u;return l&&((g=l[d])===u||h&&!h(g)||p&&!p(u)||(g=u,l[d]=g)),g}function getSetValue(l,d,u){var p;return l?!(p=l[d])&&isNullOrUndefined(p)&&(p=isUndefined(u)?{}:u,l[d]=p):p=isUndefined(u)?{}:u,p}function isNotTruthy(l){return!l}function isTruthy(l){return!!l}function throwError(l){throw new Error(l)}function optimizeObject(l){return l&&p.a&&(l=Object(p.b)(Object(p.a)({},l))),l}},function(l,d,u){var p,h,g=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.sampleseries=d.rebaseHistogramTimestamps=d.rebaseTime=d.hptimeOrigin=d.hptime=d.getLast=d.addGetterFields=d.arrayPushFixedSize=d.limitArraySize=d.scrubDeviceLabelPii=d.round=d.getAverage=d.levenshteinDistance=d.getLongestCommonContiguousSubstring=d.subtractFrom=d.getFrom=d.isInRange=d.getClosestValue=d.throwIfFeatureNotSupported=d.throwIfNotSupported=d.getMaxSubstring=d.deepEqual=d.uniqueId=d.removeUndefinedFields=d.deepClone=d.shallowClone=d.keys=d.isEmpty=d.assign=d.values=d.compareArraysBy=d.remove=d.average=d.forOwnRec=d.forOwn=d.stringifyObject=void 0;var m=u(35);Object.defineProperty(d,\"stringifyObject\",{enumerable:!0,get:function(){return m.stringifyObject}});var v=u(3);function forOwn(l,d){for(var u in l)l.hasOwnProperty(u)&&d(l[u],u)}function forOwnRec(l,d){for(var u in l)l.hasOwnProperty(u)&&(\"object\"==typeof l[u]?forOwnRec(l[u],d):d(l[u],u,l))}function average(l){var d=0;return l.forEach((function(l){return d+=l})),d/=l.length}function remove(l,d){for(var u=!1,p=l.length;p-- >0;)d(l[p],p,l)&&(l.splice(p,1),u=!0);return u}function compareArraysBy(l,d,u){var p=[];return l.forEach((function(l){d.some((function(d){return u(l,d)}))||p.push(l)})),0===p.length&&l.length===d.length}function values(l){var d=[];for(var u in l)l.hasOwnProperty(u)&&d.push(l[u]);return d}function assign(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])}function isEmpty(l){return!Object.keys(l).length}function keys(l){return Object.keys(l)}function shallowClone(l){var d={};return forOwn(l,(function(l,u){d[u]=l})),d}function deepClone(l){var d;if(!l||\"object\"!=typeof l)return l;if(l instanceof Date)return(d=new Date).setTime(l.getTime()),d;if(l instanceof Array){d=[];for(var u=0,p=l.length;u<p;u++)d[u]=deepClone(l[u]);return d}if(l instanceof Object)return d={},forOwn(l,(function(l,u){d[u]=deepClone(l)})),d;throw new Error(\"Unable to copy: \"+(0,m.stringifyObject)(l))}function removeUndefinedFields(l){return Object.keys(l).forEach((function(d){void 0===l[d]&&delete l[d]})),l}function uniqueId(){var segment=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return segment()+segment()+segment()+\"4\"+segment().substring(1)+\"b\"+segment().substring(1)+segment()+segment()+segment()}function deepEqual(l,d){var u,p=typeof l;if(l===d)return!0;if(p!==typeof d||\"object\"!==p&&\"function\"!==p)return!1;if(null===l||null===d)return l===d;if(l instanceof Date&&d instanceof Date)return+l==+d;if(l instanceof Map&&d instanceof Map)return compareMaps(l,d);for(u in l)if(!(u in d)||!deepEqual(l[u],d[u]))return!1;for(u in d)if(!(u in l)||!deepEqual(l[u],d[u]))return!1;return!0}function compareMaps(l,d){var u;if(l.size!==d.size)return!1;var p=!0;return l.forEach((function(l,h){((u=d.get(h))!==l||void 0===u&&!d.has(h))&&(p=!1)})),p}function getMaxSubstring(l,d){return d.reduce((function(d,u){var p=l.includes(u)?u.length:0;return d.length<p?u:d}),\"\")}function throwIfNotSupported(l,d){if(-1===d.indexOf(l))throw{detail:\"\".concat(l,\" mediaContent.contentType is not supported\"),type:v.default.MEDIA_ERROR.incompatibleOffer}}function throwIfFeatureNotSupported(l,d){l.forEach((function(l){if(\"\"!==l&&-1!==d.findIndex((function(d){return d===l})))throw{detail:\"Required feature '\".concat(l,\"' is not acceptable.\"),type:v.default.MEDIA_ERROR.incompatibleOffer}}))}function getClosestValue(l,d,u,p){void 0===p&&(p=0);for(var h=1;h<l.length;h++)if(l[h-1]+p<d&&d<=l[h]+p)return u?l[h]:l[h-1];return l[0]}function isInRange(l,d,u){return d<=l&&l<=u}function getFrom(l){for(var d,u,p=[],h=1;h<arguments.length;h++)p[h-1]=arguments[h];try{for(var f=g(p),m=f.next();!m.done;m=f.next()){var v=m.value;if(v.hasOwnProperty(l))return v[l]}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=f.return)&&u.call(f)}finally{if(d)throw d.error}}}function subtractFrom(l,d){return l.filter((function(l){return!d.some((function(d){return d===l}))}))}function getLongestCommonContiguousSubstring(l,d){if(l===d)return l;for(var u=0,p=0,h=\"\",g=0;g<l.length&&!(h.length>l.length-g);g++){var f=g;p-u>h.length&&(h=l.substring(u,p),g=p-1),u=g,p=g;for(var m=0;m<d.length;m++)f<l.length&&d[m]===l[f++]?p=f:(f=g,p-u>h.length&&(h=l.substring(u,p),g=p-1),u=g,p=g)}return h}function levenshteinDistance(l,d){for(var u=new Array(l.length+1),p=0;p<l.length+1;p++){u[p]=new Array(d.length+1);for(var h=0;h<d.length+1;h++)u[p][h]=0}for(p=1;p<l.length+1;p++)u[p][0]=p;for(p=1;p<d.length+1;p++)u[0][p]=p;for(p=1;p<l.length+1;p++)for(h=1;h<d.length+1;h++){var g=1;l[p-1]===d[h-1]&&(g=0),u[p][h]=Math.min(u[p-1][h]+1,u[p][h-1]+1,u[p-1][h-1]+g)}return u[l.length][d.length]}function getAverage(l){for(var d=0,u=0;u<l.length;u++)d+=l[u];return d/l.length}function round(l,d){return void 0===d&&(d=3),l&&parseFloat(l.toFixed(d))}function scrubDeviceLabelPii(l,d){if(!l)return\"\";if(l.length<3)return l;var u=[],p=l.match(/\\(([0-9a-zA-Z]+:[0-9a-zA-Z]+)\\)/);p&&u.push(p[1]);try{if(null==d?void 0:d.length)for(var h=new RegExp(\"(\".concat(d.join(\"|\"),\")\"),\"gi\"),g=h.exec(l);g;)u.push(g[1]),g=h.exec(l);else u.push(\"no_keywords\")}catch(l){u.push(\"Error: \".concat((0,m.stringifyObject)(l)))}return 0===u.length?\"unknown\":u.join(\" \")}function limitArraySize(l,d,u){return void 0===u&&(u=0),d>0&&l.length>d&&l.splice(u,l.length-d),l}function arrayPushFixedSize(l,d,u,p){void 0===p&&(p=0),u&&limitArraySize(l,u-1,p),l.push(d)}function addGetterFields(l,d){var u={};for(var p in d)u[p]={get:d[p],configurable:!1,enumerable:!0};Object.defineProperties(l,u)}function getLast(l){return(null==l?void 0:l.length)>0?l[l.length-1]:void 0}d.forOwn=forOwn,d.forOwnRec=forOwnRec,d.average=average,d.remove=remove,d.compareArraysBy=compareArraysBy,d.values=values,d.assign=assign,d.isEmpty=isEmpty,d.keys=keys,d.shallowClone=shallowClone,d.deepClone=deepClone,d.removeUndefinedFields=removeUndefinedFields,d.uniqueId=uniqueId,d.deepEqual=deepEqual,d.getMaxSubstring=getMaxSubstring,d.throwIfNotSupported=throwIfNotSupported,d.throwIfFeatureNotSupported=throwIfFeatureNotSupported,d.getClosestValue=getClosestValue,d.isInRange=isInRange,d.getFrom=getFrom,d.subtractFrom=subtractFrom,d.getLongestCommonContiguousSubstring=getLongestCommonContiguousSubstring,d.levenshteinDistance=levenshteinDistance,d.getAverage=getAverage,d.round=round,d.scrubDeviceLabelPii=scrubDeviceLabelPii,d.limitArraySize=limitArraySize,d.arrayPushFixedSize=arrayPushFixedSize,d.addGetterFields=addGetterFields,d.getLast=getLast;var y=(null===(p=null===window||void 0===window?void 0:window.performance)||void 0===p?void 0:p.now)&&(null===(h=null===window||void 0===window?void 0:window.performance)||void 0===h?void 0:h.timeOrigin),S=y?function(){return window.performance.now()}:function(){return Date.now()},_=y?window.performance.timeOrigin:0;function rebaseTime(l,d,u){var p,h;if((null==l?void 0:l.length)>0){var f=[];try{for(var m=g(l),v=m.next();!v.done;v=m.next()){var y=deepClone(v.value);y[d]=y[d]&&y[d]-u,f.push(y)}}catch(l){p={error:l}}finally{try{v&&!v.done&&(h=m.return)&&h.call(m)}finally{if(p)throw p.error}}return f}}function rebaseHistogramTimestamps(l,d){var u,p,h,m,v={seconds1to3:[],seconds3to5:[],seconds5to8:[],seconds8to15:[],seconds15to60:[],seconds60toMax:[]};try{for(var y=g(Object.entries(l)),S=y.next();!S.done;S=y.next()){var _=f(S.value,2),C=_[0],E=_[1];try{for(var T=(h=void 0,g(E)),b=T.next();!b.done;b=T.next()){var I=b.value;v[C].push(I-d)}}catch(l){h={error:l}}finally{try{b&&!b.done&&(m=T.return)&&m.call(T)}finally{if(h)throw h.error}}}}catch(l){u={error:l}}finally{try{S&&!S.done&&(p=y.return)&&p.call(y)}finally{if(u)throw u.error}}return v}function sampleseries(l,d,u){void 0===u&&(u=!1);var p=null==l?void 0:l.map(d).filter((function(l){return void 0!==l&&!isNaN(l)&&null!==l&&\"\"!==l&&(!1===u||0!==l)}));return(null==p?void 0:p.length)?p.join(\",\"):void 0}d.hptime=S,d.hptimeOrigin=_,d.rebaseTime=rebaseTime,d.rebaseHistogramTimestamps=rebaseHistogramTimestamps,d.sampleseries=sampleseries},function(l,d,u){u.d(d,\"h\",(function(){return p})),u.d(d,\"j\",(function(){return h})),u.d(d,\"l\",(function(){return g})),u.d(d,\"k\",(function(){return f})),u.d(d,\"i\",(function(){return m})),u.d(d,\"g\",(function(){return v})),u.d(d,\"b\",(function(){return y})),u.d(d,\"f\",(function(){return S})),u.d(d,\"a\",(function(){return _})),u.d(d,\"c\",(function(){return C})),u.d(d,\"d\",(function(){return E})),u.d(d,\"e\",(function(){return T}));var p=\"function\",h=\"object\",g=\"undefined\",f=\"prototype\",m=\"hasOwnProperty\",v=\"default\",y=Object,S=y[f],_=y.assign,C=y.create,E=y.defineProperty,T=S[m]},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=\"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\",h=\"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\",g=\"http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00\";d.default={MEDIA_STATE:{send:\"sendonly\",receive:\"recvonly\",sendReceive:\"sendrecv\",inactive:\"inactive\"},MEDIA_DIRECTION:{SEND:\"send\",RECV:\"recv\"},MEDIA_DEVICE_KIND:{audioInput:\"audioinput\",audioOutput:\"audiooutput\",videoInput:\"videoinput\",compositeAudio:\"compositeAudio\"},MEDIA_DEVICE:{camera:\"camera\",microphone:\"microphone\",speaker:\"speaker\",compositeAudio:\"compositeAudio\",defaultId:\"default\",communicationsId:\"communications\",defaultDeviceLabel:\"Default\"},MEDIA_ERROR:{constraintNotSatisfiedError:\"ConstraintNotSatisfiedError\",iceConnectionError:\"iceConnectionError\",srtpError:\"srtpError\",permissionDeniedError:\"permissionDeniedError\",internalError:\"internalError\",sourceUnavailableError:\"SourceUnavailableError\",devicesNotFoundError:\"DevicesNotFoundError\",noDeviceSelected:\"noDeviceSelected\",noNetworkError:\"noNetworkError\",incompatibleOffer:\"IncompatibleOffer\",mediaStreamRequestError:\"MediaStreamRequestError\",extensionNotFoundError:\"ExtensionNotFoundError\",sharingCancelledError:\"SharingCancelledError\",permissionDeniedBySystemError:\"PermissionsDeniedBySystem\",chromeRuntimeNotDefinedError:\"ChromeRuntimeNotDefinedError\",mediaStreamRequestTimedOut:\"MediaStreamRequestTimedout\",unsupportedStream:\"UnsupportedStream\",webGlRendererError:\"WebGlRendererError\"},HISTOGRAM_BATCH:{seconds1to3:2,seconds3to5:4,seconds5to8:7,seconds8to15:14,seconds15to60:59,seconds60toMax:1e6},RENEGOTIATION_ERROR:{local:\"local\",glare:\"glare\",signaling:\"signaling\",media:\"media\",escalation:\"escalation\"},MSI:{unsubscribe:-1,subscribeAny:-2},MEDIA_LABEL:{audio:\"main-audio\",video:\"main-video\",sharing:\"applicationsharing-video\",data:\"data\"},MEDIA_TYPE:{audio:\"audio\",video:\"video\",sharing:\"sharing\",data:\"x-data\",dataChannel:\"application\"},MODALITY:{audio:\"audio\",video:\"video\",sharing:\"sharing\",data:\"data\"},ICE_TRANSPORT_POLICY:{all:\"all\",relay:\"relay\"},EXTENSION_TYPE:{dominantSpeakerHistory:\"dominantSpeakerHistory\",videoStreamControl:\"videoStreamControl\",optimalVideoCount:\"optimalVideoCount\"},RENDERER_TYPE:{video:\"video\",sharing:\"sharing\"},CONTENT_TYPE:{SDP:\"application/sdp\"},ALLOWED_CONTENT_TYPES:{SDP_ONLY:[\"application/sdp\"],SDP_NGC:[\"application/sdp\",\"application/sdp-ngc-0.5\",\"application/sdp-ngc-1.0\"]},STREAMING_STATE:{created:\"created\",started:\"started\",active:\"active\",inactive:\"inactive\",stopped:\"stopped\",removed:\"removed\",failed:\"failed\"},TIME_INTERVAL:{SEC_1:1},DISPLAY_SOURCE_ID:\"display\",SYSTEM_AUDIO_SOURCE_ID:\"system\",MULTIPLE_RECV_STREAMS:\"multipleVideoStreams\",PROFILES:{udpTlsRtpSavpf:\"UDP/TLS/RTP/SAVPF\",rtpSavpf:\"RTP/SAVPF\",rtpSavp:\"RTP/SAVP\",udpDtlsSctp:\"UDP/DTLS/SCTP\"},REPORTING_PROFILE:{RT_PROFILE:\"REAL_TIME\",BE_PROFILE:\"BEST_EFFORT\",NRT_PROFILE:\"NEAR_REAL_TIME\"},PAYLOAD_TYPE:{DATA_CHANNEL:\"webrtc-datachannel\",X_DATA:\"127 126\"},VIDEO_CAPABILITIES:{MAX_FS_PATH:\"max-fs\",MAX_MBPS_PATH:\"max-mbps\",MAX_FPS_PATH:\"max-fps\",MAX_BR_PATH:\"max-br\",SSRC_PATH:\"ssrc\",RID_PATH:\"rid\",KEYFRAME_PATH:\"KeyFrame\",MAX_WIDTH:\"max-width\",MAX_HEIGHT:\"max-height\",VLA_DEBUG:\"vla-debug\"},TRANSPORT_CC:{EXT_URI:p,MSSDP_ENCODED_URI:p.replace(/\\//g,\"\\\\\"),ATTRIBUTE:\"transport-cc\"},ABS_SEND_TIME:{EXT_URI:h,MSSDP_ENCODED_URI:h.replace(/\\//g,\"\\\\\")},VLA:{EXT_URI:g,EXT_URI_NON_ADV:g+\"-non-advertised\",DEFAULT_VALUE:10}}},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.getTokenMetadata=d.getRequestTypeAsString=d.extractAuthenticationHeaders=d.getTokenType=d.convertStringToTokenType=d.isRetryable=d.isTrouterAndNavigatorConnected=d.defer=d.decodeMessage=d.parseRawHttpMessage=d.isMessageEncodingSupported=d.isEncodedMessage=d.getMessageResultFromCache=d.cacheMessageResult=d.extractCauseIdFromMessage=d.isDuplicateMessage=d.getErrorForXHRFailure=d.tryParse=d.escapeRegExp=d.getHashTableCount=d.tryRemoveKeyFromHashTable=d.tryAddNewKeyToHashTable=d.arrayContains=d.stringEndsWith=d.stringContains=d.getMediaTypes=d.assertCallEndReason=d.assertNotNullArrayContent=d.assertNotNull=d.assertNotNullOrEmpty=d.assert=d.newGuid=d.newMessageId=d.causeId=d.stripMri=d.is1to1Mri=void 0;var g=u(8),f=u(93),m=u(14),v=u(5),y=u(76);function is1to1Mri(l){return!!l.match(/^8:/)}function stripMri(l){return l.replace(/^\\d+:/,\"\")}function causeId(){return newGuid().substr(0,8)}function newMessageId(l){return l&&/^[a-z0-9]{8}$/.test(l)?l+newGuid().substr(8):newGuid()}function newGuid(){for(var l=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\",d=\"0123456789abcdef\",u=\"\",p=0,h=0;h<36;){var g=l[h];switch(p=h%8==0?4294967295*Math.random()|0:p>>4,g){case\"x\":u+=d[15&p];break;case\"y\":u+=d[3&p|8];break;case\"4\":case\"-\":u+=g}h++}return u}function assert(l,d){if(!l)throw new Error(\"Assert failed\".concat(void 0!==d?\":\".concat(d):\"\"))}function assertNotNullOrEmpty(l,d){if(!l||l instanceof String&&\"\"===l||l instanceof Array&&0===l.length)throw new Error(\"AssertNotNullOrEmpty failed. \".concat(void 0!==d?\": \".concat(d):\"\"))}function assertNotNull(l,d){if(!l)throw new Error(\"AssertNotNull failed. \".concat(void 0!==d?\": \".concat(d):\"\"))}function assertNotNullArrayContent(l,d){if(0===l.length)throw new Error(\"assertNotNullArrayContent failed. \".concat(void 0!==d?\": \".concat(d):\"\"));l.forEach((function(l){if(!l)throw new Error(\"assertNotNullArrayContent failed. \".concat(void 0!==d?\"contains null value: \".concat(d):\"\"))}))}function assertCallEndReason(l){if(assertNotNullOrEmpty(l,\"callEndReason cannot be null or empty\"),void 0===l.code||void 0===l.subCode||void 0===l.phrase||l.code<0||l.subCode<0||\" \"===l.phrase)throw new Error(\"callEndReason must specify code, subCode and phrase. Invalid reason : \".concat((0,m.getPrintableObject)(l)))}function getMediaTypes(l){var d,u;assertNotNull(l,\"MediaTypes passed cannot be null\");var h=[],g=v.default.MEDIA_TYPES;try{for(var f=p(Object.keys(g)),m=f.next();!m.done;m=f.next()){var y=m.value;arrayContains(l,g[y])&&h.push(g[y])}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=f.return)&&u.call(f)}finally{if(d)throw d.error}}return h}function stringContains(l,d){return l.indexOf(d)>-1}function stringEndsWith(l,d){return l.length>=d.length&&l.indexOf(d,l.length-d.length)>-1}function arrayContains(l,d){var u=d.toString().toLowerCase();return l.map((function(l){return l.toString().toLowerCase()})).indexOf(u)>-1}function tryAddNewKeyToHashTable(l,d,u){return!l.hasOwnProperty(d)&&(l[d]=u,!0)}function tryRemoveKeyFromHashTable(l,d){return!!l.hasOwnProperty(d)&&(delete l[d],!0)}function getHashTableCount(l){return Object.keys(l).length}function escapeRegExp(l){return l.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\")}function tryParse(l){var d=null;try{return\"object\"==typeof(d=JSON.parse(l))?d:null}catch(l){return null}}function getErrorForXHRFailure(l,d){if(!l)return{telemetryEndSubCode:v.default.CALL_END_CODE.UNKNOWN_ERROR,error:v.default.CALL_END_UNKNOWN_ERROR};var u;if(\"object\"==typeof l.response)u=l.response;else try{u=JSON.parse(l.response)}catch(l){}if(l.skypeTokenError)return{telemetryEndSubCode:v.default.CALL_END_CODE.SKYPE_TOKEN_ERROR,error:v.default.CALL_END_SKYPE_TOKEN_ERROR};if(u&&(u.operationFailure||u.broadcastOperationFailure)){var p=u.operationFailure||u.broadcastOperationFailure;return{telemetryEndSubCode:p.code,error:p}}return u&&u.code?{telemetryEndSubCode:u.code,error:u}:isNaN(l.status)||l.status!==v.default.CALL_END_CODE.NOT_FOUND?isNaN(l.status)||(null==d?void 0:d.enableErrorCodeImprovementsForNetworkFailures)&&0===l.status&&isNaN(l.response)?{telemetryEndSubCode:v.default.CALL_END_CODE.NETWORK_ERROR,error:v.default.CALL_END_NETWORK_ERROR}:{telemetryEndSubCode:l.status,error:{code:l.status,subCode:isNaN(l.response)?0:l.response,phrase:l.statusText,resultCategories:[v.RESULT_CATEGORIES.UnexpectedClientError]}}:{telemetryEndSubCode:v.default.CALL_END_CODE.NOT_FOUND,error:v.default.RESOURCE_NOT_FOUND_ERROR}}function isDuplicateMessage(l,d){if(l&&d){var u=l[v.default.HEADERS.ORIGINAL_MESSAGE_ID]||null,p=l[v.default.HEADERS.MESSAGE_ID]||null;if(p&&arrayContains(d,p)||u&&arrayContains(d,u))return!0;d.length>9&&d.shift(),d.push(u||p)}return!1}function extractCauseIdFromMessage(l){try{return l.headers[v.default.HEADERS.ORIGINAL_MESSAGE_ID].replace(\"-\",\"\").substr(0,8)}catch(l){return causeId()}}function cacheMessageResult(l,d,u){if(l&&d){var p=l[v.default.HEADERS.ORIGINAL_MESSAGE_ID]||l[v.default.HEADERS.MESSAGE_ID]||null;p&&(d[p]=u)}}function getMessageResultFromCache(l,d){return l&&d[l[v.default.HEADERS.ORIGINAL_MESSAGE_ID]||l[v.default.HEADERS.MESSAGE_ID]||null]||null}function isEncodedMessage(l){return l&&l.hasOwnProperty(v.default.HEADERS.CONTENT_ENCODING)}function isMessageEncodingSupported(l){return l&&v.default.KNOWN_PAYLOAD_ENCODINGS.hasOwnProperty(l[v.default.HEADERS.CONTENT_ENCODING].toUpperCase())}function parseRawHttpMessage(l){var d,u,f=l.split(/\\r?\\n\\r?\\n/),m=f[0].split(/\\r?\\n/),v=f[1].split(/\\r?\\n/),y=m.shift().split(\" \"),S=y[0],_=y[1]||\"\",C={};try{for(var E=p(m),T=E.next();!T.done;T=E.next()){var b=T.value;try{var I=h(b.split(\":\").map((function(l){return g.trim(l)})),2),A=I[0],R=I[1];C[A]=R}catch(l){throw new Error(\"Malformed header: \".concat(b+l))}}}catch(l){d={error:l}}finally{try{T&&!T.done&&(u=E.return)&&u.call(E)}finally{if(d)throw d.error}}return{url:_,headers:C,method:S,body:v.join(\"\")}}function decodeMessage(l){var d=atob(l);return f.inflate(d,{to:\"string\"})}function defer(){var l,d,u=!0;return{isPending:function(){return u},promise:new Promise((function(u,p){l=u,d=p})),resolve:function(d){u&&(l(d),u=!1)},reject:function(l){u&&(d(l),u=!1)}}}function isTrouterAndNavigatorConnected(l){var d=!1;try{if(d=l&&l.state()===y.TrouterState.Connected,navigator.onLine&&d)return 3;if(!navigator.onLine&&d)return 2;if(navigator.onLine&&!d)return 1}catch(l){}return 0}function isRetryable(l){return[v.default.HTTP_STATUS_CODES.UNKNOWN,v.default.HTTP_STATUS_CODES.UNAUTHORIZED,v.default.HTTP_STATUS_CODES.NETWORK_ERROR,v.default.HTTP_STATUS_CODES.OFFLINE,v.default.HTTP_STATUS_CODES.TIMEOUT,v.default.HTTP_STATUS_CODES.INTERNAL_SERVER_ERROR,v.default.HTTP_STATUS_CODES.BAD_GATEWAY,v.default.HTTP_STATUS_CODES.SERVICE_UNAVAILABLE,v.default.HTTP_STATUS_CODES.GATEWAY_TIMEOUT].indexOf(l)>=0}function convertStringToTokenType(l){switch(l){case v.default.HEADERS.BEARER_KEYWORD.toLowerCase():return 4;case v.default.HEADERS.POP_KEYWORD.toLowerCase():return 2;default:return 1}}function getTokenType(l,d,u){var p=1;if(!l.enableCallingTokenAPI)return 1;if(!u){if(d)return 1;l.callingServiceSupportsAADTokens&&(p|=4)}return p}function extractAuthenticationHeaders(l){if(l&&l[v.default.HEADERS.AUTHENTICATE.toLowerCase()])return{authenticationHeaders:[l[v.default.HEADERS.AUTHENTICATE.toLowerCase()]]}}function getRequestTypeAsString(l){switch(l){case 0:return\"GET\";case 1:return\"POST\";case 2:return\"PUT\";case 3:return\"DELETE\"}throw Error(\"[getRequestTypeAsString]: should never reach here\")}function getTokenMetadata(l,d,u,p,h){void 0===p&&(p=!1);var g=\"{ verb: \".concat(getRequestTypeAsString(d),\", path: \").concat(u.url,\" }\"),f=h?extractAuthenticationHeaders(h):void 0;return{tokenType:getTokenType(l,p,f),factorsJson:g,requestMetadataJson:f}}d.is1to1Mri=is1to1Mri,d.stripMri=stripMri,d.causeId=causeId,d.newMessageId=newMessageId,d.newGuid=newGuid,d.assert=assert,d.assertNotNullOrEmpty=assertNotNullOrEmpty,d.assertNotNull=assertNotNull,d.assertNotNullArrayContent=assertNotNullArrayContent,d.assertCallEndReason=assertCallEndReason,d.getMediaTypes=getMediaTypes,d.stringContains=stringContains,d.stringEndsWith=stringEndsWith,d.arrayContains=arrayContains,d.tryAddNewKeyToHashTable=tryAddNewKeyToHashTable,d.tryRemoveKeyFromHashTable=tryRemoveKeyFromHashTable,d.getHashTableCount=getHashTableCount,d.escapeRegExp=escapeRegExp,d.tryParse=tryParse,d.getErrorForXHRFailure=getErrorForXHRFailure,d.isDuplicateMessage=isDuplicateMessage,d.extractCauseIdFromMessage=extractCauseIdFromMessage,d.cacheMessageResult=cacheMessageResult,d.getMessageResultFromCache=getMessageResultFromCache,d.isEncodedMessage=isEncodedMessage,d.isMessageEncodingSupported=isMessageEncodingSupported,d.parseRawHttpMessage=parseRawHttpMessage,d.decodeMessage=decodeMessage,d.defer=defer,d.isTrouterAndNavigatorConnected=isTrouterAndNavigatorConnected,d.isRetryable=isRetryable,d.convertStringToTokenType=convertStringToTokenType,d.getTokenType=getTokenType,d.extractAuthenticationHeaders=extractAuthenticationHeaders,d.getRequestTypeAsString=getRequestTypeAsString,d.getTokenMetadata=getTokenMetadata},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.PAYLOAD_PROPERTY=d.URL_PATH=d.REQUEST_DISPATCHER_RESPONSE=d.RESULT_CATEGORIES=void 0,d.RESULT_CATEGORIES={Success:\"Success\",ExpectedError:\"ExpectedError\",UnexpectedClientError:\"UnexpectedClientError\",UnexpectedServerError:\"UnexpectedServerError\"};var p={INCOMING_MESSAGE_ORIGIN:{TROUTER:\"Trouter\",BROKER:\"Broker\"},INVITATION_TYPE:{NUDGE:\"nudge\"},KNOWN_PAYLOAD_ENCODINGS:{GZIP:!0},WEBRTC_NOTIFICATION_TYPE:{CONTROL_VIDEO_STREAMING:\"ControlVideoStreaming\",DOMINANT_SPEAKER_INFO:\"DominantSpeakerInfo\",CSRC_INFO:\"CsrcInfo\"},PARTICIPANT_AUDIO_STATE:{CONNECTING:\"Connecting\",RINGING:\"Ringing\",CONNECTED:\"Connected\",OTHER:\"Other\"},HEADERS:{MESSAGE_ID:\"X-Microsoft-Skype-Message-ID\",ORIGINAL_MESSAGE_ID:\"X-Microsoft-Skype-Original-Message-ID\",CONTENT_ENCODING:\"X-Microsoft-Skype-Content-Encoding\",CORRELATION_ID:\"X-Microsoft-Skype-Chain-ID\",CONTENT_SHARING_CORRELATION_ID:\"X-Microsoft-Skype-ContentSharing-Chain-ID\",CLIENT_USER_AGENT:\"X-Microsoft-Skype-Client\",SKYPE_TOKEN:\"X-Skypetoken\",AUTHORIZATION:\"Authorization\",BEARER_KEYWORD:\"Bearer\",POP_KEYWORD:\"Pop\",CACHE_SKYPE_TOKEN:\"X-CacheSkypeToken\",AUTHENTICATE:\"WWW-Authenticate\",BROKER_USE_BATCHING_HEADER_NAME:\"X-UseBatching\",PARTICIPANT_ID:\"X-Microsoft-Skype-Participant-ID\",CONTENT_TYPE:\"Content-Type\",RING:\"MS-Teams-Ring\",REGION:\"MS-Teams-Region\",PARTITION:\"MS-Teams-Partition\"},KNOWN_BOTS:{VOICEMAIL_BOT_ID:\"28:14524421-25b4-403a-a0f7-e62d4379cabc\"},HTTP_STACK_ERROR:{NONE:0,CANNOT_CONNECT:7,REQUEST_TIMEOUT:10,ATTEMPT_TIMEOUT:30,REQUEST_ABORTED:16,ATTEMPT_ABORTED:31,ABORTED_OTHER_ATTEMPT_SUCCESSFUL:32},HTTP_STATUS_CODES:{UNKNOWN:0,OK:200,CREATED:201,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,FORBIDDEN:403,PRECONDITION_FAILED:412,UNPROCESSABLE_ENTITY:422,NETWORK_ERROR:490,SKYPE_TOKEN_ERROR:495,OFFLINE:496,TIMEOUT:498,ABORTED:498,OTHER:499,INTERNAL_SERVER_ERROR:500,CONFLICT:409,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504},CALL_END_SKYPE_TOKEN_ERROR:{code:495,subCode:4507,phrase:\"CallEndReasonSkypeTokenFetchError\",resultCategories:[d.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_LOCAL_HTTP_STACK_ERROR:{code:496,subCode:4520,phrase:\"LocalHTTPStackError\",resultCategories:[d.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_UNKNOWN_ERROR:{code:497,subCode:3121,phrase:\"CallEndReasonUnknownError\",resultCategories:[d.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_NETWORK_ERROR:{code:490,subCode:4502,phrase:\"CallEndReasonNetworkError\",resultCategories:[d.RESULT_CATEGORIES.UnexpectedClientError]},CALL_END_LOCAL_DECLINE:{code:486,subCode:4508,phrase:\"LocalDecline\",resultCategories:[d.RESULT_CATEGORIES.Success]},RESOURCE_NOT_FOUND_ERROR:{code:404,subCode:404,phrase:\"ResourceNotFound\",resultCategories:[d.RESULT_CATEGORIES.ExpectedError]},CALL_STATUS:{IDLE:\"Idle\",RINGING:\"Ringing\",CONNECTING:\"Connecting\",CONNECTED:\"Connected\",CONNECTED_FOR_ROSTER_ONLY:\"ConnectedForRosterOnly\",LOCAL_TERMINATED:\"LocalTerminated\",REMOTE_TERMINATED:\"RemoteTerminated\"},MEDIA_TYPES:{AUDIO:\"Audio\",VIDEO:\"Video\",SCREEN_SHARER:\"ScreenSharer\",SCREEN_VIEWER:\"ScreenViewer\"},MUTE_SCOPE:{MYSELF:\"Myself\",EVERYONE_ELSE:\"EveryoneElse\",SPECIFIED_PARTICIPANTS:\"SpecifiedParticipants\"},URL_BASE:{CALLAGENT:\"callAgent\"},LINKS:{HANGUP:\"hangup\",MEDIA_REJECTION:\"mediaRejection\",MEDIA_ANSWER:\"mediaAnswer\",MEDIA_RENEGOTIATION:\"mediaRenegotiation\",ACCEPT:\"accept\",ATTACH:\"attach\",REJECT:\"reject\",REDIRECT:\"redirect\",REPLACE:\"replace\",TRANSFER:\"transfer\",NEW_OFFER:\"newOffer\",TRANSFER_ACCEPTANCE:\"transferAcceptance\",TRANSFER_COMPLETION:\"transferCompletion\",CONVERSATION_CONTROLLER:\"conversationController\",ADD_PARTICIPANT:\"addParticipant\",ADD_PARTICIPANTS_AND_MODALITY:\"addParticipantsAndModality\",LEAVE:\"leave\",NOTIFICATION_LINKS:\"notificationLinks\",REMOVE_PARTICIPANT:\"removeParticipant\",KEEPALIVE:\"keepAlive\",ADD_MODALITY:\"AddModality\",REMOVE_MODALITY:\"RemoveModality\",CONTENT_SHARING_CONTROLLER:\"contentSharingController\",CONTENT_SHARING_TAKE_CONTROL:\"contentSharingTakeControl\",CONTENT_SHARING_UPDATE_SESSION_STATE:\"contentSharingUpdateSessionState\",CONTENT_SHARING_UPDATE_PARTICIPANT_STATE:\"contentSharingUpdateParticipantState\",CONTENT_SHARING_NOTIFICATION_LINKS:\"contentSharingNotificationLinks\",CONTENT_SHARING_LEAVE:\"contentSharingLeave\",MUTE:\"mute\",UNMUTE:\"unmute\",ADMIT:\"admit\",ADMIT_ALL:\"admitAll\",CONTROL_VIDEO_STREAMING:\"controlVideoStreaming\",APPLY_CHANNEL_PARAMETERS:\"applyChannelParameters\",UPDATE_ENDPOINT_STATE:\"updateEndpointState\",UPDATE_ENDPOINT_METADATA:\"updateEndpointMetadata\",LMC_NOTIFICATION_LINKS:\"lmcNotificationLinks\",UPDATE_PARTICIPANT_ROLE:\"updateParticipantRole\",PUBLISH_STATE:\"publishState\",REMOVE_STATE:\"removeState\",UPDATE_MEETING_SETTINGS:\"updateMeetingSettings\",SEARCH_PARTICIPANTS:\"searchParticipants\",GET_ALL_PARTICIPANTS:\"getAllParticipants\",PARK:\"park\",UNPARK:\"unpark\",UPDATE_MEETING_LIVE_STATE:\"updateMeetingLiveState\",UPDATE_MEETING_GROUPS:\"updateMeetingGroups\",SET_MEETING_LAYOUT:\"setMeetingLayout\",UPDATE_PARTICIPANT_INTERPRETATION_STATE:\"updateParticipantInterpretationState\",JOIN_MEETING_GROUP:\"joinMeetingGroup\",LEAVE_MEETING_GROUP:\"leaveMeetingGroup\"},CONTENT_TYPE:{JSON:\"application/json\",SDP:\"application/sdp\"},TROUTER_EVENT_TYPE:{SKYPE_SKYPE_CALL:107,LYNC_SKYPE_CALL:105},MISC:{CONVERSATION:\"conversation\",LOBBY_CALL_CONTROLLER:\"lobby\",LOBBY_PARTICIPANT_STATE:\"lobby\"},SIGNALING_FSM_STATE:{IDLE:\"Idle\",INCOMING:\"Incoming\",WAITING_CALL_ACCEPTANCE_ACK:\"WaitingCallAcceptanceAck\",OUTGOING:\"Outgoing\",CONNECTED:\"Connected\",OUTGOING_FOR_ROSTER_ONLY:\"OutgoingForRosterOnly\",CONNECTED_FOR_ROSTER_ONLY:\"ConnectedForRosterOnly\"},MEDIA_RENEGOTIATION_FSM_STATE:{IDLE:\"Idle\",CALL_CONNECTED:\"Connected\",INCOMING_RENEGOTIATION:\"IncomingRenegotiation\",OUTGOING_RENEGOTIATION:\"OutgoingRenegotiation\",RENEGOTIATION_GLARE:\"RenegotiationGlare\"},CONTENT_SHARING_FSM_STATE:{IDLE:\"Idle\",CONTENT_SHARING_START_INITIATED:\"ContentSharingStartInitiated\",CONTENT_SHARING_JOIN_INITIATED:\"ContentSharingJoinInitiated\",CONTENT_SHARING_LEAVE_INITIATED:\"ContentSharingLeaveInitiated\",CONTENT_SHARING_DELETE_INITIATED:\"ContentSharingDeleteInitiated\",CONTENT_SHARING_CONNECTED:\"ContentSharingConnected\"},TIMEOUT_OPERATIONS:{ADD_PARTICIPANT:\"AddParticipant\",NUDGE_PARTICIPANT:\"NudgeParticipant\",REMOVE_PARTICIPANT:\"RemoveParticipant\",ADMIT_PARTICIPANT:\"AdmitParticipant\",ADMIT:\"Admit\",CALL_REDIRECT:\"CallRedirect\",CALL_ME_BACK:\"CallMeBack\",INCOMING_CALL_ESTABLISHMENT:\"IncomingCallEstablishment\",OUTGOING_CALL_ESTABLISHMENT:\"OutgoingCallEstablishment\",MEDIA_ANSWER:\"MediaAnswer\",MEDIA_ANSWER_ACKNOWLEDGEMENT:\"MediaAnswerAcknowledgement\",ADD_MODALITY:\"AddModality\",UNMUTE:\"Unmute\",UPDATE_MEETING_ROLE:\"UpdateMeetingRole\",MAX_PREAHEATED_TIMEOUT:\"MaxPreheateadTimeout\",PARK_COMPLETION:\"ParkCompletion\",UNPARK_COMPLETION:\"UnparkCompletion\",UPDATE_MEETING_LIVE_STATE_COMPLETION:\"UpdateMeetingLiveStateCompletion\",UPDATE_MEETING_GROUPS_COMPLETION:\"UpgradeMeetingGroupsCompletion\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION:\"UpdateParticipantInterpretationStateCompletion\",JOIN_MEETING_GROUP_COMPLETION:\"JoinMeetingGroupCompletion\",LEAVE_MEETING_GROUP_COMPLETION:\"LeaveMeetingGroupCompletion\",SET_MEETING_LAYOUT_COMPLETION:\"SetMeetingLayoutCompletion\"},TIMEOUT_VALUES_IN_SECONDS:{ADD_PARTICIPANT_TIMEOUT:130,REMOVE_PARTICIPANT_TIMEOUT:60,INCOMING_CALL_ESTABLISHMENT_TIMEOUT:75,OUTGOING_CALL_ESTABLISHMENT_TIMEOUT:90,MEDIA_ANSWER_TIMEOUT:35,MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT:15,ADD_MODALITY_TIMEOUT:65,UNMUTE_TIMEOUT:35,ADMIT_PARTICIPANT_TIMEOUT:30,ADMIT_TIMEOUT:60,UPDATE_MEETING_ROLE_TIMEOUT:15,NUDGE_PARTICIPANT_TIMEOUT:60,CALL_ME_BACK_TIMEOUT:120,MAX_PREAHEATED_TIMEOUT:60,PARK_COMPLETION_TIMEOUT:45,UNPARK_COMPLETION_TIMEOUT:45,UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:45,UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:45,SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:45,UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION_TIMEOUT:45,JOIN_MEETING_GROUP_COMPLETION_TIMEOUT:45,LEAVE_MEETING_GROUP_COMPLETION_TIMEOUT:45,CONVERSATION_KEEP_ALIVE_TIMEOUT:2700},CALL_END_CODE:{REJECT:603,SUCCESS:0,CALL_REDIRECTED:302,CANCEL:487,TIMEOUT:408,SERVICE_UNAVAILABLE:500,BAD_REQUEST:406,NO_NGC_ENDPOINT:480,P2P_FALLBACK_FOR_SCREENSHARING:460,CONFLICT:409,MEDIA_ERROR:410,CONF_PARTICIPANT_COUNT_LIMIT_REACHED:413,CALL_DOES_NOT_EXIST:481,CALL_ACCEPTED:450,CALL_FORWARDED:451,CALL_FORWARDED_TO_VOICEMAIL:452,P2P_REJECT_CALL:453,P2P_FALLBACK_DUE_TO_GROUPCALL:461,CALL_LEG_ENDED_ON_SERVICE:470,NOT_ACCEPTABLE_HERE:488,NETWORK_ERROR:490,UNKNOWN_ERROR:497,LOCAL_ERROR:498,CALL_MODALITY_FAILURE:580,ATC_CONTROLLER_FAILURE:581,CVA_CONTROLLER_FAILURE:586,GLARE_ERROR:491,NOT_FOUND:404,SKYPE_TOKEN_ERROR:495,LOCAL_HTTP_STACK_ERROR:496,HTTP_OTHER_ERROR:499,DECODING_FAILED:407,NOT_AUTHORIZED:403,BAD_SERVICE_RESPONSE:400},CALL_END_SUB_CODE:{SUCCESS:0,CALL_REDIRECTED_SUCCESS:3020,DOWNGRADE_TO_STREAMING_CLIENT:3099,MEDIA_DROP_DURING_CONNECT:3100,MEDIA_DROP_AFTER_CONNECT:3101,MEDIA_ANSWER_PROCESSING_ERROR:3102,MEDIA_FINAL_ANSWER_PROCESSING_ERROR:3103,MEDIA_OFFER_TIMEOUT:3104,MEDIA_FINAL_ANSWER_TIMEOUT:3105,MEDIA_OFFER_NULL:3106,MEDIA_AUDIO_DEVICE_ERROR:3107,MEDIA_RENEGOTIATION_ERROR:3108,MEDIA_PERMISSION_ERROR:3109,MEDIA_UNKNOWN_ERROR:3110,MEDIA_OFFER_PROCESSING_ERROR:3111,MEDIA_WHITELISTING_ISSUE:3112,MEDIA_MUTE_MICROPHONE_ERROR:3114,MEDIA_MUTE_SPEAKER_ERROR:3115,MEDIA_UNMUTE_MICROPHONE_ERROR:3116,MEDIA_UNMUTE_SPEAKER_ERROR:3117,MEDIA_GLARE_ERROR:3118,CONVERSATION_TERMINATION_UNKNOWN_ERROR:3121,CALL_NOT_ATTEMPTED:4500,CONV_URL_NOT_SET:4501,FAILED_TO_REACH_SERVICE:4502,PLACE_CALL_FAILED:4503,ATTACH_CALL_FAILED:4504,BAD_NOTIFICATION_PAYLOAD:4505,CALL_ESTABLISHMENT_TIMEOUT:4506,SKYPE_TOKEN_ERROR:4507,CONVERSATION_RESOLUTION_CONFLICT:5704,CALL_PARTICIPANT_REMOVAL_TIMEOUT:4507,UNMUTE_REQUEST_TIMEOUT:4509,UNMUTE_REQUEST_REJECTED:4510,CONFLICT_IN_NG:4090,CONFLICT_WITH_P2P:4091,CONVERSATION_END_RECEIVED_FROM_SERVICE:4100,TRANSFER_COMPLETE_TIMEOUT:4101,ATTACH_TO_NON_EXISTENT_CALL:4102,ATTACH_ACTION_FAILED:4103,ATTACH_FAILED:4105,CONVERSATION_ESTABLISHMENT_FAILED:4106,BEFORE_CONNECT:4107,AFTER_CONNECT:4108,AFTER_ACCEPT:4109,TROUTER_CONNECTION_DROPPED:4111,DUE_TO_CALL_ASSIMILATION:4112,PREHEATED_CALL_TIMEDOUT:4113,UNPARK_COMPLETION_TIMEOUT:4114,PARK_COMPLETION_TIMEOUT:4115,UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:4116,UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:4117,SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:4118,UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:4119,JOIN_MEETING_GROUP_TIMEOUT:4120,LEAVE_MEETING_GROUP_TIMEOUT:4121,LOCAL_HTTP_STACK_ERROR:4520,BEACON:4521,CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:5014,UNABLE_TO_GENERATE_MEETUP_ID:5015,UPDATE_MEETING_ROLE_REJECTED:5651,UPDATE_MEETING_ROLE_TIMEOUT:5652,PUBLISH_STATE_LINK_MISSING:5653,PUBLISH_STATE_INVALID_CONTENT:5654,PUBLISH_STATE_INVALID_SERVICE_RESPONSE:5655,REMOVE_STATE_LINK_MISSING:5656,REMOVE_STATE_MISSING_ARGUMENTS:5657,UPDATE_MEETING_SETTINGS_LINK_MISSING:5658,UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS:5659,ADMIT_ALL_LINK_MISSING:5660,ADMIT_TIMEOUT:5661,CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE:5670,ROSTER_HANDLING_INVALID_SERVICE_RESPONSE:5671,SEARCH_PARTICIPANTS_LINK_MISSING:5672,SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5673,GET_ALL_PARTICIPANTS_LINK_MISSING:5674,GET_ALL_PARTICIPANTS_INVALID_SCOPE:5675,GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE:5676,PARK_UNPARK_TYPE_MISSING:5680,PARK_UNPARK_V2_DISABLED:5682,CALL_ENDED_BY_PLATFORM_AGENT:7e3},CALL_END_PHRASE:{UNKNOWN:\"CallEndReasonUnknown\",MEDIA_ERROR:\"CallEndReasonMediaError\",MEDIA_OFFER_TIMEOUT:\"CallEndReasonMediaOfferTimeout\",MEDIA_FINAL_ANSWER_TIMEOUT:\"CallEndReasonMediaFinalAnswerTimeout\",MEDIA_ANSWER_ERROR:\"CallEndReasonMediaAnswerError\",MEDIA_FINAL_ANSWER_ERROR:\"CallEndReasonFinalAnswerError\",MEDIA_PERMISSION_ERROR:\"CallEndReasonMediaPermissionError\",MEDIA_RENEGOTIATION_ERROR:\"CallEndReasonRenegotiationError\",MEDIA_DROP_DURING_CONNECT:\"CallEndReasonMediaDropDuringConnectError\",MEDIA_DROP_AFTER_CONNECT:\"CallEndReasonMediaDropAfterConnectError\",MEDIA_OFFER_PROCESSING_ERROR:\"CallEndReasonMediaOfferProcessingError\",MEDIA_WHITELISTING_ISSUE:\"MediaWhitelistingIssue\",AUDIO_ERROR:\"CallEndReasonAudioDeviceError\",BAD_NOTIFICATION_PAYLOAD:\"BadCallNotificationPayload\",NETWORK_ERROR:\"CallEndReasonNetworkError\",LOCAL_USER_INITIATED:\"CallEndReasonLocalUserInitiated\",REMOTE_USER_INITIATED:\"CallEndReasonRemoteUserInitiated\",ESTABLISHMENT_TIMEOUT:\"CallEndReasonEstablishmentTimeout\",PARTICIPANT_REMOVAL_TIMEOUT:\"CallParticipantRemovalTimeout\",LOCAL_ERROR:\"CallEndReasonLocalError\",CALL_UPDATE_ERROR:\"CallEndReasonCallUpdateError\",CALL_REDIRECT_IS_NOT_ALLOWED:\"CallRedirectisNotAllowed\",P2P_FORK_CONNECTED:\"CallEndReasonP2pForkConnected\",P2P_FORK_FORWARDED:\"CallEndReasonP2pForkForwarded\",P2P_FORK_FORWARDED_TO_VOICEMAIL:\"CallEndReasonP2pForkForwardedToVoiceMail\",P2P_FALLBACK_FOR_SCREENSHARING:\"CallEndReasonP2pFallbackForScreensharing\",P2P_FALLBACK_FOR_GROUPCALL:\"CallEndReasonP2pFallbackForGroupCall\",P2P_FALLBACK_FOR_CALL_ASSIMILATION:\"CallEndReasonP2pFallbackForCallAssimilation\",P2P_FALLBACK_FOR_TRANSLATION:\"CallEndReasonP2pFallbackForCallTranslation\",P2P_FORK_REJECTED:\"CallEndReasonP2pForkRejected\",TROUTER_CONNECTION_DROPPED:\"CallEndReasonTrouterConnectionDropped\",REMOVED_FROM_CALL:\"CallEndReasonRemovedFromCall\",TRANSFER_COMPLETION_TIMEOUT:\"CallEndReasonTransferCompletionTimeout\",CALL_DOES_NOT_EXIST:\"CallEndReasonCallDoesNotExist\",ATTACH_ACTION_FAILED:\"CallEndReasonAttachActionFailed\",ATTACH_FAILED:\"CallEndReasonAttachFailed\",CONVERSATION_ESTABLISHMENT_FAILED:\"CallEndReasonConversationEstablishmentFailed\",CONV_END_FROM_SERVICE:\"CallEndReasonConversationEndReceivedFromService\",CONV_END_FROM_SERVICE_WITH_ERROR:\"CallEndReasonConversationEndReceivedFromServiceWithError\",SERVICE_ERROR:\"CallEndReasonServiceError\",CONFLICT:\"CallEndReasonConflict\",CALL_ALREADY_IN_P2P:\"CallEndReasonCallAlreadyExistsInP2p\",CONV_END_NO_MODALITY:\"ConversationEndNoModalityConnected\",CONV_END_FOR_ALL_INITIATED:\"ConversationEndForAllInitiated\",RENEGOTIATION_IN_PROGRESS:\"NegotiationIsInProgress\",ADD_PARTICIPANT_URL_MISSING:\"AddParticipantUrlMissing\",ADMIT_PARTICIPANT_URL_MISSING:\"AdmitParticipantUrlMissing\",ADMIT_ALL_URL_MISSING:\"AdmitAllUrlMissing\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_URL_MISSING:\"UpdateParticipantInterpretationStateUrlMissing\",ADMIT_TIMEOUT:\"AdmitTimeout\",UNABLE_TO_GENERATE_MEETUP_ID:\"Unable to generate GroupChat meetup id.\",ENDED_BY_PMA:\"Call ended by media agent.\",OWNERSHIP_RESOLUTION_CONFLICT:\"Conversation cannot be created due to a failure to resolve ownership.\",CONVERSATION_ENDED_NO_NEW_OWNER_FOUND:\"This conversation has ended since we were unable to determine a potential host for the group call.\",UNMUTE_REQUEST_TIMEOUT:\"UnmuteRequestTimeout\",UNMUTE_REQUEST_REJECTED:\"UnmuteRequestRejected\",UPDATE_MEETING_ROLE_TIMEOUT:\"UpdateMeetingRoleTimeout\",UPDATE_MEETING_ROLE_REJECTED:\"Update meeting role operation failed due to insufficient privileges.\",PARK_REQUEST_FAILED:\"Park Request Failed\",PARK_COMPLETION_TIMEOUT:\"ParkCompletionTimeout\",PARK_COMPLETION_FAILED:\"ParkCompletionFailed\",UNPARK_REQUEST_FAILED:\"UnparkFailed\",UNPARK_COMPLETION_TIMEOUT:\"UnparkCompletionTimeout\",UNPARK_COMPLETION_FAILED:\"UnparkCompletionFailed\",BAD_SERVICE_RESPONSE:\"BadServiceResponse\",UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT:\"UpdateMeetingLiveStateCompletionTimeout\",UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT:\"UpdateMeetingGroupsCompletionTimeout\",SET_MEETING_LAYOUT_COMPLETION_TIMEOUT:\"SetMeetingLayoutCompletionTimeout\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:\"UpdateParticipantInterpretationTimeout\",JOIN_MEETING_GROUP_TIMEOUT:\"JoinMeetingGroupTimeout\",LEAVE_MEETING_GROUP_TIMEOUT:\"LeaveMeetingGroupTimeout\",DOWNGRADE_TO_STREAMING_CLIENT:\"DowngradeToStreamingClient\"},TRANSACTION_END_CODE:{SUCCESS:0},URL_DEFAULTS:{UPLOAD_LOG_URL:\"https://api.cc.skype.com/cc/v1/uploadlog/\"},SUCCESS_TRANSACTION_END:{code:0,resultCategories:[d.RESULT_CATEGORIES.Success]}};d.REQUEST_DISPATCHER_RESPONSE={REQUEST_TIMEOUT:{status:p.HTTP_STATUS_CODES.TIMEOUT,statusText:\"Request timed out\",readyState:0,response:p.HTTP_STACK_ERROR.REQUEST_TIMEOUT},ATTEMPT_TIMEOUT:{status:p.HTTP_STATUS_CODES.TIMEOUT,statusText:\"Attempt timed out\",readyState:0,response:p.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT},REQUEST_ABORTED:{status:p.HTTP_STATUS_CODES.ABORTED,statusText:\"Request Aborted\",readyState:0,response:p.HTTP_STACK_ERROR.REQUEST_ABORTED},ATTEMPT_ABORTED:{status:p.HTTP_STATUS_CODES.ABORTED,statusText:\"Attempt Aborted\",readyState:0,response:p.HTTP_STACK_ERROR.ATTEMPT_ABORTED}},d.URL_PATH={MEDIA_ACKNOWLEDGEMENT:\"/call/mediaAcknowledgement/\",MEDIA_REJECTION:\"/call/rejection/\",ACKNOWLEDGEMENT:\"/call/acknowledgement/\",MEDIA_RENEGOTIATION:\"/call/mediaRenegotiation/\",REPLACE:\"/call/replacement/\",PROGRESS:\"/call/progress/\",MEDIA_ANSWER:\"/call/mediaAnswer/\",NEW_MEDIA_OFFER:\"/call/newMediaOffer/\",REDIRECTION:\"/call/redirection/\",BALANCE_UPDATE:\"/call/balanceUpdate/\",ACCEPT:\"/call/acceptance/\",CONTROL_VIDEO_STREAMING:\"/call/controlVideoStreaming/\",DOMINANT_SPEAKER_INFO:\"/call/dominantSpeakerInfo/\",CSRC_INFO:\"/call/csrcInfo/\",END:\"/call/end/\",RETARGET_COMPLETION:\"/call/retargetCompletion/\",TRANSFER:\"/call/transfer/\",TRANSFER_ACCEPTANCE:\"/call/transferAcceptance/\",TRANSFER_COMPLETION:\"/call/transferCompletion/\",PARK_COMPLETION:\"/call/holdCompletion/\",UNPARK_COMPLETION:\"/call/resumeCompletion/\",CONV_END:\"/conversation/end/\",CONV_UPDATE:\"/conversation/update/\",CONV_LOCAL_PARTICIPANT_UPDATE:\"/conversation/localParticipantUpdate/\",CONV_ROSTER_UPDATE:\"/conversation/rosterUpdate/\",CONV_ADD_PARTICIPANT_SUCCESS:\"/conversation/addParticipantSuccess/\",CONV_ADD_PARTICIPANT_FAILURE:\"/conversation/addParticipantFailure/\",CONV_NUDGE_PARTICIPANT_SUCCESS:\"/conversation/nudgeParticipantSuccess/\",CONV_NUDGE_PARTICIPANT_FAILURE:\"/conversation/nudgeParticipantFailure/\",CONV_ADMIT_PARTICIPANT_SUCCESS:\"/conversation/admitParticipantSuccess/\",CONV_ADMIT_PARTICIPANT_FAILURE:\"/conversation/admitParticipantFailure/\",CONV_ADMIT_ALL_STATUS:\"/conversation/admitAllStatus/\",CONV_REMOVE_PARTICIPANT_SUCCESS:\"/conversation/removeParticipantSuccess/\",CONV_REMOVE_PARTICIPANT_FAILURE:\"/conversation/removeParticipantFailure/\",CONV_ADD_MODALITY_SUCCESS:\"/conversation/addModalitySuccess/\",CONV_ADD_MODALITY_FAILURE:\"/conversation/addModalityFailure/\",CONV_CONTENT_SHARING_UPDATE:\"/conversation/contentSharingUpdate/\",CONV_CONTENT_SHARING_END:\"/conversation/contentSharingEnd/\",CONV_BROADCAST_UPDATE:\"/conversation/broadcastUpdate/\",CONV_CONFIRM_UNMUTE:\"/conversation/confirmUnmute/\",CONV_UNMUTE_SUCCESS:\"/conversation/unmuteSuccess/\",CONV_UNMUTE_FAILURE:\"/conversation/unmuteFailure/\",LWJ_END:\"/lwj/end/\",LWJ_ACCEPTANCE:\"/lwj/acceptance/\",UPDATE_MEETING_LIVE_STATE_STATUS:\"/conversation/updateMeetingLiveStateStatus/\",UPDATE_MEETING_GROUPS_STATUS:\"/conversation/updateMeetingGroupsStatus/\",SET_MEETING_LAYOUT_STATUS:\"/conversation/setMeetingLayoutStatus/\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS:\"/conversation/updateParticipantInterpretationStateStatus/\",JOIN_MEETING_GROUP_STATUS:\"/conversation/joinMeetingGroupStatus/\",LEAVE_MEETING_GROUP_STATUS:\"/conversation/leaveMeetingGroupStatus/\"},d.PAYLOAD_PROPERTY={CALL_NOTIFICATION:\"callNotification\",MEDIA_ANSWER:\"mediaAnswer\",MEDIA_ACKNOWLEDGEMENT:\"mediaAcknowledgement\",CALL_ACCEPTANCE:\"callAcceptance\",CALL_END:\"callEnd\",CALL_PROGRESS:\"callProgress\",CALL_ACCEPTANCE_ACKNOWLEDGEMENT:\"callAcceptanceAcknowledgement\",MEDIA_NEGOTIATION:\"mediaNegotiation\",MEDIA_NEGOTIATION_FAILURE:\"mediaNegotiationFailure\",BALANCE_UPDATE:\"balanceUpdate\",RETARGET_COMPLETED:\"retargetCompleted\",CALL_TRANSFER:\"callTransfer\",TRANSFER_COMPLETION:\"transferCompletion\",TRANSFER_ACCEPTANCE:\"transferAcceptance\",PARK_COMPLETION:\"holdCompletion\",UNPARK_COMPLETION:\"resumeCompletion\",UPDATE_MEETING_LIVE_STATE_RESPONSE:\"updateMeetingLiveStateResponse\",UPDATE_MEETING_GROUPS_RESPONSE:\"updateMeetingGroupsResponse\",SET_MEETING_LAYOUT_RESPONSE:\"setMeetingLayoutResponse\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE:\"updateParticipantInterpretationStateResponse\",JOIN_MEETING_GROUP_RESPONSE:\"joinMeetingGroupResponse\",LEAVE_MEETING_GROUP_RESPONSE:\"leaveMeetingGroupResponse\"},d.default=p},function(l,d,u){\r\n/*!\r\n\t * Microsoft Dynamic Proto Utility, 1.1.4\r\n\t * Copyright (c) Microsoft and contributors. All rights reserved.\r\n\t */\r\nvar p=\"constructor\",h=\"prototype\",g=\"function\",f=\"_dynInstFuncs\",m=\"_isDynProxy\",v=\"_dynClass\",y=\"_dynCls$\",S=\"_dynInstChk\",_=S,C=\"_dfOpts\",E=\"_unknown_\",T=\"__proto__\",b=\"useBaseInst\",I=\"setInstFuncs\",A=Object,R=A.getPrototypeOf,P=0;function _hasOwnProperty(l,d){return l&&A[h].hasOwnProperty.call(l,d)}function _isObjectOrArrayPrototype(l){return l&&(l===A[h]||l===Array[h])}function _isObjectArrayOrFunctionPrototype(l){return _isObjectOrArrayPrototype(l)||l===Function[h]}function _getObjProto(l){if(l){if(R)return R(l);var d=l[T]||l[h]||(l[p]?l[p][h]:null);if(d)return d}return null}function _forEachProp(l,d){var u=[],p=A.getOwnPropertyNames;if(p)u=p(l);else for(var h in l)\"string\"==typeof h&&_hasOwnProperty(l,h)&&u.push(h);if(u&&u.length>0)for(var g=0;g<u.length;g++)d(u[g])}function _isDynamicCandidate(l,d,u){return d!==p&&typeof l[d]===g&&(u||_hasOwnProperty(l,d))}function _throwTypeError(l){throw new TypeError(\"DynamicProto: \"+l)}function _getInstanceFuncs(l){var d={};return _forEachProp(l,(function(u){!d[u]&&_isDynamicCandidate(l,u,!1)&&(d[u]=l[u])})),d}function _hasVisited(l,d){for(var u=l.length-1;u>=0;u--)if(l[u]===d)return!0;return!1}function _getBaseFuncs(l,d,u,p){function _instFuncProxy(l,d,u){var h=d[u];if(h[m]&&p){var g=l[f]||{};!1!==g[_]&&(h=(g[d[v]]||{})[u]||h)}return function(){return h.apply(l,arguments)}}var h={};_forEachProp(u,(function(l){h[l]=_instFuncProxy(d,u,l)}));for(var g=_getObjProto(l),y=[];g&&!_isObjectArrayOrFunctionPrototype(g)&&!_hasVisited(y,g);)_forEachProp(g,(function(l){!h[l]&&_isDynamicCandidate(g,l,!R)&&(h[l]=_instFuncProxy(d,g,l))})),y.push(g),g=_getObjProto(g);return h}function _getInstFunc(l,d,u,p){var h=null;if(l&&_hasOwnProperty(u,v)){var m=l[f]||{};if((h=(m[u[v]]||{})[d])||_throwTypeError(\"Missing [\"+d+\"] \"+g),!h[S]&&!1!==m[_]){for(var y=!_hasOwnProperty(l,d),C=_getObjProto(l),E=[];y&&C&&!_isObjectArrayOrFunctionPrototype(C)&&!_hasVisited(E,C);){var T=C[d];if(T){y=T===p;break}E.push(C),C=_getObjProto(C)}try{y&&(l[d]=h),h[S]=1}catch(l){m[_]=!1}}}return h}function _getProtoFunc(l,d,u){var p=d[l];return p===u&&(p=_getObjProto(d)[l]),typeof p!==g&&_throwTypeError(\"[\"+l+\"] is not a \"+g),p}function _populatePrototype(l,d,u,p,h){function _createDynamicPrototype(l,d){var dynProtoProxy=function(){return(_getInstFunc(this,d,l,dynProtoProxy)||_getProtoFunc(d,l,dynProtoProxy)).apply(this,arguments)};return dynProtoProxy[m]=1,dynProtoProxy}if(!_isObjectOrArrayPrototype(l)){var g=u[f]=u[f]||{},v=g[d]=g[d]||{};!1!==g[_]&&(g[_]=!!h),_forEachProp(u,(function(d){_isDynamicCandidate(u,d,!1)&&u[d]!==p[d]&&(v[d]=u[d],delete u[d],(!_hasOwnProperty(l,d)||l[d]&&!l[d][m])&&(l[d]=_createDynamicPrototype(l,d)))}))}}function _checkPrototype(l,d){if(R)for(var u=[],p=_getObjProto(d);p&&!_isObjectArrayOrFunctionPrototype(p)&&!_hasVisited(u,p);){if(p===l)return!0;u.push(p),p=_getObjProto(p)}return!1}function _getObjName(l,d){return _hasOwnProperty(l,h)?l.name||d||E:((l||{})[p]||{}).name||d||E}function dynamicProto(l,d,u,p){_hasOwnProperty(l,h)||_throwTypeError(\"theClass is an invalid class definition.\");var g=l[h];_checkPrototype(g,d)||_throwTypeError(\"[\"+_getObjName(l)+\"] is not in class hierarchy of [\"+_getObjName(d)+\"]\");var f=null;_hasOwnProperty(g,v)?f=g[v]:(f=y+_getObjName(l,\"_\")+\"$\"+P,P++,g[v]=f);var m=dynamicProto[C],S=!!m[b];S&&p&&void 0!==p[b]&&(S=!!p[b]);var _=_getInstanceFuncs(d);u(d,_getBaseFuncs(g,d,_,S));var E=!!R&&!!m[I];E&&p&&(E=!!p[I]),_populatePrototype(g,f,d,_,!1!==E)}var O={setInstFuncs:!0,useBaseInst:!0};dynamicProto[C]=O,d.a=dynamicProto},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(18);d.default=p.default},function(d,u){d.exports=l},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},g=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.printMediaStream=d.allowProvisionalAnswer=d.convertToCodecInfo=d.getSimulcastConfigForMediaType=d.isVersionGreaterOrEqual=d.getAllowedCodecs=d.allowDataChannel=d.canUseWebrtc1_0=d.preferSdesSrtp=d.scrubConstraints=d.scrubDevices=d.scrubSelectedDevices=d.scrubObjectExcludingFields=d.scrubObjectFields=d.sendStreamsToModalities=d.mediaTypeToModality=d.modalityToMediaType=d.mergeSendModalities=d.getSendMediaModalities=d.isSendModalityAdded=d.parseCandidateString=d.removeChangedSendDirection=d.excludePassiveModalities=d.getSrtpInfo=d.areSendDirectionsFulfilled=d.areNegotiatedDirectionsFulfilled=d.areNegotiatedDirectionsAcceptable=d.negotiateModalities=d.isOnHold=d.addReceiveDirectionality=d.hasReceiveDirectionality=d.hasSendDirectionality=d.removeSendDirectionality=d.invertModalities=d.negotiateDirectionality=void 0;var f=u(17),m=u(1),v=u(3),y=u(27);function invertDirectionality(l){switch(l){case v.default.MEDIA_STATE.send:return v.default.MEDIA_STATE.receive;case v.default.MEDIA_STATE.receive:return v.default.MEDIA_STATE.send;default:return l}}function negotiateDirectionality(l,d){var u=hasSendDirectionality(l)&&hasSendDirectionality(d),p=hasReceiveDirectionality(l)&&hasReceiveDirectionality(d);return u&&p?v.default.MEDIA_STATE.sendReceive:u?v.default.MEDIA_STATE.send:p?v.default.MEDIA_STATE.receive:l===v.default.MEDIA_STATE.inactive&&d||l&&d===v.default.MEDIA_STATE.inactive?v.default.MEDIA_STATE.inactive:void 0}function invertModalities(l){var d={},u=invertDirectionality(l.audio);u&&(d.audio=u);var p=invertDirectionality(l.video);p&&(d.video=p);var h=invertDirectionality(l.sharing);h&&(d.sharing=h);var g=invertDirectionality(l.data);return g&&(d.data=g),d}function removeSendDirectionality(l){return l===v.default.MEDIA_STATE.sendReceive?v.default.MEDIA_STATE.receive:void 0}function hasSendDirectionality(l){return l===v.default.MEDIA_STATE.send||l===v.default.MEDIA_STATE.sendReceive}function hasReceiveDirectionality(l){return l===v.default.MEDIA_STATE.receive||l===v.default.MEDIA_STATE.sendReceive}function addReceiveDirectionality(l){return hasReceiveDirectionality(l)?l:l===v.default.MEDIA_STATE.send?v.default.MEDIA_STATE.sendReceive:v.default.MEDIA_STATE.receive}function isOnHold(l){return!(l.audio!==v.default.MEDIA_STATE.inactive||l.video&&l.video!==v.default.MEDIA_STATE.inactive||l.sharing&&l.sharing!==v.default.MEDIA_STATE.inactive)}function negotiateModalities(l,d){var u={},p=negotiateDirectionality(l.audio,d.audio);p&&(u.audio=p);var h=negotiateDirectionality(l.video,d.video);h&&(u.video=h);var g=negotiateDirectionality(l.sharing,d.sharing);g&&(u.sharing=g);var f=negotiateDirectionality(l.data,d.data);return f&&(u.data=f),u}function isNegotiatedDirectionAcceptable(l,d,u){var p=hasSendDirectionality(l)&&hasSendDirectionality(d)||!hasSendDirectionality(l)&&!hasSendDirectionality(u),h=!u||hasReceiveDirectionality(l)&&hasReceiveDirectionality(d)||!hasReceiveDirectionality(l)&&!hasReceiveDirectionality(u);return p&&h}function areNegotiatedDirectionsAcceptable(l,d,u){return isNegotiatedDirectionAcceptable(l.audio,d.audio,u.audio)&&isNegotiatedDirectionAcceptable(l.video,d.video,u.video)&&isNegotiatedDirectionAcceptable(l.sharing,d.sharing,u.sharing)&&isNegotiatedDirectionAcceptable(l.data,d.data,u.data)}function areNegotiatedDirectionsFulfilled(l,d){function isNegotiatedDirectionFulfilled(l,d){var u=hasSendDirectionality(l)===hasSendDirectionality(d),p=hasReceiveDirectionality(l)===hasReceiveDirectionality(d)||hasReceiveDirectionality(l)&&!d;return u&&p}return isNegotiatedDirectionFulfilled(l.audio,d.audio)&&isNegotiatedDirectionFulfilled(l.video,d.video)&&isNegotiatedDirectionFulfilled(l.sharing,d.sharing)&&isNegotiatedDirectionFulfilled(l.data,d.data)}function areSendDirectionsFulfilled(l,d){var isSendDirectionFulfilled=function(l,d){return hasSendDirectionality(l)===hasSendDirectionality(d)};return isSendDirectionFulfilled(l.audio,d.audio)&&isSendDirectionFulfilled(l.video,d.video)&&isSendDirectionFulfilled(l.sharing,d.sharing)&&isSendDirectionFulfilled(l.data,d.data)}function getSrtpInfo(l){var d={dtls:!1,sdes:!1};return d.dtls=!!l.fingerprint,l.media.forEach((function(l){d.dtls=d.dtls||!!l.fingerprint,d.sdes=d.sdes||!!l.crypto})),d}function shouldAddModality(l,d,u,p){if(!d[u])return!0;if(l){if(!(hasSendDirectionality(p)||l[u]&&l[u]===p))return!1}else if(d[u]===p)return!1;return!0}function excludePassiveModalities(l,d,u){if(!d||m.isEmpty(d))return l;var p={};return m.forOwn(l,(function(h,g){shouldAddModality(u,d,g,h)&&(p[g]=l[g])})),p}function removeChangedSendDirection(l,d){if(!d||m.isEmpty(d))return l;var u={};return m.forOwn(l,(function(l,p){p===v.default.MODALITY.data?u[p]=removeChangedDataSendDirection(l,d[p]):u[p]=removeChangedMediaSendDirection(l,d[p])})),u}function removeChangedMediaSendDirection(l,d){return hasSendDirectionality(l)&&!hasSendDirectionality(d)?removeSendDirectionality(l)||d:l}function removeChangedDataSendDirection(l,d){return hasSendDirectionality(l)&&!hasSendDirectionality(d)?d:l}function parseCandidateString(l){var d=(l||\"\").split(\" \");return{component:d[1],protocol:d[2],priority:d[3],ip:d[4],port:d[5],type:d[7]}}function isSendModalityAdded(l,d){return!hasSendDirectionality(l)&&hasSendDirectionality(d)}function getSendMediaModalities(l){var d;return(d={}).Audio=hasSendDirectionality(l.audio),d.Video=hasSendDirectionality(l.video),d.ScreenShare=hasSendDirectionality(l.sharing),d.Data=hasSendDirectionality(l.data),d}function mergeSendModalities(l,d){var u=m.shallowClone(l);return m.forOwn(l,(function(l,p){var h=modalityToMediaType(p);hasSendDirectionality(l)&&!d[h]&&(u[p]=removeSendDirectionality(l))})),u}function modalityToMediaType(l){switch(l){case\"audio\":return\"Audio\";case\"video\":return\"Video\";case\"sharing\":return\"ScreenShare\";default:return null}}function mediaTypeToModality(l){switch(l){case\"Audio\":return\"audio\";case\"Video\":return\"video\";case\"ScreenShare\":return\"sharing\";default:return null}}function sendStreamsToModalities(l){var d={};return m.keys(l).forEach((function(u){return d[u]=!!l[u]})),d}function scrubObjectFields(l,d,u){var m,v;if(!l)return l;var y=p({},l);try{for(var S=h(Object.entries(l)),_=S.next();!_.done;_=S.next()){var C=g(_.value,2),E=C[0],T=C[1];\"object\"==typeof T?y[E]=scrubObjectFields(T,d):T&&d.includes(E)&&(y[E]=u?u(T):f.scrubMriOrOmit(T))}}catch(l){m={error:l}}finally{try{_&&!_.done&&(v=S.return)&&v.call(S)}finally{if(m)throw m.error}}return y}function scrubObjectExcludingFields(l,d,u){var m,v;if(!l)return l;var y=p({},l);try{for(var S=h(Object.entries(l)),_=S.next();!_.done;_=S.next()){var C=g(_.value,2),E=C[0],T=C[1];\"object\"==typeof T?y[E]=scrubObjectExcludingFields(T,d):T&&!d.includes(E)&&(y[E]=u?u(T):f.scrubMriOrOmit(T))}}catch(l){m={error:l}}finally{try{_&&!_.done&&(v=S.return)&&v.call(S)}finally{if(m)throw m.error}}return y}function scrubSelectedDevices(l){return l?scrubObjectExcludingFields(l,[]):l}function scrubDevices(l,d){if(!l)return l;var u=scrubObjectFields(l,[\"deviceId\",\"groupId\",\"guid\"]);return scrubObjectFields(u,[\"label\"],(function(l){return m.scrubDeviceLabelPii(l,d)}))}function scrubConstraints(l){return scrubObjectFields(l,[\"sourceId\",\"deviceId\"])}function preferSdesSrtp(l){return!(!l.configProvider.config.checkSupportForWebrtc_1_0||l.configProvider.mediaConfig.simulcastSessionEnabled)||(l.config.isPstnCall?l.configProvider.config.preferSdesSrtpPstn:l.configProvider.config.preferSdesSrtp)}function canUseWebrtc1_0(l){return!l||y.UserAgentConfig.hasUnifiedPlanSupport()}function allowDataChannel(l){return!!l.configProvider.mediaConfig.simulcastSessionEnabled&&(l.config.isPstnCall?l.configProvider.config.enableDataChannelPstn:l.configProvider.config.enableDataChannel)}function getAllowedCodecs(l,d){switch(d){case v.default.MEDIA_TYPE.audio:return l.config.allowedAudioCodecs;case v.default.MEDIA_TYPE.video:return l.config.allowedVideoCodecs;default:return[]}}function isVersionGreaterOrEqual(l,d){var u=d.split(\".\").map((function(l){return parseInt(l,10)})),p=l.split(\".\").map((function(l){return parseInt(l,10)}));return p[0]>u[0]||p[0]===u[0]&&p[1]>=u[1]}function getSimulcastConfigForMediaType(l,d){var u,p;return\"Video\"===l?null===(u=d.config.specCompliantSimulcast)||void 0===u?void 0:u.video:\"ScreenShare\"===l?null===(p=d.config.specCompliantSimulcast)||void 0===p?void 0:p.sharing:null}function convertToCodecInfo(l){return l.map((function(l){var d=l.mimeType.split(\"/\"),u={codec:d[1]||d[0],rate:l.clockRate};return l.channels&&(u.encoding=l.channels),l.sdpFmtpLine&&(u.fmtpLine=l.sdpFmtpLine),u}))}function allowProvisionalAnswer(l){return l.config.isPstnCall?l.configProvider.config.allowProvisionalAnswerPstn:l.configProvider.config.allowProvisionalAnswer}function printMediaStream(l){return\"\".concat(null==l?void 0:l.id,\":\").concat(JSON.stringify(null==l?void 0:l.getTracks().map((function(l){return l.id}))),\"}\")}d.negotiateDirectionality=negotiateDirectionality,d.invertModalities=invertModalities,d.removeSendDirectionality=removeSendDirectionality,d.hasSendDirectionality=hasSendDirectionality,d.hasReceiveDirectionality=hasReceiveDirectionality,d.addReceiveDirectionality=addReceiveDirectionality,d.isOnHold=isOnHold,d.negotiateModalities=negotiateModalities,d.areNegotiatedDirectionsAcceptable=areNegotiatedDirectionsAcceptable,d.areNegotiatedDirectionsFulfilled=areNegotiatedDirectionsFulfilled,d.areSendDirectionsFulfilled=areSendDirectionsFulfilled,d.getSrtpInfo=getSrtpInfo,d.excludePassiveModalities=excludePassiveModalities,d.removeChangedSendDirection=removeChangedSendDirection,d.parseCandidateString=parseCandidateString,d.isSendModalityAdded=isSendModalityAdded,d.getSendMediaModalities=getSendMediaModalities,d.mergeSendModalities=mergeSendModalities,d.modalityToMediaType=modalityToMediaType,d.mediaTypeToModality=mediaTypeToModality,d.sendStreamsToModalities=sendStreamsToModalities,d.scrubObjectFields=scrubObjectFields,d.scrubObjectExcludingFields=scrubObjectExcludingFields,d.scrubSelectedDevices=scrubSelectedDevices,d.scrubDevices=scrubDevices,d.scrubConstraints=scrubConstraints,d.preferSdesSrtp=preferSdesSrtp,d.canUseWebrtc1_0=canUseWebrtc1_0,d.allowDataChannel=allowDataChannel,d.getAllowedCodecs=getAllowedCodecs,d.isVersionGreaterOrEqual=isVersionGreaterOrEqual,d.getSimulcastConfigForMediaType=getSimulcastConfigForMediaType,d.convertToCodecInfo=convertToCodecInfo,d.allowProvisionalAnswer=allowProvisionalAnswer,d.printMediaStream=printMediaStream},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getIdFromUrl=d.get=void 0;var p=u(5),h=u(4);function get(l,d,u){return void 0===u&&(u=h.causeId()),h.assertNotNullOrEmpty(d,\"trailingPath cannot be null\"),h.assertNotNull(l,\"signalingSession cannot be null\"),h.assertNotNull(l.baseMessagingChannelUrl,\"messaging channel url is not set\"),\"\".concat(l.baseMessagingChannelUrl).concat(p.default.URL_BASE.CALLAGENT,\"/\").concat(l.sessionId,\"/\").concat(u).concat(d)}function getIdFromUrl(l){var d=l.match(new RegExp(\"/\".concat(h.escapeRegExp(p.default.URL_BASE.CALLAGENT),\"/+([^/]+)\"),\"i\"));return d?d[1]:null}d.get=get,d.getIdFromUrl=getIdFromUrl},function(l,d,u){u.d(d,\"e\",(function(){return getGlobalInst})),u.d(d,\"k\",(function(){return getWindow})),u.d(d,\"d\",(function(){return getDocument})),u.d(d,\"i\",(function(){return getNavigator})),u.d(d,\"g\",(function(){return getLocation})),u.d(d,\"b\",(function(){return getConsole})),u.d(d,\"j\",(function(){return getPerformance})),u.d(d,\"l\",(function(){return hasJSON})),u.d(d,\"f\",(function(){return getJSON})),u.d(d,\"c\",(function(){return getCrypto})),u.d(d,\"h\",(function(){return getMsCrypto})),u.d(d,\"p\",(function(){return isReactNative})),u.d(d,\"o\",(function(){return isIE})),u.d(d,\"a\",(function(){return dumpObj})),u.d(d,\"m\",(function(){return isBeaconsSupported})),u.d(d,\"n\",(function(){return isFetchSupported})),u.d(d,\"r\",(function(){return useXDomainRequest})),u.d(d,\"q\",(function(){return isXhrSupported}));var p=u(2),h=u(31),g=u(0),f=\"window\",m=\"document\",v=\"navigator\",y=\"location\",S=\"console\",_=\"performance\",C=\"JSON\",E=\"crypto\",T=\"msCrypto\",b=\"ReactNative\",I=\"msie\",A=\"trident/\",R=null,P=null,O=!1,M=null,w=null;function _hasProperty(l,d){var u=!1;if(l){try{if(!(u=d in l)){var h=l[p.k];h&&(u=d in h)}}catch(l){}if(!u)try{var f=new l;u=!Object(g.x)(f[d])}catch(l){}}return u}function getGlobalInst(l){var d=Object(h.a)();return d&&d[l]?d[l]:l===f&&hasWindow()?window:null}function hasWindow(){return Boolean(typeof window===p.j&&window)}function getWindow(){return hasWindow()?window:getGlobalInst(f)}function hasDocument(){return Boolean(typeof document===p.j&&document)}function getDocument(){return hasDocument()?document:getGlobalInst(m)}function hasNavigator(){return Boolean(typeof navigator===p.j&&navigator)}function getNavigator(){return hasNavigator()?navigator:getGlobalInst(v)}function getLocation(l){if(l&&O){var d=getGlobalInst(\"__mockLocation\");if(d)return d}return typeof location===p.j&&location?location:getGlobalInst(y)}function getConsole(){return typeof console!==p.l?console:getGlobalInst(S)}function getPerformance(){return getGlobalInst(_)}function hasJSON(){return Boolean(typeof JSON===p.j&&JSON||null!==getGlobalInst(C))}function getJSON(){return hasJSON()?JSON||getGlobalInst(C):null}function getCrypto(){return getGlobalInst(E)}function getMsCrypto(){return getGlobalInst(T)}function isReactNative(){var l=getNavigator();return!(!l||!l.product)&&l.product===b}function isIE(){var l=getNavigator();if(l&&(l.userAgent!==P||null===R)){var d=((P=l.userAgent)||\"\").toLowerCase();R=Object(g.E)(d,I)||Object(g.E)(d,A)}return R}function dumpObj(l){var d=Object[p.k].toString.call(l),u=\"\";return\"[object Error]\"===d?u=\"{ stack: '\"+l.stack+\"', message: '\"+l.message+\"', name: '\"+l.name+\"'\":hasJSON()&&(u=getJSON().stringify(l)),d+u}function isBeaconsSupported(){return null===w&&(w=hasNavigator()&&Boolean(getNavigator().sendBeacon)),w}function isFetchSupported(l){var d=!1;try{d=!!getGlobalInst(\"fetch\");var u=getGlobalInst(\"Request\");d&&l&&u&&(d=_hasProperty(u,\"keepalive\"))}catch(l){}return d}function useXDomainRequest(){return null===M&&(M=\"undefined\"!=typeof XDomainRequest)&&isXhrSupported()&&(M=M&&!_hasProperty(getGlobalInst(\"XMLHttpRequest\"),\"withCredentials\")),M}function isXhrSupported(){var l=!1;try{l=!!getGlobalInst(\"XMLHttpRequest\")}catch(l){}return l}},,function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.validateCauseId=d.generateCauseId=void 0;var p=8;function generateCauseId(){for(var l=\"abcdef0123456789\",d=l.length,u=\"\",h=0;h<p;h++)u+=l.charAt(Math.floor(Math.random()*d));return u}function validateCauseId(l){return new RegExp(\"^[a-f0-9]{8}$\").test(l)&&l.length===p}d.generateCauseId=generateCauseId,d.validateCauseId=validateCauseId},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPIISafeCallInitOptions=d.truncate=d.safeJsonStringify=d.getPrintableObject=d.getPIISafeObject=void 0;var p=u(17),h=[\"response\",\"responseText\",\"responseURL\",\"status\",\"state\",\"statusText\",\"timeout\",\"withCredentials\",\"stack\",\"message\",\"name\",\"error\",\"piiSafe\",\"phase\",\"code\",\"participantId\",\"phrase\",\"subCode\",\"reason\"];function getPIISafeObject(l){try{return JSON.parse(JSON.stringify(l,h,4))}catch(l){return{error:\"failed to parse object\"}}}function getPrintableObject(l,d){void 0===d&&(d=!1);var processStackTrace=function(l){try{return l.split(\"\\n\")[0]}catch(l){return\"invalid stack\"}};if(void 0===l)return\"void\";if(l instanceof Error)return l.toString();if(l instanceof String||l instanceof Number||l instanceof Boolean)return l.toString();try{return l.stack&&(l.stack=processStackTrace(l.stack)),(d?JSON.stringify(l):JSON.stringify(l,h,4)).replace(/(\\r\\n\\t|\\n|\\r\\t|\\s)/gm,\"\")}catch(d){return\"failed to get error information:\".concat(l&&\"function\"==typeof l.toString&&l.toString(),\" \").concat(l&&l.response&&JSON.stringify(l.response))}}function safeJsonStringify(l){try{return JSON.stringify(l,null,2)}catch(d){return\"failed to stringify obj \".concat(l)}}function truncate(l,d){try{return l.substring(0,length)}catch(d){return l}}function hasValue(l){return l||!1===l||\"\"===l||0===l}function getPIISafeCallInitOptions(l){var d={mediaPeerType:l.mediaPeerType,threadId:(0,p.getLoggableThreadId)(l.threadId)};return hasValue(l.messageId)&&(d.messageId=l.messageId),hasValue(l.enableGroupCallMeetupGeneration)&&(d.enableGroupCallMeetupGeneration=l.enableGroupCallMeetupGeneration),hasValue(l.endpointMetadata)&&(d.endpointMetadata=l.endpointMetadata),hasValue(l.onBehalfOf)&&(d.onBehalfOf=(0,p.scrubMriOrOmit)(l.onBehalfOf)),hasValue(l.emergencyContent)&&(d.emergencyContent=l.emergencyContent),hasValue(l.isEmergency)&&(d.isEmergency=l.isEmergency),hasValue(l.broadcastContext)&&(d.broadcastContext=l.broadcastContext),l.meetingInfo&&(d.meetingInfo={tenantId:l.meetingInfo.tenantId,organizerId:(0,p.scrubMriOrOmit)(l.meetingInfo.organizerId)},hasValue(l.meetingInfo.meetingType)&&(d.meetingInfo.meetingType=l.meetingInfo.meetingType),hasValue(l.meetingInfo.replyChainMessageId)&&(d.meetingInfo.replyChainMessageId=l.meetingInfo.replyChainMessageId)),l.transferContext&&(d.transferContext={transferorMri:(0,p.scrubMriOrOmit)(l.transferContext.transferorMri),targetMri:(0,p.scrubMriOrOmit)(l.transferContext.targetMri),context:l.transferContext.context},hasValue(l.transferContext.transferType)&&(d.transferContext.transferType=l.transferContext.transferType)),d}d.getPIISafeObject=getPIISafeObject,d.getPrintableObject=getPrintableObject,d.safeJsonStringify=safeJsonStringify,d.truncate=truncate,d.getPIISafeCallInitOptions=getPIISafeCallInitOptions},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p,h=u(19);if(\"undefined\"!=typeof window&&\"undefined\"!=typeof navigator&&(p=window,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.MediaStream=window.MediaStream||window.webkitMediaStream||window.mozMediaStream||window.msMediaStream,window.attachMediaStream=function(l,d){\"srcObject\"in l?l.srcObject=d:void 0!==l.src&&(l.src=window.URL.createObjectURL(d))},window.AudioContext=window.AudioContext||window.webkitAudioContext,window.detachMediaStream=function(l){if(\"srcObject\"in l)l.srcObject=null;else if(void 0!==l.src&&l.src){var d=l.src;l.src=\"\",window.URL.revokeObjectURL(d)}},void 0!==navigator.webkitGetUserMedia&&\"undefined\"!=typeof webkitRTCPeerConnection&&\"Electron\"===(0,h.getBrowserInfo)().name?(window.RTCPeerConnection=webkitRTCPeerConnection,navigator.getUserMedia=function(l,d,u){var polyfillDeviceId=function(l){l&&l.deviceId&&l.deviceId.exact&&(l.mandatory||(l.mandatory={}),l.mandatory.sourceId=l.deviceId.exact,delete l.deviceId)};return l&&(polyfillDeviceId(l.audio),polyfillDeviceId(l.video)),navigator.webkitGetUserMedia(l,d,u)}):navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(l,d,u){return navigator.mediaDevices.getUserMedia(l).then(d).catch(u)}),\"undefined\"!=typeof RTCIceGatherer)){var getStats=function(){return Promise.resolve()};RTCRtpSender.prototype.getStats||(RTCRtpSender.prototype.getStats=getStats),RTCRtpSender.prototype.msGetStats||(RTCRtpSender.prototype.msGetStats=getStats),RTCRtpReceiver.prototype.getStats||(RTCRtpReceiver.prototype.getStats=getStats),RTCRtpReceiver.prototype.msGetStats||(RTCRtpReceiver.prototype.msGetStats=getStats),RTCIceTransport.prototype.getStats||(RTCIceTransport.prototype.getStats=getStats),RTCIceTransport.prototype.msGetStats||(RTCIceTransport.prototype.msGetStats=getStats),RTCRtpReceiver.prototype.getContributingSources||(RTCRtpReceiver.prototype.getContributingSources=function(){return[]}),RTCRtpReceiver.prototype.requestSendCSRC||(RTCRtpReceiver.prototype.requestSendCSRC=function(){})}d.default={window:p}},,function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getLoggableThreadId=d.mriOrId=d.scrubMriOrOmitList=d.scrubMriOrOmit=void 0;var p=u(33);function scrubMriOrOmit(l){return\"string\"==typeof l?p.pii.Mri(l):p.pii.Omit(l)}function scrubMriOrOmitList(l){return l.forEach(scrubMriOrOmit)}function mriOrId(l){return l&&p.pii.Mri(l)}function getLoggableThreadId(l){var d=_scrubThreadId(l);return d&&d.substr(0,8)}function _scrubThreadId(l){var d=\"99:\";return l&&l.substr(0,3)===d?p.pii.Omit(l):l}d.scrubMriOrOmit=scrubMriOrOmit,d.scrubMriOrOmitList=scrubMriOrOmitList,d.mriOrId=mriOrId,d.getLoggableThreadId=getLoggableThreadId},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},g=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var f=function(l){function ObservableBase(d){return l.call(this,d)||this}return p(ObservableBase,l),ObservableBase.prototype.changed=function(l,d){return this.subscribe({changed:{skipEventConfig:d,handler:l},on:void 0})},ObservableBase.prototype.on=function(l,d){return this.subscribe({changed:void 0,on:{name:String(l),handler:this._toEventCallback(d)}})},ObservableBase.prototype.once=function(l,d,u){var p,f=this,onceSubscription=function(){for(var l=[],m=0;m<arguments.length;m++)l[m]=arguments[m];p.dispose(u),f._toEventCallback(d).apply(void 0,g([],h(l),!1))};return p=this.on(l,this._fromEventCallback(onceSubscription))},ObservableBase.prototype.raiseChanged=function(l){var d=this;this.raiseEvents((function(u){if(u.changed){var p=u.changed,h=p.skipEventConfig,g=p.handler;!d.getShouldSkipChangedEvent(l,h)&&g()}}))},ObservableBase.prototype.event=function(l){var d=this;return{raise:this._fromEventCallback((function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];return d._raiseEventImpl.apply(d,g([String(l)],h(u),!1))}))}},ObservableBase.prototype._raiseEventImpl=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];this.raiseEvents((function(u){var p;return u.on&&u.on.name===l&&(p=u.on).handler.apply(p,g([],h(d),!1))}))},ObservableBase.prototype._toEventCallback=function(l){return l},ObservableBase.prototype._fromEventCallback=function(l){return l},ObservableBase.prototype.getShouldSkipChangedEvent=function(l,d){return!!(null==l?void 0:l.skipParticipantsUpdatesOnCall)&&!!(null==d?void 0:d.skipParticipantsUpdatesOnCall)},ObservableBase}(u(182).EventSourceImpl);d.default=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getBrowserInfo=void 0;var p=\"0.0\";function getBrowserVersion(l,d){var u=[];return d.some((function(d){return!!(u=l.match(d))})),!u||u.length<2?p:u[1]&&u[1].replace(/_/g,\".\")||p}function getFormFactor(l){var d=\"136\";return getOsSkuInfo()===d?\"Hololens\":/iPhone|iPad|iPod|Android|Mobi/i.test(l)?\"Mobile\":\"Desktop\"}function getOsSkuInfo(){var l=\"os-sku\",d=window.external;return(null==d?void 0:d.getHostEnvironmentValue)?JSON.parse(d.getHostEnvironmentValue(l))[l]:\"-1\"}function getBrowserInfo(){var l=\"((\\\\d+\\\\.?){2,4})\",d={name:\"Unknown\",engine:\"Unknown\",version:p,formFactor:\"Unknown\"},u=[{name:\"Edge\",engine:\"Edge\",key:\"Edge\",masks:[new RegExp(\"\".concat(\"Edge\",\"/\").concat(l))]},{name:\"EdgeAnaheim\",engine:\"Chromium\",key:\"EdgA\",masks:[new RegExp(\"\".concat(\"Chrome\",\"/\").concat(l))]},{name:\"EdgeAnaheim\",engine:\"Chromium\",key:\"Edg\",masks:[new RegExp(\"\".concat(\"Edg\",\"/\").concat(l))]},{name:\"Chromium\",engine:\"Chromium\",key:\"Chromium\",masks:[new RegExp(\"\".concat(\"Chromium\",\"/\").concat(l))]},{name:\"Opera\",engine:\"Chromium\",key:\"OPR\",masks:[new RegExp(\"\".concat(\"OPR\",\"/\").concat(l))]},{name:\"YandexBrowser\",engine:\"Chromium\",key:\"YaBrowser\",masks:[new RegExp(\"\".concat(\"YaBrowser\",\"/\").concat(l))]},{name:\"Electron\",engine:\"Chromium\",key:\"Electron\",masks:[new RegExp(\"\".concat(\"Electron\",\"/\").concat(l))]},{name:\"CiscoOS\",engine:\"Chromium\",key:\"Cisco\",masks:[new RegExp(\"\".concat(\"Chrome\",\"/\").concat(l))]},{name:\"ZoomRoom\",engine:\"Chromium\",key:\"ZoomRoom\",masks:[new RegExp(\"\".concat(\"Chrome\",\"/\").concat(l))]},{name:\"SamsungTV\",engine:\"Chromium\",key:\"TeamsSamsungTVBrowser\",masks:[new RegExp(\"\".concat(\"Chrome\",\"/\").concat(l))]},{name:\"Chrome\",engine:\"Chromium\",key:\"Chrome\",masks:[new RegExp(\"\".concat(\"Chrome\",\"/\").concat(l))]},{name:\"Firefox\",engine:\"Firefox\",key:\"Firefox\",masks:[new RegExp(\"\".concat(\"Firefox\",\"/\").concat(l))]},{name:\"Safari\",engine:\"Safari\",key:\"Safari\",masks:[new RegExp(\"Version/\".concat(l,\".*?\").concat(\"Safari\",\"/\"))]},{name:\"AppleWebView\",engine:\"Safari\",key:\"Mac OS X\",masks:[new RegExp(\"(\\\\d+_\\\\d+(_\\\\d+)?).*\".concat(\"Mac OS X\")),new RegExp(\"(\\\\d+_\\\\d+(_\\\\d+)?).*\")]},{name:\"MSIE\",engine:\"MSIE\",key:\"Trident\",masks:[new RegExp(\"MSIE \".concat(l)),new RegExp(\"rv:\".concat(l))]}],h=navigator.userAgent,g=d;return u.some((function(l){return-1!==h.indexOf(l.key)&&(g={name:l.name,engine:l.engine,version:getBrowserVersion(h,l.masks),formFactor:getFormFactor(h)},!0)})),g}d.getBrowserInfo=getBrowserInfo},function(l,d,u){u.d(d,\"e\",(function(){return g})),u.d(d,\"a\",(function(){return f})),u.d(d,\"c\",(function(){return m})),u.d(d,\"b\",(function(){return v})),u.d(d,\"d\",(function(){return y})),u.d(d,\"f\",(function(){return S}));var p=u(178),h=u(21),g={NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,CustomerContent_GenericContent:32},f={Normal:1,CostDeferred:2,RealTime:3,Immediate:4},m={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},v={Normal:1,Critical:2},y={NONE:0,ERROR:1,WARNING:2,INFORMATION:3},S=Object(p.a)(Object(p.a)({},h.b),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520})},function(l,d,u){var p;u.d(d,\"a\",(function(){return p})),u.d(d,\"b\",(function(){return h})),function(l){l[l.CRITICAL=1]=\"CRITICAL\",l[l.WARNING=2]=\"WARNING\"}(p||(p={}));var h={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103,FailedAddingCustomDefinedRequestContext:104,InMemoryStorageBufferFull:105}},function(l,d,u){u.d(d,\"d\",(function(){return randomValue})),u.d(d,\"c\",(function(){return random32})),u.d(d,\"b\",(function(){return mwcRandomSeed})),u.d(d,\"a\",(function(){return mwcRandom32}));var p=u(11),h=u(0),g=4294967296,f=4294967295,m=!1,v=123456789,y=987654321;function _mwcSeed(l){l<0&&(l>>>=0),v=123456789+l&f,y=987654321-l&f,m=!0}function _autoSeedMwc(){try{var l=2147483647&Object(h.f)();_mwcSeed((Math.random()*g^l)+l)}catch(l){}}function randomValue(l){return l>0?Math.floor(random32()/f*(l+1))>>>0:0}function random32(l){var d,u=Object(p.c)()||Object(p.h)();return u&&u.getRandomValues?d=u.getRandomValues(new Uint32Array(1))[0]&f:Object(p.o)()?(m||_autoSeedMwc(),d=mwcRandom32()&f):d=Math.floor(g*Math.random()|0),l||(d>>>=0),d}function mwcRandomSeed(l){l?_mwcSeed(l):_autoSeedMwc()}function mwcRandom32(l){var d=((y=36969*(65535&y)+(y>>16)&f)<<16)+(65535&(v=18e3*(65535&v)+(v>>16)&f))>>>0&f|0;return l||(d>>>=0),d}},function(l,d,u){var p=u(100),h=Object.prototype.toString;function isArray(l){return\"[object Array]\"===h.call(l)}function isUndefined(l){return void 0===l}function isBuffer(l){return null!==l&&!isUndefined(l)&&null!==l.constructor&&!isUndefined(l.constructor)&&\"function\"==typeof l.constructor.isBuffer&&l.constructor.isBuffer(l)}function isArrayBuffer(l){return\"[object ArrayBuffer]\"===h.call(l)}function isFormData(l){return\"undefined\"!=typeof FormData&&l instanceof FormData}function isArrayBufferView(l){return\"undefined\"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(l):l&&l.buffer&&l.buffer instanceof ArrayBuffer}function isString(l){return\"string\"==typeof l}function isNumber(l){return\"number\"==typeof l}function isObject(l){return null!==l&&\"object\"==typeof l}function isDate(l){return\"[object Date]\"===h.call(l)}function isFile(l){return\"[object File]\"===h.call(l)}function isBlob(l){return\"[object Blob]\"===h.call(l)}function isFunction(l){return\"[object Function]\"===h.call(l)}function isStream(l){return isObject(l)&&isFunction(l.pipe)}function isURLSearchParams(l){return\"undefined\"!=typeof URLSearchParams&&l instanceof URLSearchParams}function trim(l){return l.replace(/^\\s*/,\"\").replace(/\\s*$/,\"\")}function isStandardBrowserEnv(){return(\"undefined\"==typeof navigator||\"ReactNative\"!==navigator.product&&\"NativeScript\"!==navigator.product&&\"NS\"!==navigator.product)&&(\"undefined\"!=typeof window&&\"undefined\"!=typeof document)}function forEach(l,d){if(null!=l)if(\"object\"!=typeof l&&(l=[l]),isArray(l))for(var u=0,p=l.length;u<p;u++)d.call(null,l[u],u,l);else for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&d.call(null,l[h],h,l)}function merge(){var l={};function assignValue(d,u){\"object\"==typeof l[u]&&\"object\"==typeof d?l[u]=merge(l[u],d):l[u]=d}for(var d=0,u=arguments.length;d<u;d++)forEach(arguments[d],assignValue);return l}function deepMerge(){var l={};function assignValue(d,u){\"object\"==typeof l[u]&&\"object\"==typeof d?l[u]=deepMerge(l[u],d):l[u]=\"object\"==typeof d?deepMerge({},d):d}for(var d=0,u=arguments.length;d<u;d++)forEach(arguments[d],assignValue);return l}function extend(l,d,u){return forEach(d,(function assignValue(d,h){l[h]=u&&\"function\"==typeof d?p(d,u):d})),l}l.exports={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,deepMerge:deepMerge,extend:extend,trim:trim}},function(l,d,u){u.d(d,\"a\",(function(){return _gblCookieMgr})),u.d(d,\"d\",(function(){return safeGetCookieMgr})),u.d(d,\"c\",(function(){return createCookieMgr})),u.d(d,\"b\",(function(){return areCookiesSupported})),u.d(d,\"e\",(function(){return uaDisallowsSameSiteNone}));var p=u(21),h=u(11),g=u(0),f=\"toGMTString\",m=\"toUTCString\",v=\"cookie\",y=\"expires\",S=\"enabled\",_=\"isCookieUseDisabled\",C=\"disableCookiesUsage\",E=\"_ckMgr\",T=\"\",b=null,I=null,A=null,R=Object(h.d)(),P={},O={};function _gblCookieMgr(l,d){var u=createCookieMgr[E]||O[E];return u||(u=createCookieMgr[E]=createCookieMgr(l,d),O[E]=u),u}function _isMgrEnabled(l){return!l||l.isEnabled()}function _createCookieMgrConfig(l){var d=l.cookieCfg=l.cookieCfg||{};if(Object(g.D)(d,\"domain\",l.cookieDomain,g.p,g.r),Object(g.D)(d,\"path\",l.cookiePath||\"/\",null,g.r),Object(g.r)(d[S])){var u=void 0;Object(g.x)(l[_])||(u=!l[_]),Object(g.x)(l[C])||(u=!l[C]),d[S]=u}return d}function safeGetCookieMgr(l,d){var u;if(l)u=l.getCookieMgr();else if(d){var p=d.cookieCfg;u=p[E]?p[E]:createCookieMgr(d)}return u||(u=_gblCookieMgr(d,(l||{}).logger)),u}function createCookieMgr(l,d){var u=_createCookieMgrConfig(l||O),p=u.path||\"/\",v=u.domain,_=!1!==u[S],C={isEnabled:function(){var l=_&&areCookiesSupported(d),u=O[E];return l&&u&&C!==u&&(l=_isMgrEnabled(u)),l},setEnabled:function(l){_=!1!==l},set:function(l,d,S,_,E){var b=!1;if(_isMgrEnabled(C)){var A={},R=Object(g.H)(d||T),P=R.indexOf(\";\");if(-1!==P&&(R=Object(g.H)(d.substring(0,P)),A=_extractParts(d.substring(P+1))),Object(g.D)(A,\"domain\",_||v,g.v,g.x),!Object(g.r)(S)){var O=Object(h.o)();if(Object(g.x)(A[y])){var M=Object(g.f)()+1e3*S;if(M>0){var w=new Date;w.setTime(M),Object(g.D)(A,y,_formatDate(w,O?f:m)||_formatDate(w,O?f:m)||T,g.v)}}O||Object(g.D)(A,\"max-age\",T+S,null,g.x)}var N=Object(h.g)();N&&\"https:\"===N.protocol&&(Object(g.D)(A,\"secure\",null,null,g.x),null===I&&(I=!uaDisallowsSameSiteNone((Object(h.i)()||{}).userAgent)),I&&Object(g.D)(A,\"SameSite\",\"None\",null,g.x)),Object(g.D)(A,\"path\",E||p,null,g.x),(u.setCookie||_setCookieValue)(l,_formatCookieValue(R,A)),b=!0}return b},get:function(l){var d=T;return _isMgrEnabled(C)&&(d=(u.getCookie||_getCookieValue)(l)),d},del:function(l,d){var u=!1;return _isMgrEnabled(C)&&(u=C.purge(l,d)),u},purge:function(l,p){var g,f=!1;if(areCookiesSupported(d)){var m=((g={}).path=p||\"/\",g[y]=\"Thu, 01 Jan 1970 00:00:01 GMT\",g);Object(h.o)()||(m[\"max-age\"]=\"0\"),(u.delCookie||_setCookieValue)(l,_formatCookieValue(T,m)),f=!0}return f}};return C[E]=C,C}function areCookiesSupported(l){if(null===b){b=!1;try{b=void 0!==(R||{})[v]}catch(d){l&&l.throwInternal(p.a.WARNING,p.b.CannotAccessCookie,\"Cannot access document.cookie - \"+Object(g.h)(d),{exception:Object(h.a)(d)})}}return b}function _extractParts(l){var d={};if(l&&l.length){var u=Object(g.H)(l).split(\";\");Object(g.a)(u,(function(l){if(l=Object(g.H)(l||T)){var u=l.indexOf(\"=\");-1===u?d[l]=null:d[Object(g.H)(l.substring(0,u))]=Object(g.H)(l.substring(u+1))}}))}return d}function _formatDate(l,d){return Object(g.o)(l[d])?l[d]():null}function _formatCookieValue(l,d){var u=l||T;return Object(g.z)(d,(function(l,d){u+=\"; \"+l+(Object(g.r)(d)?T:\"=\"+d)})),u}function _getCookieValue(l){var d=T;if(R){var u=R[v]||T;A!==u&&(P=_extractParts(u),A=u),d=Object(g.H)(P[l]||T)}return d}function _setCookieValue(l,d){R&&(R[v]=l+\"=\"+d)}function uaDisallowsSameSiteNone(l){return!!Object(g.u)(l)&&(!(!Object(g.E)(l,\"CPU iPhone OS 12\")&&!Object(g.E)(l,\"iPad; CPU OS 12\"))||(!!(Object(g.E)(l,\"Macintosh; Intel Mac OS X 10_14\")&&Object(g.E)(l,\"Version/\")&&Object(g.E)(l,\"Safari\"))||(!(!Object(g.E)(l,\"Macintosh; Intel Mac OS X 10_14\")||!Object(g.F)(l,\"AppleWebKit/605.1.15 (KHTML, like Gecko)\"))||(!(!Object(g.E)(l,\"Chrome/5\")&&!Object(g.E)(l,\"Chrome/6\"))||(!(!Object(g.E)(l,\"UnrealEngine\")||Object(g.E)(l,\"Chrome\"))||!(!Object(g.E)(l,\"UCBrowser/12\")&&!Object(g.E)(l,\"UCBrowser/11\")))))))}},function(l,d,u){var p;Object.defineProperty(d,\"__esModule\",{value:!0}),d.NETWORK_REQUESTS=d.CONTROLLER=d.EVENTS=void 0,d.EVENTS={HANDLE_MEDIA_ACKNOWLEDGEMENT:\"HandleMediaAcknowledgement\",HANDLE_MEDIA_NEGOTIATION_FAILURE:\"HandleMediaNegotiationFailure\",HANDLE_MEDIA_ANSWER:\"HandleMediaAnswer\",HANDLE_MEDIA_ANSWER_FAILED:\"HandleMediaAnswerFailed\",HANDLE_MEDIA_OFFER:\"HandleMediaOffer\",REJECT_RENEGOTIATION:\"RejectRenegotiation\",HANDLE_RETARGET_COMPLETED:\"HandleRetargetCompleted\",HANDLE_MEDIA_ANSWER_TIMEOUT:\"HandleMediaAnswerTimeout\",HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT:\"HandleMediaAcknowledgementTimeout\",ACCEPT_RENEGOTIATION:\"AcceptRenegotiation\",START_RENEGOTIATION:\"StartRenegotiation\",MEDIA_FSM_STATE_CHANGED:\"MediaFsmStateChanged\",ADD_MODALITY_TIMEOUT:\"AddModalityTimeout\",ADD_PARTICIPANT:\"AddParticipant\",ADD_PARTICIPANT_TIMEOUT:\"AddParticipantTimeout\",ADD_PARTICIPANT_WITH_REPLACES:\"AddParticipantWithReplaces\",ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT:\"AddParticipantWithReplacesTimeout\",ADD_PARTICIPANTS_AND_MODALITY:\"AddParticipantsAndModality\",ADMIT_PARTICIPANT:\"AdmitParticipant\",ADMIT_PARTICIPANT_TIMEOUT:\"AdmitParticipantTimeout\",ADMIT:\"Admit\",ADMIT_TIMEOUT:\"AdmitTimeout\",ADMIT_FAILURE:\"AdmitFailure\",ADMIT_SUCCESS:\"AdmitSuccess\",CALL_ME_BACK:\"CallMeBack\",CALL_ME_BACK_TIMEOUT:\"CallMeBackTimeout\",REMOVE_PARTICIPANT:\"RemoveParticipant\",REMOVE_PARTICIPANT_OTHERS:\"RemoveParticipantOthers\",REMOVE_PARTICIPANT_SPECIFIED:\"RemoveParticipantSpecified\",REMOVE_PARTICIPANT_TIMEOUT:\"RemoveParticipantTimeout\",HANDLE_ADD_PARTICIPANT_SUCCESS:\"HandleAddParticipantSuccess\",HANDLE_ADD_PARTICIPANT_FAILURE:\"HandleAddParticipantFailure\",HANDLE_ADMIT_PARTICIPANT_SUCCESS:\"HandleAdmitParticipantSuccess\",HANDLE_ADMIT_PARTICIPANT_FAILURE:\"HandleAdmitParticipantFailure\",HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE:\"HandleAddParticipantModalityFailure\",HANDLE_REMOVE_PARTICIPANT_SUCCESS:\"HandleRemoveParticipantSuccess\",HANDLE_REMOVE_PARTICIPANT_FAILURE:\"HandleRemoveParticipantFailure\",HANDLE_ROSTER_UPDATE:\"HandleRosterUpdate\",HANDLE_ROSTER_UPDATE_FAIL:\"HandleRosterUpdateFail\",HANDLE_CONVERSATION_UPDATE:\"HandleConversationUpdate\",HANDLE_LOCAL_PARTICIPANT_UPDATE:\"HandleLocalParticipantUpdate\",SET_SUBJECT:\"SetSubject\",SET_JOINED_FROM:\"SetJoinedFrom\",SET_DEVICETYPE:\"SetDeviceType\",GET_EMERGENCY_CONTENT:\"GetEmergencyContent\",SET_MULTIPARTY:\"SetMultiparty\",SET_GROUPID:\"SetGroupId\",SET_THREADID:\"SetThreadId\",SET_CALLOPTIONS:\"SetCallOptions\",SET_TRANSFER_CONTEXT:\"SetTransferContext\",START_CALL:\"StartCall\",JOIN_CALL:\"JoinCall\",JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:\"JoinConversationWithoutCallModality\",HANDLE_INCOMING_CALL:\"HandleIncomingCall\",END_CALL:\"EndCall\",END_WITH_BEACON:\"EndWithBeacon\",CONFLICTED_CALL:\"ConflictedCall\",SET_PROVISIONAL_ANSWER:\"SetProvisionalAnswer\",SET_PROVISIONAL_ANSWER_FAILED:\"SetProvisionalAnswerFailed\",ACCEPT_CALL:\"AcceptCall\",ACCEPT_CALL_FAILED:\"AcceptCallFailed\",HANDLE_CALL_ACCEPTANCE_ACK:\"HandleCallAcceptanceAck\",HANDLE_CALL_ACCEPTANCE:\"HandleCallAcceptance\",HANDLE_CALL_ACCEPTANCE_SYNC:\"HandleCallAcceptanceSync\",HANDLE_CALL_ACCEPTANCE_FAILED:\"HandleCallAcceptanceFailed\",HANDLE_CALL_ESTABLISHMENT_TIMEOUT:\"HandleCallEstablishmentTimeout\",HANDLE_CALL_END:\"HandleCallEnd\",HANDLE_CALL_PROGRESS:\"HandleCallProgress\",HANDLE_LWJ_ACCEPTANCE:\"HandleLwjAcceptance\",HANDLE_LWJ_END:\"HandleLwjEnd\",TROUTER_URL_CHANGED:\"TrouterUrlChanged\",TROUTER_STATE_CHANGED:\"TrouterStateChanged\",TROUTER_URL_CHANGED_TO_INVALID:\"TrouterUrlChangedToInvalid\",TROUTER_URL_UPDATE_FAILED:\"TrouterUrlUpdateFailed\",ADD_CONTENT_SHARING_MODALITY:\"AddContentSharingModality\",ACCEPTED_BEFORE_RINGING:\"AcceptedBeforeRinging\",LEAVE_CONTENT_SHARING:\"LeaveContentSharing\",DELETE_CONTENT_SHARING:\"DeleteContentSharing\",TAKE_CONTROL_CONTENT_SHARING:\"TakeControlContentSharing\",UPDATE_SESSION_STATE_CONTENT_SHARING:\"UpdateSessionStateContentSharing\",JOIN_CONTENT_SHARING:\"JoinContentSharing\",UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:\"UpdateParticipantStateContentSharing\",HANDLE_CONTENT_SHARING_UPDATE:\"HandleContentSharingUpdate\",HANDLE_CONTENT_SHARING_END:\"HandleContentSharingEnd\",CONTENT_SHARING_START_FROM_ROSTER:\"ContentSharingStartFromRoster\",CONTENT_SHARING_END_FROM_ROSTER:\"ContentSharingEndFromRoster\",HANDLE_ADD_MODALITY_SUCCESS:\"HandleAddModalitySuccess\",HANDLE_ADD_MODALITY_FAILURE:\"HandleAddModalityFailure\",ADD_BROADCAST_MODALITY:\"AddBroadcastModality\",UPDATE_BROADCAST_DETAILS:\"UpdateBroadcastDetails\",WAITING_FOR_ADD_BROADCAST_MODALITY_COMPLETION:\"WaitingForAddBroadcastModalityCompletion\",MUTE:\"Mute\",NUDGE_PARTICIPANT_TIMEOUT:\"NudgeParticipantTimeout\",UNMUTE:\"Unmute\",UNMUTE_TIMEOUT:\"UnmuteTimeout\",HANDLE_UNMUTE_CONFIRM:\"HandleUnmuteConfirm\",HANDLE_UNMUTE_SUCCESS:\"HandleUnmuteSuccess\",HANDLE_UNMUTE_FAILURE:\"HandleUnmuteFailure\",APPROVE_UNMUTE:\"ApproveUnmute\",REJECT_UNMUTE:\"RejectUnmute\",HANDLE_CONTROL_VIDEO_STREAMING:\"HandleControlVideoStreaming\",HANDLE_DOMINANT_SPEAKER_CHANGED_COUNT:\"HandleDominantSpeakerChangedCount\",HANDLE_CSRC_INFO:\"HandleCsrcInfo\",SEND_WEBRTC_MEDIA_NOTIFICATION:\"SendWebRtcMediaNotification\",HANDLE_BALANCE_UPDATE:\"HandleBalanceUpdate\",TRANSFER_CALL:\"TransferCall\",PARK_CALL:\"ParkCall\",CALL_REDIRECT:\"CallRedirect\",CALL_REDIRECT_REQUEST_FAILED:\"CallRedirectRequestFailed\",TRANSFER_COMPLETION_FAILED:\"TransferCompletionFailed\",TRANSFER_REQUEST_RECEIVED:\"TransferRequestReceived\",HANDLE_PARK_REQUESTED:\"HandleParkRequested\",HANDLE_SERVER_HOLD:\"HandleServerHold\",DUPLICATE_MESSAGE_IGNORED:\"DuplicateMessageIgnored\",CORRELATION_ID_UPDATED:\"CorrelationIdUpdated\",UNKNOWN_MESSAGE_TYPE:\"UnkownMessageType\",FAILED_TO_HANDLE_MESSAGE:\"FailedToHandleMessage\",CONNECTIVITY_CHANGED:\"ConnectivityChanged\",TROUTER_DECODE_PAYLOAD_FAILURE:\"TrouterDecodePayloadFailure\",UPDATE_ENDPOINT_STATE:\"UpdateEndpointState\",UPDATE_ENDPOINT_STATE_SUCCESS:\"UpdateEndpointStateSuccess\",UPDATE_ENDPOINT_STATE_FAILURE:\"UpdateEndpointStateFailure\",BROKER_DECODE_PAYLOAD_FAILURE:\"BrokerDecodePayloadFailure\",BROKER_SUBSCRIPTION_TIMEOUT:\"BrokerSubscriptionTimeout\",BROKER_SUBSCRIPTION_SUCCESSFUL:\"BrokerSubscriptionSuccessful\",BROKER_SUBSCRIPTION_FAILED:\"BrokerSubscriptionFailed\",FAILED_TO_HANDLE_TROUTER_MESSAGE:\"FailedToHandleTrouterMessage\",FAILED_TO_HANDLE_BROKER_MESSAGE:\"FailedToHandleBrokerMessage\",BROKER_DISABLED_SUBSCRIBE_URL_PRESENT:\"BrokerDisabledSubscribeUrlPresent\",CONNECTED:\"Connected\",IN_LOBBY:\"InLobby\",STAGING:\"Staging\",MESSAGE_MISSING_BODY:\"MessageMissingBody\",BROADCAST_STATE_CHANGED:\"BroadcastStateChanged\",HANDLE_CALL_NOTIFICATION:\"HandleCallNotification\",HANDLE_INCOMING_CALL_REPLACEMENT:\"HandleIncomingCallReplacement\",HANDLE_PSTN_BALANCE_UPDATE:\"HandlePstnBalanceUpdate\",IGNORE_OLD_ROSTER:\"IgnoreOldRoster\",HANDLE_MEDIA_ACK:\"HandleMediaAck\",HANDLE_MEDIA_PROVISIONAL_ACK:\"HandleMediaProvisionalAck\",UPDATE_CALL_STATUS:\"UpdateCallStatus\",SEND_ATTACH:\"SendAttach\",REQUEST_NEW_OFFER:\"RequestNewOffer\",HANDLE_NEW_OFFER:\"HandleNewOffer\",UPDATE_CONVERSATION_LINKS:\"UpdateConversationLinks\",UPDATE_CONVERSATION_LINKS_SUCCESS:\"UpdateConversationLinksSuccess\",UPDATE_CONVERSATION_LINKS_FAILED:\"UpdateConversationLinksFailed\",UPDATE_LWJ_LINKS:\"UpdateLwjLinks\",UPDATE_LWJ_LINKS_SUCCESS:\"UpdateLwjLinksSuccess\",UPDATE_LWJ_LINKS_FAILED:\"UpdateLwjLinksFailed\",PROCESS_INITIAL_OFFER:\"ProcessInitialOffer\",SEND_PROGRESS:\"SendProgress\",SEND_PROGRESS_FAILED:\"SendProgressFailed\",PROCESS_CALL_ACCEPTANCE:\"ProcessCallAcceptance\",PROCESS_LWJ_ACCEPTANCE:\"ProcessLwjAcceptance\",ACCEPTANCE_USER_IN_LOBBY:\"AcceptanceUserInLobby\",REJECT_INCOMING_CALL:\"RejectIncomingCall\",SEND_KEEP_ALIVE:\"SendKeepAlive\",SEND_KEEP_ALIVE_LWJ:\"SendKeepAliveLwj\",SEND_KEEP_ALIVE_FAILED:\"SendKeepAliveFailed\",SEND_CONVERSATION_KEEP_ALIVE_FAILED:\"SendConversationKeepAliveFailed\",SEND_KEEP_ALIVE_LWJ_FAILED:\"SendKeepAliveLwjFailed\",START_AUDIO:\"StartAudio\",STOP_AUDIO:\"StopAudio\",UPDATE_MEETING_ROLE:\"UpdateMeetingRole\",UPDATE_MEETING_ROLE_TIMEOUT:\"UpdateMeetingRoleTimeout\",PREHEAT_ENABLING:\"EnablingPreheat\",PREHEAT_DISABLING:\"DisablingPreheat\",PREHEAT_DISABLED:\"PreheatDisabled\",TRANSFER_REQUEST_SENT:\"TransferRequestSent\",CALL_REDIRECT_REQUEST_SENT:\"CallRedirectRequestSent\",TRANSFER_REQUEST_FAILED:\"TransferRequestFailed\",SEND_ACCEPT_TRANSFER:\"SendAcceptTransfer\",SEND_ACCEPT_TRANSFER_FAIL:\"SendAcceptTransferFail\",WAITING_FOR_TRANSFER_COMPLETION:\"WaitingForTransferCompletion\",WAITING_FOR_TRANSFER_COMPLETION_FAIL:\"WaitingForTransferCompletionFail\",WAITING_FOR_TRANSFER_ACCEPTANCE_FAIL:\"WaitingForTransferAcceptanceFail\",WAITING_FOR_TRANSFER_ACCEPTANCE:\"WaitingForTransferAcceptance\",TRANSFER_COMPLETED:\"TransferCompleted\",SEND_COMPLETE_TRANSFER:\"SendCompleteTransfer\",SEND_COMPLETE_TRANSFER_FAILED:\"SendCompleteTransferFailed\",PICKUP_CODE_SET:\"PickupCodeSet\",ADD_PARTICIPANT_WITH_PICKUP_CODE:\"AddParticipantWithPickupCode\",ADD_PARTICIPANT_WITH_PICKUP_CODE_TIMEOUT:\"AddParticipantWithPickupCodeTimeout\",PUBLISH_STATE:\"PublishState\",PUBLISH_STATE_FAILURE:\"PublishStateFailure\",REMOVE_STATE:\"RemoveState\",REMOVE_STATE_FAILURE:\"RemoveStateFailure\",UPDATE_MEETING_SETTINGS:\"UpdateMeetingSettings\",UPDATE_MEETING_SETTINGS_FAILURE:\"UpdateMeetingSettingsFailure\",UPDATE_ENDPOINT_METADATA_SUCCESS:\"UpdateEndpointMetadataSuccess\",UPDATE_ENDPOINT_METADATA_FAILURE:\"UpdateEndpointMetadataFailure\",SEARCH_PARTICIPANTS:\"SearchParticipants\",GET_ALL_PARTICIPANTS:\"GetAllParticipants\",SEARCH_PARTICIPANTS_FAILURE:\"SearchParticipantsFailure\",GET_ALL_PARTICIPANTS_FAILURE:\"GetAllParticipantsFailure\",PARK_REQUEST:\"SendParkRequest\",PARK_REQUEST_FAILED:\"ParkRequestFailed\",WAITING_FOR_PARK_COMPLETION:\"WaitingForParkCompletion\",WAITING_FOR_PARK_COMPLETION_TIMEOUT:\"WaitingForParkCompletionTimeout\",PARK_COMPLETED:\"ParkCompleted\",PARK_FAILED:\"ParkFailed\",SEND_UNPARK_REQUEST:\"SendUnparkRequest\",UNPARK_REQUEST_FAILED:\"UnparkRequestFailed\",WAITING_FOR_UNPARK_COMPLETION:\"WaitingForUnparkCompletion\",WAITING_FOR_UNPARK_COMPLETION_TIMEOUT:\"WaitingForUnparkCompletionTimeout\",UNPARK_COMPLETED:\"UnparkCompleted\",UNPARK_FAILED:\"UnparkFailed\",UPDATE_MEETING_LIVE_STATE:\"UpdateMeetingLiveState\",WAITING_FOR_UPDATE_MEETING_LIVE_STATE_COMPLETION:\"WaitingForUpdateMeetingLiveStateCompletion\",UPDATE_MEETING_LIVE_STATE_REQUEST_FAILED:\"UpdateMeetingLiveStateRequestFailed\",UPDATE_MEETING_LIVE_STATE_RESPONSE_FAILURE:\"UpdateMeetingLiveStateResponseFailure\",UPDATE_MEETING_LIVE_STATE_RESPONSE_SUCCESS:\"UpdateMeetingLiveStateResponseSuccess\",UPDATE_MEETING_GROUPS:\"UpdateMeetingGroups\",UPDATE_PARTICIPANT_INTERPRETATION_STATE:\"UpdateParticipantInterpretationState\",JOIN_MEETING_GROUP:\"JoinMeetingGroup\",LEAVE_MEETING_GROUP:\"LeaveMeetingGroup\",WAITING_FOR_UPDATE_MEETING_GROUPS_COMPLETION:\"WaitingForUpdateMeetingGroupsCompletion\",UPDATE_MEETING_GROUPS_REQUEST_FAILED:\"UpdateMeetingGroupsRequestFailed\",UPDATE_MEETING_GROUPS_REQUEST_COMPLETED:\"UpdateMeetingGroupsRequestCompleted\",UPDATE_MEETING_GROUPS_RESPONSE_FAILURE:\"UpdateMeetingGroupsRequestFailure\",UPDATE_MEETING_GROUPS_RESPONSE_SUCCESS:\"UpdateMeetingGroupsResponseSuccess\",SET_MEETING_LAYOUT:\"SetMeetingLayout\",WAITING_FOR_SET_MEETING_LAYOUT_COMPLETION:\"WaitingForSetMeetingLayoutCompletion\",SET_MEETING_LAYOUT_REQUEST_FAILED:\"SetMeetingLayoutRequestFailed\",SET_MEETING_LAYOUT_RESPONSE_FAILURE:\"SetMeetingLayoutResponseFailure\",SET_MEETING_LAYOUT_RESPONSE_SUCCESS:\"SetMeetingLayoutResponseSuccess\",WAITING_FOR_UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION:\"WaitingForUpdateParticipantInterpretationStateCompletion\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT:\"UpdateParticipantInterpretationStateTimeout\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_REQUEST_FAILED:\"UpdateParticipantInterpretationStateRequestFailed\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_REQUEST_COMPLETED:\"UpdateParticipantInterpretationStateRequestCompleted\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_FAILED:\"UpdateParticipantInterpretationStateResponseFailed\",UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_COMPLETED:\"UpdateParticipantInterpretationStateResponseCompleted\",WAITING_FOR_JOIN_MEETING_GROUP_COMPLETION:\"WaitingForJoinMeetingGroupCompletion\",JOIN_MEETING_GROUP_REQUEST_FAILED:\"JoinMeetingGroupRequestFailed\",JOIN_MEETING_GROUP_REQUEST_COMPLETED:\"JoinMeetingGroupRequestCompleted\",JOIN_MEETING_GROUP_RESPONSE_FAILED:\"JoinMeetingGroupRequestFailed\",JOIN_MEETING_GROUP_RESPONSE_COMPLETED:\"JoinMeetingGroupRequestCompleted\",WAITING_FOR_LEAVE_MEETING_GROUP_COMPLETION:\"WaitingForLeaveMeetingGroupCompletion\",LEAVE_MEETING_GROUP_REQUEST_FAILED:\"LeaveMeetingGroupRequestFailed\",LEAVE_MEETING_GROUP_REQUEST_COMPLETED:\"LeaveMeetingGroupRequestCompleted\",LEAVE_MEETING_GROUP_RESPONSE_FAILED:\"LeaveMeetingGroupRequestFailed\",LEAVE_MEETING_GROUP_RESPONSE_COMPLETED:\"LeaveMeetingGroupRequestCompleted\",SUBSCRIBE_URL_FOUND:\"SubscribeUrlFound\",SUBSCRIBE_URL_MISSING:\"SubscribeUrlMissing\"},function(l){l[l.Call=0]=\"Call\",l[l.Conversation=1]=\"Conversation\",l[l.Broker=2]=\"Broker\",l[l.ContentShare=3]=\"ContentShare\",l[l.LMC=4]=\"LMC\",l[l.Unknown=5]=\"Unknown\"}(p=d.CONTROLLER||(d.CONTROLLER={})),d.NETWORK_REQUESTS={SEND_MEDIA_ANSWER:{name:\"SendMediaAnswer\",controller:p.Call},START_RENEGOTIATION:{name:\"StartRenegotiation\",controller:p.Call},SEND_MEDIA_ACKNOWLEDGEMENT:{name:\"SendMediaAcknowledgement\",controller:p.Call},SEND_MEDIA_REJECTION:{name:\"SendMediaRejection\",controller:p.Call},ADD_PARTICIPANT:{name:\"AddParticipant\",controller:p.Conversation},ADD_PARTICIPANT_WITH_REPLACES:{name:\"AddParticipantWithReplaces\",controller:p.Conversation},NUDGE_PARTICIPANT:{name:\"NudgeParticipant\",controller:p.Conversation},REMOVE_PARTICIPANT_NONE:{name:\"RemoveParticipant\",controller:p.Conversation},REMOVE_PARTICIPANT_OTHERS:{name:\"RemoveParticipantOthers\",controller:p.Conversation},REMOVE_PARTICIPANT_SPECIFIED:{name:\"RemoveParticipantSpecified\",controller:p.Conversation},ADMIT_PARTICIPANT:{name:\"AdmitParticipant\",controller:p.Conversation},ADMIT:{name:\"Admit\",controller:p.Conversation},BROKER_SUBSCRIBE:{name:\"BrokerSubscribe\",controller:p.Broker},CALL_ME_BACK:{name:\"CallMeBack\",controller:p.Conversation},SEND_ACCEPTANCE:{name:\"SendAcceptance\",controller:p.Call},SEND_ACCEPTANCE_ACKNOWLEDGEMENT:{name:\"SendAcceptanceAcknowledgement\",controller:p.Call},END_CALL:{name:\"EndCall\",controller:p.Conversation},CANCEL_CALL:{name:\"CancelCall\",controller:p.Conversation},REJECT_CALL:{name:\"RejectCall\",controller:p.Call},JOIN_CONVERSATION:{name:\"JoinConversation\",controller:p.Conversation},JOIN_CONVERSATION_WITHOUT_CALL_MODALITY:{name:\"JoinConversationWithoutCallModality\",controller:p.Conversation},LEAVE_CONVERSATION:{name:\"LeaveConversation\",controller:p.Conversation},DELETE_CONVERSATION:{name:\"DeleteConversation\",controller:p.Conversation},START_CALL:{name:\"StartCall\",controller:p.Conversation},PLACE_NUDGE_CALL:{name:\"PlaceNudgeCall\",controller:p.Unknown},UPDATE_CONVERSATION_LINKS:{name:\"UpdateConversationLinks\",controller:p.Conversation},SEND_CONVERSATION_KEEP_ALIVE:{name:\"SendConversationKeepAlive\",controller:p.Conversation},UPDATE_LWJ_LINKS:{name:\"UpdateLwjLinks\",controller:p.LMC},SEND_CALL_ATTACH:{name:\"SendCallAttach\",controller:p.Call},SEND_CALL_PROGRESS:{name:\"SendCallProgress\",controller:p.Call},SEND_KEEP_ALIVE:{name:\"SendKeepAlive\",controller:p.Call},SEND_KEEP_ALIVE_LWJ:{name:\"SendKeepAliveLwj\",controller:p.Call},ADD_CONTENT_SHARING_MODALITY:{name:\"AddContentSharingModality\",controller:p.Conversation},DELETE_CONTENT_SHARING:{name:\"DeleteContentSharing\",controller:p.ContentShare},TAKE_CONTROL_CONTENT_SHARING:{name:\"TakeControlContentSharing\",controller:p.ContentShare},UPDATE_SESSION_STATE_CONTENT_SHARING:{name:\"UpdateSessionStateContentSharing\",controller:p.ContentShare},JOIN_CONTENT_SHARING:{name:\"JoinContentSharing\",controller:p.ContentShare},UPDATE_PARTICIPANT_STATE_CONTENT_SHARING:{name:\"UpdateParticipantStateContentSharing\",controller:p.ContentShare},UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS:{name:\"UpdateContentSharingNotificationLinks\",controller:p.ContentShare},MUTE_ALL:{name:\"MuteAll\",controller:p.Conversation},MUTE_ALL_SYNC:{name:\"MuteAllSync\",controller:p.Conversation},MUTE_SPECIFIED:{name:\"MuteSpecified\",controller:p.Conversation},MUTE_SPECIFIED_SYNC:{name:\"MuteSpecifiedSync\",controller:p.Conversation},MUTE_MYSELF:{name:\"MuteMyself\",controller:p.Conversation},UNMUTE:{name:\"Unmute\",controller:p.Conversation},UNMUTE_SYNC:{name:\"UnmuteMyselfSync\",controller:p.Conversation},SEND_CONTROL_VIDEO_STREAMING:{name:\"SendControlVideoStreaming\",controller:p.Call},SEND_APPLY_CHANNEL_PARAMETERS:{name:\"SendApplyChannelParameters\",controller:p.Call},APPROVE_UNMUTE:{name:\"ApproveUnmute\",controller:p.Unknown},REJECT_UNMUTE:{name:\"RejectUnmute\",controller:p.Unknown},SEND_CALL_REDIRECT_REQUEST:{name:\"SendCallRedirectRequest\",controller:p.Call},SEND_TRANSFER_REQUEST:{name:\"SendTransferRequest\",controller:p.Call},SEND_PARK_REQUEST:{name:\"SendParkRequest\",controller:p.Call},SEND_SHARED_LINE_PARK_REQUEST:{name:\"SharedLinePark\",controller:p.Call},SEND_SERVER_HOLD_REQUEST:{name:\"ServerHoldRequest\",controller:p.Call},PARK_REQUEST:{name:\"ParkRequest\",controller:p.Call},SEND_UNPARK_REQUEST:{name:\"UnparkRequest\",controller:p.Call},TRANSFER_ACCEPTANCE:{name:\"TransferAcceptance\",controller:p.Call},TRANSFER_COMPLETION:{name:\"TransferCompletion\",controller:p.Call},TRANSFER_COMPLETION_FAILED:{name:\"TransferCompletionFailed\",controller:p.Call},UPDATE_ENDPOINT_STATE:{name:\"UpdateEndpointState\",controller:p.Conversation},DISABLE_PREHEAT:{name:\"DisablePreheat\",controller:p.Unknown},REQUEST_NEW_OFFER:{name:\"RequestNewOffer\",controller:p.Call},UPDATE_ENDPOINT_METADATA:{name:\"UpdateEndpointMetadata\",controller:p.Conversation},UPDATE_MEETING_ROLE_ATTENDEE:{name:\"UpdateMeetingRoleToAttendee\",controller:p.Conversation},UPDATE_MEETING_ROLE_PRESENTER:{name:\"UpdateMeetingRoleToPresenter\",controller:p.Conversation},UPDATE_MEETING_ROLE_ORGANIZER:{name:\"UpdateMeetingRoleToOrganizer\",controller:p.Conversation},ADD_PARTICIPANT_WITH_PICKUP_CODE:{name:\"AddParticipantWithPickupCode\",controller:p.Conversation},PUBLISH_STATE:{name:\"PublishState\",controller:p.Conversation},REMOVE_STATE:{name:\"RemoveState\",controller:p.Conversation},UPDATE_MEETING_SETTINGS:{name:\"UpdateMeetingSettings\",controller:p.Conversation},ADD_PARTICIPANTS_AND_MODALITY:{name:\"AddParticipantsAndModality\",controller:p.Conversation},ADD_BROADCAST_MODALITY:{name:\"AddBroadcastModality\",controller:p.Conversation},SEARCH_PARTICIPANTS:{name:\"SearchParticipants\",controller:p.Conversation},GET_ALL_PARTICIPANTS:{name:\"GetAllParticipants\",controller:p.Conversation},UPDATE_MEETING_LIVE_STATE:{name:\"UpdateMeetingLiveState\",controller:p.Conversation},UPDATE_MEETING_GROUPS:{name:\"UpdateMeetingGroups\",controller:p.Conversation},SET_MEETING_LAYOUT:{name:\"SetMeetingLayout\",controller:p.Conversation},UPDATE_PARTICIPANT_INTERPRETATION_STATE:{name:\"UpdateParticipantInterpretationState\",controller:p.Conversation},JOIN_MEETING_GROUP:{name:\"JoinMeetingGroup\",controller:p.Conversation},LEAVE_MEETING_GROUP:{name:\"LeaveMeetingGroup\",controller:p.Conversation}};var h={EVENT_SOURCE:{TROUTER:\"Trouter\",BROKER:\"Broker\",UDP:\"UDP\",LOCAL:\"Local\"},SOURCE:{NGC_SOURCE:\"SkypeConcore\"},EVENT_TYPE:{CONVERSATION_CALL_MODALITY:\"skypecosi_concore_web_csa_conversation_callmodality\",CONVERSATION_CONTENT_SHARING:\"skypecosi_concore_web_csa_conversation_contentsharing\",CONVERSATION_HTTP_REQUEST:\"skypecosi_concore_web_csa_conversation_httprequest\"},EXTENSIONS:{DATA_VERSION:\"DataVersion\",DIRECTION:\"Direction\",CONTENT_SHARING_DIRECTION:\"ContentSharingDirection\",CONNECTED_DURATION_IN_MS:\"ConnectedDurationInMsecs\",PREHEATED_CALL_SETUP_DURATION_IN_S:\"PreheatedCallSetupDurationInSeconds\",CALL_CANCELATION_DURATION_IN_S:\"CallCancelationDurationInSeconds\",IS_PREHEATED:\"IsPreheated\",TIME_TO_RING_IN_MS:\"TimeToRingInMsecs\",CALL_TERMINATING_END:\"CallTerminatingEnd\",NETWORK_REQUESTS_PENDING:\"NetworkRequestsPending\",NETWORK_REQUESTS_COMPLETED:\"NetworkRequestsCompleted\",LOCAL_OPERATIONS_PERFORMED:\"LocalOperationsPerformed\",TROUTER_WAIT_OPERATIONS:\"TrouterWaitOperations\",CALL_START_TIME:\"CallStartTime\",CALL_END_TIME:\"CallEndTime\",IS_GROUP_CALL:\"IsGroupCall\",IS_HOSTLESS_CALL:\"IsHostLessCall\",IS_CAST_CALL:\"IsCastCall\",IS_MEETUP_CALL:\"IsMeetupCall\",IS_ON_BEHALF_OF_CALL:\"IsOnBehalfOfCall\",IS_SDP_IN_CALL_NOTIFICATION:\"SdpInCallNotification\",CALL_END_CODE:\"Code\",CALL_END_SUB_CODE:\"SubCode\",CALL_PHRASE:\"Phrase\",CALL_END_RESULT_CATEGORIES:\"ResultCategories\",CALL_END_CAUSE_ID:\"CauseId\",CONTENT_SHARING_END_CODE:\"ContentSharingEndReasonServiceCode\",CONTENT_SHARING_END_SUB_CODE:\"ContentSharingEndReasonServiceSubCode\",CONVERSATION_SERVICE_URL:\"ConversationServiceUrl\",CONTENT_SHARING_SERVICE_URL:\"ContentSharingServiceUrl\",MEETING_INFO:\"MeetingInfo\",JOINED_FROM:\"JoinedFrom\",RESULT_VALUE:\"ResultValue\",RESULT_DETAIL:\"ResultDetail\",RESULT_CAUSE_ID:\"ResultCauseId\",RESULT_CODE:\"ResultCode\",LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS:\"LocalOfferAnswerGenerationTimestamps\",SELF_PARTICIPANT_ROLE:\"SelfParticipantRole\",SCENARIO:\"Scenario\",CALLER_TYPE:\"Caller_Type\",CALLEE_TYPE:\"Callee_Type\",CALL_TYPE:\"Call_Type\",TEST_CONTEXT_ID:\"Test_Context_Id\",OUTGOING_MODALITIES:\"Outgoing_Modalities\",INCOMING_MODALITIES:\"Incoming_Modalities\",OFFERED_MODALITIES:\"CallOfferredModalities\",ANSWERED_MODALITIES:\"CallAnsweredModalities\",VBSS_OPERATIONS:\"VBSS_Operations\",CHANGING_CORRELATION_ID_NEW_ID:\"ChangingCorrelationId_NewId\",CHANGING_CORRELATION_ID_OLD_ID:\"ChangingCorrelationId_OldId\",MESSAGING_CHANNEL:\"MessagingChannel\",EVENT_TIMESTAMP_BAG:\"EventTimestampBag\",ROSTER_UPDATES_BAG:\"RosterUpdatesBag\",NETWORK_REQUESTS_BAG:\"NetworkRequestBag\",CLIENT_INFORMATION:\"ClientInformation\",ECS_ETAG:\"EcsEtag\",APPLICATION_TYPE:\"ApplicationType\",RING:\"Ring\",TENANT_ID:\"TenantId\",USER_HEX_CID:\"UserHexCID\",ACS_RESOURCE_ID:\"AcsResourceId\",REGION:\"Region\",PARTITION:\"Partition\",CALL_END_CLIENT_SUB_CODE:\"CallEventCallEndClientSubCode\",CALL_END_CLIENT_PHRASE:\"CallEventCallEndClientPhrase\"},MESSAGING_CHANNEL:{TROUTER:\"Trouter\",BROKER:\"Broker\"},SIGNALING_CONFIG:\"JsCsaConfig\",SIGNALING_CONFIG_FLAGS:{BROKER_OUTGOING_ENABLED:\"BrokerOutgoingEnabled\",BROKER_INCOMING_ENABLED:\"BrokerIncomingEnabled\",BROKER_REQUEST_BATCHING_ENABLED:\"BrokerRequestBatchingEnabled\",BROKER_EXCLUSIVELY_ENABLED:\"BrokerExclusivelyEnabled\",SUPPORTS_COMPRESSED_PAYLOAD:\"SupportsCompressedPayload\",SYNC_TROUTER_RESPONSE:\"SyncTrouterResponse\",SERVER_MUTE_UNMUTE:\"serverMuteUnmute\",HANDLE_OFFER_FROM_NOTIFICATION:\"handleMediaOfferFromPushNotification\",HANDLE_NEW_OFFER_REQUEST:\"handleNewOfferRequest\",SEND_PROGRESS_FROM_CC:\"sendProgressFromCC\",HANDLE_UNMUTE_MUTE_FROM_RESPONSE:\"handleUnmuteMuteFromResponse\",INTERNAL_HTTP_DISPATCHER:\"internalHttpDispatcher\",ENABLE_TOKEN_CACHE:\"enableTokenCache\",ENABLE_TOKEN_PREFETCH:\"enableTokenPrefetch\",REQUEST_HEDGING:\"requestHedging\",PROCESS_SELF_DATA_FROM_SUBSCRIBE_RESPONSE:\"processSelfDataFromSubscribeResponse\",SUPPORT_MEDIA_RETARGET_WHILE_INCOMING_RENEGOTIATION:\"supportMediaRetargetWhileIncomingRenegotiation\",ENABLE_ERROR_CODE_IMPROVEMENTS_FOR_NETWORK_FAILURES:\"enableErrorCodeImprovementsForNetworkFailures\",ENABLE_CALL_ESTABLISHMENT_TIMEOUTS_FOR_START_OR_JOIN_CALL:\"enableCallEstablishmentTimeoutsForStartJoinCall\"},CONTEXT_ID:{CORRELATION_ID:\"CorrelationId\",SHARED_CORRELATION_ID:\"SharedCorrelationId\",SIGNALING_SESSION_ID:\"SignalingSessionId\",GROUP_ID:\"GroupId\",THREAD_ID:\"ThreadId\",TEAMS_MESSAGEID:\"TeamsMessageId\",TEAMS_MEETINGINFO:\"TeamsMeetingInfo\",ENDPOINT_ID:\"EndpointId\",PARTICIPANT_ID:\"ParticipantId\",DATA_VERSION:\"DataVersion\",CONTENT_SHARING_ID:\"ContentSharingSessionId\",CONTENT_SHARING_CORRELATION_ID:\"ContentSharingCorrelationId\"},CALL_TERMINATING_END:{LOCAL:\"Local\",REMOTE:\"Remote\"},RESULT_VALUE:{SUCCESS:\"Success\",FAILURE:\"Failure\"},DIRECTION:{INCOMING:\"Incoming\",OUTGOING:\"Outgoing\"},ROLE:{CALLER:\"caller\",CALLEE:\"callee\",JOIN:\"join\",JOIN_FOR_ROSTER_ONLY:\"joinForRosterOnly\",PREHEAT:\"preheat\"},VBSS_OPERATION:{START:\"Start\",STOP:\"Stop\",REJECTED:\"Rejected\",REMOTE_START:\"RemoteStart\",TIMEOUT:\"Timeout\",CALL_END:\"CallEnd\"},LOCAL_OFFER_ANSWER_OPERATIONS:{INITIAL_OFFER_GENERATION_STARTED:\"InitialOfferGenerationStarted\",INITIAL_OFFER_GENERATION_ENDED:\"InitialOfferGenerationEnded\",FINAL_ANSWER_PROCESSING_STARTED:\"FinalAnswerProcessingStarted\",FINAL_ANSWER_PROCESSING_ENDED:\"FinalAnswerProcessingEnded\",PROVISIONAL_ANSWER_PROCESSING_STARTED:\"ProvisonalAnswerProcessingStarted\",PROVISIONAL_ANSWER_PROCESSING_ENDED:\"ProvisonalAnswerProcessingEnded\",NEGOTIATION_COMPLETED:\"NegotiationCompleted\",INITIAL_OFFER_PROCESSING_STARTED:\"InitialOfferProcessingStarted\",INITIAL_OFFER_PROCESSING_ENDED:\"InitialOfferProcessingEnded\",FINAL_ANSWER_GENERATION_STARTED:\"FinalAnswerGenerationStarted\",FINAL_ANSWER_GENERATION_ENDED:\"FinalAnswerGenerationEnded\",PROVISIONAL_ANSWER_GENERATION_STARTED:\"ProvisionalAnswerGenerationStarted\",PROVISIONAL_ANSWER_GENERATION_ENDED:\"ProvisionalAnswerGenerationEnded\",RENEGOTIATION_OFFER_GENERATION_STARTED:\"RenegotiationOfferGenerationStarted\",RENEGOTIATION_OFFER_GENERATION_ENDED:\"RenegotiationOfferGenerationEnded\",RENEGOTIATION_ANSWER_PROCESSING_STARTED:\"RenegotiationAnswerProcessingStarted\",RENEGOTIATION_ANSWER_PROCESSING_ENDED:\"RenegotiationAnswerProcessingEnded\",RENEGOTIATION_OFFER_PROCESSING_STARTED:\"RenegotiationOfferProcessingStarted\",RENEGOTIATION_OFFER_PROCESSING_ENDED:\"RenegotiationOfferProcessingEnded\",RENEGOTIATION_ANSWER_GENERATION_STARTED:\"RenegotiationAnswerGenerationStarted\",RENEGOTIATION_ANSWER_GENERATION_ENDED:\"RenegotiationAnswerGenerationEnded\"},TROUTER_WAIT_OPERATION:{STARTED:\"Started\",ENDED:\"Ended\",FAILED:\"Failed\"}};d.default=h},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.ResolutionInfo=void 0;var h=16;function createResolutionTable(l){return l.map((function(l){return new g(l.w,l.h,l.minBr,l.maxBr)}))}var g=function(){function ResolutionInfo(l,d,u,p){void 0===u&&(u=0),void 0===p&&(p=0),this.width=l,this.height=d,this.minBitrate=u,this.maxBitrate=p,this.fs=Math.ceil(l/h)*Math.ceil(d/h)}return ResolutionInfo.prototype.toString=function(){return this.height?\"\".concat(this.height,\"p\"):\"\".concat(this.fs,\"fs\")},ResolutionInfo}();d.ResolutionInfo=g;var f=function(){function ResolutionTable(l){this.resolutions=[new g(320,180,2e4,2e5),new g(426,240,16e4,5e5),new g(640,360,4e5,12e5),new g(960,540,11e5,18e5),new g(1280,720,15e5,25e5),new g(1920,1080,18e5,1e8)],l&&(this.resolutions=createResolutionTable(l))}return Object.defineProperty(ResolutionTable.prototype,\"initialResolution\",{get:function(){return this.resolutions[this.resolutions.length-1]},enumerable:!1,configurable:!0}),ResolutionTable.prototype.getResolutionByFs=function(l){for(var d=this.resolutions.length-1;d>=0;d--)if(this.resolutions[d].fs<=l)return this.resolutions[d];return this.resolutions[0]},ResolutionTable.prototype.getMaxFS=function(l,d){return this.getResolutionRecord(l,d).fs},ResolutionTable.prototype.getResolutionForBitrate=function(l){return{lowRes:this.resolutions.filter((function(d){return d.maxBitrate&&d.maxBitrate>=l})).shift(),highRes:this.resolutions.filter((function(d){return d.minBitrate&&d.minBitrate<=l})).pop()}},ResolutionTable.prototype.getBitrateForResolution=function(l,d){var u=this.getResolutionRecord(l,d);return{minBitrate:u.minBitrate,maxBitrate:u.maxBitrate}},ResolutionTable.prototype.getResolutionForHeight=function(l){for(var d=0;d<this.resolutions.length;d++){if(this.resolutions[d].height>l)return this.resolutions[d-1]}},ResolutionTable.prototype.getResolutionRecord=function(l,d){var u,h,g=Math.max(l,d),f=Math.min(l,d);try{for(var m=p(this.resolutions),v=m.next();!v.done;v=m.next()){var y=v.value;if(y.width>=g&&y.height>=f)return y}}catch(l){u={error:l}}finally{try{v&&!v.done&&(h=m.return)&&h.call(m)}finally{if(u)throw u.error}}return this.resolutions[this.resolutions.length-1]},ResolutionTable.prototype.getResolutions=function(){return this.resolutions},ResolutionTable}();d.default=f},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.UserAgentConfig=void 0;var f=u(19),m=u(3),v=u(7),y=u(15),S=function(l){function UserAgentConfig(d){var u=l.call(this)||this;return u.configProvider=d,u.isAudioOutputSelectionSupportedValue=!1,u.configProvider.on(\"configUpdated\",(function(){return u.updateConfig()})),u.updateConfig(),u.hasRollbackSupported(),u}return p(UserAgentConfig,l),Object.defineProperty(UserAgentConfig.prototype,\"isAudioOutputSelectionSupported\",{get:function(){return this.isAudioOutputSelectionSupportedValue},enumerable:!1,configurable:!0}),Object.defineProperty(UserAgentConfig.prototype,\"isBrowserRollbackSupported\",{get:function(){return this.isBrowserRollbackSupportedValue},enumerable:!1,configurable:!0}),UserAgentConfig.hasApplyConstraints=function(){return void 0!==MediaStreamTrack.prototype.applyConstraints},UserAgentConfig.hasPermissionsApi=function(){return void 0!==navigator.permissions&&\"Firefox\"!==(0,f.getBrowserInfo)().name},Object.defineProperty(UserAgentConfig,\"hardwareConcurrency\",{get:function(){return window.navigator.hardwareConcurrency},enumerable:!1,configurable:!0}),Object.defineProperty(UserAgentConfig,\"unmaskedGlRenderer\",{get:function(){if(this.renderer)return this.renderer===m.default.MEDIA_ERROR.webGlRendererError?void 0:this.renderer;try{var l=document.createElement(\"canvas\").getContext(\"webgl\"),d=null==l?void 0:l.getExtension(\"WEBGL_debug_renderer_info\"),u=d&&l.getParameter(d.UNMASKED_RENDERER_WEBGL);return this.renderer=u,u}catch(l){return void(this.renderer=m.default.MEDIA_ERROR.webGlRendererError)}},enumerable:!1,configurable:!0}),UserAgentConfig.prototype.hasRollbackSupported=function(){return h(this,void 0,void 0,(function(){var l,d;return g(this,(function(u){switch(u.label){case 0:l=y.default.window.RTCPeerConnection&&new y.default.window.RTCPeerConnection,u.label=1;case 1:return u.trys.push([1,6,7,8]),l?[4,l.createOffer()]:[3,5];case 2:return d=u.sent(),[4,l.setLocalDescription(d)];case 3:return u.sent(),[4,l.setLocalDescription({type:\"rollback\"})];case 4:u.sent(),this.isBrowserRollbackSupportedValue=!0,u.label=5;case 5:return[3,8];case 6:return u.sent(),this.isBrowserRollbackSupportedValue=!1,[3,8];case 7:return l&&l.close(),[7];case 8:return[2]}}))}))},UserAgentConfig.hasH264CodecSupport=function(l){return h(this,void 0,void 0,(function(){var d,u,p;return g(this,(function(h){switch(h.label){case 0:if(UserAgentConfig.isEdge)return[2,!0];if(d=\"v=0\\no=- 596983 0 IN IP4 127.0.0.1\\ns=session\\nc=IN IP4 0.0.0.0\\nt=0 0\\na=msid-semantic: WMS *\\nm=video 3480 RTP/SAVPF 107 99\\na=rtpmap:107 H264/90000\\na=rtpmap:99 rtx/90000\\na=fmtp:107 max-fs=240;max-mbps=3600;max-br=208;max-fps=1500;profile-level-id=42C02A;packetization-mode=1\\na=fmtp:99 apt=107\\na=setup:actpass\\na=mid:video\\na=recvonly\\na=rtcp-mux\\na=ice-ufrag:CvYq\\na=ice-pwd:axsjsa0GOz3kz6TuGvNgJZWO\\na=fingerprint:sha-256 34:DF:5C:15:60:FF:28:3E:E8:96:4B:F8:85:61:E4:C0:57:D1:60:82:21:FD:BC:D2:90:41:06:FA:03:FD:12:A2\\n\",!(u=y.default.window.RTCPeerConnection&&new y.default.window.RTCPeerConnection))return[2,!1];h.label=1;case 1:return h.trys.push([1,3,4,5]),[4,u.setRemoteDescription({sdp:d,type:\"offer\"})];case 2:return h.sent(),[2,!0];case 3:return p=h.sent(),l.error(\"H264 not supported\",p),[2,!1];case 4:try{u.close()}catch(l){}return[7];case 5:return[2]}}))}))},UserAgentConfig.hasMediaApi=function(){return navigator.getUserMedia&&(void 0!==y.default.window.RTCIceGatherer||\"undefined\"!=typeof RTCPeerConnection)},UserAgentConfig.hasCapabilitiesApi=function(){return y.default.window.RTCRtpReceiver&&y.default.window.RTCRtpReceiver.getCapabilities},UserAgentConfig.isAudioOutputSelectionSupportedByBrowser=function(){return void 0!==y.default.window&&void 0!==y.default.window.HTMLAudioElement&&void 0!==y.default.window.HTMLAudioElement.prototype.setSinkId&&(!UserAgentConfig.isEdge||UserAgentConfig.isEdgeRS5)},UserAgentConfig.prototype.updateConfig=function(){var l=UserAgentConfig.isAudioOutputSelectionSupportedByBrowser()&&(!UserAgentConfig.isEdgeRS5||this.configProvider.config.ortcAudioOutputSelectionEnabled);l!==this.isAudioOutputSelectionSupportedValue&&(this.isAudioOutputSelectionSupportedValue=l,this.event(\"isAudioOutputSelectionSupportedChanged\").raise())},UserAgentConfig.hasUnifiedPlanSupport=function(){var l;try{l=y.default.window.RTCPeerConnection&&new y.default.window.RTCPeerConnection({sdpSemantics:\"unified-plan\"})}catch(l){return!1}var d=!1;return l&&(d=!!l.addTransceiver,l.close()),d},UserAgentConfig.isEdge=\"Edge\"===(0,f.getBrowserInfo)().name,UserAgentConfig.isEdgeRS5=UserAgentConfig.isEdge&&parseInt((0,f.getBrowserInfo)().version.split(\".\")[0],10)>=18,UserAgentConfig}(v.default);d.UserAgentConfig=S},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.Constants=d.Helper=d.MediaAgent=void 0;var p=u(3),h=u(9);d.Helper=h;var g=u(348);Object.defineProperty(d,\"MediaAgent\",{enumerable:!0,get:function(){return g.default}}),d.Constants=p.default},function(l,d,u){var p;Object.defineProperty(d,\"__esModule\",{value:!0}),d.SettablePromise=d.SettablePromiseState=void 0,function(l){l[l.Pending=0]=\"Pending\",l[l.Rejected=1]=\"Rejected\",l[l.Resolved=2]=\"Resolved\"}(p=d.SettablePromiseState||(d.SettablePromiseState={}));var h=function(){function SettablePromise(){var l=this;this.stateInt=p.Pending,this.promiseInt=new Promise((function(d,u){l.resolveInt=d,l.rejectInt=u}))}return Object.defineProperty(SettablePromise.prototype,\"state\",{get:function(){return this.stateInt},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,\"resolve\",{get:function(){var l=this;return function(d){l.stateInt=p.Resolved,l.resolveInt(d)}},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,\"reject\",{get:function(){var l=this;return function(d){l.stateInt=p.Rejected,l.rejectInt(d)}},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,\"promise\",{get:function(){return this.promiseInt},enumerable:!1,configurable:!0}),Object.defineProperty(SettablePromise.prototype,\"isPending\",{get:function(){return this.stateInt===p.Pending},enumerable:!1,configurable:!0}),SettablePromise}();d.SettablePromise=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.PromiseQueue=void 0;var p=u(29),h=u(1),g=u(13),f=function(){function PromiseQueue(l){this.logger=l,this.queue=Promise.resolve()}return PromiseQueue.prototype.add=function(l,d){var u,f=this;void 0===d&&(d=(0,g.generateCauseId)()),u=l instanceof p.SettablePromise?function(){return l.promise}:l;var m=this.queue.then(u);return this.queue=m.catch((function(l){f.queue&&f.logger.safe.error(\"[\".concat(d,\"] Error from promiseQueue! \").concat(h.stringifyObject(l)))})),m},PromiseQueue.prototype.dispose=function(){this.queue=null},PromiseQueue}();d.PromiseQueue=f},function(l,d,u){(function(l){u.d(d,\"a\",(function(){return getGlobal})),u.d(d,\"c\",(function(){return throwTypeError})),u.d(d,\"b\",(function(){return objCreateFn}));var p=u(2),h=null;function getGlobal(d){return void 0===d&&(d=!0),h&&d||(typeof globalThis!==p.l&&globalThis&&(h=globalThis),typeof self!==p.l&&self&&(h=self),typeof window!==p.l&&window&&(h=window),typeof l!==p.l&&l&&(h=l)),h}function throwTypeError(l){throw new TypeError(l)}function objCreateFn(l){var d=p.c;if(d)return d(l);if(null==l)return{};var u=typeof l;function tmpFunc(){}return u!==p.j&&u!==p.h&&throwTypeError(\"Object prototype may only be an Object:\"+l),tmpFunc[p.k]=l,new tmpFunc}}).call(this,u(63))},,function(l,u){l.exports=d},function(l,d,u){function getTsCallingVersion(){return\"2022.22.01.18\"}function getOvb(){return\"3ae178ba390f45b056ea382822633c738614d57b\"}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getOvb=d.getTsCallingVersion=void 0,d.getTsCallingVersion=getTsCallingVersion,d.getOvb=getOvb},function(l,d,u){function getRandomizedTimeout(l){var d=Math.floor(11*Math.random())+10;return Math.floor(l*(1-d/100))}function isStringBase64(l){if(!l)return!1;try{return atob(l),!0}catch(l){return!1}}function isPromiseLike(l){return!!l&&\"function\"==typeof l.then}function stringifyObject(l){if(!l)return\"\".concat(l);if(l instanceof Map)return mapToString(l);var d=l.toString();return d.endsWith(\"[object Object]\")?JSON.stringify(l):d}function mapToString(l){var d={};return l.forEach((function(l,u){d[u.toString()]=l})),JSON.stringify(d)}function stringToBuffer(l){for(var d=new ArrayBuffer(l.length),u=new Uint8Array(d),p=0;p<l.length;p++)u[p]=l.charCodeAt(p);return u}Object.defineProperty(d,\"__esModule\",{value:!0}),d.stringToBuffer=d.stringifyObject=d.isPromiseLike=d.isStringBase64=d.getRandomizedTimeout=void 0,d.getRandomizedTimeout=getRandomizedTimeout,d.isStringBase64=isStringBase64,d.isPromiseLike=isPromiseLike,d.stringifyObject=stringifyObject,d.stringToBuffer=stringToBuffer},function(l,d,u){u.d(d,\"a\",(function(){return y}));var p=u(44),h=u(43),g=u(21),f=u(0),m=u(11),v=function(){function TelemetryPluginChain(l,d){var u=this,p=null,v=Object(f.o)(l.processTelemetry),y=Object(f.o)(l.setNextPlugin);u._hasRun=!1,u.getPlugin=function(){return l},u.getNext=function(){return p},u.setNext=function(l){p=l},u.processTelemetry=function(f,S){S||(S=d);var _=l?l.identifier:\"TelemetryPluginChain\";Object(h.b)(S?S.core():null,(function(){return _+\":processTelemetry\"}),(function(){if(l&&v){u._hasRun=!0;try{S.setNext(p),y&&l.setNextPlugin(p),p&&(p._hasRun=!1),l.processTelemetry(f,S)}catch(u){var d=p&&p._hasRun;p&&d||S.diagLog().throwInternal(g.a.CRITICAL,g.b.PluginException,\"Plugin [\"+l.identifier+\"] failed during processTelemetry - \"+Object(m.a)(u)),p&&!d&&p.processTelemetry(f,S)}}else p&&(u._hasRun=!0,p.processTelemetry(f,S))}),(function(){return{item:f}}),!f.sync)}}return TelemetryPluginChain}();function _createProxyChain(l,d){var u=[];if(l&&l.length>0)for(var p=null,h=0;h<l.length;h++){var g=l[h];if(g&&Object(f.o)(g.processTelemetry)){var m=new v(g,d);u.push(m),p&&p.setNext(m),p=m}}return u.length>0?u[0]:null}function _copyProxyChain(l,d,u){var p=[],h=!u;if(l)for(;l;){var g=l.getPlugin();(h||g===u)&&(h=!0,p.push(g)),l=l.getNext()}return h||p.push(u),_createProxyChain(p,d)}function _copyPluginChain(l,d,u){var p=l,h=!1;return u&&l&&(p=[],Object(f.a)(l,(function(l){(h||l===u)&&(h=!0,p.push(l))}))),u&&!h&&(p||(p=[]),p.push(u)),_createProxyChain(p,d)}var y=function(){function ProcessTelemetryContext(l,d,u,h){var g=this,m=null;null!==h&&(l&&Object(f.o)(l.getPlugin)?m=_copyProxyChain(l,g,h||l.getPlugin()):h?m=_copyPluginChain(l,g,h):Object(f.x)(h)&&(m=_createProxyChain(l,g))),g.core=function(){return u},g.diagLog=function(){return Object(p.c)(u,d)},g.getCfg=function(){return d},g.getExtCfg=function(l,u){var p;if(void 0===u&&(u={}),d){var h=d.extensionConfig;h&&l&&(p=h[l])}return p||u},g.getConfig=function(l,u,p){var h;void 0===p&&(p=!1);var m=g.getExtCfg(l,null);return m&&!Object(f.r)(m[u])?h=m[u]:d&&!Object(f.r)(d[u])&&(h=d[u]),Object(f.r)(h)?p:h},g.hasNext=function(){return null!=m},g.getNext=function(){return m},g.setNext=function(l){m=l},g.processNext=function(l){var d=m;d&&(m=d.getNext(),d.processTelemetry(l,g))},g.createNew=function(l,p){return void 0===l&&(l=null),new ProcessTelemetryContext(l||m,d,u,p)}}return ProcessTelemetryContext}()},function(l,d,u){u.d(d,\"a\",(function(){return addEventHandler})),u.d(d,\"d\",(function(){return addPageUnloadEventListener})),u.d(d,\"b\",(function(){return addPageHideEventListener})),u.d(d,\"c\",(function(){return addPageShowEventListener})),u.d(d,\"f\",(function(){return newGuid})),u.d(d,\"h\",(function(){return perfNow})),u.d(d,\"g\",(function(){return newId})),u.d(d,\"e\",(function(){return generateW3CId}));var p,h=u(2),g=u(31),f=u(24),m=u(11),v=u(0),y=u(22),S=\"visibilitychange\",_=\"pagehide\",C=\"pageshow\",E=null;h.l;function addEventHandler(l,d){var u=!1,p=Object(m.k)();p&&(u=Object(v.e)(p,l,d),u=Object(v.e)(p.body,l,d)||u);var h=Object(m.d)();return h&&(u=Object(v.e)(h,l,d)||u),u}function addEventListeners(l,d,u){var p=!1;if(d&&l&&Object(v.k)(l)){var h=[];Object(v.a)(l,(function(l){Object(v.u)(l)&&(u&&-1!==Object(v.b)(u,l)?h.push(l):p=addEventHandler(l,d)||p)})),!p&&h.length>0&&(p=addEventListeners(h,d))}return p}function addPageUnloadEventListener(l,d){return addEventListeners([\"beforeunload\",\"unload\",\"pagehide\"],l,d)}function addPageHideEventListener(l,d){function _handlePageVisibility(d){var u=Object(m.d)();l&&u&&\"hidden\"===u.visibilityState&&l(d)}var u=!1;return d&&-1!==Object(v.b)(d,_)||(u=addEventHandler(_,l)),d&&-1!==Object(v.b)(d,S)||(u=addEventHandler(S,_handlePageVisibility)||u),!u&&d&&(u=addPageHideEventListener(l)),u}function addPageShowEventListener(l,d){function _handlePageVisibility(d){var u=Object(m.d)();l&&u&&\"visible\"===u.visibilityState&&l(d)}var u=!1;return d&&-1!==Object(v.b)(d,C)||(u=addEventHandler(C,l)),d&&-1!==Object(v.b)(d,S)||(u=addEventHandler(S,_handlePageVisibility)||u),!u&&d&&(u=addPageShowEventListener(l)),u}function newGuid(){function randomHexDigit(){return Object(y.d)(15)}return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(b,(function(l){var d=0|randomHexDigit();return(\"x\"===l?d:3&d|8).toString(16)}))}function perfNow(){var l=Object(m.j)();return l&&l.now?l.now():Object(v.f)()}function newId(l){void 0===l&&(l=22);for(var d=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",u=Object(y.c)()>>>0,p=0,h=\"\";h.length<l;)p++,h+=d.charAt(63&u),u>>>=6,5===p&&(u=(Object(y.c)()<<2&4294967295|3&u)>>>0,p=0);return h}function generateW3CId(){for(var l,d=[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"a\",\"b\",\"c\",\"d\",\"e\",\"f\"],u=\"\",p=0;p<4;p++)u+=d[15&(l=Object(y.c)())]+d[l>>4&15]+d[l>>8&15]+d[l>>12&15]+d[l>>16&15]+d[l>>20&15]+d[l>>24&15]+d[l>>28&15];var h=d[8+(3&Object(y.c)())|0];return u.substr(0,8)+u.substr(9,4)+\"4\"+u.substr(13,3)+h+u.substr(16,3)+u.substr(19,12)}var T={_canUseCookies:void 0,isTypeof:v.w,isUndefined:v.x,isNullOrUndefined:v.r,hasOwnProperty:v.j,isFunction:v.o,isObject:v.t,isDate:v.m,isArray:v.k,isError:v.n,isString:v.u,isNumber:v.s,isBoolean:v.l,toISOString:v.J,arrForEach:v.a,arrIndexOf:v.b,arrMap:v.c,arrReduce:v.d,strTrim:v.H,objCreate:g.b,objKeys:v.B,objDefineAccessors:v.y,addEventHandler:addEventHandler,dateNow:v.f,isIE:m.o,disableCookies:disableCookies,newGuid:newGuid,perfNow:perfNow,newId:newId,randomValue:y.d,random32:y.c,mwcRandomSeed:y.b,mwcRandom32:y.a,generateW3CId:generateW3CId},b=/[xy]/g;v.e,v.e,v.g,v.g;function _legacyCookieMgr(l,d){var u=Object(f.a)(l,d),h=T._canUseCookies;return null===E&&(E=[],p=h,Object(v.y)(T,\"_canUseCookies\",(function(){return p}),(function(l){p=l,Object(v.a)(E,(function(d){d.setEnabled(l)}))}))),-1===Object(v.b)(E,u)&&E.push(u),Object(v.l)(h)&&u.setEnabled(h),Object(v.l)(p)&&u.setEnabled(p),u}function disableCookies(){_legacyCookieMgr().setEnabled(!1)}},function(l,d,u){var p=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Int32Array;function _has(l,d){return Object.prototype.hasOwnProperty.call(l,d)}d.assign=function(l){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var u=d.shift();if(u){if(\"object\"!=typeof u)throw new TypeError(u+\"must be non-object\");for(var p in u)_has(u,p)&&(l[p]=u[p])}}return l},d.shrinkBuf=function(l,d){return l.length===d?l:l.subarray?l.subarray(0,d):(l.length=d,l)};var h={arraySet:function(l,d,u,p,h){if(d.subarray&&l.subarray)l.set(d.subarray(u,u+p),h);else for(var g=0;g<p;g++)l[h+g]=d[u+g]},flattenChunks:function(l){var d,u,p,h,g,f;for(p=0,d=0,u=l.length;d<u;d++)p+=l[d].length;for(f=new Uint8Array(p),h=0,d=0,u=l.length;d<u;d++)g=l[d],f.set(g,h),h+=g.length;return f}},g={arraySet:function(l,d,u,p,h){for(var g=0;g<p;g++)l[h+g]=d[u+g]},flattenChunks:function(l){return[].concat.apply([],l)}};d.setTyped=function(l){l?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,h)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,g))},d.setTyped(p)},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getBundle=d.getTypeFromModality=d.getModalities=d.getLabelForModality=d.getModality=d.getModalityForMedia=d.filterCodecs=d.removeCodec=d.forCodec=d.updatePayload=void 0;var p=u(8),h=u(3);function updatePayload(l,d,u){if(l.rtp){var p=l.rtp.filter((function(l){return l.payload===d}))[0];p&&forCodec(l,{name:p.codec,rate:p.rate,payload:p.payload},(function(l){return l.rtp.payload=u,l}))}}function forCodec(l,d,u){l.rtp&&l.rtp.some((function(p,h){var g=p.payload;if(d.name.toLowerCase()!==p.codec.toLowerCase()||d.rate!==p.rate||d.encoding!==p.encoding||d.payload&&d.payload!==p.payload)return!1;var f={rtp:p};l.fmtp=l.fmtp||[];var m=l.fmtp.some((function(l){return p.payload===l.payload&&(f.fmtp=l,!0)}));l.rtcpFb=l.rtcpFb||[],f.rtcpFb=l.rtcpFb.filter((function(l){return l.payload===p.payload&&(f.rtcpFb=l,!0)}));var v=f.rtcpFb.length>0;if(null===u(f))l.payloads=l.payloads.toString().split(\" \").filter((function(l){return p.payload!==+l})).join(\" \"),l.fmtp=l.fmtp.filter((function(l){return p.payload!==l.payload})),l.rtp.splice(h,1);else{if(f.rtp.payload!==g){var y=f.rtp.payload;l.payloads=l.payloads.toString().split(\" \").map((function(l){return+l===g?y:+l})).join(\" \"),f.fmtp&&(f.fmtp.payload=y),f.rtcpFb&&f.rtcpFb.forEach((function(l){return l.payload=y})),l.fmtp.filter((function(l){return l.config&&l.config.indexOf(\"apt=\".concat(g))>-1})).forEach((function(l){return l.config=l.config.replace(\"apt=\".concat(g),\"apt=\".concat(y))}))}!m&&f.fmtp&&l.fmtp.push(f.fmtp),!v&&f.rtcpFb&&f.rtcpFb.forEach((function(d){return l.rtcpFb.push(d)}))}return!0}))}function removeCodec(l,d){if(l.rtp){var u=-1;if(l.rtp.forEach((function(l,p){d.codec.toLowerCase()===l.codec.toLowerCase()&&d.rate===l.rate&&d.encoding===l.encoding&&(u=p)})),u>=0&&l.rtp.length>1){var p=l.rtp[u].payload;l.rtp.splice(u,1),l.payloads=l.payloads.split(\" \").filter((function(l){return p!==+l})).join(\" \"),l.fmtp=l.fmtp&&l.fmtp.filter((function(l){return p!==l.payload}))}}}function isCodecsMatch(l,d,u){if(!p.isUndefined(l.rate)&&l.rate!==d.rate)return!1;if(!p.isUndefined(l.codec)&&l.codec.toLowerCase()!==d.codec.toLowerCase())return!1;if(!p.isUndefined(l.encoding)){if(!p.isUndefined(d.encoding)&&l.encoding!==d.encoding)return!1;if(p.isUndefined(d.encoding)&&1!==l.encoding)return!1}return!!p.isUndefined(l.fmtpLine)||!!(u&&u.find((function(u){return u.payload===d.payload&&-1!==u.config.toLowerCase().indexOf(l.fmtpLine.toLowerCase())})))}function isPayloadMatch(l,d){return d===l||\"*\"===d}function filterCodecs(l,d,u,g){if(l.rtp&&l.rtp.length){var f=l.rtp.filter((function(u){return d.some((function(d){return isCodecsMatch(d,u,l.fmtp)}))}));l.type===h.default.MEDIA_TYPE.video&&(f=f.filter((function(d){var u=l.fmtp&&l.fmtp.find((function(l){return l.payload===d.payload&&l.config.startsWith(\"apt=\")}));if(u){var p=+u.config.split(\";\")[0].split(\"=\")[1];return f.some((function(l){return l.payload===p}))}return!0}))),f.length?(l.rtp=f,u&&(l.rtp=p.flatten(d.map((function(d){return l.rtp.filter((function(u){return isCodecsMatch(d,u,l.fmtp)}))})))),l.payloads=l.rtp.map((function(l){return l.payload})).join(\" \"),l.fmtp=l.fmtp&&l.fmtp.filter((function(d){return l.rtp.some((function(l){return isPayloadMatch(l.payload,d.payload)}))})),l.rtcpFb=l.rtcpFb&&l.rtcpFb.filter((function(d){return l.rtp.some((function(l){return isPayloadMatch(l.payload,d.payload)}))}))):g&&g.warn(\"Empty rtp list after filtering\")}}function getModalityForMedia(l){if(l.label)switch(l.label){case h.default.MEDIA_LABEL.audio:return\"Audio\";case h.default.MEDIA_LABEL.video:return\"Video\";case h.default.MEDIA_LABEL.sharing:return\"ScreenShare\";case h.default.MEDIA_LABEL.data:return\"Data\"}else switch(l.type){case h.default.MEDIA_TYPE.audio:return\"Audio\";case h.default.MEDIA_TYPE.video:return\"Video\";case h.default.MEDIA_TYPE.data:case h.default.MEDIA_TYPE.dataChannel:return\"Data\"}return null}function getModality(l){if(l.label)switch(l.label){case h.default.MEDIA_LABEL.audio:return h.default.MODALITY.audio;case h.default.MEDIA_LABEL.video:return h.default.MODALITY.video;case h.default.MEDIA_LABEL.sharing:return h.default.MODALITY.sharing;case h.default.MEDIA_LABEL.data:return h.default.MODALITY.data}else switch(l.type){case h.default.MEDIA_TYPE.audio:return h.default.MODALITY.audio;case h.default.MEDIA_TYPE.video:return h.default.MODALITY.video;case h.default.MEDIA_TYPE.data:case h.default.MEDIA_TYPE.dataChannel:return h.default.MODALITY.data}return null}function getLabelForModality(l){switch(l){case h.default.MODALITY.audio:return h.default.MEDIA_LABEL.audio;case h.default.MODALITY.video:return h.default.MEDIA_LABEL.video;case h.default.MODALITY.sharing:return h.default.MEDIA_LABEL.sharing;case h.default.MODALITY.data:return h.default.MEDIA_LABEL.data;default:return null}}function getModalities(l){return l.media.reduce((function(l,d){if(0!==d.port){var u=getModality(d);if(!(u in l)){var p=d.direction?d.direction.toLowerCase():h.default.MEDIA_STATE.sendReceive;l[u]=p}}return l}),{})}function getTypeFromModality(l){switch(l){case h.default.MODALITY.audio:return h.default.MEDIA_TYPE.audio;case h.default.MODALITY.video:case h.default.MODALITY.sharing:return h.default.MEDIA_TYPE.video;case h.default.MODALITY.data:return h.default.MEDIA_TYPE.data;default:return null}}function getBundle(l){var d,u=null===(d=l.groups)||void 0===d?void 0:d.find((function(l){return\"BUNDLE\"===l.type}));if(u){var p=u.mids.toString().split(\" \")[0];return l.media.find((function(l){var d=\"number\"==typeof l.mid?l.mid.toString():l.mid;return p===d}))||null}return null}d.updatePayload=updatePayload,d.forCodec=forCodec,d.removeCodec=removeCodec,d.filterCodecs=filterCodecs,d.getModalityForMedia=getModalityForMedia,d.getModality=getModality,d.getLabelForModality=getLabelForModality,d.getModalities=getModalities,d.getTypeFromModality=getTypeFromModality,d.getBundle=getBundle},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();function asap(l){return new Promise((function(d){d(l())}))}Object.defineProperty(d,\"__esModule\",{value:!0}),d.delay=d.timedDefer=d.defer=d.Timer=d.TimeoutError=d.asap=void 0,d.asap=asap;var h=function(l){function TimeoutError(){return null!==l&&l.apply(this,arguments)||this}return p(TimeoutError,l),TimeoutError}(Error);d.TimeoutError=h;var g=function(){function Timer(l){this.ontimeout=l}return Timer.prototype.start=function(l){this.timeoutId=window.setTimeout(this.ontimeout,l)},Timer.prototype.stop=function(){clearTimeout(this.timeoutId)},Timer}();function defer(){var l,d;return{promise:new Promise((function(u,p){l=u,d=p})),resolve:l,reject:d}}function timedDefer(l,d){var u,p;void 0===d&&(d=\"deferred timed out after \".concat(l,\"ms\"));var f=new g((function(){return p(new h(d))})),m=new Promise((function(l,d){u=function(d){f.stop(),l(d)},p=function(l){f.stop(),d(l)}}));return f.start(l),{promise:m,resolve:u,reject:p}}function delay(l){return new Promise((function(d){return setTimeout(d,l)}))}d.Timer=g,d.defer=defer,d.timedDefer=timedDefer,d.delay=delay},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.EMPTY_COUNTS=d.TRANSACTION_END_PHRASE=d.TRANSACTION_END_SUBCODE=d.TRANSACTION_END_CODE=d.UNPARK_CODE=d.TELEMETRY_EVENT_NAMES=d.CALL_REGISTRY_OPERATIONS=d.CONTENT_SHARING_OPERATIONS_INTERNAL=d.CONTENT_SHARING_OPERATIONS=d.PARTICIPANT_OPERATIONS_INTERNAL=d.PARTICIPANT_OPERATIONS=d.MEDIA_EVENT=d.OPERATION_VARIANTS=d.CALL_OPERATIONS_INTERNAL=d.OPERATION_TAGS=d.CALL_OPERATIONS=void 0,function(l){l.INITIALIZE=\"Initialize\",l.START_CALL=\"StartCall\",l.START_TRANSFER_TARGET_CALL=\"StartTransferTargetCall\",l.STOP_CALL=\"StopCall\",l.STOP_CALL_WITH_BEACON=\"StopCallWithBeacon\",l.JOIN_CALL=\"JoinCall\",l.JOIN_PREHEATED_CALL=\"JoinPreheatedCall\",l.SUBSCRIBE=\"Subscribe\",l.START_CALL_TO_VOICE_MAIL=\"StartCallToVoiceMail\",l.ACKNOWLEDGE=\"Acknowledge\",l.ACCEPT=\"Accept\",l.REJECT=\"Reject\",l.START_VIDEO=\"StartVideo\",l.STOP_VIDEO=\"StopVideo\",l.LOCAL_HOLD=\"LocalHold\",l.LOCAL_UNHOLD=\"LocalUnhold\",l.HOLD=\"Hold\",l.UNHOLD=\"Unhold\",l.UPDATE_ENDPOINT_METADATA=\"UpdateEndpointMetadata\",l.SEND_DTMF_TONE=\"SendDtmfTone\",l.SET_AUDIO_USAGE=\"SetAudioUsage\",l.DUMP_VIDEO_SOURCE_IMAGES=\"DumpVideoSourceImages\",l.BLIND_TRANSFER=\"BlindTransfer\",l.SAFE_TRANSFER=\"SafeTransfer\",l.TRANSFER_TO_VOICEMAIL=\"TransferToVoicemail\",l.CALL_REDIRECT=\"CallRedirect\",l.CONSULTATIVE_TRANSFER=\"ConsultativeTransfer\",l.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE=\"ConsultativeTransferWithPickupCode\",l.START_SCREEN_SHARING=\"StartScreenSharing\",l.STOP_SCREEN_SHARING=\"StopScreenSharing\",l.START_DATA_CHANNEL=\"StartDataChannel\",l.STOP_DATA_CHANNEL=\"StopDataChannel\",l.SHARE_SYSTEM_SOUNDS=\"ShareSystemSounds\",l.START_MULTICHANNEL_AUDIO_DEVICE=\"StartMultichannelAudioDevice\",l.STOP_MULTICHANNEL_AUDIO_DEVICE=\"StopMultichannelAudioDevice\",l.START_FACESTREAM=\"StartFaceStream\",l.STOP_FACESTREAM=\"StopfaceStream\",l.MUTE=\"Mute\",l.UNMUTE=\"Unmute\",l.MUTE_SPEAKER=\"MuteSpeaker\",l.UNMUTE_SPEAKER=\"UnmuteSpeaker\",l.MUTE_PARTICIPANTS=\"MuteParticipants\",l.UPDATE_MEETING_ROLE=\"UpdateMeetingRole\",l.START_AUDIO=\"StartAudio\",l.STOP_AUDIO=\"StopAudio\",l.ASSIMILATE=\"Assimilate\",l.SET_MAX_VIDEO_CHANNELS=\"SetMaxVideoChannels\",l.CREATE_CONTENT_SHARING_SESSION=\"CreateContentSharingSession\",l.START_CALL_WITH_NUDGE=\"StartCallWithNudge\",l.START_CALL_AND_UNPARK=\"StartCallAndUnpark\",l.PARK_CALL=\"ParkCall\",l.UNPARK_CALL=\"UnparkCall\",l.NUDGE_PARTICIPANTS=\"NudgeParticipants\",l.LWJ_FALLBACK=\"LwjFallback\",l.ELECTRON_SHOW_CQF_INFO=\"ElectronShowCQFInfo\",l.ELECTRON_IS_CQF_RENDERED=\"ElectronIsCQFRendered\",l.ELECTRON_PROVIDE_CQF=\"ElectronProvideCQF\",l.MERGE_CALL=\"MergeCall\",l.ADD_GROUP_MODALITY=\"AddGroupModality\",l.MERGE_WITH_PICKUP_CODE=\"MergeWithPickupCode\",l.PUBLISH_STATE=\"PublishState\",l.REMOVE_STATE=\"RemoveState\",l.UPDATE_MEETING_SETTINGS=\"UpdateMeetingSettings\",l.MERGE_PARTICIPANT=\"MergeParticipant\",l.MERGE_PARTICIPANTS=\"MergeParticipants\",l.ADMIT=\"Admit\",l.SEARCH_PARTICIPANTS=\"SearchParticipants\",l.GET_ALL_PARTICIPANTS=\"GetAllParticipants\",l.SET_AUDIO_MIDCALL_CONFIG=\"SetAudioMidcallConfig\",l.SET_PARTICIPANT_SPATIAL_POSITIONS=\"SetParticipantSpatialAudioPositions\",l.START_WITH_MEETING_DATA=\"StartWithMeetingData\",l.JOIN_WITH_MEETING_DATA=\"JoinWithMeetingData\",l.SUBSCRIBE_WITH_MEETING_DATA=\"SubscribeWithMeetingData\",l.SET_AUDIO_MIDCALL_CONFIG_JSON=\"SetAudioMidcallConfigJon\",l.GET_TECHNICAL_INFORMATION_JSON=\"getTechnicalInformationJson\",l.UPDATE_MEETING_GROUPS=\"UpdateMeetingGroups\",l.ADD_BROADCAST_MODALITY=\"AddBroadcastModality\",l.UPDATE_MEETING_LIVE_STATE=\"UpdateMeetingLiveState\",l.SET_MEETING_LAYOUT=\"SetMeetingLayout\",l.UPDATE_PARTICIPANT_INTERPRETATION_STATE=\"UpdateParticipantInterpretationState\",l.JOIN_MEETING_GROUP=\"JoinMeetingGroup\",l.LEAVE_MEETING_GROUP=\"LeaveMeetingGroup\",l.SEND_MESSAGES=\"SendMessages\"}(d.CALL_OPERATIONS||(d.CALL_OPERATIONS={})),function(l){l.NOT_SUPPORTED_IN_STREAMING_MODE=\"NOT_SUPPORTED_IN_STREAMING_MODE\"}(d.OPERATION_TAGS||(d.OPERATION_TAGS={})),function(l){l.CALL_START_OR_JOIN_INITIATED=\"_CallStartOrJoinInitiated\",l.INCOMING_INITIALIZE=\"_IncomingInitialize\",l.CALL_ENDED=\"_CallEnded\",l.RECONNECT=\"_Reconnect\",l.RENEGOTIATE=\"_Renegotiate\",l.RENEGOTIATE_OUTGOING=\"_RenegotiateOutgoing\",l.RENEGOTIATE_INCOMING=\"_RenegotiateIncoming\",l.COMPLETE_NEGOTIATION_FAILED=\"_CompleteNegotiationFailed\",l.UPDATE_LOCAL_MEDIA_STATUS=\"_UpdateLocalMediaStatus\",l.START_PREVIEW_VIDEO=\"_StartPreviewVideo\",l.START_LOCAL_VIDEO=\"_StartLocalVideo\",l.SET_LOCAL_VIDEO=\"_SetLocalVideo\",l.SET_LOCAL_AUDIO=\"_SetLocalAudio\",l.CALL_TRANSFER_IN_PROGRESS=\"_CallTransferInProgress\",l.CALL_REDIRECT_IN_PROGRESS=\"_CallRedirectInProgress\",l.ON_TRANSFER_REQUESTED=\"_OnTransferRequested\",l.ON_TRANSFER_REQUESTED_INVALID=\"_OnTransferRequestedInvalid\",l.ON_INCOMING_CALL_REPLACEMENT=\"_onIncomingCallReplacement\",l.GET_CALL_REPLACEMENT_DETAILS=\"_GetCallReplacementDetails\",l.SET_CALL_STATE=\"_SetCallState\",l.SET_TRANSFER_STATE=\"_SetTransferState\",l.SET_PARK_STATE=\"_SetParkState\",l.SET_MUTED=\"_SetMuted\",l.SET_MUTED_SPEAKER=\"_SetMutedSpeaker\",l.SET_SCREEN_SHARING=\"_SetScreenSharing\",l.SET_CALL_ORIGIN=\"_SetCallOrigin\",l.CONNECT_CALL=\"_ConnectCall\",l.WAIT_FOR_ANSWER=\"_WaitForAnswer\",l.MEDIA_ACKNOWLEDGMENT=\"_MediaAcknowledgment\",l.SIGNALING_STATE_CHANGED=\"_SignalingStateChanged\",l.CALL_TERMINATION_INFO=\"_CallTerminationInfo\",l.MEDIA_WHITELISTING_ISSUE_DETECTED=\"_MediaWhiteListingIssueDetected\",l.CALL_ESCALATED_TO_CONFERENCE=\"_CallEscalatedToConference\",l.WEB_ON_OFFER=\"_WebOnOffer\",l.WEB_ON_ANSWER=\"_WebOnAnswer\",l.WEB_ON_RETARGET_SUCCESS=\"_WebRetargetSuccess\",l.WEB_ON_RETARGET_FAILURE=\"_WebRetargetFailure\",l.WEB_ON_ESCALATION_SUCCESS=\"_WebOnEscalationSuccess\",l.WEB_ON_ESCALATION_FAILURE=\"_WebOnEscalationFailure\",l.CALL_USES_MIXER=\"_CallUsesMixer\",l.ESCALATION_IN_PROGRESS=\"_EscalationInProgress\",l.ESCALATION_COMPLETED=\"_EscalationCompleted\",l.ELECTRON_WAIT_FOR_HANDLE_PUSH=\"_ElectronWaitForHandlePush\",l.ELECTRON_WAIT_FOR_RINGING=\"_ElectronWaitForRinging\",l.ELECTRON_START_SCREEN_SHARING=\"_ElectronStartScreenSharing\",l.ELECTRON_STOP_SCREEN_SHARING=\"_ElectronStopScreenSharing\",l.ELECTRON_SLIMCORE_READY=\"_ElectronSlimcoreReady\",l.ELECTRON_DATA_CHANNEL_CREATED=\"_ElectronDataChannelCreated\",l.ELECTRON_ATTACH_SLIMCORE_CALL=\"_ElectronAttachSlimcoreCall\",l.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED=\"_ElectronAttachSlimcoreCallFailed\",l.ELECTRON_LEAVE_CALL=\"_ElectronLeaveCall\",l.PROCESS_CALL_START_OPTIONS=\"_ProcessCallStartOptions\",l.CALL_MODE_CHANGED=\"_CallModeChanged\",l.UPDATE_MEETING_GROUPS_DETAILS=\"_UpdateMeetingGroupDetails\"}(d.CALL_OPERATIONS_INTERNAL||(d.CALL_OPERATIONS_INTERNAL={})),function(l){l.CCWM=\"CCWM\",l.ENCRYPTED=\"Encrypted\",l.LWJ=\"LWJ\",l.PREHEAT=\"Preheat\",l.MULTIPLEVIDEOS=\"MultipleVideos\",l.SPECIFIED=\"Specified\",l.ALL=\"All\",l.NONE=\"None\"}(d.OPERATION_VARIANTS||(d.OPERATION_VARIANTS={})),function(l){l.AUDIO_QUALITY_CHANGED=\"AudioQualityChanged\",l.SESSION_ERROR=\"SessionError\",l.NEGOTIATION_REQUIRED=\"NegotiationRequired\",l.OUTGOING_NEGOTIATION_FAILURE=\"OutgoingNegotiationFailure\",l.INCOMING_NEGOTIATION_FAILURE=\"IncomingNegotiationFailure\",l.NEGOTIATION_FATAL_ERROR=\"NegotiationFatalError\",l.NEGOTIATION_COMPLETION=\"NegotiationCompletion\",l.AUDIO_STATE_CHANGED=\"AudioStateChanged\",l.INCOMPATIBLE_OFFER=\"IncompatibleOffer\",l.NEW_OFFER_FAILED=\"NewOfferFailed\",l.CREATING_CONFERENCE=\"CreatingConference\",l.CREATED_CONFERENCE=\"CreatedConference\"}(d.MEDIA_EVENT||(d.MEDIA_EVENT={})),function(l){l.ADD_PARTICIPANT=\"AddParticipant\",l.REMOVE_PARTICIPANT=\"RemoveParticipant\",l.ADMIT_PARTICIPANT=\"AdmitParticipant\",l.CALL_ME_BACK=\"CallMeBack\",l.ADD_PARTICIPANTS=\"AddParticipants\",l.SEARCH_PARTICIPANTS=\"SearchParticipants\",l.GET_ALL_PARTICIPANTS=\"GetALLParticipants\"}(d.PARTICIPANT_OPERATIONS||(d.PARTICIPANT_OPERATIONS={})),function(l){l.SET_PARTICIPANT_STATE_INVALID=\"_SetParticipantStateInvalid\",l.UPDATE_LOCAL_PARTICIPANT_STREAM=\"_UpdateLocalParticipantStream\",l.PARTICIPANT_JOINED=\"_ParticipantJoined\",l.SELF_PARTICIPANT_UPDATED=\"_SelfParticipantUpdated\"}(d.PARTICIPANT_OPERATIONS_INTERNAL||(d.PARTICIPANT_OPERATIONS_INTERNAL={})),function(l){l.START_CONTENT_SHARING=\"StartContentSharing\",l.STOP_CONTENT_SHARING=\"StopContentSharing\",l.JOIN_CONTENT_SHARING=\"JoinContentSharing\",l.TAKE_CONTENT_SHARING_CONTROL=\"TakeContentSharingControl\",l.UPDATE_CONTENT_SHARING_SESSION_STATE=\"UpdateContentSharingSessionState\",l.UPDATE_PARTICIPANT_STATE=\"UpdateParticipantState\"}(d.CONTENT_SHARING_OPERATIONS||(d.CONTENT_SHARING_OPERATIONS={})),function(l){l.SET_CONTENT_SHARING_STATUS=\"_SetContentSharingStatus\"}(d.CONTENT_SHARING_OPERATIONS_INTERNAL||(d.CONTENT_SHARING_OPERATIONS_INTERNAL={})),function(l){l.INITIALIZE=\"Initialize\",l.LOGOUT=\"Logout\",l.GET_CALL_STATE=\"GetCallState\"}(d.CALL_REGISTRY_OPERATIONS||(d.CALL_REGISTRY_OPERATIONS={})),d.TELEMETRY_EVENT_NAMES={CALL_SETUP_NATIVE:\"skypecosi_concore_native_ts_calling_call_setup_session\",CALL_IN_CALL_NATIVE:\"skypecosi_concore_native_ts_calling_in_call_session\",REGISTRY_WEB:\"skypecosi_concore_web_ts_calling_registry\",REGISTRY_NATIVE:\"skypecosi_concore_native_ts_calling_registry\"},d.UNPARK_CODE={PARK:\"*11\",SHARED_LINE:\"*12\",SERVER_HOLD:\"*13\"},function(l){l[l.SUCCESS=0]=\"SUCCESS\",l[l.FORBIDDEN=403]=\"FORBIDDEN\",l[l.INVALID_PARTICIPANT=406]=\"INVALID_PARTICIPANT\",l[l.CLIENT_ERROR=499]=\"CLIENT_ERROR\",l[l.SIGNALING_ERROR=599]=\"SIGNALING_ERROR\"}(d.TRANSACTION_END_CODE||(d.TRANSACTION_END_CODE={})),function(l){l[l.LOCAL_REJECT=0]=\"LOCAL_REJECT\",l[l.UNMUTE_ERROR=3124]=\"UNMUTE_ERROR\",l[l.TRANSACTION_NOT_ALLOWED=3548]=\"TRANSACTION_NOT_ALLOWED\",l[l.INVALID_ARGUMENT=3549]=\"INVALID_ARGUMENT\",l[l.CANNOT_PARSE_RESULT=3550]=\"CANNOT_PARSE_RESULT\",l[l.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE=3551]=\"TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE\",l[l.INVITE_FAILURE=5201]=\"INVITE_FAILURE\",l[l.NOT_IN_LOBBY=3552]=\"NOT_IN_LOBBY\",l[l.LEFT_LOBBY=3553]=\"LEFT_LOBBY\",l[l.DENIED_IN_LOBBY=3554]=\"DENIED_IN_LOBBY\",l[l.TIMED_OUT_IN_LOBBY=3555]=\"TIMED_OUT_IN_LOBBY\"}(d.TRANSACTION_END_SUBCODE||(d.TRANSACTION_END_SUBCODE={})),function(l){l.TRANSACTION_COMPLETE=\"TransactionComplete\",l.TRANSACTION_ALLOWED=\"TransactionAllowed\",l.TRANSACTION_DISALLOWED=\"TransactionDisallowed\",l.UNKNOWN=\"Unknown\",l.STACK_NOT_INTIALIZED=\"Stack not intialized yet\",l.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE=\"TransactionNotAllowedForStreamMode\",l.NOT_IN_LOBBY=\"Participant is not in lobby state\"}(d.TRANSACTION_END_PHRASE||(d.TRANSACTION_END_PHRASE={})),d.EMPTY_COUNTS={totalParticipants:0,preheatedParticipants:0,lobbyParticipants:0,totalPresenters:0,requestingAttentionPresenters:0,totalAttendees:0,requestingAttentionAttendees:0,overflowAttendees:0}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.FormatParameters=void 0;var p=u(1),h=function(){function FormatParameters(l){var d=this;this.parameters={},l&&l.split(\";\").forEach((function(l){var u=l.split(\"=\");d.parameters[u[0]]=u[1]}))}return FormatParameters.prototype.setIfMissing=function(l,d){this.contains(l)||(this.parameters[l]=d)},FormatParameters.prototype.removeIfPresent=function(l){this.contains(l)&&delete this.parameters[l]},FormatParameters.prototype.get=function(l){return this.parameters[l]},FormatParameters.prototype.names=function(){return Object.keys(this.parameters)},FormatParameters.prototype.contains=function(l){return this.parameters.hasOwnProperty(l)},FormatParameters.prototype.toString=function(){var l=\"\";return p.forOwn(this.parameters,(function(d,u){l+=(l?\";\":\"\")+u,void 0!==d&&(l+=\"=\".concat(d))})),l},FormatParameters}();d.FormatParameters=h,d.default={build:function(l){return new h(l)}}},function(l,d,u){u.d(d,\"a\",(function(){return v})),u.d(d,\"b\",(function(){return doPerf})),u.d(d,\"c\",(function(){return getGblPerfMgr}));var p=u(6),h=u(0),g=\"ctx\",f=null,m=function(){function PerfEvent(l,d,u){var p,f=this,m=!1;(f.start=Object(h.f)(),f.name=l,f.isAsync=u,f.isChildEvt=function(){return!1},Object(h.o)(d))&&(m=Object(h.y)(f,\"payload\",(function(){return!p&&Object(h.o)(d)&&(p=d(),d=null),p})));f.getCtx=function(l){return l?l===PerfEvent.ParentContextKey||l===PerfEvent.ChildrenContextKey?f[l]:(f[g]||{})[l]:null},f.setCtx=function(l,d){if(l)if(l===PerfEvent.ParentContextKey)f[l]||(f.isChildEvt=function(){return!0}),f[l]=d;else if(l===PerfEvent.ChildrenContextKey)f[l]=d;else{(f[g]=f[g]||{})[l]=d}},f.complete=function(){var l=0,u=f.getCtx(PerfEvent.ChildrenContextKey);if(Object(h.k)(u))for(var p=0;p<u.length;p++){var g=u[p];g&&(l+=g.time)}f.time=Object(h.f)()-f.start,f.exTime=f.time-l,f.complete=function(){},!m&&Object(h.o)(d)&&(f.payload=d())}}return PerfEvent.ParentContextKey=\"parent\",PerfEvent.ChildrenContextKey=\"childEvts\",PerfEvent}(),v=function(){function PerfManager(l){this.ctx={},Object(p.a)(PerfManager,this,(function(d){d.create=function(l,d,u){return new m(l,d,u)},d.fire=function(d){d&&(d.complete(),l&&Object(h.o)(l.perfEvent)&&l.perfEvent(d))},d.setCtx=function(l,u){l&&((d[g]=d[g]||{})[l]=u)},d.getCtx=function(l){return(d[g]||{})[l]}}))}return PerfManager}(),y=\"CoreUtils.doPerf\";function doPerf(l,d,u,p,g){if(l){var f=l;if(Object(h.o)(f.getPerfMgr)&&(f=f.getPerfMgr()),f){var v=void 0,S=f.getCtx(y);try{if(v=f.create(d(),p,g)){if(S&&v.setCtx&&(v.setCtx(m.ParentContextKey,S),S.getCtx&&S.setCtx)){var _=S.getCtx(m.ChildrenContextKey);_||(_=[],S.setCtx(m.ChildrenContextKey,_)),_.push(v)}return f.setCtx(y,v),u(v)}}catch(l){v&&v.setCtx&&v.setCtx(\"exception\",l)}finally{v&&f.fire(v),f.setCtx(y,S)}}}return u()}function getGblPerfMgr(){return f}},function(l,d,u){u.d(d,\"b\",(function(){return E})),u.d(d,\"c\",(function(){return safeGetLogger})),u.d(d,\"a\",(function(){return T}));var p=u(21),h=u(11),g=u(6),f=u(0),m=u(69),v=\"AI (Internal): \",y=\"AI: \",S=\"AITR_\",_=\"errorToConsole\",C=\"warnToConsole\";function _sanitizeDiagnosticText(l){return l?'\"'+l.replace(/\\\"/g,\"\")+'\"':\"\"}function _logToConsole(l,d){var u=Object(h.b)();if(u){var p=\"log\";u[l]&&(p=l),Object(f.o)(u[p])&&u[p](d)}}var E=function(){function _InternalLogMessage(l,d,u,p){void 0===u&&(u=!1);var g=this;g.messageId=l,g.message=(u?y:v)+l;var f=\"\";Object(h.l)()&&(f=Object(h.f)().stringify(p));var m=(d?\" message:\"+_sanitizeDiagnosticText(d):\"\")+(p?\" props:\"+_sanitizeDiagnosticText(f):\"\");g.message+=m}return _InternalLogMessage.dataType=\"MessageData\",_InternalLogMessage}();function safeGetLogger(l,d){return(l||{}).logger||new T(d)}var T=function(){function DiagnosticLogger(l){this.identifier=\"DiagnosticLogger\",this.queue=[];var d=0,u={};Object(g.a)(DiagnosticLogger,this,(function(h){function _getConfigValue(d,u){var p=l[d];return Object(f.r)(p)?u:p}function _areInternalMessagesThrottled(){return d>=h.maxInternalMessageLimit()}function _debugExtMsg(d,u){var p=Object(m.a)(l);p&&p.diagLog&&p.diagLog(d,u)}Object(f.r)(l)&&(l={}),h.consoleLoggingLevel=function(){return _getConfigValue(\"loggingLevelConsole\",0)},h.telemetryLoggingLevel=function(){return _getConfigValue(\"loggingLevelTelemetry\",1)},h.maxInternalMessageLimit=function(){return _getConfigValue(\"maxMessageLimit\",25)},h.enableDebugExceptions=function(){return _getConfigValue(\"enableDebugExceptions\",!1)},h.throwInternal=function(l,d,g,m,v){void 0===v&&(v=!1);var y=new E(d,g,v,m);if(h.enableDebugExceptions())throw y;var S=l===p.a.CRITICAL?_:C;if(Object(f.x)(y.message))_debugExtMsg(\"throw\"+(l===p.a.CRITICAL?\"Critical\":\"Warning\"),y);else{var T=h.consoleLoggingLevel();if(v){var b=+y.messageId;!u[b]&&T>=l&&(h[S](y.message),u[b]=!0)}else T>=l&&h[S](y.message);h.logInternalMessage(l,y)}},h.warnToConsole=function(l){_logToConsole(\"warn\",l),_debugExtMsg(\"warning\",l)},h.errorToConsole=function(l){_logToConsole(\"error\",l),_debugExtMsg(\"error\",l)},h.resetInternalMessageCount=function(){d=0,u={}},h.logInternalMessage=function(l,g){if(!_areInternalMessagesThrottled()){var f=!0,m=S+g.messageId;if(u[m]?f=!1:u[m]=!0,f&&(l<=h.telemetryLoggingLevel()&&(h.queue.push(g),d++,_debugExtMsg(l===p.a.CRITICAL?\"error\":\"warn\",g)),d===h.maxInternalMessageLimit())){var v=\"Internal events throttle limit per PageView reached for this app.\",y=new E(p.b.MessageLimitPerPVExceeded,v,!1);h.queue.push(y),l===p.a.CRITICAL?h.errorToConsole(v):h.warnToConsole(v)}}}}))}return DiagnosticLogger}()},,function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.getSharingParticipantLeg=d.getParticipantIdForSourceId=d.getSourceId=d.getSourceIdForMediaType=d.hasStagingGroup=d.findParticipantUsingParticipantLegId=void 0;var h=u(57),g=u(58);function hasParticipantLegId(l,d){var u,p,h;return null!==(h=null===(p=null===(u=l.endpoints)||void 0===u?void 0:u.endpointDetails)||void 0===p?void 0:p.some((function(l){return l.participantId===d})))&&void 0!==h&&h}function findParticipantUsingParticipantLegId(l,d){return l.participants.find((function(l){return hasParticipantLegId(l,d)}))}function hasStagingGroup(l){var d;return!!(null===(d=null==l?void 0:l.meetingGroupDetails)||void 0===d?void 0:d.groups)&&Object.keys(l.meetingGroupDetails.groups).some((function(l){return\"stagingGroup\"===l}))}function getSourceIdForMediaType(l,d){var u,f,m,v,y=-1;try{if(l.endpoints)try{e:for(var S=p(l.endpoints.endpointDetails),_=S.next();!_.done;_=S.next()){var C=_.value;if(null!==C&&void 0!==C.mediaStreams)try{for(var E=(m=void 0,p(C.mediaStreams)),T=E.next();!T.done;T=E.next()){var b=T.value;if(g.mapMediaTypeStringToMediaType(b.type)===d){y=b.sourceId;break e}}}catch(l){m={error:l}}finally{try{T&&!T.done&&(v=E.return)&&v.call(E)}finally{if(m)throw m.error}}else y=h.DATA_SOURCE_ID_ANY}}catch(l){u={error:l}}finally{try{_&&!_.done&&(f=S.return)&&f.call(S)}finally{if(u)throw u.error}}}catch(l){return-1}return y}function getSourceId(l,d,u){if(!l||!l.endpoints)return-1;var p=l.endpoints.endpointDetails.find((function(l){return(null==l?void 0:l.participantId)===d}));if(!p)return getSourceIdForMediaType(l,u);if(!p.mediaStreams)return getSourceIdForMediaType(l,u);var h=p.mediaStreams.find((function(l){var d=l.type;return g.mapMediaTypeStringToMediaType(d)===u}));return h?h.sourceId:-1}function getParticipantIdForSourceId(l,d,u){var h,f,m,v,y;try{if(!l.endpoints)return;try{for(var S=p(l.endpoints.endpointDetails),_=S.next();!_.done;_=S.next()){var C=_.value;if(null==C?void 0:C.mediaStreams)try{for(var E=(m=void 0,p(C.mediaStreams)),T=E.next();!T.done;T=E.next()){var b=T.value;if(u===b.sourceId&&g.mapMediaTypeStringToMediaType(b.type)===d)return null!==(y=C.participantId)&&void 0!==y?y:null}}catch(l){m={error:l}}finally{try{T&&!T.done&&(v=E.return)&&v.call(E)}finally{if(m)throw m.error}}}}catch(l){h={error:l}}finally{try{_&&!_.done&&(f=S.return)&&f.call(S)}finally{if(h)throw h.error}}return}catch(l){return}}function isScreenSharerStream(l){return\"sendonly\"===l.direction&&\"applicationsharing-video\"===l.label}function getSharingParticipantLeg(l){var d,u;if(null===(d=l.endpoints)||void 0===d?void 0:d.endpointDetails)return 1===l.endpoints.endpointDetails.length?l.endpoints.endpointDetails[0].participantId:null===(u=l.endpoints.endpointDetails.find((function(l){var d;return null===(d=null==l?void 0:l.mediaStreams)||void 0===d?void 0:d.some(isScreenSharerStream)})))||void 0===u?void 0:u.participantId}d.findParticipantUsingParticipantLegId=findParticipantUsingParticipantLegId,d.hasStagingGroup=hasStagingGroup,d.getSourceIdForMediaType=getSourceIdForMediaType,d.getSourceId=getSourceId,d.getParticipantIdForSourceId=getParticipantIdForSourceId,d.getSharingParticipantLeg=getSharingParticipantLeg},function(l,d,u){var p=u(292),h=u(293);d.write=h,d.parse=p.parse,d.parseParams=p.parseParams,d.parseFmtpConfig=p.parseFmtpConfig,d.parsePayloads=p.parsePayloads,d.parseRemoteCandidates=p.parseRemoteCandidates,d.parseImageAttributes=p.parseImageAttributes,d.parseSimulcastStreamList=p.parseSimulcastStreamList},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();function asap(l){return new Promise((function(d){d(l())}))}Object.defineProperty(d,\"__esModule\",{value:!0}),d.timeout=d.delay=d.defer=d.Timer=d.TimeoutError=d.asap=void 0,d.asap=asap;var h=function(l){function TimeoutError(){return null!==l&&l.apply(this,arguments)||this}return p(TimeoutError,l),TimeoutError}(Error);d.TimeoutError=h;var g=function(){function Timer(l){this.ontimeout=l,this.active=!1}return Object.defineProperty(Timer.prototype,\"isActive\",{get:function(){return this.active},enumerable:!1,configurable:!0}),Timer.prototype.start=function(l){var d=this;void 0!==this.timeoutId&&this.stop(),this.timeoutId=setTimeout((function(){d.ontimeout(),d.active=!1}),l),this.active=!0},Timer.prototype.stop=function(){clearTimeout(this.timeoutId),this.timeoutId=void 0,this.active=!1},Timer}();function defer(){var l,d,u=!0;return{isPending:function(){return u},promise:new Promise((function(u,p){l=u,d=p})),resolve:function(d){u&&(l(d),u=!1)},reject:function(l){u&&(d(l),u=!1)}}}function delay(l){return new Promise((function(d){return setTimeout(d,l)}))}function timeout(l,d,u,p){var h,g=[l,new Promise((function(l,p){h=setTimeout(p.bind(null,new Error(\"Promise timed out \".concat(u?\": \".concat(u):\"\",\" after \").concat(d,\" ms\"))),d)}))];p&&g.push(p);var f=Promise.race(g),always=function(){h&&clearTimeout(h)};return f.then(always,always),f}d.Timer=g,d.defer=defer,d.delay=delay,d.timeout=timeout},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.sequentialize=void 0;var sequentialize=function(){return function(l,d,u){var g=u.value;return u.value=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];return this.serialQueue.add(g.bind.apply(g,h([this],p(l),!1)))},u}};d.sequentialize=sequentialize},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=u(3),g=u(9);function compareStr(l,d){return l.toLowerCase()===d.toLowerCase()}function getStateFromDescr(l){return l.enabled?l.send&&l.recv?h.default.MEDIA_STATE.sendReceive:l.send?h.default.MEDIA_STATE.send:l.recv?h.default.MEDIA_STATE.receive:h.default.MEDIA_STATE.inactive:null}function getTypeForLabel(l){if(l===h.default.MEDIA_LABEL.audio)return h.default.MEDIA_TYPE.audio;if(l===h.default.MEDIA_LABEL.video)return h.default.MEDIA_TYPE.video;if(l===h.default.MEDIA_LABEL.sharing)return h.default.MEDIA_TYPE.video;throw new Error(\"unsupported label: \"+l)}function getStateForModality(l,d){return d===h.default.MEDIA_LABEL.audio?l.audio:d===h.default.MEDIA_LABEL.video?l.video:d===h.default.MEDIA_LABEL.sharing?l.sharing:null}function getDescrFromState(l,d,u){var p=getStateForModality(l,d);return{enabled:!!p,mediaId:u,type:getTypeForLabel(d),label:d,send:g.hasSendDirectionality(p),recv:g.hasReceiveDirectionality(p),needsTransport:!1}}function findDescrFromMedia(l,d){for(var u=0;u<l.length;u++)if(l[u].descr.label===d)return l[u].descr;return{enabled:!1,type:getTypeForLabel(d),label:d,send:!1,recv:!1}}function getModalitiesFromMedia(l){var d={},u=findDescrFromMedia(l,h.default.MEDIA_LABEL.audio),p=findDescrFromMedia(l,h.default.MEDIA_LABEL.video),g=findDescrFromMedia(l,h.default.MEDIA_LABEL.sharing);return u.enabled&&(d.audio=getStateFromDescr(u)),p.enabled&&(d.video=getStateFromDescr(p)),g.enabled&&(d.sharing=getStateFromDescr(g)),d}function codecByPayload(l,d){return d.find((function(d){return d.preferredPayloadType===+l}))}function getCodecIndexByPayload(l,d){return d.findIndex((function(d){return d.preferredPayloadType===l}))}function getCodecByName(l,d){return d.find((function(d){return compareStr(d.name,l)}))}function codecNameByPayload(l,d){return codecByPayload(l,d).name}function getTransportIndexById(l,d){return l.findIndex((function(l){return l.transportId===d}))}function matchXMessage(l,d){function splitInDict(l){return{send:/send:(\\S+)/.exec(l)[1].split(\",\"),recv:/recv:(\\S+)/.exec(l)[1].split(\",\")}}var u={send:[],recv:[]},p=splitInDict(d);if(splitInDict(l).send.forEach((function(l){-1!==p.send.indexOf(l)&&u.send.push(l)})),splitInDict(l).recv.forEach((function(l){-1!==p.recv.indexOf(l)&&u.recv.push(l)})),u.send.length||u.recv.length){var h=\"app\";return h=u.send.length?h+\" send:\"+u.send.join(\",\"):h,h=u.recv.length?h+\" recv:\"+u.recv.join(\",\"):h}return null}function matchRtcpFeedback(l,d){var u=[];return l.forEach((function(l){d.forEach((function(d){if(l.type===d.type)if(\"x-message\"===l.type){var p=matchXMessage(l.parameter,d.parameter);p&&u.push({type:\"x-message\",parameter:p})}else l.parameter===d.parameter&&u.push(l)}))})),u}function matchCodecCaps(l,d,u,h){var g=[];return l&&d&&(l.filter((function(l){return!compareStr(l.name,\"rtx\")})).forEach((function(l){for(var f=0;f<d.length;f++){var m=d[f];if(compareStr(l.name,m.name)&&compareStr(l.kind,m.kind)&&l.numChannels===m.numChannels&&l.clockRate===m.clockRate){var v=p.shallowClone(h?m:l);v.preferredPayloadType=u?l.preferredPayloadType:m.preferredPayloadType,v.rtcpFeedback=matchRtcpFeedback(l.rtcpFeedback,m.rtcpFeedback),g.push(v);break}}})),l.filter((function(l){return compareStr(l.name,\"rtx\")})).forEach((function(f){for(var m=0;m<d.length;m++){var v=d[m];if(compareStr(f.name,v.name)&&compareStr(f.kind,v.kind)&&f.numChannels===v.numChannels&&f.clockRate===v.clockRate&&compareStr(codecNameByPayload(f.parameters.apt,l),codecNameByPayload(v.parameters.apt,d))){var y=p.shallowClone(h?v:f);y.preferredPayloadType=u?f.preferredPayloadType:v.preferredPayloadType,y.parameters.apt=getCodecByName(codecByPayload(f.parameters.apt,l).name,g).preferredPayloadType,g.push(y);break}}}))),g}function findMatchingSdesParams(l,d){function _doSdesParamsMatch(l,d){var u=l.keyParams[0],p=d.keyParams[0];return l.cryptoSuite===d.cryptoSuite&&u.mkiLength===p.mkiLength&&u.mkiValue===p.mkiValue}for(var u=0;u<d.length;++u)for(var h=d[u],g=0;g<l.length;++g){var f=l[g];if(_doSdesParamsMatch(h,f))return{localSdesParams:p.shallowClone(f),remoteSdesParams:p.shallowClone(h)}}return null}function matchHeaderExtensions(l,d){var u=[];return l&&d&&l.forEach((function(l){for(var p=0;p<d.length;p++){var h=d[p];l.kind===h.kind&&l.uri===h.uri&&u.push(l)}})),u}function matchRtpCaps(l,d,u,p){var h=null;return l&&d&&(h={codecs:matchCodecCaps(l.codecs,d.codecs,u,p),headerExtensions:matchHeaderExtensions(l.headerExtensions,d.headerExtensions),fecMechanisms:l.fecMechanisms.filter((function(l){return-1!==d.fecMechanisms.indexOf(l)}))}),h}function getSendParams(l,d,u,p,h,g){return RTCRtpParameters(\"\",codecCapsToCodecParams(l.codecs),hdrExtToHdrExtParams(l.headerExtensions),getEncParams(d,g),RTCRtcpParameters(u,\"\",p,h))}function getRecvParams(l,d,u,p,h,g){return getSendParams(l,d,u,p,h,g)}function codecCapsToCodecParams(l){var d=[];return l.forEach((function(l){d.push(RTCRtpCodecParameters(l.name,l.preferredPayloadType,l.clockRate,l.numChannels,l.rtcpFeedback,l.parameters,l.ptime,l.maxptime))})),d}function hdrExtToHdrExtParams(l){var d=[];return l.forEach((function(l){d.push(RTCRtpHeaderExtensionParameters(l.uri,l.preferredId,l.preferredEncrypt))})),d}function getEncParams(l,d){var u=[];return u.push(RTCRtpEncodingParameters(l,0,0,d,1)),u}function RTCRtpParameters(l,d,u,p,h){return{muxId:l||\"\",codecs:d,headerExtensions:u,encodings:p,rtcp:h,degradationPreference:\"balanced\"}}function RTCRtpCodecParameters(l,d,u,p,h,g,f,m){return{name:l,payloadType:d,clockRate:u,numChannels:p,rtcpFeedback:h,parameters:g,ptime:f,maxptime:m}}function RTCRtpHeaderExtensionParameters(l,d,u){return{uri:l,id:d,encrypt:u}}function RTCRtcpParameters(l,d,u,p){return{ssrc:l,cname:d,reducedSize:u,mux:p}}function hasRtx(l){return l.some((function(l){return compareStr(l.name,\"rtx\")}))}function getRtxSsrc(l,d,u,p){return hasRtx(l.codecs)?p?d.rtxSsrc:u.rtxSsrc:0}function groupsToSdp(l){return l.groups&&0!==l.groups.length?[{mids:l.groups.join(\" \"),type:\"BUNDLE\"}]:null}function RTCRtpEncodingParameters(l,d,u,p,h,g,f,m,v,y,S,_,C,E){return{ssrc:l.min,ssrcRange:l,codecPayloadType:d,fec:u,rtx:p?{ssrc:p}:0,priority:h||1,maxBitrate:g,minQuality:f||0,framerateBias:m||.5,resolutionScale:v||1,framerateScale:y||1,active:_||!0,encodingId:C,dependencyEncodingId:E}}d.default={groupsToSdp:groupsToSdp,getStateFromDescr:getStateFromDescr,getDescrFromState:getDescrFromState,getCodecIndexByPayload:getCodecIndexByPayload,getTransportIndexById:getTransportIndexById,findDescrFromMedia:findDescrFromMedia,getModalitiesFromMedia:getModalitiesFromMedia,findMatchingSdesParams:findMatchingSdesParams,matchXMessage:matchXMessage,matchRtpCaps:matchRtpCaps,matchRtcpFeedback:matchRtcpFeedback,getSendParams:getSendParams,getRecvParams:getRecvParams,RTCRtpCodecParameters:RTCRtpCodecParameters,RTCRtpHeaderExtensionParameters:RTCRtpHeaderExtensionParameters,RTCRtcpParameters:RTCRtcpParameters,hasRtx:hasRtx,getRtxSsrc:getRtxSsrc,RTCRtpEncodingParameters:RTCRtpEncodingParameters,getCodecByName:getCodecByName}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaSourceIdentifiers=void 0;var p=function(){function MediaSourceIdentifiers(){}return MediaSourceIdentifiers.SourceNone=-1,MediaSourceIdentifiers.SourceAny=-2,MediaSourceIdentifiers}();d.MediaSourceIdentifiers=p},function(l,d,u){u.d(d,\"b\",(function(){return p})),u.d(d,\"a\",(function(){return h}));var p=\"iKey\",h=\"extensionConfig\"},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.calculateJoinedFromForTelemetry=d.getEndpointInformationForTelemetry=d.CallTelemetry=d.CallRegistryTelemetry=d.TelemetryUtilities=d.SELF_PARTICIPANT_ROLE=d.DIRECTION=d.RESULT_VALUE=d.CALL_TERMINATING_END=void 0;var h,g,f=u(33),m=u(13),v=u(14),y=u(17),S=u(34),_=150;!function(l){l.Pending=\"Pending\",l.Success=\"Success\",l.Failure=\"Failure\",l.Timeout=\"Timeout\"}(h||(h={})),function(l){l[l.Event=0]=\"Event\",l[l.Operation=1]=\"Operation\"}(g||(g={}));var C,E=function(){function Event(l,d,u,p,f){this.eventName=l,this.eventStartTime=d,this.type=u,this.causeId=p,this.status=h.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.type===g.Event&&delete this.status,f&&this.data.push(f)}return Object.defineProperty(Event.prototype,\"variant\",{set:function(l){this.eventVariant=l},enumerable:!1,configurable:!0}),Object.defineProperty(Event.prototype,\"additionalData\",{set:function(l){this.eventAdditionalData=l},enumerable:!1,configurable:!0}),Event.prototype.recordSuccess=function(l,d){this.recordResult(h.Success,l,d)},Event.prototype.recordFailure=function(l,d){this.recordResult(h.Failure,l,d)},Event.prototype.recordTimeout=function(l,d){this.recordResult(h.Timeout,l,d)},Event.prototype.addData=function(l){this.data.push(l)},Event.prototype.isPending=function(){return this.status===h.Pending},Event.prototype.getEvent=function(){var l,d=this,u={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,causeId:this.causeId,resultCauseId:this.resultCauseId,variant:this.eventVariant,data:this.data.map((function(l){return d.prepareData(l,!0)})).filter((function(l){return!!l}))};return this.type===g.Event&&delete u.status,u.data.length||delete u.data,u.causeId||delete u.causeId,u.resultCauseId||delete u.resultCauseId,u.result||delete u.result,u.variant||delete u.variant,this.eventAdditionalData&&Object.keys(this.eventAdditionalData).forEach((function(l){u[l]=d.eventAdditionalData[l]})),(l={})[this.eventName]=u,l},Event.prototype.recordResult=function(l,d,u){this.status=l,this.result=this.prepareData(d),this.causeId!==u&&(this.resultCauseId=u),this.duration=(new Date).getTime()-this.eventStartTimestamp},Event.prototype.prepareData=function(l,d){void 0===d&&(d=!1);var u=typeof l;if(null==l)return\"\";if(\"string\"===u)return(0,y.scrubMriOrOmit)(l);if(\"number\"===u||\"boolean\"===u)return String(l);if(\"function\"===u)return\"\";if(l instanceof Error)return l.toString();try{return Object.keys(l).length?d?l:(0,v.getPIISafeObject)(l):\"\"}catch(l){return\"invalid\"}},Event}();!function(l){l.LOCAL=\"Local\",l.REMOTE=\"Remote\"}(d.CALL_TERMINATING_END||(d.CALL_TERMINATING_END={})),function(l){l.SUCCESS=\"Success\",l.FAILURE=\"Failure\"}(d.RESULT_VALUE||(d.RESULT_VALUE={})),function(l){l.INCOMING=\"Incoming\",l.OUTGOING=\"Outgoing\"}(d.DIRECTION||(d.DIRECTION={})),function(l){l.CALLER=\"caller\",l.CALLEE=\"callee\",l.JOIN=\"join\",l.SUBSCRIBE=\"SUBSCRIBE\"}(d.SELF_PARTICIPANT_ROLE||(d.SELF_PARTICIPANT_ROLE={})),function(l){l.SUCCESS=\"Success\",l.FAILURE=\"Failure\",l.TIMEOUT=\"Timeout\"}(C||(C={}));var T=function(){function TelemetryUtilities(l,d,u){this.logger=l,this.startTime=d,this.maxEventsExceeded=u,this.recordedEvents=[],this.ongoingOperations={}}return TelemetryUtilities.prototype.recordEvent=function(l,d,u){void 0===u&&(u=(0,m.generateCauseId)()),this.logger.debug(\"Event:\",l,f.pii.Omit(d));var p=new E(l,this.getEventStartTime(),g.Event,u,d);return this.pushToRecordedEvents(p),p},TelemetryUtilities.prototype.recordOperationSuccess=function(l,d,u,p,h){void 0===d&&(d=null),this.logger.info(\"Event success:\",p,l,f.pii.Omit(u),f.pii.Omit(d)),this.recordOperationResult(l,d,C.SUCCESS,u,p,h)},TelemetryUtilities.prototype.recordOperationFailure=function(l,d,u,p,h){this.logger.info(\"Event failure:\",l,f.pii.Omit(u),d),this.recordOperationResult(l,d,C.FAILURE,u,p,h)},TelemetryUtilities.prototype.recordOperationTimeout=function(l,d,u,p,h){this.logger.info(\"Event timeout:\",l,f.pii.Omit(u),d),this.recordOperationResult(l,d,C.TIMEOUT,u,p,h)},TelemetryUtilities.prototype.maybeRecordOperationSuccess=function(l,d,u,p,h){void 0===d&&(d=null),this.hasOngoingEvent(l,u)&&this.recordOperationSuccess(l,d,u,p,h)},TelemetryUtilities.prototype.maybeRecordOperationFailure=function(l,d,u,p,h){this.hasOngoingEvent(l,u)&&this.recordOperationFailure(l,d,u,p,h)},TelemetryUtilities.prototype.maybeRecordOperationTimeout=function(l,d,u,p,h){this.hasOngoingEvent(l,u)&&this.recordOperationTimeout(l,d,u,p,h)},TelemetryUtilities.prototype.recordOperationResult=function(l,d,u,p,h,g){this.hasOngoingEvent(l,p)||this.recordOperation(l,h,p,g);var f=this.ongoingOperations[l];switch(p&&(f=f[p]),u){case C.SUCCESS:f.recordSuccess(d,h);break;case C.FAILURE:f.recordFailure(d,h);break;case C.TIMEOUT:f.recordTimeout(d,h);break;default:this.logger.error(\"Unknown operation record state in record operation result.\")}p?delete this.ongoingOperations[l][p]:delete this.ongoingOperations[l]},TelemetryUtilities.prototype.recordOperation=function(l,d,u,p){this.logger.debug(\"Event create:\",d,l,f.pii.Omit(u));var h=new E(l,this.getEventStartTime(),g.Operation,d,p);return this.ongoingOperations[l]||(this.ongoingOperations[l]={}),u?this.ongoingOperations[l][u]=h:this.ongoingOperations[l]=h,this.pushToRecordedEvents(h),h},TelemetryUtilities.prototype.setOperationVariant=function(l,d,u){var p;(p=u?this.ongoingOperations[l][u]:this.ongoingOperations[l])?p.variant=d:this.logger.error(\"Could not find operation \".concat(l,\" to set variant \").concat(d))},TelemetryUtilities.prototype.updateOperationData=function(l,d,u,p){try{if(!this.ongoingOperations[l])return void this.recordEvent(l,d,u);p?this.ongoingOperations[l][p]&&this.ongoingOperations[l][p].addData(d):this.ongoingOperations[l].addData(d)}catch(d){return void this.logger.info(\"Unable to update operation: \".concat(l,\" data\"))}},TelemetryUtilities.prototype.pushToRecordedEvents=function(l){this.maxEventsExceeded&&this.maxEventsExceeded()&&this.recordedEvents.shift(),this.recordedEvents.push(l)},TelemetryUtilities.prototype.hasOngoingEvent=function(l,d){return this.ongoingOperations[l]?!(d&&!this.ongoingOperations[l][d])||(this.logger.warn(\"Unable to find event for name\\\\id \".concat(l,\"\\\\\").concat(f.pii.Omit(d))),!1):(this.logger.warn(\"Unable to find event for name \".concat(l)),!1)},TelemetryUtilities.prototype.getEventStartTime=function(){return(new Date).getTime()-this.startTime},TelemetryUtilities.prototype.getEventTimestampBag=function(l,d){var u=d?[d.getEvent()]:this.recordedEvents.filter((function(d){return!l||!d.isPending()})).map((function(l){return l.getEvent()})),p=JSON.stringify({eventStart:this.startTime,events:u});return this.logger.info(\"Call eventTimestampBag \".concat(f.pii.Omit(p))),p},TelemetryUtilities.prototype.removeRecordedEvent=function(l){var d=this.recordedEvents.indexOf(l);d>-1&&this.recordedEvents.splice(d,1)},TelemetryUtilities}();d.TelemetryUtilities=T;var b=function(l){function CallRegistryTelemetry(d,u){var p=l.call(this,d,u,(function(){return p.recordedEvents.length>_}))||this;return p.getHostName=function(){try{return\"localhost\"===location.hostname||\"127.0.0.1\"===location.hostname?\"localhost\":\"<redacted>\"}catch(l){return\"unknown\"}},p.tsCallingVersion=(0,S.getTsCallingVersion)(),p.logger=d.createChild(\"CallRegistryTelemetry\"),p}return p(CallRegistryTelemetry,l),CallRegistryTelemetry.prototype.setEndpointId=function(l){this.endpointId=l},CallRegistryTelemetry.prototype.setSkypeId=function(l){this.skypeId=l},CallRegistryTelemetry.prototype.setApplicationType=function(l){this.applicationType=l},CallRegistryTelemetry.prototype.setRing=function(l){this.ring=l},CallRegistryTelemetry.prototype.setTenantId=function(l){this.tenantId=l},CallRegistryTelemetry.prototype.setUserHexCID=function(l){this.userHexCID=l},CallRegistryTelemetry.prototype.setAcsResourceId=function(l){this.acsResourceId=l},CallRegistryTelemetry.prototype.setRegion=function(l){this.region=l},CallRegistryTelemetry.prototype.setPartition=function(l){this.partition=l},CallRegistryTelemetry.prototype.getEvent=function(l,d){var getValue=function(l){return void 0===l?\"\":l};return{EndpointId:getValue(this.endpointId),SkypeId:getValue(this.skypeId),ApplicationType:getValue(this.applicationType),Ring:getValue(this.ring),TenantId:getValue(this.tenantId),userHexCID:getValue(this.userHexCID),AcsResourceId:getValue(this.acsResourceId),Region:getValue(this.region),Partition:getValue(this.partition),TsCallingVersion:getValue(this.tsCallingVersion),HostName:this.getHostName(),EventTimestampBag:this.getEventTimestampBag(l,d),DiagnosticInfo:this.callEndDiagnosticInfo}},CallRegistryTelemetry.prototype.removeNonPendingOperations=function(){this.recordedEvents=this.recordedEvents.filter((function(l){return l.isPending()}))},CallRegistryTelemetry}(T);d.CallRegistryTelemetry=b;var I=function(l){function CallTelemetry(d,u){var p=l.call(this,d,u,(function(){return p.inCallMode&&p.recordedEvents.length>_}))||this;return p.inCallMode=!1,p.getHostName=function(){try{return location.host}catch(l){return\"unknown\"}},p.tsCallingVersion=(0,S.getTsCallingVersion)(),p.logger=d.createChild(\"CallTelemetry\"),p}return p(CallTelemetry,l),CallTelemetry.prototype.setCallId=function(l){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=l},CallTelemetry.prototype.setConsultativeCallId=function(l){this.consultativeCallId=l},CallTelemetry.prototype.setEndpointId=function(l){this.endpointId=l},CallTelemetry.prototype.setParticipantId=function(l){this.participantId=l},CallTelemetry.prototype.setPreheatFlags=function(l){this.preheatFlags=l},CallTelemetry.prototype.setCallOrigin=function(l){this.origin=l},CallTelemetry.prototype.setGroupId=function(l){this.groupId=l},CallTelemetry.prototype.setThreadId=function(l){this.threadId=l},CallTelemetry.prototype.setMesageId=function(l){this.messageId=l},CallTelemetry.prototype.setSkypeId=function(l){this.skypeId=l},CallTelemetry.prototype.setApplicationType=function(l){this.applicationType=l},CallTelemetry.prototype.setRing=function(l){this.ring=l},CallTelemetry.prototype.setTenantId=function(l){this.tenantId=l},CallTelemetry.prototype.setUserHexCID=function(l){this.userHexCID=l},CallTelemetry.prototype.setAcsResourceId=function(l){this.acsResourceId=l},CallTelemetry.prototype.setRegion=function(l){this.region=l},CallTelemetry.prototype.setPartition=function(l){this.partition=l},CallTelemetry.prototype.setFailureType=function(l){this.failureType=l},CallTelemetry.prototype.setIsCast=function(l){this.isCast=l?\"True\":\"False\"},CallTelemetry.prototype.setIsEmergency=function(l){this.isEmergency=l?\"True\":\"False\"},CallTelemetry.prototype.setRole=function(l){this.isAnonymous=\"admin\"===l?\"False\":\"True\"},CallTelemetry.prototype.setCallType=function(l){this.callType=l},CallTelemetry.prototype.setConversationType=function(l){this.conversationType=l},CallTelemetry.prototype.setDirection=function(l){this.direction=l},CallTelemetry.prototype.setSelfParticipantRole=function(l){this.selfParticipantRole=l},CallTelemetry.prototype.setTerminationState=function(l){this.terminationState=l},CallTelemetry.prototype.setTerminationReason=function(l){this.terminationReason=l},CallTelemetry.prototype.setCallEndDiagnosticInfo=function(l){this.callEndDiagnosticInfo=l},CallTelemetry.prototype.setStackConfig=function(l){this.stackConfig=l},CallTelemetry.prototype.setJoinedFrom=function(l){this.joinedFrom=l},CallTelemetry.prototype.getEvent=function(l,d){var getValue=function(l){return void 0===l?\"\":l};return{CorrelationId:getValue(this.currentCallId),PreviousCorrelationId:getValue(this.previousCallId),ConsultativeCallId:getValue(this.consultativeCallId),EndpointId:getValue(this.endpointId),SkypeId:getValue(this.skypeId),ParticipantId:getValue(this.participantId),PreheatFlags:getValue(this.preheatFlags),CallType:getValue(this.callType),ConversationType:getValue(this.conversationType),Direction:getValue(this.direction),Origin:getValue(this.origin),SelfParticipantRole:getValue(this.selfParticipantRole),IsAnonymous:getValue(this.isAnonymous),GroupId:(0,y.scrubMriOrOmit)(getValue(this.groupId)),ThreadId:(0,y.getLoggableThreadId)(getValue(this.threadId)),MessageId:getValue(this.messageId),ApplicationType:getValue(this.applicationType),Ring:getValue(this.ring),TenantId:getValue(this.tenantId),userHexCID:getValue(this.userHexCID),AcsResourceId:getValue(this.acsResourceId),Region:getValue(this.region),Partition:getValue(this.partition),FailureType:getValue(this.failureType),IsCast:getValue(this.isCast),IsEmergency:getValue(this.isEmergency),TsCallingVersion:getValue(this.tsCallingVersion),TerminationState:getValue(this.terminationState),TerminationReason:getValue(this.terminationReason),StackConfig:getValue(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(l,d),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo,JoinedFrom:this.joinedFrom}},CallTelemetry.prototype.switchToInCallTelemetry=function(){this.recordedEvents=this.recordedEvents.filter((function(l){return l.isPending()})),this.inCallMode=!0},CallTelemetry}(T);d.CallTelemetry=I;var getEndpointInformationForTelemetry=function(l){return Array.isArray(l)?l.map((function(l){return{endpointId:l.endpointId,participantId:l.participantId}})):null};d.getEndpointInformationForTelemetry=getEndpointInformationForTelemetry;var calculateJoinedFromForTelemetry=function(l,d,u,p,h){if(l){if(l.meetingUrl)return\"MeetingUrl\";if(l.meetingCode)return\"MeetingCode\"}return d||u?\"ThreadContext\":p?\"GroupId\":h?\"Awareness\":\"\"};d.calculateJoinedFromForTelemetry=calculateJoinedFromForTelemetry},function(l,d,u){function noop(){}Object.defineProperty(d,\"__esModule\",{value:!0}),d.noop=void 0,d.noop=noop},function(l,d,u){var p,h,g;Object.defineProperty(d,\"__esModule\",{value:!0}),d.ResultCategory=d.CallAckMediaPhase=d.CallAckSignalingPhase=d.CallSetupMediaPhase=d.CallSetupSignalingPhase=d.RenegotiationPhase=d.jsCallEndPhrase=d.RenegotiationOfferType=d.ParticipantMuteState=d.EnterpisePstnTerminationCode=d.PstnTerminationCode=d.logUploadEvents=d.proxiedEvents=d.incomingCallEvents=d.pstnEnterpriseResponseCodeMap=d.pstnConsumerResponseCodeMap=d.responseCodeMap=d.jsCallEndSubCodes=d.jsCallEndCodes=void 0,d.jsCallEndCodes={Cancel:487,Reject:603,NoNgcEndpoint:480,Forbidden:403,PreconditionFailed:412,Success:0,CallRedirected:302,BadRequest:400,NotFound:404,NotAcceptable:406,Timeout:408,Conflict:409,MediaError:410,ConfParticipantCountLimitReached:413,CallAccepted:450,CallForwarded:451,CallForwardedToVoicemail:452,P2pRejectCall:453,P2pFallbackForScreensharing:460,P2pFallbackDueToGroupCall:461,CallLegEndedOnService:470,CallDoesNotExist:481,NotAcceptableHere:488,NetworkError:490,GlareError:491,SkypeTokenError:495,LocalHttpStackError:496,UnknownError:497,LocalError:498,InternalServerError:500,CallModalityFailure:580,ServiceUnavailable:503},d.jsCallEndSubCodes={Success:0,CallRedirectedSuccess:3020,InsufficientCapabilities:5204,PolicyRestriction:5448,UserBlocked:10005,MaxLobbyParticipantLimitReached:5807,MaxParticipantLimitReached:5808,MaxParticipantLimitReached2:5817,SharingStolenError:10029,DowngradeToStreamingClient:3099,MediaDropDuringConnect:3100,MediaDropAfterConnect:3101,MediaAnswerProcessingError:3102,MediaFinalAnswerProcessingError:3103,MediaOfferTimeout:3104,MediaFinalAnswerTimeout:3105,MediaOfferNull:3106,MediaAudioDeviceError:3107,MediaRenegotiationError:3108,MediaPermissionError:3109,MediaUnknownError:3110,MediaOfferProcessingError:3111,MediaWhiteListingIssue:3112,MediaMuteMicrophoneError:3113,MediaMuteSpeakerError:3114,MediaUnmuteMicrophoneError:3115,MediaUnmuteSpeakerError:3115,AttachActionFailed:4103,AttachFailed:4105,PreheatedCallTimedout:4113,RemovedFromConversation:5e3,DeniedInLobby:5854,RemovedFromCall:5300,TimedOutInLobby:5855,AnonymousJoinDisabledByPolicy:5723,B2bJoinDisabledByPolicy:5724,NoLobbyForBroadcastJoin:5354,NotAllowedDueToInformationBarrier:5810,TeamParkPolicyDisabled:10193,BroadcastLimitReached:800100},d.responseCodeMap=((p={})[d.jsCallEndCodes.Success]=1,p[d.jsCallEndCodes.Cancel]=12,p[d.jsCallEndCodes.Reject]=10,p[d.jsCallEndCodes.NoNgcEndpoint]=2,p[d.jsCallEndCodes.Timeout]=6,p[d.jsCallEndCodes.CallAccepted]=30,p[d.jsCallEndCodes.CallRedirected]=75,p[d.jsCallEndCodes.NotFound]=24,p[d.jsCallEndCodes.CallDoesNotExist]=46,p[d.jsCallEndCodes.NotAcceptable]=5,p[d.jsCallEndCodes.BadRequest]=5,p[d.jsCallEndCodes.MediaError]=4,p[d.jsCallEndCodes.ConfParticipantCountLimitReached]=59,p[d.jsCallEndCodes.CallModalityFailure]=4,p[d.jsCallEndCodes.NetworkError]=3,p[d.jsCallEndCodes.LocalHttpStackError]=31,p[d.jsCallEndCodes.LocalError]=25,p[d.jsCallEndCodes.CallForwarded]=27,p[d.jsCallEndCodes.CallForwardedToVoicemail]=28,p[d.jsCallEndCodes.SkypeTokenError]=29,p[d.jsCallEndCodes.InternalServerError]=7,p[d.jsCallEndCodes.Conflict]=7,p[d.jsCallEndCodes.GlareError]=7,p[d.jsCallEndCodes.CallLegEndedOnService]=7,p[d.jsCallEndCodes.NotAcceptableHere]=26,p[d.jsCallEndCodes.UnknownError]=32,p[d.jsCallEndCodes.Forbidden]=8,p[d.jsCallEndCodes.PreconditionFailed]=65,p),d.pstnConsumerResponseCodeMap=((h={})[9401]=33,h[9422]=33,h[6102]=1,h[6423]=14,h[9402]=14,h[9432]=14,h[6519]=3,h[9403]=15,h[9410]=36,h[9411]=37,h[1e3]=2,h[9407]=17,h[13430]=18,h[6009]=19,h[10484]=19,h[10604]=19,h[10404]=19,h[10420]=19,h[10403]=20,h[17401]=20,h[10408]=9,h[10486]=11,h[10600]=11,h[10686]=11,h[10487]=21,h[10500]=3,h[10501]=3,h[10502]=3,h[10503]=3,h[10504]=3,h[10480]=22,h[10482]=22,h[10603]=10,h[13406]=23,h[13416]=23,h),d.pstnEnterpriseResponseCodeMap=((g={})[500]=39,g[403]=41,g[404]=42,g[480]=40,g),d.incomingCallEvents={INCOMING_SKYPE_NGC_CALL:107,INCOMING_SKYPE_NGC_GVC_CALL:109,INCOMING_PSTN_NGC_CALL:111,INCOMING_SCREENSHARE_WITH_CHAT:119},d.proxiedEvents={SHARED_LINE_CALL_RECORD:121,SHARED_LINE_V2_CALL_RECORD:123},d.logUploadEvents={LOG_UPLOAD_EVENT:120},function(l){l[l.CallTerminationSubCodeSipGWMin=2e5]=\"CallTerminationSubCodeSipGWMin\",l[l.CallTerminationSubCodeSipGWMax=299999]=\"CallTerminationSubCodeSipGWMax\"}(d.PstnTerminationCode||(d.PstnTerminationCode={})),function(l){l[l.CallTerminationSubCodeSipGWMin=4e5]=\"CallTerminationSubCodeSipGWMin\",l[l.CallTerminationSubCodeSipGWMax=499999]=\"CallTerminationSubCodeSipGWMax\"}(d.EnterpisePstnTerminationCode||(d.EnterpisePstnTerminationCode={})),function(l){l[l.Unmuted=0]=\"Unmuted\",l[l.ServerMuted=1]=\"ServerMuted\",l[l.Muted=2]=\"Muted\",l[l.AttemptingUnmute=3]=\"AttemptingUnmute\"}(d.ParticipantMuteState||(d.ParticipantMuteState={})),function(l){l[l.Undefined=0]=\"Undefined\",l[l.Hold=1]=\"Hold\",l[l.Resume=2]=\"Resume\"}(d.RenegotiationOfferType||(d.RenegotiationOfferType={})),d.jsCallEndPhrase={Unknown:\"CallEndReasonUnknown\",MediaError:\"CallEndReasonMediaError\",MediaOfferTimeout:\"CallEndReasonMediaOfferTimeout\",MediaFinalAnswerTimeout:\"CallEndReasonMediaFinalAnswerTimeout\",MediaAnswerError:\"CallEndReasonMediaAnswerError\",MediaFinalAnswerError:\"CallEndReasonFinalAnswerError\",MediaPermissionError:\"CallEndReasonMediaPermissionError\",MediaRenegotiationError:\"CallEndReasonRenegotiationError\",MediaDropDuringConnect:\"CallEndReasonMediaDropDuringConnectError\",MediaDropAfterConnect:\"CallEndReasonMediaDropAfterConnectError\",MediaOfferProcessingError:\"CallEndReasonMediaOfferProcessingError\",DowngradeToStreamingClient:\"DowngradeToStreamingClient\",IncompatibleOffer:\"CallEndReasonIncompatibleOffer\",MediaWhiteListingIssue:\"MediaWhitelistingIssue\",AudioDeviceError:\"CallEndReasonAudioDeviceError\",AttachFailed:\"CallEndReasonAttachFailed\",BadNotificationPayload:\"CallEndReasonBadNotificationPayload\",RetargetNotSupported:\"RetargetNotSupported\",CallEndReasonLocalUserInitiated:\"CallEndReasonLocalUserInitiated\",EndedByRemoteEndpoint:\"EndedByRemoteEndpoint\",CallEndReasonRedirected:\"CallEndReasonRedirected\"},function(l){l.MediaCreateOffer=\"MediaCreateOffer\",l.SignalingStartNegotiation=\"SignalingStartNegotiation\",l.SignalingRenegotiationAnswer=\"SignalingRenegotiationAnswer\",l.MediaProcessAnswer=\"MediaProcessAnswer\",l.MediaProcessOffer=\"MediaProcessOffer\",l.MediaCreateAnswer=\"MediaCreateAnswer\",l.SignalingAcceptRenegotiation=\"SignalingAcceptRenegotiation\",l.SignalingMediaAcknowledgement=\"SignalingMediaAcknowledgement\",l.CompleteNegotiation=\"CompleteNegotiation\"}(d.RenegotiationPhase||(d.RenegotiationPhase={})),function(l){l.GetSignalingMediaTypes=\"GetSignalingMediaTypes\",l.CallStart=\"CallStart\",l.WaitForAnswer=\"WaitForAnswer\",l.WaitForConnect=\"WaitForConnect\",l.Accept=\"Accept\"}(d.CallSetupSignalingPhase||(d.CallSetupSignalingPhase={})),function(l){l.InitializeMediaSession=\"InitializeMediaSession\",l.UpdateMediaModalities=\"UpdateMediaModalities\",l.CreateOffer=\"CreateOffer\",l.CreateAnswer=\"CreateAnswer\",l.ProcessAnswer=\"ProcessAnswer\",l.GetSignalingMediaTypes=\"GetSignalingMediaTypes\",l.MuteUnmute=\"MuteUnmute\",l.MuteUnmuteSpeakers=\"MuteUnmuteSpeakers\",l.StartVideoSafe=\"StartVideoSafe\",l.CompleteNegotiation=\"CompleteNegotiation\",l.MuteInput=\"MuteInput\",l.MuteOutput=\"MuteOutput\",l.UnmuteInput=\"UnmuteInput\",l.UnmuteOutput=\"UnmuteOutput\"}(d.CallSetupMediaPhase||(d.CallSetupMediaPhase={})),function(l){l.ProcessIncomingCallRequest=\"ProcessIncomingCallRequest\",l.ResolvePotentialConflict=\"ResolvePotentialConflict\",l.SendAttach=\"SendAttach\",l.WaitForMediaOffer=\"WaitForMediaOffer\",l.OnAcknowledgeSuccess=\"OnAcknowledgeSuccess\"}(d.CallAckSignalingPhase||(d.CallAckSignalingPhase={})),function(l){l.InitializeMediaSession=\"InitializeMediaSession\",l.ProcessOffer=\"ProcessOffer\",l.ProcessOfferedModalities=\"ProcessOfferedModalities\",l.TrySendingProvisionalAnswer=\"TrySendingProvisionalAnswer\"}(d.CallAckMediaPhase||(d.CallAckMediaPhase={})),function(l){l.Success=\"Success\",l.ExpectedError=\"ExpectedError\",l.UnexpectedClientError=\"UnexpectedClientError\",l.UnexpectedServerError=\"UnexpectedServerError\"}(d.ResultCategory||(d.ResultCategory={}))},function(l,d,u){function generateGuid(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,(function(l){var d=16*Math.random()|0;return(\"x\"===l?d:3&d|8).toString(16)}))}Object.defineProperty(d,\"__esModule\",{value:!0}),d.default=generateGuid},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.DATA_SOURCE_ID_ANY=d.CONSTANTS=void 0,d.CONSTANTS={CODE:{SUCCESS:0,CLIENT_ERROR_CODE:499},SUB_CODE:{ACTION_NOT_ALLOWED:3548,ABANDONED:4990,ENDED_BY_REMOTE_ENDPOINT:5028,BEACON:4521}},d.DATA_SOURCE_ID_ANY=4294967294},function(l,d,u){function getMediaLabel(l){switch(l){case 0:return\"main-audio\";case 1:return\"main-video\";case 2:return\"applicationsharing-video\";case 3:return\"data\"}throw new Error(\"Invalid media type\")}function getMediaType(l){switch(l){case\"main-audio\":return 0;case\"main-video\":return 1;case\"applicationsharing-video\":return 2;case\"data\":return 3}throw new Error(\"Invalid media label\")}function mapMediaTypeStringToMediaType(l){switch(l){case\"audio\":return 0;case\"video\":return 1;case\"applicationsharing-video\":return 2;case\"data\":return 3;default:return}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.mapMediaTypeStringToMediaType=d.getMediaType=d.getMediaLabel=void 0,d.getMediaLabel=getMediaLabel,d.getMediaType=getMediaType,d.mapMediaTypeStringToMediaType=mapMediaTypeStringToMediaType},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.build=d.Stopwatch=void 0;var p=function(){function Stopwatch(){var l=this;this.msElapsed=0,this.isPaused=!1,this.startTime=(new Date).getTime(),this.pause=function(){l.isPaused||(l.msElapsed+=(new Date).getTime()-l.startTime,l.isPaused=!0)},this.resume=function(){l.isPaused&&(l.isPaused=!1,l.startTime=(new Date).getTime())},this.duration=function(){return l.isPaused?l.msElapsed:l.msElapsed+(new Date).getTime()-l.startTime},this.durationInMinutes=function(){var d=l.duration()/6e4;return Math.ceil(d)},this.durationInSeconds=function(){var d=l.duration()/1e3;return Math.ceil(d)}}return Stopwatch}();function build(){return new p}d.Stopwatch=p,d.build=build},function(l,d,u){var p,h,g,f,m,v=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.CallTelemetryBuilder=d.LocalStats=d.MediaReceiverStats=d.MediaSenderStats=d.AudioStats=d.MediaModalityStats=d.CallStats=d.Events=d.Props=d.MediaReceiverEvent=d.MediaSenderEvent=d.MediaEvent=d.CallEvent=void 0;var y,S,_,C,E=u(8),T=u(56),b=u(34);!function(l){l[l.CallStateChanged=0]=\"CallStateChanged\",l[l.TrouterStateChanged=1]=\"TrouterStateChanged\",l[l.MultiPartyModeSet=2]=\"MultiPartyModeSet\",l[l.MediaRetargetSucceeded=3]=\"MediaRetargetSucceeded\",l[l.MediaRetargetFailed=4]=\"MediaRetargetFailed\"}(y=d.CallEvent||(d.CallEvent={})),function(l){l[l.StartModality=0]=\"StartModality\",l[l.StopModality=1]=\"StopModality\",l[l.StreamStateChanged=2]=\"StreamStateChanged\",l[l.NegotiationStateChanged=3]=\"NegotiationStateChanged\"}(S=d.MediaEvent||(d.MediaEvent={})),function(l){l[l.SelectSource=0]=\"SelectSource\",l[l.AttachSource=1]=\"AttachSource\",l[l.DetachSource=2]=\"DetachSource\"}(_=d.MediaSenderEvent||(d.MediaSenderEvent={})),function(l){l[l.Available=0]=\"Available\",l[l.Subscribe=1]=\"Subscribe\",l[l.Subscribed=2]=\"Subscribed\",l[l.Unsubscribe=3]=\"Unsubscribe\",l[l.Unsubscribed=4]=\"Unsubscribed\",l[l.RenderingStarted=5]=\"RenderingStarted\",l[l.RenderingStopped=6]=\"RenderingStopped\"}(C=d.MediaReceiverEvent||(d.MediaReceiverEvent={}));var I=function(){function PiiValue(l,d){this.value=l,this.piiKind=d}return PiiValue}(),A=function(){function Props(){}return Props.agentEnvironmentId=\"agent_environment_id\",Props.correlationId=\"CorrelationId\",Props.participantId=\"participant_id\",Props.tenantId=\"TenantId\",Props.userHexCID=\"UserHexCID\",Props.acsResourceId=\"AcsResourceId\",Props.endpointId=\"endpoint_id\",Props.mediaLegId=\"media_leg_id\",Props.webMediaConfigIds=\"web_media_config_ids\",Props.tsCallingVersion=\"ts_calling_version\",Props}();d.Props=A;var R=function(){function Events(){}return Events.diagnostics=\"MediaDiagnostic\",Events.qoeStats=\"QoE\",Events.ortcReports=\"ortc_reports\",Events.ortcReportsInitial=\"ortc_reports_initial\",Events.webrtcSession=\"webrtc_session\",Events.webrtcSessionInitial=\"webrtc_session_initial\",Events.mediaSession=\"pluginless_modality_session\",Events.callSession=\"pluginless_call_session\",Events}();d.Events=R;var P=function(){function Stats(l){this.eventName=l,this.ended=!1,this.events=[]}return Stats.prototype.setLocalUserId=function(l){this.localUserId=l},Stats.prototype.start=function(){this.ended||(this.startTime=Date.now())},Stats.prototype.end=function(l){void 0===l&&(l=0),this.ended||(this.ended=!0,this.resultCode=l)},Stats.prototype.asStatsRecord=function(l){var d=this;if(void 0===l&&(l={}),E.isEmpty(this.events))return null;var u=E.uniqBy(this.events,(function(l){return JSON.stringify(l)})).map((function(l){var u,p=((u={})[l.type]=l.timestamp-d.startTime,u);return E.isEmpty(l.data)||(p.data=l.data),p}));return{name:this.eventName,record:E.assign({LocalUser:this.localUserId,ResultCode:String(this.resultCode),EventTimestampBag:JSON.stringify({eventStart:this.startTime,events:u})},l)}},Stats.prototype.add=function(l){!this.ended&&l.type&&(E.isUndefined(this.startTime)&&(this.startTime=Date.now()),E.isUndefined(l.timestamp)&&(l.timestamp=Date.now()),this.events.push(l))},Stats}(),O=function(l){function CallStats(){return l.call(this,R.callSession)||this}return v(CallStats,l),CallStats.prototype.callStateChanged=function(d){l.prototype.add.call(this,{type:y[y.CallStateChanged],data:CallStats.callStateToString[d]||d})},CallStats.prototype.event=function(d){l.prototype.add.call(this,{type:y[d]})},CallStats.callStateToString=((p={})[0]=\"None\",p[1]=\"Notified\",p[2]=\"Connecting\",p[3]=\"Connected\",p[4]=\"LocalHold\",p[5]=\"RemoteHold\",p[6]=\"Disconnecting\",p[7]=\"Disconnected\",p[8]=\"Observing\",p[10]=\"Lobby\",p),CallStats}(P);d.CallStats=O;var M=function(l){function MediaModalityStats(d,u){var p=l.call(this,R.mediaSession)||this;return p.mediaType=d,p.mediaDirection=u,p.streamDirection=MediaModalityStats.mediaDirectionToStream[p.mediaDirection],p}return v(MediaModalityStats,l),MediaModalityStats.prototype.addEvent=function(d,u){l.prototype.add.call(this,{type:d,data:u})},MediaModalityStats.prototype.lifecycle=function(l){this.addEvent(S[l])},MediaModalityStats.prototype.streamStateChanged=function(l,d){void 0===d&&(d=this.streamDirection);var u=S[S.StreamStateChanged];this.addEvent(u,{state:MediaModalityStats.streamStateToString[l],direction:MediaModalityStats.streamDirectionToString[d]})},MediaModalityStats.prototype.negotiationStateChanged=function(l,d,u){void 0===u&&(u=this.streamDirection);var p=S[S.NegotiationStateChanged];this.addEvent(p,{state:MediaModalityStats.negotiationStateToString[l],reason:d})},MediaModalityStats.prototype.asStatsRecord=function(d){return void 0===d&&(d={}),l.prototype.asStatsRecord.call(this,E.assign({MediaType:MediaModalityStats.mediaTypeToString[this.mediaType],Role:MediaModalityStats.mediaDirectionToRole[this.mediaDirection]},d))},MediaModalityStats.negotiationStateToString={started:\"NegotiationStarted\",rejected:\"NegotiationRejected\",completed:\"NegotiationCompleted\"},MediaModalityStats.streamStateToString={created:\"StreamCreated\",started:\"StreamStarted\",active:\"StreamActive\",inactive:\"StreamInactive\",stopped:\"StreamStopped\",removed:\"StreamRemoved\",failed:\"StreamFailed\",cancelled:\"StreamCancelled\"},MediaModalityStats.streamDirectionToString={send:\"Send\",receive:\"Receive\"},MediaModalityStats.mediaTypeToString=((h={})[0]=\"Audio\",h[1]=\"Video\",h[2]=\"ScreenShare\",h[3]=\"Data\",h),MediaModalityStats.mediaDirectionToRole=((g={})[1]=\"Receiver\",g[2]=\"Sender\",g[4]=\"Bidirectional\",g),MediaModalityStats.mediaDirectionToStream=((f={})[1]=\"receive\",f[2]=\"send\",f),MediaModalityStats}(P);d.MediaModalityStats=M;var w=function(l){function AudioStats(){return l.call(this,0,4)||this}return v(AudioStats,l),AudioStats.prototype.start=function(){l.prototype.start.call(this),l.prototype.lifecycle.call(this,S.StartModality)},AudioStats.prototype.stop=function(){l.prototype.lifecycle.call(this,S.StopModality)},AudioStats}(M);d.AudioStats=w;var N=function(l){function MediaSenderStats(d){var u=l.call(this,d,2)||this;return u.mediaType=d,u}return v(MediaSenderStats,l),MediaSenderStats.prototype.start=function(){l.prototype.start.call(this),l.prototype.lifecycle.call(this,S.StartModality)},MediaSenderStats.prototype.stop=function(){l.prototype.lifecycle.call(this,S.StopModality)},MediaSenderStats.prototype.event=function(d){l.prototype.addEvent.call(this,_[d])},MediaSenderStats}(M);d.MediaSenderStats=N;var D=function(l){function MediaReceiverStats(d,u){var p=l.call(this,d,1)||this;return p.mediaType=d,p.remoteParticipantId=u,p.rendererCounter=0,p}return v(MediaReceiverStats,l),MediaReceiverStats.prototype.newRendererId=function(){return this.rendererCounter+=1,String(this.rendererCounter)},MediaReceiverStats.prototype.event=function(d,u,p){l.prototype.addEvent.call(this,C[d],E.isUndefined(p)?{rendererId:u}:{rendererId:u,sourceId:p})},MediaReceiverStats.prototype.asStatsRecord=function(){return l.prototype.asStatsRecord.call(this,{TargetUser:this.remoteParticipantId})},MediaReceiverStats}(M);d.MediaReceiverStats=D;var L=function(){function LocalStats(){this.allStats=[],this.ended=!1}return LocalStats.prototype.setLocalUserId=function(l){this.localUserId=l},Object.defineProperty(LocalStats.prototype,\"call\",{get:function(){return this.callStats||this.startCall()},enumerable:!1,configurable:!0}),Object.defineProperty(LocalStats.prototype,\"audio\",{get:function(){return this.audioStats||this.newSession(0)},enumerable:!1,configurable:!0}),Object.defineProperty(LocalStats.prototype,\"video\",{get:function(){return this.videoStats||this.newSession(1)},enumerable:!1,configurable:!0}),Object.defineProperty(LocalStats.prototype,\"screenShare\",{get:function(){return this.sharingStats||this.newSession(2)},enumerable:!1,configurable:!0}),LocalStats.prototype.renderer=function(l,d){var u=this.renderingStats[d];return u||(u=this.renderingStats[d]=this.receive(l,d)),u},LocalStats.prototype.startCall=function(){return this.callStats?this.callStats:(this.callStats=new O,this.callStats.start(),this.addStats(this.callStats))},LocalStats.prototype.endCall=function(l){void 0===l&&(l=0),this.ended=!0,this.call.end(l),this.allStats.forEach((function(l){return l.end()})),this.cleanUp()},LocalStats.prototype.cleanUp=function(){this.audioStats&&(this.audioStats.stop(),this.audioStats=null),this.videoStats&&(this.videoStats.stop(),this.videoStats=null),this.sharingStats&&(this.sharingStats.stop(),this.sharingStats=null)},LocalStats.prototype.newSession=function(l){var d;switch(l){case 0:d=this.audioStats=new w;break;case 1:d=this.videoStats=new N(l);break;case 2:d=this.sharingStats=new N(l)}return this.addStats(d)},LocalStats.prototype.receive=function(l,d){var u=new D(l,d);return u.start(),this.addStats(u)},LocalStats.prototype.buildStatsRecords=function(){return this.allStats.map((function(l){return l.asStatsRecord()})).filter((function(l){return!!l}))},LocalStats.prototype.addStats=function(l){return this.ended||(this.allStats.push(l),l.setLocalUserId(this.localUserId)),l},LocalStats}();d.LocalStats=L;var k=function(){function CallTelemetryBuilder(){this.localStats=new L,this.tsCallingVersion=(0,b.getTsCallingVersion)()}return CallTelemetryBuilder.prototype.setCallId=function(l){this.callId=l},CallTelemetryBuilder.prototype.setTenantId=function(l){this.tenantId=l},CallTelemetryBuilder.prototype.setUserHexCID=function(l){this.userHexCID=l},CallTelemetryBuilder.prototype.setParticipantId=function(l){this.participantId=l},CallTelemetryBuilder.prototype.setEndpointId=function(l){this.endpointId=l},CallTelemetryBuilder.prototype.setMediaLegId=function(l){this.mediaLegId=l},CallTelemetryBuilder.prototype.setMediaStats=function(l){this.mediaStats=l},CallTelemetryBuilder.prototype.setAcsResourceId=function(l){this.acsResourceId=l},CallTelemetryBuilder.prototype.appendDataChannelInfo=function(l){var d;(null===(d=this.mediaStats)||void 0===d?void 0:d.data)&&l&&(this.mediaStats.data.DataHandlers=l)},CallTelemetryBuilder.prototype.appendSharingControlInfo=function(l){var d;(null===(d=this.mediaStats)||void 0===d?void 0:d.data)&&(this.mediaStats.data.SharingControlEnabled=l?\"true\":\"false\")},CallTelemetryBuilder.prototype.appendMediaControlPaneInfo=function(l){var d;(null===(d=this.mediaStats)||void 0===d?void 0:d.data)&&l&&(this.mediaStats.data.MediaControlPlane=l)},CallTelemetryBuilder.prototype.appendTerminationInfo=function(l,d){var u;(null===(u=this.mediaStats)||void 0===u?void 0:u.data)&&(this.mediaStats.data.TerminatedReason=\"\".concat(l),this.mediaStats.data.TerminatedState=\"\".concat(d))},CallTelemetryBuilder.prototype.setWebMediaConfigIds=function(l){this.webMediaConfigIds=Array.isArray(l)?l.join(\",\"):l},CallTelemetryBuilder.prototype.buildFromMediaStats=function(){if(!this.mediaStats)return[];var l=[];return\"OrtcMediaStats\"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,R.ortcReports)]:\"WebRtcMediaStats\"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,R.webrtcSession)]:l},CallTelemetryBuilder.prototype.buildMediaTelemetry=function(){if(this.mediaStats){var l=this.buildEvent(this.mediaStats.data,null).props,d={};return Object.keys(l).forEach((function(u){void 0===l[u].piiKind?d[u]=l[u]:d[u]=l[u].value})),d}},CallTelemetryBuilder.prototype.buildFromCallSetupStats=function(){return this.mediaStats?\"OrtcMediaStats\"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,R.ortcReportsInitial)]:\"WebRtcMediaStats\"===this.mediaStats.type?[this.buildEvent(this.mediaStats.data,R.webrtcSessionInitial)]:[]:[]},CallTelemetryBuilder.prototype.buildFromLocalStats=function(){var l=this;return this.localStats.buildStatsRecords().map((function(d){return l.buildEvent(d.record,d.name)}))},CallTelemetryBuilder.prototype.buildEvent=function(l,d){var u={};return u[A.agentEnvironmentId]=CallTelemetryBuilder.agentEnvironmentId,u[A.correlationId]=this.callId||\"\",u[A.tenantId]=this.tenantId||\"\",u[A.userHexCID]=this.userHexCID||\"\",u[A.participantId]=this.participantId||\"\",u[A.endpointId]=this.endpointId||\"\",u[A.mediaLegId]=this.mediaLegId||\"\",u[A.webMediaConfigIds]=this.webMediaConfigIds||\"\",u[A.tsCallingVersion]=this.tsCallingVersion||\"\",u[A.acsResourceId]=this.acsResourceId||\"\",{eventName:d,props:this.buildProps(l,null,u)}},CallTelemetryBuilder.prototype.normalizeKey=function(l){return l.replace(/[^a-zA-Z0-9._]/g,\"_\")},CallTelemetryBuilder.prototype.createPiiValueFromMAStat=function(l,d){if(!(d in CallTelemetryBuilder.piiDict))throw new Error(\"unknown PII type\");return new I(l,CallTelemetryBuilder.piiDict[d])},CallTelemetryBuilder.prototype.buildProps=function(l,d,u){var p=this;return E.keys(l).forEach((function(h){var g=p.normalizeKey(h),f=d?\"\".concat(d,\"_\").concat(g):g,m=l[h];if(E.isString(m))u[f]=p.getPiiAwareValue(h,m);else if(E.isArray(m)){if(m.length>0){var v=m,y=v.map((function(l){return l.value})).toString();u[f]=p.createPiiValueFromMAStat(y,v[0].type)}}else if(E.isObject(m))if(m.__VALUE__){var S=m;E.isBoolean(S.value)&&(S.value=S.value?\"true\":\"false\"),u[f]=p.createPiiValueFromMAStat(S.value,S.type)}else p.buildProps(m,f,u)})),u},CallTelemetryBuilder.prototype.getPiiAwareValue=function(l,d){return CallTelemetryBuilder.piiProps.hasOwnProperty(l)?new I(d,CallTelemetryBuilder.piiProps[l]):d},CallTelemetryBuilder.prototype.build=function(){return E.flatten([this.buildFromMediaStats(),this.buildFromLocalStats()])},CallTelemetryBuilder.agentEnvironmentId=(0,T.default)(),CallTelemetryBuilder.piiProps={IPAddr:13,MACAddr:13,IPAddress:13,OpaqueData:0,LocalSite:13,RemoteSite:13,BaseAddress:13,LocalAddress:13,RemoteAddress:13,NetworkName:12,LocalUser:10,TargetUser:10},CallTelemetryBuilder.piiDict=((m={})[0]=0,m[13]=13,m[4]=4,m),CallTelemetryBuilder}();d.CallTelemetryBuilder=k},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ngcStreamTypes=d.streamDirections=void 0,d.streamDirections={send:\"sendonly\",receive:\"recvonly\",sendReceive:\"sendrecv\"},d.ngcStreamTypes={audio:\"audio\",video:\"video\",sharing:\"applicationsharing-video\",audioteleconference:\"audio-teleconferencing\"}},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.RemoteImageRenderer=d.RemoteVideoRenderer=d.LocalVideoRenderer=d.toMediaAgentScalingMode=void 0;var f=u(18),m=u(60);function toMediaAgentScalingMode(l){switch(l){case 1:return\"crop\";case 0:return\"stretch\";case 2:default:return\"fit\"}}d.toMediaAgentScalingMode=toMediaAgentScalingMode;var v=function(l){function VideoRendererBase(){var d=null!==l&&l.apply(this,arguments)||this;return d.isRendering=!1,d.frameType=-1,d}return p(VideoRendererBase,l),Object.defineProperty(VideoRendererBase.prototype,\"rendererType\",{get:function(){return 0},enumerable:!1,configurable:!0}),VideoRendererBase.prototype.captureFrame=function(){if(this.renderer.captureFrame)return this.renderer.captureFrame();throw new Error(\"Not implemented yet\")},VideoRendererBase.prototype.getStats=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){if(this.renderer.getStats)return[2,this.renderer.getStats()];throw new Error(\"Renderer does not support stats\")}))}))},VideoRendererBase.prototype.setScalingMode=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this.renderer.setScalingMode(toMediaAgentScalingMode(l)),[2]}))}))},VideoRendererBase.prototype.dumpVideoSourceImages=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){throw new Error(\"Not implemented\")}))}))},VideoRendererBase.prototype.cameraAutoControl=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(l){throw new Error(\"Not implemented\")}))}))},VideoRendererBase.prototype.getCameraManualControlStates=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(l){throw new Error(\"Not implemented\")}))}))},VideoRendererBase.prototype.setCameraManualControlStates=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(l){throw new Error(\"Not implemented\")}))}))},VideoRendererBase.prototype.enumerateCameraManualControls=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){throw new Error(\"Not implemented\")}))}))},VideoRendererBase.prototype.onVideoSizeChanged=function(l,d){this.streamSize={width:l,height:d},this.event(\"videoSizeChanged\").raise(l,d),this.raiseChanged()},VideoRendererBase}(f.default),y=function(l){function LocalVideoRenderer(d,u){var p=l.call(this)||this;return p.renderer=u.createPreviewRenderer(d),p.renderer.on(\"onVideoSizeChanged\",(function(l,d){return p.onVideoSizeChanged(l,d)})),p}return p(LocalVideoRenderer,l),LocalVideoRenderer.prototype.onVideoSizeChanged=function(d,u){this.isRendering=d>0&&u>0,l.prototype.onVideoSizeChanged.call(this,d,u)},LocalVideoRenderer.prototype.setVideoMirroring=function(l){this.renderer.setVideoMirroring(l)},LocalVideoRenderer.prototype.startVideoAsync=function(){return this.renderer.startVideoAsync()},LocalVideoRenderer.prototype.dispose=function(){this.renderer&&(this.renderer.dispose(),this.renderer=null)},LocalVideoRenderer}(v);d.LocalVideoRenderer=y;var S=function(l){function RemoteVideoRenderer(d,u,p,h){var g=l.call(this)||this;return g.target=d,g.rendererStats=p,g.configProvider=h,g.subscriptionActive=!1,g.firstFrameRendered=!1,g.rendererId=p.newRendererId(),g.renderer=u.createRemoteRenderer(d),g.renderer.on(\"onVideoSizeChanged\",(function(l,d){return g.onVideoSizeChanged(l,d)})),g.renderer.on(\"onVideoStateChanged\",(function(l){return g.onVideoStateChanged(l)})),g.renderer.on(\"onIsRenderingChanged\",(function(l){return g.onIsRenderingChanged(l)})),g}return p(RemoteVideoRenderer,l),RemoteVideoRenderer.prototype.onVideoStateChanged=function(l){this.rendererStats.streamStateChanged(l.stream)},RemoteVideoRenderer.prototype.onVideoSizeChanged=function(d,u){this.configProvider.config.videoIsRenderingCheck&&this.setIsRendering(d>0&&u>0),l.prototype.onVideoSizeChanged.call(this,d,u)},RemoteVideoRenderer.prototype.setIsRendering=function(l){this.isRendering!==l&&(this.isRendering=l,this.rendererStats.event(this.isRendering?m.MediaReceiverEvent.RenderingStarted:m.MediaReceiverEvent.RenderingStopped,this.rendererId),this.configProvider.config.isStreamingMatchIsRendering&&this.currentVideoStream&&(this.currentVideoStream.isStreaming=l),this.isRendering&&!this.firstFrameRendered&&(this.firstFrameRendered=!0,this.event(\"firstFrameRendered\").raise()))},RemoteVideoRenderer.prototype.onIsRenderingChanged=function(l){this.setIsRendering(l),this.raiseChanged()},RemoteVideoRenderer.prototype.subscribeVideoAsync=function(l){var d=this;this.currentVideoStream=l,this.rendererStats.event(m.MediaReceiverEvent.Subscribe,this.rendererId,l.id);var u=this.renderer.subscribeVideoAsync(l.id,1===l.type);return this.subscriptionActive=!0,u.then((function(){d.rendererStats.event(m.MediaReceiverEvent.Subscribed,d.rendererId,l.id),d.watchStream(l)})),u},RemoteVideoRenderer.prototype.watchStream=function(l){var d=this;this.changeSub&&this.changeSub.dispose(),this.changeSub=l.changed((function(){l.isAvailable?d.subscriptionActive||d.subscribeVideoAsync(l):(d.subscriptionActive=!1,d.rendererStats.event(m.MediaReceiverEvent.Unsubscribe,d.rendererId),d.renderer.unsubscribeNow(),d.rendererStats.event(m.MediaReceiverEvent.Unsubscribed,d.rendererId))}))},RemoteVideoRenderer.prototype.dispose=function(){this.renderer&&(this.subscriptionActive&&(this.rendererStats.event(m.MediaReceiverEvent.Unsubscribe,this.rendererId),this.currentVideoStream&&!this.currentVideoStream.isAvailable&&this.renderer.unsubscribeNow()),this.renderer.dispose(),this.subscriptionActive&&this.rendererStats.event(m.MediaReceiverEvent.Unsubscribed,this.rendererId),this.renderer=null,this.currentVideoStream=null),this.changeSub&&(this.changeSub.dispose(),this.changeSub=null)},RemoteVideoRenderer}(v);d.RemoteVideoRenderer=S;var _=function(l){function RemoteImageRenderer(d,u,p){var h=l.call(this)||this;return h.imageRenderingSession=d,h.target=u,h.id=p,h}return p(RemoteImageRenderer,l),RemoteImageRenderer.prototype.start=function(l){var d=this;return this.renderer?Promise.reject(\"RemoteImageRenderer already started id: \".concat(this.id)):this.imageRenderingSession?(this.renderer=this.imageRenderingSession.imageRendererProvider.createRenderer({frameUris:l,frameContainer:this.target,callParams:this.imageRenderingSession.callParams,id:this.id}),this.eventSubscription=this.renderer.once(\"onRendererDisposed\",(function(){d.dispose()})),this.renderer.start().then((function(){d.isRendering=!0,d.raiseChanged()})).catch((function(l){return d.dispose(),Promise.reject(l)}))):Promise.reject(\"imageRenderingSession not provided id: \".concat(this.id))},RemoteImageRenderer.prototype.dispose=function(){this.renderer&&(this.renderer.dispose(),this.renderer=void 0),this.eventSubscription&&(this.eventSubscription.dispose(),this.eventSubscription=void 0),this.isRendering=!1,this.raiseChanged()},RemoteImageRenderer}(v);d.RemoteImageRenderer=_},function(l,d){var u;u=function(){return this}();try{u=u||new Function(\"return this\")()}catch(l){\"object\"==typeof window&&(u=window)}l.exports=u},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(13),m=u(17),v=u(15),y=u(7),S=u(1),_=function(l){function AudioRenderer(d,u){var p=l.call(this)||this;return p.logger=d,p.configProvider=u,p.window=v.default.window,p.isMuted=!1,p.isPlayingAllowed=!1,p.audioContext=null,p.sourceNode=null,p.gainNode=null,p.onAudioError=function(l){var d=l&&l.target||p.audio;d&&d.error?p.logger.safe.error(\"error with rendering audio code: \".concat(d.error.code,\", message: \").concat(d.error.message)):p.logger.safe.error(\"error with audio rendering\")},p.onAudioPaused=function(){return h(p,void 0,void 0,(function(){var l;return g(this,(function(d){switch(d.label){case 0:return this.configProvider.config.audioRendererRestartOnPause&&this.canPlay&&!this.isMuted?(l=(0,f.generateCauseId)(),this.logger.safe.info(\"[\".concat(l,\"] audio playback is paused by OS, resuming it\")),[4,this.startStream(l)]):[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))}))},p}return p(AudioRenderer,l),Object.defineProperty(AudioRenderer.prototype,\"muted\",{get:function(){return this.isMuted},enumerable:!1,configurable:!0}),AudioRenderer.prototype.setMuted=function(l,d){return h(this,void 0,void 0,(function(){return g(this,(function(u){return this.isMuted=l,l?[2,this.stopStream(d)]:[2,this.startStream(d)]}))}))},Object.defineProperty(AudioRenderer.prototype,\"canPlay\",{get:function(){return this.stream&&this.isPlayingAllowed},enumerable:!1,configurable:!0}),AudioRenderer.prototype.getStream=function(){return this.stream},AudioRenderer.prototype.getDeviceId=function(){return this.deviceId},AudioRenderer.prototype.play=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this.stream=l,this.isPlayingAllowed=!0,this.isMuted?[2]:[2,this.startStream()]}))}))},AudioRenderer.prototype.stop=function(){this.stopStream(),this.isPlayingAllowed=!1},AudioRenderer.prototype.setOutputDevice=function(l,d){return void 0===d&&(d=(0,f.generateCauseId)()),h(this,void 0,void 0,(function(){var u=this;return g(this,(function(p){return this.audio?this.audio.setSinkId?l?(this.logger.safe.info(\"[\".concat(d,\"] setting audio output device ID to \").concat(m.scrubMriOrOmit(l))),this.deviceId=l,[2,Promise.resolve(this.audio.setSinkId(l)).catch((function(l){return u.logger.safe.warn(\"[\".concat(d,\"] setSinkId operation was aborted with error \").concat(S.stringifyObject(l)))}))]):[2]:(this.logger.safe.warn(\"[\".concat(d,\"] setting output device is not supported\")),[2]):(this.deviceId=l,[2])}))}))},AudioRenderer.prototype.dispose=function(){this.logger.safe.info(\"dispose\"),this.audio&&(this.stop(),this.stream=null,this.audio.removeEventListener(\"error\",this.onAudioError),this.audio.removeEventListener(\"pause\",this.onAudioPaused),this.window.document.body.removeChild(this.audio),this.event(\"onAudioElementRemoved\").raise(this.audio),this.audio=null),this.detachGainNode()},AudioRenderer.prototype.startStream=function(l){var d;return void 0===l&&(l=(0,f.generateCauseId)()),h(this,void 0,void 0,(function(){var u;return g(this,(function(p){switch(p.label){case 0:if(!this.canPlay)return[2];p.label=1;case 1:return p.trys.push([1,5,,6]),[4,this.assureAudioElement(l)];case 2:return p.sent(),this.logger.safe.info(\"[\".concat(l,\"] attaching stream to renderer: \").concat(null===(d=this.stream)||void 0===d?void 0:d.id)),this.configProvider.config.speakerGainLevel&&this.reattachToGainNode(this.stream,this.configProvider.config.speakerGainLevel),[4,this.window.attachMediaStream(this.audio,this.stream)];case 3:return p.sent(),[4,this.audio.play()];case 4:return p.sent(),[3,6];case 5:return u=p.sent(),this.logger.safe.warn(\"[\".concat(l,\"] play operation was aborted with error \").concat(S.stringifyObject(u))),[3,6];case 6:return[2]}}))}))},AudioRenderer.prototype.assureAudioElement=function(l){return void 0===l&&(l=(0,f.generateCauseId)()),h(this,void 0,void 0,(function(){return g(this,(function(d){return this.audio?[2]:(this.logger.safe.info(\"[\".concat(l,\"] creating audio element\")),this.audio=this.window.document.createElement(\"audio\"),this.audio.addEventListener(\"error\",this.onAudioError),this.audio.addEventListener(\"pause\",this.onAudioPaused),this.window.document.body.appendChild(this.audio),this.audio.autoplay=!0,this.event(\"onAudioElementAdded\").raise(this.audio),[2,this.setOutputDevice(this.deviceId,l)])}))}))},AudioRenderer.prototype.stopStream=function(l){var d;void 0===l&&(l=(0,f.generateCauseId)()),this.audio&&this.canPlay&&(this.detachGainNode(),this.logger.safe.info(\"[\".concat(l,\"] detaching stream from renderer: \").concat(null===(d=this.stream)||void 0===d?void 0:d.id)),this.configProvider.config.audioRendererUsePauseOnDetach?this.audio.pause():this.window.detachMediaStream(this.audio))},AudioRenderer.prototype.attachToGainNode=function(l,d){this.audioContext=new v.default.window.AudioContext,this.sourceNode=this.audioContext.createMediaStreamSource(l),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=d,this.sourceNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination)},AudioRenderer.prototype.detachGainNode=function(){var l,d,u;null===(l=this.sourceNode)||void 0===l||l.disconnect(),this.sourceNode=null,null===(d=this.gainNode)||void 0===d||d.disconnect(),this.gainNode=null,null===(u=this.audioContext)||void 0===u||u.close(),this.audioContext=null},AudioRenderer.prototype.reattachToGainNode=function(l,d){this.detachGainNode(),this.attachToGainNode(l,d)},AudioRenderer}(y.default);d.default=_},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SsrcGenerator=void 0;var p=4294967040,h=function(){function SsrcGenerator(){this.ssrc=Math.floor(Math.random()*(p-1))+1}return SsrcGenerator.prototype.nextAudioStreamSsrc=function(){return this.nextSsrc(0)},SsrcGenerator.prototype.nextVideoStreamSsrc=function(){return this.nextSsrc(99)},SsrcGenerator.prototype.nextSsrc=function(l){var d=this.ssrc;do{d=this.ssrc,this.ssrc=(this.ssrc+l+1)%p,0===this.ssrc&&(this.ssrc=1)}while(d+l>p);return{min:d,max:d+l}},SsrcGenerator}();d.SsrcGenerator=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},g=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},f=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.disabledMedia=d.PartialIceRestartFixup=d.ExtUriNormalizer=d.RemoveNonAdvVLADecoratorExtension=d.AddNonAdvVLADecoratorExtension=d.RemoveVLAHeaderExtension=d.AddVLAHeaderExtension=d.AddMsidFixup=d.SimulcastToMsSDPMediaFixup=d.SimulcastFromMsSDPMediaFixup=d.NoCandidatesFixup=d.CandidatesFixup=d.NoBundleInAnswerFixup=d.BundleOnlyMediaFixup=d.BundleGroupModifier=d.RemoveH264SpsPpsIdrInKeyframe=d.InjectH264SpsPpsIdrInKeyframe=d.RemoveH264ParamsModifier=d.InjectH264ParamsModifier=d.InjectTransportCCAudio=d.AudioPrimaryCodecsModifier=d.NoAudioFixup=d.InOpusEnforcedFmtp=d.G722Fixup=d.ComfortNoiseFixup=d.FilterCodecs=d.RemoveMsRTCAttributes=d.RemoveExtmapAllowMixed=d.AddExtmapAllowMixed=d.ExtensionsFixup=d.IceRestartChecker=d.OutSdpBandwidthModifier=d.InSdpBandwidthModifier=d.RemoveLabelsModifier=d.AddLabelsModifier=d.InSdpReceiveSsrcFixup=d.OutSdpReceiveSsrcFixup=d.SendOnlyModalityFixup=d.IncomingDataModalityFixup=d.RemoveVideoOrientationExtension=d.AddVideoOrientationExtension=d.OutgoingDataModalityFixup=d.InsertDisabledXData=d.RollbackEntitiesFixup=d.DisabledMediaFixup=d.OutgoingDtlsRoleModifier=d.IncomingSrtpFixup=d.MsSdpRemoteModifier=d.MsSdpLocalModifier=void 0;var m=u(17),v=u(42),y=u(3),S=u(9),_=u(39),C=u(364),E=function(){function MsSdpLocalModifier(l,d,u){this.context=l,this.mediaManager=d,this.sessionType=u,this.msSdpT=new C.MsSdpTransform(this.context,this.mediaManager)}return MsSdpLocalModifier.prototype.modify=function(l){this.msSdpT.toMsSdp(l,this.sessionType)},MsSdpLocalModifier}();d.MsSdpLocalModifier=E;var T=function(){function MsSdpRemoteModifier(l,d,u){this.context=l,this.mediaManager=d,this.sessionType=u,this.msSdpT=new C.MsSdpTransform(this.context,this.mediaManager)}return MsSdpRemoteModifier.prototype.modify=function(l){this.msSdpT.fromMsSdp(l,this.sessionType)},MsSdpRemoteModifier}();d.MsSdpRemoteModifier=T;var b=function(){function IncomingSrtpFixup(l){this.context=l}return IncomingSrtpFixup.prototype.modify=function(l){var d=S.preferSdesSrtp(this.context),u=S.getSrtpInfo(l),p=l.media.find((function(l){return!!l.crypto}));l.media.forEach((function(l){l.type!==y.default.MEDIA_TYPE.dataChannel&&(!d&&l.fingerprint&&l.crypto&&delete l.crypto,l.protocol=!u.dtls||u.sdes&&d?y.default.PROFILES.rtpSavpf:y.default.PROFILES.udpTlsRtpSavpf,0===l.port&&l.protocol===y.default.PROFILES.rtpSavpf&&p&&(l.crypto=p.crypto))}))},IncomingSrtpFixup}();d.IncomingSrtpFixup=b;var I=function(){function OutgoingDtlsRoleModifier(l,d,u){this.mediaManager=l,this.isOffer=d,this.configProvider=u}return OutgoingDtlsRoleModifier.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){var p=l.setup,h=d.mediaManager.getMediaEntities()[u],g=h.getExtension(\"setup\");p&&h.isEnabled()&&(\"actpass\"!==p?h.setExtension(\"setup\",p):d.isOffer&&void 0!==g&&\"actpass\"!==g&&!d.configProvider.config.disableOutgoingDtlsRoleOverride&&(l.setup=g))}))},OutgoingDtlsRoleModifier}();d.OutgoingDtlsRoleModifier=I;var A=function(){function DisabledMediaFixup(l,d){this.mediaManager=l,this.modalities=d}return DisabledMediaFixup.prototype.modify=function(l){var d=this,u=0;l.media.forEach((function(l,d){var p=parseInt(l.mid,10);!isNaN(p)&&p>=u&&(u=p+1)})),l.media.forEach((function(p,h){var g=d.mediaManager.getMediaEntities()[h];if(0===p.port||g.isDisabled()||!(g.getModality()in d.modalities)){var f=g.getExtension(\"midApplied\")?void 0:p.mid||\"\".concat(u++);0===h?p.direction=y.default.MEDIA_STATE.inactive:l.media[h]=disabledMedia(p.type,void 0,p.protocol,f)}}))},DisabledMediaFixup}();d.DisabledMediaFixup=A;var R=function(){function RollbackEntitiesFixup(l,d){this.mediaManager=l,this.remote=d}return RollbackEntitiesFixup.prototype.modify=function(l){for(var d=this.mediaManager.getMediaEntities(),u=0;u<d.length;u++){var p=d[u],h=l.media[u];if(p.getExtension(\"rollback\"))if(h&&!this.remote)l.media[u]=null;else if(!h&&this.remote){var g=p.getType()===y.default.MEDIA_TYPE.data?y.default.MEDIA_TYPE.dataChannel:p.getType(),f=g===y.default.MEDIA_TYPE.dataChannel?y.default.PROFILES.udpDtlsSctp:y.default.PROFILES.udpTlsRtpSavpf;l.media.push(disabledMedia(g,void 0,f,void 0))}}l.media=l.media.filter((function(l){return l}))},RollbackEntitiesFixup}();d.RollbackEntitiesFixup=R;var P=function(){function InsertDisabledXData(l){this.mediaManager=l}return InsertDisabledXData.prototype.modify=function(l){this.mediaManager.getMediaEntities().forEach((function(d,u){var p=l.media[u];d.getModality()!==y.default.MODALITY.data||p&&p.type===y.default.MEDIA_TYPE.dataChannel||l.media.splice(u,0,disabledMedia(y.default.MEDIA_TYPE.data,y.default.MEDIA_LABEL.data,y.default.PROFILES.rtpSavp,void 0))}))},InsertDisabledXData}();d.InsertDisabledXData=P;var O=function(){function OutgoingDataModalityFixup(l,d){this.context=l,this.direction=d}return OutgoingDataModalityFixup.prototype.modify=function(l){var d=this;l.media.forEach((function(l){l.type===y.default.MEDIA_TYPE.dataChannel&&(l.type=y.default.MEDIA_TYPE.data,l.payloads=y.default.PAYLOAD_TYPE.X_DATA)})),S.allowDataChannel(this.context)&&getEnabledMedia(l,y.default.MEDIA_TYPE.data).forEach((function(u){u.rtp=u.rtp||[],u.fmtp=u.fmtp||[],u.rtp.push({codec:\"x-data\",payload:127,rate:9e4}),u.rtp.push({codec:\"rtx\",payload:126,rate:9e4}),u.fmtp.push({payload:126,config:\"apt=127\"});var p=d.getNonOverlappingSsrc(l);u.xSsrcRange={ssrcMin:p,ssrcMax:p},u.rtcpMux=\"rtcp-mux\",u.xDataProtocol=\"sctp\",u.direction=d.direction}))},OutgoingDataModalityFixup.prototype.getNonOverlappingSsrc=function(l){var d,u=!0;do{d=Math.floor(4294967293*Math.random())+2,getEnabledMedia(l).forEach((function(l){var p,h;(null===(h=null===(p=null==l?void 0:l.ssrcs)||void 0===p?void 0:p[0])||void 0===h?void 0:h.id)===d&&(u=!1)}))}while(!u);return d},OutgoingDataModalityFixup}();d.OutgoingDataModalityFixup=O;var M=function(){function VideoOrientationExtension(l){this.configProvider=l,this.uri=\"urn:3gpp:video-orientation\",this.value=13}return VideoOrientationExtension.prototype.modify=function(l){var d,u;if(this.configProvider.config.enableVideoOrientationExtension)try{for(var p=h(getEnabledMedia(l,y.default.MEDIA_TYPE.video)),g=p.next();!g.done;g=p.next()){var f=g.value;this.modifyMedia(f)}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}},VideoOrientationExtension}(),w=function(l){function AddVideoOrientationExtension(){return null!==l&&l.apply(this,arguments)||this}return p(AddVideoOrientationExtension,l),AddVideoOrientationExtension.prototype.modifyMedia=function(l){var d,u=this;null!==(d=l.ext)&&void 0!==d||(l.ext=[]),l.ext.some((function(l){return l.uri===u.uri}))||l.ext.push({value:this.getAvailableValue(l.ext),uri:this.uri})},AddVideoOrientationExtension.prototype.getAvailableValue=function(l){var d=l.map((function(l){return l.value}));return d.includes(this.value)?Math.max.apply(Math,f([],g(d),!1))+1:this.value},AddVideoOrientationExtension}(M);d.AddVideoOrientationExtension=w;var N=function(l){function RemoveVideoOrientationExtension(){return null!==l&&l.apply(this,arguments)||this}return p(RemoveVideoOrientationExtension,l),RemoveVideoOrientationExtension.prototype.modifyMedia=function(l){var d,u=this;l.ext=null===(d=l.ext)||void 0===d?void 0:d.filter((function(l){return l.uri!==u.uri}))},RemoveVideoOrientationExtension}(M);d.RemoveVideoOrientationExtension=N;var D=function(){function IncomingDataModalityFixup(l){this.context=l}return IncomingDataModalityFixup.prototype.modify=function(l){for(var d=l.media.length-1;d>=0;d--){var u=l.media[d];u.type===y.default.MEDIA_TYPE.data&&(S.allowDataChannel(this.context)?(u.payloads=y.default.PAYLOAD_TYPE.DATA_CHANNEL,u.type=y.default.MEDIA_TYPE.dataChannel,u.protocol=y.default.PROFILES.udpDtlsSctp,delete u.xDataProtocol,delete u.rtp,delete u.fmtp,delete u.rtcp,delete u.rtcpMux,delete u.ext,delete u.ssrcs,delete u.ssrcGroups,delete u.xSsrcRange):l.media.splice(d,1))}},IncomingDataModalityFixup}();d.IncomingDataModalityFixup=D;var L=function(){function SendOnlyModalityFixup(l){this.modalities=l}return SendOnlyModalityFixup.prototype.modify=function(l){var d=this;getEnabledMedia(l).forEach((function(l){var u=_.getModality(l);d.modalities[u]===y.default.MEDIA_STATE.send&&(l.direction&&l.direction.toLowerCase()===y.default.MEDIA_STATE.receive||(l.direction=y.default.MEDIA_STATE.receive))}))},SendOnlyModalityFixup}();d.SendOnlyModalityFixup=L;var k=function(){function OutSdpReceiveSsrcFixup(l,d){this.isMultiparty=l,this.cname=d}return OutSdpReceiveSsrcFixup.prototype.modify=function(l){var d=this;this.isMultiparty&&getEnabledMedia(l).forEach((function(l){var u=l.direction;u!==y.default.MEDIA_STATE.receive&&u!==y.default.MEDIA_STATE.inactive||(l.ssrcs&&l.ssrcs[0]?l.ssrcs=[{id:l.ssrcs[0].id,attribute:\"cname\",value:d.cname}]:l.type===y.default.MEDIA_TYPE.audio?l.ssrcs=[{id:4195875351,attribute:\"cname\",value:d.cname}]:l.type===y.default.MEDIA_TYPE.video&&(l.ssrcs=[{id:1,attribute:\"cname\",value:d.cname}]))}))},OutSdpReceiveSsrcFixup}();d.OutSdpReceiveSsrcFixup=k;var x=function(){function InSdpReceiveSsrcFixup(){}return InSdpReceiveSsrcFixup.prototype.modify=function(l){var d=new Set;getEnabledMedia(l,y.default.MEDIA_TYPE.video).forEach((function(l){l.ssrcs&&l.ssrcs.length>1&&d.add(l.ssrcs[0].id)}));var u=getEnabledMedia(l,y.default.MEDIA_TYPE.video).find((function(l){return l.direction===y.default.MEDIA_STATE.sendReceive||l.direction===y.default.MEDIA_STATE.send}));getEnabledMedia(l,y.default.MEDIA_TYPE.video).forEach((function(l){var p=l.direction;if((p===y.default.MEDIA_STATE.receive||p===y.default.MEDIA_STATE.inactive)&&l.ssrcs&&1===l.ssrcs.length){var h=l.ssrcs[0].id;(1===h||u&&u.ssrcs[0].id===h||!u&&d.has(h))&&(delete l.ssrcs,delete l.ssrcGroups)}}))},InSdpReceiveSsrcFixup}();d.InSdpReceiveSsrcFixup=x;var F=function(){function AddLabelsModifier(l){this.mediaManager=l}return AddLabelsModifier.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){var p=d.mediaManager.getMediaEntities()[u];l.label=_.getLabelForModality(p.getModality())}))},AddLabelsModifier}();d.AddLabelsModifier=F;var U=function(){function RemoveLabelsModifier(){}return RemoveLabelsModifier.prototype.modify=function(l){l.media.forEach((function(l){delete l.label}))},RemoveLabelsModifier}();d.RemoveLabelsModifier=U;var j=function(){function InSdpBandwidthModifier(l,d,u){this.mediaManager=l,this.modalities=d,this.configProvider=u}return InSdpBandwidthModifier.prototype.modify=function(l){var d=this,u=this.configProvider.mediaConfig.maxBandwidthInKbps,p=l.bandwidth&&l.bandwidth.find((function(l){return\"CT\"===l.type}));p&&(!u||u>p.limit)&&(u=p.limit);var h=this.configProvider.config.audioBandwidthInKbps||0,g=Math.max(u-h,0),f=this.configProvider.config.videoBandwidthAllocation&&S.hasSendDirectionality(this.modalities.video)&&S.hasSendDirectionality(this.modalities.sharing);getEnabledMedia(l,y.default.MEDIA_TYPE.video).forEach((function(l){if(delete l.bandwidth,g){var u=g;if(f){var p=d.mediaManager.getMediaEntityByMid(l.mid).getModality()===y.default.MODALITY.video?d.configProvider.config.videoBandwidthAllocation:1-d.configProvider.config.videoBandwidthAllocation;u=Math.round(g*p)}l.bandwidth=[{limit:u,type:\"AS\"}]}}))},InSdpBandwidthModifier}();d.InSdpBandwidthModifier=j;var B=function(){function OutSdpBandwidthModifier(l){this.configProvider=l}return OutSdpBandwidthModifier.prototype.modify=function(l){var d=this.configProvider.mediaConfig.maxBandwidthInKbps;d&&(l.bandwidth=[{limit:d,type:\"CT\"}])},OutSdpBandwidthModifier}();d.OutSdpBandwidthModifier=B;var V=function(){function IceRestartChecker(l){this.mediaManager=l}return IceRestartChecker.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){var p=d.mediaManager.getMediaEntities()[u],h=p.getExtension(\"iceUfrag\");p.setExtension(\"iceRestart\",!!l.iceUfrag&&!!h&&h!==l.iceUfrag),p.setExtension(\"iceUfrag\",l.iceUfrag)}))},IceRestartChecker}();d.IceRestartChecker=V;var H=function(){function ExtensionsFixup(){}return ExtensionsFixup.prototype.modify=function(l){var d=new Set([\"urn:ietf:params:rtp-hdrext:csrc-audio-level\",\"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay\"]);getEnabledMedia(l).forEach((function(l){l.ext&&(l.ext=l.ext.filter((function(l){return!d.has(l.uri)})))}))},ExtensionsFixup}();d.ExtensionsFixup=H;var G=function(){function AddExtmapAllowMixed(l){this.configProvider=l}return AddExtmapAllowMixed.prototype.modify=function(l){this.configProvider.config.extmapAllowMixed&&(l.extmapAllowMixed=\"extmap-allow-mixed\")},AddExtmapAllowMixed}();d.AddExtmapAllowMixed=G;var W=function(){function RemoveExtmapAllowMixed(l){this.configProvider=l}return RemoveExtmapAllowMixed.prototype.modify=function(l){this.configProvider.config.extmapAllowMixed||delete l.extmapAllowMixed},RemoveExtmapAllowMixed}();d.RemoveExtmapAllowMixed=W;var q=function(){function RemoveMsRTCAttributes(){}return RemoveMsRTCAttributes.prototype.modify=function(l){getEnabledMedia(l).forEach((function(l){delete l.signalingFbXMessage}))},RemoveMsRTCAttributes}();d.RemoveMsRTCAttributes=q;var z=function(){function FilterCodecs(l,d,u){this.mediaManager=l,this.configProvider=d,this.sdpType=u}return FilterCodecs.prototype.modify=function(l){var d=this;this.configProvider.config.filterCodecsInSdp&&\"offer\"===this.sdpType&&this.mediaManager.getMediaEntities().forEach((function(u,p){var h=l.media[p];if(h){var g=S.getAllowedCodecs(d.configProvider,h.type);if(g.length){var f=S.convertToCodecInfo(g);_.filterCodecs(h,f,!!u.getExtension(\"unnegotiatedModality\"),null)}}}))},FilterCodecs}();d.FilterCodecs=z;var K=function(){function ComfortNoiseFixup(){}return ComfortNoiseFixup.prototype.modify=function(l){var d=l.media.find((function(l){return l.type===y.default.MEDIA_TYPE.audio}));_.removeCodec(d,{codec:\"CN\",rate:16e3})},ComfortNoiseFixup}();d.ComfortNoiseFixup=K;var J=function(){function G722Fixup(){}return G722Fixup.prototype.modify=function(l){var d=l.media.find((function(l){return l.type===y.default.MEDIA_TYPE.audio}));_.removeCodec(d,{codec:\"g722\",rate:8e3,encoding:2})},G722Fixup}();d.G722Fixup=J;var Q=function(){function InOpusEnforcedFmtp(l){this.configProvider=l}return InOpusEnforcedFmtp.prototype.modify=function(l){var d=this.configProvider.config.enforceOpusFmtp;if(d){var u=l.media.find((function(l){return l.type===y.default.MEDIA_TYPE.audio}));_.forCodec(u,{name:\"opus\",rate:48e3,encoding:2},(function(l){l.fmtp=l.fmtp||{payload:l.rtp.payload};var u=v.default.build(l.fmtp.config);Object.keys(d).forEach((function(l){u.removeIfPresent(l),u.setIfMissing(l,\"\".concat(d[l]))})),l.fmtp.config=u.toString()}))}},InOpusEnforcedFmtp}();d.InOpusEnforcedFmtp=Q;var Y=function(){function NoAudioFixup(){}return NoAudioFixup.prototype.modify=function(l){var d=l.media.find((function(l){return l.type===y.default.MEDIA_TYPE.audio}));if(d&&0===d.port){var u=l.media.find((function(l){return!!l.iceUfrag}));u&&(d.port=9,d.direction=\"inactive\",d.iceUfrag=u.iceUfrag,d.icePwd=u.icePwd,d.rtcpMux=\"rtcp-mux\",u.crypto&&(d.crypto=u.crypto),u.fingerprint&&(d.fingerprint=u.fingerprint,d.setup=u.setup),d.rtp=[{payload:0,codec:\"PCMU\",rate:8e3}],d.payloads=\"0\")}},NoAudioFixup}();d.NoAudioFixup=Y;var $=function(){function AudioPrimaryCodecsModifier(l){this.otherPartyCodecs=l}return AudioPrimaryCodecsModifier.prototype.modify=function(l){var d=this,u=l.media.find((function(l){return l.type===y.default.MEDIA_TYPE.audio})),p=[\"cn\",\"telephone-event\"],h=u.rtp.filter((function(l){return-1!==d.otherPartyCodecs.indexOf(l.codec.toLowerCase())&&-1===p.indexOf(l.codec.toLowerCase())}));if(0===h.length)throw new Error(\"there is no matching primary audio codec\");u.rtp.filter((function(l){return l!==h[0]&&-1===p.indexOf(l.codec.toLowerCase())})).forEach((function(l){_.removeCodec(u,l)}))},AudioPrimaryCodecsModifier}();d.AudioPrimaryCodecsModifier=$;var X=function(){function InjectTransportCCAudio(l,d){this.configProvider=l,this.logger=d}return InjectTransportCCAudio.prototype.modify=function(l){var d=this;this.configProvider.config.webrtcInjectTransportCCAudio&&getEnabledMedia(l,y.default.MEDIA_TYPE.audio).forEach((function(l){var u,p,h;if(null===(u=l.ext)||void 0===u?void 0:u.find((function(l){return l.uri===y.default.TRANSPORT_CC.EXT_URI}))){var g=null===(p=l.rtp)||void 0===p?void 0:p.find((function(l){return\"opus\"===l.codec.toLowerCase()}));if(g){var f=g.payload;(null===(h=l.rtcpFb)||void 0===h?void 0:h.find((function(l){return l.type===y.default.TRANSPORT_CC.ATTRIBUTE&&l.payload===f})))?d.logger.safe.info(\"opus codec already has transport-cc attribute\"):(l.rtcpFb=l.rtcpFb||[],l.rtcpFb.push({payload:f,type:y.default.TRANSPORT_CC.ATTRIBUTE}),d.logger.safe.info(\"injected transport-cc attribute\"))}else d.logger.safe.info(\"opus codec not found, skipping injecting transport-cc attribute for audio\")}else d.logger.safe.info(\"transport-cc ext not present in sdp, skipping injecting transport-cc attribute for audio\")}))},InjectTransportCCAudio}();d.InjectTransportCCAudio=X;var Z=function(){function InjectH264ParamsModifier(l){this.mediaManager=l}return InjectH264ParamsModifier.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){if(0!==l.port&&l.type===y.default.MEDIA_TYPE.video){var p=d.mediaManager.getMediaEntities()[u];_.forCodec(l,{name:\"h264\",rate:9e4},(function(l){var d=p.getVideoCapabilities();if(d){l.fmtp=l.fmtp||{payload:l.rtp.payload};var u=v.default.build(l.fmtp.config);u.setIfMissing(\"profile-level-id\",\"42C02A\"),u.setIfMissing(\"max-fs\",d.getMaxFS().toString()),u.setIfMissing(\"max-mbps\",d.getMaxMBPS().toString()),u.setIfMissing(\"max-fps\",d.getMaxFPS().toString()),l.fmtp.config=u.toString()}}))}}))},InjectH264ParamsModifier}();d.InjectH264ParamsModifier=Z;var ee=function(){function RemoveH264ParamsModifier(l){this.configProvider=l}return RemoveH264ParamsModifier.prototype.modify=function(l){var d=this;getEnabledMedia(l,y.default.MEDIA_TYPE.video).forEach((function(l){_.forCodec(l,{name:\"h264\",rate:9e4},(function(l){if(l.fmtp){var u=v.default.build(),p=v.default.build(l.fmtp.config);[\"level-asymmetry-allowed\",\"packetization-mode\",\"profile-level-id\"].forEach((function(l){if(p.contains(l)){var h=p.get(l);\"profile-level-id\"===l&&(h=d.configProvider.config.h264SendProfileOverride||h),u.setIfMissing(l,h)}})),l.fmtp.config=u.toString()}}))}))},RemoveH264ParamsModifier}();d.RemoveH264ParamsModifier=ee;var te=function(){function InjectH264SpsPpsIdrInKeyframe(l){this.configProvider=l}return InjectH264SpsPpsIdrInKeyframe.prototype.modify=function(l){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&getEnabledMedia(l,y.default.MEDIA_TYPE.video).forEach((function(l){_.forCodec(l,{name:\"h264\",rate:9e4},(function(l){if(l.fmtp){var d=v.default.build(l.fmtp.config);d.setIfMissing(\"sps-pps-idr-in-keyframe\",\"1\"),l.fmtp.config=d.toString()}}))}))},InjectH264SpsPpsIdrInKeyframe}();d.InjectH264SpsPpsIdrInKeyframe=te;var ne=function(){function RemoveH264SpsPpsIdrInKeyframe(l){this.configProvider=l}return RemoveH264SpsPpsIdrInKeyframe.prototype.modify=function(l){this.configProvider.config.enableH264SpsPpsIdrKeyframe&&getEnabledMedia(l,y.default.MEDIA_TYPE.video).forEach((function(l){_.forCodec(l,{name:\"h264\",rate:9e4},(function(l){if(l.fmtp){var d=v.default.build(l.fmtp.config);d.removeIfPresent(\"sps-pps-idr-in-keyframe\"),l.fmtp.config=d.toString()}}))}))},RemoveH264SpsPpsIdrInKeyframe}();d.RemoveH264SpsPpsIdrInKeyframe=ne;var ie=function(){function BundleGroupModifier(l){this.configProvider=l}return BundleGroupModifier.prototype.modify=function(l){var d=(l.groups||[]).findIndex((function(l){return\"BUNDLE\"===l.type})),u=l.groups?l.groups[d]:void 0;u&&(this.configProvider.mediaConfig.isTransportUnbundled?(u.mids=this.createBundleFromMedia(getEnabledMedia(l,y.default.MEDIA_TYPE.video)),u.mids||l.groups.splice(d,1)):u.mids=this.createBundleFromMedia(getEnabledMedia(l)))},BundleGroupModifier.prototype.createBundleFromMedia=function(l){return l.map((function(l){var d;return null===(d=l.mid)||void 0===d?void 0:d.toString()})).filter((function(l){return l})).join(\" \")},BundleGroupModifier}();d.BundleGroupModifier=ie;var re=function(){function BundleOnlyMediaFixup(){}return BundleOnlyMediaFixup.prototype.modify=function(l){l.media.forEach((function(l){0===l.port&&l.bundleOnly&&(l.port=9,delete l.invalid)}))},BundleOnlyMediaFixup}();d.BundleOnlyMediaFixup=re;var oe=function(){function NoBundleInAnswerFixup(l,d){this.configProvider=l,this.mediaManager=d}return NoBundleInAnswerFixup.prototype.modify=function(l){var d=this;if(!(this.configProvider.mediaConfig.isTransportUnbundled||l.groups&&l.groups.find((function(l){return\"BUNDLE\"===l.type})))){var u=!1;if(l.media.forEach((function(l,p){var h=d.mediaManager.getMediaEntities()[p];!u&&h.isEnabled()?(l.mid=h.getMid(),u=!0):(h.disable(),l.port=0)})),u){l.groups||(l.groups=[]);var p={type:\"BUNDLE\"};l.groups.push(p)}}},NoBundleInAnswerFixup}();d.NoBundleInAnswerFixup=oe;var ae=function(){function CandidatesFixup(l,d){this.configProvider=l,this.logger=d}return CandidatesFixup.prototype.modify=function(l){var d=this;l.media.forEach((function(l){var u=!!l.candidates;if(l.candidates&&(l.candidates=l.candidates.filter((function(l){var u=!0,p=!0,h=!0;return d.configProvider.config.iceCandidateType&&(u=!!l.type.match(new RegExp(d.configProvider.config.iceCandidateType,\"i\"))),d.configProvider.config.iceCandidateTransport&&(p=!!l.transport.match(new RegExp(d.configProvider.config.iceCandidateTransport,\"i\"))),d.configProvider.config.iceCandidateFilterMDns&&((h=!d.isMdns(l.ip))||d.logger.safe.info(\"Filtering out mDNS candidate \".concat(m.scrubMriOrOmit(l.ip),\":\").concat(m.scrubMriOrOmit(l.port)))),u&&p&&h}))),u&&l.connection&&d.configProvider.config.iceCandidateFilterMDns&&(l.candidates&&0!==l.candidates.length||(l.candidates=[getDummyCandidate(l.port)]),d.isMdns(l.connection.ip)||!d.hasMatchingCandidate(l))){var p=d.getDefaultCandidate(l);l.connection.ip=p.ip,l.port=p.port}}))},CandidatesFixup.prototype.hasMatchingCandidate=function(l){var d=l.connection;return d&&!!l.candidates.find(this.createIpAndPortMatcher(d.ip,l.port))},CandidatesFixup.prototype.getDefaultCandidate=function(l){return l.candidates.slice().sort((function(l,d){return l.type===d.type?0:\"host\"===l.type||\"relay\"===d.type?1:\"relay\"===l.type||\"host\"===d.type?-1:0}))[0]},CandidatesFixup.prototype.isMdns=function(l){return l.indexOf(\".local\")>-1||l.indexOf(\".encrypted\")>-1},CandidatesFixup.prototype.createIpAndPortMatcher=function(l,d){return function(u){return u.ip===l&&u.port===d}},CandidatesFixup}();d.CandidatesFixup=ae;var se=function(){function NoCandidatesFixup(){}return NoCandidatesFixup.prototype.modify=function(l){var d=getEnabledMedia(l)[0];d&&(d.candidates=[getDummyCandidate()])},NoCandidatesFixup}();d.NoCandidatesFixup=se;var ce=function(){function SimulcastFromMsSDPMediaFixup(l){this.mediaManager=l}return SimulcastFromMsSDPMediaFixup.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){d.fromMsSdp(l,u)}))},SimulcastFromMsSDPMediaFixup.prototype.fromMsSdp=function(l,d){if(!l.rids||!l.simulcast){var u=this.mediaManager.getMediaEntities()[d],p=null==u?void 0:u.getSimulcastContext();(null==p?void 0:p.shouldBeEnabledInRemoteDesc())&&(p.enableInRemoteDesc(),l.simulcast={dir1:\"recv\",list1:p.ridList.map((function(l){return\"\".concat(p.activeRids.includes(l)?\"\":\"~\").concat(l)})).join(\";\")},l.rids=p.ridList.map((function(l){return{id:l,direction:\"recv\"}})))}},SimulcastFromMsSDPMediaFixup}();d.SimulcastFromMsSDPMediaFixup=ce;var le=function(){function SimulcastToMsSDPMediaFixup(l,d){this.mediaManager=l,this.logger=d}return SimulcastToMsSDPMediaFixup.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){d.toMsSdp(l,u)}))},SimulcastToMsSDPMediaFixup.prototype.toMsSdp=function(l,d){var u=this.mediaManager.getMediaEntities()[d],p=null==u?void 0:u.getSimulcastContext();p&&(p.localDescriptionIsApplied(),p.shouldBeEnabledInLocalDesc()&&(p.enableInLocalDesc(),this.removeSimulcastEnvelope(l),this.addStreamSsrc(l,u.getLocalSsrc())))},SimulcastToMsSDPMediaFixup.prototype.removeSimulcastEnvelope=function(l){l.rids&&delete l.rids,l.simulcast&&delete l.simulcast},SimulcastToMsSDPMediaFixup.prototype.addStreamSsrc=function(l,d){if(d)if(l.ssrcs)this.logger.safe.debug(\"Media mid: \".concat(l.mid,\" already contains ssrc: \").concat(JSON.stringify(l.ssrcs)));else{var u=d;this.setSsrc(l,u)}},SimulcastToMsSDPMediaFixup.prototype.setSsrc=function(l,d){l.ssrcs=[{id:d,attribute:\"fake_attribute\",value:\"fake_value\"}]},SimulcastToMsSDPMediaFixup}();d.SimulcastToMsSDPMediaFixup=le;var de=function(){function AddMsidFixup(l){this.mediaManager=l}return AddMsidFixup.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){var p,h=d.mediaManager.getMediaEntities()[u];!l.msid&&(null===(p=null==h?void 0:h.getSimulcastContext())||void 0===p?void 0:p.shouldUseSimulcast())&&h.getLocalTrackId()&&(l.msid=\"- \".concat(h.getLocalTrackId()))}))},AddMsidFixup}();d.AddMsidFixup=de;var ue=function(){function AddVLAHeaderExtension(l,d){this.mediaManager=l,this.configProvider=d}return AddVLAHeaderExtension.prototype.modify=function(l){var d=this;l.media.forEach((function(l,u){var p,h,g=_.getModalityForMedia(l);if(d.configProvider.config.enableVla&&(\"Video\"===g||\"ScreenShare\"===g)&&!(null===(p=l.ext)||void 0===p?void 0:p.find((function(l){return l.uri===y.default.VLA.EXT_URI})))){var f=d.mediaManager.getMediaEntities()[u],m=null==f?void 0:f.getRtpHeaderExtensions(),v=m?null===(h=m.find((function(l){return\"vla\"===l.headerType})))||void 0===h?void 0:h.value:getFreeValueForExt(l.ext,d.configProvider.config.extmapAllowMixed,y.default.VLA.DEFAULT_VALUE);v&&(l.ext=l.ext||[],l.ext.push({value:v,uri:y.default.VLA.EXT_URI}))}}))},AddVLAHeaderExtension}();d.AddVLAHeaderExtension=ue;var pe=function(){function RemoveVLAHeaderExtension(l){this.configProvider=l}return RemoveVLAHeaderExtension.prototype.modify=function(l){var d=this;l.media.forEach((function(l){var u,p=_.getModalityForMedia(l);if(!(d.configProvider.config.allowRemoteVla&&(\"Video\"===p||\"ScreenShare\"===p))){var h=null===(u=l.ext)||void 0===u?void 0:u.findIndex((function(l){return l.uri===y.default.VLA.EXT_URI}));h>-1&&l.ext.splice(h,1)}}))},RemoveVLAHeaderExtension}();d.RemoveVLAHeaderExtension=pe;var he=function(){function VLADecoratorExtension(l){this.configProvider=l}return VLADecoratorExtension.prototype.modify=function(l,d,u){var p=this;l.media.forEach((function(l){var h,g,f=_.getModalityForMedia(l);if(p.configProvider.config.enableNonAdvVla&&(\"Video\"===f||\"ScreenShare\"===f)&&!(null===(h=l.ext)||void 0===h?void 0:h.find((function(l){return l.uri===u})))){var m=null===(g=l.ext)||void 0===g?void 0:g.find((function(l){return l.uri===d}));m&&(m.uri=u)}}))},VLADecoratorExtension}(),ge=function(l){function AddNonAdvVLADecoratorExtension(d){return l.call(this,d)||this}return p(AddNonAdvVLADecoratorExtension,l),AddNonAdvVLADecoratorExtension.prototype.modify=function(d){l.prototype.modify.call(this,d,y.default.VLA.EXT_URI,y.default.VLA.EXT_URI_NON_ADV)},AddNonAdvVLADecoratorExtension}(he);d.AddNonAdvVLADecoratorExtension=ge;var fe=function(l){function RemoveNonAdvVLADecoratorExtension(d){return l.call(this,d)||this}return p(RemoveNonAdvVLADecoratorExtension,l),RemoveNonAdvVLADecoratorExtension.prototype.modify=function(d){l.prototype.modify.call(this,d,y.default.VLA.EXT_URI_NON_ADV,y.default.VLA.EXT_URI)},RemoveNonAdvVLADecoratorExtension}(he);d.RemoveNonAdvVLADecoratorExtension=fe;var me=function(){function ExtUriNormalizer(){}return ExtUriNormalizer.prototype.modify=function(l){var d=this;l.media.forEach((function(l){var u;null===(u=l.ext)||void 0===u||u.forEach((function(l){return l.uri=d.normalizeSlashesInUri(l.uri)}))}))},ExtUriNormalizer.prototype.normalizeSlashesInUri=function(l){return l.replace(/\\\\/g,\"/\")},ExtUriNormalizer}();d.ExtUriNormalizer=me;var ve=function(){function PartialIceRestartFixup(l){this.configProvider=l}return PartialIceRestartFixup.prototype.modify=function(l){if(this.configProvider.config.fixSdpForPartialIceRestart){var d=g(l.media,1)[0],u=void 0===d?{}:d,p=u.iceUfrag,h=u.icePwd;void 0!==p&&void 0!==h&&l.media.forEach((function(l){l.iceUfrag=p,l.icePwd=h}))}},PartialIceRestartFixup}();function disabledMedia(l,d,u,p){var h={type:l,port:0,label:d,payloads:l===y.default.MEDIA_TYPE.dataChannel||l===y.default.MEDIA_TYPE.data?y.default.PAYLOAD_TYPE.DATA_CHANNEL:\"36\",protocol:u,connection:{ip:\"10.10.10.10\",version:4}};return p&&(h.mid=p),h}function getEnabledMedia(l,d){return void 0===d&&(d=null),l.media.filter((function(l){return 0!==l.port&&(!d||l.type===d)}))}function getDummyCandidate(l){return void 0===l&&(l=1234),{component:1,ip:\"10.10.10.10\",foundation:1755259772,priority:2122197247,port:l!==9?l:1234,transport:\"UDP\",type:\"host\"}}function getFreeValueForExt(l,d,u,p){if(void 0===p&&(p=!1),!(null==l?void 0:l.length))return u;var h,m=2,v=14,y=l.map((function(l){return l.value}));if(p&&!y.includes(u))return u;for(var S=m;S<=v;S++)if(!y.includes(S)){h=S;break}return!h&&d&&(h=Math.max.apply(Math,f([],g(y),!1))+1),h}d.PartialIceRestartFixup=ve,d.disabledMedia=disabledMedia},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.UntilFullStatsBuffer=d.SlidingWindow=d.StatsBuffer=void 0;var h=function(){function StatsBuffer(l){this.size=l,this.items=[]}return StatsBuffer.prototype.clear=function(){this.items=[]},StatsBuffer}();d.StatsBuffer=h;var g=function(l){function SlidingWindow(){return null!==l&&l.apply(this,arguments)||this}return p(SlidingWindow,l),Object.defineProperty(SlidingWindow.prototype,\"isFull\",{get:function(){return this.items.length>=this.size},enumerable:!1,configurable:!0}),SlidingWindow.prototype.add=function(l){return this.isFull&&this.items.shift(),this.items.push(l),!0},SlidingWindow}(h);d.SlidingWindow=g;var f=function(l){function UntilFullStatsBuffer(){return null!==l&&l.apply(this,arguments)||this}return p(UntilFullStatsBuffer,l),UntilFullStatsBuffer.prototype.add=function(l){return!(this.items.length>=this.size)&&(this.items.push(l),!0)},UntilFullStatsBuffer}(h);d.UntilFullStatsBuffer=f},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))},g=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.NormalizedLossRateCalculator=d.OvershootTracker=d.SelfWeightedHarmonicMeanCalculator=d.SampleDurationTracker=d.HistogramCollector=d.LastSampleDelta=d.ModeCounter=d.ArithmeticAverager=void 0;var f=u(3),m=u(1),v=function(){function ArithmeticAverager(){this.total=0,this.duration=0,this.max=0,this.min=Number.MAX_SAFE_INTEGER}return Object.defineProperty(ArithmeticAverager.prototype,\"avg\",{get:function(){return 0!==this.duration?this.total/this.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(ArithmeticAverager.prototype,\"maxSample\",{get:function(){return this.max},enumerable:!1,configurable:!0}),Object.defineProperty(ArithmeticAverager.prototype,\"minSample\",{get:function(){return this.min},enumerable:!1,configurable:!0}),ArithmeticAverager.prototype.captureSample=function(l){(l||0===l)&&(this.total+=l,this.duration++,this.max=Math.max(l,this.max),this.min=Math.min(l,this.min))},ArithmeticAverager}();d.ArithmeticAverager=v;var y=function(){function ModeCounter(){this.sampleCounts={}}return Object.defineProperty(ModeCounter.prototype,\"min\",{get:function(){var l=Object.keys(this.sampleCounts).map(Number).filter((function(l){return l>0}));return l.length>0?Math.min.apply(Math,h([],p(l),!1)):0},enumerable:!1,configurable:!0}),Object.defineProperty(ModeCounter.prototype,\"max\",{get:function(){var l=Object.keys(this.sampleCounts).map(Number);return l.length>0?Math.max.apply(Math,h([],p(l),!1)):0},enumerable:!1,configurable:!0}),Object.defineProperty(ModeCounter.prototype,\"mode\",{get:function(){var l=this,d=Object.keys(this.sampleCounts).map(Number);return d.length>0?d.reduce((function(d,u){return l.sampleCounts[u]>l.sampleCounts[d]?u:d}),d[0]):0},enumerable:!1,configurable:!0}),ModeCounter.prototype.captureSample=function(l){var d,u;if(l){var p=\"\".concat(l);null!==(d=(u=this.sampleCounts)[p])&&void 0!==d||(u[p]=0),this.sampleCounts[p]++}},ModeCounter}();d.ModeCounter=y;var S=function(){function LastSampleDelta(){}return Object.defineProperty(LastSampleDelta.prototype,\"delta\",{get:function(){if(void 0!==this.cur&&void 0!==this.last)return this.cur-this.last},enumerable:!1,configurable:!0}),LastSampleDelta.prototype.captureSample=function(l){void 0!==l&&(void 0!==this.cur&&(this.last=this.cur),this.cur=l)},LastSampleDelta}();d.LastSampleDelta=S;var _=function(){function ActiveHistogramEvent(){this.startTime=Date.now()}return Object.defineProperty(ActiveHistogramEvent.prototype,\"elapsed\",{get:function(){return m.round((Date.now()-this.startTime)/1e3,0)},enumerable:!1,configurable:!0}),ActiveHistogramEvent}(),C=function(){function HistogramCollector(){this.eventCount=0,this.totalActiveDuration=0,this.countBuckets={seconds1to3:0,seconds3to5:0,seconds5to8:0,seconds8to15:0,seconds15to60:0,seconds60toMax:0},this.timestampBuckets={seconds1to3:[],seconds3to5:[],seconds5to8:[],seconds8to15:[],seconds15to60:[],seconds60toMax:[]},this.averager=new v}return Object.defineProperty(HistogramCollector.prototype,\"active\",{get:function(){return!!this.current},set:function(l){var d,u;if(!this.current&&l)this.current=new _;else if(this.current&&!l){var p=this.current.elapsed;this.averager.captureSample(p),this.totalActiveDuration+=p;try{for(var h=g(Object.keys(f.default.HISTOGRAM_BATCH)),m=h.next();!m.done;m=h.next()){var v=m.value;if(p<=f.default.HISTOGRAM_BATCH[v]){this.countBuckets[v]++,this.timestampBuckets[v].push(this.current.startTime);break}}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}this.eventCount++,this.current=void 0}},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,\"ongoingDuration\",{get:function(){var l;return(null===(l=this.current)||void 0===l?void 0:l.elapsed)||0},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,\"avgDuration\",{get:function(){return this.averager.avg},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,\"longestDuration\",{get:function(){return this.averager.maxSample},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,\"numEvents\",{get:function(){return this.eventCount},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,\"totalDuration\",{get:function(){return this.current?this.totalActiveDuration+this.current.elapsed:this.totalActiveDuration},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,\"timestamps\",{get:function(){return m.deepClone(this.timestampBuckets)},enumerable:!1,configurable:!0}),Object.defineProperty(HistogramCollector.prototype,\"counts\",{get:function(){return m.deepClone(this.countBuckets)},enumerable:!1,configurable:!0}),HistogramCollector}();d.HistogramCollector=C;var E=function(){function SampleDurationTracker(){this.sampleChangeCount=0,this.sampleDurations={}}return Object.defineProperty(SampleDurationTracker.prototype,\"durations\",{get:function(){return m.deepClone(this.sampleDurations)},enumerable:!1,configurable:!0}),Object.defineProperty(SampleDurationTracker.prototype,\"durationRatios\",{get:function(){var l={},d=0;for(var u in this.sampleDurations)d+=this.sampleDurations[u];for(var u in this.sampleDurations)l[u]=m.round(this.sampleDurations[u]/d*100);return l},enumerable:!1,configurable:!0}),Object.defineProperty(SampleDurationTracker.prototype,\"changeCount\",{get:function(){return this.sampleChangeCount},enumerable:!1,configurable:!0}),SampleDurationTracker.prototype.captureSample=function(l){this.sampleDurations[l]||(this.sampleDurations[l]=0),this.sampleDurations[l]++,l!==this.lastSample&&(this.sampleChangeCount++,this.lastSample=l)},SampleDurationTracker}();d.SampleDurationTracker=E;var T=function(){function SelfWeightedHarmonicMeanCalculator(){this.numSamples=0,this.invertedSum=0}return Object.defineProperty(SelfWeightedHarmonicMeanCalculator.prototype,\"harmonicMean\",{get:function(){return this.numSamples>0&&this.invertedSum>0?this.numSamples/this.invertedSum:0},enumerable:!1,configurable:!0}),SelfWeightedHarmonicMeanCalculator.prototype.captureSample=function(l){l>0&&(this.invertedSum+=1/l,this.numSamples++)},SelfWeightedHarmonicMeanCalculator}();d.SelfWeightedHarmonicMeanCalculator=T;var b=function(){function OvershootTracker(l){void 0===l&&(l=0),this.allowedOvershoot=l,this.past=[],this.totalOvershootDuration=0,this.lastAllowed=0}return Object.defineProperty(OvershootTracker.prototype,\"isOvershooting\",{get:function(){return!!this.current},enumerable:!1,configurable:!0}),Object.defineProperty(OvershootTracker.prototype,\"events\",{get:function(){return this.current?h(h([],p(this.past),!1),[this.current],!1):this.past},enumerable:!1,configurable:!0}),Object.defineProperty(OvershootTracker.prototype,\"totalDuration\",{get:function(){return this.totalOvershootDuration},enumerable:!1,configurable:!0}),OvershootTracker.prototype.captureSample=function(l,d){var u=m.round(l-d);u>this.allowedOvershoot&&(0===this.lastAllowed||d===this.lastAllowed||!this.current&&d>this.lastAllowed)?(this.totalOvershootDuration++,this.current?(this.current.min=Math.min(this.current.min,u),this.current.max=Math.max(this.current.max,u)):this.current={timestamp:Date.now(),min:u,max:u}):this.current&&(this.current.duration=Date.now()-this.current.timestamp,this.past.push(this.current),this.current=void 0),this.lastAllowed=d},OvershootTracker}();d.OvershootTracker=b;var I=function(){function NormalizedLossRateCalculator(l){void 0===l&&(l=100),this.minPackets=l,this.prevLost=0,this.prevReceived=0}return NormalizedLossRateCalculator.prototype.calculate=function(l,d){if(void 0!==l&&void 0!==d){var u=l-this.prevReceived,p=d-this.prevLost;if(!(u+p<this.minPackets))return this.prevReceived=l,this.prevLost=d,p*this.minPackets/(p+u)}},NormalizedLossRateCalculator}();d.NormalizedLossRateCalculator=I},function(l,d,u){u.d(d,\"a\",(function(){return getDebugExt})),u.d(d,\"b\",(function(){return getDebugListener}));var p,h=u(11),g=[\"eventsSent\",\"eventsDiscarded\",\"eventsSendRequest\",\"perfEvent\"],f=null;function _listenerProxyFunc(l,d){return function(){var u=arguments,p=getDebugExt(d);if(p){var h=p.listener;h&&h[l]&&h[l].apply(h,u)}}}function _getExtensionNamespace(){var l=Object(h.e)(\"Microsoft\");return l&&(f=l.ApplicationInsights),f}function getDebugExt(l){var d=f;return d||!0===l.disableDbgExt||(d=f||_getExtensionNamespace()),d?d.ChromeDbgExt:null}function getDebugListener(l){if(!p){p={};for(var d=0;d<g.length;d++)p[g[d]]=_listenerProxyFunc(g[d],l)}return p}},function(l,d,u){u.d(d,\"b\",(function(){return E})),u.d(d,\"n\",(function(){return O})),u.d(d,\"m\",(function(){return isValueAssigned})),u.d(d,\"h\",(function(){return getTenantId})),u.d(d,\"l\",(function(){return isUint8ArrayAvailable})),u.d(d,\"k\",(function(){return isLatency})),u.d(d,\"p\",(function(){return sanitizeProperty})),u.d(d,\"e\",(function(){return getCommonSchemaMetaData})),u.d(d,\"f\",(function(){return getCookie})),u.d(d,\"g\",(function(){return getCookieValue})),u.d(d,\"c\",(function(){return createGuid})),u.d(d,\"d\",(function(){return extend})),u.d(d,\"i\",(function(){return M})),u.d(d,\"q\",(function(){return setProcessTelemetryTimings})),u.d(d,\"a\",(function(){return w})),u.d(d,\"j\",(function(){return isChromium})),u.d(d,\"o\",(function(){return openXhr}));var p,h=u(2),g=u(31),f=u(20),m=u(11),v=u(0),y=u(24),S=u(37),_=u(22),C=\"3.1.11\",E=\"1DS-Web-JS-\"+C,T=\"Microsoft_ApplicationInsights_BypassAjaxInstrumentation\",b=\"withCredentials\",I=\"timeout\",A=((p={})[0]=f.c.Unspecified,p[2]=f.c.Double,p[1]=f.c.String,p[3]=f.c.Bool,p[4098]=f.c.Double,p[4097]=f.c.String,p[4099]=f.c.Bool,p),R=null,P=Boolean(Object(m.d)()),O=Boolean(Object(m.k)());function isValueAssigned(l){return!(\"\"===l||Object(v.r)(l))}function getTenantId(l){if(l){var d=l.indexOf(\"-\");if(d>-1)return l.substring(0,d)}return\"\"}function isUint8ArrayAvailable(){return null===R&&(R=!Object(v.x)(Uint8Array)&&!isSafariOrFirefox()&&!Object(m.p)()),R}function isLatency(l){return!!(l&&Object(v.s)(l)&&l>=f.a.Normal&&l<=f.a.Immediate)}function sanitizeProperty(l,d,u){if(!d&&!isValueAssigned(d)||\"string\"!=typeof l)return null;var p=typeof d;if(\"string\"===p||\"number\"===p||\"boolean\"===p||Object(v.k)(d))d={value:d};else if(\"object\"!==p||d.hasOwnProperty(\"value\")){if(Object(v.r)(d.value)||\"\"===d.value||!Object(v.u)(d.value)&&!Object(v.s)(d.value)&&!Object(v.l)(d.value)&&!Object(v.k)(d.value))return null}else d={value:u?JSON.stringify(d):d};if(Object(v.k)(d.value)&&!isArrayValid(d.value))return null;if(!Object(v.r)(d.kind)){if(Object(v.k)(d.value)||!isValueKind(d.kind))return null;d.value=d.value.toString()}return d}function getCommonSchemaMetaData(l,d,u){var p=-1;if(!Object(v.x)(l))if(d>0&&(32===d?p=8192:d<=13&&(p=d<<5)),isDataType(u))-1===p&&(p=0),p|=u;else{var h=A[getFieldValueType(l)]||-1;-1!==p&&-1!==h?p|=h:h===f.c.Double&&(p=h)}return p}function disableCookies(){Object(y.d)(null).setEnabled(!1)}function setCookie(l,d,u){Object(y.b)(null)&&Object(y.d)(null).set(l,d,86400*u,null,\"/\")}function deleteCookie(l){Object(y.b)(null)&&Object(y.d)(null).del(l)}function getCookie(l){return Object(y.b)(null)?getCookieValue(Object(y.d)(null),l):\"\"}function getCookieValue(l,d,u){var p;return void 0===u&&(u=!0),l&&(p=l.get(d),u&&p&&decodeURIComponent&&(p=decodeURIComponent(p))),p||\"\"}function createGuid(l){void 0===l&&(l=\"D\");var d=Object(S.f)();return\"B\"===l?d=\"{\"+d+\"}\":\"P\"===l?d=\"(\"+d+\")\":\"N\"===l&&(d=d.replace(/-/g,\"\")),d}function extend(l,d,u,p,g){var f={},m=!1,y=0,S=arguments.length,_=arguments;for(\"[object Boolean]\"===Object[h.k].toString.call(_[0])&&(m=_[0],y++);y<S;y++){l=_[y];Object(v.z)(l,(function(l,d){m&&d&&Object(v.t)(d)?Object(v.k)(d)?(f[l]=f[l]||[],Object(v.a)(d,(function(d,u){d&&Object(v.t)(d)?f[l][u]=extend(!0,f[l][u],d):f[l][u]=d}))):f[l]=extend(!0,f[l],d):f[l]=d}))}return f}var M=S.h;function isValueKind(l){return l===f.e.NotSet||l>f.e.NotSet&&l<=f.e.Pii_IPV4AddressLegacy||l===f.e.CustomerContent_GenericContent}function isDataType(l){return l>=0&&l<=9}function isSafariOrFirefox(){var l=Object(m.i)();if(!Object(v.x)(l)&&l.userAgent){var d=l.userAgent.toLowerCase();if((d.indexOf(\"safari\")>=0||d.indexOf(\"firefox\")>=0)&&d.indexOf(\"chrome\")<0)return!0}return!1}function isArrayValid(l){return l.length>0}function setProcessTelemetryTimings(l,d){var u=l;u.timings=u.timings||{},u.timings.processTelemetryStart=u.timings.processTelemetryStart||{},u.timings.processTelemetryStart[d]=M()}function getFieldValueType(l){var d=0;if(null!=l){var u=typeof l;\"string\"===u?d=1:\"number\"===u?d=2:\"boolean\"===u?d=3:u===h.j&&(d=4,Object(v.k)(l)?(d=4096,l.length>0&&(d|=getFieldValueType(l[0]))):Object(v.j)(l,\"value\")&&(d=8192|getFieldValueType(l.value)))}return d}h.l,h.j,h.l,v.a,v.b,v.c,v.d,v.B,v.J,m.p,v.u,v.s,v.l,v.o,v.k,v.t,v.H,m.m,v.J,m.r,y.b,y.e,v.y,S.d,S.a,v.F,v.z;var w={_canUseCookies:void 0,isTypeof:v.w,isUndefined:v.x,isNullOrUndefined:v.r,hasOwnProperty:v.j,isFunction:v.o,isObject:v.t,isDate:v.m,isArray:v.k,isError:v.n,isString:v.u,isNumber:v.s,isBoolean:v.l,toISOString:v.J,arrForEach:v.a,arrIndexOf:v.b,arrMap:v.c,arrReduce:v.d,strTrim:v.H,objCreate:g.b,objKeys:v.B,objDefineAccessors:v.y,addEventHandler:S.a,dateNow:v.f,isIE:m.o,disableCookies:disableCookies,newGuid:S.f,perfNow:S.h,newId:S.g,randomValue:_.d,random32:_.c,mwcRandomSeed:_.b,mwcRandom32:_.a,generateW3CId:S.e};function isChromium(){return!!Object(m.e)(\"chrome\")}function openXhr(l,d,u,p,h,g){function _wrapSetXhrProp(l,d,u){try{l[d]=u}catch(l){}}void 0===p&&(p=!1),void 0===h&&(h=!1);var f=new XMLHttpRequest;return p&&_wrapSetXhrProp(f,T,p),u&&_wrapSetXhrProp(f,b,u),f.open(l,d,!h),u&&_wrapSetXhrProp(f,b,u),!h&&g&&_wrapSetXhrProp(f,I,g),f}},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.reason=d.callStartOptions=d.causeId=d.operationId=d.participantOperation=d.callOperation=d.IDEMPOTENCY_LEVEL=d.OPERATION_TYPE=void 0;var g,f=u(41),m=u(13),v=u(54);!function(l){l.CHAINED=\"Chained\",l.SYNC=\"Sync\",l.ASYNC=\"Async\"}(g=d.OPERATION_TYPE||(d.OPERATION_TYPE={}));var y,S,_=\"_operationIdValue_\",C=\"_causeIdValue_\",E=\"_callStartOptionsValue_\",T=\"_clientReasonValue_\";function callOperation(l,d){return operationDecorator(S.CALL,l,d)}function participantOperation(l,d){return operationDecorator(S.PARTICIPANT,l,d)}!function(l){l.NO_OP=\"NoOp\",l.ERROR=\"Error\"}(y=d.IDEMPOTENCY_LEVEL||(d.IDEMPOTENCY_LEVEL={})),function(l){l[l.CALL=0]=\"CALL\",l[l.PARTICIPANT=1]=\"PARTICIPANT\"}(S||(S={})),d.callOperation=callOperation,d.participantOperation=participantOperation;var operationId=function(l,d,u){if(l[d][_])throw new Error(\"can not specify more than one operation id\");l[d][_]=u};d.operationId=operationId;var causeId=function(l,d,u){if(l[d][C])throw new Error(\"can not specify more than one cause id\");l[d][C]=u};d.causeId=causeId;var callStartOptions=function(l,d,u){if(l[d][E])throw new Error(\"can not specify options more than once\");l[d][E]=u};d.callStartOptions=callStartOptions;var reason=function(l,d,u){if(l[d][T])throw new Error(\"can not specify reason more than once\");l[d][T]=u};d.reason=reason;var operationDecorator=function(l,d,u){return function(S,b,I){var A=I.value,R=S[b]&&S[b][_],P=S[b]&&S[b][C],O=S[b]&&S[b][E],M=S[b]&&S[b][T],w=u&&u.type||g.ASYNC;return I.value=function(){for(var S=this,_=[],C=0;C<arguments.length;C++)_[C]=arguments[C];var E=this,T=void 0!==R?_[R]:void 0;if(void 0!==T)if(Array.isArray(T))try{var b=T.map((function(l){return l.toString()})).sort().concat().toString();T=getStringHash(b).toString()}catch(l){return Promise.reject(32)}else if(T&&\"object\"==typeof T)try{var I=JSON.stringify(T);u&&u.operationIdKey&&T.hasOwnProperty(u.operationIdKey)&&(I=T[u.operationIdKey]),T=I}catch(l){return Promise.reject(32)}var N,D=(0,m.generateCauseId)();void 0!==P&&(_[P]&&(0,m.validateCauseId)(_[P])?D=_[P]:_[P]=D),void 0!==M&&_[M]&&(N=_[M]);var L=getOperationHandler(E,l);if(L.logOperation(D,d),u&&u.singular&&L.hasPendingOperation(d))return L.logOperation(D,d,\"Not allowed, pending operation exists\"),Promise.reject(60);var k=L.getEcsConfig();if(k&&k.enableOperationIdempotency&&u&&u.idempotencyLevel&&L.getRecord(d)>0)switch(L.logOperation(D,d,\"Called multiple times, handling operation according to specified policy: idempotency=\".concat(u.idempotencyLevel)),u.idempotencyLevel){case y.NO_OP:return Promise.resolve();case y.ERROR:return Promise.reject(60)}try{void 0!==O&&_[O]&&E.processCallStartOptions(_[O],D)}catch(l){return Promise.reject(32)}var x=!(!u||!u.convertError),execute=function(){return w===g.CHAINED?L.executeChained(A.bind.apply(A,h([S],p(_),!1)),d,T,D,x,N,u):w===g.SYNC?L.executeSync(A.bind.apply(A,h([S],p(_),!1)),d,T,D,x,N):L.execute(A.bind.apply(A,h([S],p(_),!1)),d,T,D,x,N,u)};if(d!==f.CALL_OPERATIONS.START_CALL&&d!==f.CALL_OPERATIONS.JOIN_CALL||L.hasPendingOperation(f.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED)||L.createPendingOperation(f.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED).catch(v.noop),u&&u.triggerAttach&&(L.hasPendingOperation(f.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY)||L.createPendingOperation(f.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY).catch(v.noop)),u&&u.type!==g.SYNC){var F=u&&u.waitFor;if(Array.isArray(F))return Promise.all(F.map((function(l){return l&&L.hasPendingOperation(l)&&L.waitForOperation(l,void 0,D)}))).then(execute,execute);if(F&&L.hasPendingOperation(F))return L.waitForOperation(F,void 0,D).then(execute,execute)}return execute()},I}},getOperationHandler=function(l,d){if(d===S.CALL)return l._callOperationHandler;if(d===S.PARTICIPANT)return l._participantOperationHandler;throw new Error(\"Unsupported operation handler type!\")};function getStringHash(l){for(var d=0,u=0;u<l.length;u++){d=(d<<5)-d+l.charCodeAt(u),d|=0}return d}},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},m=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0});var v=u(17),y=u(183),S=u(13),_=u(184),C=u(73),E=u(14),T=u(185),b=function(l){function OperationHandler(d,u,p,h,g){var f=l.call(this,d)||this;return f.callTelemetry=u,f._ecsConfig=p,f._publishCallback=h,f._preconditionFunction=g,f._record={},f.logSuccess=function(l,d,u){f._logger.info(\"\".concat(l,\" execution succeeded, result=\").concat(d?f.stringifyForLogging(d):\"void\",\", time=\").concat(u.duration()))},f.logFailure=function(l,d,u){f._logger.info(\"\".concat(l,\" execution failed, reason=\").concat(f.stringifyForLogging(d),\", time=\").concat(u.duration()))},f.logTimeout=function(l,d,u){f._logger.info(\"\".concat(l,\" execution timed out, reason=\").concat(f.stringifyForLogging(d),\", time=\").concat(u.duration()))},f.stringifyForLogging=function(l){var d;if(l instanceof Error)d=l.toString()||\"Unknown Error\";else try{d=JSON.stringify(l)}catch(l){d=\"Unable to stringify data\"}return d},f.convertToTransactionEndIfErrorOrString=function(l,d,u){if(f._logger.info(\"ecsEnableErrorConversion in operationHandler is: \".concat(f._ecsConfig&&f._ecsConfig.enableErrorConversion)),d&&f._ecsConfig&&f._ecsConfig.enableErrorConversion&&(\"string\"==typeof l||l instanceof Error)){var p=(0,C.getRejectTransactionEnd)(l);return f._logger.info(\"\".concat(u,\" Error converted from \").concat(l,\" to \").concat((0,E.getPrintableObject)(p))),p}return l},f._logger=d.createChild(\"[Operation]\"),f._chainedPromise=new _.default(f._logger.createChild(\"[Chained]\")),f}return p(OperationHandler,l),OperationHandler.prototype.resetOperationChain=function(l){this._chainedPromise.reset(l)},OperationHandler.prototype.executeSync=function(l,d,u,p,h,g){void 0===p&&(p=(0,S.generateCauseId)());var f=this.getOperationInfoForLogging(p,d,u),m=T.build();this._logger.info(\"\".concat(f,\"API calledSync\"));var v,y=this.callTelemetry.recordOperation(d,p,u,g);try{this._setRecord(d),v=l(),y.recordSuccess(v,p),this.logSuccess(f,v,m)}catch(l){var _=this.convertToTransactionEndIfErrorOrString(l,h,f);y.recordFailure(_,p),this.logFailure(f,_,m)}return v},OperationHandler.prototype.executeChained=function(l,d,u,p,f,m,v){return void 0===p&&(p=(0,S.generateCauseId)()),h(this,void 0,void 0,(function(){return g(this,(function(h){return[2,this.checkPendingOperationAndExecute(l,!0,d,u,p,f,m,v)]}))}))},OperationHandler.prototype.execute=function(l,d,u,p,f,m,v){return void 0===p&&(p=(0,S.generateCauseId)()),h(this,void 0,void 0,(function(){return g(this,(function(h){return[2,this.checkPendingOperationAndExecute(l,!1,d,u,p,f,m,v)]}))}))},OperationHandler.prototype.logOperation=function(l,d){for(var u=this,p=[],h=2;h<arguments.length;h++)p[h-2]=arguments[h];var g=p.length&&p.map((function(l){return u.stringifyForLogging(v.scrubMriOrOmit(l))}));this._logger.info(\"[\".concat(l,\"][\").concat(d,\"]API called, \").concat(g?\"with args=\".concat(g):\"\"))},OperationHandler.prototype.rejectPendingOperations=function(d,u,p){var h,g,m,v,y,_;if(void 0===u&&(u=(0,S.generateCauseId)()),p){try{for(var C=f(Object.keys(this._deferredOperations)),E=C.next();!E.done;E=C.next()){var T=E.value;this.callTelemetry.maybeRecordOperationFailure(T,p,void 0,u)}}catch(l){h={error:l}}finally{try{E&&!E.done&&(g=C.return)&&g.call(C)}finally{if(h)throw h.error}}try{for(var b=f(Object.keys(this._deferredOperationsWithOperationId)),I=b.next();!I.done;I=b.next()){T=I.value;try{for(var A=(y=void 0,f(Object.keys(this._deferredOperationsWithOperationId[T]))),R=A.next();!R.done;R=A.next()){var P=R.value;this.callTelemetry.maybeRecordOperationFailure(T,p,P,u)}}catch(l){y={error:l}}finally{try{R&&!R.done&&(_=A.return)&&_.call(A)}finally{if(y)throw y.error}}}}catch(l){m={error:l}}finally{try{I&&!I.done&&(v=b.return)&&v.call(b)}finally{if(m)throw m.error}}}l.prototype.rejectPendingOperations.call(this,d,u)},OperationHandler.prototype.maybeRejectOperations=function(d,u,p,h,g){var m,v;if(void 0===h&&(h=(0,S.generateCauseId)()),g)try{for(var y=f(d),_=y.next();!_.done;_=y.next()){var C=_.value;this.callTelemetry.maybeRecordOperationFailure(C,g,void 0,h)}}catch(l){m={error:l}}finally{try{_&&!_.done&&(v=y.return)&&v.call(y)}finally{if(m)throw m.error}}l.prototype.maybeRejectOperations.call(this,d,u,p,h)},OperationHandler.prototype.checkPendingOperationAndExecute=function(l,d,u,p,h,g,f,m){var v=this;void 0===h&&(h=(0,S.generateCauseId)());var y=this.getOperationInfoForLogging(h,u,p),_=null,C=null;return this.hasPendingOperationWithOperationId(u,p)||this.hasPendingOperation(u)?(this._logger.info(\"\".concat(y,\"already pending, returning existing operation\")),_=this.waitForOperation(u,p,h)):C=this.createPendingOperation(u,p,h,m),d?(this._logger.info(\"\".concat(y,\"chained\")),this._chainedPromise.chainPromise((function(){return _||v.executeInternal(C,h,l,u,p,g,f,m)}),u,h)):_||this.executeInternal(C,h,l,u,p,g,f,m)},OperationHandler.prototype._setRecord=function(l){this._record.hasOwnProperty(l)||(this._record[l]=0),this._record[l]+=1},OperationHandler.prototype.getRecord=function(l){return this._record[l]},OperationHandler.prototype._recordTelemetryTimeoutAndPublish=function(l,d,u,p,h,g,f){var m=this,v=l||60;return window.setTimeout((function(){if(m._publishCallback){if(m.hasPendingOperationWithOperationId(p,f)||m.hasPendingOperation(p)){var l=new Error(\"\".concat(h,\" execution did not complete before telemetry timeout of \").concat(v,\"s.\"));m.logTimeout(h,l,g),m.callTelemetry.maybeRecordOperationTimeout(p,l,f,u),m._publishCallback(d),m.callTelemetry.removeRecordedEvent(d)}}else m._logger.warn(\"\".concat(h,\" is marked to publish telemetry but no publish callback is defined.\"))}),1e3*v)},OperationHandler.prototype._instantTelemetryPublish=function(l,d){this._publishCallback?(this._publishCallback(d),this.callTelemetry.removeRecordedEvent(d)):this._logger.warn(\"\".concat(l,\" is marked to publish telemetry but no publish callback is defined.\"))},OperationHandler.prototype.parseInstantTelemetryParameters=function(l){var d,u=!1;return l&&(u=l.enableInstantTelemetry&&!this._ecsConfig.disableInstantTelemetry,d=l.telemetryTimeout),[u,d]},OperationHandler.prototype.executeInternal=function(l,d,u,p,f,v,y,S){var _;return h(this,void 0,void 0,(function(){var h,C,E,b,I,A,R,P,O,M;return g(this,(function(g){switch(g.label){case 0:h=this.getOperationInfoForLogging(d,p,f),this._logger.info(\"\".concat(h,\" executing operation...\")),C=T.build(),E=this.callTelemetry.recordOperation(p,d,f,y),b=m(this.parseInstantTelemetryParameters(S),2),I=b[0],A=b[1],g.label=1;case 1:return g.trys.push([1,3,,4]),this._setRecord(p),R=void 0,I&&(R=this._recordTelemetryTimeoutAndPublish(A,E,d,p,h,C,f)),(null===(_=null==S?void 0:S.preconditionTags)||void 0===_?void 0:_.length)&&this._preconditionFunction&&this._preconditionFunction(p,S.preconditionTags),[4,u()];case 2:return P=g.sent(),R&&clearTimeout(R),this.callTelemetry.maybeRecordOperationSuccess(p,P,f),this.logSuccess(h,P,C),this.maybeResolveOperation(p,P,f,d),[3,4];case 3:return O=g.sent(),M=this.convertToTransactionEndIfErrorOrString(O,v,h),this.callTelemetry.maybeRecordOperationFailure(p,M,f),this.logFailure(h,M,C),this.maybeRejectOperation(p,M,f,d),[3,4];case 4:return I&&this._instantTelemetryPublish(h,E),[2,l]}}))}))},OperationHandler.prototype.getEcsConfig=function(){return this._ecsConfig},OperationHandler}(y.default);d.default=b},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getSuccessTransactionEnd=d.getRejectTransactionEnd=d.isTransactionEnd=void 0;var p=u(41),h=u(14);function isTransactionEnd(l){return!(!l||!l.code)}function getRejectTransactionEnd(l,d){return isTransactionEnd(l)?l:{code:p.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:void 0!==d?d:p.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:\"string\"==typeof l?l:(0,h.getPrintableObject)(l)}}function getSuccessTransactionEnd(){return{code:p.TRANSACTION_END_CODE.SUCCESS}}d.isTransactionEnd=isTransactionEnd,d.getRejectTransactionEnd=getRejectTransactionEnd,d.getSuccessTransactionEnd=getSuccessTransactionEnd},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(8),g=u(4),f=function(){function Participant(l){this.id=l.id,this.displayName=l.displayName||\"\",this.languageId=l.languageId||null,this.endpointDetails=l.endpointDetails||[],this.acceptedBy=l.acceptedBy,this.role=l.role,this.tenantId=l.tenantId,this.isLobby=l.isLobby,this.meetingRole=l.meetingRole,this.advancedMeetingRole=l.advancedMeetingRole,this.participantId=l.participantId,this.publishedStates=l.publishedStates}return Participant.isInLobby=function(l,d){var u,h;try{for(var g=p(l),f=g.next();!f.done;f=g.next()){var m=f.value;if(m.endpointId===d&&m.isLobby)return!0}}catch(l){u={error:l}}finally{try{f&&!f.done&&(h=g.return)&&h.call(g)}finally{if(u)throw u.error}}return!1},Participant.isParticipantServerMuted=function(l){var d,u,h,g;try{for(var f=p(l),m=f.next();!m.done;m=f.next()){var v=m.value;if(v.mediaStreams&&!v.mappedTo)try{for(var y=(h=void 0,p(v.mediaStreams)),S=y.next();!S.done;S=y.next()){var _=S.value;if(\"audio\"===_.type&&!0===_.serverMuted)return!0}}catch(l){h={error:l}}finally{try{S&&!S.done&&(g=y.return)&&g.call(y)}finally{if(h)throw h.error}}}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=f.return)&&u.call(f)}finally{if(d)throw d.error}}return!1},Participant.fromWireParticipant=function(l){return g.assertNotNull(l,\"invalid wireParticipant\"),g.assertNotNullOrEmpty(l.id,\"participant must have valid Id\"),new Participant({id:l.id,displayName:l.displayName,languageId:l.languageId,acceptedBy:l.acceptedBy})},Participant.getPluginlessStateTypeFromWire=function(l){switch(l){case\"raiseHands\":return\"raiseHands\";case\"ufd\":return\"ufd\";case\"attendeeModalitiesUnrestricted\":return\"attendeeModalitiesUnrestricted\";case\"attendeeAudioRestricted\":return\"attendeeAudioRestricted\";case\"attendeeVideoRestricted\":return\"attendeeVideoRestricted\";case\"attendeeVideoUnrestricted\":return\"attendeeVideoUnrestricted\";case\"spotlight\":return\"spotlight\";case\"manageBreakoutRooms\":return\"manageBreakoutRooms\";default:throw\"Invalid state type when converting PublishType to PublishStateType.\"}},Participant.findOrCreateTypeState=function(l,d){var u=d.typeStates.findIndex((function(d){return d.type===l}));if(-1===u){var p={participantStates:[],type:l};d.typeStates.push(p),u=d.typeStates.length-1}return u},Participant.processPublishedStates=function(l,d){var u=this,p={typeStates:[]};p.typeStates=[];var g=l;return h.forEach(g,(function(l){var h=u.findOrCreateTypeState(u.getPluginlessStateTypeFromWire(l.stateType),p),g={id:d,publishedState:{content:l.content,stateId:l.stateId,typeRank:l.typeRank}};p.typeStates[h].participantStates.push(g)})),p},Participant.fromRosterEndpoints=function(l){var d=!1,u=!1,p=!1,h=!1,g=!1;return{endpointDetails:Object.keys(l).map((function(f){var m,v,y=[],S=!1,_=0;if(l[f].call&&(d=!0,y=l[f].call.mediaStreams||null,_=l[f].call.serverMuteVersion||0,v=l[f].call.appliedInteractivityLevel||\"unknown\"),l[f].lwj&&(u=!0,m=l[f].lwj.lwjSessionInformation||null),l[f].lobby&&(S=!0,p=!0,y=l[f].lobby.mediaStreams||null,m=l[f].lobby.lwjSessionInformation||null),l[f].mappedParticipant&&(h=!0,y=l[f].mappedParticipant.mediaStreams||null),!l[f].capabilities&&l[f].endpointCapabilities){var C=l[f].endpointCapabilities;l[f].capabilities={implicitCallback:16&C?\"enabled\":\"disabled\",cloudAudioVideoConference:1&C?\"enabled\":\"disabled\",cloudScreenSharing:2&C?\"enabled\":\"disabled\",hostlessConference:4&C?\"enabled\":\"disabled\",autoJoinOnConflict:32&C?\"enabled\":\"disabled\",serverMuteUnmute:64&C?\"enabled\":\"disabled\",supportsCompressedServicePayload:128&C?\"enabled\":\"disabled\",cloudMerge:8&C?\"enabled\":\"disabled\"}}return g=g||!!l[f].streamLobby||!!l[f].stream,{endpointId:f,participantId:l[f].participantId||null,clientVersion:l[f].clientVersion||null,endpointMetadata:l[f].endpointMetadata||null,originalId:l[f].originalId||null,contentSharing:l[f].contentSharing||null,capabilities:l[f].capabilities||null,endpointType:l[f].endpointType||\"default\",deviceType:l[f].deviceType||void 0,clientEndpointCapabilities:l[f].clientEndpointCapabilities||void 0,mediaStreams:y,serverMuteVersion:_,lwjSessionInformation:m,isLobby:S,endpointState:l[f].endpointState||null,publishedStates:l[f].publishedStates||null,callLinks:l[f].callLinks||null,appliedInteractivityLevel:v||\"unknown\",mappedTo:l[f].mappedTo||null,meetingGroupDetails:l[f].meetingGroupDetails,streamInformation:l[f].streamInformation,streamLobby:l[f].streamLobby,stream:l[f].stream}})),participantHasCallModality:d,participantHasLightWeightMeetingModality:u,participantIsInLobby:p,participantHasMappedEndpoint:h,participantHasStreamEndpoint:g}},Participant.fromRoster=function(l,d){void 0===d&&(d=!1),g.assertNotNull(l,\"invalid rosterParticipant \".concat(JSON.stringify(l))),g.assertNotNullOrEmpty(l.details.id,\"participant must have valid Id\");var u=l.endpoints||{},p=this.fromRosterEndpoints(u),h=p.endpointDetails,f=p.participantHasCallModality,m=p.participantHasLightWeightMeetingModality,v=p.participantHasMappedEndpoint,y=p.participantHasStreamEndpoint,S=p.participantIsInLobby;return f||m||S||v||d||y?((f||m)&&(S=!1),new Participant({id:l.details.id,displayName:l.details.displayName,languageId:l.details.languageId,role:l.role||\"\",tenantId:l.details.tenantId||\"\",endpointDetails:h||[],acceptedBy:l.acceptedBy||\"\",isLobby:S,meetingRole:l.meetingRole,advancedMeetingRole:l.advancedMeetingRole,participantId:l.details.participantId,publishedStates:l.publishedStates||null})):null},Participant.fromRosterSearchResults=function(l){g.assertNotNull(l,\"invalid rosterParticipant \".concat(JSON.stringify(l))),g.assertNotNullOrEmpty(l.details.id,\"participant must have valid Id\");var d=l.endpoints,u=this.fromRosterEndpoints(d),p=u.endpointDetails,h=u.participantHasCallModality,f=u.participantHasLightWeightMeetingModality,m=u.participantIsInLobby,v=u.participantHasMappedEndpoint,y=0;h||f?y=3:m?y=10:v&&(y=3);var S=d[0]?d[0].participantId:\"\";return{id:l.details.id,state:y,tenantId:l.details.tenantId||\"\",displayName:l.details.displayName,role:l.role||\"\",meetingRole:l.meetingRole,advancedMeetingRole:l.advancedMeetingRole,isServerMuted:this.isParticipantServerMuted(p),publishedStates:this.processPublishedStates(l.publishedStates,S),endpoints:p||[]}},Participant}();d.default=f},function(l,d,u){l.exports={2:\"need dictionary\",1:\"stream end\",0:\"\",\"-1\":\"file error\",\"-2\":\"stream error\",\"-3\":\"data error\",\"-4\":\"insufficient memory\",\"-5\":\"buffer error\",\"-6\":\"incompatible version\"}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.CommandUrlPresence=d.TrouterState=d.DeviceType=void 0,function(l){l[l.Desktop=1]=\"Desktop\",l[l.Mobile=2]=\"Mobile\",l[l.Tablet=8]=\"Tablet\"}(d.DeviceType||(d.DeviceType={})),function(l){l[l.Unknown=0]=\"Unknown\",l[l.Connected=2]=\"Connected\",l[l.Disconnected=3]=\"Disconnected\",l[l.Switching=9]=\"Switching\"}(d.TrouterState||(d.TrouterState={})),function(l){l[l.None=0]=\"None\",l[l.Mute=1]=\"Mute\",l[l.Unmute=2]=\"Unmute\"}(d.CommandUrlPresence||(d.CommandUrlPresence={}))},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.HttpRequestDispatcher=void 0;var g=u(196),f=u(13),m=u(109),v=u(14),y=u(35),S=function(){function HttpRequestDispatcher(l){l&&\"function\"==typeof l.createChild?this.logger=l.createChild(\"RequestDispatcher\"):this.logger=new m.TsCallingLogger(\"JS.TsCalling.RequestDispatcher\",!1)}return HttpRequestDispatcher.prototype.getRequestOptions=function(l,d,u,p,h){return{headers:d||{},timeout:p,payload:u||null,responseType:h}},HttpRequestDispatcher.prototype.getAsync=function(l,d){return this.sendRequest(l,d,\"GET\")},HttpRequestDispatcher.prototype.postAsync=function(l,d){return this.sendRequest(l,d,\"POST\")},HttpRequestDispatcher.prototype.putAsync=function(l,d){return this.sendRequest(l,d,\"PUT\")},HttpRequestDispatcher.prototype.removeAsync=function(l,d){return this.sendRequest(l,d,\"DELETE\")},HttpRequestDispatcher.prototype.sendRequest=function(l,d,u){return void 0===d&&(d={headers:{}}),p(this,void 0,void 0,(function(){var p,m,S,_,C,E;return h(this,(function(h){switch(h.label){case 0:(p=this.logger.createChild(\"[\".concat(d.causeId||(0,f.generateCauseId)(),\"][Request]\"))).info(\"sending, \".concat(u,\"-\").concat(l)),m=Date.now(),d.headers=d.headers||{},d.headers[\"content-type\"]||(d.headers[\"content-type\"]=d.contentType||\"application/json\"),h.label=1;case 1:return h.trys.push([1,3,,4]),_=g.default.request({url:l,method:u,headers:d.headers||{},timeout:\"number\"==typeof d.timeout?d.timeout:45e3,data:d.payload||\"\",responseType:d.responseType||d.dataType||\"json\",withCredentials:valueOrDefault(d.withCredentials,!1),cancelToken:new g.default.CancelToken((function(l){S=l}))}),(0,y.isPromiseLike)(d.timeout)&&d.timeout.then((function(){p.info(\"Aborting pending request\"),S()}),(function(){p.info(\"Timeout promise rejected, ignoring\")})),[4,_];case 2:return C=h.sent(),p.info(\"success, status=\".concat(C.status)),[2,{response:C.data,request:C.request,duration:Date.now()-m}];case 3:if(E=h.sent(),p.info(\"failed\"),g.default.isCancel(E))throw p.info(\"response=\".concat((0,v.safeJsonStringify)(E.response))),{aborted:!0};throw E.response?p.info(\"response=\".concat((0,v.safeJsonStringify)(E.response))):E.request?p.info(\"no response, request=\".concat((0,v.safeJsonStringify)(E.request))):p.info(\"request not made, error=\".concat((0,v.safeJsonStringify)(E))),E||new Error(\"Request failed\");case 4:return[2]}}))}))},HttpRequestDispatcher}();function valueOrDefault(l,d){return void 0!==l?l:d}d.HttpRequestDispatcher=S},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(14),g=u(18),f=u(29),m=u(61),v=function(l){function Stream(d,u,p){var h=l.call(this)||this;return h.mediaSession=d,h.isAvailable=!1,h.mediaSessionInitPromise=new f.SettablePromise,h.currentIsStreaming=!1,d&&h.mediaSessionInitPromise.resolve(),h.id=p,h.logger=u.createChild(\"Stream[\".concat(h.id,\"]\")),h}return p(Stream,l),Object.defineProperty(Stream.prototype,\"isStreaming\",{get:function(){return this.currentIsStreaming},set:function(l){this.currentIsStreaming=l,this.raiseChanged()},enumerable:!1,configurable:!0}),Stream.prototype.update=function(l,d){var u=void 0===l?{}:l,p=u.sourceId,g=void 0===p?null:p,f=u.direction,v=void 0===f?m.streamDirections.receive:f,y=u.participantId,S=void 0===y?null:y,_=u.endpointId,C=void 0===_?null:_;this.logger.info(\"[\".concat(d,\"][update before]  sourceId=\").concat(g,\", direction=\").concat(v,\", participantId=\").concat(S,\", endpointId=\").concat((0,h.truncate)(C,8))),this.id=g,this.isAvailable=v===m.streamDirections.sendReceive||v===m.streamDirections.send,this.participantId=S,this.endpointId=C,this.logger.info(\"[\".concat(d,\"][update after]  sourceId=\").concat(g,\", direction=\").concat(v,\", participantId=\").concat(S,\", endpointId=\").concat((0,h.truncate)(C,8))),this.raiseChanged()},Stream.prototype.setMediaSession=function(l,d){var u=l&&l.getAllowedModalities&&l.getAllowedModalities()||{};this.logger.info(\"[\".concat(d,\"][setMediaSession] \").concat(JSON.stringify(u))),this.mediaSession=l,l?this.mediaSessionInitPromise.resolve():this.mediaSessionInitPromise.reject(new Error(\"MediaSession is null\"))},Stream.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},Stream}(g.default);d.default=v},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoRendererBase=void 0;var f=u(19),m=u(7),v=u(15);function getObjectFitValue(l){switch(l){case\"crop\":return\"cover\";case\"stretch\":return\"fill\";case\"fit\":default:return\"contain\"}}var y=function(l){function VideoRendererBase(d,u){var p=l.call(this)||this;return p.container=d,p.window=v.default.window,p.video=p.container.ownerDocument.createElement(\"video\"),p.lastNotifiedVideoWidth=0,p.lastNotifiedVideoHeight=0,p.isVideoAttached=!1,p.startTimeTTFF=0,p.timeToFirstFrame=-1,p.isTimeToFirstFrameReported=!1,p.onVideoDataUpdated=function(){var l=p.video.videoWidth,d=p.video.videoHeight;if((l<32||d<32)&&(l=d=0),(p.lastNotifiedVideoWidth!==l||p.lastNotifiedVideoHeight!==d)&&(p.lastNotifiedVideoWidth=l,p.lastNotifiedVideoHeight=d,p.event(\"onVideoSizeChanged\").raise(l,d),!p.isTimeToFirstFrameReported)){if(-1===p.timeToFirstFrame){var u=Date.now();p.timeToFirstFrame=u-p.startTimeTTFF}var h=p.getTrackId();h&&(p.event(\"onVideoStarted\").raise(p.timeToFirstFrame,h),p.isTimeToFirstFrameReported=!0)}p.video&&p.video.paused&&p.video.play()},p.onVideoError=function(){p.event(\"onError\").raise(p.video.error||\"no video\")},p.onVideoPaused=function(){\"Edge\"===(0,f.getBrowserInfo)().name&&(p.window.attachMediaStream(p.video,null),p.window.attachMediaStream(p.video,p.stream)),p.video.play()},p.onContextMenu=function(l){l.preventDefault()},p.logger=u.createChild(\"\".concat(VideoRendererBase.rendererId++)),p.video.style.width=\"100%\",p.video.style.height=\"100%\",p.video.setAttribute(\"playsinline\",\"true\"),p.video.autoplay=!0,p.video.muted=!0,p.attachEventListeners(),p.logger.safe.info(\"created\"),p}return p(VideoRendererBase,l),VideoRendererBase.prototype.getVideoElement=function(){return this.video},VideoRendererBase.prototype.getTimeToFirstFrame=function(){return this.timeToFirstFrame},VideoRendererBase.prototype.resetTimeToFirstFrameFlag=function(){this.isTimeToFirstFrameReported=!1},VideoRendererBase.prototype.dispose=function(){this.isVideoAttached&&(this.container.removeChild(this.video),this.isVideoAttached=!1),this.detachEventListeners(),this.video=null,this.stream=null,this.canvas=null,this.context=null},VideoRendererBase.prototype.reattachEventListeners=function(){this.detachEventListeners(),this.attachEventListeners()},VideoRendererBase.prototype.attachMediaStream=function(l){this.stream!==l&&(this.stream&&this.window.detachMediaStream(this.video),l&&(this.video.hidden=0===l.getVideoTracks().length,this.window.attachMediaStream(this.video,l),this.isVideoAttached||(this.container.appendChild(this.video),this.isVideoAttached=!0,this.startTimeTTFF=Date.now())),this.stream=l)},VideoRendererBase.prototype.setScalingMode=function(l){this.video.style.objectFit=getObjectFitValue(l)},VideoRendererBase.prototype.getMediaStream=function(){return this.stream},VideoRendererBase.prototype.getTrackId=function(){var l,d,u;return null!==(u=null===(d=null===(l=this.stream)||void 0===l?void 0:l.getTracks()[0])||void 0===d?void 0:d.id)&&void 0!==u?u:void 0},VideoRendererBase.prototype.captureFrame=function(){var l,d,u;return h(this,void 0,void 0,(function(){var p,h,f,m,v;return g(this,(function(g){if(!(p=this.stream))throw this.logger.safe.error(\"Mediastream not found\"),new Error(\"Mediastream not found\");if(h=null===(u=null===(d=null===(l=p.getVideoTracks)||void 0===l?void 0:l.call(p))||void 0===d?void 0:d[0])||void 0===u?void 0:u.getSettings(),f=null==h?void 0:h.width,m=null==h?void 0:h.height,!f||!m)throw this.logger.safe.error(\"Failed to get video track width/height\"),new Error(\"Failed to get video track width/height\");return v=this.getImageData(f,m),[2,{getSize:function(){return{width:f,height:m}},isMirrored:function(){return!1},getImageData:function(){return v}}]}))}))},VideoRendererBase.prototype.getImageData=function(l,d){var u,p;if(null!==(u=this.canvas)&&void 0!==u||(this.canvas=this.container.ownerDocument.createElement(\"canvas\")),null!==(p=this.context)&&void 0!==p||(this.context=this.canvas.getContext(\"2d\")),!this.context)throw this.logger.safe.error(\"Failed to get canvas 2d context\"),new Error(\"Failed to get canvas 2d context\");return this.canvas.width=l,this.canvas.height=d,this.context.drawImage(this.video,0,0,l,d),this.context.getImageData(0,0,l,d)},VideoRendererBase.prototype.attachEventListeners=function(){this.video.addEventListener(\"loadedmetadata\",this.onVideoDataUpdated),this.video.addEventListener(\"timeupdate\",this.onVideoDataUpdated),this.video.addEventListener(\"error\",this.onVideoError),this.video.addEventListener(\"pause\",this.onVideoPaused),this.video.addEventListener(\"contextmenu\",this.onContextMenu)},VideoRendererBase.prototype.detachEventListeners=function(){this.video.removeEventListener(\"loadedmetadata\",this.onVideoDataUpdated),this.video.removeEventListener(\"timeupdate\",this.onVideoDataUpdated),this.video.removeEventListener(\"error\",this.onVideoError),this.video.removeEventListener(\"pause\",this.onVideoPaused),this.video.removeEventListener(\"contextmenu\",this.onContextMenu),this.attachMediaStream(null)},VideoRendererBase.rendererId=0,VideoRendererBase}(m.default);d.VideoRendererBase=y},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ConstraintsObject=void 0;var p=u(1),h=function(){function ConstraintsObject(l,d,u,p){void 0===u&&(u=!0),void 0===p&&(p=!1),this.audio=l,this.video=d,this.withTimeout=u,this.withEffect=p}return ConstraintsObject.prototype.clone=function(){var l=p.deepClone(this.video);return new ConstraintsObject(p.deepClone(this.audio),l,this.withTimeout,this.withEffect)},ConstraintsObject}();d.ConstraintsObject=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getFrameRateForTrack=d.getFrameRateForStream=d.getResolutionForTrack=d.getResolutionForStream=void 0;var p=u(1),h=[30,15,7.5,3.75,1.875];function getResolutionForStream(l,d){return l&&l.getVideoTracks()[0]?getResolutionForTrack(l.getVideoTracks()[0],d):d}function getResolutionForTrack(l,d){if(l&&l.getSettings){var u=l.getSettings();if(u)return{width:u.width,height:u.height}}return d}function getFrameRateForStream(l){return l&&l.getVideoTracks()[0]?getFrameRateForTrack(l.getVideoTracks()[0]):0}function getFrameRateForTrack(l){if(l&&l.getSettings){var d=l.getSettings();if(d)return p.getClosestValue(h,d.frameRate,!0)}return 0}d.getResolutionForStream=getResolutionForStream,d.getResolutionForTrack=getResolutionForTrack,d.getFrameRateForStream=getFrameRateForStream,d.getFrameRateForTrack=getFrameRateForTrack},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.createDefaultDevice=d.createCompositeAudioDevice=d.createDevice=void 0;var h=u(3),g=function(){function Device(l,d,u,p,g){this.deviceId=l,this.label=d,this.kind=u,this.groupId=p,this.capabilities=g,this.type=this.getType(this.kind),this.guid=\"\".concat(this.type,\":\").concat(this.deviceId),this.isSystemDefault=this.deviceId===h.default.MEDIA_DEVICE.defaultId}return Device.prototype.toDeviceDesc=function(){return{id:this.guid,browserId:this.deviceId,label:this.label,kind:this.type}},Device.prototype.getType=function(l){switch(l){case h.default.MEDIA_DEVICE_KIND.audioInput:return h.default.MEDIA_DEVICE.microphone;case h.default.MEDIA_DEVICE_KIND.audioOutput:return h.default.MEDIA_DEVICE.speaker;case h.default.MEDIA_DEVICE_KIND.videoInput:return h.default.MEDIA_DEVICE.camera;case h.default.MEDIA_DEVICE_KIND.compositeAudio:return h.default.MEDIA_DEVICE.compositeAudio;default:throw new Error(\"Device kind to recognized: \".concat(l))}},Device}(),f=function(l){function AudioDevice(d,u,p,h,g){return l.call(this,d,u,p,h,g)||this}return p(AudioDevice,l),AudioDevice.prototype.toDeviceDesc=function(){var d=l.prototype.toDeviceDesc.call(this);return d.isSystemDefault=this.isSystemDefault,d},AudioDevice}(g),m=function(l){function VideoDevice(d,u,p,h,g){var f=l.call(this,d,u,p,h,g)||this;if(f.position=\"unknown\",g&&g.facingMode&&1===g.facingMode.length)switch(g.facingMode[0]){case\"user\":f.position=\"front\";break;case\"environment\":f.position=\"back\"}return f}return p(VideoDevice,l),VideoDevice.prototype.toDeviceDesc=function(){var d=l.prototype.toDeviceDesc.call(this);return d.position=this.position,d},VideoDevice}(g),v=function(l){function CompositeAudioDevice(d,u,p,h,g,f){var m=l.call(this,null,p,h,\"\")||this;return m.micDevice=d,m.speakerDevice=u,m.formFactor=g,m.isPcInternalDevice=f,m.guid=null,m.isSystemDefault=!1,m}return p(CompositeAudioDevice,l),Object.defineProperty(CompositeAudioDevice.prototype,\"micDeviceId\",{get:function(){return this.micDevice.guid},enumerable:!1,configurable:!0}),Object.defineProperty(CompositeAudioDevice.prototype,\"speakerDeviceId\",{get:function(){return this.speakerDevice.guid},enumerable:!1,configurable:!0}),CompositeAudioDevice.prototype.toDeviceDesc=function(){var d=l.prototype.toDeviceDesc.call(this);return d.microphoneId=this.micDeviceId,d.speakerId=this.speakerDeviceId,d.formFactor=this.formFactor,d.isPcInternalDevice=this.isPcInternalDevice,d},CompositeAudioDevice}(g);function createDevice(l){var d=l.getCapabilities&&l.getCapabilities();switch(d&&(delete d.groupId,delete d.deviceId),l.kind){case h.default.MEDIA_DEVICE_KIND.audioInput:case h.default.MEDIA_DEVICE_KIND.audioOutput:return new f(l.deviceId,l.label,l.kind,l.groupId,d);case h.default.MEDIA_DEVICE_KIND.videoInput:return new m(l.deviceId,l.label,l.kind,l.groupId,d);default:throw new Error(\"Device kind is not recognized: \".concat(l.kind))}}function createCompositeAudioDevice(l,d,u){return new v(l,d,u,\"compositeAudio\",0,!1)}function createDefaultDevice(l){var d={deviceId:h.default.MEDIA_DEVICE.defaultId,label:h.default.MEDIA_DEVICE.defaultDeviceLabel,kind:getKind(l),groupId:\"\",toJSON:function(){return JSON.stringify(d)}};return createDevice(d)}function getKind(l){switch(l){case h.default.MEDIA_DEVICE.microphone:return h.default.MEDIA_DEVICE_KIND.audioInput;case h.default.MEDIA_DEVICE.speaker:return h.default.MEDIA_DEVICE_KIND.audioOutput;case h.default.MEDIA_DEVICE.camera:return h.default.MEDIA_DEVICE_KIND.videoInput;default:throw new Error(\"Device type to recognized: \".concat(l))}}d.createDevice=createDevice,d.createCompositeAudioDevice=createCompositeAudioDevice,d.createDefaultDevice=createDefaultDevice},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ActiveSpeakerManager=void 0;var p=function(){function ActiveSpeakerManager(l,d,u){this.onActiveSpeakersChanged=l,this.onDominantSpeakersChanged=d,this.logger=u}return ActiveSpeakerManager.prototype.setStrategy=function(l){var d;this.disposeStrategy(),this.dshStrategy=l,null===(d=this.dshStrategy)||void 0===d||d.setOnDominantSpeakerChanged(this.onDominantSpeakerHistoryChanged.bind(this))},ActiveSpeakerManager.prototype.onContributingSourcesChanged=function(l){var d;this.onActiveSpeakersChanged(l),null===(d=this.dshStrategy)||void 0===d||d.setSources(l)},ActiveSpeakerManager.prototype.onDominantSpeakerHistoryChanged=function(l,d){void 0===d&&(d=!1),this.onDominantSpeakersChanged(l),d&&this.dshStrategy&&(this.logger.safe.info(\"Disposing client DSH strategy and switching to MP provided DSH\"),this.disposeStrategy())},ActiveSpeakerManager.prototype.dispose=function(){this.disposeStrategy(),this.onActiveSpeakersChanged=null,this.onDominantSpeakersChanged=null},ActiveSpeakerManager.prototype.disposeStrategy=function(){var l;null===(l=this.dshStrategy)||void 0===l||l.dispose(),this.dshStrategy=null},ActiveSpeakerManager}();d.ActiveSpeakerManager=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(7),g=u(358),f=function(l){function ExtensionsManager(d){var u=l.call(this)||this;return u.logger=d,u.extensions=[],u}return p(ExtensionsManager,l),ExtensionsManager.prototype.dispose=function(){this.extensions.map((function(l){return l.dispose()})),this.extensions=[],l.prototype.dispose.call(this)},ExtensionsManager.prototype.addExtension=function(l,d){d.manager||(d.manager=this);var u=g.default.getExtension(l);u.initialize(d),this.extensions.push(u)},ExtensionsManager.prototype.getExtension=function(l){return this.extensions.find((function(d){return d.getType()===l}))},ExtensionsManager.prototype.configureExtension=function(l,d){var u;null===(u=this.getExtension(l))||void 0===u||u.configure(d)},ExtensionsManager.prototype.processNotification=function(l,d){switch(l){case\"ControlVideoStreaming\":this.event(\"onMediaStreamControlMessage\").raise(d);break;case\"DominantSpeakerInfo\":this.event(\"onDominantHistoryMessage\").raise(d);break;case\"BandwithNotification\":this.event(\"onBandwidthMessage\").raise(d);break;default:this.logger.safe.error(\"Notification message handler not found for type: \".concat(l))}},ExtensionsManager}(h.default);d.default=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ExtensionBase=void 0;var p=function(){function ExtensionBase(l){this.manager=null,this.extensionType=l}return ExtensionBase.prototype.initialize=function(l){l.manager&&(this.manager=l.manager),l.logger&&(this.logger=l.logger.createChild(this.extensionType))},ExtensionBase.prototype.dispose=function(){this.manager&&(this.manager=null),this.logger&&(this.logger.safe.info(\"disposed\"),this.logger=null)},ExtensionBase.prototype.configure=function(l){this.options=l},ExtensionBase.prototype.getOptions=function(){return this.options},ExtensionBase.prototype.getType=function(){return this.extensionType},ExtensionBase}();d.ExtensionBase=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaRollbackModifier=d.BandwidthControlModifier=void 0;var p=u(47),h=u(42),g=u(66),f=function(){function BandwidthControlModifier(l,d,u,p){this.logger=l,this.qualityManager=d,this.resolutionTable=u,this.configProvider=p}return BandwidthControlModifier.prototype.getControlItem=function(){return this.controlItem},BandwidthControlModifier.prototype.setControlItem=function(l){this.controlItem=l},BandwidthControlModifier.prototype.dispose=function(){this.controlItem=null},BandwidthControlModifier.prototype.setVideoControlMessage=function(l){this.controlItem=this.messageToControlItem(l),this.logger.safe.info(\"BW limit requested to \".concat(this.controlItem.bandwidth))},BandwidthControlModifier.prototype.modifyDescriptor=function(l){if(!this.controlItem)return l;var d=p.parse(l.sdp);if(!d.media[1])return this.logger.unsafe.warn(\"video modality is disabled, skipping sdp modification, \",l),l;var u=this.getCurrentResolutionBitrate();this.logger.safe.info(\"Select the BW limit as min of requested \".concat(this.controlItem.bandwidth,\" and Current Resolution Max BR \").concat(u));var h=this.getSessionBitrate(d),g=Math.min(u,this.controlItem.bandwidth,h);if(d.media[1].bandwidth)d.media[1].bandwidth[0].limit=g;else{var f={limit:g,type:\"AS\"};d.media[1].bandwidth=[f]}return l.sdp=p.write(d),l},BandwidthControlModifier.prototype.messageToControlItem=function(l){var d=h.default.build(l.controlVideoStreaming.controlInfo[0].fmtParams),u=\"max-br\",p=1.2;if(!d.contains(u))return null;var g=Math.round(+d.get(u)*p);return{sourceId:l.controlVideoStreaming.controlInfo[0].sourceId,streamMsid:l.controlVideoStreaming.controlInfo[0].streamMsid,bandwidth:g}},BandwidthControlModifier.prototype.getCurrentResolutionBitrate=function(){var l=this.qualityManager.getCurrentResolution(),d=this.resolutionTable.getResolutionByFs(l);return l&&d?Math.floor(this.resolutionTable.getBitrateForResolution(d.width,d.height).maxBitrate/1e3):Number.MAX_VALUE},BandwidthControlModifier.prototype.getSessionBitrate=function(l){var d=Number.MAX_SAFE_INTEGER;return this.configProvider.mediaConfig.maxBandwidthInKbps&&(d=this.configProvider.mediaConfig.maxBandwidthInKbps),l.bandwidth&&(d=Math.min(l.bandwidth[0].limit,d)),d-(this.configProvider.config.audioBandwidthInKbps||0)},BandwidthControlModifier}();d.BandwidthControlModifier=f;var m=function(){function MediaRollbackModifier(l,d,u){this.pc=l,this.configProvider=d,this.logger=u.createChild(\"MediaRollbackModifier\")}return MediaRollbackModifier.prototype.modifyDescriptor=function(l){var d=this,u=p.parse(l.sdp);return p.parse(this.pc.localDescription.sdp).media.forEach((function(l,p){(0!==l.port||l.bundleOnly)&&u.media[p]&&0!==u.media[p].port||(d.logger.safe.info(\"Adding disabled media \".concat(l.type,\", position \").concat(p)),u.media[p]=(0,g.disabledMedia)(l.type,void 0,l.protocol,void 0))})),new g.BundleGroupModifier(this.configProvider).modify(u),l.sdp=p.write(u),l},MediaRollbackModifier}();d.MediaRollbackModifier=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaChannelType=d.VideoCapabilitiesEventType=void 0,function(l){l[l.SSRC_UPDATED=0]=\"SSRC_UPDATED\",l[l.CODEC_PARAMS_UPDATED=1]=\"CODEC_PARAMS_UPDATED\"}(d.VideoCapabilitiesEventType||(d.VideoCapabilitiesEventType={})),function(l){l[l.Audio=0]=\"Audio\",l[l.Video=1]=\"Video\"}(d.MediaChannelType||(d.MediaChannelType={}))},function(l,d,u){function isStreamValid(l){return l&&!!l.url&&(!!l.decryptionToken||!!l.keyDeliveryUrl&&!!l.keyAuthorizationToken)}function assert(l,d){if(!l)throw new Error(\"Assert failed\".concat(void 0!==d?\": \".concat(d):\"\"))}Object.defineProperty(d,\"__esModule\",{value:!0}),d.assert=d.isStreamValid=void 0,d.isStreamValid=isStreamValid,d.assert=assert},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},g=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},f=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},m=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},v=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.CallRegistry=void 0;var y=u(8),S=u(40),_=u(41),C=u(53),E=u(13),T=u(90),b=u(14),I=u(181),A=u(18),R=u(71),P=u(72),O=u(17),M=u(35),w=u(55),N=u(91),D=u(93),L=u(73),k=new RegExp(\"/callAgent/\",\"i\"),x=function(){function CallNotificationMessageHandler(l,d){this.signalingAgentProvider=l,this.callRegistry=d}return CallNotificationMessageHandler.prototype.handleMessage=function(l){var d;return l.eventId?l.eventId in w.logUploadEvents?(this.callRegistry.logUploadNotification(l),\"number\"==typeof(d=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(l))?{isHandled:!0,resultCode:d}:{isHandled:!0,resultCode:d.resultCode,responseBody:d.responseBody,responseHeaders:d.responseHeaders}):{isHandled:!1}:l.url.search(k)>-1?\"number\"==typeof(d=this.signalingAgentProvider.getSignalingAgent().handleIncomingNotification(l))?{isHandled:!0,resultCode:d}:{isHandled:!0,resultCode:d.resultCode,responseBody:d.responseBody,responseHeaders:d.responseHeaders}:{isHandled:!1}},CallNotificationMessageHandler}(),F=function(){function IncomingCallMessageHandler(l,d){this.callRegistry=l,this.recentInvitations=[],this.logger=d.createChild(\"IncomingCallMessageHandler\")}return IncomingCallMessageHandler.prototype.handleMessage=function(l){var d=this.handleIncomingCall(l);return d?{isHandled:d,resultCode:200}:{isHandled:d}},IncomingCallMessageHandler.prototype.handleIncomingCall=function(l){var d,u=(0,E.generateCauseId)(),p=this.logger.createFnLogger(\"handleIncomingCall\",u);if(this.isProxiableNotification(l))return this.callRegistry.proxyPushNotification(l),!0;if(!this.isIncomingCallMessage(l))return!1;try{if(l&&l.body&&l.body.gp&&!(0,M.isStringBase64)(l.body.gp))p.info(\"unencoded payload, skipping decoding.\"),d=l.body.gp;else{var h=decodeNotificationPayload(l);d=JSON.parse(h)}d.body=l.body}catch(l){return p.logFailure(\"Error parsing notification payload: \".concat(l)),!1}var g=this.isCallTransferNotification(l)?this.buildTransferCallPayload(d):this.buildNGCCallPayload(d);if(!g)return!1;if(this.callRegistry.calls.some((function(l){return l.callId===g.convoCallId&&l.participantId===g.participantId})))return p.logFailure(\"Duplicate call filtered because it was in the call registry, callId = \".concat(g.convoCallId,\", participantId = \").concat(g.participantId)),!1;var f=this.isCallReplacementNotification(l);if(p.log(\"replacementCall=\".concat(f)),!f&&this.recentInvitations.some((function(l){return l.convoCallId===g.convoCallId&&l.participantId===g.participantId})))return p.logFailure(\"Duplicate call filtered because it was in the recent calls list, callId = \".concat(g.convoCallId,\", participantId = \").concat(g.participantId)),!1;5===this.recentInvitations.length&&this.recentInvitations.shift(),this.recentInvitations.push({convoCallId:g.convoCallId,participantId:g.participantId});var m=y.find(this.callRegistry.calls,(function(l){return l.callId===g.convoCallId&&8===l.state}));return m||(m=g.groupId?this.callRegistry.createCallWithGroupId(g.groupId,g.convoCallId,g.participantId,u):this.callRegistry.createCall(g.conversationId,g.convoCallId,g.participantId,void 0,u)),m.init({threadId:g.conversationId,messageId:g.messageId,mediaPeerType:2}),this.callRegistry.testEndpointMetadata?m.acknowledge(g,this.callRegistry.testEndpointMetadata,u):m.acknowledge(g,void 0,u),!0},IncomingCallMessageHandler.prototype.isIncomingCallMessage=function(l){return Object.keys(w.incomingCallEvents).some((function(d){return w.incomingCallEvents[d]===l.eventId}))||this.isCallTransferNotification(l)},IncomingCallMessageHandler.prototype.isCallTransferNotification=function(l){return l.callNotification&&(\"transfer\"===l.callNotification.callType||\"replaces\"===l.callNotification.callType)},IncomingCallMessageHandler.prototype.isCallReplacementNotification=function(l){return l.callNotification&&\"replaces\"===l.callNotification.callType},IncomingCallMessageHandler.prototype.isProxiableNotification=function(l){return Object.keys(w.proxiedEvents).some((function(d){return w.proxiedEvents[d]===l.eventId}))},IncomingCallMessageHandler.prototype.buildTransferCallPayload=function(l){var d={body:l.body,callerId:l.callNotification.from.id,groupId:null,conversationId:null,convoCallId:l.debugContent.callId,isMultiParty:l.conversationInvitation&&l.conversationInvitation.isMultiParty,fromMixer:l.callNotification.fromMixer,ngcCall:!0,participantId:l.callNotification.to.participantId,transferorId:l.callNotification.transferor&&l.callNotification.transferor.details&&l.callNotification.transferor.details.id,transferorType:l.callNotification.transferor&&l.callNotification.transferor.transferorType,transferorDisplayName:l.callNotification.transferor&&l.callNotification.transferor.details&&l.callNotification.transferor.details.displayName,callType:l.callNotification.callType,consultativeCallId:l.callNotification.consultativeCallId,messageId:null,callQueueInfo:l.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.info(\"Incoming transfer paylod\",d),d},IncomingCallMessageHandler.prototype.buildNGCCallPayload=function(l){if(!l.callNotification)return this.logger.error(\"Missing callNotification in parsed incoming NGC call payload\"),null;var d={groupId:l.groupContext&&l.groupContext.id,conversationId:l.groupChat&&l.groupChat.threadId,messageId:l.groupChat&&l.groupChat.messageId,callerId:l.callNotification.from.id,isMultiParty:l.conversationInvitation.isMultiParty,fromMixer:l.callNotification.fromMixer,convoCallId:l.debugContent.callId,participantId:l.debugContent.participantId,ngcCall:!0,body:l.body,transferorId:l.callNotification.transferor&&l.callNotification.transferor.details&&l.callNotification.transferor.details.id,transferorType:l.callNotification.transferor&&l.callNotification.transferor.transferorType,transferorDisplayName:l.callNotification.transferor&&l.callNotification.transferor.details&&l.callNotification.transferor.details.displayName,callType:l.callNotification.callType,callQueueInfo:l.callNotification.applicationContent,videoCall:void 0,launchTime:void 0,pushReceivedTime:void 0,registrationId:void 0};return this.logger.info(\"Incoming NGC payload\",d),d},IncomingCallMessageHandler}(),U=function(l){function CallRegistry(d,u,p,h,g,f,m,v,y,_){void 0===f&&(f={}),void 0===m&&(m=null);var b=l.call(this)||this;if(b.trouterService=d,b.signalingAgentProvider=u,b.mediaAgent=p,b.callingLogger=h,b.telemetryLoggers=g,b.callSettings=f,b.ecsProvider=m,b.imageRendererProvider=v,b.skypeIdentity=y,b.oneDsTelemetryLoggers=_,b.calls=[],b.isDisposing=!1,b._disposedPromise=S.defer(),b.testEndpointMetadata=null,b.addCallSubscriptionToMap=function(l,d){b.callSubscriptionsMap.set(l,(b.callSubscriptionsMap.get(l)||[]).concat(d))},b.clearCallSubscription=function(){b.callSubscriptionsMap.forEach((function(l){l.forEach((function(l){l.dispose()}))})),b.callSubscriptionsMap.clear()},b.skypeIdentity&&(b.identity=b.skypeIdentity.id),b.callSubscriptionsMap=new Map,b.logger=new T.default(b.callingLogger).createChild(\"CallRegistry/\".concat((0,E.generateCauseId)())),b.registryTelemetry=new C.CallRegistryTelemetry(b.logger,(new Date).getTime()),!b._callOperationHandler){var I=b.ecsProvider&&b.ecsProvider.getEcsConfig(\"SkypeCalling\",\"disableInstantTelemetry\");b._callOperationHandler=new P.default(b.logger,b.registryTelemetry,{disableInstantTelemetry:I},(function(l){b._publishTelemetry(l)}))}var A=b.mediaAgent.getConfig().disconnectOnPageHide;return b._windowUninitEvent=A?\"pagehide\":\"beforeunload\",b.signalingAgentProvider.getSignalingAgent().setTokenRequiredCallBack(b.onTokenRequired.bind(b)),b}return p(CallRegistry,l),CallRegistry.prototype.init=function(l,d,u){return void 0===u&&(u=(0,E.generateCauseId)()),this.logger.createFnLogger(\"init\",u).info(\"init\"),this.login(l)},CallRegistry.prototype.uninit=function(){return this.logout()},CallRegistry.prototype.login=function(l,d){return void 0===d&&(d=(0,E.generateCauseId)()),this.logger.createFnLogger(\"login\",d).info(\"login\"),this.skypeIdentity=l,this.identity=this.skypeIdentity.id,this.initialize(d)},CallRegistry.prototype.initialize=function(l,d){var u=this;void 0===l&&(l=(0,E.generateCauseId)());var p=this.logger.createFnLogger(\"initialize\",l),h=d&&d.applicationType?d.applicationType:\"null\";p.info(\"initialize with applicationType: \".concat(h)),this.accountConfiguration=d,this.incomingCallMessageHandler=new F(this,this.logger),this.trouterService.registerMessageHandler(new x(this.signalingAgentProvider,this)),this.trouterService.registerMessageHandler(this.incomingCallMessageHandler),p.info(\"Call registry init, endpointMetadata\",this.testEndpointMetadata);try{this.windowUninitListener=function(){u._disregardWindowUninitEvents||u.stopCallsWithBeacon()},window.addEventListener(this._windowUninitEvent,this.windowUninitListener)}catch(l){p.logFailure(\"Not adding beforeunload listener: \".concat(l))}return Promise.resolve(void 0)},CallRegistry.prototype.logout=function(l){void 0===l&&(l=(0,E.generateCauseId)());var d=this.logger.createFnLogger(\"logout\",l);d.info(\"logout\");try{this.trouterService.clearMessageHandlers(),window.removeEventListener(this._windowUninitEvent,this.windowUninitListener)}catch(l){d.info(\"Not removing beforeunload listener: \".concat(l))}return Promise.resolve(void 0)},CallRegistry.prototype._publishTelemetry=function(l){if(this.telemetryLoggers&&this.telemetryLoggers.signaling){this.registryTelemetry.setSkypeId(this.identity);try{var d=this.signalingAgentProvider.getSignalingAgent();this.registryTelemetry.setEndpointId(d.endpointId)}catch(l){this.logger.warn(\"Could not get end point ID from signaling agent for call registry telemetry.\")}this.accountConfiguration&&(this.registryTelemetry.setAcsResourceId(this.accountConfiguration.acsResourceId),this.registryTelemetry.setApplicationType(this.accountConfiguration.applicationType),this.registryTelemetry.setPartition(this.accountConfiguration.partition),this.registryTelemetry.setRegion(this.accountConfiguration.region),this.registryTelemetry.setRing(this.accountConfiguration.ring),this.registryTelemetry.setTenantId(this.accountConfiguration.tenantId),this.registryTelemetry.setUserHexCID(this.accountConfiguration.userHexCID));var u=_.TELEMETRY_EVENT_NAMES.REGISTRY_WEB;this.telemetryLoggers.signaling.sendEvent({eventName:u,props:this.registryTelemetry.getEvent(null,l)})}},CallRegistry.prototype.dispose=function(d){return void 0===d&&(d=(0,E.generateCauseId)()),f(this,void 0,void 0,(function(){var u,p,h,g,f=this;return m(this,(function(m){return(u=this.logger.createFnLogger(\"dispose\",d)).info(\"dispose\"),this.isDisposing?(u.warn(\"call registry is already in disposing stage!\"),[2,this._disposedPromise.promise]):(this.isDisposing=!0,p=function(){f.calls=[],f.event(\"disposed\").raise(),l.prototype.dispose.call(f),f._disposedPromise.resolve()},h=this.calls.map((function(l){return l.stop()})),g=function(){return f.logout()},this.clearCallSubscription(),this.signalingAgentProvider.getSignalingAgent().resetAuthTokenManager(),Promise.all(h).then(g,g).then(p,p),[2,this._disposedPromise.promise])}))}))},Object.defineProperty(CallRegistry.prototype,\"disposePromise\",{get:function(){return this._disposedPromise.promise},enumerable:!1,configurable:!0}),CallRegistry.prototype.createCallWithMeetingData=function(l,d,u,p){var h=this,g=this.logger.createFnLogger(\"createCallWithMeetingData\",p);if(g.info(\"meetingData:\".concat((0,b.safeJsonStringify)(l),\", callId:\").concat(d,\", localParticipantId: \").concat(O.scrubMriOrOmit(u))),!l)return g.info(\"meetingData cannot be null\"),null;var f=this.mediaAgent&&this.mediaAgent.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers,m=this.getCallUsingMeetingData(l,d,u,void 0,void 0,p);if(m)return g.info(\"Call Registry has an entry for this call's meeting data\"),m;if(m=this.getCall(d,u,p))return g.info(\"Call Registry has an entry for this callId, participantId\"),m;m=new N.default(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,new T.default(this.callingLogger),f,this.skypeIdentity,this.callSettings,null,null,d,u,this.ecsProvider,this.trouterService,this.imageRendererProvider,this.accountConfiguration,void 0,this.locationInfoContent,this.networkInfoContent,l,this.areaContent),this.calls.push(m),this.event(\"callAdded\").raise(m),this.raiseChanged(),g.info(\"creating new call, \".concat(m.callId,\", \").concat((0,b.safeJsonStringify)(l),\", \").concat((0,b.safeJsonStringify)(m.meetingData)));var v=m.on(\"replacementRequested\",(function(l){h.incomingCallMessageHandler.handleMessage(l)}));return this.addCallSubscriptionToMap(m,v),m},CallRegistry.prototype.createCall=function(l,d,u,p,h){return void 0===h&&(h=(0,E.generateCauseId)()),this._createCall(l,d,u,p,h)},CallRegistry.prototype.createCallWithGroupId=function(l,d,u,p){return this._createCall(\"\",d,u,void 0,p,l)},CallRegistry.prototype._createCall=function(l,d,u,p,h,g){var f=this;void 0===h&&(h=(0,E.generateCauseId)()),this.logger.createFnLogger(\"createCall\",h).info(\"threadId:\".concat(O.getLoggableThreadId(l),\", callId:\").concat(d,\", localParticipantId: \").concat(O.scrubMriOrOmit(u),\", messageId:\").concat(p,\", groupId:\").concat(O.scrubMriOrOmit(g)));var m=this.mediaAgent&&this.mediaAgent.getConfig().useOneDsLogger?this.oneDsTelemetryLoggers:this.telemetryLoggers,v=null;if(v=this.getCall(d,u,h))return v;if(v=this.getCallUsingThreadIdMessageId(l,d,p,h))return v;if(g&&(v=y.find(this.calls,(function(l){return l.groupId===g}))))return v;v=new N.default(this.signalingAgentProvider.getSignalingAgent(),this.mediaAgent,new T.default(this.callingLogger),m,this.skypeIdentity,this.callSettings,g,l,d,u,this.ecsProvider,this.trouterService,this.imageRendererProvider,this.accountConfiguration,p,this.locationInfoContent,this.networkInfoContent,null,this.areaContent),this.calls.push(v),this.event(\"callAdded\").raise(v),this.raiseChanged();var S=v.on(\"replacementRequested\",(function(l){f.incomingCallMessageHandler.handleMessage(l)}));return this.addCallSubscriptionToMap(v,S),v},CallRegistry.prototype.getCall=function(l,d,u){void 0===u&&(u=(0,E.generateCauseId)());var p=this.logger.createFnLogger(\"getCall[callId=\".concat(l,\"][participantId=\").concat(O.scrubMriOrOmit(d),\"]\"),u);if(!l)return p.logFailure(\"callId is undefined\"),null;var h=this.calls.find((function(d){return d.callId===l}));return h&&p.info(\"Call Registry already has an entry for this call\"),h},CallRegistry.prototype.deleteCall=function(l){var d=this.calls.indexOf(l);return-1!==d&&(this.callSubscriptionsMap.get(l).forEach((function(l){l.dispose()})),this.callSubscriptionsMap.delete(l),this.calls.splice(d,1),this.event(\"callRemoved\").raise(l),this.raiseChanged(),!0)},CallRegistry.prototype.setConfiguration=function(l){return f(this,void 0,void 0,(function(){return m(this,(function(d){return this.accountConfiguration=l,[2]}))}))},CallRegistry.prototype.updateDisplayName=function(l){return this.skypeIdentity.displayName=l,this.calls.forEach((function(d){d.updateDisplayName(l)})),Promise.resolve()},CallRegistry.prototype.fireIntent=function(l,d){return Promise.resolve()},CallRegistry.prototype.getCallState=function(l,d){return Promise.reject(\"Not implemented\")},CallRegistry.prototype.getSetup=function(){},CallRegistry.prototype.updateSkypeToken=function(l){this.logger.debug(\"CallRegistry.updateSkypeToken() called but not supported in the current set up.\")},CallRegistry.prototype.updateToken=function(l,d,u,p,h){this.logger.info(\"[updateToken], causeId = \".concat(p,\" tokenType = \").concat(d.tokenType,\", \")+\"factorsJson = \".concat(l,\", tokenExpiredTime = \").concat(h));try{return this.signalingAgentProvider.getSignalingAgent().updateToken(l,d,u,p,h),Promise.resolve((0,L.getSuccessTransactionEnd)())}catch(d){return this.logger.info(\"Failed to update token with \".concat(l,\", error is \").concat(d)),Promise.reject((0,L.getRejectTransactionEnd)(\"Failed to update token with \".concat(l,\", error is \").concat(d)))}},CallRegistry.prototype.onTokenRequired=function(l){var d=l.requestMetadataJson,u=l.factorsJson,p=l.tokenType,h=l.invalidToken;this.logger.info(\"[onTokenRequired], tokenType \".concat(p,\", factorsJson \").concat(u,\", \")+\"requestMetadataJson \".concat(JSON.stringify(d))),this.event(\"tokenRequired\").raise(u,p,d,h)},CallRegistry.prototype.debugInformation=function(l){var d=l?\"CallInformation\\n * CallId=\".concat(l.callId):void 0;return Promise.resolve(d)},CallRegistry.prototype.setLocationInfo=function(l,d,u){if(void 0===u&&(u=(0,E.generateCauseId)()),this.logger.info(\"setLocationInfo, \".concat(u,\", infoType:\").concat(l,\", contentJson \").concat(d?\"is set\":\"is undefined\")),d)try{JSON.parse(d)}catch(l){return Promise.reject(\"invalid contentJson: \".concat(l))}return this.locationInfoType=l,1===this.locationInfoType&&(this.locationInfoContent=d,this.logger.info(\"locationInfoContent set to \".concat(this.locationInfoContent))),2===this.locationInfoType&&(this.networkInfoContent=d,this.logger.info(\"networkInfoContent set to \".concat(this.networkInfoContent))),3===this.locationInfoType&&(this.areaContent=d,this.logger.info(\"areaContent set to \".concat(this.areaContent))),Promise.resolve()},CallRegistry.prototype.proxyPushNotification=function(l){this.logger.info(\"Proxying push notification with event ID \".concat(l.eventId));try{var d={eventId:l.eventId,payload:decodeNotificationPayload(l)};this.event(\"proxiedPushNotification\").raise(d)}catch(l){this.logger.error(\"Error proxying push notification: \".concat(l))}},CallRegistry.prototype.logUploadNotification=function(l){this.logger.info(\"Log upload notification with event ID \".concat(l.eventId));try{var d={eventId:l.eventId,payload:decodeNotificationPayload(l)};this.event(\"logUploadNotification\").raise(d)}catch(l){this.logger.error(\"Error raising log upload notification: \".concat(l))}},CallRegistry.prototype.sendPush=function(l,d,u,p){var h={id:l},g=[];return d.forEach((function(l){g.push({id:l})})),this.signalingAgentProvider.getSignalingAgent().sendPushAsync(h,g,u,p)},CallRegistry.prototype.enableWindowUninitEventHandler=function(){this._disregardWindowUninitEvents=!1},CallRegistry.prototype.disableWindowUninitEventHandler=function(){this._disregardWindowUninitEvents=!0},CallRegistry.prototype.getCallUsingThreadIdMessageId=function(l,d,u,p){this.logger.info(\"[getCallUsingThreadIdMessageId][\".concat(p,\"] threadID: \").concat(O.getLoggableThreadId(l),\" callId: \").concat(d,\" messageId: \").concat(u));var h=null;return l&&(h=y.find(this.calls,(function(p){return p.threadId===l&&(d&&p.callId===d||u&&p.messageId===u)})))?(this.logger.logFailure(\"[getCallUsingThreadIdMessageId][\".concat(p,\"]Call Registry already has an entry for threadId: \").concat(O.getLoggableThreadId(h.threadId),\", callId: \").concat(h.callId,\", messageId: \").concat(h.messageId)),h):h},CallRegistry.prototype.getCallUsingMeetingData=function(l,d,u,p,h,g){var f,m;void 0===g&&(g=(0,E.generateCauseId)());var y,S=this.logger.createFnLogger(\"getCallUsingMeetingData\",g);if(S.info(\"[callId=\".concat(d,\"][participantId=\").concat(O.scrubMriOrOmit(u),\"] meetingData: \").concat((0,b.safeJsonStringify)(l),\" threadId: \").concat(O.getLoggableThreadId(p),\" messageId: \").concat(h)),!d)return S.logFailure(\"callId is undefined\"),null;try{for(var _=v(this.calls),C=_.next();!C.done;C=_.next()){var T=C.value;if(T.callId===d){y=T;break}if((0,I.compareMeetingData)(T.meetingData,l,g,this.logger)){y=T;break}}}catch(l){f={error:l}}finally{try{C&&!C.done&&(m=_.return)&&m.call(_)}finally{if(f)throw f.error}}return y},CallRegistry.prototype.stopCallsWithBeacon=function(){var l,d;try{for(var u=v(this.calls),p=u.next();!p.done;p=u.next()){p.value.stopWithBeacon()}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}},h([(0,R.callOperation)(_.CALL_REGISTRY_OPERATIONS.INITIALIZE,{enableInstantTelemetry:!0}),g(\"design:type\",Function),g(\"design:paramtypes\",[Object,Object]),g(\"design:returntype\",Promise)],CallRegistry.prototype,\"initialize\",null),h([(0,R.callOperation)(_.CALL_REGISTRY_OPERATIONS.LOGOUT,{enableInstantTelemetry:!0}),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],CallRegistry.prototype,\"logout\",null),CallRegistry}(A.default);function decodeNotificationPayload(l){if(l&&l.body){if(l.body.gp)return atob(l.body.gp);if(l.body.cp)return D.inflate(atob(l.body.cp),{to:\"string\"})}return\"{}\"}d.CallRegistry=U},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(14),f=function(){function InternalLogger(l){var d=this;this._callingLogger=l,this._maybeLog=function(l){for(var u,f=[],m=1;m<arguments.length;m++)f[m-1]=arguments[m];try{(u=d._callingLogger)[l].apply(u,h([],p(f),!1))}catch(l){d._callingLogger.info(\"[failed to log]\",(0,g.getPrintableObject)(l))}}}return InternalLogger.prototype.getPrefix=function(l,d){var u=\"\";return d&&(u+=\"[\".concat(d,\"]\")),l&&(u+=\"[\".concat(l,\"]\")),u},InternalLogger.prototype.createChild=function(l,d){return new InternalLogger(this._callingLogger.createChild(l,d))},InternalLogger.prototype.createFnLogger=function(l,d){for(var u=[],p=2;p<arguments.length;p++)u[p-2]=arguments[p];return new InternalLogger(this._callingLogger.createChild(this.getPrefix(l,d)+u.join(\"\"),!1))},InternalLogger.prototype.logSuccess=function(l){this._maybeLog(\"info\",\"success=\".concat(l,\"}\"))},InternalLogger.prototype.logFailure=function(l){var d=(0,g.getPrintableObject)(l);this._maybeLog(\"info\",\"failed=\".concat(d,\"}\"))},InternalLogger.prototype.log=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];this._maybeLog.apply(this,h([\"log\"],p(l),!1))},InternalLogger.prototype.debug=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];this._maybeLog.apply(this,h([\"debug\"],p(l),!1))},InternalLogger.prototype.info=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];this._maybeLog.apply(this,h([\"info\"],p(l),!1))},InternalLogger.prototype.warn=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];this._maybeLog.apply(this,h([\"warn\"],p(l),!1))},InternalLogger.prototype.error=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];this._maybeLog.apply(this,h([\"error\"],p(l),!1))},InternalLogger}();d.default=f},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},g=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},f=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},m=this&&this.__param||function(l,d){return function(u,p){d(u,p,l)}},v=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},y=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},S=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},_=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},C=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.LocalMediaStream=d.DEFAULT_PARTICIPANT_ID=d.DEFAULT_ENDPOINT_ID=void 0;var E=u(8),T=u(186),b=u(92),I=u(40),A=u(41),R=u(53),P=u(13),O=u(57),M=u(73),w=u(54),N=u(56),D=u(14),L=u(58),k=u(297),x=u(18),F=u(71),U=u(72),j=u(46),B=u(298),V=u(17),H=u(299),G=u(60),W=u(114),q=u(55),z=u(115),K=u(116),J=u(300),Q=u(117),Y=u(118),$=u(304),X=u(305),Z=u(306),ee=u(316),te=u(61),ne=u(317),ie=u(318),re=[1,2,9,10,11,12,30,27,28];d.DEFAULT_ENDPOINT_ID=\"remote\",d.DEFAULT_PARTICIPANT_ID=\"remote\";var oe,ae,se=function(l){function LocalMediaStream(d,u){var p=l.call(this)||this;return p.isStreaming=d,p.mediaType=u,p}return p(LocalMediaStream,l),LocalMediaStream}(x.default);d.LocalMediaStream=se,function(l){l.Specified=\"specified\",l.All=\"all\"}(oe||(oe={})),function(l){l[l.None=0]=\"None\",l[l.Self=1]=\"Self\",l[l.Other=2]=\"Other\"}(ae||(ae={}));var ce=function(l){function PluginlessCall(d,u,p,h,g,f,m,v,y,_,C,T,O,M,w,N,L,k,x){var F=l.call(this,p)||this;F.signalingAgent=d,F.mediaAgent=u,F.logger=p,F.telemetryLoggers=h,F.currentUserSkypeIdentity=g,F.callSettings=f,F.groupId=m,F.threadId=v,F.ecsProvider=C,F.trouterService=T,F.accountConfiguration=M,F.participants=[],F.isServerMuted=!1,F.isSpeakerMuted=!1,F.isVideoOn=!1,F.isScreenSharingOn=!1,F.callStartedAt=null,F.callHeldAt=null,F.callType=-1,F.failureType=2,F.isEmergency=!1,F.contentSharingSessions=[],F.endpoints={endpointDetails:[]},F.isPreheatEnabled=!1,F.localMediaStreams=[],F.enableRealtimeTelemetry=!1,F.isSharedLineAppearanceV2Activated=!1,F.requestedHoldState=!1,F.mediaStateConfigurationHelper=new W.MediaStateConfigHelper({mediaStates:[W.getMediaState(0,4)]}),F.canToggleAudio=!0,F.canToggleVideo=!0,F.connectCallPromise=Promise.resolve(),F.canToggleScreenSharing=!0,F.callUsesMixer=!1,F.isEscalationInProgress=!1,F.retryOutgoingRenegotiation={retry:!1,causeId:\"\"},F.isHoldInProgress=!1,F.isMuteOnHold=!1,F.callSetupFailed=!1,F.isSomeoneSharing=!1,F.isSomeoneStreamingVideo=!1,F.activeTalkersHistory=[],F.callGotConnected=!1,F.lwjFallbackInProgress=!1,F.mediaRelayWhiteListingIssue=!1,F.signalingSessionCallOptions=null,F.tsCallingTelemetryReported=!1,F.isCallSetupTelemetrySent=!1,F._isAudioStreamConnected=!1,F._wasAudioStreamConnected=!1,F._callInLobby=!1,F._callIsSetupComplete=!1,F._transferState=0,F._parkState=0,F._muteState=q.ParticipantMuteState.Unmuted,F._callCreationTime=(new Date).getTime(),F._commandUrlPresence=b.CommandUrlPresence.None,F._capabilities={canMuteOthers:!1,canUnmuteSelf:!1},F._spamRiskLevel=null,F._spamStirAttestation=null,F._disableIsMultipartyDependenceOnThreadId=!1,F._enableAddParticipantPromiseOptimization=!1,F._enableStaging=!1,F._callMode=0,F._enableMergeParticipantLegsBatchSupport=!1,F._enablePluginlessCallParticipantRaiseChangeDeferred=!1,F._shouldShareSystemSound=!1,F._publishedStatesModified=ae.None,F._participantPublishedStatesMap={},F._endpointPublishedStatesMap={},F._changedEventSkipConfig={skipParticipantsUpdatesOnCall:!0},F.startVM=function(l,d,u,p,h){return F.signalingSession.startOutgoingCall(u,p,{voicemailResourcePath:d.callVoicemailStartOptions.voicemailResourcePath,voicemailItemId:d.callVoicemailStartOptions.voicemailItemId,callToVoicemail:!0},Date.now()-h,l)},F.getSignalingSessionCallOptions=function(l){var d,u,p={suppressDialout:!l.callStartOptions.ringOthers,isPreheatOnly:1==(1&l.callStartOptions.preheatFlags),onBehalfOf:F.onBehalfOfMri,muted:1==(1&l.callStartOptions.muteFlags),invitationType:l.invitationType,participantsToNudge:l.participantsToNudge,routingFlags:l.callStartOptions&&l.callStartOptions.routingFlags,parkContext:l.parkContext,pickupCode:l.pickupCode,isLwj:F.callSettings.useLwjForAllCalls,scenario:l.callStartOptions&&l.callStartOptions.scenario,callUsesMixer:F.callUsesMixer,clientEndpointCapabilities:l.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:l.callStartOptions.clientEndpointDebugContent,isEmergency:F.isEmergency,meetingData:F.meetingData,meetingPreferences:l.meetingPreferences,alternateId:l.callStartOptions?l.callStartOptions.alternateId:null,meetingRegistrationId:l.callStartOptions?l.callStartOptions.meetingRegistrationId:\"\",additionalEndpointProperties:(null===(d=l.callStartOptions)||void 0===d?void 0:d.additionalEndpointProperties)||null},h=null===(u=l.callStartOptions)||void 0===u?void 0:u.invitationDataJson;if(h)try{p.invitationData=JSON.parse(h)}catch(l){throw new Error(\"Invalid JSON in invitationData: \".concat(h))}return p},F.startOutgoingCall=function(l,d,u,p,h){return F.signalingSession.startOutgoingCall(u,p,F.getSignalingSessionCallOptions(d),Date.now()-h,l)},F.joinGivenConversation=function(l,d,u,p,h,g){var f,m,v=1==(1&d.callStartOptions.muteFlags),y=1==(1&d.callStartOptions.preheatFlags),S=F.callSettings.useLwjForAllCalls,_=null===(f=d.callStartOptions)||void 0===f?void 0:f.sharedLineCallInvitationContentJson;F.logger.info(\"[\".concat(l,\"][joinGivenConversation] muted=\").concat(v,\", isLwj=\").concat(S,\", isPreheatOnly=\").concat(y,\", sharedLineCallInvitationContentJson=\").concat(_));var C={muted:v,isLwj:S,isPreheatOnly:y,clientEndpointCapabilities:d.callStartOptions.clientEndpointCapabilities,clientEndpointDebugContent:d.callStartOptions.clientEndpointDebugContent,isEmergency:F.isEmergency,meetingData:F.meetingData,meetingPreferences:d.meetingPreferences,meetingRegistrationId:d.callStartOptions?d.callStartOptions.meetingRegistrationId:\"\",additionalEndpointProperties:null===(m=null==d?void 0:d.callStartOptions)||void 0===m?void 0:m.additionalEndpointProperties,applyServerMute:null==d?void 0:d.applyServerMute};if(_)try{C.sharedLineCallInvitationContent=JSON.parse(_)}catch(l){throw new Error(\"Invalid JSON in sharedLineCallInvitationContent: \".concat(_))}return F.signalingSession.joinGivenConversation(g,F.callId,u,p,Date.now()-h,C,l)},F.executeCallTransfer=function(l,d,u,p){F._setTransferState(1);var h=F._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,d,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]});return 0===u?F.signalingSession.transferCallAsync(l,\"TransferTypeStandard\",void 0,p,d):2===u&&F.signalingSession.transferCallAsync(l,\"TransferTypeVoicemail\",void 0,p,d),h},F.executeConsultCallTransfer=function(l,d,u,p,h){F._setTransferState(1);var g=F._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,p,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]});return F.signalingSession.consultTransferCallAsync(l,d,u,p,h),g},F._getCallEndOperation=function(){return F._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.STOP_CALL)?F._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.STOP_CALL):F._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.REJECT)?F._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.REJECT):F._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.CALL_REDIRECT)?F._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.CALL_REDIRECT):Promise.resolve()},F._onAcknowledgeError=function(l,d,u,p){u.logFailure(l);var h,g={code:2,success:!1,fatal:!0},f=7;throw(0,B.isPhaseError)(q.CallAckSignalingPhase.SendAttach,l)&&(h={code:q.jsCallEndCodes.InternalServerError,subCode:q.jsCallEndSubCodes.AttachFailed,phrase:q.jsCallEndPhrase.AttachFailed}),(0,B.isPhaseError)(q.CallAckSignalingPhase.ProcessIncomingCallRequest,l)&&(h={code:q.jsCallEndCodes.NotAcceptable,subCode:q.jsCallEndSubCodes.AttachActionFailed,phrase:q.jsCallEndPhrase.BadNotificationPayload},g={code:0,success:!1,fatal:!0}),(0,B.isOneOfPhaseErrors)(q.CallAckMediaPhase,l)&&(f=47),l&&l.error&&l.error.type===F.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer&&(h={code:q.jsCallEndCodes.MediaError,subCode:q.jsCallEndSubCodes.MediaOfferProcessingError,phrase:q.jsCallEndPhrase.IncompatibleOffer}),F.callTelemetry.updateOperationData(A.CALL_OPERATIONS.ACKNOWLEDGE,{phases:p,error:(0,D.getPIISafeObject)(l)},d),F._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS.ACKNOWLEDGE,g,void 0,d),F.stopInternal({rejectReason:h,causeId:d,terminatedReason:f}),g},F._onAcknowledgeSuccess=function(l,d,u){return l.logSuccess(\"success\"),F.callTelemetry.updateOperationData(A.CALL_OPERATIONS.ACKNOWLEDGE,{phases:d},u),{code:1,success:!0}},F._processOfferedModalities=function(l,d){F.handleOfferedModalities(l,d);var u=F.callUsesMixer?void 0:{modalityOverride:l};return F.updateMediaModalities(u,d)},F._handleOfferProcessingError=function(l,d,u){return u.logFailure(\"handleOfferProcessingError=\".concat(l)),l&&l.error&&l.error.type===F.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer?(F.callTelemetry.recordEvent(A.MEDIA_EVENT.INCOMPATIBLE_OFFER,void 0,d),F.signalingSession.supportsNewOfferRequest()?(F.newOfferRequestDeferred=I.defer(),F.attachToCallAndGetOffer.promise.then((function(){return F.mediaSession.rejectNegotiationAsync(l,d)})).then((function(){return F.signalingSession.requestNewOffer(F.mediaSession.getAcceptedTypes(),d)})).then((function(){return F.newOfferRequestDeferred.promise})).then((function(l){return F.mediaSession.processOfferAsync(l,d)})).catch((function(l){return F.callTelemetry.recordEvent(A.MEDIA_EVENT.NEW_OFFER_FAILED,(0,D.getPrintableObject)(l),d),Promise.reject(l)}))):Promise.reject(l)):Promise.reject(l)},F._trySendProvisionalMediaAnswer=function(l){return Promise.resolve(void 0).then((function(){return F.mediaSession.createAnswerAsync(!0,l)})).then((function(l){return l.blob?(F.mediaAcknowledgmentOperation=F._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,void 0,(0,P.generateCauseId)(),{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),F.signalingSession.setProvisionalAnswerAsync(l).then((function(){return F.mediaAcknowledgmentOperation}))):Promise.resolve(void 0)}))},F.checkForCallIdUpdate=function(l,d){if(F.callId!==l){F.logger.info(\"[\".concat(d,\"][checkForCallIdUpdate] old=\").concat(F.callId,\", new=\").concat(l)),F.setCallId(l);try{F.event(\"callIdChanged\").raise(F.callId)}catch(l){F.logger.error(\"Error raising call ID change: \".concat(l))}F.raiseChanged()}},F.handleRemoteParticipantStateInOneToOneCall=function(l){if(!F.callUsesMixer&&3===F.state){var d=F.participants[0];d&&d.setState(3,void 0,l)}},F.handleRemoteParticipantJoinedInOneToOneCall=function(l,d){if(!F.callUsesMixer&&3===F.state){var u=F.participants.filter((function(d){return d.id===l.id}))[0];u?u.setState(3,void 0,d):F.logger.logFailure(\"[\".concat(d,\"][handleRemoteParticipantJoinedInOneToOneCall]unable to find particpant \").concat(V.scrubMriOrOmit(l.id)))}},F.handleRemoteParticipantStateInObservingCall=function(l,d,u){var p=d.isLobby;if(8===F.state){var h=p?7:3;l.setState(h,void 0,u)}},F.getTelemetryFromPhaseExecution=function(l){var d={phase:l.phase,phases:l.phases,code:l.error&&l.error.code,subCode:l.error&&l.error.subCode,message:l.error&&l.error.message,error:l.error};return(d.code||d.message)&&delete d.error,d},F._setTransferState=function(l){F.transferState!==l&&(F.logger.info(\"Transfer: state set: \".concat(l)),F._transferState=l,F.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_TRANSFER_STATE,{state:l}),F.raiseChanged())},F._setParkState=function(l){F.parkState!==l&&(F.logger.info(\"Parking: state set: \".concat(l)),F._parkState=l,F.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_PARK_STATE,{state:l}),F.raiseChanged())},F.prepareNegotiationResultForTelemtry=function(l){return{isComplete:l.isComplete,activeModalities:l.activeModalities,configuredModalities:l.configuredModalities,initiator:V.scrubMriOrOmit(l.initiator),attemptedModalities:l.attemptedModalities,offeredModalities:l.offeredModalities}},F.prepareTelemetryForOfferAnswer=function(l){return l&&l.mediaContent&&{isRenegotiation:!!l.renegotiation,isEscalation:!!l.mediaContent.isTwoPartyToMultiPartyEscalation,mediaTypes:l.mediaTypes,newOffer:l.mediaContent.newOffer}},F.updateLocalParticipantEndpoints=function(l){var d=[];E.each(l,(function(l){var u=W.convertSignalingEndpointDetails(l,F.getSelfClientEndpointCapabilities());d.push(u)})),F.endpoints.endpointDetails=d;var u=E.find(d,(function(l){return F.participantId===l.participantId})),p=u&&u.lwjSessionInformation;p!==F.lwjInfo&&(F.lwjInfo=p,F.event(\"lwjChanged\").raise(p),F.logger.info(\"lwjChanged: \".concat(JSON.stringify(F.lwjInfo))),p&&F.lwjFallbackInProgress&&(F.logger.info(\"LWJ fallback success\"),F.callTelemetry.recordOperationSuccess(A.CALL_OPERATIONS.LWJ_FALLBACK),F.lwjFallbackInProgress=!1));var h=F.getDataChannelSourceId();-1!==h&&F.dataChannel&&F.dataChannel.setDataChannelSourceId(h)},F.handleParticipantsMutedUpdated=function(l){var d,u;if(void 0!==l&&void 0!==l.muteUnmuteResponse){F.logger.info(\"handleParticipantsMutedUpdated: number of infos: \".concat(l.muteUnmuteResponse.length));try{for(var p=S(Object.keys(l.muteUnmuteResponse)),h=p.next();!h.done;h=p.next()){var g=h.value,f=F.getParticipant(g);f&&f.handleServerMutedInfoUpdate(l.muteUnmuteResponse[g])}}catch(l){d={error:l}}finally{try{h&&!h.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}}},F.handleSelfUnmuteUpdatedInfo=function(l,d){var u,p;if(void 0!==l&&void 0!==l.muteUnmuteResponse){F.logger.info(\"handleSelfUnmuteUpdatedInfo\");var _loop_1=function(u){var p=l.muteUnmuteResponse[u];if(u===F.localSignalingParticipant.id){var h=E.find(p,(function(l){return l.participantId===F.localSignalingParticipant.participantId}));if(void 0===h)return\"continue\";var g=E.find(F.localSignalingParticipant.endpointDetails,(function(l){return l.participantId===h.participantId}));K.handleMuteUnmuteParticipantInfo(F.logger,g,h,!1)&&F.handleSelfServerMutedState(d)}};try{for(var h=S(Object.keys(l.muteUnmuteResponse)),g=h.next();!g.done;g=h.next()){_loop_1(g.value)}}catch(l){u={error:l}}finally{try{g&&!g.done&&(p=h.return)&&p.call(h)}finally{if(u)throw u.error}}}},F.state=0,F.terminatedReason=0,F.callStats=new G.CallTelemetryBuilder,F.callTelemetry=new R.CallTelemetry(F.logger,F._callCreationTime),F.collectMediaStatsDeferred=I.defer(),F.setCallId(y),F.setGroupId(m),F.setThreadId(v),F.setMessageId(w),F.setSkypeId(F.currentUserSkypeIdentity.id),F.setParticipantId(_),F.setCallOrigin(0),F.logger=F.logger.createChild((function(){var l=(F.endpointId||\"\").substr(0,8),d=(F.participantId||\"\").substr(0,8);return\"Web[\".concat(F.callId,\"][\").concat(l,\"][\").concat(d,\"][\").concat(F.state,\"]\")})),F.initializeSignalingSession(_),F.initializeImageRenderingSession(O),F.signalingSession.setLocationInfo(N,L,x),F.streamManager=new Y.PluginlessCallStreamManager(F.participantId,null,F.callStats.localStats,F.logger,F.imageRenderingSession,F.mediaAgent.getConfigProvider()),F.mediaAgent&&(F.dataChannel=new X.PluginlessDataChannel(F.logger,F.mediaAgent.getConfigProvider()),F.dataChannel.on(\"remoteUserEventsReceived\",(function(l,d){return F.event(\"remoteUserEventsReceived\").raise(l,d)})),F.dataChannel.on(\"onDataChannelStateUpdated\",(function(l){\"Failed\"===l&&(F.logger.error(\"onDataChannelStateUpdated: datachannel creation failed, will remove data modality\"),F.mediaStateConfigurationHelper.removeModality(3),F.updateMediaModalities())})),F.screenSharingControl=new Z.PluginlessScreenSharingControl(F.logger,F.dataChannel,F,F.telemetryLoggers),F.initializeMediaControlPlane());var j={enableErrorConversion:F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"enableErrorConversion\"),enableOperationIdempotency:F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"enableOperationIdempotency\")};return F.logger.info(\"operationHandlerEcsConfig: \".concat(JSON.stringify(j))),F._enableStaging=F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"enableStaging\"),F.logger.info(\"enableStaging is: \".concat(F._enableStaging)),F._disableIsMultipartyDependenceOnThreadId=F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"disableIsMultipartyDependenceOnThreadId\"),F._preferredMpLocation=F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"preferredMpLocation\"),F._enablePluginlessCallParticipantRaiseChangeDeferred=F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"enablePluginlessCallParticipantRaiseChangeDeferred\"),F.logger.info(\"disableIsMultipartyDependenceOnThreadId is: \".concat(F._disableIsMultipartyDependenceOnThreadId)),F._callOperationHandler=new U.default(F.logger,F.callTelemetry,j,void 0,(function(l,d){F.preconditions(l,d)})),F._participantOperationHandler=new U.default(F.logger,F.callTelemetry,j),F.meetingData=k,F._enableAddParticipantPromiseOptimization=F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"enableAddParticipantPromiseOptimization\"),F.logger.info(\"enableAddParticipantPromiseOptimization is: \".concat(F._enableAddParticipantPromiseOptimization)),F._enableMergeParticipantLegsBatchSupport=F.ecsProvider.getEcsConfig(\"SkypeCalling\",\"enableMergeParticipantLegsBatchSupport\"),F}return p(PluginlessCall,l),Object.defineProperty(PluginlessCall.prototype,\"callMode\",{get:function(){return this._callMode},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"callId\",{get:function(){return this._callId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"endpointId\",{get:function(){return this._endpointId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"isHostless\",{get:function(){return this.signalingSession.isHostLessCall},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"transferState\",{get:function(){return this._transferState},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"parkState\",{get:function(){return this._parkState},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"capabilities\",{get:function(){return this._capabilities},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"publishedStates\",{get:function(){return this._publishedStates},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"dataChannelAdapter\",{get:function(){return this.dataChannel},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"participantId\",{get:function(){try{var l=this.signalingSession&&this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&this.signalingSession.participantManager.localParticipant.participantId;this._participantId=l||this._participantId}catch(l){this.logger.error(\"Error updating participantId\")}return this._participantId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"role\",{get:function(){return this.localSignalingParticipant.role},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"meetingRole\",{get:function(){return this.localSignalingParticipant.meetingRole},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"advancedMeetingRole\",{get:function(){return this.localSignalingParticipant.advancedMeetingRole},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"isMuted\",{get:function(){return this._muteState===q.ParticipantMuteState.Muted||this._muteState===q.ParticipantMuteState.AttemptingUnmute},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"tenantId\",{get:function(){return this.localSignalingParticipant.tenantId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"mediaLegId\",{get:function(){return this._mediaLegId},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"isIncomingOneOnOneVideoCall\",{get:function(){return this.isOneToOneCall()&&this.isSomeoneStreamingVideo},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"mediaStreams\",{get:function(){return this.streamManager.streams},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"origin\",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"isAudioStreamConnected\",{get:function(){return this._isAudioStreamConnected},set:function(l){this._isAudioStreamConnected!==l&&(this._isAudioStreamConnected=l,this._wasAudioStreamConnected=this._wasAudioStreamConnected||l,this.raiseChanged())},enumerable:!1,configurable:!0}),PluginlessCall.prototype.setMeetingRole=function(l){l!==this.localSignalingParticipant.meetingRole&&(this.logger.info(\"changing self role to [\".concat(l,\"]\")),this.localSignalingParticipant.meetingRole=l,this.event(\"meetingRoleUpdated\").raise(l))},PluginlessCall.prototype.setAdvancedMeetingRole=function(l){l!==this.localSignalingParticipant.advancedMeetingRole&&(this.logger.info(\"changing self advanced meeting role to [\".concat(l,\"]\")),this.localSignalingParticipant.advancedMeetingRole=l,this.event(\"advancedMeetingRoleUpdated\").raise(l))},Object.defineProperty(PluginlessCall.prototype,\"spamRiskLevel\",{get:function(){return this._spamRiskLevel},set:function(l){l&&(this._spamRiskLevel=l)},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"spamStirAttestation\",{get:function(){return this._spamStirAttestation},set:function(l){l&&(this._spamStirAttestation=l)},enumerable:!1,configurable:!0}),PluginlessCall.prototype.getScreenHandle=function(){if(!this.sharedScreenHandle){var l=!!this.mediaSession&&this.mediaSession.getSessionConfig().mediaConfig.simulcastSessionEnabled,d=!this.mediaSession||!this.mediaSession.getSessionConfig().config.requireUserActionForAudioSharing||this._shouldShareSystemSound,u=!!this.mediaSession&&this.mediaSession.getSessionConfig().config.enableAudioSharing&&d,p=this.mediaStateConfigurationHelper.isSending(0)&&u&&l;this.sharedScreenHandle=this.mediaAgent.getDeviceManager().createDevicesHandle({audio:p,sharing:!0},\"pluginlessCall:getScreenHandle()\"),this.subscribeOnSharedScreenHandleEvents(this.sharedScreenHandle)}return this.sharedScreenHandle},PluginlessCall.prototype.setCallOrigin=function(l){this.logger.info(\"Set call origin to \".concat(l)),this._origin=l,this.callTelemetry.setCallOrigin(l),this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_CALL_ORIGIN,{origin:l})},PluginlessCall.prototype.setMediaLegId=function(l){this._mediaLegId=l,this.callStats.setMediaLegId(l)},PluginlessCall.prototype.setCallId=function(l){this.callTelemetry.setCallId(l),this.callStats.setCallId(l),this._callId=l},PluginlessCall.prototype.setEndpointId=function(l){this._endpointId=l,this.logger.info(\"[endpointId=\".concat((0,D.truncate)(this._endpointId,8),\"]\")),this.callTelemetry.setEndpointId(l),this.callStats.setEndpointId(l)},PluginlessCall.prototype.setFailureType=function(l){this.callTelemetry.setFailureType(l),this.failureType=l},PluginlessCall.prototype.setParticipantId=function(l){this._participantId=l,this.logger.info(\"[participantId=\".concat(this._participantId,\"]\")),this.callTelemetry.setParticipantId(this.participantId)},PluginlessCall.prototype.setCallerMri=function(l){this.callerMri=l,this.logger.info(\"[callerMri=\".concat(V.scrubMriOrOmit(this.callerMri),\"]\"))},PluginlessCall.prototype.setTransferorMri=function(l){var d=(0,k.stripMriAliases)(l);d!==this.transferorMri&&(this.transferorMri=d,this.logger.info(\"transferorMri: \".concat(V.scrubMriOrOmit(this.transferorMri))),this.raiseChanged())},PluginlessCall.prototype.setGroupId=function(l,d){void 0===d&&(d=(0,P.generateCauseId)()),this.logger.info(\"[\".concat(d,\"][setGroupId] groupId=\").concat(V.scrubMriOrOmit(l))),this.groupId!==l&&(this.groupId=l,this.callTelemetry.setGroupId(l),this.event(\"groupIdChanged\").raise(l))},PluginlessCall.prototype.setThreadId=function(l,d){void 0===d&&(d=(0,P.generateCauseId)()),this.threadId!==l&&(this.logger.info(\"[\".concat(d,\"][setThreadId] threadId=\").concat(V.getLoggableThreadId(l))),this.threadId=l,this.callTelemetry.setThreadId(l))},PluginlessCall.prototype.setMessageId=function(l,d){void 0===d&&(d=(0,P.generateCauseId)()),this.messageId!==l&&(this.logger.info(\"[\".concat(d,\"][setMessageId] messageId=\").concat(V.scrubMriOrOmit(l))),this.messageId=l,this.callTelemetry.setMesageId(l))},PluginlessCall.prototype.setSkypeId=function(l,d){void 0===d&&(d=(0,P.generateCauseId)()),this.skypeId!==l&&(this.logger.info(\"[\".concat(d,\"][setSkypeId]\")),this.skypeId=l,this.callTelemetry.setSkypeId(l))},PluginlessCall.prototype.setCallType=function(l,d){var u=this.logger.createFnLogger(\"setCallType\",d);u.info(\"current=\".concat(this.callType,\", newValue: \").concat(l)),2!==this.callType||1!==l?l!==this.callType&&(this.callType=l,this.callTelemetry.setCallType(l),2===l&&this.callStats.localStats.call.event(G.CallEvent.MultiPartyModeSet),this.raiseChanged()):u.logFailure(\"De-escalating to P2P should not happen!\")},PluginlessCall.prototype.setConversationType=function(l,d){this.logger.createFnLogger(\"setConversationType\",d).info(\"current=\".concat(this.conversationType,\", newValue=\").concat(l)),l!==this.conversationType&&(this.conversationType=l,this.callTelemetry.setConversationType(l),this.raiseChanged())},PluginlessCall.prototype.setCallUsesMixer=function(l,d){this.callUsesMixer!==!!l&&(this.logger.info(\"[\".concat(d,\"][setCallUsesMixer] new value=\").concat(l)),this.callUsesMixer=l,this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.CALL_USES_MIXER,{newValue:l},d),this.dataChannel.setMultiparty(l)),l&&this.mediaControlPlane.start()},PluginlessCall.prototype.setIsEscalationInProgress=function(l,d){this.logger.info(\"[\".concat(d,\"][setIsEscalationInProgress] currentValue=\").concat(this.isEscalationInProgress,\", newValue=\").concat(l)),this.isEscalationInProgress=l,this.allowScreenSharingControl()&&this.screenSharingControl.setIsEscalationInProgress(l),this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.ESCALATION_IN_PROGRESS,void 0,d)},PluginlessCall.prototype.processCallStartOptions=function(l,d){var u=this.logger.createFnLogger(A.CALL_OPERATIONS_INTERNAL.PROCESS_CALL_START_OPTIONS,d);try{1&l.preheatFlags&&(this.isPreheatEnabled=!0)}catch(l){u.logFailure(l)}},PluginlessCall.prototype.getlocalScreenShareStream=function(){return E.find(this.localMediaStreams,(function(l){return 2===l.mediaType}))},PluginlessCall.prototype.updateDisplayName=function(l){this.logger.info(\"updating displayName\"),this.localSignalingParticipant.displayName=l,this.signalingSession.participantManager.localParticipant.displayName=l},PluginlessCall.prototype.init=function(l){if(this.logger.info(\"init callInitOptions:\".concat((0,D.safeJsonStringify)((0,D.getPIISafeCallInitOptions)(l)))),this.signalingSessionCallOptions={teamsMessageId:l.messageId,enableGroupCallMeetupGeneration:l.enableGroupCallMeetupGeneration,meetingInfo:l.meetingInfo,emergencyContent:l.emergencyContent?JSON.parse(l.emergencyContent):void 0,broadcastContext:l.broadcastContext,endpointMetadata:l.endpointMetadata},this.setMessageId(l.messageId),this.onBehalfOfMri=l.onBehalfOf,l.threadId&&(this.setThreadId(l.threadId),this.signalingSession.setThreadId(l.threadId)),this.groupId&&this.signalingSession.setGroupId(this.groupId),this.signalingSession.setCallOptions(this.signalingSessionCallOptions),l.transferContext){switch(this.logger.info(\"Transfer: Call.init, set transferContext\",J.scrubITransferContext(l.transferContext)),this.signalingSession.setTransferContext(l.transferContext.context),l.transferContext.transferType){case 1:this.setCallOrigin(2);break;case 0:this.setCallOrigin(1);break;case 2:this.setCallOrigin(3);break;default:throw new Error(\"TransferType: \".concat(l.transferContext.transferType,\" doesn't have a switch option\"))}l.transferContext.context.callAcceptanceCallback?this._transferredCallAcceptanceCallback=l.transferContext.context.callAcceptanceCallback:this.logger.info(\"[failed]Transfer: Missing transferred call acceptance callback\"),l.transferContext.transferorMri&&this.setTransferorMri(l.transferContext.transferorMri)}this.setIsEmergency(!!l.isEmergency),this.raiseChanged()},PluginlessCall.prototype.getRawOutputAudioStreamTrack=function(){var l;if(!this.mediaSession)throw this.logger.error(\"can not execute getRawOutputAudioStreamTrack as there is no mediaSession\"),new Error(\"NoMediaSession\");return null===(l=this.mediaSession.getRawOutputAudioStream())||void 0===l?void 0:l.getAudioTracks()[0]},PluginlessCall.prototype.setRawInputAudioStreamTrack=function(l){if(!this.mediaSession)throw this.logger.error(\"can not execute setRawInputAudioStreamTrack as there is no mediaSession\"),new Error(\"NoMediaSession\");if(!l)throw this.logger.error(\"Could not set streamTrack to input audio stream, falsy stream track - \".concat(l)),new Error(\"InvalidStreamTrack\");return this.mediaSession.setRawInputAudioStreamTrack(l)},PluginlessCall.prototype.unsetRawInputAudioStreamTrack=function(){if(!this.mediaSession)throw this.logger.error(\"can not execute unsetRawInputAudioStreamTrack as there is no mediaSession\"),new Error(\"NoMediaSession\");return this.mediaSession.setRawInputAudioStreamTrack(null)},PluginlessCall.prototype.setDeviceManager=function(l){},PluginlessCall.prototype.startVideo=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(l){return[2,this.startStopVideo(!0,d)]}))}))},PluginlessCall.prototype.stopVideo=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(l){return[2,this.startStopVideo(!1,d)]}))}))},PluginlessCall.prototype.dumpVideoSourceImages=function(){return v(this,void 0,void 0,(function(){return y(this,(function(l){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.hold=function(l,d,u){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p;return y(this,(function(h){return(p=this.logger.createFnLogger(A.CALL_OPERATIONS.HOLD,d)).info(\"[\".concat(A.CALL_OPERATIONS.HOLD,\"][\").concat(d,\"] negotiationTag \").concat(l,\" hold options: \").concat((0,D.safeJsonStringify)(u))),this.isJoinedLightweight()?(p.logFailure(\"Can not put lightweight call on hold\"),[2,Promise.reject(60)]):4===this.state?(p.logFailure(\"Trying to put a call on hold which is already held state, early resolving the promise\"),[2,Promise.resolve(void 0)]):[2,u&&u.isLocal?this.localHold(d,u):this.holdWithRenegotiate(d,u)]}))}))},PluginlessCall.prototype.holdWithRenegotiate=function(l,d){return v(this,void 0,void 0,(function(){return y(this,(function(u){return this.isValidHoldResumeCallState(this.state)?[2,this.setHold(!0,l,d)]:(this.logger.logFailure(\"[\".concat(A.CALL_OPERATIONS.HOLD,\"][\").concat(l,\"] Trying to hold a call in an invalid state: \").concat(this.state)),[2,Promise.reject(\"Trying to hold a call in an invalid state: \".concat(this.state))])}))}))},PluginlessCall.prototype.localHold=function(l,d){return v(this,void 0,void 0,(function(){return y(this,(function(u){return this.isValidHoldResumeCallState(this.state)?[2,this.setHold(!0,l,d)]:(this.logger.logFailure(\"[\".concat(A.CALL_OPERATIONS.LOCAL_HOLD,\"][\").concat(l,\"] Trying to hold a call in an invalid state: \").concat(this.state)),[2,Promise.reject(\"Trying to hold a call in an invalid state: \".concat(this.state))])}))}))},PluginlessCall.prototype.unhold=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var l;return y(this,(function(u){return l=this.logger.createFnLogger(A.CALL_OPERATIONS.UNHOLD,d),3===this.state?(l.logFailure(\"Trying to resume a call which is already in connected state, early resolving the promise\"),[2,Promise.resolve(void 0)]):4===this.state?(l.info(\"current hold state \".concat(this.requestedHoldState)),[2,this.setHold(!1,d)]):(l.logFailure(\"Trying to resume a call in an invalid state: \".concat(this.state)),[2,Promise.reject(\"Trying to resume a call in an invalid state: \".concat(this.state))])}))}))},PluginlessCall.prototype.canMerge=function(l,d){var u=l.isOneToOneCall(),p=3===this.state,h=4===l.state,g=u&&p&&h;return this.logger.info(\"[\".concat(d,\"][canMerge] Call \").concat(l.callId,\" isOneToOne \").concat(u)+\" isCallConnected \".concat(p,\" call.state \").concat(this.state)+\" isMergeOnHold \".concat(h,\" mergeCall.state \").concat(l.state,\" CanMerge result: \").concat(g)),g},PluginlessCall.prototype.updateEndpointMetadata=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(u){return[2,this.signalingSession.updateEndpointMetadata(l,d)]}))}))},PluginlessCall.prototype.sendDtmfTone=function(l){return v(this,void 0,void 0,(function(){var d;return y(this,(function(u){return this.mediaSession?(d=this.toneToString(l))?(this.logger.info(\"[\".concat(F.causeId,\"][sendDtmfTone]DtmfTone: <omitted>\")),[2,Promise.resolve(this.mediaSession.sendDtmf(d))]):[2,Promise.reject(new Error(\"Unsupported DtmfTone\"))]:[2,Promise.reject(new Error(\"no mediaSession\"))]}))}))},PluginlessCall.prototype.setAudioUsageMode=function(l){return v(this,void 0,void 0,(function(){return y(this,(function(l){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.setAudioMidcallConfig=function(l,d){return v(this,void 0,void 0,(function(){return y(this,(function(l){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.setAudioMidcallConfigJson=function(l){return v(this,void 0,void 0,(function(){var d,u;return y(this,(function(p){if(!l||!l.noiseSuppressionMode)return[2,Promise.reject(60)];switch(d=0,String(l.noiseSuppressionMode)){case\"Auto\":\"Off\"!==(u=this.mediaSession.getSessionConfig().config.wasmdns.noiseSuppressionMode)&&(d=\"High\"===u?1:2);break;case\"High\":d=1;break;case\"Low\":d=2}return[2,this.mediaAgent.getDeviceManager().audioEffectManager.setEffectAsync(d)]}))}))},PluginlessCall.prototype.setInitialTelemetry=function(l,d,u,p){var h,g,f,m=!1;switch(l){case A.CALL_OPERATIONS.SUBSCRIBE:case A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA:this.callTelemetry.setDirection(R.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(R.SELF_PARTICIPANT_ROLE.SUBSCRIBE),u||this.callTelemetry.setOperationVariant(l,A.OPERATION_VARIANTS.CCWM),this.signalingSession.setInitialTelemetry(l,{correlationId:this.callId,causeId:p,conversationServiceUrl:u});break;case A.CALL_OPERATIONS.ACKNOWLEDGE:0!==this.state&&8!==this.state&&this.callTelemetry.maybeRecordOperationSuccess(l,{code:4}),this.callTelemetry.setDirection(R.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(R.SELF_PARTICIPANT_ROLE.CALLEE),this.signalingSession.setInitialTelemetry(l,{causeId:p});break;case A.CALL_OPERATIONS.JOIN_CALL:case A.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA:this.callTelemetry.setDirection(R.DIRECTION.INCOMING),this.callTelemetry.setSelfParticipantRole(R.SELF_PARTICIPANT_ROLE.JOIN),this.callSettings.useLwjForAllCalls?this.callTelemetry.setOperationVariant(l,A.OPERATION_VARIANTS.LWJ):1&d.callStartOptions.preheatFlags&&this.callTelemetry.setOperationVariant(l,A.OPERATION_VARIANTS.PREHEAT),(h=this.telemetryDataFromCallStartOptions(d.callStartOptions))&&this.callTelemetry.updateOperationData(l,h,p),g={muted:1==(1&d.callStartOptions.muteFlags),isPreheatOnly:1==(1&d.callStartOptions.preheatFlags),isLwj:m=this.callSettings.useLwjForAllCalls},this.signalingSession.setInitialTelemetry(l,{correlationId:this.callId,causeId:p,conversationServiceUrl:u,joinCallOptions:g,offerGenerationTime:Date.now()-d.callStartTime});break;case A.CALL_OPERATIONS.START_CALL:case A.CALL_OPERATIONS.START_WITH_MEETING_DATA:this.callTelemetry.setDirection(R.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(R.SELF_PARTICIPANT_ROLE.CALLER),this.callSettings.useLwjForAllCalls||this.lwjFallbackInProgress?(m=!0,this.callTelemetry.setOperationVariant(l,A.OPERATION_VARIANTS.LWJ)):1&d.callStartOptions.preheatFlags&&this.callTelemetry.setOperationVariant(l,A.OPERATION_VARIANTS.PREHEAT),(h=this.telemetryDataFromCallStartOptions(d.callStartOptions))&&this.callTelemetry.updateOperationData(l,h,p),(f=d.callStartOptions).isLwj=m,this.signalingSession.setInitialTelemetry(l,{correlationId:this.callId,causeId:p,conversationServiceUrl:u,callStartOptions:f,offerGenerationTime:Date.now()-d.callStartTime});break;case A.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL:case A.CALL_OPERATIONS.START_CALL_WITH_NUDGE:case A.CALL_OPERATIONS.START_CALL_AND_UNPARK:this.callTelemetry.setDirection(R.DIRECTION.OUTGOING),this.callTelemetry.setSelfParticipantRole(R.SELF_PARTICIPANT_ROLE.CALLER),this.signalingSession.setInitialTelemetry(l,{correlationId:this.callId,causeId:p,conversationServiceUrl:u,startCallOptions:d.callStartOptions,offerGenerationTime:Date.now()-d.callStartTime})}},PluginlessCall.prototype.setHold=function(l,d,u){var p;return v(this,void 0,void 0,(function(){var h,g,f,m,v,S,_=this;return y(this,(function(y){switch(y.label){case 0:if(h=this.logger.createFnLogger(\"setHold\",d,\"hold=\".concat(l)),!this.canToggleAudio||this.callHoldResumeDeferred)return[2,Promise.reject(new Error(\"can not set hold as it is already in progress\"))];this.callHoldResumeDeferred=I.defer(),this.isHoldInProgress=l,this.canToggleAudio=!1,this.canToggleVideo=!1,this.canToggleScreenSharing=!1,this.requestedHoldState=l,g=function(){_.canToggleAudio=!0,_.canToggleScreenSharing=!0,_.canToggleVideo=!0},h.info(\"start, holdOptions: \".concat(JSON.stringify(u))),f=this.callHoldResumeDeferred.promise,y.label=1;case 1:return y.trys.push([1,4,,5]),l?this.isMuteOnHold=u&&u.isLocal&&5!==this.state:this.prepareModalitiesForResume(d),this.isMuteOnHold?[3,3]:[4,this.updateMediaModalities(void 0,d)];case 2:m=y.sent(),this.updateMediaState(m,d),this.updateScreenSharingState(m,d),y.label=3;case 3:return l&&(this.prepareModalitiesForHold(d),5===this.state&&this.finishCallHoldResume(),this.setCallState(4,d)),this.isMuteOnHold&&this.setMuteOnHold(l,d),g(),[3,5];case 4:return v=y.sent(),S=l?A.CALL_OPERATIONS.HOLD:A.CALL_OPERATIONS.UNHOLD,this.callTelemetry.updateOperationData(S,{error:(0,D.getPIISafeObject)(v)},d),h.logFailure(v),g(),null===(p=this.callHoldResumeDeferred)||void 0===p||p.reject(new Error(\"Failed setting hold state to \".concat(l))),this.callHoldResumeDeferred=null,[3,5];case 5:return[2,f]}}))}))},PluginlessCall.prototype.transferCall=function(l){return this.logger.warn(\"transferCall is deprecated, please use callBlindTransfer instead\"),this.callBlindTransfer(l)},PluginlessCall.prototype.callBlindTransfer=function(l,d,u){return void 0===d&&(d=(0,P.generateCauseId)()),this.executeCallTransfer(l,d,0,u)},PluginlessCall.prototype.callSafeTransfer=function(l,d,u){return void 0===d&&(d=(0,P.generateCauseId)()),this.executeCallTransfer(l,d,0,u)},PluginlessCall.prototype.transferCallToVoicemail=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),this.executeCallTransfer(l.transferTargetMri,d,2,void 0)},PluginlessCall.prototype.callConsultativeTransfer=function(l,d,u,p){void 0===d&&(d=(0,P.generateCauseId)());var h=this.logger.createFnLogger(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,d),g=l.participants[0],f=g&&g.acceptedBy||g&&g.id;return h.info(\"transferTargetParticipantLegId: \".concat(u,\" targetMri: \").concat(V.scrubMriOrOmit(f))),this.executeConsultCallTransfer(l.callId,f,u,d,p)},PluginlessCall.prototype.consultativeTransferWithPickupCode=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h,g,f;return y(this,(function(m){return(u=this.logger.createFnLogger(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,d)).info(\"pickup code: \".concat(l)),!l||isNaN(Number(l))?(u.info(\"pickup code cannot be empty\"),[2,Promise.reject((0,M.getRejectTransactionEnd)(A.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]):(p=this._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,d,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),h=\"4:\".concat(A.UNPARK_CODE.SERVER_HOLD),g={unparkContent:{pickupCode:Number(l)}},f={disableForwardingAndUnanswered:!1},this.signalingSession.transferCallAsync(h,\"TransferTypeStandard\",g,f,d),[2,p])}))}))},PluginlessCall.prototype.callRedirect=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),this.logger.createFnLogger(A.CALL_OPERATIONS.CALL_REDIRECT,d).info(\"redirectOptions: \".concat(JSON.stringify(l))),this.stopInternal({terminatedReason:75,redirectOptions:l,causeId:d}).then((function(){return{code:q.jsCallEndCodes.CallRedirected,subCode:q.jsCallEndSubCodes.CallRedirectedSuccess,phrase:q.jsCallEndPhrase.CallEndReasonRedirected,resultCategories:[q.ResultCategory.Success]}}))},PluginlessCall.prototype.convertParkContext=function(l){switch(l){case 1:return\"sharedLinePark\";case 4:return\"sharedLineParkV2\";case 0:return\"teamPark\";case 3:return\"serverHoldV2\";default:return\"serverHold\"}},PluginlessCall.prototype.park=function(l,d){var u=this;void 0===d&&(d=(0,P.generateCauseId)());var p=this.convertParkContext(l);return this.logger.info(\"[\".concat(d,\"] [\").concat(A.CALL_OPERATIONS.PARK_CALL,\"] start -  context \").concat(l,\" parkType \").concat(p)),this._pendingParkPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.PARK_CALL),\"serverHoldV2\"!==p&&this._setParkState(1),this.signalingSession.parkCallAsync(p,d).catch((function(l){u.logger.info(\"[\".concat(d,\"] [\").concat(A.CALL_OPERATIONS.PARK_CALL,\"] error in parkCallAsync (synchronous error) : \").concat((0,D.getPIISafeObject)(l),\". Hold promise will be rejected by signaling callback\")),u.callTelemetry.updateOperationData(A.CALL_OPERATIONS.PARK_CALL,{error:(0,D.getPIISafeObject)(l)},d)})),this._pendingParkPromise},PluginlessCall.prototype.unpark=function(l,d){return v(this,void 0,void 0,(function(){var u,p=this;return y(this,(function(h){return u=this.convertParkContext(l),this.logger.info(\"[\".concat(d,\"] [\").concat(A.CALL_OPERATIONS.UNPARK_CALL,\"] start -  context \").concat(l,\" parkType \").concat(u)),this._pendingUnparkPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.UNPARK_CALL),this.signalingSession.unparkAsync(u,d).catch((function(l){p.logger.info(\"[\".concat(d,\"] [\").concat(A.CALL_OPERATIONS.UNPARK_CALL,\"] error in unparkAsync (synchronous error) : \").concat((0,D.getPIISafeObject)(l),\". Unhold promise will be rejected by signaling callback\")),p.callTelemetry.updateOperationData(A.CALL_OPERATIONS.UNPARK_CALL,{error:(0,D.getPIISafeObject)(l)},d)})),[2,this._pendingUnparkPromise]}))}))},PluginlessCall.prototype.getServerHoldLocation=function(){var l=this;return this._pendingParkPromise.then((function(){return l.logger.info(\"getServerHoldLocation \".concat(l.serverHoldLocation)),l.serverHoldLocation}))},PluginlessCall.prototype.getJoinBlob=function(){return Promise.resolve(JSON.stringify({conversationUrl:this.signalingSession.getConversationUrl(),conversationId:this.callId}))},PluginlessCall.prototype.getTechnicalInformationJson=function(){return Promise.reject(60)},PluginlessCall.prototype.isOneToOneCall=function(){return 1===this.callType&&1===this.participants.length},PluginlessCall.prototype.setMuteOnHold=function(l,d){this.mediaSession.muteHold(l,d),l||(this.computeCallState(d),this.isMuteOnHold=!1),this.finishCallHoldResume()},PluginlessCall.prototype.finishCallHoldResume=function(l){var d,u;l?null===(d=this.callHoldResumeDeferred)||void 0===d||d.reject(l):null===(u=this.callHoldResumeDeferred)||void 0===u||u.resolve(),this.isHoldInProgress=!1,this.callHoldResumeDeferred=null},PluginlessCall.prototype.computeCallState=function(l){var d=3;this._callInLobby?d=10:this.signalingSession.participantManager.localParticipant.isStaging&&this._enableStaging&&(d=13),this.logger.info(\"[\".concat(l,\"][computeCallState] the call state will be set to \").concat(d)),this.setCallState(d,l)},PluginlessCall.prototype.prepareModalitiesForResume=function(l){return v(this,void 0,void 0,(function(){return y(this,(function(d){switch(d.label){case 0:return this.mediaStateConfigurationHelper.isSending(1)?[4,this.turnOnLocalVideoPreview(l)]:[3,2];case 1:d.sent(),d.label=2;case 2:return[2]}}))}))},PluginlessCall.prototype.prepareModalitiesForHold=function(l){return v(this,void 0,void 0,(function(){return y(this,(function(d){switch(d.label){case 0:return[4,this.turnOffLocalVideoPreview(l)];case 1:return d.sent(),[2]}}))}))},PluginlessCall.prototype.updateMediaState=function(l,d){this.setVideoOn(l.video===this.mediaAgent.constants.MEDIA_STATE.sendReceive||l.video===this.mediaAgent.constants.MEDIA_STATE.send,d),this.setAudioOn(l.audio===this.mediaAgent.constants.MEDIA_STATE.sendReceive||l.audio===this.mediaAgent.constants.MEDIA_STATE.send,d)},PluginlessCall.prototype.updateScreenSharingState=function(l,d){this.setScreenSharingOn(l.sharing===this.mediaAgent.constants.MEDIA_STATE.send,d)},PluginlessCall.prototype.subscribeOnSharedScreenHandleEvents=function(l){var d=this;this.sharedHandleSubs=l.on(\"onStreamStateChanged\",(function(l,u){return d.onSharingStreamStateChanged(l)}))},PluginlessCall.prototype.unsubscribeFromSharedScreenHandleEvents=function(){this.sharedHandleSubs.dispose(),this.sharedHandleSubs=null},PluginlessCall.prototype.onSharingStreamStateChanged=function(l){var d=(0,P.generateCauseId)();this.logger.info(\"[\".concat(d,\"] Sharing stream state moved to \").concat(l));var u={mediaType:2,mediaDirection:1,mediaStreamState:PluginlessCall.streamingStatetoMediaStreamState(l)};this.event(\"mediaStreamStateChanged\").raise(u),this.callStats.localStats.screenShare.streamStateChanged(l),\"stopped\"===l&&(this.canToggleScreenSharing=!0,this.stopScreenSharing(),\"screenSharingCall\"!==this.conversationType||this.participants.some((function(l){return 3===l.state}))||this.stop(!0,d))},PluginlessCall.prototype.startScreenSharing=function(l,d,u,p){return void 0===p&&(p=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var l,d,h=this;return y(this,(function(g){return this.allowScreenSharingControl()&&this.screenSharingControl.shutdownControlForViewer(),l=this.logger.createFnLogger(A.CALL_OPERATIONS.START_SCREEN_SHARING,p),this.isJoinedLightweight()?(l.logFailure(\"Can not start screen sharing in lightweight call\"),[2,Promise.reject(60)]):this.canToggleScreenSharing?this.isScreenSharingOn?(l.logSuccess(\"Resolving early because screen sharing is already on\"),[2,Promise.resolve()]):(this.screenSharingRenegotiationDeferred&&(l.logFailure(\"called before the renegotiation deferred for the previous one has been closed\"),this.screenSharingRenegotiationDeferred.resolve()),this.screenSharingRenegotiationDeferred=I.defer(),this.callStats.localStats.newSession(2),this.callStats.localStats.screenShare.start(),this.mediaStateConfigurationHelper.isDisabled(2)&&l.info(\"sharing modality was skipped till now. Adding it now\"),this.canToggleScreenSharing=!1,d=function(){h.canToggleScreenSharing=!0},this.callStats.localStats.screenShare.event(G.MediaSenderEvent.SelectSource),[2,this.getScreenHandle().acquire().then((function(){return l.logSuccess(\"sharing stream acquired\"),h.mediaStateConfigurationHelper.enableModality(2),h.updateMediaModalities(void 0,p)})).then((function(){return l.logSuccess(\"updateMediaModalities done\"),h.callStats.localStats.screenShare.negotiationStateChanged(\"started\"),h.setScreenSharingOn(!0,p),d(),h.screenSharingRenegotiationDeferred.promise})).then((function(){h.initializeScreenSharingControlForSharer(u),h.callStats.localStats.screenShare.negotiationStateChanged(\"completed\")})).catch((function(u){h.callTelemetry.updateOperationData(A.CALL_OPERATIONS.START_SCREEN_SHARING,{error:(0,D.getPIISafeObject)(u)},p),h.setScreenSharingOn(!1,p),h.mediaStateConfigurationHelper.removeModality(2),d(),h.disposeSharingScreenHandle();var g=u.error;throw g&&g.code===q.jsCallEndCodes.GlareError?(h.callStats.localStats.screenShare.negotiationStateChanged(\"rejected\",\"glare\"),l.logFailure(\"starting screen sharing failure with reason glare\")):\"ScreenSharingStopped\"===u.reason?(h.callStats.localStats.screenShare.negotiationStateChanged(\"rejected\",\"sharingStopped\"),l.logFailure(\"expectedstarting screen sharing failure with reason stopped\")):(h.callStats.localStats.screenShare.negotiationStateChanged(\"rejected\",\"other\"),l.logFailure(u)),u}))]):[2,Promise.reject(new Error(\"cannot start screen sharing\"))]}))}))},PluginlessCall.prototype.stopScreenSharing=function(l,d,u){return void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var l,d,p=this;return y(this,(function(h){return l=this.logger.createFnLogger(A.CALL_OPERATIONS.STOP_SCREEN_SHARING,u),this.isJoinedLightweight()?(l.logFailure(\"Can not stop screen sharing in lightweight call\"),[2,Promise.reject(60)]):this.canToggleScreenSharing?this.isScreenSharingOn||this._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.START_SCREEN_SHARING)?(this.screenSharingRenegotiationDeferred&&(this.screenSharingRenegotiationDeferred.reject({reason:\"ScreenSharingStopped\"}),this.screenSharingRenegotiationDeferred=null),this.mediaStateConfigurationHelper.removeModality(2),this.canToggleScreenSharing=!1,d=function(){p.canToggleScreenSharing=!0,p._shouldShareSystemSound=!1,p.callStats.localStats.screenShare.stop(),p.disposeSharingScreenHandle()},this.allowScreenSharingControl()&&this.screenSharingControl.shutdownControlForSharer(),[2,this.updateMediaModalities(void 0,u).then((function(){return p.setScreenSharingOn(!1,u)})).then(d,(function(h){throw l.logFailure(h),p.callTelemetry.updateOperationData(A.CALL_OPERATIONS.STOP_SCREEN_SHARING,{error:(0,D.getPIISafeObject)(h)},u),d(),h}))]):(l.logFailure(\"screensharing is not on, ignore this operation\"),[2,Promise.resolve()]):(l.logFailure(\"cannot stop screen sharing\"),[2,Promise.reject(new Error(\"cannot stop screen sharing\"))])}))}))},PluginlessCall.prototype.startDataChannel=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(l){switch(l.label){case 0:if(!this.allowDataChannel())throw new Error(\"startDataChannel is disabled since ECS flag prohibits it\");return this.mediaStateConfigurationHelper.enableModality(3),[4,this.updateMediaModalities({},d)];case 1:return l.sent(),[2]}}))}))},PluginlessCall.prototype.stopDataChannel=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(l){switch(l.label){case 0:if(!this.allowDataChannel())throw new Error(\"stopDataChannel is disabled since ECS flag prohibits it\");return this.mediaStateConfigurationHelper.removeModality(3),[4,this.updateMediaModalities({},d)];case 1:return l.sent(),[2]}}))}))},PluginlessCall.prototype.allowDataChannel=function(){return this.mediaSession?!!this.mediaSession.getSessionConfig().mediaConfig.simulcastSessionEnabled&&(this.isOneToOnePSTNCall()?this.mediaSession.getSessionConfig().config.enableDataChannelPstn:this.mediaSession.getSessionConfig().config.enableDataChannel):(this.logger.warn(\"datachannel not allowed as there is no mediaSession\"),!1)},PluginlessCall.prototype.isGiveControlEnabled=function(){var l,d,u=null===(d=null===(l=this.mediaSession)||void 0===l?void 0:l.getSessionConfig())||void 0===d?void 0:d.config;return u?u.enableGiveControl:(this.logger.warn(\"Give take control is not enabled as there is no mediaSession, sessionConfig or sessionConfig.config\"),!1)},PluginlessCall.prototype.allowScreenSharingControl=function(){return this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.allowDataChannel()},PluginlessCall.prototype.sendUserEvents=function(l,d){return v(this,void 0,void 0,(function(){return y(this,(function(u){return[2,this.dataChannel.sendUserEvents(l,d)]}))}))},PluginlessCall.prototype.shareSystemSound=function(l){return v(this,void 0,void 0,(function(){return y(this,(function(d){return!!this.mediaSession&&this.mediaSession.getSessionConfig().mediaConfig.simulcastSessionEnabled&&this.mediaSession.getSessionConfig().config.enableAudioSharing&&this.mediaSession.getSessionConfig().config.requireUserActionForAudioSharing?(this.logger.debug(\"ShareSystemSound: \".concat(l)),this._shouldShareSystemSound=l,[2,Promise.resolve()]):[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.mute=function(l){return void 0===l&&(l=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(d){return this.isMuted?[2,Promise.reject((0,M.getRejectTransactionEnd)(A.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]:[2,this.muteUnmute(!0,l)]}))}))},PluginlessCall.prototype.unmute=function(l){return void 0===l&&(l=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(d){return[2,this.muteUnmute(!1,l)]}))}))},PluginlessCall.prototype.muteSpeaker=function(l){return void 0===l&&(l=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(d){return[2,this.muteUnmuteSpeaker(!0,l)]}))}))},PluginlessCall.prototype.unmuteSpeaker=function(l){return void 0===l&&(l=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(d){return[2,this.muteUnmuteSpeaker(!1,l)]}))}))},PluginlessCall.prototype.muteParticipants=function(l,d,u){return void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p,h,g,f=this;return y(this,(function(m){return(p=this.logger.createFnLogger(A.CALL_OPERATIONS.MUTE_PARTICIPANTS,u,\"muteScope=\".concat(l))).info(\"callParticipants count=\".concat(d.length)),void 0===(h=PluginlessCall.convertMuteScope(l))?(p.logFailure(\"Unrecognized \".concat(l)),[2,Promise.reject(new Error(\"Unrecognized muteScope\"))]):H.callStateIsAnyOf(this.state,[11,12])?(p.logFailure(\"Can not mute/unmute during preheat call\"),[2,Promise.reject(60)]):(g=[],d.forEach((function(l){g.push(l.id)})),[2,this.signalingSession.muteAsync(h,g,u).then((function(l){return f.handleParticipantsMutedUpdated(l)})).catch((function(l){return f.callTelemetry.updateOperationData(A.CALL_OPERATIONS.MUTE_PARTICIPANTS,{error:(0,D.getPIISafeObject)(l)},u),p.logFailure(l),l&&l.endCode?Promise.reject(l.endCode):Promise.reject(l)}))])}))}))},PluginlessCall.prototype.startAudio=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var l,u,p;return y(this,(function(h){switch(h.label){case 0:if(l=this.logger.createFnLogger(A.CALL_OPERATIONS.START_AUDIO,d),3!==this.state)return l.logFailure(\"Cannot startAudio when call is not connected\"),[2,Promise.reject(60)];if(this.isJoinedLightweight())return l.logFailure(\"Can not startAudio in lightweight call\"),[2,Promise.reject(60)];if(this.mediaStateConfigurationHelper.enableModality(0),this.callUsesMixer&&this.mediaStateConfigurationHelper.removeModality(1),!this.mediaStateConfigurationHelper.isSending(1))return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.turnOnLocalVideoPreview(d)];case 2:return h.sent(),[3,4];case 3:return u=h.sent(),l.logFailure(u),[2,Promise.reject(25)];case 4:return[4,this.startStopAudio(!0,d)];case 5:return p=h.sent(),[4,this.signalingSession.recordTelemetryForStartAudio(p)];case 6:return h.sent(),[2,p]}}))}))},PluginlessCall.prototype.stopAudio=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var l,u;return y(this,(function(p){switch(p.label){case 0:return l=this.logger.createFnLogger(A.CALL_OPERATIONS.STOP_AUDIO,d),3!==this.state?(l.logFailure(\"Cannot stopAudio when call is not connected\"),[2,Promise.reject(60)]):this.isJoinedLightweight()?(l.logFailure(\"Can not stopAudio in lightweight call\"),[2,Promise.reject(60)]):(this.mediaStateConfigurationHelper.removeModality(0),[4,this.startStopAudio(!1,d)]);case 1:return u=p.sent(),[4,this.turnOffLocalVideoPreview(d)];case 2:return p.sent(),[4,this.signalingSession.recordTelemetryForStopAudio(u)];case 3:return p.sent(),[2,u]}}))}))},PluginlessCall.prototype.assimilate=function(l,d,u,p){return void 0===p&&(p=(0,P.generateCauseId)()),Promise.reject(new Error(\"Not implemented\"))},PluginlessCall.prototype.merge=function(l,d,u){return void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p,h,g,f=this;return y(this,(function(m){switch(m.label){case 0:return(p=this.logger.createFnLogger(A.CALL_OPERATIONS.MERGE_CALL,u)).error(\"merge callId \".concat(l.callId,\" callMergeOptions \").concat(JSON.stringify(d))),(h=this.canMerge(l,u))?(g=[],l.participants.forEach((function(l){g.push(f._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS.MERGE_CALL,l.id,u))})),[4,this.mergeCallByAddParticipantWithReplaces(d,l.participants,l,1,A.CALL_OPERATIONS.MERGE_CALL,u,g)]):(p.info(\"Error. \".concat((0,D.getPrintableObject)(h))),[2,Promise.reject((0,M.getRejectTransactionEnd)(A.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))]);case 1:return[2,m.sent()[0]]}}))}))},PluginlessCall.prototype.mergeParticipants=function(l,d,u,p){return v(this,void 0,void 0,(function(){var h,g,f,m,v,_,C,E,T,b,I;return y(this,(function(y){if(h=[],!l)return[2,Promise.reject((0,M.getRejectTransactionEnd)(\"Invalid callToMerge\"))];if(0===d.length)return[2,Promise.reject((0,M.getRejectTransactionEnd)(\"Invalid participantIds\"))];g=[];try{for(f=S(d),m=f.next();!m.done;m=f.next())v=m.value,(_=(0,j.findParticipantUsingParticipantLegId)(l,v))?(C=this._enableMergeParticipantLegsBatchSupport?(0,N.default)():v,E={id:_.id,participantId:C,replacementParticipantId:v},h.push(E),g.push(this._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS.MERGE_PARTICIPANT,C,p))):(T={code:A.TRANSACTION_END_CODE.INVALID_PARTICIPANT,subCode:A.TRANSACTION_END_SUBCODE.INVITE_FAILURE,phrase:\"participantId \".concat(v,\" is invalid!\")},g.push(Promise.reject((0,M.getRejectTransactionEnd)(T))))}catch(l){b={error:l}}finally{try{m&&!m.done&&(I=f.return)&&I.call(f)}finally{if(b)throw b.error}}return[2,this.mergeCallByAddParticipantWithReplaces(u,h,l,3,A.CALL_OPERATIONS.MERGE_PARTICIPANT,p,g)]}))}))},PluginlessCall.prototype.mergeWithPickupCode=function(l,d,u){return void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p,h,g,f=this;return y(this,(function(m){return(p=this.logger.createFnLogger(A.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,u)).info(\"mergeWithPickupCode: pickup code: \".concat(l,\", groupId: \").concat(V.scrubMriOrOmit(d.groupId),\", threadId: \").concat(V.getLoggableThreadId(d.threadId),\" messageId: \").concat(d.messageId)),!l||isNaN(Number(l))?(p.info(\"mergeWithPickupCode: pickup code cannot be empty\"),[2,Promise.reject((0,M.getRejectTransactionEnd)(\"mergeWithPickupCode: pickup code cannot be empty\"))]):(h={additionalData:d.additionalData,groupId:d.groupId,threadId:d.threadId,messageId:d.messageId,replacementType:2,pickupCode:Number(l)},g={id:\"4:\".concat(A.UNPARK_CODE.SERVER_HOLD)},[2,Promise.resolve().then((function(){return Promise.all(f.signalingSession.addParticipantsAsync([g],h,u))})).then((function(d){return d.length>0&&f.signalingNotifications.onParticipantJoined(d[0],u),f.callTelemetry.recordOperationSuccess(A.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,null,l,u),Promise.resolve({code:A.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:A.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE})})).catch((function(l){p.logFailure(\"Participant was not added to call, error=\".concat((0,D.getPrintableObject)(l)));var d=f._handleParticipantOperationFailure(A.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,l,u,null).reason;return Promise.reject(l?l.endCode:d||0)}))])}))}))},PluginlessCall.prototype.setMaxVideoChannels=function(l){return v(this,void 0,void 0,(function(){return y(this,(function(l){return[2,Promise.reject(60)]}))}))},PluginlessCall.prototype.stop=function(l,d,u,p){return void 0===l&&(l=!1),void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var g,f,m,v;return y(this,(function(y){return g=this.logger.createFnLogger(A.CALL_OPERATIONS.STOP_AUDIO,d),6===this.state?(g.logFailure(\"Trying to stop a call which is already Disconnecting\"),[2,Promise.reject(new Error(\"cannot stop call in Disconnecting state\"))]):7===this.state?(g.logFailure(\"Trying to stop a call which is already Disconnected\"),[2,Promise.reject(new Error(\"cannot stop call in Disconnected state\"))]):this.disposedPromise?[2,Promise.reject(\"Call already ended\")]:(f=0,1===this.state&&(f=10),m=p?{clientReasonSubCode:p.clientSubCode,clientReasonPhrase:p.clientPhrase}:{},v=h(h({terminatedReason:f,forEveryone:l,causeId:d},u),{rejectReason:m}),[2,this.stopInternal(v)])}))}))},PluginlessCall.prototype.publishState=function(l,d){var u=this.getPluginlessStateType(l.type),p=this.getPluginlessPublishLevel(l.level),h=l.participantIds&&l.participantIds.length>0?oe.Specified:void 0;return this.callTelemetry.setOperationVariant(A.CALL_OPERATIONS.PUBLISH_STATE,h===oe.Specified?\"\".concat(u).concat(A.OPERATION_VARIANTS.SPECIFIED):\"\".concat(u).concat(A.OPERATION_VARIANTS.NONE),d),this.signalingSession.publishStateAsync(u,p,d,l.content,h,l.participantIds)},PluginlessCall.prototype.publishStatesForEveryone=function(l,d){var u=this.getPluginlessStateType(l.type),p=this.getPluginlessPublishLevel(l.level),h=oe.All;return this.callTelemetry.setOperationVariant(A.CALL_OPERATIONS.PUBLISH_STATE,\"\".concat(u).concat(A.OPERATION_VARIANTS.ALL)),this.signalingSession.publishStateAsync(u,p,d,l.content,h)},PluginlessCall.prototype.removeState=function(l,d){return this.signalingSession.removeStateAsync(d,oe.Specified,void 0,l.stateIds).then((function(l){return Promise.resolve()}))},PluginlessCall.prototype.removeStatesForEveryone=function(l,d){var u=this.getPluginlessStateType(l.type);return this.signalingSession.removeStateAsync(d,oe.All,u,void 0).then((function(l){return Promise.resolve()}))},PluginlessCall.prototype.updateMeetingSettings=function(l,d){return this.signalingSession.updateMeetingSettingsAsync({allowRaiseHands:l.allowRaiseHands,attendeeRestrictions:l.attendeeRestrictions,lockMeeting:l.lockMeeting,breakoutRoomsEnabled:l.breakoutRoomsEnabled,allowPresentersToManageBreakoutRooms:l.allowPresentersToManageBreakoutRooms,disableMdpClientAudioRecording:l.disableMdpClientAudioRecording},d)},PluginlessCall.prototype.updateMeetingGroups=function(l,d){var u=this;this.logger.info(\"[\".concat(A.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,\"][\").concat(l,\"] options \").concat((0,D.safeJsonStringify)(d)));var p=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,l),h={fromGroup:d.fromGroup,toGroup:d.toGroup,scope:(0,ee.mapParticipantScope)(d.scope)};return d.participants&&(h.participants=(0,ee.createParticipantListFromMriMap)(d.participants)),this.signalingSession.updateMeetingsGroupsAsync(l,h).catch((function(d){u.logger.info(\"[\".concat(l,\"] [\").concat(A.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,\"] error in updateMeetingGroups (synchronous error) : \").concat((0,D.getPIISafeObject)(d),\". updateMeetingGroupsPromise will be rejected by signaling callback\")),u.callTelemetry.updateOperationData(A.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,{error:(0,D.getPIISafeObject)(d)},l)})),p},PluginlessCall.prototype.updateMeetingLiveState=function(l,d){var u=this;return this.logger.info(\"[\".concat(A.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,\"][\").concat(l,\"] options \").concat((0,D.safeJsonStringify)(d))),this.signalingSession.updateMeetingLiveStateAsync(l,d).catch((function(d){u.logger.info(\"[\".concat(l,\"] [\").concat(A.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,\"] error in updateMeetingLiveState (synchronous error) : \").concat((0,D.getPIISafeObject)(d),\". promise will be rejected by signaling callback\")),u.callTelemetry.updateOperationData(A.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,{error:(0,D.getPIISafeObject)(d)},l)})),this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,l)},PluginlessCall.prototype.updateParticipantInterpretationState=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h,g,f=this;return y(this,(function(m){if(this.logger.info(\"[\".concat(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,\"][\").concat(l,\"] options \").concat((0,D.safeJsonStringify)(d))),0===d.length)return[2,Promise.reject((0,M.getRejectTransactionEnd)(\"Invalid UpdateParticipantInterpretationState options\"))];for(u=this.signalingSession.updateParticipantInterpretationStateAsync(l,d),p=[],d.forEach((function(d){p.push(f._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,d.id,l))})),h=function(p){var h=u[p],g=d[p];h.then((function(){f.logger.logSuccess(\"updateParticipantInterpretationState succeeded for [id=\".concat(V.scrubMriOrOmit(g.id),\"]\"));var d={code:A.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:\"\"};f.callTelemetry.recordOperationSuccess(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,d,g.id,l),f._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,d,g.id,l)})).catch((function(d){f.logger.error(\"[\".concat(l,\"] [\").concat(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,\"] error in updateParticipantInterpretationState (synchronous error) : \").concat((0,D.getPIISafeObject)(d),\". updateParticipantInterpretationStatePromise will be rejected by signaling callback\")),f.callTelemetry.updateOperationData(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{error:(0,D.getPIISafeObject)(d)},l);var u=f._handleParticipantOperationFailure(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,d,l,g.id).reason,p=(null==d?void 0:d.endCode)||u||0;f._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,p,g.id,l)}))},g=0;g<u.length;g++)h(g);return[2,Promise.resolve(p)]}))}))},PluginlessCall.prototype.joinMeetingGroup=function(l,d){var u=this;this.logger.info(\"[\".concat(A.CALL_OPERATIONS.JOIN_MEETING_GROUP,\"][\").concat(l,\"] options \").concat((0,D.safeJsonStringify)(d)));var p=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.JOIN_MEETING_GROUP,l),g=h({meetingGroupId:d.meetingGroupId},d.groupPreferences&&{groupPreferences:d.groupPreferences});return this.signalingSession.joinMeetingGroupAsync(l,g).catch((function(d){var p=(0,D.getPIISafeObject)(d);u.logger.info(\"[\".concat(l,\"] [\").concat(A.CALL_OPERATIONS.JOIN_MEETING_GROUP,\"] error in joinMeetingGroup (synchronous error) : \").concat(p,\". joinMeetingGroupPromise will be rejected by signaling callback\")),u.callTelemetry.updateOperationData(A.CALL_OPERATIONS.JOIN_MEETING_GROUP,{error:p},l)})),p},PluginlessCall.prototype.leaveMeetingGroup=function(l,d){var u=this;this.logger.info(\"[\".concat(A.CALL_OPERATIONS.LEAVE_MEETING_GROUP,\"][\").concat(l,\"] options \").concat((0,D.safeJsonStringify)(d)));var p=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.LEAVE_MEETING_GROUP,l),h={meetingGroupId:d.meetingGroupId};return this.signalingSession.leaveMeetingGroupAsync(l,h).catch((function(d){var p=(0,D.getPIISafeObject)(d);u.logger.info(\"[\".concat(l,\"] [\").concat(A.CALL_OPERATIONS.LEAVE_MEETING_GROUP,\"] error in leaveMeetingGroup (synchronous error) : \").concat(p,\". leaveMeetingGroupPromise will be rejected by signaling callback\")),u.callTelemetry.updateOperationData(A.CALL_OPERATIONS.LEAVE_MEETING_GROUP,{error:p},l)})),p},PluginlessCall.prototype.sendMessages=function(l,d){throw new Error(\"Not yet implemented\")},PluginlessCall.prototype.updateMeetingRoles=function(l,d,u){return void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(p){return 3===this.state&&this.signalingSession.hasOwnProperty(\"updateMeetingRolesAsync\")?[2,this.signalingSession.updateMeetingRolesAsync(l,d,u)]:[2,Promise.reject({code:O.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:O.CONSTANTS.SUB_CODE.ACTION_NOT_ALLOWED,phrase:\"ActionNotAllowed\"})]}))}))},PluginlessCall.prototype.stopInternal=function(l){var d=this,u=this.logger.createFnLogger(\"stopInternal\",l.causeId),p=l.terminatedReason||0,h=l.rejectReason&&(l.rejectReason.code||l.rejectReason.subCode)?l.rejectReason:this.getRejectionInfoFromTerminatedReason(p);if(l.rejectReason&&(h||(h={}),h.clientReasonSubCode=l.rejectReason.clientReasonSubCode,h.clientReasonPhrase=l.rejectReason.clientReasonPhrase),u.info(\"started, terminatedReason=\".concat(p,\", rejectReason=\").concat((0,D.safeJsonStringify)(h))),6===this.state)return u.logFailure(\"Trying to stop a call which is already Disconnecting\"),this.disconnectingPromise;if(7===this.state)return u.logFailure(\"Trying to stop a call which is already Disconnected\"),this.disconnectingPromise;this.setCallState(6,l.causeId,p);var g={causeId:l.causeId,forEveryone:l.forEveryone,scope:this.mapEndpointScope(l.scope),redirectOptions:l.redirectOptions&&W.convertRedirectOptions(l.redirectOptions)};return 1===l.scope&&(h.code=O.CONSTANTS.CODE.SUCCESS,h.subCode=O.CONSTANTS.SUB_CODE.ENDED_BY_REMOTE_ENDPOINT,h.phrase=q.jsCallEndPhrase.EndedByRemoteEndpoint),this.disconnectingPromise=Promise.all([this.cleanUpMedia(l.causeId,h).catch((function(l){throw u.logFailure(\"cleanUpMedia failed with reason=\".concat((0,D.getPrintableObject)(l))),l})),this.signalingSession.endAsync(h,g).catch((function(l){throw u.logFailure(\"endAsync failed with reason=\".concat((0,D.getPrintableObject)(l))),l}))]).catch((function(p){throw u.logFailure(p),d.cleanUp(l.causeId,h),p})).then((function(){return d.cleanUp(l.causeId,h)})).catch((function(u){throw d.callTelemetry.updateOperationData(A.CALL_OPERATIONS.STOP_CALL,{error:(0,D.getPIISafeObject)(u)},l.causeId),d.setCallState(7,l.causeId,p),u})),this.disconnectingPromise},PluginlessCall.prototype.cleanUp=function(l,d){return v(this,void 0,void 0,(function(){var u=this;return y(this,(function(p){return this.logger.info(\"[\".concat(l,\"][cleanup]start\")),this.disposedPromise||(this.disposedPromise=this.cleanUpFinalize(l,d),this._getCallEndOperation().catch(w.noop).then((function(){var d={code:O.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:O.CONSTANTS.SUB_CODE.ABANDONED};u._callOperationHandler.rejectPendingOperations(61,l,d),u._participantOperationHandler.rejectPendingOperations(47,l,d)}))),[2,this.disposedPromise]}))}))},PluginlessCall.prototype.cleanUpMedia=function(l,d){return v(this,void 0,void 0,(function(){var u=this;return y(this,(function(p){return this.mediaDisposedPromise||(this.mediaDisposedPromise=v(u,void 0,void 0,(function(){var u,p,h,g,f,m;return y(this,(function(v){switch(v.label){case 0:if(this.turnOffLocalVideoPreview(l),this.localVideoContainer=null,this.disposeContentSharingSessions(),this.disposeSharingScreenHandle(),u=this.mediaSession,this.reportMediaStats=!!u,!u)return[2];this.mediaControlPlane.dispose(),this.dataChannel.dispose(),this.screenSharingControl.dispose(l),this.mediaSession=null,this.streamManager.setMediaSession(null,l),null===(h=this.participants)||void 0===h||h.forEach((function(d){d.setMediaSession(null,l)})),p=u.terminate(l,d),this.isVideoOn=!1,this.setMediaStream(this.isVideoOn,!1,1),this.setMediaStream(!1,!1,2),this.setMediaStream(!1,!1,0),this.isScreenSharingOn=!1,null===(g=this.screenSharingRenegotiationDeferred)||void 0===g||g.reject(d),this.screenSharingRenegotiationDeferred=null,this.mediaStateConfigurationHelper.removeModality(1),this.mediaStateConfigurationHelper.removeModality(0),this.mediaStateConfigurationHelper.removeModality(3),this.mediaStateConfigurationHelper.removeModality(2),(null===(m=null===(f=null==u?void 0:u.getSessionConfig())||void 0===f?void 0:f.config)||void 0===m?void 0:m.useOneDsLogger)&&u.getSessionConfig().config.addTelemetryReportingCallback&&window.removeEventListener(\"beforeunload\",this.beforeUnloadTelemetrySender),v.label=1;case 1:return v.trys.push([1,,3,5]),[4,p];case 2:return v.sent(),[3,5];case 3:return[4,this.collectCallStats(u)];case 4:return v.sent(),[7];case 5:return[2]}}))}))),[2,this.mediaDisposedPromise]}))}))},PluginlessCall.prototype.cleanUpFinalize=function(l,d){return v(this,void 0,void 0,(function(){var u,p;return y(this,(function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,this.cleanUpMedia(l,d)];case 1:return h.sent(),[3,3];case 2:return u=h.sent(),this.logger.info(\"[\".concat(l,\"][cleanUpMedia] failure: \").concat((0,D.getPrintableObject)(u))),[3,3];case 3:return p=this.reportCallEndStats(this.reportMediaStats),this.mediaSession&&this.mediaSession.getSessionConfig().config.waitReportStatsAtCallStop?[4,p]:[3,5];case 4:h.sent(),h.label=5;case 5:return[2]}}))}))},PluginlessCall.prototype.shouldFallbackToLwj=function(l,d){d.info(\"Checking whether to fallback to LWJ\");var u=this.signalingSession.getMeetingInfo();if(!u)return d.info(\"Not falling back to LWJ because call isn't a scheduled meeting (meetingInfo = \".concat(JSON.stringify(u),\")\")),!1;var p=this.callSettings.automaticLwjFallback&&this.callSettings.automaticLwjFallback.codeSubcodePairs;if(!(p&&p.some((function(d){return d[0]===l[0]&&d[1]===l[1]}))))return d.info(\"Not falling back to LWJ because [code, subcode] is \".concat(JSON.stringify(l),\" but eligible reasons are \").concat(JSON.stringify(p))),!1;var h=this.meetingDetails&&this.meetingDetails.capabilities&&this.meetingDetails.capabilities.allowDialinConferencing;return h?(d.info(\"Falling back to LWJ (terminatedReason \".concat(l,\", allowDialinConferencing \").concat(h,\")\")),!0):(d.info(\"Not falling back to LWJ because allowDialinConferencing is \".concat(h)),!1)},PluginlessCall.prototype.createContentSharingSession=function(l,d,u,p,h){return void 0===h&&(h=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var h,g,f=this;return y(this,(function(m){return\"attendee\"===(this.advancedMeetingRole||this.meetingRole)?(h={terminatedReason:8,terminatedReasonCode:403,terminatedReasonSubCode:0,errorMessage:\"Failed due to insufficient permissions\"},[2,Promise.reject(h)]):(g=new $.default(this.callTelemetry,this.logger,this.signalingSession,l,d,p,u),this.contentSharingSessions.push(g),g.changed((function(){return f.removeContentSessionIfEnded(g)})),this.event(\"contentSharingChanged\").raise(),[2,Promise.resolve(g)])}))}))},PluginlessCall.prototype.stopWithBeacon=function(l){return void 0===l&&(l=(0,P.generateCauseId)()),6===this.state||7===this.state||this.signalingSession.endWithBeacon(l)},PluginlessCall.prototype.disposeContentSharingSessions=function(){var l=this;this.contentSharingSessions.forEach((function(d){d.dispose(),l.removeContentSessionIfEnded(d)})),this.event(\"contentSharingChanged\").raise()},PluginlessCall.prototype.isPreheatedOnly=function(){return!!(12===this.state||2===this.state&&this._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.JOIN_PREHEATED_CALL)||9===this.state&&this._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.JOIN_PREHEATED_CALL))},PluginlessCall.prototype.removeContentSessionIfEnded=function(l){7!==l.contentSharingStatus&&8!==l.contentSharingStatus||(this.logger.info(\"stopping the content sharing session.\"),E.remove(this.contentSharingSessions,(function(d){return d.contentSharingGuid===l.contentSharingGuid})).length&&this.event(\"contentSharingChanged\").raise())},PluginlessCall.prototype.getRejectionInfoFromTerminatedReason=function(l){switch(l){case 53:return{code:q.jsCallEndCodes.MediaError,subCode:q.jsCallEndSubCodes.MediaWhiteListingIssue,phrase:q.jsCallEndPhrase.MediaWhiteListingIssue};case 4:return{code:q.jsCallEndCodes.MediaError,subCode:this._wasAudioStreamConnected?q.jsCallEndSubCodes.MediaDropAfterConnect:q.jsCallEndSubCodes.MediaDropDuringConnect,phrase:this._wasAudioStreamConnected?q.jsCallEndPhrase.MediaDropAfterConnect:q.jsCallEndPhrase.MediaDropDuringConnect};case 47:return{code:q.jsCallEndCodes.MediaError,subCode:q.jsCallEndSubCodes.MediaOfferProcessingError,phrase:q.jsCallEndPhrase.MediaOfferProcessingError};case 38:return{code:q.jsCallEndCodes.MediaError,subCode:q.jsCallEndSubCodes.MediaRenegotiationError,phrase:q.jsCallEndPhrase.RetargetNotSupported};case 10:return{code:q.jsCallEndCodes.Reject,subCode:q.jsCallEndSubCodes.Success,phrase:q.jsCallEndPhrase.CallEndReasonLocalUserInitiated};case 25:return{code:q.jsCallEndCodes.UnknownError,subCode:q.jsCallEndSubCodes.MediaUnknownError,phrase:q.jsCallEndPhrase.MediaError};case 58:return{code:q.jsCallEndCodes.MediaError,subCode:q.jsCallEndSubCodes.MediaPermissionError,phrase:q.jsCallEndPhrase.MediaPermissionError};case 7:return{code:q.jsCallEndCodes.UnknownError,subCode:q.jsCallEndSubCodes.Success,phrase:q.jsCallEndPhrase.Unknown};case 0:case 1:return{code:q.jsCallEndCodes.Success,subCode:q.jsCallEndSubCodes.Success,phrase:q.jsCallEndPhrase.CallEndReasonLocalUserInitiated};case 75:return{code:q.jsCallEndCodes.CallRedirected,subCode:q.jsCallEndSubCodes.CallRedirectedSuccess,phrase:q.jsCallEndPhrase.CallEndReasonRedirected,resultCategories:[q.ResultCategory.Success]}}return null},PluginlessCall.prototype.acknowledge=function(l,d,u){return void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p,h,g,f,m,S,_=this;return y(this,(function(C){switch(C.label){case 0:if(p=this.logger.createFnLogger(A.CALL_OPERATIONS.ACKNOWLEDGE,u),h=Date.now(),this.setInitialTelemetry(A.CALL_OPERATIONS.ACKNOWLEDGE,{callStartTime:h},\"\",u),0!==this.state&&8!==this.state)throw new Error(\"Trying to acknowledge a call that has already been acted on \".concat(this.state));p.info(\"isMultiParty=\".concat(l.isMultiParty)),p.info(\"fromMixer=\".concat(l.fromMixer)),p.info(\"participantId=\".concat(l.participantId)),p.info(\"callType=\".concat(l.callType)),this.attachToCallAndGetOffer=I.defer(),this.setCallType(l.isMultiParty?2:1,u),this.setCallUsesMixer(!!l.fromMixer,u),this.setCallerMri((0,k.stripMriAliases)(l.callerId)),this.setTransferorMri(l.transferorId),this.transferorType=l.transferorType,this.transferorDisplayName=l.transferorDisplayName,this.incomingCallType=l.callType,this.consultativeCallId=l.consultativeCallId,this.callQueueInfo=l.callQueueInfo,this.callStats.localStats.startCall(),g=(0,B.default)(p),C.label=1;case 1:return C.trys.push([1,3,,4]),g.executeSync(q.CallAckSignalingPhase.ProcessIncomingCallRequest,(function(){return _.signalingSession.processIncomingCallRequest(l,d,u)})),this.setParticipantId(this.participantId),g.executeSync(q.CallAckSignalingPhase.ResolvePotentialConflict,(function(){return _.signalingAgent.resolvePotentialCallConflict(_.signalingSession)}))===this.signalingSession?[2,Promise.reject({code:7,success:!1})]:(f=function(){return v(_,void 0,void 0,(function(){var l,d,h,f,m=this;return y(this,(function(v){switch(v.label){case 0:return g.executeSync(q.CallAckMediaPhase.InitializeMediaSession,(function(){return m.initializeMediaSession(u)})),l=this.signalingSession.getInitialMediaOfferFromIncomingCallPayload(),this.callStats.setParticipantId(this.participantId),this.onBehalfOfMri=this.signalingSession.onBehalfOf,[4,g.execute(q.CallAckSignalingPhase.WaitForMediaOffer,(function(){return l?Promise.resolve(l):m.attachToCallAndGetOffer.promise}))];case 1:d=v.sent(),v.label=2;case 2:return v.trys.push([2,4,,6]),[4,g.execute(q.CallAckMediaPhase.ProcessOffer,(function(){return m.mediaSession.processOfferAsync(d,u)}))];case 3:return h=v.sent(),[3,6];case 4:return f=v.sent(),[4,this._handleOfferProcessingError(f,u,p)];case 5:return h=v.sent(),[3,6];case 6:return[4,g.execute(q.CallAckMediaPhase.ProcessOfferedModalities,(function(){return m._processOfferedModalities(h,u)}))];case 7:return v.sent(),[4,g.execute(q.CallAckMediaPhase.TrySendingProvisionalAnswer,(function(){return m._trySendProvisionalMediaAnswer(u)}))];case 8:return v.sent(),[2]}}))}))},m=function(){return g.execute(q.CallAckSignalingPhase.SendAttach,(function(){return _.signalingSession.sendAttachToCall(u)})).then((function(){return _.setCallState(1,u)}))}(),[4,Promise.all([m,f()]).catch((function(l){return v(_,void 0,void 0,(function(){return y(this,(function(d){switch(d.label){case 0:return[4,m];case 1:throw d.sent(),l}}))}))}))]);case 2:return C.sent(),[2,g.executeSync(q.CallAckSignalingPhase.OnAcknowledgeSuccess,(function(){return _._onAcknowledgeSuccess(p,g.getTelemetryData(),u)}))];case 3:return S=C.sent(),[2,this._onAcknowledgeError(S,u,p,g.getTelemetryData())];case 4:return[2]}}))}))},PluginlessCall.prototype.accept=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var u,p,h,g,f,m,v,S,_=this;return y(this,(function(y){switch(y.label){case 0:if((u=this.logger.createFnLogger(A.CALL_OPERATIONS.ACCEPT,d)).info(\"accept, answerMediaType: \".concat(l.answerMediaType,\",\\n                            withVideo: \").concat(l.withVideo,\",\\n                            muted: \").concat(l.muted,\",\\n                            getSendMediaModalities: \").concat(JSON.stringify(l.sendMediaModalities),\",\\n                            clientEndpointCapabilities: \").concat(l.clientEndpointCapabilities)),1!==this.state)throw new Error(\"Only calls in Notified state can be accepted\");this.setCallOptions({callStartOptions:l,callStartTime:Date.now()}),p=this._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,d),this.callStats.localStats.audio.start(),h=(0,B.default)(u),this.mediaSession.createAudioElement(d),this.setMuted(l.muted?q.ParticipantMuteState.Muted:q.ParticipantMuteState.Unmuted,d),this.setCallState(2,d),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.ACCEPT),y.label=1;case 1:return y.trys.push([1,10,,11]),l.forceAudioSendModalityWithNullStream&&this.mediaSession.useNullAudioStreamClient(),this.mediaStateConfigurationHelper.setCallAcceptOptions(l),this.mediaSession.getSessionConfig().config.alwaysNegotiateDataChannel&&this.mediaStateConfigurationHelper.enableModality(3),this.mediaStateConfigurationHelper.isSending(1)?[4,h.execute(q.CallSetupMediaPhase.StartVideoSafe,(function(){return _.startVideoSafe(d)}))]:[3,3];case 2:y.sent(),y.label=3;case 3:return this.mediaStateConfigurationHelper.isSending(0)&&this.setAudioOn(!0,d),[4,h.execute(q.CallSetupMediaPhase.UpdateMediaModalities,(function(){return _.updateMediaModalities(void 0,d)}))];case 4:return g=y.sent(),f=h.executeSync(q.CallSetupSignalingPhase.GetSignalingMediaTypes,(function(){return _.getSignalingMediaTypes(g)})),[4,h.execute(q.CallSetupMediaPhase.MuteUnmute,(function(){return _.muteUnmute(_._muteState===q.ParticipantMuteState.Muted,d)}))];case 5:return y.sent(),[4,h.execute(q.CallSetupMediaPhase.CreateAnswer,(function(){return _.mediaSession.createAnswerAsync(!1,d)}))];case 6:return m=y.sent(),[4,h.execute(q.CallSetupSignalingPhase.Accept,(function(){return _.signalingSession.acceptAsync(m,f,l.clientEndpointCapabilities,d)}))];case 7:return y.sent(),[4,h.execute(q.CallSetupSignalingPhase.WaitForConnect,(function(){return p}))];case 8:return y.sent(),this.handleRemoteParticipantStateInOneToOneCall(d),[4,h.execute(q.CallSetupMediaPhase.CompleteNegotiation,(function(){return _.completeNegotiationAsync(d)}))];case 9:return y.sent(),this.callTelemetry.updateOperationData(A.CALL_OPERATIONS.ACCEPT,{phases:h.getTelemetryData()},d),[3,11];case 10:throw v=y.sent(),S=v,this.callTelemetry.updateOperationData(A.CALL_OPERATIONS.ACCEPT,this.getTelemetryFromPhaseExecution(v),d),u.logFailure(v),(0,B.isOneOfPhaseErrors)(q.CallSetupSignalingPhase,v)&&(S=7),(0,B.isOneOfPhaseErrors)(q.CallSetupMediaPhase,v)&&(S=47),S;case 11:return[2]}}))}))},PluginlessCall.prototype.reject=function(l,d){return void 0===l&&(l=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var u;return y(this,(function(p){return u=d?{clientReasonSubCode:d.clientSubCode,clientReasonPhrase:d.clientPhrase}:{},[2,1!==this.state?Promise.reject(60):this.stopInternal({terminatedReason:10,causeId:l,rejectReason:u})]}))}))},PluginlessCall.prototype.join=function(l,d,u){return void 0===d&&(d={}),void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p;return y(this,(function(h){return p=Date.now(),this.setInitialTelemetry(A.CALL_OPERATIONS.JOIN_CALL,{callStartOptions:d,callStartTime:p},l.conversationUrl,u),this.setCallerMri((0,k.stripMriAliases)(l.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.JOIN_CALL),[2,this.joinOrStartCall({callStartOptions:W.getCallStartOptions(d),callStartTime:p},this.joinGivenConversation,u,l.conversationUrl)]}))}))},PluginlessCall.prototype.joinPreheatedCall=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h,g,f,m,v,S,_=this;return y(this,(function(y){switch(y.label){case 0:u=this.logger.createFnLogger(A.CALL_OPERATIONS.JOIN_PREHEATED_CALL,d),p=this.isServerMuted||1==(1&l.muteFlags),h=2==(2&l.muteFlags),g=(0,B.default)(u),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.JOIN_PREHEATED_CALL),y.label=1;case 1:return y.trys.push([1,8,,9]),f={endpointProperties:{preheatProperties:0}},this.setCallState(2,d),p||this.isCallModeStreaming()?[3,3]:[4,g.execute(q.CallSetupMediaPhase.UnmuteInput,(function(){return _.mediaSession.unmuteInputAsync(d)}))];case 2:return y.sent(),this.setMuted(q.ParticipantMuteState.Unmuted,d),[3,4];case 3:f.state={isMuted:!0},y.label=4;case 4:return h||this.isCallModeStreaming()?[3,6]:[4,g.execute(q.CallSetupMediaPhase.UnmuteOutput,(function(){return _.mediaSession.unmuteOutputAsync(d)}))];case 5:y.sent(),this.setSpeakerMuted(!1,d),y.label=6;case 6:return[4,this.signalingSession.updateEndpointState(f,d)];case 7:return y.sent(),this.computeCallState(d),[3,9];case 8:return m=y.sent(),v=7,S=void 0,u.logFailure(\" error: \".concat(v,\" \").concat((0,D.getPrintableObject)(m))),(0,M.isTransactionEnd)(m)?S=m:(0,B.isPhaseError)(q.CallSetupMediaPhase.UnmuteInput,m)?S={code:q.jsCallEndCodes.LocalError,subCode:q.jsCallEndSubCodes.MediaUnmuteMicrophoneError,phrase:(0,D.getPrintableObject)(m),causeId:d}:(0,B.isPhaseError)(q.CallSetupMediaPhase.UnmuteOutput,m)&&(S={code:q.jsCallEndCodes.LocalError,subCode:q.jsCallEndSubCodes.MediaUnmuteSpeakerError,phrase:(0,D.getPrintableObject)(m),causeId:d}),this.callTelemetry.updateOperationData(A.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{phases:g.getTelemetryData(),error:(0,D.getPIISafeObject)(m)},d),this.stopInternal({causeId:d,terminatedReason:v,rejectReason:S}),[2,Promise.reject(S)];case 9:return[2]}}))}))},PluginlessCall.prototype.start=function(l,d){return void 0===l&&(l={}),void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var u;return y(this,(function(p){return u=Date.now(),this.setCallerMri(k.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(A.CALL_OPERATIONS.START_CALL,{callStartOptions:l,callStartTime:u},\"\",d),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.START_CALL),[2,this.joinOrStartCall({callStartOptions:W.getCallStartOptions(l),callStartTime:u},this.startOutgoingCall,d)]}))}))},PluginlessCall.prototype.startCallToVoicemail=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var u;return y(this,(function(p){return u=Date.now(),this.setCallerMri(k.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(A.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{callVoicemailStartOptions:l,callStartTime:u},\"\",d),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL),[2,this.joinOrStartCall({callVoicemailStartOptions:l,callStartTime:u},this.startVM,d)]}))}))},PluginlessCall.prototype.joinCallWithoutCallModality=function(l,d,u){return void 0===d&&(d={}),void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p,h,g=this;return y(this,(function(f){return p=Date.now(),this.setCallerMri(l.groupCallInitiator),this.setCallType(2,u),h={callStartOptions:W.getCallStartOptions(d),callStartTime:p},this.setInitialTelemetry(A.CALL_OPERATIONS.SUBSCRIBE,h,l.conversationUrl,u),0!==this.state?(this.logger.info(\"[\".concat(u,\"][joinCallWithoutCallModality]Trying to subscribe to a call that has already been acted on\")),[2,Promise.reject(60)]):(this.setCallOptions(h),this.setCallState(8,u),this.signalingSession.subscribeToCall(l.conversationUrl,this.callId,d.clientEndpointCapabilities,{meetingRegistrationId:d.meetingRegistrationId,clientEndpointDebugContent:d.clientEndpointDebugContent,additionalEndpointProperties:d.additionalEndpointProperties},u).catch((function(l){return(0,M.isTransactionEnd)(l)?(g.logger.info(\"[\".concat(u,\"][joinCallWithoutCallModality] \").concat((0,D.getPrintableObject)(l))),Promise.reject(l)):Promise.reject(W.convertReason(l))})),[2,this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.SUBSCRIBE,void 0,u)])}))}))},PluginlessCall.prototype.startWithMeetingData=function(l,d){var u=Date.now();return this.setCallerMri(k.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.setInitialTelemetry(A.CALL_OPERATIONS.START_WITH_MEETING_DATA,{callStartOptions:d,callStartTime:u},\"\",l),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.START_WITH_MEETING_DATA),this.joinOrStartCall({callStartOptions:W.getCallStartOptions(d),callStartTime:u,meetingPreferences:{shouldResurrect:d.shouldResurrect}},this.startOutgoingCall,l)},PluginlessCall.prototype.joinWithMeetingData=function(l,d,u){var p=Date.now();return this.setInitialTelemetry(A.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{callStartOptions:u,callStartTime:p},d.conversationUrl,l),this.setCallerMri((0,k.stripMriAliases)(d.groupCallInitiator)),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA),this.joinOrStartCall({callStartOptions:W.getCallStartOptions(u),callStartTime:p,meetingPreferences:{shouldResurrect:u.shouldResurrect}},this.joinGivenConversation,l,d.conversationUrl)},PluginlessCall.prototype.subscribeWithMeetingData=function(l,d,u){var p=this,h=Date.now();this.setCallerMri(d.groupCallInitiator),this.setCallType(2,l);var g={callStartOptions:W.getCallStartOptions(u),callStartTime:h};return this.setInitialTelemetry(A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,g,d.conversationUrl,l),0!==this.state?(this.logger.info(\"[\".concat(l,\"][subscribeWithMeetingData]Trying to subscribe to a call that has already been acted on\")),Promise.reject(60)):(this.setCallOptions(g),this.setCallState(8,l),this.signalingSession.subscribeToCall(d.conversationUrl,this.callId,u.clientEndpointCapabilities,{meetingPreferences:{shouldResurrect:u.shouldResurrect},meetingData:this.meetingData,meetingRegistrationId:u.meetingRegistrationId,additionalEndpointProperties:u.additionalEndpointProperties},l).catch((function(d){return(0,M.isTransactionEnd)(d)?(p.logger.info(\"[\".concat(l,\"][subscribeWithMeetingData] \").concat((0,D.getPrintableObject)(d))),Promise.reject(d)):Promise.reject(W.convertReason(d))})),this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,void 0,l))},PluginlessCall.prototype.startCallWithNudge=function(l,d,u){return void 0===d&&(d={}),void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p,h;return y(this,(function(g){return this.setCallerMri(k.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.START_CALL_WITH_NUDGE),p=Date.now(),this.logger.info(\"[\".concat(u,\"][startCallWithNudge]startCallWithNudge for participants: \").concat(V.scrubMriOrOmitList(l))),this.participants.length?[2,Promise.reject(48)]:((h={}).callStartOptions=W.getCallStartOptions(d),h.invitationType=b.CA_CONSTANTS.INVITATION_TYPE.NUDGE,h.participantsToNudge=l,h.callStartTime=p,this.setInitialTelemetry(A.CALL_OPERATIONS.START_CALL_WITH_NUDGE,h,\"\",u),[2,this.joinOrStartCall(h,this.startOutgoingCall,u)])}))}))},PluginlessCall.prototype.startAndUnpark=function(l,d,u,p){return void 0===u&&(u={}),void 0===p&&(p=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var h,g,f;return y(this,(function(m){return this.setCallerMri(k.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id),h=this.logger.createFnLogger(A.CALL_OPERATIONS.START_CALL_AND_UNPARK,p),g=Date.now(),this.setInitialTelemetry(A.CALL_OPERATIONS.START_CALL_AND_UNPARK,{callStartTime:g},\"\",p),h.info(\"startAndUnpark for context: \".concat(l,\", pickupCode :\").concat(d)),this.connectCallPromise=this._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.START_CALL_AND_UNPARK),(f={}).callStartOptions=W.getCallStartOptions(u),f.parkContext=0===l?A.UNPARK_CODE.PARK:1===l?A.UNPARK_CODE.SHARED_LINE:A.UNPARK_CODE.SERVER_HOLD,f.pickupCode=d,this.addParticipant(\"4:\".concat(f.parkContext)).catch((function(l){return h.logFailure(\"Failed to add participant to unparked call\")})),[2,this.joinOrStartCall(f,this.startOutgoingCall,p)]}))}))},PluginlessCall.prototype.admitParticipant=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var u,p,h,g,f;return y(this,(function(m){return u=(0,k.generateAliasedMri)(l),p=this.getParticipant(u),h=this._getParticipantLegId(p),g=h?{participantLegId:h}:{},p&&7!==p.state?(f={code:A.TRANSACTION_END_CODE.SUCCESS,subCode:A.TRANSACTION_END_SUBCODE.NOT_IN_LOBBY,phrase:A.TRANSACTION_END_PHRASE.NOT_IN_LOBBY},this.callTelemetry.maybeRecordOperationSuccess(A.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,f,l,d,g),[2,Promise.reject(f)]):[2,this.admitParticipantToCall(u,d,h)]}))}))},PluginlessCall.prototype.admit=function(l,d){return this.signalingSession.admitAsync(d)},PluginlessCall.prototype.callMeBack=function(l,d,u){return void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var p;return y(this,(function(h){return p=(0,k.generateAliasedMri)(\"\".concat(k.MRI_SKYPE_PREFIX).concat(this.currentUserSkypeIdentity.id),this.currentUserSkypeIdentity.sipUri),[2,this.addCallMeBackParticipant(l,d||p,u)]}))}))},PluginlessCall.prototype.addParticipant=function(l,d,u){return void 0===d&&(d={}),void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(p){switch(p.label){case 0:return[4,this.addParticipantsImpl([l],d,u,\"addParticipant\")];case 1:return[2,p.sent()[0]]}}))}))},PluginlessCall.prototype.addParticipants=function(l,d,u){return void 0===d&&(d={}),void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(p){return[2,this.addParticipantsImpl(l,d,u,\"addParticipants\")]}))}))},PluginlessCall.prototype.addParticipantsImpl=function(l,d,u,p){return void 0===d&&(d={}),void 0===u&&(u=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var h,g,f,m,S=this;return y(this,(function(C){if(this.logger.info(\"[\".concat(u,\"][\").concat(p,\"] start\")),this.isEmergency&&0===this.state&&(0!==this.participants.length||1!==l.length))return[2,Promise.reject(new Error(\"Only 1 participant (the emergency operator) may be added to unstarted emergency calls\"))];if(d.participantInvitationData)try{JSON.stringify(d.participantInvitationData)}catch(l){throw this.logger.info(\"[\".concat(u,\"][\").concat(p,\"] \").concat(l)),l}return h=[],g=[],l.forEach((function(l){var d=S.getOrCreateParticipant(l,u);0===d.state||4===d.state?(g.push(d),h.push(S._participantOperationHandler.createPendingOperation(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,d.id,u))):3===d.state?h.push(Promise.resolve(d)):S._participantOperationHandler.hasPendingOperationWithOperationId(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,d.id)&&h.push(S._participantOperationHandler.waitForOperation(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,d.id))})),0===g.length||(f=!!d.disableUnmute,m=this.addParticipantsToCall(g,u,d.participantInvitationData,d.groupId,d.threadId,d.messageId,f,d.alternateId),E.zip(m,g).forEach((function(l){var d=_(l,2),p=d[0],h=d[1];return v(S,void 0,void 0,(function(){var l,d,g;return y(this,(function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),[4,p];case 1:return f.sent(),l=this._getParticipantLegId(this.getParticipant(h.id)),d=l?{participantLegId:l}:{},this.callTelemetry.recordOperationSuccess(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{code:A.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:\"\"},h.id,u,d),this._participantOperationHandler.maybeResolveOperation(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,h,h.id,u),[3,3];case 2:return g=f.sent(),this._participantOperationHandler.maybeRejectOperation(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,g,h.id,u),[3,3];case 3:return[2]}}))}))})),this.raiseChanged(this._changedEventSkipConfig)),[2,Promise.resolve(h)]}))}))},PluginlessCall.prototype.nudgeParticipants=function(l,d,u,p){return void 0===u&&(u={}),void 0===p&&(p=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(l){return 2!==this.state&&3!==this.state?[2,Promise.reject(48)]:[2,this.signalingSession.nudgeParticipantsAsync({participantsIds:d,causeId:p,invitationData:u.participantInvitationData,newGroupId:u.groupId,newThreadId:u.threadId,newMessageId:u.messageId})]}))}))},PluginlessCall.prototype.mapEndpointScope=function(l){var d=\"none\";switch(l){case 0:d=\"specified\";break;case 1:case 1:d=\"all\";break;default:d=\"none\"}return d},PluginlessCall.prototype.removeParticipant=function(l,d,u,p){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var h,g,f=this;return y(this,(function(m){return(h=this.logger.createFnLogger(\"removeParticipant\",d)).info(\"start\"),g=this.mapEndpointScope(p),[2,this.signalingSession.removeParticipantAsync({id:l,endpointId:u},d,g).catch((function(u){h.logFailure(\"Participant was not removed from call, error=\".concat(u));var p=f._handleParticipantOperationFailure(A.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,u,d,l).reason;return Promise.reject(p||38)}))]}))}))},PluginlessCall.prototype.searchParticipants=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(u){return[2,this.signalingSession.searchParticipantsAsync(l.searchQueryOptions,d)]}))}))},PluginlessCall.prototype.getAllParticipants=function(l,d){return void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){return y(this,(function(u){return[2,this.signalingSession.getAllParticipantsAsync(l.scope,d)]}))}))},Object.defineProperty(PluginlessCall.prototype,\"dominantSpeakerInfo\",{get:function(){var l;return this.internalDominantSpeakerInfo?this.internalDominantSpeakerInfo:(null===(l=this.mediaSession)||void 0===l?void 0:l.getSessionConfig().config.emptyInitialDSH)?{speakerList:[],timestamp:null}:{speakerList:this.participants.filter((function(l){return 3===l.state})).map((function(l){return l.id})),timestamp:null}},set:function(l){this.internalDominantSpeakerInfo=l},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCall.prototype,\"slowedDownActiveTalkerInfo\",{get:function(){return this.internalSlowedDownActiveTalkerInfo},set:function(l){var d;E.isEqual(null===(d=this.internalSlowedDownActiveTalkerInfo)||void 0===d?void 0:d.speakerList,l.speakerList)||(this.internalSlowedDownActiveTalkerInfo=l,this.raiseChanged())},enumerable:!1,configurable:!0}),PluginlessCall.prototype.startVideoSafe=function(l){var d=this;return this.startVideo(l).catch((function(u){d.logger.info(u,\"startVideoSafe\",l)}))},PluginlessCall.prototype.joinOrStartCall=function(l,d,u,p){return v(this,void 0,void 0,(function(){var h,g,f,m,v,S,_,C;return y(this,(function(y){switch(y.label){case 0:return h=this.logger.createFnLogger(\"joinOrStartCall\",u),0!==this.state&&8!==this.state?(g=\"Trying to start a call that has already been acted on\",h.logFailure(g),[2,Promise.reject(60)]):this.signalingAgent.resolvePotentialCallConflict(this.signalingSession)===this.signalingSession?[2,Promise.reject(57)]:(this.callStats.localStats.startCall(),f=!this._disableIsMultipartyDependenceOnThreadId&&!!this.threadId,m=8===this.state||1!==this.participants.length||f,h.info(\"isMultiparty=\".concat(m,\", reason: threadId set = \").concat(!!this.threadId,\", participants.length=\").concat(this.participants.length,\", disableIsMultipartyDependenceOnThreadId = \").concat(!!this._disableIsMultipartyDependenceOnThreadId)),this.setCallType(m?2:1,u),this.setCallUsesMixer(m,u),this.setCallOptions(l),1==(1&(v=l.callStartOptions||{}).preheatFlags)?(this.setMuted(q.ParticipantMuteState.Muted,u),this.setSpeakerMuted(!0,u),this.setCallState(11,u)):(S=!!v&&(v.muted||1==(1&v.muteFlags)),this.setMuted(S?q.ParticipantMuteState.Muted:q.ParticipantMuteState.Unmuted,u),this.setCallState(2,u)),_=(0,R.calculateJoinedFromForTelemetry)(this.meetingData,this.threadId,this.messageId,this.groupId,!!p),this.callTelemetry.setJoinedFrom(_),this.signalingSession.setJoinedFrom(_),(C=this._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,\"\",u)).catch(w.noop),this.callSettings.useLwjForAllCalls?[4,this.joinOrStartLwj(l,d,l.callStartTime,C,u,p)]:[3,2]);case 1:return y.sent(),[3,4];case 2:return[4,this.joinOrStartWithMedia(l,d,l.callStartTime,C,u,p)];case 3:y.sent(),y.label=4;case 4:return[2,C]}}))}))},PluginlessCall.prototype.joinOrStartLwj=function(l,d,u,p,h,g){return v(this,void 0,void 0,(function(){var f;return y(this,(function(m){switch(m.label){case 0:return m.trys.push([0,2,,3]),d(h,l,null,null,u,g),[4,p];case 1:return m.sent(),[3,3];case 2:return f=m.sent(),this.catchJoinOrStartCallError(f,h,this.logger.createFnLogger(\"joinOrStartLwj\",h)),[3,3];case 3:return[2]}}))}))},PluginlessCall.prototype.joinOrStartWithMedia=function(l,d,u,p,g,f){return v(this,void 0,void 0,(function(){var m,v,S,_,C,E,T,b,I,R,P,O,M=this;return y(this,(function(y){switch(y.label){case 0:m=this.logger.createFnLogger(\"joinOrStartWithMedia\",g),this.callStats.localStats.audio.start(),v=l.callStartOptions,S=v&&1&v.preheatFlags,_=(0,B.default)(m),l.callStartOptions&&l.callStartOptions.sendMediaModalities&&(this.mediaStateConfigurationHelper=new W.MediaStateConfigHelper(l.callStartOptions.sendMediaModalities)),this._preferredMpLocation&&(l.callStartOptions=l.callStartOptions||{},C=l.callStartOptions.clientEndpointDebugContent?JSON.parse(l.callStartOptions.clientEndpointDebugContent):{},l.callStartOptions.clientEndpointDebugContent=JSON.stringify(h({preferredMpLocation:this._preferredMpLocation},C))),y.label=1;case 1:return y.trys.push([1,19,,20]),!v||S?[3,3]:this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)&&this.mediaStateConfigurationHelper.isSending(2)?(this.setCallUsesMixer(!0,g),[4,this.getScreenHandle().acquire()]):[3,3];case 2:y.sent(),y.label=3;case 3:return this.mediaStateConfigurationHelper.isSending(0)&&this.setAudioOn(!0,g),this.callUsesMixer||this.mediaStateConfigurationHelper.disableModality(2),m.info(\"skipSharingModality=\".concat(!this.callUsesMixer)),_.executeSync(q.CallSetupMediaPhase.InitializeMediaSession,(function(){return M.initializeMediaSession(g)})),this.mediaSession.getSessionConfig().config.alwaysNegotiateDataChannel&&this.mediaStateConfigurationHelper.enableModality(3),this.mediaSession.createAudioElement(g),this.callUsesMixer||f||this.isOneToOnePSTNCall()||l.callVoicemailStartOptions||(this.isSomeoneStreamingVideo=!0),(E=this._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,\"\",g,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]})).catch(w.noop),T=!1,v?S?(T=!0,[4,_.execute(q.CallSetupMediaPhase.MuteInput,(function(){return M.mediaSession.muteInputAsync(g)}))]):[3,6]:[3,8];case 4:return y.sent(),[4,_.execute(q.CallSetupMediaPhase.MuteOutput,(function(){return M.mediaSession.muteOutputAsync(g)}))];case 5:return y.sent(),this.setMuted(q.ParticipantMuteState.Muted,g),this.setCallUsesMixer(!0,g),[3,8];case 6:return this.mediaStateConfigurationHelper.isSending(1)?[4,_.execute(q.CallSetupMediaPhase.StartVideoSafe,(function(){return M.startVideoSafe(g)}))]:[3,8];case 7:y.sent(),y.label=8;case 8:return(null==v?void 0:v.forceAudioSendModalityWithNullStream)&&this.mediaSession.useNullAudioStreamClient(),[4,_.execute(q.CallSetupMediaPhase.UpdateMediaModalities,(function(){return M.updateMediaModalities(void 0,g)}))];case 9:return b=y.sent(),[4,_.execute(q.CallSetupMediaPhase.CreateOffer,(function(){return M.mediaSession.createOfferAsync(g)}))];case 10:return I=y.sent(),R=_.executeSync(q.CallSetupSignalingPhase.GetSignalingMediaTypes,(function(){return M.getSignalingMediaTypes(M.calculateModalityDirections({},g))})),this.mediaStateConfigurationHelper.isSending(2)&&this.updateScreenSharingState(b,g),T?[3,13]:[4,_.execute(q.CallSetupMediaPhase.MuteUnmute,(function(){return M.muteUnmute(M._muteState===q.ParticipantMuteState.Muted,g)}))];case 11:return y.sent(),[4,_.execute(q.CallSetupMediaPhase.MuteUnmuteSpeakers,(function(){return M.muteUnmuteSpeaker(M.isSpeakerMuted,g)}))];case 12:y.sent(),y.label=13;case 13:return _.executeSync(q.CallSetupSignalingPhase.CallStart,(function(){return d(g,l,I,R,u,f)})),[4,_.execute(q.CallSetupSignalingPhase.WaitForConnect,(function(){return p}))];case 14:return y.sent(),this.isCallModeStreaming()?[3,18]:[4,_.execute(q.CallSetupSignalingPhase.WaitForAnswer,(function(){return E}))];case 15:return P=y.sent(),[4,_.execute(q.CallSetupMediaPhase.ProcessAnswer,(function(){return M.mediaSession.processAnswerAsync(P,g,!1)}))];case 16:return y.sent(),[4,_.execute(q.CallSetupMediaPhase.CompleteNegotiation,(function(){return M.completeNegotiationAsync(g)}))];case 17:y.sent(),y.label=18;case 18:return this.callTelemetry.updateOperationData(A.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,{phases:_.getTelemetryData()},g),2!==(null==v?void 0:v.screenshareDirection)&&4!==(null==v?void 0:v.screenshareDirection)||this.initializeScreenSharingControlForSharer(),[3,20];case 19:return O=y.sent(),this.catchJoinOrStartCallError(O,g,m,_.getTelemetryData()),[3,20];case 20:return[2]}}))}))},PluginlessCall.prototype.catchJoinOrStartCallError=function(l,d,u,p){var h,g=this,f=0;if(u.logFailure((0,D.getPrintableObject)(l)),(0,B.isPhaseError)(q.CallSetupMediaPhase.MuteInput,l))f=7,h={code:q.jsCallEndCodes.LocalError,subCode:q.jsCallEndSubCodes.MediaMuteMicrophoneError,phrase:(0,D.getPrintableObject)(l),causeId:d};else if((0,B.isPhaseError)(q.CallSetupMediaPhase.MuteOutput,l))f=7,h={code:q.jsCallEndCodes.LocalError,subCode:q.jsCallEndSubCodes.MediaMuteSpeakerError,phrase:(0,D.getPrintableObject)(l),causeId:d};else if(l&&(l.type===this.mediaAgent.constants.MEDIA_ERROR.incompatibleOffer||l.type===this.mediaAgent.constants.MEDIA_ERROR.permissionDeniedError||(0,B.isOneOfPhaseErrors)(q.CallSetupMediaPhase,l))){if(f=47,this.lwjFallbackInProgress)return void u.info(\"Ignoring media setup error because LWJ fallback is in progress\")}else(0,B.isPhaseError)(q.CallSetupSignalingPhase.WaitForAnswer,l)||(0,B.isPhaseError)(q.CallSetupSignalingPhase.WaitForConnect,l)?f=l.error:(0,B.isOneOfPhaseErrors)(q.CallSetupSignalingPhase,l)&&(f=7);throw this.callTelemetry.updateOperationData(A.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,this.getTelemetryFromPhaseExecution(l),d),this.callSetupFailed=!0,u.logFailure(l),Promise.all([this._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,f,\"\",d),this._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,f,\"\",d)]).then((function(){return g.stopInternal({causeId:d,terminatedReason:f,rejectReason:h})})).catch(w.noop),f},PluginlessCall.prototype.reconnectAsLwj=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h,g,f,m;return y(this,(function(v){switch(v.label){case 0:if((u=this.logger.createFnLogger(\"reconnectAsLwj\",d)).info(\"Attempting to reconnect as LWJ, terminatedReason = \".concat(l)),6===this.state||7===this.state)return u.info(\"Not reconnecting as LWJ because call state is \".concat(this.state)),[2];p=Date.now(),this._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS.START_CALL),this._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS.JOIN_CALL),this.callTelemetry.maybeRecordOperationSuccess(A.CALL_OPERATIONS.START_CALL),this.callTelemetry.maybeRecordOperationSuccess(A.CALL_OPERATIONS.JOIN_CALL),h=Date.now()-this._mediaSessionCreationTime,this.callTelemetry.updateOperationData(A.CALL_OPERATIONS.LWJ_FALLBACK,{timeToBeginFallback:h},d),this.event(\"lwjFallbackStarted\").raise(),this.lwjFallbackInProgress=!0,g=this.getRejectionInfoFromTerminatedReason(l),this.cleanUpMedia(d,g),v.label=1;case 1:return v.trys.push([1,5,,6]),[4,this.signalingSession.endAsync(g,{preventAllCallbacks:!0,causeId:d})];case 2:return v.sent(),this.signalingSession=null,this.mediaRelayWhiteListingIssue=!1,this.initializeSignalingSession(this._participantId),this.signalingSession.setGroupId(this.groupId),this.signalingSession.setThreadId(this.threadId),this.signalingSession.setCallOptions(this.signalingSessionCallOptions),[4,this.signalingSession.ensureMessageChannelReady(d)];case 3:return v.sent(),f={suppressDialout:!0,onBehalfOf:this.onBehalfOfMri,isLwj:!0},this.setCallOptions({callStartTime:p,callStartOptions:{}}),this.setInitialTelemetry(A.CALL_OPERATIONS.START_CALL,this.callOptions,\"\",d),[4,this.signalingSession.startOutgoingCall(null,null,f,null,d)];case 4:return v.sent(),[3,6];case 5:return m=v.sent(),u.logFailure(m),this.stopInternal({causeId:d}),[3,6];case 6:return[2]}}))}))},PluginlessCall.prototype.addCallMeBackParticipant=function(l,d,u){var p=this,g=this._participantOperationHandler.waitForOperation(A.PARTICIPANT_OPERATIONS.CALL_ME_BACK,l),f=this.logger.createFnLogger(A.PARTICIPANT_OPERATIONS.CALL_ME_BACK,u),m={id:l,assertedId:d};return this.signalingSession.callMeBackAsync(m).then((function(){f.logSuccess(\"successfully executed call me back, participantId = \".concat(V.scrubMriOrOmit(l))),p._participantOperationHandler.resolveOperation(A.PARTICIPANT_OPERATIONS.CALL_ME_BACK,0,l)})).catch((function(g){f.logFailure(\"Call me back failed, participantId = \".concat(V.scrubMriOrOmit(l),\", error = \").concat(g)),p._handleParticipantOperationFailure(A.PARTICIPANT_OPERATIONS.CALL_ME_BACK,g,u,d,!1);var m=p._processError(g),v={};m&&(v=h({},m)),v.failureReason=m.reason?m.reason:11,p._participantOperationHandler.rejectOperation(A.PARTICIPANT_OPERATIONS.CALL_ME_BACK,v,l)})),g},PluginlessCall.prototype.addParticipantsToCall=function(l,d,u,p,h,g,f,m){var S=this,C=this.logger.createFnLogger(\"addParticipantsToCall\",d);l.forEach((function(l){l.setState(1,void 0,d)}));var T=l.map((function(l){return{id:l.mri}}));C.info(\"participantIds=\".concat(l.map((function(l){return V.scrubMriOrOmit(l.id)})),\", disableUnmute=\").concat(f));var b={additionalData:u,groupId:p,threadId:h,messageId:g,disableUnmute:f,alternateId:m};try{var I=this.signalingSession.addParticipantsAsync(T,b,d);return E.zip(I,T).map((function(l){var u=_(l,2),p=u[0],h=u[1];return v(S,void 0,void 0,(function(){var l,u,g,f,m,v;return y(this,(function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),[4,p];case 1:return l=y.sent(),this.signalingNotifications.onParticipantJoined(l,d),u=this._getParticipantLegId(this.getParticipant(h.id)),g=u?{participantLegId:u}:{},this.callTelemetry.recordOperationSuccess(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{code:A.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:\"\"},l.id,d,g),[3,3];case 2:throw f=y.sent(),m=this._handleParticipantOperationFailure(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,f,d,h.id),v=m.reason,this._removeParticipant(h,d,v),v;case 3:return[2]}}))}))}))}catch(l){return C.logFailure(\"Participants was not added to call, error=\".concat(l)),E.range(T.length).map((function(){return Promise.reject(1)}))}},PluginlessCall.prototype.mergeCallByAddParticipantWithReplaces=function(l,d,u,p,h,g,f){return v(this,void 0,void 0,(function(){var m,v,S,_,C,E,T,b,I,R,P;return y(this,(function(y){switch(y.label){case 0:return m=this.logger.createFnLogger(\"mergeCallByAddParticipantWithReplaces\",g),v={additionalData:l.additionalData,groupId:l.groupId,threadId:l.threadId,messageId:l.messageId,callIdToReplace:u.callId,replacementType:p},[4,this.signalingSession.addParticipantsAsync(d,v,g)];case 1:S=y.sent(),_=0,y.label=2;case 2:if(!(_<S.length))return[3,7];C=3===p?d[_].participantId:d[_].id,y.label=3;case 3:return y.trys.push([3,5,,6]),[4,S[_]];case 4:return E=y.sent(),m.logSuccess(\" [participantInfos id =\".concat(V.scrubMriOrOmit(d[_].id),\"]\")),this.signalingNotifications.onParticipantJoined(E,g),T=d[_].replacementParticipantId?{debugContent:{replacementParticipantLegId:d[_].replacementParticipantId},participantLegId:d[_].participantId}:{participantLegId:d[_].participantId},P={code:A.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:\"\"},this.callTelemetry.recordOperationSuccess(h,P,C,g,T),this._callOperationHandler.maybeResolveOperation(h,P,C,g),[3,6];case 5:return b=y.sent(),m.logFailure(\"Participant was not added to call, error=\".concat((0,D.safeJsonStringify)(b))),I=this._handleParticipantOperationFailure(h,b,g,C),R=I.reason,this._removeParticipant(d[_],g,R),P=b?b.endCode:R||0,this._callOperationHandler.maybeRejectOperation(h,P,C,g),[3,6];case 6:return _++,[3,2];case 7:return[2,Promise.resolve(f)]}}))}))},PluginlessCall.prototype.admitParticipantToCall=function(l,d,u){var p=this,h=this.logger.createFnLogger(\"admitParticipantToCall\",d),g={id:l};return h.info(\"start\"),this.signalingSession.admitParticipantAsync(g,d).then((function(g){h.info(\"successfully admitted participant to call, participantId = \".concat(V.scrubMriOrOmit(l)));var f=u?{participantLegId:u}:{},m={code:A.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:\"\"};p.callTelemetry.recordOperationSuccess(A.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,m,l,d,f)})).catch((function(u){h.logFailure(\"Participant was not admitted to call, error=\".concat(u));var g=p._handleParticipantOperationFailure(A.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,u,d,l);return Promise.reject(g)}))},PluginlessCall.prototype._processError=function(l){var d,u={reason:d};if(l&&l.endCode){var p=W.getTerminationCode(l.endCode.code,l.endCode.subCode);d=PluginlessCall.getParticipantReasonFromTerminatedReason(p),u.reason=d,u.code=l.endCode.code,u.subCode=l.endCode.subCode,u.resultCategories=l.endCode.resultCategories,u.phrase=l.endCode.phrase}else u.phrase=\"\".concat(l);return this.logger.info(\"_processError error=\".concat(l,\" telemetryData=\").concat(JSON.stringify(u))),u},PluginlessCall.prototype._handleParticipantOperationFailure=function(l,d,u,p,h){void 0===h&&(h=!0),this.callTelemetry.updateOperationData(l,{error:(0,D.getPIISafeObject)(d)},u,p);var g=this._processError(d),f=this.getParticipant(p);g.code&&f&&(f.callEndDiagnosticsInfo={callControllerCode:g.code,callControllerSubCode:g.subCode,phrase:g.phrase,resultCategories:g.resultCategories});try{if(h){var m=this._getParticipantLegId(f),v=m?{participantLegId:m}:{};this.callTelemetry.recordOperationFailure(l,g,p,u,v)}}catch(l){this.logger.info(\"_handleParticipantOperationFailure errow during recordOperationFailure \".concat(l))}return g},PluginlessCall.prototype._getParticipantLegId=function(l){return E.has(l,\"endpoints.endpointDetails\")&&l.endpoints.endpointDetails.length&&l.endpoints.endpointDetails[0].participantId?l.endpoints.endpointDetails[0].participantId:null},PluginlessCall.prototype.isOneToOnePSTNCall=function(){var l=this.signalingSession.isIncomingCall?this.callerMri:this.participants.length>0?this.participants[0].id:\"\";return this.isOneToOneCall()&&E.startsWith(l,k.PSTN_MRI_PREFIX)&&(!this.incomingCallType||!this.callUsesMixer)},PluginlessCall.prototype.updateMediaModalities=function(l,d){return void 0===l&&(l={}),void 0===d&&(d=(0,P.generateCauseId)()),v(this,void 0,void 0,(function(){var u,p;return y(this,(function(h){switch(h.label){case 0:return(p=this.logger.createFnLogger(\"updateMediaModalities\",d)).info(\"callUsesMixer=\".concat(this.callUsesMixer,\",isSomeoneSharing=\").concat(this.isSomeoneSharing,\",isSomeoneStreamingVideo=\").concat(this.isSomeoneStreamingVideo)),p.info(\"options=\".concat((0,D.safeJsonStringify)(l),\",requestHoldState=\").concat(this.requestedHoldState,\",requestedScreenSharingState=\").concat(this.mediaStateConfigurationHelper.isSending(2))),u=l.modalityOverride?l.modalityOverride:this.requestedHoldState&&!this.isMuteOnHold?this.getMediaModalitiesForHold(d):this.calculateModalityDirections(l&&l.offered,d),p.info(\"modalities=\".concat((0,D.safeJsonStringify)(u))),[4,this.mediaSession.configureModalitiesAsync(u,d)];case 1:return h.sent(),[2,u]}}))}))},PluginlessCall.prototype.calculateModalityDirections=function(l,d){void 0===l&&(l={});var u=this.logger.createFnLogger(\"calculateModalityDirections\",d);u.info(\"callUsesMixer=\".concat(this.callUsesMixer));var p={audio:this.calculateAudioDirection(l.audio,u),video:this.calculateVideoDirection(l.video,u),sharing:this.calculateSharingDirection(l.sharing,u),data:this.calculateDataDirection(l.data,u)};return u.info(\"done, modalities=\".concat((0,D.safeJsonStringify)(p))),this.deleteExtraneousModalities(p,d),p},PluginlessCall.prototype.calculateAudioDirection=function(l,d){return d.info(\"calculateAudioDirection, offer=\".concat(l,\", requestedAudioState=\").concat(this.mediaStateConfigurationHelper.isSending(0))),this.mediaStateConfigurationHelper.isInactiveOrDisabled(0)||\"inactive\"===l?\"inactive\":this.mediaSession.getAllowedModalities().audio.some((function(l){return l===te.streamDirections.send||l===te.streamDirections.sendReceive}))?\"sendrecv\":\"recvonly\"},PluginlessCall.prototype.calculateVideoDirection=function(l,d){var u=this.mediaStateConfigurationHelper.isSending(1);if(d.info(\"calculateVideoDirection, offer=\".concat(l,\", requestedVideoState=\").concat(u,\", isSomeoneStreamingVideo=\").concat(this.isSomeoneStreamingVideo)),this.mediaStateConfigurationHelper.isInactiveOrDisabled(0))return\"inactive\";var p=u,h=this.isSomeoneStreamingVideo||this.callUsesMixer;return l&&(p=p&&(\"sendrecv\"===l||\"sendonly\"===l),h=h&&(\"sendrecv\"===l||\"recvonly\"===l)),p?\"sendrecv\":h?\"recvonly\":\"inactive\"},PluginlessCall.prototype.calculateSharingDirection=function(l,d){return d.info(\"calculateSharingDirection, offer=\".concat(l,\", requestedScreenSharingState=\").concat(this.mediaStateConfigurationHelper.isSending(2),\", isSomeoneSharing=\").concat(this.isSomeoneSharing)),\"inactive\"===l?\"inactive\":this.mediaStateConfigurationHelper.isSending(2)?\"sendonly\":this.isSomeoneSharing||this.callUsesMixer?\"recvonly\":void 0},PluginlessCall.prototype.calculateDataDirection=function(l,d){var u=this.mediaStateConfigurationHelper.isSending(3),p=this.mediaStateConfigurationHelper.isDisabled(3);if(d.info(\"calculateDataDirection, offer=\".concat(l,\", dataEnabled=\").concat(u,\", disabled=\").concat(p)),this.allowDataChannel())return p||!u?void 0:\"inactive\"===l?\"inactive\":\"sendrecv\";d.info(\"calculateDataDirection, disabling data since ECS flag prohibits it\")},PluginlessCall.prototype.getMediaModalitiesForHold=function(l){this.logger.info(\"[\".concat(l,\"][getMediaModalitiesForHold]\"));var d=\"inactive\",u={audio:d,video:d,data:this.allowDataChannel()?d:void 0,sharing:d};return this.deleteExtraneousModalities(u,l),u},PluginlessCall.prototype.deleteExtraneousModalities=function(l,d){!(0,ne.hasSendDirectionality)(l.video)&&this.mediaStateConfigurationHelper.isDisabled(1)&&(this.logger.info(\"[\".concat(d,\"][deleteExtraneousModalities] skipping videoModality\")),delete l.video),!(0,ne.hasSendDirectionality)(l.sharing)&&this.mediaStateConfigurationHelper.isDisabled(2)&&(this.logger.info(\"[\".concat(d,\"][deleteExtraneousModalities] skipping sharingModality\")),delete l.sharing)},PluginlessCall.prototype.getSignalingMediaTypes=function(l){var d=this,isSendActive=function(l){return l===d.mediaAgent.constants.MEDIA_STATE.send||l===d.mediaAgent.constants.MEDIA_STATE.sendReceive},u=[];return l.audio&&l.audio!==this.mediaAgent.constants.MEDIA_STATE.inactive&&u.push(\"Audio\"),isSendActive(l.video)&&u.push(\"Video\"),l.sharing===this.mediaAgent.constants.MEDIA_STATE.send?u.push(\"ScreenSharer\"):l.sharing===this.mediaAgent.constants.MEDIA_STATE.receive&&u.push(\"ScreenViewer\"),u},PluginlessCall.prototype.initializeScreenSharingControlForSharer=function(l){if(this.allowScreenSharingControl()&&this.getlocalScreenShareStream()){var d=\"\";this.mediaSession.getLocalMediaTrackId&&(d=this.mediaSession.getLocalMediaTrackId(\"ScreenShare\")),this.screenSharingControl.initControlForSharer(l,d)}},PluginlessCall.prototype.initializeSignalingSession=function(l){var d=this;if(this.signalingSession)this.logger.info(\"Session already exists!\");else{var u=b.CA_CONSTANTS.CALL_STATUS;if(this.localSignalingParticipant={id:(0,k.generateAliasedMri)(\"\".concat(k.MRI_SKYPE_PREFIX).concat(this.currentUserSkypeIdentity.id),this.currentUserSkypeIdentity.sipUri),displayName:this.currentUserSkypeIdentity.displayName,endpointDetails:[],languageId:null,participantId:l,endpointId:null},this.accountConfiguration&&(this.localSignalingParticipant.applicationType=this.accountConfiguration.applicationType,this.callTelemetry.setApplicationType(this.accountConfiguration.applicationType),this.localSignalingParticipant.ring=this.accountConfiguration.ring,this.callTelemetry.setRing(this.accountConfiguration.ring),this.localSignalingParticipant.region=this.accountConfiguration.region,this.callTelemetry.setRegion(this.accountConfiguration.region),this.localSignalingParticipant.userHexCID=this.accountConfiguration.userHexCID,this.callTelemetry.setUserHexCID(this.accountConfiguration.userHexCID),this.localSignalingParticipant.partition=this.accountConfiguration.partition,this.callTelemetry.setPartition(this.accountConfiguration.partition),this.localSignalingParticipant.acsResourceId=this.accountConfiguration.acsResourceId,this.callTelemetry.setAcsResourceId(this.accountConfiguration.acsResourceId),this.callStats.setAcsResourceId(this.accountConfiguration.acsResourceId),this.accountConfiguration.serviceUrls)){var p=this.accountConfiguration.serviceUrls.calling_conversationServiceUrl,g=this.accountConfiguration.serviceUrls.calling_uploadLogRequestUrl;this.signalingAgent.updateUrls(p,g,this.accountConfiguration.enforceUrls)}this.callStats.localStats.setLocalUserId(this.localSignalingParticipant.id),this._callOperationHandler&&this._callOperationHandler.resetOperationChain(),this.signalingNotifications={onCallStatusChanged:function(l,p,g){void 0===g&&(g=(0,P.generateCauseId)());var f=d.logger.createFnLogger(\"onCallStatusChanged\",g),m=\"[status=\".concat(l,\"]\");if(p&&(m+=\"[reason=\".concat((0,D.safeJsonStringify)(p),\"]\"),void 0!==p.code&&(d.callEndDiagnosticsInfo={callControllerCode:p.code,callControllerSubCode:p.subCode,phrase:p.phrase,resultCategories:p.resultCategories},(p.overflowJoinInformation||p.registrationInformation)&&(d.callEndDiagnosticsInfo.additionalDiagnostics={overflowInformation:p.overflowJoinInformation,registrationInformation:p.registrationInformation}))),f.info(m),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SIGNALING_STATE_CHANGED,{status:l,reason:p},g),l===u.CONNECTING)d._transferredCallAcceptanceCallback&&(f.info(\"[Transfer] Invoke call acceptance callback for original call\"),d._transferredCallAcceptanceCallback()),d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,g);else if(l===u.RINGING)2===d.audioStreamState?(d.setCallState(9,g),d.participants.forEach((function(l){return l.setState(6,void 0,g)}))):d.participants.forEach((function(l){return l.setState(2,void 0,g)})),d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,g);else if(l===u.CONNECTED_FOR_ROSTER_ONLY)d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,g),d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,void 0,void 0,g);else if(l===u.CONNECTED){d._callIsSetupComplete=!0;var v=d.getLocalSignalingEndpointDetails();((null==v?void 0:v.isLobby)||(null==v?void 0:v.streamLobby))&&(d._callInLobby=!0,d.updateCapabilities(g,!0));var y=d._enableStaging&&d.signalingSession.participantManager.localParticipant.isStaging;if(11===d.state)d.setCallState(12,g);else if(d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.JOIN_PREHEATED_CALL))f.info(\"wait for joinPreheatedCall to resolved\");else if(d._callInLobby)f.info(\"[inLobby] Override Connected state from signaling agent\"),d.setCallState(10,g);else if(y)d.setCallState(13,g);else{if(3===d.state)return;d.setCallState(3,g),d.handleRemoteParticipantStateInOneToOneCall(g)}d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,g),d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,g),d.reportTsCallingTelemetry(!0)}else if(l===u.LOCAL_TERMINATED||l===u.REMOTE_TERMINATED){var S=d.callSetupFailed?7:W.convertReason(p);if(8===d.state&&d._callOperationHandler.hasAtleastOneOfPendingOperation([A.CALL_OPERATIONS.START_CALL,A.CALL_OPERATIONS.JOIN_CALL,A.CALL_OPERATIONS.START_WITH_MEETING_DATA,A.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA]))return d.signalingSession.resetState(),d._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS.SUBSCRIBE,S,void 0,g),d._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,S,void 0,g),void f.info(\"Subscribe failed, there is pending start/join operation, ignore call end message\");if((2===d.state||6===d.state||8===d.state)&&d._callOperationHandler.hasAtleastOneOfPendingOperation([A.CALL_OPERATIONS.START_CALL,A.CALL_OPERATIONS.JOIN_CALL,A.CALL_OPERATIONS.START_WITH_MEETING_DATA,A.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,A.CALL_OPERATIONS.SUBSCRIBE,A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA])){var _={code:d.callEndDiagnosticsInfo.callControllerCode,subCode:d.callEndDiagnosticsInfo.callControllerSubCode,phrase:d.callEndDiagnosticsInfo.phrase,reason:S};d._callOperationHandler.maybeRejectOperations([A.CALL_OPERATIONS.ACCEPT,A.CALL_OPERATIONS.JOIN_CALL,A.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,A.CALL_OPERATIONS.JOIN_PREHEATED_CALL,A.CALL_OPERATIONS.START_CALL,A.CALL_OPERATIONS.START_CALL_AND_UNPARK,A.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,A.CALL_OPERATIONS.START_CALL_WITH_NUDGE,A.CALL_OPERATIONS.START_WITH_MEETING_DATA,A.CALL_OPERATIONS.SUBSCRIBE,A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA],S,void 0,g,_)}if(d.signalingSession.acceptedElsewhereBy&&(d.acceptedElsewhereBy={id:d.signalingSession.acceptedElsewhereBy.id,displayName:d.signalingSession.acceptedElsewhereBy.displayName}),1!==S&&(d.mediaRelayWhiteListingIssue&&(S=53),f.info(\"[terminated][reason=\".concat((0,D.safeJsonStringify)(p),\"]\"))),d.lwjFallbackInProgress&&d.callTelemetry.recordOperationFailure(A.CALL_OPERATIONS.LWJ_FALLBACK,S),d._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,S,\"\",g),d._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,S,\"\",g),d.setCallState(7,g,S),d.participants.forEach((function(l){return l.setState(4,void 0,g)})),!d.disconnectingPromise){var C=h(h({},p),{remoteTerminated:l===u.REMOTE_TERMINATED});d.disconnectingPromise=d.cleanUp(g,C).catch((function(l){f.logFailure(\"Error when cleaning up the call, callId = \".concat(d.callId,\", error = \").concat(l))}))}}},onOffer:function(l,u){void 0===u&&(u=(0,P.generateCauseId)());var p=d.logger.createFnLogger(\"onOffer\",u);d.isCallModeStreaming()?p.info(\"skipped due to being in streaming mode\"):(p.info(\"\".concat((0,D.safeJsonStringify)(E.omit(l,\"mediaContent\",\"remoteParticipantId\")))),d.setMediaLegId(l.mediaContent.mediaLegId),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.WEB_ON_OFFER,d.prepareTelemetryForOfferAnswer(l),u),l.transferor&&l.transferor.details&&l.transferor.details.id&&d.setTransferorMri(l.transferor.details.id),l.transferor&&l.transferor.transferorType&&(d.transferorType=l.transferor.transferorType),l.transferor&&l.transferor.details&&l.transferor.details.displayName&&(d.transferorDisplayName=l.transferor.details.displayName),d.clientTransferContext=l.clientTransferContext,d.invitationData=l.invitationData,d.spamRiskLevel=l.riskLevel,d.spamStirAttestation=l.stirAttestation,l.mediaContent.isTwoPartyToMultiPartyEscalation&&d.setIsEscalationInProgress(!0,u),l.renegotiation?d.requestedHoldState&&d._pendingParkPromise?d.renegotiateIncoming(l.mediaContent,u):d._callOperationHandler.executeChained((function(){return d.renegotiateIncoming(l.mediaContent,u)}),A.CALL_OPERATIONS_INTERNAL.RENEGOTIATE_INCOMING,u,u,void 0,void 0,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}):(p.info(\"resolving attach / offer promise\"),d.attachToCallAndGetOffer.resolve(l.mediaContent)))},onNewOffer:function(l,u){void 0===u&&(u=(0,P.generateCauseId)());var p=d.logger.createFnLogger(\"onNewOffer\",u);d.newOfferRequestDeferred?(p.info(\"onNewOffer\"),d.newOfferRequestDeferred.resolve(l.mediaContent)):p.info(\"callback received but new offer was not requested\")},onAnswer:function(l,u){void 0===u&&(u=(0,P.generateCauseId)());var p=d.logger.createFnLogger(\"onAnswer\",u);d.isCallModeStreaming()?p.info(\"skipped due to being in streaming mode\"):(p.info(\"\".concat((0,D.safeJsonStringify)(E.omit(l,\"mediaContent\",\"remoteParticipantId\")))),d.setMediaLegId(l.mediaContent.mediaLegId),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.WEB_ON_ANSWER,d.prepareTelemetryForOfferAnswer(l),u),l.renegotiation?(p.info(\"resolving previous renegotiation promise\"),d.renegotiationAnswerDeferred.resolve(l.mediaContent)):(p.info(\"resolving final answer promise\"),l.provisional?d.mediaSession.processAnswerAsync(l.mediaContent,u,!0,l.remoteEndpointId):(d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS_INTERNAL.WAIT_FOR_ANSWER,l.mediaContent,void 0,u),d.handleRemoteParticipantStateInOneToOneCall(u))),l.provisional||!l.mediaContent.fromMixer||d.callUsesMixer||d._callOperationHandler.executeChained((function(){return d.setCallUsesMixer(!0,u),d.mediaSession.reconnectAsync(u,!0)}),A.CALL_OPERATIONS_INTERNAL.CALL_ESCALATED_TO_CONFERENCE,u,u,void 0,void 0,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}))},onMediaAcknowledgementSuccess:function(l,u){void 0===u&&(u=(0,P.generateCauseId)()),d.logger.info(\"isRenegotiation: \".concat(l),\"onMediaAcknowledgementSuccess\",u),d._callOperationHandler.resolveOperation(A.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,void 0,void 0,u)},onMediaAcknowledgementFailure:function(l,u,p){void 0===p&&(p=(0,P.generateCauseId)()),d.logger.createFnLogger(\"onMediaAcknowledgementFailure\",p).logFailure((0,D.safeJsonStringify)(u)),d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,u,p)},onMediaRenegotiationRejection:function(l,u){void 0===u&&(u=(0,P.generateCauseId)()),d.logger.createFnLogger(\"onMediaRenegotiationRejection\",u).logFailure((0,D.safeJsonStringify)(l)),d.renegotiationAnswerDeferred.reject(l)},onRosterHandlingComplete:function(){d.logger.info(\"[onRosterHandlingComplete] \".concat(d._publishedStatesModified)),d._publishedStatesModified!==ae.None&&(d.processPublishedStates(),d._publishedStatesModified=ae.None)},onMeetingGroupDetailsUpdated:function(l,u){void 0===u&&(u=(0,P.generateCauseId)()),d.meetingGroupDetails!==l&&(d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.UPDATE_MEETING_GROUPS_DETAILS,l,u),d.logger.info(\"[\".concat(u,\"][onMeetingGroupDetailsUpdated] update meetingGroupDetails from \").concat(JSON.stringify(d.meetingGroupDetails),\" to \").concat(JSON.stringify(l))),d.meetingGroupDetails=l,d.raiseChanged())},onSelfParticipantUpdated:function(l,u){void 0===u&&(u=(0,P.generateCauseId)()),d.logger.info(\"[\".concat(u,\"][onSelfParticipantUpdated]\")),d.updateLocalParticipant(l,u),d.raiseChanged()},onParticipantMriUpdated:function(l,u,p){void 0===p&&(p=(0,P.generateCauseId)()),d.logger.info(\"[\".concat(p,\"][onParticipantMriUpdated]\"));var h=d.getParticipant(l);h&&(h.id=u,d.raiseChangedDeferred())},onParticipantUpdated:function(l,u){void 0===u&&(u=(0,P.generateCauseId)()),d.logger.info(\"[\".concat(u,\"][onParticipantUpdated]: \").concat(J.scrubSignalingParticipant(l)));var p=d.getOrCreateParticipant(l.id,u);p.displayName=l.displayName;var h=PluginlessCall.getStreamsFromEndpoints(l.endpointDetails),g=E.some(l.endpointDetails,(function(l){return null==l?void 0:l.streamInformation}));d.callUsesMixer||h.length>0||g?(d.isCallModeStreaming()||p.updateStreams(h,u),d.updateCallParticipantFromSignalingParticipant(p,l,u)):p.setState(3,void 0,u),p.processParticipantDetails(l,d.getSelfClientEndpointCapabilities()),d.updatePublishedStates(l),d.updateMediaStatus(u),d.raiseChangedDeferred()},onParticipantRemoved:function(l,u,p){if(void 0===u&&(u=(0,P.generateCauseId)()),void 0===p&&(p=!1),d.logger.info(\"[\".concat(u,\"][onParticipantRemoved]\")),p&&d._enableAddParticipantPromiseOptimization){var h=d.getOrCreateParticipant(l.id,u);d.callTelemetry.recordOperationSuccess(A.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,null,h.id,u,{participantJoinedButReplaced:\"Participant joined with original MRI and replaced with participant of RNL MRI\"})}else d.callTelemetry.recordOperationSuccess(A.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,null,l.id,u),d._participantOperationHandler.maybeRejectOperation(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,1,l.id,u);d._removeParticipant(l,u),d.removePublishedStatesByParticipant(l.id),d.updateMediaStatus(u)},onParticipantJoined:function(l,u){void 0===u&&(u=(0,P.generateCauseId)()),d.logger.info(\"[\".concat(u,\"][onParticipantJoined]\"));var p=d.getOrCreateParticipant(l.id,u);p.displayName=l.displayName,0===p.state&&p.setState(1,void 0,u);var h=PluginlessCall.filterVirtualEndpoints(l.endpointDetails),g=h&&[h[0]],f=PluginlessCall.getStreamsFromEndpoints(g),m=E.some(l.endpointDetails,(function(l){return null==l?void 0:l.streamInformation}));d.callUsesMixer||f.length>0||m?(d.isCallModeStreaming()||p.updateStreams(f,u),d.updateCallParticipantFromSignalingParticipant(p,l,u),d.updateMediaStatus(u)):(d.handleRemoteParticipantJoinedInOneToOneCall(l,u),d.handleRemoteParticipantStateInObservingCall(p,l,u),l.acceptedBy&&l.acceptedBy!==l.id&&(p.acceptedBy=l.acceptedBy)),d.callTelemetry.recordOperationSuccess(A.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,(0,R.getEndpointInformationForTelemetry)(l.endpointDetails),p.id,u),p.processParticipantDetails(l,d.getSelfClientEndpointCapabilities()),d.updatePublishedStates(l),d.raiseChangedDeferred()},onCallModeChanged:function(l,u){if(d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.CALL_MODE_CHANGED,{newCallMode:l,oldCallMode:d._callMode},u),d.logger.info(\"onCallModeChanged[\".concat(u,\"]: new=\").concat(l,\" old=\").concat(d._callMode,\" \")),l&&d._callMode!==l){if(d._callMode=l,d.isCallModeStreaming()){d.logger.info(\"onCallModeChanged[\".concat(u,\"]: mode=streaming, cleaning streams and media...\"));var p={code:q.jsCallEndCodes.Success,subCode:q.jsCallEndSubCodes.DowngradeToStreamingClient,phrase:q.jsCallEndPhrase.DowngradeToStreamingClient};d.cancelAllCallingOperationsDueToStreaming(u),d.cleanUpDueToStreaming(u,p)}d.updateCapabilities(u),d.raiseChanged()}},getRemoteParticipantCollection:function(){return d.participants.map((function(l){return l.toCafeParticipant()}))},onReTargetCompletedSuccess:function(l){var u=d.logger.createFnLogger(\"onReTargetCompletedSuccess\",l);u.info(\"started, isEscalationInProgress=\".concat(d.isEscalationInProgress)),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.WEB_ON_RETARGET_SUCCESS,void 0,l),d.callStats.localStats.call.event(G.CallEvent.MediaRetargetSucceeded);var p=d.isEscalationInProgress;d.screenSharingControl&&d.screenSharingControl.shutdownControlForViewer(),d.mediaSession.completeEscalationAsync(l).then((function(){u.logSuccess(\"completeEscalationAsync\"),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.WEB_ON_ESCALATION_SUCCESS,void 0,l),d.handleCallEscalation(p,l)})).catch((function(p){u.logFailure(\"completeEscalationAsync, error=\".concat((0,D.getPrintableObject)(p))),d.setIsEscalationInProgress(!1,l),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.WEB_ON_ESCALATION_FAILURE,(0,D.getPIISafeObject)(p),l),d.stopInternal({causeId:l,terminatedReason:47})}))},onReTargetCompletedFailure:function(l,u){d.logger.createFnLogger(\"onReTargetCompletedFailure\",u).logFailure(\"reason=\".concat((0,D.getPrintableObject)(l),\", isEscalationInProgress=\").concat(d.isEscalationInProgress)),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.WEB_ON_RETARGET_FAILURE,(0,D.getPIISafeObject)(l),u),d.isEscalationInProgress&&(d.setIsEscalationInProgress(!1,u),d.setCallUsesMixer(!1,u)),d.callStats.localStats.call.event(G.CallEvent.MediaRetargetFailed),d.mediaSession.rejectEscalationAsync(l,u)},onChatModalitySetupFailed:function(l){d.logger.debug(\"onChatModalitySetupFailed: \".concat(l))},onConversationUpdated:function(l,u){d.logger.info(\"onConversationUpdated[\".concat(u,\"]: \").concat((0,D.safeJsonStringify)(l))),d.setConversationType(l.conversationType,u),d.setMessageId(l.teamsMessageId,u),d.setGroupId(l.groupId,u),d.setThreadId(l.threadId,u),d.setCallType(l.isMultiParty?2:1,u),d._commandUrlPresence=l.commandUrlPresence,d.updateCapabilities(u),d.region=l.region,d.meetingData=l.meetingData,d.meetingInfo=l.meetingInfo,d.callLimits=l.callLimits,d.raiseChanged()},onMeetingDetailsUpdated:function(l){d.meetingDetails=l,!d.enableRealtimeTelemetry&&d.meetingDetails.capabilities&&d.meetingDetails.capabilities.enableRealtimeTelemetry&&(d.mediaSession.enableRealTimeTelemetry(),d.enableRealtimeTelemetry=!0),d.raiseChanged()},onParticipantCountsUpdated:function(l){E.isEqual(l,d.participantCounts)||(d.participantCounts=h(h({},A.EMPTY_COUNTS),l),d.event(\"participantCountsUpdated\").raise(d.participantCounts))},updateIsSharedLineAppearanceV2Activated:function(l){d.isSharedLineAppearanceV2Activated!==l&&(d.logger.info(\"_updateIsSharedLineAppearanceV2Activated: new value is \".concat(l)),d.isSharedLineAppearanceV2Activated=l,d.event(\"sharedLineAppearanceV2ActivatedChanged\").raise(d.isSharedLineAppearanceV2Activated))},onBroadcastMeetingUpdated:function(l){l&&(d.broadcastMeeting&&d.broadcastMeeting.metadataChanged(JSON.stringify(l)),d.broadcastMetadata=l,d.raiseChanged())},onBroadcastMeetingConnected:function(l,u){d.logger.info(\"[\".concat(u,\"][onBroadcastMeetingConnected]\")),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)&&(l.code===A.TRANSACTION_END_CODE.SUCCESS?d._callOperationHandler.resolveOperation(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,l,u):d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,l,u))},onBroadcastMeetingEnded:function(l,u){d.logger.info(\"[\".concat(u,\"][onBroadcastMeetingEnded]\")),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)&&d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,l,u),d.signalingSession.endBroadcastMeeting(u)},onTransferRequested:function(l,u){var p=d.logger.createFnLogger(\"onTransferRequested\",u);p.info(\"Transfer: onTransferRequested, target participant\",J.scrubSignalingParticipant(l.target));var h=\"\",g=\"\",f=0;\"voicemail\"===l.target.endpointType&&(f=2);try{h=l.target.id,g=l.transferor.details.id,l&&l.parkType&&\"none\"!==l.parkType&&(f=1)}catch(l){return p.logFailure(l),d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.ON_TRANSFER_REQUESTED_INVALID),void d.signalingSession.signalTransferCompletedAsync({code:W.getCSAEndCode(7)})}var m=d.convertToTransferType(f,l.parkType),v={transferContext:{transferorMri:g,targetMri:h,transferType:f,context:{target:l.target,transferor:l.transferor,transferContext:l.transferContext,newCallModalities:l.newCallModalities,links:l.links,replacementDetails:l.replacementDetails,isConsultative:l.isConsultative,callAcceptanceCallback:function(){p.logSuccess(\"Transfer: callAcceptanceCallback called\"),d.signalingSession.signalTransferAcceptedAsync(m)}}},onCompleted:function(l){p.logSuccess(\"Transfer: onCompleted called\"),d.signalingSession.signalTransferCompletedAsync({code:W.getCSAEndCode(l)})}};d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.ON_TRANSFER_REQUESTED,{transferType:f}),d.event(\"transferRequested\").raise(v)},onTransferAccepted:function(l){d.logger.info(\"Transfer: onTransferAccepted\"),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&d._setTransferState(2),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.BLIND_TRANSFER)&&d._callOperationHandler.maybeResolveOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,void 0,l),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.PARK_CALL)&&d._setParkState(2)},onTransferCompleted:function(l,u){var p=d.logger.createFnLogger(\"onTransferCompleted\",u);p.info(\"Transfer: onTransferCompleted\");var h=l.transferCompletion,g=W.convertReason(h);if(h&&(p.info(\"Transfer: Call Transfer Code: \".concat(h.code)),0===h.code)){if(d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(d._callOperationHandler.resolveOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,void 0,u),d._setTransferState(3)),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)){var f={code:A.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:A.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE};d._callOperationHandler.resolveOperation(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,f,void 0,u),d._setTransferState(3)}d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.PARK_CALL)&&(l.unparkContent&&l.unparkContent.CallParkAdditionalContext&&l.unparkContent.CallParkAdditionalContext.ConversationControllerLocation&&(d.serverHoldLocation=l.unparkContent.CallParkAdditionalContext.ConversationControllerLocation),l.unparkContent&&void 0!==l.unparkContent.pickupCode?(d._callOperationHandler.resolveOperation(A.CALL_OPERATIONS.PARK_CALL,l.unparkContent.pickupCode,void 0,u),p.logSuccess(\"pickupCode=\".concat(l.unparkContent.pickupCode)),d._setParkState(3)):(d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS.PARK_CALL,32,u),p.logFailure(\"terminatedReason=\".concat(g)),d._setParkState(4)))}else{if(d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,g,void 0,u),p.logFailure(\"terminatedReason=\".concat(g)),d.transferDiagnosticsInfo={callControllerCode:h.code,callControllerSubCode:h.subCode,phrase:h.phrase,resultCategories:h.resultCategories},d._setTransferState(4)),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE)){var m={code:h.code,subCode:h.subCode,resultCategories:h.resultCategories};d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,m,void 0,u)}d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.PARK_CALL)&&(d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS.PARK_CALL,g,void 0,u),p.logFailure(\"terminatedReason=\".concat(g)),d.transferDiagnosticsInfo={callControllerCode:h.code,callControllerSubCode:h.subCode,phrase:h.phrase,resultCategories:h.resultCategories},d._setParkState(4))}},onParkCompleted:function(l,u){d.logger.createFnLogger(\"onParkCompleted\",u).info(\"transactionEnd \".concat((0,D.getPrintableObject)(l))),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.PARK_CALL)&&(0===l.code?(d._callOperationHandler.resolveOperation(A.CALL_OPERATIONS.PARK_CALL,\"\",void 0,u),d._setParkState(3)):(d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS.PARK_CALL,l,u),d._setParkState(4)))},onUnparkCompleted:function(l,u){d.logger.createFnLogger(\"onUnparkCompleted\",u).info(\"transactionEnd \".concat((0,D.getPrintableObject)(l))),d._callOperationHandler.hasPendingOperation(A.CALL_OPERATIONS.UNPARK_CALL)&&(0===l.code?d._callOperationHandler.resolveOperation(A.CALL_OPERATIONS.UNPARK_CALL,l,void 0,u):d._callOperationHandler.rejectOperation(A.CALL_OPERATIONS.UNPARK_CALL,l,u))},onIncomingCallReplacement:function(l,u){var p=d.logger.createFnLogger(\"onIncomingCallReplacement\",u);d.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.ON_INCOMING_CALL_REPLACEMENT,{},u),l.callNotification.callType=\"replaces\",l.callNotification.consultativeCallId=d.callId,p.info(\"consultativeCallId=\".concat(d.callId)),l.body={gp:l,evt:q.incomingCallEvents.INCOMING_SKYPE_NGC_CALL,nsp:void 0},d.event(\"replacementRequested\").raise(l)},onLwjUpdated:function(l,u){var p,h;d.logger.info(\"[\".concat(u,\"][onLwjUpdated]\")),d.lwjUris=l,d.streamManager.useLightweightStreams(d.lwjUris&&d.lwjUris.frameUris,u);try{for(var g=S(d.participants),f=g.next();!f.done;f=g.next()){f.value.useLightweightStreams(d.lwjUris&&d.lwjUris.frameUris,u)}}catch(l){p={error:l}}finally{try{f&&!f.done&&(h=g.return)&&h.call(g)}finally{if(p)throw p.error}}},onContentSharingStopped:function(l){var u,p;d.logger.debug(\"ScreenSharing: onContentSharingStopped\");try{for(var h=S(d.contentSharingSessions),g=h.next();!g.done;g=h.next()){var f=g.value;f.contentSharingGuid===l.correlationId&&(f.contentSharingStatus=7)}}catch(l){u={error:l}}finally{try{g&&!g.done&&(p=h.return)&&p.call(h)}finally{if(u)throw u.error}}},onContentSharingStarted:function(l){d.logger.debug(\"ScreenSharing: onContentSharingStarted\");var u=new $.default(d.callTelemetry,d.logger.createChild(\"ContentSharingSession\"),d.signalingSession,l.correlationId||(0,N.default)(),l.contentIdentifier,l.sessionState,l.subject,l.sessionId);u.contentSharingStatus=2,d.contentSharingSessions.push(u),u.changed((function(){return d.removeContentSessionIfEnded(u)})),d.event(\"contentSharingChanged\").raise()},onContentSharingUpdated:function(l){d.logger.debug(\"ScreenSharing: onContentSharingUpdated\");var u=E.find(d.contentSharingSessions,(function(d){return d.contentSharingGuid===l.correlationId}));u?(l.presenter&&(u.presenterId=l.presenter),l.subject&&u.subject!==l.subject&&(u.subject=l.subject),l.sessionState&&u.contentSharingState!==l.sessionState&&(u.contentSharingState=l.sessionState),3===u.contentSharingStatus&&d.localSignalingParticipant.id!==l.presenter?u.contentSharingStatus=5:5===u.contentSharingStatus&&d.localSignalingParticipant.id===l.presenter&&(u.contentSharingStatus=3)):d.logger.warn(\"onContentSharingUpdated: session not found\")},onWebRtcMediaNotification:function(l,u){var p=d.mediaSession&&d.mediaSession.getExtensionsManager?d.mediaSession.getExtensionsManager():null;p&&p.processNotification(l,u)},onCorrelationIdUpdated:function(l,u){return d.checkForCallIdUpdate(l,u)},onUnmuteRequested:function(l){},onCallForwarded:function(l){l&&l.destinationType!==d.forwardingDestinationType&&(d.forwardingDestinationType=l.destinationType,d.raiseChanged())},onPSTNBalanceUpdate:function(l){},isOneToOnePstnCall:function(){return d.isOneToOnePSTNCall()},onUpdateMeetingLiveStateCompleted:function(l,u,p){d.logger.info(\"[onUpdateMeetingLiveStateCompleted] [\".concat(u,\"] transactionEnd \").concat((0,D.getPrintableObject)(l))),d.onOperationCompleteCommonHandler(l,u,A.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE,p)},onUpdateMeetingGroupsCompleted:function(l,u,p){d.logger.info(\"[onUpdateMeetingGroupsCompleted] [\".concat(u,\"] transactionEnd \").concat((0,D.getPrintableObject)(l))),d.onOperationCompleteCommonHandler(l,u,A.CALL_OPERATIONS.UPDATE_MEETING_GROUPS,p)},onSetMeetingLayoutCompleted:function(l,u,p){d.logger.info(\"[onSetMeetingLayoutCompleted] [\".concat(u,\"] transactionEnd \").concat((0,D.getPrintableObject)(l))),d.onOperationCompleteCommonHandler(l,u,A.CALL_OPERATIONS.SET_MEETING_LAYOUT,p)},onJoinMeetingGroupCompleted:function(l,u,p){d.logger.info(\"[onJoinMeetingGroupCompleted] [\".concat(u,\"] transactionEnd \").concat((0,D.getPrintableObject)(l))),d.onOperationCompleteCommonHandler(l,u,A.CALL_OPERATIONS.JOIN_MEETING_GROUP,p)},onLeaveMeetingGroupCompleted:function(l,u,p){d.logger.info(\"[onJoinMeetingGroupCompleted] [\".concat(u,\"] transactionEnd \").concat((0,D.getPrintableObject)(l))),d.onOperationCompleteCommonHandler(l,u,A.CALL_OPERATIONS.LEAVE_MEETING_GROUP,p)},onBreakoutDetailsUpdated:function(l,u){d.logger.info(\"[onBreakoutDetailsUpdated] [\".concat(u,\"]\")),d.breakoutDetails=l,d.raiseChanged()}};var f=Object.create(this.localSignalingParticipant);this.signalingSession=this.signalingAgent.getNewSignalingSession(f,this.signalingNotifications,this.callId,this._callCreationTime),this.accountConfiguration&&this.accountConfiguration.deviceType&&this.signalingSession.setDeviceType(this.accountConfiguration.deviceType),this.setCallId(this.callId||this.signalingSession.correlationId),this.signalingSession.participantManager&&this.signalingSession.participantManager.localParticipant&&(this.setEndpointId(this.signalingSession.participantManager.localParticipant.endpointId),this.setParticipantId(this.signalingSession.participantManager.localParticipant.participantId),this.callStats.setParticipantId(this.participantId))}},PluginlessCall.prototype.cleanUpDueToStreaming=function(l,d){var u,p;this.participants.forEach((function(d){return d.updateStreams([],l)})),this.cleanUpMedia(l,d),this.finishCallHoldResume(d),null===(u=this.renegotiationAnswerDeferred)||void 0===u||u.reject(d),null===(p=this.newOfferRequestDeferred)||void 0===p||p.reject(d),this._parkState=0,this._transferState=0,this._muteState=q.ParticipantMuteState.Unmuted,this.isServerMuted=!1,this.isSpeakerMuted=!1,this.requestedHoldState=!1,this.isMuteOnHold=!1},PluginlessCall.prototype.cancelAllCallingOperationsDueToStreaming=function(l){this._callOperationHandler.maybeRejectPendingOperationsWithPredicate(74,l,(function(l,d){return E.some(null==d?void 0:d.preconditionTags,(function(l){return l===A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE}))}))},PluginlessCall.prototype.onOperationCompleteCommonHandler=function(l,d,u,p){0===l.code?this._callOperationHandler.maybeResolveOperation(u,l,p,d):this._callOperationHandler.maybeRejectOperation(u,l,p,d)},PluginlessCall.prototype.convertToTransferType=function(l,d){var u=\"none\";return 1===l&&d&&\"none\"!==d?\"teamPark\"===d?u=\"TransferTypeTeamPark\":\"sharedLinePark\"===d?u=\"TransferTypeSharedLinePark\":\"serverHold\"===d&&(u=\"TransferTypeServerHold\"):0===l?u=\"TransferTypeStandard\":2===l?u=\"TransferTypeVoicemail\":this.logger.info(\"Irrelevant combination of transferTye: \".concat(l,\" and parkType: \").concat(d)),u},PluginlessCall.prototype.initializeImageRenderingSession=function(l){var d=this;l&&(this.imageRenderingSession={imageRendererProvider:l,callParams:{callId:this.callId,imageRenderingEventCallbacks:{onImageRenderingQualityChanged:function(l){d.event(\"callQualityChanged\").raise(l)}}}})},PluginlessCall.prototype.raiseChangedDeferred=function(l){var d=this;if(!this.raiseChangedDefer||this.raiseChangedDefer.isSkippable&&!l){var u=E.defer((function(l){delete d.raiseChangedDefer,d.raiseChanged(l)}),l);this.raiseChangedDefer={timerId:u,isSkippable:!!l}}},PluginlessCall.getStreamsFromEndpoints=function(l){if(!l)return[];var d=PluginlessCall.filterVirtualEndpoints(l);return d.forEach((function(l){return E.forEach(l.mediaStreams,(function(d){d.participantId=l.participantId,d.endpointId=l.endpointId}))})),E.flatMap(d,(function(l){return l&&l.mediaStreams||[]}))},PluginlessCall.prototype.preconditions=function(l,d){this.logger.info(\"check call mode currentMode is \".concat(this.callMode,\" operationName is \").concat(l)),E.some(d,(function(l){return l===A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE}))&&this.isCallModeStreaming(!0)},PluginlessCall.prototype.isCallModeStreaming=function(l){if(void 0===l&&(l=!1),2===this.callMode){if(!l)return!0;throw this.logger.info(\"reject check callmode\"),{code:A.TRANSACTION_END_CODE.CLIENT_ERROR,subCode:A.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE,phrase:A.TRANSACTION_END_PHRASE.TRANSACTION_NOT_ALLOWED_FOR_STREAM_MODE}}return!1},PluginlessCall.prototype.setCallOptions=function(l){this.callOptions=l,this.logger.info(\"callOptions: \".concat((0,D.safeJsonStringify)(W.scrubCallOptions(l))))},PluginlessCall.prototype.getSelfClientEndpointCapabilities=function(){var l,d;return null===(d=null===(l=this.callOptions)||void 0===l?void 0:l.callStartOptions)||void 0===d?void 0:d.clientEndpointCapabilities},PluginlessCall.prototype.getLocalSignalingEndpointDetails=function(){var l=this;return E.find(this.localSignalingParticipant.endpointDetails,(function(d){return(null==d?void 0:d.endpointId)===l._endpointId}))},PluginlessCall.prototype.getStreamInformationMap=function(l){var d,u=this,p={};return(null===(d=this.accountConfiguration)||void 0===d?void 0:d.clientSupportsMiddleLane)&&E.forEach(l.endpointDetails,(function(l){(null==l?void 0:l.streamInformation)&&l.participantId&&l.participantId!==u._participantId&&(p[l.participantId]=l.streamInformation)})),p},PluginlessCall.prototype.updateSATInfo=function(l){var d;void 0===l&&(l=[]);var u=null===(d=this.mediaSession)||void 0===d?void 0:d.getSessionConfig().config.slowedDownTalkerInfoAggregationTime;if(u&&!(u<0)){var p=Date.now(),h=p-1e3*u;this.activeTalkersHistory=this.activeTalkersHistory.filter((function(l){return l.timestamp>h})).concat({speakers:l.map((function(l){return l.id})),timestamp:p});var g=Object.entries(this.activeTalkersHistory.reduce((function(l,d){var u,p,h,g=d.speakers;try{for(var f=S(g),m=f.next();!m.done;m=f.next()){var v=m.value;null!==(h=l[v])&&void 0!==h||(l[v]=0),l[v]++}}catch(l){u={error:l}}finally{try{m&&!m.done&&(p=f.return)&&p.call(f)}finally{if(u)throw u.error}}return l}),{})).sort((function(l,d){var u=_(l,2)[1];return _(d,2)[1]-u})).map((function(l){return _(l,1)[0]}));this.slowedDownActiveTalkerInfo={speakerList:g,timestamp:new Date(p)}}},PluginlessCall.prototype.initializeMediaSession=function(l){var d,u,p=this;if(!this.mediaSession){var h=function(l,d){var u={};return Object.keys(d).forEach((function(p){u[p]=function(){for(var u=[],h=0;h<arguments.length;h++)u[h]=arguments[h];return d[p]&&l()&&d[p].apply(d,C([],_(u),!1))}})),u}((function(){return!p.isCallModeStreaming()}),{onSessionErrorOccurred:function(l,d){void 0===d&&(d=(0,P.generateCauseId)()),p.logger.error(\"[\".concat(d,\"][onSessionErrorOccurred]: \").concat((0,D.safeJsonStringify)(l)));var u=[p.mediaAgent.constants.MEDIA_ERROR.iceConnectionError,p.mediaAgent.constants.MEDIA_ERROR.internalError];E.includes(u,l.type)&&p.event(\"mediaConnectionFailed\").raise(),p.callTelemetry.recordEvent(A.MEDIA_EVENT.SESSION_ERROR,{type:l.type},d)},onNegotiationRequired:function(l){void 0===l&&(l=(0,P.generateCauseId)());var d=(0,P.generateCauseId)();3===p.state||4===p.state||5===p.state||10===p.state||p.isPreheatedOnly()?(p.logger.info(\"[\".concat(l,\"][onNegotiationRequired] Negotiation started, state: \").concat(p.state)),p._callOperationHandler.executeChained((function(){return p.renegotiateOutgoing(l)}),A.CALL_OPERATIONS_INTERNAL.RENEGOTIATE_OUTGOING,d,l,void 0,void 0,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]})):p.logger.info(\"[\".concat(l,\"][onNegotiationRequired] Negotiation not started, state: \").concat(p.state)),p.callTelemetry.recordEvent(A.MEDIA_EVENT.NEGOTIATION_REQUIRED,\"\",l)},onContributingSourcesChanged:function(l){var d,u,h=[],_loop_3=function(d){var u=l.some((function(l){return d.hasAudioSource(l)})),p=u?1:0;d.updateVoiceLevel(p),u&&h.push(d)};try{for(var g=S(p.participants),f=g.next();!f.done;f=g.next()){_loop_3(f.value)}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=g.return)&&u.call(g)}finally{if(d)throw d.error}}p.updateSATInfo(h)},onDominantSpeakerChanged:function(l,d){var u=(0,P.generateCauseId)(),h=[],g=[];l.forEach((function(l){var d=E.find(p.participants,(function(d){return d.hasAudioSource(l)}));d?(h.push(d.id),g.push(V.scrubMriOrOmit(d.id))):g.push(p.streamManager.audio.id===l?\"<self>\":\"<unknown>\")})),p.logger.info(\"[\".concat(u,\"][onDominantSpeakerChanged], msidList = \").concat(l,\" => speakerList = \").concat(g,\", timestamp = \").concat(d)),p.dominantSpeakerInfo={speakerList:h,timestamp:d},p.raiseChanged()},onAudioStateChanged:function(l,d){var u=(0,P.generateCauseId)(),h=p.logger.createFnLogger(\"onAudioStateChanged\",u);h.info((0,D.safeJsonStringify)(l)),p.callStats.localStats.audio.streamStateChanged(l.stream,l.direction);var g=PluginlessCall.streamingStatetoMediaStreamState(l.stream);if(p.audioStreamState=g,g){p.callTelemetry.recordEvent(A.MEDIA_EVENT.AUDIO_STATE_CHANGED,{state:l,reason:d},u),2===g&&2===p.state&&(p.setCallState(9,u),p.participants.forEach((function(l){return l.setState(6,void 0,u)})));var f={mediaType:0,mediaDirection:PluginlessCall.streamingDirectionToMediaDirectionMapping(l.direction),mediaStreamState:g};if(p.event(\"mediaStreamStateChanged\").raise(f),!p.isCallSetupTelemetrySent&&p.mediaSession&&p.mediaSession.getSessionConfig().config.sendCallStartupTelemetry&&p.sendCallSetupTelemetry(),0===f.mediaDirection&&(p.isAudioStreamConnected=E.includes([2,1],f.mediaStreamState)),E.includes([3,4],f.mediaStreamState))if(h.logFailure(\"audio stream state changed to \".concat(l.stream,\" with reason \").concat(d)),!d||[\"timeout\",\"connection-dropped\",\"connectivity-check-failure\"].indexOf(d)>=0){p.event(\"mediaConnectionFailed\").raise();var m=p.mediaRelayWhiteListingIssue?53:4;p.mediaRelayWhiteListingIssue&&p.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.MEDIA_WHITELISTING_ISSUE_DETECTED);var v=p.getRejectionInfoFromTerminatedReason(m);p.shouldFallbackToLwj([v.code,v.subCode],h)?p.reconnectAsLwj(m,u):p.stopInternal({causeId:u,terminatedReason:m})}}},onQualityChanged:function(l){var d={type:PluginlessCall.convertQualityEventType(l.type),value:PluginlessCall.convertQualityLevel(l.value),isLocalSource:l.isLocalSource,mediaType:PluginlessCall.convertMediaType(l.mediaType)};p.muteUnmuteWorkaround(d),32===d.type&&(p.mediaRelayWhiteListingIssue=3===d.value,p.mediaRelayWhiteListingIssue&&p.event(\"mediaConnectionWhitelistingWarning\").raise()),5===d.type&&3===d.value&&p.trouterService.checkConnection(!0),p.callTelemetry.recordEvent(A.MEDIA_EVENT.AUDIO_QUALITY_CHANGED,d),p.event(\"callQualityChanged\").raise(d)},onOptimalVideoReceiversCountChanged:function(l){p.logger.debug(\"onOptimalVideoReceiversCountChanged: \".concat(l)),p.optimalVideoCount!==l&&(p.optimalVideoCount=l,p.raiseChanged())},onDataChannelUpdated:function(l){var d=(0,P.generateCauseId)();p.logger.debug(\"[\".concat(d,\"] onDataChannelUpdated\")),p.dataChannel.registerSessionDataChannel(l,d)},onUpdateMediaDescriptions:function(l,d){p.logger.debug(\"[\".concat(d,\"] onUpdateMediaDescriptions \").concat(JSON.stringify(l)))}});this._mediaSessionCreationTime=Date.now(),this.callTelemetry.recordEvent(A.MEDIA_EVENT.CREATING_CONFERENCE,\"\",l),this.mediaSession=new z.default(this.mediaAgent.createSession(h,this.signalingSession.correlationId,{isConference:this.callUsesMixer,isPstnCall:this.isOneToOnePSTNCall()}),this.signalingSession,this.mediaAgent.constants),this.callTelemetry.recordEvent(A.MEDIA_EVENT.CREATED_CONFERENCE,\"\",l),this.streamManager.setMediaSession(this.mediaSession,l),this.participants.forEach((function(d){d.setMediaSession(p.mediaSession,l)}));var g=null===(u=null===(d=this.mediaSession)||void 0===d?void 0:d.getSessionConfig())||void 0===u?void 0:u.config;(null==g?void 0:g.useOneDsLogger)&&(null==g?void 0:g.addTelemetryReportingCallback)&&(this.beforeUnloadTelemetrySender=function(){p.sendLastKnownStats()},window.addEventListener(\"beforeunload\",this.beforeUnloadTelemetrySender)),this.screenSharingControl&&this.allowDataChannel()&&(this.screenSharingControl.setGiveControlEnabled(this.isGiveControlEnabled()),this.screenSharingControl.setupDataHandlers())}},PluginlessCall.prototype.muteUnmuteWorkaround=function(l){var d;return v(this,void 0,void 0,(function(){var u;return y(this,(function(p){switch(p.label){case 0:return(null===(d=this.mediaSession)||void 0===d?void 0:d.getSessionConfig().config.enableMuteSpeakerUnmuteSpeakerWorkaround)?this.isSpeakerMuted?[2]:25!==l.type||3!==l.value||0!==l.mediaType?[3,3]:(this.logger.log(\"Performing muteSpeaker->unmuteSpeaker workaround\"),u=(0,P.generateCauseId)(),[4,this.muteSpeaker(u)]):[2];case 1:return p.sent(),[4,this.unmuteSpeaker(u)];case 2:p.sent(),p.label=3;case 3:return[2]}}))}))},PluginlessCall.prototype.sendLastKnownStats=function(){var l;if(!this.tsCallingTelemetryReported){this.reportTelemetryEvents(this.callStats.buildFromLocalStats(),\"signaling\",\"skypecosi_concore_web\"),this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo);var d=\"in_call_session\";this.reportTelemetryEvents([{eventName:d,props:this.callTelemetry.getEvent(!0)}],\"signaling\",\"skypecosi_concore_web_ts_calling\");var u=this.mediaSession.getLastKnownStats(!0);u.data.TerminationReason={code:\"\".concat(O.CONSTANTS.CODE.SUCCESS),subCode:\"\".concat(O.CONSTANTS.SUB_CODE.BEACON)},this.callStats.setMediaStats(u),this.callStats.appendDataChannelInfo(this.dataChannel.getTelemetry()),this.callStats.appendSharingControlInfo(null===(l=this.screenSharingControl)||void 0===l?void 0:l.isScreenSharingControlEnabled()),this.callStats.appendMediaControlPaneInfo(JSON.stringify(this.mediaControlPlane.getTelemetryReport())),this.reportTelemetryEvents(this.callStats.buildFromMediaStats(),\"media\",\"mdsc\")}},PluginlessCall.prototype.invertDirectionality=function(l){switch(l){case this.mediaAgent.constants.MEDIA_STATE.sendReceive:return te.streamDirections.sendReceive;case this.mediaAgent.constants.MEDIA_STATE.send:return te.streamDirections.receive;case this.mediaAgent.constants.MEDIA_STATE.receive:return te.streamDirections.send;default:return null}},PluginlessCall.prototype.completeNegotiationAsync=function(l){var u=this,p=this.logger.createFnLogger(\"completeNegotiationAsync\",l),h=this.mediaSession.completeNegotiationAsync(l).then((function(h){p.info(\"activeModalities=\".concat(h&&Object.keys(h.activeModalities)));var g=u.participants[0],f=g&&g.endpoints&&g.endpoints.endpointDetails.length&&g.endpoints.endpointDetails[0].mediaStreams&&g.endpoints.endpointDetails[0].mediaStreams.length,m=u.mediaSession.getSessionConfig().config.avoidFakeStreamsDuringEscalation&&u.isEscalationInProgress;if(g&&!u.callUsesMixer&&!m&&!f){var prepareStreamData=function(l,p,h){return{participantId:d.DEFAULT_PARTICIPANT_ID,endpointId:d.DEFAULT_ENDPOINT_ID,type:l,direction:u.invertDirectionality(p),sourceId:h,serverMuted:!1}},v=[];v.push(prepareStreamData(te.ngcStreamTypes.audio,h.activeModalities.audio,Y.AUDIO_STREAM_DEFAULT_ID)),h.activeModalities.video&&v.push(prepareStreamData(te.ngcStreamTypes.video,h.activeModalities.video,Y.VIDEO_STREAM_DEFAULT_ID)),h.activeModalities.sharing&&v.push(prepareStreamData(te.ngcStreamTypes.sharing,h.activeModalities.sharing,Y.SHARING_STREAM_DEFAULT_ID)),g.updateStreams(v,l)}return p.logSuccess((0,D.safeJsonStringify)(h)),h}));return h.catch((function(d){p.logFailure(d),u.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.COMPLETE_NEGOTIATION_FAILED,{e:d},l)})),h},PluginlessCall.prototype.renegotiateOutgoing=function(l){return v(this,void 0,void 0,(function(){var d,u,p,h,g,f,m,v,S,_,C,E,T,b=this;return y(this,(function(y){switch(y.label){case 0:this.renegotiationAnswerDeferred=I.defer(),(u=this.logger.createFnLogger(\"renegotiateOutgoing\",l)).info(\"start\"),p=(0,B.default)(u),y.label=1;case 1:y.trys.push([1,11,,12]),y.label=2;case 2:return y.trys.push([2,8,,10]),d=this.inLocalHold()?this.getMediaModalitiesForHold(l):this.calculateModalityDirections({},l),[4,p.execute(q.RenegotiationPhase.MediaCreateOffer,(function(){return b.mediaSession.createOfferAsync(l)}))];case 3:return h=y.sent(),g=this.getSignalingMediaTypes(d),[4,p.execute(q.RenegotiationPhase.SignalingStartNegotiation,(function(){return b.signalingSession.startRenegotiationAsync(h,g,l)}))];case 4:return y.sent(),[4,p.execute(q.RenegotiationPhase.SignalingRenegotiationAnswer,(function(){return b.renegotiationAnswerDeferred.promise}))];case 5:return f=y.sent(),[4,p.execute(q.RenegotiationPhase.MediaProcessAnswer,(function(){return b.mediaSession.processAnswerAsync(f,l,!1)}))];case 6:return y.sent(),[4,p.execute(q.RenegotiationPhase.CompleteNegotiation,(function(){return b.completeNegotiationAsync(l)}))];case 7:return m=y.sent(),this.onNegotiationCompletion(m,!0,d,l,p.getTelemetryData()),[3,10];case 8:if(v=y.sent(),u.logFailure(v),this.isCallModeStreaming())return this.callTelemetry.recordEvent(A.MEDIA_EVENT.OUTGOING_NEGOTIATION_FAILURE,v,l),[2];if(!v.phase)throw this.callTelemetry.recordEvent(A.MEDIA_EVENT.OUTGOING_NEGOTIATION_FAILURE,v,l),v;if(S=\"unknown\",_=this.mediaAgent.constants.RENEGOTIATION_ERROR,S=_.local,v.phase===q.RenegotiationPhase.SignalingRenegotiationAnswer||v.phase===q.RenegotiationPhase.SignalingStartNegotiation?(C=415,S=v.error.code===q.jsCallEndCodes.GlareError?_.glare:v.error.code===C?_.media:_.signaling):v.phase===q.RenegotiationPhase.MediaCreateOffer&&v.error.type===this.mediaAgent.constants.MEDIA_ERROR.noNetworkError&&(S=_.media),this.callTelemetry.recordEvent(A.MEDIA_EVENT.OUTGOING_NEGOTIATION_FAILURE,this.getTelemetryFromPhaseExecution(v),l),v.error.message&&v.error.message.includes(\"The requested call does not exist\"))throw new Error(\"Call drop due to remote replying with call not found\");return u.logFailure(S),E={type:S,detail:v.error},[4,this.mediaSession.rejectNegotiationAsync(E,l)];case 9:return y.sent(),this.onNegotiationFailure(v,S,l,d),[3,10];case 10:return[3,12];case 11:return T=y.sent(),u.logFailure(T),this.callTelemetry.recordEvent(A.MEDIA_EVENT.NEGOTIATION_FATAL_ERROR,(0,D.getPIISafeObject)(T),l),this.stopInternal({causeId:l,terminatedReason:47}),[3,12];case 12:return[2]}}))}))},PluginlessCall.prototype.renegotiateIncoming=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h,g,f,m,v,S,_,C,E,T=this;return y(this,(function(y){switch(y.label){case 0:if(this.mediaAcknowledgmentOperation=this._callOperationHandler.createPendingOperation(A.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,null,d,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),this.mediaAcknowledgmentOperation.catch(w.noop),(u=this.logger.createFnLogger(\"renegotiateIncoming\",d)).info(\"start\"),l.newOffer&&!this.mediaAgent.getCapabilities().retargeting)return u.logFailure(\"Retarget offer received, but pluginless has no support for retarget\"),this.stopInternal({causeId:d,terminatedReason:38}),[2];p=(0,B.default)(u),y.label=1;case 1:return y.trys.push([1,12,,20]),[4,p.execute(q.RenegotiationPhase.MediaProcessOffer,(function(){return T.mediaSession.processOfferAsync(l,d)}))];case 2:return h=y.sent(),this.handleOfferedModalities(h,d),this.getRenegotiationOfferType(h)!==q.RenegotiationOfferType.Resume?[3,4]:[4,this.prepareModalitiesForResume(d)];case 3:y.sent(),y.label=4;case 4:return[4,this.updateMediaModalities({offered:h},d)];case 5:return g=y.sent(),this.getRenegotiationOfferType(h)!==q.RenegotiationOfferType.Hold?[3,7]:[4,this.prepareModalitiesForHold(d)];case 6:y.sent(),y.label=7;case 7:return this.updateMediaState(g,d),this.isRenegotiationHoldOrResume(g)&&this.updateScreenSharingState(g,d),[4,p.execute(q.RenegotiationPhase.MediaCreateAnswer,(function(){return T.mediaSession.createAnswerAsync(!1,d)}))];case 8:return f=y.sent(),m=this.getSignalingMediaTypes(g),[4,p.execute(q.RenegotiationPhase.SignalingAcceptRenegotiation,(function(){return T.signalingSession.acceptRenegotiationAsync(f,m,d)}))];case 9:return y.sent(),[4,p.execute(q.RenegotiationPhase.SignalingMediaAcknowledgement,(function(){return T.mediaAcknowledgmentOperation}))];case 10:return y.sent(),[4,p.execute(q.RenegotiationPhase.CompleteNegotiation,(function(){return T.completeNegotiationAsync(d)}))];case 11:return v=y.sent(),this.onNegotiationCompletion(v,!1,h,d,p.getTelemetryData()),[3,20];case 12:S=y.sent(),y.label=13;case 13:if(y.trys.push([13,18,,19]),this.isCallModeStreaming())return this.callTelemetry.recordEvent(A.MEDIA_EVENT.INCOMING_NEGOTIATION_FAILURE,S,d),[2];if(!S.phase||S.phase===q.RenegotiationPhase.CompleteNegotiation)throw this.callTelemetry.recordEvent(A.MEDIA_EVENT.INCOMING_NEGOTIATION_FAILURE,S,d),S;return _=S,this.callTelemetry.recordEvent(A.MEDIA_EVENT.INCOMING_NEGOTIATION_FAILURE,this.getTelemetryFromPhaseExecution(S),d),C={type:this.mediaAgent.constants.RENEGOTIATION_ERROR.local,detail:S.error},_.phase!==q.RenegotiationPhase.SignalingAcceptRenegotiation&&_.phase!==q.RenegotiationPhase.SignalingMediaAcknowledgement?[3,15]:(u.logFailure(\"Error in renegotiateIncoming() -> rejecting media negotiation\"),C.type=this.mediaAgent.constants.RENEGOTIATION_ERROR.signaling,this._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,C,void 0,d),[4,this.mediaSession.rejectNegotiationAsync(C,d)]);case 14:return y.sent(),[2];case 15:return this._callOperationHandler.maybeRejectOperation(A.CALL_OPERATIONS_INTERNAL.MEDIA_ACKNOWLEDGMENT,C,void 0,d),[4,this.mediaSession.rejectNegotiationAsync(C,d)];case 16:return y.sent(),[4,this.signalingSession.rejectRenegotiationAsync(void 0,d)];case 17:return y.sent(),[3,19];case 18:return E=y.sent(),u.logFailure(E),this.callTelemetry.recordEvent(A.MEDIA_EVENT.NEGOTIATION_FATAL_ERROR,(0,D.getPIISafeObject)(E),d),this.stopInternal({causeId:d,terminatedReason:47}),[3,19];case 19:return[3,20];case 20:return[2]}}))}))},PluginlessCall.prototype.handleCallEscalation=function(l,u){var p=this.logger.createFnLogger(\"handleCallEscalation\",u);if(p.info(\"current callType=\".concat(this.callType,\", escalationInProgress=\").concat(l,\", isEscalationInProgress=\").concat(this.isEscalationInProgress)),l){var h=this.participants[0];h&&h.audio.participantId===d.DEFAULT_PARTICIPANT_ID?h.updateStreams([{type:te.ngcStreamTypes.audio,direction:\"inactive\",sourceId:null,serverMuted:!1},{type:te.ngcStreamTypes.video,direction:\"inactive\",sourceId:null,serverMuted:!1},{type:te.ngcStreamTypes.sharing,direction:\"inactive\",sourceId:null,serverMuted:!1}],u):p.info(\"no 1-1 participant found, stream update ignored\"),this.setCallType(2,u),this.setCallUsesMixer(!0,u),this.setIsEscalationInProgress(!1,u),this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.ESCALATION_COMPLETED,void 0,u),this.raiseChanged()}},PluginlessCall.prototype.reportTsCallingTelemetry=function(l){return v(this,void 0,void 0,(function(){var d;return y(this,(function(u){switch(u.label){case 0:return this.tsCallingTelemetryReported?[2]:[4,this.connectCallPromise.catch(w.noop)];case 1:return u.sent(),d=l?\"call_setup_session\":\"in_call_session\",this.callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this.reportTelemetryEvents([{eventName:d,props:this.callTelemetry.getEvent(l)}],\"signaling\",\"skypecosi_concore_web_ts_calling\"),l?this.callTelemetry.switchToInCallTelemetry():this.tsCallingTelemetryReported=!0,[2]}}))}))},PluginlessCall.prototype.sendCallSetupTelemetry=function(){this.mediaSession&&(this.collectCallStats(this.mediaSession),this.reportCallSetupStats(),this.isCallSetupTelemetrySent=!0)},PluginlessCall.prototype.collectCallStats=function(l){var d=this,always=function(){return d.collectMediaStatsDeferred.resolve()};return l.getStatsAsync(!1).then((function(l){return d.callStats.setMediaStats(l)})).then(always,always)},PluginlessCall.prototype.reportCallSetupStats=function(){var l=this;this.collectMediaStatsDeferred.promise.then((function(){l.reportTelemetryEvents(l.callStats.buildFromCallSetupStats(),\"media\",\"mdsc\"),l.event(\"statsReported\").raise(),l.collectMediaStatsDeferred=I.defer()}))},PluginlessCall.prototype.reportCallEndStats=function(l){var d;return v(this,void 0,void 0,(function(){return y(this,(function(u){switch(u.label){case 0:return this.callTelemetry.setTerminationState(this.state),this.callTelemetry.setTerminationReason(this.terminatedReason),this.callStats.localStats.endCall(this.terminatedReason),this.reportTelemetryEvents(this.callStats.buildFromLocalStats(),\"signaling\",\"skypecosi_concore_web\"),this.reportTsCallingTelemetry(!this._callIsSetupComplete),l?[4,this.collectMediaStatsDeferred.promise]:[3,2];case 1:u.sent(),this.callStats.appendTerminationInfo(this.terminatedReason,this.state),this.callStats.appendDataChannelInfo(this.dataChannel.getTelemetry()),this.callStats.appendSharingControlInfo(null===(d=this.screenSharingControl)||void 0===d?void 0:d.isScreenSharingControlEnabled()),this.callStats.appendMediaControlPaneInfo(JSON.stringify(this.mediaControlPlane.getTelemetryReport())),this.reportTelemetryEvents(this.callStats.buildFromMediaStats(),\"media\",\"mdsc\"),u.label=2;case 2:return this.event(\"statsReported\").raise(),this.collectMediaStatsDeferred=I.defer(),[2]}}))}))},PluginlessCall.prototype.reportTelemetryEvents=function(l,d,u){var p=this.telemetryLoggers?this.telemetryLoggers[d]:null;p?l.forEach((function(l){return p.sendEvent({eventName:\"\".concat(u?\"\".concat(u,\"_\"):\"\").concat(l.eventName),props:l.props})})):this.logger.debug(\"reportTelemetryEvents no logger for tenant \".concat(d))},PluginlessCall.prototype.onLocalPreviewSizeChanged=function(l,d){this.logger.debug(\"onLocalPreviewSizeChanged: \".concat(l,\"x\").concat(d))},PluginlessCall.prototype.onLocalPreviewStateChanged=function(l){this.logger.debug(\"onLocalPreviewStateChanged: \".concat(l)),this.callStats.localStats.video.streamStateChanged(l.stream)},PluginlessCall.prototype.configureVideoModalitiesAsync=function(l,d){return v(this,void 0,void 0,(function(){return y(this,(function(u){switch(u.label){case 0:return this.mediaSession?[4,this.updateMediaModalities(void 0,d)]:(this.logger.warn(\"Tried to configure modalities after call end\"),[2,Promise.resolve()]);case 1:return u.sent(),l||this.turnOffLocalVideoPreview(d),this.setVideoOn(l,d),[2]}}))}))},PluginlessCall.prototype.turnOffLocalVideoPreview=function(l){return this.localVideoRenderer&&(this.localVideoRenderer.dispose(),this.localVideoRenderer=null),Promise.resolve(void 0)},PluginlessCall.prototype.turnOnLocalVideoPreview=function(l){var d=this,u=this.logger.createFnLogger(A.CALL_OPERATIONS_INTERNAL.START_PREVIEW_VIDEO,l),p=this.mediaStateConfigurationHelper.isSending(1);if(!p||!this.localVideoContainer)return Promise.reject(\"could not start video preview: requestedVideoState=\".concat(p,\", localVideoContainer=\").concat(this.localVideoContainer));this.turnOffLocalVideoPreview(l);var h=I.asap((function(){d.localVideoRenderer=d.mediaAgent.getDeviceManager().createPreviewRenderer(d.localVideoContainer),d.localVideoRenderer.on(\"onVideoSizeChanged\",(function(l,u){return d.onLocalPreviewSizeChanged(l,u)})),d.localVideoRenderer.on(\"onVideoStateChanged\",(function(l){return d.onLocalPreviewStateChanged(l)}))})).then((function(){return d.localVideoRenderer.startVideoAsync(l)}));return h.catch((function(l){return u.logFailure(l)})),h},PluginlessCall.prototype.startStopVideo=function(l,d){var u=this,p=this.logger.createFnLogger(l?\"startVideo\":\"stopVideo\",d);if(p.info(\"start\"),this.isJoinedLightweight())return p.logFailure(\"Can not start/stop video in lightweight call]\"),Promise.reject(60);if(!this.canToggleVideo)return l===this.mediaStateConfigurationHelper.isSending(1)?this.videoTogglePromise.then((function(){u.turnOnLocalVideoPreview(d)})):(p.logFailure(\"video switching is in progress \".concat(l,\"]\")),Promise.reject({reason:1}));l?(this.callStats.localStats.newSession(1),this.callStats.localStats.video.start()):this.callStats.localStats.video.stop(),l&&this.mediaStateConfigurationHelper.isDisabled(1)&&p.info(\"Video modality was skipped till now. Adding it now.\"),l?this.mediaStateConfigurationHelper.enableModality(1):this.mediaStateConfigurationHelper.removeModality(1),this.canToggleVideo=!1;var always=function(){u.canToggleVideo=!0};return this.videoTogglePromise=Promise.resolve().then((function(){return!!l&&(u.localVideoContainer||(u.localVideoContainer=document.createElement(\"div\")),u.turnOnLocalVideoPreview(d).then((function(){return!0})))})).then((function(l){return u.configureVideoModalitiesAsync(l,d)})).catch((function(l){return p.logFailure(l),u.mediaStateConfigurationHelper.removeModality(1),u.configureVideoModalitiesAsync(!1,d).then((function(){throw l}))})).then(always,(function(l){throw p.logFailure(l),always(),l})),this.videoTogglePromise},PluginlessCall.prototype.startStopAudio=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h;return y(this,(function(g){switch(g.label){case 0:u=this.logger.createFnLogger(l?\"startAudio\":\"stopAudio\",d),g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.updateMediaModalities(void 0,d)];case 2:return p=g.sent(),this.updateMediaState(p,d),[3,4];case 3:return h=g.sent(),u.logFailure(h),[2,9];case 4:return[2,0]}}))}))},PluginlessCall.prototype.updateEndpointStateForMute=function(l,d){try{this.signalingSession.updateEndpointState({state:{isMuted:l}},d)}catch(l){this.logger.logFailure(\"updateEndpointStateForMute failure: \".concat(l))}},PluginlessCall.prototype.handleServerMutedState=function(l){return v(this,void 0,void 0,(function(){var d,u,p,h;return y(this,(function(g){switch(g.label){case 0:if(d=this.logger.createFnLogger(\"handleServerMutedState, isServerMuted=\".concat(!!this.isServerMuted),l),this.isServerMuted)return[3,4];if(u=this._muteState===q.ParticipantMuteState.AttemptingUnmute,this._muteState!==q.ParticipantMuteState.ServerMuted&&!u)return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),d.info(\"is unmuting, as we are no longer server muted\"),[4,this.handleMuteUnmuteOnMediaSession(!1,l)];case 2:return g.sent(),this.setMuted(q.ParticipantMuteState.Unmuted,l),u&&this.updateEndpointStateForMute(!1,l),[3,4];case 3:throw p=g.sent(),d.logFailure(p),p;case 4:if(!this.isServerMuted||this._muteState!==q.ParticipantMuteState.Unmuted)return[3,8];d.info(\"is muting, as we are unmuted\"),g.label=5;case 5:return g.trys.push([5,7,,8]),[4,this.handleMuteUnmuteOnMediaSession(!0,l)];case 6:return g.sent(),this.setMuted(q.ParticipantMuteState.ServerMuted,l),[3,8];case 7:throw h=g.sent(),d.logFailure(h),h;case 8:return[2]}}))}))},PluginlessCall.prototype.handleMuteUnmuteOnMediaSession=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h;return y(this,(function(g){switch(g.label){case 0:return u=this.logger.createFnLogger(\"handleMuteUnmuteOnMediaSession, value=\".concat(!!l),d),this.mediaSession&&this.mediaSession.getAllowedModalities&&!this.isServerMuted?(p=this.isMuted||this.isServerMuted,h=this.mediaSession.getAllowedModalities().audio.some((function(l){return l===te.streamDirections.send||l===te.streamDirections.sendReceive})),p&&h||!p&&!h?(u.info(\"updating audio modalities: Muted \".concat(p,\" -> \").concat(l,\"; audioAllowed = \").concat(h)),[4,this.updateMediaModalities(void 0,d)]):[3,2]):[3,2];case 1:g.sent(),g.label=2;case 2:return l?(u.info(\"mediaSession.muteInputAsync\"),[4,this.mediaSession.muteInputAsync(d)]):[3,4];case 3:return g.sent(),[3,6];case 4:return l?[3,6]:(u.info(\"mediaSession.unmuteInputAsync\"),[4,this.mediaSession.unmuteInputAsync(d)]);case 5:g.sent(),g.label=6;case 6:return[2,Promise.resolve()]}}))}))},PluginlessCall.prototype.updateCapabilities=function(l,d){void 0===d&&(d=!1);var u=!1,p=!1;if(!H.callStateIsAnyOf(this.state,[11,12])){var h=\"attendee\"===(this.advancedMeetingRole||this.meetingRole);this.isJoinedLightweight()||(this.isServerMuted&&!this._callInLobby?this._commandUrlPresence&b.CommandUrlPresence.Unmute&&(u=!0):this.isMuted&&(u=!0)),p=!!(this._commandUrlPresence&b.CommandUrlPresence.Mute)&&!h}this._capabilities.canUnmuteSelf===u&&this._capabilities.canMuteOthers===p||(this._capabilities.canUnmuteSelf=u,this._capabilities.canMuteOthers=p,this.logger.info(\"[\".concat(l,\"][updateCapabilities] Computed self capabilities: \").concat(JSON.stringify(this._capabilities))),d&&this.raiseChanged())},PluginlessCall.prototype.muteUnmute=function(l,d){return v(this,void 0,void 0,(function(){var u,p,h,g=this;return y(this,(function(f){switch(f.label){case 0:if(u=this.logger.createFnLogger(\"muteUnmute, value=\".concat(!!l),d),this.isJoinedLightweight())return u.logFailure(\"Can not mute/unmute lightweight call\"),[2,Promise.reject((0,M.getRejectTransactionEnd)(A.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))];if(H.callStateIsAnyOf(this.state,[11,12]))return u.logFailure(\"Can not mute/unmute during preheat call\"),[2,Promise.reject((0,M.getRejectTransactionEnd)(A.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED))];p=!l&&(!this.isServerMuted||this._callInLobby),f.label=1;case 1:return f.trys.push([1,4,,5]),l||p?[4,this.handleMuteUnmuteOnMediaSession(l,d)]:[3,3];case 2:f.sent(),f.label=3;case 3:if(l)this.setMuted(q.ParticipantMuteState.Muted,d),u.info(\"is updating endpointState for mute\"),this.updateEndpointStateForMute(!0,d);else{if(!p)return u.info(\"is unmuting on server\"),this._muteState===q.ParticipantMuteState.Muted&&this.setMuted(q.ParticipantMuteState.AttemptingUnmute,d),[2,this.signalingSession.unmuteAsync().then((function(l){g.handleSelfUnmuteUpdatedInfo(l,d)}))];u.info(\"is updating endpointState for unmute\"),this.setMuted(q.ParticipantMuteState.Unmuted,d),this.updateEndpointStateForMute(!1,d)}return[3,5];case 4:throw h=f.sent(),u.logFailure(h),(0,M.getRejectTransactionEnd)(h);case 5:return[2]}}))}))},PluginlessCall.prototype.muteUnmuteSpeaker=function(l,d){return v(this,void 0,void 0,(function(){var u;return y(this,(function(p){switch(p.label){case 0:return u=this.logger.createFnLogger(\"muteUnmuteSpeaker, isSpeakerMuted=\".concat(!!this.isSpeakerMuted),d),this.isJoinedLightweight()?(u.logFailure(\"Can not mute/unmute speaker in lightweight call\"),[2,Promise.reject(60)]):(this.setSpeakerMuted(l,d),this.mediaSession?l?[4,this.mediaSession.muteOutputAsync(d)]:[3,2]:[3,4]);case 1:return p.sent(),[3,4];case 2:return[4,this.mediaSession.unmuteOutputAsync(d)];case 3:p.sent(),p.label=4;case 4:return[2]}}))}))},PluginlessCall.prototype.getParticipant=function(l){return this.participants.filter((function(d){return d.isSameParticipantsMri(l)}))[0]},PluginlessCall.prototype.getOrCreateParticipant=function(l,d){var u=this,p=this.getParticipant(l);return p||((p=new Q.PluginlessCallParticipant(l,this.mediaSession,this.logger,this.callStats.localStats,this.callTelemetry,this.mediaAgent.getConfigProvider(),this.imageRenderingSession,d,this._enablePluginlessCallParticipantRaiseChangeDeferred)).changed((function(){return u.onParticipantChanged(p)})),this.lwjUris&&this.lwjUris.frameUris&&p.useLightweightStreams(this.lwjUris.frameUris,d),this.participants.push(p),this.event(\"participantAdded\").raise(p),this.monitorCallStart(),p)},PluginlessCall.prototype.onParticipantChanged=function(l){this.event(\"participantUpdated\").raise(l),this.raiseChangedDeferred(this._changedEventSkipConfig)},PluginlessCall.prototype.setCallState=function(l,d,u){if(void 0===u&&(u=0),this.state!==l){var p=this.logger.createFnLogger(\"setCallState\",d);if(p.info(\"currentState=\".concat(this.state,\", newState=\").concat(l,\", terminatedReason=\").concat(this.terminatedReason)),H.validStateTransitions[this.state].indexOf(l)>=0||(p.logFailure(\"invalid state transition\"),7===l)){if(this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{state:l,reason:u},d),this.state=l,this.callStats.localStats.call.callStateChanged(l),7===l&&(this.terminatedReason=u,!E.includes(re,u))){var h=44===this.terminatedReason,g=55===this.terminatedReason,f=56===this.terminatedReason;this.setFailureType(!this.callGotConnected||!this._wasAudioStreamConnected||h||g||f?0:1)}3===l&&(this.callGotConnected=!0,this.callHeldAt=null),this.callIsHeld()&&!this.callHeldAt&&(this.callHeldAt=new Date),p.logSuccess(\"changed to \".concat(l,\", terminatedReason: \").concat(this.terminatedReason,\", failureType=\").concat(this.failureType)),this.screenSharingControl.callStateChanged(this.state),this.monitorCallStart(),this.event(\"callStateChanged\").raise(),this.updateCapabilities(d),this.raiseChanged()}}},PluginlessCall.prototype.setMediaStream=function(l,d,u){if(l){if(!E.find(this.localMediaStreams,(function(l){return l.mediaType===u}))){var p=new se(d,u);this.logger.info(\"setMediaStream \".concat(JSON.stringify(p))),this.localMediaStreams.push(p)}}else this.logger.info(\"setMediaStream removing \".concat(u)),E.remove(this.localMediaStreams,(function(l){return l.mediaType===u}))},PluginlessCall.prototype.setVideoOn=function(l,d){this.logger.info(\"[\".concat(d,\"]videoOn=\").concat(l)),this.isVideoOn=l,this.setMediaStream(this.isVideoOn,!0,1),this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_LOCAL_VIDEO,{value:l},d),this.raiseChanged()},PluginlessCall.prototype.setAudioOn=function(l,d){this.logger.info(\"[\".concat(d,\"]audioOn=\").concat(l)),this.setMediaStream(l,!0,0),this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_LOCAL_AUDIO,{value:l},d)},PluginlessCall.prototype.setScreenSharingOn=function(l,d){this.logger.info(\"[\".concat(d,\"]screenSharingOn=\").concat(l)),this.isScreenSharingOn=l,this.setMediaStream(this.isScreenSharingOn,this.isScreenSharingOn,2),this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_SCREEN_SHARING,{screenSharingOn:l},d),this.event(\"userActivityChanged\").raise(),this.raiseChanged()},PluginlessCall.prototype.disposeSharingScreenHandle=function(){this.sharedScreenHandle&&(this.unsubscribeFromSharedScreenHandleEvents(),this.sharedScreenHandle.dispose(),this.sharedScreenHandle=null)},PluginlessCall.prototype.setMuted=function(l,d){this._muteState!==l&&(this._muteState=l,this.callTelemetry.recordEvent(A.CALL_OPERATIONS_INTERNAL.SET_MUTED,{isMuted:l},d),this.logger.info(\"[\".concat(d,\"]participantMuteState:\").concat(l,\", isMuted: \").concat(this.isMuted)),this.updateCapabilities(d),this.raiseChanged())},PluginlessCall.prototype.setSpeakerMuted=function(l,d){this.logger.info(\"[\".concat(d,\"]speakerMute=\").concat(l,\"]\")),this.isSpeakerMuted=l,this.raiseChanged()},PluginlessCall.prototype.monitorCallStart=function(){3===this.state&&this.participants.length&&!this.callStartedAt&&(this.callStartedAt=new Date)},PluginlessCall.prototype._removeParticipant=function(l,d,u){void 0===u&&(u=0);var p=this.logger.createFnLogger(\"removeParticipant\",d);p.info(\"mri=\".concat(J.scrubSignalingParticipant(l)));var h=E.remove(this.participants,(function(d){return d.isSameParticipantsMri(l.id)}))[0];h?(h.setState(4,u,d),this.event(\"participantRemoved\").raise(h)):p.logFailure(\"unable to remove participant \".concat(V.scrubMriOrOmit(l.id))),this.raiseChanged(this._changedEventSkipConfig)},PluginlessCall.prototype.setIsSomeoneSharing=function(l){var d=this;if(this.isSomeoneSharing===l||this.screenSharingRenegotiationDeferred&&this.callUsesMixer||(this.isSomeoneSharing=l,this.isSomeoneSharing&&this.isScreenSharingOn&&(this.stopScreenSharing(),this.logger.info(\"sharingStolen: Cleaning up local screenshare because remote screenshare is running\"),this.event(\"sharingStolen\").raise())),this.allowScreenSharingControl()){var u=this.localSignalingParticipant.endpointDetails.find((function(l){return d._endpointId===l.endpointId})),p=this.participants.find((function(l){return l.streams[1].some((function(l){return l.isAvailable}))}));this.screenSharingControl.startOrStopControlForViewer(this.isSomeoneSharing,p,u)}},PluginlessCall.prototype.handleOfferedModalities=function(l,d){var u=this.mediaAgent.constants.MEDIA_STATE,p=this.logger.createFnLogger(\"handleOfferedModalities\",d);try{p.info(\"offeredModalities=\".concat((0,D.safeJsonStringify)(l)))}catch(l){p.logFailure(l)}l.hasOwnProperty(\"video\")||this.mediaStateConfigurationHelper.isSending(1)?l.hasOwnProperty(\"video\")&&!this.mediaStateConfigurationHelper.isSending(1)&&this.mediaStateConfigurationHelper.removeModality(1):this.mediaStateConfigurationHelper.disableModality(1),l.hasOwnProperty(\"sharing\")||this.mediaStateConfigurationHelper.isSending(2)||this.mediaStateConfigurationHelper.disableModality(2),l.sharing!==u.receive||this.mediaStateConfigurationHelper.isSending(2)||this.mediaStateConfigurationHelper.removeModality(2),this.setIsSomeoneSharing(l.sharing===u.receive),this.isSomeoneStreamingVideo=l.video===u.receive||l.video===u.sendReceive},PluginlessCall.prototype.getRenegotiationOfferType=function(l){if(l)if(5===this.state){if(\"sendrecv\"===l.audio)return q.RenegotiationOfferType.Resume}else if(this.modalitiesAreHold(l))return q.RenegotiationOfferType.Hold;return q.RenegotiationOfferType.Undefined},PluginlessCall.prototype.isRenegotiationHoldOrResume=function(l){return this.getRenegotiationOfferType(l)===q.RenegotiationOfferType.Hold||this.getRenegotiationOfferType(l)===q.RenegotiationOfferType.Resume},PluginlessCall.prototype.isValidHoldResumeCallState=function(l){return[3,5,10,13].includes(l)},PluginlessCall.prototype.onNegotiationCompletion=function(l,d,u,p,g){var f=this;void 0===u&&(u={});var m=this.logger.createFnLogger(\"onNegotiationCompletion\",p);m.info(\"byLocal=\".concat(d,\", result=\").concat((0,D.safeJsonStringify)(l))),this.callTelemetry.recordEvent(A.MEDIA_EVENT.NEGOTIATION_COMPLETION,h({phaseTelemetryBag:g},this.prepareNegotiationResultForTelemtry(l)),p);var v=this.isOneToOneCall();if(v){var y=this.modalitiesAreHold(l.activeModalities)?5:3;this.participants[0].setState(y,void 0,p),m.info(\"isOneToOneCall: participant[0] state set to \".concat(y))}var S,_=this.modalitiesAreHold(l.configuredModalities),C=this.modalitiesAreHold(l.activeModalities),T=this._enableStaging&&this.signalingSession.participantManager.localParticipant.isStaging;m.info(\"isStaging= \".concat(T)),this.requestedHoldState?(_&&C||m.info(\"Not expected modalities when processing local hold: \".concat(_,\" \").concat(C)),4!==this.state&&m.info(\"Not expected state when processing local hold: \".concat(this.state,\", switching back to LocalHold\"))):d||this.callHoldResumeDeferred?!_&&C?S=5:_||C||this._callInLobby||this.isPreheatedOnly()||(S=T?13:3):4===this.state||this._callInLobby||this.isPreheatedOnly()||(S=v&&5===this.participants[0].state?5:T?13:3),S&&this.setCallState(S,p),this.callHoldResumeDeferred&&(m.info(\"isHoldInProgress=\".concat(this.isHoldInProgress,\", state=\").concat(this.state)),this.isHoldInProgress?this.finishCallHoldResume():this.inLocalHold()||this.finishCallHoldResume(this.isValidHoldResumeCallState(S)?void 0:new Error(\"Call state changed to \".concat(S,\" instead of Connected, Lobby, Staging or RemoteHold\")))),this.requestedHoldState||(this.setIsSomeoneSharing(E.some(this.participants,(function(l){return E.some(l.streams[1],(function(l){return l.isAvailable}))}))),this.isSomeoneStreamingVideo=E.some(this.participants,(function(l){return E.some(l.streams[0],(function(l){return l.isAvailable}))})));var b=u&&u.sharing===this.mediaAgent.constants.MEDIA_STATE.send,I=l&&l.activeModalities&&l.activeModalities.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(this.screenSharingRenegotiationDeferred&&b&&I&&(this.screenSharingRenegotiationDeferred.resolve(),this.screenSharingRenegotiationDeferred=null),this.retryOutgoingRenegotiation.retry){var R=this.retryOutgoingRenegotiation.causeId;this._callOperationHandler.executeChained((function(){return f.updateMediaModalities(void 0,R)}),A.CALL_OPERATIONS_INTERNAL.RENEGOTIATE,R,R,void 0,void 0,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),this.retryOutgoingRenegotiation.retry=!1}},PluginlessCall.prototype.updateMediaStatus=function(l){return v(this,void 0,void 0,(function(){var d,u,p,h,g,f,m,v;return y(this,(function(y){switch(y.label){case 0:d=!1,u=!1;try{for(p=S(this.participants),h=p.next();!h.done&&(g=h.value,d||(d=E.some(g.streams[1],(function(l){return l.isAvailable}))),u||(u=E.some(g.streams[0],(function(l){return l.isAvailable}))),!d||!u);h=p.next());}catch(l){m={error:l}}finally{try{h&&!h.done&&(v=p.return)&&v.call(p)}finally{if(m)throw m.error}}return this.setIsSomeoneSharing(d),this.isSomeoneStreamingVideo=u,this.mediaSession?[4,this.updateMediaModalities(void 0,l)]:[3,2];case 1:f=y.sent(),this.callTelemetry.updateOperationData(A.CALL_OPERATIONS_INTERNAL.UPDATE_LOCAL_MEDIA_STATUS,f,l),y.label=2;case 2:return[2]}}))}))},PluginlessCall.prototype.onNegotiationFailure=function(l,d,u,p){var h=p&&p.sharing===this.mediaAgent.constants.MEDIA_STATE.send;if(d===this.mediaAgent.constants.RENEGOTIATION_ERROR.glare)return this.screenSharingRenegotiationDeferred&&h&&this.callStats.localStats.screenShare.negotiationStateChanged(\"rejected\",\"glare\"),void(this.retryOutgoingRenegotiation={retry:!0,causeId:u});var g=new Error(\"Error in renegotiateOutgoing() -> rejecting hold for callId = \".concat(this.callId,\", reason=\").concat(d));g.innerError=l,this.finishCallHoldResume(g),this.screenSharingRenegotiationDeferred&&h&&(this.screenSharingRenegotiationDeferred.reject(l),this.screenSharingRenegotiationDeferred=null)},PluginlessCall.getParticipantReasonFromTerminatedReason=function(l){switch(l){case 1:return 0;case 9:return 2;case 10:return 3;case 2:return 4;case 24:return 8;case 3:return 9;case 4:return 10;case 14:return 12;case 0:return 11;case 15:return 13;case 16:return 14;case 17:return 15;case 18:return 16;case 19:return 17;case 20:return 18;case 11:return 19;case 21:return 20;case 22:return 21;case 23:return 22;case 33:return 25;case 36:return 26;case 37:return 27;case 41:return 30;case 39:return 28;case 42:return 31;case 40:return 29;case 43:return 32;case 44:return 33;case 45:return 34;case 46:return 35;case 47:return 36;case 48:return 37;case 49:return 38;case 50:return 39;case 51:return 40;case 52:return 41;case 54:return 42;case 55:return 44;case 56:return 45;case 12:return 23;case 59:return 46;case 73:return 59;case 61:return 47;case 60:return 48;case 62:return 49;case 63:return 50;case 64:return 5;case 65:return 51;case 8:return 52;default:return 11}},PluginlessCall.prototype.isRemoteParticipantInStaging=function(l){var d,u;if(!l.endpointDetails)return!1;try{for(var p=S(l.endpointDetails),h=p.next();!h.done;h=p.next()){var g=h.value;if(!(0,j.hasStagingGroup)(g))return!1}}catch(l){d={error:l}}finally{try{h&&!h.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}return!0},PluginlessCall.prototype.updateCallParticipantFromSignalingParticipant=function(l,d,u){if(E.every(d.endpointDetails,(function(l){return(null==l?void 0:l.isLobby)||(null==l?void 0:l.streamLobby)})))l.setState(7,void 0,u);else{var p=E.some(d.endpointDetails,(function(l){return null==l?void 0:l.streamInformation})),h=this.getStreamInformationMap(d);h&&this.logger.info(\"[updateCallParticipantFromSignalingParticipant]: new streamInfoMap: \".concat((0,D.safeJsonStringify)(h)));var g=d.endpointDetails&&E.some(d.endpointDetails,(function(l){return l.mappedTo})),f=PluginlessCall.filterVirtualEndpoints(d.endpointDetails),m=f&&f[0].mediaStreams,v=d.endpointDetails&&d.endpointDetails[0].lwjSessionInformation,y=this._enableStaging&&this.isRemoteParticipantInStaging(d);if(m&&m.length>0){var S=m.every((function(l){return\"inactive\"===l.direction})),_=S?5:y?8:3;1!==this.state||S||this.callUsesMixer||(_=2),this.logger.info(\"[updateCallParticipantFromSignalingParticipant]: with mediaStreams is not empty, ParticipantState is set to \".concat(_)),l.setState(_,void 0,u)}else if(m||v||g||p){_=y?8:3;this.logger.info(\"[updateCallParticipantFromSignalingParticipant]: ParticipantState is set to \".concat(_,\", mediaStreams=\").concat(!!m,\", lwj=\").concat(!!v,\", hasMappedEndpoints=\").concat(g,\", hasPlayerStreams=\").concat(p)),l.setState(_,void 0,u)}}},PluginlessCall.prototype.handleSelfServerMutedState=function(l){var d=this,u=PluginlessCall.filterVirtualEndpoints(this.localSignalingParticipant.endpointDetails),p=E.find(u,(function(l){return d._endpointId===l.endpointId})),h=p&&p.mediaStreams,g=h&&h.filter((function(l){return\"audio\"===l.type||\"audio-teleconferencing\"===l.type}));if(g&&g.length>0){var f=g.some((function(l){return l.serverMuted}));f!==this.isServerMuted&&(this.isServerMuted=f,this.callTelemetry.recordEvent(A.PARTICIPANT_OPERATIONS_INTERNAL.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted}),this.logger.info(\"updateLocalParticipant: server muted set to \".concat(f)),this.event(\"serverMutedChanged\").raise(f),this.updateCapabilities(l,!0),this.handleServerMutedState(l))}},PluginlessCall.prototype.checkIfIncomingServerMutedIsUpdated=function(l){var d=this,u=E.find(this.localSignalingParticipant.endpointDetails,(function(l){return l.participantId===d.localSignalingParticipant.participantId}));if(void 0!==u){var p=E.find(l.endpointDetails,(function(l){return d.localSignalingParticipant.participantId}));K.handleServerMutedVersion(this.logger,u,p)}},PluginlessCall.prototype.convertWiredPublishedState=function(l){if(l){var d=this.getPluginlessStateTypeFromWire(l.stateType);return{content:l.content,stateType:d,typeRank:l.typeRank,stateId:l.stateId}}},PluginlessCall.prototype.updatePublishedStateModified=function(l,d){l!==this.currentUserSkypeIdentity.id||d&&d!==this.participantId?this._publishedStatesModified=this._publishedStatesModified|ae.Other:this._publishedStatesModified=this._publishedStatesModified|ae.Self},PluginlessCall.prototype.updatePublishedStates=function(l){var d=this;try{var u=[];E.forEach(l.publishedStates,(function(l){u.push(d.convertWiredPublishedState(l))})),E.isEqual(this._participantPublishedStatesMap[l.id],u)||(0!==u.length||void 0!==this._participantPublishedStatesMap[l.id]&&null!==this._participantPublishedStatesMap[l.id])&&(this._participantPublishedStatesMap[l.id]=u,this.updatePublishedStateModified(l.id));var p=[];E.forEach(l.endpointDetails,(function(h){p.push(h.participantId),u=[],E.forEach(h.publishedStates,(function(p){var g=d.convertWiredPublishedState(p);d._endpointPublishedStatesMap[l.id]||(d._endpointPublishedStatesMap[l.id]={},d._endpointPublishedStatesMap[l.id][h.participantId]=[]),u.push(g)})),d._endpointPublishedStatesMap[l.id]&&!E.isEqual(d._endpointPublishedStatesMap[l.id][h.participantId],u)&&(0!==u.length||null!==d._endpointPublishedStatesMap[l.id][h.participantId]&&void 0!==d._endpointPublishedStatesMap[l.id][h.participantId])&&(d._endpointPublishedStatesMap[l.id][h.participantId]=u,d.updatePublishedStateModified(l.id,h.participantId))})),this._endpointPublishedStatesMap[l.id]&&Object.keys(this._endpointPublishedStatesMap[l.id]).forEach((function(u){p.some((function(l){return l===u}))||(delete d._endpointPublishedStatesMap[l.id][u],d.updatePublishedStateModified(l.id,u))}))}catch(l){this.logger.error(\"updatePublishedStates \".concat(JSON.stringify(l)))}this.logger.info(\"updatePublishedStates \".concat(JSON.stringify(this._participantPublishedStatesMap))),this.logger.info(\"updatePublishedStates \".concat(JSON.stringify(this._endpointPublishedStatesMap)))},PluginlessCall.prototype.removePublishedStatesByParticipant=function(l){this._endpointPublishedStatesMap[l]&&delete this._endpointPublishedStatesMap[l],this._participantPublishedStatesMap[l]&&delete this._participantPublishedStatesMap[l],this.updatePublishedStateModified(l)},PluginlessCall.prototype.findOrCreateTypeState=function(l){var d=this._publishedStates.typeStates.findIndex((function(d){return d.type===l}));if(-1===d){var u={participantStates:[],type:l};this._publishedStates.typeStates.push(u),d=this._publishedStates.typeStates.length-1}return d},PluginlessCall.prototype.processPublishedStates=function(){var l,d,u,p,h=this;this.logger.info(\"processPublishedStates \".concat(JSON.stringify(this._participantPublishedStatesMap))),this.logger.info(\"processPublishedStates \".concat(JSON.stringify(this._endpointPublishedStatesMap)));try{this._publishedStates||(this._publishedStates={typeStates:[]}),this._publishedStates.typeStates=[];var _loop_4=function(l){var d=g._participantPublishedStatesMap[l];E.forEach(d,(function(d){var u=h.findOrCreateTypeState(d.stateType),p={id:l,publishedState:{content:d.content,stateId:d.stateId,typeRank:d.typeRank}};h._publishedStates.typeStates[u].participantStates.push(p)}))},g=this;try{for(var f=S(Object.keys(this._participantPublishedStatesMap)),m=f.next();!m.done;m=f.next()){_loop_4(m.value)}}catch(d){l={error:d}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}var _loop_5=function(l){var d,u,_loop_6=function(d){v._endpointPublishedStatesMap[l][d].forEach((function(u){var p=h.findOrCreateTypeState(u.stateType),g={id:d,publishedState:{content:u.content,stateId:u.stateId,typeRank:u.typeRank}},f={id:l,endpoints:[g]},m=h._publishedStates.typeStates[p].participantStates.filter((function(d){return d.id===l}));m&&m.length>0?(m[0].endpoints||(m[0].endpoints=[]),m[0].endpoints.push(g)):h._publishedStates.typeStates[p].participantStates.push(f)}))};try{for(var p=(d=void 0,S(Object.keys(v._endpointPublishedStatesMap[l]))),g=p.next();!g.done;g=p.next()){_loop_6(g.value)}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}},v=this;try{for(var y=S(Object.keys(this._endpointPublishedStatesMap)),_=y.next();!_.done;_=y.next()){_loop_5(_.value)}}catch(l){u={error:l}}finally{try{_&&!_.done&&(p=y.return)&&p.call(y)}finally{if(u)throw u.error}}this.event(\"publishedStatesChanged\").raise(this._publishedStates),this.raiseChanged()}catch(l){this.logger.error(\"processPublishedStates \".concat(l,\"}\"))}},PluginlessCall.prototype.updateLocalParticipant=function(l,d){var u=this,p=this.logger.createFnLogger(\"updateLocalParticipant\",d);this.checkIfIncomingServerMutedIsUpdated(l),this.localSignalingParticipant.endpointDetails=l.endpointDetails,this.localSignalingParticipant.role=l.role,this.setMeetingRole(l.meetingRole),this.setAdvancedMeetingRole(l.advancedMeetingRole),this.localSignalingParticipant.tenantId=l.tenantId,this.localSignalingParticipant.isLobby=l.isLobby,this.callTelemetry.setTenantId(l.tenantId),this.callStats.setTenantId(l.tenantId);var h=this.localSignalingParticipant.isLobby;l.endpointDetails&&this.updateLocalParticipantEndpoints(l.endpointDetails),this.updatePublishedStates(l),this.handleSelfServerMutedState(d);var g=this.getLocalSignalingEndpointDetails();this._callInLobby=h||!!(null==g?void 0:g.streamLobby),this.signalingSession.participantManager.localParticipant.isStaging=l.isStaging;var f=this._enableStaging&&this.signalingSession.participantManager.localParticipant.isStaging;p.info(\"callInLobby = \".concat(h,\", callSetupComplete = \").concat(this._callIsSetupComplete,\", callIsHeld = \").concat(this.callIsHeld(),\", isStaging = \").concat(f)),!this._callIsSetupComplete||this.callIsHeld()||H.callStateIsAnyOf(this.state,[11,12])||(h?this.setCallState(10,d):f&&H.callStateIsAnyOf(this.state,[3,13,10,9,2])?this.setCallState(13,d):this.setCallState(3,d));var m=PluginlessCall.getStreamsFromEndpoints(l.endpointDetails);if(this.callTelemetry.recordEvent(A.PARTICIPANT_OPERATIONS_INTERNAL.UPDATE_LOCAL_PARTICIPANT_STREAM,(0,ie.getStreamInformation)(m),d),this.streamManager.updateStreams(m,d),this.updateCapabilities(d,!0),this.allowScreenSharingControl()){var v=l.endpointDetails.find((function(l){return u._endpointId===l.endpointId})),y=this.participants.find((function(l){return l.streams[1].some((function(l){return l.isAvailable}))}));this.screenSharingControl.startOrStopControlForViewer(this.isSomeoneSharing,y,v)}},PluginlessCall.prototype.modalitiesAreHold=function(l){return!(l.audio&&\"inactive\"!==l.audio||l.video&&\"inactive\"!==l.video||l.sharing&&\"inactive\"!==l.sharing)},PluginlessCall.prototype.toneToString=function(l){switch(l){case 0:return\"0\";case 1:return\"1\";case 2:return\"2\";case 3:return\"3\";case 4:return\"4\";case 5:return\"5\";case 6:return\"6\";case 7:return\"7\";case 8:return\"8\";case 9:return\"9\";case 10:return\"*\";case 11:return\"#\";default:return null}},PluginlessCall.streamingStatetoMediaStreamState=function(l){switch(l){case\"started\":return 0;case\"active\":return 2;case\"inactive\":return 1;case\"stopped\":return 3;case\"failed\":default:return 4}},PluginlessCall.streamingDirectionToMediaDirectionMapping=function(l){switch(l){case\"send\":return 1;case\"receive\":return 0;default:return}},PluginlessCall.convertMuteScope=function(l){switch(l){case 0:return\"EveryoneElse\";case 1:return\"SpecifiedParticipants\";default:return}},PluginlessCall.prototype.callIsHeld=function(){return 4===this.state||5===this.state},PluginlessCall.prototype.inLocalHold=function(){return this.isHoldInProgress||4===this.state},PluginlessCall.prototype.isJoinedLightweight=function(){var l=this,d=E.find(this.endpoints.endpointDetails,(function(d){return l.participantId===d.participantId})),u=d&&d.lwjSessionInformation;return!!this.lwjUris||!!u},PluginlessCall.prototype.telemetryDataFromCallStartOptions=function(l){var d={};return l.muteFlags&&(d.muteMicrophone=!!(1&l.muteFlags),d.muteSpeaker=!!(2&l.muteFlags)),Object.keys(d).length?d:void 0},PluginlessCall.prototype.reconnect=function(){var l=(0,P.generateCauseId)();return this.mediaSession.reconnectAsync(l)},PluginlessCall.prototype.provideCallQualityFeedback=function(l,d,u,p){return v(this,void 0,void 0,(function(){return y(this,(function(l){return[2]}))}))},PluginlessCall.prototype.showCQFInfo=function(l,d){return v(this,void 0,void 0,(function(){return y(this,(function(l){throw new Error(\"Not implemented\")}))}))},PluginlessCall.prototype.isCqfRendered=function(l){return v(this,void 0,void 0,(function(){return y(this,(function(l){return[2]}))}))},PluginlessCall.prototype.provideCallQualityFeedbackEx=function(l,d,u,p,h,g){return v(this,void 0,void 0,(function(){return y(this,(function(l){return[2]}))}))},PluginlessCall.prototype.testTriggerMediaRelayWhiteListingIssue=function(){this.logger.info(\"Simulating media relay whitelisting issue for test purposes\");var l=this.mediaSession.mediaSession.callback,d={type:\"NetworkRelaysNotReachable\",value:\"Bad\",isLocalSource:!0,mediaType:\"Audio\"};l.onQualityChanged(d);var u={direction:\"send\",stream:\"failed\",content:\"audio\"};l.onAudioStateChanged(u)},PluginlessCall.prototype.getMediaTelemetry=function(l){var d;return void 0===l&&(l=!1),v(this,void 0,void 0,(function(){var u,p;return y(this,(function(h){switch(h.label){case 0:return this.mediaSession?(p=(u=this.callStats).setMediaStats,[4,this.mediaSession.getStatsAsync(l)]):[3,2];case 1:p.apply(u,[h.sent()]),this.callStats.appendDataChannelInfo(this.dataChannel.getTelemetry()),this.callStats.appendSharingControlInfo(null===(d=this.screenSharingControl)||void 0===d?void 0:d.isScreenSharingControlEnabled()),this.callStats.appendMediaControlPaneInfo(JSON.stringify(this.mediaControlPlane.getTelemetryReport())),h.label=2;case 2:return[2,this.callStats.buildMediaTelemetry()]}}))}))},PluginlessCall.prototype.getMediaLogs=function(){return this.mediaAgent.getMediaLogs()},PluginlessCall.prototype.testSetCallState=function(l){this.logger.info(\"Overwriting call state for test purposes: \".concat(this.state,\" -> \").concat(l,\" \")),this.state=l},PluginlessCall.prototype.testSetCallType=function(l){this.logger.info(\"Overwriting call state for test purposes: \".concat(this.callType,\" -> \").concat(l,\" \")),this.callType=l},PluginlessCall.prototype.addGroupModality=function(l,d){void 0===d&&(d=(0,P.generateCauseId)());var u,p=this.logger.createFnLogger(A.CALL_OPERATIONS.ADD_GROUP_MODALITY,d);if(!l.threadId&&!l.groupId)return Promise.reject((0,M.getRejectTransactionEnd)(\"No threadId/groupId was provided.\"));if(6===this.state||7===this.state)return p.info(\"Not adding modality because CallState is \".concat(this.state,\" groupId=\").concat(V.scrubMriOrOmit(l.groupId),\", threadId = \").concat(V.getLoggableThreadId(l.threadId),\" messageId = \").concat(l.messageId)),Promise.reject((0,M.getRejectTransactionEnd)(A.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED));if(l.additionalData)try{u=JSON.stringify(l.additionalData)}catch(d){p.logFailure(\"additionalData: \".concat(l.additionalData,\" is not valid Json, error: \").concat(d));var h={code:q.jsCallEndCodes.BadRequest,subCode:0,phrase:\"additionalData is not valid Json, error: \".concat(d)};return Promise.reject(h)}p.info(\"groupId=\".concat(V.scrubMriOrOmit(l.groupId),\", threadId = \").concat(V.getLoggableThreadId(l.threadId),\" messageId = \").concat(l.messageId,\" additionalData = \").concat(V.scrubMriOrOmit(u)));var g={groupId:l.groupId,threadId:l.threadId,messageId:l.messageId,additionalData:u};return this.signalingSession.addGroupModalityAsync(g,d).catch((function(l){return p.logFailure((0,D.getPrintableObject)(l)),Promise.reject(l)}))},PluginlessCall.prototype.addBroadcastModality=function(l,d){var u=this,p=this.logger.createFnLogger(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,d);return Promise.resolve().then((function(){u.signalingSession.addBroadcastModalityAsync(l,d)})).catch((function(l){return p.logFailure((0,D.getPrintableObject)(l)),Promise.reject((0,M.getRejectTransactionEnd)(l))})).then((function(){return u._callOperationHandler.waitForOperation(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY)})).catch((function(l){throw u.callTelemetry.updateOperationData(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY,{error:(0,D.getPIISafeObject)(l)},d),p.logFailure(l),l}))},PluginlessCall.convertQualityEventType=function(l){switch(l){case\"NetworkSendQuality\":return 1;case\"NetworkRecvQuality\":return 2;case\"NetworkDelay\":return 3;case\"NetworkBandwidthLow\":return 4;case\"NetworkReconnect\":return 5;case\"NetworkPacketLoss\":return 6;case\"NetworkJitter\":return 7;case\"NetworkRateMatching\":return 8;case\"DeviceCaptureNotFunctioning\":return 9;case\"DeviceRenderNotFunctioning\":return 10;case\"DeviceRenderGlitches\":return 11;case\"DeviceLowSNR\":return 12;case\"DeviceLowSpeechLevel\":return 13;case\"DeviceClipping\":return 14;case\"DeviceEcho\":return 15;case\"DeviceNearEndToEchoRatio\":return 16;case\"DeviceHalfDuplexAec\":return 17;case\"DeviceMultipleEndpoints\":return 18;case\"DeviceHowling\":return 19;case\"DeviceRenderZeroVolume\":return 20;case\"DeviceRenderMute\":return 21;case\"NetworkSendCatastrophic\":return 22;case\"NetworkRecvCatastrophic\":return 23;case\"CpuInsufficient\":return 24;case\"DeviceCaptureMute\":return 25;case\"DeviceCaptureNotMuteButSilent\":return 26;case\"DeviceSpeakWhileMuted\":return 27;case\"VideoVbssRendered\":return 28;case\"NetworkEthernetInterfaceUsed\":return 29;case\"NetworkWlanInterfaceUsed\":return 30;case\"NetworkWwanInterfaceUsed\":return 31;case\"NetworkRelaysNotReachable\":return 32;case\"VideoCapturerDeviceStartFailed\":return 33;case\"VideoCapturerDeviceStartTimedOut\":return 34;case\"VideoCapturerDeviceStartFailureLackSystemRes\":return 35;case\"VideoCapturerDeviceStartFailureMFResConflict\":return 36;case\"NoNetwork\":return 37;case\"NetworkNotWorking\":return 38;case\"DeviceCaptureNotFunctioningDeviceInUse\":return 39;case\"DeviceRenderNotFunctioningDeviceInUse\":return 40;case\"VideoCaptureDeviceFreeze\":return 45;case\"ZeroCaptureDevicesEnumerated\":return 43;case\"ZeroRenderDevicesEnumerated\":return 44;case\"VideoCapturePermissionDenied\":return 47;case\"ScreenshareRecordingDisabled\":return 55;case\"AudioCapturePermissionDenied\":return 46;case\"VideoCaptureFreezeRecovered\":return 48;case\"DeviceRenderHowling\":return 49;case\"PresentationAudioLoopbackDeviceState\":return 53;case\"RemoteNetworkConnectivityIssue\":return 52;case\"AudioCaptureUltrasoundDetected\":return 54;case\"MusicModeNotAvailable\":return 57;case\"CameraLighting\":return 61;case\"ImageRenderingQuality\":return 51;case\"AudioLoopbackDeviceReady\":return 63;case\"NoRequiredVideoCodecs\":return 64;default:return}},PluginlessCall.convertQualityLevel=function(l){switch(l){case\"Unknown\":return 0;case\"Good\":return 1;case\"Poor\":return 2;case\"Bad\":return 3;default:return}},PluginlessCall.convertMediaType=function(l){switch(l){case\"Audio\":return 0;case\"Video\":return 1;case\"ScreenShare\":return 2;case\"Data\":return 3;default:return}},PluginlessCall.prototype.getPluginlessPublishLevel=function(l){switch(l){case\"user\":return\"user\";case\"endpoint\":return\"endpoint\";default:throw\"Invalid level type.\"}},PluginlessCall.prototype.getPluginlessStateType=function(l){switch(l){case\"raiseHands\":return\"raiseHands\";case\"ufd\":return\"ufd\";case\"attendeeModalitiesUnrestricted\":return\"attendeeModalitiesUnrestricted\";case\"attendeeAudioRestricted\":return\"attendeeAudioRestricted\";case\"attendeeVideoRestricted\":return\"attendeeVideoRestricted\";case\"attendeeVideoUnrestricted\":return\"attendeeVideoUnrestricted\";case\"spotlight\":return\"spotlight\";case\"weatherPerson\":return\"weatherPerson\";case\"sharingLayoutType\":return\"sharingLayoutType\";case\"manageBreakoutRooms\":return\"manageBreakoutRooms\";case\"togetherMode\":return\"togetherMode\";default:throw\"Invalid state type when converting PublishStateType to PublishType.\"}},PluginlessCall.prototype.getPluginlessStateTypeFromWire=function(l){switch(l){case\"raiseHands\":return\"raiseHands\";case\"ufd\":return\"ufd\";case\"attendeeModalitiesUnrestricted\":return\"attendeeModalitiesUnrestricted\";case\"attendeeAudioRestricted\":return\"attendeeAudioRestricted\";case\"attendeeVideoRestricted\":return\"attendeeVideoRestricted\";case\"attendeeVideoUnrestricted\":return\"attendeeVideoUnrestricted\";case\"spotlight\":return\"spotlight\";case\"weatherPerson\":return\"weatherPerson\";case\"sharingLayoutType\":return\"sharingLayoutType\";case\"manageBreakoutRooms\":return\"manageBreakoutRooms\";case\"togetherMode\":return\"togetherMode\";default:throw\"Invalid state type when converting PublishType to PublishStateType.\"}},PluginlessCall.prototype.setIsEmergency=function(l){this.logger.info(\"Set isEmergency:\".concat(l)),this.isEmergency=l,this.callTelemetry.setIsEmergency(l)},PluginlessCall.filterVirtualEndpoints=function(l){return l&&E.filter(l,(function(l){return!l.mappedTo}))},PluginlessCall.prototype.mapDataChannelSourceIdToParticipant=function(l){var d=null;return(d=1===this.callType?this.participants[0]:E.find(this.participants,(function(d){return d.hasSourceId(3,l)})))&&d.id?this.logger.info(\"ParticipantId: \".concat(V.scrubMriOrOmit(d.id),\" to SourceId: \").concat(l)):this.logger.warn(\"No Participant found for SourceId: \".concat(l)),d},PluginlessCall.prototype.getDataChannelSourceId=function(){var l=this,d=E.find(this.endpoints.endpointDetails,(function(d){return null!==d&&d.participantId===l._participantId}));if(!d)return this.logger.warn(\"No participantLeg found for participantId: \".concat(this._participantId)),-1;if(!d.mediaStreams)return this.logger.warn(\"ParticipantLeg \".concat(this._participantId,\" does not have valid mediaStreams\")),-1;var u=E.find(d.mediaStreams,(function(l){return 3===L.mapMediaTypeStringToMediaType(l.type)}));return u?u.sourceId:(this.logger.warn(\"participantLeg \".concat(this._participantId,\" has no data channel\")),-1)},PluginlessCall.prototype.initializeMediaControlPlane=function(){var l=this;this.mediaControlPlane=new T.MediaControlPlane(this.dataChannel,this.logger.createChild(\"MCP\"),this.mediaAgent.getConfigProvider().config.mediaControlPlaneConfig),this.mediaControlPlane.on(\"mpSendBandwidthChanged\",(function(d){var u,p=null===(u=l.mediaSession)||void 0===u?void 0:u.getExtensionsManager();null==p||p.processNotification(\"BandwithNotification\",{bw:d})}))},g([(0,F.callOperation)(A.CALL_OPERATIONS.INITIALIZE,{type:F.OPERATION_TYPE.SYNC,convertError:!0,idempotencyLevel:F.IDEMPOTENCY_LEVEL.NO_OP}),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",void 0)],PluginlessCall.prototype,\"init\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_VIDEO,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startVideo\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.STOP_VIDEO,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"stopVideo\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"dumpVideoSourceImages\",null),g([m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"hold\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.HOLD,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"holdWithRenegotiate\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.LOCAL_HOLD,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"localHold\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UNHOLD,{waitFor:[A.CALL_OPERATIONS.HOLD,A.CALL_OPERATIONS.LOCAL_HOLD],preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"unhold\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"updateEndpointMetadata\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SEND_DTMF_TONE,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),f(\"design:type\",Function),f(\"design:paramtypes\",[Number]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"sendDtmfTone\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SET_AUDIO_USAGE),f(\"design:type\",Function),f(\"design:paramtypes\",[String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"setAudioUsageMode\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Number]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"setAudioMidcallConfig\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SET_AUDIO_MIDCALL_CONFIG_JSON,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"setAudioMidcallConfigJson\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0,type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"callBlindTransfer\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0,type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"callSafeTransfer\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.TRANSFER_TO_VOICEMAIL,{singular:!0,type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"transferCallToVoicemail\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0,type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object,String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"callConsultativeTransfer\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.CONSULTATIVE_TRANSFER_WITH_PICKUP_CODE,{singular:!0,type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),f(\"design:type\",Function),f(\"design:paramtypes\",[String,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"consultativeTransferWithPickupCode\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.CALL_REDIRECT,{singular:!0,type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"callRedirect\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.PARK_CALL,{type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Number,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"park\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UNPARK_CALL,{type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Number,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"unpark\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.GET_TECHNICAL_INFORMATION_JSON),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"getTechnicalInformationJson\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_SCREEN_SHARING,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(3,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object,String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startScreenSharing\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.STOP_SCREEN_SHARING,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Boolean,String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"stopScreenSharing\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_DATA_CHANNEL,{type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startDataChannel\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.STOP_DATA_CHANNEL,{type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"stopDataChannel\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),f(\"design:type\",Function),f(\"design:paramtypes\",[Boolean]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"shareSystemSound\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.MUTE,{waitFor:A.CALL_OPERATIONS.JOIN_PREHEATED_CALL,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"mute\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UNMUTE,{waitFor:A.CALL_OPERATIONS.JOIN_PREHEATED_CALL,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"unmute\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.MUTE_SPEAKER,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"muteSpeaker\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UNMUTE_SPEAKER,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"unmuteSpeaker\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.MUTE_PARTICIPANTS),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Number,Array,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"muteParticipants\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_AUDIO,{type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startAudio\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.STOP_AUDIO,{type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"stopAudio\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.ASSIMILATE),m(3,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String,String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"assimilate\",null),g([m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"merge\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.MERGE_PARTICIPANTS),m(1,F.operationId),m(3,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Array,Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"mergeParticipants\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE),m(0,F.operationId),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"mergeWithPickupCode\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS),f(\"design:type\",Function),f(\"design:paramtypes\",[Number]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"setMaxVideoChannels\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.STOP_CALL),m(1,F.causeId),m(3,F.reason),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"stop\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.PUBLISH_STATE),m(1,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"publishState\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.PUBLISH_STATE),m(1,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"publishStatesForEveryone\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.REMOVE_STATE),m(1,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"removeState\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.REMOVE_STATE),m(1,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"removeStatesForEveryone\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UPDATE_MEETING_SETTINGS),m(1,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"updateMeetingSettings\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UPDATE_MEETING_GROUPS),m(0,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"updateMeetingGroups\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UPDATE_MEETING_LIVE_STATE),m(0,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"updateMeetingLiveState\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE),m(0,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Array]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"updateParticipantInterpretationState\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.JOIN_MEETING_GROUP),m(0,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"joinMeetingGroup\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.LEAVE_MEETING_GROUP),m(0,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"leaveMeetingGroup\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SEND_MESSAGES),m(0,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Array]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"sendMessages\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.UPDATE_MEETING_ROLE),f(\"design:type\",Function),f(\"design:paramtypes\",[Array,String,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"updateMeetingRoles\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.CREATE_CONTENT_SHARING_SESSION),m(4,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,String,String,String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"createContentSharingSession\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.STOP_CALL_WITH_BEACON,{type:F.OPERATION_TYPE.SYNC}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Boolean)],PluginlessCall.prototype,\"stopWithBeacon\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.ACKNOWLEDGE,{type:F.OPERATION_TYPE.CHAINED,convertError:!0,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"acknowledge\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.ACCEPT,{type:F.OPERATION_TYPE.CHAINED,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"accept\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.REJECT,{preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(0,F.causeId),m(1,F.reason),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"reject\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.JOIN_CALL,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),m(1,F.callStartOptions),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"join\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{waitFor:A.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED}),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"joinPreheatedCall\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_CALL,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),m(0,F.callStartOptions),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"start\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startCallToVoicemail\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SUBSCRIBE,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"joinCallWithoutCallModality\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_WITH_MEETING_DATA,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startWithMeetingData\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.JOIN_WITH_MEETING_DATA,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"joinWithMeetingData\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SUBSCRIBE_WITH_MEETING_DATA,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"subscribeWithMeetingData\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR}),m(1,F.callStartOptions),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Array,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startCallWithNudge\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:F.OPERATION_TYPE.CHAINED,idempotencyLevel:F.IDEMPOTENCY_LEVEL.ERROR,preconditionTags:[A.OPERATION_TAGS.NOT_SUPPORTED_IN_STREAMING_MODE]}),m(2,F.callStartOptions),m(3,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Number,String,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"startAndUnpark\",null),g([(0,F.participantOperation)(A.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),m(0,F.operationId),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"admitParticipant\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.ADMIT),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"admit\",null),g([(0,F.participantOperation)(A.PARTICIPANT_OPERATIONS.CALL_ME_BACK),m(0,F.operationId),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,String,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"callMeBack\",null),g([m(0,F.operationId),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"addParticipant\",null),g([(0,F.participantOperation)(A.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS),m(0,F.operationId),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Array,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"addParticipants\",null),g([m(0,F.operationId),m(2,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Array,Object,Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"addParticipantsImpl\",null),g([(0,F.participantOperation)(A.CALL_OPERATIONS.NUDGE_PARTICIPANTS),m(0,F.operationId),m(3,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Array,Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"nudgeParticipants\",null),g([(0,F.participantOperation)(A.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),m(0,F.operationId),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String,Object,String,Number]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"removeParticipant\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.SEARCH_PARTICIPANTS),m(1,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"searchParticipants\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.GET_ALL_PARTICIPANTS),m(1,F.operationId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"getAllParticipants\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.LWJ_FALLBACK),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Number,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"reconnectAsLwj\",null),g([m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"turnOffLocalVideoPreview\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS_INTERNAL.START_PREVIEW_VIDEO),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"turnOnLocalVideoPreview\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS_INTERNAL.UPDATE_LOCAL_MEDIA_STATUS,{type:F.OPERATION_TYPE.CHAINED}),m(0,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"updateMediaStatus\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS_INTERNAL.RECONNECT),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"reconnect\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.ADD_GROUP_MODALITY),m(1,F.causeId),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,Object]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"addGroupModality\",null),g([(0,F.callOperation)(A.CALL_OPERATIONS.ADD_BROADCAST_MODALITY),f(\"design:type\",Function),f(\"design:paramtypes\",[Object,String]),f(\"design:returntype\",Promise)],PluginlessCall.prototype,\"addBroadcastModality\",null),PluginlessCall}(x.default);d.default=ce},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.createParticipant=d.SkypeConCoreTelemetryManager=d.SignalingAgent=d.setDefaultsForSignalingConfig=d.IncomingNotificationMessageHandler=d.TM_CONSTANTS=d.CA_CONSTANTS=d.TrouterState=d.DeviceType=d.CommandUrlPresence=void 0;var p=u(74),h=u(76);Object.defineProperty(d,\"CommandUrlPresence\",{enumerable:!0,get:function(){return h.CommandUrlPresence}}),Object.defineProperty(d,\"DeviceType\",{enumerable:!0,get:function(){return h.DeviceType}}),Object.defineProperty(d,\"TrouterState\",{enumerable:!0,get:function(){return h.TrouterState}});var g=u(5);Object.defineProperty(d,\"CA_CONSTANTS\",{enumerable:!0,get:function(){return g.default}});var f=u(25);Object.defineProperty(d,\"TM_CONSTANTS\",{enumerable:!0,get:function(){return f.default}});var m=u(195);Object.defineProperty(d,\"IncomingNotificationMessageHandler\",{enumerable:!0,get:function(){return m.default}});var v=u(99);Object.defineProperty(d,\"setDefaultsForSignalingConfig\",{enumerable:!0,get:function(){return v.default}});var y=u(214);Object.defineProperty(d,\"SignalingAgent\",{enumerable:!0,get:function(){return y.default}});var S=u(296);function createParticipant(l){return new p.default(l)}Object.defineProperty(d,\"SkypeConCoreTelemetryManager\",{enumerable:!0,get:function(){return S.default}}),d.createParticipant=createParticipant},function(l,d,u){var p={};(0,u(38).assign)(p,u(187),u(190),u(98)),l.exports=p},function(l,d,u){function adler32(l,d,u,p){for(var h=65535&l|0,g=l>>>16&65535|0,f=0;0!==u;){u-=f=u>2e3?2e3:u;do{g=g+(h=h+d[p++]|0)|0}while(--f);h%=65521,g%=65521}return h|g<<16|0}l.exports=adler32},function(l,d,u){function makeTable(){for(var l,d=[],u=0;u<256;u++){l=u;for(var p=0;p<8;p++)l=1&l?3988292384^l>>>1:l>>>1;d[u]=l}return d}var p=makeTable();function crc32(l,d,u,h){var g=p,f=h+u;l^=-1;for(var m=h;m<f;m++)l=l>>>8^g[255&(l^d[m])];return-1^l}l.exports=crc32},function(l,d,u){var p=u(38),h=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(l){h=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){g=!1}for(var f=new p.Buf8(256),m=0;m<256;m++)f[m]=m>=252?6:m>=248?5:m>=240?4:m>=224?3:m>=192?2:1;function buf2binstring(l,d){if(d<65534&&(l.subarray&&g||!l.subarray&&h))return String.fromCharCode.apply(null,p.shrinkBuf(l,d));for(var u=\"\",f=0;f<d;f++)u+=String.fromCharCode(l[f]);return u}f[254]=f[254]=1,d.string2buf=function(l){var d,u,h,g,f,m=l.length,v=0;for(g=0;g<m;g++)55296==(64512&(u=l.charCodeAt(g)))&&g+1<m&&56320==(64512&(h=l.charCodeAt(g+1)))&&(u=65536+(u-55296<<10)+(h-56320),g++),v+=u<128?1:u<2048?2:u<65536?3:4;for(d=new p.Buf8(v),f=0,g=0;f<v;g++)55296==(64512&(u=l.charCodeAt(g)))&&g+1<m&&56320==(64512&(h=l.charCodeAt(g+1)))&&(u=65536+(u-55296<<10)+(h-56320),g++),u<128?d[f++]=u:u<2048?(d[f++]=192|u>>>6,d[f++]=128|63&u):u<65536?(d[f++]=224|u>>>12,d[f++]=128|u>>>6&63,d[f++]=128|63&u):(d[f++]=240|u>>>18,d[f++]=128|u>>>12&63,d[f++]=128|u>>>6&63,d[f++]=128|63&u);return d},d.buf2binstring=function(l){return buf2binstring(l,l.length)},d.binstring2buf=function(l){for(var d=new p.Buf8(l.length),u=0,h=d.length;u<h;u++)d[u]=l.charCodeAt(u);return d},d.buf2string=function(l,d){var u,p,h,g,m=d||l.length,v=new Array(2*m);for(p=0,u=0;u<m;)if((h=l[u++])<128)v[p++]=h;else if((g=f[h])>4)v[p++]=65533,u+=g-1;else{for(h&=2===g?31:3===g?15:7;g>1&&u<m;)h=h<<6|63&l[u++],g--;g>1?v[p++]=65533:h<65536?v[p++]=h:(h-=65536,v[p++]=55296|h>>10&1023,v[p++]=56320|1023&h)}return buf2binstring(v,p)},d.utf8border=function(l,d){var u;for((d=d||l.length)>l.length&&(d=l.length),u=d-1;u>=0&&128==(192&l[u]);)u--;return u<0||0===u?d:u+f[l[u]]>d?u:d}},function(l,d,u){function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=\"\",this.state=null,this.data_type=2,this.adler=0}l.exports=ZStream},function(l,d,u){l.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(77);function setDefaultsForSignalingConfig(l){var d=!0,u=\"enabled\",p=!1,g=!1,f=!0,m=!0,v=!0,y=!1,S=!1,_=!0,C=!0,E=!0,T=!0,b=!0,I=!1,A=!0,R=!1,P=!1,O=!1,M=!1,w=!0,N=!1,D=!0,L=!0,k=3,x=3e3,F=!1,U=!0,j=!0,B=!1,V=!0,H=!1,G=!1,W=!1,q=!1,z=!1,K=!1,J={conversationKeepAliveTimeoutSec:2700},Q=!1,Y=!1,$=3600,X=300,Z=30,ee=!1;l.cloudScreenSharingFlag=\"disabled\"===l.cloudScreenSharingFlag?l.cloudScreenSharingFlag:u,l.isWebRtcEnabled=\"undefined\"==typeof RTCIceGatherer,l.shouldServiceSendNGCUpgradeMessages=setDefault(l.shouldServiceSendNGCUpgradeMessages,f),l.isGVCOutgoingEnabled=setDefault(l.isGVCOutgoingEnabled,d),l.handleRosterFromCreateAndJoin=setDefault(l.handleRosterFromCreateAndJoin,A),l.supportsCompressedServicePayload=setDefault(l.supportsCompressedServicePayload,m),l.supportsSynchronousTrouterResponse=setDefault(l.supportsSynchronousTrouterResponse,v),l.supportsHostlessGroupCalls=setDefault(l.supportsHostlessGroupCalls,_),l.doHostlessCalling=setDefault(l.doHostlessCalling,p),l.brokerExclusively=setDefault(l.brokerExclusively,I),l.brokerEnabledOutgoing=setDefault(l.brokerEnabledOutgoing,E),l.brokerEnabledIncoming=setDefault(l.brokerEnabledIncoming,T),l.brokerRequestBatching=setDefault(l.brokerRequestBatching,b),l.handleMediaOfferFromPushNotification=setDefault(l.handleMediaOfferFromPushNotification,w),l.handleNewOfferRequest=setDefault(l.handleNewOfferRequest,R),l.autoJoinOnConflict=setDefault(l.autoJoinOnConflict,C),l.endConflictedCall=setDefault(l.endConflictedCall,y),l.autoResolveConflictedCall=setDefault(l.autoResolveConflictedCall,S),l.shouldServiceSendCallEventMessages=setDefault(l.shouldServiceSendCallEventMessages,g),l.handleUnmuteMuteFromResponse=setDefault(l.handleUnmuteMuteFromResponse,N),l.forceTrouterReconnectOnNetworkOnline=setDefault(l.forceTrouterReconnectOnNetworkOnline,D),l.attemptHttpRequestWithCachedSkypetoken=setDefault(l.attemptHttpRequestWithCachedSkypetoken,L),l.useInternalHttpDispatcher=setDefault(l.useInternalHttpDispatcher,P),l.enableTokenCache=setDefault(l.enableTokenCache,O),l.enableTokenPrefetch=setDefault(l.enableTokenPrefetch,M),l.hedgeDelayMs=setDefault(l.hedgeDelayMs,x),l.hedgeMaxParallelAttempts=setDefault(l.hedgeMaxParallelAttempts,k),l.useInternalHttpDispatcher&&(l.httpRequestDispatcher=new h.HttpRequestDispatcher(l.logger)),l.overrideDisplayName=setDefault(l.overrideDisplayName,F),l.enableDeltaRosterWeb=setDefault(l.enableDeltaRosterWeb,U),l.processSelfDataFromSubscribeResponse=setDefault(l.processSelfDataFromSubscribeResponse,j),l.enableMusicOnHoldV2=setDefault(l.enableMusicOnHoldV2,B),l.enablePstnMasking=setDefault(l.enablePstnMasking,V),l.enableQuickSendAcceptanceAck=setDefault(l.enableQuickSendAcceptanceAck,H),l.supportMediaRetargetWhileIncomingRenegotiation=setDefault(l.supportMediaRetargetWhileIncomingRenegotiation,G),l.enableStaging=setDefault(l.enableStaging,W),l.enableCallingTokenAPI=setDefault(l.enableCallingTokenAPI,Q),l.callingServiceSupportsAADTokens=setDefault(l.callingServiceSupportsAADTokens,Y),l.aadTokenExpirationTimeInSeconds=setDefault(l.aadTokenExpirationTimeInSeconds,$),l.popTokenExpirationTimeInSeconds=setDefault(l.popTokenExpirationTimeInSeconds,X),l.refreshTimeBeforeTokenTimeoutInSeconds=setDefault(l.refreshTimeBeforeTokenTimeoutInSeconds,Z),l.enableErrorCodeImprovementsForNetworkFailures=setDefault(l.enableErrorCodeImprovementsForNetworkFailures,q),l.enableMergeParticipantLegsBatchSupport=setDefault(l.enableMergeParticipantLegsBatchSupport,z),l.enableCallEstablishmentTimeoutsForStartJoinCall=setDefault(l.enableCallEstablishmentTimeoutsForStartJoinCall,K),l.csaTimeoutConfiguration=mergeObjects(l.csaTimeoutConfiguration,J),l.reportPreviousErrorsForTimeout=setDefault(l.reportPreviousErrorsForTimeout,ee)}function setDefault(l,d){return null==l?d:l}function mergeObjects(l,d){var u=p(p({},l),d);return Object.keys(u).forEach((function(p){u[p]=l&&l[p]||d&&d[p]})),u}d.default=setDefaultsForSignalingConfig},function(l,d,u){l.exports=function bind(l,d){return function wrap(){for(var u=new Array(arguments.length),p=0;p<u.length;p++)u[p]=arguments[p];return l.apply(d,u)}}},function(l,d,u){var p=u(23);function encode(l){return encodeURIComponent(l).replace(/%40/gi,\"@\").replace(/%3A/gi,\":\").replace(/%24/g,\"$\").replace(/%2C/gi,\",\").replace(/%20/g,\"+\").replace(/%5B/gi,\"[\").replace(/%5D/gi,\"]\")}l.exports=function buildURL(l,d,u){if(!d)return l;var h;if(u)h=u(d);else if(p.isURLSearchParams(d))h=d.toString();else{var g=[];p.forEach(d,(function serialize(l,d){null!=l&&(p.isArray(l)?d+=\"[]\":l=[l],p.forEach(l,(function parseValue(l){p.isDate(l)?l=l.toISOString():p.isObject(l)&&(l=JSON.stringify(l)),g.push(encode(d)+\"=\"+encode(l))})))})),h=g.join(\"&\")}if(h){var f=l.indexOf(\"#\");-1!==f&&(l=l.slice(0,f)),l+=(-1===l.indexOf(\"?\")?\"?\":\"&\")+h}return l}},function(l,d,u){l.exports=function isCancel(l){return!(!l||!l.__CANCEL__)}},function(l,d,u){(function(d){var p=u(23),h=u(202),g={\"Content-Type\":\"application/x-www-form-urlencoded\"};function setContentTypeIfUnset(l,d){!p.isUndefined(l)&&p.isUndefined(l[\"Content-Type\"])&&(l[\"Content-Type\"]=d)}function getDefaultAdapter(){var l;return(\"undefined\"!=typeof XMLHttpRequest||void 0!==d&&\"[object process]\"===Object.prototype.toString.call(d))&&(l=u(105)),l}var f={adapter:getDefaultAdapter(),transformRequest:[function transformRequest(l,d){return h(d,\"Accept\"),h(d,\"Content-Type\"),p.isFormData(l)||p.isArrayBuffer(l)||p.isBuffer(l)||p.isStream(l)||p.isFile(l)||p.isBlob(l)?l:p.isArrayBufferView(l)?l.buffer:p.isURLSearchParams(l)?(setContentTypeIfUnset(d,\"application/x-www-form-urlencoded;charset=utf-8\"),l.toString()):p.isObject(l)?(setContentTypeIfUnset(d,\"application/json;charset=utf-8\"),JSON.stringify(l)):l}],transformResponse:[function transformResponse(l){if(\"string\"==typeof l)try{l=JSON.parse(l)}catch(l){}return l}],timeout:0,xsrfCookieName:\"XSRF-TOKEN\",xsrfHeaderName:\"X-XSRF-TOKEN\",maxContentLength:-1,validateStatus:function validateStatus(l){return l>=200&&l<300},headers:{common:{Accept:\"application/json, text/plain, */*\"}}};p.forEach([\"delete\",\"get\",\"head\"],(function forEachMethodNoData(l){f.headers[l]={}})),p.forEach([\"post\",\"put\",\"patch\"],(function forEachMethodWithData(l){f.headers[l]=p.merge(g)})),l.exports=f}).call(this,u(104))},function(l,d){var u,p,h=l.exports={};function defaultSetTimout(){throw new Error(\"setTimeout has not been defined\")}function defaultClearTimeout(){throw new Error(\"clearTimeout has not been defined\")}function runTimeout(l){if(u===setTimeout)return setTimeout(l,0);if((u===defaultSetTimout||!u)&&setTimeout)return u=setTimeout,setTimeout(l,0);try{return u(l,0)}catch(d){try{return u.call(null,l,0)}catch(d){return u.call(this,l,0)}}}function runClearTimeout(l){if(p===clearTimeout)return clearTimeout(l);if((p===defaultClearTimeout||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(l);try{return p(l)}catch(d){try{return p.call(null,l)}catch(d){return p.call(this,l)}}}!function(){try{u=\"function\"==typeof setTimeout?setTimeout:defaultSetTimout}catch(l){u=defaultSetTimout}try{p=\"function\"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(l){p=defaultClearTimeout}}();var g,f=[],m=!1,v=-1;function cleanUpNextTick(){m&&g&&(m=!1,g.length?f=g.concat(f):v=-1,f.length&&drainQueue())}function drainQueue(){if(!m){var l=runTimeout(cleanUpNextTick);m=!0;for(var d=f.length;d;){for(g=f,f=[];++v<d;)g&&g[v].run();v=-1,d=f.length}g=null,m=!1,runClearTimeout(l)}}function Item(l,d){this.fun=l,this.array=d}function noop(){}h.nextTick=function(l){var d=new Array(arguments.length-1);if(arguments.length>1)for(var u=1;u<arguments.length;u++)d[u-1]=arguments[u];f.push(new Item(l,d)),1!==f.length||m||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},h.title=\"browser\",h.browser=!0,h.env={},h.argv=[],h.version=\"\",h.versions={},h.on=noop,h.addListener=noop,h.once=noop,h.off=noop,h.removeListener=noop,h.removeAllListeners=noop,h.emit=noop,h.prependListener=noop,h.prependOnceListener=noop,h.listeners=function(l){return[]},h.binding=function(l){throw new Error(\"process.binding is not supported\")},h.cwd=function(){return\"/\"},h.chdir=function(l){throw new Error(\"process.chdir is not supported\")},h.umask=function(){return 0}},function(l,d,u){var p=u(23),h=u(203),g=u(101),f=u(205),m=u(208),v=u(209),y=u(106);l.exports=function xhrAdapter(l){return new Promise((function dispatchXhrRequest(d,S){var _=l.data,C=l.headers;p.isFormData(_)&&delete C[\"Content-Type\"];var E=new XMLHttpRequest;if(l.auth){var T=l.auth.username||\"\",b=l.auth.password||\"\";C.Authorization=\"Basic \"+btoa(T+\":\"+b)}var I=f(l.baseURL,l.url);if(E.open(l.method.toUpperCase(),g(I,l.params,l.paramsSerializer),!0),E.timeout=l.timeout,E.onreadystatechange=function handleLoad(){if(E&&4===E.readyState&&(0!==E.status||E.responseURL&&0===E.responseURL.indexOf(\"file:\"))){var u=\"getAllResponseHeaders\"in E?m(E.getAllResponseHeaders()):null,p={data:l.responseType&&\"text\"!==l.responseType?E.response:E.responseText,status:E.status,statusText:E.statusText,headers:u,config:l,request:E};h(d,S,p),E=null}},E.onabort=function handleAbort(){E&&(S(y(\"Request aborted\",l,\"ECONNABORTED\",E)),E=null)},E.onerror=function handleError(){S(y(\"Network Error\",l,null,E)),E=null},E.ontimeout=function handleTimeout(){var d=\"timeout of \"+l.timeout+\"ms exceeded\";l.timeoutErrorMessage&&(d=l.timeoutErrorMessage),S(y(d,l,\"ECONNABORTED\",E)),E=null},p.isStandardBrowserEnv()){var A=u(211),R=(l.withCredentials||v(I))&&l.xsrfCookieName?A.read(l.xsrfCookieName):void 0;R&&(C[l.xsrfHeaderName]=R)}if(\"setRequestHeader\"in E&&p.forEach(C,(function setRequestHeader(l,d){void 0===_&&\"content-type\"===d.toLowerCase()?delete C[d]:E.setRequestHeader(d,l)})),p.isUndefined(l.withCredentials)||(E.withCredentials=!!l.withCredentials),l.responseType)try{E.responseType=l.responseType}catch(d){if(\"json\"!==l.responseType)throw d}\"function\"==typeof l.onDownloadProgress&&E.addEventListener(\"progress\",l.onDownloadProgress),\"function\"==typeof l.onUploadProgress&&E.upload&&E.upload.addEventListener(\"progress\",l.onUploadProgress),l.cancelToken&&l.cancelToken.promise.then((function onCanceled(l){E&&(E.abort(),S(l),E=null)})),void 0===_&&(_=null),E.send(_)}))}},function(l,d,u){var p=u(204);l.exports=function createError(l,d,u,h,g){var f=new Error(l);return p(f,d,u,h,g)}},function(l,d,u){var p=u(23);l.exports=function mergeConfig(l,d){d=d||{};var u={},h=[\"url\",\"method\",\"params\",\"data\"],g=[\"headers\",\"auth\",\"proxy\"],f=[\"baseURL\",\"url\",\"transformRequest\",\"transformResponse\",\"paramsSerializer\",\"timeout\",\"withCredentials\",\"adapter\",\"responseType\",\"xsrfCookieName\",\"xsrfHeaderName\",\"onUploadProgress\",\"onDownloadProgress\",\"maxContentLength\",\"validateStatus\",\"maxRedirects\",\"httpAgent\",\"httpsAgent\",\"cancelToken\",\"socketPath\"];p.forEach(h,(function valueFromConfig2(l){void 0!==d[l]&&(u[l]=d[l])})),p.forEach(g,(function mergeDeepProperties(h){p.isObject(d[h])?u[h]=p.deepMerge(l[h],d[h]):void 0!==d[h]?u[h]=d[h]:p.isObject(l[h])?u[h]=p.deepMerge(l[h]):void 0!==l[h]&&(u[h]=l[h])})),p.forEach(f,(function defaultToConfig2(p){void 0!==d[p]?u[p]=d[p]:void 0!==l[p]&&(u[p]=l[p])}));var m=h.concat(g).concat(f),v=Object.keys(d).filter((function filterAxiosKeys(l){return-1===m.indexOf(l)}));return p.forEach(v,(function otherKeysDefaultToConfig2(p){void 0!==d[p]?u[p]=d[p]:void 0!==l[p]&&(u[p]=l[p])})),u}},function(l,d,u){function Cancel(l){this.message=l}Cancel.prototype.toString=function toString(){return\"Cancel\"+(this.message?\": \"+this.message:\"\")},Cancel.prototype.__CANCEL__=!0,l.exports=Cancel},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.TsCallingLogger=void 0;var p=u(33),h=u(8),g=function(){function TsCallingLogger(l,d,u){void 0===u&&(u=\"\"),this.ulLogComponent=l,this.ulSafeComponent=d,this._getPrefix=(0,h.isFunction)(u)?u:function(){return u},this.logComponent=p.LogFactory.instance().component(this.ulLogComponent),p.LogFactory.instance().declareComponentSafe(this.ulLogComponent,d)}return TsCallingLogger.prototype.createChild=function(l){var d=this,u=(0,h.isFunction)(l)?l:function(){return l};return new TsCallingLogger(this.ulLogComponent,this.ulSafeComponent,(function(){return d._getPrefix()?\"\".concat(d._getPrefix(),\"/\").concat(u()):u()}))},TsCallingLogger.prototype.log=function(){for(var l=this,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];this._apply((function(d){return l.logComponent.debug2(null,d)}),d)},TsCallingLogger.prototype.debug=function(){for(var l=this,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];this._apply((function(d){return l.logComponent.debug4(null,d)}),d)},TsCallingLogger.prototype.info=function(){for(var l=this,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];this._apply((function(d){return l.logComponent.debug1(null,d)}),d)},TsCallingLogger.prototype.warn=function(){for(var l=this,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];this._apply((function(d){return l.logComponent.warn(null,d)}),d)},TsCallingLogger.prototype.error=function(){for(var l=this,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];this._apply((function(d){return l.logComponent.error(null,d)}),d)},TsCallingLogger.prototype._apply=function(l,d){void 0===d&&(d=[]),this._addPrefix(d),l(d.map((function(l){return l instanceof DOMException?l.toString():l})).map((function(l){return(0,h.isObject)(l)?JSON.stringify(l):l})).join(\", \"))},TsCallingLogger.prototype._addPrefix=function(l){if(l&&l[0]){var d=\"\".concat(this._getPrefix(),\" \").concat(l[0]);l[0]=d}},TsCallingLogger}();d.TsCallingLogger=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function PiiUtils(l){this.piiScrubber=this.getPiiScrubber(l)}return PiiUtils.prototype.scrubParticipantsList=function(l){var d=this,u=[];return Array.isArray(l)&&l.forEach((function(l){return u.push(d.scrubMriOrOmit(l))})),u},PiiUtils.prototype.scrubMriOrOmit=function(l){return\"string\"==typeof l?this.piiScrubber.mri(l):this.piiScrubber.omit(l)},PiiUtils.prototype.getPiiScrubber=function(l){return l&&\"function\"==typeof l.omit&&\"function\"==typeof l.mri?l:{omit:function(){return\"<pii:omit/>\"},mri:function(){return\"<pii:mri/>\"}}},PiiUtils}();d.default=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();function asap(l){return new Promise((function(d){d(l())}))}Object.defineProperty(d,\"__esModule\",{value:!0}),d.timedDefer=d.defer=d.Timer=d.TimerFactory=d.TimeoutError=d.asap=void 0,d.asap=asap;var h=function(l){function TimeoutError(){return null!==l&&l.apply(this,arguments)||this}return p(TimeoutError,l),TimeoutError}(Error);d.TimeoutError=h;var g=function(){function TimerFactory(){}return TimerFactory.build=function(l,d){return new f(l,d)},TimerFactory}();d.TimerFactory=g;var f=function(){function Timer(l,d){this.ontimeout=l,this.name=d}return Timer.prototype.start=function(l){var d=this;if(void 0!==this.timeoutId)throw new Error(\"Timer \".concat(this.name,\" already started\"));return this.timeoutId=window.setTimeout((function(){return d.ontimeout()}),l),this},Timer.prototype.stop=function(){if(void 0===this.timeoutId)throw new Error(\"Timer \".concat(this.name,\" is not defined\"));clearTimeout(this.timeoutId),this.timeoutId=void 0},Timer}();function defer(){var l,d;return{promise:new Promise((function(u,p){l=u,d=p})),resolve:l,reject:d}}function timedDefer(l,d){var u,p;void 0===d&&(d=\"deferred timed out after \".concat(l,\"ms\"));var g={promise:new Promise((function(l,d){u=function(d){m.stop(),l(d)},p=function(l){m.stop(),d(l)}})),resolve:u,reject:p},m=new f((function(){return g.reject(new h(d))}),\"timedDefer\");return m.start(l),g}d.Timer=f,d.defer=defer,d.timedDefer=timedDefer},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u,f){g.assertNotNull(l,\"signalingSession cannot be null\");var m=u.groupId?{id:u.groupId}:null,v=u.threadId?{threadId:u.threadId,messageId:u.messageId||null}:null,y=[],S={};d&&d.length>0?(y=d.map((function(d){return{id:d.id,assertedId:d.assertedId,displayName:d.displayName,participantId:d.participantId,replacementDetails:3===u.replacementType?l.getReplacementDetailsByParticipantLegOfCall(u.callIdToReplace,d.id,d.replacementParticipantId):void 0}})),S={addParticipantSuccess:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}):S={addModalitySuccess:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_FAILURE)};var _={payload:{disableUnmute:u&&u.disableUnmute,participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},to:y},participantInvitationData:u.additionalData,replacementDetails:3===u.replacementType?void 0:f,groupContext:m,groupChat:v,links:S}};return u&&u.alternateId&&(_.payload.participants.from.alternateId=u.alternateId),_}d.getPayload=getPayload},function(l,d){var u=l.exports={v:[{name:\"version\",reg:/^(\\d*)$/}],o:[{name:\"origin\",reg:/^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,names:[\"username\",\"sessionId\",\"sessionVersion\",\"netType\",\"ipVer\",\"address\"],format:\"%s %s %d %s IP%d %s\"}],s:[{name:\"name\"}],i:[{name:\"description\"}],u:[{name:\"uri\"}],e:[{name:\"email\"}],p:[{name:\"phone\"}],z:[{name:\"timezones\"}],r:[{name:\"repeats\"}],t:[{name:\"timing\",reg:/^(\\d*) (\\d*)/,names:[\"start\",\"stop\"],format:\"%d %d\"}],c:[{name:\"connection\",reg:/^IN IP(\\d) (\\S*)/,names:[\"version\",\"ip\"],format:\"IN IP%d %s\"}],b:[{push:\"bandwidth\",reg:/^(TIAS|AS|CT|RR|RS):(\\d*)/,names:[\"type\",\"limit\"],format:\"%s:%s\"}],m:[{reg:/^(\\S*) (\\d*) ([\\w/]*)(?: (.*))?/,names:[\"type\",\"port\",\"protocol\",\"payloads\"],format:\"%s %d %s %s\"}],a:[{push:\"rtp\",reg:/^rtpmap:(\\d*) ([\\w\\-.]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,names:[\"payload\",\"codec\",\"rate\",\"encoding\"],format:function(l){return l.encoding?\"rtpmap:%d %s/%s/%s\":l.rate?\"rtpmap:%d %s/%s\":\"rtpmap:%d %s\"}},{push:\"fmtp\",reg:/^fmtp:(\\d*) ([\\S| ]*)/,names:[\"payload\",\"config\"],format:\"fmtp:%d %s\"},{name:\"control\",reg:/^control:(.*)/,format:\"control:%s\"},{name:\"rtcp\",reg:/^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,names:[\"port\",\"netType\",\"ipVer\",\"address\"],format:function(l){return null!=l.address?\"rtcp:%d %s IP%d %s\":\"rtcp:%d\"}},{push:\"rtcpFbXMessage\",reg:/^rtcp-fb:(\\*|\\d*) x-message ([\\S| ]*)/,names:[\"payload\",\"param\"],format:function(l){return\"rtcp-fb:\"+(\"*\"===l.payload?\"%s\":\"%d\")+\" x-message %s\"}},{push:\"rtcpFbTrrInt\",reg:/^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,names:[\"payload\",\"value\"],format:\"rtcp-fb:%d trr-int %d\"},{push:\"rtcpFb\",reg:/^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,names:[\"payload\",\"type\",\"subtype\"],format:function(l){return null!=l.subtype?\"rtcp-fb:%s %s %s\":\"rtcp-fb:%s %s\"}},{push:\"ext\",reg:/^extmap:(\\d+)(?:\\/(\\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\\S*)(?: (\\S*))?/,names:[\"value\",\"direction\",\"encrypt-uri\",\"uri\",\"config\"],format:function(l){return\"extmap:%d\"+(l.direction?\"/%s\":\"%v\")+(l[\"encrypt-uri\"]?\" %s\":\"%v\")+\" %s\"+(l.config?\" %s\":\"\")}},{name:\"extmapAllowMixed\",reg:/^(extmap-allow-mixed)/},{push:\"cryptoscale\",reg:/^cryptoscale:(\\d*) (client|server) ([\\w_]*) (\\S*)(?: (\\S*))?/,names:[\"id\",\"flavor\",\"suite\",\"config\",\"sessionConfig\"],format:function(l){return null!=l.sessionConfig?\"cryptoscale:%d %s %s %s %s\":\"cryptoscale:%d %s %s %s\"}},{push:\"crypto\",reg:/^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,names:[\"id\",\"suite\",\"config\",\"sessionConfig\"],format:function(l){return null!=l.sessionConfig?\"crypto:%d %s %s %s\":\"crypto:%d %s %s\"}},{name:\"setup\",reg:/^setup:(\\w*)/,format:\"setup:%s\"},{name:\"connectionType\",reg:/^connection:(new|existing)/,format:\"connection:%s\"},{name:\"mid\",reg:/^mid:([^\\s]*)/,format:\"mid:%s\"},{name:\"msid\",reg:/^msid:(.*)/,format:\"msid:%s\"},{name:\"ptime\",reg:/^ptime:(\\d*(?:\\.\\d*)*)/,format:\"ptime:%d\"},{name:\"maxptime\",reg:/^maxptime:(\\d*(?:\\.\\d*)*)/,format:\"maxptime:%d\"},{name:\"direction\",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:\"icelite\",reg:/^(ice-lite)/},{name:\"iceUfrag\",reg:/^ice-ufrag:(\\S*)/,format:\"ice-ufrag:%s\"},{name:\"icePwd\",reg:/^ice-pwd:(\\S*)/,format:\"ice-pwd:%s\"},{name:\"fingerprint\",reg:/^fingerprint:(\\S*) (\\S*)/,names:[\"type\",\"hash\"],format:\"fingerprint:%s %s\"},{push:\"candidates\",reg:/^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?(?: network-id (\\d*))?(?: network-cost (\\d*))?/,names:[\"foundation\",\"component\",\"transport\",\"priority\",\"ip\",\"port\",\"type\",\"raddr\",\"rport\",\"tcptype\",\"generation\",\"network-id\",\"network-cost\"],format:function(l){var d=\"candidate:%s %d %s %d %s %d typ %s\";return d+=null!=l.raddr?\" raddr %s rport %d\":\"%v%v\",d+=null!=l.tcptype?\" tcptype %s\":\"%v\",null!=l.generation&&(d+=\" generation %d\"),d+=null!=l[\"network-id\"]?\" network-id %d\":\"%v\",d+=null!=l[\"network-cost\"]?\" network-cost %d\":\"%v\"}},{push:\"xCandidatesIpv6\",reg:/^x-candidate-ipv6:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?/,names:[\"foundation\",\"component\",\"transport\",\"priority\",\"ip\",\"port\",\"type\",\"raddr\",\"rport\",\"tcptype\",\"generation\"],format:function(l){var d=\"candidate:%s %d %s %d %s %d typ %s\";return d+=null!=l.raddr?\" raddr %s rport %d\":\"%v%v\",d+=null!=l.tcptype?\" tcptype %s\":\"%v\",null!=l.generation&&(d+=\" generation %d\"),d}},{name:\"endOfCandidates\",reg:/^(end-of-candidates)/},{name:\"remoteCandidates\",reg:/^remote-candidates:(.*)/,format:\"remote-candidates:%s\"},{name:\"iceOptions\",reg:/^ice-options:(\\S*)/,format:\"ice-options:%s\"},{push:\"ssrcs\",reg:/^ssrc:(\\d*) ([\\w_-]*)(?::(.*))?/,names:[\"id\",\"attribute\",\"value\"],format:function(l){var d=\"ssrc:%d\";return null!=l.attribute&&(d+=\" %s\",null!=l.value&&(d+=\":%s\")),d}},{push:\"ssrcGroups\",reg:/^ssrc-group:([\\x21\\x23\\x24\\x25\\x26\\x27\\x2A\\x2B\\x2D\\x2E\\w]*) (.*)/,names:[\"semantics\",\"ssrcs\"],format:\"ssrc-group:%s %s\"},{name:\"msidSemantic\",reg:/^msid-semantic:\\s?(\\w*) (\\S*)/,names:[\"semantic\",\"token\"],format:\"msid-semantic: %s %s\"},{push:\"groups\",reg:/^group:(\\w*) (.*)/,names:[\"type\",\"mids\"],format:\"group:%s %s\"},{name:\"rtcpMux\",reg:/^(rtcp-mux)/},{name:\"rtcpRsize\",reg:/^(rtcp-rsize)/},{name:\"sctpmap\",reg:/^sctpmap:([\\w_/]*) (\\S*)(?: (\\S*))?/,names:[\"sctpmapNumber\",\"app\",\"maxMessageSize\"],format:function(l){return null!=l.maxMessageSize?\"sctpmap:%s %s %s\":\"sctpmap:%s %s\"}},{name:\"xGoogleFlag\",reg:/^x-google-flag:([^\\s]*)/,format:\"x-google-flag:%s\"},{push:\"rids\",reg:/^rid:([\\d\\w]+) (\\w+)(?: ([\\S| ]*))?/,names:[\"id\",\"direction\",\"params\"],format:function(l){return l.params?\"rid:%s %s %s\":\"rid:%s %s\"}},{push:\"imageattrs\",reg:new RegExp(\"^imageattr:(\\\\d+|\\\\*)[\\\\s\\\\t]+(send|recv)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*)(?:[\\\\s\\\\t]+(recv|send)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*))?\"),names:[\"pt\",\"dir1\",\"attrs1\",\"dir2\",\"attrs2\"],format:function(l){return\"imageattr:%s %s %s\"+(l.dir2?\" %s %s\":\"\")}},{name:\"simulcast\",reg:new RegExp(\"^simulcast:(send|recv) ([a-zA-Z0-9\\\\-_~;,]+)(?:\\\\s?(send|recv) ([a-zA-Z0-9\\\\-_~;,]+))?$\"),names:[\"dir1\",\"list1\",\"dir2\",\"list2\"],format:function(l){return\"simulcast:%s %s\"+(l.dir2?\" %s %s\":\"\")}},{name:\"simulcast_03\",reg:/^simulcast:[\\s\\t]+([\\S+\\s\\t]+)$/,names:[\"value\"],format:\"simulcast: %s\"},{name:\"framerate\",reg:/^framerate:(\\d+(?:$|\\.\\d+))/,format:\"framerate:%s\"},{name:\"sourceFilter\",reg:/^source-filter: *(excl|incl) (\\S*) (IP4|IP6|\\*) (\\S*) (.*)/,names:[\"filterMode\",\"netType\",\"addressTypes\",\"destAddress\",\"srcList\"],format:\"source-filter: %s %s %s %s %s\"},{name:\"bundleOnly\",reg:/^(bundle-only)/},{name:\"label\",reg:/^label:(.+)/,format:\"label:%s\"},{name:\"sctpPort\",reg:/^sctp-port:(\\d+)$/,format:\"sctp-port:%s\"},{name:\"maxMessageSize\",reg:/^max-message-size:(\\d+)$/,format:\"max-message-size:%s\"},{push:\"tsRefClocks\",reg:/^ts-refclk:([^\\s=]*)(?:=(\\S*))?/,names:[\"clksrc\",\"clksrcExt\"],format:function(l){return\"ts-refclk:%s\"+(null!=l.clksrcExt?\"=%s\":\"\")}},{name:\"mediaClk\",reg:/^mediaclk:(?:id=(\\S*))? *([^\\s=]*)(?:=(\\S*))?(?: *rate=(\\d+)\\/(\\d+))?/,names:[\"id\",\"mediaClockName\",\"mediaClockValue\",\"rateNumerator\",\"rateDenominator\"],format:function(l){var d=\"mediaclk:\";return d+=null!=l.id?\"id=%s %s\":\"%v%s\",d+=null!=l.mediaClockValue?\"=%s\":\"\",d+=null!=l.rateNumerator?\" rate=%s\":\"\",d+=null!=l.rateDenominator?\"/%s\":\"\"}},{name:\"keywords\",reg:/^keywds:(.+)$/,format:\"keywds:%s\"},{name:\"content\",reg:/^content:(.+)/,format:\"content:%s\"},{name:\"bfcpFloorCtrl\",reg:/^floorctrl:(c-only|s-only|c-s)/,format:\"floorctrl:%s\"},{name:\"bfcpConfId\",reg:/^confid:(\\d+)/,format:\"confid:%s\"},{name:\"bfcpUserId\",reg:/^userid:(\\d+)/,format:\"userid:%s\"},{name:\"bfcpFloorId\",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:[\"id\",\"mStream\"],format:\"floorid:%s mstrm:%s\"},{name:\"xMediaBw\",reg:/^x-mediabw:(\\S*) send=(\\d*);recv=(\\d*)/,names:[\"label\",\"sendBw\",\"receiveBw\"],format:\"x-mediabw:%s send=%d;recv=%d\"},{name:\"xSsrcRange\",reg:/^x-ssrc-range:(\\d*)-(\\d*)/,names:[\"ssrcMin\",\"ssrcMax\"],format:\"x-ssrc-range:%d-%d\"},{name:\"xSource\",reg:/^x-source:(\\S*)/,format:\"x-source:%s\"},{name:\"xSourceStreamId\",reg:/^x-source-streamid:(\\S*)/,format:\"x-source-streamid:%s\"},{name:\"xCaps\",reg:/^x-caps:(\\d*) (\\S*)/,names:[\"payloadType\",\"value\"],format:\"x-caps:%d %s\"},{name:\"signalingFbXMessage\",reg:/^x-signaling-fb:(\\*|\\d*) x-message ([\\S| ]*)/,names:[\"payload\",\"param\"],format:function(l){return\"x-signaling-fb:\"+(\"*\"===l.payload?\"%s\":\"%d\")+\" x-message %s\"}},{push:\"xMediaSettings\",reg:/^x-mediasettings:([\\S| ]*)/,names:[\"settings\"],format:\"x-mediasettings:%s\"},{name:\"xDataProtocol\",reg:/^x-data-protocol:\\s?(.*)/,format:\"x-data-protocol:%s\"},{push:\"invalid\",names:[\"value\"]}]};Object.keys(u).forEach((function(l){u[l].forEach((function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format=\"%s\")}))}))},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.scrubCallOptions=d.MediaStateConfigHelper=d.convertRedirectOptions=d.getCallStartOptions=d.getMediaState=d.getCSAEndCode=d.getTerminationCode=d.convertSignalingEndpointDetails=d.convertReason=void 0;var h=u(8),g=u(58),f=u(17),m=u(55);function convertReason(l){return l?getTerminationCode(l.code,l.subCode):0}function convertSignalingEndpointDetails(l,d){var u={clientVersion:l.clientVersion,participantId:l.participantId,endpointId:l.endpointId,endpointType:l.endpointType,endpointMetadata:l.endpointMetadata,originalId:l.originalId,capabilities:l.capabilities,clientEndpointCapabilities:l.clientEndpointCapabilities,mappedTo:l.mappedTo,meetingGroupDetails:l.meetingGroupDetails};return l.mediaStreams&&(u.mediaStreams=l.mediaStreams),l.lwjSessionInformation&&(u.lwjSessionInformation=l.lwjSessionInformation),l.appliedInteractivityLevel&&(u.appliedInteractivityLevel=l.appliedInteractivityLevel),l.deviceType&&(u.deviceType=l.deviceType),l.streamInformation&&32&d&&(u.streamInformation=l.streamInformation),u}function getTerminationCode(l,d){if(void 0===d&&(d=null),l===m.jsCallEndCodes.Success)switch(d){case m.jsCallEndSubCodes.RemovedFromConversation:case m.jsCallEndSubCodes.RemovedFromCall:return 44;case m.jsCallEndSubCodes.DeniedInLobby:return 55;case m.jsCallEndSubCodes.TimedOutInLobby:return 56;default:return 1}if(null!==d&&d>=m.PstnTerminationCode.CallTerminationSubCodeSipGWMin&&d<=m.PstnTerminationCode.CallTerminationSubCodeSipGWMax){var u=d-m.PstnTerminationCode.CallTerminationSubCodeSipGWMin;return m.pstnConsumerResponseCodeMap[u]?m.pstnConsumerResponseCodeMap[u]:0}return null!==d&&d>=m.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMin&&d<=m.EnterpisePstnTerminationCode.CallTerminationSubCodeSipGWMax?m.pstnEnterpriseResponseCodeMap[l]?m.pstnEnterpriseResponseCodeMap[l]:43:l===m.jsCallEndCodes.Forbidden?d===m.jsCallEndSubCodes.UserBlocked?64:d===m.jsCallEndSubCodes.PolicyRestriction?62:d===m.jsCallEndSubCodes.AnonymousJoinDisabledByPolicy?66:d===m.jsCallEndSubCodes.NoLobbyForBroadcastJoin?67:d===m.jsCallEndSubCodes.NotAllowedDueToInformationBarrier?68:d===m.jsCallEndSubCodes.TeamParkPolicyDisabled?70:d===m.jsCallEndSubCodes.B2bJoinDisabledByPolicy?71:d===m.jsCallEndCodes.Success?8:7:l===m.jsCallEndCodes.PreconditionFailed&&d===m.jsCallEndSubCodes.InsufficientCapabilities?63:l===m.jsCallEndCodes.ServiceUnavailable?d===m.jsCallEndSubCodes.BroadcastLimitReached?69:48:l===m.jsCallEndCodes.InternalServerError?7:l===m.jsCallEndCodes.ConfParticipantCountLimitReached?d===m.jsCallEndSubCodes.MaxLobbyParticipantLimitReached?73:59:m.responseCodeMap[l]?m.responseCodeMap[l]:l}function getCSAEndCode(l){var d,u;if(1===l)return m.jsCallEndCodes.Success;var h=Object.keys(m.responseCodeMap).filter((function(d){return m.responseCodeMap[d]===l}));if(h.length>=1)try{for(var g=p(h),f=g.next();!f.done;f=g.next()){var v=f.value,y=parseInt(v);if(y&&m.responseCodeMap[y]===l)return y}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=g.return)&&u.call(g)}finally{if(d)throw d.error}}return m.jsCallEndCodes.UnknownError}function getMediaState(l,d){if(void 0!==d&&3!==d&&1!==d)return{mediaType:l,isDisabled:0===d,label:g.getMediaLabel(l)}}function getCallStartOptions(l){if(l.sendMediaModalities)return l;var d={mediaStates:[]},u=getMediaState(0,l.audioDirection?l.audioDirection:4);return u&&d.mediaStates.push(u),(u=getMediaState(1,l.withVideo?l.withVideo?4:1:l.videoDirection))&&d.mediaStates.push(u),(u=getMediaState(2,l.screenshareDirection?l.screenshareDirection:1))&&d.mediaStates.push(u),l.sendMediaModalities=d,l}function convertRedirectOptions(l){var d=convertRedirectionTargetIdType(l.type),u=convertRedirectionEndpointType(l.endpointType);return{type:d,id:l.id,endpointType:u}}function convertRedirectionTargetIdType(l){switch(l){case\"mri\":return\"mri\";default:throw\"Unknown RedirectionTargetIdType\"}}function convertRedirectionEndpointType(l){switch(l){case\"voicemail\":return\"voicemail\";case\"default\":return\"default\";default:throw\"Unknown RedirectionEndpointType\"}}d.convertReason=convertReason,d.convertSignalingEndpointDetails=convertSignalingEndpointDetails,d.getTerminationCode=getTerminationCode,d.getCSAEndCode=getCSAEndCode,d.getMediaState=getMediaState,d.getCallStartOptions=getCallStartOptions,d.convertRedirectOptions=convertRedirectOptions;var v=function(){function MediaStateConfigHelper(l){this.mediaStateConfiguration=l}return MediaStateConfigHelper.prototype.isDisabled=function(l){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var d=h.find(this.mediaStateConfiguration.mediaStates,(function(d){return d.mediaType===l}));return!!d&&!!d.isDisabled}return!1},MediaStateConfigHelper.prototype.isInactiveOrDisabled=function(l){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var d=h.find(this.mediaStateConfiguration.mediaStates,(function(d){return d.mediaType===l}));return!d||!!d.isDisabled}return!1},MediaStateConfigHelper.prototype.isSending=function(l){return!(!this.mediaStateConfiguration||!this.mediaStateConfiguration.mediaStates)&&!!h.find(this.mediaStateConfiguration.mediaStates,(function(d){return d.mediaType===l&&!d.isDisabled}))},MediaStateConfigHelper.prototype.setModality=function(l,d){if(this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates){var u=h.find(this.mediaStateConfiguration.mediaStates,(function(d){return d.mediaType===l}));u?u.isDisabled=d:this.mediaStateConfiguration.mediaStates.push({mediaType:l,isDisabled:d,label:g.getMediaLabel(l)})}},MediaStateConfigHelper.prototype.disableModality=function(l){this.setModality(l,!0)},MediaStateConfigHelper.prototype.enableModality=function(l){this.setModality(l,!1)},MediaStateConfigHelper.prototype.removeModality=function(l){this.mediaStateConfiguration&&this.mediaStateConfiguration.mediaStates&&h.remove(this.mediaStateConfiguration.mediaStates,(function(d){return d.mediaType===l}))},MediaStateConfigHelper.prototype.setCallAcceptOptions=function(l){var d=this.isDisabled(1),u=this.isDisabled(2);if(l.sendMediaModalities)this.mediaStateConfiguration=l.sendMediaModalities;else{void 0===l.answerMediaType&&(l.answerMediaType=l.withVideo?1:0);var p={mediaStates:[]};switch(l.answerMediaType){case 0:p.mediaStates.push(getMediaState(0,4));break;case 1:p.mediaStates.push(getMediaState(0,4)),p.mediaStates.push(getMediaState(1,4));break;case 2:p.mediaStates.push(getMediaState(1,0))}this.mediaStateConfiguration=p}d&&this.setModality(1,!0),u&&this.setModality(2,!0),l.sendMediaModalities=this.mediaStateConfiguration},MediaStateConfigHelper}();function hasValue(l){return l||!1===l||\"\"===l||0===l}function scrubCallOptions(l){var d={};hasValue(l.callStartTime)&&(d.callStartTime=l.callStartTime),hasValue(l.callVoicemailStartOptions)&&(d.callVoicemailStartOptions=l.callVoicemailStartOptions),hasValue(l.invitationType)&&(d.invitationType=l.invitationType),hasValue(l.meetingPreferences)&&(d.meetingPreferences=l.meetingPreferences),hasValue(l.parkContext)&&(d.parkContext=l.parkContext),hasValue(l.pickupCode)&&(d.pickupCode=l.pickupCode),hasValue(l.participantsToNudge)&&(d.participantsToNudgeSize=l.participantsToNudge.length);var u=l.callStartOptions;if(u){var p={};hasValue(u.additionalEndpointProperties)&&(p.additionalEndpointProperties=u.additionalEndpointProperties),hasValue(u.clientEndpointCapabilities)&&(p.clientEndpointCapabilities=u.clientEndpointCapabilities),hasValue(u.connectionType)&&(p.connectionType=u.connectionType),hasValue(u.invitationDataJson)&&(p.invitationDataJson=u.invitationDataJson),hasValue(u.isCast)&&(p.isCast=u.isCast),hasValue(u.label)&&(p.label=u.label),hasValue(u.maxVideoChannels)&&(p.maxVideoChannels=u.maxVideoChannels),hasValue(u.mediaConfiguration)&&(p.mediaConfiguration=u.mediaConfiguration),hasValue(u.muteFlags)&&(p.muteFlags=u.muteFlags),hasValue(u.muted)&&(p.muted=u.muted),hasValue(u.negotiationTag)&&(p.negotiationTag=u.negotiationTag),hasValue(u.preheatFlags)&&(p.preheatFlags=u.preheatFlags),hasValue(u.ringOthers)&&(p.ringOthers=u.ringOthers),hasValue(u.routingFlags)&&(p.routingFlags=u.routingFlags),hasValue(u.scenario)&&(p.scenario=u.scenario),hasValue(u.screenshareDirection)&&(p.screenshareDirection=u.screenshareDirection),hasValue(u.sendMediaModalities)&&(p.sendMediaModalities=u.sendMediaModalities),hasValue(u.sharedLineCallInvitationContentJson)&&(p.sharedLineCallInvitationContentJson=u.sharedLineCallInvitationContentJson),hasValue(u.clientEndpointDebugContent)&&(p.clientEndpointDebugContentSize=u.clientEndpointDebugContent.length),hasValue(u.alternateId)&&(p.alternateId=(0,f.scrubMriOrOmit)(u.alternateId)),hasValue(u.callKey)&&(p.callKeySize=u.callKey.length),hasValue(u.encryptedKey)&&(p.encryptedKeySize=u.encryptedKey.length),d.callStartOptions=p}return d}d.MediaStateConfigHelper=v,d.scrubCallOptions=scrubCallOptions},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p={NEGOTIATION_COMPLETED:\"NegotiationCompleted\",INITIAL:{OFFER_GENERATION_STARTED:\"InitialOfferGenerationStarted\",OFFER_GENERATION_ENDED:\"InitialOfferGenerationEnded\",ANSWER_PROCESSING_STARTED:\"InitialAnswerProcessingStarted\",ANSWER_PROCESSING_ENDED:\"InitialAnswerProcessingEnded\",OFFER_PROCESSING_STARTED:\"InitialOfferProcessingStarted\",OFFER_PROCESSING_ENDED:\"InitialOfferProcessingEnded\",ANSWER_GENERATION_STARTED:\"InitialAnswerGenerationStarted\",ANSWER_GENERATION_ENDED:\"InitialAnswerGenerationEnded\"},RENEGOTIATION:{OFFER_GENERATION_STARTED:\"RenegotiationOfferGenerationStarted\",OFFER_GENERATION_ENDED:\"RenegotiationOfferGenerationEnded\",ANSWER_PROCESSING_STARTED:\"RenegotiationAnswerProcessingStarted\",ANSWER_PROCESSING_ENDED:\"RenegotiationAnswerProcessingEnded\",OFFER_PROCESSING_STARTED:\"RenegotiationOfferProcessingStarted\",OFFER_PROCESSING_ENDED:\"RenegotiationOfferProcessingEnded\",ANSWER_GENERATION_STARTED:\"RenegotiationAnswerGenerationStarted\",ANSWER_GENERATION_ENDED:\"RenegotiationAnswerGenerationEnded\"}},h=function(){function MediaSessionWrapper(l,d,u){var h=this;this.mediaSession=l,this.signalingSession=d,this.mediaConstants=u,this.operationNames=p.INITIAL,this.configureModalitiesAsync=this.mediaSession.configureModalitiesAsync.bind(this.mediaSession),this.getAllowedModalities=this.mediaSession.getAllowedModalities&&this.mediaSession.getAllowedModalities.bind(this.mediaSession),this.rejectNegotiationAsync=this.mediaSession.rejectNegotiationAsync.bind(this.mediaSession),this.createRemoteRenderer=this.mediaSession.createRemoteRenderer.bind(this.mediaSession),this.getStatsAsync=this.mediaSession.getStatsAsync.bind(this.mediaSession),this.getLastKnownStats=this.mediaSession.getLastKnownStats.bind(this.mediaSession),this.muteHold=this.mediaSession.muteHold.bind(this.mediaSession),this.muteInputAsync=this.mediaSession.muteInputAsync.bind(this.mediaSession),this.unmuteInputAsync=this.mediaSession.unmuteInputAsync.bind(this.mediaSession),this.muteOutputAsync=this.mediaSession.muteOutputAsync.bind(this.mediaSession),this.unmuteOutputAsync=this.mediaSession.unmuteOutputAsync.bind(this.mediaSession),this.terminate=this.mediaSession.terminate.bind(this.mediaSession),this.createAudioElement=this.mediaSession.createAudioElement.bind(this.mediaSession),this.getSessionConfig=this.mediaSession.getSessionConfig.bind(this.mediaSession),this.getRawOutputAudioStream=this.mediaSession.getRawOutputAudioStream.bind(this.mediaSession),this.setRawInputAudioStreamTrack=this.mediaSession.setRawInputAudioStreamTrack.bind(this.mediaSession),this.useNullAudioStreamClient=this.mediaSession.useNullAudioStreamClient.bind(this.mediaSession);var g=this.getExtensionsManager();g&&g.configureExtension(this.mediaConstants.EXTENSION_TYPE.videoStreamControl,{sender:{send:function(l,d){return h.signalingSession?h.signalingSession.sendWebRtcMediaNotificationAsync(l,d):Promise.reject(new Error(\"no signaling session\"))}}})}return MediaSessionWrapper.prototype.enableRealTimeTelemetry=function(){},MediaSessionWrapper.prototype.processOfferAsync=function(l,d){var u=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_PROCESSING_STARTED),this.mediaSession.processOfferAsync(l,d).then((function(l){return u.signalingSession.setOfferAnswerGenerationTimestamps(u.operationNames.OFFER_PROCESSING_ENDED),l}))},MediaSessionWrapper.prototype.createAnswerAsync=function(l,d){var u=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_GENERATION_STARTED),this.mediaSession.createAnswerAsync(l,d).then((function(d){return u.signalingSession.setOfferAnswerGenerationTimestamps(u.operationNames.ANSWER_GENERATION_ENDED),l||(u.operationNames=p.RENEGOTIATION),d}))},MediaSessionWrapper.prototype.createOfferAsync=function(l){var d=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.OFFER_GENERATION_STARTED),this.mediaSession.createOfferAsync(l).then((function(l){return d.signalingSession.setOfferAnswerGenerationTimestamps(d.operationNames.OFFER_GENERATION_ENDED),l}))},MediaSessionWrapper.prototype.processAnswerAsync=function(l,d,u,h){var g=this;return this.signalingSession.setOfferAnswerGenerationTimestamps(this.operationNames.ANSWER_PROCESSING_STARTED),this.mediaSession.processAnswerAsync(l,d,u,h).then((function(){g.signalingSession.setOfferAnswerGenerationTimestamps(g.operationNames.ANSWER_PROCESSING_ENDED),g.operationNames=p.RENEGOTIATION}))},MediaSessionWrapper.prototype.completeNegotiationAsync=function(l){var d=this;return this.mediaSession.completeNegotiationAsync(l).then((function(l){return d.signalingSession.setOfferAnswerGenerationTimestamps(p.NEGOTIATION_COMPLETED),l}))},MediaSessionWrapper.prototype.sendDtmf=function(l){return this.mediaSession.sendDtmf?this.mediaSession.sendDtmf(l):Promise.reject(\"Not Implemented\")},MediaSessionWrapper.prototype.getExtensionsManager=function(){return this.mediaSession.getExtensionsManager?this.mediaSession.getExtensionsManager():null},MediaSessionWrapper.prototype.reconnectAsync=function(l,d){return void 0===d&&(d=!1),this.mediaSession.reconnectAsync(l,d)},MediaSessionWrapper.prototype.completeEscalationAsync=function(l){return this.mediaSession.completeEscalationAsync(l)},MediaSessionWrapper.prototype.rejectEscalationAsync=function(l,d){return this.mediaSession.rejectEscalationAsync(l,d)},MediaSessionWrapper.prototype.getAcceptedTypes=function(){return this.mediaSession.getAcceptedTypes()},MediaSessionWrapper.prototype.getLocalMediaTrackId=function(l){return this.mediaSession.getLocalMediaTrackId?this.mediaSession.getLocalMediaTrackId(l):null},MediaSessionWrapper}();d.default=h},function(l,d,u){function handleServerMutedVersion(l,d,u){if(!(void 0===d||void 0===d.serverMuteVersion||void 0===u||void 0===u.serverMuteVersion||u.serverMuteVersion>=d.serverMuteVersion)){var p=u&&u.mediaStreams,h=p&&p.filter((function(l){return\"audio\"===l.type||\"audio-teleconferencing\"===l.type})),g=d&&d.mediaStreams,f=g&&g.filter((function(l){return\"audio\"===l.type||\"audio-teleconferencing\"===l.type}));h&&h.length&&(u.serverMuteVersion=d.serverMuteVersion,h[0].serverMuted=f[0].serverMuted,l.info(\"handleServerMutedVersion: patching server muted state in audio streams updated:\".concat(JSON.stringify(h[0]),\" as we encountered stale muteServerVersion. Updated to \").concat(d.serverMuteVersion)))}}function handleMuteUnmuteParticipantInfo(l,d,u,p){if(\"success\"!==u.reason||void 0===d||u.serverMuteVersion<=d.serverMuteVersion)return l.info(\"handleMuteUnmuteParticipantInfo: ignoring updating since we encountered invalid state: \".concat(u.reason,\" serverMuteVersion: \").concat(u.serverMuteVersion)),!1;var h=d&&d.mediaStreams,g=h&&h.filter((function(l){return\"audio\"===l.type||\"audio-teleconferencing\"===l.type}));return!!g&&(g[0].serverMuted=p,d.serverMuteVersion=u.serverMuteVersion,l.info(\"handleMuteUnmuteParticipantInfo: updating since we encountered valid state serverMuteVersion: \".concat(u.serverMuteVersion,\" to: \").concat(p,\" streams: \").concat(g[0])),!0)}Object.defineProperty(d,\"__esModule\",{value:!0}),d.handleMuteUnmuteParticipantInfo=d.handleServerMutedVersion=void 0,d.handleServerMutedVersion=handleServerMutedVersion,d.handleMuteUnmuteParticipantInfo=handleMuteUnmuteParticipantInfo},function(l,d,u){var p,h,g=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.PluginlessCallParticipant=void 0;var m=u(8),v=u(41),y=u(53),S=u(13),_=u(14),C=u(18),E=u(46),T=u(17),b=u(114),I=u(116),A=u(118),R=u(61),P=((p={})[0]=[1],p[1]=[2,6,3,4,5,7,8],p[2]=[6,3,4,8],p[3]=[1,4,5,8],p[7]=[3,4,8],p[4]=[],p[5]=[3,4,8],p[6]=[3,4],p[8]=[3,5,4],p),O=((h={})[0]=\"Disconnected\",h[1]=\"Connecting\",h[2]=\"Ringing\",h[3]=\"Connected\",h[5]=\"Connected\",h[4]=\"Disconnected\",h[7]=\"Connecting\",h),M=function(l){function PluginlessCallParticipant(d,u,p,h,g,m,_,C,E){void 0===C&&(C=(0,S.generateCauseId)()),void 0===E&&(E=!1);var b=l.call(this,p)||this;return b.mri=d,b.callTelemetry=g,b.configProvider=m,b.enablePluginlessCallParticipantRaiseChangeDeferred=E,b.state=0,b.voiceLevel=0,b.isServerMuted=!1,b.endpointType=\"default\",b.balanceUpdates={},b.filteredParticipantEndpointDetails={},b.recordTelemetryForStateChange=function(l,d,u,p){var h,g;if(p){var f=v.PARTICIPANT_OPERATIONS_INTERNAL.SET_PARTICIPANT_STATE_INVALID,m={state:d,reason:u,endpoints:[]};(null===(g=null===(h=b.endpoints)||void 0===h?void 0:h.endpointDetails)||void 0===g?void 0:g.length)&&(m.endpoints=(0,y.getEndpointInformationForTelemetry)(b.endpoints.endpointDetails)),b.callTelemetry.recordEvent(f,m,l)}},b.checkIfIncomingServerMutedIsUpdated=function(l){b.filteredParticipantEndpointDetails!=={}&&l.endpointDetails.forEach((function(l){var d=b.filteredParticipantEndpointDetails[l.participantId];void 0!==d&&I.handleServerMutedVersion(b.logger,d,l)}))},b.handleServerMutedInfoUpdate=function(l){var d,u,p=!1;try{for(var h=f(l),g=h.next();!g.done;g=h.next()){var m=g.value,v=b.filteredParticipantEndpointDetails[m.participantId];I.handleMuteUnmuteParticipantInfo(b.logger,v,m,!0)&&(p=!0)}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}p&&b.updateIsServerMuted()},b.id=b.mri,b.logger=p.createChild((function(){return\"ICallParticipant[\".concat(T.scrubMriOrOmit(b.id),\"][\").concat(b.state,\"]\")})),b.logger.info(\"[\".concat(C,\"]created\")),b.streamManager=new A.PluginlessCallStreamManager(b.id,u,h,b.logger,_,b.configProvider),b}return g(PluginlessCallParticipant,l),Object.defineProperty(PluginlessCallParticipant.prototype,\"audio\",{get:function(){return this.streamManager.audio},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessCallParticipant.prototype,\"streams\",{get:function(){return this.streamManager.streams},enumerable:!1,configurable:!0}),PluginlessCallParticipant.prototype.getDiagnosticData=function(){return JSON.stringify({id:T.scrubMriOrOmit(this.id),state:this.state,isServerMuted:this.isServerMuted})},PluginlessCallParticipant.prototype.isSameParticipantsMri=function(l){return this.id===l},PluginlessCallParticipant.prototype.setMediaSession=function(l,d){void 0===d&&(d=(0,S.generateCauseId)()),this.streamManager.setMediaSession(l,d)},PluginlessCallParticipant.prototype.updateStreams=function(l,d){void 0===d&&(d=(0,S.generateCauseId)());var u=this.logger.createFnLogger(\"updateStreams\",d);this.streamManager.updateStreams(l,d),u.info(\"mediaStreams=\".concat((0,_.safeJsonStringify)(l))),this.enablePluginlessCallParticipantRaiseChangeDeferred?this.raiseChangedDeferred():this.raiseChanged()},PluginlessCallParticipant.prototype.hasAudioSource=function(l){return this.streamManager.hasAudioSource(l)},PluginlessCallParticipant.prototype.raiseChangedDeferred=function(){var l=this;this.raiseChangedDefer||(this.raiseChangedDefer=m.defer((function(){delete l.raiseChangedDefer,l.raiseChanged()})))},PluginlessCallParticipant.prototype.updateIsServerMuted=function(){if(Object.values(this.filteredParticipantEndpointDetails).length){var l=!1;Object.values(this.filteredParticipantEndpointDetails).forEach((function(d){var u,p,h;if(!d.lwjSessionInformation){var filterAndSortStreams=function(l){var u;return null===(u=d.mediaStreams)||void 0===u?void 0:u.filter((function(d){return d.type===l})).sort(A.PluginlessCallStreamManager.compareStreams)},g=null===(u=filterAndSortStreams(R.ngcStreamTypes.audio))||void 0===u?void 0:u[0];g||(g=null===(p=filterAndSortStreams(R.ngcStreamTypes.audioteleconference))||void 0===p?void 0:p[0]);var f=!!(null==g?void 0:g.serverMuted),m=null===(h=d.endpointState)||void 0===h?void 0:h.state,v=!!(null==m?void 0:m.isMuted);!1!==f||!1!==v||(l=!0)}}));var d=!l;this._updateIsServerMuted(d)}else this._updateIsServerMuted(!1)},PluginlessCallParticipant.prototype._updateIsServerMuted=function(l){l!==this.isServerMuted&&(this.isServerMuted=l,this.logger.info(\"_updateIsServerMuted updating to: \".concat(this.isServerMuted)),this.raiseChanged())},PluginlessCallParticipant.prototype.updateVoiceLevel=function(l){this.voiceLevel!==l&&(this.voiceLevel=l,this.raiseChanged())},PluginlessCallParticipant.prototype.setState=function(l,d,u){if(this.state!==l){var p=this.logger.createFnLogger(\"setState\",u);if(3!==this.state||6!==l){var h=P[this.state].indexOf(l)>=0;this.recordTelemetryForStateChange(u,l,d,!h),h?(p.info(\"state=\".concat(this.state,\"->\").concat(l,\" reason=\").concat(this.stateReason,\"->\").concat(d)),this.state=l,this.stateReason=d,this.enablePluginlessCallParticipantRaiseChangeDeferred?this.raiseChangedDeferred():this.raiseChanged()):p.logFailure(\"Invalid state transition \".concat(this.state,\"->\").concat(l,\" attempted\"))}else p.info(\"Ignore Connected->EarlyMedia transition, it is a race between media and signaling\")}},PluginlessCallParticipant.prototype.processParticipantDetails=function(l,d){var u,p=this,h=this.logger.createFnLogger(\"processParticipantDetails\",\"\");this.role=l.role,this.meetingRole=l.meetingRole,this.advancedMeetingRole=l.advancedMeetingRole,this.tenantId=l.tenantId,(null===(u=l.endpointDetails)||void 0===u?void 0:u.length)&&(this.endpoints={endpointDetails:[]},this.participantCapabilities={canConference:!1,canShareScreen:!1,canMerge:!0},this.checkIfIncomingServerMutedIsUpdated(l),this.filteredParticipantEndpointDetails={},l.endpointDetails.forEach((function(l){var u=b.convertSignalingEndpointDetails(l,d);if(p.endpoints.endpointDetails.push(u),!u.mappedTo&&(p.filteredParticipantEndpointDetails[l.participantId]={endpointId:l.endpointId,serverMuteVersion:l.serverMuteVersion,endpointState:l.endpointState,mediaStreams:l.mediaStreams,lwjSessionInformation:l.lwjSessionInformation},l.capabilities&&(p.participantCapabilities.canConference||\"enabled\"!==l.capabilities.cloudAudioVideoConference||(p.participantCapabilities.canConference=!0),p.participantCapabilities.canShareScreen||\"enabled\"!==l.capabilities.cloudScreenSharing||(p.participantCapabilities.canShareScreen=!0),p.participantCapabilities.canMerge||\"enabled\"!==l.capabilities.cloudMerge||(p.participantCapabilities.canMerge=!0)),p.contentSharingRole=0,l.contentSharing&&l.contentSharing.sessionInformation)){var h=l.contentSharing.sessionInformation;\"attendee\"===h.role?p.contentSharingRole=1:\"presenter\"===h.role&&(p.contentSharingRole=2)}})),this.updateIsServerMuted(),h.info(\"endpointDetails=\".concat(JSON.stringify(this.endpoints))),this.enablePluginlessCallParticipantRaiseChangeDeferred?this.raiseChangedDeferred():this.raiseChanged())},PluginlessCallParticipant.prototype.toCafeParticipant=function(){return{audioState:O[this.state],mri:this.mri}},PluginlessCallParticipant.prototype.getSourceIdForMediaType=function(l){var d=E.getSourceIdForMediaType(this,l);return-1===d&&this.logger.warn(\"getSourceIdForMediaType failed\"),d},PluginlessCallParticipant.prototype.useLightweightStreams=function(l,d){this.streamManager.useLightweightStreams(l,d)},PluginlessCallParticipant.prototype.hasSourceId=function(l,d){return void 0!==E.getParticipantIdForSourceId(this,l,d)},PluginlessCallParticipant}(C.default);d.PluginlessCallParticipant=M},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.PluginlessCallStreamManager=d.SHARING_STREAM_DEFAULT_ID=d.VIDEO_STREAM_DEFAULT_ID=d.AUDIO_STREAM_DEFAULT_ID=void 0;var p=u(8),h=u(301),g=u(302),f=u(303),m=u(61),v=u(119);d.AUDIO_STREAM_DEFAULT_ID=1,d.VIDEO_STREAM_DEFAULT_ID=2,d.SHARING_STREAM_DEFAULT_ID=3;var y=function(){function PluginlessCallStreamManager(l,u,p,g,m,y){this.participantId=l,this.mediaSession=u,this.localStats=p,this.imageRenderingSession=m,this.configProvider=y,this.audioSourceIds=[],this.streams={},this.lightweightFrameUris=null,this.cachedSharingStreams=[];var S=p.receive(1,l),_=p.receive(2,l);this.audio=new h.default(u,g,d.AUDIO_STREAM_DEFAULT_ID);var C=new v.default(u,S,g,d.VIDEO_STREAM_DEFAULT_ID,this.configProvider),E=new f.default(u,_,g,d.SHARING_STREAM_DEFAULT_ID,this.configProvider);this.streams[0]=[C],this.streams[1]=[E],this.logger=g.createChild(\"PluginlessCallStreamManager\")}return PluginlessCallStreamManager.prototype.setMediaSession=function(l,d){this.logger.info(\"[\".concat(d,\"][setMediaSession]\")),this.mediaSession=l,[[this.audio],this.streams[0],this.streams[1]].forEach((function(u){return u.forEach((function(u){return u.setMediaSession(l,d)}))}))},PluginlessCallStreamManager.prototype.updateStreams=function(l,d){this.logger.info(\"[\".concat(d,\"][updateStreams]\"));var filterAndSortStreams=function(d){return l.filter((function(l){return l.type===d})).sort(PluginlessCallStreamManager.compareStreams)},u=filterAndSortStreams(m.ngcStreamTypes.audio);0===u.length&&(u=filterAndSortStreams(m.ngcStreamTypes.audioteleconference)),u.length>0&&(this.audioSourceIds=u.map((function(l){return l.sourceId})));var p=u[0];p&&this.audio.update(p,d),this.updateMediaStreams(filterAndSortStreams(m.ngcStreamTypes.video),0,d),this.updateMediaStreams(filterAndSortStreams(m.ngcStreamTypes.sharing),1,d)},PluginlessCallStreamManager.prototype.hasAudioSource=function(l){return this.audioSourceIds.some((function(d){return d===l}))||this.audio.id===l},PluginlessCallStreamManager.prototype.useLightweightStreams=function(l,d){this.lightweightFrameUris=l,this.streams[1].length&&(this.logger.info(\"[\".concat(d,\"][useLightweightStreams] frameUris updated, recreating sharing streams\")),this.streams[1]=[],this.updateMediaStreams(this.cachedSharingStreams,1,d))},PluginlessCallStreamManager.compareStreams=function(l,d){var u=\"sendonly\"===l.direction||\"sendrecv\"===l.direction,p=\"sendonly\"===d.direction||\"sendrecv\"===d.direction;return u&&!p?-1:p&&!u?1:d.sourceId-l.sourceId},PluginlessCallStreamManager.prototype.updateMediaStreams=function(l,d,u){var h=this,m=this.streams[d];1===d&&(this.cachedSharingStreams=l);var y=m.filter((function(d){return!l.some((function(l){return l.sourceId===d.id}))}));y.forEach((function(l){return p.remove(m,l)})),y.length&&this.logger.info(\"[\".concat(u,\"][updateMediaStreams] Removing \").concat(y.length,\" streams of type \").concat(d)),l.forEach((function(y,S){var _=p.find(m,(function(l){return l.id===y.sourceId}));_||(0===d?_=new v.default(h.mediaSession,h.localStats.receive(1,h.participantId),h.logger,y.sourceId,h.configProvider):1===d&&(_=h.lightweightFrameUris?new g.default(h.logger,y.sourceId,h.lightweightFrameUris,h.imageRenderingSession):new f.default(h.mediaSession,h.localStats.receive(2,h.participantId),h.logger,y.sourceId,h.configProvider)),h.logger.info(\"[\".concat(u,\"][updateMediaStreams] Adding stream \").concat(y.sourceId,\" of type \").concat(d)),m.push(_)),_.update(y,u),_.rank=l.length-S}))},PluginlessCallStreamManager}();d.PluginlessCallStreamManager=y},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(60),g=u(62),f=function(l){function VideoStream(d,u,p,h,g){var f=l.call(this,d,p,h)||this;return f.rendererStats=u,f.configProvider=g,f.type=0,f}return p(VideoStream,l),Object.defineProperty(VideoStream.prototype,\"mediaSourceId\",{get:function(){return this.id},enumerable:!1,configurable:!0}),VideoStream.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,msi:this.mediaSourceId,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},VideoStream.prototype.stop=function(){return this.mediaSessionInitPromise.reject(new Error(\"Video stream stopped\")),Promise.resolve(void 0)},VideoStream.prototype.start=function(l,d){var u=this;return this.logger.info(\"video start: target=\".concat(l,\", options=\").concat(JSON.stringify(d))),this.mediaSessionInitPromise.promise.then((function(){return new g.RemoteVideoRenderer(l,u.mediaSession,u.rendererStats,u.configProvider)})).then((function(l){return d&&l.setScalingMode(d.scalingMode),u.logger.info(\"subscribeVideoAsync: videoRenderer=\".concat(l,\", id=\").concat(u.id)),l.subscribeVideoAsync(u).catch((function(d){throw l.dispose(),d})).then((function(){return u.configProvider.config.isStreamingMatchIsRendering||(u.isStreaming=!0),l}))}))},VideoStream.prototype.update=function(d,u){this.logger.info(\"[\".concat(u,\"][update] stream=\").concat(JSON.stringify(d)));var p=this.isAvailable;l.prototype.update.call(this,d,u),this.isAvailable&&this.isAvailable!==p&&this.rendererStats.event(h.MediaReceiverEvent.Available)},VideoStream}(u(78).default);d.default=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ScreenSharingControlProtocol=void 0,function(l){var d=7,u=3;function encodeMouseEvent(l){if(!l)return new Uint8Array(0);l.buttonType||(l.buttonType=0),l.xPos||(l.xPos=0),l.yPos||(l.yPos=0),l.wheelRotation||(l.wheelRotation=0);var u=new ArrayBuffer(d),p=new DataView(u),h=(3&l.type)<<0,g=(7&l.buttonType)<<2,f=(l.buttonDown?1:0)<<5,m=(l.wheelButtonDown?1:0)<<6,v=0;return p.setUint8(0,1),p.setUint8(1,h|g|f|m|v),p.setUint16(2,l.xPos,!0),p.setUint16(4,l.yPos,!0),p.setUint8(6,l.wheelRotation),new Uint8Array(u)}function encodeKeyboardEvent(l){var d=new ArrayBuffer(u),p=new DataView(d),h=(3&l.codeType)<<0,g=0,f=(l.keyUp?1:0)<<4,m=(l.repeat?1:0)<<5,v=0,y=0;return p.setUint8(0,0),p.setUint8(1,h|g|f|m|v|y),p.setUint8(2,l.code),new Uint8Array(d)}function decodeEventType(l){return l[0]}function decodeMouseEvent(l){if(1!==l[0]||l.length!==d)return null;var u=new DataView(l.buffer),p=u.getUint8(1);return{type:3&p,buttonType:p>>2&7,buttonDown:!!(p>>5&1),wheelButtonDown:!!(p>>6&1),xPos:u.getUint16(2,!0),yPos:u.getUint16(4,!0),wheelRotation:u.getUint8(6)}}function decodeKeyboardEvent(l){if(0!==l[0]||l.length!==u)return null;var d=new DataView(l.buffer),p=d.getUint8(1);return{codeType:3&p,code:d.getUint8(2),repeat:!!(p>>5&1),keyUp:!!(p>>4&1)}}l.encodeMouseEvent=encodeMouseEvent,l.encodeKeyboardEvent=encodeKeyboardEvent,l.decodeEventType=decodeEventType,l.decodeMouseEvent=decodeMouseEvent,l.decodeKeyboardEvent=decodeKeyboardEvent}(d.ScreenSharingControlProtocol||(d.ScreenSharingControlProtocol={}))},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.sendIsVirtualInputSupportedMessage=d.EdgeControlInjectorApi=void 0;var g=u(311),f=\"ncbjelpjchkpbikbpkcchkhkblodoama\",m=function(){function EdgeControlInjectorApi(l){this.logger=l}return EdgeControlInjectorApi.prototype.sendInjectInputEventMessage=function(l,d){return p(this,void 0,void 0,(function(){var u=this;return h(this,(function(p){return this.logger.info(\"EdgeControlInjectorApi - sendInjectInputEventMessage\"),[2,new Promise((function(p,h){window.top.chrome.runtime.sendMessage(f,{api:l,deviceId:u.virtualInputDeviceId,event:d},(function(l){l.error?h(l.error.message):p(0)}))}))]}))}))},EdgeControlInjectorApi.prototype.createInputDeviceId=function(l,d,u){return p(this,void 0,void 0,(function(){var p,g;return h(this,(function(h){switch(h.label){case 0:this.virtualInputDeviceId&&this.logger.warn(\"EdgeControlInjectorApi - createInputDeviceId virtual input already exists.\"),h.label=1;case 1:return h.trys.push([1,3,,4]),p=this,[4,this.sendCreateInputDeviceMessage(l,u)];case 2:return p.virtualInputDeviceId=h.sent(),[3,4];case 3:return g=h.sent(),this.logger.error(\"EdgeControlInjectorApi - createInputDevice failed, error: \".concat(JSON.stringify(g))),d(),[3,4];case 4:return[2]}}))}))},EdgeControlInjectorApi.prototype.sendSetLocalUserAvatarMessage=function(l){return p(this,void 0,void 0,(function(){var d;return h(this,(function(u){switch(u.label){case 0:return[4,this.generateAvatarBitmap(l)];case 1:return d=u.sent(),[2,new Promise((function(l,u){var p=window.top;d&&p.chrome.runtime.sendMessage(f,{api:\"setLocalUserAvatar\",avatarBitmap:d},(function(d){d.error?u(d.error.message):l()}))}))]}}))}))},EdgeControlInjectorApi.prototype.sendCloseVirtualInputDeviceMessage=function(){return p(this,void 0,void 0,(function(){var l,d=this;return h(this,(function(u){return(l=this.virtualInputDeviceId)?(this.logger.info(\"EdgeControlInjectorApi - sendCloseVirtualInputDeviceMessage called\"),[2,new Promise((function(u,p){var h=window.top;h.chrome.runtime.sendMessage(f,{api:\"closeInputDevice\",deviceId:l},(function(l){l?l.error?p(l.error.message):(d.virtualInputDeviceId=null,u(l.deviceId)):p(h.chrome.runtime.lastError.message)}))}))]):(this.logger.info(\"EdgeControlInjectorApi - VirtualInputDevice does not exists, nothing to close.\"),[2,Promise.resolve()])}))}))},EdgeControlInjectorApi.prototype.sendCreateInputDeviceMessage=function(l,d){return p(this,void 0,void 0,(function(){var u;return h(this,(function(p){switch(p.label){case 0:return this.logger.info(\"EdgeControlInjectorApi - sendCreateInputDeviceMessage called\"),[4,this.generateAvatarBitmap(d)];case 1:return u=p.sent(),[2,new Promise((function(d,p){var h=window.top,messageCallback=function(l){l?l.deviceId?d(l.deviceId):l.error?p(l.error.message):p(\"Error: Unexpected response from API\"):p(h.chrome.runtime.lastError.message)};u?h.chrome.runtime.sendMessage(f,{api:\"createInputDevice\",mediaStreamTrackId:l,avatarBitmap:u},messageCallback):h.chrome.runtime.sendMessage(f,{api:\"createInputDevice\",mediaStreamTrackId:l},messageCallback)}))]}}))}))},EdgeControlInjectorApi.prototype.generateAvatarBitmap=function(l){return p(this,void 0,void 0,(function(){var d,u,p;return h(this,(function(h){switch(h.label){case 0:if(!l)return[2,null];h.label=1;case 1:return h.trys.push([1,3,,4]),d=32,[4,(0,g.pngBase64ToBitmap)(l,d,d)];case 2:return u=h.sent(),[2,{width:d,height:d,data:u}];case 3:return p=h.sent(),this.logger.error(\"EdgeControlInjectorApi - generateAvatarBitmap error: \".concat(JSON.stringify(p),\", continue without avatar.\")),[2,null];case 4:return[2]}}))}))},EdgeControlInjectorApi}();function sendIsVirtualInputSupportedMessage(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){return[2,new Promise((function(d,u){l.info(\"EdgeControlInjectorApi - sendIsVirtualInputSupportedMessage\");var p=window.top;p.chrome.runtime.sendMessage(f,{api:\"isVirtualInputSupported\"},(function(l){l?l.error?d(l.error.message):d(l):u(p.chrome.runtime.lastError.message)}))}))]}))}))}d.EdgeControlInjectorApi=m,d.sendIsVirtualInputSupportedMessage=sendIsVirtualInputSupportedMessage},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaAgentError=void 0;var f=u(27),m=u(319),v=u(320),y=u(321),S=u(322),_=u(324),C=u(451),E=u(452),T=u(462),b=u(28),I=function(){function MediaAgentProvider(l,d,u){var p,h,g=this;null!==(p=l.logger)&&void 0!==p||(l.logger=new m.default),null!==(h=l.domOverrides)&&void 0!==h||(l.domOverrides={}),this.config=l;var f=l.mediaSettings;this.logger=new T.default(l.safeLogger&&l.safeLogger.createChild(\"MA\",f.debug),l.logger.createChild(\"MA\",f.debug)),this.configProvider=new S.default(this.logger.createChild(\"configProvider\"),u,f);var b=new C.DeviceManagerDiagnostics(this.configProvider);this.mediaAgentDiagnostics=new E.MediaAgentDiagnostics(this.configProvider,b),this.ufdManager=new y.UFDManager(this.logger.createChild(\"UFD\"),this.configProvider),this.deviceManager=new _.default(this.logger.createChild(\"DeviceManager\"),this.configProvider,b,l.domOverrides,this.ufdManager,l.webcvProvider,l.wasmdnsProvider,l.wasmaecProvider),this.capabilities=new v.default(this.configProvider),d.on(\"OnECSChanged\",(function(){var l=d.getEcsConfig(\"SkypeWebMedia\",\"mediaAgent\");l?g.configProvider.updateConfig(l,d.ETag,d.getEcsConfig(\"ConfigIDs\",\"SkypeWebMedia\")):g.logger.warn(\"No SkypeWebMedia.mediaAgent config.\")}))}return MediaAgentProvider.prototype.getDeviceManager=function(){return this.deviceManager},MediaAgentProvider.prototype.buildAgent=function(l,d){return h(this,void 0,void 0,(function(){var u,p,h,m=this;return g(this,(function(g){switch(g.label){case 0:if(!f.UserAgentConfig.hasMediaApi())throw[new A(\"\".concat(l,\" not supported by media agent provider\"),\"not_supported\")];return(u=this.config&&this.config.detectH264Support)?[4,f.UserAgentConfig.hasH264CodecSupport(this.config.logger)]:[3,2];case 1:u=!g.sent(),g.label=2;case 2:if(u)throw[new A(\"H264 is not supported\",\"not_supported\")];return(p={getRelayManager:function(){return d},getWebCVProvider:function(){return m.config.webcvProvider},getWasmDnsProvider:function(){return m.config.wasmdnsProvider},getWasmAecProvider:function(){return m.config.wasmaecProvider},domOverrides:this.config.domOverrides,configProvider:this.configProvider}).getRelayManager().initialize(),(h=b.MediaAgent.build(this.logger,p,this.configProvider,this.mediaAgentDiagnostics,this.ufdManager,this.deviceManager,this.capabilities)).constants=b.MediaAgent.constants,[2,h]}}))}))},MediaAgentProvider}();d.default=I;var A=function(l){function MediaAgentError(d,u){void 0===u&&(u=\"failure\");var p=l.call(this,d)||this;return p.reason=u,p}return p(MediaAgentError,l),MediaAgentError}(Error);d.MediaAgentError=A},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.createRemoteRendererStatsOverlay=d.createLocalRendererStatsOverlay=void 0;var h=u(1),g=function(){function RendererStatsOverlay(l){var d=this;this.container=l,this.elements={},this.createTableCell=function(l,u){d.elements[l]=document.createElement(\"td\"),d.addElementStyle(l),d.elements[u].appendChild(d.elements[l])},this.topElement=l.ownerDocument.createElement(\"div\"),this.topElement.classList.add(\"vdi-occlusion\"),this.topElement.style.position=\"absolute\",this.topElement.style.top=\"0px\",this.topElement.style.left=\"0px\",this.topElement.style.zIndex=\"100\",this.topElement.style.transform=\"inherit\",this.topElement.style.backgroundColor=\"rgba(0, 0, 0, 0.2)\",this.container.appendChild(this.topElement),this.table=document.createElement(\"table\"),this.topElement.appendChild(this.table)}return RendererStatsOverlay.prototype.dispose=function(){this.topElement.removeChild(this.table),this.container.removeChild(this.topElement),this.table=null,this.topElement=null,this.container=null},RendererStatsOverlay.prototype.createTableColumn=function(l,d){var u,h;try{for(var g=p(Object.keys(l)),f=g.next();!f.done;f=g.next()){var m=f.value;this.createTableRow(m,l[m],d)}}catch(l){u={error:l}}finally{try{f&&!f.done&&(h=g.return)&&h.call(g)}finally{if(u)throw u.error}}},RendererStatsOverlay.prototype.createTableRow=function(l,d,u){var p;this.elements[l]||(this.elements[l]=document.createElement(\"tr\"),this.table.appendChild(this.elements[l]));var h=\"\".concat(l,\"-title\");this.elements[h]||(this.createTableCell(h,l),this.elements[h].innerText=d.text?d.text:l);var g=\"\".concat(l,\"-\").concat(u);this.elements[g]||this.createTableCell(g,l),this.elements[g].innerText=null===(p=d.value)||void 0===p?void 0:p.toString()},RendererStatsOverlay.prototype.addElementStyle=function(l){this.elements[l].title=l,this.elements[l].style.color=\"yellow\",this.elements[l].style.maxWidth=\"fit-content\",this.elements[l].style.whiteSpace=\"nowrap\",this.elements[l].style.fontSize=\"smaller\"},RendererStatsOverlay}(),f=function(){function RemoteRendererStatsOverlay(l,d){this.container=l,this.renderer=d,this.subs=[]}return RemoteRendererStatsOverlay.prototype.initialize=function(){var l=this;this.overlay||(this.overlay=new g(this.container),this.overlay.createTableRow(\"streamSize\",{value:\"0x0\"},\"streamSize\"),this.subs.push(this.renderer.on(\"onVideoSizeChanged\",(function(d,u){var p;return null===(p=l.overlay)||void 0===p?void 0:p.createTableRow(\"streamSize\",{value:\"\".concat(d,\"x\").concat(u)},\"streamSize\")}))),this.overlay.createTableRow(\"rendererSize\",{value:\"0x0\"},\"rendererSize\"),this.subs.push(this.renderer.on(\"onRendererSizeChanged\",(function(d,u){var p;return null===(p=l.overlay)||void 0===p?void 0:p.createTableRow(\"rendererSize\",{value:\"\".concat(u.width,\"x\").concat(u.height)},\"rendererSize\")}))))},RemoteRendererStatsOverlay.prototype.clear=function(){var l;this.subs.forEach((function(l){return l.dispose()})),this.subs=[],null===(l=this.overlay)||void 0===l||l.dispose(),this.overlay=null},RemoteRendererStatsOverlay.prototype.setStats=function(l){if(this.overlay){var d={ssrc:{value:l.ssrc},fps:{text:\"FPS(r/d)\",value:\"\".concat(l.googFrameRateReceived,\"/\").concat(l.googFrameRateDecoded)},bitrate:{value:l.bytesReceivedDiff&&calcBitrate(l.bytesReceivedDiff)},decodeTime:{value:l.decodeTime&&l.googFrameRateDecoded&&h.round(l.decodeTime/l.googFrameRateDecoded,2)},keyFramesDecoded:{text:\"KFs\",value:l.keyFramesDecoded},nacksFirsPlisSent:{text:\"N/F/P\",value:\"\".concat(l.googNacksSent,\"/\").concat(l.googFirsSent,\"/\").concat(l.googPlisSent)}};this.overlay.createTableColumn(d,l.id)}},RemoteRendererStatsOverlay.prototype.dispose=function(){this.clear(),this.container=null,this.renderer=null},RemoteRendererStatsOverlay}(),m=function(){function LocalRendererStatsOverlay(l){this.container=l}return LocalRendererStatsOverlay.prototype.initialize=function(){var l;null!==(l=this.overlay)&&void 0!==l||(this.overlay=new g(this.container))},LocalRendererStatsOverlay.prototype.clear=function(){var l;null===(l=this.overlay)||void 0===l||l.dispose(),this.overlay=null},LocalRendererStatsOverlay.prototype.setStats=function(l){var d=this;if(this.overlay){var getStatsValues=function(l){var u={rid:{value:l.rid},inputSize:{value:l.googFrameWidthInput&&\"\".concat(l.googFrameWidthInput,\"x\").concat(l.googFrameHeightInput)},sentSize:{value:l.googFrameWidthSent&&\"\".concat(l.googFrameWidthSent,\"x\").concat(l.googFrameHeightSent)},ssrc:{value:l.ssrc},fps:{text:\"FPS(i/e)\",value:\"\".concat(l.googFrameRateInput,\"/\").concat(l.googFrameRateEncoded)},bitrate:{value:l.bytesSentDiff&&calcBitrate(l.bytesSentDiff)},encodeTime:{value:l.encodeTime&&l.googFrameRateEncoded&&h.round(l.encodeTime/l.googFrameRateEncoded,2)},qp:{value:l.qp&&l.googFrameRateEncoded&&h.round(l.qp/l.googFrameRateEncoded,2)}};l.hasOwnProperty(\"rid\")||delete u.rid,d.overlay.createTableColumn(u,l.id)};l.forEach((function(l){return getStatsValues(l)}))}},LocalRendererStatsOverlay.prototype.dispose=function(){this.clear(),this.container=null},LocalRendererStatsOverlay}();function createLocalRendererStatsOverlay(l,d){return new v(new m(d),l)}function createRemoteRendererStatsOverlay(l,d,u){return new v(new f(d,u),l)}d.createLocalRendererStatsOverlay=createLocalRendererStatsOverlay,d.createRemoteRendererStatsOverlay=createRemoteRendererStatsOverlay;var v=function(){function RendererStatsOverlayHandler(l,d){var u;this.overlay=l;var p=null===window||void 0===window?void 0:window.webMA;p&&(null!==(u=p.stats)&&void 0!==u||(p.stats={show:d})),d&&this.overlay.initialize()}return RendererStatsOverlayHandler.prototype.setStats=function(l){this.initOrClear(),this.overlay.setStats(l)},RendererStatsOverlayHandler.prototype.dispose=function(){this.overlay.dispose()},RendererStatsOverlayHandler.prototype.initOrClear=function(){var l,d=null===window||void 0===window?void 0:window.webMA;(null===(l=null==d?void 0:d.stats)||void 0===l?void 0:l.show)?this.overlay.initialize():d&&!d.stats.show&&this.overlay.clear()},RendererStatsOverlayHandler}();function calcBitrate(l){var d=1e3,u=8*l;return u>=d?\"\".concat(Math.round(u/d),\" kbps\"):\"\".concat(u,\" bps\")}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ConstraintsProviderFactory=void 0;var p=u(19),h=u(15),g=u(328),f=u(330),m=function(){function ConstraintsProviderFactory(){}return ConstraintsProviderFactory.getProvider=function(l,d,u){if(\"ScreenShare\"===l){var m=u.createChild(\"SharingCP\");return\"Safari\"===(0,p.getBrowserInfo)().name?new g.SafariSharingConstraintsProvider(m,h.default.window):new g.SharingConstraintsProvider(m)}return new f.BasicConstraintsProvider(d,u.createChild(\"VideoCP\"))},ConstraintsProviderFactory}();d.ConstraintsProviderFactory=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.adjustResolitionToAspectRatio=void 0;var p=u(8);function adjustResolitionToAspectRatio(l,d){var u=l.width/l.height,h=p.clone(l);return u>d?h.width=Math.floor(l.height*d):u<d&&(h.height=Math.floor(l.width/d)),h}d.adjustResolitionToAspectRatio=adjustResolitionToAspectRatio},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ConstraintsProviderBase=void 0;var p=u(9),h=u(1),g=function(){function ConstraintsProviderBase(l){this.logger=l}return ConstraintsProviderBase.prototype.dispose=function(){},ConstraintsProviderBase.prototype.updateVideoConstraints=function(l,d,u){var p=this.calculateConstraints(d,u);this.logger.safe.info(\"Calculated constraints: \".concat(JSON.stringify(p),\" from capabilities: \").concat(JSON.stringify(d)));var g=p.resolution,f=p.fps,m=g&&(!h.isInRange(g.width,l.video.minWidth,l.video.maxWidth)||!h.isInRange(g.height,l.video.minHeight,l.video.maxHeight)),v=l.video.fps!==f;if(!m&&!v)return l;var y=l.clone();return m&&this.setResolution(y,g),v&&(y.video.fps=f),y},ConstraintsProviderBase.prototype.updateResolution=function(l,d){var u=l.clone();return this.setResolution(u,d),u},ConstraintsProviderBase.prototype.setResolution=function(l,d){l.video.maxWidth=d.width,l.video.minWidth=d.width,l.video.maxHeight=d.height,l.video.minHeight=d.height},ConstraintsProviderBase.prototype.getKey=function(l){return l.video?h.isEmpty(l.video)?\"video\":l.video.deviceId&&l.video.minWidth&&l.video.minHeight?\"\".concat(l.video.deviceId,\"x\").concat(l.video.minWidth,\"x\").concat(l.video.minHeight):l.video.minWidth&&l.video.minHeight?\"\".concat(l.video.minWidth,\"x\").concat(l.video.minHeight):l.video.deviceId?\"\".concat(l.video.deviceId):(this.logger.safe.error(\"Cannot create key for constraints: \".concat((0,p.scrubConstraints)(l))),\"\"):\"audio\"},ConstraintsProviderBase.prototype.convertConstraints=function(l,d){if(void 0===d&&(d={}),!l)return null;var u=h.deepClone(d);return(null==l?void 0:l.deviceId)&&(u.deviceId=l.deviceId),u},ConstraintsProviderBase}();d.ConstraintsProviderBase=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoCapabilitiesValidator=void 0;var p=u(1),h=function(){function VideoCapabilitiesValidator(l,d){this.logger=l,this.maxCapabilities=d}return VideoCapabilitiesValidator.prototype.ensureValidity=function(l){this.throwIfMissing(l);var d=this.calculateMissing(l);return this.maxCapabilities&&this.applyMaxCapabilities(d),this.logger.safe.info(\"Validating capabilities \".concat(JSON.stringify(d))),d},VideoCapabilitiesValidator.prototype.throwIfMissing=function(l){if(!l.maxFs&&!l.maxMbps&&!l.maxFps||l.maxFs&&!l.maxMbps&&!l.maxFps||!l.maxFs&&l.maxMbps&&!l.maxFps||!l.maxFs&&!l.maxMbps&&l.maxFps)throw new Error(\"Missing video capabilities \".concat(JSON.stringify(l)))},VideoCapabilitiesValidator.prototype.calculateMissing=function(l){var d=p.shallowClone(l);return!l.maxFs&&l.maxMbps&&l.maxFps&&(d.maxFs=l.maxMbps/l.maxFps),l.maxFs&&!l.maxMbps&&l.maxFps&&(d.maxMbps=l.maxFs*l.maxFps),l.maxFs&&l.maxMbps&&!l.maxFps&&(d.maxFps=l.maxMbps/l.maxFs),d},VideoCapabilitiesValidator.prototype.applyMaxCapabilities=function(l){this.maxCapabilities.maxFs&&(l.maxFs=Math.min(l.maxFs,this.maxCapabilities.maxFs)),this.maxCapabilities.maxMbps&&(l.maxMbps=Math.min(l.maxMbps,this.maxCapabilities.maxMbps)),this.maxCapabilities.maxFps&&(l.maxFps=Math.min(l.maxFps,this.maxCapabilities.maxFps))},VideoCapabilitiesValidator}();d.VideoCapabilitiesValidator=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.RequestPolicyGenerator=void 0;var p=u(26),h=u(80),g=function(){function RequestPolicyGenerator(l){this.resTable=new p.default(l.config.resolutionTableOverride)}return RequestPolicyGenerator.prototype.getPolicies=function(l){var d=this;if(l.audio&&!l.video&&this.hasAudioProcessingConstraints(l))return[l,new h.ConstraintsObject({deviceId:l.audio.deviceId},null)];if(!l.video)return[l];var u=this.getSuitableResolutions(l).map((function(u){return d.getConstraintsForResolution(l,u)})),p=l.audio,g={deviceId:l.video.deviceId},f=new h.ConstraintsObject(p,g,l.withTimeout);return u.push(f),u},RequestPolicyGenerator.prototype.getSuitableResolutions=function(l){return this.resTable.getResolutions().filter((function(d){return d.width<=l.video.maxWidth&&d.height<=l.video.maxHeight})).reverse()},RequestPolicyGenerator.prototype.getConstraintsForResolution=function(l,d){var u=l.clone();return u.video.minWidth=d.width,u.video.minHeight=d.height,u},RequestPolicyGenerator.prototype.hasAudioProcessingConstraints=function(l){var d=l&&l.audio;return d&&(void 0!==d.echoCancellation||void 0!==d.autoGainControl||void 0!==d.noiseSuppression)},RequestPolicyGenerator}();d.RequestPolicyGenerator=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.GumStreamProviderFactory=void 0;var p=u(19),h=u(331),g=u(334),f=function(){function GumStreamProviderFactory(){}return GumStreamProviderFactory.getStreamProvider=function(l,d,u){var f=\"Edge\"===(0,p.getBrowserInfo)().name;return\"ScreenShare\"===l?f&&h.ORTCDisplayStreamProvider.isSupported()?new h.ORTCDisplayStreamProvider(u):g.WebRTCDisplayStreamProvider.isSupported()?new g.WebRTCDisplayStreamProvider(u):(u.error(\"GUM stream provider cannot be created for display stream\"),new g.UnsupportedStreamProvider(\"Sharing not supported\")):f?new h.ORTCMediaStreamProvider(u):new g.WebRTCMediaStreamProvider(d,u)},GumStreamProviderFactory}();d.GumStreamProviderFactory=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.GumStreamProviderBase=void 0;var p=u(9),h=u(15),g=u(131),f=function(){function GumStreamProviderBase(l){this.logger=l}return GumStreamProviderBase.isSupported=function(){return!0},GumStreamProviderBase.prototype.getStream=function(l){var d=this.constraintsAdapter.toGumConstraints(l);return this.logger.safe.info(\"Constraints to be applied: \".concat(JSON.stringify((0,p.scrubConstraints)(d)))),new Promise((function(l,u){h.default.window.navigator.getUserMedia(d,l,u)})).catch((function(d){throw new g.MediaStreamErrorDecorator(d,l).getMediaError()}))},GumStreamProviderBase.prototype.applyConstraints=function(l,d){if(!l||!l.getVideoTracks()||!l.getVideoTracks()[0])return Promise.reject(\"No video tracks found\");var u=l.getVideoTracks()[0];return this.applyConstraintsForTrack(u,d)},GumStreamProviderBase.prototype.applyConstraintsForTrack=function(l,d){var u=this.constraintsAdapter.toTrackConstraints(d);return l.applyConstraints?(this.logger.safe.info(\"Apply constraints: \".concat(JSON.stringify(u),\" on \").concat(JSON.stringify(l.id))),l.applyConstraints(u).catch((function(l){throw new g.MediaStreamErrorDecorator(l,d).getMediaError()}))):Promise.reject(\"track.applyConstraints() is not supported\")},GumStreamProviderBase}();d.GumStreamProviderBase=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaStreamErrorDecorator=void 0;var p=u(3),h=u(9),g=u(1),f=function(){function MediaStreamErrorDecorator(l,d){this.error=l,this.constraints=d}return MediaStreamErrorDecorator.prototype.getMediaError=function(){var l;switch(this.error.name){case\"SourceUnavailableError\":case\"TrackStartError\":case\"NotReadableError\":l={type:p.default.MEDIA_ERROR.sourceUnavailableError,detail:\"media device is already used by another process: \".concat(g.stringifyObject(this.error))};break;case\"ConstraintNotSatisfiedError\":case\"OverconstrainedError\":l={type:p.default.MEDIA_ERROR.constraintNotSatisfiedError,detail:\"could not obtain constrained media stream: \".concat(g.stringifyObject(this.error))};break;case\"DevicesNotFoundError\":case\"NotFoundError\":l={type:p.default.MEDIA_ERROR.devicesNotFoundError,detail:\"specified device not found: \".concat(g.stringifyObject(this.error))};break;case\"NotAllowedError\":l=\"Permission denied by system\"===this.error.message?{type:p.default.MEDIA_ERROR.permissionDeniedBySystemError,detail:\"no system permissions: \".concat(g.stringifyObject(this.error))}:{type:p.default.MEDIA_ERROR.permissionDeniedError,detail:\"permission to use media device was denied: \".concat(g.stringifyObject(this.error))};break;case\"PermissionDeniedError\":case\"PermissionDismissedError\":l={type:p.default.MEDIA_ERROR.permissionDeniedError,detail:\"permission to use media device was denied: \".concat(g.stringifyObject(this.error))};break;case p.default.MEDIA_ERROR.extensionNotFoundError:l={type:p.default.MEDIA_ERROR.extensionNotFoundError,detail:\"extension is not found: \".concat(g.stringifyObject(this.error))};break;case p.default.MEDIA_ERROR.chromeRuntimeNotDefinedError:l={type:p.default.MEDIA_ERROR.chromeRuntimeNotDefinedError,detail:\"chrome runtime is not defined: \".concat(g.stringifyObject(this.error))};break;case p.default.MEDIA_ERROR.sharingCancelledError:l=this.getSharingCancelledError(this.error);break;case p.default.MEDIA_ERROR.mediaStreamRequestTimedOut:l={type:p.default.MEDIA_ERROR.mediaStreamRequestTimedOut,detail:\"Media Stream request timed out.\"};break;default:l=this.error.message===p.default.MEDIA_ERROR.sharingCancelledError?this.getSharingCancelledError(this.error):{type:p.default.MEDIA_ERROR.mediaStreamRequestError,detail:\"media stream request error: \".concat(g.stringifyObject(this.error))}}return l.isAudio=!!this.constraints.audio,l.detail+=\" constraints: \".concat(g.stringifyObject((0,h.scrubConstraints)(this.constraints))),l.message=l.detail,l},MediaStreamErrorDecorator.prototype.getSharingCancelledError=function(l){return{type:p.default.MEDIA_ERROR.sharingCancelledError,detail:\"screen sharing cancelled: \".concat(g.stringifyObject(l))}},MediaStreamErrorDecorator}();d.MediaStreamErrorDecorator=f},function(l,d,u){var p;Object.defineProperty(d,\"__esModule\",{value:!0}),d.getDeviceSelectionStrategy=d.SelectionType=void 0,function(l){l[l.Manual=0]=\"Manual\",l[l.Automatic=1]=\"Automatic\"}(p=d.SelectionType||(d.SelectionType={}));var h=function(){function ManualSelectionStrategy(){}return ManualSelectionStrategy.prototype.getSelectedDevice=function(l){return null},ManualSelectionStrategy}(),g=function(){function AutoSelectionStrategy(){}return AutoSelectionStrategy.prototype.getSelectedDevice=function(l){return l&&(l.find((function(l){return l.isSystemDefault}))||l[0])},AutoSelectionStrategy}();function getDeviceSelectionStrategy(l){switch(l){case p.Manual:return new h;case p.Automatic:return new g;default:return null}}d.getDeviceSelectionStrategy=getDeviceSelectionStrategy},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},g=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.ComposedDeviceList=d.EmptyDeviceDebugStrings=void 0;var f=u(7),m=u(3),v=u(1),y=u(17),S=u(345),_=u(346);d.EmptyDeviceDebugStrings={microphone:\"\",camera:\"\",speaker:\"\",compositeAudio:\"\"};var C=function(l){function ComposedDeviceList(u,p){var h=l.call(this)||this;return h.configProvider=u,h.logger=p,h.debugInfo=d.EmptyDeviceDebugStrings,h.lists=new Map,h.lists.set(m.default.MEDIA_DEVICE.microphone,[]),h.lists.set(m.default.MEDIA_DEVICE.camera,[]),h.configProvider.userAgentConfig.isAudioOutputSelectionSupported&&(h.lists.set(m.default.MEDIA_DEVICE.speaker,[]),h.lists.set(m.default.MEDIA_DEVICE.compositeAudio,[])),u.userAgentConfig.on(\"isAudioOutputSelectionSupportedChanged\",(function(){return h.onConfigUpdated()})),h.logger.safe.info(\"Initialized\"),h}return p(ComposedDeviceList,l),Object.defineProperty(ComposedDeviceList.prototype,\"devices\",{get:function(){var l=[];return this.lists.forEach((function(d){return l.push.apply(l,g([],h(d),!1))})),l},enumerable:!1,configurable:!0}),ComposedDeviceList.prototype.updateDevices=function(l,d){if(void 0===d&&(d=!1),!v.deepEqual(this.latestRawList,l)){this.latestRawList=l;var u=this.devices;this.debugInfo.microphone=\"microphone\",this.debugInfo.camera=\"camera\",this.debugInfo.speaker=\"speaker\",this.debugInfo.compositeAudio=\"compositeAudio\",this.updatePrimitiveDeviceList(m.default.MEDIA_DEVICE.microphone,l.filter((function(l){return l.type===m.default.MEDIA_DEVICE.microphone}))),this.updatePrimitiveDeviceList(m.default.MEDIA_DEVICE.camera,l.filter((function(l){return l.type===m.default.MEDIA_DEVICE.camera}))),this.lists.get(m.default.MEDIA_DEVICE.speaker)&&(this.updatePrimitiveDeviceList(m.default.MEDIA_DEVICE.speaker,l.filter((function(l){return l.type===m.default.MEDIA_DEVICE.speaker}))),this.lists.get(m.default.MEDIA_DEVICE.compositeAudio)&&this.updateCompositeAudioDeviceList(this.lists.get(m.default.MEDIA_DEVICE.microphone),this.lists.get(m.default.MEDIA_DEVICE.speaker)));var p=this.lists.get(m.default.MEDIA_DEVICE.compositeAudio)||[];this.lists.set(m.default.MEDIA_DEVICE.microphone,this.orderDeviceList(this.lists.get(m.default.MEDIA_DEVICE.microphone),p)),this.lists.get(m.default.MEDIA_DEVICE.speaker)&&this.lists.set(m.default.MEDIA_DEVICE.speaker,this.orderDeviceList(this.lists.get(m.default.MEDIA_DEVICE.speaker),p));var h=this.lists.get(m.default.MEDIA_DEVICE.microphone);this.setTopItemToDefault(h);var g=this.lists.get(m.default.MEDIA_DEVICE.speaker);this.setTopItemToDefault(g),v.deepEqual(u,this.devices)||(this.logger.safe.info(\"Device lists updated and changed\"),this.logger.safe.info(this.debugInfo.microphone),this.logger.safe.info(this.debugInfo.camera),this.logger.safe.info(this.debugInfo.speaker),this.logger.safe.info(this.debugInfo.compositeAudio),this.event(\"onDevicesChanged\").raise(this.devices,d))}},ComposedDeviceList.prototype.updateActiveMicrophone=function(l){if(l&&l.deviceId!==m.default.MEDIA_DEVICE.defaultId){var d=this.lists.get(m.default.MEDIA_DEVICE.microphone),u=d.findIndex((function(l){return l.isSystemDefault}));-1!==u&&d[u]!==l?(this.logger.safe.info(\"Removing synthetic default microphone\"),l.isSystemDefault=!0,d.splice(u,1),this.lists.set(m.default.MEDIA_DEVICE.microphone,d),this.event(\"onDevicesChanged\").raise(this.devices,!1)):l.isSystemDefault=!0}},ComposedDeviceList.prototype.updatePrimitiveDeviceList=function(l,d){var u={str:this.debugInfo[l]};this.lists.set(l,(0,S.compilePrimitiveDeviceList)(l,d,this.lists.get(l)||[],this.configProvider,u)),this.debugInfo[l]=u.str},ComposedDeviceList.prototype.updateCompositeAudioDeviceList=function(l,d){var u={str:this.debugInfo.compositeAudio};this.lists.set(m.default.MEDIA_DEVICE.compositeAudio,(0,_.compileAudioDeviceList)(l,d,this.configProvider.config.devices.compositeLabelMatchingThreshold,u)),this.debugInfo.compositeAudio=u.str},ComposedDeviceList.prototype.orderDeviceList=function(l,d){var u=this;return l.sort((function(l,p){return u.getDevicePriority(p,u.getCompositeAudioDeviceCounterpart(p,d))-u.getDevicePriority(l,u.getCompositeAudioDeviceCounterpart(l,d))}))},ComposedDeviceList.prototype.getCompositeAudioDeviceCounterpart=function(l,d){var u=d.find((function(d){return d.micDeviceId===l.guid||d.speakerDeviceId===l.guid}));return u?u[l.type===m.default.MEDIA_DEVICE.speaker?\"micDevice\":\"speakerDevice\"]:null},ComposedDeviceList.prototype.getDevicePriority=function(l,d){var u=0;return this.configProvider.config.devices.overrideDefault&&d&&(!l.isSystemDefault&&d.isSystemDefault?(this.debugInfo[l.type]+=\"|overrideDefault(\".concat(y.scrubMriOrOmit(l.guid),\")\"),u+=10):l.isSystemDefault&&!d.isSystemDefault&&\"microphone\"===l.type&&(u+=15)),l.isSystemDefault&&(u+=5),d&&(u+=1,d.isSystemDefault&&(u+=2)),u},ComposedDeviceList.prototype.setTopItemToDefault=function(l){l&&l.length&&(l.forEach((function(l){return l.isSystemDefault=!1})),l[0].isSystemDefault=!0)},ComposedDeviceList.prototype.onConfigUpdated=function(){var l=!1;this.configProvider.userAgentConfig.isAudioOutputSelectionSupported?this.lists.has(m.default.MEDIA_DEVICE.speaker)||(this.lists.set(m.default.MEDIA_DEVICE.speaker,[]),this.lists.set(m.default.MEDIA_DEVICE.compositeAudio,[]),l=!0):(this.lists.has(m.default.MEDIA_DEVICE.speaker)&&(this.lists.delete(m.default.MEDIA_DEVICE.speaker),l=!0),this.lists.has(m.default.MEDIA_DEVICE.compositeAudio)&&(this.lists.delete(m.default.MEDIA_DEVICE.compositeAudio),l=!0)),l&&(this.logger.safe.info(\"Updating device list due to config update\"),this.updateDevices(this.latestRawList||[]))},ComposedDeviceList}(f.default);d.ComposedDeviceList=C},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=function(){function MediaLegId(){}return MediaLegId.prototype.process=function(l){return this.mediaLegId=l||this.mediaLegId||p.uniqueId().toUpperCase(),this.mediaLegId},MediaLegId}();d.default=h},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0});var g=function(){function RelayManagerStatisticsDecorator(l,d){this.relayManager=l,this.diagnostics=d}return RelayManagerStatisticsDecorator.prototype.initialize=function(){},RelayManagerStatisticsDecorator.prototype.queryRelaysAsync=function(l){return p(this,void 0,void 0,(function(){var d;return h(this,(function(u){switch(u.label){case 0:return[4,this.relayManager.queryRelaysAsync(l)];case 1:return(d=u.sent()).length>0&&(this.diagnostics.relay=d[0]),[2,d]}}))}))},RelayManagerStatisticsDecorator.prototype.getStats=function(){var l,d,u;return null!==(u=null===(d=(l=this.relayManager).getStats)||void 0===d?void 0:d.call(l))&&void 0!==u?u:{unavailable:\"1\"}},RelayManagerStatisticsDecorator}();d.default=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function ReconnectManagerMessageQueue(l){this.initialCallbacks=l,this.queueCallbacks={onTerminated:this.genCallback(this.initialCallbacks.onTerminated),onSessionErrorOccurred:this.genCallback(this.initialCallbacks.onSessionErrorOccurred),onNegotiationRequired:this.genCallback(this.initialCallbacks.onNegotiationRequired),onAudioStateChanged:this.genCallback(this.initialCallbacks.onAudioStateChanged),onAudioHwSilentChanged:this.genCallback(this.initialCallbacks.onAudioHwSilentChanged),onTransportDisconnected:this.genCallback(this.initialCallbacks.onTransportDisconnected),onTransportConnected:this.genCallback(this.initialCallbacks.onTransportConnected),onTransportInitialized:this.genCallback(this.initialCallbacks.onTransportInitialized),onTransportFailed:this.genCallback(this.initialCallbacks.onTransportFailed),onUpdateMediaDescriptions:this.genCallback(this.initialCallbacks.onUpdateMediaDescriptions)},this.queue=[]}return ReconnectManagerMessageQueue.prototype.flush=function(){this.queue.forEach((function(l){l.method.apply(null,l.args)})),this.clear()},ReconnectManagerMessageQueue.prototype.clear=function(){this.queue=[]},ReconnectManagerMessageQueue.prototype.genCallback=function(l){var d=this;return function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];return d.queue.push({method:l,args:u})}},ReconnectManagerMessageQueue}();d.default=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SessionDiagnosticsWrapper=void 0;var p=function(){function SessionDiagnosticsWrapper(l,d){this.stats=l,this.diagnostics=d}return Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"mediaLegId\",{set:function(l){this.stats.setMediaLegId(l.process()),this.diagnostics&&(this.diagnostics.mediaLegId=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"isMultiParty\",{set:function(l){l&&this.stats.setMultiParty(),this.diagnostics&&(this.diagnostics.isMultiParty=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"allowedModalities\",{set:function(l){this.stats.setSendModalities(l),this.diagnostics&&(this.diagnostics.allowedModalities=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"sessionError\",{set:function(l){this.stats.setError(l),this.diagnostics&&(this.diagnostics.sessionError=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"finalAnswerTime\",{set:function(l){this.stats.setFinalAnswerTimestamp(l),this.diagnostics&&(this.diagnostics.finalAnswerTime=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"dtmfResult\",{set:function(l){this.stats.dtmfResult(l),this.diagnostics&&(this.diagnostics.dtmfResult=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"swMute\",{set:function(l){this.stats.setSwMute(l),this.diagnostics&&(this.diagnostics.swMute=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"speakerMute\",{set:function(l){this.stats.setSpeakerMute(l),this.diagnostics&&(this.diagnostics.speakerMute=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"hwSilent\",{set:function(l){this.stats.setHwSilent(l),this.diagnostics&&(this.diagnostics.hwSilent=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"isSpeaking\",{set:function(l){this.stats.setSpeakingState(l),this.diagnostics&&(this.diagnostics.isSpeaking=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"iceConnectedStateTimestamp\",{set:function(l){this.stats.setIceConnectedStateTimestamp(l),this.diagnostics&&(this.diagnostics.iceConnectedStateTimestamp=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"iceInitTime\",{set:function(l){this.stats.setIceInitTimestamp(l),this.diagnostics&&(this.diagnostics.iceInitTime=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"ETag\",{set:function(l){this.stats.setETag(l),this.diagnostics&&(this.diagnostics.ETag=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"configIds\",{set:function(l){this.stats.setConfigIds(l),this.diagnostics&&(this.diagnostics.configIds=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnosticsWrapper.prototype,\"relay\",{set:function(l){this.stats.setRelay(l),this.diagnostics&&(this.diagnostics.relay=l)},enumerable:!1,configurable:!0}),SessionDiagnosticsWrapper.prototype.negotiationStart=function(l){var d;switch(null===(d=this.diagnostics)||void 0===d||d.negotiationStart(l),l){case\"Offering\":this.stats.negotiation.offering.started();break;case\"Answering\":this.stats.negotiation.answering.started()}},SessionDiagnosticsWrapper.prototype.negotiationCompleted=function(){var l;this.stats.negotiation.current.completed(),null===(l=this.diagnostics)||void 0===l||l.negotiationCompleted()},SessionDiagnosticsWrapper.prototype.negotiationRejected=function(){var l;this.stats.negotiation.current.rejected(),null===(l=this.diagnostics)||void 0===l||l.negotiationRejected()},SessionDiagnosticsWrapper.prototype.registerTransportConnected=function(){var l;this.stats.registerTransportConnected(),null===(l=this.diagnostics)||void 0===l||l.registerTransportConnected()},SessionDiagnosticsWrapper.prototype.registerTransportDisconnected=function(){var l;this.stats.registerTransportDisconnected(),null===(l=this.diagnostics)||void 0===l||l.registerTransportDisconnected()},SessionDiagnosticsWrapper.prototype.registerTransportFailed=function(){var l;this.stats.registerTransportFailed(),null===(l=this.diagnostics)||void 0===l||l.registerTransportFailed()},SessionDiagnosticsWrapper.prototype.registerRollbackEvent=function(l){var d;this.stats.registerRollbackEvent(l),null===(d=this.diagnostics)||void 0===d||d.registerRollbackEvent(l)},SessionDiagnosticsWrapper.prototype.registerRawMediaAccess=function(l,d,u){var p;\"send\"===d?this.stats.registerSetInputRawMedia(u):this.stats.registerOutputRawMediaAccess(),null===(p=this.diagnostics)||void 0===p||p.registerRawMediaAccess(l,d,u)},SessionDiagnosticsWrapper.prototype.registerQualityStateChangedEvent=function(l){var d;this.stats.registerQualityStateChangedEvent(l),null===(d=this.diagnostics)||void 0===d||d.registerQualityStateChangedEvent(l)},SessionDiagnosticsWrapper.prototype.terminated=function(l){var d;this.stats.terminated(l),null===(d=this.diagnostics)||void 0===d||d.terminated(l)},SessionDiagnosticsWrapper}();d.SessionDiagnosticsWrapper=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(13),h=u(30),g=u(29),f=function(){function SessionOperationQueue(l){this.logger=l,this.operationQueue=null,this.currentOperationDeferred=null,this.operationQueue=new h.PromiseQueue(this.logger)}return SessionOperationQueue.prototype.queueOperation=function(l,d){var u=this;void 0===d&&(d=(0,p.generateCauseId)()),this.logger.safe.info(\"[\".concat(d,\"] queueing operation\"));var h=new g.SettablePromise,f=this.operationQueue.add((function(){return u.currentOperationDeferred=h,l()}),d);return this.operationQueue.add(h,d),f},SessionOperationQueue.prototype.completeCurrentOperation=function(){this.currentOperationDeferred&&(this.logger.safe.info(\"completing operation\"),this.currentOperationDeferred.resolve())},SessionOperationQueue}();d.default=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.DSHGeneratingStrategy=void 0;var p=u(1),h=function(){function Source(l){this.id=l,this.startTimestamp=0,this.totalTime=0}return Source}(),g=function(){function DSHGeneratingStrategy(l){this.sources=[],this.configProvider=l.configProvider,this.ping=this.setupTimer()}return DSHGeneratingStrategy.prototype.setSources=function(l){var d=this;void 0===l&&(l=[]);var u=l.map(this.getOrCreateSource.bind(this)),p=this.excludeSources(this.sources,u);u.filter((function(l){return!d.isAlreadyActive(l)})).forEach(this.updateSourceTimestamp),p.forEach((function(l){d.updateTotalTime(l),d.resetStartTimestamp(l)})),this.ping||(this.ping=this.setupTimer())},DSHGeneratingStrategy.prototype.setOnDominantSpeakerChanged=function(l){this.callback=l},DSHGeneratingStrategy.prototype.dispose=function(){this.clearTimer(),this.sources=null,this.callback=null},DSHGeneratingStrategy.prototype.excludeSources=function(l,d){return l.filter((function(l){return!d.some((function(d){return l.id===d.id}))}))},DSHGeneratingStrategy.prototype.trigger=function(){var byTotalTimeDescending=function(l,d){return d.totalTime-l.totalTime},toSourceId=function(l){return l.id};if(this.hasAnyoneSpoken()){var l=this.sources.map(this.updateTotalTime).sort(byTotalTimeDescending).map(toSourceId);l.length&&!p.deepEqual(this.candidates,l)&&(this.candidates=l,this.callback&&this.callback(l,!1)),this.sources.map(this.resetTotalTime).filter(this.isAlreadyActive).forEach(this.updateSourceTimestamp)}else this.clearTimer()},DSHGeneratingStrategy.prototype.isAlreadyActive=function(l){return!!l.startTimestamp},DSHGeneratingStrategy.prototype.setupTimer=function(){return window.setInterval(this.trigger.bind(this),this.configProvider.config.activeSpeaker.timeToPromote)},DSHGeneratingStrategy.prototype.clearTimer=function(){this.ping&&(clearInterval(this.ping),this.ping=null)},DSHGeneratingStrategy.prototype.getOrCreateSource=function(l){if(this.isExist(l))return this.sourceById(l);var d=new h(l);return this.sources.push(d),d},DSHGeneratingStrategy.prototype.isExist=function(l){return this.sources.some((function(d){return l===d.id}))},DSHGeneratingStrategy.prototype.hasAnyoneSpoken=function(){return this.sources.some((function(l){return 0!==l.startTimestamp||0!==l.totalTime}))},DSHGeneratingStrategy.prototype.sourceById=function(l){return this.sources.find((function(d){return l===d.id}))},DSHGeneratingStrategy.prototype.updateSourceTimestamp=function(l){l.startTimestamp=Date.now()},DSHGeneratingStrategy.prototype.updateTotalTime=function(l){return l.startTimestamp&&(l.totalTime+=Date.now()-l.startTimestamp),l},DSHGeneratingStrategy.prototype.resetStartTimestamp=function(l){return l.startTimestamp=0,l},DSHGeneratingStrategy.prototype.resetTotalTime=function(l){return l.totalTime=0,l},DSHGeneratingStrategy}();d.DSHGeneratingStrategy=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},g=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},f=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},m=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SessionStreamsProvider=void 0;var v=u(8),y=u(7),S=u(28),_=u(141),C=u(49),E=u(1),T=function(l){function SessionStreamsProvider(d,u,p){var h,g=l.call(this)||this;return g.deviceManager=d,g.serialQueue=u,g.logger=p,g.mediaStreams=((h={}).Audio=null,h.Video=null,h.ScreenShare=null,h),g.streamSubscriptions=new Map,g.deviceManagerSubscriptions=[],g.currentMediaTypes=[],g.isNullAudioStream=!1,g}return p(SessionStreamsProvider,l),Object.defineProperty(SessionStreamsProvider.prototype,\"streams\",{get:function(){return this.mediaStreams},enumerable:!1,configurable:!0}),SessionStreamsProvider.prototype.useNullAudioStreamClient=function(){this.isNullAudioStream=!0},SessionStreamsProvider.prototype.start=function(l){return f(this,void 0,void 0,(function(){var d,u=this;return m(this,(function(p){switch(p.label){case 0:return d=E.keys(l).filter((function(d){return l[d]})),E.deepEqual(d,this.currentMediaTypes)?(this.logger.safe.info(\"Requested modalities have not changed. Do nothing\"),[2,S.Helper.sendStreamsToModalities(this.streams)]):(this.currentMediaTypes=d,this.logger.safe.info(\"Starting media session with modalities: \".concat(JSON.stringify(l))),[4,this.updateStreams(this.currentMediaTypes)]);case 1:return p.sent(),this.subscribeOnDeviceManagerEvents(this.deviceManager),this.currentMediaTypes=E.keys(this.streams).filter((function(l){return!!u.streams[l]})),[2,S.Helper.sendStreamsToModalities(this.streams)]}}))}))},SessionStreamsProvider.prototype.stop=function(){return f(this,void 0,void 0,(function(){var l=this;return m(this,(function(d){return this.logger.safe.info(\"Stopping streams\"),this.unsubscribeFromDeviceManagerEvents(),E.keys(this.mediaStreams).forEach((function(d){return l.removeStreamByType(d)})),this.currentMediaTypes=[],[2]}))}))},SessionStreamsProvider.prototype.dispose=function(){this.stop(),l.prototype.dispose.call(this)},SessionStreamsProvider.prototype.updateStreams=function(l){return f(this,void 0,void 0,(function(){var d,u,p,h,g,y=this;return m(this,(function(S){switch(S.label){case 0:return d=this.getAvailableMediaTypes(),u=v.intersection(l,d),p=E.keys(this.mediaStreams).filter((function(l){return y.mediaStreams[l]})),h=E.subtractFrom(u,p),g=E.subtractFrom(p,u),this.logger.safe.info(\"Adding media streams for types: \".concat(JSON.stringify(h))),[4,Promise.all(h.map((function(l){return f(y,void 0,void 0,(function(){return m(this,(function(d){switch(d.label){case 0:return[4,this.addStream(l,!1)];case 1:return d.sent(),this.mediaStreams[l]&&this.event(\"onStreamAdded\").raise(l),[2]}}))}))})))];case 1:return S.sent(),this.logger.safe.info(\"Removing media streams for types: \".concat(JSON.stringify(g))),g.forEach((function(l){y.event(\"onStreamRemoving\").raise(l),y.removeStreamByType(l)})),[2]}}))}))},SessionStreamsProvider.prototype.getAvailableMediaTypes=function(){var l=this.deviceManager.getSelectedDevices(),d=[];return l.microphone&&d.push(\"Audio\"),l.camera&&d.push(\"Video\"),d.push(\"ScreenShare\"),d},SessionStreamsProvider.prototype.addStream=function(l,d){return f(this,void 0,void 0,(function(){var u,p;return m(this,(function(h){switch(h.label){case 0:if(this.mediaStreams[l])return this.logger.safe.warn(\"Stream with type: \".concat(l,\" is already registered\")),[2];u=this.getStream(l,d),this.subscribeOnMediaStreamEvents(u),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,u.start()];case 2:return h.sent(),[3,4];case 3:return p=h.sent(),this.logger.safe.error(\"Media stream request error: \".concat(JSON.stringify(p))),this.event(\"onStreamError\").raise(l,p),[2];case 4:return this.mediaStreams[l]=u,[2]}}))}))},SessionStreamsProvider.prototype.removeStreamByType=function(l){var d=this.mediaStreams[l];d?(this.unsubscribeFromMediaStreamEvents(d),d.dispose(),this.mediaStreams[l]=null):this.logger.safe.warn(\"Stream with type: \".concat(l,\" is not registered\"))},SessionStreamsProvider.prototype.updateStream=function(l,d){return f(this,void 0,void 0,(function(){return m(this,(function(u){switch(u.label){case 0:return this.removeStreamByType(l),[4,this.addStream(l,d)];case 1:return u.sent(),this.event(\"onStreamUpdated\").raise(l),[2]}}))}))},SessionStreamsProvider.prototype.subscribeOnMediaStreamEvents=function(l){var d=this;if(!this.streamSubscriptions.has(l)){var u=[];u.push(l.on(\"onStreamClientError\",(function(l,u){return d.onStreamError(l,u)}))),u.push(l.on(\"onStreamClientDisposing\",(function(l){return d.onStreamDisposing(l)}))),this.streamSubscriptions.set(l,u)}},SessionStreamsProvider.prototype.unsubscribeFromMediaStreamEvents=function(l){this.streamSubscriptions.has(l)&&(this.streamSubscriptions.get(l).forEach((function(l){return l.dispose()})),this.streamSubscriptions.delete(l))},SessionStreamsProvider.prototype.getStream=function(l,d){var u=this.mediaStreams[l];return u?(this.logger.safe.info(\"Stream exists with id: \".concat(u.id,\", type: \").concat(l)),u):this.getStreamByMediaType(l,d)},SessionStreamsProvider.prototype.getStreamByMediaType=function(l,d){switch(l){case\"Audio\":return this.isNullAudioStream?new _.NullStreamClient(\"Audio\",this.logger.createChild(\"NullStreamClient\")):this.deviceManager.getAudioStream(d,\"sessionStream\");case\"Video\":return this.deviceManager.getVideoStream(d,\"sessionStream\");case\"ScreenShare\":return this.deviceManager.getDisplayStream(!!this.streams.Audio,\"sessionStream\");default:throw new Error(\"Media type is not supported: \".concat(l))}},SessionStreamsProvider.prototype.getMediaTypeForStream=function(l){var d=this,u=E.keys(this.mediaStreams).find((function(u){return d.mediaStreams[u]===l}));return u||this.logger.safe.error(\"Media type is not found for stream: \".concat(l)),u},SessionStreamsProvider.prototype.subscribeOnDeviceManagerEvents=function(l){var d=this;0===this.deviceManagerSubscriptions.length&&(this.deviceManagerSubscriptions.push(l.on(\"onSelectedDevicesChanged\",(function(l,u){return d.onSelectedDevicesChanged(l,u)}))),this.deviceManagerSubscriptions.push(l.on(\"onStreamUpdateRequested\",(function(l){return d.requestStreamUpdate(l,!1)}))))},SessionStreamsProvider.prototype.unsubscribeFromDeviceManagerEvents=function(){0!==this.deviceManagerSubscriptions.length&&(this.deviceManagerSubscriptions.forEach((function(l){return l.dispose()})),this.deviceManagerSubscriptions=[])},SessionStreamsProvider.prototype.getMediaTypesToUpdate=function(l,d){var u=[];return this.currentMediaTypes.some((function(l){return\"Audio\"===l}))&&l.microphone&&l.microphone!==d.microphone&&u.push(\"Audio\"),this.currentMediaTypes.some((function(l){return\"Video\"===l}))&&l.camera&&l.camera!==d.camera&&u.push(\"Video\"),u},SessionStreamsProvider.prototype.removeStream=function(l){var d=this.getMediaTypeForStream(l);this.removeStreamByType(d)},SessionStreamsProvider.prototype.onSelectedDevicesChanged=function(l,d){return f(this,void 0,void 0,(function(){var u,p=this;return m(this,(function(h){switch(h.label){case 0:return u=this.getMediaTypesToUpdate(l,d),this.logger.safe.info(\"Media types to update: \".concat(JSON.stringify(u))),[4,Promise.all(u.map((function(l){return p.updateStream(l,!1)})))];case 1:return h.sent(),[2]}}))}))},SessionStreamsProvider.prototype.requestStreamUpdate=function(l,d){return f(this,void 0,void 0,(function(){return m(this,(function(u){return this.currentMediaTypes.some((function(d){return d===l}))?[2,this.updateStream(l,d)]:(this.logger.safe.debug(\"Stream with media type: \".concat(l,\" is not active. Do nothing\")),[2])}))}))},SessionStreamsProvider.prototype.onStreamError=function(l,d){this.removeStream(l)},SessionStreamsProvider.prototype.onStreamDisposing=function(l){this.removeStream(l)},h([(0,C.sequentialize)(),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],SessionStreamsProvider.prototype,\"start\",null),h([(0,C.sequentialize)(),g(\"design:type\",Function),g(\"design:paramtypes\",[]),g(\"design:returntype\",Promise)],SessionStreamsProvider.prototype,\"stop\",null),h([(0,C.sequentialize)(),g(\"design:type\",Function),g(\"design:paramtypes\",[Object,Object]),g(\"design:returntype\",Promise)],SessionStreamsProvider.prototype,\"onSelectedDevicesChanged\",null),h([(0,C.sequentialize)(),g(\"design:type\",Function),g(\"design:paramtypes\",[String,Boolean]),g(\"design:returntype\",Promise)],SessionStreamsProvider.prototype,\"requestStreamUpdate\",null),SessionStreamsProvider}(y.default);d.SessionStreamsProvider=T},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.NullStreamClient=void 0;var h=function(l){function NullStreamClient(d,u){var p=l.call(this)||this;return p.logger=u,p.id=-1,p.parentId=-1,p.rawStream=null,p.rawTrack=null,p.deviceId=null,p.mediaType=d,p}return p(NullStreamClient,l),NullStreamClient.prototype.start=function(){return this.logger.safe.debug(\"start\"),Promise.resolve()},NullStreamClient.prototype.clone=function(){return this.logger.safe.debug(\"clone\"),this},NullStreamClient.prototype.setMuted=function(l,d){this.logger.safe.debug(\"setMuted\")},NullStreamClient.prototype.setHold=function(l){this.logger.safe.debug(\"setHold\")},NullStreamClient.prototype.getResolution=function(){return this.logger.safe.debug(\"getResolution\"),{width:240,height:180}},NullStreamClient.prototype.getFrameRate=function(){return this.logger.safe.debug(\"getFrameRate\"),1},NullStreamClient.prototype.hasAudio=function(){return this.logger.safe.debug(\"hasAudio\"),!1},NullStreamClient.prototype.hasVideo=function(){return this.logger.safe.debug(\"hasVideo\"),!1},NullStreamClient.prototype.isSameStream=function(l){return this.logger.safe.debug(\"isSameStream\"),l===this},NullStreamClient.prototype.applyCapabilities=function(l){return this.logger.safe.debug(\"applyCapabilities\"),Promise.resolve(!1)},NullStreamClient.prototype.onApplyConstraints=function(l){this.logger.safe.debug(\"onApplyConstraints\")},NullStreamClient.prototype.update=function(l){this.logger.safe.debug(\"update\")},NullStreamClient.prototype.isActive=function(){return!1},NullStreamClient}(u(7).default);d.NullStreamClient=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MBPS_VALUES=void 0;var p=u(3),h=u(42),g=u(1);d.MBPS_VALUES=[2812,4218,8437,16875,33750,67500,108e3,135e3,198e3,244800,27e4,352500,52e4];var f=function(){function VideoCapabilities(l,d,u){this.initialMaxFS=l,this.initialMaxFPS=d,this.h264SubscribeProfile=u,this.maxFS=l,this.maxFPS=d}return VideoCapabilities.prototype.setMaxFS=function(l,d){return!(this.maxFS===l||(this.maxFS=l,!d))&&(d(this),!0)},VideoCapabilities.prototype.getMaxFS=function(){return this.maxFS},VideoCapabilities.prototype.getMaxFPS=function(){return this.maxFPS},VideoCapabilities.prototype.getMaxMBPS=function(){return this.calculateMbps(this.maxFS,this.maxFPS)},VideoCapabilities.prototype.calculateMbps=function(l,u){var p=l*u/100;return g.getClosestValue(d.MBPS_VALUES,p,!0)},VideoCapabilities.prototype.resetToInitial=function(){this.maxFS=this.initialMaxFS,this.maxFPS=this.initialMaxFPS},VideoCapabilities.prototype.buildFmtp=function(){var l=h.default.build();return l.setIfMissing(p.default.VIDEO_CAPABILITIES.MAX_FS_PATH,this.getMaxFS().toString()),l.setIfMissing(p.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH,this.getMaxMBPS().toString()),l.setIfMissing(p.default.VIDEO_CAPABILITIES.MAX_FPS_PATH,this.getMaxFPS().toString()),this.h264SubscribeProfile&&l.setIfMissing(\"profile-level-id\",this.h264SubscribeProfile),l.toString()},VideoCapabilities}();d.default=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.DTMFQueue=void 0;var p=function(){function DTMFQueue(l){this.queue=[],this.logger=l}return DTMFQueue.prototype.cleanup=function(){this.queue.forEach((function(l){l.reject({notSent:l.tones})})),this.queue=[]},DTMFQueue.prototype.waitForNotification=function(l){var d=this;return l?(this.logger.unsafe.info(\"sending dtmf tones: \",l),new Promise((function(u,p){d.queue.push({tones:l,resolve:u,reject:p})}))):Promise.reject(new Error(\"invalid input\"))},DTMFQueue.prototype.toneSent=function(l){this.queue[0]&&(l===this.queue[0].tones[0]?(this.queue[0].tones=this.queue[0].tones.substr(1),\"\"===this.queue[0].tones&&(this.queue[0].resolve(),this.queue.shift())):(this.queue[0].reject(new Error(\"sent tone does not match: expected '\".concat(this.queue[0].tones[0],\"' got '\").concat(l,\"'\"))),this.queue.shift(),this.toneSent(l)))},DTMFQueue}();d.DTMFQueue=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoSizeTracker=void 0;var h=u(7),g=u(15),f=function(l){function VideoSizeTracker(d,u,p,h){var f=l.call(this)||this;return f.videoElement=d,f.minInterval=u,f.maxInterval=p,f.window=g.default.window,f.devicePixelRatio=h&&window.devicePixelRatio||1,f.originalVideoElementSize={width:d.offsetWidth,height:d.offsetHeight},f.initializeSizeTracking(),f}return p(VideoSizeTracker,l),Object.defineProperty(VideoSizeTracker.prototype,\"width\",{get:function(){return this.originalVideoElementSize.width*this.devicePixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(VideoSizeTracker.prototype,\"height\",{get:function(){return this.originalVideoElementSize.height*this.devicePixelRatio},enumerable:!1,configurable:!0}),VideoSizeTracker.prototype.initializeSizeTracking=function(){var l=this,d=Math.floor(Math.random()*Math.abs(this.maxInterval-this.minInterval))+this.minInterval;this.elementSizeTrackingRef=this.window.setInterval((function(){l.videoElementSizeChanged()&&(l.saveCurrentVideoElementSize(),l.raiseChanged())}),d)},VideoSizeTracker.prototype.triggerVideoElementSizeChange=function(){this.originalVideoElementSize.height&&this.originalVideoElementSize.width&&this.raiseChanged()},VideoSizeTracker.prototype.dispose=function(){this.elementSizeTrackingRef&&this.window.clearInterval(this.elementSizeTrackingRef)},VideoSizeTracker.prototype.videoElementSizeChanged=function(){return this.originalVideoElementSize.width!==this.videoElement.offsetWidth||this.originalVideoElementSize.height!==this.videoElement.offsetHeight},VideoSizeTracker.prototype.saveCurrentVideoElementSize=function(){this.originalVideoElementSize.width=this.videoElement.offsetWidth,this.originalVideoElementSize.height=this.videoElement.offsetHeight},VideoSizeTracker}(h.default);d.VideoSizeTracker=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=function(){function ReceiveStreamCollection(l){this.streams=[],this.listener=l}return ReceiveStreamCollection.prototype.add=function(l){this.streams.some((function(d){return d.getId()===l.getId()}))||(this.streams.push(l),this.listener.streamAdded(l))},ReceiveStreamCollection.prototype.remove=function(l){var d;p.remove(this.streams,(function(u){return u.getId()===l&&(d=u,!0)}))&&this.listener.streamRemoved(d)},ReceiveStreamCollection.prototype.getStreams=function(){return this.streams},ReceiveStreamCollection.prototype.clear=function(){this.streams.forEach((function(l){return l.dispose()})),this.streams=[]},ReceiveStreamCollection}();d.default=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},g=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SubscriptionManager=void 0;var f=u(13),m=u(147),v=u(7),y=u(1),S=u(51),_=function(){function SubscriptionClient(l){this.subscription=l}return SubscriptionClient.prototype.getMsi=function(){return this.checkDisposed(),this.subscription.getMsi()},SubscriptionClient.prototype.getModality=function(){return this.checkDisposed(),this.subscription.getModality()},SubscriptionClient.prototype.onMediaStreamChanged=function(l){this.checkDisposed(),this.mediaStreamChanged=l,this.subscription.isStreamReady()&&this.notifyMediaStreamChanged()},SubscriptionClient.prototype.onError=function(l){this.checkDisposed(),this.error=l},SubscriptionClient.prototype.dispose=function(){this.subscription&&(this.subscription.dispose((0,f.generateCauseId)(),this),this.subscription=null)},SubscriptionClient.prototype.disposeNow=function(){this.subscription&&(this.subscription.disposeNow(),this.subscription=null)},SubscriptionClient.prototype.notifyMediaStreamChanged=function(){if(this.mediaStreamChanged){var l=this.subscription.getStream(),d=this.subscription.isStreamReady();this.mediaStreamChanged(l&&d?l.getMediaStream():null)}},SubscriptionClient.prototype.notifyError=function(l){this.error&&this.error(l)},SubscriptionClient.prototype.checkDisposed=function(){if(!this.subscription)throw new Error(\"subscription disposed\")},SubscriptionClient}(),C=function(l){function Subscription(d,u,p){var h=l.call(this)||this;return h.modality=d,h.msi=u,h.disposeTimeout=p,h.clients=[],h.streamReady=!1,h}return p(Subscription,l),Subscription.prototype.client=function(){var l=new _(this);return this.clients.push(l),l},Subscription.prototype.getMsi=function(){return this.msi},Subscription.prototype.getStream=function(){return this.stream},Subscription.prototype.isStreamReady=function(){return this.streamReady},Subscription.prototype.getModality=function(){return this.modality},Subscription.prototype.setStream=function(l){var d=this;try{if(l===this.stream)return;this.stream&&(this.releaseStream(),this.notifyStreamChanged()),this.stream=l,l&&(this.streamReady=!1,l.requestSource(this.msi).then((function(){d.streamReady=!0,d.notifyStreamChanged()})).catch((function(l){d.notifyError(l)})))}catch(l){this.event(\"onFailed\").raise(this,l)}},Subscription.prototype.notifyError=function(l){this.clients.forEach((function(d){d.notifyError(l)})),this.event(\"onFailed\").raise(this,l)},Subscription.prototype.disposeIfInactive=function(){this.clients.length||this.disposeNow()},Subscription.prototype.dispose=function(l,d){var u=this;d?(y.remove(this.clients,(function(l){return l===d})),this.clients.length||setTimeout((function(){return u.disposeIfInactive()}),this.disposeTimeout)):(this.clients=[],this.disposeNow())},Subscription.prototype.disposeNow=function(){this.releaseStream(),this.event(\"onDisposed\").raise(this)},Subscription.prototype.notifyStreamChanged=function(){this.clients.forEach((function(l){return l.notifyMediaStreamChanged()})),this.event(\"onStreamChanged\").raise()},Subscription.prototype.releaseStream=function(){this.stream&&(this.stream.requestSource(S.MediaSourceIdentifiers.SourceNone).catch((function(){})),this.streamReady=!1,this.stream=null)},Subscription}(v.default),E=function(l){function SubscriptionManager(d,u){var p=l.call(this)||this;return p.videoSubscriptions=[],p.subscriptionEvents=new Map,p.logger=d.logger,p.configProvider=d.configProvider,p.diagnostics=d.diagnostics||new m.SubscriptionManagerDiagnostics(p.configProvider,(function(){})),p.setStreamProvider(u),p.logger.safe.info(\"created\"),p}return p(SubscriptionManager,l),SubscriptionManager.prototype.setStreamProvider=function(l){var d=this;this.streamProvider=l,this.streamProvider.onStreamsChanged((function(){return d.streamsChanged()}))},SubscriptionManager.prototype.subscribeVideo=function(l,d){var u=this;void 0===d&&(d=S.MediaSourceIdentifiers.SourceAny);var p=this.videoSubscriptions.find((function(u){return u.getMsi()===d&&u.getModality()===l}));if(!p){var h=Date.now();this.disposeInactiveSubscriptions(),this.logger.safe.info(\"creating new subscription #\".concat(d,\" for modality \").concat(l)),this.event(\"onSubscriptionChanged\").raise(1,l,d),this.diagnostics.addSubscribe(l,d),p=new C(l,d,this.configProvider.config.webrtcVideoSubscriptionDisposeTimeout);var g=[];g.push(p.on(\"onDisposed\",(function(l){return u.onSubscriptionDisposed(l)}))),g.push(p.on(\"onStreamChanged\",(function(){if(u.updateTrackIds(),p.isStreamReady()){var g=Date.now();u.event(\"onSubscriptionChanged\").raise(2,l,d,g-h),u.diagnostics.addSubscribed(l,d,g-h)}}))),g.push(p.on(\"onFailed\",(function(l,d){return u.onSubscriptionFailed(l,d)}))),this.subscriptionEvents.set(p,g),this.videoSubscriptions.push(p);var f=this.getAvailableStream(l);f&&this.assignStream(p,f)}return p.client()},SubscriptionManager.prototype.dispose=function(){var d=(0,f.generateCauseId)();this.videoSubscriptions.concat().forEach((function(l){return l.dispose(d)})),this.streamProvider.onStreamsChanged(null),l.prototype.dispose.call(this),this.logger.safe.info(\"disposed\")},SubscriptionManager.prototype.reriseSubscribeEvents=function(){var l=this;this.logger.safe.debug(\"rerising subscription events: \".concat(this.videoSubscriptions.length));var d=[];this.videoSubscriptions.forEach((function(u){l.event(\"onSubscriptionChanged\").raise(1,u.getModality(),u.getMsi()),l.diagnostics.addSubscribe(u.getModality(),u.getMsi()),d.push.apply(d,g([],h(l.getSubscriptionVideoTrackIds(u)),!1))})),this.diagnostics.subscribedTrackIds=d},SubscriptionManager.prototype.setDiagnostics=function(l){this.diagnostics=l},SubscriptionManager.prototype.disposeInactiveSubscriptions=function(){this.videoSubscriptions.concat().forEach((function(l){l.getStream()&&l.disposeIfInactive()}))},SubscriptionManager.prototype.streamsChanged=function(){var l=this;this.logger.safe.info(\"streams changed, subscriptions active: \".concat(this.videoSubscriptions.length)),this.videoSubscriptions.forEach((function(d){var u=!d.getStream()||l.isStreamRemoved(d.getStream());if(l.logger.safe.info(\"Subscription for \".concat(d.getModality(),\" \").concat(d.getMsi(),\" needs new stream: \").concat(u)),u){var p=l.getAvailableStream(d.getModality());p?l.assignStream(d,p):l.resignStream(d)}}))},SubscriptionManager.prototype.getAvailableStream=function(l){return this.streamProvider.getStreams().find((function(d){return l===d.getModality()&&d.getMsi()===S.MediaSourceIdentifiers.SourceNone}))},SubscriptionManager.prototype.isStreamRemoved=function(l){return!this.streamProvider.getStreams().some((function(d){return d===l}))},SubscriptionManager.prototype.assignStream=function(l,d){this.logger.safe.info(\"assigning stream #\".concat(d.getId(),\" to subscription #\").concat(l.getMsi())),l.setStream(d)},SubscriptionManager.prototype.resignStream=function(l){l.getStream()&&(this.logger.safe.info(\"removing stream from subscription #\".concat(l.getMsi())),l.setStream(null))},SubscriptionManager.prototype.onSubscriptionDisposed=function(l){var d=(0,f.generateCauseId)();this.event(\"onSubscriptionChanged\").raise(3,l.getModality(),l.getMsi()),this.diagnostics.addUnsubscribe(l.getModality(),l.getMsi()),this.logger.safe.info(\"disposing subscription for \".concat(l.getModality(),\" #\").concat(l.getMsi())),y.remove(this.videoSubscriptions,(function(d){return d===l})),this.streamsChanged(),this.updateTrackIds(),this.subscriptionEvents.has(l)&&(this.subscriptionEvents.get(l).forEach((function(l){return l.dispose(d)})),this.subscriptionEvents.delete(l))},SubscriptionManager.prototype.updateTrackIds=function(){var l=this,d=[],u=[];this.videoSubscriptions.forEach((function(p){var f;if(p.isStreamReady()){var m=null===(f=p.getStream())||void 0===f?void 0:f.getId().split(\"-\")[1];u.push(m),d.push.apply(d,g([],h(l.getSubscriptionVideoTrackIds(p)),!1))}})),this.event(\"onTrackIdsChanged\").raise(d),this.diagnostics.subscribedTrackIds=d,this.configProvider.config.subscribeToSsrcForVideo&&this.event(\"onTrackSsrcChanged\").raise(u)},SubscriptionManager.prototype.getSubscriptionVideoTrackIds=function(l){var d,u;return null!==(u=null===(d=null==l?void 0:l.getStream())||void 0===d?void 0:d.getMediaStream().getVideoTracks().map((function(l){return l.id})))&&void 0!==u?u:[]},SubscriptionManager.prototype.onSubscriptionFailed=function(l,d){this.event(\"onSubscriptionFailed\").raise(-1,l.getModality(),l.getMsi(),d),this.diagnostics.addFailed(l.getModality(),l.getMsi(),y.stringifyObject(d))},SubscriptionManager}(v.default);d.SubscriptionManager=E},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SubscriptionManagerDiagnostics=void 0;var p=u(3),h=u(1),g=function(){function SubscriptionManagerDiagnostics(l,d){this.configProvider=l,this.addStatsError=d,this.data={events:{video:[],sharing:[]},subscribedTrackIds:[]}}return Object.defineProperty(SubscriptionManagerDiagnostics.prototype,\"subscribedTrackIds\",{set:function(l){this.data.subscribedTrackIds=l},enumerable:!1,configurable:!0}),SubscriptionManagerDiagnostics.prototype.addSubscribe=function(l,d){this.pushToEventBag(l,{evt:1,msi:d,ts:Date.now()})},SubscriptionManagerDiagnostics.prototype.addSubscribed=function(l,d,u){this.pushToEventBag(l,{evt:2,msi:d,ts:Date.now(),duration:u})},SubscriptionManagerDiagnostics.prototype.addUnsubscribe=function(l,d){this.pushToEventBag(l,{evt:3,msi:d,ts:Date.now()})},SubscriptionManagerDiagnostics.prototype.addFailed=function(l,d,u){this.pushToEventBag(l,{evt:-1,msi:d,ts:Date.now(),error:u})},SubscriptionManagerDiagnostics.prototype.getObjectRef=function(){return this.data},SubscriptionManagerDiagnostics.prototype.pushToEventBag=function(l,d){switch(l){case p.default.MEDIA_TYPE.video:h.arrayPushFixedSize(this.data.events.video,d,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents);break;case p.default.MEDIA_TYPE.sharing:h.arrayPushFixedSize(this.data.events.sharing,d,this.configProvider.config.diagnostics.collectionLimits.numSubscriptionEvents);break;default:return void this.addStatsError(\"Unsupported modality \".concat(l))}},SubscriptionManagerDiagnostics}();d.SubscriptionManagerDiagnostics=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.StatisticsPoller=void 0;var f=u(7),m=u(15),v=u(1),y=u(381),S=u(149),_=function(l){function StatisticsPoller(d,u,p,h,g){var f=l.call(this)||this;return f.logger=d,f.configProvider=u,f.diagnostics=p,f.mediaManager=h,f.window=m.default.window,f.useNewStatsApi=f.configProvider.config.webrtcUseNewStatsApi&&f.configProvider.mediaConfig.simulcastSessionEnabled,f.gathererV1=new S.StatisticsGatherer(f.logger.createChild(\"V1\"),f.configProvider,f.mediaManager,g),f.gathererV1.on(\"onStatisticsChanged\",(function(l){return f.event(\"onStatisticsChanged\").raise(l)})),f.gathererV1.on(\"onRawStatisticsChanged\",(function(l){return f.event(\"onRawStatisticsChanged\").raise(l)})),f.useNewStatsApi&&u.config.diagnostics.sideBySide&&(f.gathererV2=new y.StatisticsGathererV2(f.logger.createChild(\"V2\"),f.configProvider,f.diagnostics,f.mediaManager)),f}return p(StatisticsPoller,l),StatisticsPoller.prototype.initialize=function(l){var d,u=this;this.pc=l,this.gathererV1.initialize(l),null!==(d=this.interval)&&void 0!==d||(this.interval=this.window.setInterval((function(){return u.processStats()}),this.configProvider.config.webrtcStatPollInterval))},StatisticsPoller.prototype.dispose=function(){l.prototype.dispose.call(this),this.interval&&(this.window.clearInterval(this.interval),this.interval=void 0),this.gathererV1.dispose(),this.pc=void 0},Object.defineProperty(StatisticsPoller.prototype,\"isDisposed\",{get:function(){return!this.pc&&void 0===this.interval},enumerable:!1,configurable:!0}),StatisticsPoller.prototype.processStats=function(){var l;return h(this,void 0,void 0,(function(){var d,u,p,h,f,m,y=this;return g(this,(function(g){switch(g.label){case 0:return this.pc&&\"closed\"!==this.pc.iceConnectionState?this.useNewStatsApi?(d=v.hptime(),u=void 0===this.loopTimer?-1:d-this.loopTimer,this.loopTimer=d,p={},[4,this.pc.getStats()]):[3,2]:[2];case 1:return g.sent().forEach((function(l){var d=l.type;delete l.type,p[d]=p[d]||{},p[d][l.id]=l})),h=v.hptime()-d,f=null===(l=this.gathererV2)||void 0===l?void 0:l.processRawReport(p),m=v.hptime(),this.gathererV1.processRawReport(p),m=v.hptime()-m,(null==f?void 0:f.perfCounters)&&(f.perfCounters.loopTime=u,f.perfCounters.fetchTime=h,f.perfCounters.legacyProcessingTime=m),[3,3];case 2:this.pc.getStats((function(l){l.result&&y.gathererV1.processLegacyReport(l)})),g.label=3;case 3:return[2]}}))}))},Object.defineProperty(StatisticsPoller.prototype,\"sessionInfo\",{get:function(){return this.gathererV1.sessionInfo},enumerable:!1,configurable:!0}),StatisticsPoller.prototype.setReportedSendBandwidth=function(l){this.gathererV1.setReportedSendBandwidth(l)},StatisticsPoller.prototype.onMaxCapabilitiesApplied=function(l){this.gathererV1.onMaxCapabilitiesApplied(l)},StatisticsPoller.prototype.clearIceCandidateErrors=function(){this.gathererV1.clearIceCandidateErrors()},StatisticsPoller.prototype.setSsrcTrackPair=function(l,d){var u;this.gathererV1.setSsrcTrackPair(l,d),null===(u=this.gathererV2)||void 0===u||u.setSsrcTrackPair(l,d)},StatisticsPoller.prototype.addSubscriptionEvent=function(l,d,u,p,h){this.gathererV1.addSubscriptionEvent(l,d,u,p,h)},StatisticsPoller.prototype.setSubscribedTrackSsrc=function(l){this.gathererV1.setSubscribedTrackSsrc(l)},StatisticsPoller.prototype.addIceCandidateError=function(l){this.gathererV1.addIceCandidateError(l)},StatisticsPoller.prototype.setH264AvailableProfiles=function(l){this.gathererV1.setH264AvailableProfiles(l)},StatisticsPoller.prototype.setTerminated=function(){this.gathererV1.setTerminated()},StatisticsPoller.prototype.onDeviceEvent=function(l){this.gathererV1.onDeviceEvent(l)},StatisticsPoller.prototype.getLastKnownReport=function(l,d){return void 0===d&&(d=!1),this.gathererV1.getLastKnownReport(l,d)},StatisticsPoller.prototype.getReport=function(l){return this.gathererV1.getReport(l)},StatisticsPoller.prototype.startWaitingForStreamStart=function(l){this.gathererV1.startWaitingForStreamStart(l)},StatisticsPoller.prototype.getLastStatistics=function(){return this.gathererV1.getLastStatistics()},StatisticsPoller.prototype.updateSendStream=function(l,d){this.gathererV1.updateSendStream(l,d)},StatisticsPoller.prototype.setSubscribedTrackIds=function(l){this.gathererV1.setSubscribedTrackIds(l)},StatisticsPoller.prototype.setMaxSessionBandwidth=function(l){this.gathererV1.setMaxSessionBandwidth(l)},StatisticsPoller.prototype.updateStatsWithLocalSsrcTrackInfo=function(){this.gathererV1.updateStatsWithLocalSsrcTrackInfo()},StatisticsPoller.prototype.onSendersChanged=function(l,d){this.gathererV1.onSendersChanged(l,d)},StatisticsPoller.prototype.setPreferredResolution=function(l,d,u){this.gathererV1.setPreferredResolution(l,d,u)},StatisticsPoller.prototype.setTimeToFirstFrame=function(l,d){this.gathererV1.setTimeToFirstFrame(l,d)},StatisticsPoller.prototype.setFreezeDuration=function(l,d){this.gathererV1.setFreezeDuration(l,d)},StatisticsPoller.prototype.addVideoControlMessage=function(l){this.gathererV1.addVideoControlMessage(l)},StatisticsPoller.prototype.setSessionDataChannelState=function(l){this.gathererV1.setSessionDataChannelState(l)},StatisticsPoller.prototype.recordDataChannelCreationFailure=function(l){this.gathererV1.recordDataChannelCreationFailure(l)},StatisticsPoller.prototype.onMaxCapabilitiesRequested=function(l){this.gathererV1.onMaxCapabilitiesRequested(l)},StatisticsPoller.prototype.recordDataChannelProtocolEvent=function(l){this.gathererV1.recordDataChannelProtocolEvent(l)},StatisticsPoller.prototype.addReportedReceiveBandwidth=function(l){this.gathererV1.addReportedReceiveBandwidth(l)},StatisticsPoller}(f.default);d.StatisticsPoller=_},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.StatisticsGatherer=d.unwrapResults=d.TRACK_ID=d.VIDEO_FRAME_RATE_RECEIVED=d.VIDEO_FRAME_RATE_DECODED=void 0;var g=u(7),f=u(15),m=u(1),v=u(9),y=u(386),S=u(387),_=u(388),C=\"VideoBwe\",E=\"bweforvideo\",T=\"googAvailableReceiveBandwidth\",b=\"googAvailableSendBandwidth\",I=\"mediaType\",A=\"framesDecoded\";d.VIDEO_FRAME_RATE_DECODED=\"googFrameRateDecoded\",d.VIDEO_FRAME_RATE_RECEIVED=\"googFrameRateReceived\";var R=\"googFrameRateInput\";function unwrapResults(l){var d={};return l.result().forEach((function(l){l.names().forEach((function(u){d[l.type]=d[l.type]||{},d[l.type][l.id]=d[l.type][l.id]||{},d[l.type][l.id][u]=l.stat(u)})),d[l.type][l.id].id=l.id})),d}d.TRACK_ID=\"googTrackId\",d.unwrapResults=unwrapResults;var P=function(l){function StatisticsGatherer(d,u,p,h){var g=l.call(this)||this;return g.logger=d,g.configProvider=u,g.mediaManager=p,g.window=f.default.window,g._sessionInfo=new S.default,g.statisticsMapper=new y.default,g.useNewStatsApi=g.configProvider.config.webrtcUseNewStatsApi&&g.configProvider.mediaConfig.simulcastSessionEnabled,g.webRtcStatistics=new _.default(g.logger.createChild(\"WebrtcStatistics\"),g._sessionInfo,g.configProvider,p,h,g.useNewStatsApi),g}return p(StatisticsGatherer,l),Object.defineProperty(StatisticsGatherer.prototype,\"sessionInfo\",{get:function(){return this._sessionInfo},enumerable:!1,configurable:!0}),Object.defineProperty(StatisticsGatherer.prototype,\"isDisposed\",{get:function(){return null===this.pc&&0===this.interval},enumerable:!1,configurable:!0}),StatisticsGatherer.prototype.initialize=function(l){this.pc=l},StatisticsGatherer.prototype.startWaitingForStreamStart=function(l,d){void 0===d&&(d=!1),this.webRtcStatistics.startWaitingForStreamStart(l,d)},StatisticsGatherer.prototype.onDeviceEvent=function(l){this.webRtcStatistics.onDeviceEvent(l)},StatisticsGatherer.prototype.onMaxCapabilitiesRequested=function(l){this.webRtcStatistics.onMaxCapabilitiesRequested(l)},StatisticsGatherer.prototype.onMaxCapabilitiesApplied=function(l){this.webRtcStatistics.onMaxCapabilitiesApplied(l)},StatisticsGatherer.prototype.onSendersChanged=function(l,d){this.webRtcStatistics.setStreamSenderStarted(l,d)},StatisticsGatherer.prototype.addSubscriptionEvent=function(l,d,u,p,h){this.webRtcStatistics.addSubscriptionEvent(l,d,u,p,h)},StatisticsGatherer.prototype.setSubscribedTrackIds=function(l){this.webRtcStatistics.setSubscribedTrackIds(l)},StatisticsGatherer.prototype.setSubscribedTrackSsrc=function(l){this.webRtcStatistics.setSubscribedTrackSsrc(l)},StatisticsGatherer.prototype.setPreferredResolution=function(l,d,u){this.webRtcStatistics.setPreferredResolution(l,d,u)},StatisticsGatherer.prototype.setReportedSendBandwidth=function(l){this.webRtcStatistics.setReportedSendBandwidth(l)},StatisticsGatherer.prototype.setMaxSessionBandwidth=function(l){this.webRtcStatistics.setMaxSessionBandwidth(l)},StatisticsGatherer.prototype.setTerminated=function(){this.webRtcStatistics.setTerminated()},StatisticsGatherer.prototype.addIceCandidateError=function(l){this.webRtcStatistics.addIceCandidateError(l)},StatisticsGatherer.prototype.clearIceCandidateErrors=function(){this.webRtcStatistics.clearIceCandidateErrors()},StatisticsGatherer.prototype.recordDataChannelProtocolEvent=function(l){this.webRtcStatistics.recordDataChannelProtocolEvent(l)},StatisticsGatherer.prototype.setSessionDataChannelState=function(l){this.webRtcStatistics.setSessionDataChannelState(l)},StatisticsGatherer.prototype.recordDataChannelCreationFailure=function(l){this.webRtcStatistics.recordDataChannelCreationFailure(l)},StatisticsGatherer.prototype.updateSendStream=function(l,d){this.webRtcStatistics.updateSendStream(l,d)},StatisticsGatherer.prototype.setH264AvailableProfiles=function(l){if(l&&l.codecs){var d=[];l.codecs.forEach((function(l){if(\"h264\"===l.mimeType&&l.sdpFmtpLine){var u=/profile-level-id=(.{6})/.exec(l.sdpFmtpLine);u&&u[1]&&(d=d.concat(u[1]))}})),this.webRtcStatistics.addH264AvailableProfiles(d)}},StatisticsGatherer.prototype.processRawReport=function(l){this.processStatsDict(this.statisticsMapper.build(l))},StatisticsGatherer.prototype.processLegacyReport=function(l){this.processStatsDict(unwrapResults(l))},StatisticsGatherer.prototype.getReport=function(l){var d=this;return this.processStatistics().then((function(){return d.getLastKnownReport(l)}))},StatisticsGatherer.prototype.getLastKnownReport=function(l,d){void 0===d&&(d=!1);var u=this.webRtcStatistics.getReport(l,d);return this.addStreamInfoForE2ETests(u),u},StatisticsGatherer.prototype.dispose=function(){this.interval&&(this.window.clearInterval(this.interval),this.interval=0),this.pc=null},StatisticsGatherer.prototype.getLastStatistics=function(){return this.statistics},StatisticsGatherer.prototype.setTimeToFirstFrame=function(l,d){this.webRtcStatistics.setTimeToFirstFrame(l,d)},StatisticsGatherer.prototype.setFreezeDuration=function(l,d){this.webRtcStatistics.setFreezeDuration(l,d)},StatisticsGatherer.prototype.addVideoControlMessage=function(l){void 0===l&&(l=!1),this.webRtcStatistics.addVideoControlMessage(l)},StatisticsGatherer.prototype.setSsrcTrackPair=function(l,d){this.statisticsMapper.setSsrcTrackPair(l,d)},StatisticsGatherer.prototype.updateStatsWithLocalSsrcTrackInfo=function(){var l,d;try{for(var u=h(this.mediaManager.getMediaEntities()),p=u.next();!p.done;p=u.next()){var g=p.value,f=g.getLocalSsrc();f&&this.statisticsMapper.setSsrcTrackPair(f,g.getLocalTrackId())}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}},StatisticsGatherer.prototype.addReportedReceiveBandwidth=function(l){this.webRtcStatistics.addReportedReceiveBandwidth(l)},StatisticsGatherer.prototype.addStreamInfoForE2ETests=function(l){var d=this._sessionInfo.negotiatedModalities;if(d)try{l.localStreams=this.getSendersReport(this.pc.getSenders(),{audio:v.hasSendDirectionality(d.audio),video:v.hasSendDirectionality(d.video)}),l.remoteStreams=this.getReceiversReport(this.pc.getReceivers(),{audio:v.hasReceiveDirectionality(d.audio),video:v.hasReceiveDirectionality(d.video)})}catch(l){this.logger.safe.warn(\"addStreamInfoForE2ETests failed: \".concat(m.stringifyObject(l)))}},StatisticsGatherer.prototype.getReceiversReport=function(l,d){var u=[];return l.forEach((function(l){var p={tracks:[]};u.push(p),l.track&&(\"audio\"===l.track.kind&&d.audio||\"video\"===l.track.kind&&d.video)&&p.tracks.push({stream:void 0,track:l.track})})),u},StatisticsGatherer.prototype.getSendersReport=function(l,d){var u=[],p={tracks:[]};return u.push(p),l.forEach((function(l){l.track&&(\"audio\"===l.track.kind&&d.audio||\"video\"===l.track.kind&&d.video)&&p.tracks.push({stream:void 0,track:l.track})})),u},StatisticsGatherer.prototype.processStatistics=function(){var l=this;return new Promise((function(d){l.pc&&\"closed\"!==l.pc.iceConnectionState?l.useNewStatsApi?l.pc.getStats().then((function(u){u.size<1||l.processStatsDict(l.unwrapNewApiResults(u)),d()})).catch((function(u){l.logger.safe.warn(\"getStats failed: \".concat(m.stringifyObject(u))),d()})):l.pc.getStats((function(u){u.result?(l.processStatsDict(unwrapResults(u)),d()):d()})):d()}))},StatisticsGatherer.prototype.unwrapNewApiResults=function(l){var d={};return l.forEach((function(l){d[l.type]=d[l.type]||{},d[l.type][l.id]=l})),this.statisticsMapper.build(d)},StatisticsGatherer.prototype.processStatsDict=function(l){var u=this;this.webRtcStatistics.processStatsDict(l);var p=0,h=0,g=l[C]?l[C][E]:null;g&&(p=Number(g[T]),h=Number(g[b]));var f=1e3*((this.configProvider.mediaConfig.maxBandwidthInKbps||Math.floor(Number.MAX_SAFE_INTEGER/1e3))-(this.configProvider.config.audioBandwidthInKbps||0)),v=isNaN(p)?0:p,y=isNaN(h)?0:h,S={estimatedReceiveBandwidth:Math.min(v,f),estimatedSendBandwidth:Math.min(y,f),remoteVideoStreams:{},localVideoStreams:{},isSpeaking:this.webRtcStatistics.getSpeakingState(),audioHwSilent:this.webRtcStatistics.getAudioHwSilent(),networkSendLevel:this.webRtcStatistics.getNetworkSendLevel(),networkRecvLevel:this.webRtcStatistics.getNetworkRecvLevel()};m.forOwn(l.ssrc,(function(l){if(\"video\"===l[I]){var p=l[d.TRACK_ID],h=l.id;-1!==h.indexOf(\"_recv\")?(S.remoteVideoStreams[p]={trackId:p,frameRateReceived:Number(l[d.VIDEO_FRAME_RATE_RECEIVED]),frameRateDecoded:Number(l[d.VIDEO_FRAME_RATE_DECODED]),framesDecoded:Number(l[A])},u.configProvider.config.isRenderingBasedOnRawStatistics||(S.remoteVideoStreams[p].isRendering=u.webRtcStatistics.getIsRendering(h))):p&&-1!==h.indexOf(\"_send\")&&(S.localVideoStreams[p]={trackId:p,ssrc:Number(l.ssrc),frameRateInput:Number(l[R])})}})),this.notifyRawStatisticsChanged(l),m.deepEqual(this.statistics,S)||(this.statistics=S,this.notifyStatisticsChanged())},StatisticsGatherer.prototype.notifyRawStatisticsChanged=function(l){this.event(\"onRawStatisticsChanged\").raise(l)},StatisticsGatherer.prototype.notifyStatisticsChanged=function(){this.event(\"onStatisticsChanged\").raise(this.statistics)},StatisticsGatherer}(g.default);d.StatisticsGatherer=P},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.AudioStreamAnalyzer=void 0;var p=u(15),h=u(1),g=function(){function AudioStreamAnalyzer(l){this.audioContext=new p.default.window.AudioContext,this.sourceNode=this.audioContext.createMediaStreamSource(l),this.analyzerNode=this.createAnalyserNode(this.sourceNode)}return AudioStreamAnalyzer.prototype.dispose=function(){this.sourceNode.disconnect(),this.audioContext.close()},AudioStreamAnalyzer.prototype.getInputLevel=function(){var l=new Uint8Array(this.analyzerNode.frequencyBinCount);return this.analyzerNode.getByteFrequencyData(l),Math.floor(65535*(0,h.getAverage)(l)/255)},AudioStreamAnalyzer.prototype.createAnalyserNode=function(l){var d=this.audioContext.createAnalyser();return d.fftSize=1024,d.smoothingTimeConstant=.1,l.connect(d),d},AudioStreamAnalyzer}();d.AudioStreamAnalyzer=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=u(3),g=function(){function WebrtcAudioPacketLossRate(l){void 0===l&&(l=100),this.minPacketsReceivedToCalculatePacketLossRate=l,this.prevPacketLost=0,this.prevPacketReceived=0,this.packetLostRateMax=0,this.totalPacketsLost=0,this.packetsLostDuration=0,this.prevPacketLostForAvgCalculations=0}return WebrtcAudioPacketLossRate.prototype.capturePacketsLostAndPacketsReceived=function(l,d){this.packetsLostDuration+=h.default.TIME_INTERVAL.SEC_1,this.setTotalPacketsLost(l);var u=d-this.prevPacketReceived;if(!(u<this.minPacketsReceivedToCalculatePacketLossRate)){this.prevPacketReceived=d;var g=l-this.prevPacketLost;this.prevPacketLost=l,this.packetLostRateMax=Math.max((0,p.round)(100*g/(g+u),2),this.packetLostRateMax)}},WebrtcAudioPacketLossRate.prototype.getPacketsLostRateMax=function(){return this.packetLostRateMax},WebrtcAudioPacketLossRate.prototype.getAvgPacketsLost=function(){return this.totalPacketsLost?(0,p.round)(this.totalPacketsLost/this.packetsLostDuration,2):0},WebrtcAudioPacketLossRate.prototype.setTotalPacketsLost=function(l){var d=l-this.prevPacketLostForAvgCalculations;d>0&&(this.totalPacketsLost+=d),this.prevPacketLostForAvgCalculations=l},WebrtcAudioPacketLossRate}();d.default=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=u(3),g=u(396),f=u(397),m=u(398),v=u(399),y=u(400),S=u(401),_=u(402),C=u(403),E=u(404),T=u(405),b=u(406),I=u(407),A=u(151),R=function(){function WebRTCVideoTelemetry(l,d,u,p){void 0===p&&(p=\"Video\"),this.startTime=l,this.configProvider=d,this.logger=u,this.mediaType=p,this.subscriptionCounter=0,this.videoFreezeTelemetry=new y.default(this.configProvider,this.startTime),this.videoDelayTelemetry=new v.default,this.videoSubscriptionEvents=new I.default(this.configProvider),this.videoQPEvents=new E.default,this.videoResolutionTelemetry=new T.default,this.videoGeneralTelemetry=new S.default,this.videoStreamsCounters=new b.default,this.videoBitrate=new f.default,this.videoMaxCapabilities=new m.default(this.configProvider,this.logger),this.videoOvershoot=new C.default(this.logger),this.keyFrameStats=new _.WebRTCVideoKeyFrameMonitor(this.configProvider,this.logger),this.videoQualityLimitations=new g.WebRTCQualityLimitationTelemetry(this.configProvider),this.videoPacketLostRate=new A.default(this.configProvider.config.minPacketsReceivedToCalculatePacketLossRate),this.timeToFirstFrame=-1,this.currentTrackId=\"\",this.recvTotalFreezeDurationMs=0}return Object.defineProperty(WebRTCVideoTelemetry.prototype,\"trackId\",{get:function(){return this.currentTrackId},set:function(l){this.currentTrackId=l},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoTelemetry.prototype,\"isRecvDataGatheringEnabled\",{get:function(){return this.subscriptionCounter>0},enumerable:!1,configurable:!0}),WebRTCVideoTelemetry.prototype.startStopRecvDataGathering=function(l){this.logger.safe.info(\"Receive data gathering is \".concat(l?\"enabled\":\"disabled\")),l?this.subscriptionCounter++:this.subscriptionCounter--,this.subscriptionCounter<0&&this.logger.safe.error(\"Subscription counter should not be less than 0. Actual value is \".concat(this.subscriptionCounter)),0===this.subscriptionCounter&&this.stopRecvGathering()},WebRTCVideoTelemetry.prototype.stopDataGathering=function(){this.stopRecvGathering(),this.stopSendGathering()},WebRTCVideoTelemetry.prototype.stopRecvGathering=function(){this.videoFreezeTelemetry.stopRecvDataGathering(),this.videoGeneralTelemetry.stopRecvDataGathering(),this.videoBitrate.stopCapture(h.default.MEDIA_DIRECTION.RECV)},WebRTCVideoTelemetry.prototype.isSendGathering=function(){return this.videoGeneralTelemetry.isGatheringSendData()},WebRTCVideoTelemetry.prototype.stopSendGathering=function(){this.videoGeneralTelemetry.stopSendDataGathering(),this.videoBitrate.stopCapture(h.default.MEDIA_DIRECTION.SEND),this.videoOvershoot.flush(),this.keyFrameStats.flush()},WebRTCVideoTelemetry.prototype.gatherRecvFreezeData=function(l,d,u){this.videoFreezeTelemetry.gatherFreezeData({frameRateDecoded:l,frameRateRecv:d,bytesReceived:u,mediaType:this.mediaType})},WebRTCVideoTelemetry.prototype.detectCaptureFreeze=function(l){this.videoFreezeTelemetry.detectCaptureFreeze(l)},WebRTCVideoTelemetry.prototype.getRecvFreezeDurationCounts=function(){return this.videoFreezeTelemetry.getRecvFreezeDurationCounts()},WebRTCVideoTelemetry.prototype.getRecvFreezeDurationTimestamps=function(){return this.videoFreezeTelemetry.getRecvFreezeDurationTimestamps(this.configProvider.config.maxVideoFreezeTimestampsInBucket)},WebRTCVideoTelemetry.prototype.getRecvTotalFreezeDuration=function(){return this.videoFreezeTelemetry.getRecvTotalFreezeDuration()},WebRTCVideoTelemetry.prototype.setRecvTotalFreezeDurationMs=function(l){this.recvTotalFreezeDurationMs=void 0!==l?this.recvTotalFreezeDurationMs+=l:void 0},WebRTCVideoTelemetry.prototype.analyzeDelay=function(l,d){this.videoDelayTelemetry.analyzeDelay(l,d)},WebRTCVideoTelemetry.prototype.getDelayCur=function(){return this.videoDelayTelemetry.getDelayCur()},WebRTCVideoTelemetry.prototype.getDelayAvg=function(){return this.videoDelayTelemetry.getDelayAvg()},WebRTCVideoTelemetry.prototype.addSubscriptionEvent=function(l){this.videoSubscriptionEvents.addSubscriptionEvent(l)},WebRTCVideoTelemetry.prototype.getSubscriptionEvents=function(){return this.videoSubscriptionEvents.getSubscriptionEvents()},WebRTCVideoTelemetry.prototype.captureQpData=function(l,d,u){this.videoQPEvents.captureQpData(l,d,u)},WebRTCVideoTelemetry.prototype.getQpAverage=function(l){return this.videoQPEvents.getQpAverage(l)},WebRTCVideoTelemetry.prototype.captureMediaData=function(l,d,u){this.videoGeneralTelemetry.captureMediaData(l,d,u)},WebRTCVideoTelemetry.prototype.getIsRendering=function(){var l=this.configProvider.config.notRenderingTimeInterval[\"Video\"===this.mediaType?\"video\":\"sharing\"];return this.videoFreezeTelemetry.getIsRendering(l)},WebRTCVideoTelemetry.prototype.captureFrameRate=function(l){this.videoGeneralTelemetry.captureFrameRate(l)},WebRTCVideoTelemetry.prototype.getTotalDuration=function(l){return this.videoGeneralTelemetry.getTotalDuration(l)},WebRTCVideoTelemetry.prototype.captureResolutionSample=function(l){this.videoResolutionTelemetry.captureSample(l)},WebRTCVideoTelemetry.prototype.countRecvStreams=function(l){this.videoStreamsCounters.countRecvStreams(l)},WebRTCVideoTelemetry.prototype.captureBitrateSample=function(l,d){this.videoBitrate.captureSample(l,d)},WebRTCVideoTelemetry.prototype.captureAllocateBandwidth=function(l){this.videoBitrate.captureAllocateBandwidth(l)},WebRTCVideoTelemetry.prototype.capturePreferredResolution=function(l,d){this.videoResolutionTelemetry.capturePreferredResolution(l,d)},WebRTCVideoTelemetry.prototype.setMaxCapabilitesRequested=function(l,d){void 0===d&&(d=!1),this.videoMaxCapabilities.setMaxCapabilitesRequested(l),d||1===l.capabilities.length&&!l.capabilities[0].ssrc||this.setMaxCapabilitiesOvershoot(l.capabilities)},WebRTCVideoTelemetry.prototype.setMaxCapabilitesApplied=function(l,d){void 0===d&&(d=!1),this.videoMaxCapabilities.setMaxCapabilitesApplied(l),d||1===l.capabilities.length&&!l.capabilities[0].ssrc||this.setMaxCapabilitiesOvershoot(l.capabilities)},WebRTCVideoTelemetry.prototype.getMaxCapabilitiesEvents=function(){var l=this.videoMaxCapabilities.getEvents();return JSON.stringify(l)},WebRTCVideoTelemetry.prototype.setCurrentParameters=function(l,d,u){this.videoOvershoot.setCurrentParams(l,d.height/16*(d.width/16),u)},WebRTCVideoTelemetry.prototype.setMaxCapabilitiesOvershoot=function(l){this.videoOvershoot.setMaxCapabilities(l)},WebRTCVideoTelemetry.prototype.getOvershootEvents=function(){var l=this,d=this.videoOvershoot.getEvents();return(d=d.slice(Math.max(0,d.length-(this.configProvider.config.maxReportedOvershootingEvents+1)),d.length)).forEach((function(d){return d.timestamp=d.timestamp-l.startTime})),JSON.stringify(d)},WebRTCVideoTelemetry.prototype.getOvershootTotalDurations=function(){var l=this,d=this.videoOvershoot.getEvents();return d.forEach((function(d){return d.timestamp=d.timestamp-l.startTime})),JSON.stringify({fs:d.reduce((function(l,d){return\"fs\"===d.overshootType?l+d.duration:l}),0),fps:d.reduce((function(l,d){return\"fps\"===d.overshootType?l+d.duration:l}),0)})},WebRTCVideoTelemetry.prototype.setQualityLimitationReason=function(l){this.videoQualityLimitations.setQualityLimitationReason(l)},WebRTCVideoTelemetry.prototype.getQualityLimitationReasonEvents=function(){return this.videoQualityLimitations.getQualityLimitationReasonEvents()},WebRTCVideoTelemetry.prototype.setKeyFrameRequested=function(l){l&&this.keyFrameStats.setKeyFrameRequested(\"FMTP\")},WebRTCVideoTelemetry.prototype.setKeyFrameData=function(l){this.keyFrameStats.setKeyFrameData(l)},WebRTCVideoTelemetry.prototype.getKeyFrameStats=function(){var l=this.keyFrameStats.getStats();return JSON.stringify(l)},WebRTCVideoTelemetry.prototype.captureTimeToFirstFrame=function(l){-1!==l&&(this.timeToFirstFrame=l)},WebRTCVideoTelemetry.prototype.getTimeToFirstFrame=function(){return this.timeToFirstFrame},WebRTCVideoTelemetry.prototype.capturePacketsLostAndPacketsReceved=function(l,d){this.videoPacketLostRate.capturePacketsLostAndPacketsReceived(l,d)},WebRTCVideoTelemetry.prototype.getReport=function(l,d,u){var g={};if(g[d+\"DurationSeconds\"]=this.getTotalDuration(l),g[d+\"QpAvg\"]=this.getQpAverage(l),g[d+\"frameRateAvg\"]=this.videoGeneralTelemetry.getAvgFrameRate(l),g[d+\"bitrateAvg\"]=this.videoBitrate.getAvg(l),g[d+\"bitrateMax\"]=this.videoBitrate.getMax(l),l===h.default.MEDIA_DIRECTION.SEND)g[d+\"DelayCur\"]=this.getDelayCur(),g[d+\"DelayAvg\"]=this.getDelayAvg(),g[d+\"TimeSinceLastEncodeStart\"]=this.videoGeneralTelemetry.getTimeSinceLastDecode(l),g[d+\"AllocateBWAvg\"]=this.videoBitrate.getAllocateBandwidthAvg(),g[d+\"CaptureFramerateAvg\"]=this.videoGeneralTelemetry.getSendCameraFramerate(),g[d+\"FreezeIntervals\"]=this.videoFreezeTelemetry.getSendCameraFreezeIntervals(),g[d+\"MaxCapabilities\"]=this.getMaxCapabilitiesEvents(),g[d+\"OvershootEvents\"]=this.getOvershootEvents(),g[d+\"OvershootDurations\"]=this.getOvershootTotalDurations(),g[d+\"qualityLimitationReasonEvents\"]=JSON.stringify(this.getQualityLimitationReasonEvents()),u||(g[d+\"KeyFrameStats\"]=this.getKeyFrameStats(),g[d+\"KeyFrameLongestDelay\"]=this.keyFrameStats.getKeyFrameLongestDelay());else if(l===h.default.MEDIA_DIRECTION.RECV){g[d+\"TimeSinceLastDecodeStart\"]=this.videoGeneralTelemetry.getTimeSinceLastDecode(l),g[d+\"FreezeHistogram\"]=this.getRecvFreezeDurationCounts(),g[d+\"FreezeTimestamps\"]=this.getRecvFreezeDurationTimestamps(),g[d+\"LongestFreezeDuration\"]=this.videoFreezeTelemetry.getLongestRecvFreezeDuration(),g[d+\"RecvAvgFreezeDuration\"]=this.videoFreezeTelemetry.getRecvAvgFreezeDuration(),g[d+\"TotalFreezeDuration\"]=this.getRecvTotalFreezeDuration(),g[d+\"TotalFreezeDurationMs\"]=this.recvTotalFreezeDurationMs,g[d+\"OngoingFreeze\"]=this.videoFreezeTelemetry.getRecvFreezeIsOngoing(this.configProvider.config.webrtcEndOfCallFreezeThreshold),g[d+\"NumResolutionSwitches\"]=this.videoResolutionTelemetry.resolutionSwitchCount,g[d+\"PreferredResolution\"]=this.videoResolutionTelemetry.preferredResolution,g[d+\"PreferredResolutionDurations\"]=JSON.stringify(this.videoResolutionTelemetry.preferredResolutionDurationRatios),g[d+\"packetsLostRateMax\"]=this.videoPacketLostRate.getPacketsLostRateMax(),g[d+\"ResolutionDurations\"]=JSON.stringify(this.videoResolutionTelemetry.resolutionDurationRatios);var f=this.videoStreamsCounters.getStreamCounts();g[d+\"StreamsMin\"]=f.min,g[d+\"StreamsMax\"]=f.max,g[d+\"StreamsMode\"]=f.mode,g[d+\"TimeToFirstFrame\"]=this.timeToFirstFrame,g[d+\"FpsHarmonicAverage\"]=(0,p.round)(this.videoGeneralTelemetry.getRecvFpsHarmonicAverage(),2)}return g},WebRTCVideoTelemetry}();d.default=R},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(19),h=u(15),g=u(409),f=u(413);function UnsupportedAdapter(){function throwUnsupported(){throw new Error(\"unsupported platform\")}this.SdpTransform=throwUnsupported,this.RTCPeerConnection=throwUnsupported,this.RTCSessionDescription=throwUnsupported,this.RTCRtpReceiver=throwUnsupported}function isWebkitRtc(){return void 0!==h.default.window.webkitRTCPeerConnection}function isMozillaRtc(){return void 0!==h.default.window.mozRTCPeerConnection}function isRtc(){return void 0!==h.default.window.RTCPeerConnection}function isSafariRtc(){return isRtc()&&\"Safari\"===(0,p.getBrowserInfo)().name}d.default={build:function(l){return isWebkitRtc()?l.unifiedPlanEnabled?new g.default(l):new f.WebkitAdapter(l):isMozillaRtc()||isSafariRtc()?new g.default(l):new UnsupportedAdapter}}},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(47),f=u(48),m=u(15),v=u(27),y=function(){function RTCRtpReceiverCababilities(){}return RTCRtpReceiverCababilities.prototype.getCapabilities=function(l){var d=RTCRtpReceiver.getCapabilities(l);return d.codecs.forEach((function(l){var d=l.mimeType.toLowerCase().split(\"/\");l.mimeType=d[1]||d[0]})),Promise.resolve(d)},RTCRtpReceiverCababilities}(),S=function(){function SdpCababilties(l){this.selfGlobal=l.global.capabilityGatherer=l.global.capabilityGatherer||{},this.getCapabilities(\"video\")}return SdpCababilties.prototype.getCapabilities=function(l){return p(this,void 0,void 0,(function(){var d,u,p,v,y,S,_;return h(this,(function(h){switch(h.label){case 0:if(\"video\"!==l&&\"audio\"!==l)return[2,Promise.reject(new Error(\"capabilities for \".concat(l,\" are not supported\")))];if(this.selfGlobal.gatherTask)return[3,4];d=f.defer(),this.selfGlobal.gatherTask=d.promise,u=void 0!==m.default.window.webkitRTCPeerConnection,p=u?new m.default.window.webkitRTCPeerConnection(null):new m.default.window.RTCPeerConnection(null),v=function(l){return u?new Promise((function(d,u){p.createOffer(d,u,l)})):p.createOffer(l)},h.label=1;case 1:return h.trys.push([1,3,,4]),[4,v({offerToReceiveVideo:1,offerToReceiveAudio:1})];case 2:return y=h.sent(),S={},g.parse(y.sdp).media.forEach((function(l){S[l.type]=l.rtp.map((function(d){var u,p={mimeType:d.codec.toLowerCase()};if(\"video\"===l.type){var h=null===(u=l.fmtp)||void 0===u?void 0:u.find((function(l){return l.payload===d.payload}));p.sdpFmtpLine=null==h?void 0:h.config}return p}))})),p.close(),d.resolve(S),[3,4];case 3:return _=h.sent(),this.selfGlobal.gatherTask=null,p.close(),d.reject(_),[3,4];case 4:return[2,this.selfGlobal.gatherTask.then((function(d){return{codecs:d[l]}}))]}}))}))},SdpCababilties}();d.default={build:function(l,d){return!d&&v.UserAgentConfig.hasCapabilitiesApi()?new y:new S(l)}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(15),h=\"rollback\";function SessionDescription(){var l=[].slice.apply(arguments),d=l[0]&&isRollback(l[0].type);l.splice(0,d?1:0,null);var u=new(Function.prototype.bind.apply(p.default.window.RTCSessionDescription,l)),g=Object.getOwnPropertyDescriptor(p.default.window.RTCSessionDescription.prototype,\"type\");return Object.defineProperty(u,\"type\",{get:function(){return d?h:g.get.call(u)},set:function(l){(d=isRollback(l))||g.set.call(u,l)}}),u}function isRollback(l){return h===l}d.default={build:function(){return SessionDescription}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ContributingSourcesHandler=d.ContributingSourcesHandlerState=void 0;var p,h=u(15);!function(l){l[l.Stopped=0]=\"Stopped\",l[l.Started=1]=\"Started\",l[l.Unsupported=2]=\"Unsupported\"}(p=d.ContributingSourcesHandlerState||(d.ContributingSourcesHandlerState={}));var g=function(){function ContributingSourcesHandler(l){this.context=l,this._state=p.Stopped,this._lastSources=[],this._window=h.default.window,this._logger=l.logger.createChild(\"contributingSources\")}return ContributingSourcesHandler.prototype.startPolling=function(){this._state===p.Stopped&&(this._state=p.Started,this._logger.safe.info(\"polling started\"),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval))},ContributingSourcesHandler.prototype.stopPolling=function(){this._state===p.Started&&(this._timer&&(this._window.clearTimeout(this._timer),this._timer=void 0),this._state=p.Stopped,this._logger.safe.info(\"polling stopped\"))},Object.defineProperty(ContributingSourcesHandler.prototype,\"state\",{get:function(){return this._state},enumerable:!1,configurable:!0}),ContributingSourcesHandler.prototype.poll=function(){var l=this;if(this._state===p.Started){var d=this.context.provider();d?(this.context.activeSpeakerManager.onContributingSourcesChanged(d.filter((function(d){var u=l._lastSources.filter((function(l){return l.source===d.source}))[0];return!u||u.timestamp!==d.timestamp})).map((function(l){return l.source}))),this.updateLastSources(d),this._timer=this._window.setTimeout(this.poll.bind(this),this.context.configProvider.config.webrtcContributingSourcesPollingInterval)):(this._logger.safe.info(\"contributing sources are not supported on this client\"),this._state=p.Unsupported,this.stopPolling())}},ContributingSourcesHandler.prototype.updateLastSources=function(l){var d=this;this._lastSources=[],l.forEach((function(l){d._lastSources.push({source:l.source,timestamp:l.timestamp})}))},ContributingSourcesHandler}();d.ContributingSourcesHandler=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(65),h=u(3),g=u(158),f=u(39),m=function(){function MediaManager(l){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.localSsrcs=new Map,this.ssrcGenerator=new p.SsrcGenerator,this.logger=l.logger.createChild(\"MM\"),this.configProvider=l.configProvider,this.numVideoChannels=l.numVideoChannels}return MediaManager.prototype.fromOffer=function(l,d){var u=this;l.media.forEach((function(l){if(l.type===h.default.MEDIA_TYPE.audio)h.default.MODALITY.audio in d&&u.addMediaEntity(h.default.MODALITY.audio);else if(l.type===h.default.MEDIA_TYPE.video){if(h.default.MODALITY.video in d)for(var p=0;p<u.numVideoChannels;p++)u.addMediaEntity(h.default.MODALITY.video);h.default.MODALITY.sharing in d&&u.addMediaEntity(h.default.MODALITY.sharing)}else l.type===h.default.MEDIA_TYPE.data&&h.default.MODALITY.data in d&&u.addMediaEntity(h.default.MODALITY.data)}))},MediaManager.prototype.fromRemote=function(l,d){var u=this;l.media.forEach((function(l,p){var h=(0,f.getModality)(l);if(0!==l.port&&h in d){if(u.mediaEntities[p]?u.mediaEntities[p].update(h,l.mid||u.generateMid(p)):u.addMediaEntity(h,l.mid||u.generateMid(p)),l.msid)u.mediaEntities[p].setRemoteStreamId(l.msid.split(\" \")[0]),u.mediaEntities[p].setRemoteTrackId(l.msid.split(\" \")[1]);else if(l.ssrcs){var g=l.ssrcs.find((function(l){return\"msid\"===l.attribute}));g?(u.mediaEntities[p].setRemoteStreamId(g.value.split(\" \")[0]),u.mediaEntities[p].setRemoteTrackId(g.value.split(\" \")[1])):u.logger.safe.warn(\"No ssrc msid for media of type \".concat(l.type,\" with mid \").concat(l.mid))}var m=l.xSourceStreamId||u.generateSourceStreamId(p);u.mediaEntities[p].setXSourceStreamId(m)}else u.mediaEntities[p]?u.mediaEntities[p].disable():u.addDisabledMediaEntity(h),u.mediaEntities[p].setRemoteStreamId(null),u.mediaEntities[p].setRemoteTrackId(null)}))},MediaManager.prototype.isEmpty=function(){return 0===this.mediaEntities.length},MediaManager.prototype.addMediaEntity=function(l,d){this.createMediaEntity(l,d||this.generateMid(this.mediaEntities.length))},MediaManager.prototype.addDisabledMediaEntity=function(l){this.createMediaEntity(l)},MediaManager.prototype.getMediaEntities=function(){return this.mediaEntities},MediaManager.prototype.createMediaEntity=function(l,d){var u=g.default.create(this.configProvider,l,d);return this.mediaEntities.push(u),u},MediaManager.prototype.getMediaEntity=function(l){return this.mediaEntities[l]},MediaManager.prototype.getMediaEntityByMid=function(l){return this.mediaEntities.find((function(d){return d.getMid()===l}))},MediaManager.prototype.getMediaEntitiesByModality=function(l){return this.mediaEntities.filter((function(d){return d.getModality()===l}))},MediaManager.prototype.getMediaEntityByRemoteStreamId=function(l){return this.mediaEntities.find((function(d){return d.getRemoteStreamId()===l}))},MediaManager.prototype.getMediaEntityByLocalTrackId=function(l){return this.mediaEntities.find((function(d){return d.getLocalTrackId()===l}))},MediaManager.prototype.getMediaEntityByXSourceStreamId=function(l){return this.mediaEntities.find((function(d){return d.getXSourceStreamId()===l}))},MediaManager.prototype.reset=function(){this.mediaEntities=[]},MediaManager.prototype.syncModalities=function(l,d,u){this.disableModalities(d),u||(this.enableModalities(d),this.addModalities(d))},MediaManager.prototype.enableModalities=function(l){var d=this;this.mediaEntities.forEach((function(u,p){u.getModality()in l&&u.isDisabled()&&u.update(u.getModality(),d.generateMid(p))}))},MediaManager.prototype.disableModalities=function(l){this.mediaEntities.forEach((function(d){d.getModality()in l||d.disable()}))},MediaManager.prototype.addModalities=function(l){var d={};for(var u in this.mediaEntities.map((function(l){return l.getModality()})).forEach((function(l){d[l]=!0})),l)u in d||this.addMediaEntity(u)},MediaManager.prototype.setLocalTracksInfo=function(l){this.mediaTracks=l,this.updateLocalSsrc(this.mediaTracks)},MediaManager.prototype.getLocalTracksInfo=function(){return this.mediaTracks},MediaManager.prototype.getLocalSsrcs=function(){return this.localSsrcs},MediaManager.prototype.updateMediaEntitiesWithLocalTracks=function(){var l=this;this.mediaTracks&&(this.mediaEntities.forEach((function(l){return l.setLocalTrackId(null)})),this.mediaTracks.forEach((function(d){var u=l.getMediaEntitiesByModality(d.modality)[0];u?u.setLocalTrackId(d.trackId):l.logger.safe.error(\"Media entity is not found for modality: \".concat(JSON.stringify(d.modality)))})))},MediaManager.prototype.updateMediaEntitiesWithActivityState=function(l,d){},MediaManager.prototype.backup=function(){var l=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach((function(d){l.mediaEntitiesBackup.push(d.clone())}))},MediaManager.prototype.commit=function(){this.mediaEntitiesBackup=[]},MediaManager.prototype.rollback=function(){this.mediaEntities=this.mediaEntitiesBackup},MediaManager.prototype.generateSourceStreamId=function(l){return l+10},MediaManager.prototype.generateMid=function(l){return\"media_\".concat(l)},MediaManager.prototype.updateLocalSsrc=function(l){var d=this;l.forEach((function(l){if(!d.localSsrcs.get(l.modality)){var u=d.ssrcGenerator.nextVideoStreamSsrc().min;d.logger.safe.debug(\"Ssrc updated for modality: \".concat(l.modality,\": \").concat(u)),d.localSsrcs.set(l.modality,u)}}))},MediaManager}();d.default=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(8),h=u(1),g=u(142),f=u(3),m=u(39),v=function(){function MediaEntity(l,d,u,p){this.entity=l,this.configProvider=d,this.videoCapabilities=u,this.simulcastContext=p}return MediaEntity.getVideoCababilities=function(l,d,u){if(l===f.default.MEDIA_TYPE.video){var p=void 0,h=void 0;return d===f.default.MODALITY.sharing?(p=u.config.webrtcScreensharingCapabilityMaxFS,h=u.config.webrtcScreensharingCapabilityMaxFPS):(p=u.config.webrtcVideoCapabilityMaxFS,h=u.config.webrtcVideoCapabilityMaxFPS),new g.default(p,h,u.config.h264SubscribeProfile)}return null},MediaEntity.create=function(l,d,u){var p=(0,m.getTypeFromModality)(d);return new MediaEntity({modality:d,mid:u,mtype:p,extensions:{}},l,MediaEntity.getVideoCababilities(p,d,l),null)},MediaEntity.prototype.clone=function(){return new MediaEntity((0,p.cloneDeep)(this.entity),this.configProvider,this.videoCapabilities,this.simulcastContext)},MediaEntity.prototype.getModality=function(){return this.entity.modality},MediaEntity.prototype.getType=function(){return this.entity.mtype},MediaEntity.prototype.getMid=function(){return this.entity.mid},MediaEntity.prototype.disable=function(){this.entity.mid=null},MediaEntity.prototype.update=function(l,d){this.entity.modality!==l&&(this.videoCapabilities=MediaEntity.getVideoCababilities(this.entity.mtype,l,this.configProvider)),this.entity.modality=l,this.entity.mid=d,this.isEnabled()&&this.setExtension(\"rollback\",!1)},MediaEntity.prototype.isDisabled=function(){return!this.entity.mid},MediaEntity.prototype.isEnabled=function(){return!!this.entity.mid},MediaEntity.prototype.getVideoCapabilities=function(){return this.videoCapabilities},MediaEntity.prototype.getRemoteStreamId=function(){return this.entity.remoteStreamId},MediaEntity.prototype.setRemoteStreamId=function(l){this.entity.remoteStreamId=l},MediaEntity.prototype.setRemoteSsrc=function(l){this.entity.remoteSsrc=l},MediaEntity.prototype.getRemoteSsrc=function(){return this.entity.remoteSsrc},MediaEntity.prototype.setLocalSsrc=function(l){this.entity.localSsrc=l},MediaEntity.prototype.getLocalSsrc=function(){return this.entity.localSsrc},MediaEntity.prototype.getRemoteTrackId=function(){return this.entity.remoteTrackId},MediaEntity.prototype.setRemoteTrackId=function(l){this.entity.remoteTrackId=l},MediaEntity.prototype.getXSourceStreamId=function(){return this.entity.xSourceStreamId},MediaEntity.prototype.setXSourceStreamId=function(l){this.entity.xSourceStreamId=l},MediaEntity.prototype.setLocalTrackId=function(l){this.entity.localTrackId=l},MediaEntity.prototype.getLocalTrackId=function(){return this.entity.localTrackId},MediaEntity.prototype.getExtension=function(l){return this.entity.extensions[l]},MediaEntity.prototype.setExtension=function(l,d){this.entity.extensions[l]=d},MediaEntity.prototype.getRtpHeaderExtensions=function(){return this.entity.rtpExt},MediaEntity.prototype.setRtpHeaderExtensions=function(l){this.entity.rtpExt=l},MediaEntity.prototype.setSimulcastContext=function(l){this.simulcastContext=l},MediaEntity.prototype.getSimulcastContext=function(){return this.simulcastContext},MediaEntity.prototype.serialize=function(){return(0,h.deepClone)(this.entity)},MediaEntity}();d.default=v},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(47),h=function(){function NegotiationEmulator(l,d,u,p,h){this.logger=l,this.webRtcAdapter=d,this.sessionDescription=u,this.negotiationQueue=p,this.mediaManager=h}return NegotiationEmulator.prototype.dispose=function(){this.peerConnection=null},NegotiationEmulator.prototype.configure=function(l){this.peerConnection=l},NegotiationEmulator.prototype.renegotiateNow=function(){return this.renegotiate(null,!0)},NegotiationEmulator.prototype.renegotiate=function(l,d){if(void 0===d&&(d=!1),!this.peerConnection)throw new Error(\"trying to renegotiate during empty peerConnection\");var u=this.createNegotiationTask(l);return d?(this.logger.safe.info(\"forced local renegotiation starting\"),Promise.resolve(u())):this.negotiationQueue.add(u)},NegotiationEmulator.prototype.normalizeSDESAnswer=function(l,d){var u=p.parse(d),h=p.parse(l);if(u.media[0].crypto)h.media.forEach((function(l){delete l.fingerprint,delete l.setup,l.crypto=l.crypto.filter((function(l){return u.media[0].crypto.some((function(d){return d.id===l.id}))})).slice(0,1)})),h.fingerprint&&delete h.fingerprint;else{var g=this.mediaManager.getMediaEntities().find((function(l){return void 0!==l.getExtension(\"setup\")}));h.media.forEach((function(l){var d=g&&g.getExtension(\"setup\")||\"actpass\";\"actpass\"===l.setup&&(l.setup=\"active\"===d?\"passive\":\"active\")}))}return p.write(h)},NegotiationEmulator.prototype.normalizeExtensionsAnswer=function(l,d){var u=p.parse(d),h=p.parse(l);return h.media.forEach((function(l,d){var p,h,g=new Set((null===(p=u.media[d].ext)||void 0===p?void 0:p.map((function(l){return l.value})))||[]);l.ext=null===(h=l.ext)||void 0===h?void 0:h.filter((function(l){return g.has(l.value)}))})),p.write(h)},NegotiationEmulator.prototype.createNegotiationTask=function(l){var d=this,throwIfNoPeerConnection=function(){if(!d.peerConnection)throw d.logger.safe.warn(\"no peer connection present\"),new Error(\"trying to renegotiate during empty peerConnection\")};return function(){d.logger.safe.debug(\"Local renegotiation starting...\");var u=d.peerConnection.remoteDescription.sdp;u=d.normalizeSDESAnswer(u,d.peerConnection.localDescription.sdp),u=d.normalizeExtensionsAnswer(u,d.peerConnection.localDescription.sdp);var p=new d.webRtcAdapter.RTCSessionDescription({sdp:u,type:\"answer\"});return l&&l.forEach((function(l){p=l.modifyDescriptor(p)})),Promise.resolve().then((function(){return d.logger.safe.debug(\"creating offer\"),throwIfNoPeerConnection(),d.peerConnection.createOffer()})).then((function(l){throwIfNoPeerConnection();var u=d.sessionDescription.createLocalOffer(l.sdp),p=new d.webRtcAdapter.RTCSessionDescription({sdp:u.toLocal(),type:\"offer\"});return d.logger.safe.debug(\"setting local description\"),d.logger.unsafe.debug(\"local description, sdp: \".concat(p.sdp)),d.peerConnection.setLocalDescription(p)})).then((function(){return throwIfNoPeerConnection(),d.logger.safe.debug(\"setting remote description\"),d.logger.unsafe.debug(\"remote description, sdp: \".concat(p.sdp)),d.peerConnection.setRemoteDescription(p)})).then((function(l){return d.logger.safe.debug(\"local renegotiation done\"),l})).catch((function(l){throw d.logger.safe.error(\"local renegotiation failed: \",l.toString()),l}))}},NegotiationEmulator}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=u(3),g=u(416),f=u(418),m=u(161),v=function(){function QualityManager(l,d,u,p,h,g){this.logger=l,this.settings=d,this.listener=u,this.statsGatherer=p,this.diagnostics=h,this.configProvider=g,this.mediaSourceModels=[]}return QualityManager.prototype.dispose=function(){this.mediaSourceModels.forEach((function(l){l.handler&&(l.handler.dispose(),l.handler=null)})),this.mediaSourceModels=null,this.sendBandwidthCalculator&&this.disableSendBandwidthCalculator()},QualityManager.prototype.updateRegisteredSources=function(l){this.logger.safe.info(\"Local media params updated: \".concat(JSON.stringify(l)));var d=[];this.mediaSourceModels.forEach((function(l){return d.push(l.sourceId)}));var u=l.map((function(l){return l.sourceId})),h=p.subtractFrom(d,u);this.removeSourcesWithIds(h);var g=p.subtractFrom(u,d);this.addSourcesWithIds(g,l),this.settings.sendBandwidthNotificationsEnabled&&this.updateSendBandwidthCalculator()},QualityManager.prototype.setMaxCapabilities=function(l){var d=this;return Promise.all(l.map((function(l){if(l.capabilities.length)if(l.sourceId){if(d.isRegistered(l.sourceId)){d.logger.safe.info(\"Capabilities handler found for sourceId: \".concat(l.sourceId));var u=d.getModelWithSourceId(l.sourceId);if(!u)return void d.logger.safe.info(\"Model is not registered for sourceId: \".concat(l.sourceId));var p=d.getOrCreateHandlerForModel(u,l.isSimulcast);return p?p.setMaxCapabilities(l.causeId,l.capabilities):void d.logger.safe.info(\"Handler is not found for sourceId: \".concat(l.sourceId))}d.logger.safe.info(\"Source \".concat(l.sourceId,\" is not registered for receive capabilities\"))}else d.logger.safe.info(\"SourceId is not defined to apply recv capabilities: \".concat(JSON.stringify(l)))}))).then((function(){d.logger.safe.debug(\"Max capabilities application completed\")})).catch((function(l){d.logger.error(\"Max capabilities application error: \".concat(JSON.stringify(l)))}))},QualityManager.prototype.resetCurrentResolution=function(){var l=this.mediaSourceModels.find((function(l){return l.modality===h.default.MODALITY.video}));l&&l.handler&&l.handler.resetCurrentResolution()},QualityManager.prototype.getCurrentResolution=function(){var l=this.mediaSourceModels.find((function(l){return l.modality===h.default.MODALITY.video}));return l&&l.handler?l.handler.getCurrentResolution():this.currentResolution&&this.currentResolution.fs},QualityManager.prototype.setCurrentResolution=function(l){var d=this.mediaSourceModels.find((function(l){return l.modality===h.default.MODALITY.video}));d&&d.handler?d.handler.setCurrentResolution(l):this.currentResolution=l},QualityManager.prototype.getOrCreateHandlerForModel=function(l,d){return l.handler||(l.handler=this.getCapabilitiesHandler(l.modality,d)),l.handler},QualityManager.prototype.addSourcesWithIds=function(l,d){var u=this;l.forEach((function(l){var p=d.find((function(d){return d.sourceId===l}));u.registerSource(l,p.modality)}))},QualityManager.prototype.removeSourcesWithIds=function(l){var d=this;l.forEach((function(l){return d.unregisterSource(l)}))},QualityManager.prototype.registerSource=function(l,d){this.logger.safe.info(\"SourceId \".concat(l,\" registered with mediaType: \").concat(d)),this.mediaSourceModels.push({modality:d,sourceId:l})},QualityManager.prototype.unregisterSource=function(l){var d=this.mediaSourceModels.find((function(d){return d.sourceId===l}));d?(d.handler&&d.handler.dispose(),this.mediaSourceModels.splice(this.mediaSourceModels.indexOf(d),1),this.logger.safe.info(\"SourceId \".concat(l,\" unregistered\"))):this.logger.safe.info(\"Model doesn't exist with sourceId \".concat(l))},QualityManager.prototype.updateSendBandwidthCalculator=function(){this.mediaSourceModels.some((function(l){return[h.default.MODALITY.video,h.default.MODALITY.sharing].indexOf(l.modality)>-1}))?this.enableSendBandwidthCalculator():this.disableSendBandwidthCalculator()},QualityManager.prototype.enableSendBandwidthCalculator=function(){var l=this;this.sendBandwidthCalculator||(this.sendBandwidthCalculator=new m.SendBandwidthCalculator(this.configProvider,this.statsGatherer,this.logger.createChild(\"SendBwCalc\")),this.sendBandwidthCalculatorSubscription=this.sendBandwidthCalculator.on(\"onSendBandwidthChanged\",(function(d){return l.onSendBandwidthChanged(d)})))},QualityManager.prototype.disableSendBandwidthCalculator=function(){this.sendBandwidthCalculatorSubscription&&(this.sendBandwidthCalculatorSubscription.dispose(),this.sendBandwidthCalculatorSubscription=null),this.sendBandwidthCalculator&&(this.sendBandwidthCalculator.dispose(),this.sendBandwidthCalculator=null)},QualityManager.prototype.getModelWithSourceId=function(l){return this.mediaSourceModels.find((function(d){return d.sourceId===l}))},QualityManager.prototype.isRegistered=function(l){return!!this.getModelWithSourceId(l)},QualityManager.prototype.getCapabilitiesHandler=function(l,d){if(l===h.default.MODALITY.audio)return null;if(l===h.default.MODALITY.video&&!d&&this.settings.customBwEstimationEnabled){var u=new g.AdaptiveCapablitiesHandler(this.listener,this.statsGatherer,this.diagnostics,this.logger.createChild(\"ach\"),this.configProvider,this.settings,d);return this.currentResolution&&u.setCurrentResolution(this.currentResolution),u}return new f.DirectCapabilitiesHandler(l,this.listener,this.statsGatherer,this.diagnostics,d)},QualityManager.prototype.onSendBandwidthChanged=function(l){var d=this;return this.listener.onSendBandwidthChanged(l).catch((function(l){d.logger.safe.error(\"Error while reporting send bandwidth change\",l),d.sendBandwidthCalculator.forceUpdate()}))},QualityManager}();d.default=v},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.SendBandwidthCalculator=void 0;var h=function(l){function SendBandwidthCalculator(d,u,p){var h=l.call(this)||this;return h.configProvider=d,h.statsGatherer=u,h.logger=p,h.lastReportedAgo=1/0,h._forceUpdate=!1,h.subs=h.statsGatherer.on(\"onStatisticsChanged\",(function(l){return h.onStatisticsChanged(l)})),h}return p(SendBandwidthCalculator,l),SendBandwidthCalculator.prototype.forceUpdate=function(){this._forceUpdate=!0},SendBandwidthCalculator.prototype.dispose=function(){this.subs.dispose(),this.subs=null},SendBandwidthCalculator.prototype.onStatisticsChanged=function(l){this._forceUpdate?this.updateBandwidth(l.estimatedSendBandwidth,\"forceUpdate\"):this.processEstimatedBandwidth(l.estimatedSendBandwidth)},SendBandwidthCalculator.prototype.processEstimatedBandwidth=function(l){if(this.lastReportedAgo++,l&&this.bandwidth!==l){var d=this.configProvider.config.webrtcSendBandwidthIgnoredUpdateLimit,u=this.configProvider.config.webrtcSendBandwidthThreshold,p=this.lastReportedAgo===1/0,h=!d&&!u,g=d&&this.lastReportedAgo>=d,f=u&&Math.abs((l-this.bandwidth)/this.bandwidth)>=u;if(p||h||g||f){var m=+p|+h<<1|+g<<2|+f<<3,v=this.getUpdateReason(m);this.updateBandwidth(l,v)}}},SendBandwidthCalculator.prototype.updateBandwidth=function(l,d){this.bandwidth=l,this.logger.safe.debug(\"Updating send bandwidth: \".concat(this.bandwidth,\", reason: \").concat(d)),this.notifySendBandwidthChanged()},SendBandwidthCalculator.prototype.notifySendBandwidthChanged=function(){this._forceUpdate=!1,this.event(\"onSendBandwidthChanged\").raise(this.bandwidth),this.lastReportedAgo=0},SendBandwidthCalculator.prototype.getUpdateReason=function(l){return 1&l?\"firstReport\":2&l?\"throttlingDisabled\":4&l?\"noReportsForTooLong\":8&l?\"bigMovement\":\"none\"},SendBandwidthCalculator}(u(7).default);d.SendBandwidthCalculator=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.RemoteVideoResolutionManager=void 0;var h=function(l){function RemoteVideoResolutionManager(d,u,p,h,g){var f=l.call(this)||this;return f.logger=d,f.multiParty=u,f.resolutionTable=p,f.configProvider=h,f.mediaManager=g,f}return p(RemoteVideoResolutionManager,l),RemoteVideoResolutionManager.prototype.getMaxFS=function(l,d){var u=this.resolutionTable.getMaxFS(l,d);return u=this.multiParty?Math.min(u,this.configProvider.config.webrtcMultiPartyRecvVideoMaxFS):Math.min(u,this.configProvider.config.webrtcRecvVideoMaxFS)},RemoteVideoResolutionManager.prototype.rendererSizeChanged=function(l,d){var u=this,p=l.getMediaStream();if(p){var h=this.mediaManager.getMediaEntityByRemoteStreamId(p.id);if(!h||!h.getVideoCapabilities())return void this.logger.safe.warn(\"no capabilities for provided modality: \".concat(l.getModality()));var g=this.getMaxFS(d.width,d.height),f=h.getVideoCapabilities();f.setMaxFS(g,(function(){if(u.logger.safe.info(\"updated max-fs video capability to \".concat(g)),u.multiParty&&u.configProvider.config.webrtcMultiPartyRecvVideoSignaling){var d=l.getMsi(),p=Number(h.getXSourceStreamId()),m=f.buildFmtp();u.event(\"onSourceRequestRequired\").raise(h.getModality(),p,d,m)}else u.event(\"onNegotiationRequired\").raise()}))}else this.logger.safe.warn(\"renderer has no stream attached\")},RemoteVideoResolutionManager}(u(7).default);d.RemoteVideoResolutionManager=h},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.RemoteVideoManager=void 0;var h=u(419),g=u(1),f=u(149),m=function(){function RemoteVideoManager(l,d,u,p,h,g){this.logger=l,this.configProvider=d,this.statsGatherer=u,this.diagnostics=p,this.remoteVideoResolutionManager=h,this.domOverrides=g,this.remoteRendererSubscriptions=new Map,this.lastPreferredResolutions=new Map,this.statSubs=[],this.subscribeToStatisticsChanged()}return Object.defineProperty(RemoteVideoManager.prototype,\"renderers\",{get:function(){return Array.from(this.remoteRendererSubscriptions,(function(l){return p(l,1)[0]}))},enumerable:!1,configurable:!0}),RemoteVideoManager.prototype.createRenderer=function(l,d,u){var p,g=new h.RemoteVideoRenderer((null!=u?u:this.logger).createChild(\"videorenderer\"),this.configProvider,null===(p=this.diagnostics)||void 0===p?void 0:p.newRendererDiagnostics(),d,l);return this.domOverrides.onMediaElementAdded&&this.domOverrides.onMediaElementAdded(g.getVideoElement()),this.addRenderer(g),g},RemoteVideoManager.prototype.moveRenderers=function(l){var d=this;this.renderers.forEach((function(u){u.resetTimeToFirstFrameFlag(),l.addRenderer(u),d.removeRenderer(u)}))},RemoteVideoManager.prototype.dispose=function(){var l=this;this.renderers.forEach((function(l){return l.resetTimeToFirstFrameFlag()})),this.renderers.forEach((function(d){var u=d.getTrackId(),p=d.getEndOfTheFreeze();l.statsGatherer.setFreezeDuration(p,u)})),this.remoteRendererSubscriptions.forEach((function(l,d){d.dispose(),l.forEach((function(l){return l.dispose()}))})),this.remoteRendererSubscriptions.clear(),this.lastPreferredResolutions.clear(),this.statSubs.forEach((function(l){return l.dispose()}))},RemoteVideoManager.prototype.addRenderer=function(l){this.remoteRendererSubscriptions.set(l,this.subscribeOnEvents(l)),this.updateLimitedResolutions(),this.logger.safe.info(\"Added renderer to manager\")},RemoteVideoManager.prototype.subscribeToStatisticsChanged=function(){var l=this;this.configProvider.config.isRenderingBasedOnRawStatistics||this.statSubs.push(this.statsGatherer.on(\"onStatisticsChanged\",(function(d){return l.processStats(d)}))),this.statSubs.push(this.statsGatherer.on(\"onRawStatisticsChanged\",(function(d){return l.processRawStats(d)})))},RemoteVideoManager.prototype.processStats=function(l){this.renderers.forEach((function(d){var u=d.getTrackId();if(l.remoteVideoStreams[u]){var p=l.remoteVideoStreams[u].isRendering;void 0!==p&&d.setIsRendering(p)}}))},RemoteVideoManager.prototype.processRawStats=function(l){var d=new Map;g.forOwn(l.ssrc,(function(l){d.set(l[f.TRACK_ID],l)})),this.renderers.forEach((function(l){var u=l.getTrackId();d.has(u)&&l.captureRawStatistics(d.get(u))}))},RemoteVideoManager.prototype.subscribeOnEvents=function(l){var d=this;return[l.on(\"onRendererSizeChanged\",(function(l,u){return d.onRendererSizeChanged(l,d.limitRendererResolution(u))})),l.on(\"onRendererDisposed\",(function(l){return d.onRendererDisposed(l)})),l.on(\"onVideoStarted\",(function(l,u){return d.onVideoStarted(l,u)})),l.on(\"onFreezeEnded\",(function(u){var p=l.getTrackId();d.statsGatherer.setFreezeDuration(u,p)}))]},RemoteVideoManager.prototype.onRendererDisposed=function(l){this.logger.safe.debug(\"Renderer removed from manager\"),this.removeRenderer(l),this.updateLimitedResolutions(),this.domOverrides.onMediaElementRemoved&&this.domOverrides.onMediaElementRemoved(l.getVideoElement())},RemoteVideoManager.prototype.removeRenderer=function(l){this.remoteRendererSubscriptions.get(l).forEach((function(l){return l.dispose()})),this.remoteRendererSubscriptions.delete(l),this.lastPreferredResolutions.delete(l)},RemoteVideoManager.prototype.onVideoStarted=function(l,d){this.statsGatherer.setTimeToFirstFrame(l,d)},RemoteVideoManager.prototype.findMaxResolution=function(l,d){var u=this,p=d,h=l.getMsi();return this.renderers.forEach((function(l){var d=l.getMsi();if(h===d){var g=u.limitRendererResolution(l.getCurrentResolution());g.width>p.width&&g.height>p.height&&(p=g)}})),p},RemoteVideoManager.prototype.onRendererSizeChanged=function(l,d){var u=this.findMaxResolution(l,d);this.remoteVideoResolutionManager.rendererSizeChanged(l,u),this.lastPreferredResolutions.set(l,u);var p=l.getMediaStream()&&l.getMediaStream().getVideoTracks();p&&p[0]&&this.statsGatherer.setPreferredResolution(p[0].id,u,l.getModality())},RemoteVideoManager.prototype.updateLimitedResolutions=function(){var l=this;this.lastPreferredResolutions.forEach((function(d,u){var p=l.limitRendererResolution(u.getCurrentResolution());d!==p&&d.height>0&&l.onRendererSizeChanged(u,p)}))},RemoteVideoManager.prototype.limitRendererResolution=function(l){var d=this.configProvider.config.multiviewResolutionLimits[\"\".concat(this.remoteRendererSubscriptions.size)]||this.configProvider.config.multiviewResolutionLimits.more;if(d){if(l.height>l.width&&l.width>d){var u=d/l.width;return{height:Math.ceil(l.height*u),width:d}}if(l.width>l.height&&l.height>d){u=d/l.height;return{height:d,width:Math.ceil(l.width*u)}}}return l},RemoteVideoManager}();d.RemoteVideoManager=m},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.LocalVideoStreamWatcher=void 0;var h=function(l){function LocalVideoStreamWatcher(d,u,p){var h=l.call(this)||this;return h.statisticsGatherer=d,h.configProvider=p,h.statisticsGathererSubscription=null,h.lastFramerateInput=-1,h.trackInfo=[],h.timeoutId=null,h.logger=u.createChild(\"localStreamWatcher\"),h}return p(LocalVideoStreamWatcher,l),LocalVideoStreamWatcher.prototype.startWatching=function(l){var d=this;this.trackInfo=l,!this.statisticsGathererSubscription&&this.configProvider.config.videoCaptureFreezeTimeout&&(this.statisticsGathererSubscription=this.statisticsGatherer.on(\"onStatisticsChanged\",(function(l){return d.onStatisticsChanged(l)})))},LocalVideoStreamWatcher.prototype.stopWatching=function(){this.trackInfo=[],this.statisticsGathererSubscription&&(this.statisticsGathererSubscription.dispose(),this.statisticsGathererSubscription=null),0!==this.lastFramerateInput||this.timeoutId||this.event(\"onVideoCaptureFreeze\").raise(!1),this.disposeTimer(),this.lastFramerateInput=-1},LocalVideoStreamWatcher.prototype.onStatisticsChanged=function(l){var d,u=this;this.trackInfo.length&&(Object.keys(l.localVideoStreams).forEach((function(p){var h=l.localVideoStreams[p];u.trackInfo.some((function(l){return l.trackId===h.trackId}))&&(!d||d.frameRateInput<h.frameRateInput)&&(d=h)})),d?d.frameRateInput!==this.lastFramerateInput&&(0===d.frameRateInput?this.scheduleCaptureFreezeStart(d.trackId):0===this.lastFramerateInput&&(this.timeoutId?this.disposeTimer():(this.logger.info(\"onVideoCaptureFreeze end for trackId: \".concat(d.trackId)),this.event(\"onVideoCaptureFreeze\").raise(!1))),this.lastFramerateInput=d.frameRateInput):this.logger.safe.warn(\"WebRTC Stats for send video not found\"))},LocalVideoStreamWatcher.prototype.scheduleCaptureFreezeStart=function(l){var d=this;this.timeoutId=window.setTimeout((function(){d.timeoutId=null,d.logger.info(\"onVideoCaptureFreeze start for trackId: \".concat(l)),d.event(\"onVideoCaptureFreeze\").raise(!0)}),this.configProvider.config.videoCaptureFreezeTimeout)},LocalVideoStreamWatcher.prototype.disposeTimer=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)},LocalVideoStreamWatcher}(u(7).default);d.LocalVideoStreamWatcher=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(51),h=function(){function WebRtcReceiveStream(l,d,u,h,g){this.mediaStream=l,this.modality=d,this.sourceStreamId=u,this.controller=h,this.videoCapabilties=g,this.msi=p.MediaSourceIdentifiers.SourceNone,this.operations=Promise.resolve()}return WebRtcReceiveStream.prototype.dispose=function(){},WebRtcReceiveStream.prototype.getId=function(){return this.mediaStream.id},WebRtcReceiveStream.prototype.getModality=function(){return this.modality},WebRtcReceiveStream.prototype.getMsi=function(){return this.msi},WebRtcReceiveStream.prototype.getMediaStream=function(){return this.mediaStream},WebRtcReceiveStream.prototype.requestSource=function(l){var d=this;this.msi=l;var u=this.operations.then((function(){var u;return d.videoCapabilties&&(d.videoCapabilties.resetToInitial(),u=d.videoCapabilties.buildFmtp()),d.controller.requestSource(d.modality,d.sourceStreamId,l,u)}));return this.operations=u.catch((function(){})),u},WebRtcReceiveStream}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRtcDTMFSender=void 0;var p=u(143),h=function(){function WebRtcDTMFSender(l){this.webRtcSender=null,this.configProvider=l.configProvider,this.queue=new p.DTMFQueue(l.logger)}return WebRtcDTMFSender.prototype.sendDtmf=function(l,d){return l&&l.getSenders?(this.syncSender(l),this.webRtcSender?(this.webRtcSender.ontonechange=this.onToneChange.bind(this),this.webRtcSender.insertDTMF(this.webRtcSender.toneBuffer+d,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(d)):Promise.reject(new Error(\"not available\"))):Promise.reject(new Error(\"bad peerConnection\"))},WebRtcDTMFSender.prototype.canSendDtmf=function(l){return!(!l||!l.getSenders)&&(this.syncSender(l),!!this.webRtcSender&&this.webRtcSender.canInsertDTMF)},WebRtcDTMFSender.prototype.dispose=function(){this.queue.cleanup()},WebRtcDTMFSender.prototype.syncSender=function(l){var d=l.getSenders().filter((function(l){return l.track&&\"audio\"===l.track.kind})).filter((function(l){return l.dtmf&&l.dtmf.canInsertDTMF}))[0];this.webRtcSender&&d&&d.dtmf!==this.webRtcSender&&(this.webRtcSender.ontonechange=null,this.queue.cleanup()),this.webRtcSender=d?d.dtmf:null},WebRtcDTMFSender.prototype.onToneChange=function(l){l.tone&&this.queue.toneSent(l.tone)},WebRtcDTMFSender}();d.WebRtcDTMFSender=h,d.default={build:function(l){return new h(l)}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SessionDescriptionFactory=d.WebRtcSessionDescription=d.SessionDescription=void 0;var p=u(8),h=u(47),g=u(42),f=u(3),m=u(9),v=u(39),y=u(66),S=function(){function SessionDescription(l,d,u,g){this.context=l,this.sessionType=d,this.sdp=u,this.remote=g,this.mediaManager=this.context.mediaManager,this.sdpTransform=this.context.sdpTransform,this.logger=this.context.logger.createChild(\"SessionDescr\"),this.sdpModel=h.parse(this.sdp),this.sdpModel.media.forEach((function(l){p.isUndefined(l.mid)||(l.mid=l.mid.toString())})),this.remote&&!this.context.configProvider.config.disableMsSdp&&new y.MsSdpRemoteModifier(l,this.mediaManager,d).modify(this.sdpModel)}return SessionDescription.prototype.clone=function(){return new SessionDescription(this.context,this.sessionType,this.sdp,this.remote)},SessionDescription.prototype.getModalities=function(){return this.modalities||v.getModalities(this.sdpModel)},SessionDescription.prototype.updateModalities=function(l){this.modalities=l},SessionDescription.prototype.getSrtpInfo=function(){return m.getSrtpInfo(this.sdpModel)},SessionDescription.prototype.getVideoCodecs=function(){var l={};return this.sdpModel.media.forEach((function(d){\"video\"===d.type&&d.rtp.map((function(l){return l.codec.toLowerCase()})).forEach((function(d){return l[d]=!0}))})),Object.keys(l)},SessionDescription.prototype.usePrimaryAudioCodecOnly=function(l){new y.AudioPrimaryCodecsModifier(l).modify(this.sdpModel)},SessionDescription.prototype.isCodecSwitchSupported=function(){var l=this;return!this.sdpModel.media.some((function(d){return d.type===f.default.MEDIA_TYPE.audio&&d.xMediaSettings&&l.containsMediaSetting(d.xMediaSettings,\"codecswitchunsupported\")}))},SessionDescription.prototype.toLocal=function(){return this.sdpModel=this.sdpTransform.toLocal(this.sdpModel,this.mediaManager,this.sessionType),h.write(this.sdpModel)},SessionDescription.prototype.toOffer=function(){return this.toOfferAnswer()},SessionDescription.prototype.toAnswer=function(){return this.toOfferAnswer()},SessionDescription.prototype.toOfferAnswer=function(){var l=\"offer\"===this.sessionType;return new y.CandidatesFixup(this.context.configProvider,this.logger).modify(this.sdpModel),(new y.BundleOnlyMediaFixup).modify(this.sdpModel),l&&this.mediaManager.isEmpty()&&this.mediaManager.fromOffer(this.sdpModel,this.modalities),this.mediaManager.syncModalities(this.sdpModel,this.modalities,!l),this.sdpModel=l?this.sdpTransform.toOffer(this.sdpModel,this.mediaManager,this.modalities):this.sdpTransform.toAnswer(this.sdpModel,this.mediaManager,this.modalities),this.context.configProvider.config.disableMsSdp||new y.MsSdpLocalModifier(this.context,this.mediaManager,this.sessionType).modify(this.sdpModel),new y.InjectH264ParamsModifier(this.mediaManager).modify(this.sdpModel),this.modalities=v.getModalities(this.sdpModel),h.write(this.sdpModel)},SessionDescription.prototype.toRemote=function(l){return this.modalities=l,this.mediaManager.fromRemote(this.sdpModel,this.modalities),this.sdpModel=this.sdpTransform.toRemote(this.sdpModel,this.mediaManager,this.modalities,this.sessionType),h.write(this.sdpModel)},SessionDescription.prototype.getVideoRecvCapabilities=function(){var l=this.getMediaByLabel(f.default.MEDIA_LABEL.video);return this.getRecvCapabilitiesForMedia(l)},SessionDescription.prototype.getSharingRecvCapabilities=function(){var l=this.getMediaByLabel(f.default.MEDIA_LABEL.sharing);return this.getRecvCapabilitiesForMedia(l)},SessionDescription.prototype.getRecvCapabilities=function(){var l=this,d=[];return this.sdpModel.media.forEach((function(u){if(u.mid){var p=l.mediaManager.getMediaEntityByMid(u.mid);if(p){var h={sourceId:p.getXSourceStreamId(),capabilities:[l.getRecvCapabilitiesForMedia(u)]};d.push(h)}else l.logger.safe.info(\"No media entity for mid: \".concat(JSON.stringify(u.mid),\", existing: \").concat(JSON.stringify(l.mediaManager.getMediaEntities().map((function(l){return l.getMid()})))))}else l.logger.safe.info(\"Modality disabled, no receive caps to handle: \".concat(JSON.stringify(u)))})),d},SessionDescription.prototype.getMediaByType=function(l){return this.sdpModel.media.find((function(d){return d.type===l}))},SessionDescription.prototype.isUnbundled=function(){var l,d=null===(l=this.sdpModel.groups)||void 0===l?void 0:l.find((function(l){return\"BUNDLE\"===l.type})),u=this.sdpModel.media.find((function(l){return l.type===f.default.MEDIA_TYPE.audio})),p=this.sdpModel.media.find((function(l){return l.type===f.default.MEDIA_TYPE.video}));return d?!d.mids.toString().split(\" \").find((function(l){return l===u.mid})):!!p},SessionDescription.prototype.couldBeUnbundled=function(){return!this.sdpModel.groups||!this.sdpModel.groups.find((function(l){return\"BUNDLE\"===l.type}))||this.hasUnbundledIceCandidates()},SessionDescription.prototype.containsMediaSetting=function(l,d){return l.some((function(l){return-1!==l.settings.indexOf(d)}))},SessionDescription.prototype.getRecvCapabilitiesForMedia=function(l){var d,u=this;return l&&v.forCodec(l,{name:\"h264\",rate:9e4},(function(l){l.fmtp&&l.fmtp.config&&(d=u.parseVideoCapabilitiesFromFmtpConfig(l.fmtp.config))})),d},SessionDescription.prototype.getMediaByLabel=function(l){return this.sdpModel.media.find((function(d){return d.label===l}))},SessionDescription.prototype.parseVideoCapabilitiesFromFmtpConfig=function(l){var d=g.default.build(l);return{maxFs:+d.get(f.default.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+d.get(f.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:+d.get(f.default.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*+d.get(f.default.VIDEO_CAPABILITIES.MAX_BR_PATH)}},SessionDescription.prototype.hasIceCandidatesForMediaType=function(l,d){void 0===d&&(d=\"\");var u=this.sdpModel.media?this.sdpModel.media.filter((function(d){return d.type===l&&!!d.candidates&&0!==d.candidates.length})):[];return d?u.some((function(l){return!!l.candidates&&l.candidates.some((function(l){return l.type===d}))})):!!u.length},SessionDescription.prototype.hasIceCandidates=function(){return this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.audio)||this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.video)},SessionDescription.prototype.hasRelayIceCandidates=function(){return this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.audio,\"relay\")||this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.video,\"relay\")},SessionDescription.prototype.hasUnbundledIceCandidates=function(){var l=this.sdpModel.media.filter((function(l){return l.type===f.default.MEDIA_TYPE.video&&0!==l.port}));return this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.audio)&&(!l.length||this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.video))},SessionDescription.prototype.hasUnbundledRelayIceCandidates=function(){var l=this.sdpModel.media.filter((function(l){return l.type===f.default.MEDIA_TYPE.video&&0!==l.port}));return this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.audio,\"relay\")&&(!l.length||this.hasIceCandidatesForMediaType(f.default.MEDIA_TYPE.video,\"relay\"))},SessionDescription.prototype.isIceRestart=function(){return this.mediaManager.getMediaEntities().some((function(l){return l.getExtension(\"iceRestart\")}))},SessionDescription.prototype.isMSRTC=function(){return!!this.sdpModel.xMediaBw},SessionDescription.prototype.insertFakeCandidateIfNeeded=function(l,d){this.hasIceCandidates()||(l.setFakeIceCandidate(!0),d&&(d.fakeIceCandidate=!0),(new y.NoCandidatesFixup).modify(this.sdpModel))},SessionDescription.prototype.getBweType=function(){var l=this.sdpModel.media.find((function(l){return 0!==l.port&&l.type===f.default.MEDIA_TYPE.video}));return l?l.ext&&l.ext.find((function(l){return l.uri===f.default.TRANSPORT_CC.EXT_URI||l.uri===f.default.TRANSPORT_CC.MSSDP_ENCODED_URI}))?\"SSBWE\":\"REMB\":\"Unknown\"},SessionDescription.prototype.fixDataModality=function(){new y.InsertDisabledXData(this.mediaManager).modify(this.sdpModel)},SessionDescription}();d.SessionDescription=S;var _=function(){function WebRtcSessionDescription(l){this.context=l}return WebRtcSessionDescription.prototype.createLocalOffer=function(l){return new S(this.context,\"offer\",l)},WebRtcSessionDescription.prototype.createRemoteOffer=function(l){return new S(this.context,\"offer\",l,!0)},WebRtcSessionDescription.prototype.createLocalAnswer=function(l){return new S(this.context,\"answer\",l)},WebRtcSessionDescription.prototype.createRemoteAnswer=function(l){return new S(this.context,\"answer\",l,!0)},WebRtcSessionDescription}();d.WebRtcSessionDescription=_;var C=function(){function SessionDescriptionFactory(){}return SessionDescriptionFactory.build=function(l){return new _(l=l||{})},SessionDescriptionFactory}();d.SessionDescriptionFactory=C},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.createIceServers=void 0;var createIceServers=function(l,d){return l.reduce((function(l,u){var p=[],h=u.addresses&&u.addresses[0],g=u.fqdns&&u.fqdns.length>0,f=d.iceUdpAddressType,m=d.iceTcpAddressType,v=d.iceServerTransport;if(!h&&!g)return l;if(v.includes(\"udp\")&&u.udpPort){var y=!g||\"fqdn\"!==f&&h?h:u.fqdns[0];p.push(\"turn:\".concat(y,\":\").concat(u.udpPort,\"?transport=udp\"))}if(v.includes(\"tcp\")&&u.tcpPort){y=!g||\"fqdn\"!==m&&h?h:u.fqdns[0];p.push(\"turn:\".concat(y,\":\").concat(u.tcpPort,\"?transport=tcp\"))}return v.includes(\"tls\")&&u.tlsPort&&g&&p.push(\"turns:\".concat(u.fqdns[0],\":\").concat(u.tlsPort)),l.concat({urls:p,credential:u.password,username:u.username})}),[])};d.createIceServers=createIceServers},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoStreamAnalyzer=void 0;var p=7,h=31,g=function(){function VideoStreamAnalyzer(l){this.logger=l}return VideoStreamAnalyzer.prototype.getTransform=function(){var l=this;return new TransformStream({transform:function(d,u){return l.transform(d,u)}})},VideoStreamAnalyzer.prototype.transform=function(l,d){this.processChunk(l),d.enqueue(l)},VideoStreamAnalyzer.prototype.getStartCodeSize=function(l){var d=l.getUint32(0);return 1===d?4:256==(4294967040&d)?3:0},VideoStreamAnalyzer.prototype.processChunk=function(l){if(\"key\"===l.type){var d=this.isH264KeyFrame(l.data)?\"\".concat(this.getH264Profile(l.data),\"(H264)\"):\"unknown\";this.logger.safe.info(\"keyframe metadata: \".concat(JSON.stringify(l.getMetadata()),\", profile=\").concat(d))}},VideoStreamAnalyzer.prototype.isH264KeyFrame=function(l){if(l.byteLength<7)return!1;var d=new DataView(l),u=this.getStartCodeSize(d);return!!u&&(d.getUint8(u)&h)===p},VideoStreamAnalyzer.prototype.getH264Profile=function(l){var d=new DataView(l),u=this.getStartCodeSize(d);return(16777215&d.getUint32(u)).toString(16)},VideoStreamAnalyzer}();d.VideoStreamAnalyzer=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.EffectStatistics=void 0;var p=u(67),h=function(){function EffectStatistics(l){this.error=new p.UntilFullStatsBuffer(l)}return EffectStatistics.prototype.startLoadTimer=function(){this.loadStartTimestamp=Date.now()},EffectStatistics.prototype.stopLoadTimer=function(){this.loadDuration=Date.now()-this.loadStartTimestamp},EffectStatistics.prototype.setError=function(l,d){this.error.add({type:l,message:d})},EffectStatistics.prototype.setRenderer=function(l){this.renderer=l},EffectStatistics.prototype.getRenderer=function(){return this.renderer},EffectStatistics.prototype.getReport=function(){return{loadDuration:this.loadDuration,error:this.error.items,renderer:this.renderer}},EffectStatistics}();d.EffectStatistics=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(8),m=u(18),v=u(62),y=\"default_output_device\",S=function(l){function DeviceManagerAdapter(d){var u=l.call(this)||this;return u._deviceManager=d,d.on(\"onDevicesChanged\",(function(l){var d=u._deviceManager.getDeviceDescriptions(l),p=u._mapDevices(d);u._raiseDevicesChanged(p)})),d.on(\"onSelectedDevicesChanged\",(function(l){return u._raiseDevicesChanged()})),d.on(\"onPermissionStateChanged\",(function(){return u.event(\"onPermissionStateChanged\").raise()})),d.on(\"onVideoEffectsEvent\",(function(l,d){return u.event(\"videoEffectsEvent\").raise(l,d)})),d.on(\"onVideoEffectApplied\",(function(){return u.event(\"videoEffectApplied\").raise()})),d.on(\"onRawStreamChanged\",(function(l){return u.event(\"onRawStreamChanged\").raise(l)})),u}return p(DeviceManagerAdapter,l),Object.defineProperty(DeviceManagerAdapter.prototype,\"isAudioOutputSelectionSupported\",{get:function(){return this._deviceManager.isAudioOutputSelectionSupported},enumerable:!1,configurable:!0}),DeviceManagerAdapter.prototype.getPermissionState=function(l){return\"camera\"===l?this.getPermissionStateHelper(this._deviceManager.getPermissionState(\"camera\")):\"microphone\"===l?this.getPermissionStateHelper(this._deviceManager.getPermissionState(\"microphone\")):\"unknown\"},DeviceManagerAdapter.prototype.askDevicePermission=function(l){return this._deviceManager.askDevicePermission?this._deviceManager.askDevicePermission(l):Promise.resolve({audio:!0,video:!0})},DeviceManagerAdapter.prototype.enumerateDevicesAsync=function(){var l=this;return this._deviceManager.enumerateDevicesAsync().then((function(d){return l._mapDevices(d)}))},DeviceManagerAdapter.prototype.getPreferredCamera=function(){throw new Error(\"Not implemented\")},DeviceManagerAdapter.prototype.selectDevices=function(l){var d=f.assign({},this._deviceManager.getSelectedDevices(),l);this._deviceManager.selectDevices(d)},DeviceManagerAdapter.prototype.getSelectedDevices=function(){return this._deviceManager.getSelectedDevices()},DeviceManagerAdapter.prototype.getDeviceNameAsync=function(l){return this._deviceManager.getDeviceNameAsync(l)},DeviceManagerAdapter.prototype.getSpeakerDeviceDomIdAsync=function(l,d){return this._deviceManager.getSpeakerDeviceDomIdAsync(l)},DeviceManagerAdapter.prototype.setDeviceEffectsAsync=function(l,d){var u=this;return this._deviceManager.videoEffectManager.init().then((function(){return u._deviceManager.videoEffectManager.setEffectAsync(d)}))},DeviceManagerAdapter.prototype.getDeviceEffectsCapabilityAsync=function(l,d){return this._deviceManager.videoEffectManager.getEffectsCapability()},DeviceManagerAdapter.prototype.setBackgroundImageAsync=function(l,d,u){return this._deviceManager.videoEffectManager.configure({imagePath:d,headers:u})},DeviceManagerAdapter.prototype.getImagePropertyAsync=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.getMicrophoneGeometryArrayInfoAsync=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.transformImageAsync=function(l,d,u,p){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.setAudioProcessingFlags=function(l){return this._deviceManager.setAudioProcessingFlags(l)},DeviceManagerAdapter.prototype.sendMessageDeviceVideoEffectsAsync=function(l,d){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.sendMessageDeviceVideoExtensibilityAsync=function(l,d){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.setVideoCaptureConfigAsync=function(l,d){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.getSpeakerVolume=function(){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.getSpeakerSystemVolume=function(){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.setSpeakerVolume=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.setSpeakerSystemVolume=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.unmuteMicrophone=function(){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.unmuteSpeaker=function(){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.getNrgLevelsForDeviceTuner=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.getAudioFeatureCapability=function(l){return this._deviceManager.audioEffectManager.getEffectsCapability()},DeviceManagerAdapter.prototype.getMicrophoneVolume=function(){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.setMicrophoneVolume=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.setDeviceTelemetryData=function(l,d,u){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.getSourceFormats=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.enableShellSharing=function(){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter.prototype.disableShellSharing=function(){return Promise.reject(new Error(\"Not implemeted\"))},DeviceManagerAdapter.prototype.enableParticipantCameras=function(){return Promise.reject(new Error(\"Not implemeted\"))},DeviceManagerAdapter.prototype.createPreview=function(l,d,u){return\"camera\"===d.kind&&f.isUndefined(d.device)?this.createPreviewRenderer(l,u):Promise.reject(new Error(\"Not yet supported\"))},DeviceManagerAdapter.prototype.createPreviewRenderer=function(l,d){return h(this,void 0,void 0,(function(){var u,p;return g(this,(function(h){switch(h.label){case 0:u=new v.LocalVideoRenderer(l,this._deviceManager),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,u.startVideoAsync()];case 2:return h.sent(),d&&(u.setScalingMode(d.scalingMode),u.setVideoMirroring(!d.ignoreMirroring)),[3,4];case 3:throw p=h.sent(),u.dispose(),p;case 4:return[2,u]}}))}))},DeviceManagerAdapter.prototype.createScreenSharingPreviewRenderer=function(l,d){return Promise.reject(new Error(\"Not yet supported\"))},DeviceManagerAdapter.prototype.getRawInputVideoStreamTrack=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){return[2,this._deviceManager.getRawInputVideoStreamTrack()]}))}))},DeviceManagerAdapter.prototype.disposeRawInputVideoStreamTrack=function(){return this._deviceManager.disposeRawInputVideoStreamTrack()},DeviceManagerAdapter.prototype.getRawInputAudioStreamTrack=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){return[2,this._deviceManager.getRawInputAudioStreamTrack()]}))}))},DeviceManagerAdapter.prototype.disposeRawInputAudioStreamTrack=function(){return this._deviceManager.disposeRawInputAudioStreamTrack()},DeviceManagerAdapter.prototype.createAudioRenderer=function(){return this._deviceManager.createAudioRenderer()},DeviceManagerAdapter.prototype._raiseDevicesChanged=function(l){var d=this;(l?Promise.resolve(l):this.enumerateDevicesAsync()).then((function(l){d.raiseChanged(),d.event(\"devicesChanged\").raise(l)}))},DeviceManagerAdapter.prototype.getPermissionStateHelper=function(l){switch(l){case\"granted\":return\"granted\";case\"denied\":return\"denied\";case\"prompt\":return\"prompt\";default:return\"unknown\"}},DeviceManagerAdapter.prototype._mapDevices=function(l){var d=this;return f.map(l,(function(l){return d._mapDeviceDesc(l)}))},DeviceManagerAdapter.prototype._mapDeviceDesc=function(l){var d=DeviceManagerAdapter._mapDeviceType(l.kind);return 1===d?{id:l.id,browserId:l.browserId,label:l.label,kind:d,position:DeviceManagerAdapter._mapCameraPosition(l.position)}:4===d?{id:null,browserId:null,label:l.label,kind:d,formFactor:l.formFactor,isPcInternalDevice:l.isPcInternalDevice,microphoneId:l.microphoneId,speakerId:l.speakerId}:{id:l.id,browserId:l.browserId===y?\"default\":l.browserId,label:l.label,kind:d,isSystemDefault:!!l.isSystemDefault}},DeviceManagerAdapter._mapDeviceType=function(l){switch(l){case\"camera\":return 1;case\"microphone\":return 2;case\"speaker\":return 3;case\"compositeAudio\":return 4;default:throw new Error(\"Invalid device type '\".concat(l,\"'\"))}},DeviceManagerAdapter._mapCameraPosition=function(l){switch(l){case\"front\":return 1;case\"back\":return 2;case\"external\":return 3;default:return 0}},DeviceManagerAdapter.prototype.startAudioLoopbackDevice=function(l){return Promise.reject(new Error(\"Not implemented\"))},DeviceManagerAdapter}(m.default);d.default=S},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(8),g=u(18),f=function(){function SharingSourceAdapter(l){this._sharingSource=l}return SharingSourceAdapter.prototype.getId=function(){return this._sharingSource.getId()},SharingSourceAdapter.prototype.getDeviceId=function(){return String(this._sharingSource.getId())},SharingSourceAdapter.prototype.getType=function(){return this.mapSharingSourceType(this._sharingSource.getType())},SharingSourceAdapter.prototype.getPreview=function(l,d,u){return Promise.reject(\"not implemented\")},SharingSourceAdapter.prototype.getPreviewAsync=function(l,d){return this._sharingSource.getPreviewAsync(l,d)},SharingSourceAdapter.prototype.getDescription=function(){return this._sharingSource.getDescription()},SharingSourceAdapter.prototype.getIcon=function(l,d){return this._sharingSource.getIcon(l,d)},SharingSourceAdapter.prototype.getBounds=function(){},SharingSourceAdapter.prototype.mapSharingSourceType=function(l){switch(l){case 1:return 1;case 2:return 2;default:throw new Error(\"Invalid sharing source type\")}},SharingSourceAdapter}(),m=function(l){function ScreenSharingManagerAdapter(d){var u=l.call(this)||this;return u._screenSharingManager=d,u._screenSharingManager.onScreensChanged((function(){u.event(\"screensChanged\").raise()})),u}return p(ScreenSharingManagerAdapter,l),ScreenSharingManagerAdapter.prototype.enumerateScreensAsync=function(){return this._screenSharingManager.enumerateScreensAsync().then((function(l){return h.map(l,(function(l){return new f(l)}))}))},ScreenSharingManagerAdapter.prototype.enumerateWindowsAsync=function(){return this._screenSharingManager.enumerateWindowsAsync().then((function(l){return h.map(l,(function(l){return new f(l)}))}))},ScreenSharingManagerAdapter.prototype.enumerateCamerasAsync=function(){return this._screenSharingManager.enumerateCamerasAsync().then((function(l){return h.map(l,(function(l){return new f(l)}))}))},ScreenSharingManagerAdapter}(g.default);d.default=m},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.pluginlessStackFactory=d.PluginlessStack=d.createTelemetryLoggersFromConfig=void 0;var f=u(8),m=u(463),v=u(464),y=u(13),S=u(54),_=u(77),C=u(90),E=u(465),T=u(474),b=u(18),I=u(17),A=u(34),R=u(475),P=u(89),O=u(171),M=u(476),w=u(122),N=u(482),D=u(483),L=u(172),k=u(484),x=u(486),F=function(l){function PluginlessStackError(d,u){void 0===u&&(u=1);var p=l.call(this,d)||this;return p.callSupport=u,p}return p(PluginlessStackError,l),PluginlessStackError}(Error);function createTelemetryLoggersFromConfig(l){var d={};return l.telemetryLoggers?d=l.telemetryLoggers:l.telemetryService&&l.telemetryService.getGenericTelemetryLogger&&l.telemetryTenants?f.forEach(Object.keys(l.telemetryTenants),(function(u){return d[u]=l.telemetryService.getGenericTelemetryLogger(l.telemetryTenants[u])})):l.telemetryService&&(l.telemetryService.sendEvents||l.telemetryService.getCallingAdapter)&&(l.telemetryService.sendEvents&&(d.media={sendEvent:function(d){d.eventName&&(d.eventName=d.eventName.replace(/^(mdsc_)/,\"\")),l.telemetryService.sendEvents([d])}},d.tlePlayer={sendEvent:function(d){d.eventName&&(d.eventName=d.eventName.replace(/^(mdsc_)/,\"\")),l.telemetryService.sendEvents([d])}}),l.telemetryService.getCallingAdapter&&(d.signaling={sendEvent:function(d){l.telemetryService.getCallingAdapter().sendEvent(d.eventName,d.props)}})),d}function createTelemetryLoggersForOneDs(l){var d={};return d.signaling=l.createLogger(\"signaling\"),d.media=l.createLogger(\"media\"),d.tlePlayer=l.createLogger(\"tlePlayer\"),d}d.createTelemetryLoggersFromConfig=createTelemetryLoggersFromConfig;var U=function(l){function PluginlessStack(d,u){var p=l.call(this)||this;return p._config=d,p._ecsProvider=u,p.callRegistries=[],p._logger=new C.default(p._config.logger).createChild(\"PluginlessStack\"),p._platformManager=new N.default,p.platformCallConstraintsProvider=new m.PlatformCallConstraintsProvider(p._logger.createChild(\"PlatformConstraintsProvider\")),p}return p(PluginlessStack,l),PluginlessStack.prototype.initializeMediaAgent=function(l){return h(this,void 0,void 0,(function(){var d,u,p,h,f,m,v,y;return g(this,(function(g){switch(g.label){case 0:if(d=!1,p=null,!this._mediaAgentProvider)throw new F(\"PluginlessStack initialize MediaAgent error, Media Stack not initialized\",p);g.label=1;case 1:return g.trys.push([1,3,,4]),h=l.relayManager||this.buildRelayManager(l.httpRequestDispatcher,l.tokenProvider,l.configProvider,l.appStateProvider,l.trapTokenCredentialsProvider),[4,this._mediaAgentProvider.buildAgent(this._config.platformType,h)];case 2:return u=g.sent(),[3,4];case 3:return f=g.sent(),d=1===(m=f).length&&\"not_supported\"===m[0].reason,v=m.some((function(l){return\"incompatible_version\"===l.reason})),p=v?2:1,[3,4];case 4:if(!this._config.usePlatformSupportApi)if(p){if(!d||!this._config.callSettings||!this._config.callSettings.useLwjForAllCalls)throw new F(\"PluginlessStack initialization failed\",p)}else if(1!==(y=(new N.default).getPlatformSupportLevel(!0))&&2!==y&&(p=1,!this._config.callSettings||!this._config.callSettings.useLwjForAllCalls))throw new F(\"PluginlessStack initialization failed\",p);return u?(this._screenSharingManager=new L.default(u.getScreenSharingManager()),this._oneDsManager=new x.OneDsTelemetryTransportLogger(this.createTelemetryConfig(u,l.clientInformation)),this._oneDsTelemetryLoggers=createTelemetryLoggersForOneDs(this._oneDsManager),this._mediaAgent=u):this._deviceManager=new T.default,[2]}}))}))},PluginlessStack.prototype.initializeSignalingAgentProvider=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this._trouterService=l.trouterService,this._signalingAgentProvider=k.signalingAgentProviderFactory.build(l.signalingAgentConfig,this._ecsProvider,this._config.logger),[2]}))}))},PluginlessStack.prototype.initializeImageRendererProvider=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this._imageRendererProvider=new v.ImageRendererProvider(l),[2,this._imageRendererProvider]}))}))},PluginlessStack.build=function(l,d){return h(this,void 0,void 0,(function(){var u,p;return g(this,(function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),(u=new PluginlessStack({detectH264Support:l.mediaAgentFactoryConfig.detectH264Support,domOverrides:l.mediaAgentFactoryConfig.domOverrides,mediaSettings:l.mediaAgentFactoryConfig.settings,logger:l.logger,telemetryLoggers:l.telemetryLoggers,telemetryService:l.telemetryService,telemetryTenants:l.telemetryTenants,telemetryContextProvider:l.telemetryContextProvider,platformType:l.platformType,callSettings:l.callSettings,usePlatformSupportApi:l.usePlatformSupportApi,clientInformation:l.signalingAgentConfig.clientInformation},d)).initializeMediaProvider({detectH264Support:l.mediaAgentFactoryConfig.detectH264Support,domOverrides:l.mediaAgentFactoryConfig.domOverrides,mediaSettings:l.mediaAgentFactoryConfig.settings,logger:l.mediaAgentFactoryConfig.logger,safeLogger:l.mediaAgentFactoryConfig.safeLogger,webcvProvider:l.mediaAgentFactoryConfig.webcvProvider,wasmdnsProvider:l.mediaAgentFactoryConfig.wasmdnsProvider,wasmaecProvider:l.mediaAgentFactoryConfig.wasmaecProvider}),[4,u.initializeMediaAgent({httpRequestDispatcher:l.mediaAgentFactoryConfig.httpRequestDispatcher,tokenProvider:l.mediaAgentFactoryConfig.tokenProvider,configProvider:l.mediaAgentFactoryConfig.configProvider,appStateProvider:l.mediaAgentFactoryConfig.appStateProvider,clientInformation:l.signalingAgentConfig.clientInformation,trapTokenCredentialsProvider:l.mediaAgentFactoryConfig.trapTokenCredentialsProvider,relayManager:l.mediaAgentFactoryConfig.relayManager})];case 1:return h.sent(),u.initializeSignalingAgentProvider({signalingAgentConfig:l.signalingAgentConfig,trouterService:l.trouterService}),l.imageRendererConfig&&u.initializeImageRendererProvider(l.imageRendererConfig),[2,u];case 2:throw(p=h.sent())instanceof F?p:new F(\"\".concat(p));case 3:return[2]}}))}))},PluginlessStack.buildBaseStack=function(l,d){return h(this,void 0,void 0,(function(){var u;return g(this,(function(p){return(u=new PluginlessStack(l,d)).initializeMediaProvider({detectH264Support:l.detectH264Support,domOverrides:l.domOverrides,mediaSettings:l.mediaSettings,logger:l.logger,safeLogger:l.safeLogger}),[2,u]}))}))},PluginlessStack.prototype.init=function(){return Promise.resolve()},PluginlessStack.prototype.dispose=function(d){return void 0===d&&(d=(0,y.generateCauseId)()),h(this,void 0,void 0,(function(){var u,p,h,f,m=this;return g(this,(function(g){switch(g.label){case 0:return(u=this._logger.createFnLogger(\"dispose\",d)).info(\"Dispose\"),this._ecsProvider.dispose(),p=function(){m.callRegistries=[],u.info(\"call registries are disposed\"),m._screenSharingManager&&(m._screenSharingManager.dispose(d),m._screenSharingManager=void 0,u.info(\"screensharing manager is disposed\")),m._deviceManager=void 0,m._oneDsManager=void 0,u.info(\"device manager is disposed\"),l.prototype.dispose.call(m)},h=function(l){u.warn(\"Failed:\",l)},f=this.callRegistries.map((function(l){return l.dispose(d).catch(h)})),[4,Promise.all(f)];case 1:return g.sent(),[4,this._mediaAgent.dispose(d).catch(h)];case 2:return g.sent(),[2,p()]}}))}))},PluginlessStack.prototype.getCallRegistry=function(){return this._logger.info(\"returning default callRegistry\"),this.callRegistries[0]?this.callRegistries[0]:this._createCallRegistry()},PluginlessStack.prototype.createCallRegistry=function(l,d){var u=this;void 0===d&&(d=(0,y.generateCauseId)());var p=l?I.mriOrId(l.id):void 0,f=this._logger.createFnLogger(\"createCallRegistry[identity=\".concat(p,\"]\"),d),m=this.callRegistries.find((function(d){return d.identity===l.id}));return m&&!m.isDisposing?(f.info(\"callRegistry already exists for \".concat(I.mriOrId(l.id))),Promise.resolve(m)):(m&&m.isDisposing?m.disposePromise:Promise.resolve().then(S.noop)).then((function(){return h(u,void 0,void 0,(function(){return g(this,(function(d){return[2,m=this._createCallRegistry(l)]}))}))}))},PluginlessStack.prototype._createCallRegistry=function(l){var d=this;if(!this._trouterService)throw new F(\"Unable to create call registry, trouter service undefined\");if(!this._mediaAgent)throw new F(\"Unable to create call registry, media agent undefined\");if(!this._signalingAgentProvider)throw new F(\"Unable to create call registry, signaling agent undefined\");var u=new P.CallRegistry(this._trouterService,this._signalingAgentProvider,this._mediaAgent,this._logger,createTelemetryLoggersFromConfig(this._config),this._config.callSettings,this._ecsProvider,this._imageRendererProvider,l,this._oneDsTelemetryLoggers);return u.on(\"disposed\",(function(){d.callRegistries.splice(d.callRegistries.indexOf(u),1)})),this.callRegistries.push(u),u},PluginlessStack.prototype.initializeMediaProvider=function(l){var d=f.assign({},l);this._mediaAgentProvider=new w.default(d,this._ecsProvider,this.platformCallConstraintsProvider),this._deviceManager=new O.default(this._mediaAgentProvider.getDeviceManager())},PluginlessStack.prototype.createTelemetryConfig=function(l,d){return{configProvider:l.getConfigProvider(),logger:this._logger.createChild(\"OneDsLogger\"),clientInfo:d,contextProvider:this._config.telemetryContextProvider}},PluginlessStack.prototype.buildRelayManager=function(l,d,u,p,h){var g=l||new _.HttpRequestDispatcher(this._logger);return R.build({logger:this._logger,tokenProvider:d,trapTokenCredentialsProvider:h,configProvider:function(){return u.getRelayConfig()},request:{get:function(l,d){return g.getAsync(l,g.getRequestOptions(\"GET\",d&&d.headers,null,d&&d.timeout))},isOnline:p.isOnline}})},PluginlessStack.prototype.getDeviceManager=function(){return this._deviceManager},PluginlessStack.prototype.createDeviceManager=function(l){return this._deviceManager},PluginlessStack.prototype.getScreenSharingManager=function(){return this._screenSharingManager},PluginlessStack.prototype.getSetup=function(){},PluginlessStack.prototype.getEcsProvider=function(){return this._ecsProvider},PluginlessStack.prototype.getCallFeedback=function(){return null},PluginlessStack.prototype.getAiMdp=function(){return null},PluginlessStack.prototype.fireIntent=function(l,d){},PluginlessStack.prototype.getVersion=function(){return{build:(0,A.getTsCallingVersion)(),ovb:(0,A.getOvb)()}},PluginlessStack.prototype.getMediaStatus=function(){return null},PluginlessStack.prototype.getVideoCapabilityLimits=function(){return null},PluginlessStack.prototype.setMediaConfig=function(l){return this._mediaAgent?(this._mediaAgent.setMediaConfig(l),Promise.resolve()):Promise.reject(\"not supported in LWJ\")},PluginlessStack.prototype.setPlatformCallConstraints=function(l){this.platformCallConstraintsProvider.setConstraints(l)},PluginlessStack.prototype.getPlatformSupportLevel=function(){return this._platformManager.getPlatformSupportLevel(!!this._mediaAgent)},PluginlessStack.prototype.getLiveStreamClient=function(){var l=this,getTelemetryLogger=function(){var d=createTelemetryLoggersFromConfig(l._config),u=l._oneDsTelemetryLoggers;return(l._mediaAgent&&l._mediaAgent.getConfig().useOneDsLogger?u:d).tlePlayer};return new E.LiveStreamClient(this._ecsProvider.createEcsConfiguration(),this._logger.createChild(\"LiveStreamClient\"),getTelemetryLogger)},PluginlessStack.prototype.createVoipCallCoordinator=function(){},PluginlessStack.prototype.setLogFileName=function(l){},PluginlessStack}(b.default);d.PluginlessStack=U,d.pluginlessStackFactory={build:function(l){var d=new D.PluginlessEcsProvider;return(0,M.initLogger)(l,d),U.build(l,d)},buildBaseStack:function(l){var d=new D.PluginlessEcsProvider;return U.buildBaseStack(l,d)},getVersion:function(){return{build:(0,A.getTsCallingVersion)(),ovb:(0,A.getOvb)()}}}},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},m=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.PlayerWrapper=void 0;var v=u(40),y=u(18),S=u(468),_=function(l){function PlayerWrapper(d){var u=l.call(this)||this;return u.logger=d,u.resultsMap=new Map,u.on(\"statsUpdated\",(function(l){u.lastDiagnosticData=l})),u.on(\"log\",(function(l,d){u.logger[l](d)})),u}return p(PlayerWrapper,l),PlayerWrapper.prototype.initialize=function(l,d,u,p){return h(this,void 0,void 0,(function(){var h,f,m;return g(this,(function(g){switch(g.label){case 0:return h={config:u.config,playerConfig:u.playerConfig},f=this,0!==p?[3,2]:[4,(0,S.setupAmpAndBuildPipe)(l,u.config.loadType,u.playerConfig.nonce)];case 1:return m=g.sent(),[3,4];case 2:return[4,(0,S.setupHlsAndBuildPipe)(l,u.config.loadType,u.playerConfig.nonce)];case 3:m=g.sent(),g.label=4;case 4:return f.pipe=m,this.pipe.registerObserver(this),[4,this.message(\"configure\").send(d,h)];case 5:return g.sent(),[2]}}))}))},PlayerWrapper.prototype.message=function(l){var d=this;return{send:this.fromMessage((function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];return d.sendMessageImpl.apply(d,m([l],f(u),!1))}))}},PlayerWrapper.prototype.dispose=function(){l.prototype.dispose.call(this),this.pipe.sendMsg(this.buildMsg(\"dispose\")),this.pipe.dispose()},PlayerWrapper.prototype.getPlayerDiagnosticSnapshot=function(){return this.lastDiagnosticData},PlayerWrapper.prototype.processMessage=function(l){var d,u;switch(l.msgType){case\"CommandResult\":(d=this.resultsMap.get(l.cmd.toString()))&&(l.error?d.reject(l.error):d.resolve(),l.error&&this.logger.warn(\"remote command failed: \".concat(l.cmd,\", \").concat(l.error)),this.resultsMap.delete(l.toString()));break;case\"PlayerNotification\":(u=this.event(l.name)).raise.apply(u,l.args);break;default:this.logger.warn(\"unexpected message received: \".concat(JSON.stringify(l)))}},PlayerWrapper.prototype.fromMessage=function(l){return l},PlayerWrapper.prototype.sendMessageImpl=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];return this.pipe.sendMsg(this.buildMsg(l,d)),this.waitForCompletion(l.toString())},PlayerWrapper.prototype.buildMsg=function(l,d){return{msgType:\"Command\",cmd:l,args:d}},PlayerWrapper.prototype.waitForCompletion=function(l){var d=this.resultsMap.get(l);d&&d.reject(new Error(\"function \".concat(l,\" is invoked again, before previos call is completed\")));var u=v.defer();return this.resultsMap.set(l,u),u.promise},PlayerWrapper}(y.default);d.PlayerWrapper=_},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.LiveStreamRenderer=void 0;var g=function(l){function LiveStreamRenderer(d,u){var p=l.call(this)||this;return p.player=d,p.logger=u,p.playerSubs=[],p.subscribeForPlayerEvents(),p}return p(LiveStreamRenderer,l),Object.defineProperty(LiveStreamRenderer.prototype,\"isRendering\",{get:function(){return!!this.player&&this.player.isRendering()},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamRenderer.prototype,\"streamSize\",{get:function(){return this.player?this.player.getStreamSize():{width:0,height:0}},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamRenderer.prototype,\"rendererType\",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamRenderer.prototype,\"frameType\",{get:function(){return-1},enumerable:!1,configurable:!0}),LiveStreamRenderer.prototype.dispose=function(){this.stopPlayer(),l.prototype.dispose.call(this)},LiveStreamRenderer.prototype.captions=function(){return this.player.getCaptionsControl()},LiveStreamRenderer.prototype.getStats=function(){throw new Error(\"Method not implemented.\")},LiveStreamRenderer.prototype.setScalingMode=function(l,d){throw new Error(\"Method not implemented.\")},LiveStreamRenderer.prototype.captureFrame=function(l,d){throw new Error(\"Method not implemented.\")},LiveStreamRenderer.prototype.stopPlayer=function(){var l=this.player;this.player=null,l&&(this.logger.info(\"stopPlayer\"),this.unsubscribeFromPlayerEvents(),l.stop())},LiveStreamRenderer.prototype.subscribeForPlayerEvents=function(){var l=this;this.playerSubs.push(this.player.on(\"fullscreenToggled\",(function(d){return l.onFullScreenToggled(d)}))),this.playerSubs.push(this.player.on(\"captionsToggled\",(function(d,u,p){return l.onCaptionsToggled(d,u,p)})))},LiveStreamRenderer.prototype.unsubscribeFromPlayerEvents=function(){var l,d;try{for(var u=h(this.playerSubs),p=u.next();!p.done;p=u.next()){p.value.dispose()}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}this.playerSubs=[]},LiveStreamRenderer.prototype.onFullScreenToggled=function(l){this.event(\"fullScreenToggled\").raise(l)},LiveStreamRenderer.prototype.onCaptionsToggled=function(l,d,u){this.logger.info(\"Turned captions \".concat(l?\"ON\":\"OFF\",\" for culture [\").concat(d,\"] at player time [\").concat(u,\"]\")),this.event(\"captionsToggled\").raise(l,d,u)},LiveStreamRenderer}(u(18).default);d.LiveStreamRenderer=g},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.CaptionsControl=void 0;var g=function(){function CaptionsControl(l,d){var u=this;this.player=l,this.availableCultures=d,this.selectedCulture=\"\",this.disposable=this.player.on(\"captionsToggled\",(function(l,d,p){u.selectedCulture=l?d:\"\"}))}return CaptionsControl.prototype.addCues=function(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){switch(d.label){case 0:return[4,this.player.message(\"addCues\").send(l)];case 1:return d.sent(),[2]}}))}))},CaptionsControl.prototype.clearCues=function(){return p(this,void 0,void 0,(function(){return h(this,(function(l){switch(l.label){case 0:return[4,this.player.message(\"clearCues\").send()];case 1:return l.sent(),[2]}}))}))},CaptionsControl.prototype.showCaptions=function(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){switch(d.label){case 0:return[4,this.player.message(\"showCaptions\").send(l)];case 1:return d.sent(),[2]}}))}))},CaptionsControl.prototype.getSelectedCulture=function(){return this.selectedCulture},CaptionsControl.prototype.getAvailableCultures=function(){return this.availableCultures},CaptionsControl.prototype.dispose=function(){this.disposable.dispose(),this.player=null},CaptionsControl}();d.CaptionsControl=g},function(l,d,u){u.d(d,\"a\",(function(){return m}));var p=u(36),h=u(0),g=u(52),f=\"getPlugin\",m=function(){function BaseTelemetryPlugin(){var l=this,d=!1,u=null,m=null;l.core=null,l.diagLog=function(d){return l._getTelCtx(d).diagLog()},l.isInitialized=function(){return d},l.setInitialized=function(l){d=l},l.setNextPlugin=function(l){m=l},l.processNext=function(l,d){d?d.processNext(l):m&&Object(h.o)(m.processTelemetry)&&m.processTelemetry(l,null)},l._getTelCtx=function(d){void 0===d&&(d=null);var h=d;if(!h){var g=u||new p.a(null,{},l.core);h=m&&m[f]?g.createNew(null,m[f]):g.createNew(null,m)}return h},l._baseTelInit=function(v,y,S,_){v&&Object(h.D)(v,g.a,[],null,h.r),!_&&y&&(_=y.getProcessTelContext().getNext());var C=m;m&&m[f]&&(C=m[f]()),l.core=y,u=new p.a(_,v,y,C),d=!0}}return BaseTelemetryPlugin.prototype.initialize=function(l,d,u,p){this._baseTelInit(l,d,u,p)},BaseTelemetryPlugin}()},function(l,d,u){u.d(d,\"a\",(function(){return f})),u.d(d,\"b\",(function(){return __extendsFn})),u.d(d,\"c\",(function(){return __spreadArrayFn}));var p=u(2),h=u(31),g=((Object(h.a)()||{}).Symbol,(Object(h.a)()||{}).Reflect,function(l){for(var d,u=1,h=arguments.length;u<h;u++)for(var g in d=arguments[u])p.f[p.i].call(d,g)&&(l[g]=d[g]);return l}),f=p.a||g,extendStaticsFn=function(l,d){return(extendStaticsFn=p.b.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d[p.i](u)&&(l[u]=d[u])})(l,d)};function __extendsFn(l,d){function __(){this.constructor=l}typeof d!==p.h&&null!==d&&Object(h.c)(\"Class extends value \"+String(d)+\" is not a constructor or null\"),extendStaticsFn(l,d),l[p.k]=null===d?Object(h.b)(d):(__[p.k]=d[p.k],new __)}function __spreadArrayFn(l,d){for(var u=0,p=d.length,h=l.length;u<p;u++,h++)l[h]=d[u];return l}},,function(l,d,u){u(89),u(60),u(122),u(115),u(91),u(117),u(62),u(171),u(172),u(173),l.exports=u(487)},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.compareMeetingData=d.getMeetingCodeFromMeetingUrl=d.sanitizeMeetingCode=d.isMeetingCodeUrl=void 0;var p=u(14);function isMeetingCodeUrl(l){var d=new URL(l).pathname.split(\"/\");return d.pop(),\"meet\"===d.pop()}function sanitizeMeetingCode(l,d,u){if(!l)return u.info(\"sanitizeMeetingCode[\".concat(d,\"] empty / undefined meeting code parameter\")),l;var p=l.replace(/\\s/g,\"\");return p=p.replace(/-/g,\"\"),u.info(\"sanitizeMeetingCode[\".concat(d,\"] meetingCode: \").concat(l,\", sanitizedMeetingCode: \").concat(p)),p}function getMeetingCodeFromMeetingUrl(l,d,u){if(!l)return u.info(\"getMeetingCodeFromMeetingUrl[\".concat(d,\"] empty / undefined meeting Url parameter\")),l;var h=new URL(l),g=\"\";if(h&&h.pathname&&h.pathname.split(\"/\").length>=2){var f=h.pathname.split(\"/\");\"meet\"===f[f.length-2]&&(g=f[f.length-1])}return u.info(\"getMeetingCodeFromMeetingUrl[\".concat(d,\"] meetingUrl: \").concat(l,\", meetingUrlObject: \").concat((0,p.safeJsonStringify)(h),\", meetingCode: \").concat(g)),g}function compareMeetingData(l,d,u,p){var h=sanitizeMeetingCode(l&&l.meetingCode||\"\",u,p),g=sanitizeMeetingCode(d&&d.meetingCode||\"\",u,p),definedAndEqual=function(l,d){return!!l&&!!d&&l===d};if(definedAndEqual(h,g))return!0;var f=getMeetingCodeFromMeetingUrl(l&&l.meetingUrl||\"\",u,p);f=sanitizeMeetingCode(f,u,p);var m=getMeetingCodeFromMeetingUrl(d&&d.meetingUrl||\"\",u,p);if(definedAndEqual(f,m=sanitizeMeetingCode(m,u,p)))return!0;if(definedAndEqual(f,g)||definedAndEqual(m,h))return!0;if(l&&l.meetingUrl&&d&&d.meetingUrl){var v=new URL(l.meetingUrl),y=new URL(d.meetingUrl);if(v.hostname===y.hostname&&v.pathname===y.pathname)return!0}return!1}d.isMeetingCodeUrl=isMeetingCodeUrl,d.sanitizeMeetingCode=sanitizeMeetingCode,d.getMeetingCodeFromMeetingUrl=getMeetingCodeFromMeetingUrl,d.compareMeetingData=compareMeetingData},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.EventSourceImpl=void 0;var p=u(8),h=u(35),g=function(){function EventSourceImpl(l){this.subscriptions=[],this.eventLogger=l}return EventSourceImpl.prototype.subscribe=function(l){return new f(this.subscriptions,l)},EventSourceImpl.prototype.dispose=function(l){this.subscriptions=[]},EventSourceImpl.prototype.raiseEvents=function(l){var d=this;this.subscriptions.slice().forEach((function(u){try{void 0!==u.eventHandler&&l(u.eventHandler)}catch(l){d.eventLogger&&d.eventLogger.warn&&d.eventLogger.warn(\"Event handler exception caught!\",(0,h.stringifyObject)(l))}}))},EventSourceImpl}();d.EventSourceImpl=g;var f=function(){function EventSubscriptionImpl(l,d){this.subscriptions=l,this.eventHandler=d,this.subscriptions.push(this)}return EventSubscriptionImpl.prototype.dispose=function(){var l=this;p.remove(this.subscriptions,(function(d){return d===l})),this.eventHandler=void 0},EventSubscriptionImpl}()},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(54),g=u(17),f=u(40),m=u(13),v=u(14),y=function(){function AsyncOperationHandler(l){var d=this;this._disposed=!1,this._logger=l.createChild(\"[ASYNC]\"),this._endOperationDeferred=f.defer(),this._endOperationDeferred.promise.catch((function(l){d._logger.info(\"Rejected all operations\")})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._deferredOperationsWithCauseId={},this._logger=l}return AsyncOperationHandler.prototype.registerPromise=function(l,d){var u=!1,always=function(){u=!0};d.then(always,always);var p=this._endOperationDeferred.promise.catch((function(d){if(!u)throw new Error(\"Operation \".concat(l,\" did not complete, reason:\").concat(d))}));return Promise.race([p,d])},AsyncOperationHandler.prototype.updateOperationId=function(l,d){var u=this;this._logger.info(\"updateOperationId \".concat(l,\" \").concat(d)),Object.keys(this._deferredOperationsWithOperationId).forEach((function(p){p&&u._deferredOperationsWithOperationId[p]&&(u._logger.info(\"_deferredOperationsWithOperationId \".concat(p)),Object.keys(u._deferredOperationsWithOperationId[p]).forEach((function(h){h&&u._deferredOperationsWithOperationId[p][h]&&(u._logger.info(\"_deferredOperationsWithOperationId \".concat(h,\" \").concat(d)),h===l&&(u._deferredOperationsWithOperationId[p][d]=u._deferredOperationsWithOperationId[p][h],delete u._deferredOperationsWithOperationId[p][h]))})))})),Object.keys(this._deferredOperationsWithCauseId).forEach((function(p){p&&u._deferredOperationsWithCauseId[p]&&(u._logger.info(\"_deferredOperationsWithCauseId \".concat(p)),Object.keys(u._deferredOperationsWithCauseId[p]).forEach((function(h){h&&u._deferredOperationsWithCauseId[p][h]&&(u._logger.info(\"_deferredOperationsWithCauseId \".concat(h,\" \").concat(d)),h===l&&(u._deferredOperationsWithOperationId[p][d]=u._deferredOperationsWithOperationId[p][h],delete u._deferredOperationsWithOperationId[p][h]))})))}))},AsyncOperationHandler.prototype.createPendingOperation=function(l,d,u,p){var v=this;void 0===u&&(u=(0,m.generateCauseId)()),void 0===p&&(p={});var y=f.defer();y.promise.catch(h.noop);var S,_=this.getOperationInfoForLogging(u,l,d);if(this._logger.info(\"\".concat(_,\"[creating...]\")),this._disposed)return this._logger.info(\"\".concat(_,\"[create failed, call is disposed]\")),Promise.reject(60);if(d){if(this._deferredOperationsWithOperationId[l]||(this._deferredOperationsWithOperationId[l]={}),this._deferredOperationsWithOperationId[l][d])return this._logger.warn(\"\".concat(_,\" Deferred operation with given name and operation id is already defined\")),Promise.reject(new Error(\"Deferred operation with given name is already defined:\".concat(l,\"/\").concat(g.scrubMriOrOmit(d))));this._deferredOperationsWithOperationId[l][d]={deferred:y,causeId:u},this._deferredOperationsWithCauseId[u]||(this._deferredOperationsWithCauseId[u]={}),this._deferredOperationsWithCauseId[u][d]={deferred:y,options:p,operationName:l},S=this._endOperationDeferred.promise.catch((function(u){if(v.hasPendingOperationWithOperationId(l,d))throw new Error(\"Operation \".concat(l,\" \").concat(d,\" did not complete, reason:\").concat(u))}))}else{if(this._deferredOperations[l])return this._logger.warn(\"\".concat(_,\" Deferred operation with given name is already defined\")),Promise.reject(new Error(\"Deferred operation with given name is already defined:\".concat(l)));this._deferredOperationsWithCauseId[u]||(this._deferredOperationsWithCauseId[u]={}),this._deferredOperationsWithCauseId[u][\"\"]={deferred:y,options:p,operationName:l},this._deferredOperations[l]={deferred:y,causeId:u},S=this._endOperationDeferred.promise.catch((function(d){if(v.hasPendingOperation(l))throw new Error(\"Operation \".concat(l,\" did not complete, reason:\").concat(d))}))}return Promise.race([S,y.promise])},AsyncOperationHandler.prototype.hasPendingOperation=function(l){return!!this._deferredOperations[l]},AsyncOperationHandler.prototype.hasAtleastOneOfPendingOperation=function(l){var d,u;try{for(var h=p(l),g=h.next();!g.done;g=h.next()){var f=g.value;if(this.hasPendingOperation(f))return!0}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}return!1},AsyncOperationHandler.prototype.hasPendingOperationWithOperationId=function(l,d){return!(!d||!this._deferredOperationsWithOperationId[l])&&!!this._deferredOperationsWithOperationId[l][d]},AsyncOperationHandler.prototype.hasPendingOperationWithCauseId=function(l,d){var u=d||\"\";return this._deferredOperationsWithCauseId[l]&&!!this._deferredOperationsWithCauseId[l][u]},AsyncOperationHandler.prototype.getPendingOperationWithCauseId=function(l,d){return this.hasPendingOperationWithCauseId(l,d)?this._deferredOperationsWithCauseId[l][d].deferred.promise:Promise.reject(\"[\".concat(l,\"][\").concat(d,\"]: getPendingOperationWithCauseId for given causeId, operationId\"))},AsyncOperationHandler.prototype.resolveOperationWithCauseId=function(l,d,u){var p=d||\"\";if(this.hasPendingOperationWithCauseId(l,p)){var h=this._deferredOperationsWithCauseId[l][p],g=h.deferred.promise;return h.deferred.resolve(u),this._logger.info(\"[\".concat(l,\"][\").concat(p,\"] resolved, result=\").concat((0,v.getPrintableObject)(u)||\"void\")),delete this._deferredOperationsWithCauseId[l][p],g}return Promise.reject(\"[\".concat(l,\"][\").concat(p,\"] resolveOperationWithCauseId failed, operation not found\"))},AsyncOperationHandler.prototype.rejectOperationWithCauseId=function(l,d,u){var p=d||\"\";if(this.hasPendingOperationWithCauseId(l,p)){var g=this._deferredOperationsWithCauseId[l][p],f=g.deferred.promise;return f.catch(h.noop),g.deferred.reject(u),this._logger.info(\"[\".concat(l,\"][\").concat(p,\"] rejected, result=\").concat((0,v.getPrintableObject)(u)||\"void\")),delete this._deferredOperationsWithCauseId[l][p],f}return Promise.reject(\"[\".concat(l,\"][\").concat(p,\"] rejectOperationWithCauseId failed, operation not found\"))},AsyncOperationHandler.prototype.maybeResolveOperationWithCauseId=function(l,d,u){var p=this;this.hasPendingOperationWithCauseId(l,d)?this.resolveOperationWithCauseId(l,d,u).catch((function(d){p._logger.info(\"\".concat(l,\"maybeResolveOperationWithCauseId failed, reason=\").concat((0,v.getPrintableObject)(d)))})):this._logger.info(\"\".concat(l,\"maybeResolveOperationWithCauseId ignored, operation does not exist\"))},AsyncOperationHandler.prototype.maybeRejectOperationWithCauseId=function(l,d,u){this.hasPendingOperationWithCauseId(l,d)?this.rejectOperationWithCauseId(l,d,u).catch(h.noop):this._logger.info(\"\".concat(l,\"maybeRejectOperationWithCauseId ignored, operation does not exist\"))},AsyncOperationHandler.prototype.getPendingOperation=function(l,d,u){return void 0===u&&(u=(0,m.generateCauseId)()),!d&&this._deferredOperations[l]?this._deferredOperations[l].deferred.promise:d&&this._deferredOperationsWithOperationId[l]&&this._deferredOperationsWithOperationId[l][d]?this._deferredOperationsWithOperationId[l][d].deferred.promise:Promise.reject(\"\".concat(this.getOperationInfoForLogging(u,l,d),\": Deferred operation with given name and operation does not exist\"))},AsyncOperationHandler.prototype.waitForOperation=function(l,d,u){return void 0===u&&(u=(0,m.generateCauseId)()),d&&this.hasPendingOperationWithOperationId(l,d)?this._deferredOperationsWithOperationId[l][d].deferred.promise:this.hasPendingOperation(l)?this._deferredOperations[l].deferred.promise:Promise.reject(\"\".concat(this.getOperationInfoForLogging(u,l,d),\"failed=wait failed, operation not found\"))},AsyncOperationHandler.prototype.resolveOperation=function(l,d,u,p,h){if(void 0===p&&(p=(0,m.generateCauseId)()),void 0===h&&(h=!1),!l)return Promise.reject(\"Unable to resolve deferred operation with empty name\");if(u&&this.hasPendingOperationWithOperationId(l,u)){var g=(f=this._deferredOperationsWithOperationId[l][u]).deferred.promise;return f.deferred.resolve(d),this._logger.info(\"\".concat(this.getOperationInfoForLogging(f.causeId,l,u),\"resolved, result=\").concat((0,v.getPrintableObject)(d)||\"void\")),h||delete this._deferredOperationsWithOperationId[l][u],g}if(this.hasPendingOperation(l)){var f=this._deferredOperations[l];g=this._deferredOperations[l].deferred.promise;return this._deferredOperations[l].deferred.resolve(d),this._logger.info(\"\".concat(this.getOperationInfoForLogging(f.causeId,l,u),\"resolved, result=\").concat((0,v.getPrintableObject)(d)||\"void\")),h||delete this._deferredOperations[l],g}return Promise.reject(\"\".concat(this.getOperationInfoForLogging(p,l,u),\"failed=resolve failed, operation not found\"))},AsyncOperationHandler.prototype.rejectOperation=function(l,d,u,p){return void 0===p&&(p=(0,m.generateCauseId)()),l?u&&this.hasPendingOperationWithOperationId(l,u)?((f=(g=this._deferredOperationsWithOperationId[l][u]).deferred.promise).catch(h.noop),g.deferred.reject(d),this._logger.info(\"\".concat(this.getOperationInfoForLogging(g.causeId,l,u),\"rejected, reason=\").concat((0,v.getPrintableObject)(d)||\"void\")),delete this._deferredOperationsWithOperationId[l][u],f):this.hasPendingOperation(l)?((f=(g=this._deferredOperations[l]).deferred.promise).catch(h.noop),g.deferred.reject(d),this._logger.info(\"\".concat(this.getOperationInfoForLogging(g.causeId,l,u),\"rejected, reason=\").concat((0,v.getPrintableObject)(d)||\"void\")),delete this._deferredOperations[l],f):Promise.reject(\"\".concat(this.getOperationInfoForLogging(p,l,u),\"failed=reject failed, operation not found\")):Promise.reject(\"Unable to reject deferred operation with empty name\");var g,f},AsyncOperationHandler.prototype.maybeResolveOperation=function(l,d,u,p){var h=this;void 0===p&&(p=(0,m.generateCauseId)());var g=this.getOperationInfoForLogging(p,l,u);u&&this.hasPendingOperationWithOperationId(l,u)||this.hasPendingOperation(l)?this.resolveOperation(l,d,u,p).catch((function(l){h._logger.info(\"\".concat(g,\"maybeResolveOperation failed, reason=\").concat((0,v.getPrintableObject)(l)))})):this._logger.info(\"\".concat(g,\"maybeResolveOperation ignored, operation does not exist\"))},AsyncOperationHandler.prototype.maybeResolveOperations=function(l,d,u,h){var g,f;void 0===h&&(h=(0,m.generateCauseId)());try{for(var v=p(l),y=v.next();!y.done;y=v.next()){var S=y.value;this.maybeResolveOperation(S,d,u,h)}}catch(l){g={error:l}}finally{try{y&&!y.done&&(f=v.return)&&f.call(v)}finally{if(g)throw g.error}}},AsyncOperationHandler.prototype.maybeRejectOperation=function(l,d,u,p){void 0===p&&(p=(0,m.generateCauseId)());var g=this.getOperationInfoForLogging(p,l,u);u&&this.hasPendingOperationWithOperationId(l,u)||this.hasPendingOperation(l)?this.rejectOperation(l,d,u,p).catch(h.noop):this._logger.info(\"\".concat(g,\"maybeRejectOperation ignored, operation does not exist\"))},AsyncOperationHandler.prototype.maybeRejectOperations=function(l,d,u,h){var g,f;void 0===h&&(h=(0,m.generateCauseId)());try{for(var v=p(l),y=v.next();!y.done;y=v.next()){var S=y.value;this.maybeRejectOperation(S,d,u,h)}}catch(l){g={error:l}}finally{try{y&&!y.done&&(f=v.return)&&f.call(v)}finally{if(g)throw g.error}}},AsyncOperationHandler.prototype.rejectPendingOperations=function(l,d){var u=this;void 0===d&&(d=(0,m.generateCauseId)()),this._disposed=!0,this._logger.info(\"[\".concat(d,\"]rejectPendingOperations=\").concat(l)),Object.keys(this._deferredOperations).forEach((function(p){u.maybeRejectOperation(p,l,void 0,d),u._deferredOperationsWithOperationId[d]&&delete u._deferredOperationsWithOperationId[d][\"\"]})),Object.keys(this._deferredOperationsWithOperationId).forEach((function(p){Object.keys(u._deferredOperationsWithOperationId[p]).forEach((function(h){u.maybeRejectOperation(p,l,h,d),u._deferredOperationsWithOperationId[d]&&delete u._deferredOperationsWithOperationId[d][h]}))})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._endOperationDeferred.reject(l)},AsyncOperationHandler.prototype.maybeRejectPendingOperationsWithPredicate=function(l,d,u){var p=this;void 0===d&&(d=(0,m.generateCauseId)()),this._logger.info(\"[\".concat(d,\"]rejectPendingOperationsWithPredicate\")),Object.keys(this._deferredOperationsWithCauseId).forEach((function(d){Object.keys(p._deferredOperationsWithCauseId[d]).forEach((function(h){var g=p._deferredOperationsWithCauseId[d][h];g&&u(g.operationName,g.options)&&(p.maybeRejectOperation(g.operationName,l,h),p.maybeRejectOperationWithCauseId(d,h,l))}))}))},AsyncOperationHandler.prototype.getOperationInfoForLogging=function(l,d,u){void 0===u&&(u=\"\");var p=u?\"[\".concat(g.scrubMriOrOmit(u),\"]\"):\"\";return\"[\".concat(l,\"][\").concat(d,\"]\").concat(p)},AsyncOperationHandler}();d.default=y},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(8),h=u(13),g=u(14),f=function(){function ChainedPromise(l){this._logger=l,this._promise=Promise.resolve(void 0),this._actionQueue=[]}return ChainedPromise.prototype.chainPromise=function(l,d,u,f){var m=this;void 0===u&&(u=(0,h.generateCauseId)()),void 0===f&&(f=!1);var v=Date.now(),y=((\"function\"==typeof d?d():d)||\"\").toString();this._actionQueue.push(y),this._logger.info(\"[\".concat(u,\"][\").concat(y,\"]enqueueing, queue=[\").concat(this._actionQueue,\"], reset=\").concat(f));var removeFromQueue=function(){m._actionQueue=m._actionQueue.filter((function(l){return l!==y}))};return f&&this.reset(u),this._promise=this._promise.catch(p.noop).then((function(){var d=Date.now()-v;return m._logger.info(\"[\".concat(u,\"][\").concat(y,\"]begin, delayMs=\").concat(d)),l()})),this._promise.then((function(){removeFromQueue();var l=Date.now()-v;m._logger.info(\"[\".concat(u,\"][\").concat(y,\"]success, durationMs=\").concat(l))}),(function(l){removeFromQueue();var d=Date.now()-v;m._logger.warn(\"[\".concat(u,\"][\").concat(y,\"]failed=\").concat((0,g.safeJsonStringify)(l),\", durationMs=\").concat(d))})),this._promise},ChainedPromise.prototype.reset=function(l){this._logger.info(\"[\".concat(l,\"] resetting\")),this._promise=Promise.resolve(void 0)},ChainedPromise}();d.default=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.build=d.Stopwatch=void 0;var p=function(){function Stopwatch(){var l=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){l.isPaused||(l.msElapsed+=(new Date).getTime()-l._startTime,l.isPaused=!0)},this.resume=function(){l.isPaused&&(l.isPaused=!1,l._startTime=(new Date).getTime())},this.duration=function(){return l.isPaused?l.msElapsed:l.msElapsed+(new Date).getTime()-l._startTime},this.durationInMinutes=function(){var d=l.duration()/6e4;return Math.ceil(d)},this.durationInSeconds=function(){var d=l.duration()/1e3;return Math.ceil(d)}}return Object.defineProperty(Stopwatch.prototype,\"startTime\",{get:function(){return this._startTime},enumerable:!1,configurable:!0}),Stopwatch}();function build(){return new p}d.Stopwatch=p,d.build=build},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaControlPlane=void 0;var m=u(18),v=u(35),y=u(29),S=18,_=4294967292,C=function(l){function MediaControlPlane(d,u,p){var h=l.call(this)||this;return h.dcAdapter=d,h.logger=u,h.mcpConfig=p,h.dcSend=null,h.telemetryLogger=new E,h.handshakePromise=new y.SettablePromise,h.isStarted=!1,h}return p(MediaControlPlane,l),MediaControlPlane.prototype.dispose=function(){l.prototype.dispose.call(this),this.isStarted&&this.dcAdapter.removeHandler(S),this.handshakePromise.promise.catch((function(){})),this.handshakePromise.reject(\"mcp disposed\"),this.dcSend=null},MediaControlPlane.prototype.getTelemetryReport=function(){return this.logger.debug(\"MCP telemetry \".concat(JSON.stringify(this.telemetryLogger.getReport()))),this.telemetryLogger.getReport()},MediaControlPlane.prototype.sendMsg=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){switch(d.label){case 0:return[4,this.handshakePromise.promise];case 1:return d.sent(),[2,this.sendMsgInternal(l)]}}))}))},MediaControlPlane.prototype.start=function(){var l=this;if(!this.isStarted&&this.mcpConfig){this.isStarted=!0;var d={onStarted:function(d,u){return h(l,void 0,void 0,(function(){return g(this,(function(l){switch(l.label){case 0:return this.logger.info(\"Data channel handler is started \".concat(d)),this.telemetryLogger.logStarted(),this.dcSend=u,[4,this.startHandshake()];case 1:return l.sent(),[2]}}))}))},onStopped:function(d){return h(l,void 0,void 0,(function(){return g(this,(function(l){return this.logger.info(\"Data channel handler is stopped \".concat(d)),this.telemetryLogger.logStopped(),this.dcSend=null,[2]}))}))},onDataReceived:function(d,u,p){return h(l,void 0,void 0,(function(){return g(this,(function(l){return this.processIncomingData(u),[2]}))}))}};this.dcAdapter.addHandler(S,d)}},MediaControlPlane.prototype.startHandshake=function(){return h(this,void 0,void 0,(function(){var l;return g(this,(function(d){switch(d.label){case 0:this.handshakePromise.isPending||(this.handshakePromise=new y.SettablePromise),this.telemetryLogger.logHandshakeStarted(),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.sendMsgInternal({type:\"syn\"})];case 2:return d.sent(),[3,4];case 3:return l=d.sent(),this.handshakePromise.reject(l),[3,4];case 4:return[2]}}))}))},MediaControlPlane.prototype.sendMsgInternal=function(l){return h(this,void 0,void 0,(function(){var d,u,p,h,m,y,S,C,E;return g(this,(function(g){switch(g.label){case 0:d=Array.isArray(l)?l:[l],u=(new TextEncoder).encode(JSON.stringify(d)),(p=new Uint8Array(1+u.length))[0]=1,p.set(u,1),g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.dcSend(p,[_])];case 2:g.sent();try{for(h=f(d),m=h.next();!m.done;m=h.next())y=m.value,this.telemetryLogger.logSentMsg(y)}catch(l){C={error:l}}finally{try{m&&!m.done&&(E=h.return)&&E.call(h)}finally{if(C)throw C.error}}return[3,4];case 3:throw S=g.sent(),this.logger.error(\"send failed: \".concat((0,v.stringifyObject)(S))),this.telemetryLogger.logSentFailed((0,v.stringifyObject)(S)),S;case 4:return[2]}}))}))},MediaControlPlane.prototype.processIncomingData=function(l){var d,u;if(1!==l[0]){var p=\"unsupported header version \".concat(l[0]);return this.logger.info(p),void this.telemetryLogger.logRecvFailed(p)}var h,g=new DataView(l.buffer,1);try{var m=(new TextDecoder).decode(g);h=JSON.parse(m)}catch(l){return this.logger.error(\"Failed to parse received data, error \".concat((0,v.stringifyObject)(l))),void this.telemetryLogger.logRecvFailed((0,v.stringifyObject)(l))}try{for(var y=f(h),S=y.next();!S.done;S=y.next()){var _=S.value;switch(this.telemetryLogger.logReceivedMsg(_),_.type){case\"syn\":this.logger.debug(\"\".concat(_.type,\" received\"));break;case\"ack\":this.logger.debug(\"\".concat(_.type,\" received\")),this.telemetryLogger.logHandshakeCompleted(_),this.handshakePromise.resolve();break;case\"bwe\":this.processBweMsg(_);break;default:p=\"Unsupported msg type \".concat(_.type);this.logger.error(p),this.telemetryLogger.logRecvFailed(p)}}}catch(l){d={error:l}}finally{try{S&&!S.done&&(u=y.return)&&u.call(y)}finally{if(d)throw d.error}}},MediaControlPlane.prototype.processBweMsg=function(l){this.mcpConfig.enableBweNotifications&&this.event(\"mpSendBandwidthChanged\").raise(l.bw)},MediaControlPlane}(m.default);d.MediaControlPlane=C;var E=function(){function TelemetryLogger(){this.storage={createTime:Date.now(),startedTs:-1,stoppedTs:-1,handshakeDuration:-1,mpCapabilities:{},sentMessages:{},recvMessages:{},sentFailed:0,recvFailed:0}}return TelemetryLogger.prototype.logStarted=function(){this.storage.startedTs=-1===this.storage.startedTs?duration(this.storage.createTime):this.storage.startedTs},TelemetryLogger.prototype.logStopped=function(){this.storage.stoppedTs=duration(this.storage.createTime)},TelemetryLogger.prototype.logSentMsg=function(l){var d,u,p;null!==(d=(u=this.storage.sentMessages)[p=l.type])&&void 0!==d||(u[p]=0),this.storage.sentMessages[l.type]++},TelemetryLogger.prototype.logReceivedMsg=function(l){var d,u,p;null!==(d=(u=this.storage.recvMessages)[p=l.type])&&void 0!==d||(u[p]=0),this.storage.recvMessages[l.type]++},TelemetryLogger.prototype.logHandshakeStarted=function(){this.handshakeStartedTs=Date.now()},TelemetryLogger.prototype.logHandshakeCompleted=function(l){-1===this.storage.handshakeDuration&&(this.storage.handshakeDuration=duration(this.handshakeStartedTs)),this.storage.mpCapabilities.send=l.send_capabilities},TelemetryLogger.prototype.logSentFailed=function(l){this.storage.sentFailed++,this.storage.lastSentFailed={ts:duration(this.storage.createTime),error:l}},TelemetryLogger.prototype.logRecvFailed=function(l){this.storage.recvFailed++,this.storage.lastRecvFailed={ts:duration(this.storage.createTime),error:l}},TelemetryLogger.prototype.getReport=function(){return this.storage},TelemetryLogger}();function duration(l){return Date.now()-l}},function(l,d,u){var p=u(188),h=u(38),g=u(96),f=u(75),m=u(97),v=Object.prototype.toString,y=0,S=4,_=0,C=1,E=2,T=-1,b=0,I=8;function Deflate(l){if(!(this instanceof Deflate))return new Deflate(l);this.options=h.assign({level:T,method:I,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:\"\"},l||{});var d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var u=p.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(u!==_)throw new Error(f[u]);if(d.header&&p.deflateSetHeader(this.strm,d.header),d.dictionary){var y;if(y=\"string\"==typeof d.dictionary?g.string2buf(d.dictionary):\"[object ArrayBuffer]\"===v.call(d.dictionary)?new Uint8Array(d.dictionary):d.dictionary,(u=p.deflateSetDictionary(this.strm,y))!==_)throw new Error(f[u]);this._dict_set=!0}}function deflate(l,d){var u=new Deflate(d);if(u.push(l,!0),u.err)throw u.msg||f[u.err];return u.result}function deflateRaw(l,d){return(d=d||{}).raw=!0,deflate(l,d)}function gzip(l,d){return(d=d||{}).gzip=!0,deflate(l,d)}Deflate.prototype.push=function(l,d){var u,f,m=this.strm,T=this.options.chunkSize;if(this.ended)return!1;f=d===~~d?d:!0===d?S:y,\"string\"==typeof l?m.input=g.string2buf(l):\"[object ArrayBuffer]\"===v.call(l)?m.input=new Uint8Array(l):m.input=l,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(T),m.next_out=0,m.avail_out=T),(u=p.deflate(m,f))!==C&&u!==_)return this.onEnd(u),this.ended=!0,!1;0!==m.avail_out&&(0!==m.avail_in||f!==S&&f!==E)||(\"string\"===this.options.to?this.onData(g.buf2binstring(h.shrinkBuf(m.output,m.next_out))):this.onData(h.shrinkBuf(m.output,m.next_out)))}while((m.avail_in>0||0===m.avail_out)&&u!==C);return f===S?(u=p.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===_):f!==E||(this.onEnd(_),m.avail_out=0,!0)},Deflate.prototype.onData=function(l){this.chunks.push(l)},Deflate.prototype.onEnd=function(l){l===_&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg},d.Deflate=Deflate,d.deflate=deflate,d.deflateRaw=deflateRaw,d.gzip=gzip},function(l,d,u){var p,h=u(38),g=u(189),f=u(94),m=u(95),v=u(75),y=0,S=1,_=3,C=4,E=5,T=0,b=1,I=-2,A=-3,R=-5,P=-1,O=1,M=2,w=3,N=4,D=0,L=2,k=8,x=9,F=15,U=8,j=256+1+29,B=30,V=19,H=2*j+1,G=15,W=3,q=258,z=q+W+1,K=32,J=42,Q=69,Y=73,$=91,X=103,Z=113,ee=666,te=1,ne=2,ie=3,re=4,oe=3;function err(l,d){return l.msg=v[d],d}function rank(l){return(l<<1)-(l>4?9:0)}function zero(l){for(var d=l.length;--d>=0;)l[d]=0}function flush_pending(l){var d=l.state,u=d.pending;u>l.avail_out&&(u=l.avail_out),0!==u&&(h.arraySet(l.output,d.pending_buf,d.pending_out,u,l.next_out),l.next_out+=u,d.pending_out+=u,l.total_out+=u,l.avail_out-=u,d.pending-=u,0===d.pending&&(d.pending_out=0))}function flush_block_only(l,d){g._tr_flush_block(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,d),l.block_start=l.strstart,flush_pending(l.strm)}function put_byte(l,d){l.pending_buf[l.pending++]=d}function putShortMSB(l,d){l.pending_buf[l.pending++]=d>>>8&255,l.pending_buf[l.pending++]=255&d}function read_buf(l,d,u,p){var g=l.avail_in;return g>p&&(g=p),0===g?0:(l.avail_in-=g,h.arraySet(d,l.input,l.next_in,g,u),1===l.state.wrap?l.adler=f(l.adler,d,g,u):2===l.state.wrap&&(l.adler=m(l.adler,d,g,u)),l.next_in+=g,l.total_in+=g,g)}function longest_match(l,d){var u,p,h=l.max_chain_length,g=l.strstart,f=l.prev_length,m=l.nice_match,v=l.strstart>l.w_size-z?l.strstart-(l.w_size-z):0,y=l.window,S=l.w_mask,_=l.prev,C=l.strstart+q,E=y[g+f-1],T=y[g+f];l.prev_length>=l.good_match&&(h>>=2),m>l.lookahead&&(m=l.lookahead);do{if(y[(u=d)+f]===T&&y[u+f-1]===E&&y[u]===y[g]&&y[++u]===y[g+1]){g+=2,u++;do{}while(y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&g<C);if(p=q-(C-g),g=C-q,p>f){if(l.match_start=d,f=p,p>=m)break;E=y[g+f-1],T=y[g+f]}}}while((d=_[d&S])>v&&0!=--h);return f<=l.lookahead?f:l.lookahead}function fill_window(l){var d,u,p,g,f,m=l.w_size;do{if(g=l.window_size-l.lookahead-l.strstart,l.strstart>=m+(m-z)){h.arraySet(l.window,l.window,m,m,0),l.match_start-=m,l.strstart-=m,l.block_start-=m,d=u=l.hash_size;do{p=l.head[--d],l.head[d]=p>=m?p-m:0}while(--u);d=u=m;do{p=l.prev[--d],l.prev[d]=p>=m?p-m:0}while(--u);g+=m}if(0===l.strm.avail_in)break;if(u=read_buf(l.strm,l.window,l.strstart+l.lookahead,g),l.lookahead+=u,l.lookahead+l.insert>=W)for(f=l.strstart-l.insert,l.ins_h=l.window[f],l.ins_h=(l.ins_h<<l.hash_shift^l.window[f+1])&l.hash_mask;l.insert&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[f+W-1])&l.hash_mask,l.prev[f&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=f,f++,l.insert--,!(l.lookahead+l.insert<W)););}while(l.lookahead<z&&0!==l.strm.avail_in)}function deflate_stored(l,d){var u=65535;for(u>l.pending_buf_size-5&&(u=l.pending_buf_size-5);;){if(l.lookahead<=1){if(fill_window(l),0===l.lookahead&&d===y)return te;if(0===l.lookahead)break}l.strstart+=l.lookahead,l.lookahead=0;var p=l.block_start+u;if((0===l.strstart||l.strstart>=p)&&(l.lookahead=l.strstart-p,l.strstart=p,flush_block_only(l,!1),0===l.strm.avail_out))return te;if(l.strstart-l.block_start>=l.w_size-z&&(flush_block_only(l,!1),0===l.strm.avail_out))return te}return l.insert=0,d===C?(flush_block_only(l,!0),0===l.strm.avail_out?ie:re):(l.strstart>l.block_start&&(flush_block_only(l,!1),l.strm.avail_out),te)}function deflate_fast(l,d){for(var u,p;;){if(l.lookahead<z){if(fill_window(l),l.lookahead<z&&d===y)return te;if(0===l.lookahead)break}if(u=0,l.lookahead>=W&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),0!==u&&l.strstart-u<=l.w_size-z&&(l.match_length=longest_match(l,u)),l.match_length>=W)if(p=g._tr_tally(l,l.strstart-l.match_start,l.match_length-W),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=W){l.match_length--;do{l.strstart++,l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart}while(0!=--l.match_length);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+1])&l.hash_mask;else p=g._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(p&&(flush_block_only(l,!1),0===l.strm.avail_out))return te}return l.insert=l.strstart<W-1?l.strstart:W-1,d===C?(flush_block_only(l,!0),0===l.strm.avail_out?ie:re):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?te:ne}function deflate_slow(l,d){for(var u,p,h;;){if(l.lookahead<z){if(fill_window(l),l.lookahead<z&&d===y)return te;if(0===l.lookahead)break}if(u=0,l.lookahead>=W&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=W-1,0!==u&&l.prev_length<l.max_lazy_match&&l.strstart-u<=l.w_size-z&&(l.match_length=longest_match(l,u),l.match_length<=5&&(l.strategy===O||l.match_length===W&&l.strstart-l.match_start>4096)&&(l.match_length=W-1)),l.prev_length>=W&&l.match_length<=l.prev_length){h=l.strstart+l.lookahead-W,p=g._tr_tally(l,l.strstart-1-l.prev_match,l.prev_length-W),l.lookahead-=l.prev_length-1,l.prev_length-=2;do{++l.strstart<=h&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+W-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart)}while(0!=--l.prev_length);if(l.match_available=0,l.match_length=W-1,l.strstart++,p&&(flush_block_only(l,!1),0===l.strm.avail_out))return te}else if(l.match_available){if((p=g._tr_tally(l,0,l.window[l.strstart-1]))&&flush_block_only(l,!1),l.strstart++,l.lookahead--,0===l.strm.avail_out)return te}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(p=g._tr_tally(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<W-1?l.strstart:W-1,d===C?(flush_block_only(l,!0),0===l.strm.avail_out?ie:re):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?te:ne}function deflate_rle(l,d){for(var u,p,h,f,m=l.window;;){if(l.lookahead<=q){if(fill_window(l),l.lookahead<=q&&d===y)return te;if(0===l.lookahead)break}if(l.match_length=0,l.lookahead>=W&&l.strstart>0&&(p=m[h=l.strstart-1])===m[++h]&&p===m[++h]&&p===m[++h]){f=l.strstart+q;do{}while(p===m[++h]&&p===m[++h]&&p===m[++h]&&p===m[++h]&&p===m[++h]&&p===m[++h]&&p===m[++h]&&p===m[++h]&&h<f);l.match_length=q-(f-h),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=W?(u=g._tr_tally(l,1,l.match_length-W),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(u=g._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),u&&(flush_block_only(l,!1),0===l.strm.avail_out))return te}return l.insert=0,d===C?(flush_block_only(l,!0),0===l.strm.avail_out?ie:re):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?te:ne}function deflate_huff(l,d){for(var u;;){if(0===l.lookahead&&(fill_window(l),0===l.lookahead)){if(d===y)return te;break}if(l.match_length=0,u=g._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,u&&(flush_block_only(l,!1),0===l.strm.avail_out))return te}return l.insert=0,d===C?(flush_block_only(l,!0),0===l.strm.avail_out?ie:re):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?te:ne}function Config(l,d,u,p,h){this.good_length=l,this.max_lazy=d,this.nice_length=u,this.max_chain=p,this.func=h}function lm_init(l){l.window_size=2*l.w_size,zero(l.head),l.max_lazy_match=p[l.level].max_lazy,l.good_match=p[l.level].good_length,l.nice_match=p[l.level].nice_length,l.max_chain_length=p[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=W-1,l.match_available=0,l.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new h.Buf16(2*H),this.dyn_dtree=new h.Buf16(2*(2*B+1)),this.bl_tree=new h.Buf16(2*(2*V+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new h.Buf16(G+1),this.heap=new h.Buf16(2*j+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new h.Buf16(2*j+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(l){var d;return l&&l.state?(l.total_in=l.total_out=0,l.data_type=L,(d=l.state).pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap?J:Z,l.adler=2===d.wrap?0:1,d.last_flush=y,g._tr_init(d),T):err(l,I)}function deflateReset(l){var d=deflateResetKeep(l);return d===T&&lm_init(l.state),d}function deflateSetHeader(l,d){return l&&l.state?2!==l.state.wrap?I:(l.state.gzhead=d,T):I}function deflateInit2(l,d,u,p,g,f){if(!l)return I;var m=1;if(d===P&&(d=6),p<0?(m=0,p=-p):p>15&&(m=2,p-=16),g<1||g>x||u!==k||p<8||p>15||d<0||d>9||f<0||f>N)return err(l,I);8===p&&(p=9);var v=new DeflateState;return l.state=v,v.strm=l,v.wrap=m,v.gzhead=null,v.w_bits=p,v.w_size=1<<v.w_bits,v.w_mask=v.w_size-1,v.hash_bits=g+7,v.hash_size=1<<v.hash_bits,v.hash_mask=v.hash_size-1,v.hash_shift=~~((v.hash_bits+W-1)/W),v.window=new h.Buf8(2*v.w_size),v.head=new h.Buf16(v.hash_size),v.prev=new h.Buf16(v.w_size),v.lit_bufsize=1<<g+6,v.pending_buf_size=4*v.lit_bufsize,v.pending_buf=new h.Buf8(v.pending_buf_size),v.d_buf=1*v.lit_bufsize,v.l_buf=3*v.lit_bufsize,v.level=d,v.strategy=f,v.method=u,deflateReset(l)}function deflateInit(l,d){return deflateInit2(l,d,k,F,U,D)}function deflate(l,d){var u,h,f,v;if(!l||!l.state||d>E||d<0)return l?err(l,I):I;if(h=l.state,!l.output||!l.input&&0!==l.avail_in||h.status===ee&&d!==C)return err(l,0===l.avail_out?R:I);if(h.strm=l,u=h.last_flush,h.last_flush=d,h.status===J)if(2===h.wrap)l.adler=0,put_byte(h,31),put_byte(h,139),put_byte(h,8),h.gzhead?(put_byte(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),put_byte(h,255&h.gzhead.time),put_byte(h,h.gzhead.time>>8&255),put_byte(h,h.gzhead.time>>16&255),put_byte(h,h.gzhead.time>>24&255),put_byte(h,9===h.level?2:h.strategy>=M||h.level<2?4:0),put_byte(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(put_byte(h,255&h.gzhead.extra.length),put_byte(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(l.adler=m(l.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=Q):(put_byte(h,0),put_byte(h,0),put_byte(h,0),put_byte(h,0),put_byte(h,0),put_byte(h,9===h.level?2:h.strategy>=M||h.level<2?4:0),put_byte(h,oe),h.status=Z);else{var A=k+(h.w_bits-8<<4)<<8;A|=(h.strategy>=M||h.level<2?0:h.level<6?1:6===h.level?2:3)<<6,0!==h.strstart&&(A|=K),A+=31-A%31,h.status=Z,putShortMSB(h,A),0!==h.strstart&&(putShortMSB(h,l.adler>>>16),putShortMSB(h,65535&l.adler)),l.adler=1}if(h.status===Q)if(h.gzhead.extra){for(f=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>f&&(l.adler=m(l.adler,h.pending_buf,h.pending-f,f)),flush_pending(l),f=h.pending,h.pending!==h.pending_buf_size));)put_byte(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>f&&(l.adler=m(l.adler,h.pending_buf,h.pending-f,f)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=Y)}else h.status=Y;if(h.status===Y)if(h.gzhead.name){f=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>f&&(l.adler=m(l.adler,h.pending_buf,h.pending-f,f)),flush_pending(l),f=h.pending,h.pending===h.pending_buf_size)){v=1;break}v=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,put_byte(h,v)}while(0!==v);h.gzhead.hcrc&&h.pending>f&&(l.adler=m(l.adler,h.pending_buf,h.pending-f,f)),0===v&&(h.gzindex=0,h.status=$)}else h.status=$;if(h.status===$)if(h.gzhead.comment){f=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>f&&(l.adler=m(l.adler,h.pending_buf,h.pending-f,f)),flush_pending(l),f=h.pending,h.pending===h.pending_buf_size)){v=1;break}v=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,put_byte(h,v)}while(0!==v);h.gzhead.hcrc&&h.pending>f&&(l.adler=m(l.adler,h.pending_buf,h.pending-f,f)),0===v&&(h.status=X)}else h.status=X;if(h.status===X&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&flush_pending(l),h.pending+2<=h.pending_buf_size&&(put_byte(h,255&l.adler),put_byte(h,l.adler>>8&255),l.adler=0,h.status=Z)):h.status=Z),0!==h.pending){if(flush_pending(l),0===l.avail_out)return h.last_flush=-1,T}else if(0===l.avail_in&&rank(d)<=rank(u)&&d!==C)return err(l,R);if(h.status===ee&&0!==l.avail_in)return err(l,R);if(0!==l.avail_in||0!==h.lookahead||d!==y&&h.status!==ee){var P=h.strategy===M?deflate_huff(h,d):h.strategy===w?deflate_rle(h,d):p[h.level].func(h,d);if(P!==ie&&P!==re||(h.status=ee),P===te||P===ie)return 0===l.avail_out&&(h.last_flush=-1),T;if(P===ne&&(d===S?g._tr_align(h):d!==E&&(g._tr_stored_block(h,0,0,!1),d===_&&(zero(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),flush_pending(l),0===l.avail_out))return h.last_flush=-1,T}return d!==C?T:h.wrap<=0?b:(2===h.wrap?(put_byte(h,255&l.adler),put_byte(h,l.adler>>8&255),put_byte(h,l.adler>>16&255),put_byte(h,l.adler>>24&255),put_byte(h,255&l.total_in),put_byte(h,l.total_in>>8&255),put_byte(h,l.total_in>>16&255),put_byte(h,l.total_in>>24&255)):(putShortMSB(h,l.adler>>>16),putShortMSB(h,65535&l.adler)),flush_pending(l),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?T:b)}function deflateEnd(l){var d;return l&&l.state?(d=l.state.status)!==J&&d!==Q&&d!==Y&&d!==$&&d!==X&&d!==Z&&d!==ee?err(l,I):(l.state=null,d===Z?err(l,A):T):I}function deflateSetDictionary(l,d){var u,p,g,m,v,y,S,_,C=d.length;if(!l||!l.state)return I;if(2===(m=(u=l.state).wrap)||1===m&&u.status!==J||u.lookahead)return I;for(1===m&&(l.adler=f(l.adler,d,C,0)),u.wrap=0,C>=u.w_size&&(0===m&&(zero(u.head),u.strstart=0,u.block_start=0,u.insert=0),_=new h.Buf8(u.w_size),h.arraySet(_,d,C-u.w_size,u.w_size,0),d=_,C=u.w_size),v=l.avail_in,y=l.next_in,S=l.input,l.avail_in=C,l.next_in=0,l.input=d,fill_window(u);u.lookahead>=W;){p=u.strstart,g=u.lookahead-(W-1);do{u.ins_h=(u.ins_h<<u.hash_shift^u.window[p+W-1])&u.hash_mask,u.prev[p&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=p,p++}while(--g);u.strstart=p,u.lookahead=W-1,fill_window(u)}return u.strstart+=u.lookahead,u.block_start=u.strstart,u.insert=u.lookahead,u.lookahead=0,u.match_length=u.prev_length=W-1,u.match_available=0,l.next_in=y,l.input=S,l.avail_in=v,u.wrap=m,T}p=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],d.deflateInit=deflateInit,d.deflateInit2=deflateInit2,d.deflateReset=deflateReset,d.deflateResetKeep=deflateResetKeep,d.deflateSetHeader=deflateSetHeader,d.deflate=deflate,d.deflateEnd=deflateEnd,d.deflateSetDictionary=deflateSetDictionary,d.deflateInfo=\"pako deflate (from Nodeca project)\"},function(l,d,u){var p=u(38),h=4,g=0,f=1,m=2;function zero(l){for(var d=l.length;--d>=0;)l[d]=0}var v=0,y=1,S=2,_=3,C=258,E=29,T=256,b=T+1+E,I=30,A=19,R=2*b+1,P=15,O=16,M=7,w=256,N=16,D=17,L=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=512,B=new Array(2*(b+2));zero(B);var V=new Array(2*I);zero(V);var H=new Array(j);zero(H);var G=new Array(C-_+1);zero(G);var W=new Array(E);zero(W);var q,z,K,J=new Array(I);function StaticTreeDesc(l,d,u,p,h){this.static_tree=l,this.extra_bits=d,this.extra_base=u,this.elems=p,this.max_length=h,this.has_stree=l&&l.length}function TreeDesc(l,d){this.dyn_tree=l,this.max_code=0,this.stat_desc=d}function d_code(l){return l<256?H[l]:H[256+(l>>>7)]}function put_short(l,d){l.pending_buf[l.pending++]=255&d,l.pending_buf[l.pending++]=d>>>8&255}function send_bits(l,d,u){l.bi_valid>O-u?(l.bi_buf|=d<<l.bi_valid&65535,put_short(l,l.bi_buf),l.bi_buf=d>>O-l.bi_valid,l.bi_valid+=u-O):(l.bi_buf|=d<<l.bi_valid&65535,l.bi_valid+=u)}function send_code(l,d,u){send_bits(l,u[2*d],u[2*d+1])}function bi_reverse(l,d){var u=0;do{u|=1&l,l>>>=1,u<<=1}while(--d>0);return u>>>1}function bi_flush(l){16===l.bi_valid?(put_short(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=255&l.bi_buf,l.bi_buf>>=8,l.bi_valid-=8)}function gen_bitlen(l,d){var u,p,h,g,f,m,v=d.dyn_tree,y=d.max_code,S=d.stat_desc.static_tree,_=d.stat_desc.has_stree,C=d.stat_desc.extra_bits,E=d.stat_desc.extra_base,T=d.stat_desc.max_length,b=0;for(g=0;g<=P;g++)l.bl_count[g]=0;for(v[2*l.heap[l.heap_max]+1]=0,u=l.heap_max+1;u<R;u++)(g=v[2*v[2*(p=l.heap[u])+1]+1]+1)>T&&(g=T,b++),v[2*p+1]=g,p>y||(l.bl_count[g]++,f=0,p>=E&&(f=C[p-E]),m=v[2*p],l.opt_len+=m*(g+f),_&&(l.static_len+=m*(S[2*p+1]+f)));if(0!==b){do{for(g=T-1;0===l.bl_count[g];)g--;l.bl_count[g]--,l.bl_count[g+1]+=2,l.bl_count[T]--,b-=2}while(b>0);for(g=T;0!==g;g--)for(p=l.bl_count[g];0!==p;)(h=l.heap[--u])>y||(v[2*h+1]!==g&&(l.opt_len+=(g-v[2*h+1])*v[2*h],v[2*h+1]=g),p--)}}function gen_codes(l,d,u){var p,h,g=new Array(P+1),f=0;for(p=1;p<=P;p++)g[p]=f=f+u[p-1]<<1;for(h=0;h<=d;h++){var m=l[2*h+1];0!==m&&(l[2*h]=bi_reverse(g[m]++,m))}}function tr_static_init(){var l,d,u,p,h,g=new Array(P+1);for(u=0,p=0;p<E-1;p++)for(W[p]=u,l=0;l<1<<k[p];l++)G[u++]=p;for(G[u-1]=p,h=0,p=0;p<16;p++)for(J[p]=h,l=0;l<1<<x[p];l++)H[h++]=p;for(h>>=7;p<I;p++)for(J[p]=h<<7,l=0;l<1<<x[p]-7;l++)H[256+h++]=p;for(d=0;d<=P;d++)g[d]=0;for(l=0;l<=143;)B[2*l+1]=8,l++,g[8]++;for(;l<=255;)B[2*l+1]=9,l++,g[9]++;for(;l<=279;)B[2*l+1]=7,l++,g[7]++;for(;l<=287;)B[2*l+1]=8,l++,g[8]++;for(gen_codes(B,b+1,g),l=0;l<I;l++)V[2*l+1]=5,V[2*l]=bi_reverse(l,5);q=new StaticTreeDesc(B,k,T+1,b,P),z=new StaticTreeDesc(V,x,0,I,P),K=new StaticTreeDesc(new Array(0),F,0,A,M)}function init_block(l){var d;for(d=0;d<b;d++)l.dyn_ltree[2*d]=0;for(d=0;d<I;d++)l.dyn_dtree[2*d]=0;for(d=0;d<A;d++)l.bl_tree[2*d]=0;l.dyn_ltree[2*w]=1,l.opt_len=l.static_len=0,l.last_lit=l.matches=0}function bi_windup(l){l.bi_valid>8?put_short(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0}function copy_block(l,d,u,h){bi_windup(l),h&&(put_short(l,u),put_short(l,~u)),p.arraySet(l.pending_buf,l.window,d,u,l.pending),l.pending+=u}function smaller(l,d,u,p){var h=2*d,g=2*u;return l[h]<l[g]||l[h]===l[g]&&p[d]<=p[u]}function pqdownheap(l,d,u){for(var p=l.heap[u],h=u<<1;h<=l.heap_len&&(h<l.heap_len&&smaller(d,l.heap[h+1],l.heap[h],l.depth)&&h++,!smaller(d,p,l.heap[h],l.depth));)l.heap[u]=l.heap[h],u=h,h<<=1;l.heap[u]=p}function compress_block(l,d,u){var p,h,g,f,m=0;if(0!==l.last_lit)do{p=l.pending_buf[l.d_buf+2*m]<<8|l.pending_buf[l.d_buf+2*m+1],h=l.pending_buf[l.l_buf+m],m++,0===p?send_code(l,h,d):(send_code(l,(g=G[h])+T+1,d),0!==(f=k[g])&&send_bits(l,h-=W[g],f),send_code(l,g=d_code(--p),u),0!==(f=x[g])&&send_bits(l,p-=J[g],f))}while(m<l.last_lit);send_code(l,w,d)}function build_tree(l,d){var u,p,h,g=d.dyn_tree,f=d.stat_desc.static_tree,m=d.stat_desc.has_stree,v=d.stat_desc.elems,y=-1;for(l.heap_len=0,l.heap_max=R,u=0;u<v;u++)0!==g[2*u]?(l.heap[++l.heap_len]=y=u,l.depth[u]=0):g[2*u+1]=0;for(;l.heap_len<2;)g[2*(h=l.heap[++l.heap_len]=y<2?++y:0)]=1,l.depth[h]=0,l.opt_len--,m&&(l.static_len-=f[2*h+1]);for(d.max_code=y,u=l.heap_len>>1;u>=1;u--)pqdownheap(l,g,u);h=v;do{u=l.heap[1],l.heap[1]=l.heap[l.heap_len--],pqdownheap(l,g,1),p=l.heap[1],l.heap[--l.heap_max]=u,l.heap[--l.heap_max]=p,g[2*h]=g[2*u]+g[2*p],l.depth[h]=(l.depth[u]>=l.depth[p]?l.depth[u]:l.depth[p])+1,g[2*u+1]=g[2*p+1]=h,l.heap[1]=h++,pqdownheap(l,g,1)}while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],gen_bitlen(l,d),gen_codes(g,y,l.bl_count)}function scan_tree(l,d,u){var p,h,g=-1,f=d[1],m=0,v=7,y=4;for(0===f&&(v=138,y=3),d[2*(u+1)+1]=65535,p=0;p<=u;p++)h=f,f=d[2*(p+1)+1],++m<v&&h===f||(m<y?l.bl_tree[2*h]+=m:0!==h?(h!==g&&l.bl_tree[2*h]++,l.bl_tree[2*N]++):m<=10?l.bl_tree[2*D]++:l.bl_tree[2*L]++,m=0,g=h,0===f?(v=138,y=3):h===f?(v=6,y=3):(v=7,y=4))}function send_tree(l,d,u){var p,h,g=-1,f=d[1],m=0,v=7,y=4;for(0===f&&(v=138,y=3),p=0;p<=u;p++)if(h=f,f=d[2*(p+1)+1],!(++m<v&&h===f)){if(m<y)do{send_code(l,h,l.bl_tree)}while(0!=--m);else 0!==h?(h!==g&&(send_code(l,h,l.bl_tree),m--),send_code(l,N,l.bl_tree),send_bits(l,m-3,2)):m<=10?(send_code(l,D,l.bl_tree),send_bits(l,m-3,3)):(send_code(l,L,l.bl_tree),send_bits(l,m-11,7));m=0,g=h,0===f?(v=138,y=3):h===f?(v=6,y=3):(v=7,y=4)}}function build_bl_tree(l){var d;for(scan_tree(l,l.dyn_ltree,l.l_desc.max_code),scan_tree(l,l.dyn_dtree,l.d_desc.max_code),build_tree(l,l.bl_desc),d=A-1;d>=3&&0===l.bl_tree[2*U[d]+1];d--);return l.opt_len+=3*(d+1)+5+5+4,d}function send_all_trees(l,d,u,p){var h;for(send_bits(l,d-257,5),send_bits(l,u-1,5),send_bits(l,p-4,4),h=0;h<p;h++)send_bits(l,l.bl_tree[2*U[h]+1],3);send_tree(l,l.dyn_ltree,d-1),send_tree(l,l.dyn_dtree,u-1)}function detect_data_type(l){var d,u=4093624447;for(d=0;d<=31;d++,u>>>=1)if(1&u&&0!==l.dyn_ltree[2*d])return g;if(0!==l.dyn_ltree[18]||0!==l.dyn_ltree[20]||0!==l.dyn_ltree[26])return f;for(d=32;d<T;d++)if(0!==l.dyn_ltree[2*d])return f;return g}zero(J);var Q=!1;function _tr_init(l){Q||(tr_static_init(),Q=!0),l.l_desc=new TreeDesc(l.dyn_ltree,q),l.d_desc=new TreeDesc(l.dyn_dtree,z),l.bl_desc=new TreeDesc(l.bl_tree,K),l.bi_buf=0,l.bi_valid=0,init_block(l)}function _tr_stored_block(l,d,u,p){send_bits(l,(v<<1)+(p?1:0),3),copy_block(l,d,u,!0)}function _tr_align(l){send_bits(l,y<<1,3),send_code(l,w,B),bi_flush(l)}function _tr_flush_block(l,d,u,p){var g,f,v=0;l.level>0?(l.strm.data_type===m&&(l.strm.data_type=detect_data_type(l)),build_tree(l,l.l_desc),build_tree(l,l.d_desc),v=build_bl_tree(l),g=l.opt_len+3+7>>>3,(f=l.static_len+3+7>>>3)<=g&&(g=f)):g=f=u+5,u+4<=g&&-1!==d?_tr_stored_block(l,d,u,p):l.strategy===h||f===g?(send_bits(l,(y<<1)+(p?1:0),3),compress_block(l,B,V)):(send_bits(l,(S<<1)+(p?1:0),3),send_all_trees(l,l.l_desc.max_code+1,l.d_desc.max_code+1,v+1),compress_block(l,l.dyn_ltree,l.dyn_dtree)),init_block(l),p&&bi_windup(l)}function _tr_tally(l,d,u){return l.pending_buf[l.d_buf+2*l.last_lit]=d>>>8&255,l.pending_buf[l.d_buf+2*l.last_lit+1]=255&d,l.pending_buf[l.l_buf+l.last_lit]=255&u,l.last_lit++,0===d?l.dyn_ltree[2*u]++:(l.matches++,d--,l.dyn_ltree[2*(G[u]+T+1)]++,l.dyn_dtree[2*d_code(d)]++),l.last_lit===l.lit_bufsize-1}d._tr_init=_tr_init,d._tr_stored_block=_tr_stored_block,d._tr_flush_block=_tr_flush_block,d._tr_tally=_tr_tally,d._tr_align=_tr_align},function(l,d,u){var p=u(191),h=u(38),g=u(96),f=u(98),m=u(75),v=u(97),y=u(194),S=Object.prototype.toString;function Inflate(l){if(!(this instanceof Inflate))return new Inflate(l);this.options=h.assign({chunkSize:16384,windowBits:0,to:\"\"},l||{});var d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||l&&l.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0==(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var u=p.inflateInit2(this.strm,d.windowBits);if(u!==f.Z_OK)throw new Error(m[u]);if(this.header=new y,p.inflateGetHeader(this.strm,this.header),d.dictionary&&(\"string\"==typeof d.dictionary?d.dictionary=g.string2buf(d.dictionary):\"[object ArrayBuffer]\"===S.call(d.dictionary)&&(d.dictionary=new Uint8Array(d.dictionary)),d.raw&&(u=p.inflateSetDictionary(this.strm,d.dictionary))!==f.Z_OK))throw new Error(m[u])}function inflate(l,d){var u=new Inflate(d);if(u.push(l,!0),u.err)throw u.msg||m[u.err];return u.result}function inflateRaw(l,d){return(d=d||{}).raw=!0,inflate(l,d)}Inflate.prototype.push=function(l,d){var u,m,v,y,_,C=this.strm,E=this.options.chunkSize,T=this.options.dictionary,b=!1;if(this.ended)return!1;m=d===~~d?d:!0===d?f.Z_FINISH:f.Z_NO_FLUSH,\"string\"==typeof l?C.input=g.binstring2buf(l):\"[object ArrayBuffer]\"===S.call(l)?C.input=new Uint8Array(l):C.input=l,C.next_in=0,C.avail_in=C.input.length;do{if(0===C.avail_out&&(C.output=new h.Buf8(E),C.next_out=0,C.avail_out=E),(u=p.inflate(C,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&T&&(u=p.inflateSetDictionary(this.strm,T)),u===f.Z_BUF_ERROR&&!0===b&&(u=f.Z_OK,b=!1),u!==f.Z_STREAM_END&&u!==f.Z_OK)return this.onEnd(u),this.ended=!0,!1;C.next_out&&(0!==C.avail_out&&u!==f.Z_STREAM_END&&(0!==C.avail_in||m!==f.Z_FINISH&&m!==f.Z_SYNC_FLUSH)||(\"string\"===this.options.to?(v=g.utf8border(C.output,C.next_out),y=C.next_out-v,_=g.buf2string(C.output,v),C.next_out=y,C.avail_out=E-y,y&&h.arraySet(C.output,C.output,v,y,0),this.onData(_)):this.onData(h.shrinkBuf(C.output,C.next_out)))),0===C.avail_in&&0===C.avail_out&&(b=!0)}while((C.avail_in>0||0===C.avail_out)&&u!==f.Z_STREAM_END);return u===f.Z_STREAM_END&&(m=f.Z_FINISH),m===f.Z_FINISH?(u=p.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===f.Z_OK):m!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),C.avail_out=0,!0)},Inflate.prototype.onData=function(l){this.chunks.push(l)},Inflate.prototype.onEnd=function(l){l===f.Z_OK&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg},d.Inflate=Inflate,d.inflate=inflate,d.inflateRaw=inflateRaw,d.ungzip=inflate},function(l,d,u){var p=u(38),h=u(94),g=u(95),f=u(192),m=u(193),v=0,y=1,S=2,_=4,C=5,E=6,T=0,b=1,I=2,A=-2,R=-3,P=-4,O=-5,M=8,w=1,N=2,D=3,L=4,k=5,x=6,F=7,U=8,j=9,B=10,V=11,H=12,G=13,W=14,q=15,z=16,K=17,J=18,Q=19,Y=20,$=21,X=22,Z=23,ee=24,te=25,ne=26,ie=27,re=28,oe=29,ae=30,se=31,ce=32,le=852,de=592,ue=15;function zswap32(l){return(l>>>24&255)+(l>>>8&65280)+((65280&l)<<8)+((255&l)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new p.Buf16(320),this.work=new p.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(l){var d;return l&&l.state?(d=l.state,l.total_in=l.total_out=d.total=0,l.msg=\"\",d.wrap&&(l.adler=1&d.wrap),d.mode=w,d.last=0,d.havedict=0,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new p.Buf32(le),d.distcode=d.distdyn=new p.Buf32(de),d.sane=1,d.back=-1,T):A}function inflateReset(l){var d;return l&&l.state?((d=l.state).wsize=0,d.whave=0,d.wnext=0,inflateResetKeep(l)):A}function inflateReset2(l,d){var u,p;return l&&l.state?(p=l.state,d<0?(u=0,d=-d):(u=1+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?A:(null!==p.window&&p.wbits!==d&&(p.window=null),p.wrap=u,p.wbits=d,inflateReset(l))):A}function inflateInit2(l,d){var u,p;return l?(p=new InflateState,l.state=p,p.window=null,(u=inflateReset2(l,d))!==T&&(l.state=null),u):A}function inflateInit(l){return inflateInit2(l,ue)}var pe,he,ge=!0;function fixedtables(l){if(ge){var d;for(pe=new p.Buf32(512),he=new p.Buf32(32),d=0;d<144;)l.lens[d++]=8;for(;d<256;)l.lens[d++]=9;for(;d<280;)l.lens[d++]=7;for(;d<288;)l.lens[d++]=8;for(m(y,l.lens,0,288,pe,0,l.work,{bits:9}),d=0;d<32;)l.lens[d++]=5;m(S,l.lens,0,32,he,0,l.work,{bits:5}),ge=!1}l.lencode=pe,l.lenbits=9,l.distcode=he,l.distbits=5}function updatewindow(l,d,u,h){var g,f=l.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new p.Buf8(f.wsize)),h>=f.wsize?(p.arraySet(f.window,d,u-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):((g=f.wsize-f.wnext)>h&&(g=h),p.arraySet(f.window,d,u-h,g,f.wnext),(h-=g)?(p.arraySet(f.window,d,u-h,h,0),f.wnext=h,f.whave=f.wsize):(f.wnext+=g,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=g))),0}function inflate(l,d){var u,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Ee,Te,be,Ie,Ae,Re,Pe,Oe,Me,we,Ne=0,De=new p.Buf8(4),Le=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!l||!l.state||!l.output||!l.input&&0!==l.avail_in)return A;(u=l.state).mode===H&&(u.mode=G),pe=l.next_out,de=l.output,ge=l.avail_out,ue=l.next_in,le=l.input,he=l.avail_in,fe=u.hold,me=u.bits,ve=he,ye=ge,Oe=T;e:for(;;)switch(u.mode){case w:if(0===u.wrap){u.mode=G;break}for(;me<16;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(2&u.wrap&&35615===fe){u.check=0,De[0]=255&fe,De[1]=fe>>>8&255,u.check=g(u.check,De,2,0),fe=0,me=0,u.mode=N;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&fe)<<8)+(fe>>8))%31){l.msg=\"incorrect header check\",u.mode=ae;break}if((15&fe)!==M){l.msg=\"unknown compression method\",u.mode=ae;break}if(me-=4,Pe=8+(15&(fe>>>=4)),0===u.wbits)u.wbits=Pe;else if(Pe>u.wbits){l.msg=\"invalid window size\",u.mode=ae;break}u.dmax=1<<Pe,l.adler=u.check=1,u.mode=512&fe?B:H,fe=0,me=0;break;case N:for(;me<16;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(u.flags=fe,(255&u.flags)!==M){l.msg=\"unknown compression method\",u.mode=ae;break}if(57344&u.flags){l.msg=\"unknown header flags set\",u.mode=ae;break}u.head&&(u.head.text=fe>>8&1),512&u.flags&&(De[0]=255&fe,De[1]=fe>>>8&255,u.check=g(u.check,De,2,0)),fe=0,me=0,u.mode=D;case D:for(;me<32;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}u.head&&(u.head.time=fe),512&u.flags&&(De[0]=255&fe,De[1]=fe>>>8&255,De[2]=fe>>>16&255,De[3]=fe>>>24&255,u.check=g(u.check,De,4,0)),fe=0,me=0,u.mode=L;case L:for(;me<16;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}u.head&&(u.head.xflags=255&fe,u.head.os=fe>>8),512&u.flags&&(De[0]=255&fe,De[1]=fe>>>8&255,u.check=g(u.check,De,2,0)),fe=0,me=0,u.mode=k;case k:if(1024&u.flags){for(;me<16;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}u.length=fe,u.head&&(u.head.extra_len=fe),512&u.flags&&(De[0]=255&fe,De[1]=fe>>>8&255,u.check=g(u.check,De,2,0)),fe=0,me=0}else u.head&&(u.head.extra=null);u.mode=x;case x:if(1024&u.flags&&((Se=u.length)>he&&(Se=he),Se&&(u.head&&(Pe=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),p.arraySet(u.head.extra,le,ue,Se,Pe)),512&u.flags&&(u.check=g(u.check,le,Se,ue)),he-=Se,ue+=Se,u.length-=Se),u.length))break e;u.length=0,u.mode=F;case F:if(2048&u.flags){if(0===he)break e;Se=0;do{Pe=le[ue+Se++],u.head&&Pe&&u.length<65536&&(u.head.name+=String.fromCharCode(Pe))}while(Pe&&Se<he);if(512&u.flags&&(u.check=g(u.check,le,Se,ue)),he-=Se,ue+=Se,Pe)break e}else u.head&&(u.head.name=null);u.length=0,u.mode=U;case U:if(4096&u.flags){if(0===he)break e;Se=0;do{Pe=le[ue+Se++],u.head&&Pe&&u.length<65536&&(u.head.comment+=String.fromCharCode(Pe))}while(Pe&&Se<he);if(512&u.flags&&(u.check=g(u.check,le,Se,ue)),he-=Se,ue+=Se,Pe)break e}else u.head&&(u.head.comment=null);u.mode=j;case j:if(512&u.flags){for(;me<16;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(fe!==(65535&u.check)){l.msg=\"header crc mismatch\",u.mode=ae;break}fe=0,me=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),l.adler=u.check=0,u.mode=H;break;case B:for(;me<32;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}l.adler=u.check=zswap32(fe),fe=0,me=0,u.mode=V;case V:if(0===u.havedict)return l.next_out=pe,l.avail_out=ge,l.next_in=ue,l.avail_in=he,u.hold=fe,u.bits=me,I;l.adler=u.check=1,u.mode=H;case H:if(d===C||d===E)break e;case G:if(u.last){fe>>>=7&me,me-=7&me,u.mode=ie;break}for(;me<3;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}switch(u.last=1&fe,me-=1,3&(fe>>>=1)){case 0:u.mode=W;break;case 1:if(fixedtables(u),u.mode=Y,d===E){fe>>>=2,me-=2;break e}break;case 2:u.mode=K;break;case 3:l.msg=\"invalid block type\",u.mode=ae}fe>>>=2,me-=2;break;case W:for(fe>>>=7&me,me-=7&me;me<32;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if((65535&fe)!=(fe>>>16^65535)){l.msg=\"invalid stored block lengths\",u.mode=ae;break}if(u.length=65535&fe,fe=0,me=0,u.mode=q,d===E)break e;case q:u.mode=z;case z:if(Se=u.length){if(Se>he&&(Se=he),Se>ge&&(Se=ge),0===Se)break e;p.arraySet(de,le,ue,Se,pe),he-=Se,ue+=Se,ge-=Se,pe+=Se,u.length-=Se;break}u.mode=H;break;case K:for(;me<14;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(u.nlen=257+(31&fe),fe>>>=5,me-=5,u.ndist=1+(31&fe),fe>>>=5,me-=5,u.ncode=4+(15&fe),fe>>>=4,me-=4,u.nlen>286||u.ndist>30){l.msg=\"too many length or distance symbols\",u.mode=ae;break}u.have=0,u.mode=J;case J:for(;u.have<u.ncode;){for(;me<3;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}u.lens[Le[u.have++]]=7&fe,fe>>>=3,me-=3}for(;u.have<19;)u.lens[Le[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,Me={bits:u.lenbits},Oe=m(v,u.lens,0,19,u.lencode,0,u.work,Me),u.lenbits=Me.bits,Oe){l.msg=\"invalid code lengths set\",u.mode=ae;break}u.have=0,u.mode=Q;case Q:for(;u.have<u.nlen+u.ndist;){for(;Te=(Ne=u.lencode[fe&(1<<u.lenbits)-1])>>>16&255,be=65535&Ne,!((Ee=Ne>>>24)<=me);){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(be<16)fe>>>=Ee,me-=Ee,u.lens[u.have++]=be;else{if(16===be){for(we=Ee+2;me<we;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(fe>>>=Ee,me-=Ee,0===u.have){l.msg=\"invalid bit length repeat\",u.mode=ae;break}Pe=u.lens[u.have-1],Se=3+(3&fe),fe>>>=2,me-=2}else if(17===be){for(we=Ee+3;me<we;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}me-=Ee,Pe=0,Se=3+(7&(fe>>>=Ee)),fe>>>=3,me-=3}else{for(we=Ee+7;me<we;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}me-=Ee,Pe=0,Se=11+(127&(fe>>>=Ee)),fe>>>=7,me-=7}if(u.have+Se>u.nlen+u.ndist){l.msg=\"invalid bit length repeat\",u.mode=ae;break}for(;Se--;)u.lens[u.have++]=Pe}}if(u.mode===ae)break;if(0===u.lens[256]){l.msg=\"invalid code -- missing end-of-block\",u.mode=ae;break}if(u.lenbits=9,Me={bits:u.lenbits},Oe=m(y,u.lens,0,u.nlen,u.lencode,0,u.work,Me),u.lenbits=Me.bits,Oe){l.msg=\"invalid literal/lengths set\",u.mode=ae;break}if(u.distbits=6,u.distcode=u.distdyn,Me={bits:u.distbits},Oe=m(S,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,Me),u.distbits=Me.bits,Oe){l.msg=\"invalid distances set\",u.mode=ae;break}if(u.mode=Y,d===E)break e;case Y:u.mode=$;case $:if(he>=6&&ge>=258){l.next_out=pe,l.avail_out=ge,l.next_in=ue,l.avail_in=he,u.hold=fe,u.bits=me,f(l,ye),pe=l.next_out,de=l.output,ge=l.avail_out,ue=l.next_in,le=l.input,he=l.avail_in,fe=u.hold,me=u.bits,u.mode===H&&(u.back=-1);break}for(u.back=0;Te=(Ne=u.lencode[fe&(1<<u.lenbits)-1])>>>16&255,be=65535&Ne,!((Ee=Ne>>>24)<=me);){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(Te&&0==(240&Te)){for(Ie=Ee,Ae=Te,Re=be;Te=(Ne=u.lencode[Re+((fe&(1<<Ie+Ae)-1)>>Ie)])>>>16&255,be=65535&Ne,!(Ie+(Ee=Ne>>>24)<=me);){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}fe>>>=Ie,me-=Ie,u.back+=Ie}if(fe>>>=Ee,me-=Ee,u.back+=Ee,u.length=be,0===Te){u.mode=ne;break}if(32&Te){u.back=-1,u.mode=H;break}if(64&Te){l.msg=\"invalid literal/length code\",u.mode=ae;break}u.extra=15&Te,u.mode=X;case X:if(u.extra){for(we=u.extra;me<we;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}u.length+=fe&(1<<u.extra)-1,fe>>>=u.extra,me-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=Z;case Z:for(;Te=(Ne=u.distcode[fe&(1<<u.distbits)-1])>>>16&255,be=65535&Ne,!((Ee=Ne>>>24)<=me);){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(0==(240&Te)){for(Ie=Ee,Ae=Te,Re=be;Te=(Ne=u.distcode[Re+((fe&(1<<Ie+Ae)-1)>>Ie)])>>>16&255,be=65535&Ne,!(Ie+(Ee=Ne>>>24)<=me);){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}fe>>>=Ie,me-=Ie,u.back+=Ie}if(fe>>>=Ee,me-=Ee,u.back+=Ee,64&Te){l.msg=\"invalid distance code\",u.mode=ae;break}u.offset=be,u.extra=15&Te,u.mode=ee;case ee:if(u.extra){for(we=u.extra;me<we;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}u.offset+=fe&(1<<u.extra)-1,fe>>>=u.extra,me-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){l.msg=\"invalid distance too far back\",u.mode=ae;break}u.mode=te;case te:if(0===ge)break e;if(Se=ye-ge,u.offset>Se){if((Se=u.offset-Se)>u.whave&&u.sane){l.msg=\"invalid distance too far back\",u.mode=ae;break}Se>u.wnext?(Se-=u.wnext,_e=u.wsize-Se):_e=u.wnext-Se,Se>u.length&&(Se=u.length),Ce=u.window}else Ce=de,_e=pe-u.offset,Se=u.length;Se>ge&&(Se=ge),ge-=Se,u.length-=Se;do{de[pe++]=Ce[_e++]}while(--Se);0===u.length&&(u.mode=$);break;case ne:if(0===ge)break e;de[pe++]=u.length,ge--,u.mode=$;break;case ie:if(u.wrap){for(;me<32;){if(0===he)break e;he--,fe|=le[ue++]<<me,me+=8}if(ye-=ge,l.total_out+=ye,u.total+=ye,ye&&(l.adler=u.check=u.flags?g(u.check,de,ye,pe-ye):h(u.check,de,ye,pe-ye)),ye=ge,(u.flags?fe:zswap32(fe))!==u.check){l.msg=\"incorrect data check\",u.mode=ae;break}fe=0,me=0}u.mode=re;case re:if(u.wrap&&u.flags){for(;me<32;){if(0===he)break e;he--,fe+=le[ue++]<<me,me+=8}if(fe!==(4294967295&u.total)){l.msg=\"incorrect length check\",u.mode=ae;break}fe=0,me=0}u.mode=oe;case oe:Oe=b;break e;case ae:Oe=R;break e;case se:return P;case ce:default:return A}return l.next_out=pe,l.avail_out=ge,l.next_in=ue,l.avail_in=he,u.hold=fe,u.bits=me,(u.wsize||ye!==l.avail_out&&u.mode<ae&&(u.mode<ie||d!==_))&&updatewindow(l,l.output,l.next_out,ye-l.avail_out),ve-=l.avail_in,ye-=l.avail_out,l.total_in+=ve,l.total_out+=ye,u.total+=ye,u.wrap&&ye&&(l.adler=u.check=u.flags?g(u.check,de,ye,l.next_out-ye):h(u.check,de,ye,l.next_out-ye)),l.data_type=u.bits+(u.last?64:0)+(u.mode===H?128:0)+(u.mode===Y||u.mode===q?256:0),(0===ve&&0===ye||d===_)&&Oe===T&&(Oe=O),Oe}function inflateEnd(l){if(!l||!l.state)return A;var d=l.state;return d.window&&(d.window=null),l.state=null,T}function inflateGetHeader(l,d){var u;return l&&l.state?0==(2&(u=l.state).wrap)?A:(u.head=d,d.done=!1,T):A}function inflateSetDictionary(l,d){var u,p=d.length;return l&&l.state?0!==(u=l.state).wrap&&u.mode!==V?A:u.mode===V&&h(1,d,p,0)!==u.check?R:updatewindow(l,d,p,p)?(u.mode=se,P):(u.havedict=1,T):A}d.inflateReset=inflateReset,d.inflateReset2=inflateReset2,d.inflateResetKeep=inflateResetKeep,d.inflateInit=inflateInit,d.inflateInit2=inflateInit2,d.inflate=inflate,d.inflateEnd=inflateEnd,d.inflateGetHeader=inflateGetHeader,d.inflateSetDictionary=inflateSetDictionary,d.inflateInfo=\"pako inflate (from Nodeca project)\"},function(l,d,u){var p=30,h=12;l.exports=function inflate_fast(l,d){var u,g,f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k,x,F;u=l.state,g=l.next_in,x=l.input,f=g+(l.avail_in-5),m=l.next_out,F=l.output,v=m-(d-l.avail_out),y=m+(l.avail_out-257),S=u.dmax,_=u.wsize,C=u.whave,E=u.wnext,T=u.window,b=u.hold,I=u.bits,A=u.lencode,R=u.distcode,P=(1<<u.lenbits)-1,O=(1<<u.distbits)-1;e:do{I<15&&(b+=x[g++]<<I,I+=8,b+=x[g++]<<I,I+=8),M=A[b&P];t:for(;;){if(b>>>=w=M>>>24,I-=w,0===(w=M>>>16&255))F[m++]=65535&M;else{if(!(16&w)){if(0==(64&w)){M=A[(65535&M)+(b&(1<<w)-1)];continue t}if(32&w){u.mode=h;break e}l.msg=\"invalid literal/length code\",u.mode=p;break e}N=65535&M,(w&=15)&&(I<w&&(b+=x[g++]<<I,I+=8),N+=b&(1<<w)-1,b>>>=w,I-=w),I<15&&(b+=x[g++]<<I,I+=8,b+=x[g++]<<I,I+=8),M=R[b&O];n:for(;;){if(b>>>=w=M>>>24,I-=w,!(16&(w=M>>>16&255))){if(0==(64&w)){M=R[(65535&M)+(b&(1<<w)-1)];continue n}l.msg=\"invalid distance code\",u.mode=p;break e}if(D=65535&M,I<(w&=15)&&(b+=x[g++]<<I,(I+=8)<w&&(b+=x[g++]<<I,I+=8)),(D+=b&(1<<w)-1)>S){l.msg=\"invalid distance too far back\",u.mode=p;break e}if(b>>>=w,I-=w,D>(w=m-v)){if((w=D-w)>C&&u.sane){l.msg=\"invalid distance too far back\",u.mode=p;break e}if(L=0,k=T,0===E){if(L+=_-w,w<N){N-=w;do{F[m++]=T[L++]}while(--w);L=m-D,k=F}}else if(E<w){if(L+=_+E-w,(w-=E)<N){N-=w;do{F[m++]=T[L++]}while(--w);if(L=0,E<N){N-=w=E;do{F[m++]=T[L++]}while(--w);L=m-D,k=F}}}else if(L+=E-w,w<N){N-=w;do{F[m++]=T[L++]}while(--w);L=m-D,k=F}for(;N>2;)F[m++]=k[L++],F[m++]=k[L++],F[m++]=k[L++],N-=3;N&&(F[m++]=k[L++],N>1&&(F[m++]=k[L++]))}else{L=m-D;do{F[m++]=F[L++],F[m++]=F[L++],F[m++]=F[L++],N-=3}while(N>2);N&&(F[m++]=F[L++],N>1&&(F[m++]=F[L++]))}break}}break}}while(g<f&&m<y);g-=N=I>>3,b&=(1<<(I-=N<<3))-1,l.next_in=g,l.next_out=m,l.avail_in=g<f?f-g+5:5-(g-f),l.avail_out=m<y?y-m+257:257-(m-y),u.hold=b,u.bits=I}},function(l,d,u){var p=u(38),h=15,g=852,f=592,m=0,v=1,y=2,S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],_=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],E=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];l.exports=function inflate_table(l,d,u,T,b,I,A,R){var P,O,M,w,N,D,L,k,x,F=R.bits,U=0,j=0,B=0,V=0,H=0,G=0,W=0,q=0,z=0,K=0,J=null,Q=0,Y=new p.Buf16(h+1),$=new p.Buf16(h+1),X=null,Z=0;for(U=0;U<=h;U++)Y[U]=0;for(j=0;j<T;j++)Y[d[u+j]]++;for(H=F,V=h;V>=1&&0===Y[V];V--);if(H>V&&(H=V),0===V)return b[I++]=20971520,b[I++]=20971520,R.bits=1,0;for(B=1;B<V&&0===Y[B];B++);for(H<B&&(H=B),q=1,U=1;U<=h;U++)if(q<<=1,(q-=Y[U])<0)return-1;if(q>0&&(l===m||1!==V))return-1;for($[1]=0,U=1;U<h;U++)$[U+1]=$[U]+Y[U];for(j=0;j<T;j++)0!==d[u+j]&&(A[$[d[u+j]]++]=j);if(l===m?(J=X=A,D=19):l===v?(J=S,Q-=257,X=_,Z-=257,D=256):(J=C,X=E,D=-1),K=0,j=0,U=B,N=I,G=H,W=0,M=-1,w=(z=1<<H)-1,l===v&&z>g||l===y&&z>f)return 1;for(;;){L=U-W,A[j]<D?(k=0,x=A[j]):A[j]>D?(k=X[Z+A[j]],x=J[Q+A[j]]):(k=96,x=0),P=1<<U-W,B=O=1<<G;do{b[N+(K>>W)+(O-=P)]=L<<24|k<<16|x|0}while(0!==O);for(P=1<<U-1;K&P;)P>>=1;if(0!==P?(K&=P-1,K+=P):K=0,j++,0==--Y[U]){if(U===V)break;U=d[u+A[j]]}if(U>H&&(K&w)!==M){for(0===W&&(W=H),N+=B,q=1<<(G=U-W);G+W<V&&!((q-=Y[G+W])<=0);)G++,q<<=1;if(z+=1<<G,l===v&&z>g||l===y&&z>f)return 1;b[M=K&w]=H<<24|G<<16|N-I|0}}return 0!==K&&(b[N+K]=U-W<<24|64<<16|0),R.bits=H,0}},function(l,d,u){function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=\"\",this.comment=\"\",this.hcrc=0,this.done=!1}l.exports=GZheader},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(5),h=function(){function IncomingNotificationMessageHandler(l){var d=this;this.handleMessage=function(l){if(!d.isMessageForExistingCall(l))return{isHandled:!1};if(l.url.search(new RegExp(\"/\".concat(p.default.URL_BASE.CALLAGENT,\"/\"),\"i\"))>-1){var u=d.signalingAgent.handleIncomingNotification(l);return\"number\"==typeof u?{isHandled:!0,resultCode:u}:{isHandled:!0,resultCode:u.resultCode,responseBody:u.responseBody,responseHeaders:u.responseHeaders}}return{isHandled:!1}},this.signalingAgent=l}return IncomingNotificationMessageHandler.prototype.isMessageForExistingCall=function(l){return!l.eventId},IncomingNotificationMessageHandler}();d.default=h},function(l,d,u){l.exports=u(197)},function(l,d,u){var p=u(23),h=u(100),g=u(198),f=u(107);function createInstance(l){var d=new g(l),u=h(g.prototype.request,d);return p.extend(u,g.prototype,d),p.extend(u,d),u}var m=createInstance(u(103));m.Axios=g,m.create=function create(l){return createInstance(f(m.defaults,l))},m.Cancel=u(108),m.CancelToken=u(212),m.isCancel=u(102),m.all=function all(l){return Promise.all(l)},m.spread=u(213),l.exports=m,l.exports.default=m},function(l,d,u){var p=u(23),h=u(101),g=u(199),f=u(200),m=u(107);function Axios(l){this.defaults=l,this.interceptors={request:new g,response:new g}}Axios.prototype.request=function request(l){\"string\"==typeof l?(l=arguments[1]||{}).url=arguments[0]:l=l||{},(l=m(this.defaults,l)).method?l.method=l.method.toLowerCase():this.defaults.method?l.method=this.defaults.method.toLowerCase():l.method=\"get\";var d=[f,void 0],u=Promise.resolve(l);for(this.interceptors.request.forEach((function unshiftRequestInterceptors(l){d.unshift(l.fulfilled,l.rejected)})),this.interceptors.response.forEach((function pushResponseInterceptors(l){d.push(l.fulfilled,l.rejected)}));d.length;)u=u.then(d.shift(),d.shift());return u},Axios.prototype.getUri=function getUri(l){return l=m(this.defaults,l),h(l.url,l.params,l.paramsSerializer).replace(/^\\?/,\"\")},p.forEach([\"delete\",\"get\",\"head\",\"options\"],(function forEachMethodNoData(l){Axios.prototype[l]=function(d,u){return this.request(p.merge(u||{},{method:l,url:d}))}})),p.forEach([\"post\",\"put\",\"patch\"],(function forEachMethodWithData(l){Axios.prototype[l]=function(d,u,h){return this.request(p.merge(h||{},{method:l,url:d,data:u}))}})),l.exports=Axios},function(l,d,u){var p=u(23);function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(l,d){return this.handlers.push({fulfilled:l,rejected:d}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(l){this.handlers[l]&&(this.handlers[l]=null)},InterceptorManager.prototype.forEach=function forEach(l){p.forEach(this.handlers,(function forEachHandler(d){null!==d&&l(d)}))},l.exports=InterceptorManager},function(l,d,u){var p=u(23),h=u(201),g=u(102),f=u(103);function throwIfCancellationRequested(l){l.cancelToken&&l.cancelToken.throwIfRequested()}l.exports=function dispatchRequest(l){return throwIfCancellationRequested(l),l.headers=l.headers||{},l.data=h(l.data,l.headers,l.transformRequest),l.headers=p.merge(l.headers.common||{},l.headers[l.method]||{},l.headers),p.forEach([\"delete\",\"get\",\"head\",\"post\",\"put\",\"patch\",\"common\"],(function cleanHeaderConfig(d){delete l.headers[d]})),(l.adapter||f.adapter)(l).then((function onAdapterResolution(d){return throwIfCancellationRequested(l),d.data=h(d.data,d.headers,l.transformResponse),d}),(function onAdapterRejection(d){return g(d)||(throwIfCancellationRequested(l),d&&d.response&&(d.response.data=h(d.response.data,d.response.headers,l.transformResponse))),Promise.reject(d)}))}},function(l,d,u){var p=u(23);l.exports=function transformData(l,d,u){return p.forEach(u,(function transform(u){l=u(l,d)})),l}},function(l,d,u){var p=u(23);l.exports=function normalizeHeaderName(l,d){p.forEach(l,(function processHeader(u,p){p!==d&&p.toUpperCase()===d.toUpperCase()&&(l[d]=u,delete l[p])}))}},function(l,d,u){var p=u(106);l.exports=function settle(l,d,u){var h=u.config.validateStatus;!h||h(u.status)?l(u):d(p(\"Request failed with status code \"+u.status,u.config,null,u.request,u))}},function(l,d,u){l.exports=function enhanceError(l,d,u,p,h){return l.config=d,u&&(l.code=u),l.request=p,l.response=h,l.isAxiosError=!0,l.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},l}},function(l,d,u){var p=u(206),h=u(207);l.exports=function buildFullPath(l,d){return l&&!p(d)?h(l,d):d}},function(l,d,u){l.exports=function isAbsoluteURL(l){return/^([a-z][a-z\\d\\+\\-\\.]*:)?\\/\\//i.test(l)}},function(l,d,u){l.exports=function combineURLs(l,d){return d?l.replace(/\\/+$/,\"\")+\"/\"+d.replace(/^\\/+/,\"\"):l}},function(l,d,u){var p=u(23),h=[\"age\",\"authorization\",\"content-length\",\"content-type\",\"etag\",\"expires\",\"from\",\"host\",\"if-modified-since\",\"if-unmodified-since\",\"last-modified\",\"location\",\"max-forwards\",\"proxy-authorization\",\"referer\",\"retry-after\",\"user-agent\"];l.exports=function parseHeaders(l){var d,u,g,f={};return l?(p.forEach(l.split(\"\\n\"),(function parser(l){if(g=l.indexOf(\":\"),d=p.trim(l.substr(0,g)).toLowerCase(),u=p.trim(l.substr(g+1)),d){if(f[d]&&h.indexOf(d)>=0)return;f[d]=\"set-cookie\"===d?(f[d]?f[d]:[]).concat([u]):f[d]?f[d]+\", \"+u:u}})),f):f}},function(l,d,u){var p=u(23),h=u(210);l.exports=p.isStandardBrowserEnv()?function standardBrowserEnv(){var l,d=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement(\"a\");function resolveURL(l){var p=l;if(h(l))throw new Error(\"URL contains XSS injection attempt\");return d&&(u.setAttribute(\"href\",p),p=u.href),u.setAttribute(\"href\",p),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,\"\"):\"\",host:u.host,search:u.search?u.search.replace(/^\\?/,\"\"):\"\",hash:u.hash?u.hash.replace(/^#/,\"\"):\"\",hostname:u.hostname,port:u.port,pathname:\"/\"===u.pathname.charAt(0)?u.pathname:\"/\"+u.pathname}}return l=resolveURL(window.location.href),function isURLSameOrigin(d){var u=p.isString(d)?resolveURL(d):d;return u.protocol===l.protocol&&u.host===l.host}}():function isURLSameOrigin(){return!0}},function(l,d,u){l.exports=function isValidXss(l){return/(\\b)(on\\w+)=|javascript|(<\\s*)(\\/*)script/gi.test(l)}},function(l,d,u){var p=u(23);l.exports=p.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(l,d,u,h,g,f){var m=[];m.push(l+\"=\"+encodeURIComponent(d)),p.isNumber(u)&&m.push(\"expires=\"+new Date(u).toGMTString()),p.isString(h)&&m.push(\"path=\"+h),p.isString(g)&&m.push(\"domain=\"+g),!0===f&&m.push(\"secure\"),document.cookie=m.join(\"; \")},read:function read(l){var d=document.cookie.match(new RegExp(\"(^|;\\\\s*)(\"+l+\")=([^;]*)\"));return d?decodeURIComponent(d[3]):null},remove:function remove(l){this.write(l,\"\",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}}},function(l,d,u){var p=u(108);function CancelToken(l){if(\"function\"!=typeof l)throw new TypeError(\"executor must be a function.\");var d;this.promise=new Promise((function promiseExecutor(l){d=l}));var u=this;l((function cancel(l){u.reason||(u.reason=new p(l),d(u.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var l;return{token:new CancelToken((function executor(d){l=d})),cancel:l}},l.exports=CancelToken},function(l,d,u){l.exports=function spread(l){return function wrap(d){return l.apply(null,d)}}},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(56),f=u(14),m=u(34),v=u(215),y=u(99),S=u(110),_=u(217),C=u(25),E=u(5),T=u(10),b=u(4),I=function(){function SignalingAgent(l){var d=this;this.endpointId=b.newGuid(),this.signalingSessions={},this.getNewSignalingSession=function(l,u,p,h){var g=b.causeId();b.assertNotNull(l,\"selfParticipant should be a non null value\"),b.assertNotNull(u,\"signalingSessionCallback should be a non null value\");var f=p||b.newGuid();b.assertNotNullOrEmpty(f,\"signalingSession id generated cannot be null or empty\"),d.checkConfigChange(g);var m=_.build(l,u,d.signalingAgentConfig,f,d,h),v=m.sessionId;return d.signalingSessions[v]=m,d.logger.info(\"[\".concat(g,\"]Created new signalingSession with correlation ID \").concat(f,\" and session ID \").concat(v)),m},this.resolvePotentialCallConflict=function(l){var u,p=b.causeId();if(d.logger.info(\"[\".concat(p,\"][resolvePotentialCallConflict]\")),!l.multiParty)return Object.keys(d.signalingSessions).forEach((function(p){d.isSessionInConflictingState(d.signalingSessions[p],!l.isIncomingCall)&&(u=l.isIncomingCall?d.compareAndGetConflictingSession(l,d.signalingSessions[p]):d.compareAndGetConflictingSession(d.signalingSessions[p],l))})),u?(d.logger.info(\"Call conflict done, conflicting session callId=\",u.correlationId,\"urlIdentifier=\",u.urlIdentifier),u.telemetryHelper.recordEvent(C.EVENTS.CONFLICTED_CALL),d.signalingAgentConfig.endConflictedCall?(d.endConflictedSession(u,p),u):void 0):void 0},this.handleIncomingNotification=function(l){if(b.assertNotNull(l,\"request should be a non null value\"),d.logger.info(\"handleIncomingNotification to : \".concat(l.url)),!l.body&&!l.rawBody)return d.logger.error(\"request has no body\"),d.buildNotificationResponse(E.default.HTTP_STATUS_CODES.BAD_REQUEST);var u=E.default.HTTP_STATUS_CODES.OK,p=T.getIdFromUrl(l.url);if(p){var h=d.signalingSessions.hasOwnProperty(p);if(d.logger.info(\"Is session found:\".concat(h)),h){var g=d.signalingSessions[p];if(b.isEncodedMessage(l.headers))try{if(!b.isMessageEncodingSupported(l.headers))throw new Error(\"Unsupported encoding\");var m=b.decodeMessage(l.rawBody),v=JSON.parse(m);l.body=v}catch(l){return g.telemetryHelper.recordEvent(C.EVENTS.TROUTER_DECODE_PAYLOAD_FAILURE),d.buildNotificationResponse(E.default.HTTP_STATUS_CODES.BAD_REQUEST)}if(g.canHandleIncomingMsgSync(l))return g.handleIncomingMsgSync(l);window.setTimeout((function(){if(d.signalingSessions.hasOwnProperty(p)){var u=d.signalingSessions[p];u.handleIncomingMsgAsync(l).catch((function(l){u&&u.telemetryHelper&&u.telemetryHelper.recordEvent(C.EVENTS.FAILED_TO_HANDLE_TROUTER_MESSAGE),d.logger.error(\"handling IncomingMsg failed with error: \".concat(l))}))}}),0)}else d.logger.info(\"Incoming message for session ID \".concat(p,\", but session was not found!\")),u=E.default.HTTP_STATUS_CODES.NOT_FOUND}else d.logger.error(\"Could not retrieve session ID from Url path. Path = \".concat(l.url)),u=E.default.HTTP_STATUS_CODES.BAD_REQUEST;var y=d.buildNotificationResponse(u);return d.logger.info(\"Result code:\".concat((0,f.getPrintableObject)(y))),y},this.onCallCompleted=function(l,u){d.signalingSessions.hasOwnProperty(l)?(delete d.signalingSessions[l],d.logger.info(\"[\".concat(u,\"][onCallCompleted] Session ID \").concat(l,\" found. Deleted from signalingSession table\"))):d.logger.info(\"[\".concat(u,\"][onCallCompleted] Session ID \").concat(l,\" not found. Could not delete from signalingSession table\"))},this.applyAuthTokenCacheConfig=function(l){d.signalingAgentConfig.enableTokenCache?(d.authTokenManager.setTokenCaching(!0,l),d.signalingAgentConfig.enableTokenPrefetch&&d.authTokenManager.getToken(l).then((function(){d.logger.info(\"[\".concat(l,\"] token prefetch success\"))})).catch((function(u){d.logger.info(\"[\".concat(l,\"] token prefetch failure, error=\").concat((0,f.getPrintableObject)(u)))}))):d.authTokenManager.setTokenCaching(!1,l)},this.endConflictedSession=function(l,u){d.logger.info(\"Call conflict, ending signalingSession with callId=\",l.correlationId,\"urlIdentifier=\",l.urlIdentifier),l.endAsync({code:E.default.CALL_END_CODE.CONFLICT,subCode:E.default.CALL_END_SUB_CODE.CONFLICT_IN_NG,phrase:E.default.CALL_END_PHRASE.CONFLICT},{forEveryone:!1,causeId:u})},this.compareAndGetConflictingSession=function(l,d){if(b.is1to1Mri(l.incomingCallCallerId)&&b.is1to1Mri(d.participantManager.localParticipant.id)){var u=b.stripMri(l.incomingCallCallerId),p=b.stripMri(d.participantManager.getParticipantsToInitiateCallWith().length&&d.participantManager.getParticipantsToInitiateCallWith()[0].id),h=b.stripMri(d.participantManager.localParticipant.id);if(p===u)return h>u?l:d}},this.isSessionInConflictingState=function(l,u){if(!l)return d.logger.info(\"Call conflict, ignore, session already disposed\"),!1;var p=[E.default.CALL_STATUS.IDLE,E.default.CALL_STATUS.CONNECTING,E.default.CALL_STATUS.RINGING];return!l.multiParty&&p.indexOf(l.getCallStatus())>-1&&(u&&l.isIncomingCall||!u&&!l.isIncomingCall)},this.buildNotificationResponse=function(l,u){return d.signalingAgentConfig.supportsSynchronousTrouterResponse?{resultCode:l,responseBody:u}:l},(0,y.default)(l),this.signalingAgentConfig=l,this.logger=l.logger.createChild(\"SignalingAgent\"),b.assertNotNull(l,\"signalingAgentConfig should be a non null value\"),this.logger.info(l.isWebRtcEnabled?\"webRTC enabled\":\"ORTC enabled\");var u={enableCallingTokenAPI:l.enableCallingTokenAPI,aadTokenExpirationTimeInSeconds:l.aadTokenExpirationTimeInSeconds,popTokenExpirationTimeInSeconds:l.popTokenExpirationTimeInSeconds,refreshTimeBeforeTokenTimeoutInSeconds:l.refreshTimeBeforeTokenTimeoutInSeconds};this.authTokenManager=v.authTokenManagerFactory.build(this.logger,l.skypeToken,u),this.applyAuthTokenCacheConfig(b.causeId())}return SignalingAgent.prototype.updateSignalingAgentConfig=function(l){var d=b.causeId(),u=JSON.stringify(l,(function(l,d){return l?String(d):d}));this.logger.info(\"[\".concat(d,\"] updateSignalingAgentConfig, SignalingAgentConfig: \").concat(u)),this.logger.info(\"[\".concat(d,\"] ecsEtag=\").concat(l.ecsEtag)),(0,y.default)(l),this.updatedSignalingAgentConfig=l},SignalingAgent.prototype.updateUrls=function(l,d,u){this.logger.info(\"updateUrls: conversationServiceUrl: \".concat(l,\", uploadLogRequestUrl: \").concat(d,\", enforceUrls: \").concat(u)),this.updatedSignalingAgentConfig=this.updatedSignalingAgentConfig||this.signalingAgentConfig,u||!this.updatedSignalingAgentConfig.isConversationServiceUrlFromEcs?this.updatedSignalingAgentConfig.conversationServiceUrl=l||this.updatedSignalingAgentConfig.conversationServiceUrl:this.updatedSignalingAgentConfig.conversationServiceUrl=this.updatedSignalingAgentConfig.conversationServiceUrl||l,u||!this.updatedSignalingAgentConfig.isUploadLogRequestUrlFromEcs?this.updatedSignalingAgentConfig.uploadLogRequestUrl=d||this.updatedSignalingAgentConfig.uploadLogRequestUrl:this.updatedSignalingAgentConfig.uploadLogRequestUrl=this.updatedSignalingAgentConfig.uploadLogRequestUrl||d},SignalingAgent.prototype.sendPushAsync=function(l,d,u,h,f){var v=this;void 0===f&&(f=b.causeId());var y=new S.default(this.signalingAgentConfig.piiScrubber),_=\"sendPush[local participant mri = \".concat(y.scrubMriOrOmit(l),\"][recipientList = \").concat(y.scrubMriOrOmit(d),\"][headers = \").concat(u,\")][causeId = \").concat(f,\"]\");if(!l||!l.id)return this.logger.info(\"\".concat(_,\" Empty localParticipantId\")),Promise.reject(\"invalid localParticipantId\");if(!d||0===d.length||d.every((function(l){return l&&\"\"===l.id})))return this.logger.info(\"\".concat(_,\" Empty recipientList\")),Promise.reject(\"invalid recipientList\");if(!u)return this.logger.info(\"\".concat(_,\" Empty headers\")),Promise.reject(\"invalid headers\");if(!h||null===b.tryParse(h))return this.logger.info(\"\".concat(_,\" Invalid body.\")),Promise.reject(\"invalid body\");var C=p(p({},b.tryParse(h)),{To:Array.from(d,(function(l){return l.id})),From:l.id});u.hasOwnProperty(E.default.HEADERS.CORRELATION_ID)||(u[E.default.HEADERS.CORRELATION_ID]=(0,g.default)()),u.hasOwnProperty(E.default.HEADERS.MESSAGE_ID)||(u[E.default.HEADERS.MESSAGE_ID]=(0,g.default)()),u.hasOwnProperty(E.default.HEADERS.PARTICIPANT_ID)||(u[E.default.HEADERS.PARTICIPANT_ID]=(0,g.default)()),u.hasOwnProperty(E.default.HEADERS.CONTENT_TYPE)||(u[E.default.HEADERS.CONTENT_TYPE]=\"application/json\"),u.hasOwnProperty(E.default.HEADERS.CLIENT_USER_AGENT)&&(u[E.default.HEADERS.CLIENT_USER_AGENT]+=\"/TsCallingVersion=\".concat((0,m.getTsCallingVersion)(),\"/Ovb=\").concat((0,m.getOvb)()));var T=this.signalingAgentConfig.httpRequestDispatcher.getRequestOptions(\"POST\",u,JSON.stringify(C),3e4);return new Promise((function(l,d){v.signalingAgentConfig.httpRequestDispatcher.postAsync(v.signalingAgentConfig.uploadLogRequestUrl||E.default.URL_DEFAULTS.UPLOAD_LOG_URL,T).then((function(){l()})).catch((function(l){d(l)}))}))},SignalingAgent.prototype.getSignalingSession=function(l){var d,u;try{for(var p=h(Object.keys(this.signalingSessions)),g=p.next();!g.done;g=p.next()){var f=g.value,m=this.signalingSessions[f];if(m.correlationId===l)return m}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}return null},SignalingAgent.prototype.updateToken=function(l,d,u,p,h){this.authTokenManager.updateToken(l,d,u,p,h)},SignalingAgent.prototype.setTokenRequiredCallBack=function(l){this.authTokenManager.setTokenRequiredCallBack(l)},SignalingAgent.prototype.resetAuthTokenManager=function(){this.setTokenRequiredCallBack(null),this.authTokenManager.setDisableTimerFlag(!0)},SignalingAgent.prototype.checkConfigChange=function(l){this.updatedSignalingAgentConfig&&this.updatedSignalingAgentConfig!==this.signalingAgentConfig&&(this.signalingAgentConfig=this.updatedSignalingAgentConfig,this.updatedSignalingAgentConfig=null,this.applyAuthTokenCacheConfig(l))},SignalingAgent}();d.default=I},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.authTokenManagerFactory=d.AuthTokenManager=void 0;var f=u(14),m=u(216),v=3600,y=function(){function AuthTokenManager(l,d,u){this.tokenProvider=d,this.tokenCachingEnabled=!1,this.cachedToken=\"\",this.lastTokenType=1,this.lastToken=\"\",this.enableCallingTokenAPI=!1,this.refreshTimeBeforeTokenTimeoutInSeconds=60,this.stopTimerFlag=!1,this.tokensPromiseMap={},this.logger=l.createChild(\"TokenManager\"),u&&this.updateTokenSettings(u),this.cacheTokenManager=new m.default}return AuthTokenManager.prototype.setTokenCaching=function(l,d){this.tokenCachingEnabled!==l&&(this.logger.info(\"setTokenCaching=\".concat(l)),this.tokenCachingEnabled=l)},AuthTokenManager.prototype.getToken=function(l,d,u){return void 0===d&&(d=!1),h(this,void 0,void 0,(function(){var p,h;return g(this,(function(g){switch(g.label){case 0:return this.enableCallingTokenAPI?(this.logger.info(\"[\".concat(l,\"][getToken] callingTokenAPI is enabled so using new API to fetch it\")),[4,this.getTokenWithTokenType(l,d,u)]):[3,2];case 1:return[2,p=g.sent().token];case 2:if(d&&this.invalidateCachedToken(l),this.cachedToken&&this.tokenCachingEnabled)return this.logger.info(\"[\".concat(l,\"][getToken] returning cached token\")),[2,Promise.resolve(this.cachedToken)];g.label=3;case 3:return g.trys.push([3,5,,6]),this.logger.info(\"[\".concat(l,\"][getToken] fetching new token\")),[4,this.tokenProvider()];case 4:return(p=g.sent())?(this.tokenCachingEnabled&&(this.cachedToken=p),this.lastToken=p,this.lastTokenType=1,this.logger.info(\"[\".concat(l,\"][getToken] fetching new token success\")),[2,p]):(this.logger.info(\"[\".concat(l,\"][getToken] received empty token\")),[2,Promise.reject(\"Received empty token\")]);case 5:throw h=g.sent(),this.logger.info(\"[\".concat(l,\"][getToken] failed to fetch token=\").concat((0,f.getPrintableObject)(h))),this.cachedToken=\"\",h;case 6:return[2]}}))}))},AuthTokenManager.prototype.invalidateCachedToken=function(l){this.cachedToken&&(this.logger.info(\"[\".concat(l,\"][invalidateCachedToken]\")),this.cachedToken=\"\")},AuthTokenManager.prototype.getLastToken=function(l){return this.logger.info(\"[\".concat(l,\"][getLastToken]\")),this.lastToken},AuthTokenManager.prototype.getTokenWithTokenType=function(l,d,u){return void 0===d&&(d=!1),h(this,void 0,void 0,(function(){var p,h,m,v,y,S,_,C,E;return g(this,(function(g){switch(g.label){case 0:if(h=(p=u||{}).factorsJson,m=p.requestMetadataJson,v=p.invalidToken,y=(null==u?void 0:u.tokenType)||1,d&&this.cacheTokenManager.invalidateCachedToken(y),this.tokenCachingEnabled&&(S=this.cacheTokenManager.getToken(y,h))&&S.token)return this.logger.info(\"[\".concat(l,\"][getTokenWithTokenType] returning cached token for factorsJson \").concat(h,\" and tokenType \").concat(y)),[2,S];g.label=1;case 1:return g.trys.push([1,3,,4]),this.logger.info(\"[\".concat(l,\"][getTokenWithTokenType] fetching new token for factorsJson \").concat(h,\" and tokenType \").concat(y)),[4,this.onTokenRequired({factorsJson:h,tokenType:y,requestMetadataJson:m,invalidToken:v})];case 2:return _=g.sent(),(C=_.token)?(this.lastTokenType=_.tokenType,this.lastToken=C,this.tokenCachingEnabled&&this.cacheTokenManager.setToken(_.tokenType,C,h),this.logger.info(\"[\".concat(l,\"][getTokenWithTokenType] fetching new token success for factorsJson \").concat(h,\" and tokenType \").concat(y)),[2,_]):(this.logger.info(\"[\".concat(l,\"][getTokenWithTokenType] received empty token\")),[2,Promise.reject(\"Received empty token\")]);case 3:throw E=g.sent(),this.logger.info(\"[\".concat(l,\"][getTokenWithTokenType] failed to fetch token=\").concat((0,f.getPrintableObject)(E))),this.cacheTokenManager.invalidateCachedToken(y),E;case 4:return[2]}}))}))},AuthTokenManager.prototype.getLastTokenType=function(l){return this.logger.info(\"[\".concat(l,\"][getLastTokenType]\")),this.lastTokenType},AuthTokenManager.prototype.updateTokenSettings=function(l){var d=l.enableCallingTokenAPI,u=l.aadTokenExpirationTimeInSeconds,p=l.popTokenExpirationTimeInSeconds,h=l.refreshTimeBeforeTokenTimeoutInSeconds;this.logger.info(\"updateTokenSettings \".concat(JSON.stringify(l))),this.enableCallingTokenAPI=null!=d?d:this.enableCallingTokenAPI,this.aadTokenExpirationTimeInSeconds=null!=u?u:this.aadTokenExpirationTimeInSeconds,this.popTokenExpirationTimeInSeconds=null!=p?p:this.popTokenExpirationTimeInSeconds,this.refreshTimeBeforeTokenTimeoutInSeconds=null!=h?h:this.refreshTimeBeforeTokenTimeoutInSeconds},AuthTokenManager.prototype.updateToken=function(l,d,u,h,g){if(this.logger.info(\"[\".concat(h,\"][updateToken] UI replies a token with factorsJson=\").concat(l,\" \")+\"updateMetadata=\".concat(JSON.stringify(d),\" tokenExpiryInSeconds=\").concat(g)),!this.tokensPromiseMap[l])throw Error(\"[updateToken]: UI try to update token with invalid factorsJson=\".concat(l));if(d.error)this.logger.info(\"[\".concat(h,\"][updateToken] UI replies with error \").concat(d.error,\" for factorsJson \").concat(l)),this.tokensPromiseMap[l].reject(d.error);else{if(this.tokensPromiseMap[l].tokenRequestOptions.tokenType=d.tokenType,this.tokensPromiseMap[l].resolve({token:u,tokenType:d.tokenType}),this.logger.info(\"[\".concat(h,\"][updateToken] resolved and upateToken with factorsJson=\").concat(l,\" tokenType=\").concat(d.tokenType)),this.tokenCachingEnabled){var f=p({},this.tokensPromiseMap[l].tokenRequestOptions);this.setTimerToRefreshToken(h,f,g)}delete this.tokensPromiseMap[l]}},AuthTokenManager.prototype.onTokenRequired=function(l){return h(this,void 0,void 0,(function(){var d,u,p,h,f,m=this;return g(this,(function(g){switch(g.label){case 0:if(d=l.factorsJson,u=l.tokenType,p=l.requestMetadataJson,h=l.invalidToken,this.logger.info(\"[onTokenRequired] factorsJson=\".concat(d,\" tokenType=\").concat(u)),this.enableCallingTokenAPI&&this.tokenCallback&&d&&u)return[3,2];if(!this.tokenProvider)throw new Error(\"[onTokenRequired]: Attempt to fetch skypeToken is not provided or already removed, factorsJson=\".concat(d));return[4,this.tokenProvider()];case 1:return[2,{token:g.sent(),tokenType:1}];case 2:return this.tokensPromiseMap[d]?(this.logger.info(\"[onTokenRequired] factorsJson=\".concat(d,\" has pending request\")),[2,this.tokensPromiseMap[d].promise]):(f=new Promise((function(l,h){m.tokensPromiseMap[d]={reject:h,resolve:l,promise:void 0,tokenRequestOptions:{factorsJson:d,tokenType:u,requestMetadataJson:p}}})),this.tokensPromiseMap[d].promise=f,this.tokenCallback({factorsJson:d,tokenType:u,requestMetadataJson:p,invalidToken:h}),[2,f])}}))}))},AuthTokenManager.prototype.setTokenRequiredCallBack=function(l){this.tokenCallback=l},AuthTokenManager.prototype.setDisableTimerFlag=function(l){this.logger.info(\"[setDisableTimerFlag] set disableTimerFlag to \".concat(l)),this.stopTimerFlag=l},AuthTokenManager.prototype.setTimerToRefreshToken=function(l,d,u){var p=this,h=d.factorsJson,g=d.tokenType,f=u;if(!f||f<=this.refreshTimeBeforeTokenTimeoutInSeconds)switch(g){case 4:f=this.aadTokenExpirationTimeInSeconds;break;default:f=v}this.logger.info(\"[\".concat(l,\"][setTimerToRefreshToken] set timeout for refresing to \").concat(f,\" tokenType=\").concat(g,\" factorsJson=\").concat(h)),setTimeout((function(){p.stopTimerFlag?p.logger.info(\"[\".concat(l,\"][setTimerToRefreshToken] stopTimerFlag=true so cancel timer\")):(p.logger.info(\"[\".concat(l,\"][setTimerToRefreshToken] refreshing token with timeout=\").concat(f,\" tokenType=\").concat(g,\" factorsJson=\").concat(h)),p.getToken(l,!0,d))}),1e3*(f-this.refreshTimeBeforeTokenTimeoutInSeconds))},AuthTokenManager}();d.AuthTokenManager=y,d.authTokenManagerFactory={build:function(l,d,u){return new y(l,d,u)}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function CacheTokenManager(){this.skypeToken=\"\",this.aadToken=\"\"}return CacheTokenManager.prototype.getToken=function(l,d){return 4&l&&this.aadToken?{token:this.aadToken,tokenType:4}:1&l&&this.skypeToken?{token:this.skypeToken,tokenType:1}:null},CacheTokenManager.prototype.setToken=function(l,d,u){switch(l){case 4:this.aadToken=d;break;case 1:this.skypeToken=d;break;default:throw new Error(\"Invalid tokenType \".concat(l))}},CacheTokenManager.prototype.invalidateCachedToken=function(l){4&l&&(this.aadToken=\"\"),1&l&&(this.skypeToken=\"\")},CacheTokenManager}();d.default=p},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.build=d.SignalingSession=void 0;var m=u(8),v=u(41),y=u(14),S=u(46),_=u(218),C=u(219),E=u(35),T=u(220),b=u(221),I=u(222),A=u(223),R=u(232),P=u(236),O=u(74),M=u(240),w=u(110),N=u(255),D=u(112),L=u(256),k=u(257),x=u(258),F=u(259),U=u(260),j=u(261),B=u(262),V=u(263),H=u(264),G=u(265),W=u(266),q=u(267),z=u(268),K=u(269),J=u(270),Q=u(271),Y=u(272),$=u(273),X=u(274),Z=u(275),ee=u(276),te=u(277),ne=u(278),ie=u(279),re=u(280),oe=u(281),ae=u(282),se=u(283),ce=u(284),le=u(285),de=u(286),ue=u(287),pe=u(288),he=u(289),ge=u(290),fe=u(25),me=u(291),ve=u(5),ye=u(76),Se=u(59),_e=u(4),Ce=u(295),Ee=function(){function SignalingSession(l,d,u,h,g,S){var C=this;this.disposed=!1,this.convSubject=null,this.groupId=null,this.threadId=null,this.incomingCallCallerId=null,this.incomingCallPayload=null,this.multiParty=!0,this.isIncomingCall=!1,this.isHostLessCall=!1,this.isCastCall=!1,this.numberOfOriginalInvitees=0,this.teamsMessageId=null,this.enableGroupCallMeetupGeneration=!1,this.meetingInfo=null,this.meetingDetails=null,this.emergencyContent=null,this.transferContext=null,this.callType=\"default\",this.callMode=0,this.transferor=null,this.onBehalfOf=null,this.endpointMetadata={},this.sessionId=_e.newGuid(),this.remoteCaller=null,this.acceptedElsewhereBy=null,this.breakoutDetails=null,this.callLimits=null,this.disposing=!1,this.links={},this.provisionalMediaAnswersSeenSoFar=[],this.incomingTrouterMessagesSeenSoFar=[],this.incomingBrokerMessagesSeenSoFar=[],this.currentCallStatus=null,this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,this.convJoined=!1,this.keepAliveTimer=null,this.keepAliveInterval=null,this.keepAliveCount=1,this.keepAliveTimerLwj=null,this.keepAliveIntervalLwj=null,this.keepAliveCountLwj=1,this.conversationKeepAliveTimer=null,this.conversationKeepAliveInterval=null,this.conversationKeepAliveCount=1,this.remoteUser=null,this.mediaTypesToUse=null,this.lastUsedOutgoingMediaContent=null,this.lastUsedJoinCallOptions=null,this.originalRoleBeforePreheat=\"\",this.endpointStateSequenceNumber=0,this.publishStateSequenceNumber=0,this.linkUpdateRequested={conversationLinks:!1,keepAliveLinks:!1},this.incomingMessageSyncResponseCache={},this.joinedLightWeight=!1,this.isPreheatOnly=!1,this.callStartTime=(new Date).getTime(),this.callUsesMixer=!1,this.disablePreheatDefer=_e.defer(),this.participantReplacementDetails={},this.meetingLiveStateSequenceNumber=0,this.meetingLayoutSequenceNumber=0,this.localParticipantUpdateSequenceNumber=0,this.isRedirectAllowed=!1,this.updateSequenceNumber=-1,this.updateEndpointState=function(l,d){void 0===d&&(d=_e.causeId()),C.logger.info(\"[\".concat(d,\"][updateEndpointState=\").concat((0,y.getPrintableObject)(l.state),\"]\"));var u=C.links[ve.default.LINKS.UPDATE_ENDPOINT_STATE],h=C.getEndpointState(),g=p(p(p({},h),l),{endpointStateSequenceNumber:++C.endpointStateSequenceNumber});C.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_ENDPOINT_STATE,{newEndpointState:g,causeId:d});var preheatDisabledInNewState=function(l){var d;return 0===(null===(d=null==l?void 0:l.endpointProperties)||void 0===d?void 0:d.preheatProperties)};return preheatDisabledInNewState(g)&&C.isPreheatOnly&&(C.telemetryHelper.recordEvent(fe.EVENTS.PREHEAT_DISABLING,{causeId:d}),C.telemetryHelper.startPreheatedCallSetupDurationWatch(),C.telemetryHelper.startCallCancelationDurationWatch()),2===C.callMode&&preheatDisabledInNewState(g)?(C.logger.info(\"[\".concat(d,\"][updateEndpointState skipped as mode is streaming]\")),C.requestedEndpointStateWhileConnecting=null,C.handlePreheatDisabled(d),Promise.resolve()):C.fsmState!==ve.default.SIGNALING_FSM_STATE.CONNECTED?(C.logger.info(\"[\".concat(d,\"][updateEndpointState will be queued as we don't have a link yet]\")),C.requestedEndpointStateWhileConnecting=l,preheatDisabledInNewState(g)?C.disablePreheatDefer.promise:Promise.resolve()):C.shouldUpdateEndpointState(h,g)||C.http.hasPendingRequest(fe.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE.name)?u?(C.latestEndpointState=g,C.http.sendPostRequest({url:u,requestName:fe.NETWORK_REQUESTS.UPDATE_ENDPOINT_STATE.name,payload:ce.getPayload(C,g),causeId:d}).then((function(){C.disposed||(C.requestedEndpointStateWhileConnecting=null,preheatDisabledInNewState(g)&&C.handlePreheatDisabled(d))})).catch((function(l){var u=_e.getErrorForXHRFailure(l,C.signalingAgentConfig);return C.logger.info(\"[\".concat(d,\"][updateEndpointState] error: \").concat((0,y.getPrintableObject)(u))),Promise.reject(u.error)}))):(C.logger.info(\"[\".concat(d,\"][updateEndpointState operation cannot be performed now, the link is not yet available]\")),Promise.reject(\"No link\")):(C.logger.info(\"[\".concat(d,\"][updateEndpointState will ignore current update as there is nothing new to send]\")),Promise.reject(\"Ignored\"))},this.setParticipantCallLinks=function(l){l&&l.endpointDetails&&(C.participantReplacementDetails[l.id]={},l.endpointDetails.forEach((function(d){d&&d.callLinks&&(C.participantReplacementDetails[l.id][d.participantId]=d.callLinks)})))},this.clearParticipantCallLinks=function(l){C.participantReplacementDetails&&C.participantReplacementDetails.hasOwnProperty(l)&&delete C.participantReplacementDetails[l]},this.getReplacementDetailsByParticipantLeg=function(l,d,u){return void 0===u&&(u=_e.causeId()),C.logger.info(\"[\".concat(u,\"]getReplacementDetailsByParticipantLeg: participantMri \").concat((0,y.getPIISafeObject)(l),\" participantLegId \").concat(d)),C.participantReplacementDetails&&C.participantReplacementDetails.hasOwnProperty(l)&&C.participantReplacementDetails[l].hasOwnProperty(d)?{replaces:C.participantReplacementDetails[l][d].replacement,replacementTargetParticipantId:d}:(C.logger.info(\"[\".concat(u,\"]getReplacementDetailsByParticipantLeg: unable to find replacement details for participantLegId \").concat(d)),{})},this.getReplacementDetailsByParticipantLegOfCall=function(l,d,u,p){void 0===p&&(p=_e.causeId()),C.logger.info(\"[\".concat(p,\"]getReplacementDetailsByParticipantLegOfCall: callId \").concat(l,\" participantMri \").concat((0,y.getPIISafeObject)(d),\" participantLegId \").concat(u));var h=C.signalingAgent.getSignalingSession(l);return h?h.getReplacementDetailsByParticipantLeg(d,u,p):{}},this.getMriByParticipantLegOfCall=function(l,d,u){C.logger.info(\"[\".concat(u,\"]getMriByParticipantLegOfCall: callId: \").concat(l,\" participantLegId \").concat(d));var p=C.signalingAgent.getSignalingSession(l);return p?p.getMriByParticipantLeg(d,u):\"\"},this.getMriByParticipantLeg=function(l,d){var u,p;C.logger.info(\"getMriByParticipantLeg[\".concat(d,\"] participantLegId \").concat(l));try{for(var h=f(Object.keys(C.participantReplacementDetails)),g=h.next();!g.done;g=h.next()){var m=g.value;if(m&&C.participantReplacementDetails.hasOwnProperty(m)&&C.participantReplacementDetails[m]&&C.participantReplacementDetails[m].hasOwnProperty(l))return m}}catch(l){u={error:l}}finally{try{g&&!g.done&&(p=h.return)&&p.call(h)}finally{if(u)throw u.error}}return\"\"},this.handlePreheatDisabled=function(l){C.isPreheatOnly=!1,C.telemetryHelper.setSelfParticipantRole(C.originalRoleBeforePreheat),C.telemetryHelper.recordEvent(fe.EVENTS.PREHEAT_DISABLED,{causeId:l}),C.telemetryHelper.resetCallCancelationDurationWatch(),C.telemetryHelper.stopPreheatedCallSetupDurationWatch(),C.telemetryHelper.startCallConnectedWatch(),C.stopCallPreheatTimer(),C.disablePreheatDefer.isPending()&&C.disablePreheatDefer.resolve()},this.shouldUpdateEndpointState=function(l,d){if(!d)return!1;var u=d.state&&d.state.isMuted?1:0,p=d.endpointProperties&&1===d.endpointProperties.preheatProperties?1:0,h=l&&l.state&&l.state.isMuted?1:0,g=l&&l.endpointProperties&&1===l.endpointProperties.preheatProperties?1:0;return!!(u^h||p^g)},this.setInitialTelemetry=function(l,d){var u,p;switch(l){case v.CALL_OPERATIONS.SUBSCRIBE:C.telemetryHelper.recordEvent(fe.EVENTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY,{causeId:d.causeId,correlationId:d.correlationId}),C.telemetryHelper.setDirection(fe.default.DIRECTION.INCOMING),C.telemetryHelper.setSelfParticipantRole(fe.default.ROLE.JOIN_FOR_ROSTER_ONLY),C.telemetryHelper.setConversationServiceUrl(d.conversationServiceUrl||C.signalingAgentConfig.conversationServiceUrl),C.telemetryHelper.setCallerType(C.participantManager.localParticipant.id);break;case v.CALL_OPERATIONS.ACKNOWLEDGE:C.telemetryHelper.recordEvent(fe.EVENTS.HANDLE_INCOMING_CALL,{causeId:d.causeId}),C.telemetryHelper.setDirection(fe.default.DIRECTION.INCOMING),C.telemetryHelper.setSelfParticipantRole(fe.default.ROLE.CALLEE),C.telemetryHelper.setCalleeType(C.participantManager.localParticipant.id);break;case v.CALL_OPERATIONS.JOIN_CALL:u=C.gatherTelemetryForStartOrJoin(d.joinCallOptions,d.causeId,d.offerGenerationTime),C.telemetryHelper.recordEvent(fe.EVENTS.JOIN_CALL,u),C.telemetryHelper.setDirection(fe.default.DIRECTION.INCOMING),C.telemetryHelper.setSelfParticipantRole(fe.default.ROLE.JOIN);break;case v.CALL_OPERATIONS.START_CALL:case v.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL:case v.CALL_OPERATIONS.START_CALL_WITH_NUDGE:case v.CALL_OPERATIONS.START_CALL_AND_UNPARK:p=C.gatherTelemetryForStartOrJoin(d.callStartOptions,d.causeId,d.offerGenerationTime),C.telemetryHelper.recordEvent(fe.EVENTS.START_CALL,p),C.telemetryHelper.setDirection(fe.default.DIRECTION.OUTGOING),C.telemetryHelper.setSelfParticipantRole(fe.default.ROLE.CALLER),C.telemetryHelper.startCallInitializationWatch(d.offerGenerationTime),C.telemetryHelper.setMeetingInfo(C.getMeetingInfo())}},this.getParticipantIdForOfferAnswer=function(l){_e.assertNotNull(l,\"mediaContent should be a non null value\"),C.logger.info(\"getParticipantIdForOfferAnswer\");var d=null;return!C.remoteUser||C.groupId||C.threadId||l.newOffer||l.escalationOccurring||(d=C.remoteUser.id),d},this.getMeetingInfo=function(){return C.meetingInfo},this.getEmergencyContent=function(){return C.telemetryHelper.recordEvent(fe.EVENTS.GET_EMERGENCY_CONTENT),C.emergencyContent},this.getEndpointId=function(){return C.signalingAgent.endpointId},this.getConversationUrl=function(){return C.links[ve.default.LINKS.CONVERSATION_CONTROLLER]},this.setJoinedFrom=function(l){!C.disposed&&l&&(C.telemetryHelper.recordEvent(fe.EVENTS.SET_JOINED_FROM),C.telemetryHelper.setJoinedFrom(l))},this.setSubject=function(l){C.disposed||(C.telemetryHelper.recordEvent(fe.EVENTS.SET_SUBJECT),_e.assertNotNull(l,\"subject should be a non null value\"),C.convSubject=l)},this.setDeviceType=function(l){C.disposed||(C.telemetryHelper.recordEvent(fe.EVENTS.SET_DEVICETYPE),l&&(C.deviceType=l,C.logger.info(\"setDeviceType\",C.deviceType)))},this.setOfferAnswerGenerationTimestamps=function(l){C.disposed||C.telemetryHelper.setOfferAnswerGenerationTimestamps(l)},this.setTimeToRingDuration=function(){C.disposed||C.telemetryHelper.setTimeToRingDuration()},this.setGroupId=function(l){C.telemetryHelper.recordEvent(fe.EVENTS.SET_GROUPID),C.groupId!==l&&l&&(_e.assert(!C.groupId,\"conversation groupId has already been set. It cannot be overwritten\"),C.groupId=l)},this.setThreadId=function(l){C.telemetryHelper.recordEvent(fe.EVENTS.SET_THREADID),_e.assertNotNull(l,\"threadId should be a non null value\"),C.threadId!==l&&(_e.assert(!C.threadId,\"conversation threadId has already been set. It cannot be overwritten\"),C.threadId=l)},this.setCallOptions=function(l){if(_e.assertNotNull(l,\"callOptions should be a non null value\"),C.logger.info(\"setCallOptions\",(0,y.getPrintableObject)(l)),C.telemetryHelper.recordEvent(fe.EVENTS.SET_CALLOPTIONS),l){C.teamsMessageId=l.teamsMessageId||null,C.meetingInfo=l.meetingInfo||null,C.emergencyContent=l.emergencyContent||null,C.enableGroupCallMeetupGeneration=l.enableGroupCallMeetupGeneration||!1,l.broadcastContext&&(C.broadcastSession=new T.default(C,C.signalingSessionCallback),C.broadcastSession.setContext(l.broadcastContext));try{C.endpointMetadata=JSON.parse(l.endpointMetadata)}catch(l){C.logger.warn(\"Unable to parse endpoint metadata\")}}},this.setTransferContext=function(l){_e.assertNotNull(l,\"transferContext should not be null\"),C.logger.info(\"Transfer: setTransferContext\",l),C.telemetryHelper.recordEvent(fe.EVENTS.SET_TRANSFER_CONTEXT),C.transferContext=l},this.muteAsync=function(l,d,u){return void 0===u&&(u=_e.causeId()),_e.assert(2!==C.callMode||l!==ve.default.MUTE_SCOPE.MYSELF,\"mute self operation is not allowed in streaming mode\"),C.logger.info(\"[\".concat(u,\"][muteAsync][scope=\").concat(l,\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.MUTE,{causeId:u}),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"[\".concat(u,\"]mute operation for all or specified only allowed in a connected call\")),C.participantManager.muteAsync(C.links[ve.default.LINKS.MUTE],l,d,u)},this.unmuteAsync=function(l){return void 0===l&&(l=_e.causeId()),_e.assert(2!==C.callMode,\"unmute operation is not allowed in streaming mode\"),C.logger.info(\"[\".concat(l,\"][unmuteAsync]\")),C.telemetryHelper.recordEvent(fe.EVENTS.UNMUTE,{causeId:l}),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"unmute operation only allowed in a connected call\"),C.participantManager.unmuteAsync(C.links[ve.default.LINKS.UNMUTE],l)},this.recordTelemetryForStartAudio=function(l,d){return C.telemetryHelper.recordEvent(fe.EVENTS.START_AUDIO,{mediaNegotiationStatus:l,causeId:d}),Promise.resolve(null)},this.recordTelemetryForStopAudio=function(l,d){return C.telemetryHelper.recordEvent(fe.EVENTS.STOP_AUDIO,{mediaNegotiationStatus:l,causeId:d}),Promise.resolve(null)},this.rejectUnmuteRequestAsync=function(l,d,u){return void 0===d&&(d=_e.causeId()),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"rejectUnmute operation only allowed in a connected call\"),_e.assertNotNullOrEmpty(l,\"requestor must be specified\"),C.logger.info(\"[\".concat(d,\"][rejectUnmuteRequestAsync][rejectionReason=\").concat(u,\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.REJECT_UNMUTE,{causeId:d,rejectionReason:u}),C.participantManager.rejectUnmuteRequestAsync(l,d,u)},this.approveUnmuteRequestAsync=function(l,d){return void 0===d&&(d=_e.causeId()),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"approveUnmute operation only allowed in a connected call\"),_e.assertNotNullOrEmpty(l,\"requestor must be specified\"),C.logger.info(\"[\".concat(d,\"][approveUnmuteRequestAsync]\")),C.telemetryHelper.recordEvent(fe.EVENTS.APPROVE_UNMUTE,{causeId:d}),C.participantManager.approveUnmuteRequestAsync(l,d)},this.sendWebRtcMediaNotificationAsync=function(l,d,u){return void 0===u&&(u=_e.causeId()),_e.assert(2!==C.callMode,\"sendWebRtcMediaNotification operation is not allowed in streaming mode\"),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"webRtc media notification can only be sent in a connected call\"),C.telemetryHelper.recordEvent(fe.EVENTS.SEND_WEBRTC_MEDIA_NOTIFICATION,{causeId:u}),0===l?C.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:fe.NETWORK_REQUESTS.SEND_APPLY_CHANNEL_PARAMETERS.name,requestUrl:C.links[ve.default.LINKS.APPLY_CHANNEL_PARAMETERS],requestBody:d,stackRetry:!1},u):C.webRtcSignalingManager.sendWebRtcMediaNotificationAsync({operation:fe.NETWORK_REQUESTS.SEND_CONTROL_VIDEO_STREAMING.name,requestUrl:C.links[ve.default.LINKS.CONTROL_VIDEO_STREAMING],requestBody:d},u)},this.addParticipantsAsync=function(l,d,u){void 0===u&&(u=_e.causeId()),_e.assertNotNullOrEmpty(l,\"remoteParticipants should be a non null value\"),_e.assert(C.isCallOngoing()||C.isCallInProgress(),\"remoteParticipants can only be added before starting an outgoing call or to an ongoing call\"),C.logger.info(\"[\".concat(u,\"][addParticipantsAsync][addParticipantOptions=\").concat((0,y.getPrintableObject)(d),\"]\\n            [remoteParticipantId=\").concat(l.map((function(l){return C.piiUtils.scrubMriOrOmit(l.id)})),\"]\"));var p=fe.EVENTS.ADD_PARTICIPANT;switch(d.replacementType){case 2:p=fe.EVENTS.ADD_PARTICIPANT_WITH_PICKUP_CODE;break;case 1:case 3:p=fe.EVENTS.ADD_PARTICIPANT_WITH_REPLACES;break;default:p=fe.EVENTS.ADD_PARTICIPANT}C.telemetryHelper.recordEvent(p,{causeId:u}),d.groupId=C.groupId||d.groupId,d.threadId=C.threadId||d.threadId;var h=d.threadId||d.groupId?C.links[ve.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:C.links[ve.default.LINKS.ADD_PARTICIPANT],g=C.participantManager.addParticipantsAsync(l,h,C.isCallConnectedOrConnectedForRoster(),d,u);return C.currentCallStatus||C.setMultiParty(1!==C.participantManager.getParticipantsToInitiateCallWith().length,u),g},this.addGroupModalityAsync=function(l,d){_e.assert(C.isCallOngoing(),\"GroupModality can only be added before starting an outgoing call or to an ongoing call\"),C.logger.info(\"[\".concat(d,\"][addGroupModalityAsync][addGroupModalityOptions=\").concat((0,y.getPrintableObject)(l),\"]\"));var u=fe.EVENTS.ADD_PARTICIPANTS_AND_MODALITY;C.telemetryHelper.recordEvent(u,{causeId:d});var p=D.getPayload(C,null,l);return C.http.sendPostRequest({url:C.links[ve.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY],payload:p,requestName:fe.NETWORK_REQUESTS.ADD_PARTICIPANTS_AND_MODALITY.name,causeId:d}).then((function(){m.noop()})).catch((function(l){var u=_e.getErrorForXHRFailure(l,C.signalingAgentConfig);throw C.logger.info(\"[\".concat(d,\"][sendNetworkRequestForAddingParticipant] failed:\").concat((0,y.getPrintableObject)(u))),u.error}))},this.addBroadcastModalityAsync=function(l,d){if(_e.assert(C.isCallOngoing(),\"BroadcastModality can only be added before starting an outgoing call or to an ongoing call\"),C.logger.info(\"[\".concat(d,\"][addBroadcastModalityAsync][addBroadcastContext=\").concat((0,y.getPrintableObject)(C.addBroadcastModalityAsync),\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.ADD_BROADCAST_MODALITY,{causeId:d}),C.broadcastSession){var u=\"There is already a broadcast session\";return C.logger.info(u),Promise.resolve(ve.default.SUCCESS_TRANSACTION_END)}C.broadcastSession=new T.default(C,C.signalingSessionCallback),C.broadcastSession.setContext(l);var p=N.getPayload(C,l);return C.http.sendPostRequest({url:C.links[ve.default.LINKS.ADD_MODALITY],payload:p,requestName:fe.NETWORK_REQUESTS.ADD_BROADCAST_MODALITY.name,causeId:d}).then((function(l){return C.logger.info(\"[\".concat(d,\"][addBroadcastModalityAsync] response: \").concat((0,y.getPrintableObject)(l))),C.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_ADD_BROADCAST_MODALITY_COMPLETION,{causeId:d}),ve.default.SUCCESS_TRANSACTION_END})).catch((function(l){var u=_e.getErrorForXHRFailure(l);return C.logger.info(\"[\".concat(d,\"][sendNetworkRequestForAddBroadcastModalityAsync] failed:\").concat((0,y.getPrintableObject)(u))),C.endBroadcastMeeting(d),Promise.reject(u.error)}))},this.nudgeParticipantsAsync=function(l){if(_e.assertNotNull(l.participantsIds,\"ParticipantsIds should be a non null value\"),_e.assert(C.isCallOngoing(),\"Participants can only be nudged before starting an outgoing call or to an ongoing call\"),C.logger.info(\"[\".concat(l.causeId,\"][nudgeParticipantsAsync][participantsIds=\").concat(C.piiUtils.scrubParticipantsList(l.participantsIds),\"][invitationData=\").concat(l.invitationData,\"]\")),void 0===l.participantsIds||l.participantsIds.length<1)return Promise.reject(\"List of participants to nudge is empty\");C.telemetryHelper.recordEvent(fe.EVENTS.ADD_PARTICIPANT,{withNudge:ve.default.INVITATION_TYPE.NUDGE,causeId:l.causeId});var d=C.groupId||l.newGroupId,u=C.threadId||l.newThreadId,p=C.teamsMessageId||l.newMessageId,h=u||d?C.links[ve.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]:C.links[ve.default.LINKS.ADD_PARTICIPANT];return C.participantManager.nudgeParticipantsAsync(l.participantsIds,h,C.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING||C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,l.causeId,l.invitationData,d,u,p)},this.callMeBackAsync=function(l,d){return void 0===d&&(d=_e.causeId()),_e.assertNotNull(l,\"remoteParticipant should be a non null value\"),C.logger.info(\"[\".concat(d,\"][callMeBackAsync][remoteParticipantId=\").concat(C.piiUtils.scrubMriOrOmit(l.id),\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.CALL_ME_BACK,{causeId:d}),C.hasGroupModality()||_e.assert(!1,\"threadId/groupId must be set before using call me back\"),C.participantManager.callMeBackAsync(l,C.links[ve.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY],d)},this.removeParticipantAsync=function(l,d,u){switch(void 0===d&&(d=_e.causeId()),void 0===u&&(u=\"none\"),_e.assertNotNull(l,\"remoteParticipant should be a non null value\"),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"participants can only be removed from an ongoing call\"),C.logger.info(\"[\".concat(d,\"][removeParticipantAsync][remoteParticipantId=\").concat(C.piiUtils.scrubMriOrOmit(l.id),\"] [removeEndpointScope] \").concat(u)),u){case\"all\":C.telemetryHelper.recordEvent(fe.EVENTS.REMOVE_PARTICIPANT_OTHERS,{causeId:d});break;case\"specified\":C.telemetryHelper.recordEvent(fe.EVENTS.REMOVE_PARTICIPANT_SPECIFIED,{causeId:d});break;default:C.telemetryHelper.recordEvent(fe.EVENTS.REMOVE_PARTICIPANT,{causeId:d})}return\"none\"!==u&&l.endpointId?C.participantManager.removeParticipantEndpointAsync(l,C.links[ve.default.LINKS.REMOVE_PARTICIPANT],u,d):C.participantManager.removeParticipantAsync(l,C.links[ve.default.LINKS.REMOVE_PARTICIPANT],d)},this.admitParticipantAsync=function(l,d){return void 0===d&&(d=_e.causeId()),_e.assertNotNull(l,\"remoteParticipant should be a non null value\"),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"remoteParticipants can only be admitted to an ongoing call\"),C.hasGroupModality()||_e.assert(!1,\"threadId/groupId must be set before admitting more participants to connected call\"),C.logger.info(\"[\".concat(d,\"][admitParticipantAsync][remoteParticipantId=\").concat(C.piiUtils.scrubMriOrOmit(l.id),\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.ADMIT_PARTICIPANT,{causeId:d}),C.participantManager.admitParticipantAsync(l,C.links[ve.default.LINKS.ADMIT],d)},this.admitAsync=function(l){if(C.logger.info(\"[\".concat(l,\"][admitAsync]\")),C.telemetryHelper.recordEvent(fe.EVENTS.ADMIT,{causeId:l}),!C.links[ve.default.LINKS.ADMIT_ALL]){var d={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.ADMIT_ALL_LINK_MISSING,phrase:ve.default.CALL_END_PHRASE.ADMIT_ALL_URL_MISSING};return C.telemetryHelper.recordEvent(fe.EVENTS.ADMIT_FAILURE,{causeId:l,transactionEnd:d}),C.logger.warn(\"admitAsync error \".concat(JSON.stringify(d))),Promise.reject(d)}var u=_e.defer();return C.callOperationHandler.setPendingOperation(0,l,{promise:u,causeId:l},l),C.sendNetworkRequestForAdmit(l),u.promise},this.updateMeetingRolesAsync=function(l,d,u){return void 0===u&&(u=_e.causeId()),_e.assertNotNull(l,\"participants array should be a non null value\"),_e.assertNotNull(d,\"meetingRole should be a non null value\"),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"remote participant roles can only be updated in an ongoing call\"),C.logger.info(\"[\".concat(u,\"][updateMeetingRolesAsync][participants=\").concat(C.piiUtils.scrubMriOrOmit(l),\"]\")),C.participantManager.updateMeetingRolesAsync(l,d,C.links[ve.default.LINKS.UPDATE_PARTICIPANT_ROLE],u)},this.startContentSharingAsync=function(l,d,u,p,h){return void 0===h&&(h=_e.causeId()),_e.assertNotNull(l,\"contentIdentifier should be a non null value\"),_e.assert(C.isCallOngoing(),\"contentSharing can only be added before starting an outgoing call or to an ongoing call\"),C.logger.info(\"[\".concat(h,\"][startContentSharingAsync]\")),C.telemetryHelper.recordEvent(fe.EVENTS.ADD_CONTENT_SHARING_MODALITY,{causeId:h}),C.contentSharingManager.startContentSharingAsync(l,d,u,C.links[ve.default.LINKS.ADD_MODALITY],C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,h,p)},this.deleteContentSharingAsync=function(l,d){return void 0===d&&(d=_e.causeId()),C.logger.info(\"[\".concat(d,\"][deleteContentSharingAsync][correlationId=\").concat(l,\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.DELETE_CONTENT_SHARING,{causeId:d,correlationId:l}),C.contentSharingManager.deleteContentSharingAsync(l,d)},this.joinContentSharingAsync=function(l,d){return void 0===d&&(d=_e.causeId()),C.logger.info(\"[\".concat(d,\"][joinContentSharingAsync][correlationId=\").concat(l,\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.JOIN_CONTENT_SHARING,{causeId:d,correlationId:l}),C.contentSharingManager.joinContentSharingAsync(l,d)},this.updateContentSharingSessionStateAsync=function(l,d,u){return void 0===u&&(u=_e.causeId()),_e.assertNotNull(d,\"sessionState should be a non null value\"),C.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_SESSION_STATE_CONTENT_SHARING,{causeId:u,correlationId:l}),C.logger.info(\"[\".concat(u,\"][updateContentSharingSessionStateAsync][correlationId=\").concat(l,\"][sessionState=\").concat(d,\"]\")),C.contentSharingManager.updateContentSharingSessionStateAsync(l,d,u)},this.takeContentSharingControlAsync=function(l,d){return void 0===d&&(d=_e.causeId()),C.telemetryHelper.recordEvent(fe.EVENTS.TAKE_CONTROL_CONTENT_SHARING,{causeId:d,correlationId:l}),C.logger.info(\"[\".concat(d,\"][takeContentSharingControlAsync][correlationId=\").concat(l,\"]\")),C.contentSharingManager.takeContentSharingControlAsync(l,d)},this.updateContentSharingParticipantStateAsync=function(l,d){return void 0===d&&(d=_e.causeId()),C.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING,{causeId:d}),C.logger.info(\"[\".concat(d,\"][updateContentSharingParticipantStateAsync][correlationId=\").concat(l,\"]\")),C.contentSharingManager.updateContentSharingParticipantStateAsync(l,d)},this.configureEndpointStateForStartOrJoin=function(l){var d={endpointStateSequenceNumber:C.endpointStateSequenceNumber},u=!1;if(l&&(l.muted&&(u=!0,Object.assign(d,{state:{isMuted:l.muted}})),l.isPreheatOnly||l.additionalEndpointProperties)){var p={};u=!0,l.isPreheatOnly&&(p.preheatProperties=1),l.additionalEndpointProperties&&(p.additionalEndpointProperties=l.additionalEndpointProperties),Object.assign(d,{endpointProperties:p})}if(u)return d},this.gatherTelemetryForStartOrJoin=function(l,d,u){var p={causeId:d};return l&&(l.invitationType===ve.default.INVITATION_TYPE.NUDGE&&(p.withNudge=l.invitationType===ve.default.INVITATION_TYPE.NUDGE),l.parkContext&&(p.unpark=!0,p.context=l.parkContext),l.isLwj&&(p.isLwj=!0),l.isPreheatOnly&&(p.isPreheatOnly=!0)),p},this.startOutgoingCall=function(l,d,u,p,h){if(void 0===h&&(h=_e.causeId()),u&&u.isLwj?C.joinedLightWeight=!0:(_e.assertNotNull(l,\"mediaContent should be a non null value\"),_e.assertNotNull(l.blob,\"outgoingSdp should be a non null value\")),_e.assert(C.isCallInProgress(),\"a call is already in progress\"),C.logger.info(\"[\".concat(h,\"][startOutgoingCall][start] applicationType=\").concat(C.participantManager.localParticipant.applicationType)),C.disposed)C.logger.warn(\"[\".concat(h,\"][startOutgoingCall][failed][reason=Session disposed]\"));else{C.lastUsedJoinCallOptions={muted:u?u.muted:null,scenario:u?u.scenario:null,isPreheatOnly:u?u.isPreheatOnly:null,clientEndpointCapabilities:u?u.clientEndpointCapabilities:null,clientEndpointDebugContent:u?u.clientEndpointDebugContent:null},C.originalRoleBeforePreheat=fe.default.ROLE.CALLER,u&&u.scenario&&C.telemetryHelper.setScenario(u.scenario),C.logger.info(\"[\".concat(h,\"][startOutgoingCall]options=\").concat((0,y.getPrintableObject)(C.gatherTelemetryForStartOrJoin(u,h,p)))),C.isBrokerEnabledForOutgoingCall()&&C.setupBrokerChannel(),C.callUsesMixer=!(!u||!u.callUsesMixer),C.fsmState=ve.default.SIGNALING_FSM_STATE.OUTGOING,C.meetingData=u&&u.meetingData,C.meetingPreferences=u&&u.meetingPreferences;var g={newCall:!0,suppressDialout:u&&u.suppressDialout||!1,conversationServiceUrl:C.signalingAgentConfig.conversationServiceUrl,onBehalfOf:u?u.onBehalfOf:null,enableLightWeightMeeting:u?u.isLwj:null,callToVoicemail:!!u&&u.callToVoicemail,voicemailResourcePath:u?u.voicemailResourcePath:null,voicemailItemId:u?u.voicemailItemId:null,endpointState:C.configureEndpointStateForStartOrJoin(u),invitationType:u&&u.invitationType?u.invitationType:null,participantsToNudge:u&&Array.isArray(u.participantsToNudge)?u.participantsToNudge:null,routingFlags:u?u.routingFlags:null,parkContext:u?u.parkContext:null,pickupCode:u?u.pickupCode:null,scenario:u?u.scenario:null,isPreheatOnly:!!u&&u.isPreheatOnly,applicationType:C.participantManager.localParticipant.applicationType,clientEndpointCapabilities:u?u.clientEndpointCapabilities:0,clientEndpointDebugContent:u?u.clientEndpointDebugContent:null,invitationData:u?u.invitationData:null,conversationType:u?C.getConversationType(u.isEmergency,u.castCall):null,meetingData:C.meetingData,meetingPreferences:C.meetingPreferences,alternateId:u?u.alternateId:null,meetingRegistrationId:u.meetingRegistrationId};C.isCastCall=u&&u.castCall,C.onBehalfOf=g.onBehalfOf,C.startOrJoinCall(g,fe.NETWORK_REQUESTS.START_CALL.name,h,l,d)}},this.joinGivenConversation=function(l,d,u,p,h,g,f){if(void 0===g&&(g={}),void 0===f&&(f=_e.causeId()),_e.assertNotNull(d,\"correlationId should be a non null value\"),_e.assertNotNullOrEmpty(l||C.getConversationUrl(),\"conversationUrl should be a non null value\"),g.isLwj?C.joinedLightWeight=!0:(_e.assertNotNull(u,\"mediaContent should be a non null value\"),_e.assertNotNull(u.blob,\"outgoingSdp should be a non null value\")),_e.assert(C.isCallInProgress(),\"a call is already in progress\"),C.logger.info(\"[\".concat(f,\"][joinGivenConversation][start][correlationId=\").concat(d,\"] applicationType=\").concat(C.participantManager.localParticipant.applicationType)),C.disposed)C.logger.warn(\"[\".concat(f,\"][joinGivenConversation][failed][reason=Session disposed]\"));else{var m=C.gatherTelemetryForStartOrJoin(g,f,h);C.lastUsedJoinCallOptions=g,C.originalRoleBeforePreheat=fe.default.ROLE.JOIN,C.telemetryHelper.startCallInitializationWatch(h),g&&g.scenario&&C.telemetryHelper.setScenario(g.scenario),C.logger.info(\"[\".concat(f,\"][joinGivenConversation]options=\").concat((0,y.getPrintableObject)(m))),C.isBrokerEnabledForIncomingCall()&&C.setupBrokerChannel(),C.fsmState=ve.default.SIGNALING_FSM_STATE.OUTGOING,C.updateCorrelationId(d,f),C.meetingData=g&&g.meetingData,C.meetingPreferences=g&&g.meetingPreferences;var v={newCall:!1,suppressDialout:!0,conversationServiceUrl:l,enableLightWeightMeeting:g.isLwj,endpointState:C.configureEndpointStateForStartOrJoin(g),scenario:g?g.scenario:null,isPreheatOnly:!!g&&g.isPreheatOnly,applicationType:C.participantManager.localParticipant.applicationType,clientEndpointCapabilities:g?g.clientEndpointCapabilities:0,clientEndpointDebugContent:g?g.clientEndpointDebugContent:null,conversationType:g?C.getConversationType(g.isEmergency,!1):null,meetingPreferences:C.meetingPreferences,meetingData:C.meetingData,meetingRegistrationId:null==g?void 0:g.meetingRegistrationId,sharedLineCallInvitationContent:null==g?void 0:g.sharedLineCallInvitationContent,applyServerMute:null==g?void 0:g.applyServerMute};C.isCastCall=!1,C.startOrJoinCall(v,fe.NETWORK_REQUESTS.JOIN_CONVERSATION.name,f,u,p)}},this.subscribeToCall=function(l,d,u,h,g){void 0===u&&(u=0),void 0===g&&(g=_e.causeId()),_e.assertNotNull(d,\"correlationId should be a non null value\"),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.IDLE,\"a call is already in progress\");var f=l;return f||(f=C.signalingAgentConfig.conversationServiceUrl,C.logger.info(\"conversationServiceUrl passed is empty. so it is set to \".concat(f))),_e.assertNotNullOrEmpty(f,\"conversationUrl should be a non null value\"),C.logger.info(\"[\".concat(g,\"][subscribeToCall][start][correlationId=\").concat(d,\"] applicationType=\").concat(C.participantManager.localParticipant.applicationType)),C.disposed?(C.logger.warn(\"[\".concat(g,\"][subscribeToCall][failed][reason=Session disposed]\")),Promise.reject(ve.default.CALL_END_CODE.CALL_DOES_NOT_EXIST)):(C.isBrokerEnabledForIncomingCall()&&C.setupBrokerChannel(),C.fsmState=ve.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY,C.updateCorrelationId(d,g),C.http.sendPostRequest({url:f,requestName:fe.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY.name,operationType:\"CallSetup\",payload:W.getPayload(C,null,null,p(p({subscribe:!0,clientEndpointCapabilities:u},h),{applicationType:C.participantManager.localParticipant.applicationType,endpointState:C.configureEndpointStateForStartOrJoin({additionalEndpointProperties:null==h?void 0:h.additionalEndpointProperties})}),g),causeId:g}).then((function(l){C.disposed||(C.fsmState=ve.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY,C.processConversationServiceResponseHeaders(l,g),C.processConversationServiceResponse(l.response,g),C.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY,g),l.response.roster&&C.internalHandleRosterUpdate(l.response.roster,!0,g))})).catch((function(l){if(l.stack&&!C.isFatalException(l))return Promise.resolve();var d=_e.getErrorForXHRFailure(l,C.signalingAgentConfig);return C.logger.info(\"[\".concat(g,\"][subscribeToCall] error: \").concat((0,y.getPrintableObject)(l),\" xhrError: \").concat((0,y.getPrintableObject)(d))),C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):(C.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,C.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultValue:fe.default.RESULT_VALUE.FAILURE,endCode:d.telemetryEndSubCode,endSubCode:d.error.subCode,resultCategories:d.error.resultCategories,resultDetail:d.error.phrase||C.getTerminatingCallResultDetail(\"subscribe\",d.error),causeId:g}),C.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,g,d.error),Promise.reject(d.error))})))},this.getCallReplacementDetailsForCall=function(l,d){void 0===d&&(d=_e.causeId()),C.logger.info(\"[\".concat(d,\"] getCallReplacementDetailsForCall callId \").concat(l));var u=C.signalingAgent.getSignalingSession(l);return u?u.getCallReplacementDetails(d):{replaces:\"\"}},this.getCallReplacementDetails=function(l){return void 0===l&&(l=_e.causeId()),C.logger.info(\"[\".concat(l,\"] getCallReplacementDetails\")),{replaces:C.links[ve.default.LINKS.REPLACE]}},this.transferCallAsync=function(l,d,u,p,h){void 0===h&&(h=_e.causeId()),C.logger.info(\"[\".concat(h,\"] transferCallAsync: transferTargetMri: \").concat(C.piiUtils.scrubMriOrOmit(l),\" transferType \").concat(d,\" callTransferOptions: \").concat((0,y.safeJsonStringify)(p))),C.transferHelper(l,d,u,p,h)},this.redirectCall=function(l,d,u){void 0===d&&(d=_e.causeId());var p=l.redirectOptions,h=p.id,g=p.endpointType,f=p.type;if(C.logger.info(\"[\".concat(d,\"] redirectCall: targetId: \").concat(C.piiUtils.scrubMriOrOmit(h),\" targetEndpointType \").concat(g)),!C.isRedirectAllowed){var m={code:ve.default.CALL_END_CODE.REJECT,phrase:ve.default.CALL_END_PHRASE.CALL_REDIRECT_IS_NOT_ALLOWED};return Promise.reject(m)}C.telemetryHelper.recordEvent(fe.EVENTS.CALL_REDIRECT,{causeId:d});var v=j.getPayload(C,f,h,g);return C.http.sendPostRequest({url:C.links[ve.default.LINKS.REDIRECT],requestName:fe.NETWORK_REQUESTS.SEND_CALL_REDIRECT_REQUEST.name,payload:v,causeId:d}).then((function(p){return C.logger.info(\"[\".concat(d,\"][redirectCall] succeeds. Leaving the call...\")),C.telemetryHelper.recordEvent(fe.EVENTS.CALL_REDIRECT_REQUEST_SENT,{causeId:d,targetEndpointType:g}),C.terminateEstablishedCall(u,l)})).catch((function(l){var p=_e.getErrorForXHRFailure(l);C.logger.info(\"[\".concat(d,\"][redirectCall] error: \").concat((0,y.getPrintableObject)(p)));var h=p.error;return C.telemetryHelper.recordEvent(fe.EVENTS.CALL_REDIRECT_REQUEST_FAILED,{causeId:d,transactionEnd:h,endpointType:g}),C.disposed||(C.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,endCode:u.code,endSubCode:u.subCode,clientReasonSubCode:u.clientReasonSubCode,clientReasonPhrase:u.clientReasonPhrase,resultDetail:u.phrase||\"RedirectCall\",resultCategories:u.resultCategories,causeId:d}),C.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,u),C.dispose(u,d)),Promise.reject(h)}))},this.transferHelper=function(l,d,u,h,g){void 0===g&&(g=_e.causeId()),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"call is not connected yet\");var f=!1;C.logger.info(\"[\".concat(g,\"][transferHelper][replacementDetails=\").concat((0,y.getPrintableObject)(u),\"] disableForwardingAndUnanswered=\").concat(h&&h.disableForwardingAndUnanswered)),C.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_CALL,{causeId:g}),C.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){C.handleCallTransferTimeout(g,f)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT),C.http.sendPostRequest({url:C.links[ve.default.LINKS.TRANSFER],requestName:fe.NETWORK_REQUESTS.SEND_TRANSFER_REQUEST.name,payload:re.getPayload(l,C,u,d,h),causeId:g}).then((function(){C.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_TRANSFER_ACCEPTANCE,{causeId:g}),f=!0})).catch((function(l){var d=_e.getErrorForXHRFailure(l,C.signalingAgentConfig);C.logger.info(\"[\".concat(g,\"][transferCallAsync] error: \").concat((0,y.getPrintableObject)(d))),C.disposed||(C.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:ve.default.CALL_END_CODE.NETWORK_ERROR,reason:(0,y.getPrintableObject)(l)}},g),C.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_REQUEST_FAILED,p({causeId:g},d.error)))})),C.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_REQUEST_SENT,{causeId:g,transferType:d})},this.consultTransferCallAsync=function(l,d,u,p,h){var g,f;if(C.logger.info(\"[\".concat(p,\"] consultTransferCallAsync: transferTargetMri: \").concat(C.piiUtils.scrubMriOrOmit(d),\" transferTargetParticipantLegId: \").concat(u)),u?(f=C.getMriByParticipantLegOfCall(l,u,p),g=C.getReplacementDetailsByParticipantLegOfCall(l,d,u,p)):(f=d,g=C.getCallReplacementDetailsForCall(l,p)),!f||!g){var m=g?\"target mri corresponding not found\":\"unable to retrieve replacementDetails for transferTargetCallId: \".concat(l,\", transferTargetMri: \").concat(d,\", transferTargetParticipantLegId: \").concat(u);return C.logger.info(\"[\".concat(p,\"] consultTransferCallAsync: error: \").concat(m)),void C.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:ve.default.CALL_END_CODE.BAD_REQUEST,reason:m}},p)}C.transferHelper(f,\"TransferTypeStandard\",g,h,p)},this.isParkByTransfer=function(l,d){var u=[\"serverHold\",\"sharedLinePark\",\"teamPark\"].indexOf(l)>-1;return C.logger.info(\"[\".concat(d,\"][isParkByTransfer][context=\").concat(l,\"] result = \").concat(u)),u},this.parkCallAsync=function(l,d){if(void 0===d&&(d=_e.causeId()),l&&\"none\"===l)throw u={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:\"Unpark context is missing or none\"};if(_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"call is not connected yet\"),C.logger.info(\"[\".concat(d,\"][parkCallAsync][context=\").concat(l,\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.PARK_CALL,{causeId:d,context:l}),C.isParkByTransfer(l,d))return C.parkByTransfer(l,d);if(C.signalingAgentConfig.enableMusicOnHoldV2)return C.park(l,d);var u={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.PARK_UNPARK_V2_DISABLED,phrase:\"Park context request was \".concat(l,\" but park/unpark v2 was disabled.\")};return Promise.reject(u)},this.unparkAsync=function(l,d){if(void 0===d&&(d=_e.causeId()),l&&\"none\"===l)throw{code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:\"Unpark context is missing or none\"};if(!C.links[ve.default.LINKS.UNPARK])throw{code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.PARK_UNPARK_TYPE_MISSING,phrase:\"Unpark link not available\"};C.logger.info(\"[\".concat(d,\"][unparkAsync][context=\").concat(l,\"]\")),C.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION,(function(){C.handleUnparkError({code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.UNPARK_COMPLETION_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.UNPARK_COMPLETION_TIMEOUT},fe.EVENTS.WAITING_FOR_UNPARK_COMPLETION_TIMEOUT,d,l)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.UNPARK_COMPLETION_TIMEOUT);var u={causeId:d};return C.http.sendPostRequest({url:C.links[ve.default.LINKS.UNPARK],requestName:fe.NETWORK_REQUESTS.SEND_UNPARK_REQUEST.name,payload:ae.getPayload(C,u),causeId:d}).then((function(l){return C.logger.info(\"[\".concat(d,\"][unparkAsync] response: \").concat((0,y.getPrintableObject)(l))),C.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_UNPARK_COMPLETION,{causeId:d}),Promise.resolve()})).catch((function(u){var p=_e.getErrorForXHRFailure(u,C.signalingAgentConfig);return C.logger.info(\"[\".concat(d,\"][unparkAsync] error: \").concat((0,y.getPrintableObject)(p))),C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):(C.handleUnparkError(p.error,fe.EVENTS.UNPARK_REQUEST_FAILED,d,l),Promise.reject(p.error))}))},this.getCallStatus=function(){return C.currentCallStatus},this.processIncomingCallRequest=function(l,d,u){if(void 0===u&&(u=_e.causeId()),_e.assertNotNull(l,\"request should be a non null value\"),_e.assertNotNullOrEmpty(l.body,\"request should have a valid body\"),_e.assertNotNullOrEmpty(l.body.gp||l.body.cp,\"request body should have payload\"),_e.assert(C.isCallInProgress(),\"a call is already in progress\"),C.callUsesMixer=l.fromMixer,C.logger.info(\"[\".concat(u,\"][processIncomingCallRequest][start]\")),C.disposed)C.logger.warn(\"processIncomingCallRequest canceled\");else{C.telemetryHelper.startCallInitializationWatch(),C.isIncomingCall=!0,C.isBrokerEnabledForIncomingCall()&&C.setupBrokerChannel(),C.fsmState=ve.default.SIGNALING_FSM_STATE.INCOMING,C.participantManager.initializeForIncomingCall();var p={};try{d&&(p=JSON.parse(d))}catch(l){C.logger.warn(\"Unable to parse endpoint metadata\")}C.endpointMetadata=p;try{var h=void 0;if(l&&l.body&&l.body.gp&&!(0,E.isStringBase64)(l.body.gp))C.logger.info(\"[\".concat(u,\"][processIncomingCallRequest] unencoded payload, skipping decoding.\")),h=l.body.gp;else{var g=l.body.gp?atob(l.body.gp):_e.decodeMessage(l.body.cp);h=JSON.parse(g)}if(!h.callNotification)throw C.logger.info(\"[\".concat(u,\"][processIncomingCallRequest][failed][reason=CallNotification missing]\")),new Error(\"CallNotification is missing\");C.processIncomingCallPayload(h,u),C.incomingCallPayload=h}catch(l){C.endIncomingCallBecauseOfInvalidPayload(u)}}},this.sendAttachToCall=function(l){return void 0===l&&(l=_e.causeId()),C.logger.info(\"[\".concat(l,\"][sendAttachToCall]\")),C.incomingCallPayload?(C.onCallStatusChanged(ve.default.CALL_STATUS.IDLE,l),C.sendAttachToCallInternal(l)):(C.endIncomingCallBecauseOfInvalidPayload(l),Promise.reject(ve.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD))},this.supportsNewOfferRequest=function(){return C.signalingAgentConfig.handleNewOfferRequest},this.requestNewOffer=function(l,d){return void 0===d&&(d=_e.causeId()),C.telemetryHelper.recordEvent(fe.EVENTS.REQUEST_NEW_OFFER,{compatibleContentTypes:l,causeId:d}),C.signalingAgentConfig.handleNewOfferRequest?(_e.assertNotNullOrEmpty(C.links[ve.default.LINKS.NEW_OFFER],\"newOffer link should be a non null value\"),C.http.sendPostRequest({url:C.links[ve.default.LINKS.NEW_OFFER],requestName:fe.NETWORK_REQUESTS.REQUEST_NEW_OFFER.name,payload:J.getPayload(C,l,C.links[ve.default.LINKS.NEW_OFFER]),causeId:d}).then((function(l){return C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):Promise.resolve(l)})).catch((function(l){var u=_e.getErrorForXHRFailure(l,C.signalingAgentConfig);return C.logger.info(\"[requestNewOffer][\".concat(d,\"] error \").concat((0,y.getPrintableObject)(u))),C.disposed?Promise.reject(C.getCallNotFoundTransactionEnd()):(C.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,C.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultValue:fe.default.RESULT_VALUE.FAILURE,endCode:u.telemetryEndSubCode,endSubCode:u.error.subCode,resultCategories:u.error.resultCategories,resultDetail:u.error.phrase||C.getTerminatingCallResultDetail(\"requestNewOffer\",u.error),causeId:d}),C.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,u.error),C.dispose(u.error,d),Promise.reject(u.error))}))):Promise.reject(\"Disabled\")},this.endAsync=function(l,d){var u,p,h,g;void 0===d&&(d={}),d.causeId=d.causeId||_e.causeId();var v=d.causeId;if(C.logger.info(\"[\".concat(v,\"][endAsync][rejectionData=\").concat(l&&(0,y.getPrintableObject)(l),\"][endCallForAll=\").concat(d.forEveryone,\"]\")),C.disposed)return C.logger.warn(\"[\".concat(v,\"][endAsync] canceled but session already disposed\")),Promise.resolve(null);if(C.disposing=!0,C.telemetryHelper.recordEvent(fe.EVENTS.END_CALL,l?{code:l.code,subCode:l.subCode,causeId:v,callEndClientSubCode:l.clientReasonSubCode,callEndClientPhrase:l.clientReasonPhrase}:{causeId:v}),d.preventAllCallbacks){var S=Object.keys(C.signalingSessionCallback);try{for(var _=f(S),E=_.next();!E.done;E=_.next()){var T=E.value;C.signalingSessionCallback[T]=m.noop}}catch(l){u={error:l}}finally{try{E&&!E.done&&(p=_.return)&&p.call(_)}finally{if(u)throw u.error}}}var b=(null===(h=C.mediaRenegotiationManager)||void 0===h?void 0:h.isIncomingRenegotiationInProgress())||(null===(g=C.mediaRenegotiationManager)||void 0===g?void 0:g.isOutgoingRenegotiationInProgress());if(C.telemetryHelper.stopCallCancelationDurationWatch(),C.fsmState===ve.default.SIGNALING_FSM_STATE.INCOMING)return l.code===ve.default.CALL_END_CODE.CALL_REDIRECTED?C.redirectCall(d,v,l):C.rejectIncomingCall(l,v);if(C.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING||C.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY)return C.cancelOutgoingCall(l,v);if(C.fsmState===ve.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK)return C.rejectIncomingCall(l,v);if((C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED||b)&&d.forEveryone)return C.deleteConversation(l,v);if(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED||C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY||b)return C.terminateEstablishedCall(l,d);C.logger.info(\"[\".concat(v,\"][endAsync] there is no call to cancel or end or reject in current state\"));var I=l&&(l.code||l.subCode)?l:{code:ve.default.CALL_END_CODE.NOT_FOUND,subCode:ve.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:ve.default.CALL_END_PHRASE.CALL_DOES_NOT_EXIST,resultCategories:[ve.RESULT_CATEGORIES.ExpectedError]};return l&&C.setClientRejectReason(I,l),C.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultDetail:I.phrase||\"CallDoesNotExist\",endCode:I.code,endSubCode:I.subCode,resultCategories:I.resultCategories,causeId:v,clientReasonSubCode:I.clientReasonSubCode,clientReasonPhrase:I.clientReasonPhrase}),C.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,v,I),C.dispose(I,v),Promise.resolve(null)},this.handleIncomingMsgAsync=function(l,d){var u,h;void 0===d&&(d=ve.default.INCOMING_MESSAGE_ORIGIN.TROUTER),_e.assertNotNull(l,\"incoming message should be a non null value\");var g=l.headers?l.headers[ve.default.HEADERS.ORIGINAL_MESSAGE_ID]:\"unknown\",f=_e.defer(),m=l.body,v=l.url,S=p(p({},l),{origin:d}),_=_e.extractCauseIdFromMessage(S);if(C.logger.info(\"[\".concat(_,\"][handleIncomingMsgAsync][url=\").concat(v,\"][messageId=\").concat(g,\"]\")),!m)return C.logger.info(\"[\".concat(_,\"][handleIncomingMsgAsync][failed][reason=received message with no body]\")),C.telemetryHelper.recordEvent(fe.EVENTS.MESSAGE_MISSING_BODY,{origin:d,messageId:g,causeId:_}),f.reject(new Error(\"received message with no body\")),f.promise;if(C.disposed)return C.logger.info(\"[\".concat(_,\"][handleIncomingMsgAsync][failed][reason=call is disposed]\")),f.reject(C.getCallNotFoundTransactionEnd()),f.promise;if(C.isDuplicatedIncomingMessage(S))return C.logger.info(\"[\".concat(_,\"][handleIncomingMsgAsync][failed][reason=duplicate]\")),C.telemetryHelper.recordEvent(fe.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:d,messageId:g,causeId:_}),f.resolve(new Error(\"Message was already handled\")),f.promise;C.checkCorrelationIdChange(l,_);var E=((u={})[ve.PAYLOAD_PROPERTY.CALL_NOTIFICATION]=function(l){C.handleCallNotification(l)},u[ve.PAYLOAD_PROPERTY.MEDIA_ANSWER]=function(l){C.handleMediaAnswer(l)},u[ve.PAYLOAD_PROPERTY.MEDIA_ACKNOWLEDGEMENT]=function(l){C.handleMediaAcknowledgement(l)},u[ve.PAYLOAD_PROPERTY.CALL_ACCEPTANCE]=function(l){C.handleCallAcceptance(l)},u[ve.PAYLOAD_PROPERTY.CALL_END]=function(l){C.handleCallEnd(l)},u[ve.PAYLOAD_PROPERTY.CALL_PROGRESS]=function(l){C.handleCallProgress(l)},u[ve.PAYLOAD_PROPERTY.CALL_ACCEPTANCE_ACKNOWLEDGEMENT]=function(l){C.handleCallAcceptanceAck(l)},u[ve.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION]=function(l){var d;null===(d=C.mediaRenegotiationManager)||void 0===d||d.handleMediaNegotiationOffer(l)},u[ve.PAYLOAD_PROPERTY.MEDIA_NEGOTIATION_FAILURE]=function(l){var d;null===(d=C.mediaRenegotiationManager)||void 0===d||d.handleMediaNegotiationFailure(l)},u[ve.PAYLOAD_PROPERTY.BALANCE_UPDATE]=function(l){C.handlePSTNBalanceUpdate(l)},u[ve.PAYLOAD_PROPERTY.RETARGET_COMPLETED]=function(l){var d;null===(d=C.mediaRenegotiationManager)||void 0===d||d.handleRetargetCompleted(l)},u[ve.PAYLOAD_PROPERTY.CALL_TRANSFER]=function(l){C.handleTransferRequested(l)},u[ve.PAYLOAD_PROPERTY.TRANSFER_COMPLETION]=function(l){C.handleTransferCompletion(l)},u[ve.PAYLOAD_PROPERTY.TRANSFER_ACCEPTANCE]=function(l){C.handleTransferAcceptance(l)},u[ve.PAYLOAD_PROPERTY.PARK_COMPLETION]=function(l){C.handleParkCompletion(l)},u[ve.PAYLOAD_PROPERTY.UNPARK_COMPLETION]=function(l){C.handleUnparkCompletion(l)},u[ve.PAYLOAD_PROPERTY.UPDATE_MEETING_LIVE_STATE_RESPONSE]=function(l){C.handleUpdateMeetingLiveStateCompletion(l)},u[ve.PAYLOAD_PROPERTY.UPDATE_MEETING_GROUPS_RESPONSE]=function(l){C.handleUpdateMeetingGroupsCompletion(l)},u[ve.PAYLOAD_PROPERTY.SET_MEETING_LAYOUT_RESPONSE]=function(l){C.handleSetMeetingLayoutCompletion(l)},u),T=((h={})[ve.URL_PATH.CONTROL_VIDEO_STREAMING]=function(l){C.webRtcSignalingManager.handleControlVideoStreaming(l)},h[ve.URL_PATH.DOMINANT_SPEAKER_INFO]=function(l){C.webRtcSignalingManager.handleDominantSpeakerInfo(l)},h[ve.URL_PATH.CSRC_INFO]=function(l){C.webRtcSignalingManager.handleCsrcInfo(l)},h[ve.URL_PATH.CONV_ROSTER_UPDATE]=function(l){C.handleRosterUpdate(l,!1)},h[ve.URL_PATH.NEW_MEDIA_OFFER]=function(l){C.handleNewMediaOffer(l)},h[ve.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS]=function(l){C.participantManager.handleAddParticipantSuccess(l)},h[ve.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE]=function(l){C.participantManager.handleAddParticipantFailure(l)},h[ve.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS]=function(l){C.participantManager.handleAdmitParticipantSuccess(l)},h[ve.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE]=function(l){C.participantManager.handleAdmitParticipantFailure(l)},h[ve.URL_PATH.CONV_ADMIT_ALL_STATUS]=function(l){C.handleAdmitAllStatus(l)},h[ve.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS]=function(l){C.participantManager.handleRemoveParticipantSuccess(l)},h[ve.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE]=function(l){C.participantManager.handleRemoveParticipantFailure(l)},h[ve.URL_PATH.CONV_CONFIRM_UNMUTE]=function(l){C.participantManager.handleUnmuteConfirmRequest(l)},h[ve.URL_PATH.CONV_UPDATE]=function(l){C.handleConversationUpdate(l)},h[ve.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE]=function(l){C.handleLocalParticipantUpdate(l)},h[ve.URL_PATH.CONV_ADD_MODALITY_SUCCESS]=function(l){C.handleAddModalitySuccess(l)},h[ve.URL_PATH.CONV_ADD_MODALITY_FAILURE]=function(l){C.handleAddModalityFailure(l)},h[ve.URL_PATH.CONV_BROADCAST_UPDATE]=function(l){C.broadcastSession.handleBroadcastStateChanged(l)},h[ve.URL_PATH.CONV_CONTENT_SHARING_UPDATE]=function(l){var d;null===(d=C.contentSharingManager)||void 0===d||d.handleContentSharingUpdate(l)},h[ve.URL_PATH.CONV_CONTENT_SHARING_END]=function(l){var d;null===(d=C.contentSharingManager)||void 0===d||d.handleContentSharingEnd(l)},h[ve.URL_PATH.CONV_END]=function(l){C.handleCallEnd(l)},h[ve.URL_PATH.LWJ_ACCEPTANCE]=function(l){C.handleLwjAcceptance(l)},h[ve.URL_PATH.LWJ_END]=function(l){C.handleCallEnd(l)},h[ve.URL_PATH.UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS]=function(l){C.participantManager.handleUpdateParticipantInterpretationStateCompletion(l)},h[ve.URL_PATH.JOIN_MEETING_GROUP_STATUS]=function(l){C.handleJoinMeetingGroupCompletion(l)},h[ve.URL_PATH.LEAVE_MEETING_GROUP_STATUS]=function(l){C.handleLeaveMeetingGroupCompletion(l)},h);try{var b=Object.keys(E).filter((function(l){return m.hasOwnProperty(l)}))[0],I=Object.keys(T).filter((function(l){return S.url&&_e.stringEndsWith(S.url,l)}))[0];b?E[b](S):I?T[I](S):(C.telemetryHelper.recordEvent(fe.EVENTS.UNKNOWN_MESSAGE_TYPE,{messageId:g}),C.logger.info(\"[\".concat(_,\"][handleIncomingMsgAsync][failed][reason=received unknown message]\"))),f.resolve(!0)}catch(l){C.telemetryHelper.recordEvent(fe.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:g,error:(0,y.getPrintableObject)(l)}),C.logger.info(\"[\".concat(_,\"][handleIncomingMsgAsync][failed][reason=\").concat(l.message,\"]\")),f.reject(new Error(l.message))}return f.promise},this.canHandleIncomingMsgSync=function(l){if(C.signalingAgentConfig.supportsSynchronousTrouterResponse){var d=l.body;return Boolean(d.callAcceptance)}return!1},this.handleIncomingMsgSync=function(l){var d=l.headers?l.headers[ve.default.HEADERS.ORIGINAL_MESSAGE_ID]:\"unknown\",u=l.body,h=l.url,g=ve.default.INCOMING_MESSAGE_ORIGIN.TROUTER,f=p(p({},l),{origin:g}),m=_e.extractCauseIdFromMessage(f);C.logger.info(\"[\".concat(m,\"][handleIncomingMsgSync][url=\").concat(h,\"][messageId=\").concat(d,\"]\"));var v=ve.default.HTTP_STATUS_CODES.OK,S=\"\",_={};if(_e.isDuplicateMessage(f.headers,C.incomingTrouterMessagesSeenSoFar)){C.logger.info(\"[\".concat(m,\"][handleIncomingMsgSync][failed][reason=duplicate]\"));var E=_e.getMessageResultFromCache(f.headers,C.incomingMessageSyncResponseCache);if(E)return C.logger.info(\"[\".concat(m,\"][handleIncomingMsgSync][cachedResponse]\")),E;C.telemetryHelper.recordEvent(fe.EVENTS.DUPLICATE_MESSAGE_IGNORED,{origin:g,messageId:d,causeId:m}),C.logger.info(\"[\".concat(m,\"][handleIncomingMsgSync][failed][reason=cachedResponseNotFound]\")),v=ve.default.HTTP_STATUS_CODES.BAD_REQUEST}else if(u){if(u.callAcceptance)try{var T=C.handleCallAcceptanceSync(f);S=(0,y.safeJsonStringify)(T)}catch(l){C.telemetryHelper.recordEvent(fe.EVENTS.FAILED_TO_HANDLE_MESSAGE,{messageId:d,origin:g,causeId:m,error:(0,y.getPrintableObject)(l)}),C.logger.info(\"[\".concat(m,\"][handleIncomingMsgSync][failed][reason=\").concat(l&&l.message,\"]\")),v=ve.default.HTTP_STATUS_CODES.BAD_REQUEST}}else C.logger.info(\"[\".concat(m,\"][handleIncomingMsgSync][failed][reason=received message with no body]\")),C.telemetryHelper.recordEvent(fe.EVENTS.MESSAGE_MISSING_BODY,{origin:g,messageId:d,causeId:m}),v=ve.default.HTTP_STATUS_CODES.BAD_REQUEST;f.headers&&(f.headers[ve.default.HEADERS.CORRELATION_ID]&&(_[ve.default.HEADERS.CORRELATION_ID]=f.headers[ve.default.HEADERS.CORRELATION_ID]),f.headers[ve.default.HEADERS.MESSAGE_ID]&&(_[ve.default.HEADERS.MESSAGE_ID]=f.headers[ve.default.HEADERS.MESSAGE_ID]));var b={resultCode:v,responseBody:S,responseHeaders:_};return _e.cacheMessageResult(f.headers,C.incomingMessageSyncResponseCache,b),C.logger.info(\"[\".concat(m,\"][handleIncomingMsgSync][success][resultCode=\").concat(v,\"]\")),b},this.acceptRenegotiationAsync=function(l,d,u){return void 0===u&&(u=_e.causeId()),_e.assertNotNull(l.blob,\"finalSdp should be a non null value\"),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight\"),C.logger.info(\"[\".concat(u,\"][acceptRenegotiationAsync][mediaTypes=\").concat(d,\"]\")),C.mediaRenegotiationManager.acceptRenegotiationAsync(l,d,u)},this.setProvisionalAnswerAsync=function(l,d){void 0===d&&(d=_e.causeId()),_e.assertNotNull(l.blob,\"sdp should be a non null value\"),C.telemetryHelper.recordEvent(fe.EVENTS.SET_PROVISIONAL_ANSWER,{causeId:d});var u=_e.defer();return C.fsmState!==ve.default.SIGNALING_FSM_STATE.INCOMING?(C.logger.info(\"[setProvisionalAnswerAsync][\".concat(d,\"] there is no incoming call to set provisional answer on.\")),u.reject(new Error(\"there is no incoming call to set provisional answer on.\")),u.promise):(C.http.sendPostRequest({url:C.links[ve.default.LINKS.MEDIA_ANSWER],requestName:fe.NETWORK_REQUESTS.SEND_MEDIA_ANSWER.name,payload:ge.getPayload(C,l),causeId:d}).then((function(l){C.disposed||C.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTING,d),u.resolve(null),C.disposed||(C.telemetryHelper.recordEvent(fe.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT,{causeId:d}),C.telemetryHelper.setTimeToRingDuration(),C.onCallStatusChanged(ve.default.CALL_STATUS.RINGING,d),C.signalingSessionCallback.onMediaAcknowledgementSuccess(!1,d))})).catch((function(l){var p=_e.getErrorForXHRFailure(l,C.signalingAgentConfig);C.logger.info(\"[setProvisionalAnswerAsync][\".concat(d,\"] error: \").concat((0,y.getPrintableObject)(p))),C.disposed?u.reject(C.getCallNotFoundTransactionEnd()):(C.telemetryHelper.recordEvent(fe.EVENTS.SET_PROVISIONAL_ANSWER_FAILED,{causeId:d}),u.reject(p.error))})),u.promise)},this.startRenegotiationAsync=function(l,d,u){return void 0===u&&(u=_e.causeId()),_e.assertNotNull(l,\"mediaContent should be a non null value\"),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight\"),C.logger.info(\"[\".concat(u,\"][startRenegotiationAsync]\")),C.mediaRenegotiationManager.startRenegotiationAsync(l,C.links[ve.default.LINKS.MEDIA_RENEGOTIATION],d,u)},this.acceptAsync=function(l,d,u,p){void 0===p&&(p=_e.causeId()),_e.assertNotNull(l,\"mediaContent should be a non null value\"),_e.assertNotNull(l.blob,\"outgoingSdp should be a non null value\"),C.logger.info(\"[\".concat(p,\"][acceptAsync][mediaTypes=\").concat(d,\"]\")),C.telemetryHelper.recordEvent(fe.EVENTS.ACCEPT_CALL,{causeId:p}),C.telemetryHelper.setAnsweredModalities(l.blob);var h=_e.defer();return C.fsmState!==ve.default.SIGNALING_FSM_STATE.INCOMING?(C.logger.warn(\"acceptAsync, there is no incoming call to accept\"),h.reject(new Error(\"there is no incoming call to accept\")),h.promise):(C.fsmState=ve.default.SIGNALING_FSM_STATE.WAITING_CALL_ACCEPTANCE_ACK,C.http.sendPostRequest({url:C.links[ve.default.LINKS.ACCEPT],requestName:fe.NETWORK_REQUESTS.SEND_ACCEPTANCE.name,payload:F.getPayload(C,l,d,u),causeId:p}).then((function(l){C.disposed||(C.currentCallStatus===ve.default.CALL_STATUS.IDLE&&(C.telemetryHelper.setTimeToRingDuration(),C.telemetryHelper.recordEvent(fe.EVENTS.ACCEPTED_BEFORE_RINGING,{causeId:p}),C.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTING,p)),l.response.callAcceptanceAcknowledgement&&(C.logger.info(\"acceptAsync, handling inlined callAcceptanceAcknowledgement\"),C.internalHandleCallAcceptanceAck(l.response,p))),h.resolve(null)})).catch((function(l){var d=_e.getErrorForXHRFailure(l,C.signalingAgentConfig);C.logger.info(\"[acceptAsync][\".concat(p,\"] error: \").concat((0,y.getPrintableObject)(d))),C.disposed?h.reject(C.getCallNotFoundTransactionEnd()):(C.fsmState=ve.default.SIGNALING_FSM_STATE.INCOMING,C.telemetryHelper.recordEvent(fe.EVENTS.ACCEPT_CALL_FAILED,{causeId:p,xhrError:d}),h.reject(d.error))})),h.promise)},this.rejectRenegotiationAsync=function(l,d){return void 0===d&&(d=_e.causeId()),_e.assert(C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED,\"Renegotation operations are only allowed when the call is connected and no disconnect operation is in flight\"),C.logger.info(\"[\".concat(d,\"][rejectRenegotiationAsync][rejectionData=\").concat(l,\"]\")),C.mediaRenegotiationManager.rejectRenegotiationAsync(l,d)},this.saveMediaControllerLinksIfAny=function(l){l.links&&(C.links[ve.default.LINKS.CONTROL_VIDEO_STREAMING]=l.links.controlVideoStreaming||C.links[ve.default.LINKS.CONTROL_VIDEO_STREAMING],C.links[ve.default.LINKS.APPLY_CHANNEL_PARAMETERS]=l.links.applyChannelParameters||C.links[ve.default.LINKS.APPLY_CHANNEL_PARAMETERS])},this.getInitialMediaOfferFromIncomingCallPayload=function(l){if(void 0===l&&(l=_e.causeId()),!C.signalingAgentConfig.handleMediaOfferFromPushNotification)return null;var d=C.incomingCallPayload&&C.incomingCallPayload.callNotification&&C.incomingCallPayload.callNotification.mediaContent?C.incomingCallPayload.callNotification.mediaContent:null;return C.telemetryHelper.setIsSdpInCallNotification(!!d),d},this.updateCorrelationId=function(l,d){if(void 0===d&&(d=_e.causeId()),C.logger.info(\"[\".concat(d,\"][updateCorrelationId][old=\").concat(C.correlationId,\"][new=\").concat(l,\"]\")),C.correlationId!==l&&!C.disposed){var u=C.correlationId;C.correlationId=l,C.telemetryHelper&&C.telemetryHelper.recordEvent&&C.telemetryHelper.recordEvent(fe.EVENTS.CORRELATION_ID_UPDATED,{newId:C.correlationId,oldId:u,causeId:d}),C.signalingSessionCallback&&C.signalingSessionCallback.onCorrelationIdUpdated&&C.signalingSessionCallback.onCorrelationIdUpdated(C.correlationId,d)}},this.endIncomingCallBecauseOfInvalidPayload=function(l){C.logger.info(\"[\".concat(l,\"][endIncomingCallBecauseOfInvalidPayload]\")),C.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE;var d={code:ve.default.CALL_END_CODE.BAD_REQUEST,subCode:ve.default.CALL_END_SUB_CODE.BAD_NOTIFICATION_PAYLOAD,phrase:ve.default.CALL_END_PHRASE.BAD_NOTIFICATION_PAYLOAD,resultCategories:[ve.RESULT_CATEGORIES.UnexpectedServerError]};C.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultValue:fe.default.RESULT_VALUE.FAILURE,endCode:d.code,endSubCode:d.subCode,resultDetail:d.phrase||\"EndIncomingCall\",resultCategories:d.resultCategories,causeId:l}),C.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,l,d),C.dispose(d,l)},this.isDuplicatedIncomingMessage=function(l){return l.origin===ve.default.INCOMING_MESSAGE_ORIGIN.BROKER&&_e.isDuplicateMessage(l.headers,C.incomingBrokerMessagesSeenSoFar)||l.origin===ve.default.INCOMING_MESSAGE_ORIGIN.TROUTER&&_e.isDuplicateMessage(l.headers,C.incomingTrouterMessagesSeenSoFar)},this.getEndpointState=function(){return C.currentCallStatus===ve.default.CALL_STATUS.CONNECTED?p({},C.latestEndpointState):p({},C.requestedEndpointStateWhileConnecting)},this.setMultiParty=function(l,d){var u=!!l;C.multiParty!==u&&(C.telemetryHelper.recordEvent(fe.EVENTS.SET_MULTIPARTY,{isMultiparty:u,causeId:d}),C.multiParty=u)},this.setupTrouterChannel=function(){C.logger.info(\"Broker config: outgoing=\".concat(C.signalingAgentConfig.brokerEnabledOutgoing?\"enabled\":\"disabled\")+\"incoming=\".concat(C.signalingAgentConfig.brokerEnabledIncoming?\"enabled\":\"disabled\")+\"batching=\".concat(C.signalingAgentConfig.brokerRequestBatching?\"enabled\":\"disabled\")+\"exclusive=\".concat(C.signalingAgentConfig.brokerExclusively?\"enabled\":\"disabled\"));var setTrouterUrl=function(l){l&&\"string\"==typeof l&&l.trim()&&(C.baseMessagingChannelUrl=C.previousTrouterUrl=C.currentTrouterUrl=l.trim(),C.telemetryHelper.addTrouterChannel())};C.brokerExclusiveEnabled()||(C.signalingAgentConfig.trouterServiceProvider?(C.signalingAgentConfig.trouterServiceProvider.state()===ye.TrouterState.Connected&&C.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync().then(setTrouterUrl),C.signalingAgentConfig.trouterServiceProvider.onStateChanged(C.onTrouterStateChanged)):(setTrouterUrl(C.signalingAgentConfig.trouterUrlGetter.trouterUrl()),C.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed(C.onTrouterUrlChanged)))},this.isTrouterDisconnected=function(){try{return C.signalingAgentConfig.trouterServiceProvider.state()===ye.TrouterState.Disconnected}catch(l){return!1}},this.forceTrouterConnectionCheck=function(){try{return void C.signalingAgentConfig.trouterServiceProvider.checkConnection(!1)}catch(l){return}},this.navigatorOnlineCallback=function(){C.disposed||(C.reportConnectivityStatus(),C.isTrouterDisconnected()&&C.signalingAgentConfig.forceTrouterReconnectOnNetworkOnline&&C.forceTrouterConnectionCheck())},this.navigatorOfflineCallback=function(){C.reportConnectivityStatus()},this.reportConnectivityStatus=function(){if(!C.disposed){var l=_e.isTrouterAndNavigatorConnected(C.signalingAgentConfig.trouterServiceProvider);C.logger.info(\"[Connectivity] status=\".concat(l)),C.telemetryHelper.recordEvent(fe.EVENTS.CONNECTIVITY_CHANGED,{status:l})}},this.onTrouterStateChanged=function(l,d){var u=_e.causeId();C.logger.info(\"[\".concat(u,\"][onTrouterStateChanged][state=\").concat(l,\"]\")),C.disposed?C.logger.info(\"onTrouterStateChanged ignored\"):(C.reportConnectivityStatus(),l===ye.TrouterState.Connected&&(C.telemetryHelper.addTrouterChannel(),C.updateLinksToTrouter(fe.EVENTS.TROUTER_STATE_CHANGED,u)))},this.setupConnectionCheck=function(){try{navigator&&navigator.onLine&&window&&window.addEventListener&&(window.addEventListener(\"online\",C.navigatorOnlineCallback),window.addEventListener(\"offline\",C.navigatorOfflineCallback))}catch(l){return}},this.tearDownConnectionCheck=function(){try{navigator&&navigator.onLine&&window&&window.removeEventListener&&(window.removeEventListener(\"online\",C.navigatorOnlineCallback),window.removeEventListener(\"offline\",C.navigatorOfflineCallback))}catch(l){return}},this.getTrouterUrlAsync=function(){return C.signalingAgentConfig.trouterServiceProvider?C.signalingAgentConfig.trouterServiceProvider.getTrouterUrlAsync():C.signalingAgentConfig.trouterUrlGetter.getTrouterUrlAsync()},this.brokerExclusiveEnabled=function(){return C.signalingAgentConfig.brokerEnabledOutgoing&&C.signalingAgentConfig.brokerEnabledIncoming&&C.signalingAgentConfig.brokerExclusively},this.isBrokerEnabledForOutgoingCall=function(){return C.signalingAgentConfig.brokerEnabledOutgoing},this.isBrokerEnabledForIncomingCall=function(){return C.signalingAgentConfig.brokerEnabledIncoming},this.isHandleUnmuteMuteFromResponseEnabled=function(){return C.signalingAgentConfig.handleUnmuteMuteFromResponse},this.isProcessSelfDataFromSubscribeResponseEnabled=function(){return C.signalingAgentConfig.processSelfDataFromSubscribeResponse},this.setupBrokerChannel=function(){C.brokerService||(C.logger.info(\"setupBrokerChannel, Enable broker\"),C.brokerService=new b.default(C),C.brokerService.onBrokerMessage((function(l){C.logger.info(\"setupBrokerChannel, message from broker\",l),C.handleIncomingMsgAsync(l,ve.default.INCOMING_MESSAGE_ORIGIN.BROKER).catch((function(l){C.telemetryHelper.recordEvent(fe.EVENTS.FAILED_TO_HANDLE_BROKER_MESSAGE),C.logger.info(\"setupBrokerChannel, Failed to handle message from broker\",l)}))})),C.baseMessagingChannelUrl||(C.telemetryHelper.addBrokerChannel(),C.baseMessagingChannelUrl=C.brokerService.baseUrl))},this.onTrouterUrlChanged=function(){var l=_e.causeId();C.logger.info(\"[\".concat(l,\"][onTrouterUrlChanged]\")),C.disposed?C.logger.info(\"onTrouterUrlChanged ignored\"):C.getTrouterUrlAsync().then((function(d){C.telemetryHelper.recordEvent(fe.EVENTS.TROUTER_URL_CHANGED,{url:d}),C.telemetryHelper.addTrouterChannel(),C.updateLinksToTrouter(fe.EVENTS.TROUTER_URL_CHANGED,l)})).catch((function(l){C.logger.info(\"Failed to update links to trouter: \".concat(l))}))},this.updateLinksToTrouter=function(l,d){C.logger.info(\"[\".concat(d,\"][updateLinksToTrouter][tag=\").concat(l,\"]\")),C.ensureLatestTrouterUrl(l).then((function(){var l;C.previousTrouterUrl!==C.currentTrouterUrl?(C.previousTrouterUrl=C.currentTrouterUrl,C.updateConversationLinks(),C.updateLwjLinks(d),C.updateKeepAliveUrl(),null===(l=C.contentSharingManager)||void 0===l||l.updateContentSharingNotificationLinksAsync(d),C.broadcastSession&&C.broadcastSession.updateBroadcastCallbackUrl(d)):C.logger.info(\"[\".concat(d,\"][updateLinksToTrouter]skip updating links, url did not change\"))})).catch((function(l){C.disposed||C.telemetryHelper.recordEvent(fe.EVENTS.TROUTER_URL_UPDATE_FAILED,{causeId:d}),C.logger.info(\"[\".concat(d,\"][updateLinksToTrouter][failed][reason=\").concat((0,y.getPrintableObject)(l),\"]\"))}))},this.updateLinks=function(l,d){C.ensureLatestTrouterUrl(fe.EVENTS.TROUTER_URL_CHANGED).then((function(){l(d)})).catch((function(l){C.disposed||C.telemetryHelper.recordEvent(fe.EVENTS.TROUTER_URL_UPDATE_FAILED,{causeId:d}),C.logger.warn(\"Failed to update links\")}))},this.startCallPreheatTimer=function(l){C.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT,(function(){C.handleCallEstablishmentTimeout(l,ve.default.CALL_END_SUB_CODE.PREHEATED_CALL_TIMEDOUT,\"Preheat timed out!\")}),ve.default.TIMEOUT_VALUES_IN_SECONDS.MAX_PREAHEATED_TIMEOUT)},this.stopCallPreheatTimer=function(){C.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.MAX_PREAHEATED_TIMEOUT)},this.updateKeepAliveUrl=function(){C.logger.info(\"updateKeepAliveUrl\"),C.links.hasOwnProperty(ve.default.LINKS.KEEPALIVE)?(C.linkUpdateRequested.keepAliveLinks=!1,C.logger.info(\"updateKeepAliveUrl, sending request\"),C.sendToKeepAliveUrl($.getPayload(C))):C.linkUpdateRequested.keepAliveLinks=!0},this.updateConversationLinks=function(l){void 0===l&&(l=_e.causeId()),C.logger.info(\"[\".concat(l,\"][updateConversationLinks]\")),C.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_CONVERSATION_LINKS,{causeId:l}),C.links.hasOwnProperty(ve.default.LINKS.NOTIFICATION_LINKS)?(C.linkUpdateRequested.conversationLinks=!1,C.logger.info(\"updateConversationLinks, sending request\"),C.sendToUpdateConversationLinks(!0)):C.linkUpdateRequested.conversationLinks=!0},this.updateLwjLinks=function(l){C.logger.info(\"[\".concat(l,\"][updateLwjLinks]\")),C.links.hasOwnProperty(ve.default.LINKS.LMC_NOTIFICATION_LINKS)&&(C.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_LWJ_LINKS,{causeId:l}),C.logger.info(\"[\".concat(l,\"][updateLwjLinks][start]\")),C.http.sendPostRequest({url:C.links[ve.default.LINKS.LMC_NOTIFICATION_LINKS],payload:le.getPayload(C),withoutTrouter:!0,requestName:fe.NETWORK_REQUESTS.UPDATE_LWJ_LINKS.name,causeId:l}).then((function(d){C.disposed||C.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_LWJ_LINKS_SUCCESS,{causeId:l})})).catch((function(d){var u=_e.getErrorForXHRFailure(d,C.signalingAgentConfig);C.logger.info(\"[\".concat(l,\"][updateLwjLinks] error : \").concat((0,y.getPrintableObject)(u))),C.disposed||C.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_LWJ_LINKS_FAILED,p({causeId:l},u.error))})))},this.sendAttachToCallInternal=function(l){var d;void 0===l&&(l=_e.causeId()),C.telemetryHelper.recordEvent(fe.EVENTS.SEND_ATTACH,{causeId:l}),C.logger.info(\"[\".concat(l,\"][sendAttachToCallInternal]\"));var u=C.signalingAgentConfig.sendProgressFromCC?((d={})[ve.default.HEADERS.CACHE_SKYPE_TOKEN]=\"1\",d):null;return C.http.sendPostRequest({url:C.incomingCallPayload.callNotification.links.attach,customHeaders:u,requestName:fe.NETWORK_REQUESTS.SEND_CALL_ATTACH.name,payload:k.getPayload(C,C.incomingCallPayload.conversationInvitation.conversationController,!C.getInitialMediaOfferFromIncomingCallPayload()),causeId:l}).then((function(d){if(!C.disposed){C.processAttachResponse(C.incomingCallPayload,d,l);var u=d.response.additionalActionResponses;u&&u.length>0&&(C.processConversationServiceResponse(u[0].output,l),u[0].output.roster&&(C.logger.info(\"[\".concat(l,\"][sendAttachToCallInternal] handling roster update from join response\")),C.internalHandleRosterUpdate(u[0].output.roster,!0,l))),C.onCallStatusChanged(ve.default.CALL_STATUS.RINGING,l),C.telemetryHelper.setTimeToRingDuration(),C.handleBrokerSubscription(d.response.callInvitation,l)}})).catch((function(d){var u=_e.getErrorForXHRFailure(d,C.signalingAgentConfig);C.logger.info(\"[\".concat(l,\"][sendAttachToCallInternal] error: \").concat((0,y.getPrintableObject)(d),\" xhrError: \").concat((0,y.getPrintableObject)(u))),C.disposed||(C.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,C.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultValue:fe.default.RESULT_VALUE.FAILURE,endCode:u.telemetryEndSubCode,endSubCode:u.error.subCode,resultCategories:u.error.resultCategories,resultDetail:u.error.phrase||C.getTerminatingCallResultDetail(\"attach\",u.error),causeId:l}),C.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,l,u.error),C.dispose(u.error,l))}))},this._processCallAcceptance=function(l,d){if(C.logger.info(\"[\".concat(d,\"][_processCallAcceptance]\")),C.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING){C.processCallAcceptance(l.body,d),C.telemetryHelper.setTimeToRingDuration();try{C.multiParty||C.callUsesMixer||C.participantManager.handleRosterUpdate(C.getFakeRoster(l.body),!0,d)}catch(p){var u={code:ve.default.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:ve.default.CALL_END_SUB_CODE.CALL_ACCEPTANCE_INVALID_SERVICE_RESPONSE,phrase:p&&p.toString()};throw C.logger.info(\"[\".concat(d,\"][_processCallAcceptance] \").concat((0,y.safeJsonStringify)(u))),C.telemetryHelper.recordRosterEvent(l,fe.EVENTS.HANDLE_ROSTER_UPDATE_FAIL,d),u}}},this.restartKeepAliveInterval=function(l,d){void 0===l&&(l=!1),C.disposed||(l&&C.telemetryHelper.recordEvent(fe.EVENTS.SEND_KEEP_ALIVE_FAILED,d),C.keepAliveTimer=window.setInterval(C.sendKeepAlive.bind(C),C.keepAliveInterval))},this.restartKeepAliveIntervalForLwj=function(l,d){void 0===l&&(l=!1),C.disposed||(l&&C.telemetryHelper.recordEvent(fe.EVENTS.SEND_KEEP_ALIVE_LWJ_FAILED,d),C.keepAliveTimerLwj=window.setInterval(C.sendKeepAliveForLwj.bind(C),C.keepAliveIntervalLwj))},this.isCallOngoing=function(){return C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED||C.fsmState===ve.default.SIGNALING_FSM_STATE.IDLE},this.isCallInProgress=function(){return C.fsmState===ve.default.SIGNALING_FSM_STATE.IDLE||C.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},this.isCallConnectedOrConnectedForRoster=function(){return C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED||C.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY},S&&(this.callStartTime=S),this.signalingSessionCallback=d,this.signalingAgentConfig=u,this.signalingAgent=g,this.urlIdentifier=h,this.piiUtils=new w.default(u.piiScrubber),this.isHostLessCall=u.doHostlessCalling||!1,this.logger=u.logger.createChild((function(){return\"CSA[\".concat(C.correlationId,\"][\").concat(C.fsmState,\"]\")}),this.correlationId,!0),this.updateCorrelationId(h),this.logger.info(\"[endpointId=\".concat((0,y.truncate)(this.signalingAgent.endpointId,8),\"]\")),this.logger.info(\"[participantId=\".concat(l.participantId,\"]\")),this.callOperationHandler=new I.default(this.logger.createChild((function(){return\"[CallOperationHandler][\".concat(l.participantId,\"]\")}))),this.http=new R.HttpStack(this,this.callStartTime),this.telemetryHelper=new me.default(this,l,this.callStartTime),this.mediaRenegotiationManager=new P.default(this,d,this.telemetryHelper),this.participantManager=new M.default(this,d,l),this.timeoutManager=new _.default(this.logger),this.contentSharingManager=new A.default(this,d),this.webRtcSignalingManager=new Ce.default(this,d),this.pstnContent={emergencyCallCountry:u.emergencyCallCountry||\"\",platformName:u.clientInformation,publicApiCall:!1},this.setupTrouterChannel(),this.setupConnectionCheck()}return SignalingSession.prototype.setCallMode=function(l,d){this.callMode!==l&&(this.logger.info(\"[\".concat(d,\"][setCallMode] oldMode=\").concat(this.callMode,\", newMode=\").concat(l)),this.callMode=l,this.signalingSessionCallback.onCallModeChanged(this.callMode,d))},SignalingSession.prototype.configureStreamingMode=function(l){var d;2!==this.callMode&&(this.logger.info(\"[\".concat(l,\"][configureStreamingMode]\")),this.setCallMode(2,l),this.cancelAllCallingHttpRequestsDueToStreaming(l),this.provisionalMediaAnswersSeenSoFar=[],null===(d=this.mediaRenegotiationManager)||void 0===d||d.dispose(),this.mediaRenegotiationManager=null,this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.keepAliveTimerLwj&&window.clearInterval(this.keepAliveTimerLwj),this.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTED,l))},SignalingSession.prototype.cancelAllCallingHttpRequestsDueToStreaming=function(l){var d,u,p={code:ve.default.CALL_END_CODE.SUCCESS,subCode:ve.default.CALL_END_SUB_CODE.DOWNGRADE_TO_STREAMING_CLIENT,phrase:ve.default.CALL_END_PHRASE.DOWNGRADE_TO_STREAMING_CLIENT},h=fe.NETWORK_REQUESTS;try{for(var g=f(Object.keys(h)),m=g.next();!m.done;m=g.next()){var v=m.value;h[v].controller!==fe.CONTROLLER.Call&&h[v].controller!==fe.CONTROLLER.LMC&&h[v].controller!==fe.CONTROLLER.ContentShare||this.http.cancelRequestIfPending(h[v].name,l,void 0,p)}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=g.return)&&u.call(g)}finally{if(d)throw d.error}}},SignalingSession.prototype.updateEndpointMetadata=function(l,d){var u=this;void 0===d&&(d=_e.causeId());var h={};try{h=JSON.parse(l)}catch(l){return Promise.reject(\"Invalid metadata\")}return this.http.sendPutRequest({url:this.links[ve.default.LINKS.UPDATE_ENDPOINT_METADATA],requestName:fe.NETWORK_REQUESTS.UPDATE_ENDPOINT_METADATA.name,payload:se.getPayload(this,h),causeId:d}).then((function(){u.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_ENDPOINT_METADATA_SUCCESS,{causeId:d})})).catch((function(l){var h=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);return u.logger.info(\"[\".concat(d,\"][updateEndpointMetadata] error: \").concat((0,y.getPrintableObject)(h))),u.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_ENDPOINT_METADATA_FAILURE,p({},h.error)),Promise.reject(h.error)}))},SignalingSession.prototype.isOneToOnePSTNCall=function(){return this.signalingSessionCallback.isOneToOnePstnCall()},SignalingSession.prototype.getLocationContent=function(){return this.isOneToOnePSTNCall()?_e.tryParse(this.locationInfoContent):null},SignalingSession.prototype.getNetworkContent=function(){return this.isOneToOnePSTNCall()?_e.tryParse(this.networkInfoContent):null},SignalingSession.prototype.getAreaContent=function(){return this.isOneToOnePSTNCall()?_e.tryParse(this.areaContent):null},SignalingSession.prototype.setLocationInfo=function(l,d,u){this.locationInfoContent=l,this.networkInfoContent=d,this.areaContent=u},SignalingSession.prototype.getEndpointCapabilities=function(l){var d;return this.signalingAgentConfig.enableDeltaRosterWeb?(d=0,this.signalingAgentConfig.brokerEnabledIncoming&&(d|=16),this.signalingAgentConfig.isGVCJoiningEnabled&&(d|=1),\"disabled\"!==this.signalingAgentConfig.cloudScreenSharingFlag&&(d|=2),this.signalingAgentConfig.supportsHostlessGroupCalls&&(d|=4),l||(d|=64),this.signalingAgentConfig.autoJoinOnConflict&&(d|=32),this.signalingAgentConfig.supportsCompressedServicePayload&&(d|=128),this.signalingAgentConfig.enablePstnMasking&&(d|=1024)):d={implicitCallback:this.signalingAgentConfig.brokerEnabledIncoming?\"enabled\":\"disabled\",cloudAudioVideoConference:this.signalingAgentConfig.isGVCJoiningEnabled?\"enabled\":\"disabled\",cloudScreenSharing:this.signalingAgentConfig.cloudScreenSharingFlag,hostlessConference:this.signalingAgentConfig.supportsHostlessGroupCalls?\"enabled\":\"disabled\",serverMuteUnmute:l?\"disabled\":\"enabled\",autoJoinOnConflict:this.signalingAgentConfig.autoJoinOnConflict?\"enabled\":\"disabled\",supportsCompressedServicePayload:this.signalingAgentConfig.supportsCompressedServicePayload?\"enabled\":\"disabled\",enablePstnMasking:this.signalingAgentConfig.enablePstnMasking?\"enabled\":\"disabled\"},d},SignalingSession.prototype.handleAdmitAllStatus=function(l){var d=l.body&&l.body.transactionResponse,u=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(u,\"][handleAdmitAllStatus][\").concat((0,y.getPrintableObject)(d),\"]\"));var p=d&&d.operationId;if(p&&this.callOperationHandler.hasPendingOperation(0,p,u)){this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.ADMIT,p);var h=d&&d.result&&d.result.code,g=d&&d.result&&d.result.subCode,f=d&&d.result&&d.result.resultCategories,m=d&&d.additionalDetail;if(0===h||h>=200&&h<300){var v={code:h,subCode:g,resultCategories:f,result:(0,y.safeJsonStringify)(m)};this.telemetryHelper.recordEvent(fe.EVENTS.ADMIT_SUCCESS,{causeId:p,transactionEnd:v}),this.callOperationHandler.resolvePendingOperation(0,p,v,u)}else{v={code:h||ve.default.CALL_END_CODE.BAD_REQUEST,subCode:g||0,resultCategories:f,result:d,phrase:ve.default.CALL_END_PHRASE.BAD_SERVICE_RESPONSE};this.telemetryHelper.recordEvent(fe.EVENTS.ADMIT_FAILURE,{causeId:p,transactionEnd:v}),this.callOperationHandler.rejectPendingOperation(0,p,\"AdmitAllStatus response contains failure\",v,u)}}else this.logger.warn(\"[\".concat(u,\"][handleAdmitAllStatus] invalid admitAllStatus response or no pending operation. operationId=\").concat(p))},SignalingSession.prototype.sendNetworkRequestForAdmit=function(l){var d=this,onceTrouterReady=function(){d.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.ADMIT,(function(){d.telemetryHelper.recordEvent(fe.EVENTS.ADMIT_TIMEOUT,{causeId:l}),d.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.ADMIT,l),d.callOperationHandler.rejectPendingOperation(0,l,\"timed out waiting for admit operation\",{code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.ADMIT_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.ADMIT_TIMEOUT},l)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.ADMIT_TIMEOUT,l)};this.http.sendPostRequest({url:this.links[ve.default.LINKS.ADMIT_ALL],requestName:fe.NETWORK_REQUESTS.ADMIT.name,payload:L.getPayload(this,l),causeId:l,onceTrouterReady:onceTrouterReady}).catch((function(u){var h=_e.getErrorForXHRFailure(u,d.signalingAgentConfig);d.telemetryHelper.recordEvent(fe.EVENTS.ADMIT_FAILURE,p({causeId:l},h.error)),d.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.ADMIT,l),d.callOperationHandler.rejectPendingOperation(0,l,u,h.error,l)}))},SignalingSession.prototype.getConversationType=function(l,d){return l?\"emergencyGroupCall\":d?\"cast\":null},SignalingSession.prototype.convertParkType=function(l){return\"teamPark\"===l?\"TransferTypeTeamPark\":\"sharedLinePark\"===l?\"TransferTypeSharedLinePark\":\"serverHold\"===l?\"TransferTypeServerHold\":(this.logger.info(\"convertParkType, parkType: \".concat(l,\" is unknown\")),\"none\")},SignalingSession.prototype.parkByTransfer=function(l,d){var u=this;this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){u.handleCallTransferTimeout(d)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT);var h=this.getNetworkRequestName(l);return this.http.sendPostRequest({url:this.links[ve.default.LINKS.TRANSFER],requestName:h,payload:Q.getPayload(l,this),causeId:d}).catch((function(l){var h=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);return u.logger.info(\"[\".concat(d,\"][parkByTransfer] error: \").concat((0,y.getPrintableObject)(h))),u.disposed?Promise.reject(u.getCallNotFoundTransactionEnd()):(u.signalingSessionCallback.onTransferCompleted({transferCompletion:{code:ve.default.CALL_END_CODE.NETWORK_ERROR,reason:(0,y.getPrintableObject)(l)}},d),u.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_REQUEST_FAILED,p({causeId:d},h.error)),Promise.reject(h.error))})),this.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_REQUEST_SENT,{causeId:d,transferType:this.convertParkType(l)}),Promise.resolve()},SignalingSession.prototype.park=function(l,d){var u=this;this.logger.info(\"[\".concat(d,\"][park] context \").concat(l)),this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.PARK_COMPLETION,(function(){u.handleParkError({code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.PARK_COMPLETION_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.PARK_COMPLETION_TIMEOUT},fe.EVENTS.WAITING_FOR_PARK_COMPLETION_TIMEOUT,d,l)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.PARK_COMPLETION_TIMEOUT);var p=this.getHoldTypeInRequest(l),h={causeId:d};return this.http.sendPostRequest({url:this.links[ve.default.LINKS.PARK],requestName:fe.NETWORK_REQUESTS.PARK_REQUEST.name,payload:Y.getPayload(this,p,h),causeId:d}).then((function(l){u.logger.info(\"[\".concat(d,\"][park] response: \").concat((0,y.getPrintableObject)(l))),u.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_PARK_COMPLETION,{causeId:d}),_e.assertNotNull(l.response.holdResponse.links,\"server response does not include park links\"),u.links[ve.default.LINKS.UNPARK]=l.response.holdResponse.links.resume})).catch((function(p){var h=_e.getErrorForXHRFailure(p,u.signalingAgentConfig);return u.logger.info(\"[\".concat(d,\"][park] error: \").concat((0,y.getPrintableObject)(h))),u.disposed?Promise.reject(u.getCallNotFoundTransactionEnd()):(u.handleParkError(h.error,fe.EVENTS.PARK_REQUEST_FAILED,d,l),Promise.reject(h.error))})),Promise.resolve()},SignalingSession.prototype.getHoldTypeInRequest=function(l){switch(l){case\"serverHoldV2\":return\"musicOnHold\";case\"sharedLineParkV2\":return\"sharedLineAppearance\";default:return null}},SignalingSession.prototype.handleParkError=function(l,d,u,h){this.disposed?this.logger.info(\"handleParkError ignored\"):(this.logger.info(\"[\".concat(u,\"] handleParkError reject reason: \").concat((0,y.getPrintableObject)(l))),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.PARK_COMPLETION),this.signalingSessionCallback.onParkCompleted&&(this.telemetryHelper.recordEvent(d,p(p({},l),{parkContext:h,causeId:u})),this.signalingSessionCallback.onParkCompleted(l,u)),this.links[ve.default.LINKS.UNPARK]=void 0)},SignalingSession.prototype.handleParkCompletion=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l),p=d.holdCompletion;this.handleOperationCompletionCommon(p,u,void 0,(0,y.getPrintableObject)(d),\"handleParkCompletion\",ve.default.TIMEOUT_OPERATIONS.PARK_COMPLETION,fe.EVENTS.PARK_COMPLETED,fe.EVENTS.PARK_FAILED,this.signalingSessionCallback.onParkCompleted,this.handleParkError.bind(this))},SignalingSession.prototype.handleUnparkError=function(l,d,u,h){this.disposed?this.logger.info(\"handleUnparkError ignored\"):(this.logger.info(\"[\".concat(u,\"] handleUnparkError reject reason: \").concat(l)),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.signalingSessionCallback.onUnparkCompleted&&(this.telemetryHelper.recordEvent(d,p(p({},l),{parkContext:h,causeId:u})),this.signalingSessionCallback.onUnparkCompleted(l,u)),this.links[ve.default.LINKS.UNPARK]=void 0)},SignalingSession.prototype.handleUnparkCompletion=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l);if(this.disposed)this.logger.info(\"[\".concat(u,\"]handleUnparkCompletion ignored\"));else{this.logger.info(\"[\".concat(u,\"][handleUnparkCompletion] body \").concat((0,y.getPrintableObject)(d)));var h=d.resumeCompletion;h.code===ve.default.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.UNPARK_COMPLETION),this.telemetryHelper.recordEvent(fe.EVENTS.UNPARK_COMPLETED,p(p({},h),{causeId:u})),this.signalingSessionCallback.onUnparkCompleted(h,u),this.links[ve.default.LINKS.UNPARK]=void 0):this.handleUnparkError(h,fe.EVENTS.UNPARK_FAILED,u)}},SignalingSession.prototype.getNetworkRequestName=function(l){return{none:null,teamPark:fe.NETWORK_REQUESTS.SEND_PARK_REQUEST.name,sharedLinePark:fe.NETWORK_REQUESTS.SEND_SHARED_LINE_PARK_REQUEST.name,serverHold:fe.NETWORK_REQUESTS.SEND_SERVER_HOLD_REQUEST.name}[l]},SignalingSession.prototype.updateMeetingsGroupsAsync=function(l,d){var u=this;this.logger.info(\"[\".concat(l,\"][updateMeetingsGroupsAsync] scope=\").concat(d.scope)),this.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_MEETING_GROUPS,{causeId:l,options:d}),this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION,(function(){u.handleUpdateMeetingGroupsError({code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT},fe.EVENTS.WAITING_FOR_UPDATE_MEETING_GROUPS_COMPLETION,l,l,d)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_MEETING_GROUPS_COMPLETION_TIMEOUT);var p=de.getMeetingGroupsPayload(this,d,l);return this.http.sendPostRequest({url:this.links[ve.default.LINKS.UPDATE_MEETING_GROUPS],requestName:fe.NETWORK_REQUESTS.UPDATE_MEETING_GROUPS.name,payload:p,causeId:l}).then((function(d){u.logger.info(\"[\".concat(l,\"][updateMeetingsGroupsAsync] response: \").concat((0,y.getPrintableObject)(d))),u.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_UPDATE_MEETING_GROUPS_COMPLETION,{causeId:l})})).catch((function(p){var h=_e.getErrorForXHRFailure(p,u.signalingAgentConfig);return u.logger.info(\"[\".concat(l,\"][updateMeetingsGroupsAsync] error: \").concat((0,y.getPrintableObject)(h))),u.disposed?Promise.reject(u.getCallNotFoundTransactionEnd()):(u.handleUpdateMeetingGroupsError(h.error,fe.EVENTS.UPDATE_MEETING_GROUPS_REQUEST_FAILED,l,l,d),Promise.reject(h.error))}))},SignalingSession.prototype.updateParticipantInterpretationStateAsync=function(l,d){return _e.assertNotNullOrEmpty(d,\"options should be a non null value\"),this.logger.info(\"[\".concat(l,\"][updateParticipantInterpretationStateAsync]\")),this.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE,{causeId:l,options:d}),this.participantManager.updateParticipantInterpretationStateAsync(d,this.links[ve.default.LINKS.UPDATE_PARTICIPANT_INTERPRETATION_STATE],l)},SignalingSession.prototype.joinMeetingGroupAsync=function(l,d){var u=this;this.logger.info(\"[\".concat(l,\"][joinMeetingGroupAsync]\")),this.telemetryHelper.recordEvent(fe.EVENTS.JOIN_MEETING_GROUP,{causeId:l,options:d}),this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION,(function(){u.handleJoinMeetingGroupError({code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.JOIN_MEETING_GROUP_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.JOIN_MEETING_GROUP_TIMEOUT},fe.EVENTS.WAITING_FOR_JOIN_MEETING_GROUP_COMPLETION,l,l,d)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.JOIN_MEETING_GROUP_COMPLETION_TIMEOUT);var p=q.getJoinMeetingGroupPayload(this,d,l);return this.http.sendPostRequest({url:this.links[ve.default.LINKS.JOIN_MEETING_GROUP],requestName:fe.NETWORK_REQUESTS.JOIN_MEETING_GROUP.name,payload:p,causeId:l}).then((function(d){u.logger.info(\"[\".concat(l,\"][joinMeetingGroupAsync] response: \").concat((0,y.getPrintableObject)(d))),u.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_JOIN_MEETING_GROUP_COMPLETION,{causeId:l})})).catch((function(p){var h=_e.getErrorForXHRFailure(p,u.signalingAgentConfig);return u.logger.info(\"[\".concat(l,\"][joinMeetingGroupAsync] error: \").concat((0,y.getPrintableObject)(h))),u.disposed?Promise.reject(u.getCallNotFoundTransactionEnd()):(u.handleJoinMeetingGroupError(h.error,fe.EVENTS.JOIN_MEETING_GROUP_REQUEST_FAILED,l,l,d),Promise.reject(h.error))}))},SignalingSession.prototype.leaveMeetingGroupAsync=function(l,d){var u=this;this.logger.info(\"[\".concat(l,\"][leaveMeetingGroupAsync]\")),this.telemetryHelper.recordEvent(fe.EVENTS.LEAVE_MEETING_GROUP,{causeId:l,options:d}),this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION,(function(){u.handleLeaveMeetingGroupError({code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.LEAVE_MEETING_GROUP_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.LEAVE_MEETING_GROUP_TIMEOUT},fe.EVENTS.WAITING_FOR_LEAVE_MEETING_GROUP_COMPLETION,l,l,d)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.LEAVE_MEETING_GROUP_COMPLETION_TIMEOUT);var p=K.getLeaveMeetingGroupPayload(this,d,l);return this.http.sendPostRequest({url:this.links[ve.default.LINKS.LEAVE_MEETING_GROUP],requestName:fe.NETWORK_REQUESTS.LEAVE_MEETING_GROUP.name,payload:p,causeId:l}).then((function(d){u.logger.info(\"[\".concat(l,\"][leaveMeetingGroupAsync] response: \").concat((0,y.getPrintableObject)(d))),u.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_LEAVE_MEETING_GROUP_COMPLETION,{causeId:l})})).catch((function(p){var h=_e.getErrorForXHRFailure(p,u.signalingAgentConfig);return u.logger.info(\"[\".concat(l,\"][leaveMeetingGroupAsync] error: \").concat((0,y.getPrintableObject)(h))),u.disposed?Promise.reject(u.getCallNotFoundTransactionEnd()):(u.handleLeaveMeetingGroupError(h.error,fe.EVENTS.LEAVE_MEETING_GROUP_REQUEST_FAILED,l,l,d),Promise.reject(h.error))}))},SignalingSession.prototype.handleUpdateMeetingGroupsError=function(l,d,u,h,g){this.disposed?this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingGroupsError] ignored. Call disposed, err: \").concat(JSON.stringify(l))):(this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingGroupsError] reject reason: \").concat(JSON.stringify(l))),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION),this.telemetryHelper.recordEvent(d,p(p({},l),{updateMeetingGroupsOptions:g,causeId:u})),this.signalingSessionCallback.onUpdateMeetingGroupsCompleted(l,u,h))},SignalingSession.prototype.handleUpdateMeetingGroupsCompletion=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l),h=d.updateMeetingGroupsResponse.operationId;if(this.disposed)this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingGroupsCompletion] ignored. Call disposed.\"));else{h||this.logger.warn(\"[\".concat(u,\"][handleUpdateMeetingGroupsCompletion] operationId is undefined.\")),this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingGroupsCompletion] starts\"));var g=d.updateMeetingGroupsResponse,f=(0,C.processTransactionResponse)(g);f.code===ve.default.TRANSACTION_END_CODE.SUCCESS?(this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingGroupsCompletion] update meeting group succeeded\")),this.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_MEETING_GROUPS_RESPONSE_SUCCESS,p(p({},f),{causeId:u}))):(this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingGroupsCompletion] update meeting group failed code=\").concat(f.code,\" subCode=\").concat(f.subCode)),this.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_MEETING_GROUPS_RESPONSE_FAILURE,p(p({},f),{causeId:u}))),this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingGroupsCompletion] completes\")),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_GROUPS_COMPLETION),this.signalingSessionCallback.onUpdateMeetingGroupsCompleted(f,u,h)}},SignalingSession.prototype.handleJoinMeetingGroupError=function(l,d,u,h,g){this.disposed?this.logger.info(\"[\".concat(u,\"][handleJoinedMeetingGroupError] ignored. Call disposed, err: \").concat(JSON.stringify(l))):(this.logger.info(\"[\".concat(u,\"][handleJoinedMeetingGroupError] reject reason: \").concat(JSON.stringify(l))),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION),this.telemetryHelper.recordEvent(d,p(p({},l),{joinMeetingGroupOptions:g,causeId:u})),this.signalingSessionCallback.onJoinMeetingGroupCompleted(l,u,h))},SignalingSession.prototype.handleJoinMeetingGroupCompletion=function(l){var d=l.body.joinMeetingGroupResponse,u=_e.extractCauseIdFromMessage(l),h=d.operationId;if(this.disposed)this.logger.info(\"[\".concat(u,\"][handleJoinMeetingGroupCompletion] ignored. Call disposed.\"));else{h||this.logger.warn(\"[\".concat(u,\"][handleJoinMeetingGroupCompletion] operationId is undefined.\")),this.logger.info(\"[\".concat(u,\"][handleJoinMeetingGroupCompletion] starts\"));var g=(0,C.processTransactionResponse)(d);g.code===ve.default.TRANSACTION_END_CODE.SUCCESS?(this.logger.info(\"[\".concat(u,\"][handleJoinMeetingGroupCompletion] join meeting group succeeded\")),this.telemetryHelper.recordEvent(fe.EVENTS.JOIN_MEETING_GROUP_RESPONSE_COMPLETED,p(p({},g),{causeId:u}))):(this.logger.info(\"[\".concat(u,\"][handleJoinMeetingGroupCompletion] join meeting group failed code=\").concat(g.code,\" subCode=\").concat(g.subCode)),this.telemetryHelper.recordEvent(fe.EVENTS.JOIN_MEETING_GROUP_RESPONSE_FAILED,p(p({},g),{causeId:u}))),this.logger.info(\"[\".concat(u,\"][handleJoinMeetingGroupCompletion] complete\")),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.JOIN_MEETING_GROUP_COMPLETION),this.signalingSessionCallback.onJoinMeetingGroupCompleted(g,u,h)}},SignalingSession.prototype.handleLeaveMeetingGroupError=function(l,d,u,h,g){this.disposed?this.logger.info(\"[\".concat(u,\"][handleLeaveMeetingGroupError] ignored. Call disposed, err: \").concat(JSON.stringify(l))):(this.logger.info(\"[\".concat(u,\"][handleLeaveMeetingGroupError] reject reason: \").concat(JSON.stringify(l))),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION),this.telemetryHelper.recordEvent(d,p(p({},l),{leaveMeetingGroupOptions:g,causeId:u})),this.signalingSessionCallback.onLeaveMeetingGroupCompleted(l,u,h))},SignalingSession.prototype.handleLeaveMeetingGroupCompletion=function(l){var d=l.body.leaveMeetingGroupResponse,u=_e.extractCauseIdFromMessage(l),h=d.operationId;if(this.disposed)this.logger.info(\"[\".concat(u,\"][handleLeaveMeetingGroupCompletion] ignored. Call disposed.\"));else{h||this.logger.warn(\"[\".concat(u,\"][handleLeaveMeetingGroupCompletion] operationId is undefined.\")),this.logger.info(\"[\".concat(u,\"][handleLeaveMeetingGroupCompletion] starts\"));var g=(0,C.processTransactionResponse)(d);g.code===ve.default.TRANSACTION_END_CODE.SUCCESS?(this.logger.info(\"[\".concat(u,\"][handleLeaveMeetingGroupCompletion] leave meeting group succeeded\")),this.telemetryHelper.recordEvent(fe.EVENTS.LEAVE_MEETING_GROUP_RESPONSE_COMPLETED,p(p({},g),{causeId:u}))):(this.logger.info(\"[\".concat(u,\"][handleLeaveMeetingGroupCompletion] leave meeting group failed code=\").concat(g.code,\" subCode=\").concat(g.subCode)),this.telemetryHelper.recordEvent(fe.EVENTS.LEAVE_MEETING_GROUP_RESPONSE_FAILED,p(p({},g),{causeId:u}))),this.logger.info(\"[\".concat(u,\"][handleLeaveMeetingGroupCompletion] complete\")),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.LEAVE_MEETING_GROUP_COMPLETION),this.signalingSessionCallback.onLeaveMeetingGroupCompleted(g,u,h)}},SignalingSession.prototype.publishStateAsync=function(l,d,u,p,h,g){var f=this;this.logger.info(\"[\".concat(u,\"][publishStateAsync][publishType=\").concat(l,\" publishLevel=\").concat(d,\"]\")),this.telemetryHelper.recordEvent(fe.EVENTS.PUBLISH_STATE,{causeId:u,publishType:l,publishLevel:d});var m=this.links[ve.default.LINKS.PUBLISH_STATE];if(!m){var v={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.PUBLISH_STATE_LINK_MISSING,phrase:\"publish state link is missing\"};return this.logger.warn(v),Promise.reject(v)}var S={};try{S=JSON.parse(p)}catch(l){v={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_CONTENT,phrase:\"publish state content is invalid\"};return this.logger.warn(v),Promise.reject(v)}return this.http.sendPostRequest({url:m,requestName:fe.NETWORK_REQUESTS.PUBLISH_STATE.name,payload:X.getPayload(this,l,d,S,++this.publishStateSequenceNumber,h,g),causeId:u,requestId:u}).then((function(l){var d;if(null===(d=null==l?void 0:l.response)||void 0===d?void 0:d.publishStateResponse)return f.parsePublishStateResult(l,u);var p=\"Invalid CS response which does not contains publishStateResponse. Respone: \".concat((null==l?void 0:l.response)?JSON.stringify(l.response):\"no response\");throw f.logger.warn(p),{response:{code:ve.default.CALL_END_CODE.DECODING_FAILED,subCode:ve.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:p}}})).catch((function(l){var d=_e.getErrorForXHRFailure(l,f.signalingAgentConfig);f.logger.info(\"[\".concat(u,\"][publishStateAsync] error: \").concat((0,y.getPrintableObject)(d)));var p=d.error;return f.telemetryHelper.recordEvent(fe.EVENTS.PUBLISH_STATE_FAILURE,{causeId:u,transactionEnd:p}),Promise.reject(p)}))},SignalingSession.prototype.parsePublishStateResult=function(l,d){var u={};if(l&&l.response&&l.response.publishStateResponse){if(l.response.publishStateResponse.stateId)return l.response.publishStateResponse.stateId;if(l.response.publishStateResponse.results){if(1===l.response.publishStateResponse.results.length){if(l.response.publishStateResponse.results[0].stateId)return l.response.publishStateResponse.results[0].stateId;this.logger.warn(\"invalid response format\")}return l.response.publishStateResponse.results.forEach((function(l){u[l.participantId]={code:l.result.code,phrase:l.result.phrase,subCode:l.result.subCode}})),JSON.stringify(u)}if(l.response.publishStateResponse.result)return u={code:l.response.publishStateResponse.result.code,phrase:l.response.publishStateResponse.result.phrase,subCode:l.response.publishStateResponse.result.subCode,result:l.response.publishStateResponse.additionalDetail},JSON.stringify(u)}var p=l&&l.response?JSON.stringify(l.response):\"no response\",h=\"Invalid CS response which does not contains publishStateResponse. Respone: \".concat(p);throw this.logger.warn(h),{response:{code:ve.default.CALL_END_CODE.DECODING_FAILED,subCode:ve.default.CALL_END_SUB_CODE.PUBLISH_STATE_INVALID_SERVICE_RESPONSE,phrase:h}}},SignalingSession.prototype.removeStateAsync=function(l,d,u,p){var h=this;if(this.logger.info(\"[\".concat(l,\"][removeStateAsync][scope=\").concat(d,\" publishType=\").concat(u,\" stateIds=\").concat(p,\"]\")),this.telemetryHelper.recordEvent(fe.EVENTS.REMOVE_STATE,{causeId:l,scope:d,publishType:u,stateIds:p}),!u&&!p){var g={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.REMOVE_STATE_MISSING_ARGUMENTS,phrase:\"remove state operation miss arguments\"};return this.logger.warn(g),Promise.reject(g)}var f=this.links[ve.default.LINKS.REMOVE_STATE];if(!f){g={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.REMOVE_STATE_LINK_MISSING,phrase:\"remove state link is missing\"};return this.logger.warn(g),Promise.reject(g)}return this.http.sendPostRequest({url:f,requestName:fe.NETWORK_REQUESTS.REMOVE_STATE.name,payload:ee.getPayload(this,++this.publishStateSequenceNumber,d,p,u),causeId:l,requestId:l}).then((function(d){return h.parseRemoveStateResult(d,l)})).catch((function(d){var u=_e.getErrorForXHRFailure(d,h.signalingAgentConfig);h.logger.info(\"[\".concat(l,\"][removeStateAsync] error: \").concat((0,y.getPrintableObject)(u)));var p=u.error;return h.telemetryHelper.recordEvent(fe.EVENTS.REMOVE_STATE_FAILURE,{causeId:l,transactionEnd:p}),Promise.reject(p)}))},SignalingSession.prototype.parseRemoveStateResult=function(l,d){var u={};return l&&l.response&&l.response.removeStateResponse&&(l.response.removeStateResponse.results?l.response.removeStateResponse.results.forEach((function(l){u[l.stateId]={code:l.result.code,phrase:l.result.phrase,subCode:l.result.subCode}})):l.response.removeStateResponse.result&&(u={code:l.response.removeStateResponse.result.code,phrase:l.response.removeStateResponse.result.phrase,subCode:l.response.removeStateResponse.result.subCode,result:l.response.removeStateResponse.additionalDetail})),JSON.stringify(u)},SignalingSession.prototype.updateMeetingSettingsAsync=function(l,d){var u=this;this.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_MEETING_SETTINGS,{causeId:d,meetingSettings:l});var p=this.links[ve.default.LINKS.UPDATE_MEETING_SETTINGS];if(!p){var h={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_LINK_MISSING,phrase:\"update meeting settings link is missing\"};return this.logger.warn(h),Promise.reject(h)}if(!Object.keys(l).length){h={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.UPDATE_MEETING_SETTINGS_MISSING_ARGUMENTS,phrase:\"update meeting settings missing arguments\"};return this.logger.warn(h),Promise.reject(h)}return this.http.sendPutRequest({url:p,requestName:fe.NETWORK_REQUESTS.UPDATE_MEETING_SETTINGS.name,payload:pe.getPayload(this,++this.publishStateSequenceNumber,l),causeId:d,requestId:d}).then((function(){m.noop()})).catch((function(l){var p=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[\".concat(d,\"][updateMeetingSettingsAsync] error: \").concat((0,y.getPrintableObject)(p)));var h=p.error;throw u.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_MEETING_SETTINGS_FAILURE,{causeId:d,transactionEnd:h}),h}))},SignalingSession.prototype.searchParticipantsAsync=function(l,d){var u=this;this.logger.info(\"[\".concat(d,\"][searchParticipantsAsync][queryOptions=\").concat(l,\"]\")),this.telemetryHelper.recordEvent(fe.EVENTS.SEARCH_PARTICIPANTS,{causeId:d,queryOptions:l});var p=this.links[ve.default.LINKS.SEARCH_PARTICIPANTS];if(!p){var h={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_LINK_MISSING,phrase:\"search participants link is missing\"};return this.logger.warn(h),Promise.reject(h)}return this.http.sendPostRequest({url:p,requestName:fe.NETWORK_REQUESTS.SEARCH_PARTICIPANTS.name,payload:te.getPayload(this,l),causeId:d,requestId:d}).then((function(l){if(l&&l.response&&l.response.participants)return u.parseSearchParticipantsResult(l,d);var p=l&&l.response?JSON.stringify(l.response):\"no response\",h=\"Invalid CS response which does not contain proper search results. Respone: \".concat(p);throw u.logger.warn(h),{response:{code:ve.default.CALL_END_CODE.DECODING_FAILED,subCode:ve.default.CALL_END_SUB_CODE.SEARCH_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:h}}})).catch((function(l){var p=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[\".concat(d,\"][searchParticipantsAsync] error: \").concat((0,y.getPrintableObject)(p)));var h=p.error;return u.telemetryHelper.recordEvent(fe.EVENTS.SEARCH_PARTICIPANTS_FAILURE,{causeId:d,transactionEnd:h}),Promise.reject(h)}))},SignalingSession.prototype.parseSearchParticipantsResult=function(l,d){var u,p,h=[];if(l&&l.response){var g=l.response.participants;if(g)try{for(var m=f(Object.keys(g)),v=m.next();!v.done;v=m.next()){var y=v.value;h.push(O.default.fromRosterSearchResults(l.response.participants[y]))}}catch(l){u={error:l}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(u)throw u.error}}}return{participants:h}},SignalingSession.prototype.getAllParticipantsAsync=function(l,d){var u=this;this.logger.info(\"[\".concat(d,\"][getAllParticipantsAsync][scope=\").concat(l,\"]\")),this.telemetryHelper.recordEvent(fe.EVENTS.GET_ALL_PARTICIPANTS,{causeId:d,scope:l});var p=this.links[ve.default.LINKS.GET_ALL_PARTICIPANTS];if(!p){var h={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_LINK_MISSING,phrase:\"get all participants link is missing\"};return this.logger.warn(h),Promise.reject(h)}if(\"lobby\"!==l){h={code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SCOPE,phrase:\"get all participants scope is invalid\"};return this.logger.warn(h),Promise.reject(h)}return this.http.sendPostRequest({url:p,requestName:fe.NETWORK_REQUESTS.GET_ALL_PARTICIPANTS.name,payload:G.getPayload(this,l),causeId:d,requestId:d}).then((function(l){if(l&&l.response)return{participants:l.response.particiapnts};var d=\"Invalid CS response which does not contain results.\";throw u.logger.warn(d),{response:{code:ve.default.CALL_END_CODE.DECODING_FAILED,subCode:ve.default.CALL_END_SUB_CODE.GET_ALL_PARTICIPANTS_INVALID_SERVICE_RESPONSE,phrase:d}}})).catch((function(l){var p=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[\".concat(d,\"][getAllParticipantsAsync] error: \").concat((0,y.getPrintableObject)(p)));var h=p.error;return u.telemetryHelper.recordEvent(fe.EVENTS.GET_ALL_PARTICIPANTS_FAILURE,{causeId:d,transactionEnd:h}),Promise.reject(h)}))},SignalingSession.prototype.setClientRejectReason=function(l,d){l.clientReasonSubCode=d.clientReasonSubCode,l.clientReasonPhrase=d.clientReasonPhrase},SignalingSession.prototype.resetState=function(){this.currentCallStatus=null,this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE},SignalingSession.prototype.saveUpdatedCallLinksIfAny=function(l){l.links&&(this.logger.info(\"saveUpdatedCallLinksIfAny, updated call links found, update to new links \".concat((0,y.getPrintableObject)(l))),this.links[ve.default.LINKS.MEDIA_RENEGOTIATION]=l.links.mediaRenegotiation||this.links[ve.default.LINKS.MEDIA_RENEGOTIATION],this.links[ve.default.LINKS.TRANSFER]=l.links.transfer||this.links[ve.default.LINKS.TRANSFER],this.links[ve.default.LINKS.REPLACE]=l.links.replacement||this.links[ve.default.LINKS.REPLACE],this.links[ve.default.LINKS.HANGUP]=l.links.callLeg||this.links[ve.default.LINKS.HANGUP],this.links[ve.default.LINKS.KEEPALIVE]=l.links.callLeg||this.links[ve.default.LINKS.KEEPALIVE],this.links[ve.default.LINKS.PARK]=l.links.hold||this.links[ve.default.LINKS.PARK])},SignalingSession.prototype.ensureMessageChannelReady=function(l){return this.disposed?(this.logger.info(\"ensureMessageChannelReady: error: call already disposed\"),Promise.reject(this.getCallNotFoundTransactionEnd())):this.brokerService?(this.telemetryHelper.addTrouterWaitOperation(\"\".concat(fe.default.TROUTER_WAIT_OPERATION.STARTED,\":\").concat(l)),this.telemetryHelper.addTrouterWaitOperation(\"\".concat(fe.default.TROUTER_WAIT_OPERATION.ENDED,\":\").concat(l)),Promise.resolve()):this.ensureLatestTrouterUrl(l)},SignalingSession.prototype.ensureLatestTrouterUrl=function(l){var d=this;return this.telemetryHelper.addTrouterWaitOperation(\"\".concat(fe.default.TROUTER_WAIT_OPERATION.STARTED,\":\").concat(l)),this.getTrouterUrlAsync().then((function(u){return!u||\"string\"==typeof u&&!u.trim()?(d.telemetryHelper.recordEvent(fe.EVENTS.TROUTER_URL_CHANGED_TO_INVALID),d.telemetryHelper.addTrouterWaitOperation(\"\".concat(fe.default.TROUTER_WAIT_OPERATION.ENDED,\":\").concat(l)),Promise.reject(new Error(\"Invalid trouter url\"))):d.disposed?(d.logger.info(\"ensureLatestTrouterUrl, trouterUrlGetter returned too late. Object is already disposed\"),Promise.reject(d.getCallNotFoundTransactionEnd())):(d.telemetryHelper.addTrouterWaitOperation(\"\".concat(fe.default.TROUTER_WAIT_OPERATION.ENDED,\":\").concat(l)),d.baseMessagingChannelUrl=d.currentTrouterUrl=u,Promise.resolve())})).catch((function(u){return d.disposed||d.telemetryHelper.addTrouterWaitOperation(\"\".concat(fe.default.TROUTER_WAIT_OPERATION.FAILED,\":\").concat(l)),d.logger.info(\"ensureLatestTrouterUrl, failed because:\".concat(u)),Promise.reject(u)}))},SignalingSession.prototype.signalTransferAcceptedAsync=function(l,d){var u=this;return void 0===d&&(d=_e.causeId()),this.logger.info(\"[signalTransferAcceptedAsync][\".concat(d,\"] transferType \").concat(l)),this.disposed?(this.logger.info(\"[signalTransferAcceptedAsync][\".concat(d,\"] Call already ended, skip acceptance request\")),Promise.reject({code:ve.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(this.telemetryHelper.recordEvent(fe.EVENTS.SEND_ACCEPT_TRANSFER,{causeId:d,transferType:l}),this.http.sendPostRequest({url:this.links[ve.default.LINKS.TRANSFER_ACCEPTANCE],requestName:fe.NETWORK_REQUESTS.TRANSFER_ACCEPTANCE.name,payload:ie.getPayload(),causeId:d}).catch((function(l){var p=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);return u.logger.info(\"[signalTransferAcceptedAsync][\".concat(d,\"] error: \").concat((0,y.getPrintableObject)(p))),u.telemetryHelper.recordEvent(fe.EVENTS.SEND_ACCEPT_TRANSFER_FAIL,{causeId:d}),Promise.reject(p.error)})))},SignalingSession.prototype.signalTransferCompletedAsync=function(l,d){var u=this;return void 0===d&&(d=_e.causeId()),this.logger.info(\"[signalTransferCompletedAsync][\".concat(d,\"] rejectReason \").concat(l)),this.disposed?(this.logger.info(\"[signalTransferCompletedAsync][\".concat(d,\"]  Call already ended by transferor, skip completion request\")),Promise.reject({code:ve.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,reason:null})):(0!==l.code?this.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_COMPLETION_FAILED,{code:l.code,subcode:l.subCode,causeId:d}):this.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_COMPLETED,{causeId:d}),this.telemetryHelper.recordEvent(fe.EVENTS.SEND_COMPLETE_TRANSFER,{causeId:d}),this.http.sendPostRequest({url:this.links[ve.default.LINKS.TRANSFER_COMPLETION],requestName:fe.NETWORK_REQUESTS.TRANSFER_COMPLETION.name,payload:oe.getPayload(l),causeId:d}).catch((function(l){u.telemetryHelper.recordEvent(fe.EVENTS.SEND_COMPLETE_TRANSFER_FAILED,{causeId:d});var p=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);return u.logger.info(\"[signalTransferCompletedAsync][\".concat(d,\"] error: \").concat((0,y.getPrintableObject)(p))),Promise.reject(p.error)})))},SignalingSession.prototype.endWithBeacon=function(l){if(navigator&&navigator.sendBeacon&&!this.disposed){var d={code:ve.default.CALL_END_CODE.SUCCESS,subCode:ve.default.CALL_END_SUB_CODE.BEACON,phrase:ve.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};this.telemetryHelper.recordEvent(fe.EVENTS.END_WITH_BEACON,{causeId:l});var u=JSON.stringify(z.getPayload(this,d).payload),p=-1===this.links[ve.default.LINKS.LEAVE].indexOf(\"?\")?\"?\":\"&\",h=\"skypeToken=\".concat(this.signalingAgent.authTokenManager.getLastToken(l));return navigator.sendBeacon(\"\".concat(this.links[ve.default.LINKS.LEAVE]).concat(p).concat(h),u)}return!1},SignalingSession.prototype.setFsmState=function(l){this.fsmState=l},SignalingSession.prototype.setIsHostless=function(l,d){var u=!!l;this.isHostLessCall!==u&&(this.logger.info(\"[\".concat(d,\"][setIsHostless] isHostless=\").concat(u)),this.isHostLessCall=u)},SignalingSession.prototype.hasGroupModality=function(){return this.threadId||this.groupId},SignalingSession.prototype.processConversationServiceResponseHeaders=function(l,d){this.logger.info(\"[\".concat(d,\"][processConversationServiceResponseHeaders]\"));try{var u=l.request.getResponseHeader(ve.default.HEADERS.CORRELATION_ID);this.updateCorrelationId(u,d)}catch(l){this.logger.info(\"[\".concat(d,\"][processConversationServiceResponseHeaders] failed, reason=\").concat((0,y.getPrintableObject)(l)))}},SignalingSession.prototype.processConversationServiceResponse=function(l,d){this.logger.info(\"[\".concat(d,\"][processConversationServiceResponse]\")),this.convJoined=!0;var u=l.sequenceNumber>=0?l.sequenceNumber:-1;if(u<this.updateSequenceNumber)this.logger.info(\"[\".concat(d,\"][processConversationServiceResponse] seqNum=\").concat(u,\" is less than latest seqNum=\").concat(this.updateSequenceNumber));else{if(this.updateSequenceNumber=u,this.links[ve.default.LINKS.CONVERSATION_CONTROLLER]=l.conversationController,this.links[ve.default.LINKS.ADD_PARTICIPANT]=l.links.addParticipant,this.links[ve.default.LINKS.ADD_PARTICIPANTS_AND_MODALITY]=l.links.addParticipantAndModality,this.links[ve.default.LINKS.LEAVE]=l.links.leave,this.links[ve.default.LINKS.NOTIFICATION_LINKS]=l.links.notificationLinks,this.links[ve.default.LINKS.REMOVE_PARTICIPANT]=l.links.removeParticipant,this.links[ve.default.LINKS.ADD_MODALITY]=l.links.addModality,this.links[ve.default.LINKS.REMOVE_MODALITY]=l.links.removeModality,this.links[ve.default.LINKS.MUTE]=l.links.mute||null,this.links[ve.default.LINKS.UNMUTE]=l.links.unmute||null,this.links[ve.default.LINKS.ADMIT]=l.links.admit||null,this.links[ve.default.LINKS.ADMIT_ALL]=l.links.admitAll||null,this.links[ve.default.LINKS.UPDATE_ENDPOINT_STATE]=l.links.updateEndpointState||null,this.links[ve.default.LINKS.UPDATE_ENDPOINT_METADATA]=l.links.updateEndpointMetadata||null,this.links[ve.default.LINKS.UPDATE_PARTICIPANT_ROLE]=l.links.updateParticipantRole||null,this.links[ve.default.LINKS.PUBLISH_STATE]=l.links.publishState||null,this.links[ve.default.LINKS.REMOVE_STATE]=l.links.removeState||null,this.links[ve.default.LINKS.UPDATE_MEETING_SETTINGS]=l.links.updateMeetingSettings||null,this.links[ve.default.LINKS.SEARCH_PARTICIPANTS]=l.links.searchParticipants||null,this.links[ve.default.LINKS.GET_ALL_PARTICIPANTS]=l.links.getAllParticipants||null,this.links[ve.default.LINKS.UPDATE_MEETING_LIVE_STATE]=l.links.updateMeetingLiveState||null,this.links[ve.default.LINKS.UPDATE_MEETING_GROUPS]=l.links.updateMeetingGroups||null,this.links[ve.default.LINKS.SET_MEETING_LAYOUT]=l.links.setMeetingLayout||null,this.links[ve.default.LINKS.UPDATE_PARTICIPANT_INTERPRETATION_STATE]=l.links.updateParticipantInterpretationState||null,this.links[ve.default.LINKS.JOIN_MEETING_GROUP]=l.links.joinMeetingGroup||null,this.links[ve.default.LINKS.LEAVE_MEETING_GROUP]=l.links.leaveMeetingGroup||null,this.convSubject=l.subject,l.state&&(this.setMultiParty(l.state.isMultiParty,d),this.setIsHostless(l.state.isHostless||!1,d),this.conversationType=l.state.conversationType,this.isCastCall=!!l.state.conversationType&&\"cast\"===l.state.conversationType),l.activeModalities&&l.activeModalities.groupChat&&this.updateGroupChatIds(l.activeModalities.groupChat,d),l.activeModalities&&l.activeModalities.broadcast&&(this.broadcastSession||(this.broadcastSession=new T.default(this,this.signalingSessionCallback)),this.broadcastSession.handleBroadcastDetailsChanged(l,d)),this.handleMeetingDetailsChanged(l,d),this.handleBrokerSubscription(l,d),this.linkUpdateRequested.conversationLinks?(this.logger.info(\"[\".concat(d,\"][processConversationServiceResponse] Updating CS links as requested\")),this.updateLinks(this.updateConversationLinks,d)):this.scheduleConversationKeepAlive(),this.isProcessSelfDataFromSubscribeResponseEnabled()&&l.subscriptionDetails&&l.subscriptionDetails.selfParticipant){var p=O.default.fromRoster(l.subscriptionDetails.selfParticipant,!0);this.logger.info(\"[\".concat(d,\"][processConversationServiceResponse] converted selfParticipant to Participant type\")),this.participantManager.updateLocalParticipantFromSubscribe(p,d)}l.meetingData&&(this.meetingData=l.meetingData),l.meetingInfo&&(this.meetingInfo=l.meetingInfo),l.region&&(this.region=l.region),l.callLimits&&(this.callLimits=l.callLimits),this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,groupId:this.groupId,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo,callLimits:this.callLimits},d)}},SignalingSession.prototype.processLocalParticipantUpdateResponse=function(l,d){this.logger.info(\"[\".concat(d,\"][processLocalParticipantUpdateResponse]\")),l.sequenceNumber&&l.sequenceNumber<this.localParticipantUpdateSequenceNumber||(this.breakoutDetails=l.breakoutDetails||{},this.signalingSessionCallback.onBreakoutDetailsUpdated(this.breakoutDetails,d))},SignalingSession.prototype.handlePendingEndpointState=function(l){var d=this;this.requestedEndpointStateWhileConnecting&&(this.logger.info(\"[\".concat(l,\"][handlePendingEndpointState]sending pending endpoint state now that we are connected.\")),this.updateEndpointState(this.requestedEndpointStateWhileConnecting,l).catch((function(l){d.isPreheatOnly&&(d.logger.info(\"handlePendingEndpointState failed\"),d.disablePreheatDefer.reject(l))})))},SignalingSession.prototype.handleMeetingDetailsChanged=function(l,d){this.logger.info(\"[\".concat(d,\"][handleMeetingDetailsChanged]\")),l.meetingDetails&&!m.isEqual(l.meetingDetails,this.meetingDetails)&&this.signalingSessionCallback.onMeetingDetailsUpdated&&(this.meetingDetails=l.meetingDetails,this.meetingDetails.meetingCapability&&this.meetingDetails.meetingCapability.meetingLiveState&&(this.meetingLiveStateSequenceNumber=this.meetingDetails.meetingCapability.meetingLiveState.seqNum,this.logger.info(\"[\".concat(d,\"][handleMeetingDetailsChanged] update meeting seqNum as \").concat(this.meetingLiveStateSequenceNumber))),this.signalingSessionCallback.onMeetingDetailsUpdated(this.meetingDetails,d))},SignalingSession.prototype.handleBrokerSubscription=function(l,d){this.logger.info(\"[\".concat(d,\"][handleBrokerSubscription]\")),l.links.subscribe?(this.telemetryHelper.recordEvent(fe.EVENTS.SUBSCRIBE_URL_FOUND,d),this.brokerService?this.brokerService.subscribeToBroker(l.links.subscribe):this.telemetryHelper.recordEvent(fe.EVENTS.BROKER_DISABLED_SUBSCRIBE_URL_PRESENT)):this.telemetryHelper.recordEvent(fe.EVENTS.SUBSCRIBE_URL_MISSING,d)},SignalingSession.prototype.cancelOutgoingCall=function(l,d){var u=this,p=_e.defer();this.logger.info(\"[\".concat(d,\"][cancelOutgoingCall][rejectionData=\").concat(l&&(0,y.getPrintableObject)(l),\"]\"));var h=l&&(l.code||l.subCode)?l:{code:ve.default.CALL_END_CODE.CANCEL,subCode:ve.default.CALL_END_SUB_CODE.SUCCESS,phrase:ve.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};if(l&&this.setClientRejectReason(h,l),h.resultCategories=h.resultCategories||[ve.RESULT_CATEGORIES.Success],this.links.hasOwnProperty(ve.default.LINKS.LEAVE)){this.logger.info(\"[\".concat(d,\"][cancelOutgoingCall] cancelling outgoing call\")),this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE;var g={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()},f={terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultDetail:h.phrase||\"CancelOutgoingCall\",endCode:h.code,endSubCode:h.subCode,causeId:d,clientReasonSubCode:h.clientReasonSubCode,clientReasonPhrase:h.clientReasonPhrase,resultCategories:h.resultCategories};this.http.sendPostRequest({url:this.links[ve.default.LINKS.LEAVE],requestName:fe.NETWORK_REQUESTS.CANCEL_CALL.name,payload:B.getPayload(this,h,g),causeId:d}).then((function(l){u.disposed||(u.telemetryHelper.setTerminatingData(f),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,h),u.dispose(h,d)),p.resolve(null)})).catch((function(l){var g=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[cancelOutgoingCall][\".concat(d,\"] error: \").concat((0,y.getPrintableObject)(l),\" xhrError: \").concat((0,y.getPrintableObject)(g))),u.disposed||(u.telemetryHelper.setTerminatingData(f),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,h),u.dispose(h,d)),p.resolve(null)}))}else this.logger.info(\"[\".concat(d,\"][cancelOutgoingCall] Conversation Service Leave Url is not yet set. Cannot leave conversation. Disposing anyways.\")),h.subCode=ve.default.CALL_END_SUB_CODE.CONV_URL_NOT_SET,this.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultDetail:h.phrase||\"CancelOutgoingCall\",endCode:h.code,endSubCode:h.subCode,causeId:d,clientReasonSubCode:h.clientReasonSubCode,clientReasonPhrase:h.clientReasonPhrase,resultCategories:h.resultCategories}),this.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,h),this.dispose(h,d),p.resolve(null);return p.promise},SignalingSession.prototype.terminateEstablishedCall=function(l,d){var u=this,p=d.causeId||_e.causeId();this.logger.info(\"[\".concat(p,\"][terminateEstablishedCall]\"));var h=_e.defer();this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE;var g=this.convJoined?fe.NETWORK_REQUESTS.LEAVE_CONVERSATION.name:fe.NETWORK_REQUESTS.END_CALL.name,f=Se.build(),m=l&&(l.code||l.subCode)?l:{code:ve.default.CALL_END_CODE.SUCCESS,subCode:ve.default.CALL_END_SUB_CODE.SUCCESS,phrase:ve.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};l&&this.setClientRejectReason(m,l),m.resultCategories=m.resultCategories||[ve.RESULT_CATEGORIES.Success];var v={terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,endCode:m.code,endSubCode:m.subCode,resultDetail:m.phrase||\"TerminateEstablishedCall\",causeId:p,clientReasonSubCode:m.clientReasonSubCode,clientReasonPhrase:m.clientReasonPhrase,resultCategories:m.resultCategories};return this.leaveConversation(m,d).then((function(){u.logger.info(\"[\".concat(p,\"][terminateEstablishedCall]success\")),u.disposed||(u.telemetryHelper.setTerminatingData(v),u.telemetryHelper.addNetworkOperationCompleted(g,!0,f.duration()),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,p,m),u.dispose(m,p)),h.resolve(null)})).catch((function(l){var d=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[\".concat(p,\"][terminateEstablishedCall][failed] error: \").concat((0,y.getPrintableObject)(l),\" xhrError: \").concat((0,y.getPrintableObject)(d),\"]\")),u.disposed||(u.telemetryHelper.setTerminatingData(v),u.telemetryHelper.addNetworkOperationCompleted(g,!1,f.duration()),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,p,m),u.dispose(m,p)),h.resolve(null)})),h.promise},SignalingSession.prototype.deleteConversation=function(l,d){var u=this;this.logger.info(\"[\".concat(d,\"][deleteConversation]\"));var p=_e.defer();this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE;var h=fe.NETWORK_REQUESTS.DELETE_CONVERSATION.name,g=Se.build(),f=l&&(l.code||l.subCode)?l:{code:ve.default.CALL_END_CODE.SUCCESS,subCode:ve.default.CALL_END_SUB_CODE.SUCCESS,phrase:ve.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED,causeId:d};l&&this.setClientRejectReason(f,l),f.resultCategories=f.resultCategories||[ve.RESULT_CATEGORIES.Success];var m={terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,endCode:f.code,endSubCode:f.subCode,resultDetail:f.phrase,causeId:d,clientReasonSubCode:f.clientReasonSubCode,clientReasonPhrase:f.clientReasonPhrase,resultCategories:f.resultCategories};return this.deleteConversationController(f,d).then((function(){u.logger.info(\"[\".concat(d,\"][deleteConversation]success\")),u.disposed||(u.telemetryHelper.setTerminatingData(m),u.telemetryHelper.addNetworkOperationCompleted(h,!0,g.duration()),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,f),u.dispose(f,d)),p.resolve(null)})).catch((function(l){var v=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[\".concat(d,\"][deleteConversation][failed] error: \").concat((0,y.getPrintableObject)(l),\" xhrError: \").concat((0,y.getPrintableObject)(v))),u.disposed||(u.telemetryHelper.setTerminatingData(m),u.telemetryHelper.addNetworkOperationCompleted(h,!1,g.duration()),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,f),u.dispose(f,d)),p.resolve(null)})),p.promise},SignalingSession.prototype.leaveConversation=function(l,d){var u=d.causeId||_e.causeId();if(this.convJoined){this.logger.info(\"[\".concat(u,\"][leaveConversation]\"));var p={cancelationDuration:this.telemetryHelper.getCallCancelationDuration()};return this.http.sendPostRequest({url:this.links[ve.default.LINKS.LEAVE],requestName:fe.NETWORK_REQUESTS.LEAVE_CONVERSATION.name,payload:z.getPayload(this,l,p,d.scope),withoutTrouter:!0,causeId:u})}return this.logger.info(\"[\".concat(u,\"][leaveConversation] ignore, not joined to conversation\")),Promise.resolve(void 0)},SignalingSession.prototype.deleteConversationController=function(l,d){return this.convJoined?(this.logger.info(\"[\".concat(d,\"][deleteConversationController]\")),this.http.sendDeleteRequest({url:this.links[ve.default.LINKS.CONVERSATION_CONTROLLER],requestName:fe.NETWORK_REQUESTS.DELETE_CONVERSATION.name,payload:H.getPayload(this,l),withoutTrouter:!0,causeId:d})):(this.logger.info(\"[\".concat(d,\"][deleteConversationController]ignored, not joined to conversation\")),Promise.resolve(void 0))},SignalingSession.prototype.rejectIncomingCall=function(l,d){var u=this;this.telemetryHelper.recordEvent(fe.EVENTS.REJECT_INCOMING_CALL,d),this.logger.info(\"[\".concat(d,\"][rejectIncomingCall]\"));var p=_e.defer();this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE;var h=l&&(l.code||l.subCode)?l:{code:ve.default.CALL_END_CODE.REJECT,subCode:ve.default.CALL_END_SUB_CODE.SUCCESS,phrase:ve.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};l&&this.setClientRejectReason(h,l),h.resultCategories=h.resultCategories||[ve.RESULT_CATEGORIES.Success];var g={terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,endCode:h.code,endSubCode:h.subCode,resultDetail:h.phrase||\"RejectCall\",causeId:d,clientReasonSubCode:h.clientReasonSubCode,clientReasonPhrase:h.clientReasonPhrase,resultCategories:h.resultCategories};return this.http.sendDeleteRequest({url:this.links[ve.default.LINKS.REJECT],requestName:fe.NETWORK_REQUESTS.REJECT_CALL.name,payload:Z.getPayload(this,h),causeId:d}).then((function(l){u.disposed||(u.telemetryHelper.setTerminatingData(g),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,h),u.dispose(h,d)),p.resolve(null)})).catch((function(l){var f=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[rejectIncomingCall][\".concat(d,\"] error: \").concat((0,y.getPrintableObject)(l),\" xhrError: \").concat((0,y.getPrintableObject)(f))),u.disposed||(u.telemetryHelper.setTerminatingData(g),u.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,d,h),u.dispose(h,d)),p.resolve(null)})),p.promise},SignalingSession.prototype.onCallStatusChanged=function(l,d,u){var p=\"[\".concat(d,\"][onCallStatusChanged]\");if(this.logger.info(\"\".concat(p).concat(this.currentCallStatus,\"=>\").concat(l,\"]\")),this.disposed)this.logger.info(\"\".concat(p,\"Call is already disposed!!\"));else if(u&&this.logger.info(\"\".concat(p,\"[statusCode=\").concat((0,y.getPrintableObject)(u),\"]\")),this.isValidStateTransitions(l)){this.currentCallStatus=l;var h={callStatus:l,statusCode:u,causeId:d};this.isPreheatOnly&&(h.isPreheatOnly=!0),this.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_CALL_STATUS,h),this.signalingSessionCallback.onCallStatusChanged(l,u,d),this.currentCallStatus===ve.default.CALL_STATUS.CONNECTED&&(this.handlePendingEndpointState(d),this.telemetryHelper.resetCallCancelationDurationWatch(),this.isPreheatOnly&&this.startCallPreheatTimer(d))}},SignalingSession.prototype.updateMeetingLiveStateAsync=function(l,d){var u=this;this.logger.info(\"[\".concat(l,\"][updateMeetingLiveStateAsync][options=\").concat(JSON.stringify(d),\"]\")),this.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_MEETING_LIVE_STATE,{causeId:l,meetingLiveStateOptions:d}),this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION,(function(){u.handleUpdateMeetingLiveStateError({code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT},fe.EVENTS.WAITING_FOR_UPDATE_MEETING_LIVE_STATE_COMPLETION,l,l,d)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_MEETING_LIVE_STATE_COMPLETION_TIMEOUT);var h=ue.getPayload(this,p(p({},d),{seqNum:this.meetingLiveStateSequenceNumber}),l);return this.http.sendPostRequest({url:this.links[ve.default.LINKS.UPDATE_MEETING_LIVE_STATE],requestName:fe.NETWORK_REQUESTS.UPDATE_MEETING_LIVE_STATE.name,payload:h,causeId:l}).then((function(d){u.logger.info(\"[\".concat(l,\"][updateMeetingLiveStateAsync] response: \").concat((0,y.getPrintableObject)(d))),u.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_UPDATE_MEETING_LIVE_STATE_COMPLETION,{causeId:l})})).catch((function(p){var h=_e.getErrorForXHRFailure(p,u.signalingAgentConfig);return u.logger.info(\"[\".concat(l,\"][updateMeetingLiveStateAsync] error: \").concat((0,y.getPrintableObject)(h))),u.disposed?Promise.reject(u.getCallNotFoundTransactionEnd()):(u.handleUpdateMeetingLiveStateError(h.error,fe.EVENTS.UPDATE_MEETING_LIVE_STATE_REQUEST_FAILED,l,l,d),Promise.reject(h.error))}))},SignalingSession.prototype.handleUpdateMeetingLiveStateError=function(l,d,u,h,g){this.disposed?this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingLiveStateError] ignored. Call disposed, err: \").concat(JSON.stringify(l))):(this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingLiveStateError] reject reason: \").concat(l)),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION),this.telemetryHelper.recordEvent(d,p(p({},l),{updateMeetingGroupsOptions:g,causeId:u})),this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted&&this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted(l,u,h))},SignalingSession.prototype.handleUpdateMeetingLiveStateCompletion=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l),p=d.updateMeetingLiveStateResponse.result,h=d.updateMeetingLiveStateResponse.operationId;h||this.logger.warn(\"[\".concat(u,\"][handleUpdateMeetingLiveStateCompletion] operationId is undefined.\")),this.logger.info(\"[\".concat(u,\"][handleUpdateMeetingLiveStateCompletion] meetingLiveUpdate completes with operationId=\").concat(h)),this.handleOperationCompletionCommon(p,u,h,(0,y.getPrintableObject)(d),\"handleUpdateMeetingLiveStateCompletion\",ve.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_LIVE_STATE_COMPLETION,fe.EVENTS.UPDATE_MEETING_LIVE_STATE_RESPONSE_SUCCESS,fe.EVENTS.UPDATE_MEETING_LIVE_STATE_RESPONSE_FAILURE,this.signalingSessionCallback.onUpdateMeetingLiveStateCompleted,this.handleUpdateMeetingLiveStateError.bind(this))},SignalingSession.prototype.setMeetingLayoutAsync=function(l,d){var u=this;this.logger.info(\"[\".concat(l,\"][setMeetingLayoutAsync][options=\").concat(JSON.stringify(d),\"]\")),this.telemetryHelper.recordEvent(fe.EVENTS.SET_MEETING_LAYOUT,{causeId:l,setMeetingLayoutOptions:d}),this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION,(function(){u.handleSetMeetingLayoutError({code:ve.default.CALL_END_CODE.TIMEOUT,subCode:ve.default.CALL_END_SUB_CODE.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT,phrase:ve.default.CALL_END_PHRASE.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT},fe.EVENTS.WAITING_FOR_SET_MEETING_LAYOUT_COMPLETION,l,l,d)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.SET_MEETING_LAYOUT_COMPLETION_TIMEOUT);var h=ne.getPayload(this,p(p({},d),{sequenceNumber:this.meetingLayoutSequenceNumber}));return this.http.sendPostRequest({url:this.links[ve.default.LINKS.SET_MEETING_LAYOUT],requestName:fe.NETWORK_REQUESTS.SET_MEETING_LAYOUT.name,payload:h,causeId:l}).then((function(d){u.logger.info(\"[\".concat(l,\"][setMeetingLayoutAsync] response: \").concat((0,y.getPrintableObject)(d))),u.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_SET_MEETING_LAYOUT_COMPLETION,{causeId:l})})).catch((function(p){var h=_e.getErrorForXHRFailure(p);return u.logger.info(\"[\".concat(l,\"][setMeetingLayoutAsync] error: \").concat((0,y.getPrintableObject)(h))),u.disposed?Promise.reject(u.getCallNotFoundTransactionEnd()):(u.handleSetMeetingLayoutError(h.error,fe.EVENTS.SET_MEETING_LAYOUT_REQUEST_FAILED,l,l,d),Promise.reject(h.error))}))},SignalingSession.prototype.handleSetMeetingLayoutError=function(l,d,u,h,g){this.disposed?this.logger.info(\"[\".concat(u,\"][handleSetMeetingLayoutError] ignored. Call disposed, err: \").concat(JSON.stringify(l))):(this.logger.info(\"[\".concat(u,\"][handleSetMeetingLayoutError] reject reason: \").concat(l)),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION),this.telemetryHelper.recordEvent(d,p(p({},l),{updateMeetingGroupsOptions:g,causeId:u})),this.signalingSessionCallback.onSetMeetingLayoutCompleted&&this.signalingSessionCallback.onSetMeetingLayoutCompleted(l,u,h))},SignalingSession.prototype.handleSetMeetingLayoutCompletion=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l),p=d.setMeetingLayoutResponse.result,h=d.setMeetingLayoutResponse.operationId;h||this.logger.warn(\"[\".concat(u,\"][handleSetMeetingLayoutCompletion] operationId is undefined.\")),this.handleOperationCompletionCommon(p,u,h,(0,y.getPrintableObject)(d),\"handleSetMeetingLayoutCompletion\",ve.default.TIMEOUT_OPERATIONS.SET_MEETING_LAYOUT_COMPLETION,fe.EVENTS.SET_MEETING_LAYOUT_RESPONSE_SUCCESS,fe.EVENTS.SET_MEETING_LAYOUT_RESPONSE_FAILURE,this.signalingSessionCallback.onSetMeetingLayoutCompleted,this.handleSetMeetingLayoutError.bind(this))},SignalingSession.prototype.handleOperationCompletionCommon=function(l,d,u,h,g,f,m,v,y,S){this.disposed?this.logger.info(\"[\".concat(d,\"][\").concat(g,\"] ignored. Call disposed.\")):(this.logger.info(\"[\".concat(d,\"][\").concat(g,\"] body \").concat(h)),l.code===ve.default.TRANSACTION_END_CODE.SUCCESS?(this.timeoutManager.stopTimer(f),this.telemetryHelper.recordEvent(m,p(p({},l),{causeId:d})),y&&y(l,d,u)):S&&S(l,v,d,u))},SignalingSession.prototype.isValidStateTransitions=function(l){if(this.currentCallStatus===ve.default.CALL_STATUS.LOCAL_TERMINATED&&l===ve.default.CALL_STATUS.CONNECTING)return!0;var orderOfCallState=function(l){switch(l){case ve.default.CALL_STATUS.IDLE:case ve.default.CALL_STATUS.CONNECTED_FOR_ROSTER_ONLY:return 0;case ve.default.CALL_STATUS.CONNECTING:return 1;case ve.default.CALL_STATUS.RINGING:return 2;case ve.default.CALL_STATUS.CONNECTED:return 3;case ve.default.CALL_STATUS.LOCAL_TERMINATED:case ve.default.CALL_STATUS.REMOTE_TERMINATED:return 4;default:return-1}};return orderOfCallState(l)>orderOfCallState(this.currentCallStatus)},SignalingSession.prototype.handlePSTNBalanceUpdate=function(l){var d=l.body.balanceUpdate,u=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(u,\"][handlePSTNBalanceUpdate]\")),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,l),d.updateBalance?this.signalingSessionCallback.onPSTNBalanceUpdate(d):this.logger.info(fe.EVENTS.HANDLE_PSTN_BALANCE_UPDATE,\"this was a pstn keepAlive message - ignore\")},SignalingSession.prototype.handleCallAcceptanceAck=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(u,\"][handleCallAcceptanceAck]\")),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_CALL_ACCEPTANCE_ACK,l),this.internalHandleCallAcceptanceAck(d,u)},SignalingSession.prototype.internalHandleCallAcceptanceAck=function(l,d){var u;this.logger.info(\"[\".concat(d,\"][internalHandleCallAcceptanceAck] \").concat((0,y.getPrintableObject)(l))),this.fsmState!==ve.default.SIGNALING_FSM_STATE.CONNECTED&&(this.links[ve.default.LINKS.MEDIA_RENEGOTIATION]=l.callAcceptanceAcknowledgement.links.mediaRenegotiation,this.links[ve.default.LINKS.TRANSFER]=l.callAcceptanceAcknowledgement.links.transfer,this.links[ve.default.LINKS.REPLACE]=l.callAcceptanceAcknowledgement.links.replacement,this.links[ve.default.LINKS.HANGUP]=l.callAcceptanceAcknowledgement.links.callLeg,this.links[ve.default.LINKS.KEEPALIVE]=l.callAcceptanceAcknowledgement.links.callLeg,this.links[ve.default.LINKS.PARK]=l.callAcceptanceAcknowledgement.links.hold,this.saveMediaControllerLinksIfAny(l.callAcceptanceAcknowledgement),this.scheduleKeepAlives(l.callAcceptanceAcknowledgement.callKeepAliveInterval),this.signalingSessionCallback.updateIsSharedLineAppearanceV2Activated(null===(u=l.callAcceptanceAcknowledgement.callProperties)||void 0===u?void 0:u.isSharedLineAppearanceV2Activated),this.fsmState=ve.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.INCOMING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(d),this.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTED,d),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info(\"[\".concat(d,\"][internalHandleCallAcceptanceAck] updating CC links as requested\")),this.updateLinks(this.updateKeepAliveUrl,d)))},SignalingSession.prototype.isFatalException=function(l){var d=!0;try{JSON.parse(l.message).code===ve.default.CALL_END_CODE.CONFLICT&&(d=!1,this.logger.info(\"isFatalException: received non-fatal 409 error\"))}catch(l){this.logger.error(\"isFatalException: failed to parse error\")}return d},SignalingSession.prototype.startOrJoinCall=function(l,d,u,p,h){var g=this;if(this.logger.info(\"[\".concat(u,\"]startOrJoinCall[\").concat(d,\"]\")),this.disposed)this.logger.info(\"[\".concat(u,\"][\").concat(d,\"] session already disposed, ignore\"));else{this.setMultiParty(1!==this.participantManager.getParticipantsToInitiateCallWith().length,u);var f=this.getConversationUrl()?this.getConversationUrl():l.conversationServiceUrl;this.telemetryHelper.setConversationServiceUrl(f),this.logger.info(\"options.conversationServiceUrl \".concat(l.conversationServiceUrl,\" conversationServiceUrl \").concat(f)),l.enableLightWeightMeeting||this.telemetryHelper.setOfferedModalities(p.blob),l.isPreheatOnly?(this.isPreheatOnly=!0,this.telemetryHelper.recordEvent(fe.EVENTS.PREHEAT_ENABLING,{causeId:u}),this.telemetryHelper.setSelfParticipantRole(fe.default.ROLE.PREHEAT),this.telemetryHelper.setIsPreheated()):this.telemetryHelper.startCallCancelationDurationWatch(),this.mediaTypesToUse=h,this.lastUsedOutgoingMediaContent=p,this.telemetryHelper.setCallerType(this.participantManager.localParticipant.id),this.logger.info(\"[\".concat(u,\"][\").concat(d,\"]target endpointType = \").concat(this.transferContext&&this.transferContext.target?this.transferContext.target.endpointType:\"default\"));var m=l.newCall?V.getPayload(this,p,h,l):W.getPayload(this,p,h,l,u);this.signalingAgentConfig.enableCallEstablishmentTimeoutsForStartJoinCall&&this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){g.handleCallEstablishmentTimeout(u)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT),this.http.sendPostRequest({url:f,requestName:d,operationType:\"CallSetup\",payload:m,causeId:u}).then((function(d){g.disposed||(l.endpointState&&(g.latestEndpointState=l.endpointState),g.processConversationServiceResponseHeaders(d,u),g.processConversationServiceResponse(d.response,u),g.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTING,u),g.signalingAgentConfig.handleRosterFromCreateAndJoin&&d.response&&d.response.roster&&g.internalHandleRosterUpdate(d.response.roster,!0,u))})).catch((function(l){if(!l.stack||g.isFatalException(l)){var p=_e.getErrorForXHRFailure(l,g.signalingAgentConfig);g.logger.info(\"[startOrJoinCall][\".concat(u,\"][\").concat(d,\"] error: \").concat((0,y.getPrintableObject)(l),\" xhrError: \").concat((0,y.getPrintableObject)(p))),g.disposed||(g.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,g.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultValue:fe.default.RESULT_VALUE.FAILURE,endCode:p.telemetryEndSubCode,endSubCode:p.error.subCode,resultCategories:p.error.resultCategories,resultDetail:p.error.phrase||g.getTerminatingCallResultDetail(d,p.error),causeId:u}),g.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,u,p.error),g.dispose(p.error,u))}}))}},SignalingSession.prototype.processIncomingCallPayload=function(l,d){this.remoteUser=O.default.fromWireParticipant(l.callNotification.from),this.participantManager.setLocalParticipantId(l.callNotification.to.participantId,d),l?(l.conversationInvitation&&(this.links[ve.default.LINKS.CONVERSATION_CONTROLLER]=l.conversationInvitation.conversationController,this.setMultiParty(l.conversationInvitation.isMultiParty,d),this.setIsHostless(!!l.conversationInvitation.isHostless,d)),l.callNotification&&(this.links[ve.default.LINKS.ATTACH]=l.callNotification.links&&l.callNotification.links.attach,this.links[ve.default.LINKS.REDIRECT]=l.callNotification.links&&l.callNotification.links.redirection,this.onBehalfOf=l.callNotification.onBehalfOf&&l.callNotification.onBehalfOf.id,this.callType=l.callNotification.callType,this.incomingCallCallerId=l.callNotification.from&&l.callNotification.from.id,this.callUsesMixer=!(!l.callNotification.mediaContent||!l.callNotification.mediaContent.fromMixer),this.isRedirectAllowed=!(!l.callNotification.redirectionProperties||!l.callNotification.redirectionProperties.isRedirectAllowed)),l.debugContent&&this.updateCorrelationId(l.debugContent.callId,d),l.callNotification.transferor&&(this.transferor=l.callNotification.transferor.details?l.callNotification.transferor.details.id:null),l.groupChat&&this.updateGroupChatIds(l.groupChat,d),l.meetingData&&(this.meetingData=l.meetingData),l.meetingInfo&&(this.meetingInfo=l.meetingInfo)):this.logger.info(\"[\".concat(d,\"][processIncomingCallPayload] empty incoming payload content\"))},SignalingSession.prototype.processAttachResponse=function(l,d,u){this.telemetryHelper.recordEvent(fe.EVENTS.PROCESS_INITIAL_OFFER,{causeId:u}),this.links[ve.default.LINKS.MEDIA_ANSWER]=d.response.callInvitation.links.mediaAnswer,this.links[ve.default.LINKS.ACCEPT]=d.response.callInvitation.links.acceptance,this.links[ve.default.LINKS.REJECT]=d.response.callInvitation.links.callLeg,this.links[ve.default.LINKS.REDIRECT]=d.response.callInvitation.links.redirection,this.links[ve.default.LINKS.NEW_OFFER]=d.response.callInvitation.links.newOffer,this.signalingAgentConfig.sendProgressFromCC||this.sendProgress(d),this.remoteCaller=d.response.participants.from;var p=this.getInitialMediaOfferFromIncomingCallPayload()||d.response.callInvitation.mediaContent;this.telemetryHelper.setCallerType(this.getParticipantIdForOfferAnswer(p));var h=_e.getMediaTypes(d.response.callInvitation.callModalities);this.telemetryHelper.addIncomingModalities(h),this.telemetryHelper.setOfferedModalities(p.blob,!0),this.callUsesMixer=p.fromMixer,this.isRedirectAllowed=!(!d.response.callInvitation.redirectionProperties||!d.response.callInvitation.redirectionProperties.isRedirectAllowed),this.signalingSessionCallback.onOffer({subject:l.conversationInvitation.subject,remoteParticipantId:this.getParticipantIdForOfferAnswer(p),remoteEndpointId:d.response.participants.from.endpointId,transferor:d.response.callInvitation.transferor,clientTransferContext:l.callNotification.transferContext,mediaTypes:h,mediaContent:p,renegotiation:!1,invitationData:d.response.callInvitation.invitationData,riskLevel:d.response.callInvitation.spamProperties&&d.response.callInvitation.spamProperties.riskLevel,stirAttestation:d.response.callInvitation.spamProperties&&d.response.callInvitation.spamProperties.stirAttestation,isRedirectAllowed:this.isRedirectAllowed},u)},SignalingSession.prototype.sendProgress=function(l,d){var u=this;void 0===d&&(d=_e.causeId()),this.logger.info(\"[\".concat(d,\"][sendProgress]\")),this.telemetryHelper.recordEvent(fe.EVENTS.SEND_PROGRESS,{causeId:d}),this.http.sendPostRequest({url:l.response.callInvitation.links.progress,requestName:fe.NETWORK_REQUESTS.SEND_CALL_PROGRESS.name,payload:U.getPayload(this),causeId:d}).catch((function(l){var h=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[\".concat(d,\"][sendProgress] error: \").concat((0,y.getPrintableObject)(h))),u.disposed||u.telemetryHelper.recordEvent(fe.EVENTS.SEND_PROGRESS_FAILED,p({causeId:d},h.error))}))},SignalingSession.prototype.handleCallNotification=function(l){var d=_e.extractCauseIdFromMessage(l);if(this.logger.info(\"[\".concat(d,\"][handleCallNotification]\")),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_CALL_NOTIFICATION,l),!_e.stringEndsWith(l.url,ve.URL_PATH.REPLACE))throw new Error(\"[\".concat(d,\"][handleCallNotification]IncomingCallNotification should not be received in handleIncomingMsg\"));this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_INCOMING_CALL_REPLACEMENT,l),this.logger.info(\"[\".concat(d,\"][handleCallNotification]replacementCallNotification\")),this.signalingSessionCallback&&this.signalingSessionCallback.onIncomingCallReplacement(l.body,d)},SignalingSession.prototype.handleMediaAnswer=function(l){this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_MEDIA_ANSWER,l);var d=l.body,u=_e.extractCauseIdFromMessage(l);if(this.logger.info(\"[\".concat(u,\"][handleMediaAnswer]\")),this.mediaRenegotiationManager.isOutgoingRenegotiationInProgress())this.mediaRenegotiationManager.handleMediaAnswer(d,u);else if(this.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED);else if(this.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING){if(_e.isDuplicateMessage(l.headers,this.provisionalMediaAnswersSeenSoFar))return void this.logger.info(\"[\".concat(u,\"][handleMediaAnswer] ignoring provisional answer retried by service\"));d.mediaAnswer.sender&&(this.remoteUser=d.mediaAnswer.sender),this.resetCallEstablishmentTimeout(u),d.mediaAnswer.noRingBack||(this.telemetryHelper.setTimeToRingDuration(),this.onCallStatusChanged(ve.default.CALL_STATUS.RINGING,u));var p=d.mediaAnswer.mediaContent;this.signalingSessionCallback.onAnswer({provisional:!0,renegotiation:!1,remoteEndpointId:d.mediaAnswer.sender?d.mediaAnswer.sender.endpointId:_e.newGuid(),remoteParticipantId:this.getParticipantIdForOfferAnswer(p),mediaContent:p},u)}},SignalingSession.prototype._sendCallAcceptanceAcknowledgement=function(l,d){return h(this,void 0,void 0,(function(){var u=this;return g(this,(function(h){return this.http.sendPostRequest({url:l.body.callAcceptance.links.acknowledgement,requestName:fe.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,payload:x.getPayload(this),causeId:d}).catch((function(l){var h=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);u.logger.info(\"[\".concat(d,\"][_sendCallAcceptanceAcknowledgement] error: \").concat((0,y.getPrintableObject)(h))),u.disposed||u.telemetryHelper.recordEvent(fe.EVENTS.HANDLE_CALL_ACCEPTANCE_FAILED,p({causeId:d},h.error))})),[2]}))}))},SignalingSession.prototype.handleCallAcceptance=function(l){var d=this,u=_e.extractCauseIdFromMessage(l);this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_CALL_ACCEPTANCE,l,{enableQuickSendAcceptanceAck:this.signalingAgentConfig.enableQuickSendAcceptanceAck,causeId:u}),this.logger.info(\"[\".concat(u,\"][handleCallAcceptance]enableQuickSendAcceptanceAck:\\n            \").concat(this.signalingAgentConfig.enableQuickSendAcceptanceAck)),this.signalingAgentConfig.enableQuickSendAcceptanceAck?(this._sendCallAcceptanceAcknowledgement(l,u),this._processCallAcceptance(l,u)):(this._processCallAcceptance(l,u),this.http.sendPostRequest({url:l.body.callAcceptance.links.acknowledgement,requestName:fe.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,payload:x.getPayload(this),causeId:u}).catch((function(l){var h=_e.getErrorForXHRFailure(l,d.signalingAgentConfig);d.logger.info(\"[\".concat(u,\"][handleCallAcceptance] error: \").concat((0,y.getPrintableObject)(h))),d.disposed||d.telemetryHelper.recordEvent(fe.EVENTS.HANDLE_CALL_ACCEPTANCE_FAILED,p({causeId:u},h.error))})))},SignalingSession.prototype.handleCallAcceptanceSync=function(l){var d=_e.extractCauseIdFromMessage(l);this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_CALL_ACCEPTANCE_SYNC,l,{enableQuickSendAcceptanceAck:this.signalingAgentConfig.enableQuickSendAcceptanceAck,causeId:d}),this.logger.info(\"[\".concat(d,\"][handleCallAcceptanceSync] enableQuickSendAcceptanceAck:\\n            \").concat(this.signalingAgentConfig.enableQuickSendAcceptanceAck)),this.signalingAgentConfig.enableQuickSendAcceptanceAck?m.defer(this._processCallAcceptance,l,d):this._processCallAcceptance(l,d);var u=x.getPayload(this).payload;return this.telemetryHelper.addNetworkOperationCompleted(fe.NETWORK_REQUESTS.SEND_ACCEPTANCE_ACKNOWLEDGEMENT.name,!0),u},SignalingSession.prototype.getFakeRoster=function(l){var d,u,p,h=this.participantManager.getParticipantsToInitiateCallWith(),g={id:p=1===h.length?h[0].id:l.callAcceptance.acceptedBy.id,displayName:l.callAcceptance.acceptedBy.id===p?l.callAcceptance.acceptedBy.displayName:\"\",endpointId:l.callAcceptance.acceptedBy.endpointId,participantId:l.callAcceptance.acceptedBy.participantId,languageId:l.callAcceptance.acceptedBy.languageId},f=l.callAcceptance.acceptedBy.endpointId;return{type:\"MultiPartyEndpoint\",participants:(d={},d[p]={acceptedBy:l.callAcceptance.acceptedBy.id,details:g,endpoints:(u={},u[f]={call:{},contentSharing:{},capabilities:l.callAcceptance.capabilities},u)},d)}},SignalingSession.prototype.processCallAcceptance=function(l,d){var u;this.logger.info(\"[\".concat(d,\"][processCallAcceptance] \").concat((0,y.getPrintableObject)(l))),this.telemetryHelper.recordEvent(fe.EVENTS.PROCESS_CALL_ACCEPTANCE,{causeId:d}),this.fsmState=ve.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch(),this.mediaRenegotiationManager.onCallConnected(d);var p=!1;l.callAcceptance.controllerName===ve.default.MISC.LOBBY_CALL_CONTROLLER&&(this.logger.info(\"[\".concat(d,\"][processCallAcceptance] Controller name is lobby so putting user in lobby\")),this.participantManager.localParticipant.isLobby=!0,this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId,participantId:this.participantManager.localParticipant.participantId}),p=!0,this.telemetryHelper.recordEvent(fe.EVENTS.ACCEPTANCE_USER_IN_LOBBY,{causeId:d})),this.participantManager.localParticipant.isStaging=(0,S.hasStagingGroup)(l.callAcceptance),this.signalingSessionCallback.onMeetingGroupDetailsUpdated(l.callAcceptance.meetingGroupDetails,d),this.signalingSessionCallback.updateIsSharedLineAppearanceV2Activated(null===(u=l.callAcceptance.callProperties)||void 0===u?void 0:u.isSharedLineAppearanceV2Activated),this.logger.info(\"[\".concat(d,\"][processCallAcceptance] for localParticipant, isStaging is set to \").concat(this.participantManager.localParticipant.isStaging));var h=this.mediaTypesToUse,g=_e.newGuid();l.callAcceptance.acceptedBy&&(this.remoteUser=O.default.fromWireParticipant(l.callAcceptance.acceptedBy),g=l.callAcceptance.acceptedBy.endpointId),l.callAcceptance.acceptedCallModalities&&l.callAcceptance.acceptedCallModalities.length>0&&(h=l.callAcceptance.acceptedCallModalities);var f=l.callAcceptance.mediaContent;this.callUsesMixer=f.fromMixer;var m=_e.getMediaTypes(h);this.telemetryHelper.addIncomingModalities(m),this.telemetryHelper.setAnsweredModalities(f.blob,!0),this.links[ve.default.LINKS.MEDIA_RENEGOTIATION]=l.callAcceptance.links.mediaRenegotiation,this.links[ve.default.LINKS.TRANSFER]=l.callAcceptance.links.transfer,this.links[ve.default.LINKS.REPLACE]=l.callAcceptance.links.replacement,this.links[ve.default.LINKS.HANGUP]=l.callAcceptance.links.callLeg,this.links[ve.default.LINKS.KEEPALIVE]=l.callAcceptance.links.callLeg,this.links[ve.default.LINKS.PARK]=l.callAcceptance.links.hold,this.saveMediaControllerLinksIfAny(l.callAcceptance),this.scheduleKeepAlives(l.callAcceptance.callKeepAliveInterval);var v=this.getParticipantIdForOfferAnswer(f);this.signalingSessionCallback.onAnswer({provisional:!1,renegotiation:!1,remoteEndpointId:g,remoteParticipantId:v,callAcceptedByNGCVoicemail:v===ve.default.KNOWN_BOTS.VOICEMAIL_BOT_ID,mediaTypes:m,mediaContent:f},d),this.setCallMode(1,d),this.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTED,d),p&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant,d),this.linkUpdateRequested.keepAliveLinks&&(this.logger.info(\"[\".concat(d,\"][processCallAcceptance] Updating CC links as requested\")),this.updateLinks(this.updateKeepAliveUrl,d))},SignalingSession.prototype.handleLwjAcceptance=function(l){var d=_e.extractCauseIdFromMessage(l);if(this.logger.info(\"[\".concat(d,\"][handleLwjAcceptance]\")),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_LWJ_ACCEPTANCE,l),this.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING){this.telemetryHelper.recordEvent(fe.EVENTS.PROCESS_LWJ_ACCEPTANCE,{causeId:d}),this.fsmState=ve.default.SIGNALING_FSM_STATE.CONNECTED,this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.isPreheatOnly||this.telemetryHelper.startCallConnectedWatch();var u=!1;l.body.participantState===ve.default.MISC.LOBBY_PARTICIPANT_STATE&&(this.logger.info(\"LWJ acceptance indicates user is in lobby\"),this.participantManager.localParticipant.isLobby=!0,this.participantManager.localParticipant.endpointDetails.push({isLobby:!0,endpointId:this.participantManager.localParticipant.endpointId,participantId:this.participantManager.localParticipant.participantId}),u=!0,this.telemetryHelper.recordEvent(fe.EVENTS.ACCEPTANCE_USER_IN_LOBBY)),this.links[ve.default.LINKS.LMC_NOTIFICATION_LINKS]=l.body.links.notificationLinks,this.links[ve.default.LINKS.KEEPALIVE]=l.body.links.keepalive,this.scheduleKeepAlivesForLwj(l.body.lwj.refreshInterval),this.signalingSessionCallback.onLwjUpdated(l.body.lwj,d),this.onCallStatusChanged(ve.default.CALL_STATUS.CONNECTED,d),this.telemetryHelper.setTimeToRingDuration(),u&&this.signalingSessionCallback.onSelfParticipantUpdated(this.participantManager.localParticipant,d)}},SignalingSession.prototype.updateGroupChatIds=function(l,d){var u=this.groupId,p=this.threadId,h=this.teamsMessageId;this.groupId=l.groupId,this.threadId=l.threadId,this.teamsMessageId=l.messageId||null,this.groupId===u&&this.threadId===p&&this.teamsMessageId===h||this.signalingSessionCallback.onConversationUpdated({conversationType:this.conversationType,groupId:this.groupId,threadId:this.threadId,teamsMessageId:this.teamsMessageId,isMultiParty:this.multiParty,commandUrlPresence:this.getCommandUrlPresence(),meetingData:this.meetingData,region:this.region,meetingInfo:this.meetingInfo,callLimits:this.callLimits},d)},SignalingSession.prototype.handleCallEnd=function(l){var d=l.body.callEnd||l.body,u=_e.extractCauseIdFromMessage(l);if(this.logger.info(\"[\".concat(u,\"][handleCallEnd][content=\").concat((0,y.getPrintableObject)(d),\"]\")),this.telemetryHelper.recordEvent(fe.EVENTS.HANDLE_CALL_END,{origin:l.origin,code:d?d.code:\"unknown\",subCode:d?d.subCode:\"unknown\",resultCategories:d?d.resultCategories:[],causeId:u}),this.fsmState!==ve.default.SIGNALING_FSM_STATE.IDLE)if(d.code===ve.default.CALL_END_CODE.CONFLICT&&this.multiParty&&d.conversationUrl&&d.conversationUrl.Location)this.handleConversationResolutionConflict(d,u);else{this.disposing=!0,d.callControllerTransactionEnd&&(this.logger.info(\"handleCallEnd: using CC end details specified in CS end\"),d=d.callControllerTransactionEnd),d.broadcastOperationFailure&&(this.logger.info(\"handleCallEnd: using broadcastOperationFailure end details specified in CS end\"),d=d.broadcastOperationFailure);var p=d.code===ve.default.CALL_END_CODE.SUCCESS||d.code===ve.default.CALL_END_CODE.CANCEL||d.code===ve.default.CALL_END_CODE.REJECT;this.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.REMOTE,resultDetail:d.phrase,resultValue:p?fe.default.RESULT_VALUE.SUCCESS:fe.default.RESULT_VALUE.FAILURE,endCode:d.code,endSubCode:d.subCode,resultCategories:d?d.resultCategories:[],causeId:u});var h={code:d.code,subCode:d.subCode,phrase:d.phrase,resultCategories:d.resultCategories};this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,d.acceptedElsewhereBy&&(this.acceptedElsewhereBy={id:d.acceptedElsewhereBy.id,displayName:d.acceptedElsewhereBy.displayName}),this.onCallStatusChanged(ve.default.CALL_STATUS.REMOTE_TERMINATED,u,h),this.dispose(h,u)}else this.logger.info(\"[\".concat(u,\"][handleCallEnd] not handling incoming callEnd since fsmstate = SIGNALING_FSM_STATE.IDLE\"))},SignalingSession.prototype.handleConversationResolutionConflict=function(l,d){var u;this.logger.info(\"[\".concat(d,\"][handleConversationResolutionConflict]\"));var h=p(p({},l),{phrase:l.phrase||\"Conflict Resolution Error\"});if(this.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING_FOR_ROSTER_ONLY||this.fsmState===ve.default.SIGNALING_FSM_STATE.CONNECTED_FOR_ROSTER_ONLY)this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,this.http.cancelRequestIfPending(fe.NETWORK_REQUESTS.JOIN_CONVERSATION_WITHOUT_CALL_MODALITY.name,d,void 0,h),this.subscribeToCall(l.conversationUrl.Location,l.correlationId,this.lastUsedJoinCallOptions?this.lastUsedJoinCallOptions.clientEndpointCapabilities:0,{meetingData:this.meetingData,meetingPreferences:this.meetingPreferences,additionalEndpointProperties:null===(u=this.lastUsedJoinCallOptions)||void 0===u?void 0:u.additionalEndpointProperties},d);else{this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT);var g={meetingData:this.meetingData,meetingPreferences:this.meetingPreferences};if(this.joinedLightWeight&&(g.isLwj=!0),this.lastUsedJoinCallOptions){var f=this.lastUsedJoinCallOptions.scenario;g.muted=this.lastUsedJoinCallOptions.muted,g.scenario=\"409Redirect\".concat(f||\"\"),g.isPreheatOnly=this.lastUsedJoinCallOptions.isPreheatOnly,g.clientEndpointCapabilities=this.lastUsedJoinCallOptions.clientEndpointCapabilities,g.clientEndpointDebugContent=this.lastUsedJoinCallOptions.clientEndpointDebugContent,g.additionalEndpointProperties=this.lastUsedJoinCallOptions.additionalEndpointProperties}else g.scenario=\"409RedirectJoin\";this.setInitialTelemetry(v.CALL_OPERATIONS.JOIN_CALL,{correlationId:l.correlationId,causeId:d,conversationServiceUrl:l.conversationUrl.Location,joinCallOptions:g,offerGenerationTime:void 0}),this.http.cancelRequestIfPending(fe.NETWORK_REQUESTS.JOIN_CONVERSATION.name,d,void 0,h),this.http.cancelRequestIfPending(fe.NETWORK_REQUESTS.START_CALL.name,d,void 0,h),this.joinGivenConversation(l.conversationUrl.Location,l.correlationId,this.lastUsedOutgoingMediaContent,this.mediaTypesToUse,void 0,g,d)}},SignalingSession.prototype.handleCallProgress=function(l){this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_CALL_PROGRESS,l);var d=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(d,\"][handleCallProgress]\"));var u=l.body.callProgress;this.fsmState===ve.default.SIGNALING_FSM_STATE.OUTGOING&&(this.telemetryHelper.setTimeToRingDuration(),this.resetCallEstablishmentTimeout(d),this.onCallStatusChanged(ve.default.CALL_STATUS.RINGING,d),\"forwarded\"===u.status&&this.signalingSessionCallback.onCallForwarded({destinationType:u.forwardingDestinationType||\"user\"},d))},SignalingSession.prototype.resetCallEstablishmentTimeout=function(l){var d=this;this.logger.info(\"resetCallEstablishmentTimeout\"),this.timeoutManager.stopTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT),this.timeoutManager.startTimer(ve.default.TIMEOUT_OPERATIONS.OUTGOING_CALL_ESTABLISHMENT,(function(){d.handleCallEstablishmentTimeout(l)}),ve.default.TIMEOUT_VALUES_IN_SECONDS.OUTGOING_CALL_ESTABLISHMENT_TIMEOUT)},SignalingSession.prototype.handleMediaAcknowledgement=function(l){this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_MEDIA_ACK,l);var d=l.body,u=_e.extractCauseIdFromMessage(l);this.currentCallStatus!==ve.default.CALL_STATUS.CONNECTED?this.telemetryHelper.recordEvent(fe.EVENTS.HANDLE_MEDIA_PROVISIONAL_ACK,{causeId:u}):this.mediaRenegotiationManager.handleMediaAcknowledgment(d,u)},SignalingSession.prototype.handleConversationUpdate=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(u,\"][handleConversationUpdate]content=\").concat((0,y.getPrintableObject)(d))),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_CONVERSATION_UPDATE,l),this.processConversationServiceResponse(d,u)},SignalingSession.prototype.endBroadcastMeeting=function(l){this.logger.info(\"[\".concat(l,\"][endBroadcastMeeting]\")),this.broadcastSession=null},SignalingSession.prototype.handleLocalParticipantUpdate=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(u,\"][handleLocalParticipantUpdate]content=\").concat((0,y.getPrintableObject)(d))),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_LOCAL_PARTICIPANT_UPDATE,l),this.processLocalParticipantUpdateResponse(d,u)},SignalingSession.prototype.handleAddModalityFailure=function(l){var d,u=l.body,p=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(p,\"][handleAddModalityFailure]\")),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_ADD_MODALITY_FAILURE,l),u.modalityFailure.contentSharing?null===(d=this.contentSharingManager)||void 0===d||d.handleAddModalityFailure(u,p):u.modalityFailure.groupChat?this.signalingSessionCallback.onChatModalitySetupFailed({code:u.modalityFailure.groupChat.code,subCode:u.modalityFailure.groupChat.subCode,phrase:u.modalityFailure.groupChat.phrase,resultCategories:u.modalityFailure.groupChat.resultCategories},p):u.modalityFailure.broadcast&&this.broadcastSession&&this.broadcastSession.handleAddBroadcastModalityFailure(u,p)},SignalingSession.prototype.handleAddModalitySuccess=function(l){var d,u=l.body,p=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(p,\"][handleAddModalitySuccess]\")),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,l),u.modalitySuccess.contentSharing?null===(d=this.contentSharingManager)||void 0===d||d.handleAddModalitySuccess(u,p):u.modalitySuccess.groupChat?this.logger.info(\"[\".concat(p,\"][handleAddModalitySuccess] group modality \").concat((0,y.getPrintableObject)(u.modalitySuccess.groupChat))):u.modalitySuccess.broadcast&&this.broadcastSession&&this.broadcastSession.handleAddBroadcastModalitySuccess(u,p)},SignalingSession.prototype.handleTransferRequested=function(l){var d=l.body.callTransfer,u=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(u,\"][handleTransferRequested]\")),d.parkType?(this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_PARK_REQUESTED,l,{type:d.parkType}),this.telemetryHelper.addSharedCorrelationId(d.sharedCorrelationId)):\"voicemail\"===d.target.endpointType?(this.logger.info(\"[\".concat(u,\"][handleTransferRequested] target endpointType = \").concat(d.target.endpointType)),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.TRANSFER_REQUEST_RECEIVED,l)):this.telemetryHelper.recordIncomingEvent(fe.EVENTS.TRANSFER_REQUEST_RECEIVED,l),this.links[ve.default.LINKS.TRANSFER_ACCEPTANCE]=d.links.transferAcceptance,this.links[ve.default.LINKS.TRANSFER_COMPLETION]=d.links.transferCompletion,this.signalingSessionCallback.onTransferRequested?this.signalingSessionCallback.onTransferRequested(d,u):this.logger.info(\"[\".concat(u,\"][handleTransferRequested] failed, no callback defined\"))},SignalingSession.prototype.handleTransferAcceptance=function(l){var d=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(d,\"][handleTransferAcceptance]\")),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.WAITING_FOR_TRANSFER_COMPLETION,l),this.signalingSessionCallback.onTransferAccepted?this.signalingSessionCallback.onTransferAccepted(d):this.logger.info(\"[\".concat(d,\"][handleTransferAcceptance]failed, no callback defined\"))},SignalingSession.prototype.handleTransferCompletion=function(l){var d=l.body,u=_e.extractCauseIdFromMessage(l);this.logger.info(\"[\".concat(u,\"][handleTransferCompletion]\")),d.sharedCorrelationId&&this.telemetryHelper.addSharedCorrelationId(d.sharedCorrelationId),d.unparkContent&&void 0!==d.unparkContent.pickupCode&&(d.unparkContent.pickupCode=d.unparkContent.pickupCode.toString(),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.PICKUP_CODE_SET,l)),this.signalingSessionCallback.onTransferCompleted?(l.body.transferCompletion&&(0===l.body.transferCompletion.code?this.telemetryHelper.recordIncomingEvent(fe.EVENTS.TRANSFER_COMPLETED,l):(this.logger.info(\"[\".concat(u,\"][handleTransferCompletion]-1-code: \").concat(d.transferCompletion.code,\", message: \").concat((0,y.getPrintableObject)(l))),this.telemetryHelper.recordIncomingEvent(fe.EVENTS.TRANSFER_COMPLETION_FAILED,l,{code:d.transferCompletion.code,subcode:d.transferCompletion.subCode,resultCategories:d.transferCompletion.resultCategories}))),this.signalingSessionCallback.onTransferCompleted(d,u)):(l.body.transferCompletion&&(l.body.transferCompletion.code===ve.default.CALL_END_CODE.NETWORK_ERROR?this.telemetryHelper.recordIncomingEvent(fe.EVENTS.WAITING_FOR_TRANSFER_COMPLETION_FAIL,l):this.telemetryHelper.recordIncomingEvent(fe.EVENTS.TRANSFER_COMPLETION_FAILED,l,{code:d.transferCompletion.code,subcode:d.transferCompletion.subCode,resultCategories:d.transferCompletion.resultCategories})),this.logger.info(\"[\".concat(u,\"][handleTransferCompletion]failed, no callback defined\")))},SignalingSession.prototype.handleRosterUpdate=function(l,d){var u=l.body,p=_e.extractCauseIdFromMessage(l);this.disposing||this.disposed?this.logger.info(\"[\".concat(p,\"][handleRosterUpdate]failed=ignore call ending or ended\")):this.internalHandleRosterUpdate(u,d,p)},SignalingSession.prototype.handleNewMediaOffer=function(l){var d=_e.extractCauseIdFromMessage(l);this.telemetryHelper.recordIncomingEvent(fe.EVENTS.HANDLE_NEW_OFFER,l);var u=l.body.mediaOfferReady.mediaContent;this.callUsesMixer=u.fromMixer,this.signalingSessionCallback.onNewOffer({mediaContent:u,renegotiation:!1},d)},SignalingSession.prototype.internalHandleRosterUpdate=function(l,d,u){var p;if(l&&\"Delta\"!==l.type&&\"MultiPartyEndpoint\"!==l.type)this.logger.warn(\"[\".concat(u,\"][internalHandleRosterUpdate] roster.type=\").concat(l.type,\" is invalid\"));else{this.logger.info(\"[\".concat(u,\"][internalHandleRosterUpdate]\"));try{this.participantManager.handleRosterUpdate(l,d,u),null===(p=this.contentSharingManager)||void 0===p||p.handleIncomingContentSharingFromRoster(l,d,u)}catch(d){var h={code:ve.default.CALL_END_CODE.BAD_SERVICE_RESPONSE,subCode:ve.default.CALL_END_SUB_CODE.ROSTER_HANDLING_INVALID_SERVICE_RESPONSE,phrase:d&&d.toString()};throw this.logger.info(\"[\".concat(u,\"][internalHandleRosterUpdate] \").concat((0,y.safeJsonStringify)(h))),this.telemetryHelper.recordRosterEvent(l,fe.EVENTS.HANDLE_ROSTER_UPDATE_FAIL,u),h}}},SignalingSession.prototype.scheduleKeepAlives=function(l){var d=.9*l*1e3;this.logger.info(\"scheduleKeepAlives: every \".concat(d,\" milliseconds\")),this.keepAliveInterval=d,this.keepAliveTimer=window.setInterval(this.sendKeepAlive.bind(this),this.keepAliveInterval)},SignalingSession.prototype.scheduleKeepAlivesForLwj=function(l){var d=.9*l*1e3;this.logger.info(\"scheduleKeepAlivesForLwj: every \".concat(d,\" milliseconds\")),this.keepAliveIntervalLwj=d,this.keepAliveTimerLwj=window.setInterval(this.sendKeepAliveForLwj.bind(this),this.keepAliveIntervalLwj)},SignalingSession.prototype.scheduleConversationKeepAlive=function(){if(!this.conversationKeepAliveTimer&&!this.disposed){if(!this.conversationKeepAliveInterval){var l=this.signalingAgentConfig.csaTimeoutConfiguration.conversationKeepAliveTimeoutSec,d=(0,E.getRandomizedTimeout)(1e3*l);this.logger.info(\"sendConversationKeepAlive: every \".concat(d,\" milliseconds\")),this.conversationKeepAliveInterval=d}this.conversationKeepAliveTimer=window.setInterval(this.sendConversationKeepAlive.bind(this),this.conversationKeepAliveInterval)}},SignalingSession.prototype.sendConversationKeepAlive=function(){this.logger.info(\"sendConversationKeepAlive\"),this.disposed?this.logger.info(\"sendConversationKeepAlive ignored\"):(this.logger.info(\"sendConversationKeepAlive keepAlive count = \".concat(this.conversationKeepAliveCount++)),this.sendToUpdateConversationLinks(!0))},SignalingSession.prototype.sendKeepAlive=function(){this.logger.info(\"sendKeepAlive\"),this.disposed?this.logger.info(\"sendKeepAlive ignored\"):(this.logger.info(\"sendKeepAlive keepAlive count = \".concat(this.keepAliveCount++)),this.sendToKeepAliveUrl(null))},SignalingSession.prototype.sendKeepAliveForLwj=function(){this.disposed?this.logger.info(\"sendKeepAliveForLwj ignored\"):(this.logger.info(\"sendKeepAliveForLwj keepAlive count = \".concat(this.keepAliveCountLwj++)),this.sendToKeepAliveUrlForLwj(null))},SignalingSession.prototype.sendToUpdateConversationLinks=function(l,d){var u=this;if(void 0===d&&(d=_e.causeId()),!this.disposed){var h=this.logger.createChild(\"[\".concat(d,\"][sendToUpdateConversationLinks]\"),this.correlationId),g=l?he.getPayload(this):{},f=l?fe.NETWORK_REQUESTS.UPDATE_CONVERSATION_LINKS.name:fe.NETWORK_REQUESTS.SEND_CONVERSATION_KEEP_ALIVE.name,m=this.links[ve.default.LINKS.NOTIFICATION_LINKS];h.info(\"shouldUpdateUrl: \".concat(l,\", url: \").concat(m,\", payload: \").concat((0,y.getPrintableObject)(g))),m&&(this.conversationKeepAliveTimer&&(window.clearInterval(this.conversationKeepAliveTimer),this.conversationKeepAliveTimer=0),this.http.sendPostRequest({url:m,payload:g,withoutTrouter:!0,requestName:f,causeId:d}).then((function(l){u.disposed||(u.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_CONVERSATION_LINKS_SUCCESS,{causeId:d}),u.processConversationServiceResponse(l.response,d))})).catch((function(l){var h=_e.getErrorForXHRFailure(l,u.signalingAgentConfig),g=_e.isRetryable(h.error.code);u.logger.info(\"[\".concat(d,\"][updateConversationLinks] error: \").concat((0,y.getPrintableObject)(h),\", retryable: \").concat(g)),u.disposed||(u.telemetryHelper.recordEvent(fe.EVENTS.UPDATE_CONVERSATION_LINKS_FAILED,p({causeId:d},h.error)),g?u.scheduleConversationKeepAlive():u.links[ve.default.LINKS.NOTIFICATION_LINKS]=null)})))}},SignalingSession.prototype.sendToKeepAliveUrl=function(l,d){var u=this;void 0===d&&(d=_e.causeId());var p=this.logger.createChild(\"[\".concat(d,\"][sendToKeepAliveUrl]\"),this.correlationId);p.info(\"payload: \".concat((0,y.getPrintableObject)(l))),window.clearInterval(this.keepAliveTimer),this.disposed||(this.telemetryHelper.recordEvent(fe.EVENTS.SEND_KEEP_ALIVE),this.http.sendPostRequest({url:this.links[ve.default.LINKS.KEEPALIVE],payload:l,requestName:fe.NETWORK_REQUESTS.SEND_KEEP_ALIVE.name,withoutTrouter:!0,causeId:d}).then((function(){u.restartKeepAliveInterval()})).catch((function(l){var d=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);p.info(\"error: \".concat((0,y.getPrintableObject)(d))),u.restartKeepAliveInterval(!0,d.error)})))},SignalingSession.prototype.sendToKeepAliveUrlForLwj=function(l,d){var u=this;void 0===d&&(d=_e.causeId());var p=this.logger.createChild(\"[\".concat(d,\"][sendToKeepAliveUrlForLwj]\"),this.correlationId);p.info(\"payload: \".concat((0,y.getPrintableObject)(l))),window.clearInterval(this.keepAliveTimerLwj),this.disposed||(this.telemetryHelper.recordEvent(fe.EVENTS.SEND_KEEP_ALIVE_LWJ),this.http.sendPostRequest({url:this.links[ve.default.LINKS.KEEPALIVE],payload:l,requestName:fe.NETWORK_REQUESTS.SEND_KEEP_ALIVE_LWJ.name,withoutTrouter:!0,causeId:d}).then((function(){u.restartKeepAliveIntervalForLwj()})).catch((function(l){var h=_e.getErrorForXHRFailure(l,u.signalingAgentConfig);p.info(\"error: \".concat((0,y.getPrintableObject)(h))),h.error&&h.error.code===ve.default.CALL_END_CODE.NOT_FOUND?(p.info(\"disposing lwj call because of code: \".concat(h.error.code)),u.dispose(h.error,d)):u.restartKeepAliveIntervalForLwj(!0,h.error)})))},SignalingSession.prototype.handleCallEstablishmentTimeout=function(l,d,u){this.telemetryHelper.recordEvent(fe.EVENTS.HANDLE_CALL_ESTABLISHMENT_TIMEOUT);var p={code:ve.default.CALL_END_CODE.TIMEOUT,subCode:d||ve.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:u||ve.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT,resultCategories:[ve.RESULT_CATEGORIES.UnexpectedClientError]};this.telemetryHelper.setTerminatingData({terminatingEnd:fe.default.CALL_TERMINATING_END.LOCAL,resultValue:fe.default.RESULT_VALUE.FAILURE,resultDetail:p.phrase,endCode:p.code,endSubCode:p.subCode,causeId:l,resultCategories:p.resultCategories}),this.fsmState=ve.default.SIGNALING_FSM_STATE.IDLE,this.onCallStatusChanged(ve.default.CALL_STATUS.LOCAL_TERMINATED,l,p),this.dispose(p,l)},SignalingSession.prototype.handleCallTransferTimeout=function(l,d){if(this.disposed)this.logger.info(\"Transfer: handleCallTransferTimeout ignored\");else{var u={code:ve.default.CALL_END_CODE.TIMEOUT,phrase:ve.default.CALL_END_PHRASE.TRANSFER_COMPLETION_TIMEOUT};this.signalingSessionCallback.onTransferCompleted&&(!1===d?this.telemetryHelper.recordEvent(fe.EVENTS.TRANSFER_COMPLETION_FAILED,{code:ve.default.CALL_END_CODE.TIMEOUT,subcode:ve.default.CALL_END_SUB_CODE.TRANSFER_COMPLETE_TIMEOUT,causeId:l}):!0===d&&this.telemetryHelper.recordEvent(fe.EVENTS.WAITING_FOR_TRANSFER_ACCEPTANCE_FAIL,{causeId:l}),this.signalingSessionCallback.onTransferCompleted({transferCompletion:u},l))}},SignalingSession.prototype.checkCorrelationIdChange=function(l,d){if(l&&l.headers&&l.headers[ve.default.HEADERS.CORRELATION_ID]&&l.headers[ve.default.HEADERS.CORRELATION_ID].length){var u=[ve.URL_PATH.CONV_CONTENT_SHARING_UPDATE,ve.URL_PATH.CONV_CONTENT_SHARING_END].some((function(d){return l.url&&_e.stringEndsWith(l.url,d)})),p=l.headers[ve.default.HEADERS.CORRELATION_ID];this.correlationId===p||u||(this.logger.info(\"[\".concat(d,\"]checkCorrelationIdChange:\").concat(this.correlationId,\" => \").concat(p)),this.telemetryHelper.addChangingCorrelationId(this.correlationId,p),this.updateCorrelationId(p,d))}},SignalingSession.prototype.getCommandUrlPresence=function(){var l=ye.CommandUrlPresence.None;return this.links[ve.default.LINKS.MUTE]&&(l|=ye.CommandUrlPresence.Mute),this.links[ve.default.LINKS.UNMUTE]&&(l|=ye.CommandUrlPresence.Unmute),l},SignalingSession.prototype.getCallNotFoundTransactionEnd=function(){return{code:ve.default.CALL_END_CODE.CALL_DOES_NOT_EXIST,subCode:0,phrase:ve.default.CALL_END_PHRASE.CALL_DOES_NOT_EXIST}},SignalingSession.prototype.getTerminatingCallResultDetail=function(l,d){var u=p({source:l},d);return(0,y.getPrintableObject)(u)},SignalingSession.prototype.dispose=function(l,d){var u=this;this.disposed||(this.logger.info(\"[\".concat(d,\"][dispose] end reason \").concat((0,y.getPrintableObject)(l))),this.disposed=!0,this.disposing=!1,this.tearDownConnectionCheck(),this.conversationKeepAliveTimer&&(window.clearInterval(this.conversationKeepAliveTimer),this.conversationKeepAliveTimer=0),this.keepAliveTimer&&window.clearInterval(this.keepAliveTimer),this.keepAliveTimerLwj&&window.clearInterval(this.keepAliveTimerLwj),this.brokerService&&this.brokerService.dispose(),this.http.cancelAllRequests(d).then((function(){var p,h;u.signalingAgent.onCallCompleted(u.sessionId,d),u.signalingAgentConfig.trouterUrlGetter&&u.signalingAgentConfig.trouterUrlGetter.trouterUrl.changed.off(u.onTrouterUrlChanged),u.signalingAgentConfig.trouterServiceProvider&&u.signalingAgentConfig.trouterServiceProvider.offStateChanged(u.onTrouterStateChanged),u.timeoutManager.dispose(),u.timeoutManager=null,u.participantManager.dispose(l,d),u.callOperationHandler.dispose(\"call ended\",l,d),u.participantManager=null,null===(p=u.mediaRenegotiationManager)||void 0===p||p.dispose(),u.mediaRenegotiationManager=null,null===(h=u.contentSharingManager)||void 0===h||h.dispose(l,d),u.contentSharingManager=null,u.telemetryHelper.dispose(),u.telemetryHelper=null,u.webRtcSignalingManager.dispose(),u.webRtcSignalingManager=null})))},SignalingSession}();function build(l,d,u,p,h,g){return new Ee(l,d,u,p,h,g)}d.SignalingSession=Ee,d.build=build},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function TimeoutManager(l){var d=this;this.timers={},this.startTimer=function(l,u,p,h){d.logger.info(\"startTimer called for :  \".concat(l));var g=window.setTimeout(u,1e3*p),f=h?\"\".concat(l).concat(h):l;d.timers[f]=g},this.stopTimer=function(l,u){d.logger.info(\"stopTimer called for : \".concat(l));var p=u?\"\".concat(l).concat(u):l;d.timers.hasOwnProperty(p)&&(clearTimeout(d.timers[p]),delete d.timers[p])},this.dispose=function(){d.logger.info(\"timeoutManager :: dispose\"),Object.keys(d.timers).forEach((function(l){d.stopTimer(l)}))},this.logger=l}return TimeoutManager}();d.default=p},function(l,d,u){function processTransactionResponse(l){var d={};if(l.stateId)d.result=l.stateId;else if(l.results){var u=l.results;1===u.length&&u[0].stateId&&(d.result=u[0].stateId);var p={};l.results.forEach((function(l){var u=l.result,h=getParticipantId(l);(void 0===d.code||u.code>d.code)&&(d.code=u.code,d.subCode=u.subCode),p[h]=l})),d.result=JSON.stringify(p)}else l.result&&(d={code:l.result.code,phrase:l.result.phrase,subCode:l.result.subCode,resultCategories:l.result.resultCategories},l.additionalDetail&&(d.result=l.additionalDetail));return d}function getParticipantId(l){return l.participantId||l.participant&&l.participant.id}Object.defineProperty(d,\"__esModule\",{value:!0}),d.processTransactionResponse=void 0,d.processTransactionResponse=processTransactionResponse},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(25),g=u(5),f=u(10),m=u(4),v=function(){function BroadcastSession(l,d){var u=this;this.broadcastContext=null,this.broadcastControllerUrl=\"\",this.broadcastCallbackUrl=\"\",this.broadcastState=null,this.setContext=function(l){void 0===l&&(l=null),u.logger.info(\"BroadcastSession :: set broadcast context\",l),u.broadcastContext=l},this.getContext=function(){return u.logger.info(\"BroadcastSession :: get broadcast context\",u.broadcastContext||null),u.broadcastContext||null},this.signalingSession=l,this.signalingSessionCallback=d,this.logger=l.logger.createChild((function(){return\"[Broadcast]\"}))}return BroadcastSession.prototype.handleBroadcastStateChanged=function(l){var d=l.body;this.broadcastState=d;var u=(0,m.extractCauseIdFromMessage)(l);this.signalingSession.telemetryHelper.recordIncomingEvent(h.EVENTS.BROADCAST_STATE_CHANGED,l),this.logger.info(\"[\".concat(u,\"] broadcast state changed=\").concat(this.broadcastState)),this.updateBroadcastMetadata(u)},BroadcastSession.prototype.updateBroadcastCallbackUrl=function(l){var d=f.get(this.signalingSession,g.URL_PATH.CONV_BROADCAST_UPDATE);this.broadcastCallbackUrl!==d&&(this.broadcastCallbackUrl=d,this.logger.info(\"[\".concat(l,\"] broadcast callback url changed=\").concat(this.broadcastCallbackUrl)),this.updateBroadcastMetadata(l))},BroadcastSession.prototype.handleBroadcastDetailsChanged=function(l,d){this.signalingSession.telemetryHelper.recordEvent(h.EVENTS.UPDATE_BROADCAST_DETAILS,{causeId:d}),l.activeModalities&&l.activeModalities.broadcast&&l.activeModalities.broadcast.controller!==this.broadcastControllerUrl&&(this.broadcastControllerUrl=l.activeModalities.broadcast.controller,this.broadcastAdditionalData=l.activeModalities.broadcast,this.logger.info(\"[\".concat(d,\"] broadcast controller changed=\").concat(this.broadcastControllerUrl)),this.signalingSessionCallback.onBroadcastMeetingConnected(g.default.SUCCESS_TRANSACTION_END,d),this.updateBroadcastMetadata(d)),!this.broadcastControllerUrl||l.activeModalities&&l.activeModalities.broadcast||(this.broadcastControllerUrl=\"\",this.broadcastContext=null,this.logger.info(\"[\".concat(d,\"] broadcast controller changed=\").concat(this.broadcastControllerUrl)),this.updateBroadcastMetadata(d),this.signalingSessionCallback.onBroadcastMeetingEnded(g.default.SUCCESS_TRANSACTION_END,d))},BroadcastSession.prototype.handleAddBroadcastModalitySuccess=function(l,d){this.logger.info(\"[\".concat(d,\"][handleAddBroadcastModalitySuccess]\"))},BroadcastSession.prototype.handleAddBroadcastModalityFailure=function(l,d){this.logger.info(\"[\".concat(d,\"][handleAddBroadcastModalityFailure]\"));var u=p({},l.modalityFailure.broadcast);this.signalingSessionCallback.onBroadcastMeetingEnded(u,d)},BroadcastSession.prototype.updateBroadcastMetadata=function(l){var d={broadcastControllerUrl:this.broadcastControllerUrl,broadcastStateCallbackUrl:this.broadcastCallbackUrl,broadcastState:this.broadcastState,broadcastAdditionalData:this.broadcastAdditionalData};this.logger.info(\"[\".concat(l,\"] update broadcast metadata=\").concat(d)),this.signalingSessionCallback.onBroadcastMeetingUpdated&&this.signalingSessionCallback.onBroadcastMeetingUpdated(d,l)},BroadcastSession}();d.default=v},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.TIMERS=void 0;var p,h=u(14),g=u(25),f=u(111),m=u(5),v=u(4),y=\"http://broker.invalid/\",S=30,_=5,C=1;!function(l){l.RETRY=\"RETRY\",l.TIMEOUT=\"TIMEOUT\"}(p=d.TIMERS||(d.TIMERS={}));var E=function(){function BrokerService(l){var d,u=this;this._signalingSession=l,this.baseUrl=y,this._currentSubscriptionTimeoutInSec=S,this._subscribers=[],this._disposed=!1,this._reportedResultCount=0,this._subscriptionRetryBackoffInSec=_,this._notifySubscribers=function(l){u._logger.info(\"_notifySubscribers\"),Promise.resolve().then((function(){l.split(\",\").forEach((function(l){var d=v.decodeMessage(l),p=v.parseRawHttpMessage(d),h=p.body;v.isEncodedMessage(p.headers)&&v.isMessageEncodingSupported(p.headers)&&(h=v.decodeMessage(h));var g={url:p.url,body:JSON.parse(h),headers:p.headers};u._logger.info(\"message length=\",h.length,\"n. of subscribers\",u._subscribers.length),u._subscribers.forEach((function(l){return l(g)}))}))})).catch((function(l){u._logger.error(\"_notifySubscribers, failed to decode message\",l),u._signalingSession.telemetryHelper.recordEvent(g.EVENTS.BROKER_DECODE_PAYLOAD_FAILURE)}))},this._subscribeToBroker=function(l,d){if(u._disposed)u._logger.warn(\"_subscribeToBroker, disposed, ignore subscription\");else{var p=v.causeId();u._logger.info(\"_subscribeToBroker, url: \",l,\",timeout in sec\",d),u._currentSubscriptionUrl=l,u._currentSubscriptionTimeoutInSec=d,u._clearAllPendingTimeouts(),u._setSubscriptionTimeout(d),u._signalingSession.http.sendGetRequest({url:u._currentSubscriptionUrl,requestName:g.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name,customHeaders:u._getBrokerRequestHeaders(p),payload:null,skipHttpTelemetry:!u._reportSubscriptionInTelemetry(),causeId:v.causeId(),operationType:\"BrokerSubscribe\"}).then(u._handleSubscriptionSuccess).catch(u._handleSubscriptionFailure)}},this._clearAllPendingTimeouts=function(){u._cancelRequestTimer&&(u._cancelRequestTimer.stop(),u._cancelRequestTimer=null),u._retryRequestTimer&&(u._retryRequestTimer.stop(),u._retryRequestTimer=null)},this._abortPendingRequest=function(){u._signalingSession.http.cancelRequestIfPending(g.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name,v.causeId())},this._setSubscriptionTimeout=function(l){u._cancelRequestTimer=f.TimerFactory.build((function(){u._disposed||(u._signalingSession.http.hasPendingRequest(g.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name)?(u._logger.warn(\"timeout subscription\"),u._signalingSession.telemetryHelper.recordEvent(g.EVENTS.BROKER_SUBSCRIPTION_TIMEOUT),u._signalingSession.http.cancelRequestIfPending(g.NETWORK_REQUESTS.BROKER_SUBSCRIBE.name,v.causeId())):u._logger.error(\"Unable to resolve timeout deferred, it is not defined!\"))}),p.TIMEOUT).start(1e3*l)},this._handleSubscriptionSuccess=function(l){if(u._disposed)u._logger.warn(\"_handleSubscriptionSuccess, disposed, ignore subscription success\");else if(u._reportSubscriptionInTelemetry(l)&&u._signalingSession.telemetryHelper.recordEvent(g.EVENTS.BROKER_SUBSCRIPTION_SUCCESSFUL),l&&l.response){var d=l.response;u._logger.info(\"_handleSubscriptionSuccess, response\",d),d.message&&u._notifySubscribers(d.message);var p=d.nextSubscribeUrl||u._currentSubscriptionUrl,h=d.expirationTimeInSec||u._currentSubscriptionTimeoutInSec;u._subscribeToBroker(p,h)}else u._logger.info(\"_handleSubscriptionSuccess, empty response\")},this._handleSubscriptionFailure=function(l){if(u._disposed)u._logger.warn(\"_handleSubscriptionFailure, disposed, ignore subscription\");else if(l.status>=400&&l.status<500&&401!==l.status&&u.isNotNetworkErrors(l.status))u._logger.warn(\"_handleSubscriptionFailure, received status \".concat(l.status,\", stop subscribing\"));else{var d=(0,h.getPrintableObject)(l);u._logger.error(\"_handleSubscriptionFailure failed, re-subscribing\",d),u._reportSubscriptionInTelemetry()&&u._signalingSession.telemetryHelper.recordEvent(g.EVENTS.BROKER_SUBSCRIPTION_FAILED),u._retryRequestTimer=f.TimerFactory.build((function(){u._subscribeToBroker(u._currentSubscriptionUrl,u._currentSubscriptionTimeoutInSec)}),p.RETRY).start(1e3*u._subscriptionRetryBackoffInSec)}},this._reportSubscriptionInTelemetry=function(l){return u._reportedResultCount++,u._reportedResultCount<=C},this._getBrokerRequestHeaders=function(l){var d={};return d[m.default.HEADERS.CONTENT_TYPE]=m.default.CONTENT_TYPE.JSON,u._signalingSession.signalingAgentConfig.brokerRequestBatching&&(d[m.default.HEADERS.BROKER_USE_BATCHING_HEADER_NAME]=\"1\"),d},this._logger=this._signalingSession.logger.createChild(\"Broker\"),(null===(d=this._signalingSession.signalingAgentConfig.csaTimeoutConfiguration)||void 0===d?void 0:d.brokerRetryBackOffInSec)&&(this._subscriptionRetryBackoffInSec=this._signalingSession.signalingAgentConfig.csaTimeoutConfiguration.brokerRetryBackOffInSec)}return BrokerService.prototype.subscribeToBroker=function(l){this._abortPendingRequest(),this._clearAllPendingTimeouts(),this._subscribeToBroker(l,this._currentSubscriptionTimeoutInSec)},BrokerService.prototype.onBrokerMessage=function(l){this._logger.info(\"onBrokerMessage callback added\"),this._subscribers.push(l)},BrokerService.prototype.dispose=function(){this._disposed=!0,this._logger.info(\"dispose\"),this._subscribers=[],this._clearAllPendingTimeouts(),this._abortPendingRequest()},BrokerService.prototype.isNotNetworkErrors=function(l){return 490!==l&&496!==l&&498!==l&&499!==l},BrokerService}();d.default=E},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(17),h=u(5),g=function(){function CallOperations(l){this.requests={},this.logger=l}return CallOperations.prototype.clear=function(l,d){var u=this,p=d||{code:h.default.CALL_END_CODE.SUCCESS,subCode:h.default.CALL_END_SUB_CODE.SUCCESS,phrase:h.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach((function(d){try{var h=parseInt(d,10);Object.keys(u.requests[h]).forEach((function(d){u.rejectOperation(h,d,l,p)}))}catch(l){u.logger.warn(\"CallOperations: clear error = \".concat(l))}}))},CallOperations.prototype.hasOperation=function(l,d){return this.requests.hasOwnProperty(l.valueOf())&&this.requests[l.valueOf()].hasOwnProperty(d)},CallOperations.prototype.getAllOperations=function(){return this.requests},CallOperations.prototype.getOperation=function(l,d){return this.hasOperation(l,d)?this.requests[l.valueOf()][d]:null},CallOperations.prototype.setOperation=function(l,d,u){return!this.hasOperation(l,d)&&(this.hasOwnProperty(l.valueOf())||(this.requests[l.valueOf()]={}),this.requests[l.valueOf()][d]=u,!0)},CallOperations.prototype.rejectOperation=function(l,d,u,p){if(this.hasOperation(l,d)){var h=l.valueOf(),g=this.requests[h][d].promise;delete this.requests[h][d],g.reject(p)}},CallOperations.prototype.resolveOperation=function(l,d,u,p){if(this.hasOperation(l,d)){var h=l.valueOf(),g=this.requests[h][d].promise;delete this.requests[h][d],g.resolve(u)}},CallOperations}(),f=function(){function CallOperationHandler(l){this.logger=l,this.localRequests=new g(l)}return CallOperationHandler.prototype.dispose=function(l,d,u){this.logger.info(\"[\".concat(u,\"][dispose]\")),this.rejectAllPendingOperations(l,d)},CallOperationHandler.prototype.hasPendingOperation=function(l,d,u){return this.logger.info(\"[\".concat(u,\"][hasPendingOperation] \").concat(l,\" \").concat((0,p.scrubMriOrOmit)(d),\"}\")),this.localRequests.hasOperation(l,d)},CallOperationHandler.prototype.rejectPendingOperation=function(l,d,u,p,h){this.logger.info(\"[\".concat(h,\"][rejectPendingOperation] \").concat(l,\" \").concat(d,\" reason: \").concat(u,\" endCode: \").concat(p)),this.localRequests.rejectOperation(l,d,u,p)},CallOperationHandler.prototype.resolvePendingOperation=function(l,d,u,h){this.logger.info(\"[\".concat(h,\"][resolvePendingOperation]: \").concat((0,p.scrubMriOrOmit)(d))),this.localRequests.resolveOperation(l,d,u,h)},CallOperationHandler.prototype.setPendingOperation=function(l,d,u,p){return this.logger.info(\"[\".concat(p,\"][setPendingOperation] \").concat(l,\" value: \").concat(u)),this.localRequests.setOperation(l,d,u)},CallOperationHandler.prototype.rejectAllPendingOperations=function(l,d){this.logger.info(\"rejectLocalQueuedOperations\"),this.localRequests.clear(l,d)},CallOperationHandler}();d.default=f},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(14),f=u(224),m=u(5),v=u(4),y=function(){function ContentSharingManager(l,d){var u=this;this.contentSharingToStartCallWith=null,this.contentSharingSessions={},this.DEFAULT_STOP_REASON={code:m.default.CALL_END_CODE.SUCCESS,subCode:m.default.CALL_END_SUB_CODE.SUCCESS,phrase:m.default.CALL_END_PHRASE.REMOTE_USER_INITIATED},this.DEFAULT_STOP_ID=\"8:unknown\",this.deleteContentSharingAsync=function(l,d){u.logger.info(\"[\".concat(d,\"][deleteContentSharingAsync]\"));var p=v.defer(),h=u.contentSharingSessions[l];if(u.pendingSessionToStart&&u.pendingSessionToStart.correlationId===l&&(h=u.pendingSessionToStart),h){var always=function(){u.contentSharingSessions[l]&&delete u.contentSharingSessions[l]};h.delete(p,d).then(always,always)}else u.rejectBecauseOfMissingSession(l,p);return p.promise},this.signalingSession=l,this.signalingSessionCallback=d,this.logger=l.logger.createChild((function(){return\"[ContentSharingManager]\"})),this.lastProcessedSequenceNumber=-1,this.lastProcessedSequenceNumberForParticipant={}}return ContentSharingManager.prototype.startContentSharingAsync=function(l,d,u,p,h,g,y){var S=this;if(this.logger.info(\"startContentSharingAsync called for: \".concat(l)),this.pendingSessionToStart){var _=\"There is already a ContentSharing session start pending\";return this.logger.error(_),Promise.reject(new Error(_))}var C={contentIdentifier:l,subject:u||null,sessionState:d||null,sequenceNumber:1},E=v.defer(),T=new f.ContentSharingSession(this.signalingSession,y||v.newGuid());return this.pendingSessionToStart=T,h?(this.logger.info(\"Call connected, send content sharing request out immediately\"),T.start(p,C,E,g)):(this.logger.info(\"Content sharing is to be started when startOutgoingCall is called\"),T.addSessionPromise=E,T.fsmState=m.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED,this.contentSharingToStartCallWith=C),E.promise.then((function(){S.contentSharingSessions.hasOwnProperty(T.correlationId)||(S.contentSharingSessions[T.correlationId]=T),S.pendingSessionToStart=null})).catch((function(){S.pendingSessionToStart=null})),E.promise},ContentSharingManager.prototype.joinContentSharingAsync=function(l,d){this.logger.info(\"[\".concat(d,\"][joinContentSharingAsync]\"));var u=v.defer(),p=this.contentSharingSessions[l];return p?p.join(u,d):this.rejectBecauseOfMissingSession(l,u),u.promise},ContentSharingManager.prototype.updateContentSharingSessionStateAsync=function(l,d,u){this.logger.info(\"[\".concat(u,\"][updateContentSharingSessionStateAsync][sessionState=\").concat(JSON.stringify(d),\"]\"));var p=v.defer(),h=this.contentSharingSessions[l];return h?h.updateSessionState(d,p,u):this.rejectBecauseOfMissingSession(l,p),p.promise},ContentSharingManager.prototype.takeContentSharingControlAsync=function(l,d){this.logger.info(\"[\".concat(d,\"][takeContentSharingControlAsync]\"));var u=v.defer(),p=this.contentSharingSessions[l];return p?p.takeControl(u,d):this.rejectBecauseOfMissingSession(l,u),u.promise},ContentSharingManager.prototype.updateContentSharingParticipantStateAsync=function(l,d){this.logger.info(\"[\".concat(d,\"][updateContentSharingParticipantStateAsync]\"));var u=v.defer(),p=this.contentSharingSessions[l];return p?p.updateParticipantState(u,d):this.rejectBecauseOfMissingSession(l,u),u.promise},ContentSharingManager.prototype.updateContentSharingNotificationLinksAsync=function(l){var d,u;this.logger.info(\"[\".concat(l,\"][updateContentSharingNotificationLinksAsync]\"));try{for(var p=h(Object.keys(this.contentSharingSessions)),g=p.next();!g.done;g=p.next()){var f=g.value;if(this.contentSharingSessions.hasOwnProperty(f)){var m=this.contentSharingSessions[f];m&&m.updateNotificationLinks(l)}}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}},ContentSharingManager.prototype.getContentSharingInfoToStartSharing=function(){if(this.contentSharingToStartCallWith){var l=this.pendingSessionToStart,d=m.default.CONTENT_SHARING_FSM_STATE.CONTENT_SHARING_START_INITIATED;l&&l.fsmState===d||(this.contentSharingToStartCallWith=null,this.pendingSessionToStart=null)}return this.contentSharingToStartCallWith},ContentSharingManager.prototype.dispose=function(l,d){var u,p;this.logger.info(\"[\".concat(d,\"][dispose]\"));try{for(var g=h(Object.keys(this.contentSharingSessions)),f=g.next();!f.done;f=g.next()){var m=f.value;if(this.contentSharingSessions.hasOwnProperty(m)){var v=this.contentSharingSessions[m];v&&v.dispose(l,d)}}}catch(l){u={error:l}}finally{try{f&&!f.done&&(p=g.return)&&p.call(g)}finally{if(u)throw u.error}}},ContentSharingManager.prototype.handleContentSharingUpdate=function(l){var d=l.body,u=v.extractCauseIdFromMessage(l),p=this.contentSharingSessions[d.contentSharingCorrelationId];p?p.handleUpdate(d,u)&&this.signalingSessionCallback.onContentSharingUpdated({sessionId:d.sessionId,correlationId:d.contentSharingCorrelationId,contentIdentifier:d.identifier,presenter:d.presenter.id,subject:d.subject||null,sessionState:d.sessionState||null},u):this.logger.info(\"[\".concat(u,\"][handleContentSharingUpdate][failed][reason=no session with correlation ID \").concat(d.correlationId,\"]\"))},ContentSharingManager.prototype.handleAddModalitySuccess=function(l,d){this.logger.info(\"[\".concat(d,\"][handleAddModalitySuccess]\"));var u=this.pendingSessionToStart;u?u.handleAddModalitySuccess(l,d):this.logger.info(\"[\".concat(d,\"][handleAddModalitySuccess]Ignoring handleAddModalitySuccess because not waiting for one\"))},ContentSharingManager.prototype.handleAddModalityFailure=function(l,d){this.logger.info(\"[\".concat(d,\"][handleAddModalityFailure]\"));var u=this.pendingSessionToStart;u?u.handleAddModalityFailure(l,d):this.logger.info(\"[\".concat(d,\"][handleAddModalityFailure]Ignoring handleAddModalityFailure because not waiting for one\"))},ContentSharingManager.prototype.handleIncomingContentSharingFromRoster=function(l,d,u){if(this.logger.info(\"[\".concat(u,\"] handleIncomingContentSharingFromRoster: isFullRoster \").concat(d,\" content \").concat((0,g.getPrintableObject)(l))),(\"MultiPartyEndpoint\"===l.type||d)&&this.lastProcessedSequenceNumber>l.sequenceNumber)this.logger.info(\"[\".concat(u,\"] handleIncomingContentSharingFromRoster invalid roster current sequenceNumber \").concat(l.sequenceNumber,\" lastProcessedSequenceNumber \").concat(this.lastProcessedSequenceNumber));else{var p=this.parseContentSharingSessionsFromRoster(l),h=p.sessionsWithPresenters,f=p.sessionsWithoutPresenters;this.startSessionsFromRoster(h,u),this.stopSessionsFromRoster(f,u),this.lastProcessedSequenceNumber=l.sequenceNumber}},ContentSharingManager.prototype.handleContentSharingEnd=function(l){var d=l.body,u=v.extractCauseIdFromMessage(l);this.logger.info(\"handleContentSharingEnd : \",(0,g.getPrintableObject)(d));var h=this.contentSharingSessions[d.contentSharingCorrelationId];if(h){if(h.handleStop(d,u)){var f=p({},d.contentSharingTransactionEnd);this.raiseContentSharingStopped(d.contentSharingCorrelationId,u,d.presenter.id,f)}}else this.logger.info(\"Ignoring contentSharingEnd since there is no corresponding sharing ongoing\")},ContentSharingManager.prototype.parseContentSharingSessionsFromRoster=function(l){var d,u,p,g,f,m,v,y={},S={},_=new Set;try{for(var C=h(Object.keys(l.participants)),E=C.next();!E.done;E=C.next()){var T=E.value,b=l.participants[T];if(!(\"Delta\"===l.type&&this.lastProcessedSequenceNumberForParticipant.hasOwnProperty(T)&&b.version<=this.lastProcessedSequenceNumberForParticipant[T])&&(b.version=b.version||-1,this.lastProcessedSequenceNumberForParticipant[T]=b.version,_.add(b.details.id),b.endpoints)){var I=this.signalingSession.participantManager.localParticipant.participantId;try{for(var A=(p=void 0,h(Object.keys(b.endpoints))),R=A.next();!R.done;R=A.next()){var P=R.value,O=b.endpoints[P],M=null===(v=null==O?void 0:O.contentSharing)||void 0===v?void 0:v.sessionInformation;\"presenter\"===(null==M?void 0:M.role)&&(y[M.contentSharingCorrelationId]={presenterId:b.details.id,sessionInfo:M,selfEndpointIsPresenter:O.participantId===I})}}catch(l){p={error:l}}finally{try{R&&!R.done&&(g=A.return)&&g.call(A)}finally{if(p)throw p.error}}}}}catch(l){d={error:l}}finally{try{E&&!E.done&&(u=C.return)&&u.call(C)}finally{if(d)throw d.error}}try{for(var w=h(Object.keys(this.contentSharingSessions)),N=w.next();!N.done;N=w.next()){var D=N.value;!y[D]&&_.has(this.contentSharingSessions[D].presenterMri)&&(S[D]=this.contentSharingSessions[D])}}catch(l){f={error:l}}finally{try{N&&!N.done&&(m=w.return)&&m.call(w)}finally{if(f)throw f.error}}return{sessionsWithPresenters:y,sessionsWithoutPresenters:S}},ContentSharingManager.prototype.stopSessionsFromRoster=function(l,d){var u,p;this.logger.info(\"[\".concat(d,\"][stopSessionsFromRoster]\"));try{for(var g=h(Object.keys(l)),f=g.next();!f.done;f=g.next()){var m=f.value;this.logger.info(\"[\".concat(d,\"][stopSessionsFromRoster] stopping session with correlationId \").concat(m)),this.stopSession(l[m],d)}}catch(l){u={error:l}}finally{try{f&&!f.done&&(p=g.return)&&p.call(g)}finally{if(u)throw u.error}}},ContentSharingManager.prototype.stopSession=function(l,d){this.logger.info(\"[\".concat(d,\"][stopSession] Stopping session \").concat(l.sessionId)),l.handleStopFromRoster(this.DEFAULT_STOP_REASON,d),this.raiseContentSharingStopped(l.correlationId,d)},ContentSharingManager.prototype.startSessionsFromRoster=function(l,d){var u,p;this.logger.info(\"[\".concat(d,\"][startSessionsFromRoster]\"));try{for(var g=h(Object.keys(l)),f=g.next();!f.done;f=g.next()){var m=f.value;this.logger.info(\"[\".concat(d,\"][startSessionsFromRoster]\"));var v=this.contentSharingSessions[m],y=l[m];if(this.pendingSessionToStart&&this.pendingSessionToStart.correlationId===m?this.pendingSessionToStart.confirmInRoster():v&&v.confirmInRoster(),v)v&&(this.contentSharingSessions[m].presenterMri=y.presenterId,this.logger.info(\"[\".concat(d,\"][startSessionsFromRoster]Session \").concat(m,\" is already present locally\")));else{if(y.selfEndpointIsPresenter){this.logger.info(\"[\".concat(d,\"][startSessionsFromRoster]This endpoint is presenting, dont fire callback\"));continue}this.logger.info(\"[\".concat(d,\"][startSessionsFromRoster]New sharing session found. Raising ContentSharingStarted\")),this.raiseContentSharingStarted(y.presenterId,y.sessionInfo,d).handleStartFromRoster(y.presenterId,d)}}}catch(l){u={error:l}}finally{try{f&&!f.done&&(p=g.return)&&p.call(g)}finally{if(u)throw u.error}}},ContentSharingManager.prototype.raiseContentSharingStopped=function(l,d,u,p){this.logger.info(\"[\".concat(d,\"][raiseContentSharingStopped]\")),this.signalingSessionCallback.onContentSharingStopped({sessionId:this.contentSharingSessions[l].sessionId,correlationId:l,endedBy:u||this.DEFAULT_STOP_ID,reason:p||this.DEFAULT_STOP_REASON},d),delete this.contentSharingSessions[l]},ContentSharingManager.prototype.raiseContentSharingStarted=function(l,d,u){var p;this.logger.info(\"[\".concat(u,\"][raiseContentSharingStarted]\"));var h=new f.ContentSharingSession(this.signalingSession,d.contentSharingCorrelationId,d.contentSharingSessionId,((p={})[m.default.LINKS.CONTENT_SHARING_CONTROLLER]=d.contentSharingController,p));h.presenterMri=l,this.contentSharingSessions[h.correlationId]=h;var g={sessionId:d.contentSharingSessionId,correlationId:d.contentSharingCorrelationId,contentIdentifier:d.identifier,presenter:l,subject:d.subject||null,sessionState:d.sessionState||null};return this.signalingSessionCallback.onContentSharingStarted(g,u),h},ContentSharingManager.prototype.rejectBecauseOfMissingSession=function(l,d){var u=\"There is no ContentSharing session with the correlation ID \".concat(l);this.logger.error(u),d&&d.reject(new Error(u))},ContentSharingManager}();d.default=y},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.ContentSharingSession=void 0;var h=u(14),g=u(225),f=u(226),m=u(227),v=u(228),y=u(229),S=u(230),_=u(231),C=u(25),E=u(5),T=u(59),b=u(4),I=function(){function ContentSharingSession(l,d,u,p){var h=this;this.signalingSession=l,this.correlationId=d,this.sessionId=null,this.fsmState=E.default.CONTENT_SHARING_FSM_STATE.IDLE,this.addSessionPromise=null,this.removeSessionPromise=null,this.confirmInRosterPromise=null,this.links={},this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.disposed=!1,this.isPresenter=!1,this.FSM_STATES=E.default.CONTENT_SHARING_FSM_STATE,this.logger=l.logger.createChild((function(){return\"[\".concat(h.fsmState,\"][cs=\").concat(h.sessionId,\"][cc=\").concat(h.correlationId,\"]\")})),u&&(this.sessionId=u),p&&(this.links=p)}return ContentSharingSession.prototype.start=function(l,d,u,p){var f,m=this;if(this.logger.info(\"[\".concat(p,\"][start]\")),b.assertNotNullOrEmpty(l,\"Correct addModality url is not provided\"),!this.checkState(\"start\",this.FSM_STATES.IDLE,this.addSessionPromise))return Promise.reject(null);this.addSessionPromise=u,this.confirmInRosterPromise=b.defer(),this.fsmState=this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.addTelemetryOperation(C.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY.name,{causeId:p});var v=((f={})[E.default.HEADERS.CONTENT_SHARING_CORRELATION_ID]=this.correlationId,f);return this.signalingSession.http.sendPostRequest({url:l,payload:g.getPayload(this.signalingSession,d),requestName:C.NETWORK_REQUESTS.ADD_CONTENT_SHARING_MODALITY.name,customHeaders:v,onceTrouterReady:function(){m.startContentSharingTimer(p)},causeId:p}).then((function(){m.disposed||(m.presenterMri=m.signalingSession.participantManager.localParticipant.id,m.isPresenter=!0)})).catch((function(l){var d=b.getErrorForXHRFailure(l,m.signalingSession.signalingAgentConfig);return m.logger.info(\"[\".concat(p,\"][start] error: \").concat((0,h.getPrintableObject)(d))),m.disposed||(m.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADD_MODALITY),m.rejectPendingPromise((0,h.getPrintableObject)(l),d.error)),Promise.reject(null)}))},ContentSharingSession.prototype.delete=function(l,d){var u=this;this.logger.info(\"[\".concat(d,\"][delete]\"));var p=!1;if(this.fsmState===this.FSM_STATES.IDLE)return this.logger.info(\"[\".concat(d,\"][delete] skipped because state is already \").concat(this.fsmState)),l.resolve(),Promise.resolve();if(this.fsmState===this.FSM_STATES.CONTENT_SHARING_START_INITIATED)p=!0,this.rejectPendingPromise(\"Session delete called before start was finished\");else if(!this.checkState(\"delete\",this.FSM_STATES.CONTENT_SHARING_CONNECTED,l))return Promise.reject(null);p||b.assertNotNullOrEmpty(this.links[E.default.LINKS.CONTENT_SHARING_CONTROLLER],\"Correct controller url is not set\"),this.removeSessionPromise=l,this.fsmState=this.FSM_STATES.CONTENT_SHARING_DELETE_INITIATED;var g=T.build(),f=this.addTelemetryOperation(C.NETWORK_REQUESTS.DELETE_CONTENT_SHARING.name,{causeId:d});return(p?Promise.resolve(void 0):this.signalingSession.http.sendDeleteRequest({url:this.links[E.default.LINKS.CONTENT_SHARING_CONTROLLER],requestName:C.NETWORK_REQUESTS.DELETE_CONTENT_SHARING.name,payload:m.getPayload(this.signalingSession,{code:E.default.CALL_END_CODE.SUCCESS,subCode:E.default.CALL_END_SUB_CODE.SUCCESS,phrase:E.default.CALL_END_PHRASE.LOCAL_USER_INITIATED}),causeId:d})).then((function(){if(!u.disposed){var l={success:!0,duration:g.duration()};p&&(l.skipReason=\"Session delete called before start was finished\"),u.updateTelemetryOperation(f,l),u.fsmState=u.FSM_STATES.IDLE,u.resolvePendingPromise()}})).catch((function(l){var p=b.getErrorForXHRFailure(l,u.signalingSession.signalingAgentConfig);if(u.logger.info(\"[\".concat(d,\"][delete] error: \").concat((0,h.getPrintableObject)(p))),!u.disposed){var m={success:!1,duration:g.duration()};u.updateTelemetryOperation(f,m),u.fsmState=u.FSM_STATES.IDLE,u.resolvePendingPromise()}return Promise.reject(null)}))},ContentSharingSession.prototype.join=function(l,d){var u=this;if(this.logger.info(\"[\".concat(d,\"][join]\")),b.assertNotNullOrEmpty(this.links[E.default.LINKS.CONTENT_SHARING_CONTROLLER],\"Correct joinContentSharing url is not provided\"),this.checkState(\"join\",this.FSM_STATES.IDLE,l)){this.lastUpdateSequenceNumber=-1,this.nextClientSequenceNumberToUse=1,this.addSessionPromise=l,this.fsmState=this.FSM_STATES.CONTENT_SHARING_JOIN_INITIATED;var p=T.build(),g=this.addTelemetryOperation(C.NETWORK_REQUESTS.JOIN_CONTENT_SHARING.name,{causeId:d});this.signalingSession.http.sendPostRequest({url:this.links[E.default.LINKS.CONTENT_SHARING_CONTROLLER],payload:f.getPayload(this.signalingSession),requestName:C.NETWORK_REQUESTS.JOIN_CONTENT_SHARING.name,causeId:d}).then((function(l){if(!u.disposed){var d={success:!0,duration:p.duration()};u.updateTelemetryOperation(g,d),u.processStartOrJoinSuccess(l.response),u.resolvePendingPromise(l.response)}})).catch((function(l){var f=b.getErrorForXHRFailure(l,u.signalingSession.signalingAgentConfig);if(u.logger.info(\"[\".concat(d,\"][join] error: \").concat((0,h.getPrintableObject)(f))),!u.disposed){var m={success:!1,duration:p.duration()};u.updateTelemetryOperation(g,m);var v=f.error;u.rejectPendingPromise((0,h.getPrintableObject)(l),v)}}))}},ContentSharingSession.prototype.takeControl=function(l,d){var u=this;if(this.logger.info(\"[\".concat(d,\"][takeControl]\")),b.assertNotNullOrEmpty(this.links[E.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],\"correct contentSharingTakeControl url is not provided\"),this.checkState(\"takeControl\",this.FSM_STATES.CONTENT_SHARING_CONNECTED,l)){var p=T.build(),g=this.addTelemetryOperation(C.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING.name,{causeId:d});this.signalingSession.http.sendPostRequest({url:this.links[E.default.LINKS.CONTENT_SHARING_TAKE_CONTROL],payload:v.getPayload(this.signalingSession),requestName:C.NETWORK_REQUESTS.TAKE_CONTROL_CONTENT_SHARING.name,withoutTrouter:!0,causeId:d}).then((function(d){if(!u.disposed){var h={success:!0,duration:p.duration()};u.updateTelemetryOperation(g,h);var f={contentIdentifier:d.response.identifier,presenter:d.response.presenter.id,subject:d.response.subject||null,sessionState:d.response.sessionState||null};l.resolve(f)}})).catch((function(f){var m=b.getErrorForXHRFailure(f,u.signalingSession.signalingAgentConfig);if(u.logger.info(\"[\".concat(d,\"][takeControl] error: \").concat((0,h.getPrintableObject)(m))),!u.disposed){var v={success:!1,duration:p.duration()};u.updateTelemetryOperation(g,v);var y=new Error((0,h.getPrintableObject)(f));y.endCode=m.error,l.reject(y)}}))}},ContentSharingSession.prototype.updateSessionState=function(l,d,u){var p=this;if(this.logger.info(\"[\".concat(u,\"][updateSessionState]\")),b.assertNotNullOrEmpty(this.links[E.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],\"Correct sendUpdateSessionState url is not provided\"),this.checkState(\"updateSessionState\",this.FSM_STATES.CONTENT_SHARING_CONNECTED,d)){var g=T.build(),f=this.addTelemetryOperation(C.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING.name,{causeId:u});this.signalingSession.http.sendPostRequest({url:this.links[E.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE],payload:_.getPayload(this.signalingSession,l,this.nextClientSequenceNumberToUse++),requestName:C.NETWORK_REQUESTS.UPDATE_SESSION_STATE_CONTENT_SHARING.name,causeId:u}).then((function(){if(!p.disposed){var l={success:!0,duration:g.duration()};p.updateTelemetryOperation(f,l),d.resolve()}})).catch((function(l){var m=b.getErrorForXHRFailure(l,p.signalingSession.signalingAgentConfig);if(p.logger.info(\"[\".concat(u,\"][updateSessionState] error: \").concat((0,h.getPrintableObject)(m))),!p.disposed){var v={success:!1,duration:g.duration()};p.updateTelemetryOperation(f,v);var y=new Error((0,h.getPrintableObject)(l));y.endCode=m.error,d.reject(y)}}))}},ContentSharingSession.prototype.updateParticipantState=function(l,d){var u=this;if(this.logger.info(\"[\".concat(d,\"][updateParticipantState]\")),b.assertNotNullOrEmpty(this.links[E.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],\"correct confirmContentSharingView url is not provided\"),this.checkState(\"updateParticipantState\",this.FSM_STATES.CONTENT_SHARING_CONNECTED,l)){var p=T.build(),g=this.addTelemetryOperation(C.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING.name,{causeId:d});this.signalingSession.http.sendPostRequest({url:this.links[E.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE],payload:S.getPayload(this.signalingSession),requestName:C.NETWORK_REQUESTS.UPDATE_PARTICIPANT_STATE_CONTENT_SHARING.name,withoutTrouter:!0,causeId:d}).then((function(){if(!u.disposed){var d={success:!0,duration:p.duration()};u.updateTelemetryOperation(g,d),l.resolve()}})).catch((function(f){var m=b.getErrorForXHRFailure(f,u.signalingSession.signalingAgentConfig);if(u.logger.info(\"[\".concat(d,\"][updateParticipantState] error: \").concat((0,h.getPrintableObject)(m))),!u.disposed){var v={success:!1,duration:p.duration()};u.updateTelemetryOperation(g,v);var y=new Error((0,h.getPrintableObject)(f));y.endCode=m.error,l.reject(y)}}))}},ContentSharingSession.prototype.updateNotificationLinks=function(l){var d=this;if(this.logger.info(\"[\".concat(l,\"][updateNotificationLinks]\")),b.assertNotNullOrEmpty(this.links[E.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],\"correct notificationLinks url is not provided\"),this.checkState(\"updateState\",this.FSM_STATES.CONTENT_SHARING_CONNECTED)){var u=T.build(),p=this.addTelemetryOperation(C.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS.name,{causeId:l});this.signalingSession.http.sendPostRequest({url:this.links[E.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS],payload:y.getPayload(this.signalingSession),requestName:C.NETWORK_REQUESTS.UPDATE_CONTENT_SHARING_NOTIFICATION_LINKS.name,withoutTrouter:!0,causeId:l}).then((function(){if(!d.disposed){var l={success:!0,duration:u.duration()};d.updateTelemetryOperation(p,l)}})).catch((function(g){var f=b.getErrorForXHRFailure(g,d.signalingSession.signalingAgentConfig);if(d.logger.info(\"[\".concat(l,\"][updateNotificationLinks] error: \").concat((0,h.getPrintableObject)(f))),!d.disposed){var m={success:!1,duration:u.duration()};d.updateTelemetryOperation(p,m)}}))}},ContentSharingSession.prototype.confirmInRoster=function(){this.confirmInRosterPromise&&this.confirmInRosterPromise.isPending&&(this.logger.info(\"Confirmed in roster\"),this.confirmInRosterPromise.resolve())},ContentSharingSession.prototype.handleAddModalitySuccess=function(l,d){var u=this;return this.logger.info(\"[\".concat(d,\"][handleAddModalitySuccess]\")),this.checkState(\"handleAddModalitySuccess\",this.FSM_STATES.CONTENT_SHARING_START_INITIATED)?l.modalitySuccess&&l.modalitySuccess.contentSharing?(this.addTelemetryOperation(C.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{causeId:d}),this.processStartOrJoinSuccess(l.modalitySuccess.contentSharing),this.confirmInRosterPromise.promise.then((function(){delete u.confirmInRosterPromise,u.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADD_MODALITY),u.resolvePendingPromise(l.modalitySuccess.contentSharing)})),!0):(this.addTelemetryOperation(C.EVENTS.HANDLE_ADD_MODALITY_SUCCESS,{causeId:d,skipReason:\"no content sharing blob\"}),this.logger.info(\"[\".concat(d,\"][handleAddModalitySuccess] ignored because modalitySuccess was missing or did not contain content sharing blob\")),!1):(this.logger.info(\"[\".concat(d,\"][handleAddModalitySuccess] ignored because session is not waiting to start\")),!1)},ContentSharingSession.prototype.handleAddModalityFailure=function(l,d){if(this.logger.info(\"[\".concat(d,\"][handleAddModalityFailure]\")),!this.checkState(\"handleAddModalityFailure\",[this.FSM_STATES.CONTENT_SHARING_START_INITIATED,this.FSM_STATES.CONTENT_SHARING_CONNECTED]))return!1;if(!l.modalityFailure||!l.modalityFailure.contentSharing)return this.addTelemetryOperation(C.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{causeId:d,skipReason:\"no content sharing blob\"}),!1;var u=l.modalityFailure.contentSharing;this.addTelemetryOperation(C.EVENTS.HANDLE_ADD_MODALITY_FAILURE,{reason:u,causeId:d});var h=p({},u);return this.sendTelemetryData(h),this.rejectPendingPromise(h.phrase,h),this.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADD_MODALITY),!0},ContentSharingSession.prototype.handleStartFromRoster=function(l,d){this.logger.info(\"[\".concat(d,\"][handleStartFromRoster]\")),this.addTelemetryOperation(C.EVENTS.CONTENT_SHARING_START_FROM_ROSTER,{causeId:d})},ContentSharingSession.prototype.handleStopFromRoster=function(l,d){this.logger.info(\"[\".concat(d,\"][handleStopFromRoster]\")),this.addTelemetryOperation(C.EVENTS.CONTENT_SHARING_END_FROM_ROSTER,{causeId:d}),this.sendTelemetryData(l)},ContentSharingSession.prototype.handleStop=function(l,d){if(this.logger.info(\"[\".concat(d,\"][handleStop]\")),this.isSelfInitiatedAction(l))return this.logger.info(\"[\".concat(d,\"][handleStop]handleStop skipped because session was ended by self\")),!1;var u=p({},l.contentSharingTransactionEnd);return this.addTelemetryOperation(C.EVENTS.HANDLE_CONTENT_SHARING_END,{causeId:d}),this.sendTelemetryData(u),!0},ContentSharingSession.prototype.handleUpdate=function(l,d){return this.logger.info(\"[\".concat(d,\"][handleUpdate]\")),l.sequenceNumber<=this.lastUpdateSequenceNumber?(this.logger.info(\"handleUpdate skipped because of old sequence number: last received \".concat(this.lastUpdateSequenceNumber,\", update contained \").concat(l.sequenceNumber)),this.addTelemetryOperation(C.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{causeId:d,skipReason:\"old sequence number\"}),!1):(this.lastUpdateSequenceNumber=l.sequenceNumber,this.isPresenter=l.presenter.id===this.signalingSession.participantManager.localParticipant.id,this.addTelemetryOperation(C.EVENTS.HANDLE_CONTENT_SHARING_UPDATE,{causeId:d}),!0)},ContentSharingSession.prototype.dispose=function(l,d){this.logger.info(\"[\".concat(d,\"][dispose]\")),this.disposed=!0,this.rejectPendingPromise(\"call ended\",l||{code:E.default.CALL_END_CODE.SUCCESS,subCode:E.default.CALL_END_SUB_CODE.SUCCESS,phrase:E.default.CALL_END_PHRASE.LOCAL_USER_INITIATED}),this.addTelemetryOperation(C.EVENTS.HANDLE_CALL_END,{causeId:d}),this.sendTelemetryData(l)},ContentSharingSession.prototype.rejectPendingPromise=function(l,d){this.logger.info(\"rejectPendingPromise\");var u=new Error(l);d&&(u.endCode=d),this.removeSessionPromise&&(this.removeSessionPromise.reject(u),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.reject(u),this.addSessionPromise=null)},ContentSharingSession.prototype.resolvePendingPromise=function(l){this.logger.info(\"resolvePendingPromise\");var d=null;l&&(d={sessionId:l.sessionId,correlationId:l.contentSharingCorrelationId,contentIdentifier:l.identifier,presenter:l.presenter.id,subject:l.subject||null,sessionState:l.sessionState||null}),this.removeSessionPromise&&(this.removeSessionPromise.resolve(d),this.removeSessionPromise=null),this.addSessionPromise&&(this.addSessionPromise.resolve(d),this.addSessionPromise=null)},ContentSharingSession.prototype.processStartOrJoinSuccess=function(l){this.logger.info(\"processStartOrJoinSuccess\"),this.sessionId=l.sessionId,this.fsmState=this.FSM_STATES.CONTENT_SHARING_CONNECTED,this.lastUpdateSequenceNumber=-1,this.links[E.default.LINKS.CONTENT_SHARING_CONTROLLER]=l.links.contentSharingController,this.links[E.default.LINKS.CONTENT_SHARING_TAKE_CONTROL]=l.links.takeControl,this.links[E.default.LINKS.CONTENT_SHARING_UPDATE_SESSION_STATE]=l.links.updateSessionState,this.links[E.default.LINKS.CONTENT_SHARING_UPDATE_PARTICIPANT_STATE]=l.links.sync,this.links[E.default.LINKS.CONTENT_SHARING_NOTIFICATION_LINKS]=l.links.notificationLinks,this.links[E.default.LINKS.CONTENT_SHARING_LEAVE]=l.links.leave},ContentSharingSession.prototype.checkState=function(l,d,u){if(\"string\"==typeof d?this.fsmState===d:d.indexOf(this.fsmState)>-1)return!0;var p=\"\".concat(l,\" requires state \").concat(d,\", but state is \").concat(this.fsmState);return this.logger.error(p),u&&u.reject(p),!1},ContentSharingSession.prototype.isSelfInitiatedAction=function(l){return l.presenter.participantId===this.signalingSession.participantManager.localParticipant.participantId},ContentSharingSession.prototype.startContentSharingTimer=function(l){var d=this;this.logger.info(\"startContentSharingTimer\"),this.signalingSession.timeoutManager.startTimer(E.default.TIMEOUT_OPERATIONS.ADD_MODALITY,(function(){d.addTelemetryOperation(C.EVENTS.ADD_MODALITY_TIMEOUT,{causeId:l}),d.signalingSession.timeoutManager.stopTimer(E.default.TIMEOUT_OPERATIONS.ADD_MODALITY),d.rejectPendingPromise(\"timed out waiting for ContentSharing to start\",{code:E.default.CALL_END_CODE.TIMEOUT,subCode:E.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:E.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT})}),E.default.TIMEOUT_VALUES_IN_SECONDS.ADD_MODALITY_TIMEOUT)},ContentSharingSession.prototype.addTelemetryOperation=function(l,d){return this.signalingSession.telemetryHelper.addContentSharingOperation(this.correlationId,l,d)},ContentSharingSession.prototype.updateTelemetryOperation=function(l,d){this.signalingSession.telemetryHelper.updateContentSharingOperation(this.correlationId,l,d)},ContentSharingSession.prototype.sendTelemetryData=function(l){this.signalingSession.telemetryHelper.sendContentSharingTelemetryData(this.correlationId,this.signalingSession.sessionId,this.isPresenter,l,this.links[E.default.LINKS.CONTENT_SHARING_CONTROLLER],this.sessionId)},ContentSharingSession}();d.ContentSharingSession=I},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d){return g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"content cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},to:[]},contentSharing:{identifier:d.contentIdentifier,subject:d.subject,sessionState:d.sessionState,sequenceNumber:d.sequenceNumber,links:{sessionUpdate:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_END)}},links:{addModalitySuccess:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_FAILURE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l){return g.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{contentSharing:{links:{sessionUpdate:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_END)}},participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d){return p.assertNotNull(l,\"signalingSession cannot be null\"),p.assertCallEndReason(d),{payload:{contentSharingTransactionEnd:d,participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l){return p.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l){return g.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}},links:{sessionUpdate:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_END)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l){return p.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d,u){return p.assertNotNull(l,\"signalingSession cannot be null\"),p.assertNotNull(d,\"sessionState cannot be null\"),p.assertNotNull(u,\"sequenceNumber cannot be null\"),{payload:{sessionUpdateSequenceNumber:u,sessionState:d,participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}}}}}d.getPayload=getPayload},function(l,d,u){var p,h=this&&this.__assign||function(){return(h=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},g=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},f=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},m=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},v=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.HttpStack=void 0;var y=u(14),S=u(233),_=u(5),C=u(234),E=u(235),T=u(59),b=u(4),I=((p={})[1]=\"POST\",p[0]=\"GET\",p[2]=\"PUT\",p[3]=\"DELETE\",p),A=function(){function HttpStack(l,d){var u=this;this.signalingSession=l,this.callStartTime=d,this.pendingRequests={},this.sendGetRequest=function(l){return u.sendRequest(0,l)},this.sendPostRequest=function(l){return u.sendRequest(1,l)},this.sendPutRequest=function(l){return u.sendRequest(2,l)},this.sendDeleteRequest=function(l){return u.sendRequest(3,l)},this.cancelRequestIfPending=function(l,d,p,h){u.logger.info(\"[\".concat(d,\"][cancelRequestIfPending]\")),u.pendingRequests[l]?p?u.hasPendingRequest(l,p)&&u.cancelRequest(l,p,d,h):Object.keys(u.pendingRequests[l]).forEach((function(p){return u.cancelRequest(l,p,d,h)})):u.logger.info(\"[\".concat(d,\"][cancelRequestIfPending]no pending request with name=\").concat(l))},this.cancelAllRequests=function(l){u.logger.info(\"[\".concat(l,\"][cancelAllRequests]\"));var d=[];return Object.keys(u.pendingRequests).forEach((function(p){Object.keys(u.pendingRequests[p]).forEach((function(h){d.push(u.cancelRequest(p,h,l))}))})),Promise.all(d).catch((function(){}))},this.hasPendingRequest=function(l,d){return!!u.pendingRequests[l]&&Boolean(d?u.pendingRequests[l][d]:u.pendingRequests[l])},this.cancelRequest=function(l,d,p,h){try{return u.pendingRequests[l][d].dispatcher&&u.pendingRequests[l][d].dispatcher.cancelRequest(),u.pendingRequests[l][d].aborted=!0,u.pendingRequests[l][d].errorDetails=h,u.logger.info(\"[\".concat(p,\"][cancelRequest]Request=\").concat(l,\" aborted \").concat(h?\"with errorDetails \".concat(JSON.stringify(h)):\"\")),u.pendingRequests[l][d].requestPromise.catch((function(){}))}catch(h){return u.logger.warn(\"[\".concat(p,\"][cancelRequest]Unable to cancel request=\").concat(l,\", requestId=\").concat(d)),Promise.resolve()}},this.buildRequestTelemetry=function(l,d,p,h){return{name:\"\".concat(I[l],\"-\").concat(d.requestName),url:d.url,eventStart:p-u.callStartTime,trouterReady:-1,requestReady:-1,status:-1,attempts:[],rtt:-1,uid:d.requestId,causeId:d.causeId,requestDispatcherConfig:h,enableRequestHedging:u.shouldEnableRequestHedging(h)}},this.addPendingRequest=function(l){return u.pendingRequests[l.requestName]||(u.pendingRequests[l.requestName]={}),u.pendingRequests[l.requestName][l.requestId]={dispatcher:null,requestPromise:null,aborted:!1},u.pendingRequests[l.requestName][l.requestId]},this.sendRequest=function(l,d){if(!d.url){u.logger.error(d.requestName,\"Link does not exist\");var p={code:_.default.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,subCode:_.default.CALL_END_SUB_CODE.LOCAL_HTTP_STACK_ERROR,phrase:\"Link does not exist for requestName: \".concat(d.requestName,\".\")};return Promise.reject(p)}d.requestId||(d.requestId=b.newGuid()),d.causeId||(d.causeId=b.causeId());var S=u.logger.createChild(\"[\".concat(d.causeId,\"][\").concat(d.requestName,\"]\"));S.info(\"[scheduled]\");var I,A=u.getInternalHttpDispatcherConfig(d.requestName,d.operationType);d.skipHttpTelemetry||(d.skipHttpTelemetry=!1);var R=T.build(),P=(new Date).getTime(),O=[],M=u.buildRequestTelemetry(l,d,P,A),updateRequestTelemetry=function(){u.signalingSession.disposed?u.logger.info(\"Unable to record telemetry, session disposed\"):u.signalingSession.telemetryHelper.updateNetworkRequest(M)},deleteRequestTelemetry=function(){u.signalingSession.telemetryHelper.deleteNetworkRequest(M)};updateRequestTelemetry();var logRequestAttempt=function(l,p){if(l&&l.request){S.info(\"[finished][status=\".concat(l.request.status,\"][statusText=\").concat(l.request.statusText,\"][retryCount=\").concat(l.attempt,\"]\"));var h={status:l.request.status,start:l.attemptStartTimestamp-P,end:l.attemptResponseTimestamp-P,online:b.isTrouterAndNavigatorConnected(u.signalingSession.signalingAgentConfig.trouterServiceProvider)};l.abandoned&&(h.abandoned=!0),l.request.statusText&&(h.statusText=l.request.statusText),(p||-1===M.status)&&(M.status=l.request.status),M.attempts.push(h),updateRequestTelemetry()}else u.logger.warn(d.requestName,\"missing request details, unable to record for telemetry!\")};if(u.hasPendingRequest(d.requestName,d.requestId))return u.logger.warn(d.requestName,d.requestId,\"is already pending request!!\"),u.pendingRequests[d.requestName][d.requestId].requestPromise;I=u.addPendingRequest(d);var recordTelemetryAndCleanup=function(l,p,h,g){if(l&&d.skipHttpTelemetry)return u.logger.info(\"Skipping telemetry\"),void deleteRequestTelemetry();S.info(\"[steps=\".concat(O,\"]\")),u.pendingRequests[d.requestName][d.requestId].aborted&&(M.aborted=!0),u.hasPendingRequest(d.requestName,d.requestId)?(delete u.pendingRequests[p][h],Object.keys(u.pendingRequests[p]).length||delete u.pendingRequests[p]):u.logger.warn(\"Unable to clean up!\"),u.signalingSession.disposed||(g&&(M.error=g),M.rtt=R.duration(),u.signalingSession.telemetryHelper.addNetworkOperationCompleted(d.requestName,l,R.duration()),updateRequestTelemetry())},checkIfNotDisposed=function(l){return function(){for(var p=[],h=0;h<arguments.length;h++)p[h]=arguments[h];if(u.signalingSession.disposed){var g=\"[\".concat(d.causeId,\"][\").concat(d.requestName,\"][failed][reason=Session disposed]\");throw S.info(\"[failed][reason=Session disposed]\"),new Error(g)}if(u.hasPendingRequest(d.requestName,d.requestId)&&u.pendingRequests[d.requestName][d.requestId].aborted){var f=void 0,y=\"[\".concat(d.causeId,\"][\").concat(d.requestName,\"][failed][reason=request already aborted]\"),_=u.pendingRequests[d.requestName][d.requestId].errorDetails;throw _?(f=_).phrase=y:f=y,S.info(\"\".concat(y)),new Error(JSON.stringify(f))}return l.apply(void 0,v([],m(p),!1))}},w=checkIfNotDisposed((function(){return O.push(\"[waitForTrouter]\"),d.withoutTrouter?Promise.resolve():u.signalingSession.ensureMessageChannelReady(d.requestName)})),N=checkIfNotDisposed((function(){return O.push(\"[trouterReady]\"),M.trouterReady=R.duration(),d.onceTrouterReady&&d.onceTrouterReady(),updateRequestTelemetry(),Promise.resolve()})),D=checkIfNotDisposed((function(){var p=b.getTokenMetadata(u.signalingSession.signalingAgentConfig,l,d);return O.push(\"[buildRequest]\"),C.get({signalingSession:u.signalingSession,operation:d.requestName,data:d.payload,customHeaders:d.customHeaders,causeId:d.causeId,tokenRequestOptions:p},u.logger)})),L=checkIfNotDisposed((function(l){O.push(\"[failedToBuildRequestOptions]\");var d={request:{status:_.default.HTTP_STATUS_CODES.OTHER,statusText:\"Local error\"},attempt:1,success:!1,attemptResponseTimestamp:(new Date).getTime(),attemptStartTimestamp:(new Date).getTime()};return l&&l.skypeTokenError&&(d.request={status:_.default.HTTP_STATUS_CODES.SKYPE_TOKEN_ERROR,statusText:\"Failed to fetch skypetoken\"}),logRequestAttempt(d,!1),Promise.reject(l)})),k=checkIfNotDisposed((function(l){return O.push(\"[requestBuilt]\"),M.requestReady=R.duration(),l.usedCachedSkypetoken&&(M.usedCachedSkypetoken=l.usedCachedSkypetoken),updateRequestTelemetry(),Promise.resolve(l)})),authRequiredCallback=function(){O.push(\"[authRequired]\");var p=b.getTokenMetadata(u.signalingSession.signalingAgentConfig,l,d,!0);return C.get({signalingSession:u.signalingSession,operation:d.requestName,data:d.payload,customHeaders:d.customHeaders,causeId:d.causeId,forceFetchToken:!0,tokenRequestOptions:p},u.logger)},x=checkIfNotDisposed((function(p){O.push(\"[sendRequest]\");var g=h(h({},A),{enableRequestHedging:u.shouldEnableRequestHedging(A),hedgeDelayMs:u.signalingSession.signalingAgentConfig.hedgeDelayMs,hedgeMaxParallelAttempts:u.signalingSession.signalingAgentConfig.hedgeMaxParallelAttempts,retryIntervalsMs:d.disableRetry||!A.retryIntervalsMs?[]:A.retryIntervalsMs,reportPreviousErrorsForTimeout:u.signalingSession.signalingAgentConfig.reportPreviousErrorsForTimeout}),f=(0,E.build)({logger:u.logger,causeId:d.causeId,dispatcher:u.signalingSession.signalingAgentConfig.httpRequestDispatcher,url:d.url,request:p,requestType:l,authRequiredCallback:authRequiredCallback,attemptFailureCallback:function(l){logRequestAttempt(l,!1)},settings:g});return I.dispatcher=f,updateRequestTelemetry(),f.sendRequest()})),F=checkIfNotDisposed((function(l){return g(u,void 0,void 0,(function(){return f(this,(function(u){return logRequestAttempt(l,!0),S.info(\"[success]\"),recordTelemetryAndCleanup(!0,d.requestName,d.requestId),[2,l]}))}))})),onFailure=function(l){var u=(0,y.getPrintableObject)(l);return recordTelemetryAndCleanup(!1,d.requestName,d.requestId,u),!l||l.readyState||l.status?S.info(\"[failed][reason=\".concat(u,\"]\")):S.info(\"[failed][offline][reason=\".concat(u,\"]\")),Promise.reject(l)},U=Promise.resolve().then(w).then(N).then(D).catch(L).then(k).then(x).then(F).catch(onFailure);return I.requestPromise=U,U},this.logger=this.signalingSession.logger.createChild(\"[HTTP]\")}return HttpStack.prototype.getInternalHttpDispatcherConfig=function(l,d){void 0===d&&(d=\"Other\");var u=h(h(h({},S.defaultRequestTypeHttpDispatcherConfigMap.Default),S.defaultOperationTypeHttpDispatcherConfigMap[d]),S.defaultRequestTypeHttpDispatcherConfigMap[l]);return this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap&&(u=h(h({},u),this.signalingSession.signalingAgentConfig.operationTypeHttpDispatcherConfigMap[d])),this.signalingSession&&this.signalingSession.signalingAgentConfig&&this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap&&(u=h(h(h({},u),this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap.Default),this.signalingSession.signalingAgentConfig.requestTypeHttpDispatcherConfigMap[l])),this.logger.info(\"getInternalHttpDispatcherConfig request type: \".concat(l,\" config: \").concat((0,y.safeJsonStringify)(u))),u},HttpStack.prototype.shouldEnableRequestHedging=function(l){return!!(this.signalingSession.getMeetingInfo()&&l.requestHedgingCapability.indexOf(\"enabledForMeetings\")>-1)||(!this.signalingSession.multiParty&&l.requestHedgingCapability.indexOf(\"enabledForP2PCalls\")>-1||(!!(this.signalingSession.multiParty&&l.requestHedgingCapability.indexOf(\"enabledForGroupCalls\")>-1)||l.requestHedgingCapability.indexOf(\"enabled\")>-1))},HttpStack}();d.HttpStack=A},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.defaultOperationTypeHttpDispatcherConfigMap=d.defaultRequestTypeHttpDispatcherConfigMap=void 0,d.defaultRequestTypeHttpDispatcherConfigMap={Default:{retryIntervalsMs:[200,1e3,5e3],maxRequestAttempts:4,perRequestTimeoutMs:45e3,perAttemptTimeoutMs:15e3},BrokerSubscribe:{retryIntervalsMs:[100,200,500]}},d.defaultOperationTypeHttpDispatcherConfigMap={CallSetup:{requestHedgingCapability:[\"disabled\"]},Other:{requestHedgingCapability:[\"disabled\"]},BrokerSubscribe:{requestHedgingCapability:[\"disabled\"]}}},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.get=void 0;var h=u(5),g=u(4),f=\"HttpRequestDispatcherFactory\";function get(l,d){var u=l.signalingSession,m=l.operation,v=l.causeId,y=l.data,S=l.customHeaders,_=void 0===S?{}:S,C=l.forceFetchToken,E=l.tokenRequestOptions;if(u.disposed)return Promise.reject(\"Session already disposed\");var handleFailure=function(l){var d=\"string\"==typeof l?new Error(l):l;throw d.skypeTokenError=!0,d},T=!1;return u.signalingAgent.authTokenManager.getToken(v,C,E).catch((function(l){return!C&&isAppOnline(u)&&u.signalingAgentConfig.attemptHttpRequestWithCachedSkypetoken&&u.signalingAgent.authTokenManager.getLastToken(v)?(T=!0,Promise.resolve(u.signalingAgent.authTokenManager.getLastToken(v))):(d&&d.info(\"[\".concat(v,\"] getToken failed with error \").concat(l)),handleFailure(l))})).then((function(l){if(u.disposed)throw new Error(\"skypeToken Getter returned too late. Object is already disposed\");var d={};if(d[h.default.HEADERS.CORRELATION_ID]=u.correlationId,d[h.default.HEADERS.MESSAGE_ID]=g.newMessageId(v),d[h.default.HEADERS.CLIENT_USER_AGENT]=u.signalingAgentConfig.clientInformation,u.signalingAgentConfig.enableCallingTokenAPI){var S=u.signalingAgent.authTokenManager.getLastTokenType(v);switch(S){case 4:d[h.default.HEADERS.AUTHORIZATION]=\"\".concat(h.default.HEADERS.BEARER_KEYWORD,\" \").concat(l);break;case 1:d[h.default.HEADERS.SKYPE_TOKEN]=l;break;default:throw new Error(\"Error in RequestBuilder. TokenType \".concat(S,\" is not supported\"))}}else d[h.default.HEADERS.SKYPE_TOKEN]=l;var C=u.participantManager.localParticipant;C&&(C.ring&&(d[h.default.HEADERS.RING]=C.ring),C.region&&(d[h.default.HEADERS.REGION]=C.region),C.partition&&(d[h.default.HEADERS.PARTITION]=C.partition));var E=y&&y.payload?JSON.stringify(y.payload):null,b={headers:p(p({},d),_),payload:E,usedCachedSkypetoken:T,reporting:{serviceName:m?\"\".concat(f,\"-\").concat(m):f}};return u.telemetryHelper.addNetworkOperationStarted(m),b})).catch(handleFailure)}function isAppOnline(l){var d=g.isTrouterAndNavigatorConnected(l.signalingAgentConfig.trouterServiceProvider);return 3===d||1===d}d.get=get},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.RequestDispatcher=d.build=d.TIMERS=void 0;var f,m=u(14),v=u(5),y=u(111),S=u(4),_=500,C=1e4,E=4,T=3e3,b=3;function build(l){return new I(l.causeId,l.logger,l.dispatcher,l.requestType,l.url,l.request,l.attemptFailureCallback,l.authRequiredCallback,l.settings)}!function(l){l.HEDGE=\"HEDGE\",l.ATTEMPT_TIMEOUT=\"ATTEMPT_TIMEOUT\",l.RETRY=\"RETRY\",l.REQUEST_TIMEOUT=\"REQUEST_TIMEOUT\"}(f=d.TIMERS||(d.TIMERS={})),d.build=build;var I=function(){function RequestDispatcher(l,d,u,h,g,S,I,A,R){var P=this;this.causeId=l,this.logger=d,this.dispatcher=u,this.requestType=h,this.url=g,this.request=S,this.onRequestFailed=I,this.authRequiredCallback=A,this.settings=R,this.requestsSent=0,this.otherAttemptSuccessful=!1,this.pendingAttempts=[],this.hedgeDelayMs=T,this.hedgeMaxParallelAttempts=b,this.stopStandardRetryTimer=function(){P.standardRetryTimer&&(P.standardRetryTimer.stop(),P.standardRetryTimer=null)},this.stopHedgeTimer=function(){P.hedgeTimer&&(P.hedgeTimer.stop(),P.hedgeTimer=null)},this.stopAttemptTimeoutTimer=function(l){try{l.timeoutTimer.stop()}catch(l){P.logger.info(\"attempt time stopped\")}},this.stopRequestTimer=function(){try{P.requestTimer&&P.requestTimer.stop()}catch(l){P.logger.info(\"stopRequestTimer error \".concat(l))}P.logger.info(\"Request timer stopped\"),P.requestTimer=null},this.canScheduleNextAttempt=function(){return P.stackError===v.default.HTTP_STACK_ERROR.REQUEST_ABORTED||P.otherAttemptSuccessful||P.requestsSent>=P.settings.maxRequestAttempts?(P.logger.info(\"canScheduleNextAttempt stack error \".concat(P.stackError)+\" otherAttemptSuccessful \".concat(P.otherAttemptSuccessful)+\" exceeded max attempt \".concat(P.requestsSent>=P.settings.maxRequestAttempts)),!1):P.settings.enableRequestHedging?((l=P.pendingAttempts.length<P.hedgeMaxParallelAttempts)||P.logger.info(\"canScheduleNextAttempt enableRequestHedging attempts sent: \".concat(P.pendingAttempts.length,\" max attempts: \").concat(P.hedgeMaxParallelAttempts)),l):((l=P.requestsSent<P.settings.retryIntervalsMs.length)||P.logger.info(\"canScheduleNextAttempt attempts sent: \".concat(P.requestsSent,\" max attempts: \").concat(P.settings.retryIntervalsMs.length)),l);var l},this.scheduleNextRequest=function(l){P.settings.enableRequestHedging?(P.logger.info(\"scheduleNextRequest with hedging\"),P.hedgeTimer=y.TimerFactory.build((function(){P.attempt(),P.canScheduleNextAttempt()&&P.scheduleNextRequest(!1)}),f.HEDGE).start(P.getNextDelay(l))):(P.logger.info(\"scheduleNextRequest with retry\"),P.standardRetryTimer=y.TimerFactory.build((function(){P.attempt()}),f.RETRY).start(P.getNextDelay(l)))},this.standardizeFailedRequest=function(l,d){var u,h,g,f=P.logger.createChild(\"[standardizeFailedRequest]\");try{if(P.stackError===v.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT)f.info(\"request timed out\"),g=v.REQUEST_DISPATCHER_RESPONSE.REQUEST_TIMEOUT;else if(P.stackError===v.default.HTTP_STACK_ERROR.REQUEST_ABORTED)f.info(\"request aborted\"),g=v.REQUEST_DISPATCHER_RESPONSE.REQUEST_ABORTED;else if(d&&d.status===v.default.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT)f.info(\"request attempt timed out\"),g=v.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_TIMEOUT;else if(d&&[v.default.HTTP_STACK_ERROR.ATTEMPT_ABORTED,v.default.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL].indexOf(d.status)>-1)f.info(\"request attempt aborted\"),g=v.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_ABORTED;else if(l){if(f.info(\"request \".concat((0,m.safeJsonStringify)(l))),\"function\"==typeof XMLHttpRequest&&l instanceof XMLHttpRequest)g=l;else if(\"function\"==typeof XMLHttpRequest&&l&&l.request instanceof XMLHttpRequest){var y=l;g={response:p(p({},null===(u=null==y?void 0:y.request)||void 0===u?void 0:u.response),{headers:null===(h=y.response)||void 0===h?void 0:h.headers}),status:y.request.status,statusText:y.request.statusText,readyState:y.request.readyState}}else l.status||l.statusCode||l.response?g={response:l.response,status:[void 0,null,\"\"].indexOf(l.status)>-1?l.statusCode:l.status,statusText:l.statusText,readyState:l.readyState}:(f.info(\"Local http stack error\"),g={response:v.default.CALL_END_SUB_CODE.LOCAL_HTTP_STACK_ERROR,status:v.default.CALL_END_CODE.LOCAL_HTTP_STACK_ERROR,statusText:\"LocalHTTPStackError\",readyState:l.readyState||0});P.isBrowserOffline()&&0===g.status&&4===g.readyState&&(f.info(\"offline\"),g={response:v.default.HTTP_STACK_ERROR.CANNOT_CONNECT,status:v.default.HTTP_STATUS_CODES.OFFLINE,statusText:\"offline\",readyState:g.readyState}),l.response&&l.response.message&&(l.response.message.operationFailure||l.response.message.broadcastOperationFailure)?g={response:l.response.message}:!l.response&&l.body&&l.body.operationFailure&&(g={response:l.body})}else f.info(\"no response\"),g={response:v.default.HTTP_STACK_ERROR.NONE,status:v.default.HTTP_STATUS_CODES.OTHER,statusText:\"Empty Response\",readyState:0}}catch(l){f.info(\"Failed to handle error \".concat(l)),g={response:\"\",status:v.default.HTTP_STATUS_CODES.OTHER,statusText:\"FailedToHandleError\",readyState:0}}return g},this.hasPendingAttempts=function(){return P.pendingAttempts.some((function(l){return l.pending}))},this.getRequestFromStatus=function(l){return l&&l.request&&l.request.status||0},this.isBrowserOffline=function(){return navigator&&!1===navigator.onLine},this.logger=d.createChild(\"[\".concat(this.causeId,\"][Dispatcher]\")),this.logger.info(\"created request, url=\".concat(g)),!isNaN(this.settings.hedgeDelayMs)&&this.settings.hedgeDelayMs>=_&&this.settings.hedgeDelayMs<=C&&(this.hedgeDelayMs=this.settings.hedgeDelayMs),!isNaN(this.settings.hedgeMaxParallelAttempts)&&this.settings.hedgeMaxParallelAttempts>=0&&this.settings.hedgeMaxParallelAttempts<=E&&(this.hedgeMaxParallelAttempts=this.settings.hedgeMaxParallelAttempts),(isNaN(this.settings.perAttemptTimeoutMs)||this.settings.perAttemptTimeoutMs<=0)&&(this.settings.perAttemptTimeoutMs=15e3),(isNaN(this.settings.perRequestTimeoutMs)||this.settings.perRequestTimeoutMs<=0)&&(this.settings.perRequestTimeoutMs=45e3),(isNaN(this.settings.maxRequestAttempts)||this.settings.maxRequestAttempts<=0)&&(this.settings.maxRequestAttempts=4)}return RequestDispatcher.prototype.sendRequest=function(){var l=this;this.stackError=v.default.HTTP_STACK_ERROR.NONE;var timeoutCallback=function(){l.stackError=v.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT,l.cancelAllAttempts(v.default.HTTP_STACK_ERROR.REQUEST_TIMEOUT)};return this.logger.info(\"send api called\"),this.requestTimer=y.TimerFactory.build(timeoutCallback,f.REQUEST_TIMEOUT).start(this.settings.perRequestTimeoutMs),new Promise((function(d,u){l.resolve=d,l.reject=u,l.scheduleNextRequest(!0)}))},RequestDispatcher.prototype.cancelRequest=function(){this.logger.info(\"cancelRequest\"),this.stackError=v.default.HTTP_STACK_ERROR.REQUEST_ABORTED,this.cancelAllAttempts(v.default.HTTP_STACK_ERROR.ATTEMPT_ABORTED)},RequestDispatcher.prototype.cancelOtherAttempts=function(l){this.pendingAttempts.splice(l-1,1),this.cancelAllAttempts(v.default.HTTP_STACK_ERROR.ABORTED_OTHER_ATTEMPT_SUCCESSFUL)},RequestDispatcher.prototype.cancelAllAttempts=function(l){var d=this;this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.pendingAttempts.forEach((function(u){u.status=l,u.cancelDeferred.resolve(),d.stopAttemptTimeoutTimer(u)})),this.stopRequestTimer()},RequestDispatcher.prototype.getRequestMethod=function(l){switch(l){case 0:return this.dispatcher.getAsync.bind(this.dispatcher);case 1:return this.dispatcher.postAsync.bind(this.dispatcher);case 2:return this.dispatcher.putAsync.bind(this.dispatcher);case 3:return this.dispatcher.removeAsync.bind(this.dispatcher);default:return null}},RequestDispatcher.prototype.queueAttempt=function(l){return h(this,void 0,void 0,(function(){var d,u;return g(this,(function(p){switch(p.label){case 0:if(d=l&&this.isNotRetryable(l),this.logger.info(\"queueAttempt\"),d||!this.canScheduleNextAttempt())return this.logger.info(\"unable to retry isNotRetryable \".concat(d,\" \").concat(JSON.stringify(l))),this.stopHedgeTimer(),this.stopRequestTimer(),this.hasPendingAttempts()||(this.settings.reportPreviousErrorsForTimeout&&l===v.REQUEST_DISPATCHER_RESPONSE.ATTEMPT_TIMEOUT&&this.previousAttempt?this.reject(this.previousAttempt):this.reject(l)),[2];if(!this.isAuthFailedStatus(l))return[3,4];this.logger.info(\"auth failed\"),this.stopHedgeTimer(),this.stopStandardRetryTimer(),this.stopRequestTimer(),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.authRequiredCallback()];case 2:return u=p.sent(),this.request=u,[3,4];case 3:return p.sent(),this.reject(l),[2];case 4:return this.previousAttempt=l,this.hedgeTimer?(this.logger.info(\"scheduleNextRequest ignored as there's already active hedge timer\"),[2]):(this.scheduleNextRequest(!1),[2])}}))}))},RequestDispatcher.prototype.attempt=function(){var l=this;if(this.logger.info(\"attempt to send request\"),this.stackError!==v.default.HTTP_STACK_ERROR.REQUEST_ABORTED&&!this.otherAttemptSuccessful){var d=(new Date).getTime();this.requestsSent++;var u=this.requestsSent,p=S.defer();this.request.timeout=p.promise;var h={cancelDeferred:p,status:v.default.HTTP_STACK_ERROR.NONE,timeoutTimer:null,pending:!0},timeoutRequest=function(){h.status=v.default.HTTP_STACK_ERROR.ATTEMPT_TIMEOUT,h.cancelDeferred.resolve()},g=y.TimerFactory.build(timeoutRequest,f.ATTEMPT_TIMEOUT).start(this.settings.perAttemptTimeoutMs);h.timeoutTimer=g,this.pendingAttempts.push(h),this.getRequestMethod(this.requestType)(this.url,this.request).then((function(p){if(l.logger.info(\"attempt successful, request response=\".concat((0,m.safeJsonStringify)(p),\" status=\").concat(l.getRequestFromStatus(p))),l.otherAttemptSuccessful)throw\"Other attempt succesful\";if(l.stackError===v.default.HTTP_STACK_ERROR.REQUEST_ABORTED)throw\"Session disposed\";if(!p)throw\"Invalid response\";h.pending=!1,l.otherAttemptSuccessful=!0,l.stopRequestTimer(),l.stopHedgeTimer(),l.stopAttemptTimeoutTimer(h),l.cancelOtherAttempts(u),l.resolve({success:!0,request:p.request,response:p.response,attempt:l.requestsSent,attemptStartTimestamp:d,attemptResponseTimestamp:(new Date).getTime()})})).catch((function(u){h.pending=!1,l.stopAttemptTimeoutTimer(h);var p=l.standardizeFailedRequest(u,h);l.logger.info(\"attempt failed, request: \".concat((0,m.safeJsonStringify)(u),\" status=\").concat(p.status)),l.onRequestFailed({abandoned:l.otherAttemptSuccessful,success:!1,request:p,attempt:l.requestsSent,attemptStartTimestamp:d,attemptResponseTimestamp:(new Date).getTime()}),l.queueAttempt(p)}))}},RequestDispatcher.prototype.getNextDelay=function(l){var d;if(l)d=0;else if(this.settings.enableRequestHedging)d=this.hedgeDelayMs;else{if(!(this.requestsSent<=this.settings.retryIntervalsMs.length))throw\"Unable to get next delay\";d=this.settings.retryIntervalsMs[this.requestsSent-1]}return this.logger.info(\"next delay= \".concat(d,\" ms\")),d},RequestDispatcher.prototype.isRequestWithStatus=function(l,d){return!!l&&d.indexOf(l.status)>-1},RequestDispatcher.prototype.isNotRetryable=function(l){return!S.isRetryable(l&&l.status)},RequestDispatcher.prototype.isAuthFailedStatus=function(l){return this.isRequestWithStatus(l,[v.default.HTTP_STATUS_CODES.UNAUTHORIZED])},RequestDispatcher}();d.RequestDispatcher=I},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(14),h=u(237),g=u(238),f=u(239),m=u(25),v=u(5),y=u(4),S=function(){function MediaRenegotiationManager(l,d,u){var g=this;this.telemetryHelper=u,this.vbssInitiated=!1,this.disposed=!1,this.fsmState=v.default.MEDIA_RENEGOTIATION_FSM_STATE.IDLE,this.fsmStateCauseId=\"\",this.links={},this.renegotiationOffersSeenSoFar=[],this.isOutgoingRenegotiationInProgress=function(){return g.fsmState===v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION||g.fsmState===v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.isIncomingRenegotiationInProgress=function(){return g.fsmState===v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION||g.fsmState===v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE},this.acceptRenegotiationAsync=function(l,d,u){g.logger.info(\"[\".concat(u,\"][acceptRenegotiationAsync][mediaTypes=\").concat(d,\"]\")),g.signalingSession.telemetryHelper.recordEvent(m.EVENTS.ACCEPT_RENEGOTIATION,{mediaTypes:d,causeId:u}),y.assertNotNullOrEmpty(g.links[v.default.LINKS.MEDIA_ANSWER],\"MediaAnswer link not set\");var h=y.defer();switch(g.fsmState){case v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,u);break;case v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,u);break;default:return g.logger.info(\"[\".concat(u,\"][acceptRenegotiationAsync]there is no incoming media renegotiation offer to accept\")),h.reject(new Error(\"there is no incoming media renegotiation offer to accept\")),h.promise}var onceTrouterReady=function(){g.signalingSession.timeoutManager.startTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT,g.handleMediaAnswerAcknowledgmentTimeout.bind(g,u),v.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_ACKNOWLEDGEMENT_TIMEOUT)};return g.signalingSession.http.sendPostRequest({url:g.links[v.default.LINKS.MEDIA_ANSWER],payload:f.getPayload(g.signalingSession,l,d),requestName:m.NETWORK_REQUESTS.SEND_MEDIA_ANSWER.name,onceTrouterReady:onceTrouterReady,causeId:u}).then((function(l){h.resolve(l.response)})).catch((function(l){var d=y.getErrorForXHRFailure(l,g.signalingSession.signalingAgentConfig);g.logger.info(\"[\".concat(u,\"][acceptRenegotiationAsync] error: \").concat((0,p.getPrintableObject)(d))),g.disposed||g.signalingSession.timeoutManager.stopTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),h.reject(new Error(\"acceptRenegotiationAsync failed because : \".concat((0,p.getPrintableObject)(l))))})),h.promise},this.startRenegotiationAsync=function(l,d,u,f){g.logger.info(\"[\".concat(f,\"][startRenegotiationAsync][mediaTypes=\").concat(u,\"]\")),g.signalingSession.telemetryHelper.recordEvent(m.EVENTS.START_RENEGOTIATION,{causeId:f,mediaTypes:u}),y.assertNotNullOrEmpty(d,\"MediaRenegotiation link not set\");var S=y.defer();switch(g.fsmState){case v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,f);break;case v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:case v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:case v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return g.logger.info(\"[\".concat(f,\"][startRenegotiationAsync][failed] can only be performed with no current outstanding renegotiations, previous negotiation causeId=\").concat(g.fsmStateCauseId)),g.signalingSessionCallback.onMediaRenegotiationRejection(g.getGlareError(),f),Promise.resolve(null);default:return g.logger.info(\"[\".concat(f,\"][startRenegotiationAsync][failed] can only be performed on an established call\")),S.reject(new Error(\"media renegotiation can only be performed on an established call\")),S.promise}var _=u&&y.arrayContains(u,v.default.MEDIA_TYPES.SCREEN_SHARER);_?(g.vbssInitiated=!0,g.signalingSession.telemetryHelper.addVbssOperations(m.default.VBSS_OPERATION.START)):!_&&g.vbssInitiated&&(g.vbssInitiated=!1,g.signalingSession.telemetryHelper.addVbssOperations(m.default.VBSS_OPERATION.STOP));var onceTrouterReady=function(){g.signalingSession.timeoutManager.startTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER,g.handleMediaAnswerTimeout.bind(g),v.default.TIMEOUT_VALUES_IN_SECONDS.MEDIA_ANSWER_TIMEOUT)};return g.signalingSession.http.sendPostRequest({url:d,payload:h.getPayload(g.signalingSession,l,u),requestName:m.NETWORK_REQUESTS.START_RENEGOTIATION.name,onceTrouterReady:onceTrouterReady,causeId:f}).then((function(l){S.resolve(l.response)})).catch((function(l){var d=y.getErrorForXHRFailure(l,g.signalingSession.signalingAgentConfig);if(g.logger.info(\"[\".concat(f,\"][startRenegotiationAsync] error: \").concat((0,p.getPrintableObject)(d))),!g.disposed){switch(g.fsmState){case v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,f);break;case v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,f)}g.signalingSession.timeoutManager.stopTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER)}S.reject(new Error(\"startRenegotiationAsync failed because : \".concat((0,p.getPrintableObject)(l))))})),S.promise},this.handleMediaAcknowledgment=function(l,d){g.signalingSession.telemetryHelper.recordEvent(m.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT,{causeId:d}),g.signalingSession.timeoutManager.stopTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT),g.signalingSession.saveMediaControllerLinksIfAny(l),g.signalingSession.saveUpdatedCallLinksIfAny(l),g.signalingSessionCallback.onMediaAcknowledgementSuccess(!0,d)},this.onCallConnected=function(l){g.logger.info(\"onCallConnected\"),g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,l)},this.handleMediaNegotiationFailure=function(l){var d=y.extractCauseIdFromMessage(l);g.signalingSession.telemetryHelper.recordIncomingEvent(m.EVENTS.HANDLE_MEDIA_NEGOTIATION_FAILURE,l),g.handleMediaNegotiationFailureInternal(l.body.mediaNegotiationFailure,l.origin,d)},this.handleMediaAnswer=function(l,d){switch(g.logger.info(\"[\".concat(d,\"][handleMediaAnswer]\")),g.signalingSession.telemetryHelper.recordEvent(m.EVENTS.HANDLE_MEDIA_ANSWER,{causeId:d}),g.fsmState){case v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,d);break;case v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,d);break;default:return}g.signalingSession.timeoutManager.stopTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER);var u=[];l.mediaAnswer.callModalities&&l.mediaAnswer.callModalities.length>0&&(u=y.getMediaTypes(l.mediaAnswer.callModalities),g.signalingSession.telemetryHelper.addIncomingModalities(u));var h={provisional:!1,renegotiation:!0,mediaTypes:u,remoteParticipantId:g.signalingSession.getParticipantIdForOfferAnswer(l.mediaAnswer.mediaContent),mediaContent:l.mediaAnswer.mediaContent};g.signalingSession.http.sendPostRequest({url:l.mediaAnswer.links.mediaAcknowledgement,payload:null,requestName:m.NETWORK_REQUESTS.SEND_MEDIA_ACKNOWLEDGEMENT.name,causeId:d}).catch((function(l){var u=y.getErrorForXHRFailure(l,g.signalingSession.signalingAgentConfig);g.logger.info(\"[\".concat(d,\"][handleMediaAnswer] error: \").concat((0,p.getPrintableObject)(u))),g.signalingSession.disposed||g.signalingSession.telemetryHelper.recordEvent(m.EVENTS.HANDLE_MEDIA_ANSWER_FAILED,{causeId:d})})),g.signalingSessionCallback.onAnswer(h,d)},this.handleMediaNegotiationOffer=function(l){var d=l.body,u=l.headers,p=y.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(p,\"][handleMediaNegotiationOffer]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(m.EVENTS.HANDLE_MEDIA_OFFER,l);var h=y.isDuplicateMessage(u,g.renegotiationOffersSeenSoFar);switch(g.fsmState){case v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE,p),g.raiseMediaRenegotiationOffer(d,p);break;case v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,p),g.raiseMediaRenegotiationOffer(d,p);break;case v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:if(g.signalingSession&&g.signalingSession.signalingAgentConfig&&g.signalingSession.signalingAgentConfig.supportMediaRetargetWhileIncomingRenegotiation){g.raiseMediaRenegotiationOffer(d,p);break}g.rejectAndLog(p,h,d);break;default:g.rejectAndLog(p,h,d)}},this.rejectRenegotiationAsync=function(l,d){g.logger.info(\"[\".concat(d,\"][rejectRenegotiationAsync]\")),g.signalingSession.telemetryHelper.recordEvent(m.EVENTS.REJECT_RENEGOTIATION,{rejectionData:l,causeId:d}),y.assertNotNullOrEmpty(g.links[v.default.LINKS.MEDIA_REJECTION],\"MediaRejection link not set\");var u=l||{code:v.default.CALL_END_CODE.NOT_ACCEPTABLE_HERE,subCode:v.default.CALL_END_SUB_CODE.MEDIA_ANSWER_PROCESSING_ERROR,phrase:v.default.CALL_END_PHRASE.MEDIA_ANSWER_ERROR};switch(g.fsmState){case v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION:return g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,d),g.rejectMediaRenegotiation(g.links[v.default.LINKS.MEDIA_REJECTION],u,d);case v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:return g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION,d),g.rejectMediaRenegotiation(g.links[v.default.LINKS.MEDIA_REJECTION],u,d);default:return g.logger.error(\"[\".concat(d,\"][rejectRenegotiationAsync][failed] There is no incoming media renegotiation offer to reject\")),Promise.resolve(null)}},this.handleRetargetCompleted=function(l){var d=l.body.retargetCompleted,u=y.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(u,\"][handleRetargetCompleted][details=\").concat((0,p.getPrintableObject)(d),\"]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(m.EVENTS.HANDLE_RETARGET_COMPLETED,l,(0,p.getPIISafeObject)(d)),0===d.code?g.signalingSessionCallback.onReTargetCompletedSuccess(u):g.signalingSessionCallback.onReTargetCompletedFailure(d,u)},this.dispose=function(){g.logger.info(\"mediaRenegotiationManager :: dispose\"),g.disposed=!0},this.getGlareError=function(){return{code:v.default.CALL_END_CODE.GLARE_ERROR,subCode:v.default.CALL_END_SUB_CODE.MEDIA_GLARE_ERROR,phrase:v.default.CALL_END_PHRASE.RENEGOTIATION_IN_PROGRESS,previousNegotiationCauseId:g.fsmStateCauseId}},this.handleMediaNegotiationFailureInternal=function(l,d,u){switch(g.logger.info(\"[\".concat(u,\"][handleMediaNegotiationFailureInternal][failureData=\").concat((0,p.getPIISafeObject)(l),\"]\")),g.signalingSession.timeoutManager.stopTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),g.fsmState){case v.default.MEDIA_RENEGOTIATION_FSM_STATE.OUTGOING_RENEGOTIATION:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.CALL_CONNECTED,u);break;case v.default.MEDIA_RENEGOTIATION_FSM_STATE.RENEGOTIATION_GLARE:g.setFsmState(v.default.MEDIA_RENEGOTIATION_FSM_STATE.INCOMING_RENEGOTIATION,u);break;default:return}g.vbssInitiated&&(g.vbssInitiated=!1,g.signalingSession.telemetryHelper.addVbssOperations(m.default.VBSS_OPERATION.REJECTED)),g.signalingSession.telemetryHelper.addIncomingModalities([\"Rejected\"]),g.signalingSessionCallback.onMediaRenegotiationRejection({code:l.code,subCode:l.subCode,phrase:l.phrase},u)},this.signalingSession=l,this.signalingSessionCallback=d,this.logger=l.logger.createChild((function(){return\"[RenegotiationManager][\".concat(g.fsmState,\"][stateCauseId=\").concat(g.fsmStateCauseId,\"]\")}))}return MediaRenegotiationManager.prototype.rejectAndLog=function(l,d,u){this.logger.error(\"[\".concat(l,\"][handleMediaNegotiationOffer] Cannot handle the incoming mediaRenegotiation offer in present callstate. Either call not connected or renegotiation in progress. isDuplicateOffer=\").concat(d)),d||this.rejectMediaRenegotiation(u.mediaNegotiation.links.rejection,this.getGlareError(),l)},MediaRenegotiationManager.prototype.setFsmState=function(l,d){this.fsmState=l,this.fsmStateCauseId=d,this.logger.info(\"[setFsmState]state=\".concat(l)),this.telemetryHelper.recordEvent(m.EVENTS.MEDIA_FSM_STATE_CHANGED,{state:l,causeId:d})},MediaRenegotiationManager.prototype.raiseMediaRenegotiationOffer=function(l,d){this.logger.info(\"[\".concat(d,\"][raiseMediaRenegotiationOffer]\")),this.links[v.default.LINKS.MEDIA_ANSWER]=l.mediaNegotiation.links.mediaAnswer,this.links[v.default.LINKS.MEDIA_REJECTION]=l.mediaNegotiation.links.rejection;var u=[];l.mediaNegotiation.callModalities&&l.mediaNegotiation.callModalities.length>0&&(u=y.getMediaTypes(l.mediaNegotiation.callModalities),this.signalingSession.telemetryHelper.addIncomingModalities(u),y.arrayContains(u,v.default.MEDIA_TYPES.SCREEN_SHARER)&&this.signalingSession.telemetryHelper.addVbssOperations(m.default.VBSS_OPERATION.REMOTE_START));var p={mediaTypes:u,remoteParticipantId:this.signalingSession.getParticipantIdForOfferAnswer(l.mediaNegotiation.mediaContent),mediaContent:l.mediaNegotiation.mediaContent,renegotiation:!0};this.signalingSessionCallback.onOffer(p,d)},MediaRenegotiationManager.prototype.rejectMediaRenegotiation=function(l,d,u){var h=this;this.logger.info(\"[\".concat(u,\"][rejectMediaRenegotiation][rejectionData=\").concat((0,p.getPIISafeObject)(d),\"]\"));var f=y.defer();return this.signalingSession.http.sendPostRequest({url:l,payload:g.getPayload(this.signalingSession,d),requestName:m.NETWORK_REQUESTS.SEND_MEDIA_REJECTION.name,causeId:u}).then((function(l){f.resolve(l.response)})).catch((function(l){var d=y.getErrorForXHRFailure(l,h.signalingSession.signalingAgentConfig);h.logger.info(\"[\".concat(u,\"][rejectMediaRenegotiation] error: \").concat((0,p.getPrintableObject)(d))),f.reject(new Error(\"rejectMediaRenegotiation failed because : \".concat((0,p.getPrintableObject)(l))))})),f.promise},MediaRenegotiationManager.prototype.handleMediaAnswerTimeout=function(l){this.logger.info(\"[\".concat(l,\"][handleMediaAnswerTimeout]\")),this.vbssInitiated&&(this.vbssInitiated=!1,this.signalingSession.telemetryHelper.addVbssOperations(m.default.VBSS_OPERATION.TIMEOUT)),this.signalingSession.telemetryHelper.addIncomingModalities([\"Timeout\"]),this.signalingSession.telemetryHelper.recordEvent(m.EVENTS.HANDLE_MEDIA_ANSWER_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER),this.handleMediaNegotiationFailureInternal({code:v.default.CALL_END_CODE.TIMEOUT,subCode:v.default.CALL_END_SUB_CODE.MEDIA_FINAL_ANSWER_TIMEOUT,phrase:v.default.CALL_END_PHRASE.MEDIA_FINAL_ANSWER_TIMEOUT},m.default.EVENT_SOURCE.LOCAL,l)},MediaRenegotiationManager.prototype.handleMediaAnswerAcknowledgmentTimeout=function(l){this.logger.info(\"[\".concat(l,\"][handleMediaAnswerAcknowledgmentTimeout]\")),this.signalingSession.telemetryHelper.recordEvent(m.EVENTS.HANDLE_MEDIA_ACKNOWLEDGEMENT_TIMEOUT),this.signalingSession.timeoutManager.stopTimer(v.default.TIMEOUT_OPERATIONS.MEDIA_ANSWER_ACKNOWLEDGEMENT);var d={reason:\"timed out waiting for Media Answer Acknowledgement\"};this.signalingSessionCallback.onMediaAcknowledgementFailure(!0,d,l)},MediaRenegotiationManager}();d.default=S},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){g.assertNotNull(l,\"signalingSession cannot be null\");var f=[];u&&(f=g.getMediaTypes(u),l.telemetryHelper.addOutgoingModalities(f));var m=g.causeId();return{payload:{mediaNegotiation:{callModalities:f,sender:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},links:{mediaAnswer:h.get(l,p.URL_PATH.MEDIA_ANSWER,m),rejection:h.get(l,p.URL_PATH.MEDIA_REJECTION,m)},mediaContent:d}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d){return p.assertNotNull(l,\"signalingSession cannot be null\"),p.assertCallEndReason(d),{payload:{mediaNegotiationFailure:{sender:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},code:d.code,subCode:d.subCode,phrase:d.phrase},debugContent:{callId:l.correlationId,endpointId:l.participantManager.localParticipant.endpointId}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){g.assertNotNull(l,\"signalingSession cannot be null\");var f=[];return u&&(f=g.getMediaTypes(u),l.telemetryHelper.addOutgoingModalities(f)),{payload:{mediaAnswer:{callModalities:f,sender:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},links:{mediaAcknowledgement:h.get(l,p.URL_PATH.MEDIA_ACKNOWLEDGEMENT)},clientContentForMediaController:l.webRtcSignalingManager.getClientUrls(),mediaContent:d},debugContent:{callId:l.correlationId,endpointId:l.participantManager.localParticipant.endpointId}}}}d.getPayload=getPayload},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(8),f=u(14),m=u(241),v=u(112),y=u(242),S=u(243),_=u(244),C=u(245),E=u(246),T=u(247),b=u(248),I=u(249),A=u(250),R=u(251),P=u(252),O=u(253),M=u(254),w=u(25),N=u(5),D=u(4),L=function(){function ParticipantManager(l,d,u){var g=this;this.connectedRemoteParticipantIds={},this.disposed=!1,this.unmuteApprovalLinks={},this.setLocalParticipantId=function(l,d){l&&(g.logger.info(\"[\".concat(d,\"][setLocalParticipantId][participantId=\").concat(l,\"]\")),g.localParticipant.participantId=l)},this.admitParticipantAsync=function(l,d,u){var p=\"[\".concat(u,\"][admitParticipantAsync]\");g.logger.info(\"\".concat(p).concat(g.piiUtils.scrubMriOrOmit(l.id)));var h=D.defer();return g.participantOperationHandler.hasPendingOperation(1,l.id,u)?(g.logger.info(\"\".concat(p,\"there is an existing pending request to admit the participant \").concat(g.piiUtils.scrubMriOrOmit(l.id))),h.reject(new Error(\"there is an existing pending request to admit the participant\"))):(g.participantOperationHandler.setPendingOperation(1,l.id,{participant:l,promise:h,causeId:u},u),g.sendNetworkRequestForAdmittingParticipant(l,d,u)),h.promise},this.addParticipantsAsync=function(l,d,u,p,h){var f=\"[\".concat(h,\"][addParticipantsAsync]\"),m=l.map((function(l){return g.piiUtils.scrubMriOrOmit(l.id)}));g.logger.info(\"\".concat(f,\" remoteParticipantsIds: \").concat(m));var v=[],y=[];return l.forEach((function(l){var d=D.defer(),u=3===p.replacementType?l.participantId:l.id;g.connectedRemoteParticipantIds.hasOwnProperty(l.id)?(g.logger.info(\"\".concat(f,\"the given participant is already connected to the call \").concat(g.piiUtils.scrubMriOrOmit(l.id))),d.reject(new Error(\"the given participant is already connected to the call\"))):g.participantOperationHandler.hasPendingOperation(0,u,h)?(g.logger.info(\"\".concat(f,\"there is an existing pending request to add the participant \").concat(g.piiUtils.scrubMriOrOmit(l.id))),d.reject(new Error(\"there is an existing pending request to add the participant\"))):(l.participantId||(l.participantId=D.newGuid(),g.logger.info(\"participantId created \".concat(l.participantId))),g.participantOperationHandler.setPendingOperation(0,u,{participant:l,promise:d,causeId:h},h),v.push(l)),y.push(d.promise)})),u&&g.sendNetworkRequestForAddingParticipant(v,d,p,h),y},this.nudgeParticipantsAsync=function(l,d,u,p,h,f,m,v){return g.logger.info(\"[\".concat(p,\"][nudgeParticipantAsync] \").concat(g.piiUtils.scrubParticipantsList(l))),u?g.sendNetworkRequestForNudgingParticipants(l,d,p,h,f,m,v):Promise.reject(\"[\".concat(p,\"][nudgeParticipantAsync] Call not started\"))},this.updateMeetingRolesAsync=function(l,d,u,h){void 0===h&&(h=D.causeId());var m=D.defer();if(!l||l.length<1){var v=\"[\".concat(h,\"][updateMeetingRolesAsync] participantsInfo cannot be empty or null\");(S=new Error(v)).endCode={code:N.default.CALL_END_CODE.REJECT,subCode:N.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:v},g.logger.info(v),m.reject(S)}else if(d)if(u){var y;\"attendee\"===d?y=w.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_ATTENDEE.name:\"presenter\"===d?y=w.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_PRESENTER.name:\"organizer\"===d?y=w.NETWORK_REQUESTS.UPDATE_MEETING_ROLE_ORGANIZER.name:m.reject(new Error(\"[\".concat(h,\"] Invalid meetingRole value(\").concat(d,\")\"))),g.logger.info(\"[\".concat(h,\"][updateMeetingRolesAsync][meetingRole=\").concat(d,\"]\")),g.signalingSession.ensureMessageChannelReady(y).then((function(){g.sendNetworkRequestForUpdatingMeetingRoles(l,d,u,y,h,m)})).catch((function(l){var d=(0,f.getPrintableObject)(l);g.logger.info(\"[\".concat(h,\"][updateMeetingRolesAsync][failed][reason=\").concat(d,\"]\"));var u=D.getErrorForXHRFailure(l,g.signalingSession.signalingAgentConfig),v=p({},u.error);m.reject(v)}))}else{v=\"[\".concat(h,\"][updateMeetingRolesAsync] updateMeetingRoleUrl cannot be empty or null\");(S=new Error(v)).endCode={code:N.default.CALL_END_CODE.REJECT,subCode:N.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:v},g.logger.info(v),m.reject(S)}else{var S,v=\"[\".concat(h,\"][updateMeetingRolesAsync] meetingRole cannot be empty or null\");(S=new Error(v)).endCode={code:N.default.CALL_END_CODE.REJECT,subCode:N.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:v},g.logger.info(v),m.reject(S)}return m.promise},this.updateParticipantInterpretationStateAsync=function(l,d,u){var p=\"[\".concat(u,\"][updateParticipantInterpretationStateAsync]\"),h=l.map((function(l){return g.piiUtils.scrubMriOrOmit(l.id)}));g.logger.info(\"\".concat(p,\" remoteParticipantsIds: \").concat(h));var f=[],m=[];return l.forEach((function(l){var d=D.defer();g.participantOperationHandler.hasPendingOperation(5,l.id,u)?(g.logger.info(\"\".concat(p,\"there is an existing pending request to update the participant \").concat(g.piiUtils.scrubMriOrOmit(l.id))),d.reject(new Error(\"there is an existing pending request to update the participant\"))):(g.participantOperationHandler.setPendingOperation(5,l.id,{option:l,promise:d,causeId:u},u),f.push(l)),m.push(d.promise)})),g.sendNetworkRequestToUpdateParticipantInterpretationState(f,d,l,u),m},this.callMeBackAsync=function(l,d,u){g.logger.info(\"[\".concat(u,\"][callMeBackAsync] \").concat(g.piiUtils.scrubMriOrOmit(l.id)));var p=D.defer();return g.connectedRemoteParticipantIds.hasOwnProperty(l.id)?(g.logger.info(\"the given participant is already connected to the call : \".concat(g.piiUtils.scrubMriOrOmit(l.id))),p.reject(new Error(\"the given participant is already connected to the call\"))):g.participantOperationHandler.hasPendingOperation(2,l.id,u)?(g.logger.info(\"there is an existing pending request to call back the participant : \".concat(g.piiUtils.scrubMriOrOmit(l.id))),p.reject(new Error(\"there is an existing pending request to call back the participant\"))):(g.participantOperationHandler.setPendingOperation(2,l.id,{participant:l,promise:p},u),g.sendNetworkRequestForCallMeBack(l,d,u)),p.promise},this.isRosterStale=function(l,d){return g.rosterManager.isRosterStale(l,d)},this.removeParticipantAsync=function(l,d,u){g.logger.info(\"[\".concat(u,\"][removeParticipantAsync] \").concat(g.piiUtils.scrubMriOrOmit(l.id))),D.assertNotNullOrEmpty(d,\"correct removeParticipantUrl is not provided\");var p=D.defer();if(g.participantOperationHandler.hasPendingOperation(3,l.id,u))g.logger.info(\"there is an existing pending request to remove the participant \".concat(g.piiUtils.scrubMriOrOmit(l.id))),p.reject(new Error(\"there is an existing pending request to remove the participant\"));else{g.participantOperationHandler.setPendingOperation(3,l.id,{participant:l,promise:p},u);var onceTrouterReady=function(){g.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,(function(){g.signalingSession.telemetryHelper.recordEvent(w.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),g.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,l.id),g.participantOperationHandler.rejectPendingOperation(3,l.id,\"timed out waiting for participant to not show up in roster\",{code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:N.default.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},u)}),N.default.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT,l.id)};g.signalingSession.http.sendPostRequest({url:d,payload:A.getPayload(g.signalingSession,l),requestName:w.NETWORK_REQUESTS.REMOVE_PARTICIPANT_NONE.name,onceTrouterReady:onceTrouterReady,causeId:u}).catch((function(d){var p=D.getErrorForXHRFailure(d,g.signalingSession.signalingAgentConfig);g.logger.info(\"[\".concat(u,\"][removeParticipantAsync][failed][reason=\").concat((0,f.getPrintableObject)(p),\"]\")),g.disposed||(g.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,l.id),g.participantOperationHandler.rejectPendingOperation(3,l.id,d,p.error,u))}))}return p.promise},this.removeParticipantEndpointAsync=function(l,d,u,p){g.logger.info(\"[\".concat(p,\"][removeParticipantEndpointAsync] \").concat((0,f.truncate)(l.endpointId,8),\" [endPointScope] \").concat(u)),D.assertNotNullOrEmpty(d,\"correct removeParticipantUrl is not provided\");var h=D.defer(),m=\"\";switch(u){case\"all\":m=w.NETWORK_REQUESTS.REMOVE_PARTICIPANT_OTHERS.name;break;case\"specified\":m=w.NETWORK_REQUESTS.REMOVE_PARTICIPANT_SPECIFIED.name;break;default:return Promise.reject(\"invalid scope \".concat(u,\" removeParticipantEndpointAsync\"))}g.participantOperationHandler.setPendingOperation(4,l.endpointId,{participant:l,promise:h,scope:u},p);var onceTrouterReady=function(){g.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,(function(){g.signalingSession.telemetryHelper.recordEvent(w.EVENTS.REMOVE_PARTICIPANT_TIMEOUT),g.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,l.endpointId),g.participantOperationHandler.rejectPendingOperation(4,l.endpointId,\"timed out waiting for participant endpoint sync response from service\",{code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.CALL_PARTICIPANT_REMOVAL_TIMEOUT,phrase:N.default.CALL_END_PHRASE.PARTICIPANT_REMOVAL_TIMEOUT},p)}),N.default.TIMEOUT_VALUES_IN_SECONDS.REMOVE_PARTICIPANT_TIMEOUT,l.endpointId)};return g.signalingSession.http.sendPostRequest({url:d,payload:I.getPayload(g.signalingSession,l,u),requestName:m,onceTrouterReady:onceTrouterReady,causeId:p}).then((function(l){if(l.response&&l.response.code)if(-1!==[N.default.HTTP_STATUS_CODES.OK,N.default.HTTP_STATUS_CODES.CREATED].indexOf(l.response.code))g.logger.info(\"[\".concat(p,\"][removeParticipantEndpointAsync][endPointScope] \").concat(u,\" [passed][reason=\").concat((0,f.getPrintableObject)(l.response),\"]\")),h.resolve(l.response);else{var d=new Error(\"invalid service response for removeParticipantEndpoint\");d.endCode={code:l.response.code,subCode:l.response.subcode,phrase:l.response.reason},g.logger.info(\"[\".concat(p,\"][removeParticipantEndpointAsync][endPointScope] \").concat(u,\" [failed][reason=\").concat((0,f.getPrintableObject)(l.response),\"]\")),h.reject(d)}h.resolve()})).catch((function(d){var h=D.getErrorForXHRFailure(d,g.signalingSession.signalingAgentConfig);g.logger.info(\"[\".concat(p,\"][removeParticipantEndpointAsync][endPointScope] \").concat(u,\" [failed][reason=\").concat((0,f.getPrintableObject)(h),\"]\")),g.disposed||(g.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,l.endpointId),g.participantOperationHandler.rejectPendingOperation(4,l.endpointId,(0,f.getPrintableObject)(d),h.error,p))})),h.promise},this.getParticipantsToInitiateCallWith=function(){var l,d;g.logger.info(\"getParticipantsToInitiateCallWith\");var u=[],p=g.participantOperationHandler.getAllPendingOperations(0,D.causeId());try{for(var f=h(Object.keys(p)),m=f.next();!m.done;m=f.next()){var v=m.value;p.hasOwnProperty(v)&&p[v]&&u.push(p[v].participant)}}catch(d){l={error:d}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}return u},this.initializeForIncomingCall=function(l){g.logger.info(\"initializeForIncomingCall\"),g.participantOperationHandler.dispose(\"incoming calls cannot add/remove participants until call is connected\",null,D.causeId())},this.handleAddParticipantSuccess=function(l){var d=l.body,u=D.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(u,\"][handleAddParticipantSuccess(\").concat(d.participantInfos?\"new format\":\"old format\",\")]\").concat((0,f.getPrintableObject)(d),\"]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS,l),g.internalHandleCallMeBackSuccess(d,u)||g.signalingSession.telemetryHelper.recordEvent(w.EVENTS.HANDLE_ADD_PARTICIPANT_SUCCESS)},this.handleAddParticipantFailure=function(l){var d=l.body,u=D.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(u,\"][handleAddParticipantFailure(\").concat(d.participantInfos?\"new format\":\"old format\",\")][\").concat((0,f.getPrintableObject)(d),\"]\")),d.modalityFailure?(g.logger.info(\"[\".concat(u,\"][handleAddParticipantFailure][modalityFailure=\").concat((0,f.getPrintableObject)(d),\"]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_ADD_PARTICIPANT_MODALITY_FAILURE,l)):g.internalHandleAddParticipantFailure(l,u)},this.handleAdmitParticipantSuccess=function(l){var d=l.body,u=D.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(u,\"][handleAdmitParticipantSuccess][\").concat((0,f.getPrintableObject)(d),\"]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_ADMIT_PARTICIPANT_SUCCESS,l),d.participants&&g.internalHandleAdmitParticipantSuccess(l,u)},this.handleAdmitParticipantFailure=function(l){var d=l.body,u=D.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(u,\"][handleAdmitParticipantFailure][\").concat((0,f.getPrintableObject)(d),\"]\")),d.participants&&g.internalHandleAdmitParticipantFailure(l,u)},this.handleRemoveParticipantFailure=function(l){var d,u,p=l.body,m=D.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(m,\"][handleRemoveParticipantFailure][\").concat((0,f.getPrintableObject)(p),\"]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_REMOVE_PARTICIPANT_FAILURE,l);try{for(var v=h(Object.keys(p.participants)),y=v.next();!y.done;y=v.next()){var S=y.value;p.participants.hasOwnProperty(S)&&g.internalHandleRemoveParticipantFailure(S,p.participants[S],m)}}catch(l){d={error:l}}finally{try{y&&!y.done&&(u=v.return)&&u.call(v)}finally{if(d)throw d.error}}},this.handleRemoveParticipantSuccess=function(l){var d=l.body,u=D.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(u,\"][handleRemoveParticipantSuccess][\").concat((0,f.getPrintableObject)(d),\"]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_REMOVE_PARTICIPANT_SUCCESS,l)},this.handleUnmuteConfirmRequest=function(l){var d=l.body,u=D.extractCauseIdFromMessage(l);g.logger.info(\"[\".concat(u,\"][handleUnmuteConfirmRequest][\").concat((0,f.getPrintableObject)(d),\"]\")),g.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_UNMUTE_CONFIRM,l),g.unmuteApprovalLinks[d.from.id]={approve:d.links.approveUnmute,reject:d.links.rejectUnmute},g.signalingSessionCallback.onUnmuteRequested(d.from.id,u)},this.approveUnmuteRequestAsync=function(l,d){g.logger.info(\"[\".concat(d,\"][approveUnmuteRequestAsync]\"));var u=D.defer();return g.unmuteApprovalLinks.hasOwnProperty(l)?(g.signalingSession.ensureMessageChannelReady(w.NETWORK_REQUESTS.APPROVE_UNMUTE.name).then((function(){g.muteUnmute(w.NETWORK_REQUESTS.APPROVE_UNMUTE.name,_.getPayload(g.signalingSession),u,g.unmuteApprovalLinks[l].approve,d)})).catch((function(l){var p=(0,f.getPrintableObject)(l);g.logger.info(\"[\".concat(d,\"][approveUnmuteRequestAsync][failed][reason=\").concat(p,\"]\")),u.reject(new Error(l))})),u.promise):(u.reject(new Error(\"no unmute links found for given participant\")),u.promise)},this.rejectUnmuteRequestAsync=function(l,d,u){g.logger.info(\"[\".concat(d,\"][rejectUnmuteRequestAsync]\"));var p=D.defer();if(!g.unmuteApprovalLinks.hasOwnProperty(l))return p.reject(new Error(\"no unmute links found for given participant\")),p.promise;var h=u||{code:N.default.CALL_END_CODE.REJECT,subCode:N.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_REJECTED,phrase:N.default.CALL_END_PHRASE.UNMUTE_REQUEST_REJECTED};return g.signalingSession.ensureMessageChannelReady(w.NETWORK_REQUESTS.REJECT_UNMUTE.name).then((function(){g.muteUnmute(w.NETWORK_REQUESTS.REJECT_UNMUTE.name,b.getPayload(g.signalingSession,h),p,g.unmuteApprovalLinks[l].reject,d)})).catch((function(l){var u=(0,f.getPrintableObject)(l);g.logger.info(\"[\".concat(d,\"][rejectUnmuteRequestAsync][failed][reason=\").concat(u,\"]\")),p.reject(new Error(l))})),p.promise},this.handleRosterUpdate=function(l,d,u){var p=g.getCurrentParticipantsInCallModality(!1);g.rosterManager.handleRosterUpdate(l,p,d,u)},this.updateLocalParticipantFromSubscribe=function(l,d){g.localParticipant.fromRoster||g.rosterManager.updateLocalParticipantFromSubscribe(l,d)},this.muteAsync=function(l,d,u,p){g.logger.info(\"[\".concat(p,\"][muteAsync][muteScope=\").concat(d,\"]\"));var h=\"specified\",m=[],v=w.NETWORK_REQUESTS.MUTE_SPECIFIED;switch(d){case N.default.MUTE_SCOPE.MYSELF:v=w.NETWORK_REQUESTS.MUTE_MYSELF,m.push({id:g.localParticipant.id});break;case N.default.MUTE_SCOPE.EVERYONE_ELSE:v=g.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?w.NETWORK_REQUESTS.MUTE_ALL_SYNC:w.NETWORK_REQUESTS.MUTE_ALL,h=\"all\",u.forEach((function(l){m.push({id:l})}));break;case N.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS:D.assertNotNullOrEmpty(u,\"[\".concat(p,\"]array of participantIds must be specified for SPECIFIED_PARTICIPANTS mute scope\")),v=g.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?w.NETWORK_REQUESTS.MUTE_SPECIFIED_SYNC:w.NETWORK_REQUESTS.MUTE_SPECIFIED,u.forEach((function(l){m.push({id:l})}));break;default:D.assert(!1,\"[\".concat(p,\"]muteScope is a required param. please pass in a valid value.\"))}var y=D.defer();if(d===N.default.MUTE_SCOPE.SPECIFIED_PARTICIPANTS){var S=g.areParticipantsConnectedToCall(u);if(!S.result)return y.reject(new Error(\"[\".concat(p,\"]specified participant is not connected to call yet. Id = \").concat(S.participant))),y.promise}return g.signalingSession.ensureMessageChannelReady(v.name).then((function(){g.muteUnmute(v.name,C.getPayload(g.signalingSession,h,m),y,l,p)})).catch((function(l){var d=(0,f.getPrintableObject)(l),u=D.getErrorForXHRFailure(l,g.signalingSession.signalingAgentConfig);g.logger.info(\"[\".concat(p,\"][muteAsync][failed][reason=\").concat(d,\"]\")),y.reject(u)})),y.promise},this.unmuteAsync=function(l,d){g.logger.info(\"[\".concat(d,\"][unmuteAsync]\"));var u=D.defer();return g.signalingSession.ensureMessageChannelReady(w.NETWORK_REQUESTS.UNMUTE.name).then((function(){g.muteUnmute(g.signalingSession.isHandleUnmuteMuteFromResponseEnabled()?w.NETWORK_REQUESTS.UNMUTE_SYNC.name:w.NETWORK_REQUESTS.UNMUTE.name,R.getPayload(g.signalingSession),u,l,d,!0)})).catch((function(l){var p=(0,f.getPrintableObject)(l);g.logger.info(\"[\".concat(d,\"][unmuteAsync][failed][reason=\").concat(p,\"]\")),u.reject(new Error(l))})),u.promise},this.dispose=function(l,d){g.logger.info(\"[\".concat(d,\"][dispose]\")),g.disposed=!0,g.participantOperationHandler.dispose(\"call ended\",l,d),g.signalingSession.telemetryHelper.setParticipantId(g.localParticipant.participantId)},this.internalHandleCallMeBackSuccess=function(l,d){var u,p,f,m,v=!1;if(l&&l.participantInfos){var y=l.participantInfos;try{for(var S=h(y),_=S.next();!_.done;_=S.next()){var C=_.value.id;g.internalHandleCallMeBackSuccessHelper(C,d)&&(v=!0)}}catch(l){u={error:l}}finally{try{_&&!_.done&&(p=S.return)&&p.call(S)}finally{if(u)throw u.error}}}else if(l&&l.participants)try{for(var E=h(l.participants),T=E.next();!T.done;T=E.next()){C=T.value;g.internalHandleCallMeBackSuccessHelper(C,d)&&(v=!0)}}catch(l){f={error:l}}finally{try{T&&!T.done&&(m=E.return)&&m.call(E)}finally{if(f)throw f.error}}return v},this.signalingSession=l,this.signalingSessionCallback=d,this.localParticipant=u,this.localParticipant.endpointId||(this.localParticipant.endpointId=this.signalingSession.getEndpointId());var v=(0,f.truncate)(this.localParticipant.endpointId,8);this.logger=l.logger.createChild((function(){return\"[PM][\".concat(v,\"]\")})),this.piiUtils=l.piiUtils,this.participantOperationHandler=new m.default(l.logger.createChild((function(){return\"[ParticipantOperationHandler][\".concat(v,\"]\")}))),this.rosterManager=new M.default(this,l.logger.createChild((function(){return\"[RosterManager][\".concat(v,\"]\")}))),this.localParticipant.participantId||(this.localParticipant.participantId=D.newGuid()),\"string\"==typeof l.signalingAgentConfig.languageCode?this.localParticipant.languageId=l.signalingAgentConfig.languageCode:\"function\"==typeof l.signalingAgentConfig.languageCode&&(this.localParticipant.languageId=l.signalingAgentConfig.languageCode()),l.telemetryHelper.setEndPointId(this.localParticipant.endpointId)}return ParticipantManager.prototype.handleUpdateParticipantInterpretationStateCompletion=function(l){var d,u,p=l.body,g=D.extractCauseIdFromMessage(l),m=p.operationId;if(this.disposed)this.logger.info(\"[\".concat(g,\"][handleUpdateParticipantInterpretationStateCompletion] ignored. Call disposed.\"));else{m||this.logger.warn(\"[\".concat(g,\"][handleUpdateParticipantInterpretationStateCompletion] operationId is undefined.\")),this.logger.info(\"[\".concat(g,\"][handleUpdateParticipantInterpretationStateCompletion] starts\"));var v=l.body;if(v.participantInfos)try{for(var y=h(v.participantInfos),S=y.next();!S.done;S=y.next()){var _=S.value;if(this.logger.info(_),this.participantOperationHandler.hasPendingOperation(5,_.participant.id,g))if(this.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,_.participant.id),_.transactionEnd.code===N.default.TRANSACTION_END_CODE.SUCCESS)this.logger.info(\"[\".concat(g,\"]Update participant interpretation state succeeded for: \").concat(this.piiUtils.scrubMriOrOmit(_.participant.id))),this.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_COMPLETED,l),this.participantOperationHandler.resolvePendingOperation(5,_.participant.id,void 0,g);else{var C=_.transactionEnd.reason;this.logger.info(\"[\".concat(g,\"]Update participant interpretation state failed for: \").concat(this.piiUtils.scrubMriOrOmit(_.participant.id),\" reason : \").concat((0,f.getPrintableObject)(C)));var E=this.getCallEndGivenParticipantFailure(C);this.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_RESPONSE_FAILED,l,E),this.participantOperationHandler.rejectPendingOperation(5,_.participant.id,E.phrase,E,g)}}}catch(l){d={error:l}}finally{try{S&&!S.done&&(u=y.return)&&u.call(y)}finally{if(d)throw d.error}}}},ParticipantManager.prototype.areParticipantsConnectedToCall=function(l){var d,u;this.logger.info(\"areParticipantsConnectedToCall : \".concat((0,f.getPrintableObject)(l)));var p=this.getCurrentParticipantsInCallModality(!0);try{for(var g=h(l),m=g.next();!m.done;m=g.next()){var v=m.value;if(!p.hasOwnProperty(v))return this.logger.info(\"areParticipantsConnectedToCall : returning false for :\".concat(this.piiUtils.scrubMriOrOmit(v))),{result:!1,participant:v}}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=g.return)&&u.call(g)}finally{if(d)throw d.error}}return this.logger.info(\"areParticipantsConnectedToCall : returning true\"),{result:!0}},ParticipantManager.prototype.processUnmuteInfo=function(l){var d=this;if(void 0!==l&&void 0!==l.muteUnmuteResponse){var u=l.muteUnmuteResponse[this.localParticipant.id];if(void 0!==u){var p=g.find(u,(function(l){return l.participantId===d.localParticipant.participantId}));void 0!==p&&(\"success\"===p.reason?this.signalingSession.telemetryHelper.recordEvent(w.EVENTS.HANDLE_UNMUTE_SUCCESS,p.serverMuteVersion):this.signalingSession.telemetryHelper.recordEvent(w.EVENTS.HANDLE_UNMUTE_FAILURE,p.serverMuteVersion))}}},ParticipantManager.prototype.muteUnmute=function(l,d,u,p,h,g){var m=this;D.assert(2!==this.signalingSession.callMode,\"mute/unmute operations are not allowed in streaming mode\"),this.logger.info(\"[muteUnmute][\".concat(h,\"][operation=\").concat(l,\"]\")),p?(g&&this.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.UNMUTE,(function(){m.signalingSession.telemetryHelper.recordEvent(w.EVENTS.UNMUTE_TIMEOUT),m.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.UNMUTE);var l=new Error(\"timed out waiting for response to request\");l.endCode={code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.UNMUTE_REQUEST_TIMEOUT,phrase:N.default.CALL_END_PHRASE.UNMUTE_REQUEST_TIMEOUT},u.reject(l)}),N.default.TIMEOUT_VALUES_IN_SECONDS.UNMUTE_TIMEOUT),this.signalingSession.http.sendPostRequest({url:p,payload:d,requestName:l,withoutTrouter:!0,causeId:h}).then((function(d){m.disposed||(l===w.NETWORK_REQUESTS.UNMUTE.name&&d.response&&m.processUnmuteInfo(d.response),m.signalingSession.isHandleUnmuteMuteFromResponseEnabled()&&(l===w.NETWORK_REQUESTS.UNMUTE_SYNC.name&&d.response&&u.resolve(d.response),l!==w.NETWORK_REQUESTS.MUTE_ALL_SYNC.name&&l!==w.NETWORK_REQUESTS.MUTE_SPECIFIED_SYNC.name||!d.response||u.resolve(d.response)),u.resolve())})).catch((function(l){var d=D.getErrorForXHRFailure(l,m.signalingSession.signalingAgentConfig);m.logger.info(\"[\".concat(h,\"][muteUnmute][failed][reason=\").concat((0,f.getPrintableObject)(d),\"]\")),m.disposed||(g&&m.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.UNMUTE),u.reject(d.error))}))):u.reject(new Error(\"[\".concat(h,\"][muteUnmute] cannot be performed now, the link is not yet available\")))},ParticipantManager.prototype.sendNetworkRequestForUpdatingMeetingRoles=function(l,d,u,p,h,g){var m=this;if(!u){var v=\"[\".concat(h,\"][sendNetworkRequestForUpdatingMeetingRoles] failed because correct updateMeetingRoleUrl is not provided\");(y=new Error(v)).endCode={code:N.default.CALL_END_CODE.REJECT,subCode:N.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:v},this.logger.info(v),g.reject()}if(!l){var y;v=\"[\".concat(h,\"][sendNetworkRequestForUpdatingMeetingRoles] failed because participants list is empty or null\");(y=new Error(v)).endCode={code:N.default.CALL_END_CODE.REJECT,subCode:N.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_REJECTED,phrase:v},this.logger.info(v),g.reject(y)}var onceTrouterReady=function(){m.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE,(function(){m.signalingSession.telemetryHelper.recordEvent(w.EVENTS.UPDATE_MEETING_ROLE,{causeId:h}),m.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE);var l=new Error(\"[\".concat(h,\"] Timed out waiting for response to request\"));l.endCode={code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.UPDATE_MEETING_ROLE_TIMEOUT,phrase:N.default.CALL_END_PHRASE.UPDATE_MEETING_ROLE_TIMEOUT},g.reject(l)}),N.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_MEETING_ROLE_TIMEOUT)};this.signalingSession.http.sendPostRequest({url:u,payload:P.getPayload(this.signalingSession,l,\"specified\",d),requestName:p,onceTrouterReady:onceTrouterReady,causeId:h}).then((function(l){g.resolve(l.response)})).catch((function(l){var d=(0,f.getPrintableObject)(l);m.logger.info(\"[\".concat(h,\"][sendNetworkRequestForUpdatingMeetingRoles] failed: \").concat(d));var u=new Error(\"[\".concat(h,\"][CS response] Forbidden request\")),p=D.getErrorForXHRFailure(l,m.signalingSession.signalingAgentConfig);u.code=p.error.code,u.subCode=p.error.subCode,u.phrase=p.error.phrase,m.disposed||(m.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.UPDATE_MEETING_ROLE),g.reject(u))}))},ParticipantManager.prototype.sendNetworkRequestForNudgingParticipants=function(l,d,u,p,h,g,m){var v=this;if(d){var onceTrouterReady=function(){v.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,(function(){v.signalingSession.telemetryHelper.recordEvent(w.EVENTS.NUDGE_PARTICIPANT_TIMEOUT),v.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,l?l.join():\"\")}),N.default.TIMEOUT_VALUES_IN_SECONDS.NUDGE_PARTICIPANT_TIMEOUT,l?l.join():\"\")},y=g||h?E.getPayload(this.signalingSession,l,h,g,m,p):T.getPayload(this.signalingSession,l,p);return this.signalingSession.http.sendPostRequest({url:d,payload:y,requestName:w.NETWORK_REQUESTS.NUDGE_PARTICIPANT.name,onceTrouterReady:onceTrouterReady,causeId:u}).then((function(){})).catch((function(d){var p=D.getErrorForXHRFailure(d,v.signalingSession.signalingAgentConfig);return v.logger.info(\"[\".concat(u,\"][sendNetworkRequestForNudgingParticipant][failed][reason=\").concat((0,f.getPrintableObject)(p),\"]\")),v.disposed||v.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.NUDGE_PARTICIPANT,l?l.join():\"\"),Promise.reject(p.error)}))}return this.logger.info(\"[\".concat(u,\"][sendNetworkRequestForNudgingParticipant] failed because correct nudgeParticipantUrl is not provided\")),Promise.reject(\"Missing nudgeParticipant url\")},ParticipantManager.prototype.sendNetworkRequestForAddingParticipant=function(l,d,u,p){var h=this;if(void 0===p&&(p=D.causeId()),d){var g=w.NETWORK_REQUESTS.ADD_PARTICIPANT.name,m=w.EVENTS.ADD_PARTICIPANT_TIMEOUT,S={};switch(u.replacementType){case 2:g=w.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_PICKUP_CODE.name,m=w.EVENTS.ADD_PARTICIPANT_WITH_PICKUP_CODE_TIMEOUT,S.unparkContent={pickupCode:u.pickupCode};break;case 1:g=w.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_REPLACES.name,m=w.EVENTS.ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT,S=this.signalingSession.getCallReplacementDetailsForCall(u.callIdToReplace,p);break;case 3:g=w.NETWORK_REQUESTS.ADD_PARTICIPANT_WITH_REPLACES.name,m=w.EVENTS.ADD_PARTICIPANT_WITH_REPLACES_TIMEOUT,S=this.signalingSession.getReplacementDetailsByParticipantLegOfCall(u.callIdToReplace,l[0].id,l[0].replacementParticipantId,p);break;default:g=w.NETWORK_REQUESTS.ADD_PARTICIPANT.name,m=w.EVENTS.ADD_PARTICIPANT_TIMEOUT,S=null}var onceTrouterReady=function(){l.forEach((function(l){var d=3===u.replacementType?l.participantId:l.id;h.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,(function(){h.signalingSession.telemetryHelper.recordEvent(m,{causeId:p}),h.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,d),h.participantOperationHandler.rejectPendingOperation(0,d,\"timed out waiting for participant to show up in roster\",{code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:N.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},p)}),N.default.TIMEOUT_VALUES_IN_SECONDS.ADD_PARTICIPANT_TIMEOUT,d)}))},_=u.threadId||u.groupId?v.getPayload(this.signalingSession,l,u,S):y.getPayload(this.signalingSession,l,u,S);this.signalingSession.http.sendPostRequest({url:d,payload:_,requestName:g,onceTrouterReady:onceTrouterReady,causeId:p}).catch((function(d){var g=D.getErrorForXHRFailure(d,h.signalingSession.signalingAgentConfig);h.logger.info(\"[\".concat(p,\"][sendNetworkRequestForAddingParticipant] failed:\").concat((0,f.getPrintableObject)(d))),h.disposed||l.forEach((function(l){var f=3===u.replacementType?l.participantId:l.id;h.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,f),h.participantOperationHandler.rejectPendingOperation(0,f,d,g.error,p)}))}))}else this.logger.info(\"[\".concat(p,\"][sendNetworkRequestForAddingParticipants] failed because correct addParticipantUrl is not provided\")),l.forEach((function(l){var d=3===u.replacementType?l.participantId:l.id;h.participantOperationHandler.rejectPendingOperation(0,d,\"correct addParticipantUrl is not provided\",{code:N.default.CALL_END_CODE.LOCAL_ERROR,subCode:N.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:N.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},p)}))},ParticipantManager.prototype.sendNetworkRequestToUpdateParticipantInterpretationState=function(l,d,u,p){var h=this;if(void 0===p&&(p=D.causeId()),d){var g=w.NETWORK_REQUESTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE.name,m=w.EVENTS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT,onceTrouterReady=function(){var d={code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT,phrase:N.default.CALL_END_PHRASE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_TIMEOUT};l.forEach((function(l){h.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,(function(){h.logger.info(\"[\".concat(p,\"][sendNetworkRequestToUpdateParticipantInterpretationState] timed out\")),h.signalingSession.telemetryHelper.recordEvent(m,{causeId:p}),h.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,l.id),h.participantOperationHandler.rejectPendingOperation(5,l.id,\"timed out waiting to update particiant interpretation state\",d,p)}),N.default.TIMEOUT_VALUES_IN_SECONDS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION_TIMEOUT,l.id)}))},v=O.getUpdateParticipantInterpretationStatePayload(this.signalingSession,u,p);this.signalingSession.http.sendPostRequest({url:d,payload:v,requestName:g,onceTrouterReady:onceTrouterReady,causeId:p}).catch((function(d){var u=D.getErrorForXHRFailure(d,h.signalingSession.signalingAgentConfig);h.logger.info(\"[\".concat(p,\"][sendNetworkRequestToUpdateParticipantInterpretationState] failed:\").concat((0,f.getPrintableObject)(d))),h.disposed||l.forEach((function(l){h.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.UPDATE_PARTICIPANT_INTERPRETATION_STATE_COMPLETION,l.id),h.participantOperationHandler.rejectPendingOperation(5,l.id,d,u.error,p)}))}))}else{this.logger.info(\"[\".concat(p,\"][sendNetworkRequestToUpdateParticipantInterpretationState] failed because correct updateParticipantUrl is not provided\"));var y={code:N.default.CALL_END_CODE.LOCAL_ERROR,subCode:N.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:N.default.CALL_END_PHRASE.UPDATE_PARTICIPANT_INTERPRETATION_STATE_URL_MISSING};l.forEach((function(l){h.participantOperationHandler.rejectPendingOperation(5,l.id,\"correct updateParticipantUrl is not provided\",y,p)}))}},ParticipantManager.prototype.sendNetworkRequestForCallMeBack=function(l,d,u){var p=this;if(d){var onceTrouterReady=function(){p.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,(function(){p.signalingSession.telemetryHelper.recordEvent(w.EVENTS.CALL_ME_BACK_TIMEOUT,{causeId:u}),p.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,l.id),p.participantOperationHandler.rejectPendingOperation(2,l.id,\"timed out waiting for call me back success response\",{code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:N.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},u)}),N.default.TIMEOUT_VALUES_IN_SECONDS.CALL_ME_BACK_TIMEOUT,l.id)},h={groupId:this.signalingSession.groupId,threadId:this.signalingSession.threadId,messageId:this.signalingSession.teamsMessageId};this.signalingSession.http.sendPostRequest({url:d,payload:v.getPayload(this.signalingSession,[l],h),requestName:w.NETWORK_REQUESTS.CALL_ME_BACK.name,onceTrouterReady:onceTrouterReady,causeId:u}).catch((function(d){var h=D.getErrorForXHRFailure(d,p.signalingSession.signalingAgentConfig);p.logger.info(\"[\".concat(u,\"][sendNetworkRequestForCallMeBack] failed: \").concat((0,f.getPrintableObject)(h))),p.disposed||(p.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,l.id),p.participantOperationHandler.rejectPendingOperation(2,l.id,d,h.error,u))}))}else this.logger.info(\"[\".concat(u,\"][sendNetworkRequestForCallMeBack] failed because correct addParticipantUrl is not provided\")),this.participantOperationHandler.rejectPendingOperation(2,l.id,\"correct addParticipantUrl is not provided\",{code:N.default.CALL_END_CODE.LOCAL_ERROR,subCode:N.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:N.default.CALL_END_PHRASE.ADD_PARTICIPANT_URL_MISSING},u)},ParticipantManager.prototype.sendNetworkRequestForAdmittingParticipant=function(l,d,u){var p=this;if(d){var onceTrouterReady=function(){p.signalingSession.timeoutManager.startTimer(N.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,(function(){p.signalingSession.telemetryHelper.recordEvent(w.EVENTS.ADMIT_PARTICIPANT_TIMEOUT),p.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,l.id),p.participantOperationHandler.rejectPendingOperation(1,l.id,\"timed out waiting for participant to show up in roster\",{code:N.default.CALL_END_CODE.TIMEOUT,subCode:N.default.CALL_END_SUB_CODE.CALL_ESTABLISHMENT_TIMEOUT,phrase:N.default.CALL_END_PHRASE.ESTABLISHMENT_TIMEOUT},u)}),N.default.TIMEOUT_VALUES_IN_SECONDS.ADMIT_PARTICIPANT_TIMEOUT,l.id)};this.signalingSession.http.sendPostRequest({url:d,payload:S.getPayload(this.signalingSession,l,u),requestName:w.NETWORK_REQUESTS.ADMIT_PARTICIPANT.name,onceTrouterReady:onceTrouterReady,causeId:u}).catch((function(d){var h=D.getErrorForXHRFailure(d,p.signalingSession.signalingAgentConfig);p.logger.info(\"[\".concat(u,\"][sendNetworkRequestForAdmittingParticipant][failed][reason=\").concat((0,f.getPrintableObject)(h),\"]\")),p.disposed||(p.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,l.id),p.participantOperationHandler.rejectPendingOperation(1,l.id,d,h.error,u))}))}else this.logger.info(\"[\".concat(u,\"][sendNetworkRequestForAdmittingParticipant] failed because correct admitParticipantUrl is not provided\")),this.participantOperationHandler.rejectPendingOperation(1,l.id,\"correct admitParticipantUrl is not provided\",{code:N.default.CALL_END_CODE.LOCAL_ERROR,subCode:N.default.CALL_END_SUB_CODE.CALL_NOT_ATTEMPTED,phrase:N.default.CALL_END_PHRASE.ADMIT_PARTICIPANT_URL_MISSING},u)},ParticipantManager.prototype.getCurrentParticipantsInCallModality=function(l){var d={},u=[N.default.PARTICIPANT_AUDIO_STATE.CONNECTED];return l||u.push(N.default.PARTICIPANT_AUDIO_STATE.CONNECTING,N.default.PARTICIPANT_AUDIO_STATE.RINGING),this.signalingSessionCallback.getRemoteParticipantCollection().forEach((function(l){u.some((function(d){return d===l.audioState}))&&(d[l.mri]=!0)})),d},ParticipantManager.prototype.internalHandleRemoveParticipantFailure=function(l,d,u){if(this.participantOperationHandler.hasPendingOperation(3,l,u)){this.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,l),this.logger.info(\"[\".concat(u,\"][internalHandleRemoveParticipantFailure] failed for \").concat(this.piiUtils.scrubMriOrOmit(l),\" reason \").concat((0,f.getPrintableObject)(d)));var p=this.getCallEndGivenParticipantFailure(d);this.participantOperationHandler.rejectPendingOperation(3,l,p.phrase,p,u)}},ParticipantManager.prototype.internalHandleCallMeBackSuccessHelper=function(l,d){if(this.participantOperationHandler.hasPendingOperation(2,l,d)){var u={id:l};return this.logger.info(\"participant : \".concat(this.piiUtils.scrubMriOrOmit(l),\" was successfully added. Resolving CallMeBack request\")),this.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,l),this.participantOperationHandler.resolvePendingOperation(2,u.id,u,d),!0}return!1},ParticipantManager.prototype.internalHandleAddParticipantFailure=function(l,d){var u,p,g=this;void 0===d&&(d=D.causeId());var f=l.body;if(f.participantInfos)f.participantInfos.forEach((function(u){var p=[u.participant.participantId],h=g.participantOperationHandler.getRnlMri(p,d)||u.participant.id;g.rejectAddParticipantFailure(h,u.transactionEnd,l,d)}));else if(f.participants)try{for(var m=h(Object.keys(f.participants)),v=m.next();!v.done;v=m.next()){var y=v.value;this.rejectAddParticipantFailure(y,f.participants[y],l,d)}}catch(l){u={error:l}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(u)throw u.error}}},ParticipantManager.prototype.rejectAddParticipantFailure=function(l,d,u,p){var h=this.getCallEndGivenParticipantFailure(d);this.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_ADD_PARTICIPANT_FAILURE,u,h),this.participantOperationHandler.hasPendingOperation(0,l,p)?(this.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,l),this.logger.info(\"participantAdd failed for : \".concat(this.piiUtils.scrubMriOrOmit(l),\" reason : \").concat((0,f.getPrintableObject)(d))),this.participantOperationHandler.rejectPendingOperation(0,l,h.phrase,h,p)):this.participantOperationHandler.hasPendingOperation(2,l,p)&&(this.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.CALL_ME_BACK,l),this.logger.info(\"callMeBack failed for : \".concat(this.piiUtils.scrubMriOrOmit(l),\" reason : \").concat((0,f.getPrintableObject)(d))),this.participantOperationHandler.rejectPendingOperation(2,l,h.phrase,h,p))},ParticipantManager.prototype.internalHandleAdmitParticipantSuccess=function(l,d){var u,p,g=l.body;try{for(var f=h(g.participants),m=f.next();!m.done;m=f.next()){var v=m.value;this.participantOperationHandler.hasPendingOperation(1,v,d)&&(this.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,v),this.logger.info(\"Admit participant success for : \".concat(this.piiUtils.scrubMriOrOmit(v))),this.participantOperationHandler.resolvePendingOperation(1,v,void 0,d))}}catch(l){u={error:l}}finally{try{m&&!m.done&&(p=f.return)&&p.call(f)}finally{if(u)throw u.error}}},ParticipantManager.prototype.internalHandleAdmitParticipantFailure=function(l,d){var u,p,g=l.body;try{for(var m=h(Object.keys(g.participants)),v=m.next();!v.done;v=m.next()){var y=v.value;if(this.participantOperationHandler.hasPendingOperation(1,y,d)){this.signalingSession.timeoutManager.stopTimer(N.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,y);var S=g.participants[y];this.logger.info(\"Admit participant failed for : \".concat(this.piiUtils.scrubMriOrOmit(y),\" reason : \").concat((0,f.getPrintableObject)(S)));var _=this.getCallEndGivenParticipantFailure(S);this.signalingSession.telemetryHelper.recordIncomingEvent(w.EVENTS.HANDLE_ADMIT_PARTICIPANT_FAILURE,l,_),this.participantOperationHandler.rejectPendingOperation(1,y,_.phrase,_,d)}}}catch(l){u={error:l}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(u)throw u.error}}},ParticipantManager.prototype.getCallEndGivenParticipantFailure=function(l){var d={code:l.code,subCode:l.subCode,phrase:l.phrase,resultCategories:l.resultCategories};return l.code===N.default.CALL_END_CODE.CALL_MODALITY_FAILURE&&l.callControllerTransactionEnd?d=p({},l.callControllerTransactionEnd):l.code===N.default.CALL_END_CODE.ATC_CONTROLLER_FAILURE&&l.atcControllerTransactionEnd?d=p({},l.atcControllerTransactionEnd):l.code===N.default.CALL_END_CODE.CVA_CONTROLLER_FAILURE&&l.cvaControllerTransactionEnd&&(d=p({},l.cvaControllerTransactionEnd)),d},ParticipantManager}();d.default=L},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(17),g=u(5),f=function(){function ParticipantOperations(){this.requests={}}return ParticipantOperations.prototype.clear=function(l,d){var u=this,p=d||{code:g.default.CALL_END_CODE.SUCCESS,subCode:g.default.CALL_END_SUB_CODE.SUCCESS,phrase:g.default.CALL_END_PHRASE.LOCAL_USER_INITIATED};Object.keys(this.requests).forEach((function(d){u.rejectOperation(d,l,p)}))},ParticipantOperations.prototype.hasOperation=function(l){return this.requests.hasOwnProperty(l)},ParticipantOperations.prototype.getAllOperations=function(){return this.requests},ParticipantOperations.prototype.getOperation=function(l){return this.hasOperation(l)?this.requests[l]:null},ParticipantOperations.prototype.setOperation=function(l,d){return!this.hasOperation(l)&&(this.requests[l]=d,!0)},ParticipantOperations.prototype.rejectOperation=function(l,d,u){var p=new Error(d);if(u&&(p.endCode=u),this.hasOperation(l)){var h=this.requests[l].promise;delete this.requests[l],h.reject(p)}},ParticipantOperations.prototype.resolveOperation=function(l,d){if(this.hasOperation(l)){var u=this.requests[l].promise;delete this.requests[l],u.resolve(d)}},ParticipantOperations}(),m=function(){function ParticipantOperationHandler(l){this.logger=l,this.localAddParticipantRequests=new f,this.localAdmitParticipantRequests=new f,this.localCallMeBackRequests=new f,this.localRemoveParticipantEndpointRequests=new f,this.localRemoveParticipantRequests=new f,this.localUpdateParticipantInterpretationStateRequest=new f,this.participantIdMriMap=new Map}return ParticipantOperationHandler.prototype.dispose=function(l,d,u){this.logger.info(\"[\".concat(u,\"][dispose]\")),this.rejectAllPendingOperations(l,d)},ParticipantOperationHandler.prototype.getAllPendingOperations=function(l,d){this.logger.info(\"[\".concat(d,\"][getAllPendingOperations] \").concat(l));var u=this.getOperationTable(l);return u?u.getAllOperations():null},ParticipantOperationHandler.prototype.getPendingOperation=function(l,d,u){this.logger.info(\"[\".concat(u,\"][getPendingOperation] \").concat(l,\" \").concat(d));var p=this.getOperationTable(l);return p?p.getOperation(d):null},ParticipantOperationHandler.prototype.getRnlMri=function(l,d){var u,h;this.logger.info(\"[\".concat(d,\"][getRnlMri] \").concat(l));try{for(var g=p(l),f=g.next();!f.done;f=g.next()){var m=f.value;if(this.participantIdMriMap.has(m))return this.participantIdMriMap.get(m)}}catch(l){u={error:l}}finally{try{f&&!f.done&&(h=g.return)&&h.call(g)}finally{if(u)throw u.error}}return\"\"},ParticipantOperationHandler.prototype.hasPendingOperation=function(l,d,u){this.logger.info(\"[\".concat(u,\"][hasPendingOperation] \").concat(l,\" \").concat((0,h.scrubMriOrOmit)(d)));var p=this.getOperationTable(l);return!!p&&p.hasOperation(d)},ParticipantOperationHandler.prototype.rejectPendingOperation=function(l,d,u,p,g){this.logger.info(\"[\".concat(g,\"][rejectPendingOperation] \").concat(l,\" \").concat((0,h.scrubMriOrOmit)(d),\" reason: \").concat(u));var f=this.getOperationTable(l);f&&f.rejectOperation(d,u,p)},ParticipantOperationHandler.prototype.resolvePendingOperation=function(l,d,u,p){this.logger.info(\"[\".concat(p,\"][resolvePendingOperation]: \").concat((0,h.scrubMriOrOmit)(d)));var g=this.getOperationTable(l);g&&g.resolveOperation(d,u)},ParticipantOperationHandler.prototype.setPendingOperation=function(l,d,u,p){this.logger.info(\"[\".concat(p,\"][setPendingOperation] \").concat(l,\" \").concat((0,h.scrubMriOrOmit)(d),\" value: \").concat(u));var g=this.getOperationTable(l);if(!g)return!1;if(0===l){var f=u&&u.participant&&u.participant.participantId;f&&this.participantIdMriMap.set(f,d)}return g.setOperation(d,u)},ParticipantOperationHandler.prototype.getOperationTable=function(l){switch(l){case 0:return this.localAddParticipantRequests;case 1:return this.localAdmitParticipantRequests;case 2:return this.localCallMeBackRequests;case 4:return this.localRemoveParticipantEndpointRequests;case 3:return this.localRemoveParticipantRequests;case 5:return this.localUpdateParticipantInterpretationStateRequest;default:return null}},ParticipantOperationHandler.prototype.rejectAllPendingOperations=function(l,d){this.logger.info(\"rejectLocalQueuedOperations\"),this.localAddParticipantRequests.clear(l,d),this.localAdmitParticipantRequests.clear(l,d),this.localCallMeBackRequests.clear(l,d),this.localRemoveParticipantRequests.clear(l,d),this.localRemoveParticipantEndpointRequests.clear(l,d),this.localUpdateParticipantInterpretationStateRequest.clear(l,d)},ParticipantOperationHandler}();d.default=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u,f){g.assertNotNull(l,\"signalingSession cannot be null\");var m=d.map((function(l){return g.assertNotNull(l,\"remoteParticipant cannot be null\"),{id:l.id,assertedId:l.assertedId,displayName:l.displayName,participantId:l.participantId}}));return{payload:{disableUnmute:u&&u.disableUnmute,participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId,alternateId:u?u.alternateId:null},to:m},participantInvitationData:u.additionalData,replacementDetails:f,links:{addParticipantSuccess:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){return g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"remoteParticipant cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},to:[{id:d.id,displayName:d.displayName}]},links:{admitFailure:h.get(l,p.URL_PATH.CONV_ADMIT_PARTICIPANT_FAILURE),admitSuccess:h.get(l,p.URL_PATH.CONV_ADMIT_PARTICIPANT_SUCCESS)},debugContent:{causeId:u}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l){return p.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},mediaTypes:[\"audio\"]}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d,u){return p.assertNotNull(l,\"signalingSession cannot be null\"),p.assertNotNull(d,\"muteScope be null\"),p.assertNotNull(u,\"participantList cannot be null\"),{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},scope:d,muteParticipants:u,mediaTypes:[\"audio\"]}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u,f,m,v){g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"participantsIds cannot be null\");var y=l.groupId?{id:l.groupId}:null,S=f?{threadId:f,messageId:m||null}:null,_=[];return d.forEach((function(l){var d={id:l};_.push(d)})),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},invitationType:p.default.INVITATION_TYPE.NUDGE,to:_},participantInvitationData:v,groupContext:y,groupChat:S,links:{nudgeParticipantSuccess:h.get(l,p.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:h.get(l,p.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"participantsIds cannot be null\");var f=[];return d.forEach((function(l){var d={id:l};f.push(d)})),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},invitationType:p.default.INVITATION_TYPE.NUDGE,to:f},participantInvitationData:u,links:{nudgeParticipantSuccess:h.get(l,p.URL_PATH.CONV_NUDGE_PARTICIPANT_SUCCESS),nudgeParticipantFailure:h.get(l,p.URL_PATH.CONV_NUDGE_PARTICIPANT_FAILURE),addParticipantSuccess:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d){return p.assertNotNull(l,\"signalingSession cannot be null\"),p.assertCallEndReason(d),{payload:{transactionEnd:d}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){return g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"remoteParticipant cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},scope:u,toEndpoints:[{id:d.id,endpointId:d.endpointId}]},links:{removeParticipantSuccess:h.get(l,p.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:h.get(l,p.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d){return g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"remoteParticipant cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},to:[{id:d.id,displayName:d.displayName}]},links:{removeParticipantSuccess:h.get(l,p.URL_PATH.CONV_REMOVE_PARTICIPANT_SUCCESS),removeParticipantFailure:h.get(l,p.URL_PATH.CONV_REMOVE_PARTICIPANT_FAILURE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l){return p.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},mediaTypes:[\"audio\"]}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d,u,h){void 0===h&&(h=\"\"),p.assertNotNull(u&&\"specified\"===u,\"Only non-null non-empty scope of 'specified' is supported.\"),p.assertNotNull(l,\"signalingSession cannot be null\"),p.assertNotNull(d,\"participantsIds cannot be null\");var g=[];return d.forEach((function(l){var d={id:l,meetingRole:h};g.push(d)})),{payload:{from:{id:l.participantManager.localParticipant.id,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},scope:u,to:g}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getUpdateParticipantInterpretationStatePayload=void 0;var p=u(5),h=u(10),g=u(4);function getUpdateParticipantInterpretationStatePayload(l,d,u){return g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"options cannot be null\"),{payload:{from:{id:l.participantManager.localParticipant.id},to:d,links:{updateParticipantInterpretationStateStatus:h.get(l,p.URL_PATH.UPDATE_PARTICIPANT_INTERPRETATION_STATE_STATUS)},operationId:u}}}d.getUpdateParticipantInterpretationStatePayload=getUpdateParticipantInterpretationStatePayload},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(8),g=u(46),f=u(17),m=u(74),v=u(25),y=u(5),S=u(4),_=function(){function RosterManager(l,d){var u=this;this.participantManager=l,this.logger=d,this.handleRosterUpdate=function(l,d,h,g){var f,y;if(\"Delta\"===l.type||\"MultiPartyEndpoint\"===l.type){if(void 0===l.sequenceNumber&&(l.sequenceNumber=u.lastRosterUpdateSeqNumber),u.logger.info(\"[\".concat(g,\"][handleRosterUpdate][sequenceNumber=\").concat(l.sequenceNumber,\"]\")),u.rostersInLifetime.add(l.sequenceNumber),\"Delta\"===l.type)u.logger.info(\"[\".concat(g,\"][handleRosterUpdate], RosterType: Delta, isFullRoster: \").concat(h)),u.handleDeltaRoster(l,h,d,g);else{if(u.logger.info(\"[\".concat(g,\"][handleRosterUpdate], RosterType: MultiPartyEndpoint\")),u.isRosterStale(l,g))return u.participantManager.signalingSession.telemetryHelper.recordEvent(v.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:u.lastRosterUpdateSeqNumber,sequenceNumber:l.sequenceNumber,causeId:g}),void u.logger.info(\"[\".concat(g,\"][handleRosterUpdate] Ignoring old roster update: received \").concat(l.sequenceNumber,\", but already handled \").concat(u.lastRosterUpdateSeqNumber));try{for(var S=p(Object.keys(l.participants)),_=S.next();!_.done;_=S.next()){var C=_.value,E=m.default.fromRoster(l.participants[C]);u.handleRosterParticipant(E,d,g)}}catch(l){f={error:l}}finally{try{_&&!_.done&&(y=S.return)&&y.call(S)}finally{if(f)throw f.error}}u.checkForRemovedParticipants(d,l.participants,g),u.participantManager.signalingSessionCallback.onParticipantCountsUpdated(l.participantCounts,g)}l.sequenceNumber>u.lastRosterUpdateSeqNumber&&(u.lastRosterUpdateSeqNumber=l.sequenceNumber,u.firstRosterUpdateSeqNumber<0&&(u.firstRosterUpdateSeqNumber=u.lastRosterUpdateSeqNumber),u.participantCountInFirstRoster<0&&(u.participantCountInFirstRoster=l.participants.length),u.maxConcurrentParticipantsDuringLeg=Math.max(u.maxConcurrentParticipantsDuringLeg,l.participants.length)),u.recordTelemetry(l,h,g),u.participantManager.signalingSessionCallback.onRosterHandlingComplete()}else u.logger.warn(\"[\".concat(g,\"][handleRosterUpdate][sequenceNumber=\").concat(l.sequenceNumber,\"] invalid roster type \").concat(l.type))},this.isRosterStale=function(l,d){return u.logger.info(\"[\".concat(d,\"][isRosterStale] \").concat(l.sequenceNumber<u.lastRosterUpdateSeqNumber)),l.sequenceNumber<u.lastRosterUpdateSeqNumber},this.updateLocalParticipantFromSubscribe=function(l,d){u.logger.info(\"[\".concat(d,\"][updateLocalParticipantFromSubscribe]\")),u.updateLocalParticipant(l,d)},this.lastRosterUpdateSeqNumber=-1,this.firstRosterUpdateSeqNumber=-1,this.tombstoneSequence=new Map,this.latestRosterVersionForActiveParticipants=new Map,this.rostersInLifetime=new Set,this.maxConcurrentParticipantsDuringLeg=-1,this.participantCountInFirstRoster=-1}return RosterManager.prototype.recordTelemetry=function(l,d,u){var p={participantCountInLastRoster:l.participants.length,participantCountInFirstRoster:this.participantCountInFirstRoster,sequenceNumberOfLastRoster:this.lastRosterUpdateSeqNumber,sequenceNumberOfFirstRoster:this.firstRosterUpdateSeqNumber,rosterType:l.type,isFullRoster:d,maxConcurrentParticipantsDuringLeg:this.maxConcurrentParticipantsDuringLeg,totalParticipantsDuringLifetimeOfLeg:this.tombstoneSequence.size+this.latestRosterVersionForActiveParticipants.size,countOfMissingNotifications:this.getMissingNotificiations()};this.logger.info(\"[recordTelemetry] data \".concat(JSON.stringify(p,null,4))),this.participantManager.signalingSession.telemetryHelper.recordRosterEvent(p,v.EVENTS.HANDLE_ROSTER_UPDATE,u)},RosterManager.prototype.getMissingNotificiations=function(){var l=this.lastRosterUpdateSeqNumber-this.firstRosterUpdateSeqNumber+1-this.rostersInLifetime.size;return l>0?l:0},RosterManager.prototype.isParticipantRosterStale=function(l,d){if(this.logger.info(\"[isParticipantRosterStale], rosterParticipantVersion \".concat(d)),d){if(this.tombstoneSequence.has(l))return d<=this.tombstoneSequence.get(l);if(this.latestRosterVersionForActiveParticipants.has(l))return d<=this.latestRosterVersionForActiveParticipants.get(l)}return!1},RosterManager.prototype.handleDeltaRoster=function(l,d,u,h){var g,f,y,S;if(this.logger.info(\"[\".concat(h,\"][handleDeltaRoster] isFullRoster \").concat(d)),d){if(this.isRosterStale(l,h))return this.participantManager.signalingSession.telemetryHelper.recordEvent(v.EVENTS.IGNORE_OLD_ROSTER,{lastRosterUpdateSeqNumber:this.lastRosterUpdateSeqNumber,sequenceNumber:l.sequenceNumber,causeId:h}),void this.logger.info(\"[\".concat(h,\"][handleRosterUpdate] Ignoring old roster update: received \").concat(l.sequenceNumber,\", but already handled \").concat(this.lastRosterUpdateSeqNumber));try{for(var _=p(Object.keys(u)),C=_.next();!C.done;C=_.next()){var E=C.value;if(!l.participants.hasOwnProperty(E)){var T=new m.default({id:E});this.logger.info(\"[\".concat(h,\"][handleRosterUpdate] participant missing from delta, full roster\")),this.handleRemovedDeltaRosterParticipant(T,l.sequenceNumber,u,h)}}}catch(l){g={error:l}}finally{try{C&&!C.done&&(f=_.return)&&f.call(_)}finally{if(g)throw g.error}}}else if(!l||!l.participants)return void this.logger.warn(\"[\".concat(h,\"][handleRosterUpdate] participants blob empty in delta roster\"));try{for(var b=p(Object.keys(l.participants)),I=b.next();!I.done;I=b.next()){var A=I.value,R=l.participants[A];if(!this.isParticipantRosterStale(A,R.version)){T=m.default.fromRoster(R);R.state&&\"active\"===R.state?(this.logger.info(\"[\".concat(h,\"][handleDeltaRoster] participant active\")),this.handleRosterParticipant(T,u,h),this.tombstoneSequence.has(A)&&this.tombstoneSequence.delete(A),this.latestRosterVersionForActiveParticipants.set(A,R.version)):R.state&&\"inactive\"===R.state?(T=T||new m.default({id:R.details.id}),this.logger.info(\"[\".concat(h,\"][handleDeltaRoster] participant inactive\")),this.handleRemovedDeltaRosterParticipant(T,R.version,u,h)):this.logger.info(\"[\".concat(h,\"][handleDeltaRoster] unexpected participant state \").concat(R.state))}}}catch(l){y={error:l}}finally{try{I&&!I.done&&(S=b.return)&&S.call(b)}finally{if(y)throw y.error}}this.handleRemoveParticipantRequests(this.getActiveParticipants(l.participants),h),this.participantManager.signalingSessionCallback.onParticipantCountsUpdated(l.participantCounts,h)},RosterManager.prototype.getRnlMri=function(l,d){var u=this.participantManager.participantOperationHandler;if(l){var p=this.getRnlParticipantIdsFromRoster(l,d);return u.getRnlMri(p,d)}return\"\"},RosterManager.prototype.handleRemovedDeltaRosterParticipant=function(l,d,u,p){var h=l.id,g=this.getRnlMri(l,p),f=\"\";u.hasOwnProperty(h)?f=h:u.hasOwnProperty(g)&&(f=g),f&&this.handleRemovedParticipant(u,f,p),this.tombstoneSequence.set(h,d),this.latestRosterVersionForActiveParticipants.has(h)&&this.latestRosterVersionForActiveParticipants.delete(h)},RosterManager.prototype.handleRemovedParticipant=function(l,d,u){var p=this.participantManager.signalingSessionCallback,h=this.participantManager.signalingSession;!1!==l[d]&&(S.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,d),this.logger.info(\"[\".concat(u,\"][handleRemovedParticipant] \").concat(f.scrubMriOrOmit(d),\" removed from roster\")),p.onParticipantRemoved({id:d},u),h.clearParticipantCallLinks(d))},RosterManager.prototype.getActiveParticipants=function(l){var d,u,h={};try{for(var g=p(Object.keys(l)),f=g.next();!f.done;f=g.next()){var m=f.value;\"inactive\"!==l[m].state&&(h[m]=l[m])}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=g.return)&&u.call(g)}finally{if(d)throw d.error}}return h},RosterManager.prototype.handleRosterParticipant=function(l,d,u){var h,g;if(l)if(l.id!==this.participantManager.localParticipant.id){var m=this.participantManager.participantOperationHandler,v=this.participantManager.signalingSession,_=this.participantManager.signalingSessionCallback,C=l.id,E=this.getRnlMri(l,u);v.signalingAgentConfig.overrideDisplayName&&v.remoteCaller&&l.participantId===v.remoteCaller.participantId&&(l.displayName=v.remoteCaller.displayName),S.tryAddNewKeyToHashTable(this.participantManager.connectedRemoteParticipantIds,l.id,!0);var T=d.hasOwnProperty(l.id),b=d.hasOwnProperty(E);(T||b)&&(d[l.id]=!1),m.hasPendingOperation(0,l.id,u)&&this.isParticipantInCall(l)?(this.logger.info(\"participant \".concat(f.scrubMriOrOmit(l.id),\" appears in roster. Resolving AddParticipant request\")),v.timeoutManager.stopTimer(y.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,l.id),m.resolvePendingOperation(0,l.id,l,u)):E&&m.hasPendingOperation(0,E,u)&&this.isParticipantInCall(l)?(this.logger.info(\"RNL participant \".concat(f.scrubMriOrOmit(E),\" appears in roster. Resolving AddParticipant request\")),v.timeoutManager.stopTimer(y.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,E),m.resolvePendingOperation(0,E,l,u)):m.hasPendingOperation(1,l.id,u)&&this.isParticipantInCall(l)&&(this.logger.info(\"participant: \".concat(f.scrubMriOrOmit(l.id),\" appears in roster. Resolving AdmitParticipant request\")),v.timeoutManager.stopTimer(y.default.TIMEOUT_OPERATIONS.ADMIT_PARTICIPANT,l.id),m.resolvePendingOperation(1,l.id,l,u));try{for(var I=p(l.endpointDetails),A=I.next();!A.done;A=I.next()){var R=A.value;m.hasPendingOperation(0,R.participantId,u)&&this.isParticipantInCall(l)&&(this.logger.info(\"participant \".concat(f.scrubMriOrOmit(l.id),\" appears in roster. Resolving AddParticipant request\")),v.timeoutManager.stopTimer(y.default.TIMEOUT_OPERATIONS.ADD_PARTICIPANT,R.participantId),m.resolvePendingOperation(0,R.participantId,l,u))}}catch(l){h={error:l}}finally{try{A&&!A.done&&(g=I.return)&&g.call(I)}finally{if(h)throw h.error}}T?(this.logger.info(\"participantId=\".concat(l.participantId,\" updated \").concat(f.scrubMriOrOmit(l.id))),_.onParticipantUpdated(l,u),v.setParticipantCallLinks(l)):b?(this.logger.info(\"RNL participant participantId=\".concat(l.participantId,\" removed old \").concat(f.scrubMriOrOmit(E),\" and added new \").concat(f.scrubMriOrOmit(C))),_.onParticipantRemoved({id:E},u,!0),v.clearParticipantCallLinks(E),_.onParticipantJoined(l,u),v.setParticipantCallLinks(l)):m.hasPendingOperation(3,l.id,u)?this.logger.info(\"participantId=\".concat(l.participantId,\" ignored \").concat(f.scrubMriOrOmit(l.id))):(this.logger.info(\"participantId=\".concat(l.participantId,\" joined \").concat(f.scrubMriOrOmit(l.id))),_.onParticipantJoined(l,u),v.setParticipantCallLinks(l))}else{this.updateLocalParticipant(l,u);var P=this.getLocalEndpoint();(null==P?void 0:P.stream)||(null==P?void 0:P.streamLobby)?this.participantManager.signalingSession.configureStreamingMode(u):this.participantManager.signalingSession.setCallMode(1,u)}else this.logger.info(\"[handleRosterParticipant] [\".concat(u,\"] rosterParticipant processing skipped because null.\"))},RosterManager.prototype.getLocalEndpoint=function(){var l=this;return h.find(this.participantManager.localParticipant.endpointDetails,(function(d){return l.participantManager.localParticipant.endpointId===d.endpointId}))},RosterManager.prototype.getRnlParticipantIdsFromRoster=function(l,d){var u,h,g=[];try{for(var f=p(l.endpointDetails),m=f.next();!m.done;m=f.next()){var v=m.value;g.push(v.participantId)}}catch(l){u={error:l}}finally{try{m&&!m.done&&(h=f.return)&&h.call(f)}finally{if(u)throw u.error}}return this.logger.info(\"[\".concat(d,\"][getRnlParticipantIdsFromRoster] \").concat(JSON.stringify(g))),g},RosterManager.prototype.isParticipantInCall=function(l){return l.endpointDetails&&l.endpointDetails[0]&&!l.endpointDetails[0].isLobby},RosterManager.prototype.updateLocalParticipant=function(l,d){var u=this.participantManager.localParticipant,p=this.participantManager.signalingSession,f=this.participantManager.signalingSessionCallback;this.logger.info(\"[\".concat(d,\"][updateLocalParticipant]\"));var m=!1;if(l&&l.endpointDetails){var y=h.find(l.endpointDetails,(function(l){return u.endpointId===l.endpointId})),S=h.find(u.endpointDetails,(function(l){return u.endpointId===l.endpointId}));m=(0,g.hasStagingGroup)(y),!y||!y.isLobby||S&&S.isLobby?!y||y.isLobby||S&&!S.isLobby||(m?p.telemetryHelper.recordEvent(v.EVENTS.STAGING,{causeId:d}):p.telemetryHelper.recordEvent(v.EVENTS.CONNECTED,{causeId:d})):p.telemetryHelper.recordEvent(v.EVENTS.IN_LOBBY,{causeId:d}),f.onMeetingGroupDetailsUpdated(y&&y.meetingGroupDetails,d)}l&&(u.endpointDetails=l.endpointDetails||[],u.acceptedBy=l.acceptedBy,u.role=l.role,u.meetingRole=l.meetingRole,u.advancedMeetingRole=l.advancedMeetingRole,u.tenantId=l.tenantId,u.isLobby=l.isLobby,u.publishedStates=l.publishedStates,u.isStaging=m,this.participantManager.localParticipant.fromRoster=!0,f.onSelfParticipantUpdated(u,d))},RosterManager.prototype.checkForRemovedParticipants=function(l,d,u){var h,g,m=this.participantManager.signalingSessionCallback,v=this.participantManager.signalingSession,y=this.participantManager.participantOperationHandler;this.logger.info(\"[\".concat(u,\"][checkForRemovedParticipants]\"));try{for(var _=p(Object.keys(l)),C=_.next();!C.done;C=_.next()){var E=C.value;l.hasOwnProperty(E)&&!1!==l[E]&&!y.hasPendingOperation(0,E,u)&&(S.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,E),this.logger.info(\"[\".concat(u,\"][checkForRemovedParticipants] \").concat(f.scrubMriOrOmit(E),\" removed from roster\")),m.onParticipantRemoved({id:E},u),v.clearParticipantCallLinks(E))}}catch(l){h={error:l}}finally{try{C&&!C.done&&(g=_.return)&&g.call(_)}finally{if(h)throw h.error}}this.handleRemoveParticipantRequests(d,u)},RosterManager.prototype.handleRemoveParticipantRequests=function(l,d){var u,h,g=this.participantManager.signalingSession,v=this.participantManager.participantOperationHandler;this.logger.info(\"handleRemoveParticipantRequests [\".concat(d,\"] dynamicRosterParticipants\"));var _=[];Object.keys(l).forEach((function(d){var u=m.default.fromRoster(l[d]);u&&u.endpointDetails&&u.endpointDetails.forEach((function(l){l.originalId&&_.push(l.originalId)}))}));var C=v.getAllPendingOperations(3,d);try{for(var E=p(Object.keys(C)),T=E.next();!T.done;T=E.next()){var b=T.value;-1!==_.indexOf(b)||l.hasOwnProperty(b)||(this.logger.info(\"[\".concat(d,\"][handleRemoveParticipantRequests] \").concat(f.scrubMriOrOmit(b),\" no longer appears in roster. Resolving RemoveParticipant request\")),S.tryRemoveKeyFromHashTable(this.participantManager.connectedRemoteParticipantIds,b),g.timeoutManager.stopTimer(y.default.TIMEOUT_OPERATIONS.REMOVE_PARTICIPANT,b),v.resolvePendingOperation(3,b,{id:b},d))}}catch(l){u={error:l}}finally{try{T&&!T.done&&(h=E.return)&&h.call(E)}finally{if(u)throw u.error}}},RosterManager}();d.default=_},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d){return g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"broadcastContext cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}},broadcast:d,links:{addModalitySuccess:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_FAILURE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d){return g.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}},links:{admitAllStatus:h.get(l,p.URL_PATH.CONV_ADMIT_ALL_STATUS)},operationId:d,debugContent:{causeId:d}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){void 0===u&&(u=!0),g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(d,\"joinUrl cannot be null\");var f={type:l.signalingAgentConfig.enableDeltaRosterWeb?\"Delta\":\"MultiPartyEndpoint\",rosterUpdate:h.get(l,p.URL_PATH.CONV_ROSTER_UPDATE)},m=l.getEndpointCapabilities(),v={payload:{attach:{requireMediaContent:u,links:{end:h.get(l,p.URL_PATH.END)},locationContent:l.getLocationContent(),networkContent:l.getNetworkContent(),areaContent:l.getAreaContent()},capabilities:l.signalingAgentConfig.enableDeltaRosterWeb?null:m,endpointCapabilities:l.signalingAgentConfig.enableDeltaRosterWeb?m:null,additionalActions:[{input:{capabilities:l.signalingAgentConfig.enableDeltaRosterWeb?null:m,endpointCapabilities:l.signalingAgentConfig.enableDeltaRosterWeb?m:null,conversationRequest:{applicationType:l.participantManager.localParticipant.applicationType,roster:f,links:{conversationEnd:h.get(l,p.URL_PATH.CONV_END),conversationUpdate:h.get(l,p.URL_PATH.CONV_UPDATE),localParticipantUpdate:h.get(l,p.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},endpointMetadata:l.endpointMetadata,participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}}},name:\"join\",url:d,waitForResponse:!0}]}};return l.signalingAgentConfig.ecsEtag&&(v.payload.debugContent={ecsEtag:l.signalingAgentConfig.ecsEtag}),v.payload.additionalActions.length>0&&l.deviceType&&\"default\"!==l.deviceType&&(v.payload.additionalActions[0].input.conversationRequest.deviceType=l.deviceType),v}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l){return g.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{callAcceptanceAcknowledgement:{links:{mediaRenegotiation:h.get(l,p.URL_PATH.MEDIA_RENEGOTIATION),transfer:h.get(l,p.URL_PATH.TRANSFER),replacement:h.get(l,p.URL_PATH.REPLACE),balanceUpdate:h.get(l,p.URL_PATH.BALANCE_UPDATE),retargetCompletion:h.get(l,p.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:h.get(l,p.URL_PATH.CONTROL_VIDEO_STREAMING)}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u,f){g.assertNotNull(l,\"signalingSession cannot be null\");var m=g.getMediaTypes(u);l.telemetryHelper.addOutgoingModalities(m);var v=l.getEndpointCapabilities();return{payload:{callAcceptance:{acceptedBy:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},acceptedCallModalities:m,capabilities:l.signalingAgentConfig.enableDeltaRosterWeb?null:v,endpointCapabilities:l.signalingAgentConfig.enableDeltaRosterWeb?v:null,clientEndpointCapabilities:0!==f?f:null,links:{mediaRenegotiation:h.get(l,p.URL_PATH.MEDIA_RENEGOTIATION),transfer:h.get(l,p.URL_PATH.TRANSFER),replacement:h.get(l,p.URL_PATH.REPLACE),balanceUpdate:h.get(l,p.URL_PATH.BALANCE_UPDATE),retargetCompletion:h.get(l,p.URL_PATH.RETARGET_COMPLETION),controlVideoStreaming:h.get(l,p.URL_PATH.CONTROL_VIDEO_STREAMING)},clientContentForMediaController:l.webRtcSignalingManager.getClientUrls(),mediaContent:d,pstnContent:l.pstnContent,callKeepAliveInterval:null}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l){return p.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{callProgress:{sender:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},status:\"ringing\",phrase:\"ringing\"}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d,u,h){p.assertNotNull(l,\"signalingSession cannot be null\");var g=l.participantManager.localParticipant;return{payload:{invitationRedirection:{target:{type:d,endpointType:h,id:u},sender:{id:g.id,endpointId:g.endpointId,participantId:g.participantId,languageId:g.languageId}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(4);function getPayload(l,d,u){h.assertNotNull(l,\"signalingSession cannot be null\"),h.assertCallEndReason(d);var g={payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,languageId:l.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:\"noError\",code:p.default.CALL_END_CODE.SUCCESS,phrase:p.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:d}};return u&&d.code===p.default.CALL_END_CODE.CANCEL&&(g.payload.callTransactionEnd.callQualityDiagnosticsInformation=u),g}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u,f){g.assertNotNull(l,\"signalingSession cannot be null\");var m=[];m=f.invitationType===p.default.INVITATION_TYPE.NUDGE&&Array.isArray(f.participantsToNudge)?f.participantsToNudge.map((function(l){return{id:l}})):l.participantManager.getParticipantsToInitiateCallWith(),l.signalingAgentConfig.doHostlessCalling||g.assert(m.length>0,\"remoteParticipants need to be set before a call can be made\");var v={type:l.signalingAgentConfig.enableDeltaRosterWeb?\"Delta\":\"MultiPartyEndpoint\",rosterUpdate:h.get(l,p.URL_PATH.CONV_ROSTER_UPDATE)},y=l.groupId?{id:l.groupId}:null,S=l.threadId?{threadId:l.threadId,messageId:l.teamsMessageId||null}:null,_=l.contentSharingManager.getContentSharingInfoToStartSharing(),C=null===_?null:{identifier:_.contentIdentifier,subject:_.subject,sessionState:_.sessionState,sessionUpdateSequenceNumber:_.sequenceNumber,links:{sessionUpdate:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_UPDATE),sessionEnd:h.get(l,p.URL_PATH.CONV_CONTENT_SHARING_END)}},E=l.broadcastSession&&l.broadcastSession.getContext(),T=l.getEndpointCapabilities(f.enableLightWeightMeeting);1===m.length&&l.telemetryHelper.setCalleeType(m[0].id),l.numberOfOriginalInvitees=m.length;var b=[];m.forEach((function(d){var u={id:d.id};d.displayName&&(u.displayName=d.displayName),d.participantId&&(u.participantId=d.participantId),(f.callToVoicemail||l.transferContext&&l.transferContext.target&&\"voicemail\"===l.transferContext.target.endpointType)&&(u.endpointType=\"voicemail\"),b.push(u)}));var I=l.transferContext?l.transferContext.transferor:null,A=l.transferContext?l.transferContext.transferContext:null,R={};f.callToVoicemail&&(f.voicemailResourcePath&&(R.localResourcePath=f.voicemailResourcePath),f.voicemailItemId&&(R.voicemailItemId=f.voicemailItemId));var P={payload:{conversationRequest:{conversationType:f.conversationType,subject:l.convSubject,suppressDialout:f.suppressDialout,applicationType:f.applicationType,roster:v,properties:{allowConversationWithoutHost:l.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:l.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:l.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:l.enableGroupCallMeetupGeneration},links:{conversationEnd:h.get(l,p.URL_PATH.CONV_END),conversationUpdate:h.get(l,p.URL_PATH.CONV_UPDATE),localParticipantUpdate:h.get(l,p.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE),addModalitySuccess:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_SUCCESS),addModalityFailure:h.get(l,p.URL_PATH.CONV_ADD_MODALITY_FAILURE),confirmUnmute:h.get(l,p.URL_PATH.CONV_CONFIRM_UNMUTE)}},broadcast:E,contentSharing:C,participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId,meetingRegistrationId:f.meetingRegistrationId},to:b},capabilities:l.signalingAgentConfig.enableDeltaRosterWeb?null:T,endpointCapabilities:l.signalingAgentConfig.enableDeltaRosterWeb?T:null,clientEndpointCapabilities:f.clientEndpointCapabilities?f.clientEndpointCapabilities:null,endpointMetadata:l.endpointMetadata,groupContext:y,groupChat:S,meetingInfo:l.getMeetingInfo(),meetingData:f.meetingData,meetingPreferences:f.meetingPreferences,endpointState:f.endpointState}};if(l.deviceType&&\"default\"!==l.deviceType&&(P.payload.conversationRequest.deviceType=l.deviceType),f.enableLightWeightMeeting)P.payload.lwj={end:h.get(l,p.URL_PATH.LWJ_END),acceptance:h.get(l,p.URL_PATH.LWJ_ACCEPTANCE)};else{var O=g.getMediaTypes(u);l.telemetryHelper.addOutgoingModalities(O),P.payload.callInvitation={callModalities:O,replaces:null,transferor:I||null,clientTransferContext:A,links:{progress:h.get(l,p.URL_PATH.PROGRESS),mediaAnswer:h.get(l,p.URL_PATH.MEDIA_ANSWER),acceptance:h.get(l,p.URL_PATH.ACCEPT),redirection:h.get(l,p.URL_PATH.REDIRECTION),end:h.get(l,p.URL_PATH.END)},clientContentForMediaController:l.webRtcSignalingManager.getClientUrls(),pstnContent:l.pstnContent,emergencyContent:l.getEmergencyContent(),mediaContent:d,voicemailSettings:R,routingFlags:f.routingFlags,invitationData:f.invitationData,locationContent:l.getLocationContent(),networkContent:l.getNetworkContent(),areaContent:l.getAreaContent()},f.pickupCode&&(P.payload.callInvitation.unparkContent={pickupCode:parseInt(f.pickupCode,10)}),f.onBehalfOf&&(P.payload.callInvitation.onBehalfOf={id:f.onBehalfOf}),f.scenario&&(P.payload.conversationRequest.scenario=f.scenario),f.alternateId&&(P.payload.participants.from.alternateId=f.alternateId)}if(f.invitationType===p.default.INVITATION_TYPE.NUDGE&&(P.payload.participants.invitationType=f.invitationType),l.signalingAgentConfig.ecsEtag&&(P.payload.debugContent={ecsEtag:l.signalingAgentConfig.ecsEtag}),f.clientEndpointDebugContent){P.payload.debugContent||(P.payload.debugContent={});try{P.payload.debugContent.clientDebugContent=JSON.parse(f.clientEndpointDebugContent)}catch(l){g.assert(!1,\"Failed to parse \".concat(f.clientEndpointDebugContent))}}return P}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(4);function getPayload(l,d){return h.assertNotNull(l,\"signalingSession cannot be null\"),h.assertCallEndReason(d),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}},conversationTransactionEnd:{reason:\"noError\",code:p.default.CALL_END_CODE.SUCCESS,phrase:p.default.CALL_END_PHRASE.CONV_END_FOR_ALL_INITIATED},callTransactionEnd:d}}}d.getPayload=getPayload},function(l,d,u){function getPayload(l,d){return{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},scope:d}}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0,d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u,f,m){g.assertNotNull(l,\"signalingSession cannot be null\");var v={type:l.signalingAgentConfig.enableDeltaRosterWeb?\"Delta\":\"MultiPartyEndpoint\",rosterUpdate:h.get(l,p.URL_PATH.CONV_ROSTER_UPDATE)},y=l.getEndpointCapabilities(f.enableLightWeightMeeting),S=l.groupId?{id:l.groupId}:null,_=l.threadId?{threadId:l.threadId,messageId:l.teamsMessageId||null}:null,C={payload:{conversationRequest:{conversationType:f.conversationType,subject:l.convSubject,suppressDialout:f.suppressDialout,scenario:f.scenario,applicationType:f.applicationType,roster:v,properties:{allowConversationWithoutHost:l.signalingAgentConfig.doHostlessCalling,enableGroupCallEventMessages:l.signalingAgentConfig.shouldServiceSendCallEventMessages,enableGroupCallUpgradeMessage:l.signalingAgentConfig.shouldServiceSendNGCUpgradeMessages,enableGroupCallMeetupGeneration:l.enableGroupCallMeetupGeneration},links:{conversationEnd:h.get(l,p.URL_PATH.CONV_END),conversationUpdate:h.get(l,p.URL_PATH.CONV_UPDATE),localParticipantUpdate:h.get(l,p.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),addParticipantSuccess:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_SUCCESS),addParticipantFailure:h.get(l,p.URL_PATH.CONV_ADD_PARTICIPANT_FAILURE)}},groupContext:S,groupChat:_,participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId,meetingRegistrationId:f.meetingRegistrationId}},capabilities:l.signalingAgentConfig.enableDeltaRosterWeb?null:y,endpointCapabilities:l.signalingAgentConfig.enableDeltaRosterWeb?y:null,clientEndpointCapabilities:f.clientEndpointCapabilities?f.clientEndpointCapabilities:null,endpointMetadata:l.endpointMetadata,meetingInfo:l.getMeetingInfo(),meetingData:f.meetingData,meetingPreferences:f.meetingPreferences,endpointState:f.endpointState}};if((null==f?void 0:f.applyServerMute)&&(C.payload.participants.from.applyServerMute=f.applyServerMute.value,f.applyServerMute.mediaTypes&&(C.payload.participants.from.mediaTypes=f.applyServerMute.mediaTypes)),l.deviceType&&\"default\"!==l.deviceType&&(C.payload.conversationRequest.deviceType=l.deviceType),!f.subscribe&&!f.enableLightWeightMeeting){var E=g.getMediaTypes(u);l.telemetryHelper.addOutgoingModalities(E),C.payload.callInvitation={callModalities:E,replaces:null,transferor:null,links:{progress:h.get(l,p.URL_PATH.PROGRESS),mediaAnswer:h.get(l,p.URL_PATH.MEDIA_ANSWER),acceptance:h.get(l,p.URL_PATH.ACCEPT),redirection:h.get(l,p.URL_PATH.REDIRECTION),end:h.get(l,p.URL_PATH.END)},clientContentForMediaController:l.webRtcSignalingManager.getClientUrls(),mediaContent:d,pstnContent:l.pstnContent,locationContent:l.getLocationContent(),networkContent:l.getNetworkContent(),areaContent:l.getAreaContent(),sharedLineCallInvitationContent:f.sharedLineCallInvitationContent}}if(f.enableLightWeightMeeting&&(C.payload.lwj={end:h.get(l,p.URL_PATH.LWJ_END),acceptance:h.get(l,p.URL_PATH.LWJ_ACCEPTANCE)}),l.signalingAgentConfig.ecsEtag&&(C.payload.debugContent={ecsEtag:l.signalingAgentConfig.ecsEtag}),m&&(C.payload.debugContent||(C.payload.debugContent={}),C.payload.debugContent.causeId=m),f.clientEndpointDebugContent){C.payload.debugContent||(C.payload.debugContent={});try{C.payload.debugContent.clientDebugContent=JSON.parse(f.clientEndpointDebugContent)}catch(l){g.assert(!1,\"Failed to parse \".concat(f.clientEndpointDebugContent))}}return C}d.getPayload=getPayload},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.getJoinMeetingGroupPayload=void 0;var h=u(5),g=u(10),f=u(4);function getJoinMeetingGroupPayload(l,d,u){f.assertNotNull(l,\"signalingSession cannot be null\");var m=d.meetingGroupId,v=d.groupPreferences;return{payload:p(p({from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},meetingGroup:m},v&&{groupPreferences:v}),{links:{joinMeetingGroupStatus:g.get(l,h.URL_PATH.JOIN_MEETING_GROUP_STATUS)},operationId:u})}}d.getJoinMeetingGroupPayload=getJoinMeetingGroupPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(4);function getPayload(l,d,u,g){h.assertNotNull(l,\"signalingSession cannot be null\"),h.assertCallEndReason(d);var f={payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},scope:g&&\"all\"!==g?void 0:g},conversationTransactionEnd:{reason:\"noError\",code:p.default.CALL_END_CODE.SUCCESS,phrase:p.default.CALL_END_PHRASE.CONV_END_NO_MODALITY},callTransactionEnd:d}};return u&&d.code===p.default.CALL_END_CODE.CANCEL&&(f.payload.callTransactionEnd.callQualityDiagnosticsInformation=u),f}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getLeaveMeetingGroupPayload=void 0;var p=u(5),h=u(10),g=u(4);function getLeaveMeetingGroupPayload(l,d,u){g.assertNotNull(l,\"signalingSession cannot be null\");var f=d.meetingGroupId;return{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},meetingGroup:f,links:{leaveMeetingGroupStatus:h.get(l,p.URL_PATH.LEAVE_MEETING_GROUP_STATUS)},operationId:u}}}d.getLeaveMeetingGroupPayload=getLeaveMeetingGroupPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){return g.assertNotNull(l,\"signalingSession cannot be null\"),g.assertNotNull(u,\"newOfferLink cannot be null\"),{payload:{mediaOfferRequirements:{compatibleContentTypes:d,links:{offerReady:h.get(l,p.URL_PATH.NEW_MEDIA_OFFER)}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d){return g.assertNotNull(d,\"signalingSession cannot be null\"),{payload:{callTransfer:{target:{id:d.participantManager.localParticipant.id},transferor:{details:{id:d.participantManager.localParticipant.id,endpointId:d.participantManager.localParticipant.endpointId,participantId:d.participantManager.localParticipant.participantId,languageId:d.participantManager.localParticipant.languageId},authorizationToken:null},parkType:l,links:{transferAcceptance:h.get(d,p.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:h.get(d,p.URL_PATH.TRANSFER_COMPLETION)}}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){g.assertNotNull(l,\"ParkRequestPayload: signalingSession cannot be null\");var f={payload:{hold:{holdType:d,links:{holdCompletion:h.get(l,p.URL_PATH.PARK_COMPLETION)}}}};return u&&(f.payload.debugContent=u),f}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l){return g.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{callParticipantUpdate:{links:{mediaRenegotiation:h.get(l,p.URL_PATH.MEDIA_RENEGOTIATION),transfer:h.get(l,p.URL_PATH.TRANSFER),replacement:h.get(l,p.URL_PATH.REPLACE),end:h.get(l,p.URL_PATH.END),balanceUpdate:h.get(l,p.URL_PATH.BALANCE_UPDATE),retargetCompletion:h.get(l,p.URL_PATH.RETARGET_COMPLETION)},clientContentForMediaController:l.webRtcSignalingManager.getClientUrls()}}}}d.getPayload=getPayload},function(l,d,u){function getPayload(l,d,u,p,h,g,f){var m={payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},publishedState:{content:p,level:u,stateType:d,sequenceNumber:h},scope:g}};if(f&&f.length>0){var v=f.map((function(l){return{id:l}}));m.payload.to=v}return m}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0,d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d){return p.assertNotNull(l,\"signalingSession cannot be null\"),p.assertCallEndReason(d),{payload:{callEnd:d}}}d.getPayload=getPayload},function(l,d,u){function getPayload(l,d,u,p,h){var g={from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},sequenceNumber:d,scope:u};return\"specified\"===u?g.stateIds=p:g.stateType=h,{payload:g}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0,d.getPayload=getPayload},function(l,d,u){function getPayload(l,d){return{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},searchOptions:d}}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0,d.getPayload=getPayload},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var h=u(5),g=u(10),f=u(4);function getPayload(l,d){return f.assertNotNull(l,\"signalingSession cannot be null\"),{payload:p(p({from:{id:l.participantManager.localParticipant.id,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId,displayName:l.participantManager.localParticipant.displayName}},d),{links:{setMeetingLayoutStatus:g.get(l,h.URL_PATH.SET_MEETING_LAYOUT_STATUS)}})}}d.getPayload=getPayload},function(l,d,u){function getPayload(){return{payload:{transferAcceptance:{}}}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0,d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u,f,m){return g.assertNotNull(d,\"signalingSession cannot be null\"),g.assertNotNullOrEmpty(l,\"transferTarget cannot be null OR empty\"),{payload:{callTransfer:{target:{id:l,endpointType:\"TransferTypeVoicemail\"===f?\"voicemail\":void 0},transferor:{details:{id:d.participantManager.localParticipant.id,endpointId:d.participantManager.localParticipant.endpointId,participantId:d.participantManager.localParticipant.participantId,languageId:d.participantManager.localParticipant.languageId},authorizationToken:null},links:{transferAcceptance:h.get(d,p.URL_PATH.TRANSFER_ACCEPTANCE),transferCompletion:h.get(d,p.URL_PATH.TRANSFER_COMPLETION)},replacementDetails:u,disableForwardingAndUnanswered:m&&m.disableForwardingAndUnanswered,transferContext:m&&m.clientTransferContext}}}}d.getPayload=getPayload},function(l,d,u){function getPayload(l){return{payload:{transferCompletion:l}}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0,d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d){g.assertNotNull(l,\"ResumePayload: signalingSession cannot be null\");var u={payload:{resume:{links:{resumeCompletion:h.get(l,p.URL_PATH.UNPARK_COMPLETION)}}}};return d&&(u.payload.debugContent=d),u}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d){return p.assertNotNull(d,\"clientMetadataJson cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}},endpointMetadata:d}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d){return p.assertNotNull(d,\"clientStateJson cannot be null\"),{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},endpointState:d}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l){return g.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}},links:{end:h.get(l,p.URL_PATH.LWJ_END),acceptance:h.get(l,p.URL_PATH.LWJ_ACCEPTANCE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getMeetingGroupsPayload=void 0;var p=u(5),h=u(10),g=u(4);function getMeetingGroupsPayload(l,d,u){g.assertNotNull(l,\"signalingSession cannot be null\");var f=d.scope,m=d.toGroup,v=d.fromGroup,y=d.participants;\"specified\"===f&&g.assertNotNull(y,\"participantsIds cannot be null\");var S={from:{id:l.participantManager.localParticipant.id,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId,displayName:l.participantManager.localParticipant.displayName},scope:f,fromGroup:v,toGroup:m,links:{updateMeetingGroupsStatus:h.get(l,p.URL_PATH.UPDATE_MEETING_GROUPS_STATUS)},operationId:u};return y&&(S.to=y.map((function(l){return{id:l.mri,endpointId:l.endpointId,participantId:l.participantId}}))),{payload:S}}d.getMeetingGroupsPayload=getMeetingGroupsPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l,d,u){return g.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{from:{id:l.participantManager.localParticipant.id,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId,displayName:l.participantManager.localParticipant.displayName},meetingLiveState:d,links:{updateMeetingLiveStateStatus:h.get(l,p.URL_PATH.UPDATE_MEETING_LIVE_STATE_STATUS)},operationId:u}}}d.getPayload=getPayload},function(l,d,u){function getPayload(l,d,u){var p={};return void 0!==u.allowRaiseHands&&(p.allowRaiseHands=u.allowRaiseHands),void 0!==u.attendeeRestrictions&&(p.attendeeRestrictions=u.attendeeRestrictions),void 0!==u.lockMeeting&&(p.lockMeeting=u.lockMeeting),void 0!==u.breakoutRoomsEnabled&&(p.breakoutRoomsEnabled=u.breakoutRoomsEnabled),void 0!==u.allowPresentersToManageBreakoutRooms&&(p.allowPresentersToManageBreakoutRooms=u.allowPresentersToManageBreakoutRooms),void 0!==u.disableMdpClientAudioRecording&&(p.disableMdpClientAudioRecording=u.disableMdpClientAudioRecording),{payload:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},meetingSettings:p,sequenceNumber:d}}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0,d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(5),h=u(10),g=u(4);function getPayload(l){g.assertNotNull(l,\"signalingSession cannot be null\");var d={type:l.signalingAgentConfig.enableDeltaRosterWeb?\"Delta\":\"MultiPartyEndpoint\",rosterUpdate:h.get(l,p.URL_PATH.CONV_ROSTER_UPDATE)};return{payload:{participants:{from:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId}},roster:d,links:{conversationEnd:h.get(l,p.URL_PATH.CONV_END),conversationUpdate:h.get(l,p.URL_PATH.CONV_UPDATE),localParticipantUpdate:h.get(l,p.URL_PATH.CONV_LOCAL_PARTICIPANT_UPDATE),confirmUnmute:h.get(l,p.URL_PATH.CONV_CONFIRM_UNMUTE)}}}}d.getPayload=getPayload},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPayload=void 0;var p=u(4);function getPayload(l,d){return p.assertNotNull(l,\"signalingSession cannot be null\"),{payload:{mediaAnswer:{sender:{id:l.participantManager.localParticipant.id,displayName:l.participantManager.localParticipant.displayName,endpointId:l.participantManager.localParticipant.endpointId,participantId:l.participantManager.localParticipant.participantId,languageId:l.participantManager.localParticipant.languageId},mediaContent:d,pstnContent:l.pstnContent}}}}d.getPayload=getPayload},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(8),f=u(47),m=u(5),v=u(59),y=u(4),S=u(25),_=u(294),C=function(){function TelemetryHelper(l,d,u){var C=this;this.signalingSession=l,this.callStartTime=u,this.networkRequestsCompleted=[],this.networkRequestsStarted={},this.networkRequests={},this.localOperationsPerformed=[],this.recordedEvents=[],this.rosterUpdates=[],this.contentSharingOperationsPerformed={},this.outgoingModalities=[],this.incomingModalities=[],this.offeredModalities=\"\",this.answeredModalities=\"\",this.vbssOperations=[],this.vbssStarted=!1,this.localOfferAnswerGenerationTimestamps=[],this.trouterWaitOperations=[],this.telemetryData={},this.contentSharingBaseTelemetryData={},this.httpRequestTelemetryData={},this.connectedStopWatch=null,this.preheatedCallSetupDurationWatch=null,this.callCancelationDurationWatch=null,this.timeToRingStopWatch=null,this.isSdpInCallNotification=!1,this.isPreheated=0,this.addBrokerChannel=function(){C.setMessagingChannel(S.default.MESSAGING_CHANNEL.BROKER)},this.addTrouterChannel=function(){C.setMessagingChannel(S.default.MESSAGING_CHANNEL.TROUTER)},this.addTrouterWaitOperation=function(l){C.trouterWaitOperations.push(C.recordOperation(l))},this.recordIncomingEvent=function(l,d,u){var p=y.extractCauseIdFromMessage(d),h={origin:d.origin,causeId:p,data:u};u||delete h.data,C.recordEvent(l,h)},this.recordIncomingEventCount=function(l){C.localOperationsPerformed.push(C.recordOperation(l));var d=C.recordedEvents.findIndex((function(d){return d[l]}));if(-1!==d)C.recordedEvents[d][l]+=1;else{var u={};u[l]=1,C.recordedEvents.push(u)}},this.recordEvent=function(l,d){C.logger.debug(\"Event:\",l,d),C.localOperationsPerformed.push(C.recordOperation(l));var u={};u[l]=C.timeSinceCallStart(),d&&(u.data=d),C.recordedEvents.push(u)},this.recordRosterEvent=function(l,d,u){C.localOperationsPerformed.push(C.recordOperation(d));var p={data:l,causeId:u},h={eventName:C.timeSinceCallStart(),data:p};C.rosterUpdates.push(h)},this.addOutgoingModalities=function(l){l&&C.outgoingModalities.push(l)},this.addIncomingModalities=function(l){l&&C.incomingModalities.push(l)},this.setOfferedModalities=function(l,d){C.offeredModalities=C.sdpTelemetryFormat(l,d)},this.setAnsweredModalities=function(l,d){C.answeredModalities=C.sdpTelemetryFormat(l,d)},this.setIsSdpInCallNotification=function(l){C.isSdpInCallNotification=l},this.addVbssOperations=function(l){l&&(l===S.default.VBSS_OPERATION.START?C.vbssStarted=!0:C.vbssStarted=!1,C.vbssOperations.push(C.recordOperation(l)))},this.addNetworkOperationStarted=function(l){y.tryAddNewKeyToHashTable(C.networkRequestsStarted,l,C.recordOperation(l))},this.addNetworkOperationCompleted=function(l,d,u){var p=d?S.default.RESULT_VALUE.SUCCESS:S.default.RESULT_VALUE.FAILURE,h=u?\"\".concat(l,\":\").concat(p,\":\").concat(u):\"\".concat(l,\":\").concat(p);C.networkRequestsCompleted.push(C.recordOperation(h)),y.tryRemoveKeyFromHashTable(C.networkRequestsStarted,l)},this.updateNetworkRequest=function(l){C.networkRequests[l.uid]?g.assign(C.networkRequests[l.uid],l):C.networkRequests[l.uid]=l},this.deleteNetworkRequest=function(l){delete C.networkRequests[l.uid]},this.addContentSharingOperation=function(l,d,u){var p;C.contentSharingOperationsPerformed[l]||(C.contentSharingOperationsPerformed[l]=[]);var h=((p={})[d]=C.timeSinceCallStart(),p);C.contentSharingOperationsPerformed[l].push(h);var g=C.contentSharingOperationsPerformed[l].length-1;return u&&C.updateContentSharingOperation(l,g,u),g},this.updateContentSharingOperation=function(l,d,u){var p,g;if(C.contentSharingOperationsPerformed[l]){var f=C.contentSharingOperationsPerformed[l][d],m=[];try{for(var v=h(Object.keys(u)),y=v.next();!y.done;y=v.next()){var S=y.value;m.push(\"\".concat(S,\": \").concat(u[S]))}}catch(l){p={error:l}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(p)throw p.error}}f.data=m.join(\", \")}},this.setDirection=function(l){C.telemetryData[S.default.EXTENSIONS.DIRECTION]=l},this.setEndPointId=function(l){C.telemetryData[S.default.CONTEXT_ID.ENDPOINT_ID]=l,C.contentSharingBaseTelemetryData[S.default.CONTEXT_ID.ENDPOINT_ID]=l,C.httpRequestTelemetryData[S.default.CONTEXT_ID.ENDPOINT_ID]=l},this.setParticipantId=function(l){C.telemetryData[S.default.CONTEXT_ID.PARTICIPANT_ID]=l,C.contentSharingBaseTelemetryData[S.default.CONTEXT_ID.PARTICIPANT_ID]=l,C.httpRequestTelemetryData[S.default.CONTEXT_ID.PARTICIPANT_ID]=l},this.setConversationServiceUrl=function(l){C.telemetryData[S.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=l},this.setMeetingInfo=function(l){l||(C.telemetryData[S.default.EXTENSIONS.MEETING_INFO]=l)},this.setJoinedFrom=function(l){C.telemetryData[S.default.EXTENSIONS.JOINED_FROM]=l},this.setSelfParticipantRole=function(l){C.telemetryData[S.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]=l},this.setScenario=function(l){C.telemetryData[S.default.EXTENSIONS.SCENARIO]=l},this.setCallerType=function(l){l&&(C.telemetryData[S.default.EXTENSIONS.CALLER_TYPE]=l.split(\":\",1)[0])},this.setCalleeType=function(l){l&&(C.telemetryData[S.default.EXTENSIONS.CALLEE_TYPE]=l.split(\":\",1)[0])},this.setTerminatingData=function(l){C.telemetryData[S.default.EXTENSIONS.CALL_TERMINATING_END]=l.terminatingEnd,C.telemetryData[S.default.EXTENSIONS.CALL_END_CODE]=l.endCode||m.default.CALL_END_CODE.SUCCESS,C.telemetryData[S.default.EXTENSIONS.CALL_END_SUB_CODE]=l.endSubCode||m.default.CALL_END_SUB_CODE.SUCCESS,C.telemetryData[S.default.EXTENSIONS.CALL_PHRASE]=l.phrase||m.default.CALL_END_PHRASE.UNKNOWN,C.telemetryData[S.default.EXTENSIONS.RESULT_VALUE]=l.resultValue||S.default.RESULT_VALUE.SUCCESS,C.telemetryData[S.default.EXTENSIONS.RESULT_DETAIL]=l.resultDetail||\"Call gracefully hungup\",C.telemetryData[S.default.EXTENSIONS.RESULT_CAUSE_ID]=l.causeId||\"unknown\",C.telemetryData[S.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=l.resultCategories||[],C.telemetryData[S.default.EXTENSIONS.CALL_END_CLIENT_SUB_CODE]=l.clientReasonSubCode,C.telemetryData[S.default.EXTENSIONS.CALL_END_CLIENT_PHRASE]=l.clientReasonPhrase},this.startCallInitializationWatch=function(l){C.timeToRingStopWatch=v.build(),l&&(C.timeToRingStopWatch.msElapsed+=l)},this.startCallConnectedWatch=function(){C.connectedStopWatch=v.build()},this.setIsPreheated=function(){C.isPreheated=1},this.startPreheatedCallSetupDurationWatch=function(){C.preheatedCallSetupDurationWatch=v.build()},this.stopPreheatedCallSetupDurationWatch=function(){C.preheatedCallSetupDurationWatch.pause()},this.startCallCancelationDurationWatch=function(){C.callCancelationDurationWatch=v.build()},this.stopCallCancelationDurationWatch=function(){C.callCancelationDurationWatch&&C.callCancelationDurationWatch.pause()},this.getCallCancelationDuration=function(){return C.callCancelationDurationWatch?C.callCancelationDurationWatch.durationInSeconds():0},this.resetCallCancelationDurationWatch=function(){C.callCancelationDurationWatch=null},this.setOfferAnswerGenerationTimestamps=function(l){C.localOfferAnswerGenerationTimestamps.push(C.recordOperation(l))},this.setTimeToRingDuration=function(){C.timeToRingStopWatch&&(C.telemetryData[S.default.EXTENSIONS.TIME_TO_RING_IN_MS]=C.timeToRingStopWatch.duration(),C.timeToRingStopWatch=null)},this.dispose=function(){C.sendCallModalityTelemetryData(),C.sendHttpTelemetryData()},this.setMessagingChannel=function(l){C.telemetryData[S.default.EXTENSIONS.MESSAGING_CHANNEL]||(C.telemetryData[S.default.EXTENSIONS.MESSAGING_CHANNEL]=[]),C.telemetryData[S.default.EXTENSIONS.MESSAGING_CHANNEL].some((function(d){return-1!==d.indexOf(l)}))||C.telemetryData[S.default.EXTENSIONS.MESSAGING_CHANNEL].push(C.recordOperation(l))},this.sendHttpTelemetryData=function(){var l=p({},C.httpRequestTelemetryData);l[S.default.CONTEXT_ID.CORRELATION_ID]=C.signalingSession.correlationId,l[S.default.CONTEXT_ID.SIGNALING_SESSION_ID]=C.signalingSession.sessionId,l[S.default.EXTENSIONS.CLIENT_INFORMATION]=C.signalingSession.signalingAgentConfig.clientInformation;var d=Object.keys(C.networkRequests).map((function(l){return delete C.networkRequests[l].uid,C.networkRequests[l]})),u=JSON.stringify({eventStart:C.callStartTime,events:d});l[S.default.EXTENSIONS.NETWORK_REQUESTS_BAG]=u,C.telemetryLogger.logHttpTelemetryEvent(l)},this.sdpTelemetryFormat=function(l,d){var u,p;if(!l)return\"\";var convertType=function(l){switch(l){case\"main-audio\":return\"Audio\";case\"main-video\":return\"Video\";case\"applicationsharing-video\":return\"AppSharing\";default:return}},convertDirection=function(l){switch(l){case\"inactive\":return\"Inactive\";case\"sendonly\":return d?\"ReceiveFromPeer\":\"SendToPeer\";case\"recvonly\":return d?\"SendToPeer\":\"ReceiveFromPeer\";case\"sendrecv\":default:return\"Bidirectional\"}},g={\"main-audio\":0,\"main-video\":0,\"applicationsharing-video\":0},m=[],v=f.parse(l);try{for(var y=h(v.media),S=y.next();!S.done;S=y.next()){var _=S.value,C=convertType(_.label);if(C){var E=g[_.label]++,T=convertDirection(_.direction);m.push(\"\".concat(C,\"[\").concat(E,\"] = \").concat(T))}}}catch(l){u={error:l}}finally{try{S&&!S.done&&(p=y.return)&&p.call(y)}finally{if(u)throw u.error}}return m.join(\", \")},this.logger=l.logger,this.telemetryLogger=_.getLogger(l,this.logger),this.telemetryData[S.default.EXTENSIONS.CALL_START_TIME]=this.callStartTime,this.telemetryData[S.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=l.signalingAgentConfig.conversationServiceUrl,this.fillCommonData(d,this.telemetryData),this.fillCommonData(d,this.httpRequestTelemetryData),this.fillCommonData(d,this.contentSharingBaseTelemetryData)}return TelemetryHelper.prototype.fillCommonData=function(l,d){d[S.default.EXTENSIONS.APPLICATION_TYPE]=l.applicationType,d[S.default.EXTENSIONS.RING]=l.ring,d[S.default.EXTENSIONS.TENANT_ID]=l.tenantId,d[S.default.EXTENSIONS.USER_HEX_CID]=l.userHexCID,d[S.default.EXTENSIONS.ACS_RESOURCE_ID]=l.acsResourceId,d[S.default.EXTENSIONS.REGION]=l.region,d[S.default.EXTENSIONS.PARTITION]=l.partition},TelemetryHelper.prototype.addChangingCorrelationId=function(l,d){this.telemetryData[S.default.EXTENSIONS.CHANGING_CORRELATION_ID_OLD_ID]=l,this.telemetryData[S.default.EXTENSIONS.CHANGING_CORRELATION_ID_NEW_ID]=d},TelemetryHelper.prototype.addSharedCorrelationId=function(l){this.telemetryData[S.default.CONTEXT_ID.SHARED_CORRELATION_ID]=l},TelemetryHelper.prototype.sendContentSharingTelemetryData=function(l,d,u,h,g,f){var m=p({},this.contentSharingBaseTelemetryData),v=this.contentSharingOperationsPerformed[l];v&&(m[S.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=JSON.stringify(v)),m[S.default.CONTEXT_ID.CONTENT_SHARING_CORRELATION_ID]=l,m[S.default.CONTEXT_ID.SIGNALING_SESSION_ID]=d,m[S.default.CONTEXT_ID.CONTENT_SHARING_ID]=f||\"\",m[S.default.EXTENSIONS.CONTENT_SHARING_SERVICE_URL]=g,m[S.default.EXTENSIONS.CONTENT_SHARING_DIRECTION]=u?S.default.DIRECTION.OUTGOING:S.default.DIRECTION.INCOMING,m[S.default.EXTENSIONS.CALL_END_CODE]=h.code,m[S.default.EXTENSIONS.CALL_END_SUB_CODE]=h.subCode,m[S.default.EXTENSIONS.CALL_PHRASE]=h.phrase,m[S.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(h.resultCategories),m[S.default.EXTENSIONS.CALL_END_CAUSE_ID]=h.causeId,m[S.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,delete this.contentSharingOperationsPerformed[l],this.telemetryLogger.logConversationContentSharingEvent(m)},TelemetryHelper.prototype.recordOperation=function(l){return\"\".concat(l,\":\").concat(this.timeSinceCallStart())},TelemetryHelper.prototype.timeSinceCallStart=function(){return(new Date).getTime()-this.callStartTime},TelemetryHelper.prototype.sendCallModalityTelemetryData=function(){var l,d;this.vbssStarted&&this.addVbssOperations(S.default.VBSS_OPERATION.CALL_END);var durationMsToS=function(l){return\"number\"==typeof l?l/1e3:0};if(this.telemetryData[S.default.EXTENSIONS.CLIENT_INFORMATION]=this.signalingSession.signalingAgentConfig.clientInformation,this.telemetryData[S.default.EXTENSIONS.CALL_END_TIME]=(new Date).getTime(),this.connectedStopWatch&&(this.telemetryData[S.default.EXTENSIONS.CONNECTED_DURATION_IN_MS]=this.connectedStopWatch.duration()),this.telemetryData[S.default.EXTENSIONS.IS_PREHEATED]=this.isPreheated,this.preheatedCallSetupDurationWatch&&(this.telemetryData[S.default.EXTENSIONS.PREHEATED_CALL_SETUP_DURATION_IN_S]=durationMsToS(this.preheatedCallSetupDurationWatch.duration())),this.callCancelationDurationWatch&&(this.telemetryData[S.default.EXTENSIONS.CALL_CANCELATION_DURATION_IN_S]=durationMsToS(this.callCancelationDurationWatch.duration())),this.networkRequestsCompleted.length&&(this.telemetryData[S.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED]=JSON.stringify(this.networkRequestsCompleted)),this.localOperationsPerformed.length&&(this.telemetryData[S.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED]=JSON.stringify(this.localOperationsPerformed)),this.trouterWaitOperations.length&&(this.telemetryData[S.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS]=JSON.stringify(this.trouterWaitOperations)),this.localOfferAnswerGenerationTimestamps.length&&(this.telemetryData[S.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS]=JSON.stringify(this.localOfferAnswerGenerationTimestamps)),this.incomingModalities.length&&(this.telemetryData[S.default.EXTENSIONS.INCOMING_MODALITIES]=JSON.stringify(this.incomingModalities)),this.outgoingModalities.length&&(this.telemetryData[S.default.EXTENSIONS.OUTGOING_MODALITIES]=JSON.stringify(this.outgoingModalities)),this.offeredModalities.length&&(this.telemetryData[S.default.EXTENSIONS.OFFERED_MODALITIES]=this.offeredModalities),this.answeredModalities.length&&(this.telemetryData[S.default.EXTENSIONS.ANSWERED_MODALITIES]=this.answeredModalities),this.telemetryData[S.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]=this.getResultCategoryString(this.telemetryData[S.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES]),this.telemetryData[S.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION]=this.isSdpInCallNotification.toString(),this.vbssOperations.length&&(this.telemetryData[S.default.EXTENSIONS.VBSS_OPERATIONS]=JSON.stringify(this.vbssOperations)),this.recordedEvents.length){var u=JSON.stringify({eventStart:this.callStartTime,events:this.recordedEvents});this.telemetryData[S.default.EXTENSIONS.EVENT_TIMESTAMP_BAG]=u}if(this.rosterUpdates.length){var p=JSON.stringify({eventStart:this.callStartTime,events:this.rosterUpdates});this.telemetryData[S.default.EXTENSIONS.ROSTER_UPDATES_BAG]=p}var g=[];try{for(var f=h(Object.keys(this.networkRequestsStarted)),m=f.next();!m.done;m=f.next()){var v=m.value;g.push(this.networkRequestsStarted[v])}}catch(d){l={error:d}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}g.length>0&&(this.telemetryData[S.default.EXTENSIONS.NETWORK_REQUESTS_PENDING]=JSON.stringify(g)),this.telemetryLogger.logConversationCallModalityEvent(this.telemetryData)},TelemetryHelper.prototype.getResultCategoryString=function(l){return l&&Array.isArray(l)?l.join(\",\"):\"\"},TelemetryHelper}();d.default=C},function(l,d,u){var toIntIfInt=function(l){return String(Number(l))===l?Number(l):l},attachProperties=function(l,d,u,p){if(p&&!u)d[p]=toIntIfInt(l[1]);else for(var h=0;h<u.length;h+=1)null!=l[h+1]&&(d[u[h]]=toIntIfInt(l[h+1]))},parseReg=function(l,d,u){var p=l.name&&l.names;l.push&&!d[l.push]?d[l.push]=[]:p&&!d[l.name]&&(d[l.name]={});var h=l.push?{}:p?d[l.name]:d;attachProperties(u.match(l.reg),h,l.names,l.name),l.push&&d[l.push].push(h)},p=u(113),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);d.parse=function(l){var d={},u=[],g=d;return l.split(/(\\r\\n|\\r|\\n)/).filter(h).forEach((function(l){var d=l[0],h=l.slice(2);\"m\"===d&&(u.push({rtp:[],fmtp:[]}),g=u[u.length-1]);for(var f=0;f<(p[d]||[]).length;f+=1){var m=p[d][f];if(m.reg.test(h))return parseReg(m,g,h)}})),d.media=u,d};var paramReducer=function(l,d){var u=d.split(/=(.+)/,2);return 2===u.length?l[u[0]]=toIntIfInt(u[1]):1===u.length&&d.length>1&&(l[u[0]]=void 0),l};d.parseParams=function(l){return l.split(/;\\s?/).reduce(paramReducer,{})},d.parseFmtpConfig=d.parseParams,d.parsePayloads=function(l){return l.toString().split(\" \").map(Number)},d.parseRemoteCandidates=function(l){for(var d=[],u=l.split(\" \").map(toIntIfInt),p=0;p<u.length;p+=3)d.push({component:u[p],ip:u[p+1],port:u[p+2]});return d},d.parseImageAttributes=function(l){return l.split(\" \").map((function(l){return l.substring(1,l.length-1).split(\",\").reduce(paramReducer,{})}))},d.parseSimulcastStreamList=function(l){return l.split(\";\").map((function(l){return l.split(\",\").map((function(l){var d,u=!1;return\"~\"!==l[0]?d=toIntIfInt(l):(d=toIntIfInt(l.substring(1,l.length)),u=!0),{scid:d,paused:u}}))}))}},function(l,d,u){var p=u(113),h=/%[sdv%]/g,format=function(l){var d=1,u=arguments,p=u.length;return l.replace(h,(function(l){if(d>=p)return l;var h=u[d];switch(d+=1,l){case\"%%\":return\"%\";case\"%s\":return String(h);case\"%d\":return Number(h);case\"%v\":return\"\"}}))},makeLine=function(l,d,u){var p=[l+\"=\"+(d.format instanceof Function?d.format(d.push?u:u[d.name]):d.format)];if(d.names)for(var h=0;h<d.names.length;h+=1){var g=d.names[h];d.name?p.push(u[d.name][g]):p.push(u[d.names[h]])}else p.push(u[d.name]);return format.apply(null,p)},g=[\"v\",\"o\",\"s\",\"i\",\"u\",\"e\",\"p\",\"c\",\"b\",\"t\",\"r\",\"z\",\"a\"],f=[\"i\",\"c\",\"b\",\"a\"];l.exports=function(l,d){d=d||{},null==l.version&&(l.version=0),null==l.name&&(l.name=\" \"),l.media.forEach((function(l){null==l.payloads&&(l.payloads=\"\")}));var u=d.outerOrder||g,h=d.innerOrder||f,m=[];return u.forEach((function(d){p[d].forEach((function(u){u.name in l&&null!=l[u.name]?m.push(makeLine(d,u,l)):u.push in l&&null!=l[u.push]&&l[u.push].forEach((function(l){m.push(makeLine(d,u,l))}))}))})),l.media.forEach((function(l){m.push(makeLine(\"m\",p.m[0],l)),h.forEach((function(d){p[d].forEach((function(u){u.name in l&&null!=l[u.name]?m.push(makeLine(d,u,l)):u.push in l&&null!=l[u.push]&&l[u.push].forEach((function(l){m.push(makeLine(d,u,l))}))}))}))})),m.join(\"\\r\\n\")+\"\\r\\n\"}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.getLogger=d.TelemetryLogger=void 0;var p=u(17),h=u(25),g=function(){function TelemetryLogger(l,d){var u=this;this.signalingSession=l,this.logger=d,this.logConversationCallModalityEvent=function(l){var d=u.createCallModalityEvent(l);u.logger.info(\"sending modality telemetry:\",u.getStringifiedEventData(d)),d.hostName=u.getHostDomainInfo(),u.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(h.default.EVENT_TYPE.CONVERSATION_CALL_MODALITY,d)},this.logConversationContentSharingEvent=function(l){l[h.default.CONTEXT_ID.CORRELATION_ID]=u.signalingSession.correlationId,l[h.default.EXTENSIONS.ECS_ETAG]=u.signalingSession.signalingAgentConfig.ecsEtag,u.logger.info(\"sending content sharing telemetry:\",u.getStringifiedEventData(l)),l.hostName=u.getHostDomainInfo(),u.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(h.default.EVENT_TYPE.CONVERSATION_CONTENT_SHARING,l)},this.logHttpTelemetryEvent=function(l){l[h.default.EXTENSIONS.ECS_ETAG]=u.signalingSession.signalingAgentConfig.ecsEtag,l[h.default.SIGNALING_CONFIG]=u.getSignalingAgentConfig(),u.logger.info(\"sending http telemetry:\",u.getStringifiedEventData(l)),l.hostName=u.getHostDomainInfo(),u.signalingSession.signalingAgentConfig.telemetryManager.sendEvent(h.default.EVENT_TYPE.CONVERSATION_HTTP_REQUEST,l)},this.getHostDomainInfo=function(){return\"localhost\"===location.hostname||\"127.0.0.1\"===location.hostname?\"localhost\":\"<redacted>\"},this.getSignalingAgentConfig=function(){var l=[],d=u.signalingSession.signalingAgentConfig;return d.supportsCompressedServicePayload&&l.push(h.default.SIGNALING_CONFIG_FLAGS.SUPPORTS_COMPRESSED_PAYLOAD),d.brokerEnabledOutgoing&&l.push(h.default.SIGNALING_CONFIG_FLAGS.BROKER_OUTGOING_ENABLED),d.brokerEnabledIncoming&&l.push(h.default.SIGNALING_CONFIG_FLAGS.BROKER_INCOMING_ENABLED),d.brokerRequestBatching&&l.push(h.default.SIGNALING_CONFIG_FLAGS.BROKER_REQUEST_BATCHING_ENABLED),d.brokerExclusively&&l.push(h.default.SIGNALING_CONFIG_FLAGS.BROKER_EXCLUSIVELY_ENABLED),d.supportsSynchronousTrouterResponse&&l.push(h.default.SIGNALING_CONFIG_FLAGS.SYNC_TROUTER_RESPONSE),d.handleMediaOfferFromPushNotification&&l.push(h.default.SIGNALING_CONFIG_FLAGS.HANDLE_OFFER_FROM_NOTIFICATION),d.handleNewOfferRequest&&l.push(h.default.SIGNALING_CONFIG_FLAGS.HANDLE_NEW_OFFER_REQUEST),d.sendProgressFromCC&&l.push(h.default.SIGNALING_CONFIG_FLAGS.SEND_PROGRESS_FROM_CC),d.handleUnmuteMuteFromResponse&&l.push(h.default.SIGNALING_CONFIG_FLAGS.HANDLE_UNMUTE_MUTE_FROM_RESPONSE),d.useInternalHttpDispatcher&&l.push(h.default.SIGNALING_CONFIG_FLAGS.INTERNAL_HTTP_DISPATCHER),d.enableTokenCache&&l.push(h.default.SIGNALING_CONFIG_FLAGS.ENABLE_TOKEN_CACHE),d.enableTokenPrefetch&&l.push(h.default.SIGNALING_CONFIG_FLAGS.ENABLE_TOKEN_PREFETCH),d.processSelfDataFromSubscribeResponse&&l.push(h.default.SIGNALING_CONFIG_FLAGS.PROCESS_SELF_DATA_FROM_SUBSCRIBE_RESPONSE),d.supportMediaRetargetWhileIncomingRenegotiation&&l.push(h.default.SIGNALING_CONFIG_FLAGS.SUPPORT_MEDIA_RETARGET_WHILE_INCOMING_RENEGOTIATION),d.enableErrorCodeImprovementsForNetworkFailures&&l.push(h.default.SIGNALING_CONFIG_FLAGS.ENABLE_ERROR_CODE_IMPROVEMENTS_FOR_NETWORK_FAILURES),d.enableCallEstablishmentTimeoutsForStartJoinCall&&l.push(h.default.SIGNALING_CONFIG_FLAGS.ENABLE_CALL_ESTABLISHMENT_TIMEOUTS_FOR_START_OR_JOIN_CALL),l.push(h.default.SIGNALING_CONFIG_FLAGS.SERVER_MUTE_UNMUTE),l.join(\",\")},this.getStringifiedEventData=function(l){try{return JSON.stringify(l)}catch(l){return\"invalid data\"}}}return TelemetryLogger.prototype.createCallModalityEvent=function(l){var d={};d.Type=h.default.SOURCE.NGC_SOURCE;var setEventPropertyIfRecorded=function(u,p){void 0===p&&(p=!1),l.hasOwnProperty(u)&&(d[u]=p?JSON.stringify(l[u]):l[u])};return d.ResultDetail=l[h.default.EXTENSIONS.RESULT_DETAIL],d.ResultValue=l[h.default.EXTENSIONS.RESULT_VALUE],d.ResultCode=l[h.default.EXTENSIONS.CALL_END_CODE],d.ResultCauseId=l[h.default.EXTENSIONS.RESULT_CAUSE_ID],d[h.default.SIGNALING_CONFIG]=this.getSignalingAgentConfig(),d[h.default.CONTEXT_ID.CORRELATION_ID]=this.signalingSession.correlationId,d[h.default.CONTEXT_ID.SIGNALING_SESSION_ID]=this.signalingSession.sessionId,d[h.default.CONTEXT_ID.ENDPOINT_ID]=l[h.default.CONTEXT_ID.ENDPOINT_ID],d[h.default.CONTEXT_ID.PARTICIPANT_ID]=l[h.default.CONTEXT_ID.PARTICIPANT_ID],d[h.default.EXTENSIONS.ECS_ETAG]=this.signalingSession.signalingAgentConfig.ecsEtag,d[h.default.EXTENSIONS.CONVERSATION_SERVICE_URL]=l[h.default.EXTENSIONS.CONVERSATION_SERVICE_URL],d[h.default.EXTENSIONS.CALL_START_TIME]=JSON.stringify(l[h.default.EXTENSIONS.CALL_START_TIME]),d[h.default.EXTENSIONS.CALL_END_TIME]=JSON.stringify(l[h.default.EXTENSIONS.CALL_END_TIME]),d[h.default.EXTENSIONS.MESSAGING_CHANNEL]=JSON.stringify(l[h.default.EXTENSIONS.MESSAGING_CHANNEL]),d[h.default.EXTENSIONS.IS_GROUP_CALL]=this.signalingSession.multiParty?\"true\":\"false\",d[h.default.EXTENSIONS.IS_HOSTLESS_CALL]=this.signalingSession.isHostLessCall?\"true\":\"false\",d[h.default.EXTENSIONS.IS_CAST_CALL]=this.signalingSession.isCastCall?\"true\":\"false\",d[h.default.EXTENSIONS.IS_ON_BEHALF_OF_CALL]=this.signalingSession.onBehalfOf?\"true\":\"false\",d[h.default.EXTENSIONS.CLIENT_INFORMATION]=l[h.default.EXTENSIONS.CLIENT_INFORMATION],d[h.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION]=l[h.default.EXTENSIONS.IS_SDP_IN_CALL_NOTIFICATION],d[h.default.EXTENSIONS.CALL_TERMINATING_END]=l[h.default.EXTENSIONS.CALL_TERMINATING_END],d[h.default.EXTENSIONS.CALL_END_CODE]=JSON.stringify(l[h.default.EXTENSIONS.CALL_END_CODE]),d[h.default.EXTENSIONS.CALL_END_SUB_CODE]=JSON.stringify(l[h.default.EXTENSIONS.CALL_END_SUB_CODE]),setEventPropertyIfRecorded(h.default.CONTEXT_ID.SHARED_CORRELATION_ID),setEventPropertyIfRecorded(h.default.EXTENSIONS.DIRECTION),setEventPropertyIfRecorded(h.default.EXTENSIONS.SELF_PARTICIPANT_ROLE),setEventPropertyIfRecorded(h.default.EXTENSIONS.CONNECTED_DURATION_IN_MS,!0),setEventPropertyIfRecorded(h.default.EXTENSIONS.TIME_TO_RING_IN_MS,!0),setEventPropertyIfRecorded(h.default.EXTENSIONS.NETWORK_REQUESTS_COMPLETED),setEventPropertyIfRecorded(h.default.EXTENSIONS.NETWORK_REQUESTS_PENDING),setEventPropertyIfRecorded(h.default.EXTENSIONS.LOCAL_OPERATIONS_PERFORMED),setEventPropertyIfRecorded(h.default.EXTENSIONS.EVENT_TIMESTAMP_BAG),setEventPropertyIfRecorded(h.default.EXTENSIONS.ROSTER_UPDATES_BAG),setEventPropertyIfRecorded(h.default.EXTENSIONS.NETWORK_REQUESTS_BAG),setEventPropertyIfRecorded(h.default.EXTENSIONS.TROUTER_WAIT_OPERATIONS),setEventPropertyIfRecorded(h.default.EXTENSIONS.LOCAL_OFFER_ANSWER_GENERATION_TIMESTAMPS),setEventPropertyIfRecorded(h.default.EXTENSIONS.OUTGOING_MODALITIES),setEventPropertyIfRecorded(h.default.EXTENSIONS.INCOMING_MODALITIES),setEventPropertyIfRecorded(h.default.EXTENSIONS.OFFERED_MODALITIES),setEventPropertyIfRecorded(h.default.EXTENSIONS.ANSWERED_MODALITIES),setEventPropertyIfRecorded(h.default.EXTENSIONS.VBSS_OPERATIONS),setEventPropertyIfRecorded(h.default.EXTENSIONS.CALLER_TYPE),setEventPropertyIfRecorded(h.default.EXTENSIONS.CALLEE_TYPE),setEventPropertyIfRecorded(h.default.EXTENSIONS.SCENARIO),setEventPropertyIfRecorded(h.default.EXTENSIONS.PREHEATED_CALL_SETUP_DURATION_IN_S),setEventPropertyIfRecorded(h.default.EXTENSIONS.CALL_CANCELATION_DURATION_IN_S),setEventPropertyIfRecorded(h.default.EXTENSIONS.IS_PREHEATED),setEventPropertyIfRecorded(h.default.EXTENSIONS.ACS_RESOURCE_ID),setEventPropertyIfRecorded(h.default.EXTENSIONS.CALL_END_RESULT_CATEGORIES),setEventPropertyIfRecorded(h.default.EXTENSIONS.APPLICATION_TYPE),setEventPropertyIfRecorded(h.default.EXTENSIONS.RING),setEventPropertyIfRecorded(h.default.EXTENSIONS.REGION),setEventPropertyIfRecorded(h.default.EXTENSIONS.PARTITION),setEventPropertyIfRecorded(h.default.EXTENSIONS.JOINED_FROM),setEventPropertyIfRecorded(h.default.EXTENSIONS.USER_HEX_CID),this.signalingSession.callType&&(d[h.default.EXTENSIONS.CALL_TYPE]=this.signalingSession.callType),this.signalingSession.signalingAgentConfig.testCall&&(d[h.default.EXTENSIONS.TEST_CONTEXT_ID]=\"Test\"),this.signalingSession.groupId&&(d[h.default.CONTEXT_ID.GROUP_ID]=p.scrubMriOrOmit(this.signalingSession.groupId)),this.signalingSession.threadId&&(d[h.default.CONTEXT_ID.THREAD_ID]=p.getLoggableThreadId(this.signalingSession.threadId)),this.signalingSession.teamsMessageId&&(d[h.default.CONTEXT_ID.TEAMS_MESSAGEID]=this.signalingSession.teamsMessageId),this.signalingSession.getMeetingInfo()&&(d[h.default.CONTEXT_ID.TEAMS_MEETINGINFO]=JSON.stringify(this.signalingSession.getMeetingInfo())),this.signalingSession.multiParty&&0===this.signalingSession.numberOfOriginalInvitees&&l.hasOwnProperty(h.default.EXTENSIONS.SELF_PARTICIPANT_ROLE)&&l[h.default.EXTENSIONS.SELF_PARTICIPANT_ROLE]===h.default.ROLE.CALLER&&(d[h.default.EXTENSIONS.IS_MEETUP_CALL]=\"true\"),d},TelemetryLogger}();function getLogger(l,d){return new g(l,d)}d.TelemetryLogger=g,d.getLogger=getLogger},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(14),h=u(25),g=u(5),f=u(10),m=u(4),v=function(){function WebRtcSignalingManager(l,d){var u=this;this.disposed=!1,this.lastSeenSeqNumbers={},this.getClientUrls=function(){var l=null;return u.isWebRtcCall&&(l={controlVideoStreaming:f.get(u.signalingSession,g.URL_PATH.CONTROL_VIDEO_STREAMING),dominantSpeakerInfo:f.get(u.signalingSession,g.URL_PATH.DOMINANT_SPEAKER_INFO),csrcInfo:f.get(u.signalingSession,g.URL_PATH.CSRC_INFO)}),l},this.handleDominantSpeakerInfo=function(l){var d=l.body;u.logger.debug(\"handleDominantSpeakerInfo : \",(0,p.getPrintableObject)(d)),u.signalingSession.telemetryHelper.recordIncomingEventCount(h.EVENTS.HANDLE_DOMINANT_SPEAKER_CHANGED_COUNT),u.handleWebRtcNotification(g.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO,d.dominantSpeakerInformation)},this.handleControlVideoStreaming=function(l){var d=l.body;u.logger.debug(\"handleControlVideoStreaming: \",(0,p.getPrintableObject)(d)),u.signalingSession.telemetryHelper.recordIncomingEvent(h.EVENTS.HANDLE_CONTROL_VIDEO_STREAMING,l),u.handleWebRtcNotification(g.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING,d.controlVideoStreaming)},this.handleCsrcInfo=function(l){var d=l.body;u.logger.debug(\"handleCsrcInfo : \",(0,p.getPrintableObject)(d)),u.signalingSession.telemetryHelper.recordIncomingEvent(h.EVENTS.HANDLE_CSRC_INFO,l),u.handleWebRtcNotification(g.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO,d.csrcInfo)},this.sendWebRtcMediaNotificationAsync=function(l,d){var h=l.operation,f=l.requestUrl,v=l.requestBody,y=l.stackRetry,S=void 0===y||y;u.logger.info(\"sendWebRtcMediaNotificationAsync\"),m.assert(u.isWebRtcCall,\"this is not a webrtc call\"),m.assertNotNullOrEmpty(f,\"correct media notification requestUrl is not provided\"),m.assertNotNullOrEmpty(v,\"media notification requestBody cannot be null or empty\");var _=m.defer(),C={url:f,payload:{payload:v},requestName:h,withoutTrouter:!0,causeId:d};return S||(C.disableRetry=!0),u.signalingSession.http.sendPostRequest(C).then((function(){u.disposed||_.resolve()})).catch((function(l){var d=(0,p.getPrintableObject)(l);if(u.logger.error(\"sendWebRtcMediaNotificationAsync failed because : \".concat(d)),!u.disposed){var h=new Error(l);h.endCode=g.default.CALL_END_NETWORK_ERROR,_.reject(h)}})),_.promise},this.dispose=function(){u.logger.info(\"WebRtcSignalingManager :: dispose\"),u.disposed=!0},this.signalingSession=l,this.signalingSessionCallback=d,this.isWebRtcCall=l.signalingAgentConfig.isWebRtcEnabled,this.logger=l.logger,this.lastSeenSeqNumbers[g.default.WEBRTC_NOTIFICATION_TYPE.CONTROL_VIDEO_STREAMING]=-1,this.lastSeenSeqNumbers[g.default.WEBRTC_NOTIFICATION_TYPE.DOMINANT_SPEAKER_INFO]=-1,this.lastSeenSeqNumbers[g.default.WEBRTC_NOTIFICATION_TYPE.CSRC_INFO]=-1}return WebRtcSignalingManager.prototype.handleWebRtcNotification=function(l,d){m.assert(this.isWebRtcCall,\"ignoring message in non-webrtc call\");var u=this.lastSeenSeqNumbers[l];d.sequenceNumber<=u?this.logger.info(\"ignoring \".concat(l,\" . Last seen seq = \").concat(u)+\" current seq = \".concat(d.sequenceNumber)):(this.lastSeenSeqNumbers[l]=d.sequenceNumber,this.signalingSessionCallback.onWebRtcMediaNotification(l,d))},WebRtcSignalingManager}();d.default=v},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function SkypeConCoreTelemetryManager(l,d){this.appTelemetryManager=l,this.skypeConcoreToken=d}return SkypeConCoreTelemetryManager.prototype.sendEvent=function(l,d){this.appTelemetryManager.sendEvent(this.skypeConcoreToken,l,d)},SkypeConCoreTelemetryManager}();d.default=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.generateAliasedMri=d.stripMriAliases=d.PSTN_MRI_PREFIX=d.MRI_SIP_PREFIX=d.MRI_ALIAS_PREFIX=d.MRI_SKYPE_PREFIX=void 0;var p=/;aliases=.*$/i;function stripMriAliases(l){return l?l.replace(p,\"\"):l}function generateAliasedMri(l,u){var p=l;return u&&(p+=d.MRI_ALIAS_PREFIX+d.MRI_SIP_PREFIX+u),p}d.MRI_SKYPE_PREFIX=\"8:\",d.MRI_ALIAS_PREFIX=\";aliases=\",d.MRI_SIP_PREFIX=\"2:\",d.PSTN_MRI_PREFIX=\"4:\",d.stripMriAliases=stripMriAliases,d.generateAliasedMri=generateAliasedMri},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.isPhaseError=d.isOneOfPhaseErrors=void 0;var g=u(14),isOneOfPhaseErrors=function(l,d){return d&&void 0!==d.phase&&!!l[d.phase]};d.isOneOfPhaseErrors=isOneOfPhaseErrors;var isPhaseError=function(l,d){return d&&void 0!==d.phase&&d.phase===l};function createPhaseExecutor(l){var d=this,u={},recordPhaseStep=function(l){var d={status:\"Pending\"};u[l]=d},recordStepDoneTelemetry=function(l,d){u[l].t=d,delete u[l].status},recordStepFailedTelemetry=function(l,d,p){u[l].status=\"Failed\",u[l].t=d,u[l].reason=(0,g.getPrintableObject)(p)};return{execute:function(f,m){return p(d,void 0,void 0,(function(){var d,p,v,y,S;return h(this,(function(h){switch(h.label){case 0:d=l.createChild(\"[phase=\".concat(f,\"]\")),recordPhaseStep(f),d.info(\"started\"),p=(new Date).getTime(),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,m()];case 2:return v=h.sent(),S=+new Date-p,d.logSuccess(\"done, time=\".concat(S)),recordStepDoneTelemetry(f,S),[2,v];case 3:throw y=h.sent(),S=+new Date-p,d.logFailure(\"time=\".concat(S,\", error=\").concat((0,g.getPrintableObject)(y))),recordStepFailedTelemetry(f,S,y),{phase:f,error:y,phases:u};case 4:return[2]}}))}))},executeSync:function(d,p){var h=l.createChild(\"[phase=\".concat(d,\"]\"));h.info(\"started\"),recordPhaseStep(d);var f=(new Date).getTime();try{var m=p(),v=+new Date-f;return recordStepDoneTelemetry(d,v),h.logSuccess(\"done, time=\".concat(v)),m}catch(l){v=+new Date-f;throw h.logFailure(\"time=\".concat(v,\", error=\").concat((0,g.getPrintableObject)(l))),recordStepFailedTelemetry(d,v,l),{phase:d,error:l,phases:u}}},getTelemetryData:function(){return u}}}d.isPhaseError=isPhaseError,d.default=createPhaseExecutor},function(l,d,u){var p;function callStateIsAnyOf(l,d){return-1!==d.indexOf(l)}Object.defineProperty(d,\"__esModule\",{value:!0}),d.validStateTransitions=d.callStateIsAnyOf=void 0,d.callStateIsAnyOf=callStateIsAnyOf,d.validStateTransitions=((p={})[0]=[1,2,8,6,10,11,9],p[1]=[2,6,7,10,13],p[2]=[1,3,6,7,9,10,13,14],p[3]=[6,7,4,5,10,13],p[8]=[1,11,10,2,9,6,7],p[4]=[6,7,3,5,10,13],p[5]=[6,7,3,4,10,13],p[9]=[3,6,7,10,13],p[10]=[3,6,7,9,4,5,13,15],p[13]=[3,6,7,4,5],p[14]=[3,6,7,10,13],p[15]=[3,6,7,4,5,13],p[11]=[12,1,2,6,7],p[12]=[2,6,7],p[6]=[7],p[7]=[],p)},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.scrubAddParticipantPayload=d.scrubITransferContext=d.scrubSignalingParticipant=void 0;var p=u(33),h=u(8),g=u(17);function scrub(l,d,u,h){var g=JSON.stringify(l),f=JSON.parse(g);return f&&(scrubOneTypeOfParams(l,f,d,p.pii.Omit),scrubOneTypeOfParams(l,f,u,p.pii.Mri),scrubOneTypeOfParams(l,f,h,p.pii.UserName)),JSON.stringify(f)}function scrubOneTypeOfParams(l,d,u,p){u&&h.each(u,(function(u){l[u]&&(d[u]=p(l[u]))}))}function scrubSignalingParticipant(l){return\"id=\".concat(p.pii.Mri(l.id),\", participantId=\").concat(l.participantId)}function scrubITransferContext(l){return scrub(l,[],[\"transferorMri\",\"targetMri\"])}function scrubAddParticipantPayload(l){var d=\"payload: \";if(l.participants){if(l.participants.from){var u=l.participants.from;d+=\"from: \".concat(scrub(u,[\"id\"],[],[\"displayName\"]),\", to: \")}if(l.participants.to){var f=l.participants.to;h.each(f,(function(l){var u=scrub(l,[\"id\",\"assertedId\"],[],[\"displayName\"]);d+=\"\".concat(u,\", \")}))}}return l.groupId&&(d+=\"groupId: \".concat((0,g.scrubMriOrOmit)(l.groupId),\", \")),l.threadId&&(d+=\"threadId: \".concat((0,g.getLoggableThreadId)(l.threadId),\", \")),l.messageId&&(d+=\"messageId: \".concat(l.messageId,\", \")),l.sipUri&&(d+=\"sipUri: \".concat(l.sipUri,\", \")),l.participantInvitationData&&(d+=\"participantInvitationData: \".concat(p.pii.Omit(l.participantInvitationData),\", \")),l.links&&(d+=\"links: \".concat(JSON.stringify(l.links))),l.alternateId&&(d+=\"alternateId: \".concat(p.pii.Omit(l.alternateId))),d}d.scrubSignalingParticipant=scrubSignalingParticipant,d.scrubITransferContext=scrubITransferContext,d.scrubAddParticipantPayload=scrubAddParticipantPayload},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=function(l){function AudioStream(){return null!==l&&l.apply(this,arguments)||this}return p(AudioStream,l),AudioStream}(u(78).default);d.default=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(62),m=function(l){function ImageStream(d,u,p,h){var g=l.call(this,void 0,d,u)||this;return g.frameUris=p,g.imageRenderingSession=h,g.type=1,g.renderers=[],g.imageRendererId=0,g}return p(ImageStream,l),Object.defineProperty(ImageStream.prototype,\"mediaSourceId\",{get:function(){return this.id},enumerable:!1,configurable:!0}),ImageStream.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,msi:this.mediaSourceId,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming})},ImageStream.prototype.stop=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){return this.dispose(),[2,Promise.resolve()]}))}))},ImageStream.prototype.start=function(l){return h(this,void 0,void 0,(function(){var d,u=this;return g(this,(function(p){return this.imageRenderingSession?(this.imageRendererId++,this.logger.info(\"Image stream start stream id:\".concat(this.id,\", imageRendererId: \").concat(this.imageRendererId)),d=new f.RemoteImageRenderer(this.imageRenderingSession,l,this.imageRendererId),this.renderers.push(d),[2,d.start(this.frameUris).catch((function(l){throw u.logger.error(\"Failed starting renderer, stream id:\".concat(u.id,\", imageRendererId: \").concat(u.imageRendererId,\": \").concat(l)),l})).then((function(){return u.isStreaming=!0,d}))]):[2,Promise.reject(\"imageRenderingSession not passed, id: \".concat(this.id))]}))}))},ImageStream.prototype.dispose=function(){var d=this;l.prototype.dispose.call(this),this.isStreaming=!1,this.renderers.forEach((function(l){try{l.dispose()}catch(l){d.logger.error(\"Failed disposing renderer, stream id:\".concat(d.id,\": \").concat(l))}})),this.renderers=[]},ImageStream}(u(78).default);d.default=m},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=function(l){function SharingStream(d,u,p,h,g){var f=l.call(this,d,u,p,h,g)||this;return f.type=1,f}return p(SharingStream,l),SharingStream}(u(119).default);d.default=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},g=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},f=this&&this.__param||function(l,d){return function(u,p){d(u,p,l)}};Object.defineProperty(d,\"__esModule\",{value:!0});var m=u(18),v=u(41),y=u(13),S=u(71),_=u(72),C=u(55),E=function(l){function PluginlessContentSharingSession(d,u,p,h,g,f,m,v){void 0===f&&(f=\"\");var y=l.call(this)||this;return y.callTelemetry=d,y.signalingSession=p,y.contentSharingGuid=h,y.contentSharingIdentity=g,y.state=f,y.subject=m,y.handleOperationFailure=function(l,d,u){u.logFailure(l);var p=y.getTerminatedReasonFromError(l);return d.updateStatusTo&&(y.contentSharingStatus=d.updateStatusTo,y.rejectContentSharing(p)),Promise.reject(p)},y._logger=u.createChild((function(){return\"[ContentSharingSession][\".concat(y.contentSharingGuid,\"]\")})),y.contentSharingStatus=0,y.contentSharingTerminationReason=null,y.contentSharingState=f,y._callOperationHandler=new _.default(y._logger,y.callTelemetry),v&&(y.sessionId=v),y}return p(PluginlessContentSharingSession,l),Object.defineProperty(PluginlessContentSharingSession.prototype,\"contentSharingStatus\",{get:function(){return this.status},set:function(l){if(this._logger.info(\"[set contentSharingStatus][currentStatus=\".concat(this.status,\"][newStatus=\").concat(l,\"]\")),this.callTelemetry.recordEvent(v.CONTENT_SHARING_OPERATIONS_INTERNAL.SET_CONTENT_SHARING_STATUS,{newStatus:l,oldStatus:this.status}),this.status!==l&&7!==this.status&&8!==this.status){if(this._logger.info(\"[set contentSharingStatus] Changing content sharing status to: \".concat(l)),this.status=l,7===this.status){var d={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:\"[set contentSharingStatus] Content sharing is disconnected\"};this._callOperationHandler.maybeResolveOperation(v.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),this._callOperationHandler.rejectPendingOperations(d)}if(2===this.status||5===this.status){d={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:\"Content sharing cannot be ended when not presenting\"};this._callOperationHandler.maybeRejectOperation(v.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,d)}3===this.status&&(this._callOperationHandler.maybeResolveOperation(v.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),this._callOperationHandler.maybeResolveOperation(v.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)),this.raiseChanged()}},enumerable:!1,configurable:!0}),Object.defineProperty(PluginlessContentSharingSession.prototype,\"contentSharingState\",{get:function(){return this.state},set:function(l){this.state!==l&&(this.state=l,this.raiseChanged())},enumerable:!1,configurable:!0}),PluginlessContentSharingSession.prototype.startContentSharing=function(l){var d=this;void 0===l&&(l=(0,y.generateCauseId)());var u=this._logger.createFnLogger(v.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING,l);if(0!==this.contentSharingStatus){var p=\"[\".concat(l,\"][startContentSharing][failed][reason=InvalidState]\"),h={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:p};return u.logFailure(\"state=\".concat(this.contentSharingStatus,\", reason=\").concat(p)),Promise.reject(h)}return this.signalingSession.startContentSharingAsync(this.contentSharingIdentity,this.contentSharingState,this.subject,this.contentSharingGuid,l).then((function(l){d.sessionId=l.sessionId,d.contentSharingStatus=3,d.presenterId=d.signalingSession.participantManager.localParticipant.id})).catch((function(p){return d.handleOperationFailure(p,{causeId:l,operation:v.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING,updateStatusTo:8},u)})),this._callOperationHandler.waitForOperation(v.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING)},PluginlessContentSharingSession.prototype.joinContentSharing=function(l){var d=this;void 0===l&&(l=(0,y.generateCauseId)());var u=this._logger.createFnLogger(v.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING,l);if(2!==this.contentSharingStatus){var p=\"[\".concat(l,\"][joinContentSharing][failed][reason=InvalidState]\"),h={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:p};return u.logFailure(\"state=\".concat(this.contentSharingStatus,\", reason=\").concat(p)),Promise.reject(h)}return this.signalingSession.joinContentSharingAsync(this.contentSharingGuid,l).then((function(l){return d.contentSharingStatus=4,d.contentSharingState=l.sessionState,d.presenterId=l.presenter,Promise.resolve()})).catch((function(p){return d.handleOperationFailure(p,{causeId:l,operation:v.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING,updateStatusTo:8},u)}))},PluginlessContentSharingSession.prototype.updateContentSharingSessionState=function(l,d,u){var p=this;void 0===u&&(u=(0,y.generateCauseId)());var h=this._logger.createFnLogger(v.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,u);if(3!==this.contentSharingStatus){var g=\"[\".concat(u,\"][updateContentSharingSessionState][failed][reason=InvalidState]\"),f={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:g};return h.logFailure(\"state=\".concat(this.contentSharingStatus,\", reason=\").concat(g)),Promise.reject(f)}return this.signalingSession.updateContentSharingSessionStateAsync(this.contentSharingGuid,d,u).then((function(){return Promise.resolve()})).catch((function(d){return p.handleOperationFailure(d,{causeId:u,operation:v.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,operationId:l},h)}))},PluginlessContentSharingSession.prototype.takeContentSharingControl=function(l){var d=this;void 0===l&&(l=(0,y.generateCauseId)());var u=this._logger.createFnLogger(v.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL,l);if(5!==this.contentSharingStatus){var p=\"[\".concat(l,\"][updateContentSharingSessionState][failed][reason=InvalidState]\"),h={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:p};return u.logFailure(\"state=\".concat(this.contentSharingStatus,\", reason=\").concat(p)),Promise.reject(h)}return this.signalingSession.takeContentSharingControlAsync(this.contentSharingGuid,l).then((function(){d.contentSharingStatus=3,d.presenterId=d.signalingSession.participantManager.localParticipant.id})).catch((function(p){return d.handleOperationFailure(p,{causeId:l,operation:v.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL},u)})),this._callOperationHandler.waitForOperation(v.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL)},PluginlessContentSharingSession.prototype.updateContentSharingParticipantStateToViewer=function(l){var d=this;void 0===l&&(l=(0,y.generateCauseId)());var u=this._logger.createFnLogger(v.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE,l);if(4!==this.contentSharingStatus){var p=\"[\".concat(l,\"][updateContentSharingSessionState][failed][reason=InvalidState]\"),h={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:p};return u.logFailure(\"state=\".concat(this.contentSharingStatus,\", reason=\").concat(p)),Promise.reject(h)}return this.signalingSession.updateContentSharingParticipantStateAsync(this.contentSharingGuid,l).then((function(){return d.contentSharingStatus=d.presenterId===d.signalingSession.participantManager.localParticipant.id?3:5,Promise.resolve()})).catch((function(p){return d.handleOperationFailure(p,{causeId:l,operation:v.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE},u)}))},PluginlessContentSharingSession.prototype.stopContentSharing=function(l){var d=this;void 0===l&&(l=(0,y.generateCauseId)());var u=this._logger.createFnLogger(v.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,l);if(2===this.contentSharingStatus||4===this.contentSharingStatus||5===this.contentSharingStatus){var p=\"[\".concat(l,\"][stopContentSharing][failed][reason=InvalidState]\"),h={terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:p};return u.logFailure(\"state=\".concat(this.contentSharingStatus,\", reason=\").concat(p)),Promise.reject(h)}return this.signalingSession.deleteContentSharingAsync(this.contentSharingGuid,l).then((function(){return d.contentSharingStatus=7,d._callOperationHandler.waitForOperation(v.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)})).catch((function(p){return d.handleOperationFailure(p,{causeId:l,operation:v.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING},u)}))},PluginlessContentSharingSession.prototype.dispose=function(d){void 0===d&&(d=(0,y.generateCauseId)());var u={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:\"Call ended\"};this._callOperationHandler.rejectPendingOperations(u,d),this.contentSharingStatus=7,this.contentSharingState=\"\",l.prototype.dispose.call(this)},PluginlessContentSharingSession.prototype.rejectContentSharing=function(l){if(void 0===l&&(l={terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:\"[rejectContentSharing] Content sharing is disconnected\"}),7!==this.status&&8!==this.status)throw new Error(\"Tried to reject content sharing with status=\".concat(this.status));this._callOperationHandler.maybeResolveOperation(v.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING),this._callOperationHandler.rejectPendingOperations(l)},PluginlessContentSharingSession.prototype.getTerminatedReasonFromError=function(l){var d=l&&l.endCode&&l.endCode.code||0,u={terminatedReason:32,terminatedReasonCode:d,terminatedReasonSubCode:l&&l.endCode&&l.endCode.subCode||0,errorMessage:l};switch(d){case C.jsCallEndCodes.NotFound:u.terminatedReason=34,u.errorMessage=\"Active session not found on server\";break;case C.jsCallEndCodes.Forbidden:u.terminatedReason=8,u.errorMessage=\"Failed due to insufficient permissions\"}return u},h([(0,S.callOperation)(v.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),f(0,S.causeId),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],PluginlessContentSharingSession.prototype,\"startContentSharing\",null),h([(0,S.callOperation)(v.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),f(0,S.causeId),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],PluginlessContentSharingSession.prototype,\"joinContentSharing\",null),h([(0,S.callOperation)(v.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE),f(0,S.operationId),f(2,S.causeId),g(\"design:type\",Function),g(\"design:paramtypes\",[String,String,Object]),g(\"design:returntype\",Promise)],PluginlessContentSharingSession.prototype,\"updateContentSharingSessionState\",null),h([(0,S.callOperation)(v.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),f(0,S.causeId),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],PluginlessContentSharingSession.prototype,\"takeContentSharingControl\",null),h([(0,S.callOperation)(v.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),f(0,S.causeId),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],PluginlessContentSharingSession.prototype,\"updateContentSharingParticipantStateToViewer\",null),h([(0,S.callOperation)(v.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,{waitFor:v.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING}),f(0,S.causeId),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],PluginlessContentSharingSession.prototype,\"stopContentSharing\",null),PluginlessContentSharingSession}(m.default);d.default=E},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},m=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.PluginlessDataChannel=void 0;var v=u(13),y=u(57),S=function(l){function PluginlessDataChannel(d,u){var p=l.call(this)||this;return p.configProvider=u,p.mainChannel=null,p.sourceId=y.DATA_SOURCE_ID_ANY,p._state=\"Inactive\",p.dataHandlers=new Map,p.dataHandlerTelemetry=new Map,p.startTime=Date.now(),p.configProviderView=p.configProvider.getConfigView(!1),p.sendMessage=function(l,d,u){return h(p,void 0,void 0,(function(){return g(this,(function(p){if(this.logger.debug(\"Sending message for \".concat(l,\", from: \").concat(this.sourceId,\" to: \").concat(u,\" state: \").concat(!!this.mainChannel&&this.mainChannel.state,\" len: \").concat(d.length)),!this.mainChannel||\"Connected\"!==this.mainChannel.state||\"Active\"!==this.state)throw new Error(\"No active data channel to send data from\");return this.mainChannel.sendMessage(l,this.sourceId,d,u),[2]}))}))},p.logger=d.createChild(\"PluginlessDataChannel\"),p}return p(PluginlessDataChannel,l),Object.defineProperty(PluginlessDataChannel.prototype,\"state\",{get:function(){return this._state},enumerable:!1,configurable:!0}),PluginlessDataChannel.prototype.registerSessionDataChannel=function(l,d){this.sessionDataChannel&&this.stop(d),this.sessionDataChannel=l,this.subscribeForSessionDataChannelEvents()},PluginlessDataChannel.prototype.setDataChannelSourceId=function(l){this.logger.debug(\"setDataChannelSourceId \".concat(l)),this.sourceId=l},PluginlessDataChannel.prototype.requestDataChannelHandler=function(l){return this.sessionDataChannel.getDataChannel(l)},PluginlessDataChannel.prototype.sendUserEvents=function(l,d){return h(this,void 0,void 0,(function(){var u;return g(this,(function(p){if(!this.mainChannel)throw this.logger.info(\"sendUserEvents() no data channel available\"),new Error(\"Main DataChannel is not active\");return u=d?d.map((function(l){return parseInt(l,10)})):[],this.mainChannel.sendMessage(0,this.sourceId,(new TextEncoder).encode(l),u),[2]}))}))},PluginlessDataChannel.prototype.addHandler=function(l,d){return h(this,void 0,void 0,(function(){var u;return g(this,(function(p){if(this.logger.info(\"Adding handler with dataId \".concat(l)),this.dataHandlers.get(l))throw new Error(\"Data Id \".concat(l,\" is already registered\"));return u={isStarted:!1,handler:d},this.dataHandlers.set(l,u),this.recordDataHandlerEvent(l,\"added\"),this.mainChannel&&\"Connected\"===this.mainChannel.state&&this.startHandler(l,u),[2]}))}))},PluginlessDataChannel.prototype.removeHandler=function(l){return h(this,void 0,void 0,(function(){var d;return g(this,(function(u){if(this.logger.info(\"Removing handler with dataId \".concat(l)),!this.dataHandlers.has(l))throw new Error(\"Handler associated with Data Id \".concat(l,\" is not attached\"));return(d=this.dataHandlers.get(l)).isStarted&&this.stopHandler(l,d),this.dataHandlers.delete(l),[2]}))}))},PluginlessDataChannel.prototype.updateNegotiationTag=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(l){return[2]}))}))},PluginlessDataChannel.prototype.getTelemetry=function(){var l,d;if(!this.dataHandlerTelemetry.size)return\"\";var u={};try{for(var p=f(this.dataHandlerTelemetry),h=p.next();!h.done;h=p.next()){var g=m(h.value,2),v=g[0],y=g[1];u[v]=y}}catch(d){l={error:d}}finally{try{h&&!h.done&&(d=p.return)&&d.call(p)}finally{if(l)throw l.error}}return JSON.stringify(u)},PluginlessDataChannel.prototype.start=function(l){this.mainChannel?this.logger.info(\"[\".concat(l,\"] already started\")):(this.logger.info(\"[\".concat(l,\"] starting\")),this.mainChannel=this.sessionDataChannel.getDataChannel(l),this.subscribeForMainDataChannelEvents())},PluginlessDataChannel.prototype.stop=function(l){this.mainChannel&&(this.logger.info(\"[\".concat(l,\"] stopping\")),this.mainChannel.dispose(),this.mainChannel=null)},PluginlessDataChannel.prototype.dispose=function(){this.stop(void 0),this.sessionDataChannel=null,l.prototype.dispose.call(this)},PluginlessDataChannel.prototype.setMultiparty=function(l){this.configProviderView=this.configProvider.getConfigView(l)},PluginlessDataChannel.prototype.subscribeForMainDataChannelEvents=function(){var l=this;this.mainChannel.on(\"onmessage\",(function(d,u,p){l.logger.debug(\"Got message for \".concat(d,\", from: \").concat(u,\" state: \").concat(!!l.mainChannel&&l.mainChannel.state,\", len: \").concat(p.length)),l.dataHandlers.has(d)&&(l.recordDataHandlerEvent(d,\"recvd\"),l.dataHandlers.get(d).handler.onDataReceived(d,p,u)),l.event(\"remoteUserEventsReceived\").raise(d.toString(),(new TextDecoder).decode(p))})),this.onMainChannelStateChanged(),this.mainChannel.on(\"onStateChanged\",(function(){return l.onMainChannelStateChanged()}))},PluginlessDataChannel.prototype.onMainChannelStateChanged=function(){if(this.mainChannel)switch(this.mainChannel.state){case\"Connected\":this.startHandlers();break;case\"Closed\":case\"Destroyed\":this.stopHandlers()}},PluginlessDataChannel.prototype.startHandlers=function(){var l,d;try{for(var u=f(this.dataHandlers.entries()),p=u.next();!p.done;p=u.next()){var h=m(p.value,2),g=h[0],v=h[1];v.isStarted||this.startHandler(g,v)}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}},PluginlessDataChannel.prototype.stopHandlers=function(){var l,d;try{for(var u=f(this.dataHandlers.entries()),p=u.next();!p.done;p=u.next()){var h=m(p.value,2),g=h[0],v=h[1];v.isStarted&&this.stopHandler(g,v)}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}},PluginlessDataChannel.prototype.startHandler=function(l,d){var u=this;this.logger.info(\"Starting dataHandler id: \".concat(l)),d.handler.onStarted(l,(function(d,p){return u.recordDataHandlerEvent(l,\"sent\"),u.sendMessage(l,d,p)})),d.isStarted=!0,this.recordDataHandlerEvent(l,\"started\")},PluginlessDataChannel.prototype.stopHandler=function(l,d){this.logger.info(\"Stopping dataHandler id: \".concat(l)),d.handler.onStopped(l),d.isStarted=!1,this.recordDataHandlerEvent(l,\"removed\")},PluginlessDataChannel.prototype.subscribeForSessionDataChannelEvents=function(){var l=this;this.sessionDataChannel.on(\"onStateChanged\",(function(d){var u=(0,v.generateCauseId)();switch(d){case\"Active\":l.start(u),l.setState(\"Active\");break;case\"Inactive\":l.stop(u),l.setState(\"Inactive\");break;case\"Failed\":l.stop(u),l.setState(\"Failed\");break;default:l.logger.warn(\"[\".concat(u,\"] unhandled SessionDataChannelState \").concat(d))}}))},PluginlessDataChannel.prototype.recordDataHandlerEvent=function(l,d){var u,p=this.dataHandlerTelemetry.get(l);switch(p?u=p[p.length-1]:(p=[u={}],this.dataHandlerTelemetry.set(l,p)),\"added\"===d&&void 0!==u.added&&(u={},p.push(u),p.length>this.configProviderView.config.maxStoredDataChannelValues&&p.shift()),d){case\"added\":case\"started\":case\"removed\":u[d]=Date.now()-this.startTime;break;case\"recvd\":case\"sent\":u[d]=isNaN(u[d])?1:u[d]+1}},PluginlessDataChannel.prototype.setState=function(l){this._state!==l&&(this._state=l,this.logger.info(\"PluginlessDataChannelState changed, state=\".concat(this._state)),this.event(\"onDataChannelStateUpdated\").raise(this._state))},PluginlessDataChannel}(u(18).default);d.PluginlessDataChannel=S},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.PluginlessScreenSharingControl=d.bufferToString=void 0;var f=u(19),m=u(18),v=u(46),y=u(307),S=u(120),_=u(309),C=u(121),E=function(){function ControlInjectorAdapter(l){var d=this;this.logger=l,this.activeSourceId=0,this.edgeVirtualInputSupported=!1,this.pendingPointerImages=new Map,this.logger.info(\"ControlInjectorAdapter\"),\"EdgeAnaheim\"===(0,f.getBrowserInfo)().name&&(0,C.sendIsVirtualInputSupportedMessage)(l).then((function(u){d.edgeVirtualInputSupported=u,l.info(\"ControlInjectorAdapter - Edge supports virtual input device: \".concat(JSON.stringify(d.edgeVirtualInputSupported)))})).catch((function(d){l.error(\"ControlInjectorAdapter - Edge IsVirtualInputSupported error \".concat(JSON.stringify(d)))}))}return ControlInjectorAdapter.prototype.enableInjector=function(l){var d=this;if(this.injector)return this.logger.error(\"Control injector already present\"),Promise.reject();if(\"EdgeAnaheim\"===(0,f.getBrowserInfo)().name){if(!this.edgeVirtualInputSupported)return this.logger.info(\"ControlInjectorAdapter - Edge doesn't support give control\"),Promise.reject();var onInitErrorCallback=function(){return d.disableInjector(),d.logger.error(\"ControlInjectorAdapter - An error occured, control injector is disabled.\"),Promise.reject()};this.injector=new _.EdgeControlInjector(this.logger,l,onInitErrorCallback),this.logger.info(\"ControlInjectorAdapter - Edge ControlInjector created\")}else window.ControlInjector&&(this.injector=window.ControlInjector(l),this.logger.info(\"ControlInjectorAdapter - Window ControlInjector created\"));return this.pendingPointerImages.forEach((function(l,u){d.injector.setAvatar(u,l)})),this.pendingPointerImages.clear(),Promise.resolve()},ControlInjectorAdapter.prototype.disableInjector=function(){return this.injector?(this.logger.info(\"ControlInjectorAdapter - ControlInjector disposed\"),this.injector.dispose(),this.injector=null,Promise.resolve()):(this.logger.error(\"Control injector not present\"),Promise.reject())},ControlInjectorAdapter.prototype.setPointerImage=function(l,d){var u=this;return this.injector?new Promise((function(p){u.injector.setAvatar(l,d),p()})):(this.pendingPointerImages.set(l,d),Promise.resolve())},ControlInjectorAdapter.prototype.showVirtualCursor=function(l){var d=this;return this.logger.info(\"ControlInjectorAdapter - showVirtualCursor \".concat(l,\" \").concat(this.activeSourceId)),this.injector?new Promise((function(u){l?(d.activeSourceId&&d.injector.showVirtualCursor(d.activeSourceId,!1),d.injector.showVirtualCursor(l,!0),d.activeSourceId=l):d.activeSourceId&&(d.injector.showVirtualCursor(d.activeSourceId,!1),d.activeSourceId=0),u()})):(this.logger.error(\"Control injector not present\"),Promise.reject())},ControlInjectorAdapter.prototype.injectRawInput=function(l,d){var u=this;if(!this.injector)return this.logger.error(\"Control injector not present\"),Promise.reject();var p=this.injector;return new Promise((function(h,g){var f,m,v=S.ScreenSharingControlProtocol.decodeEventType(l);switch(v){case 1:f=S.ScreenSharingControlProtocol.decodeMouseEvent(l),p.injectMouseEvent(d,f).then((function(l){return 0===l?h():g()}));break;case 0:m=S.ScreenSharingControlProtocol.decodeKeyboardEvent(l),p.injectKeyboardEvent(d,m).then((function(l){return 0===l?h():g()}));break;default:u.logger.error(\"Invalid event type in raw input: \".concat(v)),g()}}))},ControlInjectorAdapter.prototype.canBeEnabled=function(){return\"EdgeAnaheim\"===(0,f.getBrowserInfo)().name?this.edgeVirtualInputSupported:!!window.ControlInjector},ControlInjectorAdapter}(),T=function(){function RendererAdapter(l){this.logger=l,this.logger.info(\"RendererAdapter\")}return RendererAdapter.prototype.getTarget=function(l){return l.target},RendererAdapter.prototype.subscribeVideoSizeChangedEvent=function(l,d){var u=l;return u.streamSize&&d(u.streamSize.width,u.streamSize.height),u.renderer.on(\"onVideoSizeChanged\",d)},RendererAdapter.prototype.subscribeRenderStartedEvent=function(l,d){return l.renderer.on(\"onVideoStarted\",(function(l,u){return d()}))},RendererAdapter}();function bufferToString(l){return String.fromCharCode.apply(null,l)}d.bufferToString=bufferToString;var b=function(l){function DataChannelAdapter(d,u){var p=l.call(this)||this;return p.logger=d,p._call=u,p}return p(DataChannelAdapter,l),DataChannelAdapter.prototype.isActive=function(){return!(!this.protocolSendFunc||!this.controlSendFunc)},DataChannelAdapter.prototype.sendProtocolMessage=function(l,d){return this.protocolSendFunc?this.protocolSendFunc(l,d):(this.logger.error(\"Cannot send protocol message, ProtocolHandler hasn't started\"),Promise.resolve())},DataChannelAdapter.prototype.sendControlMessage=function(l,d){return this.controlSendFunc?this.controlSendFunc(l,d):(this.logger.error(\"Cannot send control message, ControlHandler hasn't started\"),Promise.resolve())},DataChannelAdapter.prototype.getProtocolHandler=function(){var l=this;return{onStarted:function(d,u){return h(l,void 0,void 0,(function(){return g(this,(function(l){return this.logger.info(\"ProtocolHandler started for \".concat(d)),this.protocolSendFunc=u,this.isActive()&&this.event(\"stateChange\").raise(!0),[2]}))}))},onStopped:function(d){return h(l,void 0,void 0,(function(){var l;return g(this,(function(u){return this.logger.info(\"ProtocolHandler stopped for \".concat(d)),l=this.isActive(),this.protocolSendFunc=null,l&&this.event(\"stateChange\").raise(!1),[2]}))}))},onDataReceived:function(d,u,p){return h(l,void 0,void 0,(function(){var l,h,f;return g(this,(function(g){return 1===d?(l=JSON.parse(bufferToString(u)),h=this._call.mapDataChannelSourceIdToParticipant(p),f=void 0,h&&(f=v.getParticipantIdForSourceId(h,3,p)),[2,this.event(\"protocolMessage\").raise(l.message,h,f,p)]):[2]}))}))}}},DataChannelAdapter.prototype.getControlHandler=function(){var l=this;return{onStarted:function(d,u){return h(l,void 0,void 0,(function(){return g(this,(function(l){return this.logger.info(\"ControlHandler started for \".concat(d)),this.controlSendFunc=u,this.isActive()&&this.event(\"stateChange\").raise(!0),[2]}))}))},onStopped:function(d){return h(l,void 0,void 0,(function(){var l;return g(this,(function(u){return this.logger.info(\"ControlHandler stopped for \".concat(d)),l=this.isActive(),this.controlSendFunc=null,l&&this.event(\"stateChange\").raise(!1),[2]}))}))},onDataReceived:function(d,u,p){return h(l,void 0,void 0,(function(){return g(this,(function(l){return 2===d?[2,this.event(\"controlMessage\").raise(u,p)]:[2]}))}))}}},DataChannelAdapter}(m.default),I=function(l){function PluginlessScreenSharingControl(d,u,p,h){var g=l.call(this,d.createChild(\"ScreenSharingControl\"),p,h)||this;g.dataChannel=u;var f=new E(g._logger),m=new T(g._logger),v=new b(g._logger,p);return g.setAdapters(f,m,v),g}return p(PluginlessScreenSharingControl,l),PluginlessScreenSharingControl.prototype.setupDataHandlers=function(){this.dataChannel.addHandler(1,this.getProtocolHandler()),this.dataChannel.addHandler(2,this.getControlHandler())},PluginlessScreenSharingControl.prototype.startOrStopControlForViewer=function(l,d,u){l&&u&&\"nonInteractive\"!==u.appliedInteractivityLevel?d&&0===this.role&&this.initControlForViewer(d):2===this.role&&this.shutdownControlForViewer()},PluginlessScreenSharingControl.prototype.getProtocolHandler=function(){return this._dataChannelAdapter.getProtocolHandler()},PluginlessScreenSharingControl.prototype.getControlHandler=function(){return this._dataChannelAdapter.getControlHandler()},PluginlessScreenSharingControl}(y.ScreenSharingControl.ControlBase);d.PluginlessScreenSharingControl=I},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.ScreenSharingControl=void 0;var m=u(308),v=u(120),y=u(8),S=u(40),_=u(53),C=u(56),E=u(17),T=u(34),b=u(33),I=u(13),A=u(57),R=u(58),P=u(18),O=u(46),M=u(35),w=3e4,N=1e4,D=2e3,L=6,k=\"\";!function(l){var d,u;!function(l){l.INITIATED=\"Initiated\",l.CALL_STATE=\"CallState\",l.SHARING_STARTED=\"SharingStarted\",l.DATA_CHANNEL_AVAILABLE=\"DataChannelAvailable\",l.DATA_CHANNEL_UNAVAILABLE=\"DataChannelUnavailable\",l.CONTROL_GIVEN=\"ControlGiven\",l.CONTROL_REQUEST=\"ControlRequest\",l.AVAILABLE_HANDSHAKE=\"AvailableHandshake\",l.SESSION_SHUTDOWN=\"Shutdown\",l.SESSION_SHUTDOWN_BY_ANOTHER_SESSION=\"ShutdownByOtherSession\"}(d||(d={})),function(l){l.INITIATED=\"Initiated\",l.CALL_STATE=\"CallState\",l.DATA_CHANNEL_AVAILABLE=\"DataChannelAvailable\",l.DATA_CHANNEL_UNAVAILABLE=\"DataChannelUnavailable\",l.GIVE_CONTROL=\"GiveControl\",l.CONTROL_REQUEST=\"ControlRequest\",l.SESSION_SHUTDOWN=\"Shutdown\",l.SESSION_SHUTDOWN_BY_ANOTHER_SESSION=\"ShutdownByOtherSession\",l.AVAILABLE_ACK_ENABLED=\"AvailableAckEnabled\",l.AVAILABLE_ACK_DISABLED=\"AvailableAckDisabled\"}(u||(u={}));var x=function(l){function ControlSessionTelemetryBase(d,u,p,h,g,f){var m=l.call(this,d,u,(function(){return m.recordedEvents.length>100}))||this;return m.negotiationTag=p,m.callId=h,m.participantId=g,m.endpointId=f,m.messagesFromUnknownSender={},m.tsCallingVersion=(0,T.getTsCallingVersion)(),m}return p(ControlSessionTelemetryBase,l),ControlSessionTelemetryBase.prototype.recordProtocolMessage=function(l,d){l||(d in this.messagesFromUnknownSender||(this.messagesFromUnknownSender[d]=0),this.messagesFromUnknownSender[d]++)},ControlSessionTelemetryBase.prototype.setCallId=function(l){this.callId=l},ControlSessionTelemetryBase.prototype.setEndpointId=function(l){this.endpointId=l},ControlSessionTelemetryBase.prototype.setParticipantId=function(l){this.participantId=l},ControlSessionTelemetryBase.prototype.setTenantId=function(l){this.tenantId=l},ControlSessionTelemetryBase.prototype.setUserHexCID=function(l){this.userHexCID=l},ControlSessionTelemetryBase}(_.TelemetryUtilities),F=function(l){function ViewerControlSessionTelemetry(d,u,p,h,g,f,m){var v=l.call(this,d,u,p,h,g,f)||this,S=O.getSharingParticipantLeg(m);if(S){v.sharerParticipantId=S;var _=y.find(m.endpoints.endpointDetails,(function(l){return l.participantId===S}));_&&(v.sharerClientVersion=_.clientVersion)}return v}return p(ViewerControlSessionTelemetry,l),ViewerControlSessionTelemetry.prototype.getEvent=function(d,u){var getValue=function(l){return void 0===l?\"\":l};return{CorrelationId:getValue(this.callId),ParticipantId:getValue(this.participantId),EndpointId:getValue(this.endpointId),NegotiationTag:getValue(this.negotiationTag),TsCallingVersion:getValue(this.tsCallingVersion),TenantId:getValue(this.tenantId),SharerParticipantId:getValue(this.sharerParticipantId),SharerClientVersion:getValue(this.sharerClientVersion),EventTimestampBag:l.prototype.getEventTimestampBag.call(this,d,u),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},ViewerControlSessionTelemetry}(x),U=function(l){function SharerControlSessionTelemetry(d,u,p,h,g,f){return l.call(this,d,u,p,h,g,f)||this}return p(SharerControlSessionTelemetry,l),SharerControlSessionTelemetry.prototype.getEvent=function(d,u){var getValue=function(l){return void 0===l?\"\":l};return{CorrelationId:getValue(this.callId),ParticipantId:getValue(this.participantId),EndpointId:getValue(this.endpointId),NegotiationTag:getValue(this.negotiationTag),TsCallingVersion:getValue(this.tsCallingVersion),TenantId:getValue(this.tenantId),EventTimestampBag:l.prototype.getEventTimestampBag.call(this,d,u),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},SharerControlSessionTelemetry}(x),j=function(l){function ControlBase(d,u,p){var h=l.call(this,d)||this;return h._logger=d,h._telemetryLoggers=p,h.controlState=0,h.role=0,h._enabled=!1,h._availableAckEnabled=!0,h._dataChannelActive=!1,h._dataChannelAvailableSent=!1,h._controlRequest=null,h._controlRequestSubscription=null,h._controllerParticipant=null,h._controllerParticipantSubscription=null,h._controllerSourceId=null,h._screenSharingVideoRenderer=null,h._screenSharingVideoRendererSubscriptions=[],h._sharerParticipant=null,h._pendingSharer=null,h._controlCapturer=null,h._captureEventSubscription=null,h._mouseControlEventSubscription=null,h._keyboardControlEventSubscription=null,h._requestControlTimer=null,h._grantControlTimer=null,h._acceptControlTimer=null,h._terminateControlTimer=null,h._availableAckTimer=null,h._retryAttempt=0,h._raiseRenderedAtViewer=null,h._participantSubscriptions={},h._viewerSessionLastTerminatedReason=0,h._completedViewerSessions=[],h.enableParticipantLegToSourceIdMapping=!0,h.giveControlEnabled=!0,h.isEscalationInProgress=!1,h._logger.info(\"constructor\"),h._callId=u.callId,u.on(\"callIdChanged\",(function(l){h._callId=l,h._currentViewerSessionTelemetry&&h._currentViewerSessionTelemetry.setCallId(l),h._currentSharerSessionTelemetry&&h._currentSharerSessionTelemetry.setCallId(l)})),h._participantId=u.participantId,u.on(\"callLegIdChanged\",(function(l){h._participantId=l,h._currentViewerSessionTelemetry&&h._currentViewerSessionTelemetry.setParticipantId(l),h._currentSharerSessionTelemetry&&h._currentSharerSessionTelemetry.setParticipantId(l)})),h._endpointId=u.endpointId,h}return p(ControlBase,l),ControlBase.prototype.setAdapters=function(l,d,u){var p=this;this._controlInjector=l,this._rendererAdapter=d,this._dataChannelAdapter=u,this._dataChannelAdapter.on(\"stateChange\",(function(l){p._onDataChannelStatusChanged(l)})),this._dataChannelAdapter.on(\"protocolMessage\",(function(l,d,u,h){return p.processProtocolMessage(l,d,u,h)})),this._dataChannelAdapter.on(\"controlMessage\",(function(l,d){return p.processControlMessage(l,d)}))},ControlBase.prototype.testSetControlInjector=function(l){},ControlBase.prototype.enableScreenSharingControl=function(l,d,p,h){if(this._availableAckEnabled!==l||this._allowControlForUser!==h){if(this._allowControlForUser=h,l)this._raiseScreenSharingControlCapableEvent(!0,k);else{if(0===d){var g={reason:2,detail:p};this.event(\"sharingControlError\").raise(g)}this._raiseScreenSharingControlCapableEvent(!1,k)}if(this._availableAckEnabled!==l){var f=l?u.AVAILABLE_ACK_ENABLED:u.AVAILABLE_ACK_DISABLED;this._recordSharerSessionTelemetry((function(l){return l.recordEvent(f)}),!1)}this._availableAckEnabled=l}},ControlBase.prototype.setGiveControlEnabled=function(l){this.giveControlEnabled=l},ControlBase.prototype.canEnableGiveControl=function(){return this._controlInjector.canBeEnabled()&&this.giveControlEnabled},ControlBase.prototype.setRaiseRenderedAtViewer=function(l){this._raiseRenderedAtViewer=l},ControlBase.prototype.setScreenSharingControlFeatureFlag=function(l){this._logger.info(\"_setScreenSharingControlFeatureFlag() enabled=\".concat(l)),this._enabled=l,this._availableAckEnabled=l,this._enabled&&this.handleCallState(this._callState)},ControlBase.prototype.isScreenSharingControlEnabled=function(){return this._enabled},ControlBase.prototype._disposeRenderer=function(l){var d,u;this._disposeControlCapturer(l);try{for(var p=f(this._screenSharingVideoRendererSubscriptions),h=p.next();!h.done;h=p.next()){h.value.dispose()}}catch(l){d={error:l}}finally{try{h&&!h.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}this._screenSharingVideoRendererSubscriptions=[],this._screenSharingVideoRenderer=null},ControlBase.prototype.setRenderer=function(l,d){var u=this;this._logger.info(\"setRenderer\");var p=(0,I.generateCauseId)();if(this._disposeRenderer(p),!l)return Promise.resolve();var h=d||this._rendererAdapter.getTarget(l);return S.asap((function(){u._setViewingRenderer(l,h)}))},ControlBase.prototype._raiseScreenSharingControlCapableEvent=function(l,d,u){if(this._enabled&&this._dataChannelAdapter.isActive()){this._logger.info(\"_raiseScreenSharingControlCapableEvent() enabled is true, raising control capability, capable=\".concat(l));var p={capable:l,id:d,disabledBySharer:u};this.event(\"sharingControlCapable\").raise(p)}else{this._logger.info(\"_raiseScreenSharingControlCapableEvent() enabled is false, disabling control capability\");p={capable:!1,id:d};this.event(\"sharingControlCapable\").raise(p)}},ControlBase.prototype.initControlForSharer=function(l,d){var u=this;this._logger.info(\"initControlForSharer()\"),this._isSharing()&&this._logger.warn(\"initControlForSharer() when already sharing\"),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this.role=1,this._dataChannelAvailableSent=!1,this.canEnableGiveControl()&&this._controlInjector.enableInjector(d).catch((function(l){var d={reason:0,detail:JSON.stringify({errorMsg:l})};u.event(\"sharingControlError\").raise(d)})),this._raiseScreenSharingControlCapableEvent(this.canEnableGiveControl(),k),this._initiateSharerSessionTelemetry(l)},ControlBase.prototype.shutdownControlForSharer=function(){var l=this;if(this._logger.info(\"shutdownControlForSharer()\"),this._isSharing()||this._logger.warn(\"shutdownControlForSharer() when not sharing\"),this._controlRequest){this._logger.warn(\"Rejecting pending control requests\");var d=this._getDataSourceIdForParticipantLeg(this._controlRequest),p=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(p),this._sendControlRejectRequest(5,d)}if(this.role=0,this._controllerParticipant){var h={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this.event(\"sharingControlChanged\").raise(h)}this._finalizeSharerSessionTelemetry(u.SESSION_SHUTDOWN),this._teardownSharerRemoteControl(),this._controlInjector.disableInjector().catch((function(d){var u={reason:0,detail:JSON.stringify({errorMsg:d})};l.event(\"sharingControlError\").raise(u)})),this._resetControlState(),this._resetParticipantSubscriptions(),this._availableAckEnabled=this._enabled},ControlBase.prototype._resetParticipantSubscriptions=function(){this._logger.info(\"resetParticipantSubscriptions() Stopping tracking all participant state changes\"),y.each(this._participantSubscriptions,(function(l){l.dispose()})),this._participantSubscriptions={}},ControlBase.prototype._initiateViewerSessionTelemetry=function(l,u,p){if(!p&&!u)return null;if(!p&&y.find(this._completedViewerSessions,(function(l){return u===l})))return null;if(this._currentViewerSessionTelemetry){if(this._currentViewerSessionTelemetry.negotiationTag===u)return null;this._finalizeViewerSessionTelemetry(d.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}return this._logger.info(\"Initiating new viewer session telemetry for \".concat(u)),this._currentViewerSessionTelemetry=new F(this._logger,(new Date).getTime(),u,this._callId,this._participantId,this._endpointId,l),this._currentViewerSessionTelemetry.recordEvent(d.CALL_STATE,{state:this._callState}),this._dataChannelAdapter.isActive()&&this._currentViewerSessionTelemetry.recordEvent(d.DATA_CHANNEL_AVAILABLE),this._currentViewerSessionTelemetry},ControlBase.prototype._recordViewerSessionTelemetry=function(l,d){void 0===d&&(d=!0),this._currentViewerSessionTelemetry?l&&l(this._currentViewerSessionTelemetry):d&&this._logger.error(\"Cannot record telemetry without current session\")},ControlBase.prototype._finalizeViewerSessionTelemetry=function(l){if(this._currentViewerSessionTelemetry){this._currentViewerSessionTelemetry.recordEvent(l);var d=this._currentViewerSessionTelemetry.getEvent();this._sendTelemetryEvent(\"mdsc_gtc_viewer_session\",d),this._currentViewerSessionTelemetry.negotiationTag&&this._completedViewerSessions.push(this._currentViewerSessionTelemetry.negotiationTag),this._currentViewerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentViewerSessionTelemetry.messagesFromUnknownSender).length&&b.RootToolsManager.logExternalForDDL(\"ScreenSharingControl_viewer: messages received from unkonwn sender\",JSON.stringify(d.ProtocolMessages)),this._currentViewerSessionTelemetry=null}},ControlBase.prototype._initiateSharerSessionTelemetry=function(l){if(this._currentSharerSessionTelemetry){if(this._currentSharerSessionTelemetry.negotiationTag===l)return null;this._finalizeSharerSessionTelemetry(u.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}this._logger.info(\"Initiating new sharer session telemetry for \".concat(l)),this._currentSharerSessionTelemetry=new U(this._logger,(new Date).getTime(),l,this._callId,this._participantId,this._endpointId),this._dataChannelAdapter.isActive()&&this._currentSharerSessionTelemetry.recordEvent(u.DATA_CHANNEL_AVAILABLE)},ControlBase.prototype._recordSharerSessionTelemetry=function(l,d){void 0===d&&(d=!0),this._currentSharerSessionTelemetry?l&&l(this._currentSharerSessionTelemetry):d&&this._logger.error(\"Cannot record telemetry without current session\")},ControlBase.prototype._finalizeSharerSessionTelemetry=function(l){if(this._currentSharerSessionTelemetry){this._currentSharerSessionTelemetry.recordEvent(l);var d=this._currentSharerSessionTelemetry.getEvent();this._sendTelemetryEvent(\"mdsc_gtc_sharer_session\",d),this._currentSharerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentSharerSessionTelemetry.messagesFromUnknownSender).length&&b.RootToolsManager.logExternalForDDL(\"ScreenSharingControl_sharer: messages received from unkonwn sender\",JSON.stringify(d.ProtocolMessages)),this._currentSharerSessionTelemetry=null}},ControlBase.prototype._sendTelemetryEvent=function(l,d){var u=this;this._logger.info(\"Sending event \".concat(l,\": \")),Object.keys(d).forEach((function(l){u._logger.info(\"     \".concat(l,\" => \").concat(d[l]))})),this._telemetryLoggers&&this._telemetryLoggers.media&&this._telemetryLoggers.media.sendEvent({eventName:l,props:d})},ControlBase.prototype._recordProtocolMessage=function(l,d){this._currentViewerSessionTelemetry&&this._currentViewerSessionTelemetry.recordProtocolMessage(l,d),this._currentSharerSessionTelemetry&&this._currentSharerSessionTelemetry.recordProtocolMessage(l,d)},ControlBase.prototype.reportSharingSessionChangeForViewer=function(l,d){d&&this._initiateViewerSessionTelemetry(l,d,!1)},ControlBase.prototype.initControlForViewer=function(l,u){if(this._logger.info(\"initControlForViewer(\".concat(E.scrubMriOrOmit(null==l?void 0:l.id),\", \").concat(u,\")\")),l){if(this._isViewing()&&this._logger.warn(\"initControlForViewer: called when already viewing\"),3!==this._callState)return this._logger.info(\"initControlForViewer: postponed until call is connected, callState=\".concat(this._callState)),this._pendingNegotiationTag=u,void(this._pendingSharer=l);var p=!this._sharerParticipant||this._sharerParticipant&&this._sharerParticipant.id!==l.id||u!==this._currentNegotiationTag;this._currentNegotiationTag=u,this.role=2,this._sharerParticipant?this._sharerParticipant.id!==l.id&&(this._recordViewerSessionTelemetry((function(l){return l.recordEvent(d.SESSION_SHUTDOWN_BY_ANOTHER_SESSION,null,u)})),this._logger.info(\"initControlForViewer: sharer switched, new sharer id=\".concat(E.scrubMriOrOmit(l.id))),this._dataChannelAvailableSent=!1,4===this.controlState&&this._terminateControl(!1)):(this._logger.info(\"initControlForViewer: setting sharer to id=\".concat(E.scrubMriOrOmit(l.id))),this._sharerParticipant=l,this._dataChannelAvailableSent=!1),this._initiateViewerSessionTelemetry(l,u,!0),p&&this._recordViewerSessionTelemetry((function(l){return l.recordEvent(d.SHARING_STARTED)})),this._dataChannelAdapter.isActive()&&!this._dataChannelAvailableSent&&(this._resetControlState(),this.role=2,this._sharerParticipant=l,this._logger.info(\"initControlForViewer: sending Available message to sharer\"),this._startAvailableHandshake())}else this._logger.warn(\"initControlForViewer: Sharer undefined, ignoring\")},ControlBase.prototype.shutdownControlForViewer=function(l){var u;this._logger.info(\"shutdownControlForViewer()\"),this._pendingSharer=null;var p=!1;if(l&&l.id!==(null===(u=this._sharerParticipant)||void 0===u?void 0:u.id)||(this._logger.info(\"shutdownControlForViewer: setting shouldShutdownControlForViewer to true, isViewing: \".concat(this._isViewing())),p=!0),p&&this._isViewing()){if(1===this.controlState){if(this._sharerParticipant){var h=this._getSharerDataSourceId();this._sendRequest({action:2,terminatedReason:6},h)}else this._logger.warn(\"shutdownControlForViewer: sharer participant is null\");var g={inControl:!1,id:k,terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:g,details:\"\"}))):this._logger.error(\"shutdownControlForViewer: Unexpected, no promise could be resolved, controlState=RequestSent\")}else if(4===this.controlState){g={inControl:!1,id:k,terminatedReason:6};this.event(\"sharingControlChanged\").raise(g)}this._teardownViewerRemoteControl(),this._resetControlState(),this._screenSharingVideoRenderer=null,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._dataChannelAvailableSent=!1,this._finalizeViewerSessionTelemetry(d.SESSION_SHUTDOWN),this._raiseScreenSharingControlCapableEvent(!1,k),this.role=0}},ControlBase.prototype._resetControlRequest=function(l){this._clearControlRequest(),this._controlRequest=l,this._registerParticipantListener(l),3===l.participantState&&(this._logger.info(\"participantState: Connected, raising: sharingIncomingControlRequest for participantId: \".concat(l.participant.id)),this.event(\"sharingIncomingControlRequest\").raise(l.participant.id))},ControlBase.prototype._clearControlRequest=function(){this._logger.info(\"_clearControlRequest()\"),this._stopListeningToParticipantChanges(this._controlRequest),this._controlRequest=null},ControlBase.prototype._stopListeningToParticipantChanges=function(l){this._controlRequestSubscription&&(this._logger.info(\"_stopListeningToParticipantChanges: stopping tracking changes for \".concat(l.participant.id)),this._controlRequestSubscription.dispose(),this._controlRequestSubscription=null)},ControlBase.prototype._registerParticipantListener=function(l){var d=this;this._logger.info(\"_registerParticipantListener: tracking changes for \".concat(l.participant.id)),this._logger.info(\"request.participantState: \".concat(l.participantState,\" | request.participant.state: \").concat(l.participant.state)),this._controlRequestSubscription=l.participant.changed((function(){if(l.participant.state!==l.participantState)switch(d._logger.info(\"request.participantState about to changed from: \".concat(l.participantState,\" to: \").concat(l.participant.state)),l.participantState=l.participant.state,l.participantState){case 3:d.event(\"sharingIncomingControlRequest\").raise(l.participant.id),d._logger.info(\"participantState: Connected, raising: sharingIncomingControlRequest for participantId: \".concat(l.participant.id));break;case 0:case 5:case 4:d.denyControlRequest().catch((function(l){d._logger.info(\"It is ok if denyControlRequest rejects here as screensharing may have just been stopped. Err: \".concat(l))})),d._logger.info(\"_registerParticipantListener: participant \".concat(l.participant.id,\" is no longer connected. resetting\")),d._clearControlRequest(),d._raiseControlRequestCanceled(l);break;case 1:case 2:case 6:case 7:d._logger.info(\"participantState: \".concat(l.participantState,\", participantId: \").concat(l.participant.id));break;default:d._logger.error(\"_registerParticipantListener: Unexpected participantState \".concat(l.participantState,\" unhandled\"))}}))},ControlBase.prototype._resetControllerParticipant=function(l){var d=this;this._controllerParticipantSubscription&&(this._logger.info(\"_resetControllerParticipant: stopping tracking changes for \".concat(this._controllerParticipant.participant.id)),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),l&&(this._logger.info(\"_resetControllerParticipant: tracking changes for \".concat(l.participant.id)),this._controllerParticipantSubscription=l.participant.changed((function(){3!==l.participant.state&&d.handleParticipantRemoved(l.participant.id)}))),this._controllerParticipant=l},ControlBase.prototype.handleParticipantRemoved=function(l){if(this._participantSubscriptions[l]&&(this._logger.info(\"handleParticipantRemoved(): Stopping tracking state changes for \".concat(l)),this._participantSubscriptions[l].dispose(),delete this._participantSubscriptions[l]),this._isSharing()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===l){this._logger.info(\"handleParticipantRemoved: controller left call, tearing down control session\"),this._teardownSharerRemoteControl(),this.controlState=0,this._resetControllerParticipant();var d={inControl:!1,id:l,terminatedReason:5};this.event(\"sharingControlChanged\").raise(d)}this._raiseScreenSharingControlCapableEvent(!1,l)}else if(this._sharerParticipant&&this._sharerParticipant.id===l&&4===this.controlState){this._logger.info(\"handleParticipantRemoved: sharer left call, tearing down control session\"),this._teardownViewerRemoteControl(),this.controlState=0;d={inControl:!1,id:k,terminatedReason:6};this.event(\"sharingControlChanged\").raise(d)}},ControlBase.prototype.callStateChanged=function(l){this._callState=l,this._recordViewerSessionTelemetry((function(u){return u.recordEvent(d.CALL_STATE,{state:l})}),!1),this._recordSharerSessionTelemetry((function(d){return d.recordEvent(u.CALL_STATE,{state:l})}),!1),this.isScreenSharingControlEnabled()&&this.handleCallState(l)},ControlBase.prototype.setIsEscalationInProgress=function(l){this.isEscalationInProgress=l},ControlBase.prototype.handleCallState=function(l){switch(l){case 3:this._handleCallConnected();break;case 7:this._handleCallDisconnected();break;case 4:case 5:this.shutdownControlForViewer()}},ControlBase.prototype._handleCallConnected=function(){this._logger.info(\"_handleCallConnected()\"),this._pendingSharer&&(this.initControlForViewer(this._pendingSharer,this._pendingNegotiationTag),this._pendingSharer=null)},ControlBase.prototype._handleCallDisconnected=function(){this._logger.info(\"_handleCallDisconnected()\"),this._isSharing()?this.shutdownControlForSharer():this.shutdownControlForViewer()},ControlBase.prototype._videoSizeChanged=function(l,d){null!==this._controlCapturer&&this._controlCapturer.updateVideoSize(l,d)},ControlBase.prototype._onRenderStarted=function(){var l={action:11,terminatedReason:0};if(this._sharerParticipant){var d=this._getSharerDataSourceId();this._sendRequest(l,d)}else this._logger.error(\"Attempted to send sharing rendered message to null sharerParticipant\")},ControlBase.prototype._setViewingRenderer=function(l,d){var u=this;try{this._screenSharingVideoRenderer=l,this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeVideoSizeChangedEvent(this._screenSharingVideoRenderer,(function(l,d){u._videoSizeChanged(l,d)}))),this._screenSharingVideoRendererSubscriptions.push(this._rendererAdapter.subscribeRenderStartedEvent(this._screenSharingVideoRenderer,(function(){u._onRenderStarted()})));var p=1;l.streamSize&&l.streamSize.width>0&&l.streamSize.height>0&&(p=l.streamSize.width/l.streamSize.height),this._controlCapturer=new m.SlimCoreElectronControlCapturer(this._logger,d,!0,p),4===this.controlState?(this._logger.info(\"_setViewingRenderer: detected local state is controlling\"),this._setupViewerRemoteControl()):this._teardownViewerRemoteControl()}catch(l){this._logger.error(\"_setViewingRenderer: unable to set _screenSharingVideoRenderer error=\".concat(l))}},ControlBase.prototype._onDataChannelStatusChanged=function(l){this._logger.info(\"_onDataChannelStatusChanged(): Data channel status=\".concat(l,\", isEscalationInProgress=\").concat(this.isEscalationInProgress)),l?this._enabled&&(this._dataChannelActive||(this._dataChannelActive=!0,this._recordViewerSessionTelemetry((function(l){return l.recordEvent(d.DATA_CHANNEL_AVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(l){return l.recordEvent(u.DATA_CHANNEL_AVAILABLE)}),!1),this._isViewing()?this._dataChannelAvailableSent||(this._sharerParticipant?(this._logger.info(\"_onDataChannelStatusChanged: sending Available message to sharer\"),this._startAvailableHandshake()):this._logger.error(\"Unexpected null _sharerParticipant trying to send Available to sharer\")):this._isSharing()&&(this.isEscalationInProgress||this._raiseScreenSharingControlCapableEvent(!0,k)))):this._dataChannelActive&&(this._recordViewerSessionTelemetry((function(l){return l.recordEvent(d.DATA_CHANNEL_UNAVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(l){return l.recordEvent(u.DATA_CHANNEL_UNAVAILABLE)}),!1),this._dataChannelActive=!1,this._dataChannelAvailableSent=!1,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(3),this.isEscalationInProgress||this._raiseScreenSharingControlCapableEvent(!1,k))},ControlBase.prototype._isSharing=function(){return 1===this.role},ControlBase.prototype._isViewing=function(){return 2===this.role},ControlBase.prototype._handleAvailableRequest=function(l,d,u){var p=this,h=!1,g=0;if(this._enabled)if(this._availableAckEnabled)if(this.canEnableGiveControl())if(d&&d.id){if(this._allowControlForUser&&typeof this._allowControlForUser==typeof Function)return void this._allowControlForUser(d).then((function(f){f||(h=!0,g=1),p._sendResponseToAvailableRequest(l,d,u,h,g)}))}else h=!0,g=10;else this._logger.info(\"GiveControl is not enabled. no need to answer the available ack\"),h=!0,g=9;else this._logger.info(\"Available ack is off. no need to answer the available ack\"),h=!0,g=9;else this._logger.info(\"Feature flag is off. no need to answer the available ack\"),h=!0,g=9;this._sendResponseToAvailableRequest(l,d,u,h,g)},ControlBase.prototype._sendResponseToAvailableRequest=function(l,d,u,p,h){var g=this;p?(this._logger.info(\"Rejecting Available for handShake:\".concat(u,\":\").concat(l.handshakeId)),this.event(\"controlAvailableHandshake\").raise(l.handshakeId,u,7,this._getAvailableHandshakeTerminatedFromControlTerminated(h)),this._sendRequest({action:10,terminatedReason:h,handshakeId:l.handshakeId},u)):(this._raiseScreenSharingControlCapableEvent(!0,d.id),this._participantSubscriptions[d.id]||(this._logger.info(\"Tracking participant status for \".concat(d.id)),this._participantSubscriptions[d.id]=d.changed((function(){3!==d.state&&(g._logger.info(\"Participant \".concat(d.id,\" is not connected. removing\")),g.handleParticipantRemoved(d.id))}))),this._logger.info(\"Acking Available for handShake:\".concat(u,\":\").concat(l.handshakeId)),this.event(\"controlAvailableHandshake\").raise(l.handshakeId,u,3),this._sendRequest({action:9,terminatedReason:0,handshakeId:l.handshakeId},u))},ControlBase.prototype.processProtocolMessage=function(l,d,u,p){var h=this;return S.asap((function(){h._processProtocolMessage(l,d,u,p)}))},ControlBase.prototype._raiseControlRequestCanceled=function(l){this.event(\"sharingIncomingControlRequestCancelled\").raise(l.participant.id)},ControlBase.prototype._processProtocolMessage=function(l,p,h,g){var f;this._recordProtocolMessage(p,g);try{f=JSON.parse(l)}catch(l){return void this._logger.error(\"Error parsing controlMessage\")}if(this._logger.info(\"_processProtocolMessage action=\".concat(toControlActionString(f.action),\" sender=\").concat(g)),p||this._logger.warn(\"protocol message from unknown sender with sourceId=\".concat(g)),0===f.action)this._handleAvailableRequest(f,p,g);else if(1===f.action)this._recordSharerSessionTelemetry((function(l){l.recordOperation(u.CONTROL_REQUEST,null,String(g))})),this._enabled?this._controlRequest?(this._logger.warn(\"Sharer is already processing a control request...rejecting new requests\"),this._sendControlRejectRequest(3,g)):this._controllerParticipant&&this._controllerParticipant.participant===p?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==h?(this._logger.warn(\"rejecting control request from second endpoint. participantId: \".concat(h)),this._sendControlRejectRequest(3,g)):(this._logger.warn(\"Got control request for someone already in control\"),this._sendControlAcceptRequest(g),this.controlState=2):p?(this._logger.info(\"resetControlRequest for participantId: \".concat(h)),this._resetControlRequest({participant:p,participantState:p.state,participantId:h})):this._logger.error(\"Got ControlRequest message but could not find a sender participant, ignoring\"):(this._logger.warn(\"Sharer control is disabled - rejecting request\"),this._sendControlRejectRequest(9,g));else if(3===f.action)if(1===this.controlState){var m=this._sendRequest({action:5,terminatedReason:0},g);this._logger.info(\"controlMessage.action: \".concat(f.action,\" _sendRequest: action:\").concat(5,\", terminateReason:\").concat(0,\", senderSourceId: \").concat(g,\", isSent: \").concat(m)),m?(this._setupViewerRemoteControl(),this.controlState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error(\"Unexpected, no promise could be resolved - controlState=RequestSent action=\".concat(toControlActionString(f.action))),this._recordViewerSessionTelemetry((function(l){l.recordOperationSuccess(d.CONTROL_REQUEST,null)}))):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:\"request control is accepted, but failed to send ack\"}))):this._logger.error(\"Unexpected, no promise could be resolved - controlState=\".concat(toControlStateString(this.controlState),\" action=\").concat(toControlActionString(f.action))),this._cancelRequestControlTimer()}else this._logger.warn(\"AcceptRequest message received in controlState=\".concat(toControlStateString(this.controlState)));else if(4===f.action)if(1===this.controlState){this._logger.info(\"_processProtocolMessage controlState: \".concat(this.controlState,\", about to be changed to: \").concat(0)),this.controlState=0;var v={inControl:!1,id:k,terminatedReason:f.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:v,details:\"\"}))):this._logger.error(\"Unexpected, no promise could be resolved - controlState=RequestSent action=\".concat(f.action)),this._recordViewerSessionTelemetry((function(l){l.recordOperationFailure(d.CONTROL_REQUEST,{reason:toControlTerminatedReason(f.terminatedReason)})})),this._cancelRequestControlTimer()}else this._logger.warn(\"RejectRequest message received in controlState=\".concat(toControlStateString(this.controlState),\" reason=\").concat(f.terminatedReason));else if(2===f.action){if(this._logger.info(\"_processProtocolMessage action=\".concat(f.action,\" sender=\").concat(g,\", controlRequest participantId: \").concat(this._controlRequest.participantId,\", controlRequest participantState: \").concat(this._controlRequest.participantState,\":\")),this._controlRequest){var y=this._controlRequest;this._logger.info(\"_processProtocolMessage action=\".concat(f.action,\" sender=\").concat(g,\", about to raise: _raiseControlRequestCanceled state: \").concat(this._controlRequest.participantState,\" \")),this._recordSharerSessionTelemetry((function(l){l.recordOperationTimeout(u.CONTROL_REQUEST,{participantId:g},String(g))})),this._clearControlRequest(),this._raiseControlRequestCanceled(y)}}else if(6===f.action){m=this._sendRequest({action:5,terminatedReason:0},g);if(this._logger.info(\"controlMessage.action: \".concat(f.action,\" _sendRequest: action:\").concat(5,\", terminateReason:\").concat(0,\", senderSourceId: \").concat(g,\", isSent: \").concat(m)),m){this._setupViewerRemoteControl(),this._logger.info(\"_processProtocolMessage controlState: \".concat(this.controlState,\", about to be changed to: \").concat(4)),this.controlState=4,this._recordViewerSessionTelemetry((function(l){l.recordEvent(d.CONTROL_GIVEN,{sender:g})}));v={inControl:!0,id:k,terminatedReason:f.terminatedReason};this.event(\"sharingControlChanged\").raise(v)}}else if(5===f.action)if(2===this.controlState)if(this._controllerParticipant&&this._controllerParticipant.participant===p){var S=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);g!==S&&this._logger.warn(\"acknowledging source id: \".concat(g,\" does not match requesting source id: \").concat(S)),this._logger.info(\"Setting up remote control for controller source id=\".concat(S)),this._setupSharerRemoteControl(S),this._logger.info(\"_processProtocolMessage controlState: \".concat(this.controlState,\", about to be changed to: \").concat(3)),this.controlState=3;v={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:f.terminatedReason};this.event(\"sharingControlChanged\").raise(v),this._grantControlPromise?(this._grantControlPromise.resolve(),this._cancelGrantControlTimer(),this._recordSharerSessionTelemetry((function(l){l.recordOperationSuccess(u.GIVE_CONTROL,{participantId:S})}))):this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer(),this._recordSharerSessionTelemetry((function(l){l.recordOperationSuccess(u.CONTROL_REQUEST,{participantId:S},String(S))}))):this._logger.error(\"Unexpected, no promise could be resolved - controlState=WaitingForControlAck action=\".concat(toControlActionString(f.action)))}else p?this._logger.warn(\"Ignoring ack from participant that does not match controller id=\".concat(E.scrubMriOrOmit(p.id))):this._logger.warn(\"Ignoring ack from null participant source id=\".concat(g));else 5===this.controlState?(this._logger.info(\"_processProtocolMessage controlState: \".concat(this.controlState,\", about to be changed to: \").concat(0)),this.controlState=0,this._resetControllerParticipant(),this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._cancelTerminateControlTimer()):this._logger.error(\"Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck action=\".concat(toControlActionString(f.action)))):this._logger.warn(\"Unexpected ack in control controlState=\".concat(toControlStateString(this.controlState)));else if(7===f.action||8===f.action){var _=void 0;this._isViewing()?(this._teardownViewerRemoteControl(),_=k):(this._teardownSharerRemoteControl(),p?_=p.id:this._logger.error(\"Got terminate message but could not find a sender participant!\")),this._logger.info(\"controlMessage action: \".concat(f.action,\", controllerId: \").concat(_)),this._logger.info(\"controlState: \".concat(this.controlState,\", about to be changed to: \").concat(0)),this.controlState=0,this._resetControllerParticipant();v={inControl:!1,id:_,terminatedReason:f.terminatedReason};this.event(\"sharingControlChanged\").raise(v),8===f.action&&this._sendRequest({action:5,terminatedReason:0},g)}else if(9===f.action)this._terminateAvailableHandshake&&(this._logger.info(\"_processProtocolMessage: terminate available handshake reason: \".concat(1,\",handshakeId: \").concat(f.handshakeId)),this._terminateAvailableHandshake(1,f.handshakeId)),this._raiseScreenSharingControlCapableEvent(!0,k);else if(10===f.action){if(this._logger.info(\"_processProtocolMessage: action=\".concat(f.action,\" terminate reason: \").concat(f.terminatedReason)),this._viewerSessionLastTerminatedReason=f.terminatedReason,this._recordViewerSessionTelemetry((function(l){l.updateOperationData(d.AVAILABLE_HANDSHAKE,{nackReason:f.terminatedReason},f.handshakeId)})),10===f.terminatedReason)return void this._logger.warn(\"_processProtocolMessage: control terminate reason: UnknownSender\");this._terminateAvailableHandshake&&(this._terminateAvailableHandshake(this._getAvailableHandshakeTerminatedFromControlTerminated(f.terminatedReason),f.handshakeId),this._logger.info(\"terminateAvailableHandshake reason=\".concat(f.terminatedReason))),1===f.terminatedReason?(this._logger.warn(\"_processProtocolMessage: control terminate reason: SharerDenied\"),this._raiseScreenSharingControlCapableEvent(!0,k,!0)):this._raiseScreenSharingControlCapableEvent(!1,k)}else 11===f.action?this._raiseRenderedAtViewer&&(p?(this._logger.info(\"raiseRenderedAtViewer senderId=\".concat(p.id,\", action=\").concat(f.action)),this._raiseRenderedAtViewer(p.id)):this._logger.error(\"Got RenderedAtViewer message but could not find a sender participant!\")):this._logger.error(\"Unknown request action received on control protocol data sink, action=\".concat(toControlActionString(f.action)))},ControlBase.prototype._getAvailableHandshakeTerminatedFromControlTerminated=function(l){switch(l){case 10:return 6;case 1:return 7;case 9:default:return 0}},ControlBase.prototype._sendRequest=function(l,d){this._logger.info(\"_sendRequest() action=\".concat(toControlActionString(l.action),\" recipient sourceid=\").concat(d));var u={type:0,message:JSON.stringify(l)},p=[d];return this._dataChannelAdapter.sendProtocolMessage((0,M.stringToBuffer)(JSON.stringify(u)),p),!0},ControlBase.prototype.processControlMessage=function(l,d){return h(this,void 0,void 0,(function(){return g(this,(function(u){return d!==this._controllerSourceId?(this._logger.debug(\"Ignoring control message, wrong sourceId. Expected: \".concat(d,\", got: \").concat(this._controllerSourceId)),[2]):3!==this.controlState?(this._logger.debug(\"Ignoring control message, wrong controlState. Expected: RemoteControlling, got: \".concat(toControlStateString(this.controlState))),[2]):[2,this._processControlMessage(l,d)]}))}))},ControlBase.prototype._processControlMessage=function(l,d){return this._controlInjector.injectRawInput(l,d)},ControlBase.prototype._resetControlState=function(){this._logger.info(\"_resetControlState()\"),this.controlState=0,this._resetControllerParticipant(),this._sharerParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer()},ControlBase.prototype._setupSharerRemoteControl=function(l){var d=this;this._logger.info(\"_setupSharerRemoteControl() sourceId=\".concat(l)),this._controllerSourceId=l,this._controlInjector.showVirtualCursor(l).catch((function(u){var p={reason:3,detail:JSON.stringify({sourceId:l,errorMsg:u})};d.event(\"sharingControlError\").raise(p)}))},ControlBase.prototype._teardownSharerRemoteControl=function(){var l=this;this._logger.info(\"_teardownSharerRemoteControl()\"),this._controllerSourceId=null,this._controlInjector.showVirtualCursor(0).catch((function(d){var u={reason:3,detail:JSON.stringify({sourceId:0,errorMsg:d})};l.event(\"sharingControlError\").raise(u)}))},ControlBase.prototype._setupViewerRemoteControl=function(){this._logger.info(\"_setupViewerRemoteControl()\"),this._setCapturerMode(3)},ControlBase.prototype._teardownViewerRemoteControl=function(){this._logger.info(\"_teardownViewerRemoteControl()\"),this._setCapturerMode(0)},ControlBase.prototype._clearCapturerEventSubscriptions=function(){this._logger.info(\"_clearCapturerEventSubscriptions()\"),this._captureEventSubscription&&(this._captureEventSubscription.dispose(),this._captureEventSubscription=null),this._mouseControlEventSubscription&&(this._mouseControlEventSubscription.dispose(),this._mouseControlEventSubscription=null),this._keyboardControlEventSubscription&&(this._keyboardControlEventSubscription.dispose(),this._keyboardControlEventSubscription=null)},ControlBase.prototype.sendRemoteControlEvent=function(l,d){if(d)switch(l){case\"mouseControlEvent\":this._sendControlEvent(v.ScreenSharingControlProtocol.encodeMouseEvent(d));break;case\"keyboardControlEvent\":this._sendControlEvent(v.ScreenSharingControlProtocol.encodeKeyboardEvent(d));break;default:return void this._logger.error(\"sendRemoteControlEvent: Invalid type=\",l)}else this._logger.error(\"sendRemoteControlEvent: Invalid argument.\")},ControlBase.prototype._sendControlEvent=function(l){if(this._dataChannelAdapter.isActive()&&this._sharerParticipant&&4===this.controlState){var d=[this._getSharerDataSourceId()];this._dataChannelAdapter.sendControlMessage(l,d)}else this._logger.error(\"_sendControlEvent: Dropping message - No data channel or wrong controlState. dataConnected: \".concat(this._dataChannelAdapter.isActive(),\" controlState: \").concat(toControlStateString(this.controlState),\")\"))},ControlBase.prototype._setCapturerMode=function(l){var d=this;this._logger.info(\"_setCapturerMode() capturerMode=\".concat(l)),this._controlCapturer?(this._controlCapturer.setCaptureMode(l),this._clearCapturerEventSubscriptions(),1===l?this._captureEventSubscription=this._controlCapturer.on(\"ctrlCaptureEvent\",(function(l){0===l&&d.event(\"sharingRendererClicked\").raise()})):2===l?this._captureEventSubscription=this._controlCapturer.on(\"ctrlCaptureEvent\",(function(l){1===l?d.event(\"sharingRendererMouseEntering\").raise():2===l&&d.event(\"sharingRendererMouseLeaving\").raise()})):3===l&&(this._mouseControlEventSubscription=this._controlCapturer.on(\"mouseControlEvent\",(function(l){d._sendControlEvent(v.ScreenSharingControlProtocol.encodeMouseEvent(l))})),this._keyboardControlEventSubscription=this._controlCapturer.on(\"keyboardControlEvent\",(function(l){d._sendControlEvent(v.ScreenSharingControlProtocol.encodeKeyboardEvent(l))})),this._captureEventSubscription=this._controlCapturer.on(\"ctrlCaptureEvent\",(function(l){1===l?d.event(\"sharingRendererMouseEntering\").raise():2===l&&d.event(\"sharingRendererMouseLeaving\").raise()})))):this._logger.warn(\"_controlCapturer not found when trying to setup viewer capture mode\")},ControlBase.prototype.setPointerImage=function(l,d){return this._logger.warn(\"setPointerImage is deprecated. Use setLocalPointerImage or setRemotePointerImage\"),l?this.setRemotePointerImage(l,d):this.setLocalPointerImage(d)},ControlBase.prototype.setLocalPointerImage=function(l){return 0===l.length?Promise.reject(new Error(\"setLocalPointerImage invalid image length\")):this._setPointerImage(0,l)},ControlBase.prototype.setRemotePointerImage=function(l,d){return h(this,void 0,void 0,(function(){var u,p,h,m,v,y,S;return g(this,(function(g){switch(g.label){case 0:if(!l)throw new Error(\"setRemotePointerImage participant is null\");if(0===d.length)throw new Error(\"setRemotePointerImage invalid image length\");if(this.enableParticipantLegToSourceIdMapping)return[3,2];if((m=this._mapParticipantToSourceId(l))<0)throw new Error(\"setRemotePointerImage unable to map participant to sourceId\");return[4,this._setPointerImage(m,d)];case 1:return g.sent(),[2];case 2:if(0===(u=this._getParticipantsDataSourceIds(l)).length)throw new Error(\"setRemotePointerImage unable to map participant to sourceIds\");this._logger.info(\"set pointer image for \".concat(u.length,\" sources\")),g.label=3;case 3:g.trys.push([3,8,9,10]),p=f(u),h=p.next(),g.label=4;case 4:return h.done?[3,7]:(m=h.value,[4,this._setPointerImage(m,d)]);case 5:g.sent(),g.label=6;case 6:return h=p.next(),[3,4];case 7:return[3,10];case 8:return v=g.sent(),y={error:v},[3,10];case 9:try{h&&!h.done&&(S=p.return)&&S.call(p)}finally{if(y)throw y.error}return[7];case 10:return[2]}}))}))},ControlBase.prototype._setPointerImage=function(l,d){return this._isSharing()||this._logger.warn(\"_setPointerImage called when not sharing\"),this._controlInjector.setPointerImage(l,d)},ControlBase.prototype.startPointerMode=function(){var l=this;return this._dataChannelAdapter.isActive()?0!==this.controlState?Promise.reject(new Error(\"startPointerMode called in bad control controlState=\".concat(toControlStateString(this.controlState)))):this._isViewing()?S.asap((function(){l._setCapturerMode(2)})):Promise.reject(new Error(\"startPointerMode when not viewing\")):Promise.reject(new Error(\"startPointerMode when data channel not active\"))},ControlBase.prototype.stopPointerMode=function(){var l=this;return 0!==this.controlState?Promise.reject(new Error(\"stopPointerMode called in bad control controlState=\".concat(toControlStateString(this.controlState)))):this._isViewing()?S.asap((function(){l._setCapturerMode(1)})):Promise.reject(new Error(\"stopPointerMode when not viewing\"))},ControlBase.prototype._startAvailableHandshake=function(){var l,u=this,p=this._getSharerDataSourceId();p<0&&this._logger.warn(\"sharer: \".concat(E.scrubMriOrOmit(null===(l=this._sharerParticipant)||void 0===l?void 0:l.id),\" has no data channel\"));var h=(0,C.default)();this._logger.info(\"_startAvailableHandshake() - handshakeId: \".concat(p,\":\").concat(h)),this.event(\"controlAvailableHandshake\").raise(h,p,1),this._terminateAvailableHandshake&&(this._logger.warn(\"Replacing existing availble handshake\"),this._terminateAvailableHandshake(4)),this._recordViewerSessionTelemetry((function(l){return l.recordOperation(d.AVAILABLE_HANDSHAKE,h)})),this._sendRequest({action:0,terminatedReason:0,handshakeId:h},p)||this._logger.error(\"Failed to send Available message to sharer, will retry after backoff\"),this._dataChannelAvailableSent=!0,this._waitForAvailableAck(h),this._terminateAvailableHandshake=function(l,g){void 0===l&&(l=0),u._logger.info(\"_terminateAvailableHandshake() - handshakeId: \".concat(p,\":\").concat(h,\", status: \").concat(l)),u._recordViewerSessionTelemetry((function(l){l.updateOperationData(d.AVAILABLE_HANDSHAKE,{tries:u._retryAttempt},g)})),1===l?u._recordViewerSessionTelemetry((function(l){l.recordOperationSuccess(d.AVAILABLE_HANDSHAKE,null,\"\",g)})):(u._logger.error(\"GTC handshake terminated with code \".concat(l,\", last terminated reason: \").concat(toControlTerminatedReason(u._viewerSessionLastTerminatedReason))),b.RootToolsManager.logExternalForDDL(\"GTC handshake terminated with code \".concat(l,\",\"),u._viewerSessionLastTerminatedReason.toString()),u._recordViewerSessionTelemetry((function(u){u.recordOperationFailure(d.AVAILABLE_HANDSHAKE,{reason:l},\"\",g)}))),u._terminateAvailableHandshake=null,u.event(\"controlAvailableHandshake\").raise(h,p,1===l?5:6,l),g&&g!==h&&u._logger.warn(\"AvailableSeries: Got handshake from another series - expected: \".concat(h,\", received: \").concat(g)),u._availableAckTimer&&(clearTimeout(u._availableAckTimer),u._availableAckTimer=null),u._retryAttempt=0}},ControlBase.prototype._waitForAvailableAck=function(l){var d=this;this._logger.info(\"_waitForAvailableAck()\"),this._availableAckTimer=window.setTimeout((function(){d._logger.warn(\"No Ack received for Available message from attempt=\".concat(d._retryAttempt)),d._availableAckTimer=null;var u=d._getSharerDataSourceId();if(d._retryAttempt<=L)d._logger.info(\"Re-sending Available message handshakeId: \".concat(u,\":\").concat(l)),d.event(\"controlAvailableHandshake\").raise(l,u,2),d._sendRequest({action:0,terminatedReason:0,handshakeId:l},u),d._waitForAvailableAck(l);else if(d._logger.error(\"Reached Available retry limit! Control capability will be false\"),d._terminateAvailableHandshake)d._terminateAvailableHandshake(5);else{var p={reason:4,detail:JSON.stringify({sourceId:u,errorMsg:\"Timed out after \".concat(d._retryAttempt,\" tries\")})};d.event(\"sharingControlError\").raise(p)}}),D*++this._retryAttempt)},ControlBase.prototype.requestControl=function(){return this._dataChannelAdapter.isActive()?0!==this.controlState?Promise.reject(new Error(\"requestControl called in bad controlState=\".concat(toControlStateString(this.controlState)))):this._isViewing()?this._sharerParticipant?this._requestControlPromise?Promise.reject(new Error(\"request control promise has not been resolved yet while requesting control\")):this._terminateControlPromise?Promise.reject(new Error(\"terminate control promise has not been resolved yet while requesting control\")):this._requestControl():Promise.reject(new Error(\"requestControl unexpected null sharer\")):Promise.reject(new Error(\"requestControl when not viewing\")):Promise.reject(new Error(\"requestControl when data channel not active\"))},ControlBase.prototype._requestControl=function(){var l=this;this._logger.info(\"_requestControl(), controlState: \".concat(this.controlState)),this._requestControlPromise=S.defer();var always=function(){l._requestControlPromise=null};this._requestControlPromise.promise.then(always,always);var u=this._getSharerDataSourceId();if(!this._sendRequest({action:1,terminatedReason:0},u)){var p={inControl:!1,id:k,terminatedReason:7};return this._requestControlPromise.reject(new Error),this._logger.error(\"_requestControl(): failed to send the request.\"),Promise.reject(new Error(JSON.stringify({controlInfo:p,details:\"\"})))}return this._recordViewerSessionTelemetry((function(l){return l.recordOperation(d.CONTROL_REQUEST,\"\")})),this.controlState=1,this._requestControlTimer=window.setTimeout((function(){if(1===l.controlState){l.controlState=0,l._logger.warn(\"No response to control request - canceling\"),l._sendRequest({action:2,terminatedReason:2},u)||l._logger.error(\"Failed to send the cancel control request\");var p={inControl:!1,id:k,terminatedReason:2};l._recordViewerSessionTelemetry((function(l){l.recordOperationTimeout(d.CONTROL_REQUEST,null)})),l._requestControlPromise?l._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:p,details:\"we did not get any response to the control - terminating control\"}))):l._logger.error(\"Unexpected, no promise could be resolved - controlState=RequestSent\")}else l._requestControlPromise?l._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:\"request control - times out in bad state - do nothing\"}))):l._logger.error(\"Unexpected, no promise could be resolved - controlState=\".concat(toControlStateString(l.controlState)));l._requestControlTimer=null}),w),this._requestControlPromise.promise},ControlBase.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error(\"cancelled by _cancelRequestControlTimer\")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},ControlBase.prototype.cancelControl=function(){return this._dataChannelAdapter.isActive()?1!==this.controlState?Promise.reject(new Error(\"cancelControl called in bad state=\".concat(toControlStateString(this.controlState)))):this._isViewing()?this._sharerParticipant?this._requestControlPromise?this._terminateControlPromise?Promise.reject(new Error(\"Terminate control promise has not been resolved yet while cancelling control\")):this._cancelControl():Promise.reject(new Error(\"Request control promise has been resolved while cancelling control\")):Promise.reject(new Error(\"cancelControl unexpected null sharer\")):Promise.reject(new Error(\"cancelControl when not viewing\")):Promise.reject(new Error(\"cancelControl when data channel not active\"))},ControlBase.prototype._cancelControl=function(){this._logger.info(\"_cancelControl()\");var l=this._getSharerDataSourceId();if(1!==this.controlState)return Promise.reject(new Error(\"Cancel control - in bad state - do nothing\"));if(this._cancelRequestControlTimer(),this.controlState=0,this._logger.info(\"Viewer cancels the control\"),!this._sendRequest({action:2,terminatedReason:8},l))return Promise.reject(new Error(\"Failed to send cancel control request\"));var u={inControl:!1,id:k,terminatedReason:8};return this._recordViewerSessionTelemetry((function(l){l.recordOperationFailure(d.CONTROL_REQUEST,{reason:toControlTerminatedReason(u.terminatedReason)})})),this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:u,details:\"\"}))),new Promise((function(l,d){l()}))},ControlBase.prototype.acceptControlRequest=function(){return this._dataChannelAdapter.isActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error(\"Accept control promise has not been resolved yet while accepting control\")):this._grantControlPromise?Promise.reject(new Error(\"Grant control promise has not been resolved yet while accepting control\")):this._terminateControlPromise?Promise.reject(new Error(\"Terminate control promise has not been resolved yet while accepting control\")):this._acceptControlRequest():Promise.reject(new Error(\"acceptControlRequest when not sharing\")):Promise.reject(new Error(\"acceptControlRequest while no control request pending\")):Promise.reject(new Error(\"acceptControlRequest when data channel not active\"))},ControlBase.prototype._acceptControlRequest=function(){var l=this;this._logger.info(\"_acceptControlRequest()\"),this._acceptControlPromise=S.defer();var always=function(){l._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(always,always),this._controllerParticipant){this._logger.warn(\"_acceptControlRequest called while another participant already has control - terminating control\"),this._teardownSharerRemoteControl();var d=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},d)||this._logger.error(\"Failed to send the terminateNoAck request\"),this._resetControllerParticipant()}var p=this._getDataSourceIdForParticipantLeg(this._controlRequest),h=this._controlRequest.participant.id;return this._sendControlAcceptRequest(p)?(this._resetControllerParticipant(this._controlRequest),this._clearControlRequest(),this.controlState=2,this._acceptControlTimer=window.setTimeout((function(){if(2===l.controlState){l.controlState=0,l._resetControllerParticipant(),l._recordSharerSessionTelemetry((function(l){l.recordOperationTimeout(u.CONTROL_REQUEST,{participantId:p},String(p))})),l._logger.error(\"No ack received when accepting control request - terminating control\"),l._sendRequest({action:7,terminatedReason:4},p)||l._logger.error(\"Failed to send the TerminateNoAck request\");var d={inControl:!1,id:h,terminatedReason:4};l.event(\"sharingControlChanged\").raise(d),l._acceptControlPromise?l._acceptControlPromise.reject(new Error(\"No ack received when accept control - terminating control\")):l._logger.error(\"Unexpected, no promise could be resolved - controlState=WaitingForControlAck\")}else l._acceptControlPromise?l._acceptControlPromise.reject(new Error(\"accept control - times out in bad state - do nothing\")):l._logger.error(\"Unexpected, no promise could be resolved - controlState=\".concat(toControlStateString(l.controlState)));l._acceptControlTimer=null}),N),this._acceptControlPromise.promise):(this._logger.error(\"Failed to send the accept control request\"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error(\"Failed to send the accept control request!\")))},ControlBase.prototype._sendControlAcceptRequest=function(l){var d=this._sendRequest({action:3,terminatedReason:0},l);return this._recordSharerSessionTelemetry((function(d){d.updateOperationData(u.CONTROL_REQUEST,{status:\"accepting\",participantId:l},null,String(l))})),d},ControlBase.prototype._sendControlRejectRequest=function(l,d){var p=this._sendRequest({action:4,terminatedReason:l},d);return this._recordSharerSessionTelemetry((function(p){p.recordOperationFailure(u.CONTROL_REQUEST,{participantId:d,reason:toControlTerminatedReason(l)},String(d))})),p},ControlBase.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error(\"cancelled by _cancelAcceptControlTimer\")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},ControlBase.prototype.denyControlRequest=function(){return this._dataChannelAdapter.isActive()?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error(\"Accept control promise has not been resolved yet while denying control\")):this._grantControlPromise?Promise.reject(new Error(\"Grant control promise has not been resolved yet while denying control\")):this._terminateControlPromise?Promise.reject(new Error(\"Terminate control promise has not been resolved yet while denying control\")):this._denyControlRequest():Promise.reject(new Error(\"denyControlRequest when not sharing\")):Promise.reject(new Error(\"denyControlRequest while no control request pending\")):Promise.reject(new Error(\"denyControlRequest when data channel not active\"))},ControlBase.prototype._denyControlRequest=function(){this._logger.info(\"_denyControlRequest()\");var l=this._getDataSourceIdForParticipantLeg(this._controlRequest);return this._clearControlRequest(),this._sendControlRejectRequest(1,l)?Promise.resolve():Promise.reject(new Error(\"Failed to send the deny control requst\"))},ControlBase.prototype.grantControl=function(l){return this._dataChannelAdapter.isActive()?this._controlRequest?Promise.reject(new Error(\"grantControl called while control request pending\")):this._isSharing()?l?this._acceptControlPromise?Promise.reject(new Error(\"Accept control promise has not been resolved yet while granting control\")):this._grantControlPromise?Promise.reject(new Error(\"Grant control promise has not been resolved yet while granting control\")):this._terminateControlPromise?Promise.reject(new Error(\"Terminate control promise has not been resolved yet while granting control\")):this._grantControl(l):Promise.reject(new Error(\"grantControl null participant\")):Promise.reject(new Error(\"grantControl when not sharing\")):Promise.reject(new Error(\"grantControl when data channel not active\"))},ControlBase.prototype._grantControl=function(l){var d=this;this._logger.info(\"_grantControl()\"),this._grantControlPromise=S.defer();var always=function(){d._grantControlPromise=null};if(this._grantControlPromise.promise.then(always,always),3===this.controlState){if(this._controllerParticipant.participant===l)return this._logger.warn(\"_grantControl called for participant who already has control\"),this._grantControlPromise.resolve(),new Promise((function(l,d){l()}));this._logger.warn(\"_grantControl called while another participant already has control - terminating control\"),this._teardownSharerRemoteControl();var p=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},p)||this._logger.error(\"Failed to send the terminateNoAck request\")}var h=this._mapParticipantToSourceId(l),g=this._sendRequest({action:6,terminatedReason:0},h);if(this._recordSharerSessionTelemetry((function(l){l.recordOperation(u.GIVE_CONTROL,null)})),!g)return this._logger.error(\"Failed to send the grant control request\"),this._grantControlPromise.reject(new Error),Promise.reject(new Error(\"Failed to send the grant control request!\"));var f=this._getParticipantIdForDataSourceId(l,h);return this._resetControllerParticipant({participant:l,participantState:l.state,participantId:f}),this.controlState=2,this._grantControlTimer=window.setTimeout((function(){2===d.controlState?(d.controlState=0,d._resetControllerParticipant(),d._logger.error(\"No ack received when granting control - terminating control\"),d._sendRequest({action:7,terminatedReason:4},h)||d._logger.error(\"Failed to send the terminateNoAck request\"),d._recordSharerSessionTelemetry((function(l){l.recordOperationTimeout(u.GIVE_CONTROL,null)})),d._grantControlPromise?d._grantControlPromise.reject(new Error(\"No ack received when granting control - terminating control\")):d._logger.error(\"Unexpected, no promise could be resolved - controlState=WaitingForControlAck\")):d._grantControlPromise?d._grantControlPromise.reject(new Error(\"Grant control - times out in bad state - do nothing\")):d._logger.error(\"Unexpected, no promise could be resolved - controlState=\".concat(toControlStateString(d.controlState)));d._grantControlTimer=null}),N),this._grantControlPromise.promise},ControlBase.prototype._cancelGrantControlTimer=function(){this._grantControlTimer&&(this._grantControlPromise&&this._grantControlPromise.reject(new Error(\"cancelled by _cancelGrantControlTimer\")),clearTimeout(this._grantControlTimer),this._grantControlTimer=null)},ControlBase.prototype._mapParticipantToSourceId=function(l){return this._dataChannelAdapter.isActive()?O.getSourceIdForMediaType(l,3):(this._logger.error(\"Null data channel cannot map participant to source id\"),-1)},ControlBase.prototype._getParticipantsDataSourceIds=function(l){var d,u,p,h,g=[];try{if(l&&l.endpoints&&l.endpoints.endpointDetails){if(1===l.endpoints.endpointDetails.length)if(!(y=l.endpoints.endpointDetails[0])||!y.mediaStreams)return g.push(A.DATA_SOURCE_ID_ANY),g;try{for(var m=f(l.endpoints.endpointDetails),v=m.next();!v.done;v=m.next()){var y;if((y=v.value)&&y.mediaStreams)try{for(var S=(p=void 0,f(y.mediaStreams)),_=S.next();!_.done;_=S.next()){var C=_.value;if(3===R.mapMediaTypeStringToMediaType(C.type)){if(g.push(C.sourceId),g.length>=8)return this._logger.error(\"Excessive amount of data streams\"),g;break}}}catch(l){p={error:l}}finally{try{_&&!_.done&&(h=S.return)&&h.call(S)}finally{if(p)throw p.error}}}}catch(l){d={error:l}}finally{try{v&&!v.done&&(u=m.return)&&u.call(m)}finally{if(d)throw d.error}}}}catch(l){this._logger.error(\"_getParticipantsDataSourceIds caught exception error=\".concat(l))}return g},ControlBase.prototype._getParticipantIdForDataSourceId=function(l,d){return O.getParticipantIdForSourceId(l,3,d)},ControlBase.prototype._getDataSourceIdForParticipantId=function(l,d){return this._dataChannelAdapter.isActive()?O.getSourceId(l,d,3):(this._logger.error(\"Null data channel cannot map participant to source id\"),-1)},ControlBase.prototype._getDataSourceIdForParticipantLeg=function(l){return this._getDataSourceIdForParticipantId(l.participant,l.participantId)},ControlBase.prototype._getSharerDataSourceId=function(){var l=O.getSharingParticipantLeg(this._sharerParticipant);return l?this._getDataSourceIdForParticipantId(this._sharerParticipant,l):(this._logger.warn(\"Unable to identify the sharer participantId, falling back to first data channel\"),this._mapParticipantToSourceId(this._sharerParticipant))},ControlBase.prototype.terminateControl=function(){if(this._isViewing()){if(4!==this.controlState)return Promise.reject(new Error(\"terminateControl called while not in control\"));if(!this._sharerParticipant)return Promise.reject(new Error(\"terminateControl called but _sharerParticipant is null\"))}else{if(!this._isSharing())return Promise.reject(new Error(\"terminateControl called but not sharing nor viewing\"));if(!this._controllerParticipant)return Promise.reject(new Error(\"terminateControl called but controllerParticipant is null\"))}return this._requestControlPromise?Promise.reject(new Error(\"Request control promise has not been resolved yet while terminating control\")):this._acceptControlPromise?Promise.reject(new Error(\"Accept control promise has not been resolved yet while terminating control\")):this._grantControlPromise?Promise.reject(new Error(\"Grant control promise has not been resolved yet while terminating control\")):this._terminateControlPromise?Promise.reject(new Error(\"Terminate control promise has not been resolved yet while terminating control\")):this._terminateControl()},ControlBase.prototype._terminateControl=function(l){var d=this;void 0===l&&(l=!0),this._logger.info(\"_terminateControl()\"),this._terminateControlPromise=S.defer();var always=function(){d._terminateControlPromise=null};this._terminateControlPromise.promise.then(always,always);var u,p,h=0,g=l?8:7;if(this._isViewing()){if(4!==this.controlState)return this._logger.error(\"Local viewer called terminateControl when not controlling\"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error(\"Local viewer called terminateControl when not controlling\"));this._teardownViewerRemoteControl(),h=6,u=this._getSharerDataSourceId(),p=k,this._logger.info(\"Terminating remote control reason: \".concat(h,\",  recipient: \").concat(u,\", controllerId: \").concat(p))}else{if(3!==this.controlState||!this._controllerParticipant)return this._logger.error(\"Local sharer called terminateControl when no one is in control\"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error(\"Local sharer called terminateControl when no one is in control\"));this._teardownSharerRemoteControl(),h=5,u=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),p=this._controllerParticipant.participant.id,this._logger.info(\"Terminating control on the sharer side, reason: \".concat(h,\", recipient: \").concat(u,\", controllerId: \").concat(p))}if(!this._sendRequest({action:g,terminatedReason:h},u)){if(l)return this._logger.error(\"Failed to send the terminate control request\"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error(\"Failed to send the grant control request!\"));this._logger.error(\"Failed to send the terminateNoAck request\")}this.controlState=l?5:0;var f={inControl:!1,id:p,terminatedReason:h};return this._logger.info(\"raising event sharingControlChanged reason=\".concat(f.terminatedReason,\" controlState=\").concat(this.controlState)),this.event(\"sharingControlChanged\").raise(f),l?(this._terminateControlTimer=window.setTimeout((function(){5===d.controlState?(d.controlState=0,d._resetControllerParticipant(),d._logger.error(\"No ack received when terminating control - resending terminate request\"),d._sendRequest({action:7,terminatedReason:4},u)||d._logger.error(\"Failed to send the terminateNoAck request\"),d._terminateControlPromise?d._terminateControlPromise.reject(new Error(\"No ack received when terminating control - resending terminate request\")):d._logger.error(\"Unexpected, no promise could be resolved - controlState=WaitingForTerminateAck\")):d._terminateControlPromise?d._terminateControlPromise.reject(new Error(\"terminate control - times out in bad state - do nothing\")):d._logger.error(\"Unexpected, no promise could be resolved - controlState=\".concat(toControlStateString(d.controlState)));d._terminateControlTimer=null}),N),this._terminateControlPromise.promise):(this._terminateControlPromise.resolve(),new Promise((function(l,d){l()})))},ControlBase.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error(\"cancelled by _cancelTerminateControlTimer\")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null,this._logger.info(\"_cancelTerminateControlTimer()\"))},ControlBase.prototype._disposeControlCapturer=function(l){void 0===l&&(l=(0,I.generateCauseId)()),this._logger.info(\"_disposeControlCapturer causeId: \".concat(l)),this._clearCapturerEventSubscriptions(),this._controlCapturer&&(this._controlCapturer.dispose(l),this._controlCapturer=null)},ControlBase.prototype.dispose=function(p){this._logger.info(\"dispose causeId: \".concat(p)),this._dataChannelAdapter.dispose(p),this._resetControlState(),this._disposeRenderer(p),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._resetParticipantSubscriptions(),this._finalizeViewerSessionTelemetry(d.SESSION_SHUTDOWN),this._finalizeSharerSessionTelemetry(u.SESSION_SHUTDOWN),l.prototype.dispose.call(this,p)},ControlBase}(P.default);function toControlActionString(l){switch(l){case 0:return\"Available\";case 1:return\"ControlRequest\";case 2:return\"CancelControlRequest\";case 3:return\"AcceptRequest\";case 4:return\"RejectRequest\";case 5:return\"Ack\";case 6:return\"GiveControl\";case 7:return\"TerminateNoAck\";case 8:return\"Terminate\";case 9:return\"AvailableAck\";case 10:return\"AvailableNack\";case 11:return\"RenderedAtViewer\";default:return\"Unknown\"}}function toControlStateString(l){switch(l){case 0:return\"None\";case 1:return\"RequestSent\";case 2:return\"WaitingForControlAck\";case 3:return\"RemoteControlling\";case 4:return\"LocalControlling\";case 5:return\"WaitingForTerminateAck\";default:return\"Unknown\"}}function toControlTerminatedReason(l){switch(l){case 0:return\"None\";case 1:return\"SharerDenied\";case 2:return\"SharerNoResponse\";case 3:return\"SharerBusy\";case 4:return\"AckTimeout\";case 5:return\"SharerTerminated\";case 6:return\"ViewerTerminated\";case 7:return\"DataChannelError\";case 8:return\"ViewerCancelled\";case 9:return\"SharerControlDisabled\";case 10:return\"UnknownSender\";default:return\"Unknown\"}}l.ControlBase=j}(d.ScreenSharingControl||(d.ScreenSharingControl={}))},function(l,d,u){!function webpackUniversalModuleDefinition(d,p){l.exports=p(u(8))}(window,(function(l){return function(l){var d={};function __webpack_require__(u){if(d[u])return d[u].exports;var p=d[u]={i:u,l:!1,exports:{}};return l[u].call(p.exports,p,p.exports,__webpack_require__),p.l=!0,p.exports}return __webpack_require__.m=l,__webpack_require__.c=d,__webpack_require__.d=function(l,d,u){__webpack_require__.o(l,d)||Object.defineProperty(l,d,{enumerable:!0,get:u})},__webpack_require__.r=function(l){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(l,\"__esModule\",{value:!0})},__webpack_require__.t=function(l,d){if(1&d&&(l=__webpack_require__(l)),8&d)return l;if(4&d&&\"object\"==typeof l&&l&&l.__esModule)return l;var u=Object.create(null);if(__webpack_require__.r(u),Object.defineProperty(u,\"default\",{enumerable:!0,value:l}),2&d&&\"string\"!=typeof l)for(var p in l)__webpack_require__.d(u,p,function(d){return l[d]}.bind(null,p));return u},__webpack_require__.n=function(l){var d=l&&l.__esModule?function getDefault(){return l.default}:function getModuleExports(){return l};return __webpack_require__.d(d,\"a\",d),d},__webpack_require__.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},__webpack_require__.p=\"\",__webpack_require__(__webpack_require__.s=0)}([function(l,d,u){l.exports=u(1)},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.SlimCoreElectronControlCapturer=void 0;var h=u(2),g=u(6),f=65535,m=3e3,v=250,y=18,S=17,_=16,C=91,E=50,T=30,b=function(l){function SlimCoreElectronControlCapturer(d,u,p,h){void 0===p&&(p=!0),void 0===h&&(h=1);var g,f,m=this;return(m=l.call(this)||this)._logger=d,m._element=u,m._captureRegionPreserveAspectRatio=p,m._mouseMoveCount=0,m._mouseMoveStartTime=0,m._isMouseDown=!1,m._isMouseOnRenderer=!1,m._captureMode=0,m._pollTimerID=0,m._resizeTimerID=0,m._mouseMoveThrottlingEnabled=!1,m._handleResizeEvents=function(){clearTimeout(m._resizeTimerID),m._resizeTimerID=window.setTimeout((function(){m.updateCaptureRegion()}),v)},m._handleMouseLeave=function(l){!m._isOnScreenContent(l)&&m._isMouseOnRenderer&&(m._raiseCaptureEvent(2),m._logger.info(\"Mouse leaving render region\")),m._isMouseOnRenderer=!1},m._handleMouseEnter=function(l){m._isOnScreenContent(l)&&(m._isMouseOnRenderer=!0,m._raiseCaptureEvent(1),m._logger.info(\"Mouse entering render region\"))},m._handleLosingFocus=function(){m._syncKeyStates(!0)},m._handleClick=function(l){m._isOnScreenContent(l)&&(m._raiseCaptureEvent(0),m._logger.info(\"Mouse clicked\"))},m._handleMouseMove=function(l){if(!m._isOnScreenContent(l)&&m._isMouseOnRenderer)return m._raiseCaptureEvent(2),m._isMouseOnRenderer=!1,void m._logger.info(\"Mouse leaving render region\");if(m._isOnScreenContent(l)&&!m._isMouseOnRenderer&&(m._raiseCaptureEvent(1),m._isMouseOnRenderer=!0,m._logger.info(\"Mouse entering render region\")),2===m._captureMode||3===m._captureMode){if(m._mouseMoveCount++,m._mouseMoveThrottlingEnabled){if(!m._isOnScreenContent(l)||!m._shouldMoveMouse())return}else if(!m._isOnScreenContent(l)||m._mouseMoveCount%2==0)return;var d={type:0};m._normalizeMousePosition(l,d),m._raiseMouseEvent(d)}},m._handleMouseDown=function(l){if((2===m._captureMode||3===m._captureMode)&&m._isOnScreenContent(l)){var d={type:2,buttonType:convertButton(l.button),buttonDown:!0};m._isMouseDown=!0,m._normalizeMousePosition(l,d),m._raiseMouseEvent(d)}},m._handleMouseUp=function(l){if((2===m._captureMode||3===m._captureMode)&&m._isOnScreenContent(l)){var d={type:2,buttonType:convertButton(l.button),buttonDown:!1};m._isMouseDown=!1,m._normalizeMousePosition(l,d),m._raiseMouseEvent(d)}},m._handleKeyDown=function(l){m._raiseKeyboardEvent({codeType:1,code:l.keyCode,repeat:l.repeat,keyUp:!1}),l.stopPropagation(),l.preventDefault()},m._handleKeyUp=function(l){m._raiseKeyboardEvent({codeType:1,code:l.keyCode,repeat:l.repeat,keyUp:!0}),l.stopPropagation(),l.preventDefault()},m._handleWheel=function(l){m._raiseMouseEvent({type:1,wheelRotation:l.deltaY>0?-120:120})},m._handleContextMenu=function(l){l.preventDefault()},m._ensureCanReceiveKeyboardInput(),null===(f=null===(g=m._element.ownerDocument)||void 0===g?void 0:g.defaultView)||void 0===f||f.addEventListener(\"resize\",m._handleResizeEvents,!1),m._captureRegion={left:0,top:0,width:m._element.clientWidth,height:m._element.clientHeight},m._videoSize={width:Math.floor(u.clientHeight*h),height:u.clientHeight},m._origElementSize={width:0,height:0},m._checkElementSize(),m._mouseMoveStartTime=new Date(0).getTime(),m}return p(SlimCoreElectronControlCapturer,l),Object.defineProperty(SlimCoreElectronControlCapturer.prototype,\"captureMode\",{get:function(){return this._captureMode},enumerable:!1,configurable:!0}),Object.defineProperty(SlimCoreElectronControlCapturer.prototype,\"captureRegion\",{get:function(){return this._captureRegion},enumerable:!1,configurable:!0}),SlimCoreElectronControlCapturer.prototype.setMouseMoveThrottlingFeatureFlag=function(l){this._mouseMoveThrottlingEnabled=l},SlimCoreElectronControlCapturer.prototype.dispose=function(d){var u,p;this._logger.info(\"dispose causeId: \".concat(d)),window.clearTimeout(this._pollTimerID),null===(p=null===(u=this._element.ownerDocument)||void 0===u?void 0:u.defaultView)||void 0===p||p.removeEventListener(\"resize\",this._handleResizeEvents,!1),l.prototype.dispose.call(this,d)},SlimCoreElectronControlCapturer.prototype.updateVideoSize=function(l,d){this._videoSize.width=l,this._videoSize.height=d,this.updateCaptureRegion()},SlimCoreElectronControlCapturer.prototype.updateCaptureRegion=function(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)},SlimCoreElectronControlCapturer.prototype.setCaptureMode=function(l){3===this._captureMode&&3!==l&&this._syncKeyStates(!0),this._captureMode=l,0!==l?(this._element.addEventListener(\"click\",this._handleClick),this._element.addEventListener(\"pointermove\",this._handleMouseMove),this._element.addEventListener(\"pointerdown\",this._handleMouseDown),this._element.addEventListener(\"pointerup\",this._handleMouseUp),this._element.addEventListener(\"pointerenter\",this._handleMouseEnter),this._element.addEventListener(\"pointerleave\",this._handleMouseLeave),3===l?(this._element.addEventListener(\"wheel\",this._handleWheel),this._element.addEventListener(\"keydown\",this._handleKeyDown),this._element.addEventListener(\"keyup\",this._handleKeyUp),this._element.addEventListener(\"contextmenu\",this._handleContextMenu),this._element.addEventListener(\"blur\",this._handleLosingFocus)):(this._element.removeEventListener(\"wheel\",this._handleWheel),this._element.removeEventListener(\"keydown\",this._handleKeyDown),this._element.removeEventListener(\"keyup\",this._handleKeyUp),this._element.removeEventListener(\"contextmenu\",this._handleContextMenu),this._element.removeEventListener(\"blur\",this._handleLosingFocus))):(this._element.removeEventListener(\"pointermove\",this._handleMouseMove),this._element.removeEventListener(\"pointerdown\",this._handleMouseDown),this._element.removeEventListener(\"pointerup\",this._handleMouseUp),this._element.removeEventListener(\"pointerenter\",this._handleMouseEnter),this._element.removeEventListener(\"pointerleave\",this._handleMouseLeave),this._element.removeEventListener(\"click\",this._handleClick),this._element.removeEventListener(\"wheel\",this._handleWheel),this._element.removeEventListener(\"keydown\",this._handleKeyDown),this._element.removeEventListener(\"keyup\",this._handleKeyUp),this._element.removeEventListener(\"contextmenu\",this._handleContextMenu),this._element.removeEventListener(\"blur\",this._handleLosingFocus))},SlimCoreElectronControlCapturer.prototype._ensureCanReceiveKeyboardInput=function(){this._element.tabIndex=this._element.tabIndex},SlimCoreElectronControlCapturer.prototype._checkElementSize=function(){var l=this;this._origElementSize.width===this._element.clientWidth&&this._origElementSize.height===this._element.clientHeight||(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout((function(){l._checkElementSize()}),m)},SlimCoreElectronControlCapturer.prototype._raiseMouseEvent=function(l){this.event(\"mouseControlEvent\").raise(l)},SlimCoreElectronControlCapturer.prototype._raiseKeyboardEvent=function(l){this.event(\"keyboardControlEvent\").raise(l)},SlimCoreElectronControlCapturer.prototype._raiseCaptureEvent=function(l){this.event(\"ctrlCaptureEvent\").raise(l)},SlimCoreElectronControlCapturer.prototype._normalizeMousePosition=function(l,d){d.xPos=(l.offsetX-this._captureRegion.left)/this._captureRegion.width*f,d.yPos=(l.offsetY-this._captureRegion.top)/this._captureRegion.height*f},SlimCoreElectronControlCapturer.prototype._isOnScreenContent=function(l){var d=this._captureRegion.left,u=this._captureRegion.left+this._captureRegion.width,p=this._captureRegion.top,h=this._captureRegion.top+this._captureRegion.height;return d<=l.offsetX&&l.offsetX<u&&p<=l.offsetY&&l.offsetY<h},SlimCoreElectronControlCapturer.prototype._shouldMoveMouse=function(){if(this._mouseMoveStartTime){var l=(new Date).getTime(),d=l-this._mouseMoveStartTime;if(this._isMouseDown&&d>=T||!this._isMouseDown&&d>=E)return this._mouseMoveStartTime=l,!0}else this._mouseMoveStartTime=(new Date).getTime();return!1},SlimCoreElectronControlCapturer.prototype._syncKeyStates=function(l){this._raiseKeyboardEvent({codeType:1,code:S,repeat:!1,keyUp:l}),this._raiseKeyboardEvent({codeType:1,code:_,repeat:!1,keyUp:l}),this._raiseKeyboardEvent({codeType:1,code:y,repeat:!1,keyUp:l}),this._raiseKeyboardEvent({codeType:1,code:C,repeat:!1,keyUp:l}),this._logger.info(\"Synced Key states.\")},SlimCoreElectronControlCapturer.formatMouseEvent=function(l){return g.ScreenSharingControlProtocol.encodeMouseEvent(l)},SlimCoreElectronControlCapturer.formatKeyboardEvent=function(l){return g.ScreenSharingControlProtocol.encodeKeyboardEvent(l)},SlimCoreElectronControlCapturer}(h.default);function convertButton(l){switch(l){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}d.SlimCoreElectronControlCapturer=b},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var g=function(l){function ObservableBase(d){return l.call(this,d)||this}return p(ObservableBase,l),ObservableBase.prototype.changed=function(l,d){return this.subscribe({changed:{skipEventConfig:d,handler:l},on:void 0})},ObservableBase.prototype.on=function(l,d){return this.subscribe({changed:void 0,on:{name:String(l),handler:this._toEventCallback(d)}})},ObservableBase.prototype.once=function(l,d,u){var p,h=this,onceSubscription=function(){for(var l=[],g=0;g<arguments.length;g++)l[g]=arguments[g];p.dispose(u),h._toEventCallback(d).apply(void 0,l)};return p=this.on(l,this._fromEventCallback(onceSubscription))},ObservableBase.prototype.raiseChanged=function(l){var d=this;this.raiseEvents((function(u){if(u.changed){var p=u.changed,h=p.skipEventConfig,g=p.handler;!d.getShouldSkipChangedEvent(l,h)&&g()}}))},ObservableBase.prototype.event=function(l){var d=this;return{raise:this._fromEventCallback((function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];return d._raiseEventImpl.apply(d,h([String(l)],u,!1))}))}},ObservableBase.prototype._raiseEventImpl=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];this.raiseEvents((function(u){var p;return u.on&&u.on.name===l&&(p=u.on).handler.apply(p,d)}))},ObservableBase.prototype._toEventCallback=function(l){return l},ObservableBase.prototype._fromEventCallback=function(l){return l},ObservableBase.prototype.getShouldSkipChangedEvent=function(l,d){return!!(null==l?void 0:l.skipParticipantsUpdatesOnCall)&&!!(null==d?void 0:d.skipParticipantsUpdatesOnCall)},ObservableBase}(u(3).EventSourceImpl);d.default=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.EventSourceImpl=void 0;var p=u(4),h=u(5),g=function(){function EventSourceImpl(l){this.subscriptions=[],this.eventLogger=l}return EventSourceImpl.prototype.subscribe=function(l){return new f(this.subscriptions,l)},EventSourceImpl.prototype.dispose=function(l){this.subscriptions=[]},EventSourceImpl.prototype.raiseEvents=function(l){var d=this;this.subscriptions.slice().forEach((function(u){try{void 0!==u.eventHandler&&l(u.eventHandler)}catch(l){d.eventLogger&&d.eventLogger.warn&&d.eventLogger.warn(\"Event handler exception caught!\",(0,h.stringifyObject)(l))}}))},EventSourceImpl}();d.EventSourceImpl=g;var f=function(){function EventSubscriptionImpl(l,d){this.subscriptions=l,this.eventHandler=d,this.subscriptions.push(this)}return EventSubscriptionImpl.prototype.dispose=function(){var l=this;p.remove(this.subscriptions,(function(d){return d===l})),this.eventHandler=void 0},EventSubscriptionImpl}()},function(d,u){d.exports=l},function(l,d,u){function getRandomizedTimeout(l){var d=Math.floor(11*Math.random())+10;return Math.floor(l*(1-d/100))}function isStringBase64(l){if(!l)return!1;try{return atob(l),!0}catch(l){return!1}}function isPromiseLike(l){return!!l&&\"function\"==typeof l.then}function stringifyObject(l){if(!l)return\"\".concat(l);if(l instanceof Map)return mapToString(l);var d=l.toString();return d.endsWith(\"[object Object]\")?JSON.stringify(l):d}function mapToString(l){var d={};return l.forEach((function(l,u){d[u.toString()]=l})),JSON.stringify(d)}function stringToBuffer(l){for(var d=new ArrayBuffer(l.length),u=new Uint8Array(d),p=0;p<l.length;p++)u[p]=l.charCodeAt(p);return u}Object.defineProperty(d,\"__esModule\",{value:!0}),d.stringToBuffer=d.stringifyObject=d.isPromiseLike=d.isStringBase64=d.getRandomizedTimeout=void 0,d.getRandomizedTimeout=getRandomizedTimeout,d.isStringBase64=isStringBase64,d.isPromiseLike=isPromiseLike,d.stringifyObject=stringifyObject,d.stringToBuffer=stringToBuffer},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ScreenSharingControlProtocol=void 0,function(l){var d=7,u=3;function encodeMouseEvent(l){if(!l)return new Uint8Array(0);l.buttonType||(l.buttonType=0),l.xPos||(l.xPos=0),l.yPos||(l.yPos=0),l.wheelRotation||(l.wheelRotation=0);var u=new ArrayBuffer(d),p=new DataView(u),h=(3&l.type)<<0,g=(7&l.buttonType)<<2,f=(l.buttonDown?1:0)<<5,m=(l.wheelButtonDown?1:0)<<6,v=0;return p.setUint8(0,1),p.setUint8(1,h|g|f|m|v),p.setUint16(2,l.xPos,!0),p.setUint16(4,l.yPos,!0),p.setUint8(6,l.wheelRotation),new Uint8Array(u)}function encodeKeyboardEvent(l){var d=new ArrayBuffer(u),p=new DataView(d),h=(3&l.codeType)<<0,g=0,f=(l.keyUp?1:0)<<4,m=(l.repeat?1:0)<<5,v=0,y=0;return p.setUint8(0,0),p.setUint8(1,h|g|f|m|v|y),p.setUint8(2,l.code),new Uint8Array(d)}function decodeEventType(l){return l[0]}function decodeMouseEvent(l){if(1!==l[0]||l.length!==d)return null;var u=new DataView(l.buffer),p=u.getUint8(1);return{type:3&p,buttonType:p>>2&7,buttonDown:!!(p>>5&1),wheelButtonDown:!!(p>>6&1),xPos:u.getUint16(2,!0),yPos:u.getUint16(4,!0),wheelRotation:u.getUint8(6)}}function decodeKeyboardEvent(l){if(0!==l[0]||l.length!==u)return null;var d=new DataView(l.buffer),p=d.getUint8(1);return{codeType:3&p,code:d.getUint8(2),repeat:!!(p>>5&1),keyUp:!!(p>>4&1)}}l.encodeMouseEvent=encodeMouseEvent,l.encodeKeyboardEvent=encodeKeyboardEvent,l.decodeEventType=decodeEventType,l.decodeMouseEvent=decodeMouseEvent,l.decodeKeyboardEvent=decodeKeyboardEvent}(d.ScreenSharingControlProtocol||(d.ScreenSharingControlProtocol={}))}])}))},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.EdgeControlInjector=void 0;var g=u(310),f=u(121),m=function(){function EdgeControlInjector(l,d,u){this.logger=l,this.sharingTrackId=d,this.onInitErrorCallback=u,this.images=new Map,this.controlEventConverter=new g.EdgeControlEventConverter(l),this.edgeApi=new f.EdgeControlInjectorApi(this.logger)}return EdgeControlInjector.prototype.showVirtualCursor=function(l,d){if(this.logger.info(\"EdgeControlInjector - showVirtualCursor, id: \".concat(l,\" sharingTrackId: \").concat(this.sharingTrackId)),d){this.edgeApi.createInputDeviceId(this.sharingTrackId,this.onInitErrorCallback,this.images[l]);var u=this.images[0];u?this.edgeApi.sendSetLocalUserAvatarMessage(u):this.logger.error(\"EdgeControllerInjector - local avatar is missing, continue without local avatar\")}else this.edgeApi.sendCloseVirtualInputDeviceMessage()},EdgeControlInjector.prototype.setAvatar=function(l,d){this.logger.info(\"\".concat(l,\" EdgeControlInjector - setAvatar, id: \").concat(l,\", data: \").concat(JSON.stringify(d))),this.images[l]=d},EdgeControlInjector.prototype.injectMouseEvent=function(l,d){return p(this,void 0,void 0,(function(){var u;return h(this,(function(p){return this.logger.info(\"\".concat(l,\" EdgeControlInjector - injectMouseEvent \").concat(JSON.stringify(d))),u=this.controlEventConverter.toEdgeControlMouseEvent(d),[2,this.edgeApi.sendInjectInputEventMessage(u.apiName,u.event)]}))}))},EdgeControlInjector.prototype.injectKeyboardEvent=function(l,d){return p(this,void 0,void 0,(function(){var l;return h(this,(function(u){return l=this.controlEventConverter.toEdgeControlKeyboardEvent(d),[2,this.edgeApi.sendInjectInputEventMessage(l.apiName,l.event)]}))}))},EdgeControlInjector.prototype.injectClipboardText=function(l,d){return this.logger.info(\"\".concat(l,\" EdgeControlInjector - injectClipboardText is unimplemented\")),Promise.resolve(0)},EdgeControlInjector.prototype.dispose=function(l){this.logger.info(\"EdgeControlInjector - dispose\"),this.edgeApi.sendCloseVirtualInputDeviceMessage()},EdgeControlInjector}();d.EdgeControlInjector=m},function(l,d,u){var p,h;Object.defineProperty(d,\"__esModule\",{value:!0}),d.EdgeControlEventConverter=d.EdgeControlEventData=void 0,function(l){l[l.LEFT=0]=\"LEFT\",l[l.RIGHT=1]=\"RIGHT\",l[l.MIDDLE=2]=\"MIDDLE\",l[l.BACK=3]=\"BACK\",l[l.FORWARD=4]=\"FORWARD\"}(p||(p={})),function(l){l[l.SCAN_CODE=0]=\"SCAN_CODE\",l[l.VIRTUAL_KEY=1]=\"VIRTUAL_KEY\",l[l.RECOGNITION_INPUT=2]=\"RECOGNITION_INPUT\"}(h||(h={}));var g=function(){function EdgeControlEventData(){}return EdgeControlEventData}();d.EdgeControlEventData=g;var f=function(){function EdgeControlEventConverter(l){this.logger=l}return EdgeControlEventConverter.prototype.toEdgeControlMouseEvent=function(l){var d;switch(l.type){case 0:return{event:this.toMouseMoveEvent(l),apiName:\"injectMouseMoveEvent\"};case 1:return{event:this.toMouseWheelEvent(l),apiName:\"injectMouseWheelEvent\"};case 2:return{event:this.toMouseButtonPressedEvent(l),apiName:\"injectMouseButtonEvent\"};default:throw d=\"Uncovered mouse control event type. Event: \".concat(l),this.logger.error(d),Error(d)}},EdgeControlEventConverter.prototype.toEdgeControlKeyboardEvent=function(l){return{event:{repeat:l.repeat,keyUp:l.keyUp,codeType:h[l.codeType],keyCode:l.code},apiName:\"injectKeyEvent\"}},EdgeControlEventConverter.prototype.toMouseMoveEvent=function(l){return{xPos:l.xPos,yPos:l.yPos}},EdgeControlEventConverter.prototype.toMouseWheelEvent=function(l){return{wheelButtonDown:l.wheelButtonDown,wheelRotation:l.wheelRotation}},EdgeControlEventConverter.prototype.toMouseButtonPressedEvent=function(l){return{xPos:l.xPos,yPos:l.yPos,button:p[l.buttonType],buttonDown:l.buttonDown}},EdgeControlEventConverter}();d.EdgeControlEventConverter=f},function(l,d,u){(function(l){var u=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},p=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};function pngBase64ToBitmap(d,h,g){return u(this,void 0,void 0,(function(){return p(this,(function(u){return[2,new Promise((function(u,p){var f=l.from(d,\"base64\"),m=document.createElement(\"canvas\").getContext(\"2d\"),v=new Blob([f],{type:\"image/png\"}),y=new Image;y.onload=function(){m.drawImage(y,0,0,y.width,y.height,0,0,h,g);var l=m.getImageData(0,0,h,g);window.URL.revokeObjectURL(y.src),y=null,u(Array.from(l.data))},y.onerror=function(l){p(l)},y.src=window.URL.createObjectURL(v)}))]}))}))}Object.defineProperty(d,\"__esModule\",{value:!0}),d.pngBase64ToBitmap=void 0,d.pngBase64ToBitmap=pngBase64ToBitmap}).call(this,u(312).Buffer)},function(l,d,u){(function(l){\r\n/*!\r\n\t * The buffer module from node.js, for the browser.\r\n\t *\r\n\t * @author   Feross Aboukhadijeh <http://feross.org>\r\n\t * @license  MIT\r\n\t */\r\nvar p=u(313),h=u(314),g=u(315);function typedArraySupport(){try{var l=new Uint8Array(1);return l.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===l.foo()&&\"function\"==typeof l.subarray&&0===l.subarray(1,1).byteLength}catch(l){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(l,d){if(kMaxLength()<d)throw new RangeError(\"Invalid typed array length\");return Buffer.TYPED_ARRAY_SUPPORT?(l=new Uint8Array(d)).__proto__=Buffer.prototype:(null===l&&(l=new Buffer(d)),l.length=d),l}function Buffer(l,d,u){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(l,d,u);if(\"number\"==typeof l){if(\"string\"==typeof d)throw new Error(\"If encoding is specified then the first argument must be a string\");return allocUnsafe(this,l)}return from(this,l,d,u)}function from(l,d,u,p){if(\"number\"==typeof d)throw new TypeError('\"value\" argument must not be a number');return\"undefined\"!=typeof ArrayBuffer&&d instanceof ArrayBuffer?fromArrayBuffer(l,d,u,p):\"string\"==typeof d?fromString(l,d,u):fromObject(l,d)}function assertSize(l){if(\"number\"!=typeof l)throw new TypeError('\"size\" argument must be a number');if(l<0)throw new RangeError('\"size\" argument must not be negative')}function alloc(l,d,u,p){return assertSize(d),d<=0?createBuffer(l,d):void 0!==u?\"string\"==typeof p?createBuffer(l,d).fill(u,p):createBuffer(l,d).fill(u):createBuffer(l,d)}function allocUnsafe(l,d){if(assertSize(d),l=createBuffer(l,d<0?0:0|checked(d)),!Buffer.TYPED_ARRAY_SUPPORT)for(var u=0;u<d;++u)l[u]=0;return l}function fromString(l,d,u){if(\"string\"==typeof u&&\"\"!==u||(u=\"utf8\"),!Buffer.isEncoding(u))throw new TypeError('\"encoding\" must be a valid string encoding');var p=0|byteLength(d,u),h=(l=createBuffer(l,p)).write(d,u);return h!==p&&(l=l.slice(0,h)),l}function fromArrayLike(l,d){var u=d.length<0?0:0|checked(d.length);l=createBuffer(l,u);for(var p=0;p<u;p+=1)l[p]=255&d[p];return l}function fromArrayBuffer(l,d,u,p){if(d.byteLength,u<0||d.byteLength<u)throw new RangeError(\"'offset' is out of bounds\");if(d.byteLength<u+(p||0))throw new RangeError(\"'length' is out of bounds\");return d=void 0===u&&void 0===p?new Uint8Array(d):void 0===p?new Uint8Array(d,u):new Uint8Array(d,u,p),Buffer.TYPED_ARRAY_SUPPORT?(l=d).__proto__=Buffer.prototype:l=fromArrayLike(l,d),l}function fromObject(l,d){if(Buffer.isBuffer(d)){var u=0|checked(d.length);return 0===(l=createBuffer(l,u)).length||d.copy(l,0,0,u),l}if(d){if(\"undefined\"!=typeof ArrayBuffer&&d.buffer instanceof ArrayBuffer||\"length\"in d)return\"number\"!=typeof d.length||isnan(d.length)?createBuffer(l,0):fromArrayLike(l,d);if(\"Buffer\"===d.type&&g(d.data))return fromArrayLike(l,d.data)}throw new TypeError(\"First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.\")}function checked(l){if(l>=kMaxLength())throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\"+kMaxLength().toString(16)+\" bytes\");return 0|l}function SlowBuffer(l){return+l!=l&&(l=0),Buffer.alloc(+l)}function byteLength(l,d){if(Buffer.isBuffer(l))return l.length;if(\"undefined\"!=typeof ArrayBuffer&&\"function\"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(l)||l instanceof ArrayBuffer))return l.byteLength;\"string\"!=typeof l&&(l=\"\"+l);var u=l.length;if(0===u)return 0;for(var p=!1;;)switch(d){case\"ascii\":case\"latin1\":case\"binary\":return u;case\"utf8\":case\"utf-8\":case void 0:return utf8ToBytes(l).length;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return 2*u;case\"hex\":return u>>>1;case\"base64\":return base64ToBytes(l).length;default:if(p)return utf8ToBytes(l).length;d=(\"\"+d).toLowerCase(),p=!0}}function slowToString(l,d,u){var p=!1;if((void 0===d||d<0)&&(d=0),d>this.length)return\"\";if((void 0===u||u>this.length)&&(u=this.length),u<=0)return\"\";if((u>>>=0)<=(d>>>=0))return\"\";for(l||(l=\"utf8\");;)switch(l){case\"hex\":return hexSlice(this,d,u);case\"utf8\":case\"utf-8\":return utf8Slice(this,d,u);case\"ascii\":return asciiSlice(this,d,u);case\"latin1\":case\"binary\":return latin1Slice(this,d,u);case\"base64\":return base64Slice(this,d,u);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return utf16leSlice(this,d,u);default:if(p)throw new TypeError(\"Unknown encoding: \"+l);l=(l+\"\").toLowerCase(),p=!0}}function swap(l,d,u){var p=l[d];l[d]=l[u],l[u]=p}function bidirectionalIndexOf(l,d,u,p,h){if(0===l.length)return-1;if(\"string\"==typeof u?(p=u,u=0):u>2147483647?u=2147483647:u<-2147483648&&(u=-2147483648),u=+u,isNaN(u)&&(u=h?0:l.length-1),u<0&&(u=l.length+u),u>=l.length){if(h)return-1;u=l.length-1}else if(u<0){if(!h)return-1;u=0}if(\"string\"==typeof d&&(d=Buffer.from(d,p)),Buffer.isBuffer(d))return 0===d.length?-1:arrayIndexOf(l,d,u,p,h);if(\"number\"==typeof d)return d&=255,Buffer.TYPED_ARRAY_SUPPORT&&\"function\"==typeof Uint8Array.prototype.indexOf?h?Uint8Array.prototype.indexOf.call(l,d,u):Uint8Array.prototype.lastIndexOf.call(l,d,u):arrayIndexOf(l,[d],u,p,h);throw new TypeError(\"val must be string, number or Buffer\")}function arrayIndexOf(l,d,u,p,h){var g,f=1,m=l.length,v=d.length;if(void 0!==p&&(\"ucs2\"===(p=String(p).toLowerCase())||\"ucs-2\"===p||\"utf16le\"===p||\"utf-16le\"===p)){if(l.length<2||d.length<2)return-1;f=2,m/=2,v/=2,u/=2}function read(l,d){return 1===f?l[d]:l.readUInt16BE(d*f)}if(h){var y=-1;for(g=u;g<m;g++)if(read(l,g)===read(d,-1===y?0:g-y)){if(-1===y&&(y=g),g-y+1===v)return y*f}else-1!==y&&(g-=g-y),y=-1}else for(u+v>m&&(u=m-v),g=u;g>=0;g--){for(var S=!0,_=0;_<v;_++)if(read(l,g+_)!==read(d,_)){S=!1;break}if(S)return g}return-1}function hexWrite(l,d,u,p){u=Number(u)||0;var h=l.length-u;p?(p=Number(p))>h&&(p=h):p=h;var g=d.length;if(g%2!=0)throw new TypeError(\"Invalid hex string\");p>g/2&&(p=g/2);for(var f=0;f<p;++f){var m=parseInt(d.substr(2*f,2),16);if(isNaN(m))return f;l[u+f]=m}return f}function utf8Write(l,d,u,p){return blitBuffer(utf8ToBytes(d,l.length-u),l,u,p)}function asciiWrite(l,d,u,p){return blitBuffer(asciiToBytes(d),l,u,p)}function latin1Write(l,d,u,p){return asciiWrite(l,d,u,p)}function base64Write(l,d,u,p){return blitBuffer(base64ToBytes(d),l,u,p)}function ucs2Write(l,d,u,p){return blitBuffer(utf16leToBytes(d,l.length-u),l,u,p)}function base64Slice(l,d,u){return 0===d&&u===l.length?p.fromByteArray(l):p.fromByteArray(l.slice(d,u))}function utf8Slice(l,d,u){u=Math.min(l.length,u);for(var p=[],h=d;h<u;){var g,f,m,v,y=l[h],S=null,_=y>239?4:y>223?3:y>191?2:1;if(h+_<=u)switch(_){case 1:y<128&&(S=y);break;case 2:128==(192&(g=l[h+1]))&&(v=(31&y)<<6|63&g)>127&&(S=v);break;case 3:g=l[h+1],f=l[h+2],128==(192&g)&&128==(192&f)&&(v=(15&y)<<12|(63&g)<<6|63&f)>2047&&(v<55296||v>57343)&&(S=v);break;case 4:g=l[h+1],f=l[h+2],m=l[h+3],128==(192&g)&&128==(192&f)&&128==(192&m)&&(v=(15&y)<<18|(63&g)<<12|(63&f)<<6|63&m)>65535&&v<1114112&&(S=v)}null===S?(S=65533,_=1):S>65535&&(S-=65536,p.push(S>>>10&1023|55296),S=56320|1023&S),p.push(S),h+=_}return decodeCodePointsArray(p)}d.Buffer=Buffer,d.SlowBuffer=SlowBuffer,d.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==l.TYPED_ARRAY_SUPPORT?l.TYPED_ARRAY_SUPPORT:typedArraySupport(),d.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(l){return l.__proto__=Buffer.prototype,l},Buffer.from=function(l,d,u){return from(null,l,d,u)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,\"undefined\"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(l,d,u){return alloc(null,l,d,u)},Buffer.allocUnsafe=function(l){return allocUnsafe(null,l)},Buffer.allocUnsafeSlow=function(l){return allocUnsafe(null,l)},Buffer.isBuffer=function isBuffer(l){return!(null==l||!l._isBuffer)},Buffer.compare=function compare(l,d){if(!Buffer.isBuffer(l)||!Buffer.isBuffer(d))throw new TypeError(\"Arguments must be Buffers\");if(l===d)return 0;for(var u=l.length,p=d.length,h=0,g=Math.min(u,p);h<g;++h)if(l[h]!==d[h]){u=l[h],p=d[h];break}return u<p?-1:p<u?1:0},Buffer.isEncoding=function isEncoding(l){switch(String(l).toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"latin1\":case\"binary\":case\"base64\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return!0;default:return!1}},Buffer.concat=function concat(l,d){if(!g(l))throw new TypeError('\"list\" argument must be an Array of Buffers');if(0===l.length)return Buffer.alloc(0);var u;if(void 0===d)for(d=0,u=0;u<l.length;++u)d+=l[u].length;var p=Buffer.allocUnsafe(d),h=0;for(u=0;u<l.length;++u){var f=l[u];if(!Buffer.isBuffer(f))throw new TypeError('\"list\" argument must be an Array of Buffers');f.copy(p,h),h+=f.length}return p},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var l=this.length;if(l%2!=0)throw new RangeError(\"Buffer size must be a multiple of 16-bits\");for(var d=0;d<l;d+=2)swap(this,d,d+1);return this},Buffer.prototype.swap32=function swap32(){var l=this.length;if(l%4!=0)throw new RangeError(\"Buffer size must be a multiple of 32-bits\");for(var d=0;d<l;d+=4)swap(this,d,d+3),swap(this,d+1,d+2);return this},Buffer.prototype.swap64=function swap64(){var l=this.length;if(l%8!=0)throw new RangeError(\"Buffer size must be a multiple of 64-bits\");for(var d=0;d<l;d+=8)swap(this,d,d+7),swap(this,d+1,d+6),swap(this,d+2,d+5),swap(this,d+3,d+4);return this},Buffer.prototype.toString=function toString(){var l=0|this.length;return 0===l?\"\":0===arguments.length?utf8Slice(this,0,l):slowToString.apply(this,arguments)},Buffer.prototype.equals=function equals(l){if(!Buffer.isBuffer(l))throw new TypeError(\"Argument must be a Buffer\");return this===l||0===Buffer.compare(this,l)},Buffer.prototype.inspect=function inspect(){var l=\"\",u=d.INSPECT_MAX_BYTES;return this.length>0&&(l=this.toString(\"hex\",0,u).match(/.{2}/g).join(\" \"),this.length>u&&(l+=\" ... \")),\"<Buffer \"+l+\">\"},Buffer.prototype.compare=function compare(l,d,u,p,h){if(!Buffer.isBuffer(l))throw new TypeError(\"Argument must be a Buffer\");if(void 0===d&&(d=0),void 0===u&&(u=l?l.length:0),void 0===p&&(p=0),void 0===h&&(h=this.length),d<0||u>l.length||p<0||h>this.length)throw new RangeError(\"out of range index\");if(p>=h&&d>=u)return 0;if(p>=h)return-1;if(d>=u)return 1;if(this===l)return 0;for(var g=(h>>>=0)-(p>>>=0),f=(u>>>=0)-(d>>>=0),m=Math.min(g,f),v=this.slice(p,h),y=l.slice(d,u),S=0;S<m;++S)if(v[S]!==y[S]){g=v[S],f=y[S];break}return g<f?-1:f<g?1:0},Buffer.prototype.includes=function includes(l,d,u){return-1!==this.indexOf(l,d,u)},Buffer.prototype.indexOf=function indexOf(l,d,u){return bidirectionalIndexOf(this,l,d,u,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(l,d,u){return bidirectionalIndexOf(this,l,d,u,!1)},Buffer.prototype.write=function write(l,d,u,p){if(void 0===d)p=\"utf8\",u=this.length,d=0;else if(void 0===u&&\"string\"==typeof d)p=d,u=this.length,d=0;else{if(!isFinite(d))throw new Error(\"Buffer.write(string, encoding, offset[, length]) is no longer supported\");d|=0,isFinite(u)?(u|=0,void 0===p&&(p=\"utf8\")):(p=u,u=void 0)}var h=this.length-d;if((void 0===u||u>h)&&(u=h),l.length>0&&(u<0||d<0)||d>this.length)throw new RangeError(\"Attempt to write outside buffer bounds\");p||(p=\"utf8\");for(var g=!1;;)switch(p){case\"hex\":return hexWrite(this,l,d,u);case\"utf8\":case\"utf-8\":return utf8Write(this,l,d,u);case\"ascii\":return asciiWrite(this,l,d,u);case\"latin1\":case\"binary\":return latin1Write(this,l,d,u);case\"base64\":return base64Write(this,l,d,u);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return ucs2Write(this,l,d,u);default:if(g)throw new TypeError(\"Unknown encoding: \"+p);p=(\"\"+p).toLowerCase(),g=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:\"Buffer\",data:Array.prototype.slice.call(this._arr||this,0)}};var f=4096;function decodeCodePointsArray(l){var d=l.length;if(d<=f)return String.fromCharCode.apply(String,l);for(var u=\"\",p=0;p<d;)u+=String.fromCharCode.apply(String,l.slice(p,p+=f));return u}function asciiSlice(l,d,u){var p=\"\";u=Math.min(l.length,u);for(var h=d;h<u;++h)p+=String.fromCharCode(127&l[h]);return p}function latin1Slice(l,d,u){var p=\"\";u=Math.min(l.length,u);for(var h=d;h<u;++h)p+=String.fromCharCode(l[h]);return p}function hexSlice(l,d,u){var p=l.length;(!d||d<0)&&(d=0),(!u||u<0||u>p)&&(u=p);for(var h=\"\",g=d;g<u;++g)h+=toHex(l[g]);return h}function utf16leSlice(l,d,u){for(var p=l.slice(d,u),h=\"\",g=0;g<p.length;g+=2)h+=String.fromCharCode(p[g]+256*p[g+1]);return h}function checkOffset(l,d,u){if(l%1!=0||l<0)throw new RangeError(\"offset is not uint\");if(l+d>u)throw new RangeError(\"Trying to access beyond buffer length\")}function checkInt(l,d,u,p,h,g){if(!Buffer.isBuffer(l))throw new TypeError('\"buffer\" argument must be a Buffer instance');if(d>h||d<g)throw new RangeError('\"value\" argument is out of bounds');if(u+p>l.length)throw new RangeError(\"Index out of range\")}function objectWriteUInt16(l,d,u,p){d<0&&(d=65535+d+1);for(var h=0,g=Math.min(l.length-u,2);h<g;++h)l[u+h]=(d&255<<8*(p?h:1-h))>>>8*(p?h:1-h)}function objectWriteUInt32(l,d,u,p){d<0&&(d=4294967295+d+1);for(var h=0,g=Math.min(l.length-u,4);h<g;++h)l[u+h]=d>>>8*(p?h:3-h)&255}function checkIEEE754(l,d,u,p,h,g){if(u+p>l.length)throw new RangeError(\"Index out of range\");if(u<0)throw new RangeError(\"Index out of range\")}function writeFloat(l,d,u,p,g){return g||checkIEEE754(l,d,u,4),h.write(l,d,u,p,23,4),u+4}function writeDouble(l,d,u,p,g){return g||checkIEEE754(l,d,u,8),h.write(l,d,u,p,52,8),u+8}Buffer.prototype.slice=function slice(l,d){var u,p=this.length;if((l=~~l)<0?(l+=p)<0&&(l=0):l>p&&(l=p),(d=void 0===d?p:~~d)<0?(d+=p)<0&&(d=0):d>p&&(d=p),d<l&&(d=l),Buffer.TYPED_ARRAY_SUPPORT)(u=this.subarray(l,d)).__proto__=Buffer.prototype;else{var h=d-l;u=new Buffer(h,void 0);for(var g=0;g<h;++g)u[g]=this[g+l]}return u},Buffer.prototype.readUIntLE=function readUIntLE(l,d,u){l|=0,d|=0,u||checkOffset(l,d,this.length);for(var p=this[l],h=1,g=0;++g<d&&(h*=256);)p+=this[l+g]*h;return p},Buffer.prototype.readUIntBE=function readUIntBE(l,d,u){l|=0,d|=0,u||checkOffset(l,d,this.length);for(var p=this[l+--d],h=1;d>0&&(h*=256);)p+=this[l+--d]*h;return p},Buffer.prototype.readUInt8=function readUInt8(l,d){return d||checkOffset(l,1,this.length),this[l]},Buffer.prototype.readUInt16LE=function readUInt16LE(l,d){return d||checkOffset(l,2,this.length),this[l]|this[l+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(l,d){return d||checkOffset(l,2,this.length),this[l]<<8|this[l+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(l,d){return d||checkOffset(l,4,this.length),(this[l]|this[l+1]<<8|this[l+2]<<16)+16777216*this[l+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(l,d){return d||checkOffset(l,4,this.length),16777216*this[l]+(this[l+1]<<16|this[l+2]<<8|this[l+3])},Buffer.prototype.readIntLE=function readIntLE(l,d,u){l|=0,d|=0,u||checkOffset(l,d,this.length);for(var p=this[l],h=1,g=0;++g<d&&(h*=256);)p+=this[l+g]*h;return p>=(h*=128)&&(p-=Math.pow(2,8*d)),p},Buffer.prototype.readIntBE=function readIntBE(l,d,u){l|=0,d|=0,u||checkOffset(l,d,this.length);for(var p=d,h=1,g=this[l+--p];p>0&&(h*=256);)g+=this[l+--p]*h;return g>=(h*=128)&&(g-=Math.pow(2,8*d)),g},Buffer.prototype.readInt8=function readInt8(l,d){return d||checkOffset(l,1,this.length),128&this[l]?-1*(255-this[l]+1):this[l]},Buffer.prototype.readInt16LE=function readInt16LE(l,d){d||checkOffset(l,2,this.length);var u=this[l]|this[l+1]<<8;return 32768&u?4294901760|u:u},Buffer.prototype.readInt16BE=function readInt16BE(l,d){d||checkOffset(l,2,this.length);var u=this[l+1]|this[l]<<8;return 32768&u?4294901760|u:u},Buffer.prototype.readInt32LE=function readInt32LE(l,d){return d||checkOffset(l,4,this.length),this[l]|this[l+1]<<8|this[l+2]<<16|this[l+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(l,d){return d||checkOffset(l,4,this.length),this[l]<<24|this[l+1]<<16|this[l+2]<<8|this[l+3]},Buffer.prototype.readFloatLE=function readFloatLE(l,d){return d||checkOffset(l,4,this.length),h.read(this,l,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(l,d){return d||checkOffset(l,4,this.length),h.read(this,l,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(l,d){return d||checkOffset(l,8,this.length),h.read(this,l,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(l,d){return d||checkOffset(l,8,this.length),h.read(this,l,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(l,d,u,p){(l=+l,d|=0,u|=0,p)||checkInt(this,l,d,u,Math.pow(2,8*u)-1,0);var h=1,g=0;for(this[d]=255&l;++g<u&&(h*=256);)this[d+g]=l/h&255;return d+u},Buffer.prototype.writeUIntBE=function writeUIntBE(l,d,u,p){(l=+l,d|=0,u|=0,p)||checkInt(this,l,d,u,Math.pow(2,8*u)-1,0);var h=u-1,g=1;for(this[d+h]=255&l;--h>=0&&(g*=256);)this[d+h]=l/g&255;return d+u},Buffer.prototype.writeUInt8=function writeUInt8(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(l=Math.floor(l)),this[d]=255&l,d+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[d]=255&l,this[d+1]=l>>>8):objectWriteUInt16(this,l,d,!0),d+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[d]=l>>>8,this[d+1]=255&l):objectWriteUInt16(this,l,d,!1),d+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[d+3]=l>>>24,this[d+2]=l>>>16,this[d+1]=l>>>8,this[d]=255&l):objectWriteUInt32(this,l,d,!0),d+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[d]=l>>>24,this[d+1]=l>>>16,this[d+2]=l>>>8,this[d+3]=255&l):objectWriteUInt32(this,l,d,!1),d+4},Buffer.prototype.writeIntLE=function writeIntLE(l,d,u,p){if(l=+l,d|=0,!p){var h=Math.pow(2,8*u-1);checkInt(this,l,d,u,h-1,-h)}var g=0,f=1,m=0;for(this[d]=255&l;++g<u&&(f*=256);)l<0&&0===m&&0!==this[d+g-1]&&(m=1),this[d+g]=(l/f>>0)-m&255;return d+u},Buffer.prototype.writeIntBE=function writeIntBE(l,d,u,p){if(l=+l,d|=0,!p){var h=Math.pow(2,8*u-1);checkInt(this,l,d,u,h-1,-h)}var g=u-1,f=1,m=0;for(this[d+g]=255&l;--g>=0&&(f*=256);)l<0&&0===m&&0!==this[d+g+1]&&(m=1),this[d+g]=(l/f>>0)-m&255;return d+u},Buffer.prototype.writeInt8=function writeInt8(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(l=Math.floor(l)),l<0&&(l=255+l+1),this[d]=255&l,d+1},Buffer.prototype.writeInt16LE=function writeInt16LE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[d]=255&l,this[d+1]=l>>>8):objectWriteUInt16(this,l,d,!0),d+2},Buffer.prototype.writeInt16BE=function writeInt16BE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[d]=l>>>8,this[d+1]=255&l):objectWriteUInt16(this,l,d,!1),d+2},Buffer.prototype.writeInt32LE=function writeInt32LE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[d]=255&l,this[d+1]=l>>>8,this[d+2]=l>>>16,this[d+3]=l>>>24):objectWriteUInt32(this,l,d,!0),d+4},Buffer.prototype.writeInt32BE=function writeInt32BE(l,d,u){return l=+l,d|=0,u||checkInt(this,l,d,4,2147483647,-2147483648),l<0&&(l=4294967295+l+1),Buffer.TYPED_ARRAY_SUPPORT?(this[d]=l>>>24,this[d+1]=l>>>16,this[d+2]=l>>>8,this[d+3]=255&l):objectWriteUInt32(this,l,d,!1),d+4},Buffer.prototype.writeFloatLE=function writeFloatLE(l,d,u){return writeFloat(this,l,d,!0,u)},Buffer.prototype.writeFloatBE=function writeFloatBE(l,d,u){return writeFloat(this,l,d,!1,u)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(l,d,u){return writeDouble(this,l,d,!0,u)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(l,d,u){return writeDouble(this,l,d,!1,u)},Buffer.prototype.copy=function copy(l,d,u,p){if(u||(u=0),p||0===p||(p=this.length),d>=l.length&&(d=l.length),d||(d=0),p>0&&p<u&&(p=u),p===u)return 0;if(0===l.length||0===this.length)return 0;if(d<0)throw new RangeError(\"targetStart out of bounds\");if(u<0||u>=this.length)throw new RangeError(\"sourceStart out of bounds\");if(p<0)throw new RangeError(\"sourceEnd out of bounds\");p>this.length&&(p=this.length),l.length-d<p-u&&(p=l.length-d+u);var h,g=p-u;if(this===l&&u<d&&d<p)for(h=g-1;h>=0;--h)l[h+d]=this[h+u];else if(g<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(h=0;h<g;++h)l[h+d]=this[h+u];else Uint8Array.prototype.set.call(l,this.subarray(u,u+g),d);return g},Buffer.prototype.fill=function fill(l,d,u,p){if(\"string\"==typeof l){if(\"string\"==typeof d?(p=d,d=0,u=this.length):\"string\"==typeof u&&(p=u,u=this.length),1===l.length){var h=l.charCodeAt(0);h<256&&(l=h)}if(void 0!==p&&\"string\"!=typeof p)throw new TypeError(\"encoding must be a string\");if(\"string\"==typeof p&&!Buffer.isEncoding(p))throw new TypeError(\"Unknown encoding: \"+p)}else\"number\"==typeof l&&(l&=255);if(d<0||this.length<d||this.length<u)throw new RangeError(\"Out of range index\");if(u<=d)return this;var g;if(d>>>=0,u=void 0===u?this.length:u>>>0,l||(l=0),\"number\"==typeof l)for(g=d;g<u;++g)this[g]=l;else{var f=Buffer.isBuffer(l)?l:utf8ToBytes(new Buffer(l,p).toString()),m=f.length;for(g=0;g<u-d;++g)this[g+d]=f[g%m]}return this};var m=/[^+\\/0-9A-Za-z-_]/g;function base64clean(l){if((l=stringtrim(l).replace(m,\"\")).length<2)return\"\";for(;l.length%4!=0;)l+=\"=\";return l}function stringtrim(l){return l.trim?l.trim():l.replace(/^\\s+|\\s+$/g,\"\")}function toHex(l){return l<16?\"0\"+l.toString(16):l.toString(16)}function utf8ToBytes(l,d){var u;d=d||1/0;for(var p=l.length,h=null,g=[],f=0;f<p;++f){if((u=l.charCodeAt(f))>55295&&u<57344){if(!h){if(u>56319){(d-=3)>-1&&g.push(239,191,189);continue}if(f+1===p){(d-=3)>-1&&g.push(239,191,189);continue}h=u;continue}if(u<56320){(d-=3)>-1&&g.push(239,191,189),h=u;continue}u=65536+(h-55296<<10|u-56320)}else h&&(d-=3)>-1&&g.push(239,191,189);if(h=null,u<128){if((d-=1)<0)break;g.push(u)}else if(u<2048){if((d-=2)<0)break;g.push(u>>6|192,63&u|128)}else if(u<65536){if((d-=3)<0)break;g.push(u>>12|224,u>>6&63|128,63&u|128)}else{if(!(u<1114112))throw new Error(\"Invalid code point\");if((d-=4)<0)break;g.push(u>>18|240,u>>12&63|128,u>>6&63|128,63&u|128)}}return g}function asciiToBytes(l){for(var d=[],u=0;u<l.length;++u)d.push(255&l.charCodeAt(u));return d}function utf16leToBytes(l,d){for(var u,p,h,g=[],f=0;f<l.length&&!((d-=2)<0);++f)p=(u=l.charCodeAt(f))>>8,h=u%256,g.push(h),g.push(p);return g}function base64ToBytes(l){return p.toByteArray(base64clean(l))}function blitBuffer(l,d,u,p){for(var h=0;h<p&&!(h+u>=d.length||h>=l.length);++h)d[h+u]=l[h];return h}function isnan(l){return l!=l}}).call(this,u(63))},function(l,d,u){d.byteLength=byteLength,d.toByteArray=toByteArray,d.fromByteArray=fromByteArray;for(var p=[],h=[],g=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,f=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",m=0,v=f.length;m<v;++m)p[m]=f[m],h[f.charCodeAt(m)]=m;function getLens(l){var d=l.length;if(d%4>0)throw new Error(\"Invalid string. Length must be a multiple of 4\");var u=l.indexOf(\"=\");return-1===u&&(u=d),[u,u===d?0:4-u%4]}function byteLength(l){var d=getLens(l),u=d[0],p=d[1];return 3*(u+p)/4-p}function _byteLength(l,d,u){return 3*(d+u)/4-u}function toByteArray(l){var d,u,p=getLens(l),f=p[0],m=p[1],v=new g(_byteLength(l,f,m)),y=0,S=m>0?f-4:f;for(u=0;u<S;u+=4)d=h[l.charCodeAt(u)]<<18|h[l.charCodeAt(u+1)]<<12|h[l.charCodeAt(u+2)]<<6|h[l.charCodeAt(u+3)],v[y++]=d>>16&255,v[y++]=d>>8&255,v[y++]=255&d;return 2===m&&(d=h[l.charCodeAt(u)]<<2|h[l.charCodeAt(u+1)]>>4,v[y++]=255&d),1===m&&(d=h[l.charCodeAt(u)]<<10|h[l.charCodeAt(u+1)]<<4|h[l.charCodeAt(u+2)]>>2,v[y++]=d>>8&255,v[y++]=255&d),v}function tripletToBase64(l){return p[l>>18&63]+p[l>>12&63]+p[l>>6&63]+p[63&l]}function encodeChunk(l,d,u){for(var p,h=[],g=d;g<u;g+=3)p=(l[g]<<16&16711680)+(l[g+1]<<8&65280)+(255&l[g+2]),h.push(tripletToBase64(p));return h.join(\"\")}function fromByteArray(l){for(var d,u=l.length,h=u%3,g=[],f=16383,m=0,v=u-h;m<v;m+=f)g.push(encodeChunk(l,m,m+f>v?v:m+f));return 1===h?(d=l[u-1],g.push(p[d>>2]+p[d<<4&63]+\"==\")):2===h&&(d=(l[u-2]<<8)+l[u-1],g.push(p[d>>10]+p[d>>4&63]+p[d<<2&63]+\"=\")),g.join(\"\")}h[\"-\".charCodeAt(0)]=62,h[\"_\".charCodeAt(0)]=63},function(l,d){\r\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\r\nd.read=function(l,d,u,p,h){var g,f,m=8*h-p-1,v=(1<<m)-1,y=v>>1,S=-7,_=u?h-1:0,C=u?-1:1,E=l[d+_];for(_+=C,g=E&(1<<-S)-1,E>>=-S,S+=m;S>0;g=256*g+l[d+_],_+=C,S-=8);for(f=g&(1<<-S)-1,g>>=-S,S+=p;S>0;f=256*f+l[d+_],_+=C,S-=8);if(0===g)g=1-y;else{if(g===v)return f?NaN:1/0*(E?-1:1);f+=Math.pow(2,p),g-=y}return(E?-1:1)*f*Math.pow(2,g-p)},d.write=function(l,d,u,p,h,g){var f,m,v,y=8*g-h-1,S=(1<<y)-1,_=S>>1,C=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,E=p?0:g-1,T=p?1:-1,b=d<0||0===d&&1/d<0?1:0;for(d=Math.abs(d),isNaN(d)||d===1/0?(m=isNaN(d)?1:0,f=S):(f=Math.floor(Math.log(d)/Math.LN2),d*(v=Math.pow(2,-f))<1&&(f--,v*=2),(d+=f+_>=1?C/v:C*Math.pow(2,1-_))*v>=2&&(f++,v/=2),f+_>=S?(m=0,f=S):f+_>=1?(m=(d*v-1)*Math.pow(2,h),f+=_):(m=d*Math.pow(2,_-1)*Math.pow(2,h),f=0));h>=8;l[u+E]=255&m,E+=T,m/=256,h-=8);for(f=f<<h|m,y+=h;y>0;l[u+E]=255&f,E+=T,f/=256,y-=8);l[u+E-T]|=128*b}},function(l,d){var u={}.toString;l.exports=Array.isArray||function(l){return\"[object Array]\"==u.call(l)}},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};function createParticipantListFromMriMap(l){var d,u,h,g,f=[];try{for(var m=p(Object.keys(l)),v=m.next();!v.done;v=m.next()){var y=v.value;if(l[y].participantLegIds)try{for(var S=(h=void 0,p(l[y].participantLegIds)),_=S.next();!_.done;_=S.next()){var C=_.value;f.push({id:y,mri:y,participantId:C})}}catch(l){h={error:l}}finally{try{_&&!_.done&&(g=S.return)&&g.call(S)}finally{if(h)throw h.error}}else f.push({id:y,mri:y})}}catch(l){d={error:l}}finally{try{v&&!v.done&&(u=m.return)&&u.call(m)}finally{if(d)throw d.error}}return f}function mapParticipantScope(l){switch(l){case 1:return\"specified\";case 0:return\"all\";case 3:return\"attendees\";case 2:return\"presenters\";default:return\"none\"}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.mapParticipantScope=d.createParticipantListFromMriMap=void 0,d.createParticipantListFromMriMap=createParticipantListFromMriMap,d.mapParticipantScope=mapParticipantScope},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.hasReceiveDirectionality=d.hasSendDirectionality=void 0;var p=u(9);Object.defineProperty(d,\"hasSendDirectionality\",{enumerable:!0,get:function(){return p.hasSendDirectionality}}),Object.defineProperty(d,\"hasReceiveDirectionality\",{enumerable:!0,get:function(){return p.hasReceiveDirectionality}})},function(l,d,u){function getStreamInformation(l){var d=[];return l.forEach((function(l){try{var u=d.find((function(d){return d.participantId===l.participantId&&d.endpointId===l.endpointId}));u||(u={participantId:l.participantId,endpointId:l.endpointId},d.push(u)),\"audio\"!==l.type&&\"audioteleconference\"!==l.type||(u.serverMuted=l.serverMuted),u[l.type]=l.direction}catch(l){d=[]}})),d}Object.defineProperty(d,\"__esModule\",{value:!0}),d.getStreamInformation=void 0,d.getStreamInformation=getStreamInformation},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(8),f=function(){function NoopLogger(l){var d=this;this._prefix=l,this._children=[],this._useConsoleLogger=!1,this.createChild=function(l,u){var p=\"function\"==typeof l?\"\":l,h=new NoopLogger((d._prefix||\"\")+p);return d._children.push(h),d._useConsoleLogger&&h.useConsoleLogger(),h},this.createFnLogger=function(l,u){for(var p=[],h=2;h<arguments.length;h++)p[h-2]=arguments[h];var g=\"[\".concat(u,\"][\").concat(l,\"]\"),f=new NoopLogger((d._prefix||\"\")+g);return d._children.push(f),d._useConsoleLogger&&f.useConsoleLogger(),f}}return NoopLogger.prototype.logInfo=function(){},NoopLogger.prototype.logFailure=function(){},NoopLogger.prototype.logSuccess=function(){},NoopLogger.prototype.log=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d]},NoopLogger.prototype.debug=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d]},NoopLogger.prototype.info=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d]},NoopLogger.prototype.warn=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d]},NoopLogger.prototype.error=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d]},NoopLogger.prototype.useConsoleLogger=function(){var l=this;this._useConsoleLogger=!0;var logWithConsole=function(){for(var d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];console.info.apply(console,h([l._prefix||\"\"],p(d),!1))};this.log=logWithConsole,this.debug=logWithConsole,this.info=logWithConsole,this.warn=logWithConsole,this.error=logWithConsole,g.each(this._children,(function(l){return l.useConsoleLogger()}))},NoopLogger}();d.default=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(15),h=function(){function Capabilities(l){var d=this;this.configProvider=l,this.window=p.default.window,this.updateCapabilityOverrides(),this.configProviderSub=l.on(\"configUpdated\",(function(){return d.updateCapabilityOverrides()}))}return Object.defineProperty(Capabilities.prototype,\"audio\",{get:function(){return this.getCapability(\"audio\")},enumerable:!1,configurable:!0}),Object.defineProperty(Capabilities.prototype,\"video\",{get:function(){return this.getCapability(\"video\")},enumerable:!1,configurable:!0}),Object.defineProperty(Capabilities.prototype,\"screensharing\",{get:function(){return this.getCapability(\"screensharing\")},enumerable:!1,configurable:!0}),Object.defineProperty(Capabilities.prototype,\"retargeting\",{get:function(){return this.getCapability(\"retargeting\")},enumerable:!1,configurable:!0}),Capabilities.prototype.dispose=function(){this.configProviderSub&&this.configProviderSub.dispose()},Capabilities.prototype.updateCapabilityOverrides=function(){var l;this.configProvider.config.capabilities&&(this.hasOrtc()?l=this.configProvider.config.capabilities.ortc:this.hasWebRtc()&&(l=this.configProvider.config.capabilities.webrtc)),this.overrides=l||{}},Capabilities.prototype.hasMediaCapture=function(){return!!this.window.navigator.getUserMedia},Capabilities.prototype.getCapability=function(l){return void 0!==this.overrides[l]?!!this.overrides[l]:this.hasMediaCapture()&&(this.hasOrtc()||this.hasWebRtc())},Capabilities.prototype.hasWebRtc=function(){return void 0!==this.window.RTCPeerConnection},Capabilities.prototype.hasOrtc=function(){return void 0!==this.window.RTCIceGatherer},Capabilities}();d.default=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},g=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.getQualityEventType=d.UFDManager=void 0;var f=u(19),m=u(13),v=function(l){function UFDManager(d,u){var p=l.call(this)||this;return p.logger=d,p.configProvider=u,p.eventStates=new Map,p.swMuted=!1,p.logger.safe.info(\"Initialized\"),p}return p(UFDManager,l),UFDManager.prototype.signalEvent=function(l,d,u,p,h){void 0===u&&(u=\"Audio\"),void 0===p&&(p=!0),void 0===h&&(h=(0,m.generateCauseId)());var g={type:l,value:d,isLocalSource:p,mediaType:u},f=this.getEventKey(g),v=this.eventStates.get(f);(!v||v.value!==d||this.configProvider.config.alwaysRaiseBadDeviceEvents&&\"Good\"!==d)&&(v||\"Good\"!==d)&&(this.eventStates.set(f,g),this.shouldRaiseEvent(g,v)&&(this.logger.safe.info(\"[\".concat(h,\"] Raising UFD \").concat(l,\" for \").concat(u,\": \").concat(d)),this.event(\"onQualityChanged\").raise(g)))},UFDManager.prototype.signalDeviceEvent=function(l,d,u){var p=getQualityEventType(l,u);p?this.signalEvent(p,d,u):this.logger.warn(\"Unknown device quality event type: \".concat(l))},UFDManager.prototype.raisePendingWhitelistingUFD=function(){this.lastWhitelistingUFD&&(this.logger.safe.debug(\"Raising whitelisting UFD \".concat(this.lastWhitelistingUFD.type,\": \").concat(this.lastWhitelistingUFD.value)),this.event(\"onQualityChanged\").raise(this.lastWhitelistingUFD))},UFDManager.prototype.cancelPendingWhitelistingUFD=function(){this.lastWhitelistingUFD=void 0},UFDManager.prototype.setSwMute=function(l){if(this.swMuted=l,l){var d=this.eventStates.get(this.getEventKey({type:\"DeviceSpeakWhileMuted\",mediaType:\"Audio\"}));d&&\"Good\"!==d.value&&this.event(\"onQualityChanged\").raise(d)}},UFDManager.prototype.applyCurrentState=function(l){var d,u,p=0;try{for(var g=h(this.eventStates.values()),f=g.next();!f.done;f=g.next()){var m=f.value;\"Good\"!==m.value&&(l(m),p++)}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=g.return)&&u.call(g)}finally{if(d)throw d.error}}p>0&&this.logger.safe.info(\"Applied \".concat(p,\" UFDs\"))},UFDManager.prototype.reset=function(){var l,d;this.logger.safe.info(\"Resetting UFD states\");try{for(var u=h(this.eventStates.entries()),p=u.next();!p.done;p=u.next()){var f=g(p.value,2),m=f[0],v=f[1];UFDManager.persistent.has(v.type)||this.eventStates.delete(m)}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}this.lastWhitelistingUFD=void 0,this.swMuted=!1},UFDManager.prototype.getEventKey=function(l){return\"\".concat(l.type,\":\").concat(l.mediaType)},UFDManager.prototype.shouldRaiseEvent=function(l,d){return\"NetworkRelaysNotReachable\"===l.type?(this.lastWhitelistingUFD=l,!1):!!(\"DeviceSpeakWhileMuted\"!==l.type||this.swMuted||\"Good\"===l.value&&\"Good\"!==(null==d?void 0:d.value))&&(!!(\"NetworkRecvQuality\"!==l.type||\"Edge\"!==(0,f.getBrowserInfo)().name&&this.configProvider.config.webrtcStatNetworkDetectionEnabled)&&!(this.configProvider.config.alwaysRaiseBadDeviceEvents&&!UFDManager.deviceQualityEvents.has(l.type)&&l.value===(null==d?void 0:d.value)))},UFDManager.persistent=new Set([\"ZeroCaptureDevicesEnumerated\",\"ZeroRenderDevicesEnumerated\"]),UFDManager.deviceQualityEvents=new Set([\"DeviceCaptureNotFunctioning\",\"VideoCapturerDeviceStartFailed\",\"DeviceCaptureNotFunctioning\",\"VideoCapturerDeviceStartTimedOut\",\"DeviceCaptureMute\",\"ScreenshareRecordingDisabled\",\"DeviceCaptureNotMuteButSilent\",\"VideoCapturePermissionDenied\"]),UFDManager}(u(7).default);function getQualityEventType(l,d){switch(l){case 0:return\"Audio\"===d?\"DeviceCaptureNotFunctioning\":\"VideoCapturerDeviceStartFailed\";case 1:return\"Audio\"===d?\"DeviceCaptureNotFunctioning\":\"VideoCapturerDeviceStartTimedOut\";case 2:return\"DeviceCaptureMute\";case 3:switch(d){case\"ScreenShare\":return\"ScreenshareRecordingDisabled\";case\"Audio\":return\"DeviceCaptureNotMuteButSilent\";case\"Video\":return\"VideoCapturePermissionDenied\";default:return}default:return}}d.UFDManager=v,d.getQualityEventType=getQualityEventType},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(8),g=u(7),f=u(1),m=u(9),v=u(323),y=u(27),S=function(){function MediaSettingsImp(l){this.settings=l,this.isTransportUnbundled=!1,this.webrtcRejectedFeatures=\"\",this.webrtcRequiredFeatures=\"\",this._maxBandwidthInKbps=0,this._noiseSuppressionMode=\"Auto\"}return MediaSettingsImp.prototype.setMediaConfiguration=function(l){this.maxBandwidthInKbps=Math.floor((l.maxBandwidthInBps||0)/1e3),this.isTransportUnbundled=this.settings.forceUnbundledTransport||this.settings.enableQosSupport&&(l.enableMediaQoS||!!l.mediaPortRanges),this._mediaPortRanges=l.mediaPortRanges,this.simulcastSessionEnabled=this.settings.webrtcSimulcastSessionEnabled&&(0,m.canUseWebrtc1_0)(this.settings.checkSupportForWebrtc_1_0),this._noiseSuppressionMode=l.noiseSuppressionMode||\"Auto\",this.webrtcRejectedFeatures=l.enableMediaBypass?\"\":this.settings.webrtcRejectedFeatures,this.webrtcRequiredFeatures=l.enableMediaBypass?\"\":this.settings.webrtcRequiredFeatures},Object.defineProperty(MediaSettingsImp.prototype,\"noiseSuppressionMode\",{get:function(){return this._noiseSuppressionMode},enumerable:!1,configurable:!0}),Object.defineProperty(MediaSettingsImp.prototype,\"maxBandwidthInKbps\",{get:function(){return this._maxBandwidthInKbps},set:function(l){this._maxBandwidthInKbps=l,this.settings.maxBandwidthInKbps&&(this._maxBandwidthInKbps=Math.min(this.settings.maxBandwidthInKbps,this._maxBandwidthInKbps||Number.MAX_SAFE_INTEGER))},enumerable:!1,configurable:!0}),Object.defineProperty(MediaSettingsImp.prototype,\"audioPortRange\",{get:function(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.audioMin&&this._mediaPortRanges.audioMax)return{min:this._mediaPortRanges.audioMin,max:this._mediaPortRanges.audioMax}},enumerable:!1,configurable:!0}),Object.defineProperty(MediaSettingsImp.prototype,\"videoPortRange\",{get:function(){if(this.isTransportUnbundled&&this._mediaPortRanges&&this._mediaPortRanges.videoMin&&this._mediaPortRanges.videoMax)return{min:this._mediaPortRanges.videoMin,max:this._mediaPortRanges.videoMax}},enumerable:!1,configurable:!0}),MediaSettingsImp}(),arrayMergeCustomizer=function(l,d){if(Array.isArray(l))return d.slice()},_=function(l){function ConfigProvider(d,u,p){var g,m=this;return(m=l.call(this)||this).logger=d,m.platformCallConstraintsProvider=u,m.platformConfig=(0,v.getPlatformConfig)(),m.sessionCount=0,m.initialSettings=f.deepClone(m.platformConfig.getInitialSettings()),m.consoleOverridesInternal={},m.uaConfig=new y.UserAgentConfig(m),m.mediaConfiguration={},p&&(m.stackSettings=f.deepClone(p),h.mergeWith(m.initialSettings,p,arrayMergeCustomizer)),h.mergeWith(m.initialSettings,m.platformConfig.getEnforcedSettings(),arrayMergeCustomizer),m.settings=m.initialSettings,m.settingsOut=m.settings,m.mediaSettings=new S(m.settingsOut),null===(g=m.platformCallConstraintsProvider)||void 0===g||g.changed((function(){m.updateConfigInternal(m.settings)})),m.logger.safe.info(\"Initialized\"),m}return p(ConfigProvider,l),ConfigProvider.prototype.getConfigView=function(l){var d=l?\"Multiparty\":\"1on1\",u=h.cloneDeep(this.settingsOut);Object.keys(u).forEach((function(l){l.endsWith(d)&&(u[l.replace(d,\"\")]=u[l])}));var p=new S(u);return p.setMediaConfiguration(this.mediaConfiguration),{config:u,mediaConfig:p,countryCode:this.countryCode,userAgentConfig:this.userAgentConfig}},ConfigProvider.prototype.updateConfig=function(l,d,u,p){this.etag=d||this.etag,this.configIds=u||this.configIds,this.country=p||this.country,this.event(\"newConfigReceived\").raise(l,d,u),this.updateConfigInternal(l)},ConfigProvider.prototype.updateSessionCount=function(l){this.sessionCount=l,0===l&&this.pendingSettings&&(this.logSettings(\"Applying pending configuration\",this.pendingSettings),this.updateConfigInternal(this.pendingSettings),this.pendingSettings=null)},Object.defineProperty(ConfigProvider.prototype,\"config\",{get:function(){return this.settingsOut},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,\"stackConfig\",{get:function(){return this.stackSettings||{}},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,\"consoleOverrides\",{get:function(){return this.consoleOverridesInternal},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,\"defaultConfig\",{get:function(){return this.initialSettings},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,\"userAgentConfig\",{get:function(){return this.uaConfig},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,\"countryCode\",{get:function(){return this.country},enumerable:!1,configurable:!0}),ConfigProvider.prototype.setMediaConfiguration=function(l){this.mediaConfiguration=l,this.mediaSettings.setMediaConfiguration(l)},Object.defineProperty(ConfigProvider.prototype,\"mediaConfig\",{get:function(){return this.mediaSettings},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,\"ETag\",{get:function(){return this.etag},enumerable:!1,configurable:!0}),Object.defineProperty(ConfigProvider.prototype,\"ecsConfigIds\",{get:function(){return this.configIds},enumerable:!1,configurable:!0}),ConfigProvider.prototype.setConsoleOverrides=function(l){h.mergeWith(this.consoleOverridesInternal,l,arrayMergeCustomizer),this.updateConfigInternal(this.settings)},ConfigProvider.prototype.setConsoleOverride=function(l,d){this.consoleOverridesInternal[l]=d,this.updateConfigInternal(this.settings)},ConfigProvider.prototype.clearConsoleOverride=function(l){delete this.consoleOverridesInternal[l],this.updateConfigInternal(this.settings)},ConfigProvider.prototype.clearAllConsoleOverrides=function(){this.consoleOverridesInternal={},this.updateConfigInternal(this.settings)},ConfigProvider.prototype.updateConfigInternal=function(l){if(this.sessionCount>0)this.pendingSettings=l,this.logSettings(\"pendingSettings updated\",l);else{if(this.settings=h.mergeWith(f.deepClone(this.initialSettings),l,arrayMergeCustomizer),this.settingsOut=f.deepClone(this.settings),this.settings.enablePlatformCallConstraints){var d=this.platformCallConstraintsProvider.getSettings(this.settings);this.logger.safe.info(\"Merging settings with platform call constraints: \".concat(f.stringifyObject(d))),h.mergeWith(this.settingsOut,d,arrayMergeCustomizer)}h.mergeWith(this.settingsOut,this.consoleOverridesInternal,arrayMergeCustomizer),this.event(\"configUpdated\").raise(),this.logSettings(\"Settings updated\",this.settingsOut)}},ConfigProvider.prototype.logSettings=function(l,d){var u=this,p={};f.forOwn(d,(function(l,h){d[h]!==u.initialSettings[h]&&(p[h]=l)})),this.logger.safe.info(\"\".concat(l,\": \").concat(JSON.stringify(p)))},ConfigProvider}(g.default);d.default=_},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.getPlatformConfig=void 0;var h=u(19),g=u(3),f=u(9);function getPlatformConfig(){var l=(0,h.getBrowserInfo)();return\"Safari\"===l.name?new v(l):\"Firefox\"===l.name?new y:\"Chromium\"===l.engine?new S(l):new m}d.getPlatformConfig=getPlatformConfig;var m=function(){function BaseConfig(){}return BaseConfig.prototype.getInitialSettings=function(){return{activeSpeaker:{timeToPromote:3e3},dtmf:{toneDuration:200,toneGap:100},allowAccessRawMediaStream:!1,mediaStreamHoldInterval:5e3,ortcAllowedMediaContentType:g.default.ALLOWED_CONTENT_TYPES.SDP_NGC,ortcMediaContentType:g.default.CONTENT_TYPE.SDP,ortcVideoCapabilityCheckIntervalMin:2e4,ortcVideoCapabilityCheckIntervalMax:3e4,ortcVideoCapabilityMaxFS:1200,ortcVideoCapabilityMaxFPS:3e3,ortcOutgoingScreenSharingEnabled:!1,webrtcContributingSourcesPollingInterval:1e3,webrtcIceGatheringTimeoutMs:2e4,webrtcAllowedMediaContentType:g.default.ALLOWED_CONTENT_TYPES.SDP_NGC,webrtcMediaContentType:g.default.CONTENT_TYPE.SDP,webrtcScreensharingCapabilityMaxFS:8160,webrtcScreensharingCapabilityMaxFPS:1500,webrtcStatHwSilentDetectionDuration:5,webrtcStatHwSilentDetectionLevel:14,webrtcStatPollInterval:1e3,webrtcStatStoredRecordsNumber:60,webrtcStatNetworkDetectionDuration:10,webrtcStatNetworkDetectionHysteresis:.01,webrtcStatNetworkDetectionBadLevel:.07,webrtcStatNetworkDetectionGoodLevel:.03,webrtcMinAudioSamplesRecvForNetworkRecvQuality:48e4,webrtcVideoCapabilityCheckIntervalMin:2e4,webrtcVideoCapabilityCheckIntervalMinMultiparty:5e3,webrtcVideoCapabilityCheckIntervalMax:3e4,webrtcVideoCapabilityCheckIntervalMaxMultiparty:5500,webrtcScreensharingCapabilityCheckIntervalMin:0,webrtcScreensharingCapabilityCheckIntervalMax:0,webrtcVideoCapabilityMaxFS:1200,webrtcVideoCapabilityMaxFPS:3e3,webrtcMultiPartyRecvVideoMaxFS:8160,webrtcRecvVideoMaxFS:8160,webrtcCameraOpenFs:8160,webrtcMultipartyMaxScalingFs:8160,webrtcMaxScalingFs:8160,webrtcMultiPartyVideoScaling:!0,webrtcVideoScaling:!1,ovcBandwidthPerVideoReceiver:2e5,ovcSlidingWindowPercentile:.3,ovcSlidingWindowSamples:20,nonEstimatedDefaultVideoReceiversCount:4,ovcMaxCount:4,webrtcStatNetworkDetectionEnabled:!1,webrtcUseNewStatsApi:!0,useAudioAnalyzer:!1,webrtcVideoSubscriptionDisposeTimeout:2e3,webrtcCompareContentTypeInOffer:!0,iceServerTransport:\"udp,tcp,tls\",iceHostCandidateOnly:!0,iceUdpAddressType:\"ip\",iceTcpAddressType:\"ip\",renegotiationAttempts:3,reconnectTimeLimit:9e4,initialReconnectTimeLimit:0,maxReconnectDelayTime:5,waitForRelayOnReconnect:!0,relayWaitSaneTimeoutMs:25e3,reconnectOnDisconnect:!1,webrtcSpeakingWhileMutedBadDuration:3,webrtcSpeakingWhileMutedDetectionLevel:4e3,webrtcNegotiateDisabledDataModality:!1,recoverableMediaErrors:[g.default.MEDIA_ERROR.iceConnectionError,g.default.MEDIA_ERROR.noNetworkError,g.default.MEDIA_ERROR.srtpError,g.default.MEDIA_ERROR.incompatibleOffer,g.default.MEDIA_ERROR.internalError].join(\",\"),sendCallStartupTelemetry:!0,webrtcMultiPartyRecvVideoSignaling:!0,webrtcVideoDelayThreshold:10,webrtcEndOfCallFreezeThreshold:3,webrtcSubscriptionEventLimit:300,webrtcHandleRollback:!0,losingConnectivityTimeoutMs:-1,ortcAudioOutputSelectionEnabled:!1,iceCandidateFilterMDns:!0,webrtcInjectTransportCCAudio:!1,webrtcRejectedFeatures:\"\",webrtcRequiredFeatures:\"\",webrtcSimulcastSessionEnabled:!1,webrtcSimulcastStreamsCountForVideo:1,webrtcSimulcastStreamsCountForSharing:1,webrtcFmtParamListSupported:!1,webrtcNegotiatedSsrcRangeForVideo:0,webrtcNegotiatedSsrcRangeForSharing:0,webrtcNegotiatedSsrcRangeForVideoOneToOne:0,webrtcNegotiatedSsrcRangeForSharingOneToOne:0,webrtcAllowRestoreKeyframe:!1,webrtcEnabledCustomBwEstimationForVideo:!1,webrtcDisabledSenderBitrate:1e3,maxStoredPreferredResolutionCount:4,maxStoredQualityLimitationReasonEvents:30,maxStoredUFDCount:50,simulcastTelemetryLayoutsPerSession:5,simulcastTelemetryNumModalitySessions:3,simulcastTelemetryNumFMTP:10,maxSendVideoCapabilitiesReportingForVideoEnabled:!1,maxSendVideoCapabilitiesReportingForSharingEnabled:!1,maxReportedOvershootingEvents:20,permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!0,adpRequestAVLast:!0,rememberNegative:!1},devices:{blacklist:{microphone:\"stereo mix \\\\(\",camera:\"ir camera\",speaker:\"\"},overrideDefault:!1,compositeLabelMatchingThreshold:.5,piiSafeWords:[\"airpod\",\"bluetooth\",\"hands-free\",\"stereo\",\"wireless\",\"citrix hdx\",\"remote audio\",\"vmware\",\"built-in\",\"integrated\",\"internal\",\"teams\",\"high definition\",\"facetime\",\"macbook\",\"smartaudio\",\"front\",\"rear\",\"back\",\"iphone\",\"ipad\",\"display\",\"displayport\",\"dp\",\"hdmi\",\"amd\",\"nvidia\",\"intel\",\"analog\",\"digital\",\"dock\",\"line( in| out)?\",\"s/pdif\",\"external\",\"thunderbolt\\\\d*\",\"usb\",\"panoramic\",\"desktop\",\"capture\",\"cable\",\"cam\",\"virtual\",\"manycam\",\"snap camera\",\"obs\",\"vb-audio\",\"vaio\",\"default\",\"test\"],pollingIntervalActive:3e3,enumerateDevicesTimeout:25e3,enumerateDevicesAfterADP:!1},useGoogPrefixAudioConstraints:!0,multiviewResolutionLimits:{1:720,2:720,3:480,4:360,more:360},maxVideoFreezeTimestampsInBucket:5,webrtcSendBandwidthNotificationsEnabled:!1,webrtcSendBandwidthIgnoredUpdateLimit:6,webrtcSendBandwidthThreshold:.1,webrtcUnifiedPlanEnabled:!1,checkSupportForWebrtc_1_0:!1,webrtcLastAppliedVideoCapabilitiesCount:5,webrtcLastAppliedVideoCapabilitiesSequenceCount:5,gumRequestTimeout:2e4,videoCaptureFreezeTimeout:5e3,webrtcCloseAfterIceFailure:!0,audioBandwidthInKbps:90,videoBandwidthAllocation:.3,enableQosSupport:!1,forceUnbundledTransport:!1,allowedAudioCodecs:[],allowedVideoCodecs:[],filterCodecsInSdp:!1,subscribeToSsrcForVideo:!1,audioRendererUsePauseOnDetach:!1,audioRendererRestartOnPause:!1,preferSdesSrtp:!1,preferSdesSrtpPstn:!1,useLocalStorageForOneDs:!1,useOneDsLogger:!1,useSendBeaconSync:!1,addTelemetryReportingCallback:!1,eventsLimitInMem:200,enableCompoundKey:!1,telemetryTenants:{signaling:\"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413\",media:\"1cae5691997646c98b01d15beddae7a3-ce16e198-bc32-420f-ac64-42bb916111af-6865\",tlePlayer:\"2efdf03d07594586a5977c404e185186-71b046c4-f48f-4ba7-96d3-2a74b54e1d46-7326\"},collectorUrl:\"https://ic3.events.data.microsoft.com/OneCollector/1.0/\",transmitProfileName:\"REAL_TIME\",transmitProfileTimings:[],waitReportStatsAtCallStop:!1,oneStreamPerDeviceType:!1,enableWebRtcInternalsLogs:!1,enableMultiViewStats:!0,webrtcBWJumpLowerLimit:1e5,webrtcBWJumpUpperLimit:3e5,webrtcBWStabilizationSlidingWindowSize:10,webrtcBWStabilizationMaxDeviation:.1,webrtcBWStabilizationMinBandwidth:1e5,maxKeyFrameTimestampsInBucket:5,enableAudioSharing:!1,enableDevtoolsAPI:!1,enableDataChannel:!1,enableDataChannelPstn:!1,alwaysNegotiateDataChannel:!1,enableGiveControl:!1,maxStoredDataChannelValues:15,localPreviewMirroringSupported:!1,enableVideoEffects:!1,forceKeyFrameV2ScaleFactor:1.1,effectsTelemetryBufferSize:20,wasmdns:{pTime:10,goodPerfThreshold:8,poorPerfThreshold:10,badPerfThreshold:12,perfWindowLength:10,enableNoiseSuppression:!1,noiseSuppressionMode:\"Off\",backgroundMode:!1},webcv:{qualityConfig:{outputFps:{min:15,max:30},outputResolution:720,preserveResolution:!0,degradationLadder:[{resolution:{width:1920,height:1080},fps:{min:15,max:30}},{resolution:{width:1280,height:720},fps:{min:15,max:30}},{resolution:{width:960,height:540},fps:{min:15,max:30}},{resolution:{width:852,height:480},fps:{min:15,max:30}},{resolution:{width:640,height:360},fps:{min:15,max:30}},{resolution:{width:480,height:270},fps:{min:10,max:15}},{resolution:{width:426,height:240},fps:{min:10,max:15}},{resolution:{width:320,height:180},fps:{min:10,max:15}}],initialLadderResolution:360,improvementFpsThresholdPercent:20,statsIntervalSec:5,enableMaskPropagation:!1,maskPropagationFramesInterval:30},powerPreference:\"default\",useInsertableStreams:!1,webGLUnsupportedRenderers:[\"Google SwiftShader\"],webGLRequiredExtensions:[\"EXT_color_buffer_float\",\"WEBGL_debug_renderer_info\",\"OES_texture_float_linear\"],usePreheat:!0,useSharedArrayBuffer:!0,useWasmEffects:!1,processorType:\"Webgl2\"},insertFakeCandidateIfNeeded:!0,useSdpCapabilities:!0,enableH264SpsPpsIdrKeyframe:!0,enableReconnectChrome:!0,enableReconnectEdge:!0,disableMsSdp:!1,disableSdes:!1,disableIceReinvite:!1,iceDisconnectedTimeoutMs:3e4,enableLocalVideoConstraints:!0,webrtcAudioChannelSignalingFeedback:\"app recv:dsh\",webrtcVideoChannelSignalingFeedback:\"app send:src recv:src,vc\",ortcVideoRendererAggressiveStreamRefresh:!0,ortcPreferBundling:!1,webrtcResolutionManagerCooldownTimeout:15e3,webrtcResolutionManagerRetryDelay:5e3,webrtcNativeCpuOveruseDisabled:!1,webrtcDisplayStreamContentHint:\"text\",h264SendProfileOverride:\"42C02A\",addFmtpToInitialSubscription:!0,h264SubscribeProfile:\"64001f\",notRenderingTimeInterval:{video:3,sharing:10},notRenderingLowBitrateThreshold:6,isBytesRecvUsedInIsRenderingCalculation:!0,useInsertableStreams:!1,useConnectionState:!0,useDtlsTrasportConnectionCheck:!1,enableNetworkRecvQualityUFD:!0,enableNetworkSendQualityUFD:!0,webrtcJitterLowThreshold:.2,webrtcJitterHighThreshold:.35,webrtcJitterSticknessTime:5e3,webrtcLossRateLowThreshold:.03,webrtcLossRateHighThreshold:.1,webrtcLossRateSticknessTime:5e3,webrtcMinPacketsSentForNetworkSendQuality:200,webrtcLossRateWindowSize:3,webrtcJitterWindowSize:3,isStreamingMatchIsRendering:!0,freezeMinDuration:128,freezeIntervalFrequency:1e3,minPacketsReceivedToCalculatePacketLossRate:100,healedRatioPrecision:8,requestNewStreamOnUnmute:!1,raiseVideoMuteUfd:!1,useMediaQualityController:!1,useMediaQualityControllerForceKeyFrame:!1,layoutControlTimeout:1e4,extmapAllowMixed:!1,enableVla:!1,allowRemoteVla:!1,enableNonAdvVla:!1,specCompliantSimulcast:{video:{enableLocally:!1,allowEnableRemotely:!1,layerScaleFactors:[1]},sharing:{enableLocally:!1,allowEnableRemotely:!1,layerScaleFactors:[1]}},enforceOpusFmtpMultiparty:{usedtx:1},videoIsRenderingCheck:!1,fixSdpForPartialIceRestart:!1,mapSsrcToTrackForStats:!1,enableVideoOrientationExtension:!1,speakerGainLevel:0,ignoreClosedDtlsTransportState:!1,disconnectOnPageHide:!1,renderThroughCanvas:!1,isRenderingBasedOnRawStatistics:!1,enableDevicePixelRatio:!0,useSetParametersToApplyCapabilities:!1,enablePlatformCallConstraints:!1,setParametersMaxBitrateUndefined:!1,onAddTrackRemoveOtherTracks:!1,avoidFakeStreamsDuringEscalation:!0,navConnectionPollingInterval:1e3,navConnectionNumSamplesToCollect:60,allowProvisionalAnswer:!1,allowProvisionalAnswerPstn:!1,disableIncomingDtlsRoleOverride:!1,disableOutgoingDtlsRoleOverride:!1,statsAllowAnyVideoSendTrack:!1,showStatsInCall:!1,useSetStreamsForSender:!1,addPrefixForMsidInSdp:!0,enableMuteSpeakerUnmuteSpeakerWorkaround:!1,alwaysRaiseBadDeviceEvents:!1,removeRecvStreamOnEnded:!1,requiredVideoCodecs:[\"h264\"],enableActiveSpeakerBasedDSH:!1,emptyInitialDSH:!0,diagnostics:{sideBySide:!1,useForTelemetry:!1,collectionLimits:{numDeviceEvents:300,numVideoEffectsEvents:100,numAudioEffectsEvents:100,numOvershootEvents:100,numStatsReports:600,numStatsErrors:100,numSubscriptionEvents:200,numMultiViewStats:50,numUFDs:200,numNativeSessions:10,numSessions:10,numCapabilitiesRequested:60,numCapabilitiesApplied:60},telemetryLimits:{numDeviceEvents:50,numVideoEffectsEvents:50,numAudioEffectsEvents:50,numOvershootEvents:20,numPreferredResolutions:3,numSubscriptionEvents:100,numMultiViewStats:6,numUFDs:50,numAggregatedSamples:60,numStatsErrors:20,numCapabilitiesRequested:5,numCapabilitiesApplied:3}},enableReinviteless:!1,requireUserActionForAudioSharing:!1}},BaseConfig.prototype.getEnforcedSettings=function(){return{}},BaseConfig}(),v=function(l){function SafariConfig(d){var u=l.call(this)||this;return u.browserInfo=d,u}return p(SafariConfig,l),SafariConfig.prototype.getEnforcedSettings=function(){var l={webrtcSimulcastSessionEnabled:!0,webrtcFmtParamListSupported:!0,webrtcAllowRestoreKeyframe:!0,webrtcUnifiedPlanEnabled:!0,permissions:{usePositiveInAdp:!1,useNegativeInAdp:!1,adpFallback:!0,adpFallbackAudio:!0,adpFallbackVideo:!1,adpRequestAVLast:!1,rememberNegative:!0},devices:{pollingIntervalIdle:1e4},audioRendererUsePauseOnDetach:!0,audioRendererRestartOnPause:!0,subscribeToSsrcForVideo:!0,webrtcEnabledCustomBwEstimationForVideo:!1,insertFakeCandidateIfNeeded:!0,useAudioAnalyzer:!0};return f.isVersionGreaterOrEqual(this.browserInfo.version,\"15.0\")||(l.statsAllowAnyVideoSendTrack=!0),l},SafariConfig}(m),y=function(l){function MozConfig(){return null!==l&&l.apply(this,arguments)||this}return p(MozConfig,l),MozConfig.prototype.getEnforcedSettings=function(){return{webrtcSimulcastSessionEnabled:!0,webrtcFmtParamListSupported:!0,webrtcAllowRestoreKeyframe:!0,webrtcUnifiedPlanEnabled:!0,webrtcEnabledCustomBwEstimationForVideo:!1,oneStreamPerDeviceType:!0,useDtlsTrasportConnectionCheck:!0,videoIsRenderingCheck:!1,fixSdpForPartialIceRestart:!0,mapSsrcToTrackForStats:!0,ignoreClosedDtlsTransportState1on1:!0,useAudioAnalyzer:!0,subscribeToSsrcForVideo1on1:!0,devices:{enumerateDevicesTimeout:0,pollingIntervalIdle:1e4,idlePollingOnStart:!0},webrtcInjectTransportCCAudio:!1,videoCaptureFreezeTimeout:0,filterCodecsInSdp:!0,useSetParametersToApplyCapabilities:!0,removeRecvStreamOnEnded:!0}},MozConfig}(m),S=function(l){function ChromiumConfig(d){var u=l.call(this)||this;return u.browserInfo=d,u}return p(ChromiumConfig,l),ChromiumConfig.prototype.getEnforcedSettings=function(){var l={};return\"Electron\"===this.browserInfo.name?(l.useConnectionState=!1,l.requireUserActionForAudioSharing=!0,l):(f.isVersionGreaterOrEqual(this.browserInfo.version,\"74.0\")&&(l.webrtcSimulcastSessionEnabled=!0,l.webrtcFmtParamListSupported=!0,l.webrtcAllowRestoreKeyframe=!0,l.enableAudioSharing=!0),f.isVersionGreaterOrEqual(this.browserInfo.version,\"93.0\")&&(l.webrtcUnifiedPlanEnabled=!0),\"CiscoOS\"===this.browserInfo.name&&(l.waitReportStatsAtCallStop=!0),\"Mobile\"===this.browserInfo.formFactor&&(l.oneStreamPerDeviceType=!0,l.devices={pollingIntervalIdle:1e4}),\"SamsungTV\"===this.browserInfo.name&&(l.useSetParametersToApplyCapabilities=!0),l)},ChromiumConfig}(m)},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},g=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},f=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0});var m=u(19),v=u(17),y=u(7),S=u(325),_=u(26),C=u(326),E=u(1),T=u(3),b=u(9),I=u(343),A=u(132),R=u(347),P=u(447),O=u(449),M=u(450),w=u(64),N=u(13),D=function(l){function DeviceManager(d,u,p,g,f,m,v,y){var S=l.call(this)||this;return S.logger=d,S.configProvider=u,S.diagnostics=p,S.domOverrides=g,S.ufdManager=f,S.deviceEnumerator=new I.DeviceEnumerator(S.configProvider,S.logger.createChild(\"DeviceEnumerator\")),S.permissionManager=new M.PermissionManager(S.configProvider,{getMediaStream:function(l){return S.getMediaStream(h(h({},l),{withEffect:!1,withTimeout:!0,force:!1}),\"permissionManager\")},hasCamera:function(){return S.hasDeviceType(\"camera\")},raiseTelemetryEvent:function(l,d){return S.raiseTelemetryEvent(l,d)},getActiveConstraints:function(){return S.mediaStreamManager.getActiveConstraints()},handlePermissionStateChange:function(){return S.handlePermissionStateChange()}},S.logger.createChild(\"PermissionManager\")),S.activeRenderers=[],S.selectedDevices={camera:null,microphone:null,speaker:null},S.pendingDevices=null,S.streamManagerSubscriptions=[],S.streamSubscriptions=new Map,S.rendererSubscriptions=new Map,S.clientAudioRenderers=new Map,S.permissionManager.on(\"onDevicesPermissionChanged\",(function(){return S.event(\"onDevicesPermissionChanged\").raise()})),S.deviceList.on(\"onDevicesChanged\",(function(l,d){return S.onDevicesChanged(l,d)})),S.deviceSelection.on(\"onSelectedDevicesChanged\",(function(l,d){return S.onSelectedDevicesChanged(l,d)})),S.deviceEnumerator.initialize(),S.audioManager=new O.AudioEffectManager(v,y,S.configProvider,S.logger.createChild(\"AudioEffectManager\")),S.audioManager.on(\"onAudioEffectTelemetryEvent\",(function(l){var d;null===(d=S.diagnostics)||void 0===d||d.registerAudioEffectsEvent(E.deepClone(l)),S.event(\"onAudioEffectsTelemetryEvent\").raise(l)})),S.effectManager=new P.VideoEffectManager(m,S.configProvider,S.logger.createChild(\"EffectMgr\")),S.effectManager.on(\"onMediaStreamUpdateRequested\",(function(l){return S.onMediaStreamUpdateRequested(l)})),S.effectManager.on(\"onVideoEffectQualityChanged\",(function(l){return S.onVideoEffectsQualityEventHandler(l)})),S.effectManager.on(\"onVideoEffectTelementyEvent\",(function(l){var d;null===(d=S.diagnostics)||void 0===d||d.registerVideoEffectsEvent(E.deepClone(l)),S.event(\"onVideoEffectsTelemetryEvent\").raise(l)})),S.effectManager.on(\"onVideoEffectApplied\",(function(){S.raiseTelemetryEvent(\"video_effect_applied\",{}),S.event(\"onVideoEffectApplied\").raise()})),S.mediaStreamManager=new C.MediaStreamManager(S.logger.createChild(\"MediaStreamManager\"),S,S.configProvider,S.effectManager,S.audioManager),S.subscribeOnStreamManagerEvents(),S.subscribeOnDeviceEnumeratorEvents(),S}return p(DeviceManager,l),Object.defineProperty(DeviceManager.prototype,\"devices\",{get:function(){return this.deviceList.devices},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,\"deviceList\",{get:function(){return this.deviceEnumerator.list},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,\"deviceSelection\",{get:function(){return this.deviceEnumerator.selection},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,\"isInitialized\",{get:function(){return this.deviceEnumerator.isInitialized},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,\"isAudioOutputSelectionSupported\",{get:function(){return this.configProvider.userAgentConfig.isAudioOutputSelectionSupported},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,\"videoEffectManager\",{get:function(){return this.effectManager},enumerable:!1,configurable:!0}),Object.defineProperty(DeviceManager.prototype,\"audioEffectManager\",{get:function(){return this.audioManager},enumerable:!1,configurable:!0}),DeviceManager.prototype.createPreviewRenderer=function(l){var d=new S.LocalVideoRenderer(l,this,this.logger.createChild(\"videorenderer\"),this.configProvider);return this.domOverrides.onMediaElementAdded&&this.domOverrides.onMediaElementAdded(d.getVideoElement()),this.subscribeOnRendererEvents(d),d},DeviceManager.prototype.askDevicePermission=function(l){return g(this,void 0,void 0,(function(){var d,u;return f(this,(function(p){switch(p.label){case 0:return[4,this.isInitialized.promise];case 1:return p.sent(),[4,this.permissionManager.askDevicePermission(l)];case 2:if(d=p.sent(),!this.configProvider.config.devices.enumerateDevicesAfterADP)return[3,6];p.label=3;case 3:return p.trys.push([3,5,,6]),[4,this.deviceEnumerator.enumerateDevices()];case 4:return p.sent(),[3,6];case 5:return u=p.sent(),this.logger.safe.warn(\"Post-ADP device enumeration failed: \".concat(E.stringifyObject(u))),[3,6];case 6:return[2,d]}}))}))},DeviceManager.prototype.getPermissionState=function(l){return this.permissionManager.getPermissionState(l)},DeviceManager.prototype.handlePermissionStateChange=function(){this.diagnostics&&(this.diagnostics.permissionStates=this.permissionManager.knownPermissionStates),this.event(\"onPermissionStateChanged\").raise()},DeviceManager.prototype.onMediaStreamUpdateRequested=function(l){this.updateRenderersAsync(),this.event(\"onStreamUpdateRequested\").raise(l)},DeviceManager.prototype.createAudioRenderer=function(){var l=this,d=new w.default(this.logger.createChild(\"CustomAudioRenderer\"),this.configProvider),u=E.uniqueId();this.clientAudioRenderers.set(u,d);var p=d.play.bind(d),h=d.stop.bind(d);return this.raiseTelemetryEvent(\"custom_audio_renderer_created\",this.getSelectedDevices()),{play:p,stop:h,dispose:function(){var d;null===(d=l.clientAudioRenderers.get(u))||void 0===d||d.dispose(),l.clientAudioRenderers.delete(u)},setMuted:function(l,u){return void 0===u&&(u=(0,N.generateCauseId)()),d.setMuted(l,u)},isMuted:function(){return d.muted}}},DeviceManager.prototype.createDevicesHandle=function(l,d){return new R.DevicesHandle(this.logger.createChild(\"DevicesHandle\"),this.getMediaStream(h(h({},l),{withTimeout:!1,withEffect:!1,audioProcessingFlags:this.audioProcessingFlags,force:!1}),d))},DeviceManager.prototype.getAllowedModalities=function(){var l=E.shallowClone(this.permissionManager.browserPermittedModalities);return this.hasDeviceType(\"microphone\")||(l.audio=[T.default.MEDIA_STATE.inactive,T.default.MEDIA_STATE.receive]),this.hasDeviceType(\"camera\")||(l.video=[T.default.MEDIA_STATE.inactive,T.default.MEDIA_STATE.receive]),l},DeviceManager.prototype.getRawInputVideoStreamTrack=function(){var l;return g(this,void 0,void 0,(function(){return f(this,(function(d){switch(d.label){case 0:if(!this.configProvider.config.allowAccessRawMediaStream)return this.logger.safe.debug(\"allowAccessRawMediaStream is not enabled\"),[2,null];if(!this.hasDeviceType(\"camera\"))throw new Error(\"No input device found\");return null===(l=this.activeRawInputVideoMediaStreamClient)||void 0===l||l.dispose(),this.activeRawInputVideoMediaStreamClient=this.getVideoStream(!1,\"rawStream\"),[4,this.activeRawInputVideoMediaStreamClient.start()];case 1:return d.sent(),this.raiseTelemetryEvent(\"raw_input_video_stream_access\",this.getSelectedDevices()),[2,this.activeRawInputVideoMediaStreamClient.rawTrack]}}))}))},DeviceManager.prototype.getRawInputAudioStreamTrack=function(){var l;return g(this,void 0,void 0,(function(){return f(this,(function(d){switch(d.label){case 0:if(!this.configProvider.config.allowAccessRawMediaStream)return this.logger.safe.debug(\"allowAccessRawMediaStream is not enabled\"),[2,null];if(!this.hasDeviceType(\"microphone\"))throw new Error(\"No input device found\");return null===(l=this.activeRawInputAudioMediaStreamClient)||void 0===l||l.dispose(),this.activeRawInputAudioMediaStreamClient=this.getAudioStream(!1,\"rawStream\"),[4,this.activeRawInputAudioMediaStreamClient.start()];case 1:return d.sent(),this.raiseTelemetryEvent(\"raw_input_audio_stream_access\",this.getSelectedDevices()),[2,this.activeRawInputAudioMediaStreamClient.rawTrack]}}))}))},DeviceManager.prototype.disposeRawInputAudioStreamTrack=function(){this.configProvider.config.allowAccessRawMediaStream?this.activeRawInputAudioMediaStreamClient&&(this.activeRawInputAudioMediaStreamClient.dispose(),this.activeRawInputAudioMediaStreamClient=null,this.raiseTelemetryEvent(\"raw_input_audio_stream_dispose\",this.getSelectedDevices())):this.logger.safe.debug(\"allowAccessRawMediaStream is not enabled\")},DeviceManager.prototype.disposeRawInputVideoStreamTrack=function(){this.configProvider.config.allowAccessRawMediaStream?this.activeRawInputVideoMediaStreamClient&&(this.activeRawInputVideoMediaStreamClient.dispose(),this.activeRawInputVideoMediaStreamClient=null,this.raiseTelemetryEvent(\"raw_input_video_stream_dispose\",this.getSelectedDevices())):this.logger.safe.debug(\"allowAccessRawMediaStream is not enabled\")},DeviceManager.prototype.getAudioStream=function(l,d){return this.getMediaStream({audio:!0,withTimeout:this.permissionManager.isPermissionKnown(\"microphone\"),withEffect:!1,audioProcessingFlags:void 0!==this.audioProcessingFlags?this.audioProcessingFlags:this.configProvider.config.defaultAudioProcessingFlags,force:l},d)},DeviceManager.prototype.getVideoStream=function(l,d){return this.getMediaStream({video:!0,withTimeout:this.permissionManager.isPermissionKnown(\"camera\"),withEffect:this.configProvider.config.enableVideoEffects&&this.videoEffectManager.isEffectEnabled,force:l},d)},DeviceManager.prototype.getDisplayStream=function(l,d){var u=l&&this.configProvider.config.enableAudioSharing;return this.getMediaStream({audio:u,sharing:!0,withTimeout:!1,withEffect:!1,audioProcessingFlags:u?0:void 0,force:!1},d)},DeviceManager.prototype.enumerateDevicesAsync=function(){var l=this;return this.isInitialized.promise.then((function(){return l.getDeviceDescriptions(l.devices)}))},DeviceManager.prototype.getDeviceNameAsync=function(l){var d=this;return this.isInitialized.promise.then((function(){var u=d.devices.find((function(d){return d.guid===l})),p=\"\";return u&&u.label?u.label:p}))},DeviceManager.prototype.getSpeakerDeviceDomIdAsync=function(l){var d=this;return this.isInitialized.promise.then((function(){var u=d.devices.find((function(d){return d.guid===l}));return u&&u.deviceId?u.deviceId:\"\"}))},DeviceManager.prototype.selectDevices=function(l){var d=this;return this.pendingDevices?(this.logger.safe.info(\"Overriding device selection until enumeration is complete with \".concat(JSON.stringify((0,b.scrubSelectedDevices)(this.pendingDevices)))),void(this.pendingDevices=l)):this.isInitialized.isPending?(this.logger.safe.info(\"Postponing device selection until enumeration is complete\"),this.pendingDevices=l,void this.isInitialized.promise.then((function(){d.logger.safe.info(\"Performing postponed device selection\");var l=d.pendingDevices;d.pendingDevices=null,d.selectDevices(l)}))):void this.deviceSelection.selectDevices(l)},DeviceManager.prototype.getSelectedDevices=function(){return this.toSelectedDevices(this.deviceSelection.selectedDevices)},DeviceManager.prototype.setAudioProcessingFlags=function(l){l!==this.audioProcessingFlags&&(this.logger.debug(\"Setting audio processing flags: \".concat(this.audioProcessingFlags,\" -> \").concat(l)),this.audioProcessingFlags=l,this.event(\"onStreamUpdateRequested\").raise(\"Audio\"))},DeviceManager.prototype.getOutputDeviceId=function(){return this.selectedDevices.speaker&&this.selectedDevices.speaker.deviceId},DeviceManager.prototype.getDeviceDescriptions=function(l){return(l||this.devices).map((function(l){return l.toDeviceDesc()}))},DeviceManager.prototype.getDevicesCount=function(){return this.devices.reduce((function(l,d){return l[d.type]++,l}),{camera:0,speaker:0,microphone:0,compositeAudio:0})},DeviceManager.prototype.getKnownPermissionStates=function(){return g(this,void 0,void 0,(function(){return f(this,(function(l){switch(l.label){case 0:return[4,this.permissionManager.initialize()];case 1:return l.sent(),[2,this.permissionManager.knownPermissionStates]}}))}))},DeviceManager.prototype.getLocalVideoRenderers=function(){return this.activeRenderers},DeviceManager.prototype.dispose=function(){this.unsubscribeFromStreamManagerEvents(),this.deviceEnumerator.dispose(),this.mediaStreamManager.dispose(),this.disposeRawInputAudioStreamTrack(),this.disposeRawInputVideoStreamTrack(),this.disposeClientAudioRenderer(),l.prototype.dispose.call(this)},DeviceManager.prototype.disposeClientAudioRenderer=function(){this.clientAudioRenderers.size&&(this.clientAudioRenderers.forEach((function(l){l.dispose()})),this.clientAudioRenderers.clear(),this.raiseTelemetryEvent(\"custom_audio_renderer_disposed\",this.getSelectedDevices()))},DeviceManager.prototype.toSelectedDevices=function(l){var d={};return Object.keys(l).forEach((function(u){l[u]&&(d[u]=l[u].guid)})),d},DeviceManager.prototype.getStreamConstraints=function(l){return(null==l?void 0:l.deviceId)?{deviceId:l.deviceId}:{deviceId:void 0}},DeviceManager.prototype.hasDeviceType=function(l){return E.values(this.devices).some((function(d){return d.type===l}))},DeviceManager.prototype.getConstraints=function(l){var d=this;if(!l.audio&&!l.video&&!l.sharing)throw new Error(\"requesting nothing\");if(this.logger.safe.info(\"retrieving media stream: \".concat(JSON.stringify(l))),l.sharing)return{audio:l.audio?{deviceId:T.default.SYSTEM_AUDIO_SOURCE_ID}:void 0,sharing:{deviceId:T.default.DISPLAY_SOURCE_ID},withTimeout:l.withTimeout,withEffect:!1,audioProcessingFlags:l.audioProcessingFlags,force:!1};var u=this.selectedDevices.microphone,p=this.selectedDevices.camera,h=l.audio&&u,g=l.video&&p;if(!h&&!g)throw{type:T.default.MEDIA_ERROR.noDeviceSelected,detail:\"audio requested \".concat(l.audio,\", video requested: \").concat(l.video,\" Devices: \").concat(JSON.stringify(this.devices.map((function(l){return JSON.stringify((0,b.scrubDevices)(l,d.configProvider.config.devices.piiSafeWords))}))))};var f=this.getStreamConstraints(u),m=this.getStreamConstraints(p),v=l.audioProcessingFlags;return void 0!==v&&l.audio&&!l.video&&u&&u.capabilities&&(u.capabilities.echoCancellation&&!u.capabilities.echoCancellation.includes(!!(2&v))&&(v^=2),u.capabilities.autoGainControl&&!u.capabilities.autoGainControl.includes(!!(1&v))&&(v^=1),u.capabilities.noiseSuppression&&!u.capabilities.noiseSuppression.includes(!!(4&v))&&(v^=4)),v!==l.audioProcessingFlags&&this.logger.safe.warn(\"Unable to fulfill processing flags \".concat(l.audioProcessingFlags,\", using \").concat(v,\" instead\")),{audio:l.audio?f:void 0,video:l.video?m:void 0,withTimeout:l.withTimeout,withEffect:l.withEffect,audioProcessingFlags:v,force:l.force}},DeviceManager.prototype.getMediaStream=function(l,d){var u=this,p=this.getConstraints(l),h=this.mediaStreamManager.getMediaStream(p,d);return this.subscribeOnStreamEvents(h),h.start().then((function(){var d=h.hasAudio(),p=h.hasVideo();d&&u.signalDeviceGood(\"Audio\",h.rawTrack.muted),p&&u.signalDeviceGood(\"Video\",h.rawTrack.muted),u.permissionManager.update(l,l)})).catch((function(d){return u.handleUserMediaError(l,d)})),h},DeviceManager.prototype.signalDeviceGood=function(l,d){this.ufdManager.signalDeviceEvent(0,\"Good\",l),this.ufdManager.signalDeviceEvent(1,\"Good\",l),this.ufdManager.signalDeviceEvent(3,\"Good\",l),d||\"Audio\"!==l&&!this.configProvider.config.raiseVideoMuteUfd||this.ufdManager.signalDeviceEvent(2,\"Good\",l)},DeviceManager.prototype.handlePermissionDeniedError=function(l,d){l.sharing&&\"Safari\"===(0,m.getBrowserInfo)().name?this.ufdManager.signalDeviceEvent(3,\"Bad\",d):l.sharing||(l.audio&&!l.video?this.permissionManager.update({audio:!0},{audio:!1}):l.video&&!l.audio&&this.permissionManager.update({video:!0},{video:!1}))},DeviceManager.prototype.handleUserMediaError=function(l,d){var u=this.getMediaType(l);switch(d.type){case T.default.MEDIA_ERROR.permissionDeniedError:this.handlePermissionDeniedError(l,u);break;case T.default.MEDIA_ERROR.permissionDeniedBySystemError:this.ufdManager.signalDeviceEvent(3,\"Bad\",u);break;case T.default.MEDIA_ERROR.sourceUnavailableError:this.ufdManager.signalDeviceEvent(0,\"Bad\",u);break;case T.default.MEDIA_ERROR.mediaStreamRequestTimedOut:this.ufdManager.signalDeviceEvent(1,\"Bad\",u);break;default:this.logger.safe.error(\"getMediaStream() error: \".concat(E.stringifyObject(d)))}},DeviceManager.prototype.getMediaType=function(l){if(l.sharing)return\"ScreenShare\";if(l.video)return\"Video\";if(l.audio)return\"Audio\";throw new Error(\"mediaType is not defined for this constraint \".concat(JSON.stringify(l)))},DeviceManager.prototype.subscribeOnStreamEvents=function(l){var d=this,u=[];u.push(l.on(\"onStreamClientStarted\",(function(l,u){return d.onStreamStarted(l,u)}))),u.push(l.on(\"onStreamClientDisposing\",(function(l){return d.onStreamDisposing(l)}))),u.push(l.on(\"onStreamClientEnded\",(function(l,u){return d.onStreamEnded(l,u)}))),u.push(l.on(\"onStreamClientMuted\",(function(l,u){return d.onStreamMuted(l,u)}))),u.push(l.on(\"onStreamClientError\",(function(l,u){return d.onStreamError(l,u)}))),this.streamSubscriptions.set(l,u)},DeviceManager.prototype.unsubscribeFromStreamEvents=function(l){this.streamSubscriptions.has(l)&&(this.streamSubscriptions.get(l).forEach((function(l){return l.dispose()})),this.streamSubscriptions.delete(l))},DeviceManager.prototype.subscribeOnRendererEvents=function(l){var d=this,u=[];u.push(l.on(\"onRendererDisposed\",(function(l){return d.onRendererDisposed(l)}))),u.push(l.on(\"onRendererStarted\",(function(l){return d.onRendererStarted(l)}))),this.rendererSubscriptions.set(l,u)},DeviceManager.prototype.unsubscribeFromRendererEvents=function(l){this.rendererSubscriptions.has(l)&&(this.rendererSubscriptions.get(l).forEach((function(l){return l.dispose()})),this.rendererSubscriptions.delete(l))},DeviceManager.prototype.subscribeOnStreamManagerEvents=function(){var l=this;this.streamManagerSubscriptions=[],this.streamManagerSubscriptions.push(this.mediaStreamManager.on(\"onAllStreamsRemoved\",(function(){return l.onAllStreamsRemoved()}))),this.streamManagerSubscriptions.push(this.mediaStreamManager.on(\"onStreamAcquired\",(function(d,u,p,h){return l.onStreamAcquired(d,u,p,h)})))},DeviceManager.prototype.subscribeOnDeviceEnumeratorEvents=function(){var l=this;this.deviceEnumerator.on(\"onDeviceEnumerationfailed\",(function(d){return l.raiseTelemetryEvent(\"enumeration_failed\",{error:d})}))},DeviceManager.prototype.unsubscribeFromStreamManagerEvents=function(){this.streamManagerSubscriptions.forEach((function(l){return l.dispose()}))},DeviceManager.prototype.updateRenderersAsync=function(){return g(this,void 0,void 0,(function(){var l;return f(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,Promise.all(this.activeRenderers.map((function(l){return l.updateStreamAsync()})))];case 1:return d.sent(),this.logger.safe.info(\"Renderers updates finished\"),[3,3];case 2:return l=d.sent(),this.logger.safe.error(\"Error updating renderers: \".concat(E.stringifyObject(l))),[3,3];case 3:return[2]}}))}))},DeviceManager.prototype.updateCameraSelectionStrategy=function(l){var d=(0,A.getDeviceSelectionStrategy)(l);this.deviceSelection.setCameraSelectionStrategy(d)},DeviceManager.prototype.onSelectedDevicesChanged=function(l,d){var u,p=this,h=this.selectedDevices;if(this.selectedDevices=l,null===(u=this.diagnostics)||void 0===u||u.setSelectedDevices(l,d),!(\"camera\"in h^\"camera\"in this.selectedDevices||\"microphone\"in h^\"microphone\"in this.selectedDevices)){var g=this.toSelectedDevices(this.selectedDevices),f=this.toSelectedDevices(h);this.event(\"onSelectedDevicesChanged\").raise(g,f),g.microphone!==f.microphone&&this.activeRawInputAudioMediaStreamClient&&this.event(\"onRawStreamChanged\").raise(0),g.camera!==f.camera&&this.activeRawInputVideoMediaStreamClient&&this.event(\"onRawStreamChanged\").raise(1),this.clientAudioRenderers.forEach((function(l){l.setOutputDevice(p.getOutputDeviceId())}))}var m=this.configProvider.config.devices.piiSafeWords;this.raiseTelemetryEvent(\"selected_devices_changed\",{microphone:this.selectedDevices.microphone&&E.scrubDeviceLabelPii(this.selectedDevices.microphone.label,m),camera:this.selectedDevices.camera&&E.scrubDeviceLabelPii(this.selectedDevices.camera.label,m),speaker:this.selectedDevices.speaker&&E.scrubDeviceLabelPii(this.selectedDevices.speaker.label,m),fromInterface:d}),this.updateRenderersAsync()},DeviceManager.prototype.onDevicesChanged=function(l,d){var u,p=this;this.event(\"onDevicesChanged\").raise(l),null===(u=this.diagnostics)||void 0===u||u.setDeviceList(l,d,this.deviceEnumerator.list.debugInfo);var h=this.getDevicesCount();this.ufdManager.signalEvent(\"ZeroCaptureDevicesEnumerated\",h.microphone>0?\"Good\":\"Bad\"),this.isAudioOutputSelectionSupported&&this.ufdManager.signalEvent(\"ZeroRenderDevicesEnumerated\",h.speaker>0?\"Good\":\"Bad\");var g=new Map,f=1;this.raiseTelemetryEvent(\"devices_changed\",{devices:l.map((function(l){var d=g.get(l.groupId)||f++;return g.set(l.groupId,d),{label:E.scrubDeviceLabelPii(l.label,p.configProvider.config.devices.piiSafeWords),isSystemDefault:l.isSystemDefault,kind:l.kind,type:l.type,capabilities:l.capabilities,groupId:\"\".concat(d)}})),debug:this.deviceList.debugInfo})},DeviceManager.prototype.getDeviceListDebugInfo=function(){return this.deviceList.debugInfo},Object.defineProperty(DeviceManager.prototype,\"isPollingInProgress\",{get:function(){return this.deviceEnumerator.isPollingInProgress},enumerable:!1,configurable:!0}),DeviceManager.prototype.raiseTelemetryEvent=function(l,d){var u;this.logger.safe.info(\"Device event: \".concat(l,\": \").concat(JSON.stringify(this.scrubPayload(l,d))));var p={eventType:l,timestamp:Date.now(),payload:d};null===(u=this.diagnostics)||void 0===u||u.registerDeviceTelemetryEvent(E.deepClone(p)),this.event(\"onDeviceTelemetryEvent\").raise(p)},DeviceManager.prototype.scrubPayload=function(l,d){var u=this;if(\"devices_changed\"===l){var p=d;return{devices:E.values(p.devices).map((function(l){return(0,b.scrubDevices)(l,u.configProvider.config.devices.piiSafeWords)})),debug:d.debug}}return d},DeviceManager.prototype.onStreamStarted=function(l,d){return g(this,void 0,void 0,(function(){var u;return f(this,(function(p){switch(p.label){case 0:if(!this.permissionManager.browserPermittedModalities.audio.some((function(l){return l===T.default.MEDIA_STATE.send}))&&!this.permissionManager.browserPermittedModalities.video.some((function(l){return l===T.default.MEDIA_STATE.send})))return[3,4];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.deviceEnumerator.enumerateDevices()];case 2:return p.sent(),[3,4];case 3:return u=p.sent(),this.logger.safe.warn(\"onStreamStarted device enumeration failed: \".concat(E.stringifyObject(u))),[3,4];case 4:if(!l.rawTrack)return this.logger.safe.warn(\"stream:\".concat(l.id,\" is already disposed\")),[2];switch(l.mediaType){case\"Audio\":this.deviceEnumerator.startDevicePolling(),this.updateActiveMicrophone(l,d);break;case\"Video\":this.deviceEnumerator.startDevicePolling(),this.updateCameraSelectionStrategy(A.SelectionType.Manual),this.notifyMaxVideoSendCapabilitiesChanged(l);break;case\"ScreenShare\":this.notifyMaxVideoSendCapabilitiesChanged(l)}return[2]}}))}))},DeviceManager.prototype.updateActiveMicrophone=function(l,d){var u=this;if(l.deviceId){var p=this.devices.find((function(d){return d.deviceId===l.deviceId}));if(!p&&\"default\"!==l.deviceId)return void this.logger.safe.error(\"Active device not found\",\"Device id from track: '\".concat(v.scrubMriOrOmit(l.deviceId),\"', known devices: [\").concat(this.devices.map((function(l){return JSON.stringify((0,b.scrubDevices)(l,u.configProvider.config.devices.piiSafeWords))})),\"]}\"),JSON.stringify((0,b.scrubConstraints)(d)));p&&\"default\"!==l.deviceId&&d.audio&&d.audio.deviceId===T.default.MEDIA_DEVICE.defaultId&&this.deviceList.updateActiveMicrophone(p)}},DeviceManager.prototype.notifyMaxVideoSendCapabilitiesChanged=function(l){var d=l.getResolution(),u=new _.ResolutionInfo(d.width,d.height),p=l.getFrameRate(),h={maxFs:u.fs,maxMbps:u.fs*p,maxFps:p,maxWidth:u.width,maxHeight:u.height};this.logger.safe.info(\"Capabilities for \".concat(l.mediaType,\" stream: \").concat(JSON.stringify(h))),this.event(\"onMaxVideoSendCapabilitiesChanged\").raise(l.mediaType,h)},DeviceManager.prototype.onStreamDisposing=function(l){this.unsubscribeFromStreamEvents(l),\"Video\"===l.mediaType&&this.updateCameraSelectionStrategy(A.SelectionType.Automatic),this.raiseTelemetryEvent(\"stream_disposed\",l.mediaType)},DeviceManager.prototype.onStreamMuted=function(l,d){(\"Audio\"===l.mediaType||this.configProvider.config.raiseVideoMuteUfd)&&this.ufdManager.signalDeviceEvent(2,d?\"Bad\":\"Good\",l.mediaType),this.raiseTelemetryEvent(d?\"stream_muted\":\"stream_unmuted\",l.mediaType)},DeviceManager.prototype.onStreamEnded=function(l,d){d.error?(this.raiseTelemetryEvent(\"stream_ended_error\",{mediaType:l.mediaType,error:{type:d.error.name,detail:d.error.message}}),\"SourceUnavailableError\"===d.error.name&&this.ufdManager.signalDeviceEvent(0,\"Bad\",\"Audio\")):(\"Audio\"!==l.mediaType&&\"Video\"!==l.mediaType||this.ufdManager.signalDeviceEvent(0,\"Bad\",l.mediaType),this.raiseTelemetryEvent(\"stream_ended\",l.mediaType))},DeviceManager.prototype.onStreamError=function(l,d){this.raiseTelemetryEvent(\"stream_error\",{mediaType:l.mediaType,error:d})},DeviceManager.prototype.onAllStreamsRemoved=function(){this.deviceEnumerator.stopDevicePolling()},DeviceManager.prototype.onStreamAcquired=function(l,d,u,p){0!==d&&this.raiseTelemetryEvent(\"stream_acquired\",{mediaType:l,timestamp:d,resolution:u,withAudio:p})},DeviceManager.prototype.onRendererDisposed=function(l){E.remove(this.activeRenderers,(function(d){return d===l})),this.domOverrides.onMediaElementRemoved&&this.domOverrides.onMediaElementRemoved(l.getVideoElement()),this.unsubscribeFromRendererEvents(l)},DeviceManager.prototype.onRendererStarted=function(l){this.activeRenderers.push(l),this.event(\"onLocalRendererStarted\").raise(l)},DeviceManager.prototype.onVideoEffectsQualityEventHandler=function(l){var d=this.deviceSelection.selectedDevices.camera;if(d&&d.deviceId){var u={type:\"onVideoEffectQualityChanged\",payload:{message:l.message,effectType:l.effectType}};this.event(\"onVideoEffectsEvent\").raise(d.deviceId,u)}},DeviceManager}(y.default);d.default=D},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.LocalVideoRenderer=void 0;var f=u(19),m=u(13),v=u(30),y=u(1),S=u(123),_=function(l){function LocalVideoRenderer(d,u,p,h){var g=l.call(this,d,p.createChild(\"local\"))||this;return g.mediaStreamProvider=u,g.configProvider=h,g.isDisposed=!1,g.serialQueue=new v.PromiseQueue(g.logger.createChild(\"rendererQueue\")),g.logger.safe.info(\"ctor\"),g.overlayStats=(0,S.createLocalRendererStatsOverlay)(g.configProvider.config.showStatsInCall,d),g}return p(LocalVideoRenderer,l),LocalVideoRenderer.prototype.dispose=function(){var d;this.logger.safe.info(\"dispose\"),this.isDisposed=!0,this.event(\"onRendererDisposed\").raise(this),l.prototype.dispose.call(this),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null),null===(d=this.statsSub)||void 0===d||d.dispose(),this.overlayStats.dispose()},LocalVideoRenderer.prototype.setVideoMirroring=function(l){this.configProvider.config.localPreviewMirroringSupported&&(this.getVideoElement().style.transform=l?\"scaleX(-1)\":void 0)},LocalVideoRenderer.prototype.startVideoAsync=function(l){var d=this;return void 0===l&&(l=(0,m.generateCauseId)()),this.logger.safe.info(\"[\".concat(l,\"] starting local video\")),this.event(\"onRendererStarted\").raise(this),this.serialQueue.add((function(){return d.restartVideo()}),l)},LocalVideoRenderer.prototype.updateStreamAsync=function(l){var d=this;return void 0===l&&(l=(0,m.generateCauseId)()),this.logger.safe.info(\"[\".concat(l,\"] updating local video\")),this.serialQueue.add((function(){return d.restartVideo()}),l)},LocalVideoRenderer.prototype.setStatsProvider=function(l){var d,u=this;null===(d=this.statsSub)||void 0===d||d.dispose(),this.statsSub=l.on(\"onRawStatisticsChanged\",(function(l){var d=Object.keys(l.ssrc).filter((function(d){return\"video\"===l.ssrc[d].mediaType&&-1!==d.indexOf(\"_send\")})).map((function(d){return l.ssrc[d]}));d.length&&u.overlayStats.setStats(d)}))},LocalVideoRenderer.prototype.restartVideo=function(){return h(this,void 0,void 0,(function(){var l,d;return g(this,(function(u){switch(u.label){case 0:l=this.mediaStreamProvider.getVideoStream(!1,\"localVideoRenderer\"),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,l.start()];case 2:if(u.sent(),this.isDisposed)throw l.dispose(),new Error(\"local video renderer is disposed\");return this.attachStream(l),[3,4];case 3:throw d=u.sent(),this.mediaStreamProvider.raiseTelemetryEvent(\"video_preview_error\",{mediaType:\"Video\",error:y.stringifyObject(d)}),d;case 4:return[2]}}))}))},LocalVideoRenderer.prototype.attachStream=function(d){var u;if(this.mediaStream!==d)if((null===(u=this.mediaStream)||void 0===u?void 0:u.parentId)!==(null==d?void 0:d.parentId)){this.logger.safe.info(\"attach media stream \".concat(null==d?void 0:d.id));try{this.mediaStream&&(\"Edge\"===(0,f.getBrowserInfo)().name&&l.prototype.reattachEventListeners.call(this),this.mediaStream.dispose(),this.mediaStream=null),d&&l.prototype.attachMediaStream.call(this,d.rawStream),this.mediaStream=d}catch(l){throw d&&d.dispose(),l}}else d.dispose()},LocalVideoRenderer}(u(79).VideoRendererBase);d.LocalVideoRenderer=_},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaStreamManager=void 0;var h=u(7),g=u(30),f=u(9),m=u(27),v=u(1),y=u(327),S=u(339),_=function(l){function MediaStreamManager(d,u,p,h,f){var m=l.call(this)||this;return m.logger=d,m.deviceManager=u,m.configProvider=p,m.videoEffectManager=h,m.audioEffectManager=f,m.cachedStreamsSubs=new Map,m.cachedStreamsMap=new Map,m.mediaStreamSerialQueue=new g.PromiseQueue(m.logger),m.couldUseWebrtc_1_0=!1,m.deviceManager.on(\"onDevicesChanged\",(function(l){return m.onDevicesChanged(l)})),m}return p(MediaStreamManager,l),MediaStreamManager.prototype.getMediaStream=function(l,d){var u=this;this.logger.safe.info(\"retrieving media stream: \".concat(JSON.stringify((0,f.scrubConstraints)(l)))),this.cachedStreamsMap.size||(this.couldUseWebrtc_1_0=(0,f.canUseWebrtc1_0)(this.configProvider.config.checkSupportForWebrtc_1_0));var p=this.getSuitableStream(l);p||(this.logger.safe.info(\"cached stream is not found. Creating a new one with constraints: \".concat(v.stringifyObject((0,f.scrubConstraints)(l)))),p=this.createCachedStream(l));var h=p.getClient(d);return h.start().catch((function(l){u.logger.safe.error(\"could not start media stream: \".concat(p.id,\", total streams: \").concat(u.cachedStreamsMap.size,\", error: \").concat(JSON.stringify(l))),u.removeStream(p)})),h},MediaStreamManager.prototype.dispose=function(){this.cachedStreamsSubs&&(this.cachedStreamsSubs.forEach((function(l){l.forEach((function(l){l.dispose()}))})),this.cachedStreamsSubs=null),this.cachedStreamsMap&&(this.cachedStreamsMap.forEach((function(l){return l.dispose(\"MSM dispose\")})),this.cachedStreamsMap=null),this.mediaStreamSerialQueue&&(this.mediaStreamSerialQueue.dispose(),this.mediaStreamSerialQueue=null),l.prototype.dispose.call(this)},MediaStreamManager.prototype.getCachedStreams=function(){return this.cachedStreamsMap},MediaStreamManager.prototype.getActiveConstraints=function(){var l={audio:!1,video:!1,sharing:!1};return this.cachedStreamsMap.forEach((function(d,u){u.audio&&(l.audio=!0),u.video&&(l.video=!0),u.sharing&&(l.sharing=!0)})),l},MediaStreamManager.prototype.getSuitableStream=function(l){var d,u=this;return this.cachedStreamsMap.forEach((function(p,h){u.isSuitable(u.addDeviceIdIfNecessary(p,h),l)&&(d=h)})),d&&this.cachedStreamsMap.get(d)},MediaStreamManager.prototype.addDeviceIdIfNecessary=function(l,d){if(!l.deviceId)return d;var u=v.deepClone(d);return d.audio&&void 0===d.audio.deviceId&&(u.audio.deviceId=l.deviceId),d.video&&void 0===d.video.deviceId&&(u.video.deviceId=l.deviceId),u},MediaStreamManager.prototype.createCachedStream=function(l){var d=this.createStream(l);return this.subscribeOnStreamEvents(d),this.logger.safe.info(\"created media stream, id: \".concat(d.id,\" total: \").concat(this.cachedStreamsMap.size)),this.cachedStreamsMap.set(l,d),d},MediaStreamManager.prototype.disposeCurrentDeviceStream=function(l){var deviceChanged=function(l,d){return l&&d&&l.deviceId!==d.deviceId};this.cachedStreamsMap.forEach((function(d,u){l.sharing||u.sharing||!deviceChanged(l.audio,u.audio)&&!deviceChanged(l.video,u.video)||d.dispose(\"MSM dispose oneStreamPerDeviceType\")}))},MediaStreamManager.prototype.createStream=function(l){return this.configProvider.config.oneStreamPerDeviceType&&this.disposeCurrentDeviceStream(l),this.configProvider.config.webrtcSimulcastSessionEnabled&&m.UserAgentConfig.hasApplyConstraints()&&this.couldUseWebrtc_1_0?new S.SimulcastMediaStream(l,this.mediaStreamSerialQueue,this.configProvider,this.logger,this.videoEffectManager,this.audioEffectManager):new y.MediaStreamInternal(l,this.mediaStreamSerialQueue,this.logger,this.configProvider)},MediaStreamManager.prototype.subscribeOnStreamEvents=function(l){var d=this,u=[];u.push(l.on(\"onStreamAcquired\",(function(l,u,p){return d.onStreamAcquired(l,u,p)}))),u.push(l.on(\"onStreamDisposing\",(function(l){return d.onStreamDisposing(l)}))),this.cachedStreamsSubs.set(l,u)},MediaStreamManager.prototype.unsubscribeFromStreamEvents=function(l){this.cachedStreamsSubs.get(l).forEach((function(l){return l.dispose()})),this.cachedStreamsSubs.delete(l)},MediaStreamManager.prototype.removeStream=function(l){this.logger.safe.info(\"release media stream generation: \".concat(l.id,\" cached: \").concat(this.cachedStreamsMap.size)),this.cachedStreamsSubs.has(l)?(this.unsubscribeFromStreamEvents(l),this.cachedStreamsMap.delete(this.getConstraintsForStream(l)),this.cachedStreamsMap.size||this.event(\"onAllStreamsRemoved\").raise()):this.logger.safe.warn(\"skipping unknown stream \".concat(l.id))},MediaStreamManager.prototype.getConstraintsForStream=function(l){var d;return this.cachedStreamsMap.forEach((function(u,p){l===u&&(d=p)})),d},MediaStreamManager.prototype.isSuitable=function(l,d){var u=d.sharing||this.isAcceptable(l.audio,d.audio)&&l.audioProcessingFlags===d.audioProcessingFlags,p=this.isAcceptable(l.video,d.video),h=this.isAcceptable(l.sharing,d.sharing),g=l.withEffect===d.withEffect;return!d.force&&u&&p&&h&&g},MediaStreamManager.prototype.isAcceptable=function(l,d){return!l&&!d||l&&d&&l.deviceId===d.deviceId},MediaStreamManager.prototype.isDeviceOutdated=function(l,d){return l&&l.deviceId&&!d.some((function(d){return d.deviceId===l.deviceId}))},MediaStreamManager.prototype.onStreamDisposing=function(l){this.logger.safe.info(\"onStreamDisposing event \".concat(l.id)),this.removeStream(l)},MediaStreamManager.prototype.onStreamAcquired=function(l,d,u){var p=\"Audio\"===l.mediaType?void 0:!!l.rawStream.getAudioTracks()[0];this.event(\"onStreamAcquired\").raise(l.mediaType,d,u,p)},MediaStreamManager.prototype.onDevicesChanged=function(l){var d=this;this.cachedStreamsMap.forEach((function(u,p){if(!p.sharing){var h=d.isDeviceOutdated(p.audio,l),g=d.isDeviceOutdated(p.video,l);(h||g)&&d.cachedStreamsMap.delete(p)}}))},MediaStreamManager}(h.default);d.MediaStreamManager=_},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},g=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaStreamInternal=void 0;var f=u(19),m=u(7),v=u(3),y=u(9),S=u(29),_=u(1),C=u(124),E=u(128),T=u(129),b=u(338),I=u(81),A=function(l){function MediaStreamInternal(d,u,p,h){var g=l.call(this)||this;return g.streamConstraints=d,g.serialQueue=u,g.configProvider=h,g.clientId=0,g.clients=[],g.gumStreams={},g.clientGumStreams=[],g.streamsDump=[],g.isMuted=!1,g.isHold=!1,g.gumStartTime=0,g.streamId=MediaStreamInternal.streamGeneration++,g.logger=p.createChild(\"MediaStream:\".concat(g.streamId)),g.mediaType=g.getMediaType(g.streamConstraints),g.constraintsProvider=C.ConstraintsProviderFactory.getProvider(g.mediaType,g.configProvider,g.logger),g.currentConstraints=g.constraintsProvider.createConstraintsObject(d),g}return p(MediaStreamInternal,l),Object.defineProperty(MediaStreamInternal.prototype,\"id\",{get:function(){return this.streamId},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamInternal.prototype,\"rawStream\",{get:function(){return this.currentGumStream},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamInternal.prototype,\"deviceId\",{get:function(){var l,d,u,p,h,g;return null!==(g=null===(h=null===(p=null===(u=null===(d=null===(l=this.rawStream)||void 0===l?void 0:l.getTracks())||void 0===d?void 0:d[0])||void 0===u?void 0:u.getSettings)||void 0===p?void 0:p.call(u))||void 0===h?void 0:h.deviceId)&&void 0!==g?g:null},enumerable:!1,configurable:!0}),MediaStreamInternal.prototype.applyCapabilities=function(l){var d=this;if(this.currentGumStream){var u=this.constraintsProvider.updateVideoConstraints(this.currentConstraints,l,this.getResolution());if(!u)return Promise.resolve(!1);if(this.currentConstraints!==u){this.currentConstraints=u;var p=this.currentConstraints;return this.hasDisplay()?this.applyConstraints(this.currentConstraints).then((function(){return _.deepEqual(d.currentConstraints,p)})).catch((function(l){return d.logger.safe.error(\"Apply constraints error: \".concat(_.stringifyObject(l))),!1})):this.applyConstraintsInternal().then((function(){return _.deepEqual(d.currentConstraints,p)}))}}return Promise.resolve(!1)},MediaStreamInternal.prototype.getClient=function(){var l,d;this.currentGumStream?(d=this.getClone(),this.clientGumStreams.push(((l={})[this.constraintsProvider.getKey(this.currentConstraints)]=d,l))):this.clientGumStreams.push({});var u=new b.MediaStreamClient(this,d,this.logger.createChild(\"Client:\".concat(this.clientId++)));return this.clients.push(u),u},MediaStreamInternal.prototype.getClone=function(){return this.hasDisplay()?this.currentGumStream:this.currentGumStream.clone()},MediaStreamInternal.prototype.setMuted=function(l){this.isMuted=l,this.clients.forEach((function(d){d.setMuted(l)})),this.enableDisableTracks()},MediaStreamInternal.prototype.getMuted=function(){return this.isMuted},MediaStreamInternal.prototype.setHold=function(l){this.isHold=l,this.clients.forEach((function(d){d.setHold(l)})),this.enableDisableTracks()},MediaStreamInternal.prototype.disposeClient=function(l){var d=this.clients.indexOf(l);d>=0&&(this.clients.splice(d,1),this.streamsDump.push(this.clientGumStreams[d]),this.clientGumStreams.splice(d,1),0===this.clients.length)&&this.disposeStream()},MediaStreamInternal.prototype.dispose=function(){for(var l=this.clients.length-1;l>=0;l--)this.clients[l].dispose()},MediaStreamInternal.prototype.disposeStream=function(){var d=this;this.event(\"onStreamDisposing\").raise(this),this.stopGumStream().then((function(){d.event(\"onStreamDisposed\").raise(d)})).catch((function(l){d.event(\"onStreamError\").raise(d,l)})).then((function(){d.constraintsProvider=null,d.serialQueue=null,d.configProvider=null,d.logger=d.logger.createChild(\"DISPOSED\"),l.prototype.dispose.call(d)}))},MediaStreamInternal.prototype.start=function(){var l=this;return this.gumPromise||(this.currentConstraints.video&&\"Edge\"!==(0,f.getBrowserInfo)().name?this.gumPromise=this.applyConstraintsInternal():this.gumPromise=this.updateGumStreamInternal(this.currentConstraints),this.gumPromise=this.gumPromise.then((function(){l.event(\"onStreamStarted\").raise(l,l.currentConstraints)})).catch((function(d){throw l.event(\"onStreamError\").raise(l,d),d}))),this.gumPromise},MediaStreamInternal.prototype.hasAudio=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getAudioTracks().length},MediaStreamInternal.prototype.hasVideo=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getVideoTracks().length&&this.currentConstraints.video&&this.currentConstraints.video.deviceId!==v.default.DISPLAY_SOURCE_ID},MediaStreamInternal.prototype.hasDisplay=function(){return!!this.currentGumStream&&0!==this.currentGumStream.getVideoTracks().length&&this.currentConstraints.video&&this.currentConstraints.video.deviceId===v.default.DISPLAY_SOURCE_ID},MediaStreamInternal.prototype.getVideoDeviceId=function(){return this.currentConstraints.video.deviceId},MediaStreamInternal.prototype.getResolution=function(){var l=this;if(![\"Video\",\"ScreenShare\",\"PanoramicVideo\"].some((function(d){return d===l.mediaType})))return null;var d={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},u=I.getResolutionForStream(this.currentGumStream,d);return u===d?this.logger.safe.error(\"Stream resolution is not avalable, assuming we're at \".concat(d.width,\"x\").concat(d.height,\" now\")):this.logger.safe.info(\"Stream resolution is \".concat(u.width,\"x\").concat(u.height)),u},MediaStreamInternal.prototype.getFrameRate=function(){var l=this;if(![\"Video\",\"ScreenShare\",\"PanoramicVideo\"].some((function(d){return d===l.mediaType})))return null;var d=I.getFrameRateForStream(this.currentGumStream);return 0===d?this.logger.safe.error(\"Stream frame rate is not avalable, returning 0\"):this.logger.safe.info(\"Stream fps is \".concat(d)),d},MediaStreamInternal.prototype.getMediaType=function(l){if(l.sharing)return\"ScreenShare\";if(l.video)return\"Video\";if(l.audio)return\"Audio\";throw new Error(\"Media type is not defined: \".concat(JSON.stringify(l)))},MediaStreamInternal.prototype.updateClients=function(l){var d=this,u=this.constraintsProvider.getKey(l);this.clients.forEach((function(l,p){d.clientGumStreams[p][u]||(d.clientGumStreams[p][u]=d.getClone()),l.update(d.clientGumStreams[p][u])}))},MediaStreamInternal.prototype.applyConstraints=function(l){var d=this.getGumStreamProvider();return Promise.all(this.clients.map((function(u){return d.applyConstraints(u.rawStream,l)}))).then((function(){}))},MediaStreamInternal.prototype.applyConstraintsInternal=function(){var l=this;return new Promise((function(d,u){l.logger.safe.info(\"applying stream constraints: \".concat(JSON.stringify((0,y.scrubConstraints)(l.currentConstraints))));var p=new S.SettablePromise;l.clients.forEach((function(l){l.onApplyConstraints&&l.onApplyConstraints(p.promise)})),d(l.serialQueue.add((function(){var d=new E.RequestPolicyGenerator(l.configProvider).getPolicies(l.currentConstraints);return l.gumPromise=l.updateGumStreamInternal(d[0]),d.slice(1).forEach((function(d){l.gumPromise=l.gumPromise.catch((function(u){if(v.default.MEDIA_ERROR.constraintNotSatisfiedError===u.type)return l.logger.safe.warn(\"could not obtain constrained media stream, will attempt weaker policy\"),l.updateGumStreamInternal(d);throw u.constraints=d,u}))})),l.gumPromise})).then((function(){p.resolve()})).catch((function(d){throw l.logger.safe.error(\"failed to apply constraints: \".concat(JSON.stringify((0,y.scrubConstraints)(d.constraints)),\" error: \").concat(_.stringifyObject(d))),p.reject(d),d})))}))},MediaStreamInternal.prototype.enableDisableTracks=function(){var l=this;this.currentGumStream&&this.currentGumStream.getTracks().forEach((function(d){void 0!==d.enabled&&(d.enabled=!(\"audio\"===d.kind&&l.isMuted||l.isHold),l.logger.safe.info(\"control media stream track kind: \".concat(d.kind,\" enabled: \").concat(d.enabled,\" muted: \").concat(d.muted)))}))},MediaStreamInternal.prototype.getGumStreamProvider=function(){return T.GumStreamProviderFactory.getStreamProvider(this.mediaType,this.configProvider,this.logger.createChild(\"MSProvider\"))},MediaStreamInternal.prototype.updateGumStreamInternal=function(l){var d=this;return Promise.resolve().then((function(){d.logger.safe.info(\"querying user media for stream: \".concat(JSON.stringify(l)));var u=d.gumStreams[d.constraintsProvider.getKey(l)];if(u)return u;var p=d.getGumStreamProvider();return d.startRequestCalculation(),p.getStream(l)})).then((function(u){u.getAudioTracks().forEach((function(l){l.onended=function(l){d.logger.safe.info(\"Audio stream track ended: \".concat(JSON.stringify(l.error&&l.error.name||l))),d.event(\"onStreamTrackEnded\").raise(d,l)},l.onmute=function(){d.logger.safe.info(\"Audio stream track muted\"),d.event(\"onStreamTrackMuted\").raise(d,!0)},l.onunmute=function(){d.logger.safe.info(\"Audio stream track unmuted\"),d.event(\"onStreamTrackMuted\").raise(d,!1)},l.muted&&d.event(\"onStreamTrackMuted\").raise(d,!0),d.logger.safe.info(\"Audio track added: \".concat(JSON.stringify(l.id)))})),d.currentGumStream=u,d.currentConstraints=l.video?d.constraintsProvider.updateResolution(l,d.getResolution()):l,d.logger.safe.info(\"Stream constraints updated: \".concat(JSON.stringify(d.currentConstraints)));var p=d.constraintsProvider.getKey(d.currentConstraints);d.gumStreams[p]!==u&&(d.gumStreams[p]&&(d.logger.safe.info(\"Stream cache hit for \".concat(p,\", stopping old stream\")),d.stopOneGumStream(d.gumStreams[p])),d.gumStreams[p]=u),d.updateClients(d.currentConstraints);var h=u.getVideoTracks()[0];h&&(h.onmute=function(l){d.logger.safe.error(\"Video stream track muted: \".concat(JSON.stringify((0,y.scrubConstraints)(d.currentConstraints)),\"; \").concat(JSON.stringify(l)))},h.onended=function(l){d.logger.safe.info(\"Video stream track ended: \".concat(JSON.stringify((0,y.scrubConstraints)(d.currentConstraints)),\"; \").concat(JSON.stringify(l.error&&l.error.name||l))),d.event(\"onStreamTrackEnded\").raise(d,l)},d.hasDisplay()&&d.configProvider.config.webrtcDisplayStreamContentHint&&d.applyContentHint(h,d.configProvider.config.webrtcDisplayStreamContentHint),d.logger.safe.info(\"Video track added: \".concat(JSON.stringify(h.id)))),d.enableDisableTracks(),d.logger.safe.info(\"media stream updated\");var g=d.stopRequestCalculation();d.event(\"onStreamAcquired\").raise(d,g,(d.hasVideo()||d.hasDisplay())&&d.getResolution()||void 0)}))},MediaStreamInternal.prototype.applyContentHint=function(l,d){[\"\",\"text\",\"detail\",\"motion\"].indexOf(d)<0?this.logger.safe.error(\"Cannot apply content hint: \".concat(d)):(this.logger.safe.info(\"Apply content hint: \".concat(d)),l.contentHint=d)},MediaStreamInternal.prototype.startRequestCalculation=function(){this.gumStartTime=Date.now()},MediaStreamInternal.prototype.stopRequestCalculation=function(){if(0===this.gumStartTime)return 0;var l=Date.now()-this.gumStartTime;return this.gumStartTime=0,l},MediaStreamInternal.prototype.stopGumStream=function(){var l=this;return this.gumPromise?(this.logger.safe.info(\"queueing media stream stop\"),this.serialQueue.add((function(){l.stopGumStreamInternal()}))):Promise.resolve()},MediaStreamInternal.prototype.stopOneGumStream=function(l){var d=this;try{l.getTracks().forEach((function(l){d.logger.safe.info(\"Track is stopped: \".concat(JSON.stringify(l.id))),l.onended=null,l.onmute=null,l.stop()})),this.logger.safe.info(\"media stream stopped\")}catch(l){this.logger.safe.warn(\"failed to stop media stream: \".concat(_.stringifyObject(l)))}},MediaStreamInternal.prototype.stopGumStreamInternal=function(){var l=this;this.currentGumStream&&(g(g(g([],h(this.clientGumStreams),!1),h(this.streamsDump),!1),[this.gumStreams],!1).forEach((function(d){_.forOwn(d,(function(d){l.stopOneGumStream(d)}))})),this.gumStreams={},this.clientGumStreams=[],this.streamsDump=[],this.currentGumStream=null)},MediaStreamInternal.streamGeneration=0,MediaStreamInternal}(m.default);d.MediaStreamInternal=A},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SafariSharingConstraintsProvider=d.SharingConstraintsProvider=void 0;var g=u(125),f=u(80),m=u(126),v=u(329),y=u(127),S=8160,_=15,C=function(l){function SharingConstraintsProvider(d){var u=l.call(this,d)||this;return u.initialConstraints={maxWidth:1920,minWidth:1920,maxHeight:1080,minHeight:1080,fps:15},u.maxCapabilities={maxFs:S,maxFps:_},u.validator=new y.VideoCapabilitiesValidator(u.logger.createChild(\"CV\"),u.maxCapabilities),u.constraintsCalculator=new v.SharingConstraintsCalculator(u.logger.createChild(\"CC\")),u}return p(SharingConstraintsProvider,l),SharingConstraintsProvider.prototype.createConstraintsObject=function(l){if(!l.sharing)throw new Error(\"Sharing constraints are not presented: \".concat(JSON.stringify(l)));var d=this.convertConstraints(l.sharing,this.initialConstraints),u=l.audio?l.audio:null;return u&&u.deviceId&&delete u.deviceId,new f.ConstraintsObject(u,d,!1)},SharingConstraintsProvider.prototype.generatePolicies=function(l){return[l]},SharingConstraintsProvider.prototype.calculateConstraints=function(l,d){this.logger.safe.info(\"Stream resolution is \".concat(JSON.stringify(d)));var u=this.validator.ensureValidity(l);return this.constraintsCalculator.calculateConstraints(u,d)},SharingConstraintsProvider}(m.ConstraintsProviderBase);d.SharingConstraintsProvider=C;var E=function(l){function SafariSharingConstraintsProvider(d,u){var p,f,m,v,y=l.call(this,d)||this,S=u.screen.width/u.screen.height;S<1&&(p=h([y.initialConstraints.maxHeight,y.initialConstraints.maxWidth],2),y.initialConstraints.maxWidth=p[0],y.initialConstraints.maxHeight=p[1],f=h([y.initialConstraints.minHeight,y.initialConstraints.minWidth],2),y.initialConstraints.minWidth=f[0],y.initialConstraints.minHeight=f[1]);var _=(0,g.adjustResolitionToAspectRatio)({width:y.initialConstraints.maxWidth,height:y.initialConstraints.maxHeight},S);return m=h([_.width,_.height],2),y.initialConstraints.maxWidth=m[0],y.initialConstraints.maxHeight=m[1],_=(0,g.adjustResolitionToAspectRatio)({width:y.initialConstraints.minWidth,height:y.initialConstraints.minHeight},S),v=h([_.width,_.height],2),y.initialConstraints.minWidth=v[0],y.initialConstraints.minHeight=v[1],y}return p(SafariSharingConstraintsProvider,l),SafariSharingConstraintsProvider}(C);d.SafariSharingConstraintsProvider=E},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SharingConstraintsCalculator=d.ResolutionTableCalculator=void 0;var p=u(125),h=16,g=function(){function ResolutionTableCalculator(){this.MAX_SHARING_WIDTH=1920,this.MAX_SHARING_HEIGHT=1080}return ResolutionTableCalculator.prototype.getResolutionTable=function(l,d){var u=this.constraintToMaxResolution(l,d);return this.generateResolutionTable(u)},ResolutionTableCalculator.prototype.constraintToMaxResolution=function(l,d){var u=this.getPortraitOrLandscapeMaxResolution(l),h=(0,p.adjustResolitionToAspectRatio)({width:l.width,height:l.height},d),g=u.width/h.width,f=u.height/h.height,m=Math.min(g,f);return this.resizeResolution(h,m)},ResolutionTableCalculator.prototype.resizeResolution=function(l,d){return{width:Math.round(l.width*d),height:Math.round(l.height*d)}},ResolutionTableCalculator.prototype.getPortraitOrLandscapeMaxResolution=function(l){return l.width>l.height?{width:this.MAX_SHARING_WIDTH,height:this.MAX_SHARING_HEIGHT}:{width:this.MAX_SHARING_HEIGHT,height:this.MAX_SHARING_WIDTH}},ResolutionTableCalculator.prototype.ceilToMackroblockSize=function(l){var d=l.width,u=l.height;return{width:Math.ceil(d/h)*h,height:Math.ceil(u/h)*h}},ResolutionTableCalculator.prototype.generateResolutionTable=function(l){var d=this;return[1,2/3,1/3,1/6].map((function(u){return d.resizeResolution(l,u)})).map((function(l){return d.ceilToMackroblockSize(l)}))},ResolutionTableCalculator}();d.ResolutionTableCalculator=g;var f=function(){function SharingConstraintsCalculator(l){this.logger=l,this.FPS_TABLE=[15,7.5,3.75,1.875],this.resolutionTableCalculator=new g,this.initialAspectRatio=null}return SharingConstraintsCalculator.prototype.calculateConstraints=function(l,d){var u=this;this.initialAspectRatio||(this.initialAspectRatio=d.width/d.height);var p=this.resolutionTableCalculator.getResolutionTable(d,this.initialAspectRatio),h={resolution:p[p.length-1],fps:this.FPS_TABLE[this.FPS_TABLE.length-1]};return p.some((function(d){var p=u.getFs(d);return u.FPS_TABLE.some((function(g){var f=u.getMbps(p,g);return p<=l.maxFs&&g<=l.maxFps&&f<=l.maxMbps&&(h={resolution:d,fps:g},!0)}))}))?this.logger.safe.info(\"Calculated resolution: \".concat(JSON.stringify(h))):this.logger.safe.error(\"None of available resolutions are suitable: \".concat(JSON.stringify(p),\". Fallback to: \").concat(JSON.stringify(h))),h},SharingConstraintsCalculator.prototype.getMbps=function(l,d){return l*d},SharingConstraintsCalculator.prototype.getFs=function(l){return Math.ceil(l.width/h)*Math.ceil(l.height/h)},SharingConstraintsCalculator}();d.SharingConstraintsCalculator=f},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.BasicConstraintsProvider=void 0;var h=u(19),g=u(26),f=u(80),m=u(126),v=30,y=function(l){function BasicConstraintsProvider(d,u){var p=l.call(this,u)||this;return p.configProvider=d,p.resTable=new g.default(d.config.resolutionTableOverride),p}return p(BasicConstraintsProvider,l),BasicConstraintsProvider.prototype.createConstraintsObject=function(l){var d={},u=(0,h.getBrowserInfo)().engine;void 0!==l.audioProcessingFlags&&(\"Chromium\"===u?(d.autoGainControl=!!(1&l.audioProcessingFlags),d.echoCancellation=!!(2&l.audioProcessingFlags),d.noiseSuppression=!!(4&l.audioProcessingFlags),this.configProvider.config.useGoogPrefixAudioConstraints&&(d.googAutoGainControl=!!(1&l.audioProcessingFlags),d.googAutoGainControl2=!!(1&l.audioProcessingFlags),d.googEchoCancellation=!!(2&l.audioProcessingFlags),d.googHighpassFilter=!!(4&l.audioProcessingFlags),d.googNoiseSuppression=!!(4&l.audioProcessingFlags),d.googTypingNoiseDetection=!!(4&l.audioProcessingFlags))):\"Safari\"===u||\"Firefox\"===u?(d.autoGainControl=!!(1&l.audioProcessingFlags),d.echoCancellation=!!(2&l.audioProcessingFlags),d.noiseSuppression=!!(4&l.audioProcessingFlags)):this.logger.warn(\"Unsupported browser for audio processing flags \".concat(u)));var p=this.convertConstraints(l.audio,d),g=this.convertConstraints(l.video,this.initialVideoConstraints);return new f.ConstraintsObject(p,g,l.withTimeout,l.withEffect)},BasicConstraintsProvider.prototype.calculateConstraints=function(l){var d=Math.min(l.maxFs,this.configProvider.config.webrtcCameraOpenFs);return{resolution:this.resTable.getResolutionByFs(d),fps:l.maxFps}},Object.defineProperty(BasicConstraintsProvider.prototype,\"initialVideoConstraints\",{get:function(){var l=\"Edge\"===(0,h.getBrowserInfo)().name?this.resTable.initialResolution:this.resTable.getResolutionByFs(this.configProvider.config.webrtcCameraOpenFs);return{maxWidth:l.width,minWidth:l.width,maxHeight:l.height,minHeight:l.height,fps:v}},enumerable:!1,configurable:!0}),BasicConstraintsProvider}(m.ConstraintsProviderBase);d.BasicConstraintsProvider=y},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.ORTCDisplayStreamProvider=d.ORTCMediaStreamProvider=void 0;var h=u(130),g=u(15),f=u(332),m=u(333),v=function(l){function ORTCMediaStreamProvider(d){var u=l.call(this,d)||this;return u.constraintsAdapter=new f.OrtcConstraintsAdapter,u}return p(ORTCMediaStreamProvider,l),ORTCMediaStreamProvider}(h.GumStreamProviderBase);d.ORTCMediaStreamProvider=v;var y=function(l){function ORTCDisplayStreamProvider(d){var u=l.call(this,d.createChild(\"ORTCDispProvider\"))||this;return u.constraintsAdapter=new m.OrtcDisplayConstraintsAdapter,u}return p(ORTCDisplayStreamProvider,l),ORTCDisplayStreamProvider.isSupported=function(){return(!!window.navigator).getDisplayMedia},ORTCDisplayStreamProvider.prototype.getStream=function(l){var d=this.constraintsAdapter.toGumConstraints(l);return this.logger.safe.info(\"Constraints to be applied: \".concat(JSON.stringify(d))),g.default.window.navigator.getDisplayMedia(d)},ORTCDisplayStreamProvider}(h.GumStreamProviderBase);d.ORTCDisplayStreamProvider=y},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.OrtcConstraintsAdapter=void 0;var p=u(3),h=function(){function OrtcConstraintsAdapter(){}return OrtcConstraintsAdapter.prototype.toGumConstraints=function(l){var d={};return l.audio&&(d.audio={},l.audio.deviceId&&l.audio.deviceId!==p.default.MEDIA_DEVICE.defaultId&&(d.audio.deviceId={exact:l.audio.deviceId})),l.video&&(d.video={},l.video.deviceId&&(d.video.deviceId={exact:l.video.deviceId}),l.video.minWidth&&(d.video.minWidth=l.video.minWidth),l.video.maxWidth&&(d.video.maxWidth=l.video.maxWidth),l.video.minHeight&&(d.video.minHeight=l.video.minHeight),l.video.maxHeight&&(d.video.maxHeight=l.video.maxHeight),l.video.fps&&(d.video.fps=l.video.fps)),d},OrtcConstraintsAdapter.prototype.toTrackConstraints=function(l){throw new Error(\"Track constraints not supported for ORTC\")},OrtcConstraintsAdapter}();d.OrtcConstraintsAdapter=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.OrtcDisplayConstraintsAdapter=void 0;var p=function(){function OrtcDisplayConstraintsAdapter(){}return OrtcDisplayConstraintsAdapter.prototype.toGumConstraints=function(l){var d={video:{}};return l.video.minWidth&&(d.video.minWidth=l.video.minWidth),l.video.maxWidth&&(d.video.maxWidth=l.video.maxWidth),l.video.minHeight&&(d.video.minHeight=l.video.minHeight),l.video.maxHeight&&(d.video.maxHeight=l.video.maxHeight),l.video.fps&&(d.video.fps=l.video.fps),d},OrtcDisplayConstraintsAdapter.prototype.toTrackConstraints=function(l){throw new Error(\"Track constraints not supported for ORTC\")},OrtcDisplayConstraintsAdapter}();d.OrtcDisplayConstraintsAdapter=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.UnsupportedStreamProvider=d.WebRTCDisplayStreamProvider=d.WebRTCMediaStreamProvider=void 0;var h=u(19),g=u(130),f=u(131),m=u(15),v=u(3),y=u(1),S=u(335),_=u(336),C=u(337),E=u(9),T=function(l){function WebRTCMediaStreamProvider(d,u){var p=l.call(this,u.createChild(\"WebRTCProvider\"))||this;return p.configProvider=d,p.timeoutId=null,void 0!==navigator.webkitGetUserMedia&&void 0!==webkitRTCPeerConnection&&\"Electron\"===(0,h.getBrowserInfo)().name?p.constraintsAdapter=new S.WebKitConstraintsAdapter:navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&(p.constraintsAdapter=new _.WebRTCConstraintsAdapter),p}return p(WebRTCMediaStreamProvider,l),WebRTCMediaStreamProvider.prototype.getStream=function(d){var u=this;if(!d.withTimeout||!this.configProvider.config.gumRequestTimeout)return l.prototype.getStream.call(this,d);var p=this.startGumRequestTimer(d),h=l.prototype.getStream.call(this,d).then((function(l){if(!u.timeoutId)throw u.stopStreamAfterTimeout(l,d),u.getMediaStreamTimeoutError(d);return u.stopGumRequestTimer(),l}));return Promise.race([p,h]).catch((function(l){throw u.stopGumRequestTimer(),l}))},WebRTCMediaStreamProvider.prototype.getMediaStreamTimeoutError=function(l){var d={name:v.default.MEDIA_ERROR.mediaStreamRequestTimedOut,message:\"Media stream request timed out. Constraints: \".concat(y.stringifyObject((0,E.scrubConstraints)(l)))};return new f.MediaStreamErrorDecorator(d,l).getMediaError()},WebRTCMediaStreamProvider.prototype.startGumRequestTimer=function(l){var d=this;return new Promise((function(u,p){d.timeoutId=window.setTimeout((function(){d.timeoutId=null,p(d.getMediaStreamTimeoutError(l))}),d.configProvider.config.gumRequestTimeout)}))},WebRTCMediaStreamProvider.prototype.stopGumRequestTimer=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)},WebRTCMediaStreamProvider.prototype.stopStreamAfterTimeout=function(l,d){var u=this;this.logger.safe.info(\"Stopping media stream acquired after timeout: \".concat(JSON.stringify(l.id),\" with constraints: \").concat(JSON.stringify(d)));try{l.getTracks().forEach((function(l){u.logger.safe.info(\"Track is stopped: \".concat(JSON.stringify(l.id))),l.stop()})),this.logger.safe.info(\"Media stream stopped: \".concat(l.id))}catch(l){this.logger.safe.warn(\"Failed to stop media stream: \".concat(y.stringifyObject(l)))}},WebRTCMediaStreamProvider}(g.GumStreamProviderBase);d.WebRTCMediaStreamProvider=T;var b=function(l){function WebRTCDisplayStreamProvider(d){var u=l.call(this,d.createChild(\"WebRTCDispProvider\"))||this;return u.constraintsAdapter=new C.WebRTCDisplayConstraintsAdapter,u}return p(WebRTCDisplayStreamProvider,l),WebRTCDisplayStreamProvider.isSupported=function(){return!!window.navigator.mediaDevices.getDisplayMedia},WebRTCDisplayStreamProvider.prototype.getStream=function(l){var d=this.constraintsAdapter.toGumConstraints(l);return this.logger.safe.info(\"Constraints to be used: \".concat(JSON.stringify(d))),Promise.resolve().then((function(){return m.default.window.navigator.mediaDevices.getDisplayMedia(d)})).catch((function(d){throw new f.MediaStreamErrorDecorator(d,l).getMediaError()}))},WebRTCDisplayStreamProvider}(g.GumStreamProviderBase);d.WebRTCDisplayStreamProvider=b;var I=function(){function UnsupportedStreamProvider(l){this.detail=l}return UnsupportedStreamProvider.prototype.getStream=function(l){throw this.getError(l)},UnsupportedStreamProvider.prototype.applyConstraints=function(l,d){throw this.getError(d)},UnsupportedStreamProvider.prototype.applyConstraintsForTrack=function(l,d){throw this.getError(d)},UnsupportedStreamProvider.prototype.getError=function(l){return{type:v.default.MEDIA_ERROR.unsupportedStream,detail:this.detail,message:this.detail,isAudio:!!l.audio}},UnsupportedStreamProvider}();d.UnsupportedStreamProvider=I},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebKitConstraintsAdapter=void 0;var p=u(1),h=u(3),g=function(){function WebKitConstraintsAdapter(){}return WebKitConstraintsAdapter.prototype.toGumConstraints=function(l){var d={};return l.audio&&(d.audio=p.deepClone(l.audio),d.audio.deviceId&&delete d.audio.deviceId,l.audio.deviceId&&l.audio.deviceId!==h.default.MEDIA_DEVICE.defaultId&&(d.audio.deviceId=l.audio.deviceId)),l.video&&(d.video={mandatory:{}},l.video.deviceId&&(d.video.mandatory.sourceId=l.video.deviceId),l.video.minWidth&&(d.video.mandatory.minWidth=l.video.minWidth),l.video.maxWidth&&(d.video.mandatory.maxWidth=l.video.maxWidth),l.video.minHeight&&(d.video.mandatory.minHeight=l.video.minHeight),l.video.maxHeight&&(d.video.mandatory.maxHeight=l.video.maxHeight),l.video.fps&&(d.video.mandatory.maxFrameRate=l.video.fps),p.isEmpty(d.video.mandatory)&&delete d.video.mandatory),d},WebKitConstraintsAdapter.prototype.toTrackConstraints=function(l){var d={};return l.video&&(l.video.minWidth&&(d.width=l.video.minWidth),l.video.minHeight&&(d.height=l.video.minHeight),l.video.fps&&(d.frameRate=l.video.fps)),d},WebKitConstraintsAdapter}();d.WebKitConstraintsAdapter=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRTCConstraintsAdapter=void 0;var p=u(1),h=u(3),g=function(){function WebRTCConstraintsAdapter(){}return WebRTCConstraintsAdapter.prototype.toGumConstraints=function(l){var d={};if(l.audio&&(d.audio=p.deepClone(l.audio),d.audio.deviceId&&delete d.audio.deviceId,l.audio.deviceId&&l.audio.deviceId!==h.default.MEDIA_DEVICE.defaultId&&(d.audio.deviceId={exact:l.audio.deviceId})),l.video)for(var u in d.video={width:{},height:{},frameRate:{}},l.video.deviceId&&(d.video.deviceId={exact:l.video.deviceId}),l.video.minWidth&&(d.video.width.min=l.video.minWidth),l.video.maxWidth&&(d.video.width.max=l.video.maxWidth),l.video.minHeight&&(d.video.height.min=l.video.minHeight),l.video.maxHeight&&(d.video.height.max=l.video.maxHeight),l.video.fps&&(d.video.frameRate.max=l.video.fps,d.video.frameRate.ideal=l.video.fps),d.video)p.isEmpty(d.video[u])&&delete d.video[u];return d},WebRTCConstraintsAdapter.prototype.toTrackConstraints=function(l){var d={};return l.video&&(l.video.minWidth&&(d.width=l.video.minWidth),l.video.minHeight&&(d.height=l.video.minHeight),l.video.fps&&(d.frameRate=l.video.fps)),d},WebRTCConstraintsAdapter}();d.WebRTCConstraintsAdapter=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRTCDisplayConstraintsAdapter=void 0;var p=function(){function WebRTCDisplayConstraintsAdapter(){}return WebRTCDisplayConstraintsAdapter.prototype.toGumConstraints=function(l){if(!l||!l.video)throw new Error(\"constraints cannot be applied: \".concat(l));var d={video:{}};return l.video.maxWidth&&(d.video.width={max:l.video.maxWidth}),l.video.maxHeight&&(d.video.height={max:l.video.maxHeight}),l.video.fps&&(d.video.frameRate=l.video.fps),l.audio&&(d.audio=!0),d},WebRTCDisplayConstraintsAdapter.prototype.toTrackConstraints=function(l){var d=navigator.mediaDevices.getSupportedConstraints();if(!d)throw new Error(\"Constraints are not supported by browser\");var u={};return d.width&&l.video.minWidth&&(u.width=l.video.minWidth),d.height&&l.video.minHeight&&(u.height=l.video.minHeight),d.frameRate&&l.video.fps&&(u.frameRate=l.video.fps),u},WebRTCDisplayConstraintsAdapter}();d.WebRTCDisplayConstraintsAdapter=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaStreamClient=void 0;var h=u(13),g=function(l){function MediaStreamClient(d,u,p){var h=l.call(this)||this;return h.mediaStream=d,h.logger=p,h.mediaStreamSubscriptions=[],h.isHold=!1,h.isMuted=h.mediaStream.getMuted(),h.isDisposed=!1,h.originalId=d.id,h.subscribeOnMediaStreamEvents(),h.update(u),h.logger.safe.info(\"ctor\"),h.mediaType=h.mediaStream.mediaType,h}return p(MediaStreamClient,l),Object.defineProperty(MediaStreamClient.prototype,\"id\",{get:function(){return this.originalId},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,\"parentId\",{get:function(){return this.originalId},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,\"rawStream\",{get:function(){return this.gumStream},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,\"rawTrack\",{get:function(){return this.getTrackByMediaType(this.rawStream,this.mediaType)},enumerable:!1,configurable:!0}),Object.defineProperty(MediaStreamClient.prototype,\"deviceId\",{get:function(){return this.mediaStream.deviceId},enumerable:!1,configurable:!0}),MediaStreamClient.prototype.update=function(l){l&&(this.gumStream=l,this.enableDisableTracks())},MediaStreamClient.prototype.dispose=function(){this.isDisposed?this.logger.safe.info(\"already disposed\"):(this.isDisposed=!0,this.logger.safe.info(\"dispose\"),this.logger=this.logger.createChild(\"DISPOSED\"),this.event(\"onStreamClientDisposing\").raise(this),this.mediaStream&&(this.mediaStream.disposeClient(this),this.unsubscribeFromMediaStreamEvents(),this.mediaStream=null),this.event(\"onStreamClientDisposed\").raise(this))},MediaStreamClient.prototype.clone=function(){var l=this.mediaStream.getClient();return this.isMuted&&l.setMuted(!0),this.isHold&&l.setHold(!0),l},MediaStreamClient.prototype.applyCapabilities=function(l){return this.mediaStream.applyCapabilities(l)},MediaStreamClient.prototype.setMuted=function(l,d){void 0===d&&(d=(0,h.generateCauseId)()),this.isMuted=l||this.mediaStream.getMuted(),this.logger.safe.info(\"[\".concat(d,\"] setMuted => \").concat(this.isMuted)),this.enableDisableTracks()},MediaStreamClient.prototype.setHold=function(l){this.isHold=l,this.enableDisableTracks()},MediaStreamClient.prototype.start=function(){return this.mediaStream.start()},MediaStreamClient.prototype.hasAudio=function(){return this.mediaStream.hasAudio()},MediaStreamClient.prototype.hasVideo=function(){return this.mediaStream.hasVideo()},MediaStreamClient.prototype.hasDisplay=function(){return this.mediaStream.hasDisplay()},MediaStreamClient.prototype.isSameStream=function(l){return this.parentId===l.parentId},MediaStreamClient.prototype.getResolution=function(){return this.mediaStream.getResolution()},MediaStreamClient.prototype.getFrameRate=function(){return this.mediaStream.getFrameRate()},MediaStreamClient.prototype.isActive=function(){return!0},MediaStreamClient.prototype.subscribeOnMediaStreamEvents=function(){var l=this;this.mediaStreamSubscriptions.push(this.mediaStream.on(\"onStreamStarted\",(function(d,u){l.event(\"onStreamClientStarted\").raise(l,u)}))),this.mediaStreamSubscriptions.push(this.mediaStream.on(\"onStreamError\",(function(d,u){l.event(\"onStreamClientError\").raise(l,u)}))),this.mediaStreamSubscriptions.push(this.mediaStream.on(\"onStreamTrackMuted\",(function(d,u){l.event(\"onStreamClientMuted\").raise(l,u)}))),this.mediaStreamSubscriptions.push(this.mediaStream.on(\"onStreamTrackEnded\",(function(d,u){l.event(\"onStreamClientEnded\").raise(l,u)})))},MediaStreamClient.prototype.unsubscribeFromMediaStreamEvents=function(){this.mediaStreamSubscriptions.forEach((function(l){return l.dispose()})),this.mediaStreamSubscriptions=[]},MediaStreamClient.prototype.enableDisableTracks=function(){var l=this;this.gumStream?this.gumStream.getTracks().forEach((function(d){void 0!==d.enabled&&(d.enabled=!l.isMuted&&!l.isHold,l.logger.safe.info(\"Track \".concat(JSON.stringify(d.id),\" enabled state set to => \").concat(d.enabled)))})):this.logger.safe.warn(\"gumStream stream doesn't exist\")},MediaStreamClient.prototype.getTrackByMediaType=function(l,d){return\"Audio\"===d?l.getAudioTracks()[0]:l.getVideoTracks()[0]},MediaStreamClient}(u(7).default);d.MediaStreamClient=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SimulcastMediaStream=void 0;var f=u(1),m=u(9),v=u(7),y=u(124),S=u(129),_=u(340),C=u(81),E=u(342),T=function(l){function SimulcastMediaStream(d,u,p,h,g,f){var m=l.call(this)||this;return m.serialQueue=u,m.configProvider=p,m.videoEffectManager=g,m.audioEffectManager=f,m.originalMediaStream=null,m.gumRequestTime=0,m.id=SimulcastMediaStream.streamId++,m.logger=h.createChild(\"MediaStream:\".concat(m.id)),m.mediaType=m.getMediaType(d),m.initialize(d),m}return p(SimulcastMediaStream,l),Object.defineProperty(SimulcastMediaStream.prototype,\"rawStream\",{get:function(){return this.mediaStream},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStream.prototype,\"deviceId\",{get:function(){var l,d,u,p;return this.originalMediaStream?null===(p=null===(u=null===(d=null===(l=this.originalMediaStream.getTracks())||void 0===l?void 0:l[0])||void 0===d?void 0:d.getSettings)||void 0===u?void 0:u.call(d))||void 0===p?void 0:p.deviceId:null},enumerable:!1,configurable:!0}),SimulcastMediaStream.prototype.start=function(){return this.mediaStreamStartPromise||(this.mediaStreamStartPromise=this.startStream(this.currentConstraints)),this.mediaStreamStartPromise},SimulcastMediaStream.prototype.dispose=function(d){var u=this;this.event(\"onStreamDisposing\").raise(this),this.stopMediaStream(d).catch((function(l){u.event(\"onStreamError\").raise(u,l)})).then((function(){u.constraintsProvider=null,u.serialQueue=null,u.configProvider=null,u.logger=u.logger.createChild(\"DISPOSED\"),u.clientGenerationStrategy.dispose(),u.event(\"onStreamDisposed\").raise(u),l.prototype.dispose.call(u)}))},SimulcastMediaStream.prototype.getClient=function(l){return this.logger.safe.debug(\"getClient: \".concat(l)),this.clientGenerationStrategy.getClient()},SimulcastMediaStream.prototype.getOriginalMediaStream=function(){return this.originalMediaStream},SimulcastMediaStream.prototype.disposeClient=function(l){this.clientGenerationStrategy.disposeClient(l)},SimulcastMediaStream.prototype.resetEffectOutputConstraints=function(l){this.currentConstraints.withEffect&&this.videoEffectManager.resetOutputConstraints(l)},SimulcastMediaStream.prototype.getResolution=function(){var l=this;if(![\"Video\",\"ScreenShare\",\"PanoramicVideo\"].some((function(d){return d===l.mediaType})))return null;var d={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},u=C.getResolutionForStream(this.mediaStream,d);return u===d?this.logger.safe.error(\"Stream resolution is not avalable, assuming we're at \".concat(d.width,\"x\").concat(d.height,\" now\")):this.logger.safe.info(\"Stream resolution is \".concat(u.width,\"x\").concat(u.height)),u},SimulcastMediaStream.prototype.getFrameRate=function(){var l=this;if(![\"Video\",\"ScreenShare\",\"PanoramicVideo\"].some((function(d){return d===l.mediaType})))return null;var d=C.getFrameRateForStream(this.mediaStream);return 0===d?this.logger.safe.error(\"Stream frame rate is not avalable, returning 0\"):this.logger.safe.info(\"Stream fps is \".concat(d)),d},SimulcastMediaStream.prototype.getMediaType=function(l){if(l.sharing)return\"ScreenShare\";if(l.video)return\"Video\";if(l.audio)return\"Audio\";throw new Error(\"Media type is not defined: \".concat(JSON.stringify(l)))},SimulcastMediaStream.prototype.initialize=function(l){var d=this;this.constraintsProvider=y.ConstraintsProviderFactory.getProvider(this.mediaType,this.configProvider,this.logger),this.currentConstraints=this.constraintsProvider.createConstraintsObject(l),this.gumStreamProvider=S.GumStreamProviderFactory.getStreamProvider(this.mediaType,this.configProvider,this.logger),this.mediaStreamRequestStrategy=E.RequestStrategyFactory.getStrategy(this.mediaType,this.gumStreamProvider,this.serialQueue,this.logger,this.configProvider),this.clientGenerationStrategy=new _.CloneClientGeneratorStrategy(this,this.currentConstraints,this.constraintsProvider,this.gumStreamProvider,this.logger),this.clientGenerationStrategy.on(\"onAllClientsDisposed\",(function(){return d.onAllClientsDisposed()}))},SimulcastMediaStream.prototype.onAllClientsDisposed=function(){this.logger.safe.info(\"All clients are disposed, disposing master stream\"),this.dispose()},SimulcastMediaStream.prototype.startStream=function(l){var d=this;return this.getOrCreateMediaStream(l).then((function(){d.event(\"onStreamStarted\").raise(d,d.currentConstraints)})).catch((function(l){throw d.event(\"onStreamError\").raise(d,l),l}))},SimulcastMediaStream.prototype.getOrCreateMediaStream=function(l){var d=this;if(this.mediaStream)return Promise.resolve();var u=this.getRequestStartTimestamp();return this.mediaStreamRequestStrategy.getStream(l).then((function(p){return d.gumRequestTime=d.getRequestDuration(u),d.handleMediaStreamRequestSuccess(p,l)}))},SimulcastMediaStream.prototype.handleMediaStreamRequestSuccess=function(l,d){return h(this,void 0,void 0,(function(){var u,p;return g(this,(function(h){switch(h.label){case 0:return this.logger.safe.info(\"Media stream acquired: \".concat((0,m.printMediaStream)(l),\" with constraints: \").concat(JSON.stringify((0,m.scrubConstraints)(d)))),this.originalMediaStream=l,this.subscribeToTrackEvents(this.originalMediaStream),u=this,d.withEffect?[4,this.getVideoEffectStream(l)]:[3,2];case 1:return p=h.sent(),[3,3];case 2:p=l,h.label=3;case 3:return u.mediaStream=p,\"Audio\"===this.mediaType?[4,this.startNoiseSuppression()]:[3,5];case 4:h.sent(),h.label=5;case 5:return this.currentConstraints=d,this.applyState(this.mediaStream),this.event(\"onStreamAcquired\").raise(this,this.gumRequestTime,\"Audio\"!==this.mediaType&&this.getResolution()||void 0),[2]}}))}))},SimulcastMediaStream.prototype.getVideoEffectStream=function(l){return h(this,void 0,void 0,(function(){var d,u=this;return g(this,(function(p){switch(p.label){case 0:return this.sub=this.videoEffectManager.on(\"onVideoStreamQualityChanged\",(function(l,d){return u.onVideoStreamQualityChanged(l,d)})),[4,this.videoEffectManager.setSourceAsync(l)];case 1:return d=p.sent(),this.logger.safe.info(\"Media stream switched: \".concat((0,m.printMediaStream)(l),\" -> \").concat((0,m.printMediaStream)(d))),[2,d]}}))}))},SimulcastMediaStream.prototype.subscribeToTrackEvents=function(l){var d=this,u=l?this.getTrackByMediaType(l,this.mediaType):null;u&&(u.onended=function(l){d.logger.safe.info(\"Track \".concat(u.id,\" ended: \").concat(JSON.stringify(l))),d.event(\"onStreamTrackEnded\").raise(d,l)},u.onmute=function(){d.logger.safe.info(\"Track \".concat(u.id,\" muted\")),d.event(\"onStreamTrackMuted\").raise(d,!0)},u.onunmute=function(){d.logger.safe.info(\"Track \".concat(u.id,\" unmute\")),d.event(\"onStreamTrackMuted\").raise(d,!1)})},SimulcastMediaStream.prototype.unsubscribeFromTrackEvents=function(l){var d=l?this.getTrackByMediaType(l,this.mediaType):null;d&&(d.onended=null,d.onmute=null,d.onunmute=null)},SimulcastMediaStream.prototype.getTrackByMediaType=function(l,d){return\"Audio\"===d?l.getAudioTracks()[0]:l.getVideoTracks()[0]},SimulcastMediaStream.prototype.removeVideoEffectStream=function(){var l;null===(l=this.sub)||void 0===l||l.dispose(),this.videoEffectManager.removeSourceAsync(this.mediaStream)},SimulcastMediaStream.prototype.applyState=function(l){var d=this;l.getAudioTracks().forEach((function(l){return d.applyAudioState(l)}));var u=l.getVideoTracks()[0];this.applyVideoState(u)},SimulcastMediaStream.prototype.applyAudioState=function(l){l&&(this.hasNonDefaultAudioProcessingConstraints()||\"ScreenShare\"===this.mediaType?this.applyContentHint(l,\"music\"):this.configProvider.config.defaultAudioContentHint&&this.applyContentHint(l,this.configProvider.config.defaultAudioContentHint),l.muted&&this.event(\"onStreamTrackMuted\").raise(this,!0),this.logger.safe.info(\"Audio track added: \".concat(JSON.stringify(l.id))))},SimulcastMediaStream.prototype.applyVideoState=function(l){l&&(\"ScreenShare\"===this.mediaType&&this.configProvider.config.webrtcDisplayStreamContentHint&&this.applyContentHint(l,this.configProvider.config.webrtcDisplayStreamContentHint),this.logger.safe.info(\"Video track added: \".concat(JSON.stringify(l.id))))},SimulcastMediaStream.prototype.applyContentHint=function(l,d){this.logger.safe.info(\"Apply content hint: \".concat(d)),l.contentHint=d},SimulcastMediaStream.prototype.hasNonDefaultAudioProcessingConstraints=function(){var l=this.currentConstraints.audio;if(l){var d=this.configProvider.config.defaultAudioProcessingFlags,u=void 0;return void 0===l.echoCancellation&&void 0===l.autoGainControl&&void 0===l.noiseSuppression||(u=0,void 0!==l.echoCancellation&&(u+=l.echoCancellation?2:0),void 0!==l.autoGainControl&&(u+=l.autoGainControl?1:0),void 0!==l.noiseSuppression&&(u+=l.noiseSuppression?4:0)),u!==d}return!1},SimulcastMediaStream.prototype.getRequestStartTimestamp=function(){return Date.now()},SimulcastMediaStream.prototype.getRequestDuration=function(l){return 0===l?0:Date.now()-l},SimulcastMediaStream.prototype.startNoiseSuppression=function(){return h(this,void 0,void 0,(function(){var l,d;return g(this,(function(u){switch(u.label){case 0:return this.logger.safe.info(\"ECS keys for wasmdns are: \".concat(JSON.stringify(this.configProvider.config.wasmdns),\", and audioEffectManager is \").concat(this.audioEffectManager?\"defined\":\"undefined\")),this.configProvider.config.wasmdns.enableNoiseSuppression&&this.audioEffectManager?(l=this.configProvider.mediaConfig.noiseSuppressionMode,this.logger.safe.info(\"Configuring the audio effect manager for Noise Suppression mode: \".concat(l)),\"Auto\"===l&&(l=this.configProvider.config.wasmdns.noiseSuppressionMode,this.logger.safe.info(\"Overriding 'Auto' with \".concat(l))),[4,this.audioEffectManager.configureEffect({audioContext:new AudioContext({latencyHint:\"interactive\"}),noiseSuppressionMode:l,pTime:this.configProvider.config.wasmdns.pTime,goodPerfThreshold:this.configProvider.config.wasmdns.goodPerfThreshold,poorPerfThreshold:this.configProvider.config.wasmdns.poorPerfThreshold,badPerfThreshold:this.configProvider.config.wasmdns.badPerfThreshold,perfWindowLength:this.configProvider.config.wasmdns.perfWindowLength,enableNoiseSuppression:this.configProvider.config.wasmdns.enableNoiseSuppression,backgroundMode:this.configProvider.config.wasmdns.backgroundMode})]):[3,3];case 1:return u.sent(),[4,this.audioEffectManager.setSourceAsync(this.mediaStream)];case 2:d=u.sent(),this.configProvider.config.wasmdns.backgroundMode?this.logger.safe.info(\"Noise suppression is running in the background.\"):this.mediaStream=d,u.label=3;case 3:return[2]}}))}))},SimulcastMediaStream.prototype.stopMediaStream=function(l){var d=this;return this.mediaStreamStartPromise?(this.logger.safe.info(\"Queueing media stream stop: \".concat(l)),this.serialQueue.add((function(){return d.stopMediaStreamInternal()}))):Promise.resolve()},SimulcastMediaStream.prototype.stopOneMediaStream=function(l){var d=this;try{l.getTracks().forEach((function(l){d.logger.safe.info(\"Track is stopped: \".concat(JSON.stringify(l.id))),l.stop()})),this.logger.safe.info(\"Media stream stopped: \".concat(l.id))}catch(l){this.logger.safe.warn(\"Failed to stop media stream: \".concat(f.stringifyObject(l)))}},SimulcastMediaStream.prototype.stopMediaStreamInternal=function(){var l;\"Video\"===this.mediaType&&this.configProvider.config.enableVideoEffects&&this.removeVideoEffectStream(),\"Audio\"===this.mediaType&&(null===(l=this.audioEffectManager)||void 0===l||l.dispose()),this.mediaStream&&(this.stopOneMediaStream(this.mediaStream),this.mediaStream=null),this.originalMediaStream&&(this.stopOneMediaStream(this.originalMediaStream),this.unsubscribeFromTrackEvents(this.originalMediaStream),this.originalMediaStream=null)},SimulcastMediaStream.prototype.onVideoStreamQualityChanged=function(l,d){this.logger.safe.debug(\"onStreamQualityChanged: \".concat(JSON.stringify(l),\"@\").concat(d)),this.event(\"onStreamQualityChanged\").raise(this,l,d)},SimulcastMediaStream.streamId=0,SimulcastMediaStream}(v.default);d.SimulcastMediaStream=T},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.CloneClientGeneratorStrategy=void 0;var h=u(7),g=u(341),f=u(9),m=function(l){function CloneClientGeneratorStrategy(d,u,p,h,g){var f=l.call(this)||this;return f.stream=d,f.constraints=u,f.constraintsProvider=p,f.gumStreamProvider=h,f.logger=g,f.clients=[],f.streams=[],f.clientId=0,f.mediaStreamSubscription=f.stream.on(\"onStreamAcquired\",(function(){return f.onStreamAcquired()})),f}return p(CloneClientGeneratorStrategy,l),CloneClientGeneratorStrategy.prototype.getClient=function(){var l=new g.SimulcastMediaStreamClient(this.clientId++,this.stream,this.constraints,this.constraintsProvider,this.gumStreamProvider,this.logger);return this.addClient(l),l},CloneClientGeneratorStrategy.prototype.disposeClient=function(l){this.removeClient(l),this.clients.length||this.event(\"onAllClientsDisposed\").raise()},CloneClientGeneratorStrategy.prototype.dispose=function(){var d=this;this.mediaStreamSubscription.dispose(),this.clients.length&&this.logger.safe.error(\"Not all clients are disposed! \".concat(JSON.stringify(this.clients.map((function(l){return l.id}))))),this.streams.forEach((function(l){return d.disposeStream(l)})),l.prototype.dispose.call(this)},CloneClientGeneratorStrategy.prototype.getOrCreateStream=function(){var l=this.streams.length?this.streams[this.streams.length-1]:this.stream.rawStream;if(!l)return null;var d=l.clone();return this.logger.safe.info(\"Cloned: \".concat(f.printMediaStream(l),\" -> \").concat(f.printMediaStream(d))),this.resetStream(d),this.streams.push(d),d},CloneClientGeneratorStrategy.prototype.addClient=function(l){this.updateClient(l),this.clients.push(l)},CloneClientGeneratorStrategy.prototype.updateClient=function(l){var d=this.getOrCreateStream();d&&l.update(d)},CloneClientGeneratorStrategy.prototype.removeClient=function(l){var d=this.clients.indexOf(l);this.clients.splice(d,1)},CloneClientGeneratorStrategy.prototype.addStream=function(){var l=this;this.clients.forEach((function(d){return l.updateClient(d)}))},CloneClientGeneratorStrategy.prototype.disposeStream=function(l){var d=this;l.getTracks().forEach((function(l){d.logger.safe.info(\"Stopping track: \".concat(JSON.stringify(l.id))),l.stop()}))},CloneClientGeneratorStrategy.prototype.onStreamAcquired=function(){this.addStream()},CloneClientGeneratorStrategy.prototype.resetStream=function(l){var d=this;l.getTracks().forEach((function(l){d.logger.safe.info(\"Resetting state for track: \".concat(l.id)),l.enabled=!0}))},CloneClientGeneratorStrategy}(h.default);d.CloneClientGeneratorStrategy=m},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SimulcastMediaStreamClient=void 0;var f=u(7),m=u(81),v=u(9),y=function(l){function SimulcastMediaStreamClient(d,u,p,h,g,f){var m=l.call(this)||this;return m.id=d,m.masterStream=u,m.currentConstraints=p,m.constraintsProvider=h,m.streamProvider=g,m.isDisposed=!1,m.masterStreamSubscriptions=[],m.mixerSubscriptions=[],m.parentId=u.id,m.logger=f.createChild(\"C:\".concat(m.parentId,\":\").concat(m.id)),m.subscribeOnMasterStreamEvents(),m}return p(SimulcastMediaStreamClient,l),Object.defineProperty(SimulcastMediaStreamClient.prototype,\"rawTrack\",{get:function(){return this.mediaTrack},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStreamClient.prototype,\"rawStream\",{get:function(){return this.rawMediaStream||(this.rawMediaStream=new MediaStream([this.mediaTrack])),this.rawMediaStream},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStreamClient.prototype,\"deviceId\",{get:function(){return this.masterStream.deviceId},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastMediaStreamClient.prototype,\"mediaType\",{get:function(){return this.masterStream.mediaType},enumerable:!1,configurable:!0}),SimulcastMediaStreamClient.prototype.dispose=function(d){this.isDisposed||(this.isDisposed=!0,this.logger.safe.info(\"dispose: \".concat(d)),this.logger=this.logger.createChild(\"DISPOSED\"),this.event(\"onStreamClientDisposing\").raise(this),this.mediaTrack&&(this.unsubscribeFromMediaTrackEvents(),this.mediaTrack=null),this.masterStream&&(this.unsubscribeFromMasterStreamEvents(),this.masterStream.disposeClient(this),this.masterStream=null),this.unsubscribeFromMixerTrackEvents(),l.prototype.dispose.call(this),this.event(\"onStreamClientDisposed\").raise(this))},SimulcastMediaStreamClient.prototype.applyCapabilities=function(l){return h(this,void 0,void 0,(function(){var d,u;return g(this,(function(p){switch(p.label){case 0:if(!this.mediaTrack)return[2,Promise.resolve(!1)];if(!(d=this.constraintsProvider.updateVideoConstraints(this.currentConstraints,l,this.getResolution()))||this.currentConstraints===d)return[2,Promise.resolve(!1)];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.applyConstraints(d)];case 2:return p.sent(),this.currentConstraints=d,this.masterStream.resetEffectOutputConstraints(d),[2,!0];case 3:throw u=p.sent(),this.logger.safe.error(\"Apply constraints error: \".concat(JSON.stringify(u))),u;case 4:return[2]}}))}))},SimulcastMediaStreamClient.prototype.start=function(){return this.masterStream.start()},SimulcastMediaStreamClient.prototype.clone=function(l){return this.masterStream.getClient(\"streamclient: \".concat(l))},SimulcastMediaStreamClient.prototype.setMuted=function(l,d){this.isMuted=l,this.applyState(d)},SimulcastMediaStreamClient.prototype.setHold=function(l,d){this.isHold=l,this.applyState(d)},SimulcastMediaStreamClient.prototype.isSameStream=function(l){return this.parentId===l.parentId},SimulcastMediaStreamClient.prototype.getResolution=function(){var l=this;if(![\"Video\",\"ScreenShare\",\"PanoramicVideo\"].some((function(d){return d===l.mediaType})))return null;var d={width:this.currentConstraints.video.minWidth,height:this.currentConstraints.video.minHeight},u=m.getResolutionForTrack(this.mediaTrack,d);return u===d?this.logger.safe.error(\"Stream resolution is not avalable, assuming we're at \".concat(d.width,\"x\").concat(d.height,\" now\")):this.logger.safe.info(\"Stream resolution is \".concat(u.width,\"x\").concat(u.height,\" for track \").concat(this.mediaTrack.id)),u},SimulcastMediaStreamClient.prototype.getFrameRate=function(){var l=this;if(![\"Video\",\"ScreenShare\",\"PanoramicVideo\"].some((function(d){return d===l.mediaType})))return null;var d=m.getFrameRateForTrack(this.mediaTrack);return 0===d?this.logger.safe.error(\"Stream frame rate is not avalable, returning 0\"):this.logger.safe.info(\"Stream fps is \".concat(d)),d},SimulcastMediaStreamClient.prototype.update=function(l){l?this.mediaTrack?this.logger.safe.error(\"Media track is already created: \".concat(this.mediaTrack.id)):(this.mediaTrack=this.getTrackByMediaType(l,this.mediaType),this.updateTrackConstraints(),this.subscribeOnMediaTrackEvents(this.mediaTrack),this.hasMasterAudio=l&&l.getAudioTracks().length>0,this.hasMasterVideo=l&&l.getVideoTracks().length>0,this.hasMasterAudio&&this.hasMasterVideo&&(this.rawMediaStream=l),this.logger.safe.info(\"Updated: \".concat(v.printMediaStream(l)))):this.logger.safe.error(\"No master media stream, skipping update\")},SimulcastMediaStreamClient.prototype.updateTrackConstraints=function(){return h(this,void 0,void 0,(function(){var l,d,u;return g(this,(function(p){switch(p.label){case 0:if(\"ScreenShare\"!==this.mediaType)return[2];if(!(l=this.masterStream.getResolution()))return[3,4];(d=this.currentConstraints.clone()).video.maxWidth=l.width,d.video.minWidth=l.width,d.video.maxHeight=l.height,d.video.minHeight=l.height,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.applyConstraints(d)];case 2:return p.sent(),this.currentConstraints=d,this.masterStream.resetEffectOutputConstraints(d),[3,4];case 3:return u=p.sent(),this.logger.safe.error(\"Apply constraints error: \".concat(JSON.stringify(u))),[3,4];case 4:return[2]}}))}))},SimulcastMediaStreamClient.prototype.getTrackByMediaType=function(l,d){return\"Audio\"===d?l.getAudioTracks()[0]:l.getVideoTracks()[0]},SimulcastMediaStreamClient.prototype.applyConstraints=function(l){return this.streamProvider.applyConstraintsForTrack(this.mediaTrack,l)},SimulcastMediaStreamClient.prototype.applyState=function(l){this.mediaTrack&&void 0!==this.mediaTrack.enabled&&(this.mediaTrack.enabled=!this.isMuted&&!this.isHold,this.logger.safe.info(\"[\".concat(l,\"] Track \").concat(JSON.stringify(this.mediaTrack.id),\" enabled state set to => \").concat(this.mediaTrack.enabled)))},SimulcastMediaStreamClient.prototype.subscribeOnMediaTrackEvents=function(l){var d=this;l.onended=function(u){d.logger.safe.info(\"Track \".concat(l.id,\" ended: \").concat(JSON.stringify(u))),d.event(\"onStreamClientEnded\").raise(d,u)},l.onmute=function(){d.logger.safe.info(\"Track \".concat(l.id,\" muted\")),d.event(\"onStreamClientMuted\").raise(d,!0)},l.onunmute=function(){d.logger.safe.info(\"Track \".concat(l.id,\" unmuted\")),d.event(\"onStreamClientMuted\").raise(d,!1)}},SimulcastMediaStreamClient.prototype.unsubscribeFromMediaTrackEvents=function(){this.mediaTrack.onended=null,this.mediaTrack.onmute=null,this.mediaTrack.onunmute=null},SimulcastMediaStreamClient.prototype.unsubscribeFromMixerTrackEvents=function(){this.mixerSubscriptions.forEach((function(l){return l.dispose()})),this.mixerSubscriptions=[]},SimulcastMediaStreamClient.prototype.subscribeOnMasterStreamEvents=function(){var l=this;this.masterStreamSubscriptions.push(this.masterStream.on(\"onStreamStarted\",(function(d,u){return l.event(\"onStreamClientStarted\").raise(l,u)})),this.masterStream.on(\"onStreamError\",(function(d,u){return l.event(\"onStreamClientError\").raise(l,u)})),this.masterStream.on(\"onStreamTrackMuted\",(function(d,u){return l.event(\"onStreamClientMuted\").raise(l,u)})),this.masterStream.on(\"onStreamDisposing\",(function(d){return l.dispose()})),this.masterStream.on(\"onStreamQualityChanged\",(function(d,u,p){return l.event(\"onStreamQualityChanged\").raise(l,u,p)})),this.masterStream.on(\"onStreamTrackEnded\",(function(d,u){return l.event(\"onStreamClientEnded\").raise(l,u)})))},SimulcastMediaStreamClient.prototype.unsubscribeFromMasterStreamEvents=function(){this.masterStreamSubscriptions.forEach((function(l){return l.dispose()})),this.masterStreamSubscriptions=[]},SimulcastMediaStreamClient.prototype.hasAudio=function(){return this.hasMasterAudio},SimulcastMediaStreamClient.prototype.hasVideo=function(){return this.hasMasterVideo},SimulcastMediaStreamClient.prototype.isActive=function(){var l,d,u;return(null===(l=this.mediaTrack)||void 0===l?void 0:l.enabled)&&!(null===(d=this.mediaTrack)||void 0===d?void 0:d.muted)&&\"live\"===(null===(u=this.mediaTrack)||void 0===u?void 0:u.readyState)},SimulcastMediaStreamClient}(f.default);d.SimulcastMediaStreamClient=y},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaStreamRequestStrategyBase=d.RequestStrategyFactory=void 0;var h=u(128),g=u(3),f=u(9),m=function(){function RequestStrategyFactory(){}return RequestStrategyFactory.getStrategy=function(l,d,u,p,h){return\"Video\"===l?new S(d,u,p,h):new y(d,u,p)},RequestStrategyFactory}();d.RequestStrategyFactory=m;var v=function(){function MediaStreamRequestStrategyBase(l,d,u){this.gumStreamProvider=l,this.serialQueue=d,this.logger=u}return MediaStreamRequestStrategyBase.prototype.getStream=function(l){var d=this;return this.logger.safe.info(\"Requesting stream with constraints: \".concat(JSON.stringify((0,f.scrubConstraints)(l)))),this.serialQueue.add((function(){return d.request(l)}))},MediaStreamRequestStrategyBase}();d.MediaStreamRequestStrategyBase=v;var y=function(l){function SimpleRequestStrategy(d,u,p){return l.call(this,d,u,p.createChild(\"SimpleStrat\"))||this}return p(SimpleRequestStrategy,l),SimpleRequestStrategy.prototype.request=function(l){return this.gumStreamProvider.getStream(l)},SimpleRequestStrategy}(v),S=function(l){function MultipleRequestStrategy(d,u,p,g){var f=l.call(this,d,u,p.createChild(\"MultStrat\"))||this;return f.policyGenerator=new h.RequestPolicyGenerator(g),f}return p(MultipleRequestStrategy,l),MultipleRequestStrategy.prototype.request=function(l){var d=this.policyGenerator.getPolicies(l);return this.makeRequests(d)},MultipleRequestStrategy.prototype.makeRequests=function(l){var d=this,u=l[0];return this.logger.safe.info(\"Requesting media stream with policy: \".concat(JSON.stringify(u))),this.makeRequestWithPolicy(u).catch((function(u){var p=l.slice(1);if(p.length&&g.default.MEDIA_ERROR.constraintNotSatisfiedError===u.type)return d.logger.safe.warn(\"Could not obtain constrained media stream, will attempt weaker policy\"),d.makeRequests(p);throw u}))},MultipleRequestStrategy.prototype.makeRequestWithPolicy=function(l){return this.gumStreamProvider.getStream(l)},MultipleRequestStrategy}(v)},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.DeviceEnumerator=void 0;var f=u(29),m=u(15),v=u(48),y=u(1),S=u(344),_=u(82),C=u(133),E=function(l){function DeviceEnumerator(d,u){var p=l.call(this)||this;return p.configProvider=d,p.logger=u,p.isInitialized=new f.SettablePromise,p.list=new C.ComposedDeviceList(p.configProvider,p.logger.createChild(\"DeviceList\")),p.selection=new S.DeviceSelection(p.list,p.configProvider,p.logger.createChild(\"DeviceSelection\")),p.window=m.default.window,p.currentPollingInterval=0,p.configProvider.userAgentConfig.on(\"isAudioOutputSelectionSupportedChanged\",(function(){return p.enumerateDevices()})),p.configProvider.on(\"configUpdated\",(function(){void 0!==p.configProvider.config.devices.pollingIntervalIdle&&null!==p.pollingTimer&&p.startDevicePolling(!0)})),p.configProvider.config.devices.pollingIntervalIdle&&p.configProvider.config.devices.idlePollingOnStart&&p.startDevicePolling(!0),p.subscribeForDeviceChangeEvent(),p}return p(DeviceEnumerator,l),Object.defineProperty(DeviceEnumerator.prototype,\"isPollingInProgress\",{get:function(){return!!this.pollingTimer},enumerable:!1,configurable:!0}),DeviceEnumerator.prototype.initialize=function(){var l=this;this.enumerateDevices().then((function(){return l.isInitialized.resolve()})).catch((function(d){return l.isInitialized.reject(d)}))},DeviceEnumerator.prototype.enumerateDevices=function(){var l;return h(this,void 0,void 0,(function(){return g(this,(function(d){if(!this.window.navigator||!this.window.navigator.mediaDevices||!this.window.navigator.mediaDevices.enumerateDevices)throw new Error(\"device enumeration unsupported\");return null!==(l=this.enumerateDevicesPromise)&&void 0!==l||(this.enumerateDevicesPromise=this.runEnumerateDevicesAsync()),[2,this.enumerateDevicesPromise]}))}))},DeviceEnumerator.prototype.startDevicePolling=function(l){var d=this,u=l?this.configProvider.config.devices.pollingIntervalIdle:this.configProvider.config.devices.pollingIntervalActive;if(this.currentPollingInterval!==u&&this.stopDevicePolling(!0),u&&!this.pollingTimer){var pollingTask=function(){return h(d,void 0,void 0,(function(){var l;return g(this,(function(d){switch(d.label){case 0:this.currentPollingInterval=u,this.logger.safe.debug(\"Polling devices\"),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.enumerateDevices()];case 2:return d.sent(),this.pollingTimer=this.window.setTimeout(pollingTask,u),[3,4];case 3:throw l=d.sent(),this.pollingTimer=null,l;case 4:return[2]}}))}))};this.logger.safe.info(\"starting \".concat(l?\"idle\":\"active\",\" device polling with interval \").concat(u,\"ms\")),pollingTask()}},DeviceEnumerator.prototype.stopDevicePolling=function(l){this.enumerateDevicesPromise=null,this.pollingTimer&&(this.logger.safe.info(\"stopping device polling\"),this.window.clearTimeout(this.pollingTimer),this.pollingTimer=null,!l&&this.configProvider.config.devices.pollingIntervalIdle&&this.startDevicePolling(!0))},DeviceEnumerator.prototype.dispose=function(){l.prototype.dispose.call(this),this.logger.safe.info(\"disposing\"),this.stopDevicePolling(!0),this.window.navigator.mediaDevices.ondevicechange=void 0},DeviceEnumerator.prototype.runEnumerateDevicesAsync=function(){return h(this,void 0,void 0,(function(){var l,d,u;return g(this,(function(p){switch(p.label){case 0:return p.trys.push([0,5,6,7]),this.configProvider.config.devices.enumerateDevicesTimeout?[4,v.timeout(this.window.navigator.mediaDevices.enumerateDevices(),this.configProvider.config.devices.enumerateDevicesTimeout,\"enumerateDevices\")]:[3,2];case 1:return d=p.sent(),[3,4];case 2:return[4,this.window.navigator.mediaDevices.enumerateDevices()];case 3:d=p.sent(),p.label=4;case 4:return l=d,this.list.updateDevices(l.map((function(l){return _.createDevice(l)}))),[3,7];case 5:throw u=p.sent(),this.logger.safe.warn(\"error with enumerating devices: \".concat(y.stringifyObject(u))),this.event(\"onDeviceEnumerationfailed\").raise(y.stringifyObject(u)),u;case 6:return this.enumerateDevicesPromise=null,[7];case 7:return[2]}}))}))},DeviceEnumerator.prototype.subscribeForDeviceChangeEvent=function(){var l=this;this.window.navigator.mediaDevices&&(this.window.navigator.mediaDevices.ondevicechange=function(){l.logger.safe.debug(\"enumerating due to ondevicechange callback\"),l.enumerateDevices().catch((function(d){l.logger.safe.error(\"unable to enumerate ondevicechange: \".concat(y.stringifyObject(d)))}))})},DeviceEnumerator}(u(7).default);d.DeviceEnumerator=E},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.DeviceSelection=void 0;var h=u(7),g=u(1),f=u(3),m=u(9),v=u(132),y=function(l){function DeviceSelection(d,u,p){var h=l.call(this)||this;return h.deviceList=d,h.configProvider=u,h.logger=p,h.userSelectedDevices={microphone:null,camera:null,speaker:null},h.currentlySelectedDevices={microphone:null,camera:null,speaker:null},h.deviceSelectionStrategies=new Map,h.deviceAutoSelection=new Map,h.deviceSelectionStrategies.set(f.default.MEDIA_DEVICE.microphone,(0,v.getDeviceSelectionStrategy)(v.SelectionType.Automatic)),h.deviceSelectionStrategies.set(f.default.MEDIA_DEVICE.camera,(0,v.getDeviceSelectionStrategy)(v.SelectionType.Automatic)),h.deviceSelectionStrategies.set(f.default.MEDIA_DEVICE.speaker,(0,v.getDeviceSelectionStrategy)(v.SelectionType.Automatic)),h.deviceAutoSelection.set(f.default.MEDIA_DEVICE.microphone,!0),h.deviceAutoSelection.set(f.default.MEDIA_DEVICE.camera,!0),h.deviceAutoSelection.set(f.default.MEDIA_DEVICE.speaker,!0),h.deviceList.on(\"onDevicesChanged\",(function(l){return h.onDevicesChanged(l)})),h.logger.safe.info(\"Initialized\"),h}return p(DeviceSelection,l),Object.defineProperty(DeviceSelection.prototype,\"selectedDevices\",{get:function(){return g.deepClone(this.currentlySelectedDevices)},enumerable:!1,configurable:!0}),DeviceSelection.prototype.selectDevices=function(l){var d=this,u=!1;if(g.forOwn(l,(function(l,p){d.deviceAutoSelection.set(p,!1);var h=d.getDeviceToSelect(p,d.deviceList.devices.filter((function(l){return l.type===p})),l);d.isSameDevice(d.currentlySelectedDevices[p],h)||(d.userSelectedDevices[p]=(null==h?void 0:h.guid)||d.userSelectedDevices[p],u=!0),d.currentlySelectedDevices[p]=h})),u){var p=g.values(this.currentlySelectedDevices).map((function(l){return JSON.stringify((0,m.scrubDevices)(l,d.configProvider.config.devices.piiSafeWords))}));this.logger.safe.info(\"Changed from public interface: \".concat(p)),this.event(\"onSelectedDevicesChanged\").raise(this.selectedDevices,!0)}},DeviceSelection.prototype.setCameraSelectionStrategy=function(l){this.deviceSelectionStrategies.set(f.default.MEDIA_DEVICE.camera,l)},DeviceSelection.prototype.getDeviceToSelect=function(l,d,u){var p,h=this,g=this.userSelectedDevices[l];if(u?p=d.find((function(l){return l.guid===u})):g&&(p=d.find((function(l){return l.guid===g}))),!p){var f=this.currentlySelectedDevices[l]&&d.find((function(d){return d.guid===h.currentlySelectedDevices[l].guid}));this.deviceAutoSelection.get(l)||!f||u?(!(p=this.deviceSelectionStrategies.get(l).getSelectedDevice(d))&&f&&(p=f),this.deviceAutoSelection.set(l,!0)):p=f}return p||d[0]},DeviceSelection.prototype.onDevicesChanged=function(l){var d=this,u=!1;if(Object.keys(this.currentlySelectedDevices).forEach((function(p){var h=l.filter((function(l){return l.type===p}));if(h.length>0){var g=d.getDeviceToSelect(p,h);d.isSameDevice(g,d.currentlySelectedDevices[p])||(d.currentlySelectedDevices[p]=g,u=!0)}else d.currentlySelectedDevices[p]&&(d.currentlySelectedDevices[p]=null,u=!0)})),u){var p=g.values(this.currentlySelectedDevices).map((function(l){return JSON.stringify((0,m.scrubDevices)(l,d.configProvider.config.devices.piiSafeWords))}));this.logger.safe.info(\"Changed due to device list change: \".concat(p)),this.event(\"onSelectedDevicesChanged\").raise(this.selectedDevices,!1)}},DeviceSelection.prototype.isSameDevice=function(l,d){return!l&&!d||l&&d&&l.guid===d.guid},DeviceSelection}(h.default);d.DeviceSelection=y},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.compilePrimitiveDeviceList=void 0;var h=u(19),g=u(17),f=u(1),m=u(3),v=u(82);function compilePrimitiveDeviceList(l,d,u,h,y){var S,_;void 0===y&&(y={str:\"\"}),y.str+=\"|input(\".concat(d.length,\")\");var C=[],E=[h.config.devices.blacklist[l],h.defaultConfig.devices.blacklist[l]],_loop_1=function(l){try{var u=new RegExp(l,\"i\");return C=d.filter((function(d){return l&&d.label.match(u)?(y.str+=\"|-blacklisted(\".concat(d.label,\")\"),!1):d.deviceId!==m.default.MEDIA_DEVICE.communicationsId||(y.str+=\"|-communications\",!1)})),\"break\"}catch(u){y.str+=\"|filterError('\".concat(l,\"', \").concat(f.stringifyObject(u),\")\"),C=d}};try{for(var T=p(E),b=T.next();!b.done;b=T.next()){if(\"break\"===_loop_1(b.value))break}}catch(l){S={error:l}}finally{try{b&&!b.done&&(_=T.return)&&_.call(T)}finally{if(S)throw S.error}}if(C.length){var I=deductDefaultDevice(u,C,y);if(I&&(I.isSystemDefault=!0,y.str+=\"|default(\".concat(g.scrubMriOrOmit(I.guid),\")\")),I&&I.deviceId!==m.default.MEDIA_DEVICE.defaultId&&C.length>1&&(C=C.filter((function(l){return l.deviceId!==m.default.MEDIA_DEVICE.defaultId||(y.str+=\"|-defaultId\",!1)}))),l===m.default.MEDIA_DEVICE.camera||I||(y.str+=\"|+syntheticDefault\",C.unshift(v.createDefaultDevice(l))),u.forEach((function(l){var d=C.find((function(d){return d.guid===l.guid}));d&&!d.label&&l.label&&(y.str+=\"|migrateLabel(\".concat(g.scrubMriOrOmit(d.guid),\")\"),d.label=l.label)})),l===m.default.MEDIA_DEVICE.speaker){var A=C.filter((function(l){return\"\"===l.label}));A.length>1&&A.length===C.length&&(C=I?[I]:[C[0]],y.str+=\"|-filteredEmptyLabels(\".concat(A.length,\")\"))}}return C}function deductDefaultDevice(l,d,u){if(1===d.length)return u.str+=\"|default:only\",d[0];var p=d.find((function(l){return l.isSystemDefault&&l.deviceId===m.default.MEDIA_DEVICE.defaultId}));if(p){var g=d.filter((function(l){return l!==p}));if(1===g.length)return u.str+=\"|default:firstNonDefault\",g[0];if(\"\"!==p.groupId){var v=g.filter((function(l){return l.groupId===p.groupId}));if(1===v.length)return u.str+=\"|default:groupId\",v[0]}var y=l.find((function(l){return l.isSystemDefault}));if(y){var S=g.find((function(l){return l.deviceId===y.deviceId}));if(S)return u.str+=\"|default:previousList\",S}var _=g.map((function(l){return l.label})),C=f.getMaxSubstring(p.label,_),E=g.find((function(l){return l.label===C}));if(E)return u.str+=\"|default:label\",E}else if(\"Edge\"!==(0,h.getBrowserInfo)().name)return u.str+=\"|default:noSynthetic\",d.find((function(l){return l.isSystemDefault}))||d[0];return u.str+=\"|default:anyOrNull\",d.find((function(l){return l.isSystemDefault}))||null}d.compilePrimitiveDeviceList=compilePrimitiveDeviceList},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))},g=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.compileAudioDeviceList=void 0;var f=u(17),m=u(1),v=u(82);function compileAudioDeviceList(l,d,u,g){void 0===u&&(u=.5),void 0===g&&(g={str:\"\"});var f=[];if(l.length&&d.length){var m=getGroupedPairs(l.filter((function(l){return\"\"!==l.groupId})),d.filter((function(l){return\"\"!==l.groupId})),g);m.length&&(f.push.apply(f,h([],p(m.map((function(l){return v.createCompositeAudioDevice(l.microphone,l.speaker,createCompositeDeviceLabel(l.microphone.label,l.speaker.label))}))),!1)),g.str+=\"|directMatched(\".concat(f.length,\")\"));var y=f.length;f.push.apply(f,h([],p(composeAudioDevicesFromLabels(l.filter((function(l){return!f.some((function(d){return d.micDeviceId===l.guid}))})),d.filter((function(l){return!f.some((function(d){return d.speakerDeviceId===l.guid}))})),u,g)),!1)),g.str+=\"|otherMatched(\".concat(f.length-y,\")\")}return f}function getGroupedPairs(l,d,u){var m,v,y,S;void 0===u&&(u={str:\"\"});var _=new Set;try{for(var C=g(h(h([],p(l),!1),p(d),!1)),E=C.next();!E.done;E=C.next()){var T=E.value;_.add(T.groupId)}}catch(l){m={error:l}}finally{try{E&&!E.done&&(v=C.return)&&v.call(C)}finally{if(m)throw m.error}}var b=[],_loop_1=function(p){var h=l.filter((function(l){return l.groupId===p})),g=d.filter((function(l){return l.groupId===p}));if(h&&g)if(1===h.length&&1===g.length)b.push({microphone:h[0],speaker:g[0]}),u.str+=\"|pairSimple(\".concat(f.scrubMriOrOmit(h[0].guid),\", \").concat(f.scrubMriOrOmit(g[0].guid),\")\");else if(h.length>1||g.length>1)for(var m=getMostSimilarPair(h,g);m;)u.str+=\"|pairComplex(\".concat(f.scrubMriOrOmit(m.microphone.guid),\", \").concat(f.scrubMriOrOmit(m.speaker.guid),\")\"),b.push(m),h=h.filter((function(l){return l!==m.microphone})),g=g.filter((function(l){return l!==m.speaker})),m=getMostSimilarPair(h,g)};try{for(var I=g(_.values()),A=I.next();!A.done;A=I.next()){_loop_1(A.value)}}catch(l){y={error:l}}finally{try{A&&!A.done&&(S=I.return)&&S.call(I)}finally{if(y)throw y.error}}return b}function getMostSimilarPair(l,d){var u,p,h,f,v=999,y=null;if(l.length>0&&d.length>0)try{for(var S=g(l),_=S.next();!_.done;_=S.next()){var C=_.value;try{for(var E=(h=void 0,g(d)),T=E.next();!T.done;T=E.next()){var b=T.value,I=m.levenshteinDistance(C.label,b.label);I<v&&(v=I,y={microphone:C,speaker:b})}}catch(l){h={error:l}}finally{try{T&&!T.done&&(f=E.return)&&f.call(E)}finally{if(h)throw h.error}}}}catch(l){u={error:l}}finally{try{_&&!_.done&&(p=S.return)&&p.call(S)}finally{if(u)throw u.error}}return y}function composeAudioDevicesFromLabels(l,d,u,p){var h=[];return l.length&&d.length?(l.forEach((function(l){var g=d.filter((function(d){return d.groupId===l.groupId}));if(g.length){var y=m.getLongestCommonContiguousSubstring(l.label,g[0].label).length,S=g.sort((function(d,u){var p=m.getLongestCommonContiguousSubstring(l.label,d.label),h=m.getLongestCommonContiguousSubstring(l.label,u.label);return p.length>y&&(y=p.length),h.length>y&&(y=h.length),h.length-p.length}));if(S.length){var _=y/l.label.length;_>u&&(h.push(v.createCompositeAudioDevice(l,S[0],createCompositeDeviceLabel(l.label,S[0].label))),p.str+=\"|lbl_matched(\".concat(f.scrubMriOrOmit(l.guid),\" & \").concat(f.scrubMriOrOmit(S[0].guid),\", \").concat(Math.round(1e4*_)/100,\"%)\"))}}else p.str+=\"|lbl_nocand(\".concat(f.scrubMriOrOmit(l.guid),\")\")})),h):h}function createCompositeDeviceLabel(l,d){if(l===d)return l;var u=m.getLongestCommonContiguousSubstring(l,d);u=u.trim().replace(/^\\((.+)\\)$/,\"$1\");var p=\"\",h=\"\",g=0,f=[countBraces(l),countBraces(d)];if(0===f[0]||0===f[1])return u;for(var v=0;v<u.length;v++)if(\"(\"===u[v])g++,h+=u[v];else if(\")\"===u[v]){if(!(g>0))break;g--,p+=h+=u[v],h=\"\"}else g>0?h+=u[v]:p+=u[v];var y=countBraces(p);return y!==f[0]&&y!==f[1]||(p=createCompositeDeviceLabel(u,p=p.replace(/\\w+\\s?\\((.+)\\)/,\"$1\"))),p.trim()}function countBraces(l){for(var d=[\"(\",\")\"],u=0,_loop_2=function(p){d.some((function(d){return l[p]===d}))&&u++},p=0;p<l.length;p++)_loop_2(p);return u}d.compileAudioDeviceList=compileAudioDeviceList},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.DevicesHandle=void 0;var h=u(28),g=u(7),f=u(1),m=function(l){function DevicesHandle(d,u){var p=l.call(this)||this;return p.logger=d,p.mediaStream=u,p.subs=[],p.subscribeOnMediaStreamEvents(u),p}return p(DevicesHandle,l),DevicesHandle.prototype.acquire=function(){var l=this;return this.mediaStream?this.mediaStream.start().then((function(){return l.logger.safe.info(\"Stream acquired\")})).catch((function(d){throw l.logger.safe.warn(\"Failed to acquire the stream: \".concat(f.stringifyObject(d))),d})):Promise.reject(\"Disposed\")},DevicesHandle.prototype.dispose=function(){this.logger.safe.info(\"Disposing stream\"),this.unsubscribeFromMediaStreamEvents(),this.mediaStream&&(this.mediaStream.dispose(),this.mediaStream=null)},DevicesHandle.prototype.subscribeOnMediaStreamEvents=function(l){var d=this;this.subs=[l.on(\"onStreamClientStarted\",(function(){return d.event(\"onStreamStateChanged\").raise(\"active\")})),l.on(\"onStreamClientMuted\",(function(l,u){return d.event(\"onStreamStateChanged\").raise(u?\"inactive\":\"active\")})),l.on(\"onStreamClientEnded\",(function(){return d.event(\"onStreamStateChanged\").raise(\"stopped\")})),l.on(\"onStreamClientError\",(function(l,u){var p=u.type===h.Constants.MEDIA_ERROR.permissionDeniedError||u.type===h.Constants.MEDIA_ERROR.sharingCancelledError;d.event(\"onStreamStateChanged\").raise(p?\"cancelled\":\"failed\")}))]},DevicesHandle.prototype.unsubscribeFromMediaStreamEvents=function(){this.subs.forEach((function(l){return l.dispose()})),this.subs=[]},DevicesHandle}(g.default);d.DevicesHandle=m},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},g=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},f=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var m=u(8),v=u(19),y=u(349),S=u(350),_=u(351),C=u(353),E=u(1),T=u(3),b=u(9),I=u(357),A=u(378),R=u(380),P=u(422),O=function(){function MediaAgent(l,d,u,p,h,g,f){var m=this;this.logger=l,this.context=d,this.configProvider=u,this.diagnostics=p,this.ufdManager=h,this.deviceManager=g,this.capabilities=f,this.activeSessions=[],this.pendingDeviceTelemetryEvents=[],this.pendingVideoEffectsTelemetryEvents=[],this.pendingAudioEffectsTelemetryEvents=[],this.callsCount=0,this.mediaConfig={},this.configProvider.on(\"configUpdated\",(function(){return m.configApplied()})),this.deviceManager.on(\"onDeviceTelemetryEvent\",(function(l){return m.onDeviceTelemetryEvent(l)})),this.deviceManager.on(\"onVideoEffectsTelemetryEvent\",(function(l){return m.onVideoEffectsTelemetryEvent(l)})),this.deviceManager.on(\"onAudioEffectsTelemetryEvent\",(function(l){return m.onAudioEffectsTelemetryEvent(l)}))}return MediaAgent.prototype.createSession=function(l,d,u){var p=this;this.configProvider.setMediaConfiguration(this.mediaConfig);var h=this.configProvider.getConfigView(u&&u.isConference),g=this.logger,f=this.diagnostics.newSession(h,d,this.logger.createChild(\"sessionDiagnostics\")),m={getDeviceManager:function(){return p.getDeviceManager()},getLogger:function(){return g},getUfdManager:function(){return p.ufdManager},maContext:this.context,config:null!=u?u:{},configProvider:h,diagnostics:f.newNativeSessionDiag()},S=(\"Edge\"===(0,v.getBrowserInfo)().name?I.default:h.mediaConfig.simulcastSessionEnabled?P.default:R.default).build(m,d,l),E=new A.default(h,++this.callsCount);E.setMediaQosEnabled(!!this.mediaConfig.enableMediaQoS),E.setPortRangeConfigured(!!this.mediaConfig.mediaPortRanges);var T=function(){if(\"Edge\"!==(0,v.getBrowserInfo)().name){var u=new C.default(S,d,m,l,E,p.configProvider,f);return u.on(\"onTerminated\",(function(l){return p.onSessionTerminated(l)})),u}var h=new _.default(S,d,m,l,E,p.configProvider);return h.on(\"onTerminated\",(function(l){return p.onSessionTerminated(l)})),h}();for(this.activeSessions.push(T),this.configProvider.updateSessionCount(this.activeSessions.length),this.webRtcInternalsCollector=y.default.getInstance(this.logger,h),this.webRtcInternalsCollector.updateSessionCount(this.activeSessions.length);this.pendingDeviceTelemetryEvents.length>0;)T.registerDeviceTelemetryEvent(this.pendingDeviceTelemetryEvents.pop());for(;this.pendingVideoEffectsTelemetryEvents.length>0;)T.registerVideoEffectsTelemetryEvent(this.pendingVideoEffectsTelemetryEvents.pop());for(;this.pendingAudioEffectsTelemetryEvents.length>0;)T.registerAudioEffectsTelemetryEvent(this.pendingAudioEffectsTelemetryEvents.pop());return T},MediaAgent.prototype.getDeviceManager=function(){return this.deviceManager},MediaAgent.prototype.getCapabilities=function(){return this.capabilities},MediaAgent.prototype.getScreenSharingManager=function(){return new S.ScreenSharingManager},MediaAgent.prototype.updateConfig=function(l,d,u,p){this.configProvider.updateConfig(l,d,u,p)},MediaAgent.prototype.getConfig=function(){return this.configProvider.config},MediaAgent.prototype.getConfigProvider=function(){return this.configProvider},MediaAgent.prototype.setMediaConfig=function(l){m.merge(this.mediaConfig,l),this.diagnostics.mediaConfig=this.mediaConfig},MediaAgent.prototype.getMediaLogs=function(){return this.webRtcInternalsCollector?this.webRtcInternalsCollector.collect():Promise.resolve(\"\")},MediaAgent.prototype.dispose=function(l){var d=this;return Promise.all(f([this.deviceManager.dispose(),this.capabilities.dispose()],g(this.activeSessions.map((function(u){return p(d,void 0,void 0,(function(){return h(this,(function(d){switch(d.label){case 0:return[4,u.terminate(l,{}).catch((function(){}))];case 1:return d.sent(),u.dispose(),[2]}}))}))}))),!1)).then((function(){}),(function(){}))},MediaAgent.prototype.configApplied=function(){window&&(this.configProvider.config.enableDevtoolsAPI?window.webMA||this.injectDevtoolsAPI():window.webMA&&delete window.webMA)},MediaAgent.prototype.injectDevtoolsAPI=function(){var l=this;window.webMA={config:{addOverride:function(d,u){return l.configProvider.setConsoleOverride(d,u)},setOverrides:function(d){return l.configProvider.setConsoleOverrides(d)},clearOverride:function(d){return l.configProvider.clearConsoleOverride(d)},clearAllOverrides:function(){return l.configProvider.clearAllConsoleOverrides()}},diagnosticsReport:this.diagnostics.reportGenerator,deviceManager:{setAudioProcessingFlags:function(d){return l.deviceManager.setAudioProcessingFlags(d)}}}},MediaAgent.prototype.onDeviceTelemetryEvent=function(l){this.activeSessions.length>0?this.activeSessions.forEach((function(d){return d.registerDeviceTelemetryEvent(l)})):this.pendingDeviceTelemetryEvents.push(l)},MediaAgent.prototype.onVideoEffectsTelemetryEvent=function(l){this.activeSessions.length>0?this.activeSessions.forEach((function(d){return d.registerVideoEffectsTelemetryEvent(l)})):this.pendingVideoEffectsTelemetryEvents.push(l)},MediaAgent.prototype.onAudioEffectsTelemetryEvent=function(l){this.activeSessions.length>0?this.activeSessions.forEach((function(d){return d.registerAudioEffectsTelemetryEvent(l)})):this.pendingAudioEffectsTelemetryEvents.push(l)},MediaAgent.prototype.onSessionTerminated=function(l){E.remove(this.activeSessions,(function(d){return d===l})),this.configProvider.updateSessionCount(this.activeSessions.length),this.webRtcInternalsCollector.updateSessionCount(this.activeSessions.length),0===this.activeSessions.length&&this.ufdManager.reset()},MediaAgent}(),M=function(){function MediaAgentFactory(){}return MediaAgentFactory.build=function(l,d,u,p,h,g,f){return new O(l,d,u,p,h,g,f)},MediaAgentFactory.constants=T.default,MediaAgentFactory.helper=b,MediaAgentFactory}();d.default=M},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRtcInternalsCollector=void 0;var g=u(19),f=function(){function WebRtcInternalsCollector(l){this.extensionId=\"nkeimhogjdpnpccoofpliimaahmaaome\",this.editorExtensionId=\"ncbjelpjchkpbikbpkcchkhkblodoama\",this.logId=\"WebRTCLogs\",this.connectionCount=0,this.logger=l.createChild(\"WebRtcInternals\")}return WebRtcInternalsCollector.prototype.updateSessionCount=function(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){switch(d.label){case 0:return[4,this.isExtensionAvailable()];case 1:return d.sent()?0!==this.connectionCount||1!==l?[3,3]:[4,this.startLogging()]:[2];case 2:return d.sent(),[3,5];case 3:return 0!==l?[3,5]:[4,this.stopLogging()];case 4:d.sent(),d.label=5;case 5:return this.connectionCount=l,[2]}}))}))},WebRtcInternalsCollector.prototype.collect=function(){return p(this,void 0,void 0,(function(){var l=this;return h(this,(function(d){switch(d.label){case 0:return[4,this.isExtensionAvailable()];case 1:return d.sent()?this.collectPromise?[2,this.collectPromise]:[2,this.collectPromise=new Promise((function(d){return p(l,void 0,void 0,(function(){var l,u;return h(this,(function(p){switch(p.label){case 0:return p.trys.push([0,5,,6]),this.connectionCount>0?(this.logger.safe.info(\"Stopping logger for gathering, open connections: \".concat(this.connectionCount)),[4,this.stopLogging()]):[3,2];case 1:p.sent(),p.label=2;case 2:return[4,this.storeLogs()];case 3:return p.sent(),[4,this.gatherFromStorage()];case 4:return l=p.sent(),this.connectionCount>0&&this.startLogging(),d(l.length>0?l.join(\"\\r\\n\"):\"\"),[3,6];case 5:return u=p.sent(),this.logger.safe.error(\"Error while collecting logs\",u),d(JSON.stringify(u)),[3,6];case 6:return this.collectPromise=void 0,[2]}}))}))}))]:[2,\"\"]}}))}))},WebRtcInternalsCollector.prototype.isExtensionAvailable=function(){return p(this,void 0,void 0,(function(){var l;return h(this,(function(d){switch(d.label){case 0:if(void 0!==this.isAvailable)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.sendMessage(this.extensionId,{method:\"isExtensionEnabled\"})];case 2:return d.sent(),this.isAvailable=!0,[3,4];case 3:return l=d.sent(),this.logger.safe.warn(\"Extension cannot be accessed\",l),this.isAvailable=!1,[3,4];case 4:return[2,this.isAvailable]}}))}))},WebRtcInternalsCollector.prototype.startLogging=function(){return p(this,void 0,void 0,(function(){var l;return h(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this.sendMessage(this.extensionId,{method:\"logging.start\"})];case 1:return d.sent(),this.logger.safe.info(\"Logging started\"),[3,3];case 2:return l=d.sent(),this.logger.safe.error(\"Error while starting logging\",l),[3,3];case 3:return[2]}}))}))},WebRtcInternalsCollector.prototype.stopLogging=function(){return p(this,void 0,void 0,(function(){var l;return h(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this.sendMessage(this.extensionId,{method:\"logging.stop\"})];case 1:return d.sent(),this.logger.safe.info(\"Logging stopped\"),[3,3];case 2:return l=d.sent(),this.logger.safe.error(\"Error while stopping logging\",l),[3,3];case 3:return[2]}}))}))},WebRtcInternalsCollector.prototype.storeLogs=function(){return p(this,void 0,void 0,(function(){var l;return h(this,(function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,this.sendMessage(this.extensionId,{method:\"logging.store\",logId:this.logId})];case 1:return d.sent(),this.logger.safe.info(\"Logs stored to \".concat(this.logId)),[3,3];case 2:return l=d.sent(),this.logger.safe.error(\"Error while storing logs\",l),[3,3];case 3:return[2]}}))}))},WebRtcInternalsCollector.prototype.gatherFromStorage=function(){return p(this,void 0,void 0,(function(){var l,d;return h(this,(function(u){switch(u.label){case 0:l=[],d={offset:0},u.label=1;case 1:return[4,this.sendMessage(this.editorExtensionId,{api:\"getWebRtcLog\",logId:this.logId,offset:d.offset})];case 2:d=u.sent(),l.push(d.data),this.logger.safe.info(\"Batch gathered with offset: \".concat(d.offset,\", moreData: \").concat(d.moreData)),u.label=3;case 3:if(d.moreData)return[3,1];u.label=4;case 4:return this.logger.safe.info(\"Finished gathering\"),[2,l]}}))}))},WebRtcInternalsCollector.prototype.sendMessage=function(l,d){return new Promise((function(u,p){var h=chrome.runtime;h.sendMessage(l,d,(function(l){if(!l||l&&l.error){var g=l?JSON.stringify(l.error):h.lastError;p(\"sendMessage \".concat(JSON.stringify(d),\" failed with error: \").concat(g))}u(l)}))}))},WebRtcInternalsCollector}();d.WebRtcInternalsCollector=f;var m=function(){var l;function getInstance(d,u){return u&&u.config.enableWebRtcInternalsLogs&&\"EdgeAnaheim\"===(0,g.getBrowserInfo)().name?(l||(l=new f(d)),l):(d.safe.info(\"WebRTC internal logging is disabled\"),{collect:function(){return Promise.resolve(\"\")},updateSessionCount:function(){return Promise.resolve()}})}return{getInstance:getInstance}}();d.default=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ScreenSharingManager=void 0;var p=function(){function SyntheticSharingSource(){}return SyntheticSharingSource.prototype.getId=function(){return 0},SyntheticSharingSource.prototype.getDeviceId=function(){return String(0)},SyntheticSharingSource.prototype.getPreviewAsync=function(l,d){return Promise.resolve(null)},SyntheticSharingSource.prototype.getDescription=function(){return\"display\"},SyntheticSharingSource.prototype.getType=function(){return 1},SyntheticSharingSource.prototype.getIcon=function(l,d){return Promise.resolve(null)},SyntheticSharingSource}(),h=function(){function ScreenSharingManager(){this.sharingSource=new p}return ScreenSharingManager.prototype.onScreensChanged=function(l){return{dispose:function(){}}},ScreenSharingManager.prototype.enumerateScreensAsync=function(){return Promise.resolve([this.sharingSource])},ScreenSharingManager.prototype.enumerateWindowsAsync=function(){return Promise.resolve([])},ScreenSharingManager.prototype.enumerateCamerasAsync=function(){return Promise.resolve([])},ScreenSharingManager}();d.ScreenSharingManager=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0});var m=u(13),v=u(28),y=u(134),S=u(135),_=u(7),C=u(352),E=u(137),T=u(138),b=u(1),I=function(l){function Session(d,u,p,h,g,f){var m,S=l.call(this)||this;S.context=p,S.callback=h,S.statistics=g,S.configProvider=f,S.audioStreamStates=((m={})[v.Constants.STREAMING_STATE.inactive]=[v.Constants.STREAMING_STATE.active,v.Constants.STREAMING_STATE.failed],m[v.Constants.STREAMING_STATE.active]=[v.Constants.STREAMING_STATE.removed,v.Constants.STREAMING_STATE.stopped,v.Constants.STREAMING_STATE.failed],m),S.rejectedNegotiations=0,S.negotiationState=null,S.iceDisconnectedRetried=!1,S.audioStreamState=v.Constants.STREAMING_STATE.inactive,S.deviceManagerDisposables=[],S.logger=p.getLogger().createChild(\"Session\",u),S.ufdManager=p.getUfdManager(),S.ufdManagerDisposable=S.ufdManager.on(\"onQualityChanged\",(function(l){return S.qualityChanged(l)})),S.mediaLegId=new y.default,S.sessionOperationQueue=new T.default(S.logger),S.statistics.setId(u),S.statistics.setETag(S.configProvider.ETag),S.recoverableErrors=S.configProvider.config.recoverableMediaErrors.split(\",\"),p.config.isConference&&S.statistics.setMultiParty();var _=S.getSessionCallbacks();d.callbacks=_,d.relayManagerProvider=S;var E=S.getReconnectManagerCallbacks();return S.reconnectManager=new C.default(d,p,S.statistics,S.sessionOperationQueue,E,_,S.configProvider),S.deviceManager=S.context.getDeviceManager(),S.deviceManagerDisposables.push(S.deviceManager.on(\"onDevicesPermissionChanged\",(function(){return S.devicePermissionsChanged()}))),S.deviceManagerDisposables.push(S.deviceManager.on(\"onSelectedDevicesChanged\",(function(){return S.deviceSelectionChanged()}))),S.deviceManagerDisposables.push(S.deviceManager.on(\"onDevicesChanged\",(function(){return S.deviceListChanged()}))),S.deviceManagerDisposables.push(S.deviceManager.on(\"onMaxVideoSendCapabilitiesChanged\",(function(l,d){return S.onMaxVideoSendCapabilitiesChanged(l,d)}))),S.statistics.setDevicesCount(S.deviceManager.getDevicesCount()),S.ufdManager.applyCurrentState((function(l){return S.qualityChanged(l)})),S}return p(Session,l),Session.prototype.useNullAudioStreamClient=function(){this.logger.safe.info(\"useNullAudioStreamClient is not implemented yet\")},Session.prototype.setRawInputAudioStreamTrack=function(l){this.logger.safe.info(\"setRawInputAudioStream is not implemented yet\")},Session.prototype.getRawOutputAudioStream=function(){return this.logger.safe.info(\"getRawOutputAudioStream is not implemented yet\"),null},Session.prototype.enableRealTimeTelemetry=function(){this.logger.safe.info(\"enableRealTimeTelemetry is not implemented yet\")},Session.prototype.createOfferAsync=function(l){var d=this;return this.sessionOperationQueue.queueOperation((function(){return d.statistics.negotiation.offering.started(),d.getCurrentSession().createOfferAsync(l).then((function(l){return d.updateSelectedDevices(),l.mediaLegId=d.mediaLegId.process(l.mediaLegId),d.reconnectManager.isReconnecting()&&(d.statistics.registerRetargetOutgoing(),l.newOffer=!0),l})).catch((function(l){throw d.statistics.setError(l),l}))}),l).then((function(l){return l}))},Session.prototype.processOfferAsync=function(l,d){var u=this;return this.sessionOperationQueue.queueOperation((function(){return u.statistics.negotiation.answering.started(),u.mediaLegId.process(l.mediaLegId),(l.newOffer?u.reconnectManager.acceptReconnectStartAsync(l.escalationOccurring,d):Promise.resolve()).then((function(){return u.getCurrentSession().processOfferAsync(l,d)})).then((function(p){return l.newOffer?u.reconnectManager.acceptReconnectFinish(d).then((function(){return p})):Promise.resolve(p)})).catch((function(l){throw u.statistics.setError(l),l}))}),d)},Session.prototype.processAnswerAsync=function(l,d,u){var p=this;return new Promise((function(h){return h(p.getCurrentSession().processAnswerAsync(l,d,u))})).catch((function(l){throw p.statistics.setError(l),l}))},Session.prototype.completeNegotiationAsync=function(l){var d=this;return this.rejectedNegotiations=0,this.getCurrentSession().completeNegotiationAsync(l).then((function(u){return d.negotiationState=u,d.statistics.setFinalAnswerTimestamp((new Date).getTime()),d.statistics.negotiation.current.completed(),d.reconnectManager.onNegotiationCompletedAsync(l)})).then((function(){return d.sessionOperationQueue.completeCurrentOperation(),d.negotiationState})).catch((function(l){throw d.statistics.setError(l),l}))},Session.prototype.registerReconnectRejection=function(){this.rejectedNegotiations++,this.statistics.negotiation.current.rejected()},Session.prototype.isReconnectRetryAllowed=function(){return this.rejectedNegotiations<this.context.configProvider.config.renegotiationAttempts},Session.prototype.rejectNegotiationAsync=function(l,d){var u=this;this.logger.safe.info(\"[\".concat(d,\"] rejectNegotiationAsync\"),l),this.registerReconnectRejection();var p=this.isReconnectRetryAllowed()&&this.isRetriableError(l.type);return this.reconnectManager.reset(),(this.reconnectManager.isReconnecting()?this.reconnectManager.onNegotiationRejectedAsync(l,p,d).then((function(){return u.negotiationState})):this.getCurrentSession().rejectNegotiationAsync(l,d,p)).then((function(l){return u.negotiationState=l,u.sessionOperationQueue.completeCurrentOperation(),l})).catch((function(l){throw u.statistics.setError(l),l}))},Session.prototype.completeEscalationAsync=function(l){return this.reconnectManager.completeReconnect(l)},Session.prototype.rejectEscalationAsync=function(l,d){return this.reconnectManager.rejectReconnect(d)},Session.prototype.terminate=function(l,d){return h(this,void 0,void 0,(function(){var u,p,h,f=this;return g(this,(function(g){switch(g.label){case 0:return p=(u=this.statistics).setPermissionStates,[4,this.deviceManager.getKnownPermissionStates()];case 1:return p.apply(u,[g.sent()]),this.statistics.terminated(d),h=function(){return f.cleanUp()},[2,this.reconnectManager.terminateAsync(l).then(h,h)]}}))}))},Session.prototype.getStatsAsync=function(l){var d=this;return this.getMainSession().getStatsAsync(l).then((function(l){return d.prepareStats(l)}))},Session.prototype.getLastKnownStats=function(l){return void 0===l&&(l=!1),this.prepareStats(this.getMainSession().getLastKnownStats(l),l)},Session.prototype.prepareStats=function(l,d){return void 0===d&&(d=!1),this.statistics.setDeviceList(this.deviceManager.getDeviceDescriptions(),this.deviceManager.getDeviceListDebugInfo()),this.statistics.setRelayManagerTimers(this.getRelayManager().getStats()),this.statistics.setVideoEffectStats(this.deviceManager.videoEffectManager.getStats()),this.statistics.setAudioEffectStats(this.deviceManager.audioEffectManager.getStats()),this.statistics.generateStatistics(l,this.mediaLegId,d)},Session.prototype.createAnswerAsync=function(l,d){var u=this;return this.getCurrentSession().createAnswerAsync(l,d).then((function(l){return u.updateSelectedDevices(),l.mediaLegId=u.mediaLegId.process(l.mediaLegId),l})).catch((function(l){throw u.statistics.setError(l),l}))},Session.prototype.configureModalitiesAsync=function(l,d){return b.forOwn(l,(function(d,u){d||delete l[u]})),this.reconnectManager.configureModalitiesAsync(l,d)},Session.prototype.getAllowedModalities=function(){return this.deviceManager.getAllowedModalities()},Session.prototype.createRemoteRenderer=function(l){return this.getMainSession().createRemoteRenderer(l)},Session.prototype.sendDtmf=function(l){var d=this;return this.getMainSession().sendDtmf(l).then((function(l){return d.statistics.dtmfResult(!0),l})).catch((function(l){throw d.statistics.dtmfResult(!1),l}))},Session.prototype.canSendDtmf=function(){return this.reconnectManager.canSendDtmf()},Session.prototype.getExtensionsManager=function(){return this.reconnectManager.getExtensionsManager()},Session.prototype.muteHold=function(l,d){this.reconnectManager.muteHold(l,d)},Session.prototype.muteInputAsync=function(l){return this.statistics.setSwMute(!0),this.ufdManager.setSwMute(!0),this.reconnectManager.muteInputAsync(l)},Session.prototype.unmuteInputAsync=function(l){return this.statistics.setSwMute(!1),this.ufdManager.setSwMute(!1),this.reconnectManager.unmuteInputAsync(l)},Session.prototype.muteOutputAsync=function(l){return this.statistics.setSpeakerMute(!0),this.reconnectManager.muteOutputAsync(l)},Session.prototype.unmuteOutputAsync=function(l){return this.statistics.setSpeakerMute(!1),this.reconnectManager.unmuteOutputAsync(l)},Session.prototype.getAcceptedTypes=function(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()},Session.prototype.createAudioElement=function(l){this.getCurrentSession().createAudioElement(l)},Session.prototype.deviceSelectionChanged=function(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()},Session.prototype.deviceListChanged=function(){this.deviceManager.isPollingInProgress&&this.statistics.deviceChangedByPoll(),this.statistics.devicesChanged(),this.statistics.setDevicesCount(this.deviceManager.getDevicesCount())},Session.prototype.qualityChanged=function(l){this.callback&&this.callback.onQualityChanged&&(this.statistics.registerQualityStateChangedEvent(l),\"DeviceSpeakWhileMuted\"===l.type&&this.statistics.setSpeakingState(\"Good\"===l.value),this.callback.onQualityChanged(l))},Session.prototype.onMaxVideoSendCapabilitiesChanged=function(l,d){this.reconnectManager.getCurrentSession().onMaxVideoSendCapabilitiesChanged(l,d)},Session.prototype.devicePermissionsChanged=function(){this.statistics.setSendModalities(this.getAllowedModalities())},Session.prototype.registerDeviceTelemetryEvent=function(l){this.getCurrentSession().onDeviceEvent(l),this.statistics.registerDeviceTelemetryEvent(l)},Session.prototype.registerVideoEffectsTelemetryEvent=function(l){this.statistics.registerVideoEffectsTelemetryEvent(l)},Session.prototype.registerAudioEffectsTelemetryEvent=function(l){this.statistics.registerAudioEffectsTelemetryEvent(l)},Session.prototype.reconnectAsync=function(l,d){return void 0===d&&(d=!1),this.reconnectManager.reconnectAsync(l,d)},Session.prototype.isReconnecting=function(){return this.reconnectManager.isReconnecting()},Session.prototype.getRelayManager=function(){var l;return null!==(l=this.relayManager)&&void 0!==l||(this.relayManager=new S.default(this.context.maContext.getRelayManager(),new E.SessionDiagnosticsWrapper(this.statistics))),this.relayManager},Session.prototype.cleanUp=function(){this.callback=null,this.deviceManagerDisposables.forEach((function(l){return l.dispose()})),this.ufdManagerDisposable.dispose()},Session.prototype.updateSelectedDevices=function(){var l=this,d=this.deviceManager.getSelectedDevices(),getDeviceName=function(d){return d?l.deviceManager.getDeviceNameAsync(d).then((function(d){return b.scrubDeviceLabelPii(d,l.configProvider.config.devices.piiSafeWords)})):Promise.resolve(\"none\")};Promise.all([getDeviceName(d.microphone),getDeviceName(d.speaker),getDeviceName(d.camera)]).then((function(d){var u=f(d,3),p=u[0],h=u[1],g=u[2];l.statistics.setUsedDevices({microphone:p,speaker:h,camera:g})}))},Session.prototype.isRetriableError=function(l){return v.Constants.RENEGOTIATION_ERROR.signaling===l||v.Constants.RENEGOTIATION_ERROR.media===l},Session.prototype.getCurrentSession=function(){return this.reconnectManager.getCurrentSession()},Session.prototype.getMainSession=function(){return this.reconnectManager.getMainSession()},Session.prototype.setAudioStreamState=function(l,d){void 0===d&&(d=(0,m.generateCauseId)()),this.isAudioStateValid(l)?this.raiseAudioStateChanged(l,d):this.logger.safe.error(\"[\".concat(d,\"] audio state transition is invalid: \").concat(this.audioStreamState,\" -> \").concat(l))},Session.prototype.isAudioStateValid=function(l){return this.audioStreamStates[this.audioStreamState].indexOf(l)>=-1},Session.prototype.raiseAudioStateChanged=function(l,d){if(this.logger.safe.info(\"[\".concat(d,\"] audio state changed to \").concat(l)),this.callback.onAudioStateChanged){var u={content:\"audio\",direction:\"receive\",stream:l};this.callback.onAudioStateChanged(u)}},Session.prototype.getReconnectManagerCallbacks=function(){var l=this;return{onSessionErrorOccurred:function(d,u){l.setAudioStreamState(v.Constants.STREAMING_STATE.failed),l.callback.onSessionErrorOccurred&&(l.callback.onSessionErrorOccurred(d,u),l.iceDisconnectedRetried&&l.isNetworkMediaError(d)&&l.ufdManager.raisePendingWhitelistingUFD())}}},Session.prototype.isNetworkMediaError=function(l){return l.type===v.Constants.MEDIA_ERROR.iceConnectionError||l.type===v.Constants.MEDIA_ERROR.noNetworkError},Session.prototype.isRecoverableMediaError=function(l){return this.recoverableErrors.indexOf(l.type)>-1},Session.prototype.startReconnect=function(l){return void 0===l&&(l=(0,m.generateCauseId)()),this.iceDisconnectedRetried=!0,this.reconnectManager.onIceDisconnect(l)},Session.prototype.getSessionCallbacks=function(){var l=this;return{onTerminated:function(){l.event(\"onTerminated\").raise(l)},onSessionErrorOccurred:function(d,u){if(l.getCurrentSession().isReconnectSupported()&&l.isRecoverableMediaError(d)&&!l.iceDisconnectedRetried)return l.startReconnect(u);if(l.iceDisconnectedRetried){var p=l.reconnectManager.rejectReconnect(u);if(l.registerReconnectRejection(),l.isReconnectRetryAllowed()&&l.isRecoverableMediaError(d))return p.then((function(){return l.reconnectAsync(u)}));l.isNetworkMediaError(d)&&l.ufdManager.raisePendingWhitelistingUFD()}return l.setAudioStreamState(v.Constants.STREAMING_STATE.failed,u),l.callback.onSessionErrorOccurred(d,u),l.statistics.setError(d),Promise.resolve()},onNegotiationRequired:function(d){return l.callback.onNegotiationRequired(d)},onAudioHwSilentChanged:function(d){l.statistics.setHwSilent(d)},onAudioStateChanged:function(d){l.setAudioStreamState(d)},onTransportConnected:function(d){void 0===d&&(d=(0,m.generateCauseId)()),l.logger.safe.info(\"[\".concat(d,\"] Transport connectivity established\")),l.reconnectManager.onTransportConnected(l.iceDisconnectedRetried,d),l.iceDisconnectedRetried=!1,l.ufdManager.cancelPendingWhitelistingUFD(),l.statistics.registerTransportConnected(),l.statistics.setIceConnectedStateTimestamp((new Date).getTime())},onTransportDisconnected:function(d){return void 0===d&&(d=(0,m.generateCauseId)()),l.logger.safe.warn(\"[\".concat(d,\"] Transport connectivity lost\")),l.reconnectManager.onTransportDisconnect(d),l.statistics.registerTransportDisconnected(),l.getCurrentSession().isReconnectSupported()&&l.configProvider.config.reconnectOnDisconnect?l.startReconnect(d):Promise.resolve()},onTransportFailed:function(){l.statistics.registerTransportFailed()},onTransportInitialized:function(){l.statistics.setIceInitTimestamp((new Date).getTime())},onUpdateMediaDescriptions:function(d,u){return l.callback.onUpdateMediaDescriptions(d,u)}}},Session.prototype.getSessionConfig=function(){return this.reconnectManager.getCurrentSession().getSessionConfig()},Session}(_.default);d.default=I},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(8),g=u(3),f=u(1),m=(u(28),u(136)),v=function(){function ReconnectManager(l,d,u,p,h,g,f){this.session=l,this.statistics=u,this.sessionOperationQueue=p,this.callback=h,this.sessionCallbacks=g,this.configProvider=f,this.allowUFD=!1,this.reconnectGlare=!1,this.escalationType=0,this.logger=d.getLogger().createChild(\"reconnectManager\"),this.ufdManager=d.getUfdManager(),this.session.callbacks=g,this.reconnectManagerMessageQueue=new m.default(g)}return Object.defineProperty(ReconnectManager.prototype,\"settings\",{get:function(){return(this.reconnectSession||this.session).getSessionConfig().config},enumerable:!1,configurable:!0}),ReconnectManager.prototype.getCurrentSession=function(){return this.reconnectSession||this.session},ReconnectManager.prototype.getMainSession=function(){return this.session},ReconnectManager.prototype.getReconnectSession=function(){return this.reconnectSession},ReconnectManager.prototype.onIceDisconnect=function(l){return this.logger.safe.info(\"[\".concat(l,\"] reconnect attempt after iceDisconnect error\")),this.allowUFD&&this.raiseReconnectEvent(\"Bad\",l),this.isReconnecting()?Promise.resolve():(this.statistics.registerReconnectAttempted(),this.reconnectAsync(l))},ReconnectManager.prototype.onTransportDisconnect=function(l){this.allowUFD&&this.raiseConnectivityLostUFD(l)},ReconnectManager.prototype.onTransportConnected=function(l,d){l&&this.statistics.registerReconnectConnected(),this.allowUFD&&(this.raiseReconnectEvent(\"Good\",d),clearTimeout(this.losingConnectivityTimer)),this.allowUFD=!0},ReconnectManager.prototype.onNegotiationCompletedAsync=function(l){return this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null),this.isReconnecting()?(this.reconnectGlare=!1,this.statistics.registerRetargetCompleted(),2===this.escalationType?Promise.resolve():this.completeReconnect(l)):(this.reconnectGlare&&(this.reconnectGlare=!1,this.reconnectAsync(l)),Promise.resolve())},ReconnectManager.prototype.onNegotiationRejectedAsync=function(l,d,u){var p=this;this.statistics.registerRetargetRejected();var h=1===this.escalationType;return this.rejectReconnect(u).then((function(){d?p.reconnectAsync(u,h):l.type===g.default.RENEGOTIATION_ERROR.glare?(p.reconnectGlare=!0,p.glareTimer=window.setTimeout((function(){p.callback.onSessionErrorOccurred({type:g.default.MEDIA_ERROR.iceConnectionError,detail:\"Reconnect failed, error - \".concat(f.stringifyObject(l))},u)}),1e4)):p.callback.onSessionErrorOccurred({type:g.default.MEDIA_ERROR.iceConnectionError,detail:\"Reconnect failed, error - \".concat(f.stringifyObject(l))},u)}))},ReconnectManager.prototype.reconnectAsync=function(l,d){var u=this;return void 0===d&&(d=!1),this.logger.safe.info(\"[\".concat(l,\"] queueing reconnect, escalation=\").concat(d)),this.statistics.registerReconnectAttempt(d?\"local escalation\":\"out\"),d&&(this.escalationType=1),this.sessionOperationQueue.queueOperation((function(){return u.logger.safe.info(\"[\".concat(l,\"] starting reconnect\")),u.initReconnect(0!==u.escalationType,l).then((function(){return u.reconnectSession.configureModalitiesAsync(u.session.getConfiguredModalities(),l)})).then((function(){u.sessionOperationQueue.completeCurrentOperation()}))}),l)},ReconnectManager.prototype.acceptReconnectStartAsync=function(l,d){return this.logger.safe.info(\"[\".concat(d,\"] accepting reconnect\")),this.statistics.registerRetargetIncoming(),l&&(this.escalationType=2,this.statistics.registerEscalationStart()),this.initReconnect(l,d)},ReconnectManager.prototype.acceptReconnectFinish=function(l){var d=this.session.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(d,l).then((function(){return d}))},ReconnectManager.prototype.isReconnecting=function(){return!!this.reconnectSession},ReconnectManager.prototype.reset=function(){this.glareTimer&&(clearTimeout(this.glareTimer),this.glareTimer=null),this.reconnectGlare=!1,this.session.callbacks=this.sessionCallbacks||{}},ReconnectManager.prototype.cleanUp=function(){this.sessionCallbacks=null,this.reset()},ReconnectManager.prototype.terminateAsync=function(l){var d=this,always=function(){return d.terminateReconnectSessionAsync(l).then((function(){return d.cleanUp()}),(function(){return d.cleanUp()}))};return this.session.terminate(l,{}).then(always,always)},ReconnectManager.prototype.completeReconnect=function(l){if(this.logger.safe.info(\"[\".concat(l,\"] completing reconnect\")),2===this.escalationType&&this.statistics.registerEscalationCompleted(),this.escalationType=0,this.reconnectSession){this.statistics.registerReconnectAttemptCompleted(),this.reconnectManagerMessageQueue.clear();var d=this.session;return this.session=this.reconnectSession,d.move(this.session,l),this.reconnectSession=null,this.negotiationPausePromise=null,d.terminate(l,{})}return Promise.resolve()},ReconnectManager.prototype.rejectReconnect=function(l){if(this.logger.safe.info(\"[\".concat(l,\"] rejecting reconnect\")),2===this.escalationType&&this.statistics.registerEscalationRejected(),this.escalationType=0,this.reconnectSession){this.statistics.registerReconnectAttemptRejected(),this.reconnectManagerMessageQueue.flush();var d=this.reconnectSession;return this.reconnectSession=null,this.unblockCurrentSession(),d.terminate(l,{})}return Promise.resolve()},ReconnectManager.prototype.configureModalitiesAsync=function(l,d){return this.isReconnecting()?Promise.all([this.session.configureModalitiesAsync(l,d),this.reconnectSession.configureModalitiesAsync(l,d)]).then((function(){return Promise.resolve()})):this.session.configureModalitiesAsync(l,d)},ReconnectManager.prototype.canSendDtmf=function(){return this.session.canSendDtmf()},ReconnectManager.prototype.getExtensionsManager=function(){return this.session.getExtensionsManager()},ReconnectManager.prototype.muteHold=function(l,d){this.session.muteHold(l,d)},ReconnectManager.prototype.muteInputAsync=function(l){return this.session.muteInputAsync(l)},ReconnectManager.prototype.unmuteInputAsync=function(l){return this.session.unmuteInputAsync(l)},ReconnectManager.prototype.muteOutputAsync=function(l){return this.session.muteOutputAsync(l)},ReconnectManager.prototype.unmuteOutputAsync=function(l){return this.session.unmuteOutputAsync(l)},ReconnectManager.prototype._deviceSelectionChanged=function(){this.session._deviceSelectionChanged(),this.isReconnecting()&&this.reconnectSession._deviceSelectionChanged()},ReconnectManager.prototype.reconnectCloneSession=function(l){var d=this;this.reconnectSession=this.session.clone(l,this.configProvider.getConfigView(l)),this.reconnectSession.callbacks=this.sessionCallbacks,this.session.callbacks=p(p({},this.reconnectManagerMessageQueue.queueCallbacks),{onSessionErrorOccurred:function(l,u){return l.type!==g.default.MEDIA_ERROR.iceConnectionError&&d.reconnectManagerMessageQueue.queueCallbacks.onSessionErrorOccurred(l,u),Promise.resolve()}})},ReconnectManager.prototype.initReconnect=function(l,d){return void 0===l&&(l=!1),this.logger.safe.info(\"[\".concat(d,\"] initiate reconnect\")),this.reconnectCloneSession(l),this.session.pauseNegotiations&&(this.negotiationPausePromise=this.session.pauseNegotiations(d)),Promise.all([this.reconnectSession.muteInputAsync(d),this.reconnectSession.muteOutputAsync(d)]).then(h.noop)},ReconnectManager.prototype.unblockCurrentSession=function(){this.negotiationPausePromise&&(this.negotiationPausePromise.resolve(),this.negotiationPausePromise=null)},ReconnectManager.prototype.raiseReconnectEvent=function(l,d){this.ufdManager.signalEvent(\"NetworkReconnect\",l,\"Audio\",!0,d)},ReconnectManager.prototype.terminateReconnectSessionAsync=function(l){return this.reconnectSession?this.reconnectSession.terminate(l,{}):Promise.resolve()},ReconnectManager.prototype.raiseConnectivityLostUFD=function(l){var d=this;-1!==this.settings.losingConnectivityTimeoutMs&&(this.losingConnectivityTimer=window.setTimeout((function(){return d.raiseReconnectEvent(\"Poor\",l)}),this.settings.losingConnectivityTimeoutMs))},ReconnectManager}();d.default=v},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0});var m=u(13),v=u(3),y=u(354),S=u(28),_=u(134),C=u(135),E=u(7),T=u(355),b=u(356),I=u(137),A=u(138),R=u(1),P=function(l){function Session(d,u,p,h,g,f,m){var v,C=l.call(this)||this;C.context=p,C.callback=h,C.statistics=g,C.configProvider=f,C.diag=m,C.audioStreamStates=((v={})[S.Constants.STREAMING_STATE.inactive]=[S.Constants.STREAMING_STATE.active,S.Constants.STREAMING_STATE.failed],v[S.Constants.STREAMING_STATE.active]=[S.Constants.STREAMING_STATE.removed,S.Constants.STREAMING_STATE.stopped,S.Constants.STREAMING_STATE.failed],v),C.mediaLegId=new _.default,C.rejectedNegotiations=0,C.negotiationState=null,C.audioStreamState=S.Constants.STREAMING_STATE.inactive,C.deviceManagerDisposables=[],C.logger=p.getLogger().createChild(\"SessionV2\",u),C.ufdManager=p.getUfdManager(),C.ufdManagerDisposable=C.ufdManager.on(\"onQualityChanged\",(function(l){return C.qualityChanged(l)})),C.sessionOperationQueue=new A.default(C.logger),C.mediaLegId=new _.default,C.diagnostics=new I.SessionDiagnosticsWrapper(C.statistics,C.diag),C.statistics.setId(u),C.diagnostics.mediaLegId=C.mediaLegId,C.diagnostics.ETag=C.configProvider.ETag,C.diagnostics.configIds=C.configProvider.ecsConfigIds,C.diagnostics.isMultiParty=!!p.config.isConference,C.recoverableErrors=C.configProvider.config.recoverableMediaErrors.split(\",\");var E=C.getSessionCallbacks();return d.callbacks=E,d.relayManagerProvider=C,C.reconnectManager=new b.default(d,p,new T.ReconnectDiagnosticsWrapper(C.statistics,C.diag?new y.ReconnectDiagnostics:void 0,C.diag),C.sessionOperationQueue,C.getReconnectManagerCallbacks(),E,C.configProvider),C.deviceManager=C.context.getDeviceManager(),C.deviceManagerDisposables.push(C.deviceManager.on(\"onDevicesPermissionChanged\",(function(){return C.diagnostics.allowedModalities=C.getAllowedModalities()}))),C.deviceManagerDisposables.push(C.deviceManager.on(\"onSelectedDevicesChanged\",(function(){return C.deviceSelectionChanged()}))),C.deviceManagerDisposables.push(C.deviceManager.on(\"onDevicesChanged\",(function(){return C.deviceListChanged()}))),C.deviceManagerDisposables.push(C.deviceManager.on(\"onMaxVideoSendCapabilitiesChanged\",(function(l,d){return C.onMaxVideoSendCapabilitiesChanged(l,d)}))),C.statistics.setDevicesCount(C.deviceManager.getDevicesCount()),C.ufdManager.applyCurrentState((function(l){return C.qualityChanged(l)})),C}return p(Session,l),Session.prototype.enableRealTimeTelemetry=function(){this.logger.safe.info(\"enableRealTimeTelemetry is not implemented yet\")},Session.prototype.createOfferAsync=function(l){var d=this;return this.sessionOperationQueue.queueOperation((function(){return h(d,void 0,void 0,(function(){var d,u;return g(this,(function(p){switch(p.label){case 0:this.diagnostics.negotiationStart(\"Offering\"),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.getCurrentSession().createOfferAsync(l)];case 2:return d=p.sent(),this.updateSelectedDevices(),d.mediaLegId=this.mediaLegId.process(d.mediaLegId),this.diagnostics.mediaLegId=this.mediaLegId,this.reconnectManager.isReconnecting()&&!this.reconnectManager.isSignalingStable()&&(this.reconnectManager.registerRetargetOutgoing(),d.newOffer=!0),[2,d];case 3:throw u=p.sent(),this.diagnostics.sessionError=u,u;case 4:return[2]}}))}))}),l)},Session.prototype.processOfferAsync=function(l,d){var u=this;return this.sessionOperationQueue.queueOperation((function(){return h(u,void 0,void 0,(function(){var u,p,h;return g(this,(function(g){switch(g.label){case 0:this.diagnostics.negotiationStart(\"Answering\"),l.mediaLegId=this.mediaLegId.process(l.mediaLegId),g.label=1;case 1:return g.trys.push([1,7,,8]),l.newOffer?[4,this.reconnectManager.acceptReconnectStartAsync(l.escalationOccurring,d)]:[3,3];case 2:g.sent(),g.label=3;case 3:return[4,this.getCurrentSession().processOfferAsync(l,d)];case 4:return u=g.sent(),l.newOffer?[4,this.reconnectManager.acceptReconnectFinish(d)]:[3,6];case 5:return p=g.sent(),u.sharing===v.default.MEDIA_STATE.sendReceive&&(u.sharing=p.sharing===v.default.MEDIA_STATE.send?v.default.MEDIA_STATE.send:v.default.MEDIA_STATE.receive),[2,u];case 6:return[2,u];case 7:throw h=g.sent(),this.diagnostics.sessionError=h,h;case 8:return[2]}}))}))}),d)},Session.prototype.processAnswerAsync=function(l,d,u){return h(this,void 0,void 0,(function(){var p;return g(this,(function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,this.getCurrentSession().processAnswerAsync(l,d,u)];case 1:return[2,h.sent()];case 2:throw p=h.sent(),this.diagnostics.sessionError=p,p;case 3:return[2]}}))}))},Session.prototype.completeNegotiationAsync=function(l){var d,u;return h(this,void 0,void 0,(function(){var p,h;return g(this,(function(g){switch(g.label){case 0:this.rejectedNegotiations=0,g.label=1;case 1:return g.trys.push([1,4,,5]),[4,this.getCurrentSession().completeNegotiationAsync(l)];case 2:return p=g.sent(),this.negotiationState=p,this.diagnostics.finalAnswerTime=Date.now(),null===(u=(d=this.diagnostics).negotiationCompleted)||void 0===u||u.call(d),[4,this.reconnectManager.onNegotiationCompletedAsync(l)];case 3:return g.sent(),this.sessionOperationQueue.completeCurrentOperation(),[2,this.negotiationState];case 4:throw h=g.sent(),this.diagnostics.sessionError=h,h;case 5:return[2]}}))}))},Session.prototype.rejectNegotiationAsync=function(l,d){return h(this,void 0,void 0,(function(){var u,p;return g(this,(function(h){switch(h.label){case 0:this.logger.safe.info(\"[\".concat(d,\"] rejectNegotiationAsync\"),l),h.label=1;case 1:return h.trys.push([1,6,,7]),this.reconnectManager.isReconnecting()?[4,this.reconnectManager.onNegotiationRejection(l.type,d)]:[3,3];case 2:return h.sent(),this.registerNegotiationRejection(this.negotiationState),this.sessionOperationQueue.completeCurrentOperation(),[2,this.negotiationState];case 3:return[4,this.getCurrentSession().rejectNegotiationAsync(l,d,this.isRenegotiationAllowed(l.type))];case 4:return u=h.sent(),this.sessionOperationQueue.completeCurrentOperation(),this.registerNegotiationRejection(u),[2,u];case 5:return[3,7];case 6:throw p=h.sent(),this.diagnostics.sessionError=p,p;case 7:return[2]}}))}))},Session.prototype.completeEscalationAsync=function(l){return this.reconnectManager.completeReconnect(l)},Session.prototype.rejectEscalationAsync=function(l){return this.reconnectManager.rejectReconnect(l)},Session.prototype.terminate=function(l,d){return h(this,void 0,void 0,(function(){var u,p,h,f=this;return g(this,(function(g){switch(g.label){case 0:return p=(u=this.statistics).setPermissionStates,[4,this.deviceManager.getKnownPermissionStates()];case 1:return p.apply(u,[g.sent()]),this.diagnostics.terminated(d),h=function(){return f.cleanUp()},[2,this.reconnectManager.terminateAsync(l).then(h,h)]}}))}))},Session.prototype.getStatsAsync=function(l){var d;return h(this,void 0,void 0,(function(){var u=this;return g(this,(function(p){return[2,this.configProvider.config.diagnostics.useForTelemetry?null===(d=this.diag)||void 0===d?void 0:d.telemetryReport:this.getMainSession().getStatsAsync(l).then((function(l){return u.prepareStats(l)}))]}))}))},Session.prototype.getLastKnownStats=function(l){var d;return void 0===l&&(l=!1),this.configProvider.config.diagnostics.useForTelemetry?null===(d=this.diag)||void 0===d?void 0:d.telemetryReport:this.prepareStats(this.getMainSession().getLastKnownStats(l),l)},Session.prototype.createAnswerAsync=function(l,d){return h(this,void 0,void 0,(function(){var u,p;return g(this,(function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,this.getCurrentSession().createAnswerAsync(l,d)];case 1:return u=h.sent(),this.updateSelectedDevices(),u.mediaLegId=this.mediaLegId.process(u.mediaLegId),this.diagnostics.mediaLegId=this.mediaLegId,[2,u];case 2:throw p=h.sent(),this.diagnostics.sessionError=p,p;case 3:return[2]}}))}))},Session.prototype.configureModalitiesAsync=function(l,d){return R.forOwn(l,(function(d,u){d||delete l[u]})),this.reconnectManager.configureModalitiesAsync(l,d)},Session.prototype.getAllowedModalities=function(){return this.deviceManager.getAllowedModalities()},Session.prototype.createRemoteRenderer=function(l){return this.getMainSession().createRemoteRenderer(l)},Session.prototype.sendDtmf=function(l){return h(this,void 0,void 0,(function(){var d,u;return g(this,(function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,this.getMainSession().sendDtmf(l)];case 1:return d=p.sent(),this.diagnostics.dtmfResult=!0,[2,d];case 2:throw u=p.sent(),this.diagnostics.dtmfResult=!1,u;case 3:return[2]}}))}))},Session.prototype.canSendDtmf=function(){return this.reconnectManager.canSendDtmf()},Session.prototype.getExtensionsManager=function(){return this.reconnectManager.getExtensionsManager()},Session.prototype.muteHold=function(l,d){this.reconnectManager.muteHold(l,d)},Session.prototype.muteInputAsync=function(l){return this.diagnostics.swMute=!0,this.ufdManager.setSwMute(!0),this.reconnectManager.muteInputAsync(l)},Session.prototype.unmuteInputAsync=function(l){return this.diagnostics.swMute=!1,this.ufdManager.setSwMute(!1),this.reconnectManager.unmuteInputAsync(l)},Session.prototype.muteOutputAsync=function(l){return this.diagnostics.speakerMute=!0,this.reconnectManager.muteOutputAsync(l)},Session.prototype.unmuteOutputAsync=function(l){return this.diagnostics.speakerMute=!1,this.reconnectManager.unmuteOutputAsync(l)},Session.prototype.getAcceptedTypes=function(){return this.reconnectManager.getCurrentSession().getAcceptedTypes()},Session.prototype.useNullAudioStreamClient=function(){this.getCurrentSession().useNullAudioStreamClient()},Session.prototype.createAudioElement=function(l){this.getCurrentSession().createAudioElement(l)},Session.prototype.getRawOutputAudioStream=function(){return this.diagnostics.registerRawMediaAccess(\"audio\",\"recv\",!0),this.getCurrentSession().getRawOutputAudioStream()},Session.prototype.setRawInputAudioStreamTrack=function(l){return this.diagnostics.registerRawMediaAccess(\"audio\",\"send\",!!l),this.getCurrentSession().setRawInputAudioStreamTrack(l)},Session.prototype.deviceSelectionChanged=function(){this.updateSelectedDevices(),this.reconnectManager._deviceSelectionChanged()},Session.prototype.registerDeviceTelemetryEvent=function(l){this.getCurrentSession().onDeviceEvent(l),this.statistics.registerDeviceTelemetryEvent(l)},Session.prototype.registerVideoEffectsTelemetryEvent=function(l){this.statistics.registerVideoEffectsTelemetryEvent(l)},Session.prototype.registerAudioEffectsTelemetryEvent=function(l){this.statistics.registerAudioEffectsTelemetryEvent(l)},Session.prototype.reconnectAsync=function(l,d){return void 0===d&&(d=!1),this.reconnectManager.reconnectAsync(l,!0,d)},Session.prototype.isReconnecting=function(){return this.reconnectManager.isReconnecting()},Session.prototype.onMaxVideoSendCapabilitiesChanged=function(l,d){this.reconnectManager.getCurrentSession().onMaxVideoSendCapabilitiesChanged(l,d)},Session.prototype.getRelayManager=function(){var l;return null!==(l=this.relayManager)&&void 0!==l?l:this.relayManager=new C.default(this.context.maContext.getRelayManager(),this.diagnostics)},Session.prototype.getSessionConfig=function(){return this.reconnectManager.getCurrentSession().getSessionConfig()},Session.prototype.getLocalMediaTrackId=function(l){return this.reconnectManager.getMainSession().getLocalMediaTrackId(l)},Session.prototype.cleanUp=function(){this.callback=null,this.deviceManagerDisposables.forEach((function(l){return l.dispose()})),this.ufdManagerDisposable.dispose()},Session.prototype.updateSelectedDevices=function(){var l=this,d=this.deviceManager.getSelectedDevices(),getDeviceName=function(d){return d?l.deviceManager.getDeviceNameAsync(d).then((function(d){return R.scrubDeviceLabelPii(d,l.configProvider.config.devices.piiSafeWords)})):Promise.resolve(\"none\")};Promise.all([getDeviceName(d.microphone),getDeviceName(d.speaker),getDeviceName(d.camera)]).then((function(d){var u=f(d,3),p=u[0],h=u[1],g=u[2];l.statistics.setUsedDevices({microphone:p,speaker:h,camera:g})}))},Session.prototype.getCurrentSession=function(){return this.reconnectManager.getCurrentSession()},Session.prototype.getMainSession=function(){return this.reconnectManager.getMainSession()},Session.prototype.setAudioStreamState=function(l,d){this.isAudioStateValid(l)?this.raiseAudioStateChanged(l,d):this.logger.safe.error(\"[\".concat(d,\"] audio state transition is invalid: \").concat(this.audioStreamState,\" -> \").concat(l))},Session.prototype.isAudioStateValid=function(l){return this.audioStreamStates[this.audioStreamState].indexOf(l)>=-1},Session.prototype.raiseAudioStateChanged=function(l,d){if(this.logger.safe.info(\"[\".concat(d,\"] audio state changed to \").concat(l)),this.callback.onAudioStateChanged){var u={content:\"audio\",direction:\"receive\",stream:l};this.callback.onAudioStateChanged(u)}},Session.prototype.getReconnectManagerCallbacks=function(){var l=this;return{onSessionErrorOccurred:function(d,u){l.isNetworkMediaError(d)&&l.ufdManager.raisePendingWhitelistingUFD(),l.endCallOnFailure(d,u)}}},Session.prototype.isNetworkMediaError=function(l){return l.type===S.Constants.MEDIA_ERROR.iceConnectionError||l.type===S.Constants.MEDIA_ERROR.noNetworkError},Session.prototype.isRecoverableMediaError=function(l){return this.recoverableErrors.indexOf(l.type)>-1},Session.prototype.startReconnect=function(l){return void 0===l&&(l=(0,m.generateCauseId)()),this.reconnectManager.onIceDisconnect(l)},Session.prototype.getSessionCallbacks=function(){var l=this;return{onTerminated:function(){l.logger.safe.warn(\"call onTerminated\"),l.event(\"onTerminated\").raise(l)},onSessionErrorOccurred:function(d,u){if(void 0===u&&(u=(0,m.generateCauseId)()),l.isRecoverableMediaError(d)){if(l.reconnectManager.isReconnecting())return l.reconnectManager.onSessionErrorOccurred(d,u);if(l.getCurrentSession().isReconnectSupported())return l.startReconnect(u)}return l.endCallOnFailure(d,u),Promise.resolve()},onNegotiationRequired:function(d){return l.callback.onNegotiationRequired(d)},onAudioHwSilentChanged:function(d){l.diagnostics.hwSilent=d},onAudioStateChanged:function(d,u){l.setAudioStreamState(d,u)},onTransportConnected:function(d){void 0===d&&(d=(0,m.generateCauseId)()),l.logger.safe.info(\"[\".concat(d,\"] Transport connectivity established\")),l.ufdManager.cancelPendingWhitelistingUFD(),l.reconnectManager.onConnected(d),l.diagnostics.registerTransportConnected(),l.diagnostics.iceConnectedStateTimestamp=Date.now()},onTransportDisconnected:function(d){return void 0===d&&(d=(0,m.generateCauseId)()),l.logger.safe.warn(\"[\".concat(d,\"] Transport connectivity lost\")),l.reconnectManager.onTransportDisconnect(d),l.diagnostics.registerTransportDisconnected(),l.getCurrentSession().isReconnectSupported()&&l.configProvider.config.reconnectOnDisconnect?l.startReconnect(d):Promise.resolve()},onTransportFailed:function(){l.diagnostics.registerTransportFailed()},onTransportInitialized:function(){l.diagnostics.iceInitTime=Date.now()},onUpdateMediaDescriptions:function(d,u){return l.callback.onUpdateMediaDescriptions(d,u)}}},Session.prototype.registerNegotiationRejection=function(l){var d,u;this.rejectedNegotiations++,null===(u=(d=this.diagnostics).negotiationRejected)||void 0===u||u.call(d),l.rollback&&this.diagnostics.registerRollbackEvent(l.rollback)},Session.prototype.isRenegotiationAllowed=function(l){return this.rejectedNegotiations<this.context.configProvider.config.renegotiationAttempts&&!this.reconnectManager.isReconnectScheduled&&(S.Constants.RENEGOTIATION_ERROR.signaling===l||S.Constants.RENEGOTIATION_ERROR.media===l)},Session.prototype.prepareStats=function(l,d){return void 0===d&&(d=!1),this.statistics.setDeviceList(this.deviceManager.getDeviceDescriptions(),this.deviceManager.getDeviceListDebugInfo()),this.statistics.setRelayManagerTimers(this.getRelayManager().getStats()),this.statistics.setVideoEffectStats(this.deviceManager.videoEffectManager.getStats()),this.statistics.setAudioEffectStats(this.deviceManager.audioEffectManager.getStats()),this.statistics.generateStatistics(l,this.mediaLegId,d)},Session.prototype.deviceListChanged=function(){this.deviceManager.isPollingInProgress&&this.statistics.deviceChangedByPoll(),this.statistics.devicesChanged(),this.statistics.setDevicesCount(this.deviceManager.getDevicesCount())},Session.prototype.qualityChanged=function(l){this.callback&&this.callback.onQualityChanged&&(this.diagnostics.registerQualityStateChangedEvent(l),\"DeviceSpeakWhileMuted\"===l.type&&(this.diagnostics.isSpeaking=\"Good\"!==l.value),this.callback.onQualityChanged(l))},Session.prototype.endCallOnFailure=function(l,d){this.callback&&(this.callback.onSessionErrorOccurred&&this.callback.onSessionErrorOccurred(l,d),this.diagnostics.sessionError=l,this.setAudioStreamState(S.Constants.STREAMING_STATE.failed,d))},Session}(E.default);d.default=P},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ReconnectDiagnostics=void 0;var p=function(){function ReconnectDiagnostics(){this.data={records:[],isReconnecting:!1,reconnectCount:{attempted:0,connected:0},retargetCount:{incoming:0,outgoing:0,completed:0,rejected:0},escalationCount:{attempted:0,completed:0,rejected:0}}}return ReconnectDiagnostics.prototype.registerReconnectAttempt=function(l){this.activeRecord&&(this.activeAttempt={direction:l,startTime:Date.now(),status:!1},this.data.isReconnecting=!0,this.activeRecord.attempts.push(this.activeAttempt))},ReconnectDiagnostics.prototype.registerReconnectAttemptStatus=function(l){\"completed\"===l&&(this.data.isReconnecting=!1),this.activeAttempt&&this.activeRecord&&(this.activeAttempt.endTime=Date.now(),this.activeAttempt.status=\"completed\"===l)},ReconnectDiagnostics.prototype.registerReconnect=function(l){if(this.data.reconnectCount[l]++,this.data.isReconnecting=\"attempted\"===l,\"attempted\"===l){if(this.activeRecord)return;this.activeRecord={startTime:Date.now(),attempts:[]},this.data.records.push(this.activeRecord)}else if(\"connected\"===l){if(!this.activeRecord)return;this.activeRecord.endTime=Date.now(),this.activeRecord=void 0,this.activeAttempt=void 0}},ReconnectDiagnostics.prototype.registerRetarget=function(l){this.data.retargetCount[l]++},ReconnectDiagnostics.prototype.registerEscalation=function(l){this.data.escalationCount[l]++},ReconnectDiagnostics.prototype.getObject=function(){return this.data},ReconnectDiagnostics}();d.ReconnectDiagnostics=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ReconnectDiagnosticsWrapper=void 0;var p=function(){function ReconnectDiagnosticsWrapper(l,d,u){this.stats=l,this.diag=d,u&&d&&(u.reconnect=d.getObject())}return ReconnectDiagnosticsWrapper.prototype.registerReconnectAttempt=function(l){var d;this.stats.registerReconnectAttempt(l),null===(d=this.diag)||void 0===d||d.registerReconnectAttempt(l)},ReconnectDiagnosticsWrapper.prototype.registerReconnectAttemptStatus=function(l){var d;switch(l){case\"completed\":this.stats.registerReconnectAttemptCompleted();break;case\"rejected\":this.stats.registerReconnectAttemptRejected()}null===(d=this.diag)||void 0===d||d.registerReconnectAttemptStatus(l)},ReconnectDiagnosticsWrapper.prototype.registerReconnect=function(l){var d;switch(l){case\"attempted\":this.stats.registerReconnectAttempted();break;case\"connected\":this.stats.registerReconnectConnected()}null===(d=this.diag)||void 0===d||d.registerReconnect(l)},ReconnectDiagnosticsWrapper.prototype.registerRetarget=function(l){var d;switch(l){case\"completed\":this.stats.registerRetargetCompleted();break;case\"rejected\":this.stats.registerRetargetRejected();break;case\"incoming\":this.stats.registerRetargetIncoming();break;case\"outgoing\":this.stats.registerRetargetOutgoing()}null===(d=this.diag)||void 0===d||d.registerRetarget(l)},ReconnectDiagnosticsWrapper.prototype.registerEscalation=function(l){var d;switch(l){case\"attempted\":this.stats.registerEscalationStart();break;case\"completed\":this.stats.registerEscalationCompleted();break;case\"rejected\":this.stats.registerEscalationRejected()}null===(d=this.diag)||void 0===d||d.registerEscalation(l)},ReconnectDiagnosticsWrapper}();d.ReconnectDiagnosticsWrapper=p},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(40),m=u(1),v=u(3),y=(u(28),u(136)),S=function(){function ReconnectManager(l,d,u,p,h,g,f){this.session=l,this.context=d,this.diagnostics=u,this.sessionOperationQueue=p,this.callback=h,this.sessionCallbacks=g,this.configProvider=f,this.wasConnected=!1,this.isDisconnected=!1,this.isReconnectConference=!1,this.escalationType=0,this._isSignalingStable=!0,this.reconnectDelayTime=0,this._isReconnectScheduled=!1,this.logger=d.getLogger().createChild(\"ReconnectManagerV2\"),this.ufdManager=d.getUfdManager(),this.session.callbacks=g,this.reconnectManagerMessageQueue=new y.default(g)}return Object.defineProperty(ReconnectManager.prototype,\"settings\",{get:function(){return(this.reconnectSession||this.session).getSessionConfig().config},enumerable:!1,configurable:!0}),ReconnectManager.prototype.getCurrentSession=function(){return this.reconnectSession||this.session},ReconnectManager.prototype.getMainSession=function(){return this.session||this.reconnectSession},ReconnectManager.prototype.getReconnectSession=function(){return this.reconnectSession},ReconnectManager.prototype.onIceDisconnect=function(l){return this.logger.safe.info(\"[\".concat(l,\"] reconnect attempt after iceDisconnect error\")),this.wasConnected&&this.raiseReconnectEvent(\"Bad\",l),this.isDisconnected=!0,this.isReconnecting()?Promise.resolve():(this.diagnostics.registerReconnect(\"attempted\"),this.reconnectAsync(l))},ReconnectManager.prototype.onTransportDisconnect=function(l){this.isDisconnected=!0,this.wasConnected&&this.raiseConnectivityLostUFD(l)},ReconnectManager.prototype.onConnected=function(l){this.isDisconnected=!1,this.logger.safe.info(\"[\".concat(l,\"] set allow UFD\")),this.raiseReconnectEvent(\"Good\",l),this.wasConnected=!0,clearTimeout(this.losingConnectivityTimer)},ReconnectManager.prototype.onNegotiationCompletedAsync=function(l){return this.logger.safe.info(\"[\".concat(l,\"] handle negotiation completed\")),this.setSignalingState(!0),this.isReconnecting()&&(this.diagnostics.registerRetarget(\"completed\"),2===this.escalationType&&this.blockCurrentSession(l)),Promise.resolve()},ReconnectManager.prototype.onSessionErrorOccurred=function(l,d){var u=this;return this.logger.safe.info(\"[\".concat(d,\"] handle session error\"),m.stringifyObject(l)),this.rejectReconnect(d).then((function(){return u.isReconnectAllowed()?u.scheduleReconnectRetry(d,!1,!1):u.callback.onSessionErrorOccurred(l,d)}))},ReconnectManager.prototype.onNegotiationRejection=function(l,d){var u=this;this.logger.safe.info(\"[\".concat(d,\"] handle negotiation rejection\")),this.diagnostics.registerRetarget(\"rejected\");var p=1===this.escalationType;return this.rejectReconnect(d).then((function(){var h=l===v.default.RENEGOTIATION_ERROR.glare&&p;(l!==v.default.RENEGOTIATION_ERROR.glare||p)&&(u.isRecoverableError(l)||h?u.scheduleReconnectRetry(d,h,p):u.onReconnectFailed(l,d))}))},ReconnectManager.prototype.reconnectAsync=function(l,d,u){var p=this;return void 0===d&&(d=!1),void 0===u&&(u=!1),this.logger.safe.info(\"[\".concat(l,\"] queueing reconnect, force=\").concat(d,\", escalation=\").concat(u)),this.diagnostics.registerReconnectAttempt(u?\"local escalation\":\"out\"),this._isReconnectScheduled=!0,u&&(this.escalationType=1),this.sessionOperationQueue.queueOperation((function(){return p._isReconnectScheduled=!1,!d&&p.session&&p.session.isConnected()?(p.logger.safe.info(\"[\".concat(l,\"] old session is active reconnect\")),p.isReconnecting()||p.diagnostics.registerReconnect(\"connected\"),p.sessionOperationQueue.completeCurrentOperation(),Promise.resolve()):p.reconnectSession&&p._isSignalingStable?(p.logger.safe.info(\"[\".concat(l,\"] ongoing reconnect is in progress\")),p.sessionOperationQueue.completeCurrentOperation(),Promise.resolve()):p.initReconnect(l).then((function(){return p.reconnectSession.configureModalitiesAsync(p.getConfiguredModalities(),l)})).then((function(){p.sessionOperationQueue.completeCurrentOperation()}))}),l)},ReconnectManager.prototype.acceptReconnectStartAsync=function(l,d){return this.logger.safe.info(\"[\".concat(d,\"] accepting reconnect\")),this.diagnostics.registerRetarget(\"incoming\"),l?(this.escalationType=2,this.diagnostics.registerEscalation(\"attempted\")):(!this.isReconnecting()&&this.isDisconnected?this.diagnostics.registerReconnect(\"attempted\"):this.isReconnecting()&&this.rejectReconnect(d),this.diagnostics.registerReconnectAttempt(\"in\")),this.initReconnect(d)},ReconnectManager.prototype.acceptReconnectFinish=function(l){var d=this.getConfiguredModalities();return this.reconnectSession.configureModalitiesAsync(d,l).then((function(){return d}))},ReconnectManager.prototype.isReconnecting=function(){return!!this.reconnectSession},ReconnectManager.prototype.isReconnectScheduled=function(){return this._isReconnectScheduled},ReconnectManager.prototype.cleanUp=function(){this.sessionCallbacks=null,this.reconnectSession=null},ReconnectManager.prototype.terminateAsync=function(l){var d;return h(this,void 0,void 0,(function(){return g(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,null===(d=this.session)||void 0===d?void 0:d.terminate(l,{})];case 1:return u.sent(),[3,3];case 2:return u.sent(),[3,3];case 3:return u.trys.push([3,5,,6]),[4,this.terminateReconnectSessionAsync(l,!0)];case 4:return u.sent(),[3,6];case 5:return u.sent(),[3,6];case 6:return this.cleanUp(),[2]}}))}))},ReconnectManager.prototype.completeReconnect=function(l){return this.logger.safe.info(\"[\".concat(l,\"] completing reconnect\")),2===this.escalationType&&(this.unblockCurrentSession(),this.diagnostics.registerEscalation(\"completed\")),this.escalationType=0,this.reconnectSession&&(this.context.config.isConference=this.isReconnectConference,this.disposeActiveSession(l),this.session=this.reconnectSession,this.reconnectManagerMessageQueue.clear(),this.diagnostics.registerReconnectAttemptStatus(\"completed\"),this._isSignalingStable||this.diagnostics.registerRetarget(\"completed\"),this.isDisconnected&&this.diagnostics.registerReconnect(\"connected\"),this.resetReconnectTimer(),this.reconnectDelayTime=0,this.reconnectSession=null,this.negotiationPausePromise=null,this.session.callbacks=this.sessionCallbacks||{}),Promise.resolve()},ReconnectManager.prototype.rejectReconnect=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){switch(d.label){case 0:return this.logger.safe.info(\"[\".concat(l,\"] rejecting reconnect\")),this.setSignalingState(!1),2===this.escalationType&&this.diagnostics.registerEscalation(\"rejected\"),this.escalationType=0,this.reconnectSession?[4,this.terminateReconnectSessionAsync(l,!1)]:[3,2];case 1:d.sent(),this.diagnostics.registerReconnectAttemptStatus(\"rejected\"),d.label=2;case 2:return this.session&&(this.reconnectManagerMessageQueue.flush(),this.session.callbacks=this.sessionCallbacks,this.unblockCurrentSession()),[2]}}))}))},ReconnectManager.prototype.configureModalitiesAsync=function(l,d){this.lastKnownConfiguredModalities=l;var u=[];return this.session&&u.push(this.session.configureModalitiesAsync(l,d)),this.reconnectSession&&u.push(this.reconnectSession.configureModalitiesAsync(l,d)),Promise.all(u).then((function(){return Promise.resolve()}))},ReconnectManager.prototype.canSendDtmf=function(){return this.getMainSession().canSendDtmf()},ReconnectManager.prototype.getExtensionsManager=function(){return this.getMainSession().getExtensionsManager()},ReconnectManager.prototype.muteHold=function(l,d){this.getMainSession().muteHold(l,d)},ReconnectManager.prototype.muteInputAsync=function(l){return this.getMainSession().muteInputAsync(l)},ReconnectManager.prototype.unmuteInputAsync=function(l){return this.getMainSession().unmuteInputAsync(l)},ReconnectManager.prototype.muteOutputAsync=function(l){return this.getMainSession().muteOutputAsync(l)},ReconnectManager.prototype.unmuteOutputAsync=function(l){return this.getMainSession().unmuteOutputAsync(l)},ReconnectManager.prototype._deviceSelectionChanged=function(){this.session&&this.session._deviceSelectionChanged(),this.reconnectSession&&this.reconnectSession._deviceSelectionChanged()},ReconnectManager.prototype.disposeActiveSession=function(l){if(this.session&&this.isReconnecting()){this.logger.safe.info(\"[\".concat(l,\"] About to dispose current session...\"));var d=this.session;return this.lastKnownConfiguredModalities=this.session.getConfiguredModalities(),d.callbacks=this.reconnectManagerMessageQueue.queueCallbacks,d.move(this.reconnectSession,l),this.session=null,d.terminate(l,{},!1)}return Promise.resolve()},ReconnectManager.prototype.registerRetargetOutgoing=function(){this.diagnostics.registerRetarget(\"outgoing\")},ReconnectManager.prototype.isSignalingStable=function(){return this._isSignalingStable},ReconnectManager.prototype.getConfiguredModalities=function(){return this.getMainSession().getConfiguredModalities()||this.lastKnownConfiguredModalities},ReconnectManager.prototype.scheduleReconnectRetry=function(l,d,u){var p=this,h=this.getReconnectDelayTime(),g=\"the time limit was reached\";return(0,f.delay)(h).then((function(){return p.isReconnectAllowed()||d?p.reconnectAsync(l,u,u):!p.session||p.session.isFailed()?p.onReconnectFailed(g,l):void 0}))},ReconnectManager.prototype.isRecoverableError=function(l){return v.default.RENEGOTIATION_ERROR.media===l||v.default.RENEGOTIATION_ERROR.signaling===l},ReconnectManager.prototype.resetReconnectSession=function(l){var d=this,u=null;this.logger.safe.info(\"[\".concat(l,\"] Resetting reconnect session. Session exists: old: \").concat(!!this.session,\", new: \").concat(!!this.reconnectSession)),this.isReconnectConference=0!==this.escalationType||this.context.config.isConference;var h=0!==this.escalationType||this.context.config.isConference&&this.wasConnected&&!this.isDisconnected;(u=this.getMainSession().clone(h,this.configProvider.getConfigView(h))).callbacks=p(p({},this.sessionCallbacks),{onTransportConnected:function(l){2!==d.escalationType&&d.completeReconnect(l),d.raiseReconnectEvent(\"Good\",l),d.sessionCallbacks.onTransportConnected(l)}}),this.session&&(this.session.callbacks=p(p({},this.reconnectManagerMessageQueue.queueCallbacks),{onSessionErrorOccurred:function(l,u){return l.type!==v.default.MEDIA_ERROR.iceConnectionError&&d.reconnectManagerMessageQueue.queueCallbacks.onSessionErrorOccurred(l,u),Promise.resolve()}})),this.reconnectSession&&(this.reconnectSession.move(u,l),this.logger.safe.info(\"[\".concat(l,\"] reconnect session still exists during reconnect clone operation\")),this.terminateReconnectSessionAsync(l,!1)),this.logger.safe.info(\"[\".concat(l,\"] New session reset.\")),this.reconnectSession=u},ReconnectManager.prototype.initReconnect=function(l){return this.logger.safe.info(\"[\".concat(l,\"] initiate reconnect\")),this.setReconnectTimer(),this.resetReconnectSession(l),this.setSignalingState(!1),this.session?(this.blockCurrentSession(l),Promise.all([this.reconnectSession.muteInputAsync(l),this.reconnectSession.muteOutputAsync(l)]).then((function(){return Promise.resolve()}))):Promise.resolve()},ReconnectManager.prototype.blockCurrentSession=function(l){this.session.pauseNegotiations&&(this.negotiationPausePromise=this.session.pauseNegotiations(l))},ReconnectManager.prototype.unblockCurrentSession=function(){this.negotiationPausePromise&&(this.negotiationPausePromise.resolve(),this.negotiationPausePromise=null)},ReconnectManager.prototype.raiseReconnectEvent=function(l,d){this.ufdManager.signalEvent(\"NetworkReconnect\",l,\"Audio\",!0,d)},ReconnectManager.prototype.terminateReconnectSessionAsync=function(l,d){return h(this,void 0,void 0,(function(){var u;return g(this,(function(h){switch(h.label){case 0:return this.reconnectSession?(u=new y.default(this.sessionCallbacks),this.reconnectSession.callbacks=p(p({},u.queueCallbacks),{onTerminated:d?this.sessionCallbacks.onTerminated:u.queueCallbacks.onTerminated}),[4,this.reconnectSession.terminate(l,{},!1)]):[3,2];case 1:h.sent(),u.clear(),this.reconnectSession=null,h.label=2;case 2:return[2]}}))}))},ReconnectManager.prototype.setReconnectTimer=function(){var l=this,d=this.wasConnected?this.settings.reconnectTimeLimit:this.settings.initialReconnectTimeLimit;d>0&&!this.reconnectTimer&&(this.reconnectTimer=window.setTimeout((function(){return l.resetReconnectTimer()}),d))},ReconnectManager.prototype.resetReconnectTimer=function(){clearTimeout(this.reconnectTimer),this.reconnectTimer=null},ReconnectManager.prototype.isReconnectAllowed=function(){return!!this.reconnectTimer},ReconnectManager.prototype.getReconnectDelayTime=function(){return 1e3*Math.min(++this.reconnectDelayTime,this.settings.maxReconnectDelayTime)},ReconnectManager.prototype.onReconnectFailed=function(l,d){this.callback.onSessionErrorOccurred({type:v.default.MEDIA_ERROR.iceConnectionError,detail:\"Reconnect failed, error - \".concat(m.stringifyObject(l))},d)},ReconnectManager.prototype.setSignalingState=function(l){this._isSignalingStable=l},ReconnectManager.prototype.raiseConnectivityLostUFD=function(l){var d=this;-1!==this.settings.losingConnectivityTimeoutMs&&(this.losingConnectivityTimer=window.setTimeout((function(){return d.raiseReconnectEvent(\"Poor\",l)}),this.settings.losingConnectivityTimeoutMs))},ReconnectManager}();d.default=S},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},g=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(13),m=u(83),v=u(139),y=u(30),S=u(64),_=u(140),C=u(65),E=u(1),T=u(3),b=u(84),I=u(9),A=u(87),R=u(50),P=u(370),O=u(373),M=u(374),w=u(376),N=u(377);function OrtcState(){var l=this;function _stateChangeError(d){throw new Error(\"Invalid state change:\"+l.state+\" \"+d+\" changing: \"+l.changing)}this.STABLE=\"stable\",this.NEGOTIATION_REQUESTED=\"negotiation_requested\",this.HAVE_LOCAL_OFFER=\"have_local_offer\",this.HAVE_REMOTE_PRANSWER=\"have_remote_pranswer\",this.HAVE_REMOTE_ANSWER=\"have_remote_answer\",this.HAVE_REMOTE_OFFER=\"have_remote_offer\",this.HAVE_LOCAL_PRANSWER=\"have_local_pranswer\",this.HAVE_LOCAL_ANSWER=\"have_local_answer\",this.TERMINATED=\"terminated\",this.state=l.STABLE,this.changing=!1,this.change=function(d,u){switch(l.busy&&_stateChangeError(d),u&&(l.changing=u),d){case l.STABLE:l.state!==l.HAVE_REMOTE_ANSWER&&l.state!==l.HAVE_LOCAL_ANSWER&&_stateChangeError(d);break;case l.NEGOTIATION_REQUESTED:l.state!==l.STABLE&&_stateChangeError(d);break;case l.HAVE_LOCAL_OFFER:l.state!==l.STABLE&&l.state!==l.NEGOTIATION_REQUESTED&&_stateChangeError(d);break;case l.HAVE_REMOTE_PRANSWER:case l.HAVE_REMOTE_ANSWER:l.state!==l.HAVE_LOCAL_OFFER&&l.state!==l.HAVE_REMOTE_PRANSWER&&_stateChangeError(d);break;case l.HAVE_REMOTE_OFFER:l.state!==l.STABLE&&l.state!==l.NEGOTIATION_REQUESTED&&_stateChangeError(d);break;case l.HAVE_LOCAL_PRANSWER:case l.HAVE_LOCAL_ANSWER:l.state!==l.HAVE_REMOTE_OFFER&&l.state!==l.HAVE_LOCAL_PRANSWER&&_stateChangeError(d);break;case l.TERMINATED:break;default:_stateChangeError(d)}l.state=d},this.complete=function(){l.changing=!1}}function OrtcSession(l,d,u){var D;this.configureModalitiesAsync=_configureModalitiesAsync,this.getConfiguredModalities=_getConfiguredModalities,this.processOfferAsync=_processOfferAsync,this.createAnswerAsync=_createAnswerAsync,this.createOfferAsync=_createOfferAsync,this.processAnswerAsync=_processAnswerAsync,this.completeNegotiationAsync=_completeNegotiationAsync,this.rejectNegotiationAsync=_rejectNegotiationAsync,this.createRemoteRenderer=_createRemoteRenderer,this.sendDtmf=_sendDtmf,this.canSendDtmf=_canSendDtmf,this.getLastKnownStats=_getLastKnownStats,this.getStatsAsync=_getStatsAsync,this.terminate=_terminate,this.isReconnectSupported=_isReconnectSupported,this.muteHold=_muteHold,this.muteInputAsync=_muteInputAsync,this.unmuteInputAsync=_unmuteInputAsync,this.setMuteAsync=_setMute,this.muteOutputAsync=_muteOutputAsync,this.unmuteOutputAsync=_unmuteOutputAsync,this.createAudioElement=_createAudioElement,this.getRawOutputAudioStream=_getRawOutputAudioStream,this.setRawInputAudioStreamTrack=_setRawInputAudioStreamTrack,this.useNullAudioStreamClient=function(){},this._deviceSelectionChanged=_deviceSelectionChanged,this.onDeviceEvent=function(){},this.onContributingSourcesChanged=null,this.callbacks={},this.getExtensionsManager=_getExtensionsManager,this.clone=_clone,this.setInternals=_setInternals,this.move=_move,this.isFailed=_isFailed,this.isConnected=_isConnected,this.getSessionConfig=_getSessionConfig,this.getAcceptedTypes=function(){return te};var L,k,x,F=l.config.iceTransportPolicy?l.config.iceTransportPolicy:T.default.ICE_TRANSPORT_POLICY.all,U=l.getLogger().createChild(\"ortc\"),j=l.config.muted,B=!1,V=this,H=!l.config.isConference,G=null,W=new O.default(U,l.configProvider,l.config.isConference),q=new M.default,z=!1,K=!1,J=new OrtcState,Q=[],Y={},$=!1,X=!1,Z={triggerIceReinvite:function(){l.configProvider.config.disableIceReinvite?U.safe.info(\"ICE-reinvite disabled - triggerIceReinvite skipped\"):(U.safe.info(\"triggerIceReinvite\"),_triggerRenegotiation(!0))},onConnected:_onTransportConnected,onError:_onTransportError},ee=E.getFrom(\"ortcMediaContentType\",l.config,l.configProvider.config),te=l.configProvider.config.ortcAllowedMediaContentType,ne=new _.SessionStreamsProvider(l.getDeviceManager(),new y.PromiseQueue(U),U.createChild(\"SessionStreamsProvider\"));function _onTransportError(l,d){l.type=l.type||T.default.MEDIA_ERROR.iceConnectionError,l.detail=l.detail||\"none\";var u=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.audio)||Q[0];u&&u.getTransportId()===d&&(U.error(\"primary transport disconnected, ending call\"),_raiseError(l))}function _onTransportConnected(l){var d=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.audio);d&&d.getTransportId()===l&&(U.safe.info(\"audio channel transport connected\"),V.callbacks.onAudioStateChanged(T.default.STREAMING_STATE.active)),V.callbacks.onTransportConnected&&V.callbacks.onTransportConnected()}var ie=new S.default(U.createChild(\"AudioRenderer\"),l.configProvider),re=new w.default(l.configProvider,U,Z,l.config.isRemoteClientLync,F,H),oe=Promise.resolve({}),ae=N.default.build(l.configProvider,U),se=new C.SsrcGenerator,ce=Promise.resolve(),le=l.config.passiveModalities,de=new b.default(U.createChild(\"ExtMgr\")),ue=new m.ActiveSpeakerManager(u.onContributingSourcesChanged,u.onDominantSpeakerChanged,U.createChild(\"ActiveSpeakerManager\")),pe={IceGathererFailed:\"false\"};function descrTypeToChannelType(l){if(l===T.default.MEDIA_TYPE.audio)return A.MediaChannelType.Audio;if(l===T.default.MEDIA_TYPE.video)return A.MediaChannelType.Video;throw new Error(\"Error in media descriptors descr.type: \"+l)}function _clone(p,h){var g=E.shallowClone(l);g.config=E.shallowClone(l.config),g.ortcMediaContentType=ee,g.configProvider=h,p&&(g.config.isConference=!0);var f=new OrtcSession(g,d,u);return D&&(f.relayManagerProvider=D),f.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,f}function _setInternals(l){l.renderers&&(ae&&ae.terminate(),(ae=l.renderers).reset(),updateRenderers()),l.audioRenderer&&(l.audioRenderer.play(ie.getStream()),ie=l.audioRenderer)}function _move(l){ie.stop(),l.setInternals({renderers:ae,audioRenderer:ie}),l.muteHold(B),j?l.muteInputAsync():l.unmuteInputAsync(),ae=null,ie=null,this.callbacks.onTerminated=null}function _assureChannels(d){for(var u=0;u<d.length;u++){if(d[u].label!==T.default.MEDIA_LABEL.audio||Q[u]){if(d[u].label===T.default.MEDIA_LABEL.video){if(!Q[u]){p=U.createChild(\"VStrm_\"+d[u].mediaId+\":\");Q[u]=new P.default(l.configProvider,d[u].mediaId,p,descrTypeToChannelType(d[u].type),d[u].label,V,se,!1)}}else if(d[u].label===T.default.MEDIA_LABEL.sharing&&!Q[u]){p=U.createChild(\"SStrm_\"+d[u].mediaId+\":\");Q[u]=new P.default(l.configProvider,d[u].mediaId,p,descrTypeToChannelType(d[u].type),d[u].label,V,se,!0)}}else{var p=U.createChild(\"AStrm_\"+d[u].mediaId+\":\");Q[u]=new P.default(l.configProvider,d[u].mediaId,p,descrTypeToChannelType(d[u].type),d[u].label,V,se,!1)}if(Q[u]&&(Q[u].setMute(j),Q[u].preconfigureChannel(d[u])),Q[u]&&Q[u].getLabel()!==d[u].label)throw new Error(\"Error in media descriptors ch.label: \"+Q[u].getLabel()+\" descr.label: \"+d[u].label)}}function _findFirstChannelByLabel(l,d){for(var u=0;u<l.length;u++)if(l[u].getLabel()===d)return l[u];return null}function _getMediaChannelParams(){for(var l=[],d=0;d<Q.length;d++)Q[d]&&(l[d]=Q[d].getLocalParameters());return l}function _raiseError(l){U.safe.error(\"Media error occurred\",\"type:\",l.type,\"detail:\",l.detail?l.detail.toString():\"no details\"),l.detail&&l.detail.stack&&U.safe.error(\"Stack:\",l.detail.stack),V.callbacks.onSessionErrorOccurred&&V.callbacks.onSessionErrorOccurred(l)}function _triggerRenegotiation(l){J.state!==J.STABLE||J.changing?l&&($=!0):(J.change(J.NEGOTIATION_REQUESTED),U.safe.info(\"triggerNegotiation\",\"mods:\",JSON.stringify(L),\"force:\",l),$=!1,V.callbacks.onNegotiationRequired&&V.callbacks.onNegotiationRequired())}function _configureModalitiesAsync(l){var d=ce.then((function(){if(!l||!l.audio&&!l.video&&!l.sharing)throw new Error(\"Invalid parameters!\"+JSON.stringify(l));var d=Promise.resolve();return!I.areSendDirectionsFulfilled(l,Y)&&J.state!==J.HAVE_REMOTE_OFFER&&(d=d.then((function(){return ne.start(I.getSendMediaModalities(l))})).then((function(d){l=I.mergeSendModalities(l,d)}))),d.then((function(){var d=!L||!I.areNegotiatedDirectionsFulfilled(l,Y);L=l,d&&_triggerRenegotiation()})).then((function(){return L}))}));return ce=d.catch((function(l){U.safe.warn(\"Error during configuring modalities: \".concat(l))})),d}function _getConfiguredModalities(){return L}function _processOfferAsync(l){return new Promise((function(d){X=!1;var u=l.blob;U.unsafe.debug(\"PROCESS OFFER\",\"sdp:\",u),E.throwIfNotSupported(l.contentType,te),ee=l.contentType,J.change(J.HAVE_REMOTE_OFFER);var p=q.sdpToParams(u);W.processOffer(p),G=p.transportParams,d(k=I.invertModalities(R.default.getModalitiesFromMedia(p.media)))}))}function descrsNeedsTransports(l){var d=0;return l.forEach((function(l){l.needsTransport&&d++})),d}function _raiseQualityChangeEvent(l,d){V.callbacks.onAudioQualityChanged&&V.callbacks.onAudioQualityChanged({type:l,value:d?\"Bad\":\"Good\",isLocalSource:!0,mediaType:\"Audio\"})}function _checkIceCandidates(l){if(re.hasIceCandidates(l)===z&&(_raiseQualityChangeEvent(\"NoNetwork\",z=!z),z))throw{type:T.default.MEDIA_ERROR.noNetworkError,detail:\"no ice candidates\"};re.hasIceCandidates(l)&&re.hasRelayIceCandidates(l)===K&&_raiseQualityChangeEvent(\"NetworkRelaysNotReachable\",K=!K)}function _createAnswerAsync(l){return l?(J.change(J.HAVE_LOCAL_PRANSWER,!0),Promise.resolve({blob:\"\",contentType:ee,modalities:{audio:\"sendrecv\",video:\"sendrecv\",sharing:\"sendrecv\"}})):Promise.resolve().then((function(){if(J.change(J.HAVE_LOCAL_ANSWER,!0),!L)throw new Error(\"Modalities not configured for answer\");x=I.excludePassiveModalities(L,le,k),d=W.createMediaDescriptorsForAnswer(x);var l=I.getSendMediaModalities(x);return Promise.all([ne.start(l),re.assureInitAsync(\"controlled\",descrsNeedsTransports(d),!0)])})).then((function(){return re.waitIceCompletionIfNeededAsync(G)})).then((function(){return re.getLocalParamsAsync()})).then((function(u){_checkIceCandidates(u),_assureChannels(d);var p=W.createAnswer(d,u,_getMediaChannelParams(),l);J.complete(),V.callbacks.onTransportInitialized&&V.callbacks.onTransportInitialized();var h=q.paramsToSdp(p);return U.debug(l?\"CREATE PRANSWER\":\"CREATE ANSWER\",\"sdp:\",h),{blob:h,contentType:ee}}));var d}function _initTransport(l,d,u){return re.assureInitAsync(l,d,u).then((function(){return re.getLocalParamsAsync()}))}function _createAudioElement(l){}function _getRawOutputAudioStream(){}function _setRawInputAudioStreamTrack(){}function _createOfferAsync(){return new Promise((function(d){if(X=!0,J.change(J.HAVE_LOCAL_OFFER,!0),x=I.excludePassiveModalities(L,le,k),!k||!k.video||k.video!==T.default.MEDIA_STATE.send&&k.video!==T.default.MEDIA_STATE.sendReceive||L.video!==T.default.MEDIA_STATE.inactive&&L.video!==T.default.MEDIA_STATE.receive||Q.forEach((function(l){l.getMediaParameters().descr.label===T.default.MEDIA_LABEL.video&&l.stopSender()})),k=x,I.hasSendDirectionality(x.sharing)&&!l.configProvider.config.ortcOutgoingScreenSharingEnabled)throw new Error(\"unsupported shreensharing send directionality in _negotiatingModalities \".concat(JSON.stringify(x)));var u=W.createMediaDescriptorsForOffer(x);d(_initTransport(\"controlling\",descrsNeedsTransports(u),!0).catch((function(l){if(\"IceGatherer failed!\"===l.message)return pe.IceGathererFailed=\"true\",U.safe.info(\"IceGatherer failed! Retry without relays\"),re.stop(),_initTransport(\"controlling\",descrsNeedsTransports(u),!1);throw l})).then((function(l){_checkIceCandidates(l),_assureChannels(u);var d=W.createOffer(u,l,_getMediaChannelParams());J.complete();var p=q.paramsToSdp(d);return U.debug(\"CREATE OFFER\",\"sdp:\",p),{blob:p,contentType:ee}})))}))}function _processAnswerAsync(l,d,u){void 0===d&&(d=(0,f.generateCauseId)());var p=l.blob;if(U.debug(u?\"PROCESS PRANSWER\":\"PROCESS ANSWER\",\"sdp:\",p),u)return J.change(J.HAVE_REMOTE_PRANSWER),U.safe.info(\"[\".concat(d,\"] ignoring provisional answer\")),Promise.resolve();ee=l.contentType;var h=q.sdpToParams(p),g=I.invertModalities(R.default.getModalitiesFromMedia(h.media)),m=I.getSendMediaModalities(g);return ne.start(m).then((function(){return J.change(J.HAVE_REMOTE_ANSWER),W.processAnswer(h),V.callbacks.onTransportInitialized&&V.callbacks.onTransportInitialized(),g}))}function _transportsToStart(l){var d=[];return l.forEach((function(l){l.descr.enabled&&-1===d.indexOf(l.descr.transportId)&&d.push(l.descr.transportId)})),d}function _bindChannelsToTransport(l){Q.forEach((function(d,u){d.setTransportId(l[u].descr.transportId)}))}function getMediaTypeFromLabel(l){switch(l){case T.default.MEDIA_LABEL.audio:return\"Audio\";case T.default.MEDIA_LABEL.video:return\"Video\";case T.default.MEDIA_LABEL.sharing:return\"ScreenShare\"}return null}function getLabelFromMediaType(l){switch(l){case\"Audio\":return T.default.MEDIA_LABEL.audio;case\"Video\":return T.default.MEDIA_LABEL.video;case\"ScreenShare\":return T.default.MEDIA_LABEL.sharing;default:return null}}function _completeNegotiationAsync(){return Promise.resolve().then((function(){J.change(J.STABLE,!0);var d=W.completeNegotiation(),u=d.media,finalize=function(l){var d=arguments[1];if(ne.stop(),l)return d;throw d};return _bindChannelsToTransport(u),re.configureTransportAsync(d,_transportsToStart(u)).then((function(){_assureAlive();for(var d=0;d<u.length;d++){var p=void 0,h=void 0;if(Q[d]){p=re.getTransportById(Q[d].getTransportId());var g=getMediaTypeFromLabel(u[d].descr.label);h=ne.streams[g]}if(u[d].descr.label===T.default.MEDIA_LABEL.audio){var f=Q[d].getRecvTrack();Q[d].configureChannel(u[d],p,h),Q[d].getRecvTrack()&&Q[d].getRecvTrack()!==f?(l.configProvider.userAgentConfig.isAudioOutputSelectionSupported&&ie.setOutputDevice(l.getDeviceManager().getOutputDeviceId()),ie.play(new MediaStream([Q[d].getRecvTrack()]))):!Q[d].getRecvTrack()&&f&&ie.stop()}else(u[d].descr.label===T.default.MEDIA_LABEL.video||u[d].descr.label===T.default.MEDIA_LABEL.sharing)&&Q[d].configureChannel(u[d],p,h)}updateRenderers(),J.complete(),Y=R.default.getModalitiesFromMedia(u);var m=I.excludePassiveModalities(L,le,k),v=$||!I.areNegotiatedDirectionsAcceptable(m,x,Y);return v&&_triggerRenegotiation(),U.safe.info(\"_completeNegotiationAsync: configured:\",JSON.stringify(L),\"_negotiatingModalities:\",JSON.stringify(x),\"activeModalities:\",JSON.stringify(Y)),{isComplete:!v,activeModalities:Y,offeredModalities:k,attemptedModalities:x,configuredModalities:L,initiator:X}})).then(finalize.bind(null,!0),finalize.bind(null,!1))}))}function updateRenderers(){ae.update(Q.filter((function(l){return T.default.MEDIA_LABEL.video===l.getLabel()||T.default.MEDIA_LABEL.sharing===l.getLabel()})))}function _rejectNegotiationAsync(l,d,u){return new Promise((function(p){var h=l.type===T.default.RENEGOTIATION_ERROR.local;J.state=J.STABLE,U.safe.error(\"[\".concat(d,\"] negotiation failed\"),\"error:\",E.stringifyObject(l)),u&&(U.safe.info(\"retrying failed negotiation\"),_triggerRenegotiation()),p({isComplete:h,activeModalities:Y,offeredModalities:k,attemptedModalities:x,configuredModalities:L,initiator:X})}))}function _createRemoteRenderer(l,d){return ae.create(l,d)}function _updateAudioOutputDevice(){var d=l.getDeviceManager().getOutputDeviceId();if(ie.getDeviceId()!==d&&l.configProvider.userAgentConfig.isAudioOutputSelectionSupported){ie.stop();var u=ie.getStream();ie.setOutputDevice(d),u&&ie.play(u)}}function _deviceSelectionChanged(){U.safe.info(\"_deviceSelectionChanged\");var l=I.getSendMediaModalities(Y);_isTerminated()||!l.Audio&&!l.Video||ne.stop().then((function(){return ne.start(l)})).then((function(){var d;return l.Audio&&ne.streams.Audio&&(d=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.audio),_updateAudioOutputDevice(),d.updateLocalMediaStream(ne.streams.Audio)),l.Video&&ne.streams.Video&&(d=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.video)).updateLocalMediaStream(ne.streams.Video),ne.stop()})).catch((function(l){_raiseError({type:T.default.MEDIA_ERROR.internalError,detail:l}),ne.stop()}))}function _getLastKnownStats(){return{type:\"OrtcMediaStats\",data:{}}}function _getStatsAsync(l){return _isTerminated()?oe:oe=new Promise((function(l){var u={type:\"OrtcMediaStats\",data:{},localStreams:[{tracks:[]}],remoteStreams:[{tracks:[]}]},p=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.audio),h=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.video),g=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.sharing);p&&p.getSendTrack()&&u.localStreams[0].tracks.push({stream:null,track:p.getSendTrack()}),h&&h.getSendTrack()&&u.localStreams[0].tracks.push({stream:null,track:h.getSendTrack()}),g&&g.getSendTrack()&&u.localStreams[0].tracks.push({stream:null,track:g.getSendTrack()}),p&&p.getRecvTrack()&&u.remoteStreams[0].tracks.push({stream:null,track:p.getRecvTrack()}),h&&h.getRecvTrack()&&u.remoteStreams[0].tracks.push({stream:null,track:h.getRecvTrack()}),g&&g.getRecvTrack()&&u.remoteStreams[0].tracks.push({stream:null,track:g.getRecvTrack()}),Promise.all([p?p.getReportsAsync():{},h?h.getReportsAsync():{},g?g.getReportsAsync():{}]).then((function(p){u.data={CorrelationId:d,mainAudio:p[0],mainVideo:p[1],appsharingVideo:p[2],Session:E.deepClone(pe)},l(u)})).catch((function(d){U.safe.error(\"getting statistics should never fail:\",d),l(u)}))}))}function _isTerminated(){return J.state===J.TERMINATED}function _assureAlive(){if(_isTerminated())throw new Error(\"session is already terminated\")}function _terminate(){return U.safe.info(\"terminate\"),_getStatsAsync().then((function(){J.change(J.TERMINATED),_cleanUp()}),_cleanUp)}function _cleanUp(){de.dispose(),ue.dispose(),re.stop(),ie&&ie.dispose(),ae&&ae.terminate(),Q.forEach((function(l){l.terminate()})),V.callbacks.onTerminated&&V.callbacks.onTerminated(),u=null}function _isReconnectSupported(){return l.configProvider.config.enableReconnectEdge}function _muteHold(l){var d,u;B=l;var p=[T.default.MODALITY.audio,T.default.MODALITY.video,T.default.MODALITY.sharing].filter((function(l){return I.hasSendDirectionality(L[l])&&(l!==T.default.MODALITY.audio||!j)}));try{for(var h=g(p),f=h.next();!f.done;f=h.next()){var m=f.value;_setMute(I.modalityToMediaType(m),l)}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}}function _muteInputAsync(){return p(this,void 0,void 0,(function(){return h(this,(function(l){return j=!0,[2,_setMute(\"Audio\",!0)]}))}))}function _unmuteInputAsync(){return p(this,void 0,void 0,(function(){return h(this,(function(l){return j=!1,_setMute(\"Audio\",!1),[2]}))}))}function _setMute(l,d){U.safe.info(\"call setMute for \".concat(l,\" with mute state \").concat(d)),Q.filter((function(d){return d.getLabel()===getLabelFromMediaType(l)})).forEach((function(l){return l.setMute(d)}))}function _muteOutputAsync(l){return void 0===l&&(l=(0,f.generateCauseId)()),ie.setMuted(!0,l),Promise.resolve()}function _unmuteOutputAsync(l){return void 0===l&&(l=(0,f.generateCauseId)()),ie.setMuted(!1,l),Promise.resolve()}function _sendDtmf(l){var d=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.audio);return d?d.sendDtmf(l):Promise.reject(new Error(\"no audio channel\"))}function _canSendDtmf(){var l=_findFirstChannelByLabel(Q,T.default.MEDIA_LABEL.audio);return!!l&&l.canSendDtmf()}function _getExtensionsManager(){return de}function _isFailed(){return re.iceTransport&&\"failed\"===re.iceTransport.state}function _isConnected(){return re.iceTransport&&(\"connected\"===re.iceTransport.state||\"completed\"===re.iceTransport.state)}function _getSessionConfig(){return l.configProvider}Object.defineProperty(this,\"relayManagerProvider\",{set:function(l){D=l,re.relayManagerProvider=D}}),ue.setStrategy(new v.DSHGeneratingStrategy({configProvider:l.configProvider})),U.info(\"create session\",\"config:\",l.config),this.onError=function(l){_raiseError(l)},this.onMediaCapabilitiesChanged=function(l,d){W.onMediaCapabilitiesChanged(l,d),J.state!==J.HAVE_LOCAL_ANSWER&&_triggerRenegotiation(!0)},this.onContributingSourcesChanged=function(l){J.state!==J.STABLE||J.changing||ue.onContributingSourcesChanged(l)},this.onAudioQualityChanged=function(l){V.callbacks.onAudioQualityChanged&&V.callbacks.onAudioQualityChanged(l)}}d.default={build:function(l,d,u){return new OrtcSession(l,d,u)}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(3),h=u(359),g=u(361),f=u(362),m=function(){function ExtensionFactory(){}return ExtensionFactory.getExtension=function(l){switch(l){case p.default.EXTENSION_TYPE.dominantSpeakerHistory:return new g.default;case p.default.EXTENSION_TYPE.videoStreamControl:return new f.default;case p.default.EXTENSION_TYPE.optimalVideoCount:return new h.default;default:throw new Error(\"Extension of type \".concat(l,\" is not found\"))}},ExtensionFactory}();d.default=m},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(3),g=u(360),f=function(l){function OptimalVideoCountExtension(){var d=l.call(this,h.default.EXTENSION_TYPE.optimalVideoCount)||this;return d.callback=null,d}return p(OptimalVideoCountExtension,l),OptimalVideoCountExtension.prototype.initialize=function(d){var u=this;l.prototype.initialize.call(this,d),this.extensionManagerSubscription=this.manager.on(\"onBandwidthMessage\",(function(l){return u.onBandwidthMessage(l)})),this.callback=d.callback,this.optimalCountCalculator=new g.OptimalReceiversCountCalculator(d.configProvider.config,d.logger.createChild(\"OptVideoCnt\")),this.optimalCountCalculator.on(\"onOptimalReceiversCountChanged\",(function(l){return u.callback&&u.callback(l)})),this.statisticsGatherer=d.statisticsGatherer,this.callback(d.configProvider.config.nonEstimatedDefaultVideoReceiversCount)},OptimalVideoCountExtension.prototype.dispose=function(){var d;this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null,this.callback=null,null===(d=this.optimalCountCalculator)||void 0===d||d.dispose(),l.prototype.dispose.call(this)},OptimalVideoCountExtension.prototype.onBandwidthMessage=function(l){var d,u;null===(d=this.statisticsGatherer)||void 0===d||d.addReportedReceiveBandwidth(l.bw),null===(u=this.optimalCountCalculator)||void 0===u||u.processEstimatedBandwidth(l.bw)},OptimalVideoCountExtension}(u(85).ExtensionBase);d.default=f},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.OptimalReceiversCountCalculator=void 0;var h=u(7),g=u(1),f=function(l){function OptimalReceiversCountCalculator(d,u){var p=l.call(this)||this;return p.settings=d,p.logger=u,p.bandwidthEstimationAvailable=!1,p.slidingWindow=[],p.optimalReceiversCount=0,p}return p(OptimalReceiversCountCalculator,l),OptimalReceiversCountCalculator.prototype.processEstimatedBandwidth=function(l){this.bandwidth=l,this.processOptimalReceiversCount()},OptimalReceiversCountCalculator.prototype.sample=function(l){if(this.slidingWindow.length>=this.settings.ovcSlidingWindowSamples?this.slidingWindow.shift():this.slidingWindow.length===this.settings.ovcSlidingWindowSamples-1&&(this.slidingWindow=this.slidingWindow.map((function(){return l}))),this.slidingWindow.push(l),this.slidingWindow.length>=this.settings.ovcSlidingWindowSamples){var d=this.slidingWindow.slice().sort(),u=g.average(d);return d[d.length-1]-(d[d.length-1]-u*(1-this.settings.ovcSlidingWindowPercentile))}return l},OptimalReceiversCountCalculator.prototype.processOptimalReceiversCount=function(){if(!(this.bandwidth<0)){this.bandwidth>0&&!this.bandwidthEstimationAvailable&&(this.bandwidthEstimationAvailable=!0);var l=Math.floor(this.sample(this.bandwidth)/this.settings.ovcBandwidthPerVideoReceiver);0!==(l=Math.min(l,this.settings.ovcMaxCount))||this.bandwidthEstimationAvailable||(l=this.settings.nonEstimatedDefaultVideoReceiversCount),this.optimalReceiversCount!==Math.max(l,1)&&(l?this.logger.safe.info(\"optimal video receivers count changed to \".concat(l)):(this.logger.safe.warn(\"there is not enough bandwidth even for a single video receiver\"),l=1),this.optimalReceiversCount=l,this.event(\"onOptimalReceiversCountChanged\").raise(this.optimalReceiversCount))}},OptimalReceiversCountCalculator}(h.default);d.OptimalReceiversCountCalculator=f},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(3),g=function(l){function DominantSpeakerHistoryExtension(){var d=l.call(this,h.default.EXTENSION_TYPE.dominantSpeakerHistory)||this;return d.callback=null,d}return p(DominantSpeakerHistoryExtension,l),DominantSpeakerHistoryExtension.prototype.initialize=function(d){var u=this;l.prototype.initialize.call(this,d),this.extensionManagerSubscription=this.manager.on(\"onDominantHistoryMessage\",(function(l){return u.onDominantHistoryMessage(l)})),d&&d.callback&&(this.callback=d.callback)},DominantSpeakerHistoryExtension.prototype.dispose=function(){this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null,this.callback=null,l.prototype.dispose.call(this)},DominantSpeakerHistoryExtension.prototype.onDominantHistoryMessage=function(l){this.callback&&this.callback(l.previousDominantSpeakerHistory,!0)},DominantSpeakerHistoryExtension}(u(85).ExtensionBase);d.default=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(3),g=u(85),f=u(363),m=u(369),v=function(l){function MediaStreamControlExtension(){var d=l.call(this,h.default.EXTENSION_TYPE.videoStreamControl)||this;return d.messageGenerator=new m.MediaControlMessageGenerator,d}return p(MediaStreamControlExtension,l),MediaStreamControlExtension.prototype.initialize=function(d){l.prototype.initialize.call(this,d),this.subscribeListeners(),this.sourceRequester=new m.SourceRequester(d.logger),this.streamConfigurationHandler=new f.MediaStreamConfigurationHandler(d.logger,d.negotiationEmulator,d.qualityManager,d.diagnostics,d.configProvider,d.statisticsGatherer)},MediaStreamControlExtension.prototype.configure=function(d){l.prototype.configure.call(this,d),this.sourceRequester.configure(d)},MediaStreamControlExtension.prototype.sendSourceRequest=function(l,d,u){var p=this.messageGenerator.getVideoControlMessage(l,d,u);return this.sourceRequester.sendMessage(1,p)},MediaStreamControlExtension.prototype.sendBandwidthInfo=function(l,d){var u=this.messageGenerator.getBandwidthInfoMessage(l,d);return this.sourceRequester.sendMessage(0,u)},MediaStreamControlExtension.prototype.sendMaxVideoSendCapabilities=function(l,d){var u=this.messageGenerator.getMaxVideoSendCapabilitiesMessage(l,d);return this.sourceRequester.sendMessage(0,u)},MediaStreamControlExtension.prototype.dispose=function(){this.unsubscribeListeners(),this.streamConfigurationHandler&&(this.streamConfigurationHandler.dispose(),this.streamConfigurationHandler=null),this.sourceRequester&&(this.sourceRequester.dispose(),this.sourceRequester=null),l.prototype.dispose.call(this)},MediaStreamControlExtension.prototype.onMediaStreamControlMessage=function(l){this.streamConfigurationHandler.handleMessage(l)},MediaStreamControlExtension.prototype.subscribeListeners=function(){var l=this;this.extensionManagerSubscription=this.manager.on(\"onMediaStreamControlMessage\",(function(d){return l.onMediaStreamControlMessage(d)}))},MediaStreamControlExtension.prototype.unsubscribeListeners=function(){this.extensionManagerSubscription.dispose(),this.extensionManagerSubscription=null},MediaStreamControlExtension}(g.ExtensionBase);d.default=v},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaStreamConfigurationHandler=void 0;var p=u(42),h=u(26),g=u(3),f=u(86),m=function(){function MediaStreamConfigurationHandler(l,d,u,p,g,m){this.logger=l,this.emulator=d,this.qualityManager=u,this.diagnostics=p,this.configProvider=g,this.statsGatherer=m,this.previousSequenceNumber=-1,this.modifiers=this.configProvider.mediaConfig.simulcastSessionEnabled?[]:[new f.BandwidthControlModifier(this.logger.createChild(\"rembModifier\"),this.qualityManager,new h.default(this.configProvider.config.resolutionTableOverride),this.configProvider)]}return MediaStreamConfigurationHandler.prototype.dispose=function(){this.cleanupDevToolsInjector(),this.modifiers&&(this.modifiers.forEach((function(l){return l.dispose()})),this.modifiers=null),this.emulator=null,this.logger=null},MediaStreamConfigurationHandler.prototype.handleMessage=function(l){var d,u;if(l.sequenceNumber<this.previousSequenceNumber)return this.statsGatherer.addVideoControlMessage(!0),null===(d=this.diagnostics)||void 0===d||d.addVideoControlMessage(!0),this.logger.safe.info(\"Discarded old media stream control message (\".concat(JSON.stringify(l),\")\")),Promise.resolve();this.statsGatherer.addVideoControlMessage(),null===(u=this.diagnostics)||void 0===u||u.addVideoControlMessage(),this.configProvider.config.enableDevtoolsAPI&&this.injectFmtpHandler(l);var p={controlVideoStreaming:l};return this.previousSequenceNumber=l.sequenceNumber,this.configureResolution(p),this.modifiers.length?(this.modifiers.forEach((function(l){return l.setVideoControlMessage(p)})),this.emulator.renegotiate(this.modifiers)):Promise.resolve()},MediaStreamConfigurationHandler.prototype.configureResolution=function(l){this.logger.safe.info(\"Signaling FMTP: \".concat(JSON.stringify(l.controlVideoStreaming)));var d=String(l.controlVideoStreaming.sequenceNumber),u=l.controlVideoStreaming.controlInfo[0].fmtParamsList,p=l.controlVideoStreaming.controlInfo[0].fmtParams,h=[{causeId:d,isSimulcast:!!u,capabilities:u&&this.configProvider.config.webrtcFmtParamListSupported?this.parseFmtParamsList(u):[this.parseFmtParams(p)],sourceId:+l.controlVideoStreaming.controlInfo[0].sourceId}];this.qualityManager.setMaxCapabilities(h)},MediaStreamConfigurationHandler.prototype.parseFmtParamsList=function(l){var d=this;return l.map((function(l){return d.parseFmtParams(l)}))},MediaStreamConfigurationHandler.prototype.parseFmtParams=function(l){var d=p.default.build(l);return{maxFs:+d.get(g.default.VIDEO_CAPABILITIES.MAX_FS_PATH),maxMbps:+d.get(g.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH),maxFps:+d.get(g.default.VIDEO_CAPABILITIES.MAX_FPS_PATH)/100,maxBr:1200*+d.get(g.default.VIDEO_CAPABILITIES.MAX_BR_PATH),ssrc:+d.get(g.default.VIDEO_CAPABILITIES.SSRC_PATH),rid:d.get(g.default.VIDEO_CAPABILITIES.RID_PATH),keyframe:this.shouldGenerateKeyFrame(d),vlaDebug:d.get(g.default.VIDEO_CAPABILITIES.VLA_DEBUG)}},MediaStreamConfigurationHandler.prototype.shouldGenerateKeyFrame=function(l){return l.get(g.default.VIDEO_CAPABILITIES.KEYFRAME_PATH)?!!+l.get(g.default.VIDEO_CAPABILITIES.KEYFRAME_PATH):this.configProvider.config.webrtcAllowRestoreKeyframe},MediaStreamConfigurationHandler.prototype.injectFmtpHandler=function(l){var d=window;d&&d.webMA&&(d.webMA.fmtp||(d.webMA.fmtp={handleMessage:this.handleMessage.bind(this)}),d.webMA.fmtp.lastFmtp=l)},MediaStreamConfigurationHandler.prototype.cleanupDevToolsInjector=function(){var l=window;l&&l.webMA&&delete l.webMA.fmtp},MediaStreamConfigurationHandler}();d.MediaStreamConfigurationHandler=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MsSdpTransform=void 0;var p=u(3),h=u(365),g=u(366),f=u(367),m=u(9),v={audio:\"main-audio\",video:\"main-video\"},y=function(){function MsSdpTransform(l,d){this.context=l,this.mediaManager=d,this.logger=this.context.logger,this.candidateTransform=h.default.build(),this.streamTransform=new f.SsrcTransform(this.context.configuration),this.rtcpTransform=g.default.build()}return MsSdpTransform.prototype.toMsSdp=function(l,d){var u=this;return l.msidSemantic={semantic:\"WMS\",token:\"*\"},l.media.forEach((function(h,g){if(h.protocol=p.default.PROFILES.rtpSavp,h.label=h.label||u.getLabel(h.type),0===h.port){for(var f in h)h.hasOwnProperty(f)&&[\"type\",\"port\",\"protocol\",\"payloads\"].indexOf(f)<0&&delete h[f];h.payloads=\"34\"}var m=u.getSsrcRangeForIndex(h.direction,g);u.streamTransform.toMsSdp(h,m),h.crypto&&h.crypto.forEach((function(l){l.config+=\"|2^31\"})),0!==h.port&&l.fingerprint&&(h.fingerprint=l.fingerprint),u.candidateTransform.toMsSdp(h,l),u.rtcpTransform.toMsSdp(h,d),h.invalid&&(u.logger.unsafe.error(\"Unknown SDP attributes! \".concat(JSON.stringify(h.invalid))),delete h.invalid),u.transformExtensions(h,!1),0!==h.port&&(h.type===p.default.MEDIA_TYPE.audio&&u.context.configProvider.config.webrtcAudioChannelSignalingFeedback?h.signalingFbXMessage={payload:\"*\",param:u.context.configProvider.config.webrtcAudioChannelSignalingFeedback}:h.type===p.default.MEDIA_TYPE.video&&u.context.configProvider.config.webrtcVideoChannelSignalingFeedback&&(h.signalingFbXMessage={payload:\"*\",param:u.context.configProvider.config.webrtcVideoChannelSignalingFeedback}))})),delete l.fingerprint,l},MsSdpTransform.prototype.fromMsSdp=function(l,d){for(var u=l.media.length-1;u>=0;--u){var p=l.media[u];if((p.ssrcs&&p.ssrcs[0]||p.xSsrcRange)&&(l.msidSemantic={semantic:\"WMS\",token:\"*\"}),0!==p.port){if(this.streamTransform.fromMsSdp(p),delete p.cryptoscale,p.fingerprint&&(!this.isOffer(d)||this.context.configProvider.config.disableIncomingDtlsRoleOverride&&p.setup||(p.setup=\"actpass\")),p.crypto)for(var h=p.crypto.length-1;h>=0;--h){var g=p.crypto[h];g.config.match(/.*\\|\\d+:\\d+/)?p.crypto.splice(h,1):g.config=g.config.replace(/(.*)\\|2\\^\\d+/,\"$1\")}p.remoteCandidates&&(delete p.candidates,delete p.xCandidatesIpv6,delete p.remoteCandidates),this.candidateTransform.fromMsSdp(p),p.rtcpFbXMessage&&delete p.rtcpFbXMessage,p.invalid&&this.logger.unsafe.info(\"Unknown SDP attributes! \".concat(JSON.stringify(p.invalid))),this.transformExtensions(p,!0)}else p.direction||(p.direction=\"inactive\")}return l},MsSdpTransform.prototype.transformExtensions=function(l,d){var u=[{name:p.default.ABS_SEND_TIME.EXT_URI,encoded:p.default.ABS_SEND_TIME.MSSDP_ENCODED_URI},{name:p.default.TRANSPORT_CC.EXT_URI,encoded:p.default.TRANSPORT_CC.MSSDP_ENCODED_URI}];l.ext&&l.ext.forEach((function(l){u.some((function(u){var p=d?u.encoded:u.name,h=d?u.name:u.encoded;return p===l.uri&&(l.uri=h,!0)}))}))},MsSdpTransform.prototype.isOffer=function(l){return\"offer\"===l},MsSdpTransform.prototype.getLabel=function(l){return v.hasOwnProperty(l)&&v[l]||\"undefined\"},MsSdpTransform.prototype.getSsrcRangeForIndex=function(l,d){var u=this.mediaManager.getMediaEntities()[d],p=null==u?void 0:u.getSimulcastContext();return m.hasSendDirectionality(l)&&p?p.getSsrcRange():0},MsSdpTransform}();d.MsSdpTransform=y},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(39);function CandidateTransform(){var l=[{jsep:\"active\",msSdp:\"tcp-act\"},{jsep:\"passive\",msSdp:\"tcp-pass\"},{jsep:\"so\",msSdp:\"tcp-so\"}];function transformBundle(l,d){if(l.port&&!l.candidates.length){var u=(0,p.getBundle)(d);u&&(l.port=u.port,l.connection=u.connection)}}function transformCandidate(l,d){delete l.generation,delete l[\"network-id\"],delete l[\"network-cost\"],l.transport.match(/tcp/i)&&transformTcpCandidate(l,d)}function transformTcpCandidate(d,u){l.some((function(l){if(u){if(l.msSdp===d.transport.toLowerCase())return d.transport=\"tcp\",d.tcptype=l.jsep,!0}else if(d.tcptype&&l.jsep===d.tcptype.toLowerCase())return d.transport=l.msSdp,delete d.tcptype,!0;return!1}))}function isDefault(l,d,u){var p=d.connection||u.connection,isSame=function(l,d,u){return l.port===u&&l.ip===d};return!!p&&(1===l.component?isSame(l,p.ip,d.port):!!d.rtcp&&isSame(l,d.rtcp.ip||p.ip,d.rtcp.port))}this.fromMsSdp=function(l){l.candidates=l.candidates||[],l.xCandidatesIpv6&&(l.xCandidatesIpv6.forEach((function(d){l.candidates.push(d)})),delete l.xCandidatesIpv6),l.candidates.forEach((function(l){transformCandidate(l,!0)}))},this.toMsSdp=function(l,d){l.candidates=l.candidates||[],l.candidates.sort((function(u,p){return u.foundation!==p.foundation?u.foundation-p.foundation:u.component!==p.component?u.component-p.component:+isDefault(p,l,d)-+isDefault(u,l,d)})),l.candidates=l.candidates.filter((function(d,u){transformCandidate(d,!1);var p=l.candidates[u-1];return!p||p.component!==d.component||p.foundation!==d.foundation})),transformBundle(l,d)}}d.default={build:function(){return new CandidateTransform}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function RtcpTransform(){}return RtcpTransform.prototype.toMsSdp=function(l,d){\"offer\"===d?l.rtcp&&(l.rtcp={port:l.port}):delete l.rtcp},RtcpTransform}();d.default={build:function(){return new p}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SsrcTransform=void 0;var p=u(1),h=u(3),g=u(368),f=[{label:h.default.MEDIA_LABEL.audio,id:g.default.STREAM_ID.audio},{label:h.default.MEDIA_LABEL.video,id:g.default.STREAM_ID.video},{label:h.default.MEDIA_LABEL.sharing,id:g.default.STREAM_ID.sharing}].reduce((function(l,d){return l[d.label]=d.id,l}),{}),m=p.uniqueId(),v=function(){function SsrcTransform(l){this.configuration=l}return SsrcTransform.prototype.fromMsSdp=function(l){var d=this;if(0!==l.port){var u=\"-\";if(!this.isRecvOnly(l)||this.configuration.unifiedPlanEnabled){if(l.msid){l.ssrcs&&1===l.ssrcs.length&&(this.addStream(l,l.ssrcs[0].id,l.ssrcs[0].value,l.msid),l.ssrcs.shift());var p=l.msid.split(\" \");(this.configuration.addPrefixForMsid||p[0]===u)&&(l.msid=this.getMsidValue(p[0],p[1]||p[0],l.label))}if(l.ssrcs)this.updateMsids(l.ssrcs,(function(p,h){return d.configuration.addPrefixForMsid||p===u?d.getMsidValue(p,h,l.label):\"\".concat(p,\" \").concat(h)}));else{var h=this.getFlowSsrcs(l);h.length>0?h.forEach((function(u){d.addStream(l,u,m,d.getMsidValue(h[0],h[0],l.label))})):l.xSsrcRange&&this.addStream(l,l.xSsrcRange.ssrcMin,m,this.getMsidValue(l.xSsrcRange.ssrcMin,l.xSsrcRange.ssrcMin,l.label))}}delete l.xSsrcRange}},SsrcTransform.prototype.toMsSdp=function(l,d){var u;0!==l.port&&(l.ssrcs&&l.ssrcs[0]&&(u=l.ssrcs[0].id),void 0!==u&&(l.xSsrcRange={ssrcMin:u,ssrcMax:u+d}))},SsrcTransform.prototype.getFlowSsrcs=function(l){var d;if(l.ssrcGroups&&l.type===h.default.MEDIA_TYPE.video&&(l.ssrcGroups.some((function(l){return\"FID\"===l.semantics&&(d=l,!0)})),d))return d.ssrcs.split(\" \").map((function(l){return+l}));return[]},SsrcTransform.prototype.addStream=function(l,d,u,p){l.ssrcs=l.ssrcs||[],l.ssrcs.push({attribute:\"cname\",id:d,value:u}),l.ssrcs.push({attribute:\"msid\",id:d,value:p})},SsrcTransform.prototype.updateMsids=function(l,d){l.filter((function(l){return\"msid\"===l.attribute})).forEach((function(l){var u=l.value.split(\" \");l.value=d(u[0],u[1]||u[0])}))},SsrcTransform.prototype.getMsidValue=function(l,d,u){var p=this.getMsidPrefix(u);return p+l+\" \"+p+d},SsrcTransform.prototype.getMsidPrefix=function(l){return f[l]?f[l]+g.default.STREAM_ID_DELIMITER:\"\"},SsrcTransform.prototype.isRecvOnly=function(l){return\"recvonly\"===l.direction},SsrcTransform}();d.SsrcTransform=v},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.default={STREAM_ID:{audio:\"mainAudio\",video:\"mainVideo\",sharing:\"applicationsharingVideo\"},STREAM_ID_DELIMITER:\"-\"}},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SourceRequester=d.MediaControlMessageGenerator=void 0;var g=u(3),f=function(){function MediaControlMessageGenerator(){this.sequence=0}return MediaControlMessageGenerator.prototype.getVideoControlMessage=function(l,d,u){var p={controlVideoStreaming:{sequenceNumber:++this.sequence,globalTimeStamp:(new Date).toString(),controlInfo:[{control:\"start\",sourceId:d,streamMsid:l}]}};return u&&(p.controlVideoStreaming.controlInfo[0].fmtParams=u),p},MediaControlMessageGenerator.prototype.getBandwidthInfoMessage=function(l,d){return{applyChannelParameters:{multiChannelParameter:{mids:l,mediaParameter:JSON.stringify({payload:{remoteUplinkBWE:{bw:d.toString()}}})}}}},MediaControlMessageGenerator.prototype.getMaxVideoSendCapabilitiesMessage=function(l,d){var u;function ceilToMacroblock(l){var d=16;return Math.ceil(l/d)*d}var p=((u={})[g.default.VIDEO_CAPABILITIES.MAX_FS_PATH]=d.maxFs,u[g.default.VIDEO_CAPABILITIES.MAX_FPS_PATH]=d.maxFps,u[g.default.VIDEO_CAPABILITIES.MAX_MBPS_PATH]=d.maxMbps,u[g.default.VIDEO_CAPABILITIES.MAX_WIDTH]=ceilToMacroblock(d.maxWidth),u[g.default.VIDEO_CAPABILITIES.MAX_HEIGHT]=ceilToMacroblock(d.maxHeight),u);return{applyChannelParameters:{multiChannelParameter:{mids:l,mediaParameter:JSON.stringify({payload:{maxVideoSendCapabilities:{caps:p}}})}}}},MediaControlMessageGenerator}();d.MediaControlMessageGenerator=f;var m=function(){function SourceRequester(l){this.logger=l}return SourceRequester.prototype.dispose=function(){this.sender=null},SourceRequester.prototype.configure=function(l){this.sender=l.sender},SourceRequester.prototype.sendMessage=function(l,d){return p(this,void 0,void 0,(function(){return h(this,(function(u){return this.checkConfigured()?(this.logger.safe.info(\"sending video control message: \".concat(JSON.stringify(d))),[2,this.sender.send(l,d)]):(this.logger.safe.warn(\"extension not configured with sender\"),[2,null])}))}))},SourceRequester.prototype.checkConfigured=function(){return!!this.sender},SourceRequester}();d.SourceRequester=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(26),h=u(1),g=u(142),f=u(3),m=u(371),v=u(87),y=u(372),S=u(50),_=\"h264\",C=\"opus\",E=\"vp8\",T=\"rtx\";function stringifyTransport(l){if(!l)return\"null\";if(!l.transport)return\"transport not set\";var d=l.transport.transport;return d?\"\".concat(d.component,\" \").concat(d.role,\" \").concat(d.state):\"ice transport not set\"}var b=function(){function OrtcMediaChannel(l,d,u,h,m,v,y,S){this.configProvider=l,this.channelId=d,this.logger=u,this.channelType=h,this.label=m,this.observer=v,this.ssrcGenerator=y,this.maintainResolution=S,this.contributingSourcesPollingInterval=1e3,this.doMute=!1,this.sendActive=!1,this.recvActive=!1,this.lastSources=[],this.subscribedMsi=f.default.MSI.unsubscribe,this.isSsrcUpdated=!1,this.networkSendQualityLevel=\"Good\",this.networkRecvQualityLevel=\"Good\",this.resolutionTable=new p.default(l.config.resolutionTableOverride);var _=l.config.ortcVideoCapabilityMaxFS,C=l.config.ortcVideoCapabilityMaxFPS;this.videoCapabilities=new g.default(_,C),this.ssrcRange=this.generateSsrcRange()}return OrtcMediaChannel.prototype.setTransportId=function(l){this.transportId=l},OrtcMediaChannel.prototype.getTransportId=function(){return this.transportId},OrtcMediaChannel.prototype.getLabel=function(){return this.label},OrtcMediaChannel.prototype.getType=function(){return this.channelType},OrtcMediaChannel.prototype.getSubscrbedMsi=function(){return this.subscribedMsi},OrtcMediaChannel.prototype.getMediaParameters=function(){return this.mediaParams},OrtcMediaChannel.prototype.getLocalParameters=function(){var l=h.deepClone(this.getLocalRtpCaps());this.updateCodecParameters(l);var d={rtpCaps:l,rtxSsrc:this.getRtxSsrc(this.ssrcRange),ssrcRange:this.ssrcRange};return{sender:d,receiver:h.deepClone(d)}},OrtcMediaChannel.prototype.configureChannel=function(l,d,u){this.logger.safe.info(\"configureChannel\",\"type:\",this.channelType,\"transport:\",stringifyTransport(d)),this.logger.info(\"descr:\",JSON.stringify(l.descr)),this.mediaParams=l,l.descr.enabled?(this.configureSsrc(l.receiver,l.sender),this.configureReceiver(l.descr,l.receiver,d),this.configureSender(l.descr,l.sender,d,u)):this.disable()},OrtcMediaChannel.prototype.updateLocalMediaStream=function(l){this.rtpSender&&this.replaceMediaStreamIfDifferent(l)},OrtcMediaChannel.prototype.canSubscribe=function(){return this.recvActive&&this.rtpReceiver&&this.subscribedMsi===f.default.MSI.unsubscribe&&this.isVideo()},OrtcMediaChannel.prototype.subscribe=function(l){if(this.subscribedMsi===f.default.MSI.unsubscribe&&this.isVideo())return this.subscribedMsi=l,this.requestSendCsrc(this.subscribedMsi);throw new Error(\"invalid call for subscribe:\"+this.subscribedMsi+\"type:\"+this.channelType)},OrtcMediaChannel.prototype.unsubscribe=function(){if(this.subscribedMsi===f.default.MSI.unsubscribe||!this.isVideo())throw new Error(\"invalid call for unsubscribe:\"+this.subscribedMsi+\"type:\"+this.channelType);this.subscribedMsi=f.default.MSI.unsubscribe,this.requestSendCsrc(this.subscribedMsi)},OrtcMediaChannel.prototype.getReportsAsync=function(){var l=this.recvActive?this.rtpReceiver:null,d=this.sendActive?this.rtpSender:null,u=l?l.transport.transport:d?d.transport.transport:null;return m.default.build({logger:this.logger},u,d,l).getReport()},OrtcMediaChannel.prototype.getSendTrack=function(){return this.sendActive&&this.rtpSender?this.rtpSender.track:null},OrtcMediaChannel.prototype.getRecvTrack=function(){return this.recvActive&&this.rtpReceiver?this.recvTrack:null},OrtcMediaChannel.prototype.terminate=function(){this.disable(),this.logger.safe.info(\"terminated\")},OrtcMediaChannel.prototype.sendDtmf=function(l){return this.dtmfSender.sendDtmf(this.rtpSender,l)},OrtcMediaChannel.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.rtpSender)},OrtcMediaChannel.prototype.videoSizeChanged=function(l,d){var u=this,p=this.resolutionTable.getMaxFS(l,d);this.videoCapabilities?this.mediaParams.receiver?this.videoCapabilities.setMaxFS(p,(function(l){var d=u.mediaParams.receiver.rtpCaps.codecs[0];d.name.toLowerCase()===_&&u.observer.onMediaCapabilitiesChanged(v.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED,{mediaId:u.channelId,codecName:d.name,capabilities:{\"max-fs\":l.getMaxFS(),\"max-mbps\":l.getMaxMBPS(),\"max-fps\":l.getMaxFPS()}})})):this.logger.safe.warn(\"no incoming video\"):this.logger.safe.error(\"no capabilities for provided modality:\",self)},OrtcMediaChannel.prototype.setMute=function(l){this.doMute=l,this.currMediaStreamRef&&this.currMediaStreamRef.setMuted(l)},OrtcMediaChannel.prototype.preconfigureChannel=function(l){if(l){this.logger.safe.debug(\"Preconfigure with remote ssrc:\",l.remoteSsrcRange),this.logger.safe.debug(\"Preconfigure label\",this.label,\"to\",l.label),this.label=l.label;var d=this.rtpReceiver&&this.hasSsrcChanged(l.remoteSsrcRange,this.recvRemoteSsrc),u=this.rtpSender&&this.hasSsrcChanged(l.remoteSsrcRange,this.sendRemoteSsrc);(d||u)&&(this.isSsrcUpdated=!0,this.updateSsrcRange())}},OrtcMediaChannel.prototype.getLocalRtpCaps=function(){return this.localRtpCaps||(this.localRtpCaps=this.gatherLocalRtpCaps()),this.localRtpCaps},OrtcMediaChannel.prototype.gatherLocalRtpCaps=function(){var l=this,d=this.typeToString(this.channelType),u=RTCRtpReceiver.getCapabilities(d);if(!u.codecs)return u;if(this.channelType===v.MediaChannelType.Audio&&this.configProvider.config.audioCodec){var p=[\"cn\",\"red\"];h.remove(u.codecs,(function(d){var u=d.name.toLowerCase();return u!==l.configProvider.config.audioCodec.toLowerCase()&&-1===p.indexOf(u)}))}else this.channelType===v.MediaChannelType.Video&&this.configProvider.config.videoCodec&&h.remove(u.codecs,(function(d){return d.name.toLowerCase()!==l.configProvider.config.videoCodec.toLowerCase()}));if(this.channelType===v.MediaChannelType.Audio)for(var g=u.codecs.length-1;g>=0;g--){var f=u.codecs[g];f.name.toLowerCase()===C&&(f.preferredPayloadType=111,this.logger.safe.info(\"Opus payloadType fix, change payload type to 111 for\",f.name))}if(this.channelType===v.MediaChannelType.Video){var m=u.codecs.find((function(l){return l.name.toLowerCase()===E}));m&&h.remove(u.codecs,(function(l){return l.name.toLowerCase()===E||l.name.toLowerCase()===T&&m.preferredPayloadType===+l.parameters.apt}))}return u},OrtcMediaChannel.prototype.getRtxSsrc=function(l){var d=this.getLocalRtpCaps();return S.default.hasRtx(d.codecs)?this.ssrcRange.min+50:0},OrtcMediaChannel.prototype.replaceMediaStreamIfDifferent=function(l){var d,u;this.isAudio()?(u=this.currMediaStreamRef.rawStream.getAudioTracks()[0],d=l.rawStream.getAudioTracks()):(u=this.currMediaStreamRef.rawStream.getVideoTracks()[0],d=l.rawStream.getVideoTracks());var p=d.length?d[0]:null;if(null!==p){var h=u.getSettings().deviceId,g=p.getSettings().deviceId;if(h!==g){this.logger.safe.info(\"replacing media track\",\"currDevID:\",h,\"newDevID:\",g,\"currTrackID:\",u.id,\"newTrackID:\",p.id);var f=l.clone();f.setMuted(this.doMute),this.isAudio()?this.rtpSender.setTrack(f.rawStream.getAudioTracks()[0]):this.rtpSender.setTrack(f.rawStream.getVideoTracks()[0]),this.currMediaStreamRef.dispose(),this.currMediaStreamRef=f}else this.logger.safe.info(\"NOT replacing media track\",\"currDevID:\",h,\"newDevID:\",g,\"currTrackID:\",u.id,\"newTrackID:\",p.id)}else this.logger.safe.error(\"media track is not available\")},OrtcMediaChannel.prototype.isAudio=function(){return this.channelType===v.MediaChannelType.Audio},OrtcMediaChannel.prototype.isVideo=function(){return this.channelType===v.MediaChannelType.Video},OrtcMediaChannel.prototype.updateContributingSources=function(){var l=this;if(this.recvActive&&this.rtpReceiver){var d=void 0;try{d=this.rtpReceiver.getContributingSources()}catch(l){return void this.logger.safe.error(\"failed to retrieve contributing sources from receiver\",\"error:\",l)}if(!d)return void this.logger.safe.warn(\"could not retrieve contributing sources from receiver\");var u=d.map((function(l){return l.csrc}));this.lastSources.length===u.length&&u.every((function(d,u){return d===l.lastSources[u]}))||(this.logger.safe.debug(\"contributing sources changed\",\"sources:\",u),this.observer.onContributingSourcesChanged(u)),this.lastSources=u,setTimeout(this.updateContributingSources.bind(this),this.contributingSourcesPollingInterval)}else this.logger.safe.debug(\"receiver is missing, stop polling for contributing sources\")},OrtcMediaChannel.prototype.requestSendCsrc=function(l){if(this.recvActive&&this.rtpReceiver){this.logger.safe.info(\"_requestSendCsrc\",\"csrc:\",l);try{this.rtpReceiver.requestSendCSRC(l)}catch(l){this.logger.safe.error(\"failed to request send csrc\",\"error:\",l)}return!0}return!1},OrtcMediaChannel.prototype.raiseAudioQualityEvent=function(l){var d={type:\"NetworkSendQuality\",value:\"Good\",isLocalSource:!0,mediaType:\"Audio\"};if(\"NetworkSendQuality\"===l.name)d.type=\"NetworkSendQuality\";else{if(\"NetworkReceiveQuality\"!==l.name)return;d.type=\"NetworkRecvQuality\"}if(\"Good\"===l.value)d.value=\"Good\";else if(\"Poor\"===l.value)d.value=\"Poor\";else{if(\"Bad\"!==l.value&&\"Catastrophic\"!==l.value)return;d.value=\"Bad\"}if(\"NetworkSendQuality\"===d.type){if(this.networkSendQualityLevel===d.value)return;this.networkSendQualityLevel=d.value}else if(\"NetworkRecvQuality\"===d.type){if(this.networkRecvQualityLevel===d.value)return;this.networkRecvQualityLevel=d.value}this.observer.onAudioQualityChanged(d)},OrtcMediaChannel.prototype.createReceiver=function(l,d){var u=this;this.logger.safe.info(\"_rtpReceiver create\");var p=this.typeToString(this.channelType);this.rtpReceiver=new RTCRtpReceiver(l.transport,p),this.recvTrack=this.rtpReceiver.track,this.rtpReceiver.onerror=function(l){u.logger.safe.error(\"_rtpReceiver.onerror\",\"event:\",l),u.observer.onError({type:f.default.MEDIA_ERROR.internalError,detail:JSON.stringify(l),isAudio:u.channelType===v.MediaChannelType.Audio})},this.rtpReceiver.onmsquality=function(l){l.messages.forEach((function(l){u.logger.safe.info(\"this.rtpReceiver.onmsquality\",\"event:\",l),u.raiseAudioQualityEvent(l)}))}},OrtcMediaChannel.prototype.createSender=function(l,d,u){var p,h=this;p=this.isAudio()?d.rawStream.getAudioTracks()[0]:d.rawStream.getVideoTracks()[0],this.logger.safe.info(\"this.rtpSender create trackID:\",p.id,\" transport: \",stringifyTransport(l)),this.rtpSender=new RTCRtpSender(p,l.transport),this.logger.safe.info(\"this.rtpSender created\"),this.rtpSender.onerror=function(l){h.logger.safe.error(\"this.rtpSender.onerror\",\"event:\",l),h.observer.onError({type:f.default.MEDIA_ERROR.internalError,detail:JSON.stringify(l),isAudio:h.channelType===v.MediaChannelType.Audio})},this.rtpSender.onmsquality=function(l){l.messages.forEach((function(l){h.logger.safe.info(\"this.rtpSender.onmsquality\",\"event:\",l),h.raiseAudioQualityEvent(l)}))},this.rtpSender.onssrcconflict=function(l){h.logger.safe.error(\"this.rtpSender.onssrcconflict\",\"event:\",l)}},OrtcMediaChannel.prototype.getRecvParams=function(l){var d=S.default.getRecvParams(l.rtpCaps,l.remoteSsrcRange,this.ssrcRange.min,l.rtcpReducedSize,l.rtcpMux,l.rtxSsrc);return this.maintainResolution&&(d.degradationPreference=\"maintain-resolution\"),d.encodings[0].active=this.recvActive,d},OrtcMediaChannel.prototype.getSendParams=function(l){var d=S.default.getSendParams(l.rtpCaps,this.ssrcRange,l.remoteSsrcRange.min,l.rtcpReducedSize,l.rtcpMux,l.rtxSsrc);return d.encodings[0].active=this.sendActive,d},OrtcMediaChannel.prototype.configureSsrc=function(l,d){(this.rtpReceiver&&this.hasSsrcChanged(l.remoteSsrcRange,this.recvRemoteSsrc)||this.rtpSender&&this.hasSsrcChanged(d.remoteSsrcRange,this.sendRemoteSsrc))&&!this.isSsrcUpdated?this.updateSsrcRange():this.isSsrcUpdated=!1},OrtcMediaChannel.prototype.updateSsrcRange=function(){var l=this.generateSsrcRange();this.logger.safe.debug(\"SSRC updating: \",this.ssrcRange,\" -> \",l),this.ssrcRange=l,this.observer.onMediaCapabilitiesChanged(v.VideoCapabilitiesEventType.SSRC_UPDATED,{mediaId:this.channelId,ssrcRange:this.ssrcRange,rtxSsrc:this.getRtxSsrc(this.ssrcRange)})},OrtcMediaChannel.prototype.configureReceiver=function(l,d,u){this.rtpReceiver&&this.hasSsrcChanged(d.remoteSsrcRange,this.recvRemoteSsrc)&&(this.logger.safe.info(\"SSRC changed, resetting receiver\"),this.stopReceiver()),this.rtpReceiver||(this.createReceiver(u,d),this.recvRemoteSsrc=d.remoteSsrcRange),this.recvActive=!!l.recv;var p=this.getRecvParams(d);this.logger.safe.debug(\"rtpReceiver.receive:\",JSON.stringify(p)),this.rtpReceiver.receive(p),this.recvActive&&(this.isAudio()?this.updateContributingSources():this.subscribedMsi!==f.default.MSI.unsubscribe&&this.requestSendCsrc(this.subscribedMsi))},OrtcMediaChannel.prototype.stopReceiver=function(){this.rtpReceiver&&(this.logger.safe.info(\"_rtpReceiver stop & destroy\"),this.recvActive=!1,this.recvTrack=null,this.rtpReceiver.stop(),this.rtpReceiver=null)},OrtcMediaChannel.prototype.configureSender=function(l,d,u,p){if(this.rtpSender&&this.hasSsrcChanged(d.remoteSsrcRange,this.sendRemoteSsrc)&&(this.logger.safe.info(\"SSRC changed, resetting sender\"),this.stopSender()),this.sendActive=!!l.send,this.sendActive&&p){this.currMediaStreamRef?this.replaceMediaStreamIfDifferent(p):(this.currMediaStreamRef=p.clone(),this.currMediaStreamRef.setMuted(this.doMute)),this.rtpSender||(this.createSender(u,this.currMediaStreamRef,d),this.sendRemoteSsrc=d.remoteSsrcRange),this.dtmfSender||(this.dtmfSender=new y.default({logger:this.logger,configProvider:this.configProvider})),this.logger.safe.debug(\"this.rtpSender.configureSender\",JSON.stringify(d));var h=this.getSendParams(d);this.logger.safe.debug(\"this.rtpSender.send:\",JSON.stringify(h)),this.rtpSender.send(h)}else this.stopSender(),this.disposeLocalStream()},OrtcMediaChannel.prototype.stopSender=function(){this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.rtpSender&&(this.logger.safe.info(\"this.rtpSender stop & destroy\"),this.sendActive=!1,this.rtpSender.stop(),this.rtpSender=null)},OrtcMediaChannel.prototype.disposeLocalStream=function(){this.currMediaStreamRef&&(this.currMediaStreamRef.dispose(),this.currMediaStreamRef=null)},OrtcMediaChannel.prototype.hasSsrcChanged=function(l,d){return d&&l&&!h.deepEqual(l,d)},OrtcMediaChannel.prototype.updateCodecParameters=function(l){var d=l.codecs.find((function(l){return l.name.toLowerCase()===_}));d&&d.parameters&&(d.parameters[\"max-fs\"]=this.videoCapabilities.getMaxFS(),d.parameters[\"max-mbps\"]=this.videoCapabilities.getMaxMBPS(),d.parameters[\"max-fps\"]=this.videoCapabilities.getMaxFPS())},OrtcMediaChannel.prototype.disable=function(){this.stopReceiver(),this.stopSender(),this.disposeLocalStream()},OrtcMediaChannel.prototype.generateSsrcRange=function(){return this.channelType===v.MediaChannelType.Audio?this.ssrcGenerator.nextAudioStreamSsrc():this.channelType===v.MediaChannelType.Video?this.ssrcGenerator.nextVideoStreamSsrc():null},OrtcMediaChannel.prototype.typeToString=function(l){return v.MediaChannelType[l].toLowerCase()},OrtcMediaChannel}();d.default=b},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(48),h=u(1);function OrtcChannelStats(l,d,u,g){var f=l.logger.createChild(\"ChannelStats\");function getMediaDiagnosticReason(){if(!d)return\"CheckNotCompleted\";var l=d.state;return\"new\"===l||\"checking\"===l||\"connected\"===l?\"CheckNotCompleted\":\"completed\"===l?\"CheckSucceed\":\"failed\"===l||\"closed\"===l?\"CheckFailed\":\"disconnected\"===l?\"MediaTimeout\":\"Unknown DiagnosticReason\"}this.getReport=function(){var l={};function updateReportWith(d,u,g){if(!d)return null;var m=u+\".\"+(g?\"msGetStats\":\"getStats\"),v=new Promise((function(l){f.safe.info(m,\"start\"),l(g?d.msGetStats():d.getStats())})).then((function(d){f.safe.info(m,\"complete\"),l[u]=l[u]||{},h.forOwn(d,(function(d){l[u][d.type||d.msType]=d}))})).catch((function(l){f.safe.warn(m,\"failed:\",l)}));return p.timeout(v,5e3,m).catch((function(l){f.safe.warn(m,\"failed:\",l)}))}return l.extended={mediaDiagnostic:{reason:getMediaDiagnosticReason()}},new Promise((function(p){Promise.all([updateReportWith(d,\"iceTransport\",!1),updateReportWith(d,\"iceTransport\",!0),updateReportWith(u,\"sender\",!1),updateReportWith(u,\"sender\",!0),updateReportWith(g,\"receiver\",!1),updateReportWith(g,\"receiver\",!0)]).then((function(){p(l)})).catch((function(d){f.safe.error(\"getting statistics should never fail\",d),p(l)}))}))}}d.default={build:function(l,d,u,p){return new OrtcChannelStats(l,d,u,p)}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(143),h=function(){function OrtcDTMFSender(l){this.queue=new p.DTMFQueue(l.logger),this.configProvider=l.configProvider}return OrtcDTMFSender.prototype.sendDtmf=function(l,d){return l?(this.syncSender(l),this.ortcSender.canInsertDTMF?(this.ortcSender.insertDTMF(this.ortcSender.toneBuffer+d,this.configProvider.config.dtmf.toneDuration,this.configProvider.config.dtmf.toneGap),this.queue.waitForNotification(d)):Promise.reject(new Error(\"not available\"))):Promise.reject(new Error(\"bad sender\"))},OrtcDTMFSender.prototype.canSendDtmf=function(l){return!!l&&(this.syncSender(l),!!this.ortcSender&&this.ortcSender.canInsertDTMF)},OrtcDTMFSender.prototype.dispose=function(){this.queue.cleanup()},OrtcDTMFSender.prototype.syncSender=function(l){this.ortcSender&&this.ortcSender.sender===l||(this.ortcSender&&(this.ortcSender.ontonechange=null,this.queue.cleanup(),this.ortcSender=null),this.ortcSender=new RTCDtmfSender(l),this.ortcSender.ontonechange=this.onToneChange.bind(this))},OrtcDTMFSender.prototype.onToneChange=function(l){l.tone&&this.queue.toneSent(l.tone)},OrtcDTMFSender}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=u(3),g=u(87),f=u(50);function OrtcNegotiation(l,d,u){var m=u&&d.config.numVideoChannelsGvc?d.config.numVideoChannelsGvc:1;this.processOffer=_processOffer,this.createMediaDescriptorsForAnswer=_createMediaDescriptorsForAnswer,this.createAnswer=_createAnswer,this.createMediaDescriptorsForOffer=_createMediaDescriptorsForOffer,this.createOffer=_createOffer,this.processAnswer=_processAnswer,this.completeNegotiation=_completeNegotiation,this.onMediaCapabilitiesChanged=_onMediaCapabilitiesChanged,this.supportsBundling=_supportsBundling;var v=null,y=null,S=null,_=!1;function _supportsBundling(l,u){return u||d.config.ortcPreferBundling||l&&l.bundledOnly?l&&l.groups&&l.groups.length>0:_}function _processOffer(d){v=d,l.debug(\"PROCESS OFFER\",\"params:\",JSON.stringify(v))}function _negotiateMediaDescriptor(l,d){var u=d.descr;u||(u={enabled:!0,send:!0,recv:!0});var p=l.send&&l.enabled&&u.recv&&u.enabled,h=l.recv&&l.enabled&&u.send&&u.enabled,g=l.enabled&&u.enabled&&(p||h||!l.send&&!l.recv||!u.send&&!u.recv),f=d.receiver.ssrcRange;return{enabled:g,mediaId:l.mediaId,mid:void 0===u.mid?null:u.mid.toString(),type:l.type,transportId:l.transportId,needsTransport:l.needsTransport,label:l.label,send:p,recv:h,remoteSsrcRange:f}}function _createMediaDescriptorsForAnswer(l){if(S&&S.media.length>v.media.length)throw new Error(\"Invalid remote offer - removed media lines\");var d,u=[],p=!1,g=!1,y=0;_=_supportsBundling(v,!1);for(var C=0;C<v.media.length;C++){if(S&&S.media[C]){if(S.media[C].type!==v.media[C].type)throw new Error(\"Changing media type not supported\");if(S.media[C].label&&v.media[C].label&&S.media[C].label!==v.media[C].label)throw new Error(\"Changing media label not supported\")}v.media[C].descr.label!==h.default.MEDIA_LABEL.audio||p?v.media[C].descr.label===h.default.MEDIA_LABEL.video&&y<m?((d=_negotiateMediaDescriptor(f.default.getDescrFromState(l,h.default.MEDIA_LABEL.video,C),v.media[C])).needsTransport=!0,y>0&&(d.send=!1,d.needsTransport=!1),u.push(d),y++):v.media[C].descr.label!==h.default.MEDIA_LABEL.sharing||g?u.push({enabled:!1,type:v.media[C].descr.type,label:S&&S.media[C]?S.media[C].descr.label:v.media[C].descr.label}):((d=_negotiateMediaDescriptor(f.default.getDescrFromState(l,h.default.MEDIA_LABEL.sharing,C),v.media[C])).needsTransport=!0,u.push(d),g=!0):((d=_negotiateMediaDescriptor(f.default.getDescrFromState(l,h.default.MEDIA_LABEL.audio,C),v.media[C])).needsTransport=!0,u.push(d),p=!0)}if(_){var E=!1;u.forEach((function(l){!E&&l.needsTransport?E=!0:l.needsTransport=!1}))}return u}function _createTransportParams(l,u,p){for(var h=0;h<l.length;h++)if(l[h]&&(l[h].doRtcpMux=!(u[h]&&!u[h].doRtcpMux)),l[h]&&u[h]){for(var g=!1,m=0;!d.config.disableSdes&&m<u.length;m++)u[m]&&u[m].sdesParamsList&&u[m].sdesParamsList.length&&(g=!0);u[h].doRtcpMux&&(l[h].rtcpIceParams=null,l[h].rtcpIceCandidates=null),l[h].dtlsParams&&u[h].dtlsParams&&(l[h].dtlsParams.role=\"client\"===u[h].dtlsParams.role?\"server\":\"client\"),!g&&u[h].dtlsParams||(l[h].dtlsParams=null),g||(l[h].sdesParamsList=[]);var v=null;l[h].sdesParamsList&&u[h].sdesParamsList&&(v=f.default.findMatchingSdesParams(l[h].sdesParamsList,u[h].sdesParamsList))&&(v.localSdesParams.tag=v.remoteSdesParams.tag,l[h].sdesParamsList=[v.localSdesParams],l[h].remoteSdesParams=v.remoteSdesParams)}else l[h]&&l[h].dtlsParams&&(l[h].dtlsParams.role=null);return l}function _matchChannelParams(l,d,u,p){var h=p?l.sender:l.receiver,g=p?d.receiver:d.sender,m=f.default.matchRtpCaps(h.rtpCaps,g.rtpCaps,u,p);return{mid:u?h.mid:g.mid,transportId:h.transportId,ssrcRange:h.ssrcRange,remoteSsrcRange:g.ssrcRange,rtxSsrc:f.default.getRtxSsrc(m,h,g,p),rtpCaps:m}}function _createMediaParams(l,d,u,p,h){if(l.enabled){var g=d;return g.sender.rtcpReducedSize=h,g.receiver.rtcpReducedSize=h,g.descr=l,g.justAdded=u,g.bundledWithOther=p,g}return{descr:l}}function _createAnswer(d,u,g,f){for(var m,S={isOffer:!1,sessionVersion:v.sessionVersion,transportParams:_createTransportParams(u,v.transportParams),media:[],bundled:_,groups:[]},C=!1,E=!1,T=0,b=0,I=0;I<d.length;I++){var A=E&&d[I].label===h.default.MEDIA_LABEL.video||C&&S.bundled,R={},P=p.shallowClone(d[I]);if(P.enabled){C=!0;var O=_matchChannelParams(g[I],v.media[I],!1,!1),M=_matchChannelParams(g[I],v.media[I],!1,!0);R.receiver=O,R.sender=M,m=P.needsTransport?u[T]:u[b],P.transportId=m.transportId,P.needsTransport&&(b=T,T++),P.label===h.default.MEDIA_LABEL.video&&(P.firstVideoChannel=!E,E=!0),_verifyTransportAndMediaParams(P,m,R.receiver)&&_verifyTransportAndMediaParams(P,m,R.sender)||(P.enabled=!1,l.safe.warn(\"Rejecting media since unable to match parameters\"))}S.media.push(_createMediaParams(P,R,!1,A,v.media[I].receiver.rtcpReducedSize))}l.debug(f?\"CREATE PRANSWER\":\"CREATE ANSWER\",\"params:\",JSON.stringify(S)),f||(y=_verifyAndNegotiateParameters(S,v,!1));var w=[];return S.media.forEach((function(l){_&&l.descr.enabled&&l.descr.mid&&w.push(l.descr.mid)})),S.groups=w,S}function _createMediaDescriptorsForOffer(l){var d=[],p=!1,g=!1,v=0,y=0;if(S)for(var C=0;C<S.media.length;C++){var E=void 0;S.media[C].descr.label!==h.default.MEDIA_LABEL.audio||p?S.media[C].descr.label===h.default.MEDIA_LABEL.video&&v<m?((E=f.default.getDescrFromState(l,h.default.MEDIA_LABEL.video,y++)).needsTransport=!0,v>0&&(E.send=!1,E.needsTransport=!1),v++):S.media[C].descr.label!==h.default.MEDIA_LABEL.sharing||g?E={enabled:!1,type:S.media[C].descr.type,label:S.media[C].descr.label}:((E=f.default.getDescrFromState(l,h.default.MEDIA_LABEL.sharing,y++)).needsTransport=!0,g=!0):((E=f.default.getDescrFromState(l,h.default.MEDIA_LABEL.audio,y++)).needsTransport=!0,p=!0),E.enabled&&(E.mid=S.media[C].descr.mid),d.push(E)}!p&&l.audio&&((E=f.default.getDescrFromState(l,h.default.MEDIA_LABEL.audio,y++)).needsTransport=!0,d.push(E));for(var T=v;T<m&&l.video;T++){var E=f.default.getDescrFromState(l,h.default.MEDIA_LABEL.video,y++);T>0?(E.send=!1,E.needsTransport=!1):E.needsTransport=!0,d.push(E)}!g&&l.sharing&&((E=f.default.getDescrFromState(l,h.default.MEDIA_LABEL.sharing,y++)).needsTransport=!0,d.push(E));for(C=0;C<d.length;C++)d[C].mid||(d[C].mid=\"m\"+C);if(u&&(_=!0),_){var b=!1;d.forEach((function(l){!b&&l.needsTransport?b=!0:l.needsTransport=!1}))}return d}function _createOffer(d,u,p){for(var g={isOffer:!0,sessionVersion:S?S.sessionVersion:0,transportParams:_createTransportParams(u,S?S.transportParams:[]),groups:[],bundled:_,media:[]},f=!1,m=!1,y=0,C=0,E=0;E<d.length;E++){var T=S&&S.media[E]&&S.media[E].descr.enabled,b=!T&&d[E].enabled,I=void 0,A=m&&d[E].label===h.default.MEDIA_LABEL.video||g.bundled&&f;d[E].enabled&&d[E].mid&&g.groups.push(d[E].mid),I=b?p[E]:S.media[E],d[E].transportId=d[E].needsTransport?u[y].transportId:u[C].transportId,d[E].needsTransport&&(C=y,y++),f=f||T||b,d[E].label===h.default.MEDIA_LABEL.video&&(d[E].firstVideoChannel=!m,m=!0),g.media.push(_createMediaParams(d[E],I,b,A,!0))}return v=g,l.debug(\"CREATE OFFER\",\"params:\",JSON.stringify(v)),v}function _processAnswer(d){l.debug(\"PROCESS ANSWER\",\"params:\",JSON.stringify(d)),y=_verifyAndNegotiateParameters(v,d,!0)}function _verifyTransportAndMediaParams(d,u,p){if(d.enabled){if(!u.sdesParamsList&&!u.dtlsParams)return l.warn(\"no sdes nor dtls params:\",u.sdesParamsList,u.dtlsParams),!1;if(!p.rtpCaps.codecs.length)return l.safe.warn(\"no common codecs!\",p.rtpCaps),!1}return!0}function _getNegotiatedTransportParams(l,d,u){for(var h=[],g=0;g<Math.max(l.length,d.length);g++){var m=null;if(l[g]&&d[g]){(m=p.shallowClone(d[g])).doRtcpMux=l[g].doRtcpMux&&d[g].doRtcpMux,m.enableDtls=l[g].dtlsParams&&d[g].dtlsParams,m.transportId=l[g].transportId;var v=null;l[g].sdesParamsList&&d[g].sdesParamsList&&(v=f.default.findMatchingSdesParams(l[g].sdesParamsList,d[g].sdesParamsList))&&(v.localSdesParams.tag=v.remoteSdesParams.tag,m.sdesParamsList=[v.localSdesParams],m.remoteSdesParams=v.remoteSdesParams)}h.push(m)}return h}function _getNegotiatedMediaParams(l,d,u,p,h){function composeParams(u,h){var g=u?l.sender:l.receiver,f=u?d.sender:d.receiver,m=_matchChannelParams(l,d,p,u);return m.rtcpMux=h.doRtcpMux,m.rtcpReducedSize=g.rtcpReducedSize&&f.rtcpReducedSize,m.enableDtls=h.enableDtls,m}var g=_negotiateMediaDescriptor(l.descr,d),m={descr:g};if(g.enabled){g.transportId=h?u[0].transportId:g.transportId;var v=f.default.getTransportIndexById(u,g.transportId),y=h?u[0]:u[v];if(m.descr=g,m.sender=composeParams(!0,y),m.receiver=composeParams(!1,y),!_verifyTransportAndMediaParams(g,y,m.sender)||!_verifyTransportAndMediaParams(g,y,m.receiver))throw new Error(\"Failed to verify negotiated parameters!\")}return m}function _verifyAndNegotiateParameters(l,d,u){if(l.media.length!==d.media.length)throw new Error(\"Number of media lines doesn't match in offer & answer l:\"+l.media.length+\" r: \"+d.media.length);_=_supportsBundling(d,u);for(var p={sessionVersion:u?l.sessionVersion:d.sessionVersion,transportParams:_getNegotiatedTransportParams(l.transportParams,d.transportParams),bundle:u?l.groups:d.groups,bundled:_,media:[]},h=0;h<l.media.length;h++)p.media.push(_getNegotiatedMediaParams(l.media[h],d.media[h],p.transportParams,u,p.bundled));return p}function _completeNegotiation(){return y.sessionVersion++,S=y,l.debug(\"NEGOTIATED\",\"params:\",JSON.stringify(S)),S}function _onMediaCapabilitiesChanged(l,d){return l===g.VideoCapabilitiesEventType.CODEC_PARAMS_UPDATED?_handleCodecParamsChange(d):l===g.VideoCapabilitiesEventType.SSRC_UPDATED?_handleSsrcChange(d):void 0}function _handleCodecParamsChange(d){var u=S.media.find((function(l){return l.descr.mediaId===d.mediaId}));if(u){var h=f.default.getCodecByName(d.codecName,u.receiver.rtpCaps.codecs);h&&h.parameters?p.forOwn(d.capabilities,(function(u,p){l.safe.info(\"changing \",p,\" for \",d.codecName,\" from \",h.parameters[p],\" to \",u),h.parameters[p]=u})):l.safe.warn(\"codec not found for codecName: \",d.codecName)}else l.safe.warn(\"mediaCaps not found for mediaId: \",d.mediaId)}function _handleSsrcChange(d){var u=S.media.find((function(l){return l.descr.mediaId===d.mediaId}));u?(l.safe.info(\"SSRC changing: \",u.receiver.ssrcRange,\" -> \",d.ssrcRange),l.safe.info(\"rtxSSRC changing: \",u.receiver.rtxSsrc,\" -> \",d.rtxSsrc),u.receiver.ssrcRange=p.shallowClone(d.ssrcRange),u.sender.ssrcRange=p.shallowClone(d.ssrcRange),u.receiver.rtxSsrc=d.rtxSsrc,u.sender.rtxSsrc=d.rtxSsrc):l.warn(\"mediaCaps not found for mediaType: \",d.mediaId,S)}}d.default=OrtcNegotiation},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(375),h=u(42),g=u(1),f=u(3),m=u(50);function OrtcSdp(){function _encodeExtensionUri(l,d){return d?l.replace(/\\\\/g,\"/\"):l.replace(/\\//g,\"\\\\\")}function _compareStr(l,d){return l.toLowerCase()===d.toLowerCase()}function _isIpv4(l){return-1===l.indexOf(\":\")}function _getHostIp(l){for(var d=l.iceCandidates.slice(0).sort((function(l,d){return d.priority-l.priority})),u=0;u<d.length;u++)if(\"host\"===d[u].type)return d[u].ip;return\"0.0.0.0\"}function _getDirection(l,d){return l&&d?\"sendrecv\":l?\"sendonly\":d?\"recvonly\":\"inactive\"}function _getTransport(l,d){var u=l.toUpperCase();if(\"TCP\"===u)switch(d.toLowerCase()){case\"active\":return\"TCP-ACT\";case\"passive\":return\"TCP-PASS\";case\"so\":return\"TCP-SO\"}return u}function _addCandidate(l,d,u){u.push({foundation:l.foundation,component:d,transport:_getTransport(l.protocol,l.tcpType),priority:l.priority,ip:l.ip,port:l.port,type:l.type,raddr:_compareStr(l.type,\"host\")?void 0:l.relatedAddress,rport:_compareStr(l.type,\"host\")?void 0:l.relatedPort})}function _addCandidates(l,d,u,p){l&&l.forEach((function(l){_isIpv4(l.ip)?_addCandidate(l,d,u):_addCandidate(l,d,p)}))}function _getDefaultCandidates(l){if(l.iceCandidatePair)return{0:l.iceCandidatePair.local,1:l.rtcpIceCandidatePair?l.rtcpIceCandidatePair.local:null};var d=l.iceCandidates.slice(0).sort((function(l,d){return d.priority-l.priority}))[0],u=null;if(l.rtcpIceCandidates)for(var p=0;p<l.rtcpIceCandidates.length;++p){var h=l.rtcpIceCandidates[p];if(h.foundation===d.foundation){u=h;break}}return{0:d,1:u}}function _makeMediaParams(l,d,u,p,h,m){var v=d.receiver,y={rtp:[],fmtp:[],rtcpFb:[],ext:[],type:d.descr.type,port:0,protocol:\"RTP/SAVP\",payloads:\"\",cryptoscale:[],crypto:[],candidates:[],xCandidatesIpv6:[]};if(!d.descr.enabled)return y.type===f.default.MEDIA_TYPE.video?y.payloads=\"34\":y.payloads=\"9\",y;d.descr.mid&&(y.mid=d.descr.mid);var S,_,C=_getDefaultCandidates(l);if(y.port=C[0].port,(h&&y.mid===m[0]||!h)&&(S=C[0],_=C[1],p.ip!==S.ip&&(y.connection={version:_isIpv4(S.ip)?4:6,ip:S.ip})),y.iceUfrag=l.iceParams.usernameFragment,y.icePwd=l.iceParams.password,y.type===f.default.MEDIA_TYPE.audio){var E=_getCodecPtimeCapabilities(v.rtpCaps.codecs);y.maxptime=E.maxptime,y.ptime=E.ptime}y.direction=_getDirection(d.descr.send,d.descr.recv),y.xSsrcRange={ssrcMin:v.ssrcRange.min,ssrcMax:v.ssrcRange.max},y.ssrcGroups=_transformRtxSsrc(d.sender.rtxSsrc,d.sender.ssrcRange.min),y.label=d.descr.label,(y.label!==f.default.MEDIA_LABEL.video||d.descr.firstVideoChannel)&&(y.xSource=y.label),v.rtcpReducedSize&&(y.rtcpRsize=!0),u&&d.justAdded?(l.doRtcpMux&&(y.rtcpMux=!0),y.rtcp={port:_&&_.port||y.port+1}):l.doRtcpMux?y.rtcpMux=!0:y.rtcp={port:_&&_.port||y.port+1};var T=null;function mkiConfigString(l){return 0!==l.mkiLength?\"|\"+l.mkiValue+\":\"+l.mkiLength:\"\"}if(v.rtpCaps&&v.rtpCaps.codecs&&(v.rtpCaps.codecs.forEach((function(l){y.rtp.push({payload:l.preferredPayloadType,codec:l.name,rate:l.clockRate,encoding:l.numChannels>1?l.numChannels:void 0});var d=\"\";g.forOwn(l.parameters,(function(l,u){\"\"!==d&&(d+=\";\"),d+=\"events\"===u?l:u+\"=\"+l})),\"\"!==d&&y.fmtp.push({payload:l.preferredPayloadType,config:d}),y.payloads+=(y.payloads?\" \":\"\")+l.preferredPayloadType;for(var u=0;u<l.rtcpFeedback.length;u++)_compareStr(l.rtcpFeedback[u].type,\"x-message\")?T=l.rtcpFeedback[u].parameter:y.rtcpFb.push({payload:l.preferredPayloadType,type:l.rtcpFeedback[u].type,subtype:l.rtcpFeedback[u].parameter})})),T&&y.rtcpFb.push({payload:\"*\",type:\"x-message\",subtype:T})),v.rtpCaps&&v.rtpCaps.headerExtensions&&v.rtpCaps.headerExtensions.forEach((function(l){y.ext.push({value:l.preferredId,uri:_encodeExtensionUri(l.uri,!1)})})),l.sdesParamsList)for(var b=0;b<l.sdesParamsList.length;++b){var I=l.sdesParamsList[b];_compareStr(I.cryptoSuite,\"AES_CM_128_HMAC_SHA1_80\")?y.crypto.push({id:I.tag,suite:\"AES_CM_128_HMAC_SHA1_80\",config:I.keyParams[0].keyMethod+\":\"+I.keyParams[0].keySalt+\"|\"+I.keyParams[0].lifetime+mkiConfigString(I.keyParams[0])}):_compareStr(I.cryptoSuite,\"SCALE_AES_CM_128_HMAC_SHA1_80\")&&y.cryptoscale.push({id:I.tag,flavor:\"client\",suite:\"AES_CM_128_HMAC_SHA1_80\",config:I.keyParams[0].keyMethod+\":\"+I.keyParams[0].keySalt+\"|\"+I.keyParams[0].lifetime+mkiConfigString(I.keyParams[0])})}if(d.bundledWithOther||(l.iceCandidatePair?(_addCandidates([l.iceCandidatePair.local],1,y.candidates,y.xCandidatesIpv6),l.rtcpIceCandidatePair&&!l.doRtcpMux&&_addCandidates([l.rtcpIceCandidatePair.local],2,y.candidates,y.xCandidatesIpv6),y.remoteCandidates=\"1 \"+l.iceCandidatePair.remote.ip+\" \"+l.iceCandidatePair.remote.port,l.doRtcpMux?y.remoteCandidates+=\" 2 \"+l.iceCandidatePair.remote.ip+\" \"+l.iceCandidatePair.remote.port:y.remoteCandidates+=\" 2 \"+l.rtcpIceCandidatePair.remote.ip+\" \"+l.rtcpIceCandidatePair.remote.port):(_addCandidates(l.iceCandidates,1,y.candidates,y.xCandidatesIpv6),(u&&d.justAdded||!l.doRtcpMux)&&_addCandidates(l.rtcpIceCandidates,2,y.candidates,y.xCandidatesIpv6)),y.candidates.sort((function(l,d){return+l.foundation-+d.foundation||l.foundation===d.foundation&&l.component-d.component})),y.xCandidatesIpv6.sort((function(l,d){return+l.foundation-+d.foundation||l.foundation===d.foundation&&l.component-d.component}))),l.dtlsParams)switch(y.fingerprint={type:l.dtlsParams.fingerprints[0].algorithm,hash:l.dtlsParams.fingerprints[0].value},l.dtlsParams.role){case\"auto\":y.setup=\"actpass\";break;case\"client\":y.setup=\"active\";break;case\"server\":y.setup=\"passive\"}return y}function _getProtocol(l){var d=l.toLowerCase();switch(d){case\"tcp-act\":case\"tcp-pass\":case\"tcp-so\":return\"tcp\";default:return d}}function _getTcpType(l){switch(l.toLowerCase()){case\"tcp-act\":return\"active\";case\"tcp-pass\":return\"passive\";case\"tcp-so\":return\"so\";default:return}}function _getCandidate(l){var d={foundation:l.foundation,priority:l.priority,ip:l.ip,protocol:_getProtocol(l.transport),port:l.port,type:l.type};return _compareStr(l.type,\"host\")||(d.tcpType=_getTcpType(l.transport),d.relatedAddress=l.raddr,d.relatedPort=l.rport),d}function _getCandidates(l,d,u){l.candidates&&l.candidates.forEach((function(l){l.component===d&&u.push(_getCandidate(l))})),l.xCandidatesIpv6&&l.xCandidatesIpv6.forEach((function(l){l.component===d&&u.push(_getCandidate(l))}))}function _getKeyParamsFromConfig(l){var d=/(\\w+):([a-zA-Z0-9+\\/]+={0,2})(\\|([0-9\\^]+))?(\\|([0-9]+):([0-9]+))?/,u=l.match(d);if(u){var p={keyMethod:u[1],keySalt:u[2],mkiValue:0,mkiLength:0};return void 0!==u[4]&&(p.lifetime=u[4]),void 0!==u[7]&&(p.mkiValue=+u[6],p.mkiLength=+u[7]),p}}function _getTransportParams(l,d){var u={},p=[];function addSdesParams(l,d,u,h){p.push({tag:l,cryptoSuite:d,keyParams:u,sessionParams:h})}if(d.cryptoscale&&d.cryptoscale.forEach((function(l){var d=_compareStr(l.flavor,\"server\")?_getKeyParamsFromConfig(l.config):void 0;d&&addSdesParams(l.id,\"SCALE_\"+l.suite,[d],[])})),d.crypto&&d.crypto.forEach((function(l){var d=_getKeyParamsFromConfig(l.config);d&&addSdesParams(l.id,l.suite,[d],[])})),u.iceParams={usernameFragment:d.iceUfrag,password:d.icePwd},u.sdesParamsList=p,u.iceCandidates=[],_getCandidates(d,1,u.iceCandidates),u.doRtcpMux=!!d.rtcpMux,d.rtcpMux||(u.rtcpIceParams={usernameFragment:d.iceUfrag,password:d.icePwd},u.rtcpIceCandidates=[],_getCandidates(d,2,u.rtcpIceCandidates),l.icelite&&(u.rtcpIceParams.iceLite=!0)),d.remoteCandidates&&(u.iceCandidatePair={}),l.fingerprint||d.fingerprint){var h=d.fingerprint?d.fingerprint:l.fingerprint,g=\"auto\";switch(d.setup?d.setup:l.setup){case\"actpass\":g=\"auto\";break;case\"active\":g=\"client\";break;case\"passive\":g=\"server\"}u.dtlsParams={role:g,fingerprints:[{algorithm:h.type,value:h.hash}]}}return l.icelite&&(u.iceParams.iceLite=!0),u}function _getRTPCaps(l){var d=[],u=[];return l.rtp.forEach((function(u){var p={name:u.codec,kind:l.type,clockRate:u.rate,preferredPayloadType:u.payload,numChannels:u.encoding?u.encoding:1,rtcpFeedback:[],parameters:{}};l.type===f.default.MEDIA_TYPE.audio&&(p.ptime=l.ptime,p.maxptime=l.maxptime),l.rtcpFbXMessage&&l.rtcpFbXMessage.length&&l.rtcpFbXMessage.forEach((function(l){\"*\"!==l.payload&&p.preferredPayloadType!==+l.payload||p.rtcpFeedback.push({type:\"x-message\",parameter:l.param})})),l.rtcpFb&&l.rtcpFb.length&&l.rtcpFb.forEach((function(l){\"*\"!==l.payload&&p.preferredPayloadType!==+l.payload||p.rtcpFeedback.push({type:l.type,parameter:l.subtype||\"\"})})),d.push(p)})),l.fmtp&&l.fmtp.forEach((function(l){var u=h.default.build(l.config),p=m.default.getCodecIndexByPayload(l.payload,d);u.names().forEach((function(l){d[p].parameters[l]=u.get(l)}))})),l.ext&&l.ext.forEach((function(d){u.push({kind:l.type,uri:_encodeExtensionUri(d.uri,!0),preferredId:d.value})})),{codecs:d,headerExtensions:u,fecMechanisms:[]}}function _getMediaDescriptor(l){l.direction||(l.direction=\"sendrecv\");var d=l.direction.toLowerCase(),u=0!==parseInt(l.port,10);l.type!==f.default.MEDIA_TYPE.audio&&l.type!==f.default.MEDIA_TYPE.video&&(u=!1);var getLabel=function(){if(u&&!l.label){if(f.default.MEDIA_TYPE.audio===l.type)return f.default.MEDIA_LABEL.audio;if(f.default.MEDIA_TYPE.video===l.type)return f.default.MEDIA_LABEL.video}return l.label};return{enabled:u,type:l.type,label:getLabel(),mid:l.mid,send:!!u&&(\"sendrecv\"===d||\"sendonly\"===d),recv:!!u&&(\"sendrecv\"===d||\"recvonly\"===d)}}function _getRtxSsrc(l){if(l){var d=l.find((function(l){return\"FID\"===l.semantics}));if(d)return+d.ssrcs.split(\" \")[1]}return 0}function _transformRtxSsrc(l,d){return l?[{semantics:\"FID\",ssrcs:d+\" \"+l}]:[]}function _getMediaParams(l){var d=_getMediaDescriptor(l);if(d.enabled){var u={rtpCaps:_getRTPCaps(l),ssrcRange:{min:l.xSsrcRange?l.xSsrcRange.ssrcMin:0,max:l.xSsrcRange?l.xSsrcRange.ssrcMax:0},mid:l.mid||void 0,rtxSsrc:_getRtxSsrc(l.ssrcGroups),rtcpReducedSize:!!l.rtcpRsize};return{descr:_getMediaDescriptor(l),receiver:u,sender:g.deepClone(u)}}var p={rtpCaps:null,ssrcRange:null,rtcpReducedSize:!1};return{descr:d,receiver:p,sender:p}}function _getCodecPtimeCapabilities(l){if(0===l.length)return{ptime:0,maxptime:0};var d=l[0].ptime,u=l[0].maxptime;return l.forEach((function(l){u>l.maxptime&&l.maxptime>0&&(u=l.maxptime)})),{ptime:d,maxptime:u}}function getBundledMids(l){return l&&l.groups?l.groups.find((function(l){return\"BUNDLE\"===l.type})).mids.toString().split(\" \"):[]}function getBundledOnly(l){for(var d=0;d<l.media.length;d++)if(l.media[d].signalingFbXMessage)return!0;var u=getBundledMids(l);return!(!u||!u[1])&&l.media.some((function(l){return l.mid===u[1]&&(!l.candidates||0===l.candidates.length)}))}this.paramsToSdp=function(l){var d={},u=l.transportParams[0]||l.transportParams[1]||l.transportParams[2],h=_getHostIp(u),g=_getDefaultCandidates(u)[0];d.groups=m.default.groupsToSdp(l),d.version=0,d.origin={username:\"-\",sessionId:0,sessionVersion:l.sessionVersion,netType:\"IN\",ipVer:_isIpv4(h)?4:6,address:h},d.bandwidth=[{type:\"CT\",limit:99980}],d.timing={start:0,stop:0},d.name=\"session\",d.connection={version:_isIpv4(g.ip)?4:6,ip:g.ip},d.xMediaBw={label:f.default.MEDIA_LABEL.video,sendBw:8100,receiveBw:8e3},d.media=[];for(var v=0;v<l.media.length;v++){var y=l.bundled?0:m.default.getTransportIndexById(l.transportParams,l.media[v].descr.transportId),S=l.transportParams[y];d.media.push(_makeMediaParams(S,l.media[v],l.isOffer,g,l.bundled,l.groups))}return p.write(d)},this.sdpToParams=function(l){for(var d=p.parse(l),u={sessionVersion:d.origin.sessionVersion,transportParams:[],groups:getBundledMids(d),bundledOnly:getBundledOnly(d),media:[]},h=0;h<d.media.length;h++){var g=d.media[h],f=_getMediaParams(g);if(u.media.push(f),f.descr.enabled)_getTransportParams(d,g).iceCandidates.length>0&&u.transportParams.push(_getTransportParams(d,g));void 0!==f.mid&&(f.mid=f.mid.toString())}return u}}d.default=OrtcSdp},function(l,d,u){var p;!function(d){l.exports=d()}((function(){return function e(l,d,u){function s(g,f){if(!d[g]){if(!l[g]){if(!f&&(\"function\"==typeof p&&p))return p(g,!0);if(h)return h(g,!0);var m=new Error(\"Cannot find module '\"+g+\"'\");throw m.code=\"MODULE_NOT_FOUND\",m}var v=d[g]={exports:{}};l[g][0].call(v.exports,(function(d){var u=l[g][1][d];return s(u||d)}),v,v.exports,e,l,d,u)}return d[g].exports}for(var h=\"function\"==typeof p&&p,g=0;g<u.length;g++)s(u[g]);return s}({1:[function(l,d,u){var p=d.exports={v:[{name:\"version\",reg:/^(\\d*)$/}],o:[{name:\"origin\",reg:/^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,names:[\"username\",\"sessionId\",\"sessionVersion\",\"netType\",\"ipVer\",\"address\"],format:\"%s %s %d %s IP%d %s\"}],s:[{name:\"name\"}],i:[{name:\"description\"}],u:[{name:\"uri\"}],e:[{name:\"email\"}],p:[{name:\"phone\"}],z:[{name:\"timezones\"}],r:[{name:\"repeats\"}],t:[{name:\"timing\",reg:/^(\\d*) (\\d*)/,names:[\"start\",\"stop\"],format:\"%d %d\"}],c:[{name:\"connection\",reg:/^IN IP(\\d) (\\S*)/,names:[\"version\",\"ip\"],format:\"IN IP%d %s\"}],b:[{push:\"bandwidth\",reg:/^(TIAS|AS|CT|RR|RS):(\\d*)/,names:[\"type\",\"limit\"],format:\"%s:%s\"}],m:[{reg:/^(\\S*) (\\d*) ([\\w\\/]*)(?: (.*))?/,names:[\"type\",\"port\",\"protocol\",\"payloads\"],format:\"%s %d %s %s\"}],a:[{push:\"rtp\",reg:/^rtpmap:(\\d*) ([\\w\\-]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,names:[\"payload\",\"codec\",\"rate\",\"encoding\"],format:function(l){return l.encoding?\"rtpmap:%d %s/%s/%s\":l.rate?\"rtpmap:%d %s/%s\":\"rtpmap:%d %s\"}},{push:\"fmtp\",reg:/^fmtp:(\\d*) ([\\S| ]*)/,names:[\"payload\",\"config\"],format:\"fmtp:%d %s\"},{name:\"control\",reg:/^control:(.*)/,format:\"control:%s\"},{name:\"rtcp\",reg:/^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,names:[\"port\",\"netType\",\"ipVer\",\"address\"],format:function(l){return null!=l.address?\"rtcp:%d %s IP%d %s\":\"rtcp:%d\"}},{push:\"rtcpFbXMessage\",reg:/^rtcp-fb:(\\*|\\d*) x-message ([\\S| ]*)/,names:[\"payload\",\"param\"],format:function(l){return\"rtcp-fb:\"+(\"*\"===l.payload?\"%s\":\"%d\")+\" x-message %s\"}},{push:\"rtcpFbTrrInt\",reg:/^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,names:[\"payload\",\"value\"],format:\"rtcp-fb:%d trr-int %d\"},{push:\"rtcpFb\",reg:/^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,names:[\"payload\",\"type\",\"subtype\"],format:function(l){return null!=l.subtype?\"rtcp-fb:%s %s %s\":\"rtcp-fb:%s %s\"}},{push:\"ext\",reg:/^extmap:([\\w_\\/]*) (\\S*)(?: (\\S*))?/,names:[\"value\",\"uri\",\"config\"],format:function(l){return null!=l.config?\"extmap:%s %s %s\":\"extmap:%s %s\"}},{push:\"cryptoscale\",reg:/^cryptoscale:(\\d*) (client|server) ([\\w_]*) (\\S*)(?: (\\S*))?/,names:[\"id\",\"flavor\",\"suite\",\"config\",\"sessionConfig\"],format:function(l){return null!=l.sessionConfig?\"cryptoscale:%d %s %s %s %s\":\"cryptoscale:%d %s %s %s\"}},{push:\"crypto\",reg:/^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,names:[\"id\",\"suite\",\"config\",\"sessionConfig\"],format:function(l){return null!=l.sessionConfig?\"crypto:%d %s %s %s\":\"crypto:%d %s %s\"}},{name:\"setup\",reg:/^setup:(\\w*)/,format:\"setup:%s\"},{name:\"mid\",reg:/^mid:([^\\s]*)/,format:\"mid:%s\"},{name:\"msid\",reg:/^msid:(.*)/,format:\"msid:%s\"},{name:\"ptime\",reg:/^ptime:(\\d*)/,format:\"ptime:%d\"},{name:\"maxptime\",reg:/^maxptime:(\\d*)/,format:\"maxptime:%d\"},{name:\"direction\",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:\"icelite\",reg:/^(ice-lite)/},{name:\"iceUfrag\",reg:/^ice-ufrag:(\\S*)/,format:\"ice-ufrag:%s\"},{name:\"icePwd\",reg:/^ice-pwd:(\\S*)/,format:\"ice-pwd:%s\"},{name:\"fingerprint\",reg:/^fingerprint:(\\S*) (\\S*)/,names:[\"type\",\"hash\"],format:\"fingerprint:%s %s\"},{push:\"candidates\",reg:/^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?/,names:[\"foundation\",\"component\",\"transport\",\"priority\",\"ip\",\"port\",\"type\",\"raddr\",\"rport\",\"tcptype\",\"generation\"],format:function(l){var d=\"candidate:%s %d %s %d %s %d typ %s\";return d+=null!=l.raddr?\" raddr %s rport %d\":\"%v%v\",d+=null!=l.tcptype?\" tcptype %s\":\"%v\",null!=l.generation&&(d+=\" generation %d\"),d}},{push:\"xCandidatesIpv6\",reg:/^x-candidate-ipv6:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?/,names:[\"foundation\",\"component\",\"transport\",\"priority\",\"ip\",\"port\",\"type\",\"raddr\",\"rport\",\"tcptype\",\"generation\"],format:function(l){var d=\"candidate:%s %d %s %d %s %d typ %s\";return d+=null!=l.raddr?\" raddr %s rport %d\":\"%v%v\",d+=null!=l.tcptype?\" tcptype %s\":\"%v\",null!=l.generation&&(d+=\" generation %d\"),d}},{name:\"endOfCandidates\",reg:/^(end-of-candidates)/},{name:\"remoteCandidates\",reg:/^remote-candidates:(.*)/,format:\"remote-candidates:%s\"},{name:\"iceOptions\",reg:/^ice-options:(\\S*)/,format:\"ice-options:%s\"},{push:\"ssrcs\",reg:/^ssrc:(\\d*) ([\\w_]*):(.*)/,names:[\"id\",\"attribute\",\"value\"],format:\"ssrc:%d %s:%s\"},{push:\"ssrcGroups\",reg:/^ssrc-group:(\\w*) (.*)/,names:[\"semantics\",\"ssrcs\"],format:\"ssrc-group:%s %s\"},{name:\"msidSemantic\",reg:/^msid-semantic:\\s?(\\w*) (\\S*)/,names:[\"semantic\",\"token\"],format:\"msid-semantic: %s %s\"},{push:\"groups\",reg:/^group:(\\w*) (.*)/,names:[\"type\",\"mids\"],format:\"group:%s %s\"},{name:\"rtcpMux\",reg:/^(rtcp-mux)/,format:\"rtcp-mux\"},{name:\"rtcpRsize\",reg:/^(rtcp-rsize)/,format:\"rtcp-rsize\"},{name:\"xMediaBw\",reg:/^x-mediabw:(\\S*) send=(\\d*);recv=(\\d*)/,names:[\"label\",\"sendBw\",\"receiveBw\"],format:\"x-mediabw:%s send=%d;recv=%d\"},{name:\"xSsrcRange\",reg:/^x-ssrc-range:(\\d*)-(\\d*)/,names:[\"ssrcMin\",\"ssrcMax\"],format:\"x-ssrc-range:%d-%d\"},{name:\"label\",reg:/^label:(\\S*)/,format:\"label:%s\"},{name:\"xSource\",reg:/^x-source:(\\S*)/,format:\"x-source:%s\"},{name:\"xSourceStreamId\",reg:/^x-source-streamid:(\\S*)/,format:\"x-source-streamid:%s\"},{name:\"xCaps\",reg:/^x-caps:(\\d*) (\\S*)/,names:[\"payloadType\",\"value\"],format:\"x-caps:%d %s\"},{name:\"signalingFbXMessage\",reg:/^x-signaling-fb:(\\*|\\d*) x-message ([\\S| ]*)/,names:[\"payload\",\"param\"],format:function(l){return\"x-signaling-fb:\"+(\"*\"===l.payload?\"%s\":\"%d\")+\" x-message %s\"}},{push:\"xMediaSettings\",reg:/^x-mediasettings:([\\S| ]*)/,names:[\"settings\"],format:\"x-mediasettings:%s\"},{push:\"invalid\",names:[\"value\"]}]};Object.keys(p).forEach((function(l){p[l].forEach((function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format=\"%s\")}))}))},{}],2:[function(l,d,u){var toIntIfInt=function(l){return String(Number(l))===l?Number(l):l},attachProperties=function(l,d,u,p){if(p&&!u)d[p]=toIntIfInt(l[1]);else for(var h=0;h<u.length;h+=1)null!=l[h+1]&&(d[u[h]]=toIntIfInt(l[h+1]))},parseReg=function(l,d,u){var p=l.name&&l.names;l.push&&!d[l.push]?d[l.push]=[]:p&&!d[l.name]&&(d[l.name]={});var h=l.push?{}:p?d[l.name]:d;attachProperties(u.match(l.reg),h,l.names,l.name),l.push&&d[l.push].push(h)},p=l(\"./grammar\"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);u.parse=function(l){var d={},u=[],g=d;return l.split(/(\\r\\n|\\r|\\n)/).filter(h).forEach((function(l){var d=l[0],h=l.slice(2);\"m\"===d&&(u.push({rtp:[],fmtp:[]}),g=u[u.length-1]);for(var f=0;f<(p[d]||[]).length;f+=1){var m=p[d][f];if(m.reg.test(h))return parseReg(m,g,h)}})),d.media=u,d};var fmtpReducer=function(l,d){var u=d.split(\"=\");return 2===u.length&&(l[u[0]]=toIntIfInt(u[1])),l};u.parseFmtpConfig=function(l){return l.split(/\\;\\s?/).reduce(fmtpReducer,{})},u.parsePayloads=function(l){return l.split(\" \").map(Number)},u.parseRemoteCandidates=function(l){for(var d=[],u=l.split(\" \").map(toIntIfInt),p=0;p<u.length;p+=3)d.push({component:u[p],ip:u[p+1],port:u[p+2]});return d}},{\"./grammar\":1}],3:[function(l,d,u){var p=l(\"./grammar\"),h=/%[sdv%]/g,format=function(l){var d=1,u=arguments,p=u.length;return l.replace(h,(function(l){if(d>=p)return l;var h=u[d];switch(d+=1,l){case\"%%\":return\"%\";case\"%s\":return String(h);case\"%d\":return Number(h);case\"%v\":return\"\"}}))},makeLine=function(l,d,u){var p=[l+\"=\"+(d.format instanceof Function?d.format(d.push?u:u[d.name]):d.format)];if(d.names)for(var h=0;h<d.names.length;h+=1){var g=d.names[h];d.name?p.push(u[d.name][g]):p.push(u[d.names[h]])}else p.push(u[d.name]);return format.apply(null,p)},g=[\"v\",\"o\",\"s\",\"i\",\"u\",\"e\",\"p\",\"c\",\"b\",\"t\",\"r\",\"z\",\"a\"],f=[\"i\",\"c\",\"b\",\"a\"];d.exports=function(l,d){d=d||{},null==l.version&&(l.version=0),null==l.name&&(l.name=\" \"),l.media.forEach((function(l){null==l.payloads&&(l.payloads=\"\")}));var u=d.outerOrder||g,h=d.innerOrder||f,m=[];return u.forEach((function(d){p[d].forEach((function(u){u.name in l&&null!=l[u.name]?m.push(makeLine(d,u,l)):u.push in l&&null!=l[u.push]&&l[u.push].forEach((function(l){m.push(makeLine(d,u,l))}))}))})),l.media.forEach((function(l){m.push(makeLine(\"m\",p.m[0],l)),h.forEach((function(d){p[d].forEach((function(u){u.name in l&&null!=l[u.name]?m.push(makeLine(d,u,l)):u.push in l&&null!=l[u.push]&&l[u.push].forEach((function(l){m.push(makeLine(d,u,l))}))}))}))})),m.join(\"\\r\\n\")+\"\\r\\n\"}},{\"./grammar\":1}],\"sdp-transform\":[function(l,d,u){var p=l(\"./parser\"),h=l(\"./writer\");u.write=h,u.parse=p.parse,u.parseFmtpConfig=p.parseFmtpConfig,u.parsePayloads=p.parsePayloads,u.parseRemoteCandidates=p.parseRemoteCandidates},{\"./parser\":2,\"./writer\":3}]},{},[])(\"sdp-transform\")}))},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(29),h=u(1),g=u(3),f=u(50);function IceTransport(l,d,u,h,f,m,v){var y,S,_=this,C=new p.SettablePromise;this.nominatedCandidatePair=null,d.info(\"create RTCIceGatherer\",\"options:\",JSON.stringify(f.iceGathererOptions)),this.iceGatherer=m?m.createAssociatedGatherer():new RTCIceGatherer(f.iceGathererOptions),d.safe.info(\"create RTCIceTransport\"),this.iceTransport=v?v.createAssociatedTransport():new RTCIceTransport,this.getLocalCandidatesAsync=function(){return C.promise},this.start=function(l,p){if(S)throw new Error(\"icetransport already started!\");S=!0,y=u.createCb(f.iceRole),d.info(\"RTCIceTransport setRemoteCandidates\",\"candidates:\",JSON.stringify(l)),_.iceTransport.setRemoteCandidates(l),d.info(\"RTCIceTransport start\",\"remoteIceParams:\",JSON.stringify(p),\"role:\",f.iceRole),_.iceTransport.start(_.iceGatherer,p,f.iceRole),d.safe.info(\"RTCIceTransport start\",\"role:\",_.iceTransport.role)},this.dispose=function(){d.safe.info(\"dispose\"),_.iceTransport.stop(),_.iceTransport=null,_.iceGatherer=null,C.isPending&&C.reject(new Error(\"operation canceled due to stop\")),y&&y.dispose()},this.iceGatherer.onlocalcandidate=function(l){d.info(\"RTCIceGatherer.onlocalcandidate\",\"candidate:\",JSON.stringify(l.candidate)),0===Object.keys(l.candidate).length&&C.resolve()},this.iceGatherer.onerror=function(l){d.safe.error(\"RTCIceGatherer.onerror\",\"event:\",l),C.reject(new Error(\"IceGatherer failed!\"))},this.iceTransport.onicestatechange=function(){_.iceTransport&&(d.safe.info(\"RTCIceTransport.onicestatechange\",\"state:\",_.iceTransport.state),\"completed\"===_.iceTransport.state?(d.info(\"pair:\",JSON.stringify(_.iceTransport.getNominatedCandidatePair())),_.nominatedCandidatePair=_.iceTransport.getNominatedCandidatePair(),y.iceCompleted(),h.onConnected(l)):\"connected\"===_.iceTransport.state?h.onConnected(l):\"disconnected\"===_.iceTransport.state&&(d.safe.error(\"audio ICE transport disconnected, ending call!\"),h.onError({type:g.default.MEDIA_ERROR.iceConnectionError,detail:\"ice transport disconnected\"},l)))},this.iceTransport.oncandidatepairchange=function(l){d.info(\"RTCIceTransport.oncandidatepairchange\",\"event:\",l)}}function DtlsTransport(l,d,u,p){var h=this,f=!1;this.dtlsTransport=new RTCDtlsTransport(u),this.dtlsTransport.ondtlsstatechange=function(){d.safe.info(\"RTCDtlsTransport.ondtlsstatechange\",\"state:\",event.state,\"role:\",h.dtlsTransport?h.dtlsTransport.getLocalParameters().role:\"\")},this.dtlsTransport.onerror=function(u){d.safe.error(\"RTCDtlsTransport.onerror\",\"event:\",u),p.onError({type:g.default.MEDIA_ERROR.srtpError,detail:u},l)},this.startAsync=function(l){if(f)throw new Error(\"dtlstransport already started!\");return f=!0,d.info(\"RTCDtlsTransport.start\",\"params:\",JSON.stringify(l)),h.dtlsTransport.start(l),Promise.resolve()},this.dispose=function(){f&&h.dtlsTransport.stop(),h.dtlsTransport=null}}var m=0;function MediaTransport(l,d,u,p,h,f,v){var y,S,_,C,E=this,T=!1;function _filterCandidates(l){var d=l;return(h.iceCandidateType||h.iceCandidateTransport)&&(d=d.filter((function(l){var d=!0,u=!0;return h.iceCandidateType&&(d=l.type.match(new RegExp(h.iceCandidateType),\"i\")),h.iceCandidateTransport&&(u=l.protocol.match(new RegExp(h.iceCandidateTransport,\"i\"))),d&&u}))),h.iceGathererOptions.gatherPolicy===g.default.ICE_TRANSPORT_POLICY.relay&&d.forEach((function(l){l.relatedAddress=l.ip,l.relatedPort=l.port})),d}function _getLocalParams(){return{transportId:E.transportId,iceParams:y.iceGatherer.getLocalParameters(),iceCandidates:_filterCandidates(y.iceGatherer.getLocalCandidates()),iceCandidatePair:y.nominatedCandidatePair,sdesParamsList:v,dtlsParams:_?_.dtlsTransport.getLocalParameters():null,rtcpIceParams:S?S.iceGatherer.getLocalParameters():null,rtcpIceCandidates:S?_filterCandidates(S.iceGatherer.getLocalCandidates()):null,rtcpIceCandidatePair:S?S.nominatedCandidatePair:null}}this.transportId=m++,y=new IceTransport(this.transportId,d.createChild(\"IceT\"),u,p,h),_=new DtlsTransport(this.transportId,d.createChild(\"DtlsT\"),y.iceTransport,p),f&&(S=new IceTransport(this.transportId,d.createChild(\"RtcpIceT\"),u,p,h,y.iceGatherer,y.iceTransport)),Object.defineProperty(this,\"transport\",{get:function(){return!l.config.disableSdes&&C?C:_?_.dtlsTransport:null}}),this.isStarted=function(){return T},this.getLocalParamsAsync=function(){return(S?Promise.all([y.getLocalCandidatesAsync(),S.getLocalCandidatesAsync()]):y.getLocalCandidatesAsync()).then((function(){return _getLocalParams()}))},this.startAsync=function(l){if(T)throw new Error(\"mediaTransport already started!\");var u=Promise.resolve();return T=!0,y.start(l.iceCandidates,l.iceParams),S&&(l.doRtcpMux?(S.dispose(),S=null):S.start(l.rtcpIceCandidates,l.rtcpIceParams)),l.enableDtls?u=_.startAsync(l.dtlsParams):C||(d.debug(\"RTCSrtpSdesTransport\",\"local:\",JSON.stringify(l.sdesParamsList[0]),\"remote:\",JSON.stringify(l.remoteSdesParams)),(C=new RTCSrtpSdesTransport(y.iceTransport,l.sdesParamsList[0],l.remoteSdesParams)).onerror=function(l){d.info(\"RTCSrtpSdesTransport.onerror\",\"event:\",l),p.onError({type:g.default.MEDIA_ERROR.srtpError,detail:l},E.transportId)}),u},this.dispose=function(){d.safe.info(\"dispose\"),y.dispose(),y=null,S&&(S.dispose(),S=null),_&&(_.dispose(),_=null)}}function IceCompletionMonitor(l,d){var u=[],g=!1,f=new p.SettablePromise,m=0;function Callback(p){var v=this;this.dispose=function(){h.remove(u,(function(l){return l===v}))},this.gotCallback=!1,this.iceCompleted=function(){this.gotCallback=!0,this.gotCallbackFromControlling=\"controlling\"===p;for(var h=0,v=0,y=0;y<u.length;y++)u[y].gotCallback&&h++,u[y].gotCallbackFromControlling&&v++;v&&v===m&&!g&&(l.safe.info(\"IceCompletionMonitor REINVITE\"),g=!0,d.triggerIceReinvite()),h&&h===u.length&&(l.safe.info(\"IceCompletionMonitor ALL COMPLETE\"),f.resolve())}}this.createCb=function(l){var d=new Callback(l);return u.push(d),\"controlling\"===l&&(g=!1,m++),f.reject(void 0),f=new p.SettablePromise,d},this.waitAllCallbacksAsync=function(){return f.promise}}function OrtcTransport(l,d,u,p,h,m){var v,y=this,S=[],_=h||g.default.ICE_TRANSPORT_POLICY.all,C=new IceCompletionMonitor(d,u),E=null;function _filterLocalSdesParamsList(l){return\"SCALE_AES_CM_128_HMAC_SHA1_80\"!==l.cryptoSuite}function _queryRelaysAsync(){if(!v){if(!y.relayManagerProvider)throw new Error(\"relay manager provider is not set!\");var l={relayType:\"msturn\",isRemoteClientLync:p};v=y.relayManagerProvider.getRelayManager().queryRelaysAsync(l)}return v}function _getIceServers(l){return l.reduce((function(l,d){var u=d.fqdns;return u&&0!==u.length||(u=d.addresses||[]),u.map((function(u){l.push({urls:d.type+\":\"+u+\":\"+d.udpPort+\"?transport=udp\",credential:d.password,username:d.username}),l.push({urls:d.type+\":\"+u+\":\"+d.tcpPort+\"?transport=tcp\",credential:d.password,username:d.username})})),l}),[])}function _getPortRange(l,d){return 0===d?{min:l.audioMin,max:l.audioMax}:{min:l.videoMin,max:l.videoMax}}function _getTransportParamsById(l,d){return l.find((function(l){return l.transportId===d}))}this.relayManagerProvider=null,l.config.disableSdes||(E=RTCSrtpSdesTransport.getLocalParameters().filter(_filterLocalSdesParamsList)),this.getTransportById=function(l){return S[f.default.getTransportIndexById(S,l)]},this.assureInitAsync=function(p,h,g){return new Promise((function(f){d.safe.info(\"assureInitAsync\",h),f((g?_queryRelaysAsync():Promise.resolve([])).then((function(g){for(var f={iceRole:p,iceCandidateType:l.config.iceCandidateType,iceCandidateTransport:l.config.iceCandidateTransport,iceGathererOptions:{gatherPolicy:_,iceServers:_getIceServers(g),portRange:null}},v=S.length;v<h;v++){d.safe.info(\"assureInitAsync \"+v+f.iceRole),l.config.mediaPortRanges&&(f.iceGathererOptions.portRange=_getPortRange(l.config.mediaPortRanges,v));var y={onError:u.onError,onConnected:u.onConnected},T=new MediaTransport(l,d.createChild(\"MT\"+v),C,y,f,m,E);S.push(T)}})))}))},this.getLocalParamsAsync=function(){return d.safe.info(\"getLocalParamsAsync\"),new Promise((function(l){var d=S.map((function(l){return l.getLocalParamsAsync()}));l(Promise.all(d))}))},this.hasIceCandidates=function(l){return l.some((function(l){return!!l.iceCandidates&&l.iceCandidates.length>0}))},this.hasRelayIceCandidates=function(l){return this.hasIceCandidates(l)&&l.some((function(l){return!!l.iceCandidates&&l.iceCandidates.some((function(l){return\"relay\"===l.type}))}))},this.waitIceCompletionIfNeededAsync=function(l){return new Promise((function(u){var p=\"\";(l[0]&&l[0].iceCandidatePair||l[1]&&l[1].iceCandidatePair)&&(d.safe.info(\"waiting ICE completed state!\"),p=C.waitAllCallbacksAsync()),u(p)}))},this.configureTransportAsync=function(l,d){return new Promise((function(u){var p=[],h=l.transportParams;S=S.filter((function(l){return-1!==d.findIndex((function(d){return d===l.transportId}))?(l.isStarted()||p.push(l.startAsync(_getTransportParamsById(h,l.transportId))),!0):(l.dispose(),!1)})),u(Promise.all(p))}))},this.stop=function(){S.forEach((function(l){l.dispose()})),S=[]}}d.default=OrtcTransport},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(79),h=u(144),g=u(29),f=u(15),m=u(1),v=u(3),y=1e3;function OrtcVideoRendererGroup(l,d){var u=d.createChild(\"OrtcVideoRendererGroup\"),S=[],_=f.default.window,C=[];function OrtcVideoRenderer(d,f){p.VideoRendererBase.call(this,d);var E,T,b,I,A=this,R=this.dispose.bind(this),P=!1,O=new g.SettablePromise;this.on(\"onVideoSizeChanged\",(function(l,d){l&&d&&stopRefreshing()})),this.updateRecvTrack=function(l,d){if(d!==getVideoTrack()){var p=d?new MediaStream([d]):null;u.safe.info(\"updating renderer media stream to\",p),A.attachMediaStream(p),T!==l&&(T=l,u.safe.info(\"renderer subscribed msi updated to\",l))}};var M=this.attachMediaStream.bind(this);function startRefreshing(){I||(u.safe.info(\"starting video tag periodic refresh\"),I=_.setInterval((function(){A.getVideoElement().play()}),y))}function stopRefreshing(){I&&(u.safe.info(\"stopping video tag periodic refresh\"),_.clearInterval(I),I=null)}function getVideoTrack(){var l=A.getMediaStream();return l?l.getVideoTracks()[0]:null}function unsubscribeIfSubscribed(){E&&(E.remove(A),E=void 0),T=void 0}function subscribeInternal(l,d){if(!getSubscription(l,d)){var u,p=new g.SettablePromise,h=[],f=!1,dispose_1=function(){f||(h=[],p.isPending&&p.reject(new Error(\"disposing renderer\")),u&&u.unsubscribe(),m.remove(S,(function(u){return u.rendererType===l&&u.msi===d})),f=!0,S.forEach((function(l){l.update()})))},reset=function(){p=new g.SettablePromise},update_1=function(){if(p.isPending){var g=getSubscribableChannel(l);g&&(g.subscribe(d),u=g,p.resolve())}if(u){var f=u.getRecvTrack();h.forEach((function(l){l.updateRecvTrack(d,f)}))}};S.push({rendererType:l,msi:d,add:function(l,d){p.promise.then(d.resolve,d.reject),h.push(l),update_1()},remove:function(l){m.remove(h,(function(d){return d===l})),0===h.length&&dispose_1()},getChannel:function(){return u},update:update_1,dispose:dispose_1,reset:reset})}(E=getSubscription(l,d)).add(A,O)}function getSubscription(l,d){return S.find((function(u){return u.rendererType===l&&u.msi===d}))}function getSubscribableChannel(l){return C.find((function(d){return d.canSubscribe()&&d.label===getLabelForModality(l)}))}function getLabelForModality(l){switch(l){case v.default.MODALITY.video:return v.default.MEDIA_LABEL.video;case v.default.MODALITY.sharing:return v.default.MEDIA_LABEL.sharing}return\"unknown\"}function trackElementSizeChange(){l.config.ortcVideoCapabilityCheckIntervalMin&&l.config.ortcVideoCapabilityCheckIntervalMax?b||(b=new h.VideoSizeTracker(A.getVideoElement(),l.config.ortcVideoCapabilityCheckIntervalMin,l.config.ortcVideoCapabilityCheckIntervalMax,l.config.enableDevicePixelRatio)).changed((function(){u.safe.info(\"video renderer size changed, updating capabilities\"),E.getChannel()&&E.getChannel().videoSizeChanged(b.width,b.height)})):u.safe.info(\"skipping video size tracking\")}this.attachMediaStream=function(d){return l.config.ortcVideoRendererAggressiveStreamRefresh&&(d?startRefreshing():stopRefreshing()),M(d)},this.subscribeVideoAsync=function(l,d){var p=l||v.default.MSI.subscribeAny,h=d?v.default.RENDERER_TYPE.sharing:v.default.RENDERER_TYPE.video;return u.safe.info(\"subscribing renderer to type:\",h,\"msi:\",l),new Promise((function(l){if(!P){var d=T!==p;d&&unsubscribeIfSubscribed(),O.isPending&&(O.resolve(),O=new g.SettablePromise),p!==v.default.MSI.unsubscribe&&d?(subscribeInternal(h,p),trackElementSizeChange()):O.resolve()}l(O.promise)}))},this.dispose=function(){u.safe.debug(\"disposing remote renderer\"),b&&(b.dispose(),b=null),stopRefreshing(),unsubscribeIfSubscribed(),O.isPending&&O.reject(new Error(\"disposing renderer\")),P=!0,R()}}this.create=function(l,d){return new OrtcVideoRenderer(l,d)},this.reset=function(){return S.forEach((function(l){return l.reset()}))},this.update=function(l){C=l,S.forEach((function(l){return l.update()}))},this.terminate=function(){return S.forEach((function(l){return l.dispose()}))},OrtcVideoRenderer.prototype=Object.create(p.VideoRendererBase.prototype)}d.default={build:function(l,d){return new OrtcVideoRendererGroup(l,d)}}},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(67),g=u(1),f=u(133),m=u(9),v=u(28),y=u(27),S=u(379),_=function(){function StopWatch(){this.startTime=0,this.elapsed=0,this._count=0}return Object.defineProperty(StopWatch.prototype,\"count\",{get:function(){return this._count},enumerable:!1,configurable:!0}),StopWatch.prototype.start=function(){this.startTime||(this.startTime=Date.now(),this._count++)},StopWatch.prototype.stop=function(){this.startTime&&(this.elapsed+=Date.now()-this.startTime,this.startTime=0)},StopWatch.prototype.isRunning=function(){return!!this.startTime},StopWatch.prototype.getElapsed=function(){return this.startTime?this.elapsed+Date.now()-this.startTime:this.elapsed},StopWatch}(),C=function(){function QualityEventStats(l){void 0===l&&(l=\"Good\"),this.stopWatches=[],this.currentLevel=l,this.getStopWatch(l).start()}return QualityEventStats.prototype.updateLevel=function(l){this.currentLevel!==l&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=l,this.getStopWatch(this.currentLevel).start())},QualityEventStats.prototype.getCount=function(l){var d=this.stopWatches[l];return d?d.count:0},QualityEventStats.prototype.getElapsed=function(l){var d=this.stopWatches[l];return d?d.getElapsed():0},QualityEventStats.prototype.getStopWatch=function(l){var d=this.stopWatches[l];return d||(d=new _,this.stopWatches[l]=d),d},QualityEventStats}(),E=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\\:[0-9]{2,5})?$/),T=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/),b=RegExp(/^\\[(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\](\\:[0-9]{2,5})$/),I=function(){function SessionStatistics(l,d){var u=this;this.configProvider=l,this.callNumber=d,this.negotiation={offering:this.offering(),answering:this.answering(),current:this.current()},this.creationTime=Date.now(),this.negotiationCount=0,this.initialNegotiationCompleted=!1,this.multiParty=!1,this.noIceCandidatesGoodEventCount=0,this.noIceCandidatesBadEventCount=0,this.noRelayIceCandidatesGoodEventCount=0,this.noRelayIceCandidatesBadEventCount=0,this.cameraInUseBadEventCount=0,this.cameraInUseGoodEventCount=0,this.microphoneInUseBadEventCount=0,this.microphoneInUseGoodEventCount=0,this.cameraFreezeStartEventCount=0,this.cameraFreezeEndEventCount=0,this.networkRecv=new C,this.networkSend=new C,this.retargetIncomingCount=0,this.retargetOutgoingCount=0,this.retargetCompletedCount=0,this.retargetRejectedCount=0,this.reconnectAttemptedCount=0,this.reconnectConnectedCount=0,this.escalationAttemptedCount=0,this.escalationCompletedCount=0,this.escalationRejectedCount=0,this.duration=0,this.terminationReason={},this.terminationTime=0,this.sessionId=\"0\",this.rejectedNegotiationCount=0,this.mediaError={type:\"none\",detail:\"none\"},this.incompatibleOffer=!1,this.dtmfSuccess=0,this.dtmfFailure=0,this.relay=null,this.relayManagerTimers=null,this.allowedAudioSend=!0,this.allowedVideoSend=!0,this.allowedScreensharingSend=!0,this.iceInitTime=0,this.finalAnswerTime=0,this.iceConnectedStateTime=0,this.usedDevices=null,this.deviceSelectionChangeCount=0,this.devicesChangeCount=0,this.devicesPollChangeCount=0,this.mute=new _,this.osMute=new _,this.hwSilent=new _,this.isSpeaking=new _,this.swMute=new _,this.speakerMute=new _,this.deviceTelemetryEvents=[],this.videoEffectsTelemetryEvents=new h.SlidingWindow(this.configProvider.config.effectsTelemetryBufferSize),this.audioEffectsTelemetryEvents=new h.SlidingWindow(this.configProvider.config.effectsTelemetryBufferSize),this.devicesCount=null,this.reconnectStats=new S.default(this.creationTime),this.transportDisconnected=!1,this.transportReconnectedCount=0,this.ufds=[],this.mediaQosEnabled=!1,this.portRangeConfigured=!1,this.rollbackNegotiation=[],this.rawOutputAudioAccess={attempt:0,timer:new _},this.rawInputAudioOverride={attempt:0,timer:new _},this.connectionEffectiveTypeSeries=new h.SlidingWindow(this.configProvider.config.navConnectionNumSamplesToCollect),this.connectionRttSeries=new h.SlidingWindow(this.configProvider.config.navConnectionNumSamplesToCollect),this.connectionDownlinkSeries=new h.SlidingWindow(this.configProvider.config.navConnectionNumSamplesToCollect),this.navigatorConnectionInterval=setInterval((function(){var l=null===navigator||void 0===navigator?void 0:navigator.connection;l&&(\"number\"==typeof l.downlink&&u.connectionDownlinkSeries.add(l.downlink),\"number\"==typeof l.rtt&&u.connectionRttSeries.add(l.rtt),\"number\"==typeof l.effectiveType&&u.connectionEffectiveTypeSeries.add(l.effectiveType))}),this.configProvider.config.navConnectionPollingInterval)}return SessionStatistics.prototype.terminated=function(l){this.terminationReason=(0,g.deepClone)(l),this.terminationTime=Date.now(),this.duration=this.terminationTime-this.creationTime,this.osMute.stop(),this.swMute.stop(),this.hwSilent.stop(),this.isSpeaking.stop(),this.mute.stop(),this.speakerMute.stop(),this.rawInputAudioOverride.timer.stop(),this.rawOutputAudioAccess.timer.stop(),clearInterval(this.navigatorConnectionInterval)},SessionStatistics.prototype.setMultiParty=function(){this.multiParty=!0},SessionStatistics.prototype.updateCommonMute=function(){this.swMute.isRunning()||this.osMute.isRunning()?this.mute.start():this.swMute.isRunning()||this.osMute.isRunning()||this.mute.stop()},SessionStatistics.prototype.setDeviceList=function(l,d){var u=this;this.deviceList=l.map((function(l){return{label:(0,g.scrubDeviceLabelPii)(l.label,u.configProvider.config.devices.piiSafeWords),kind:l.kind}})),d&&(this.deviceDebugStrings=(0,g.deepClone)(d))},SessionStatistics.prototype.setPermissionStates=function(l){this.permissionStates=l},SessionStatistics.prototype.setSwMute=function(l){l?this.swMute.start():this.swMute.stop(),this.updateCommonMute()},SessionStatistics.prototype.setSpeakerMute=function(l){l?this.speakerMute.start():this.speakerMute.stop()},SessionStatistics.prototype.setHwSilent=function(l){l?this.hwSilent.start():this.hwSilent.stop()},SessionStatistics.prototype.setSpeakingState=function(l){l?this.isSpeaking.start():this.isSpeaking.stop()},SessionStatistics.prototype.setETag=function(l){this.ETag=l},SessionStatistics.prototype.setConfigIds=function(l){this.configIds=l},SessionStatistics.prototype.setVideoEffectStats=function(l){l&&this.videoEffectsTelemetryEvents.add(l)},SessionStatistics.prototype.setAudioEffectStats=function(l){l&&this.audioEffectsTelemetryEvents.add(l)},SessionStatistics.prototype.registerQualityStateChangedEvent=function(l){switch(l.type){case\"NoNetwork\":\"Good\"===l.value?this.noIceCandidatesGoodEventCount++:this.noIceCandidatesBadEventCount++;break;case\"NetworkRelaysNotReachable\":\"Good\"===l.value?this.noRelayIceCandidatesGoodEventCount++:this.noRelayIceCandidatesBadEventCount++;break;case\"DeviceCaptureNotFunctioning\":\"Good\"===l.value?this.microphoneInUseGoodEventCount++:this.microphoneInUseBadEventCount++;break;case\"VideoCapturerDeviceStartFailed\":\"Good\"===l.value?this.cameraInUseGoodEventCount++:this.cameraInUseBadEventCount++;break;case\"DeviceCaptureMute\":\"Audio\"===l.mediaType&&(\"Bad\"===l.value?this.osMute.start():this.osMute.stop(),this.updateCommonMute());break;case\"NetworkRecvQuality\":this.networkRecv.updateLevel(l.value);break;case\"NetworkSendQuality\":this.networkSend.updateLevel(l.value);break;case\"VideoCaptureDeviceFreeze\":\"Good\"===l.value?this.cameraFreezeEndEventCount++:this.cameraFreezeStartEventCount++}\"DeviceSpeakWhileMuted\"!==l.type&&this.ufds.push(p(p({},l),{timestamp:Date.now()-this.creationTime})),this.ufds.length>this.configProvider.config.maxStoredUFDCount&&this.ufds.shift()},SessionStatistics.prototype.registerRetargetIncoming=function(){this.retargetIncomingCount++},SessionStatistics.prototype.registerRetargetOutgoing=function(){this.retargetOutgoingCount++},SessionStatistics.prototype.registerRetargetCompleted=function(){this.retargetCompletedCount++},SessionStatistics.prototype.registerRetargetRejected=function(){this.retargetRejectedCount++},SessionStatistics.prototype.registerEscalationStart=function(){this.escalationAttemptedCount++},SessionStatistics.prototype.registerEscalationCompleted=function(){this.escalationCompletedCount++},SessionStatistics.prototype.registerEscalationRejected=function(){this.escalationRejectedCount++},SessionStatistics.prototype.registerRollbackEvent=function(l){l&&this.rollbackNegotiation.push({type:l.type,attempt:this.rollbackNegotiation.length+1,error:l.error?l.error:\"\"})},SessionStatistics.prototype.registerReconnectAttempted=function(){this.reconnectAttemptedCount++,this.reconnectStats.onReconnectStart()},SessionStatistics.prototype.registerReconnectConnected=function(){this.reconnectConnectedCount++,this.reconnectStats.onReconnectConnected()},SessionStatistics.prototype.registerDeviceTelemetryEvent=function(l){l.timestamp=l.timestamp-this.creationTime,this.deviceTelemetryEvents.push(l)},SessionStatistics.prototype.registerVideoEffectsTelemetryEvent=function(l){l&&(l.timestamp=l.timestamp-this.creationTime,this.videoEffectsTelemetryEvents.add(l))},SessionStatistics.prototype.registerAudioEffectsTelemetryEvent=function(l){l&&(l.timestamp=l.timestamp-this.creationTime,this.audioEffectsTelemetryEvents.add(l))},SessionStatistics.prototype.registerReconnectAttempt=function(l){this.reconnectStats.onReconnectAttempt(l)},SessionStatistics.prototype.registerReconnectAttemptCompleted=function(){this.reconnectStats.onReconnectCompleted()},SessionStatistics.prototype.registerReconnectAttemptRejected=function(){this.reconnectStats.onReconnectRejected()},SessionStatistics.prototype.setMediaLegId=function(l){this.mediaLegId=l},SessionStatistics.prototype.setId=function(l){this.sessionId=l},SessionStatistics.prototype.setError=function(l){l.type===v.Constants.MEDIA_ERROR.incompatibleOffer&&(this.incompatibleOffer=!0),this.mediaError.type=l.type||v.Constants.MEDIA_ERROR.internalError,this.mediaError.detail=l.detail||l.toString()},SessionStatistics.prototype.setRelay=function(l){this.relay={address:l.addresses.join(),expires:l.expires,realm:l.realm,credentials:!(!l.username||!l.password),ports:[l.udpPort?\"udp:\".concat(l.udpPort):\"\",l.tcpPort?\"tcp:\".concat(l.tcpPort):\"\",l.tlsPort?\"tls:\".concat(l.tlsPort):\"\"].join(\",\"),fqdns:l.fqdns?l.fqdns.join():\"none\"}},SessionStatistics.prototype.setRelayManagerTimers=function(l){this.relayManagerTimers=l},SessionStatistics.prototype.setSendModalities=function(l){this.allowedAudioSend=l.audio.some((function(l){return(0,m.hasSendDirectionality)(l)})),this.allowedVideoSend=l.video.some((function(l){return(0,m.hasSendDirectionality)(l)})),this.allowedScreensharingSend=l.sharing.some((function(l){return(0,m.hasSendDirectionality)(l)}))},SessionStatistics.prototype.setIceInitTimestamp=function(l){this.iceInitTime||(this.iceInitTime=l)},SessionStatistics.prototype.setFinalAnswerTimestamp=function(l){this.finalAnswerTime||(this.finalAnswerTime=l)},SessionStatistics.prototype.setIceConnectedStateTimestamp=function(l){this.iceConnectedStateTime||(this.iceConnectedStateTime=l)},SessionStatistics.prototype.dtmfResult=function(l){l?++this.dtmfSuccess:++this.dtmfFailure},SessionStatistics.prototype.setUsedDevices=function(l){this.usedDevices&&JSON.stringify(l)!==JSON.stringify(this.usedDevices)&&this.deviceSelectionChangeCount++,this.usedDevices=l},SessionStatistics.prototype.setDevicesCount=function(l){this.devicesCount=l},SessionStatistics.prototype.setMediaQosEnabled=function(l){this.mediaQosEnabled=l},SessionStatistics.prototype.setPortRangeConfigured=function(l){this.portRangeConfigured=l},SessionStatistics.prototype.devicesChanged=function(){this.devicesChangeCount++},SessionStatistics.prototype.deviceChangedByPoll=function(){this.devicesPollChangeCount++},SessionStatistics.prototype.registerOutputRawMediaAccess=function(){this.rawOutputAudioAccess.attempt++,this.rawOutputAudioAccess.timer.start()},SessionStatistics.prototype.registerSetInputRawMedia=function(l){this.rawInputAudioOverride.attempt++,l?this.rawInputAudioOverride.timer.start():this.rawInputAudioOverride.timer.stop()},SessionStatistics.prototype.getReport=function(){var l,d=this.usedDevices||{microphone:\"none\",speaker:\"none\",camera:\"none\"};return{RawOutputAudioAccessDurationRatio:this.getDurationRatio(this.rawOutputAudioAccess.timer.getElapsed()),RawOutputAudioAccessAttempted:this.rawOutputAudioAccess.attempt,RawInputAudioOverrideDurationRatio:this.getDurationRatio(this.rawInputAudioOverride.timer.getElapsed()),RawInputAudioOverrideAttempted:this.rawInputAudioOverride.attempt,SessionId:this.sessionId,CallNumber:this.callNumber,NoIceCandidatesBadEventCount:this.noIceCandidatesBadEventCount,NoIceCandidatesGoodEventCount:this.noIceCandidatesGoodEventCount,NoRelayIceCandidatesBadEventCount:this.noRelayIceCandidatesBadEventCount,NoRelayIceCandidatesGoodEventCount:this.noRelayIceCandidatesGoodEventCount,CameraInUseBadEventCount:this.cameraInUseBadEventCount,CameraInUseGoodEventCount:this.cameraInUseGoodEventCount,MicrophoneInUseBadEventCount:this.microphoneInUseBadEventCount,MicrophoneInUseGoodEventCount:this.microphoneInUseGoodEventCount,CameraFreezeStartEventCount:this.cameraFreezeStartEventCount,CameraFreezeEndEventCount:this.cameraFreezeEndEventCount,RetargetIncomingCount:this.retargetIncomingCount,RetargetOutgoingCount:this.retargetOutgoingCount,RetargetCompletedCount:this.retargetCompletedCount,RetargetRejectedCount:this.retargetRejectedCount,ReconnectAttemptedCount:this.reconnectAttemptedCount,ReconnectConnectedCount:this.reconnectConnectedCount,EscalationAttemptedCount:this.escalationAttemptedCount,EscalationCompletedCount:this.escalationCompletedCount,EscalationRejectedCount:this.escalationRejectedCount,CreationTime:this.getHpTimeFromMillis(this.creationTime),InitTime:this.getHpTimeFromMillis(this.creationTime),TerminationTime:this.getHpTimeFromMillis(this.terminationTime),CallDuration:this.getHpTimeFromMillis(this.getCurrentDuration()),InitialNegotiationType:this.initialNegotiationType||\"none\",InitialNegotiationCompleted:this.initialNegotiationCompleted,NegotiationCount:this.negotiationCount,RejectedNegotiationCount:this.rejectedNegotiationCount,MediaLegId:this.mediaLegId,MultiParty:this.multiParty,ErrorType:this.mediaError.type,ErrorDetail:this.mediaError.detail,TerminationReason:this.terminationReason,IncompatibleOffer:this.incompatibleOffer,DtmfSuccess:this.dtmfSuccess,DtmfFailure:this.dtmfFailure,Relay:this.relay?JSON.stringify(this.relay):\"none\",RelayManager:this.relayManagerTimers?JSON.stringify(this.relayManagerTimers):\"none\",AllowedAudioSend:this.allowedAudioSend,AllowedVideoSend:this.allowedVideoSend,AllowedScreensharingSend:this.allowedScreensharingSend,IceInitTime:this.getHpTimeFromMillis(this.iceInitTime),FinalAnswerTime:this.getHpTimeFromMillis(this.finalAnswerTime),IceConnectedStateTime:this.getHpTimeFromMillis(this.iceConnectedStateTime),UsedMicrophone:d.microphone,UsedSpeaker:d.speaker,UsedCamera:d.camera,DeviceSelectionChangeCount:this.deviceSelectionChangeCount,DevicesChangeCount:this.devicesChangeCount,DevicesPollChangeCount:this.devicesPollChangeCount,DevicesCount:this.devicesCount?JSON.stringify(this.devicesCount):\"none\",ETag:this.ETag||\"\",ConfigIds:this.configIds?Array.isArray(this.configIds)?this.configIds.join(\",\"):this.configIds:\"\",CallMutedRatio:this.getDurationRatio(this.mute.getElapsed()),CallOsMuted:this.getHpTimeFromMillis(this.osMute.getElapsed()),CallHwSilent:this.getHpTimeFromMillis(this.hwSilent.getElapsed()),CallSwMuted:this.getHpTimeFromMillis(this.swMute.getElapsed()),CallSpeakerMuted:this.getHpTimeFromMillis(this.speakerMute.getElapsed()),CallIsSpeaking:this.getHpTimeFromMillis(this.isSpeaking.getElapsed()),NetworkRecvGood:this.networkRecv.getCount(\"Good\")-1,NetworkRecvPoor:this.networkRecv.getCount(\"Poor\"),NetworkRecvBad:this.networkRecv.getCount(\"Bad\"),NetworkSendGood:this.networkSend.getCount(\"Good\")-1,NetworkSendPoor:this.networkSend.getCount(\"Poor\"),NetworkSendBad:this.networkSend.getCount(\"Bad\"),NetworkRecvGoodRatio:this.getDurationRatio(this.networkRecv.getElapsed(\"Good\")),NetworkRecvPoorRatio:this.getDurationRatio(this.networkRecv.getElapsed(\"Poor\")),NetworkRecvBadRatio:this.getDurationRatio(this.networkRecv.getElapsed(\"Bad\")),NetworkSendGoodRatio:this.getDurationRatio(this.networkSend.getElapsed(\"Good\")),NetworkSendPoorRatio:this.getDurationRatio(this.networkSend.getElapsed(\"Poor\")),NetworkSendBadRatio:this.getDurationRatio(this.networkSend.getElapsed(\"Bad\")),DeviceEvents:JSON.stringify(this.deviceTelemetryEvents),DeviceList:JSON.stringify(this.deviceList),DeviceListDebug:JSON.stringify(this.deviceDebugStrings),VideoEffects:JSON.stringify(this.videoEffectsTelemetryEvents.items),AudioEffects:JSON.stringify(this.audioEffectsTelemetryEvents.items),PermissionStates:JSON.stringify(this.permissionStates),ReconnectAttempts:this.reconnectStats.getReport(),ReconnectInProgress:this.reconnectStats.isReconnecting(),TransportReconnectedCount:this.transportReconnectedCount,UFDs:JSON.stringify(this.ufds),MediaQosEnabled:this.mediaQosEnabled,PortRangeConfigured:this.portRangeConfigured,RollbackNegotiation:JSON.stringify(this.rollbackNegotiation),hardwareConcurrency:y.UserAgentConfig.hardwareConcurrency,GPUName:y.UserAgentConfig.unmaskedGlRenderer,Connection_Downlink:(0,g.sampleseries)(this.connectionDownlinkSeries.items,(function(l){return l})),Connection_EffectiveType:(0,g.sampleseries)(this.connectionEffectiveTypeSeries.items,(function(l){return l})),Connection_Rtt:(0,g.sampleseries)(this.connectionRttSeries.items,(function(l){return l})),Connection_SaveData:null===(l=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===l?void 0:l.saveData}},SessionStatistics.prototype.generateStatistics=function(l,d,u){var p=this;if(void 0===u&&(u=!1),this.setMediaLegId(d.process()),\"OrtcMediaStats\"!==l.type&&\"WebRtcMediaStats\"!==l.type)throw new Error(\"Unknown stats type - \".concat(l.type));if(u){var h=this.deviceTelemetryEvents.length;this.deviceTelemetryEvents.splice(0,h-1),this.deviceDebugStrings=f.EmptyDeviceDebugStrings}return l.data.metrics=this.getReport(),(0,g.forOwnRec)(l.data,(function(l,d,u){u[d]=p.addPiiToStatsValue(l)})),l},SessionStatistics.prototype.registerTransportConnected=function(){this.transportDisconnected&&(this.transportDisconnected=!1,this.transportReconnectedCount++)},SessionStatistics.prototype.registerTransportDisconnected=function(){this.transportDisconnected=!0},SessionStatistics.prototype.registerTransportFailed=function(){this.transportDisconnected=!1},SessionStatistics.prototype.resetError=function(){this.setError({type:\"none\",detail:\"none\"})},SessionStatistics.prototype.addPiiToStatsValue=function(l){var d=0;return E.test(l)?d=13:(T.test(l)||b.test(l))&&(d=4),{type:d,value:l,__VALUE__:!0}},SessionStatistics.prototype.offering=function(){var l=this;return{started:function(){l.currentNegotiationType=\"Offering\",l.negotiationStarted()}}},SessionStatistics.prototype.answering=function(){var l=this;return{started:function(){l.currentNegotiationType=\"Answering\",l.negotiationStarted()}}},SessionStatistics.prototype.negotiationStarted=function(){this.initialNegotiationType=this.initialNegotiationType||this.currentNegotiationType,++this.negotiationCount},SessionStatistics.prototype.current=function(){var l=this;return{completed:function(){l.initialNegotiationCompleted=!0,l.resetError()},rejected:function(){++l.rejectedNegotiationCount}}},SessionStatistics.prototype.getDurationRatio=function(l){var d=this.getCurrentDuration();return l/(0!==d?d:1)},SessionStatistics.prototype.getCurrentDuration=function(){return this.duration>0?this.duration:Date.now()-this.creationTime},SessionStatistics.prototype.getHpTimeFromMillis=function(l){return 1e4*l},SessionStatistics}();d.default=I},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function ReconnectStatistics(l){this.creationTime=l,this.records=[],this.activeRecord=null,this.activeAttempt=null,this.reconnectState=!1}return ReconnectStatistics.prototype.getReport=function(){return this.records.length?JSON.stringify(this.records):\"\"},ReconnectStatistics.prototype.isReconnecting=function(){return this.reconnectState},ReconnectStatistics.prototype.onReconnectStart=function(){this.reconnectState=!0,this.activeRecord||(this.activeRecord={attempts:[],endTime:null,startTime:Date.now()-this.creationTime},this.records.push(this.activeRecord))},ReconnectStatistics.prototype.onReconnectAttempt=function(l){if(!this.activeRecord)return null;this.activeAttempt={direction:l,status:!1,endTime:null,startTime:this.getTimestamp()},this.reconnectState=!0,this.activeRecord.attempts.push(this.activeAttempt)},ReconnectStatistics.prototype.onReconnectConnected=function(){if(!this.activeRecord)return null;this.reconnectState=!1,this.activeRecord.endTime=this.getTimestamp(),this.activeRecord=this.activeAttempt=null},ReconnectStatistics.prototype.onReconnectCompleted=function(){this.reconnectState=!1,this.resolveReconnectAttempt(!0)},ReconnectStatistics.prototype.onReconnectRejected=function(){this.resolveReconnectAttempt(!1)},ReconnectStatistics.prototype.resolveReconnectAttempt=function(l){this.activeAttempt&&this.activeRecord&&(this.activeAttempt.status=l,this.activeAttempt.endTime=this.getTimestamp())},ReconnectStatistics.prototype.getTimestamp=function(){return Date.now()-this.creationTime-this.activeRecord.startTime},ReconnectStatistics}();d.default=p},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},m=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0});var v=u(13),y=u(48),S=u(83),_=u(30),C=u(64),E=u(26),T=u(29),b=u(65),I=u(51),A=u(145),R=u(146),P=u(1),O=u(3),M=u(86),w=u(84),N=u(9),D=u(148),L=u(153),k=u(156),x=u(157),F=u(159),U=u(160),j=u(162),B=u(163),V=u(164),H=u(165),G=u(166),W=u(167),q=u(168),z=0,K=function(){function WebRtcSession(l,d,u){var p,h=this;this.context=l,this.callId=d,this.callback=u,this.callbacks={},this.multiParty=this.context.config&&this.context.config.isConference,this.configProvider=this.context.configProvider,this.logger=this.context.getLogger().createChild(\"webrtc-\".concat(++z)),this.deviceManager=this.context.getDeviceManager(),this.webrtcAdapter=L.default.build({global:this.context.maContext,configProvider:this.configProvider}),this.iceHostCandidateOnly=this.multiParty&&P.getFrom(\"iceHostCandidateOnly\",this.context.config,this.configProvider.config),this.mediaManager=new x.default({logger:this.logger,configProvider:this.configProvider,numVideoChannels:this.multiParty&&this.configProvider.config.numVideoChannelsGvc||1,unifiedPlanEnabled:!1,useSimulcast:!1}),this.resolutionTable=new E.default(this.configProvider.config.resolutionTableOverride),this.sessionDescription=W.SessionDescriptionFactory.build({sdpTransform:new this.webrtcAdapter.SdpTransform(this.context),mediaManager:this.mediaManager,logger:this.logger,configProvider:this.configProvider,configuration:this.getStreamTransformConfiguration()}),this.allowedMediaContentType=P.getFrom(\"webrtcAllowedMediaContentType\",this.context.config,this.configProvider.config).concat(),this.receiveStreamCollection=new A.default({streamAdded:function(l){return h.streamAdded(l)},streamRemoved:function(l){return h.streamRemoved(l)}}),this.stats=new D.StatisticsPoller(this.logger.createChild(\"stats\"),this.configProvider,void 0,this.mediaManager,this.multiParty),this.scalingEnabled=this.multiParty?this.configProvider.config.webrtcMultiPartyVideoScaling:this.configProvider.config.webrtcVideoScaling,this.maxResolution=this.multiParty?this.resolutionTable.getResolutionByFs(this.configProvider.config.webrtcMultipartyMaxScalingFs):this.resolutionTable.getResolutionByFs(this.configProvider.config.webrtcMaxScalingFs),this.qualityManager=new U.default(this.logger.createChild(\"qm\"),{scalingEnabled:this.scalingEnabled,cooldownTimeout:this.configProvider.config.webrtcResolutionManagerCooldownTimeout,retryDelay:this.configProvider.config.webrtcResolutionManagerRetryDelay,maxResolution:this.maxResolution,customBwEstimationEnabled:!0,sendBandwidthNotificationsEnabled:this.multiParty&&this.configProvider.config.webrtcSendBandwidthNotificationsEnabled},{onReceiveCapabilitiesChanged:function(l,d,u){return h.applyCapabilitiesForModality(l,d,u)},onSendBandwidthChanged:function(l){return h.onSendBandwidthChanged(l)}},this.stats,void 0,this.configProvider),this.localVideoStreamWatcher=new V.LocalVideoStreamWatcher(this.stats,this.logger,this.configProvider),this.activeSpeakerManager=new S.ActiveSpeakerManager(this.callback.onContributingSourcesChanged,this.callback.onDominantSpeakerChanged,this.logger.createChild(\"ActiveSpeakerManager\")),this.contributingSources=new k.ContributingSourcesHandler({activeSpeakerManager:this.activeSpeakerManager,logger:this.logger,configProvider:this.configProvider,provider:function(){if(!h.peerConnection)return[];if(h.peerConnection.getReceivers&&h.multiParty){var l=h.peerConnection.getReceivers().filter((function(l){return\"audio\"===l.track.kind}))[0];if(!l)return[];if(l.getContributingSources)return l.getContributingSources()}}}),this.passiveModalities=this.context.config.passiveModalities,this.senders={},this.negotiationQueue=new _.PromiseQueue(this.logger),this.negotiationEmulator=new F.default(this.logger.createChild(\"negotiationEmulator\"),this.webrtcAdapter,this.sessionDescription,this.negotiationQueue,this.mediaManager),this.extensionsManager=this.setupExtensionsManager(),this.toBeCalledAfterConnected=[],this.iceTransportPolicy=this.configProvider.config.iceTransportPolicyForced||this.context.config.iceTransportPolicy||O.default.ICE_TRANSPORT_POLICY.all,this.isMuteHold=!1,this.peerConnection=null,this.mediaStreams=new Map,this.doAudioMute=this.context.config.muted,this.iceCandidatesDeferred=new T.SettablePromise,this.relayCandidateGathered=!1,this.iceCandidatesTimer=null,this.triggerRenegotiationFlag=!1,this.canTriggerRenegotiation=!0,this.noIceCandidates=!1,this.noRelayIceCandidates=!1,this.forceMediaStreamUpdate=!1,this.negotiatedModalities={},this.iceDisconnectedTimer=null,this.statisticsReport=Promise.resolve({}),this.terminated=!1,this.initiator=!1,this.streamsChangedListener=null,this.dtmfSender=G.default.build({logger:this.logger,configProvider:this.configProvider}),this.mediaContentType=P.getFrom(\"webrtcMediaContentType\",this.context.config,this.configProvider.config),this.streamsChangedNotificationScheduled=!1,this.subscriptionManager=new R.SubscriptionManager({logger:this.logger.createChild(\"subs\"),configProvider:this.configProvider},{getStreams:function(){return h.getStreams()},onStreamsChanged:function(l){return h.onStreamsChanged(l)}}),this.remoteVideoResolutionManager=new j.RemoteVideoResolutionManager(this.logger.createChild(\"rvrm\"),this.multiParty,new E.default(this.configProvider.config.recvResolutionTableOverride),this.configProvider,this.mediaManager),this.remoteVideoManager=new B.RemoteVideoManager(this.logger.createChild(\"RemoteVideoManager\"),this.configProvider,this.stats,void 0,this.remoteVideoResolutionManager,this.context.maContext.domOverrides),this.hwSilent=!1,this.configuredModalitiesPromise=Promise.resolve(),this.negotiationCompletedPromise=new T.SettablePromise,this.ssrcGenerator=new b.SsrcGenerator,this.ssrcs=((p={}).Audio=this.getSsrcRangeForMediaType(\"Audio\"),p.Video=this.getSsrcRangeForMediaType(\"Video\"),p.ScreenShare=this.getSsrcRangeForMediaType(\"ScreenShare\"),p),this.forceKeyFramePromise=null,this.ufdManager=l.getUfdManager(),this.stats.on(\"onStatisticsChanged\",(function(l){h.updateQualityLevels(l)})),this.negotiationCompletedPromise.promise.catch((function(){})),this.negotiationCompletedPromise.reject(\"placeholder\"),this.remoteVideoResolutionManager.on(\"onNegotiationRequired\",(function(){return h.triggerRenegotiation(!0)})),this.remoteVideoResolutionManager.on(\"onSourceRequestRequired\",(function(l,d,u,p){return h.requestSource(l,d,u,p)})),this.setSubsForSubscriptionManager(),this.localVideoStreamWatcher.on(\"onVideoCaptureFreeze\",(function(l){h.isConnected()&&h.ufdManager.signalEvent(\"VideoCaptureDeviceFreeze\",l?\"Bad\":\"Good\",\"Video\")})),this.configProvider.mediaConfig.maxBandwidthInKbps&&this.stats.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.createAudioRenderer(),this.scalingEnabled&&this.onOptimalVideoReceiversCountChanged(this.configProvider.config.nonEstimatedDefaultVideoReceiversCount)}return Object.defineProperty(WebRtcSession.prototype,\"audioStream\",{get:function(){return this.mediaStreams.get(\"Audio\")},enumerable:!1,configurable:!0}),Object.defineProperty(WebRtcSession.prototype,\"videoStream\",{get:function(){return this.mediaStreams.get(\"Video\")},enumerable:!1,configurable:!0}),Object.defineProperty(WebRtcSession.prototype,\"displayStream\",{get:function(){return this.mediaStreams.get(\"ScreenShare\")},enumerable:!1,configurable:!0}),WebRtcSession.prototype.useNullAudioStreamClient=function(){},WebRtcSession.prototype.getRawOutputAudioStream=function(){return null},WebRtcSession.prototype.setRawInputAudioStreamTrack=function(l){},WebRtcSession.prototype.getAcceptedTypes=function(){return this.allowedMediaContentType},WebRtcSession.prototype.clone=function(l){void 0===l&&(l=!1);var d=P.shallowClone(this.context);d.config=P.shallowClone(this.context.config),d.config.webrtcMediaContentType=this.mediaContentType,d.config.webrtcAllowedMediaContentType=this.allowedMediaContentType,l?d.config.isConference=!0:(d.config.iceHostCandidateOnly=!1,this.configProvider.config.waitForRelayOnReconnect&&(d.config.webrtcIceGatheringTimeoutIncreased=!0));var u=new WebRtcSession(d,this.callId,this.callback);return this.relayManagerProvider&&(u.relayManagerProvider=this.relayManagerProvider),u.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,u},WebRtcSession.prototype.enableRealTimeTelemetry=function(){this.logger.safe.info(\"enableRealTimeTelemetry is not implemented yet\")},WebRtcSession.prototype.setInternals=function(l){var d=this;if(l.extensionsManager&&this.extensionsManager){var u=l.extensionsManager.getExtension(O.default.EXTENSION_TYPE.videoStreamControl);u&&u.getOptions()&&this.extensionsManager.configureExtension(O.default.EXTENSION_TYPE.videoStreamControl,u.getOptions())}l.subscriptionManager&&(this.subscriptionManager&&this.subscriptionManager.dispose(),this.subscriptionManager=l.subscriptionManager,this.subscriptionManager.setStreamProvider({getStreams:function(){return d.getStreams()},onStreamsChanged:function(l){return d.onStreamsChanged(l)}}),this.setSubsForSubscriptionManager(),this.subscriptionManager.reriseSubscribeEvents(),this.notifyStreamsChanged()),l.audioRenderer&&(l.audioRenderer.play(this.audioRenderer.getStream()),this.audioRenderer=l.audioRenderer),l.remoteVideoManager&&l.remoteVideoManager.moveRenderers(this.remoteVideoManager)},WebRtcSession.prototype.setSubsForSubscriptionManager=function(){var l=this;this.subscriptionManagerSubs=[this.subscriptionManager.on(\"onTrackIdsChanged\",(function(d){return l.stats.setSubscribedTrackIds(d)})),this.subscriptionManager.on(\"onTrackSsrcChanged\",(function(d){return l.stats.setSubscribedTrackSsrc(d)})),this.subscriptionManager.on(\"onSubscriptionChanged\",(function(d,u,p,h){return l.stats.addSubscriptionEvent(d,u,p,null,h)})),this.subscriptionManager.on(\"onSubscriptionFailed\",(function(d,u,p,h){return l.stats.addSubscriptionEvent(d,u,p,h)}))]},WebRtcSession.prototype.move=function(l,d){l.setInternals({subscriptionManager:this.subscriptionManager,extensionsManager:this.extensionsManager,audioRenderer:this.audioRenderer,remoteVideoManager:this.remoteVideoManager}),l.muteHold(this.isMuteHold,d),this.doAudioMute?l.muteInputAsync(d):l.unmuteInputAsync(d),this.subscriptionManager=null,this.audioRenderer=null,this.callbacks.onTerminated=null},WebRtcSession.prototype.setMute=function(l,d,u){this.logger.safe.info(\"[\".concat(u,\"] call setMuteAsync with mute state \").concat(d,\", audio stream exists: \").concat(!!this.audioStream)),\"Audio\"===l&&this.audioStream?this.audioStream.setMuted(d,u):\"Video\"===l&&this.videoStream?this.videoStream.setMuted(d,u):\"ScreenShare\"===l&&this.displayStream&&this.displayStream.setMuted(d,u),this.updateQualityLevels(this.stats.getLastStatistics())},WebRtcSession.prototype.configureModalitiesAsync=function(l,d){var u=this,p=this.configuredModalitiesPromise.then((function(){if(!l||!l.audio&&!l.video&&!l.sharing)throw new Error(\"Invalid parameters! \".concat(JSON.stringify(l)));var p=!u.configuredModalities||!N.areNegotiatedDirectionsFulfilled(l,u.negotiatedModalities);return u.configuredModalities=l,u.logger.safe.info(\"[\".concat(d,\"] configure modalities\"),\"audio: \".concat(l.audio),\"video: \".concat(l.video),\"sharing: \".concat(l.sharing),\"peerconnection: \".concat(!!u.peerConnection),\"pc.signalingState: \".concat(u.peerConnection?u.peerConnection.signalingState:\"-\"),\"needNewRenegotiation: \".concat(p)),p&&u.triggerRenegotiation(!1,d),u.configuredModalities}));return this.configuredModalitiesPromise=p.catch((function(l){u.logger.safe.warn(\"[\".concat(d,\"] Error during configuring modalities: \").concat(P.stringifyObject(l)))})).then((function(){})),p.then((function(){}))},WebRtcSession.prototype.getConfiguredModalities=function(){return this.configuredModalities},WebRtcSession.prototype.createAudioElement=function(l){},WebRtcSession.prototype.createOfferAsync=function(l){var d=this,u=this.negotiationQueue.add((function(){return new Promise((function(u){d.logger.safe.info(\"[\".concat(l,\"] create [offer] configured: \").concat(JSON.stringify(d.configuredModalities))),d.initiator=!0,d.throwIfModalitiesNotConfigured(\"no configured modalities to create offer for\"),d.canTriggerRenegotiation=!1,d.negotiatingModalities=N.excludePassiveModalities(d.configuredModalities,d.passiveModalities,d.offeredModalities),d.offeredModalities=d.negotiatingModalities,d.configProvider.config.webrtcNegotiateDisabledDataModality&&!d.offeredModalities[O.default.MODALITY.data]&&d.multiParty&&(d.offeredModalities[O.default.MODALITY.data]=O.default.MEDIA_STATE.inactive),N.isOnHold(d.offeredModalities)&&!P.isEmpty(d.negotiatedModalities)&&Object.keys(d.offeredModalities).forEach((function(l){void 0===d.negotiatedModalities[l]&&delete d.offeredModalities[l]})),u(d.updatePeerConnectionStreamsAsync(d.offeredModalities,!0,!0,l).then((function(){var u=d.createNegotiationConstraints(d.offeredModalities);return d.logger.safe.info(\"[\".concat(l,\"] create [offer] offered: \").concat(JSON.stringify(d.offeredModalities),\" constraints: \").concat(JSON.stringify(u))),d.peerConnection.createOffer(u)})).then((function(u){d.logger.unsafe.debug(\"[\".concat(l,\"] create [offer] offer from peer connection\"),\"sdp:\",u.sdp);var p=d.sessionDescription.createLocalOffer(u.sdp);d.hasIceCandidates(p)||d.resetCandidateGathering(l),d.stats.startWaitingForStreamStart(d.offeredModalities);var h=new d.webrtcAdapter.RTCSessionDescription({sdp:p.toLocal(),type:\"offer\"});return d.setupIceGatheringTimeout(l),Promise.all([d.peerConnection.setLocalDescription(h),d.iceCandidatesDeferred.promise])})).then((function(){var u=d.sessionDescription.createLocalOffer(d.peerConnection.localDescription.sdp);u.updateModalities(d.offeredModalities),d.checkIceCandidates(u);var p=u.toOffer();d.logger.unsafe.debug(\"CREATE OFFER\",\"sdp:\",p);var h={blob:p,contentType:d.mediaContentType};return\"\"===d.configProvider.config.webrtcRequiredFeatures||d.multiParty||(h.requiredFeatures=d.configProvider.config.webrtcRequiredFeatures),d.configProvider.countryCode&&(h.clientLocation=d.configProvider.countryCode),d.doRetargetIfNeeded(h,u,l),h})))}))}),l);return this.resetNegotiationQueue(l),u},WebRtcSession.prototype.processOfferAsync=function(l,d){var u=this,p=this.negotiationQueue.add((function(){return new Promise((function(p){var h=l.blob;if(u.logger.unsafe.debug(\"[\".concat(d,\"] process [offer]\"),\"sdp:\",h),u.configProvider.config.webrtcCompareContentTypeInOffer&&(P.throwIfNotSupported(l.contentType,u.allowedMediaContentType),u.mediaContentType=l.contentType),l.requiredFeatures){var g=u.configProvider.config.webrtcRejectedFeatures.split(\",\"),f=l.requiredFeatures.split(\",\");P.throwIfFeatureNotSupported(f,g)}u.initiator=!1,u.offeredDescription=u.sessionDescription.createRemoteOffer(h),u.canTriggerRenegotiation=!1,u.offeredModalities=N.invertModalities(u.offeredDescription.getModalities()),u.peerConnection||(u.context.configProvider.mediaConfig.isTransportUnbundled?u.context.configProvider.mediaConfig.isTransportUnbundled=u.offeredDescription.couldBeUnbundled():u.context.configProvider.mediaConfig.isTransportUnbundled=u.offeredDescription.isUnbundled());var m=Promise.resolve(u.offeredModalities);if(N.hasSendDirectionality(u.offeredModalities.video)||N.hasReceiveDirectionality(u.offeredModalities.video)||N.hasSendDirectionality(u.offeredModalities.sharing)||N.hasReceiveDirectionality(u.offeredModalities.sharing)){var v=u.offeredDescription.getVideoCodecs();m=u.webrtcAdapter.RTCRtpReceiver.getCapabilities(\"video\").then((function(l){if(!l.codecs.some((function(l){return v.some((function(d){return l.mimeType===d}))}))){u.logger.safe.warn(\"[\".concat(d,\"] offer doesn't contain any supported video codecs\"));var p=P.shallowClone(u.offeredModalities);return p.video=void 0,p.sharing=void 0,p}return u.offeredModalities})).catch((function(l){return u.logger.safe.error(\"[\".concat(d,\"] failed to get video capability \").concat(P.stringifyObject(l))),u.offeredModalities}))}p(m.then((function(l){return u.logger.safe.info(\"[\".concat(d,\"] process [offer] offered: \").concat(JSON.stringify(u.offeredModalities),\" acceptable: \").concat(JSON.stringify(l))),l})))}))}),d);return this.resetNegotiationQueue(d),p},WebRtcSession.prototype.createAnswerAsync=function(l,d){var u=this;return new Promise((function(p){if(l)p({blob:\"\",contentType:u.mediaContentType});else{u.logger.safe.info(\"[\".concat(d,\"] create [answer] offered: \").concat(JSON.stringify(u.offeredModalities),\" configured: \").concat(JSON.stringify(u.configuredModalities))),u.throwIfModalitiesNotConfigured(\"no configured modalities to create answer for\"),u.negotiatingModalities=N.excludePassiveModalities(u.configuredModalities,u.passiveModalities,u.offeredModalities);var h=N.negotiateModalities(u.offeredModalities,u.negotiatingModalities),g=u.offeredDescription.clone();p(u.updatePeerConnectionStreamsAsync(h,!0,!1,d).then((function(){return u.handleCodecSwitchUnsupported(d)})).then((function(){var l=u.offeredDescription.toRemote(h);u.mediaManager.updateMediaEntitiesWithLocalTracks(),u.registerMediaSources();var p=new u.webrtcAdapter.RTCSessionDescription({sdp:l,type:\"offer\"});return u.updateDescriptor(p,g),u.logger.unsafe.info(\"[\".concat(d,\"] create [answer] set remote description\"),\"negotiated:\",h,\"sdp:\",p.sdp),u.peerConnection.setRemoteDescription(p)})).then((function(){return u.callbacks.onTransportInitialized&&u.callbacks.onTransportInitialized(),u.updatePeerConnectionStreamsAsync(h,!1,!0,d)})).then((function(){return u.handleSharingRecvCapabilities(g),u.handleVideoRecvCapabilities(g)})).then((function(){return u.peerConnection.createAnswer()})).then((function(l){u.logger.unsafe.debug(\"[\".concat(d,\"] create [answer] answer from peer connection\"),\"sdp:\",l.sdp);var p=u.sessionDescription.createLocalAnswer(l.sdp);u.hasIceCandidates(p)||u.resetCandidateGathering(d),u.stats.startWaitingForStreamStart(h);var g=new u.webrtcAdapter.RTCSessionDescription({sdp:p.toLocal(),type:\"answer\"});return u.setupIceGatheringTimeout(d),Promise.all([u.peerConnection.setLocalDescription(g),u.iceCandidatesDeferred.promise])})).then((function(){var l=u.sessionDescription.createLocalAnswer(u.peerConnection.localDescription.sdp);l.updateModalities(h),u.checkIceCandidates(l);var p=l.toAnswer();h=l.getModalities(),N.areNegotiatedDirectionsAcceptable(u.configuredModalities,u.negotiatingModalities,h)||u.triggerRenegotiation(!0,d),u.setNegotiatedModalities(h),u.stats.sessionInfo.setBweType(l.getBweType()),u.logger.unsafe.debug(\"CREATE ANSWER\",\"sdp:\",p);var g={blob:p,contentType:u.mediaContentType};return u.configProvider.countryCode&&(g.clientLocation=u.configProvider.countryCode),g})))}}))},WebRtcSession.prototype.processAnswerAsync=function(l,d,u){var p=this,h=l.blob;if(this.logger.unsafe.debug(u?\"PROCESS PRANSWER\":\"PROCESS ANSWER\",\"sdp:\",h),u)return this.logger.safe.info(\"[\".concat(d,\"] process [pranswer] ignored\")),Promise.resolve();this.mediaContentType=l.contentType,-1===this.allowedMediaContentType.indexOf(this.mediaContentType)&&this.allowedMediaContentType.push(this.mediaContentType);var g=this.sessionDescription.createRemoteAnswer(h),f=g.clone(),m=N.invertModalities(g.getModalities());this.setNegotiatedModalities(m);var v=g.toRemote(this.negotiatedModalities);this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.registerMediaSources(),this.stats.sessionInfo.setBweType(g.getBweType());var y=new this.webrtcAdapter.RTCSessionDescription({sdp:v,type:\"answer\"});return this.updateDescriptor(y,f),this.logger.unsafe.info(\"[\".concat(d,\"] process [answer] set remote description\"),\"negotiated:\",this.negotiatedModalities,\"sdp:\",y.sdp),this.peerConnection.setRemoteDescription(y).then((function(){return p.callbacks.onTransportInitialized&&p.callbacks.onTransportInitialized(),p.negotiatedModalities})).then((function(){return p.handleSharingRecvCapabilities(f),p.handleVideoRecvCapabilities(f)})).then((function(l){l&&p.triggerRenegotiation(!0,d)}))},WebRtcSession.prototype.completeNegotiationAsync=function(l){var d=this;return new Promise((function(u){d.mediaManager.commit();var p=N.excludePassiveModalities(d.configuredModalities,d.passiveModalities,d.offeredModalities),h=d.forceMediaStreamUpdate&&!N.isOnHold(d.negotiatedModalities)||!N.areNegotiatedDirectionsAcceptable(p,d.negotiatingModalities,d.negotiatedModalities)||d.triggerRenegotiationFlag,g=!h;d.canTriggerRenegotiation=!0,d.logger.safe.info(\"[\".concat(l,\"] negotiation completed isComplete: \").concat(g,\" configured: \").concat(JSON.stringify(d.configuredModalities),\" negotiating: \").concat(JSON.stringify(d.negotiatingModalities),\" offered: \").concat(JSON.stringify(d.offeredModalities),\" negotiated: \").concat(JSON.stringify(d.negotiatedModalities))),h&&d.triggerRenegotiation(!1,l),d.negotiationCompletedPromise.resolve(),u({isComplete:g,activeModalities:d.negotiatedModalities,offeredModalities:d.offeredModalities,attemptedModalities:d.negotiatingModalities,configuredModalities:d.configuredModalities,initiator:d.initiator})}))},WebRtcSession.prototype.rejectNegotiationAsync=function(l,d,u){var p=this;return void 0===u&&(u=!1),Promise.resolve().then((function(){if(p.mediaManager.rollback(),p.logger.safe.warn(\"[\".concat(d,\"] negotiation rejected isComplete: \").concat(!u,\" error: \").concat(P.stringifyObject(l),\" configured: \").concat(JSON.stringify(p.configuredModalities),\" negotiating: \").concat(JSON.stringify(p.negotiatingModalities),\" offered: \").concat(JSON.stringify(p.offeredModalities),\" negotiated: \").concat(JSON.stringify(p.negotiatedModalities))),p.peerConnection){if(\"have-local-offer\"===p.peerConnection.signalingState)return p.logger.safe.info(\"[\".concat(d,\"] rolling back local description\")),p.configProvider.config.webrtcHandleRollback?(p.logger.safe.info(\"[\".concat(d,\"] rolling back using local renegotiation\")),p.negotiationEmulator.renegotiateNow().then((function(){p.logger.safe.info(\"[\".concat(d,\"] rolling back using local complete\"))}))):p.peerConnection.setLocalDescription(new p.webrtcAdapter.RTCSessionDescription({type:\"rollback\"}));p.logger.safe.error(\"[\".concat(d,\"] cannot rollback local description in currrent state: \").concat(p.peerConnection.signalingState))}})).then((function(){p.canTriggerRenegotiation=!0,p.negotiationCompletedPromise.reject(\"negotiation rejected\"),p.getAddedMediaTypes(p.negotiatedModalities,p.negotiatingModalities).forEach((function(l){p.removeTrackByMediaType(l),p.disposeStreamByMediaType(l)})),p.registerLocalStreams()})).then((function(){return u&&(p.logger.safe.info(\"[\".concat(d,\"] retrying failed negotiation\")),p.triggerRenegotiation(!1,d)),{isComplete:!u,activeModalities:p.negotiatedModalities,offeredModalities:p.offeredModalities,attemptedModalities:p.negotiatingModalities,configuredModalities:p.configuredModalities,initiator:p.initiator}}))},WebRtcSession.prototype.createRemoteRenderer=function(l){return this.remoteVideoManager.createRenderer(l,this.subscriptionManager,this.logger)},WebRtcSession.prototype.getStatsAsync=function(l){var d=this;return this.terminated||(this.statisticsReport=this.statisticsReport.then((function(){return d.stats.getReport(l)})).catch((function(l){return d.logger.safe.error(\"getting statistics should never fail: \".concat(l.error)),l.partialReport}))),this.statisticsReport},WebRtcSession.prototype.getLastKnownStats=function(l){return void 0===l&&(l=!1),this.stats.getLastKnownReport(!1,l)},WebRtcSession.prototype.isReconnectSupported=function(){return this.configProvider.config.enableReconnectChrome},WebRtcSession.prototype.muteHold=function(l,d){var u,p,h=this;this.isMuteHold=l;var g=[O.default.MODALITY.audio,O.default.MODALITY.video,O.default.MODALITY.sharing].filter((function(l){return N.hasSendDirectionality(h.negotiatedModalities[l])&&(l!==O.default.MODALITY.audio||!h.doAudioMute)}));try{for(var m=f(g),v=m.next();!v.done;v=m.next()){var y=v.value;this.setMute(N.modalityToMediaType(y),l,d)}}catch(l){u={error:l}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(u)throw u.error}}},WebRtcSession.prototype.muteInputAsync=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this.doAudioMute=!0,this.setMute(\"Audio\",!0,l),[2]}))}))},WebRtcSession.prototype.unmuteInputAsync=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this.doAudioMute=!1,this.setMute(\"Audio\",!1,l),[2]}))}))},WebRtcSession.prototype.muteOutputAsync=function(l){return this.audioRenderer.setMuted(!0,l),Promise.resolve()},WebRtcSession.prototype.unmuteOutputAsync=function(l){return this.audioRenderer.setMuted(!1,l),Promise.resolve()},WebRtcSession.prototype.sendDtmf=function(l){return this.dtmfSender.sendDtmf(this.peerConnection,l)},WebRtcSession.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.peerConnection)},WebRtcSession.prototype.pauseNegotiations=function(l){var d=this;void 0===l&&(l=(0,v.generateCauseId)());var u=new T.SettablePromise;return this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){d.setNegotiationPromise(u,l)})),u},WebRtcSession.prototype.getExtensionsManager=function(){return this.extensionsManager},WebRtcSession.prototype.onDeviceEvent=function(l){this.stats.onDeviceEvent(l)},WebRtcSession.prototype._deviceSelectionChanged=function(){this.peerConnection&&(this.audioRenderer&&this.audioRenderer.getStream()&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),N.isOnHold(this.negotiatedModalities)||(this.forceMediaStreamUpdate=!0,this.triggerRenegotiation(!0)))},WebRtcSession.prototype.terminate=function(l,d,u){return void 0===u&&(u=!0),h(this,void 0,void 0,(function(){var d;return g(this,(function(p){switch(p.label){case 0:this.logger.safe.info(\"[\".concat(l,\"] terminate\")),this.stats.setTerminated(),this.canTriggerRenegotiation=!1,this.cleanUp(l),p.label=1;case 1:return p.trys.push([1,4,5,6]),u?[4,this.getStatsAsync(!1)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[3,6];case 4:return d=p.sent(),this.logger.safe.error(\"[\".concat(l,\"] Error while gathering stats \").concat(P.stringifyObject(d))),[3,6];case 5:return this.stats.dispose(),this.terminated=!0,[7];case 6:return[2]}}))}))},WebRtcSession.prototype.cleanUp=function(l){this.activeSpeakerManager.dispose(),this.negotiationQueue.dispose(),this.negotiationCompletedPromise.reject(\"webRtcSession cleanUp\"),this.localVideoStreamWatcher.dispose(),this.remoteVideoManager.dispose(),this.resetPeerConnection(l),this.subscriptionManagerSubs.forEach((function(l){return l.dispose()})),this.subscriptionManager&&this.subscriptionManager.dispose(),this.clearIceDisconnectedTimer(),this.extensionsManager&&this.extensionsManager.dispose(),this.callbacks.onTerminated&&this.callbacks.onTerminated(this)},WebRtcSession.prototype.resetPeerConnection=function(l){this.logger.safe.info(\"[\".concat(l,\"] reset peer connection\")),this.audioRenderer&&this.audioRenderer.dispose(),this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.peerConnection&&this.peerConnection.close(),this.toBeCalledAfterConnected=[],this.disposeStreams(),this.peerConnection=null,this.contributingSources.stopPolling(),this.negotiationEmulator.configure(null),this.peerConnectionPromise=null,this.resetCandidateGathering(l),this.canTriggerRenegotiation=!0,this.negotiatedModalities={}},WebRtcSession.prototype.resetNegotiationQueue=function(l){void 0===l&&(l=(0,v.generateCauseId)()),this.negotiationCompletedPromise.reject(\"promise expired\"),this.setNegotiationPromise(new T.SettablePromise,l)},WebRtcSession.prototype.setNegotiationPromise=function(l,d){void 0===d&&(d=(0,v.generateCauseId)()),this.terminated||(this.negotiationCompletedPromise=l,this.negotiationQueue.add(this.negotiationCompletedPromise,d))},WebRtcSession.prototype.setupExtensionsManager=function(){var l=new w.default(this.logger.createChild(\"ExtMgr\"));return l.addExtension(O.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:this.logger,callback:this.activeSpeakerManager.onDominantSpeakerHistoryChanged.bind(this.activeSpeakerManager)}),l.addExtension(O.default.EXTENSION_TYPE.videoStreamControl,{logger:this.logger,negotiationEmulator:this.negotiationEmulator,qualityManager:this.qualityManager,configProvider:this.configProvider,statisticsGatherer:this.stats}),l},WebRtcSession.prototype.updateQualityLevels=function(l){if(l){this.hwSilent!==l.audioHwSilent&&(this.hwSilent=l.audioHwSilent,this.callbacks.onAudioHwSilentChanged&&this.callbacks.onAudioHwSilentChanged(this.hwSilent)),this.ufdManager.signalEvent(\"NetworkRecvQuality\",l.networkRecvLevel),this.ufdManager.signalEvent(\"NetworkSendQuality\",l.networkSendLevel);var d=!(!l.isSpeaking||!this.doAudioMute);this.ufdManager.signalEvent(\"DeviceSpeakWhileMuted\",d?\"Bad\":\"Good\")}},WebRtcSession.prototype.triggerRenegotiation=function(l,d){void 0===d&&(d=(0,v.generateCauseId)()),this.canTriggerRenegotiation?(this.canTriggerRenegotiation=!1,this.triggerRenegotiationFlag=!1,this.logger.safe.info(\"[\".concat(d,\"] triggering renegotiation\")),this.mediaManager.backup(),this.callbacks.onNegotiationRequired&&this.callbacks.onNegotiationRequired(d)):l&&(this.logger.safe.info(\"[\".concat(d,\"] renegotiation postponed\")),this.triggerRenegotiationFlag=!0)},WebRtcSession.prototype.throwIfModalitiesNotConfigured=function(l){if(!this.configuredModalities)throw new Error(l)},WebRtcSession.prototype.addTrack=function(l,d,u){if(l){var p=this.modalityByMediaType(u);if(this.logger.safe.info(\"add media track kind: \".concat(l.kind,\" id: \").concat(l.id)),this.senders[p])throw new Error(\"track already created, modality:\"+p+\", kind:\"+l.kind+\", id:\"+l.id);\"closed\"!==this.peerConnection.iceConnectionState&&(this.senders[p]=this.peerConnection.addTrack(l,d))}},WebRtcSession.prototype.registerMediaSources=function(){var l=this,d=[];if(this.mediaStreams.forEach((function(u,p){var h={sourceId:l.getSourceIdForStream(u),defaultSSRC:l.ssrcs[p].min,modality:l.modalityByMediaType(p)};d.push(h)})),this.qualityManager.updateRegisteredSources(d),this.videoStream){var u=this.videoStream.getResolution();this.qualityManager.setCurrentResolution(new E.ResolutionInfo(u.width,u.height))}},WebRtcSession.prototype.updateStream=function(l,d){var u=this;return l.start().then((function(){try{var p=u.mediaStreams.get(d);if(p&&l.isSameStream(p))return l.dispose(),null;if(u.updateSsrcRangeForMediaType(d),u.removeTrackByMediaType(d),u.disposeStreamByMediaType(d),!u.peerConnection)return l.dispose(),null;if(u.addTrack(l.rawTrack,l.rawStream,d),l.onApplyConstraints=function(p){u.removeTrackByMediaType(d),p.then((function(){u.addTrack(l.rawTrack,l.rawStream,d),u.registerLocalStreams(),u.mediaManager.updateMediaEntitiesWithLocalTracks()}))},u.mediaStreams.set(d,l),\"Video\"===d){var h=[u.getMediaTrackInfo(d)];u.localVideoStreamWatcher.startWatching(h)}}catch(p){throw u.removeTrackByMediaType(d),u.disposeStreamByMediaType(d),l.dispose(),p}}))},WebRtcSession.prototype.getSourceIdForStream=function(l){var d=l.rawStream.getTracks()[0].id,u=this.mediaManager.getMediaEntityByLocalTrackId(d);return u?(this.logger.safe.info(\"Media entity found: \".concat(JSON.stringify(u.getXSourceStreamId()))),u.getXSourceStreamId()):(this.logger.safe.error(\"Media entity is not found for stream: \".concat(JSON.stringify(d))),0)},WebRtcSession.prototype.updatePeerConnectionStreamsAsync=function(l,d,u,p){var h=this,g=N.hasSendDirectionality(this.negotiatedModalities.audio),f=N.hasSendDirectionality(this.negotiatedModalities.video),m=N.hasSendDirectionality(this.negotiatedModalities.sharing),v=N.isOnHold(this.negotiatedModalities),y=N.hasSendDirectionality(l.audio),S=N.hasSendDirectionality(l.video),_=N.hasSendDirectionality(l.sharing),C=N.isOnHold(l);return v||C||(this.stats.onSendersChanged(\"Audio\",y),this.stats.onSendersChanged(\"Video\",S),this.stats.onSendersChanged(\"ScreenShare\",_)),this.assurePeerConnectionAsync(p).then((function(){if(h.logger.safe.info(\"updatePeerConnectionStreamsAsync\",\"pc state\",h.peerConnection.signalingState,\"hold\",\"[\",v,\"->\",C,\"]\",\"audio\",\"[\",g,\"->\",y,\"]\",\"video\",\"[\",f,\"->\",S,\"]\",\"sharing\",\"[\",m,\"->\",_,\"]\"),v!==C){if(h.videoStream&&h.videoStream.setHold(C),h.audioStream&&h.audioStream.setHold(C),h.displayStream&&h.displayStream.setHold(C),C)return;if(!C&&h.audioStream){h.removeTrackByMediaType(\"Audio\");var l=h.audioStream.clone();h.audioStream.dispose(),h.mediaStreams.set(\"Audio\",l),h.addTrack(h.audioStream.rawStream.getAudioTracks()[0],h.audioStream.rawStream,\"Audio\")}}if((g!==y||f!==S||m!==_||h.forceMediaStreamUpdate)&&(u&&(h.forceMediaStreamUpdate=!1),d&&(h.logger.safe.info(\"not using any media(track api) track, remove all senders\"),y||(h.removeTrackByMediaType(\"Audio\"),h.disposeStreamByMediaType(\"Audio\")),u&&S||(h.removeTrackByMediaType(\"Video\"),h.disposeStreamByMediaType(\"Video\")),u&&_||(h.removeTrackByMediaType(\"ScreenShare\"),h.disposeStreamByMediaType(\"ScreenShare\"))),u)){var p=[];if(S){var E=h.deviceManager.getVideoStream(!1);p.push(h.updateStream(E,\"Video\"))}if(_){E=h.deviceManager.getDisplayStream(!1);p.push(h.updateStream(E,\"ScreenShare\"))}if(y){E=h.deviceManager.getAudioStream(!1);p.push(h.updateStream(E,\"Audio\").then((function(){h.audioStream.setMuted(h.doAudioMute)})))}return Promise.all(p).then((function(){return h.registerLocalStreams()}))}}))},WebRtcSession.prototype.getMediaTrackInfo=function(l){var d=this.modalityByMediaType(l),u=this.mediaStreams.get(l).rawStream.getTracks()[0].id;return u||this.logger.safe.error(\"No media track for modality found: \".concat(d)),{trackId:u,modality:d}},WebRtcSession.prototype.getSsrcRangeForMediaType=function(l){var d={min:1,max:1};switch(l){case\"Audio\":return this.ssrcGenerator.nextAudioStreamSsrc();case\"Video\":case\"ScreenShare\":return this.ssrcGenerator.nextVideoStreamSsrc();default:return d}},WebRtcSession.prototype.updateSsrcRangeForMediaType=function(l){\"Video\"!==l&&\"ScreenShare\"!==l||(this.ssrcs[l]=this.ssrcGenerator.nextVideoStreamSsrc())},WebRtcSession.prototype.getStreamTransformConfiguration=function(){return{unifiedPlanEnabled:!1,addPrefixForMsid:this.configProvider.config.addPrefixForMsidInSdp}},WebRtcSession.prototype.registerLocalStreams=function(){var l=this,d=[];this.mediaStreams.forEach((function(u,p){d.push(l.getMediaTrackInfo(p))})),this.mediaManager.setLocalTracksInfo(d)},WebRtcSession.prototype.handleVideoRecvCapabilities=function(l){if(this.configProvider.config.enableLocalVideoConstraints&&N.hasReceiveDirectionality(l.getModalities().video)){if(this.videoStream){var d=l.getVideoRecvCapabilities();if(!d)return this.logger.safe.error(\"No fmt params found for video modality\"),Promise.resolve(!1);var u=this.generateReceiveCapabilities(d,this.videoStream);this.qualityManager.setMaxCapabilities([u])}this.logger.safe.error(\"remote endpoint didn't specify video receive capability\")}return Promise.resolve(!1)},WebRtcSession.prototype.handleSharingRecvCapabilities=function(l){if(this.configProvider.config.enableLocalVideoConstraints&&N.hasReceiveDirectionality(l.getModalities().sharing)&&this.displayStream){var d=l.getSharingRecvCapabilities();if(!d)return void this.logger.safe.error(\"No fmt params found for sharing modality\");var u=this.generateReceiveCapabilities(d,this.displayStream);this.qualityManager.setMaxCapabilities([u])}},WebRtcSession.prototype.generateReceiveCapabilities=function(l,d){var u=p({ssrc:0,rid:\"0\",keyframe:!1},l),h={causeId:(0,v.generateCauseId)(),isSimulcast:!1,sourceId:this.getSourceIdForStream(d),capabilities:[u]};return this.logger.safe.info(\"Generated receive capabilities for stream \".concat(d.id,\": \").concat(JSON.stringify(h))),h},WebRtcSession.prototype.updateDescriptor=function(l,d){var u=d.getVideoRecvCapabilities(),p={sourceId:0,streamMsid:0,bandwidth:0};if(u&&this.videoStream&&!this.displayStream&&(p.sourceId=this.getSourceIdForStream(this.videoStream),p.streamMsid=this.videoStream.id,p.bandwidth=u.maxBr?u.maxBr:Number.MAX_VALUE),p.bandwidth>0){p.bandwidth=Math.floor(p.bandwidth/1200);var h=new M.BandwidthControlModifier(this.logger.createChild(\"rembModifier\"),this.qualityManager,this.resolutionTable,this.configProvider);h.setControlItem(p),h.modifyDescriptor(l)}},WebRtcSession.prototype.removeTrackByMediaType=function(l){return this.removeTracksByModality(this.modalityByMediaType(l))},WebRtcSession.prototype.modalityByMediaType=function(l){switch(l){case\"Audio\":return O.default.MODALITY.audio;case\"Video\":return O.default.MODALITY.video;case\"ScreenShare\":return O.default.MODALITY.sharing;default:throw new Error(\"Modality is not defined for media type: \".concat(l))}},WebRtcSession.prototype.removeTracksByModality=function(l){var d=this;this.forceKeyFramePromise&&\"sharing\"===l?this.forceKeyFramePromise.then((function(){d.removeTracksByModality(l)})):l in this.senders&&(this.logger.safe.info(\"remove sender track kind: \".concat(this.senders[l].track.kind,\" track id: \").concat(this.senders[l].track.id)),\"closed\"!==this.peerConnection.iceConnectionState&&this.peerConnection.removeTrack(this.senders[l]),delete this.senders[l])},WebRtcSession.prototype.handleCodecSwitchUnsupported=function(l){var d=this;return this.offeredDescription.isCodecSwitchSupported()?Promise.resolve():this.webrtcAdapter.RTCRtpReceiver.getCapabilities(O.default.MEDIA_TYPE.audio).then((function(l){var u=l.codecs.map((function(l){return l.mimeType}));d.offeredDescription.usePrimaryAudioCodecOnly(u)})).catch((function(u){d.logger.safe.error(\"[\".concat(l,\"] failed to set primary codec based on audio capability \").concat(P.stringifyObject(u)))}))},WebRtcSession.prototype.disposeStreamByMediaType=function(l){var d=this.mediaStreams.get(l);d&&(this.mediaStreams.delete(l),d.dispose(),\"Video\"===l&&this.localVideoStreamWatcher.stopWatching())},WebRtcSession.prototype.disposeStreams=function(){var l=this;this.mediaStreams.forEach((function(d,u){return l.disposeStreamByMediaType(u)}))},WebRtcSession.prototype.assurePeerConnectionAsync=function(l){var d=this;if(!this.peerConnectionPromise){if(!this.relayManagerProvider)throw new Error(\"relay manager provider is not set!\");this.logger.safe.info(\"fetching relay details from RelayManager...\");var u={relayType:\"turn\",isRemoteClientLync:this.context.config.isRemoteClientLync};this.peerConnectionPromise=this.relayManagerProvider.getRelayManager().queryRelaysAsync(u).then((function(u){if(d.terminated)throw new Error(\"session already disposed\");var p={optional:[]},h=(0,q.createIceServers)(u,d.configProvider.config),g=d.configureCrypto(p);d.configureCpuThreshold(p),d.logger.safe.info(\"create peer connection\");var f=d.context.configProvider.mediaConfig.isTransportUnbundled?\"balanced\":\"max-bundle\",y=d.peerConnection=new d.webrtcAdapter.RTCPeerConnection({iceServers:h,rtcpMuxPolicy:\"require\",iceTransportPolicy:d.iceTransportPolicy,bundlePolicy:f,sdpSemantics:\"plan-b\",audioPortRange:d.configProvider.mediaConfig.audioPortRange,videoPortRange:d.configProvider.mediaConfig.videoPortRange,enableDtlsSrtp:1===g,offerExtmapAllowMixed:!1},p);d.negotiationEmulator.configure(y),d.stats.initialize(y),d.stats.sessionInfo.setIceServers(h),d.stats.sessionInfo.setIceTransportPolicy(d.iceTransportPolicy),d.stats.sessionInfo.setBundlePolicy(f),d.webrtcAdapter.RTCRtpReceiver.getCapabilities(\"video\").then((function(l){return d.stats.setH264AvailableProfiles(l)})),d.contributingSources.startPolling(),y.onnegotiationneeded=function(){d.logger.safe.info(\"onnegotiationneeded signalingState: \".concat(y.signalingState))},y.onsignalingstatechange=function(){d.stats.sessionInfo.setSignalingConnectionState(y.signalingState),d.logger.safe.info(\"onsignalingstatechange signalingState: \".concat(y.signalingState))},y.onicecandidateerror=function(l){var u=m([l.address,l.port],2),p=u[0],h=u[1];d.logger.safe.warn(\"On ICE candidate error \".concat(l.url,\" | \").concat(p,\":\").concat(h,\": code \").concat(l.errorCode,\": \").concat(l.errorText)),d.isConnected()&&!d.iceCandidatesDeferred.isPending||d.stats.addIceCandidateError({address:p,port:+h,url:l.url,errorCode:l.errorCode,errorText:l.errorText})};var onAddStream=function(l){if(!d.isConnected())return d.logger.safe.info(\"onaddstream handling postponed till PC is connected\"),void d.toBeCalledAfterConnected.push((function(){return onAddStream(l)}));var u=l.stream;d.logger.safe.info(\"onaddstream stream: \".concat(u.id));var p=d.mediaManager.getMediaEntityByRemoteStreamId(u.id);if(p||(d.logger.safe.info(\"cannot find media entity with stream id \".concat(u.id,\" trying to fallback\")),u.getAudioTracks()[0]&&(p=d.mediaManager.getMediaEntitiesByModality(O.default.MODALITY.audio)[0])),p){var h=d.createReceiveStream(u,p);d.receiveStreamCollection.add(h)}else d.logger.safe.error(\"could not find media entity for an added stream: \".concat(u.id))};y.onaddstream=onAddStream,y.ontrack=function(l){d.logger.safe.info(\"ontrack track: \".concat(l.track))};var onRemoveStream=function(l){if(!d.isConnected())return d.logger.safe.info(\"onremovestream handling postponed till PC is connected\"),void d.toBeCalledAfterConnected.push((function(){return onRemoveStream(l)}));d.logger.safe.info(\"onremovestream stream: \".concat(l.stream)),d.receiveStreamCollection.remove(l.stream.id)};y.onremovestream=onRemoveStream,y.onicecandidate=function(u){var p=u.candidate;if(p){var g=N.parseCandidateString(p.candidate);d.logger.safe.info(\"[\".concat(l,\"] onicecandidate candidate: prio:\").concat(g.priority,\" type:\").concat(g.type,\" port:\").concat(g.port)),d.logger.unsafe.info(\"[\".concat(l,\"] candidate details: \").concat(p.candidate)),!d.relayCandidateGathered&&p.candidate.indexOf(\"typ relay\")>-1&&(d.stats.sessionInfo.setRelayCandidateInfo({priority:p.priority||p.candidate.split(\" \")[3],time:Date.now()-d.iceRelayCandidatesGatherStartTime}),d.relayCandidateGathered=!0)}else d.logger.safe.info(\"[\".concat(l,\"] onicecandidate candidate: null\"));if(d.iceCandidatesDeferred.isPending){var f=!d.initiator||!d.context.config.webrtcIceGatheringTimeoutIncreased,m=d.iceHostCandidateOnly||0===h.length;if(!p&&f||m){p&&d.logger.safe.info(\"[\".concat(l,\"] Not waiting for ICE candidates, hoping that host/prflx is enough\")),d.logger.safe.info(\"[\".concat(l,\"] Is connected:\"),d.isConnected(),y.iceConnectionState,y.signalingState);var v=!0;if(d.context.configProvider.mediaConfig.isTransportUnbundled&&p)v=d.sessionDescription.createLocalOffer(d.peerConnection.localDescription.sdp).hasUnbundledIceCandidates();v&&d.completeCandidateGathering(l)}else if(d.relayCandidateGathered){v=!0;if(d.context.configProvider.mediaConfig.isTransportUnbundled)v=d.sessionDescription.createLocalOffer(d.peerConnection.localDescription.sdp).hasUnbundledRelayIceCandidates();v&&(d.stats.clearIceCandidateErrors(),d.completeCandidateGathering(l))}}},y.onicegatheringstatechange=function(){d.logger.safe.info(\"onicegatheringstatechange iceGatheringState: \".concat(y.iceGatheringState))},y.oniceconnectionstatechange=function(){var l=(0,v.generateCauseId)();if(!d.terminated){if(d.stats.sessionInfo.setIceConnectionState(y.iceConnectionState),d.logger.safe.info(\"[\".concat(l,\"] oniceconnectionstatechange iceConnectionState: \").concat(y.iceConnectionState,\" pc.signalingState: \").concat(y.signalingState)),\"connected\"===y.iceConnectionState||\"completed\"===y.iceConnectionState)d.onTransportConnected(l);else if(\"failed\"===y.iceConnectionState){if(d.iceCandidatesDeferred.isPending)return d.logger.safe.info(\"[\".concat(l,\"] ice failed while gathering candidates, suppressing error\")),void d.completeCandidateGathering(l);d.raiseError({type:O.default.MEDIA_ERROR.iceConnectionError,detail:\"ice transport failed\"},l),d.configProvider.config.webrtcCloseAfterIceFailure&&y.close(),d.onTransportFailed()}\"disconnected\"===y.iceConnectionState?(d.onTransportDisconnected(l),d.startIceDisconnectedTimer(l)):d.clearIceDisconnectedTimer()}}}))}return this.peerConnectionPromise},WebRtcSession.prototype.configureCrypto=function(l){var d=!1,u=N.preferSdesSrtp(this.context);if(this.offeredDescription){var p=this.offeredDescription.getSrtpInfo();this.stats.sessionInfo.setOfferedSrtpInfo(p),d=!p.dtls||p.sdes&&u}else d=u;return d&&(this.logger.safe.info(\"configuring peer connection to use sdes\"),l.optional.push({DtlsSrtpKeyAgreement:!1})),this.stats.sessionInfo.setNegotiatedSrtpInfo({dtls:!d,sdes:!!d}),d?0:1},WebRtcSession.prototype.configureCpuThreshold=function(l){this.configProvider.config.webrtcNativeCpuOveruseDisabled&&this.multiParty&&l.optional.push({googCpuOveruseDetection:!1})},WebRtcSession.prototype.completeCandidateGathering=function(l){this.iceCandidatesDeferred.isPending&&(this.logger.safe.info(\"[\".concat(l,\"] ICE candidates gathered completely\")),this.iceCandidatesDeferred.resolve())},WebRtcSession.prototype.onTransportConnected=function(l){if(this.logger.safe.info(\"[\".concat(l,\"] audio transport connected\")),this.stats.clearIceCandidateErrors(),!this.terminated){for(;this.toBeCalledAfterConnected.length;)this.toBeCalledAfterConnected.shift()();this.callbacks.onAudioStateChanged(O.default.STREAMING_STATE.active,l),this.callbacks.onTransportConnected&&this.callbacks.onTransportConnected(l)}},WebRtcSession.prototype.onTransportDisconnected=function(l){this.callbacks.onTransportDisconnected&&this.callbacks.onTransportDisconnected(l)},WebRtcSession.prototype.onTransportFailed=function(){this.callbacks.onTransportFailed&&this.callbacks.onTransportFailed()},WebRtcSession.prototype.startIceDisconnectedTimer=function(l){var d=this;this.configProvider.config.iceDisconnectedTimeoutMs&&(this.iceDisconnectedTimer=setTimeout((function(){d.logger.safe.error(\"[\".concat(l,\"] ice disconnected for \").concat(d.configProvider.config.iceDisconnectedTimeoutMs,\"ms. Raise CONSTANTS.MEDIAthis._ERROR.iceConnectionError\")),d.raiseError({type:O.default.MEDIA_ERROR.iceConnectionError,detail:\"ice transport disconnected\"},l)}),this.configProvider.config.iceDisconnectedTimeoutMs))},WebRtcSession.prototype.clearIceDisconnectedTimer=function(){this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null)},WebRtcSession.prototype.raiseError=function(l,d){void 0===d&&(d=(0,v.generateCauseId)()),this.logger.safe.error(\"[\".concat(d,\"] Media error occurred type: \").concat(l.type,\" detail: \").concat(l.detail)),this.callbacks.onSessionErrorOccurred&&this.callbacks.onSessionErrorOccurred(l,d)},WebRtcSession.prototype.createNegotiationConstraints=function(l){function canReceive(l){return!!l&&(N.hasReceiveDirectionality(l)||\"inactive\"===l)}return{offerToReceiveAudio:canReceive(l.audio),offerToReceiveVideo:canReceive(l.video)||canReceive(l.sharing)}},WebRtcSession.prototype.resetCandidateGathering=function(l){this.logger.safe.info(\"[\".concat(l,\"] reset candidate gathering\")),this.iceCandidatesDeferred.promise.then((function(){}),(function(){})),this.iceCandidatesDeferred.reject(new Error(\"reset candidate gathering\")),this.iceCandidatesDeferred=new T.SettablePromise},WebRtcSession.prototype.checkIceCandidates=function(l){var d=this.hasIceCandidates(l);if(d===this.noIceCandidates&&(this.noIceCandidates=!this.noIceCandidates,this.ufdManager.signalEvent(\"NoNetwork\",this.noIceCandidates?\"Bad\":\"Good\"),this.noIceCandidates))throw{type:O.default.MEDIA_ERROR.noNetworkError,detail:\"no ice candidates\"};if(d){var u=this.hasRelayIceCandidates(l);if(u===this.noRelayIceCandidates){if(!u&&(\"connected\"===this.peerConnection.iceConnectionState||\"completed\"===this.peerConnection.iceConnectionState))return;this.noRelayIceCandidates=!this.noRelayIceCandidates,this.ufdManager.signalEvent(\"NetworkRelaysNotReachable\",this.noRelayIceCandidates?\"Bad\":\"Good\")}}},WebRtcSession.prototype.hasIceCandidates=function(l){return this.configProvider.mediaConfig.isTransportUnbundled?l.hasUnbundledIceCandidates():l.hasIceCandidates()},WebRtcSession.prototype.hasRelayIceCandidates=function(l){return this.configProvider.mediaConfig.isTransportUnbundled?l.hasUnbundledRelayIceCandidates():l.hasRelayIceCandidates()},WebRtcSession.prototype.doRetargetIfNeeded=function(l,d,u){var p=d.isIceRestart();this.logger.safe.info(\"[\".concat(u,\"] ICE restart: \").concat(p)),this.context.configProvider.mediaConfig.isTransportUnbundled&&this.offeredDescription&&this.offeredDescription.isMSRTC()&&p&&!this.multiParty&&d.getSrtpInfo().sdes&&(l.newOffer=!0)},WebRtcSession.prototype.getAddedMediaTypes=function(l,d){l||(l={}),d||(d={});var u=[];return isModalityAdded(l.audio,d.audio)&&u.push(\"Audio\"),isModalityAdded(l.video,d.video)&&u.push(\"Video\"),isModalityAdded(l.sharing,d.sharing)&&u.push(\"ScreenShare\"),u},WebRtcSession.prototype.applyCapabilitiesForModality=function(l,d,u){return l===O.default.MODALITY.video?this.applyCapabilitiesForVideo(d,u[0]):l===O.default.MODALITY.sharing?this.applyCapabilitiesForSharing(d,u[0]):Promise.resolve(!1)},WebRtcSession.prototype.applyCapabilitiesForSharing=function(l,d){var u=this;return this.displayStream?this.applyCapabilities(this.displayStream,d).then((function(p){return u.stats.onMaxCapabilitiesApplied({causeId:l,modality:O.default.MODALITY.sharing,capabilities:[d]}),u.configProvider.config.webrtcAllowRestoreKeyframe?u.forceKeyframe(u.senders[O.default.MODALITY.sharing]).then((function(){return p})):Promise.resolve(p)})):(this.logger.safe.info(\"\".concat(JSON.stringify(d),\" is ignored as no sharing stream is sent, no renegotiation\")),Promise.resolve(!1))},WebRtcSession.prototype.forceKeyframe=function(l){var d=this;if(!l)return this.logger.safe.error(\"forceKeyframe: No sender available for sharing\"),null;if(this.forceKeyFramePromise)return this.logger.safe.warn(\"forceKeyframe: already in progress\"),this.forceKeyFramePromise;this.logger.safe.info(\"Restoring keyframe\");var u=l.track;return this.forceKeyFramePromise=l.replaceTrack(null).then((function(){return l.replaceTrack(u)})).then((function(){d.forceKeyFramePromise=null,d.logger.safe.info(\"Restoring keyframe finished\")})).catch((function(l){d.forceKeyFramePromise=null,d.logger.safe.error(\"Restoring keyframe failed: \".concat(l)),delete d.senders[O.default.MODALITY.sharing]})),this.forceKeyFramePromise},WebRtcSession.prototype.applyCapabilitiesForVideo=function(l,d){return this.negotiationCompletedPromise.isPending?(this.logger.safe.info(\"##### Renegotiation is in progress, no local resolution switch for now #####\"),this.negotiationCompletedPromise.promise.then((function(){return Promise.resolve(!1)}))):this.videoStream?this.scheduleApplyCapabilities(this.videoStream,l,d):(this.logger.safe.info(\"\".concat(JSON.stringify(d),\" is ignored as no video is sent, no renegotiation\")),Promise.resolve(!0))},WebRtcSession.prototype.scheduleApplyCapabilities=function(l,d,u){var p=this;this.logger.safe.info(\"Queueing local renegotiation...\");var h=!1;return this.negotiationQueue.add((function(){return p.logger.safe.info(\"############# LOCAL RENEGOTIATION START #############\"),p.applyCapabilities(l,u).then((function(){p.stats.onMaxCapabilitiesApplied({causeId:d,modality:O.default.MODALITY.video,capabilities:[u]}),h=!0}))}),d),this.negotiationEmulator.renegotiate().then((function(){return p.logger.safe.info(\"############# LOCAL RENEGOTIATION END. RESULT: \".concat(h,\"  #############\")),h}))},WebRtcSession.prototype.applyCapabilities=function(l,d){return l?(this.logger.safe.info(\"Changing resolution to \".concat(JSON.stringify(d))),l.applyCapabilities(d)):(this.logger.safe.info(\"Resolution \".concat(JSON.stringify(d),\" ignored, no stream is being sent\")),Promise.resolve(!1))},WebRtcSession.prototype.onOptimalVideoReceiversCountChanged=function(l){this.callback.onOptimalVideoReceiversCountChanged&&this.callback.onOptimalVideoReceiversCountChanged(l)},WebRtcSession.prototype.onSendBandwidthChanged=function(l){return h(this,void 0,void 0,(function(){var d,u,p=this;return g(this,(function(h){return this.isConnected()?(d=this.extensionsManager.getExtension(O.default.EXTENSION_TYPE.videoStreamControl),0===(u=this.mediaManager.getMediaEntities().filter((function(l){return[O.default.MODALITY.video,O.default.MODALITY.sharing].indexOf(l.getModality())>-1})).filter((function(l){return l.isEnabled()})).map((function(l){return l.getMid()}))).length?[2]:[2,d.sendBandwidthInfo(u,l).then((function(){p.stats.setReportedSendBandwidth(l)}))]):[2]}))}))},WebRtcSession.prototype.getStreams=function(){return this.receiveStreamCollection.getStreams()},WebRtcSession.prototype.onStreamsChanged=function(l){this.streamsChangedListener=l},WebRtcSession.prototype.notifyStreamsChanged=function(){var l=this;this.logger.safe.info(\"Scheduling stream changed notification: \".concat(this.streamsChangedNotificationScheduled)),this.streamsChangedNotificationScheduled||this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){l.streamsChangedNotificationScheduled=!1,l.streamsChangedListener&&l.streamsChangedListener()}))},WebRtcSession.prototype.streamAdded=function(l){O.default.MODALITY.audio===l.getModality()&&(this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId()),this.audioRenderer.play(l.getMediaStream())),this.notifyStreamsChanged()},WebRtcSession.prototype.streamRemoved=function(l){O.default.MODALITY.audio===l.getModality()&&this.audioRenderer.getStream()===l.getMediaStream()&&this.audioRenderer.stop(),this.notifyStreamsChanged()},WebRtcSession.prototype.setNegotiatedModalities=function(l){this.negotiatedModalities=l,this.stats.sessionInfo.setNegotiatedModalities(l)},WebRtcSession.prototype.setupIceGatheringTimeout=function(l){var d=this;this.iceRelayCandidatesGatherStartTime=Date.now();var u=this.context.config.webrtcIceGatheringTimeoutIncreased?this.configProvider.config.relayWaitSaneTimeoutMs:this.configProvider.config.webrtcIceGatheringTimeoutMs;if(u){this.iceCandidatesTimer>0&&clearTimeout(this.iceCandidatesTimer);var p=this.iceCandidatesDeferred;this.iceCandidatesTimer=setTimeout((function(){d.iceCandidatesTimer=0,p.isPending&&(d.logger.safe.warn(\"[\".concat(l,\"] ICE candidates gathering terminated due to timeout \").concat(u)),p.resolve())}),u)}},WebRtcSession.prototype.createAudioRenderer=function(){this.audioRenderer=new C.default(this.logger.createChild(\"AudioRenderer\"),this.configProvider),this.context.maContext.domOverrides.onMediaElementAdded&&this.audioRenderer.on(\"onAudioElementAdded\",this.context.maContext.domOverrides.onMediaElementAdded),this.context.maContext.domOverrides.onMediaElementRemoved&&this.audioRenderer.on(\"onAudioElementRemoved\",this.context.maContext.domOverrides.onMediaElementRemoved)},WebRtcSession.prototype.isConnected=function(){var l=this.peerConnection;return l&&(\"connected\"===l.iceConnectionState||\"completed\"===l.iceConnectionState)},WebRtcSession.prototype.isFailed=function(){return this.peerConnection&&(\"failed\"===this.peerConnection.iceConnectionState||\"closed\"===this.peerConnection.iceConnectionState)},WebRtcSession.prototype.createReceiveStream=function(l,d){var u=this.configProvider.config.addFmtpToInitialSubscription?d.getVideoCapabilities():null;return new H.default(l,d.getModality(),+d.getXSourceStreamId(),this,u)},WebRtcSession.prototype.requestSource=function(l,d,u,p){var h=this;return this.multiParty?!this.isMuteHold&&this.negotiatedModalities[l]!==O.default.MEDIA_STATE.inactive||u===I.MediaSourceIdentifiers.SourceNone?this.negotiationCompletedPromise.isPending?this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){return h.requestSource(l,d,u,p)})):Promise.resolve().then((function(){return h.extensionsManager.getExtension(O.default.EXTENSION_TYPE.videoStreamControl).sendSourceRequest(d,u,p)})):y.delay(10).then((function(){return h.requestSource(l,d,u,p)})):Promise.resolve()},WebRtcSession.prototype.onMaxVideoSendCapabilitiesChanged=function(l,d){},WebRtcSession.prototype.getSessionConfig=function(){return this.configProvider},WebRtcSession}();function isModalityAdded(l,d){return!N.hasSendDirectionality(l)&&N.hasSendDirectionality(d)}d.default={build:function(l,d,u){return new K(l,d,u)}}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.StatisticsGathererV2=void 0;var p=u(1),h=u(9),g=u(382),f=function(){function StatisticsGathererV2(l,d,u,p){this.logger=l,this.configProvider=d,this.diagnostics=u,this.mediaManager=p,this.webrtcStats=new g.WebrtcStatisticsV2(this.configProvider,this.diagnostics),this.ssrcToRecvTrackMap=new Map}return StatisticsGathererV2.prototype.processRawReport=function(l){this.diagnostics.latestRawReport=l;var d={loopTime:-1,fetchTime:-1,convertTime:-1,processingTime:-1,updateTime:-1,legacyProcessingTime:-1};try{var u=p.hptime(),h=u,g=this.convertStatsReport(l);return g.perfCounters=d,u=p.hptime(),d.convertTime=u-h,h=u,this.webrtcStats.processStats(g),this.diagnostics.addStatsReport(g),u=p.hptime(),d.processingTime=u-h,g}catch(l){var f=p.stringifyObject(l);return this.logger.safe.error(\"Error processing raw stats: \".concat(f)),void this.diagnostics.addStatsError(\"StatisticsGatherer:processRawReport\",f)}},StatisticsGathererV2.prototype.setSsrcTrackPair=function(l,d){null===d?this.ssrcToRecvTrackMap.delete(l):this.ssrcToRecvTrackMap.set(l,d)},StatisticsGathererV2.prototype.convertStatsReport=function(l){var d=this,u={transports:this.processTransportStats(l)},h=\"\";l[\"peer-connection\"]&&(p.forOwn(l[\"peer-connection\"],(function(l){\"\"===h?h=l:(d.logger.safe.error(\"Unexpected second peer connection stats id \".concat(l,\", also found \").concat(h)),d.diagnostics.addStatsError(\"StatisticsGatherer\",\"Unexpected second peer connection stats\"))})),u.peerConnection=l[\"peer-connection\"][h]);var g=this.mediaManager.getMediaEntities(),getEntityByRemoteSSRC=function(l){return g.find((function(d){return d.getRemoteSsrc()===l}))},getEntityByRemoteTrack=function(l){return void 0!==l?g.find((function(d){return d.getRemoteTrackId()===l})):void 0},getEntityByLocalSSRC=function(l,d){return g.find((function(u){var p;return u.getLocalSsrc()===l&&(!d||(null===(p=u.getSimulcastContext())||void 0===p?void 0:p.activeRids.map(String).some((function(l){return l===d}))))}))},getEntityByLocalTrack=function(l,d){return l?g.find((function(u){var p;return u.getLocalTrackId()===l&&(!d||(null===(p=u.getSimulcastContext())||void 0===p?void 0:p.activeRids.map(String).some((function(l){return l===d}))))})):void 0},getRequestedCapabilitiesBySsrc=function(l,u){var p=d.diagnostics.getObjectRef().qualityManager;return\"video\"===l?null==p?void 0:p.currentVideoSsrcRequestedCapabilities[\"\".concat(u)]:\"sharing\"===l?null==p?void 0:p.currentSharingSsrcRequestedCapabilities[\"\".concat(u)]:void 0},getAppliedCapabilitiesBySsrc=function(l,u){var p=d.diagnostics.getObjectRef().qualityManager;return\"video\"===l?null==p?void 0:p.currentVideoSsrcAppliedCapabilities[\"\".concat(u)]:\"sharing\"===l?null==p?void 0:p.currentSharingSsrcAppliedCapabilities[\"\".concat(u)]:void 0},getRendererDiagnosticsByTrack=function(l){var u;return null===(u=d.diagnostics.getObjectRef().remoteVideoManager)||void 0===u?void 0:u.renderers.find((function(d){return d.trackId===l}))};return this.appendSendMediaStats(l,u,getEntityByLocalSSRC,getEntityByLocalTrack,getRequestedCapabilitiesBySsrc,getAppliedCapabilitiesBySsrc),this.appendRecvMediaStats(l,u,getEntityByRemoteSSRC,getEntityByRemoteTrack,getRendererDiagnosticsByTrack),l[\"data-channel\"]&&(u.data=l[\"data-channel\"]),u},StatisticsGathererV2.prototype.processTransportStats=function(l){if(l.transport){var d={};for(var u in l.transport){var h=l.transport[u];if(d[u]=p.shallowClone(h),h.selectedCandidatePairId)(g=p.shallowClone(l[\"candidate-pair\"][h.selectedCandidatePairId])).localCandidate=l[\"local-candidate\"][g.localCandidateId],g.remoteCandidate=l[\"remote-candidate\"][g.remoteCandidateId],d[u].selectedCandidatePair=g;h.localCertificateId&&l.certificate&&(d[u].localCertificate=l.certificate[h.localCertificateId]),h.remoteCertificateId&&l.certificate&&(d[u].remoteCertificate=l.certificate[h.remoteCertificateId])}return d}if(l[\"candidate-pair\"]){d={};for(var u in l[\"candidate-pair\"]){var g;(g=p.shallowClone(l[\"candidate-pair\"][u])).selected&&(g.localCandidate=l[\"local-candidate\"][g.localCandidateId],g.remoteCandidate=l[\"remote-candidate\"][g.remoteCandidateId],d.faketransport={id:\"faketransport\",timestamp:g.timestamp,type:\"transport\",selectedCandidatePair:g,selectedCandidatePairId:g.id})}return d}},StatisticsGathererV2.prototype.appendSendMediaStats=function(l,d,u,p,g,f){var m,v,y,S,_,C,E,T;for(var b in l[\"outbound-rtp\"]){var I=l[\"outbound-rtp\"][b],A={outboundRTP:I};I.codecId&&l.codec&&(A.codec=l.codec[I.codecId]),Object.defineProperty(A,\"transport\",{value:d.transports[null!==(m=I.transportId)&&void 0!==m?m:\"faketransport\"],configurable:!1,enumerable:!1}),I.remoteId&&l[\"remote-inbound-rtp\"]&&(A.remoteInboundRTP=l[\"remote-inbound-rtp\"][I.remoteId]),I.mediaSourceId&&l[\"media-source\"]&&(A.mediaSource=l[\"media-source\"][I.mediaSourceId]),I.trackId&&l.track&&(A.track=l.track[I.trackId]);var R=null!==(_=p(null!==(y=null===(v=A.track)||void 0===v?void 0:v.trackIdentifier)&&void 0!==y?y:null===(S=A.mediaSource)||void 0===S?void 0:S.trackIdentifier,I.rid))&&void 0!==_?_:u(I.ssrc,I.rid);if(R){A.mediaEntity=R.serialize();var P=\"video\"===I.kind&&A.track?\"sharing\"===(null==R?void 0:R.getModality())?\"sharing\":\"video\":I.kind;if(h.hasSendDirectionality(null===(C=this.diagnostics.getObjectRef().activeModalities)||void 0===C?void 0:C[P])){if(\"video\"===I.kind){var O=null!==(E=g(P,I.ssrc))&&void 0!==E?E:g(P,0);O&&(A.requestedCapabilities=O);var M=null!==(T=f(P,I.ssrc))&&void 0!==T?T:f(P,0);M&&(A.appliedCapabilities=M)}d[P]||(d[P]={}),d[P].send||(d[P].send=[]),d[P].send.push(A)}}}},StatisticsGathererV2.prototype.appendRecvMediaStats=function(l,d,u,p,g){var f,m,v,y,S,_,C,E=null===(f=this.diagnostics.getObjectRef().subscriptionManager)||void 0===f?void 0:f.subscribedTrackIds,_loop_1=function(f){var b=l[\"inbound-rtp\"][f],I={inboundRTP:b};b.codecId&&l.codec&&(I.codec=l.codec[b.codecId]),d.transports[null!==(m=b.transportId)&&void 0!==m?m:\"faketransport\"]&&Object.defineProperty(I,\"transport\",{value:d.transports[null!==(v=b.transportId)&&void 0!==v?v:\"faketransport\"],configurable:!1,enumerable:!1}),b.remoteId&&l[\"remote-outbound-rtp\"]&&(I.remoteOutboundRTP=l[\"remote-outbound-rtp\"][b.remoteId]);var A=T.ssrcToRecvTrackMap.get(b.ssrc);if(b.trackId||A){b.trackId&&l.track?I.track=l.track[b.trackId]:A&&(I.track={id:\"ssrcToTrackId\",kind:b.kind,timestamp:b.timestamp,type:\"track\",trackIdentifier:A});var R=g(null===(y=I.track)||void 0===y?void 0:y.trackIdentifier);R&&(I.renderer=R)}if(\"video\"===b.kind&&!E.some((function(l){var d;return l&&l===(null===(d=I.track)||void 0===d?void 0:d.trackIdentifier)})))return\"continue\";var P=null!==(_=p(null===(S=I.track)||void 0===S?void 0:S.trackIdentifier))&&void 0!==_?_:u(b.ssrc);if(!P)return\"continue\";I.mediaEntity=P.serialize();var O=\"video\"===b.kind&&I.track?\"sharing\"===(null==P?void 0:P.getModality())?\"sharing\":\"video\":b.kind;if(!h.hasReceiveDirectionality(null===(C=T.diagnostics.getObjectRef().activeModalities)||void 0===C?void 0:C[O]))return\"continue\";d[O]||(d[O]={}),d[O].recv||(d[O].recv=[]),d[O].recv.push(I)},T=this;for(var b in l[\"inbound-rtp\"])_loop_1(b)},StatisticsGathererV2}();d.StatisticsGathererV2=f},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebrtcStatisticsV2=void 0;var h=u(383),g=u(384),f=u(385),m=u(68),v=u(1),y=function(){function WebrtcStatisticsV2(l,d){this.configProvider=l,this.diagnostics=d,this.transportStatsProcessor=new f.TransportStatsProcessor(this.diagnostics,this.configProvider),this.audioStatsProcessor=new h.AudioStatsProcessor(this.diagnostics),this.videoStatsProcessor=new g.VideoStatsProcessor(this.diagnostics),this.sharingStatsProcessor=new g.VideoStatsProcessor(this.diagnostics),this.statsAggregators={audio:{recv:new h.AudioRecvStatsAggregator,send:new h.AudioSendStatsAggregator(this.diagnostics)},video:{recv:new g.VideoRecvStatsAggregator,send:new g.VideoSendStatsAggregator(this.diagnostics)},sharing:{recv:new g.VideoRecvStatsAggregator,send:new g.VideoSendStatsAggregator(this.diagnostics)}},this.aggregatedModalityStats={},this.recvVideoStreamsCounter=new m.ModeCounter,this.multiviewData={},this.multiviewStats=[],this.diagnostics.aggregatedStatsRef=this.aggregatedModalityStats,this.diagnostics.multiViewStatsRef=this.multiviewStats}return WebrtcStatisticsV2.prototype.processStats=function(l){var d,u,p,h;this.transportStatsProcessor.processStats(l.transports),this.audioStatsProcessor.processStats(l.audio),this.videoStatsProcessor.processStats(l.video),this.sharingStatsProcessor.processStats(l.sharing),this.recvVideoStreamsCounter.captureSample(null===(u=null===(d=l.video)||void 0===d?void 0:d.recv)||void 0===u?void 0:u.length),this.diagnostics.recvVideoStreamsCount={min:this.recvVideoStreamsCounter.min,max:this.recvVideoStreamsCounter.max,mode:this.recvVideoStreamsCounter.mode};try{this.processAggregated(l)}catch(l){this.diagnostics.addStatsError(\"webrtcStatistics:processAggregated\",v.stringifyObject(l))}try{this.processMultiview(null!==(h=null===(p=l.video)||void 0===p?void 0:p.recv)&&void 0!==h?h:[])}catch(l){this.diagnostics.addStatsError(\"webrtcStatistics:processMultiview\",v.stringifyObject(l))}try{var g=null===navigator||void 0===navigator?void 0:navigator.connection;g&&this.diagnostics.addNetworkInfo({downlink:g.downlink,rtt:g.rtt,effectiveType:g.effectiveType,saveData:g.saveData})}catch(l){this.diagnostics.addStatsError(\"webrtcStatistics:processStats(networkInfo)\",v.stringifyObject(l))}},WebrtcStatisticsV2.prototype.processMultiview=function(l){var d,u,h,g,f,y,S,_,C,E,T,b,I,A,R=new Set;try{for(var P=p(l),O=P.next();!O.done;O=P.next()){var M=O.value;R.add(M.inboundRTP.id);var w=this.multiviewData[M.inboundRTP.id];w?w.stats.duration++:(w={bitrateAverager:new m.ArithmeticAverager,jitterAverager:new m.ArithmeticAverager,frameRateAverager:new m.ArithmeticAverager,freezeHistogram:new m.HistogramCollector,resolutionDurations:new m.SampleDurationTracker,stats:{ssrc:M.inboundRTP.ssrc,startTime:Date.now(),duration:0}},v.arrayPushFixedSize(this.multiviewStats,w.stats,this.configProvider.config.diagnostics.collectionLimits.numMultiViewStats),this.multiviewData[M.inboundRTP.id]=w),w.bitrateAverager.captureSample(null===(S=M.extensions)||void 0===S?void 0:S.bitrate),w.jitterAverager.captureSample(1e3*(null!==(_=M.inboundRTP.jitter)&&void 0!==_?_:0)),w.frameRateAverager.captureSample(M.inboundRTP.framesPerSecond),w.freezeHistogram.active=0===(null===(C=M.extensions)||void 0===C?void 0:C.frameRateDecoded)&&M.inboundRTP.framesPerSecond>0||0===M.inboundRTP.framesPerSecond,M.inboundRTP.frameWidth&&M.inboundRTP.frameHeight&&w.resolutionDurations.captureSample(\"\".concat(M.inboundRTP.frameWidth,\"x\").concat(M.inboundRTP.frameHeight)),w.stats.frameRateAvg=v.round(w.frameRateAverager.avg),w.stats.bitrateAvg=v.round(w.bitrateAverager.avg,0),w.stats.bitrateMax=v.round(w.bitrateAverager.maxSample,0),w.stats.freezeHistogram=w.freezeHistogram.counts,w.stats.freezeTimestamps=w.freezeHistogram.timestamps,w.stats.avgFreezeDuration=v.round(w.freezeHistogram.avgDuration),w.stats.totalFreezeDuration=w.freezeHistogram.totalDuration,w.stats.ongoingFreeze=w.freezeHistogram.active,w.stats.numResolutionSwitches=w.resolutionDurations.changeCount,w.stats.rendererSize=\"\".concat(null===(T=null===(E=M.renderer)||void 0===E?void 0:E.rendererSize)||void 0===T?void 0:T.width,\"x\").concat(null===(I=null===(b=M.renderer)||void 0===b?void 0:b.rendererSize)||void 0===I?void 0:I.height),w.stats.resolutionDurations=w.resolutionDurations.durations,w.stats.timeToFirstFrame=null===(A=M.renderer)||void 0===A?void 0:A.timeToFirstFrame}}catch(l){d={error:l}}finally{try{O&&!O.done&&(u=P.return)&&u.call(P)}finally{if(d)throw d.error}}var N=[];try{for(var D=p(Object.keys(this.multiviewData)),L=D.next();!L.done;L=D.next()){var k=L.value;R.has(k)||N.push(k)}}catch(l){h={error:l}}finally{try{L&&!L.done&&(g=D.return)&&g.call(D)}finally{if(h)throw h.error}}try{for(var x=p(N),F=x.next();!F.done;F=x.next()){k=F.value;delete this.multiviewData[k]}}catch(l){f={error:l}}finally{try{F&&!F.done&&(y=x.return)&&y.call(x)}finally{if(f)throw f.error}}},WebrtcStatisticsV2.prototype.processAggregated=function(l){var d,u;try{for(var h=p([\"audio\",\"video\",\"sharing\"]),g=h.next();!g.done;g=h.next()){var f=g.value;if(l[f])for(var m in l[f])this.processAggregatedModality(l,f,m)}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}},WebrtcStatisticsV2.prototype.processAggregatedModality=function(l,d,u){var p,h,g,f,m,v,y,S=null!==(g=null===(h=null===(p=l[d])||void 0===p?void 0:p[u])||void 0===h?void 0:h.length)&&void 0!==g?g:0;S>0&&(null!==(f=(v=this.aggregatedModalityStats)[d])&&void 0!==f||(v[d]={}),null!==(m=(y=this.aggregatedModalityStats[d])[u])&&void 0!==m||(y[u]=[]),S>1&&(\"audio\"===d||\"sharing\"===d)&&this.diagnostics.addStatsError(\"webrtcStatistics:processAggregatedModality\",\"Multiple \".concat(d,\" \").concat(u,\" streams: \").concat(S)),this.statsAggregators[d][u].processSample(l[d][u],this.aggregatedModalityStats[d][u]))},WebrtcStatisticsV2}();d.WebrtcStatisticsV2=y},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.AudioSendStatsAggregator=d.AudioRecvStatsAggregator=d.AudioStatsProcessor=void 0;var h=u(68),g=u(1),f=function(){function AudioStatsProcessor(l){this.diagnostics=l,this.recvExtenders=new Map,this.sendExtenders=new Map}return AudioStatsProcessor.prototype.processStats=function(l){var d,u,h,f,v,S;if(l){if(l.recv)try{for(var _=p(l.recv),C=_.next();!C.done;C=_.next()){var E=C.value;try{var T=null!==(v=this.recvExtenders.get(E.inboundRTP.id))&&void 0!==v?v:new m;this.recvExtenders.set(E.inboundRTP.id,T),T.processSample(E)}catch(l){this.diagnostics.addStatsError(\"AudioStatsProcessor:recv\",g.stringifyObject(l))}}}catch(l){d={error:l}}finally{try{C&&!C.done&&(u=_.return)&&u.call(_)}finally{if(d)throw d.error}}if(l.send)try{for(var b=p(l.send),I=b.next();!I.done;I=b.next()){E=I.value;try{T=null!==(S=this.sendExtenders.get(E.outboundRTP.id))&&void 0!==S?S:new y;this.sendExtenders.set(E.outboundRTP.id,T),T.processSample(E)}catch(l){this.diagnostics.addStatsError(\"AudioStatsProcessor:send\",g.stringifyObject(l))}}}catch(l){h={error:l}}finally{try{I&&!I.done&&(f=b.return)&&f.call(b)}finally{if(h)throw h.error}}}},AudioStatsProcessor}();d.AudioStatsProcessor=f;var m=function(){function AudioRecvStatsExtender(){this.duration=0,this.lossRateCalculator=new h.NormalizedLossRateCalculator,this.lossRateAverager=new h.ArithmeticAverager,this.bytesReceivedDiff=new h.LastSampleDelta,this.jitterAverager=new h.ArithmeticAverager,this.bitrateAverager=new h.ArithmeticAverager,this.healedRatioAverager=new h.ArithmeticAverager}return AudioRecvStatsExtender.prototype.processSample=function(l){var d=this.lossRateCalculator.calculate(l.inboundRTP.packetsReceived,l.inboundRTP.packetsLost);this.lossRateAverager.captureSample(d),this.bytesReceivedDiff.captureSample(l.inboundRTP.bytesReceived);var u=this.bytesReceivedDiff.delta,p=u?8*u:void 0;this.bitrateAverager.captureSample(p);var h=l.inboundRTP.jitterBufferEmittedCount&&g.round(l.inboundRTP.jitterBufferDelay/l.inboundRTP.jitterBufferEmittedCount*1e3,0);this.jitterAverager.captureSample(h&&1e3*h);var f=l.inboundRTP.totalSamplesReceived&&g.round((l.inboundRTP.concealedSamples-l.inboundRTP.silentConcealedSamples)/l.inboundRTP.totalSamplesReceived);this.healedRatioAverager.captureSample(f),l.extensions={lossRate:d,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,healedRatio:f,healedRatioAvg:g.round(this.healedRatioAverager.avg),healedRatioMax:this.healedRatioAverager.maxSample,jitterBufferMs:h,avgJitterBufferSize:g.round(this.jitterAverager.avg),bitrate:p||0,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0)},this.duration++},AudioRecvStatsExtender}(),v=function(){function AudioRecvStatsAggregator(){this.duration=0,this.lossRateAverager=new h.ArithmeticAverager,this.bitrateAverager=new h.ArithmeticAverager,this.jitterAverager=new h.ArithmeticAverager}return AudioRecvStatsAggregator.prototype.processSample=function(l,d){var u,p=l[0],h={inboundRTP:p.inboundRTP};p.transport&&Object.defineProperty(h,\"transport\",{value:p.transport,configurable:!1,enumerable:!1}),p.codec&&(h.codec=p.codec),p.track&&(h.track=p.track),p.remoteOutboundRTP&&(h.remoteOutboundRTP=p.remoteOutboundRTP),p.extensions&&(this.lossRateAverager.captureSample(p.extensions.lossRate),this.bitrateAverager.captureSample(p.extensions.bitrate),this.jitterAverager.captureSample(1e3*(null!==(u=p.inboundRTP.jitter)&&void 0!==u?u:0)),h.extensions={lossRate:p.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,bitrate:p.extensions.bitrate,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0),avgJitterBufferSize:g.round(this.jitterAverager.avg),jitterBufferMs:p.extensions.jitterBufferMs,healedRatio:p.extensions.healedRatio,healedRatioAvg:p.extensions.healedRatioAvg,healedRatioMax:p.extensions.healedRatioMax},this.duration++),d.push(h)},AudioRecvStatsAggregator}();d.AudioRecvStatsAggregator=v;var y=function(){function AudioSendStatsExtender(){this.duration=0,this.lossRateCalculator=new h.NormalizedLossRateCalculator,this.lossRateAverager=new h.ArithmeticAverager,this.bytesSendDiff=new h.LastSampleDelta,this.rttAverager=new h.ArithmeticAverager,this.bitrateAverager=new h.ArithmeticAverager}return AudioSendStatsExtender.prototype.processSample=function(l){var d,u,p,h,f=this.lossRateCalculator.calculate(null===(d=l.remoteInboundRTP)||void 0===d?void 0:d.packetsReceived,null===(u=l.remoteInboundRTP)||void 0===u?void 0:u.packetsLost);this.lossRateAverager.captureSample(f),this.bytesSendDiff.captureSample(l.outboundRTP.bytesSent);var m=this.bytesSendDiff.delta,v=m?8*m:void 0;this.bitrateAverager.captureSample(v),this.rttAverager.captureSample(1e3*(null!==(h=null===(p=l.remoteInboundRTP)||void 0===p?void 0:p.roundTripTime)&&void 0!==h?h:0)),l.extensions={lossRate:f,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,rttAvg:g.round(this.rttAverager.avg),bitrate:v||0,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0)},this.duration++},AudioSendStatsExtender}(),S=function(){function AudioSendStatsAggregator(l){this.diagnostics=l,this.duration=0,this.lossRateAverager=new h.ArithmeticAverager,this.bitrateAverager=new h.ArithmeticAverager,this.rttAverager=new h.ArithmeticAverager}return AudioSendStatsAggregator.prototype.processSample=function(l,d){var u,p=l[0],h={outboundRTP:p.outboundRTP};p.transport&&Object.defineProperty(h,\"transport\",{value:p.transport,configurable:!1,enumerable:!1}),p.codec&&(h.codec=p.codec),p.track&&(h.track=p.track),p.mediaSource&&(h.mediaSource=p.mediaSource),p.remoteInboundRTP&&(h.remoteInboundRTP=p.remoteInboundRTP),p.extensions&&(this.lossRateAverager.captureSample(p.extensions.lossRate),this.bitrateAverager.captureSample(p.extensions.bitrate),this.rttAverager.captureSample(null===(u=p.remoteInboundRTP)||void 0===u?void 0:u.roundTripTime),h.extensions={lossRate:p.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,bitrate:p.extensions.bitrate,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0),rttAvg:g.round(this.rttAverager.avg),rawInputVolume:this.diagnostics.audioLevel},this.duration++),d.push(h)},AudioSendStatsAggregator}();d.AudioSendStatsAggregator=S},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoSendStatsAggregator=d.VideoRecvStatsAggregator=d.VideoStatsProcessor=void 0;var g=u(1),f=u(68),m=function(){function VideoStatsProcessor(l){this.diagnostics=l,this.recvExtenders=new Map,this.sendExtenders=new Map}return VideoStatsProcessor.prototype.processStats=function(l){var d,u,p,f,m,y;if(l){if(l.send)try{for(var _=h(l.send),C=_.next();!C.done;C=_.next()){var E=C.value;try{var T=null!==(m=this.sendExtenders.get(E.outboundRTP.id))&&void 0!==m?m:new S;this.sendExtenders.set(E.outboundRTP.id,T),T.processSample(E)}catch(l){this.diagnostics.addStatsError(\"VideoStatsProcessor:send\",g.stringifyObject(l))}}}catch(l){d={error:l}}finally{try{C&&!C.done&&(u=_.return)&&u.call(_)}finally{if(d)throw d.error}}if(l.recv)try{for(var b=h(l.recv),I=b.next();!I.done;I=b.next()){E=I.value;try{T=null!==(y=this.recvExtenders.get(E.inboundRTP.id))&&void 0!==y?y:new v;this.recvExtenders.set(E.inboundRTP.id,T),T.processSample(E)}catch(l){this.diagnostics.addStatsError(\"VideoStatsProcessor:recv\",g.stringifyObject(l))}}}catch(l){p={error:l}}finally{try{I&&!I.done&&(f=b.return)&&f.call(b)}finally{if(p)throw p.error}}}},VideoStatsProcessor}();d.VideoStatsProcessor=m;var v=function(){function VideoRecvStatsExtender(){this.duration=0,this.lossRateCalculator=new f.NormalizedLossRateCalculator,this.lossRateAverager=new f.ArithmeticAverager,this.bytesReceivedDelta=new f.LastSampleDelta,this.framesDecodedDelta=new f.LastSampleDelta,this.trackFramesDelta=new f.LastSampleDelta,this.frameRateAverager=new f.ArithmeticAverager,this.jitterAverager=new f.ArithmeticAverager,this.bitrateAverager=new f.ArithmeticAverager,this.freezeHistogram=new f.HistogramCollector,this.harmonicDecodedFps=new f.SelfWeightedHarmonicMeanCalculator,this.resolutionDurations=new f.SampleDurationTracker}return VideoRecvStatsExtender.prototype.processSample=function(l){var d,u,p,h=this.lossRateCalculator.calculate(l.inboundRTP.packetsReceived,l.inboundRTP.packetsLost);this.lossRateAverager.captureSample(h),this.framesDecodedDelta.captureSample(l.inboundRTP.framesDecoded),this.trackFramesDelta.captureSample(null===(d=l.track)||void 0===d?void 0:d.framesReceived);var f=this.framesDecodedDelta.delta||0,m=l.inboundRTP.framesPerSecond;this.harmonicDecodedFps.captureSample(f),this.freezeHistogram.active=-1!==(null===(u=l.renderer)||void 0===u?void 0:u.timeToFirstFrame)&&(0===f&&m>0||0===m),this.frameRateAverager.captureSample(null!=m?m:f),this.bytesReceivedDelta.captureSample(l.inboundRTP.bytesReceived);var v=this.bytesReceivedDelta.delta,y=v?8*v:void 0;this.bitrateAverager.captureSample(y);var S=l.inboundRTP.jitterBufferEmittedCount&&g.round((null!==(p=l.inboundRTP.jitterBufferDelay)&&void 0!==p?p:0)/l.inboundRTP.jitterBufferEmittedCount*1e3);this.jitterAverager.captureSample(S&&1e3*S),l.inboundRTP.frameWidth&&l.inboundRTP.frameHeight&&this.resolutionDurations.captureSample(\"\".concat(l.inboundRTP.frameWidth,\"x\").concat(l.inboundRTP.frameHeight)),l.extensions={lossRate:h,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,frameRateDecoded:f,trackRecvFps:this.trackFramesDelta.delta,avgFrameRate:g.round(this.frameRateAverager.avg),fpsHarmonicAverage:g.round(this.harmonicDecodedFps.harmonicMean),jitterBufferMs:S,avgJitterBufferSize:g.round(this.jitterAverager.avg),bitrate:y||0,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0),isFrozen:this.freezeHistogram.active,numFreezes:this.freezeHistogram.numEvents,avgFreezeDuration:g.round(this.freezeHistogram.avgDuration),longestFreeze:this.freezeHistogram.longestDuration,totalFreezeDuration:this.freezeHistogram.totalDuration,freezeCountHistogram:this.freezeHistogram.counts,freezeTimestampsHistogram:this.freezeHistogram.timestamps,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios},this.duration++},VideoRecvStatsExtender}(),y=function(){function VideoRecvStatsAggregator(){this.duration=0,this.lossRateAverager=new f.ArithmeticAverager,this.bitrateAverager=new f.ArithmeticAverager,this.jitterAverager=new f.ArithmeticAverager,this.frameRateAverager=new f.ArithmeticAverager,this.freezeHistogram=new f.HistogramCollector,this.harmonicDecodedFps=new f.SelfWeightedHarmonicMeanCalculator,this.resolutionDurations=new f.SampleDurationTracker}return VideoRecvStatsAggregator.prototype.processSample=function(l,d){var u,p,h,f=l.sort((function(l,d){return d.inboundRTP.frameHeight-l.inboundRTP.frameHeight}))[0],m={inboundRTP:f.inboundRTP};f.transport&&Object.defineProperty(m,\"transport\",{value:f.transport,configurable:!1,enumerable:!1}),f.codec&&(m.codec=f.codec),f.track&&(m.track=f.track),f.remoteOutboundRTP&&(m.remoteOutboundRTP=f.remoteOutboundRTP),this.harmonicDecodedFps.captureSample(f.extensions.frameRateDecoded),f.extensions&&(this.lossRateAverager.captureSample(f.extensions.lossRate),this.bitrateAverager.captureSample(f.extensions.bitrate),this.jitterAverager.captureSample(1e3*(null!==(u=f.inboundRTP.jitter)&&void 0!==u?u:0)),this.frameRateAverager.captureSample(null!==(p=f.inboundRTP.framesPerSecond)&&void 0!==p?p:f.extensions.frameRateDecoded),this.freezeHistogram.active=-1!==(null===(h=f.renderer)||void 0===h?void 0:h.timeToFirstFrame)&&(0===f.extensions.frameRateDecoded&&f.inboundRTP.framesPerSecond>0||0===f.inboundRTP.framesPerSecond),f.inboundRTP.frameWidth&&f.inboundRTP.frameHeight&&this.resolutionDurations.captureSample(\"\".concat(f.inboundRTP.frameWidth,\"x\").concat(f.inboundRTP.frameHeight)),m.extensions={lossRate:f.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,frameRateDecoded:f.extensions.frameRateDecoded,trackRecvFps:f.extensions.trackRecvFps,avgFrameRate:g.round(this.frameRateAverager.avg),fpsHarmonicAverage:g.round(this.harmonicDecodedFps.harmonicMean),avgJitterBufferSize:g.round(this.jitterAverager.avg),jitterBufferMs:f.extensions.jitterBufferMs,bitrate:f.extensions.bitrate,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0),isFrozen:this.freezeHistogram.active,numFreezes:this.freezeHistogram.numEvents,avgFreezeDuration:g.round(this.freezeHistogram.avgDuration),longestFreeze:this.freezeHistogram.longestDuration,totalFreezeDuration:this.freezeHistogram.totalDuration,freezeCountHistogram:this.freezeHistogram.counts,freezeTimestampsHistogram:this.freezeHistogram.timestamps,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios},this.duration++),d.push(m)},VideoRecvStatsAggregator}();d.VideoRecvStatsAggregator=y;var S=function(){function VideoSendStatsExtender(){this.duration=0,this.lossRateCalculator=new f.NormalizedLossRateCalculator,this.lossRateAverager=new f.ArithmeticAverager,this.captureFreezeIntervalsCount=0,this.bytesSendDelta=new f.LastSampleDelta,this.encodedFramesDelta=new f.LastSampleDelta,this.frameRateAverager=new f.ArithmeticAverager,this.captureFpsAverager=new f.ArithmeticAverager,this.rttAverager=new f.ArithmeticAverager,this.bitrateAverager=new f.ArithmeticAverager,this.resolutionDurations=new f.SampleDurationTracker,this.harmonicEncodedFps=new f.SelfWeightedHarmonicMeanCalculator,this.fsOvershoot=new f.OvershootTracker,this.fpsOvershoot=new f.OvershootTracker(1),this.brOvershoot=new f.OvershootTracker}return VideoSendStatsExtender.prototype.processSample=function(l){var d,u,f,m,v,y,S,_,C,E,T,b=this.lossRateCalculator.calculate(null===(S=l.remoteInboundRTP)||void 0===S?void 0:S.packetsReceived,null===(_=l.remoteInboundRTP)||void 0===_?void 0:_.packetsLost);this.lossRateAverager.captureSample(b),this.bytesSendDelta.captureSample(l.outboundRTP.bytesSent);var I=this.bytesSendDelta.delta,A=I?8*I:void 0;this.bitrateAverager.captureSample(A),this.rttAverager.captureSample(null===(C=l.remoteInboundRTP)||void 0===C?void 0:C.roundTripTime),this.encodedFramesDelta.captureSample(l.outboundRTP.framesEncoded),this.harmonicEncodedFps.captureSample(this.encodedFramesDelta.delta),this.frameRateAverager.captureSample(l.outboundRTP.framesPerSecond);var R=null===(E=l.mediaSource)||void 0===E?void 0:E.framesPerSecond;this.captureFpsAverager.captureSample(R),0===R&&void 0!==this.lastCaptureFramerate&&this.lastCaptureFramerate>0&&this.captureFreezeIntervalsCount++,this.lastCaptureFramerate=R,l.outboundRTP.frameWidth&&l.outboundRTP.frameHeight&&this.resolutionDurations.captureSample(\"\".concat(l.outboundRTP.frameWidth,\"x\").concat(l.outboundRTP.frameHeight));var P=null!==(T=l.appliedCapabilities)&&void 0!==T?T:l.requestedCapabilities;P&&(void 0!==l.outboundRTP.frameHeight&&void 0!==l.outboundRTP.frameWidth&&this.fsOvershoot.captureSample(l.outboundRTP.frameHeight/16*(l.outboundRTP.frameWidth/16),P.maxFs),void 0!==l.outboundRTP.framesPerSecond&&this.fpsOvershoot.captureSample(l.outboundRTP.framesPerSecond,P.maxFps),P.maxBr&&this.brOvershoot.captureSample(A,P.maxBr));var O=[];try{for(var M=h(this.fsOvershoot.events),w=M.next();!w.done;w=M.next()){var N=w.value;O.push(p(p({},N),{overshootType:\"fs\"}))}}catch(l){d={error:l}}finally{try{w&&!w.done&&(u=M.return)&&u.call(M)}finally{if(d)throw d.error}}try{for(var D=h(this.fpsOvershoot.events),L=D.next();!L.done;L=D.next()){N=L.value;O.push(p(p({},N),{overshootType:\"fps\"}))}}catch(l){f={error:l}}finally{try{L&&!L.done&&(m=D.return)&&m.call(D)}finally{if(f)throw f.error}}try{for(var k=h(this.brOvershoot.events),x=k.next();!x.done;x=k.next()){N=x.value;O.push(p(p({},N),{overshootType:\"br\"}))}}catch(l){v={error:l}}finally{try{x&&!x.done&&(y=k.return)&&y.call(k)}finally{if(v)throw v.error}}O.sort((function(l,d){return l.timestamp-d.timestamp})),l.extensions={lossRate:b,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,frameRateEncoded:this.encodedFramesDelta.delta,frameRateAvg:g.round(this.frameRateAverager.avg),captureFramerateAvg:g.round(this.captureFpsAverager.avg),fpsHarmonicAverage:g.round(this.harmonicEncodedFps.harmonicMean),qpAvg:g.round(l.outboundRTP.qpSum/l.outboundRTP.framesSent),rttAvg:g.round(this.rttAverager.avg),bitrate:A||0,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0),captureFreezeIntervalsCount:this.captureFreezeIntervalsCount,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios,isFsOvershooting:this.fsOvershoot.isOvershooting,isFpsOvershooting:this.fpsOvershoot.isOvershooting,isBrOvershooting:this.brOvershoot.isOvershooting,totalFsOvershootDuration:this.fsOvershoot.totalDuration,totalFpsOvershootDuration:this.fpsOvershoot.totalDuration,totalBrOvershootDuration:this.brOvershoot.totalDuration,overshootEvents:O},this.duration++},VideoSendStatsExtender}(),_=function(){function VideoSendStatsAggregator(l){this.diagnostics=l,this.duration=0,this.lossRateAverager=new f.ArithmeticAverager,this.bitrateAverager=new f.ArithmeticAverager,this.sendBWEAverager=new f.ArithmeticAverager,this.rttAverager=new f.ArithmeticAverager,this.framerateAverager=new f.ArithmeticAverager,this.captureFpsAverager=new f.ArithmeticAverager,this.captureFreezeIntervalsCount=0,this.lastCaptureFps=void 0,this.resolutionDurations=new f.SampleDurationTracker,this.fsOvershoot=new f.OvershootTracker,this.fpsOvershoot=new f.OvershootTracker(1),this.brOvershoot=new f.OvershootTracker,this.harmonicEncodedFps=new f.SelfWeightedHarmonicMeanCalculator}return VideoSendStatsAggregator.prototype.processSample=function(l,d){var u,f,m,v,y,S,_,C,E,T,b,I;l.length>1&&l.sort((function(l,d){var u,p,h=null!==(u=l.appliedCapabilities)&&void 0!==u?u:l.requestedCapabilities,g=null!==(p=d.appliedCapabilities)&&void 0!==p?p:d.requestedCapabilities;return(null==h?void 0:h.maxMbps)&&(null==g?void 0:g.maxMbps)?g.maxMbps-h.maxMbps:0}));var A=l[0],R={outboundRTP:A.outboundRTP};if(A.transport&&Object.defineProperty(R,\"transport\",{value:A.transport,configurable:!1,enumerable:!1}),A.codec&&(R.codec=A.codec),A.track&&(R.track=A.track),A.mediaSource&&(R.mediaSource=A.mediaSource),A.remoteInboundRTP&&(R.remoteInboundRTP=A.remoteInboundRTP),A.extensions){this.lossRateAverager.captureSample(A.extensions.lossRate),this.bitrateAverager.captureSample(A.extensions.bitrate),this.sendBWEAverager.captureSample(null===(C=null===(_=A.transport)||void 0===_?void 0:_.selectedCandidatePair)||void 0===C?void 0:C.availableOutgoingBitrate),this.rttAverager.captureSample(null===(E=A.remoteInboundRTP)||void 0===E?void 0:E.roundTripTime),this.framerateAverager.captureSample(A.outboundRTP.framesPerSecond);var P=null===(T=A.mediaSource)||void 0===T?void 0:T.framesPerSecond;this.captureFpsAverager.captureSample(P),0===P&&void 0!==this.lastCaptureFps&&this.lastCaptureFps>0&&this.captureFreezeIntervalsCount++,A.outboundRTP.frameWidth&&A.outboundRTP.frameHeight&&this.resolutionDurations.captureSample(\"\".concat(A.outboundRTP.frameWidth,\"x\").concat(A.outboundRTP.frameHeight));var O=null!==(b=A.appliedCapabilities)&&void 0!==b?b:A.requestedCapabilities;O&&(void 0!==A.outboundRTP.frameHeight&&void 0!==A.outboundRTP.frameWidth&&this.fsOvershoot.captureSample(A.outboundRTP.frameHeight/16*(A.outboundRTP.frameWidth/16),O.maxFs),void 0!==A.outboundRTP.framesPerSecond&&this.fpsOvershoot.captureSample(A.outboundRTP.framesPerSecond,O.maxFps),O.maxBr&&this.brOvershoot.captureSample(null===(I=A.extensions)||void 0===I?void 0:I.bitrate,O.maxBr)),this.harmonicEncodedFps.captureSample(A.extensions.frameRateEncoded);var M=[];try{for(var w=h(this.fsOvershoot.events),N=w.next();!N.done;N=w.next()){var D=N.value;M.push(p(p({},D),{overshootType:\"fs\"}))}}catch(l){u={error:l}}finally{try{N&&!N.done&&(f=w.return)&&f.call(w)}finally{if(u)throw u.error}}try{for(var L=h(this.fpsOvershoot.events),k=L.next();!k.done;k=L.next()){D=k.value;M.push(p(p({},D),{overshootType:\"fps\"}))}}catch(l){m={error:l}}finally{try{k&&!k.done&&(v=L.return)&&v.call(L)}finally{if(m)throw m.error}}try{for(var x=h(this.brOvershoot.events),F=x.next();!F.done;F=x.next()){D=F.value;M.push(p(p({},D),{overshootType:\"br\"}))}}catch(l){y={error:l}}finally{try{F&&!F.done&&(S=x.return)&&S.call(x)}finally{if(y)throw y.error}}M.sort((function(l,d){return l.timestamp-d.timestamp})),R.extensions={lossRate:A.extensions.lossRate,lossRateMax:this.lossRateAverager.maxSample,duration:this.duration,frameRateEncoded:A.extensions.frameRateEncoded,frameRateAvg:g.round(this.framerateAverager.avg),captureFramerateAvg:g.round(this.captureFpsAverager.avg),fpsHarmonicAverage:g.round(this.harmonicEncodedFps.harmonicMean),qpAvg:g.round(A.outboundRTP.qpSum/A.outboundRTP.framesSent),rttAvg:g.round(this.rttAverager.avg),bitrate:A.extensions.bitrate,bitrateAvg:g.round(this.bitrateAverager.avg,0),bitrateMax:g.round(this.bitrateAverager.maxSample,0),bweAvg:g.round(this.sendBWEAverager.avg,0),captureFreezeIntervalsCount:this.captureFreezeIntervalsCount,numResolutionSwitches:this.resolutionDurations.changeCount,resolutionDurations:this.resolutionDurations.durations,resolutionDurationRatios:this.resolutionDurations.durationRatios,cameraOpenResolution:this.diagnostics.deviceManager.latestCameraOpenResolution,isFsOvershooting:this.fsOvershoot.isOvershooting,isFpsOvershooting:this.fpsOvershoot.isOvershooting,isBrOvershooting:this.brOvershoot.isOvershooting,totalFsOvershootDuration:this.fsOvershoot.totalDuration,totalFpsOvershootDuration:this.fpsOvershoot.totalDuration,totalBrOvershootDuration:this.brOvershoot.totalDuration,overshootEvents:M},this.duration++}d.push(R)},VideoSendStatsAggregator}();d.VideoSendStatsAggregator=_},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.TransportStatsProcessor=void 0;var p=u(68),h=u(1),g=function(){function TransportStatsProcessor(l,d){this.diagnostics=l,this.configProvider=d,this.extenders=new Map}return TransportStatsProcessor.prototype.processStats=function(l){var d;for(var u in l)try{var p=l[u],g=null!==(d=this.extenders.get(p.id))&&void 0!==d?d:new f(this.configProvider);this.extenders.set(p.id,g),g.processSample(p)}catch(l){this.diagnostics.addStatsError(\"TransportStatsProcessor\",h.stringifyObject(l))}},TransportStatsProcessor}();d.TransportStatsProcessor=g;var f=function(){function TransportStatsExtender(l){this.configProvider=l,this.bwJumpsHistogramCollector=new p.HistogramCollector,this.sendBWEAverager=new p.ArithmeticAverager,this.recvBWEAverager=new p.ArithmeticAverager,this.sendBW=new p.LastSampleDelta,this.recvBW=new p.LastSampleDelta,this.sendBWAverager=new p.ArithmeticAverager,this.recvBWAverager=new p.ArithmeticAverager}return TransportStatsExtender.prototype.processSample=function(l){var d,u,p,g,f;this.sendBWEAverager.captureSample(null===(d=l.selectedCandidatePair)||void 0===d?void 0:d.availableOutgoingBitrate),this.recvBWEAverager.captureSample(null===(u=l.selectedCandidatePair)||void 0===u?void 0:u.availableIncomingBitrate),this.sendBW.captureSample(null===(p=l.selectedCandidatePair)||void 0===p?void 0:p.bytesSent),this.recvBW.captureSample(null===(g=l.selectedCandidatePair)||void 0===g?void 0:g.bytesReceived);var m=this.sendBW.delta,v=this.recvBW.delta,y=m?8*m:void 0,S=v?8*v:void 0;this.sendBWAverager.captureSample(y),this.recvBWAverager.captureSample(S);var _=null===(f=l.selectedCandidatePair)||void 0===f?void 0:f.availableOutgoingBitrate;_&&(this.bwJumpsHistogramCollector.active=this.bwJumpsHistogramCollector.active&&_<this.configProvider.config.webrtcBWJumpUpperLimit||_<this.configProvider.config.webrtcBWJumpLowerLimit),l.extensions={sendBWEAvg:h.round(this.sendBWEAverager.avg,0),sendBWEMax:h.round(this.sendBWEAverager.maxSample,0),recvBWEAvg:h.round(this.recvBWEAverager.avg,0),recvBWEMax:h.round(this.recvBWEAverager.maxSample,0),sendBitrate:y,recvBitrate:S,sendBWAvg:h.round(this.sendBWAverager.avg,0),sendBWMax:h.round(this.sendBWAverager.maxSample,0),recvBWAvg:h.round(this.recvBWAverager.avg,0),recvBWMax:h.round(this.recvBWAverager.maxSample,0),bwJumpsHistogram:this.bwJumpsHistogramCollector.counts}},TransportStatsExtender}()},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(1),f=function(){function StatsDict(){this.googCandidatePair={},this.ssrc={},this.googComponent={},this.VideoBwe={bweforvideo:{}}}return StatsDict}(),m=function(){function LegacyStatisticsMapper(){this.statistics=new f,this.statsDiffMap=new Map,this.ssrcTrackMap=new Map}return LegacyStatisticsMapper.prototype.build=function(l){return this.statistics=new f,this.constructGoogCandidatePair(l),this.constructGoogSsrc(l),this.constructGoogComponent(l),this.constructDataChannel(l),this.constructVideoBwe(l),this.statistics},LegacyStatisticsMapper.prototype.setSsrcTrackPair=function(l,d){null===d?this.ssrcTrackMap.delete(l):this.ssrcTrackMap.set(l,d)},LegacyStatisticsMapper.prototype.constructGoogSsrc=function(l){var d=this,u={};if(l.hasOwnProperty(\"outbound-rtp\")){var p=l[\"outbound-rtp\"];Object.keys(p).forEach((function(h){var g=\"ssrc_\".concat(p[h].ssrc,\"_send\"),f=d.constructSendSsrc(l,p[h]);u[g]=f}))}if(l.hasOwnProperty(\"inbound-rtp\")){var h=l[\"inbound-rtp\"];Object.keys(h).forEach((function(p){var g=\"ssrc_\".concat(h[p].ssrc,\"_recv\"),f=d.constructRecvSsrc(l,h[p]);u[g]=f}))}this.statistics.ssrc=u},LegacyStatisticsMapper.prototype.constructSendSsrc=function(l,d){var u,h,f=d.trackId?l.track[d.trackId]:null,m=d.mediaSourceId?l[\"media-source\"][d.mediaSourceId]:null,v=this.getRemoteInboundRtp(l,d.ssrc),y=\"ssrc_\".concat(d.ssrc,\"_send\"),S=null!==(h=null!==(u=null==m?void 0:m.trackIdentifier)&&void 0!==u?u:null==f?void 0:f.trackIdentifier)&&void 0!==h?h:this.ssrcTrackMap.get(d.ssrc),_={id:y,ssrc:d.ssrc,mediaType:d.mediaType,bytesSent:d.bytesSent,bytesSentDiff:this.calculateDiff(y,d.bytesSent,4),packetsSent:d.packetsSent,packetsLost:null==v?void 0:v.packetsLost,jitter:null==v?void 0:v.jitter,googRtt:this.getRtt(v),googCodecName:this.getCodec(l,d.codecId),transportId:d.transportId,googTrackId:S};return\"audio\"===d.mediaType&&(_=p(p({},_),this.constructAudioSendSsrc(d,m))),\"video\"===d.mediaType&&(_=p(p({},_),this.constructVideoSendSsrc(d,m,y,f))),g.removeUndefinedFields(_)},LegacyStatisticsMapper.prototype.constructAudioSendSsrc=function(l,d){return{audioInputLevel:null==d?void 0:d.audioLevel,totalAudioEnergy:null==d?void 0:d.totalAudioEnergy,fecPacketsSent:l.fecPacketsSent}},LegacyStatisticsMapper.prototype.constructVideoSendSsrc=function(l,d,u,p){var h,g,f,m,v;return{framesEncoded:l.framesEncoded,googFrameRateEncoded:this.calculateDiff(u,l.framesEncoded,2),googFrameRateSent:null!==(h=l.framesPerSecond)&&void 0!==h?h:this.calculateDiff(u,null!==(g=l.framesSent)&&void 0!==g?g:null==p?void 0:p.framesSent,1),googFrameRateInput:null==d?void 0:d.framesPerSecond,googFrameHeightSent:null!==(f=l.frameHeight)&&void 0!==f?f:null==p?void 0:p.frameHeight,googFrameWidthSent:null!==(m=l.frameWidth)&&void 0!==m?m:null==p?void 0:p.frameWidth,googFrameHeightInput:null==d?void 0:d.height,googFrameWidthInput:null==d?void 0:d.width,hugeFramesSent:null!==(v=l.hugeFramesSent)&&void 0!==v?v:null==p?void 0:p.hugeFramesSent,keyFramesEncoded:l.keyFramesEncoded,qpSum:l.qpSum,qp:this.calculateDiff(u,l.qpSum,8),googPlisReceived:l.pliCount,googFirsReceived:l.firCount,googNacksReceived:l.nackCount,qualityLimitationDurations:l.qualityLimitationDurations,qualityLimitationReason:l.qualityLimitationReason,qualityLimitationResolutionChanges:l.qualityLimitationResolutionChanges,codecImplementationName:l.encoderImplementation,rid:l.rid,encodeTime:l.totalEncodeTime&&Math.round(1e3*this.calculateDiff(u,l.totalEncodeTime,6))}},LegacyStatisticsMapper.prototype.constructRecvSsrc=function(l,d){var u,h=d.trackId?l.track[d.trackId]:null,f=\"ssrc_\".concat(d.ssrc,\"_recv\"),m=null!==(u=null==h?void 0:h.trackIdentifier)&&void 0!==u?u:this.ssrcTrackMap.get(d.ssrc),v={id:f,ssrc:d.ssrc,mediaType:d.mediaType,bytesReceived:d.bytesReceived,bytesReceivedDiff:this.calculateDiff(f,d.bytesReceived,5),packetsReceived:d.packetsReceived,packetsLost:d.packetsLost,jitter:d.jitter,googJitterBufferMs:d.jitterBufferEmittedCount&&Math.round(d.jitterBufferDelay/d.jitterBufferEmittedCount*1e3),googCodecName:this.getCodec(l,d.codecId),googTrackId:m,transportId:d.transportId};return\"audio\"===d.mediaType&&(v=p(p({},v),this.constructAudioRecvSsrc(d,h))),\"video\"===d.mediaType&&(v=p(p({},v),this.constructVideoRecvSsrc(d,f,h))),g.removeUndefinedFields(v)},LegacyStatisticsMapper.prototype.constructAudioRecvSsrc=function(l,d){var u,p;return{audioOutputLevel:null!==(u=l.audioLevel)&&void 0!==u?u:null==d?void 0:d.audioLevel,totalAudioEnergy:null!==(p=l.totalAudioEnergy)&&void 0!==p?p:null==d?void 0:d.totalAudioEnergy,concealedSamples:l.concealedSamples,silentConcealedSamples:l.silentConcealedSamples,totalSamplesReceived:l.totalSamplesReceived,healedRatio:l.totalSamplesReceived&&(l.concealedSamples-l.silentConcealedSamples)/l.totalSamplesReceived,fecPacketsReceived:l.fecPacketsReceived,fecPacketsDiscarded:l.fecPacketsDiscarded}},LegacyStatisticsMapper.prototype.constructVideoRecvSsrc=function(l,d,u){var p,h,g,f;return{framesDecoded:l.framesDecoded,googFrameRateDecoded:this.calculateDiff(d,l.framesDecoded,3),googFrameRateReceived:null!==(p=l.framesPerSecond)&&void 0!==p?p:this.calculateDiff(d,null!==(h=l.framesReceived)&&void 0!==h?h:null==u?void 0:u.framesReceived,0),googFrameHeightReceived:null!==(g=l.frameHeight)&&void 0!==g?g:null==u?void 0:u.frameHeight,googFrameWidthReceived:null!==(f=l.frameWidth)&&void 0!==f?f:null==u?void 0:u.frameWidth,keyFramesDecoded:l.keyFramesDecoded,googPlisSent:l.pliCount,googFirsSent:l.firCount,googNacksSent:l.nackCount,codecImplementationName:l.decoderImplementation,decodeTime:l.totalDecodeTime&&Math.round(1e3*this.calculateDiff(d,l.totalDecodeTime,7))}},LegacyStatisticsMapper.prototype.constructGoogCandidatePair=function(l){var d=this,u=l[\"candidate-pair\"];u&&Object.keys(u).forEach((function(p){var h=d.constructPair(l,u[p]);d.statistics.googCandidatePair[h.id]=h}))},LegacyStatisticsMapper.prototype.constructPair=function(l,d){var u=l[\"local-candidate\"][d.localCandidateId],p=l[\"remote-candidate\"][d.remoteCandidateId],h={bytesReceived:d.bytesReceived,bytesSent:d.bytesSent,googTransportType:u.protocol,googRtt:d.currentRoundTripTime?Math.round(1e3*d.currentRoundTripTime):void 0,googLocalAddress:\"\".concat(u.ip?u.ip:u.address,\":\").concat(u.port),googLocalCandidateType:u.candidateType,localRelayProtocol:u.relayProtocol,localNetworkType:u.networkType,googRemoteAddress:\"\".concat(p.ip?p.ip:p.address,\":\").concat(p.port),googRemoteCandidateType:p.candidateType,googActiveConnection:d.nominated,requestsReceived:d.requestsReceived,requestsSent:d.requestsSent,responsesReceived:d.responsesReceived,responsesSent:d.responsesSent,consentRequestsSent:d.consentRequestsSent,id:d.id,remoteCandidateId:d.remoteCandidateId,localCandidateId:d.localCandidateId,googWritable:d.writable};return g.removeUndefinedFields(h)},LegacyStatisticsMapper.prototype.constructGoogComponent=function(l){var d=this;l.transport&&Object.keys(l.transport).forEach((function(u){d.statistics.googComponent[u]={id:u,selectedCandidatePairId:l.transport[u].selectedCandidatePairId}}))},LegacyStatisticsMapper.prototype.constructDataChannel=function(l){if(l.hasOwnProperty(\"data-channel\")){var d=l[\"data-channel\"];this.statistics.data=Object.keys(d).map((function(l){var u=d[l];return{bytesReceived:u.bytesReceived,bytesSent:u.bytesSent,dataChannelIdentifier:u.dataChannelIdentifier,label:u.label,messagesReceived:u.messagesReceived,messagesSent:u.messagesSent,protocol:u.protocol,state:u.state,timestamp:u.timestamp,type:u.type}}))}},LegacyStatisticsMapper.prototype.constructVideoBwe=function(l){var d=l[\"outbound-rtp\"],u=l[\"candidate-pair\"];if(d&&u){var p=null;if(Object.keys(d).forEach((function(u){\"video\"===d[u].mediaType&&l.transport&&!p&&(p=l.transport[d[u].transportId])})),p&&u[p.selectedCandidatePairId]){var h={googAvailableSendBandwidth:u[p.selectedCandidatePairId].availableOutgoingBitrate,googAvailableReceiveBandwidth:u[p.selectedCandidatePairId].availableIncomingBitrate};this.statistics.VideoBwe.bweforvideo=g.removeUndefinedFields(h)}}},LegacyStatisticsMapper.prototype.getRemoteInboundRtp=function(l,d){var u,p,g=l[\"remote-inbound-rtp\"];if(g)try{for(var f=h(Object.keys(g)),m=f.next();!m.done;m=f.next()){var v=m.value;if(g[v].ssrc===d)return g[v]}}catch(l){u={error:l}}finally{try{m&&!m.done&&(p=f.return)&&p.call(f)}finally{if(u)throw u.error}}},LegacyStatisticsMapper.prototype.getRtt=function(l){var d=null==l?void 0:l.roundTripTime;return d?Math.round(1e3*d):void 0},LegacyStatisticsMapper.prototype.getCodec=function(l,d){if(d&&l.codec&&l.codec[d])return l.codec[d].mimeType.split(\"/\")[1]},LegacyStatisticsMapper.prototype.calculateDiff=function(l,d,u){if(void 0!==d){var p=d,h=this.statsDiffMap.has(l)?this.statsDiffMap.get(l):new Map;if(h.has(u)){var g=h.get(u);g<=d&&(p=d-g)}return h.set(u,d),this.statsDiffMap.set(l,h),isNaN(p)?void 0:p}},LegacyStatisticsMapper}();d.default=m},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(1);function getSrtpReport(l){var d=\"\";return l.dtls&&(d+=\"dtls\"),l.sdes&&(d+=\"sdes\"),d}var g=function(){function SessionInfo(){this.info={OfferedSrtp:\"none\",NegotiatedSrtp:\"none\",IceConnectionState:\"none\",IceConnectionStatePrevious:\"none\",SignalingState:\"none\",SignalingStatePrevious:\"none\",RelayCandidate:\"none\",IceTransportPolicy:\"none\",IceServers:\"none\",FakeIceCandidate:!1,BweType:\"none\",SdpSemantics:\"none\",BundlePolicy:\"none\",IPAddress:\"none\",ReflexiveLocalIP:\"none\",NumberOfInterfaces:0}}return SessionInfo.prototype.setCandidateDetails=function(l){\"host\"===l.type&&\"udp\"===l.protocol?this.setIPAddressInfo(l.ip):\"srflx\"===l.type&&this.setReflexiveLocalIP(l.ip)},SessionInfo.prototype.setOfferedModalities=function(l){this.offeredModalities=l,this.activeModalities=l},SessionInfo.prototype.setNegotiatedModalities=function(l){this.negotiatedModalities=l,this.activeModalities=l},SessionInfo.prototype.setNegotiatedSrtpInfo=function(l){this.info.NegotiatedSrtp=getSrtpReport(l)},SessionInfo.prototype.setOfferedSrtpInfo=function(l){this.info.OfferedSrtp=getSrtpReport(l)},SessionInfo.prototype.setIceConnectionState=function(l){this.info.IceConnectionStatePrevious=this.info.IceConnectionState,this.info.IceConnectionState=l},SessionInfo.prototype.setSignalingConnectionState=function(l){this.info.SignalingStatePrevious=this.info.SignalingState,this.info.SignalingState=l},SessionInfo.prototype.setRelayCandidateInfo=function(l){this.info.RelayCandidate=JSON.stringify(l)},SessionInfo.prototype.fillExtensionInfo=function(l){h.assign(l,this.info)},SessionInfo.prototype.setIceTransportPolicy=function(l){this.info.IceTransportPolicy=l},SessionInfo.prototype.setIceServers=function(l){var d=l.map((function(l){var d=p({},l);return d.username&&(d.username=\"true\"),d.credential&&(d.credential=\"true\"),d}));this.info.IceServers=JSON.stringify(d)},SessionInfo.prototype.setFakeIceCandidate=function(l){this.info.FakeIceCandidate=l},SessionInfo.prototype.setBweType=function(l){\"Unknown\"!==l&&(this.info.BweType=l)},SessionInfo.prototype.setSdpSemantics=function(l){this.info.SdpSemantics=l},SessionInfo.prototype.setBundlePolicy=function(l){this.info.BundlePolicy=l},SessionInfo.prototype.setIPAddressInfo=function(l){this.info.NumberOfInterfaces+=1,\"none\"===this.info.IPAddress&&(this.info.IPAddress=l)},SessionInfo.prototype.setReflexiveLocalIP=function(l){\"none\"===this.info.ReflexiveLocalIP&&(this.info.ReflexiveLocalIP=l)},SessionInfo}();d.default=g},function(l,d,u){var p=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},h=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},g=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},m=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var v=u(8),y=u(1),S=u(3),_=u(9),C=u(389),E=u(390),T=u(391),b=u(392),I=u(393),A=u(395),R=u(152),P=u(408),O=[\"googFrameHeightReceived\",\"googFrameWidthReceived\",\"googFrameHeightSent\",\"googFrameWidthSent\",\"googFrameRateInput\",\"googFrameRateSent\",\"googNacksSent\",\"googNacksReceived\",\"googPlisSent\",\"googPlisReceived\",\"googFirsSent\",\"googFirsReceived\",\"framesDecoded\",\"googFrameRateDecoded\",\"googFrameRateReceived\",\"framesEncoded\",\"packetsLost\",\"packetsSent\",\"packetsReceived\",\"bytesReceived\",\"bytesSent\",\"googEncodeUsagePercent\",\"audioInputLevel\",\"audioOutputLevel\",\"googDecodingCTN\",\"googDecodingPLC\",\"keyFramesEncoded\",\"keyFramesDecoded\",\"googRtt\",\"concealedSamples\",\"silentConcealedSamples\",\"totalSamplesReceived\",\"healedRatio\",\"googJitterBufferMs\",\"qpSum\",\"fecPacketsReceived\",\"fecPacketsDiscarded\",\"fecPacketsSent\"],M=[\"bytesSent\",\"bytesReceived\",\"googRtt\",\"packetsSent\",\"requestsSent\",\"consentRequestsSent\",\"responsesSent\",\"requestsReceived\",\"responsesReceived\"],w=[\"googAvailableReceiveBandwidth\",\"googAvailableSendBandwidth\",\"googTransmitBitrate\"];function catchStatsErrors(l,d,u){var p=u.value;u.value=function(){try{return p.apply(this,arguments)}catch(l){this.processStatsError(d,l)}}}var N=10,D=function(){function WebrtcStatistics(l,d,u,p,h,g){this.logger=l,this.sessionInfo=d,this.configProvider=u,this.mediaManager=p,this.multiparty=h,this.newStatsApi=g,this.statsErrors=[],this.subscribedTrackIds=[],this.iceCandidateErrors=[],this.terminated=!1,this.hwSilent=!1,this.isSpeaking=!1,this.networkSendLevel=\"Good\",this.networkRecvLevel=\"Good\",this.audioTelemetry=new E.default(this.configProvider),this.cameraOpenResolution={width:0,height:0},this.streamSenderStarted={},this.totalVideoControlMessages=0,this.outOfOrderVideoControlMessages=0,this.subscribedTrackSsrc=[],this.multiViewVideoTelemetry={},this.h264AvailableProfiles=[],this.timeToFirstFrame={},this.missedInitialPreferredResolution={},this.extensions={WebRTCStats:{},AudioTransportRecvBitrate:0,AudioTransportSendBitrate:0,AudioPayloadSendBitrate:0,AudioPayloadRecvBitrate:0,VideoPayloadSendBitrate:0,VideoPayloadRecvBitrate:0,TimerAudioTransportRecvBitrate:0,TimerAudioTransportSendBitrate:0,TimerAudioPayloadRecvBitrate:0,TimerAudioPayloadSendBitrate:0,TimerVideoPayloadRecvBitrate:0,TimerVideoPayloadSendBitrate:0,StartTime:Date.now(),EndTime:Date.now(),Audio_recv_jitterBufferAvgSize:0,Audio_recv_jitterMax:0,Audio_recv_googRttAvgSize:0,MaxSessionBandwidth:0},this.report={type:\"WebRtcMediaStats\",data:{Extensions:this.extensions}},this.lastSSRCs=new Map,this.videoTelemetry=new R.default(this.extensions.StartTime,this.configProvider,this.logger.createChild(\"Video\"),\"Video\"),this.sharingTelemetry=new R.default(this.extensions.StartTime,this.configProvider,this.logger.createChild(\"Sharing\"),\"ScreenShare\"),this.dataTelemetry=new b.WebRTCDataTelemetry,this.bandwidthTelemetry=new T.WebRTCBandwidthTelemetry(this.configProvider.config.webrtcBWJumpLowerLimit,this.configProvider.config.webrtcBWJumpUpperLimit),this.stabilizationTelemetry=new A.WebrtcStabilizationTelemetry(this.configProvider.config.webrtcBWStabilizationSlidingWindowSize,this.configProvider.config.webrtcBWStabilizationMaxDeviation,this.configProvider.config.webrtcBWStabilizationMinBandwidth),this.storedRecordsNumber=Number(this.configProvider.config.webrtcStatStoredRecordsNumber),this.hwSilentDetectionDuration=Number(this.configProvider.config.webrtcStatHwSilentDetectionDuration),this.hwSilentDetectionLevel=Number(this.configProvider.config.webrtcStatHwSilentDetectionLevel),this.audioHealedRatioTelemetry=new C.default(this.configProvider.config.webrtcStatNetworkDetectionDuration),this.networkQualityTelemetry=new I.default(this.configProvider,this.newStatsApi,this.audioHealedRatioTelemetry),this.speakingWhileMutedBadDuration=Number(this.configProvider.config.webrtcSpeakingWhileMutedBadDuration),this.speakingWhileMutedDetectionLevel=Number(this.configProvider.config.webrtcSpeakingWhileMutedDetectionLevel),this.videoDelayTimePeriod=this.configProvider.config.webrtcVideoDelayThreshold,this.maxStoredPreferredResolutions=this.configProvider.config.maxStoredPreferredResolutionCount,this.simulcastVideo=new P.default(this.logger.createChild(\"simulcastVideo\"),this.configProvider),this.simulcastSharing=new P.default(this.logger.createChild(\"simulcastSharing\"),this.configProvider)}return Object.defineProperty(WebrtcStatistics.prototype,\"currentVideoRecvTrackId\",{get:function(){return this.extensions.WebRTCStats.ssrc_video_recv&&this.extensions.WebRTCStats.ssrc_video_recv.googTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(WebrtcStatistics.prototype,\"currentSharingRecvTrackId\",{get:function(){return this.extensions.WebRTCStats.ssrc_sharing_recv&&this.extensions.WebRTCStats.ssrc_sharing_recv.googTrackId},enumerable:!1,configurable:!0}),Object.defineProperty(WebrtcStatistics.prototype,\"isMultiViewVideoTelemetry\",{get:function(){return Object.getOwnPropertyNames(this.multiViewVideoTelemetry).length>0},enumerable:!1,configurable:!0}),WebrtcStatistics.prototype.onDeviceEvent=function(l){if(\"stream_acquired\"===l.eventType){var d=l.payload;\"Video\"===d.mediaType&&(this.cameraOpenResolution=d.resolution)}},WebrtcStatistics.prototype.onMaxCapabilitiesRequested=function(l){(l.modality===S.default.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesRequested(l),(l.modality===S.default.MODALITY.video?this.simulcastVideo:this.simulcastSharing).setMaxCapabilities(l,!1)},WebrtcStatistics.prototype.onMaxCapabilitiesApplied=function(l){(l.modality===S.default.MODALITY.video?this.videoTelemetry:this.sharingTelemetry).setMaxCapabilitesApplied(l),(l.modality===S.default.MODALITY.video?this.simulcastVideo:this.simulcastSharing).setMaxCapabilities(l,!0)},WebrtcStatistics.prototype.setSubscribedTrackIds=function(l){this.subscribedTrackIds=l||[]},WebrtcStatistics.prototype.setSubscribedTrackSsrc=function(l){this.subscribedTrackSsrc=l||[]},WebrtcStatistics.prototype.addSubscriptionEvent=function(l,d,u,p,h){var g={evt:l,ts:Date.now()-this.extensions.StartTime,msi:u,duration:h};p&&(g.error=y.stringifyObject(p));var f=this.getHandlerForModality(d);if(f.addSubscriptionEvent(g),1===l||3===l){var m=1===l;f.startStopRecvDataGathering(m)}},WebrtcStatistics.prototype.getHandlerForModality=function(l){switch(l){case S.default.MODALITY.video:return this.videoTelemetry;case S.default.MODALITY.sharing:return this.sharingTelemetry;default:throw new Error(\"Handler not found for modality: \".concat(l))}},WebrtcStatistics.prototype.setTerminated=function(){this.extensions.EndTime=(new Date).getTime(),this.terminated=!0},WebrtcStatistics.prototype.startWaitingForStreamStart=function(l,d){this.streamStartDetection||this.sessionInfo.setOfferedModalities(l),this.streamStartDetection=!0},WebrtcStatistics.prototype.recordDataChannelProtocolEvent=function(l){this.dataTelemetry.recordDataChannelProtocolEvent(l)},WebrtcStatistics.prototype.setSessionDataChannelState=function(l){this.dataTelemetry.setSessionDataChannelState(l)},WebrtcStatistics.prototype.recordDataChannelCreationFailure=function(l){this.dataTelemetry.recordDataChannelCreationFailure(l)},WebrtcStatistics.prototype.processStatsDict=function(l){var d,u;if(this.processSimulcastStats(l),this.constructWebRtcReportForSingleStream(this.extensions.WebRTCStats,l),this.streamStartDetection&&(this.setStartTime(this.sessionInfo.offeredModalities)||this.terminated)&&(this.streamStartDetection=!1),Object.keys(this.missedInitialPreferredResolution).length>0&&(this.currentVideoRecvTrackId||this.currentSharingRecvTrackId)&&this.setMissedInitialPreferredResolution(),this.constructWebRTCDataReport(this.extensions.WebRTCStats,l),this.calculateHwSilentState(),this.calculateSpeakingState(),this.setHealedRatioSamples(),this.calculateNetworkRecvQualityLevel(),this.calculateNetworkSendQualityLevel(),this.sessionInfo.activeModalities&&(this.processBandwidthStats(),this.processAudioStats(),this.processVideoStatsRecv(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_recv,!0),this.processVideoStatsSend(this.videoTelemetry,this.extensions.WebRTCStats.ssrc_video_send),this.processSharingStats(),this.processStreamsCounters()),this.configProvider.config.enableMultiViewStats){var p=this.extensions.WebRTCStats[S.default.MULTIPLE_RECV_STREAMS]?this.extensions.WebRTCStats[S.default.MULTIPLE_RECV_STREAMS]:{};this.constructWebRtcReportForMultipleStreams(p,l);try{for(var h=g(Object.keys(p)),f=h.next();!f.done;f=h.next()){var m=f.value,v=p[m];this.processVideoStatsRecv(this.multiViewVideoTelemetry[m],v)}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}this.extensions.WebRTCStats[S.default.MULTIPLE_RECV_STREAMS]=p}this.extensions.WebRTCStats.statsErrors=JSON.stringify(this.statsErrors)},WebrtcStatistics.prototype.setTimeToFirstFrame=function(l,d){d in this.timeToFirstFrame||(this.timeToFirstFrame[d]=l)},WebrtcStatistics.prototype.getCurrentTimeToFirstFrame=function(l){return this.timeToFirstFrame[l]?this.timeToFirstFrame[l]:-1},WebrtcStatistics.prototype.getVideoTelemetryBySsrc=function(l){var d;return this.extensions.WebRTCStats.ssrc_video_recv&&this.extensions.WebRTCStats.ssrc_video_recv.id===l?d=this.videoTelemetry:this.extensions.WebRTCStats.ssrc_sharing_recv&&this.extensions.WebRTCStats.ssrc_sharing_recv.id===l?d=this.sharingTelemetry:this.isMultiViewVideoTelemetry&&!d&&(d=this.multiViewVideoTelemetry[l]),d},WebrtcStatistics.prototype.getIsRendering=function(l){var d=this.getVideoTelemetryBySsrc(l);return d?d.getIsRendering():void 0},WebrtcStatistics.prototype.setFreezeDuration=function(l,d){var u,p;try{for(var h=g(Object.keys(this.multiViewVideoTelemetry)),f=h.next();!f.done;f=h.next()){var m=f.value;this.multiViewVideoTelemetry[m].trackId===d&&this.isSubscribed(d)&&this.multiViewVideoTelemetry[m].setRecvTotalFreezeDurationMs(l)}}catch(l){u={error:l}}finally{try{f&&!f.done&&(p=h.return)&&p.call(h)}finally{if(u)throw u.error}}this.currentSharingRecvTrackId===d&&this.isSubscribed(d)&&this.sharingTelemetry.setRecvTotalFreezeDurationMs(l),this.currentVideoRecvTrackId===d&&this.isSubscribed(d)&&this.videoTelemetry.setRecvTotalFreezeDurationMs(l)},WebrtcStatistics.prototype.addVideoControlMessage=function(l){this.totalVideoControlMessages++,l&&this.outOfOrderVideoControlMessages++},WebrtcStatistics.prototype.setStreamSenderStarted=function(l,d){this.streamSenderStarted[l]=d},WebrtcStatistics.prototype.addReportedReceiveBandwidth=function(l){this.limitCaptureAmount(this.extensions,\"ReportedReceiveBandwidth\",l)},WebrtcStatistics.prototype.setHealedRatioSamples=function(){var l,d,u,p,h,g,f,m,v;this.audioHealedRatioTelemetry.captureHealedRatioSamples(null===(u=null===(d=null===(l=this.extensions)||void 0===l?void 0:l.WebRTCStats)||void 0===d?void 0:d.ssrc_audio_recv)||void 0===u?void 0:u.concealedSamples,null===(g=null===(h=null===(p=this.extensions)||void 0===p?void 0:p.WebRTCStats)||void 0===h?void 0:h.ssrc_audio_recv)||void 0===g?void 0:g.silentConcealedSamples,null===(v=null===(m=null===(f=this.extensions)||void 0===f?void 0:f.WebRTCStats)||void 0===m?void 0:m.ssrc_audio_recv)||void 0===v?void 0:v.totalSamplesReceived)},WebrtcStatistics.prototype.processSimulcastStats=function(l){this.simulcastVideo.processStats(l),this.simulcastSharing.processStats(l)},WebrtcStatistics.prototype.processBandwidthStats=function(){var l=this.extensions.WebRTCStats.bweStat&&this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth;if(l){var d=this.streamSenderStarted.Video||this.streamSenderStarted.ScreenShare;this.bandwidthTelemetry.recordSendBandwidth(l[l.length-1]),this.stabilizationTelemetry.processSendBandwidth(parseInt(l[l.length-1]),this.sessionInfo.activeModalities,d)}},WebrtcStatistics.prototype.processAudioStats=function(){var l,d,u,p;if(this.extensions.WebRTCStats.ssrc_audio_send&&this.limitCaptureAmount(this.extensions,\"Audio_send_RawInputVolume\",this.audioTelemetry.getInputLevel(\"Audio\")),void 0!==(null===(l=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===l?void 0:l.googJitterBufferMs)&&this.audioTelemetry.captureJitterBuffer((0,v.last)(this.extensions.WebRTCStats.ssrc_audio_recv.googJitterBufferMs)),void 0!==(null===(d=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===d?void 0:d.packetsLost)&&(null===(u=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===u?void 0:u.packetsReceived)&&this.audioTelemetry.capturePacketsLostAndPacketsReceived((0,v.last)(this.extensions.WebRTCStats.ssrc_audio_recv.packetsLost),(0,v.last)(this.extensions.WebRTCStats.ssrc_audio_recv.packetsReceived)),void 0!==(null===(p=this.extensions.WebRTCStats.ssrc_audio_recv)||void 0===p?void 0:p.jitter)&&this.audioTelemetry.captureJitterMax(this.extensions.WebRTCStats.ssrc_audio_recv.jitter),this.extensions.WebRTCStats.ssrc_audio_send&&this.extensions.WebRTCStats.ssrc_audio_send.googRtt){var h=this.extensions.WebRTCStats.ssrc_audio_send.googRtt;this.audioTelemetry.captureRtt(h[h.length-1])}},WebrtcStatistics.prototype.stopGatheringIfNeeded=function(l,d,u,p){var h=\"\".concat(d).concat(u);p!==this.lastSSRCs.get(h)&&(this.lastSSRCs.set(h,p),d===S.default.MEDIA_DIRECTION.SEND?l.stopSendGathering():l.stopRecvGathering())},WebrtcStatistics.prototype.setKeyFrameData=function(l,d){var u={kfEncoded:this.getLastSampleInt(d.keyFramesEncoded),fir:this.getLastSampleInt(d.googFirsReceived),pli:this.getLastSampleInt(d.googPlisReceived)};l.setKeyFrameData(u)},WebrtcStatistics.prototype.processVideoStatsSend=function(l,d){d&&_.hasSendDirectionality(this.sessionInfo.activeModalities.video)?(this.stopGatheringIfNeeded(l,S.default.MEDIA_DIRECTION.SEND,\"Video\",d.ssrc),this.setKeyFrameData(l,d),l.captureMediaData(S.default.MEDIA_DIRECTION.SEND,d.googFrameRateSent,d.framesEncoded),l.captureFrameRate(d.googFrameRateInput),l.analyzeDelay(this.videoDelayTimePeriod,d.googAvgEncodeMs),l.captureQpData(S.default.MEDIA_DIRECTION.SEND,d.qpSum,d.framesEncoded),l.captureBitrateSample(S.default.MEDIA_DIRECTION.SEND,this.getLastSampleInt(d.bytesSent)),l.detectCaptureFreeze(d.googFrameRateInput),l.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth),l.setCurrentParameters(parseInt(d.ssrc),{width:this.getLastSampleInt(d.googFrameWidthSent),height:this.getLastSampleInt(d.googFrameHeightSent)},this.getLastSampleInt(d.googFrameRateSent)),l.setQualityLimitationReason(d.qualityLimitationReason)):l.isSendGathering()&&(l.stopSendGathering(),this.lastSSRCs.delete(\"\".concat(S.default.MEDIA_DIRECTION.SEND,\"Video\")))},WebrtcStatistics.prototype.processVideoStatsRecv=function(l,d,u){var p,h;void 0===u&&(u=!1),d&&_.hasReceiveDirectionality(this.sessionInfo.activeModalities.video)&&this.videoTelemetry.isRecvDataGatheringEnabled?(u&&this.stopGatheringIfNeeded(l,S.default.MEDIA_DIRECTION.RECV,\"Video\",d.ssrc),l.trackId=d.googTrackId,l.gatherRecvFreezeData(d.googFrameRateDecoded,d.googFrameRateReceived,this.getLastSampleInt(d.bytesReceived)),l.captureMediaData(S.default.MEDIA_DIRECTION.RECV,d.googFrameRateReceived,d.googFrameRateDecoded),l.captureTimeToFirstFrame(this.getCurrentTimeToFirstFrame(d.googTrackId)),l.captureQpData(S.default.MEDIA_DIRECTION.RECV,d.qpSum,d.framesDecoded),l.captureBitrateSample(S.default.MEDIA_DIRECTION.RECV,this.getLastSampleInt(d.bytesReceived)),l.captureResolutionSample({width:this.getLastSampleInt(d.googFrameWidthReceived),height:this.getLastSampleInt(d.googFrameHeightReceived)}),(null===(p=this.extensions.WebRTCStats.ssrc_video_recv)||void 0===p?void 0:p.packetsLost)&&(null===(h=this.extensions.WebRTCStats.ssrc_video_recv)||void 0===h?void 0:h.packetsReceived)&&this.videoTelemetry.capturePacketsLostAndPacketsReceved((0,v.last)(this.extensions.WebRTCStats.ssrc_video_recv.packetsLost),(0,v.last)(this.extensions.WebRTCStats.ssrc_video_recv.packetsReceived))):u&&this.lastSSRCs.delete(\"\".concat(S.default.MEDIA_DIRECTION.RECV,\"Video\"))},WebrtcStatistics.prototype.processSharingStats=function(){var l=this.extensions.WebRTCStats.ssrc_sharing_send,d=this.extensions.WebRTCStats.ssrc_sharing_recv;l&&_.hasSendDirectionality(this.sessionInfo.activeModalities.sharing)?(this.stopGatheringIfNeeded(this.sharingTelemetry,S.default.MEDIA_DIRECTION.SEND,\"Sharing\",l.ssrc),this.setKeyFrameData(this.sharingTelemetry,l),this.sharingTelemetry.captureMediaData(S.default.MEDIA_DIRECTION.SEND,l.googFrameRateSent,l.framesEncoded),this.sharingTelemetry.captureFrameRate(l.googFrameRateInput),this.sharingTelemetry.analyzeDelay(this.videoDelayTimePeriod,l.googAvgEncodeMs),this.sharingTelemetry.captureQpData(S.default.MEDIA_DIRECTION.SEND,l.qpSum,l.framesEncoded),this.sharingTelemetry.captureBitrateSample(S.default.MEDIA_DIRECTION.SEND,this.getLastSampleInt(l.bytesSent)),this.sharingTelemetry.detectCaptureFreeze(l.googFrameRateInput),this.sharingTelemetry.captureAllocateBandwidth(this.extensions.WebRTCStats.bweStat.googAvailableSendBandwidth),this.sharingTelemetry.setCurrentParameters(parseInt(l.ssrc),{width:this.getLastSampleInt(l.googFrameWidthSent),height:this.getLastSampleInt(l.googFrameHeightSent)},this.getLastSampleInt(l.googFrameRateSent)),this.limitCaptureAmount(this.extensions,\"Sharing_send_RawInputVolume\",this.audioTelemetry.getInputLevel(\"ScreenShare\"))):this.sharingTelemetry.isSendGathering()&&(this.sharingTelemetry.stopSendGathering(),this.lastSSRCs.delete(\"\".concat(S.default.MEDIA_DIRECTION.SEND,\"Sharing\"))),d&&_.hasReceiveDirectionality(this.sessionInfo.activeModalities.sharing)&&this.sharingTelemetry.isRecvDataGatheringEnabled?(this.stopGatheringIfNeeded(this.sharingTelemetry,S.default.MEDIA_DIRECTION.RECV,\"Sharing\",d.ssrc),this.sharingTelemetry.trackId=d.googTrackId,this.sharingTelemetry.gatherRecvFreezeData(d.googFrameRateDecoded,d.googFrameRateReceived),this.sharingTelemetry.captureMediaData(S.default.MEDIA_DIRECTION.RECV,d.googFrameRateReceived,d.googFrameRateDecoded),this.sharingTelemetry.captureTimeToFirstFrame(this.getCurrentTimeToFirstFrame(d.googTrackId)),this.sharingTelemetry.captureQpData(S.default.MEDIA_DIRECTION.RECV,d.qpSum,d.framesDecoded),this.sharingTelemetry.captureBitrateSample(S.default.MEDIA_DIRECTION.RECV,this.getLastSampleInt(d.bytesReceived)),this.sharingTelemetry.captureResolutionSample({width:this.getLastSampleInt(d.googFrameWidthReceived),height:this.getLastSampleInt(d.googFrameHeightReceived)})):this.lastSSRCs.delete(\"\".concat(S.default.MEDIA_DIRECTION.RECV,\"Sharing\"))},WebrtcStatistics.prototype.processStreamsCounters=function(){var l=this.extensions.WebRTCStats.recvCounters;l&&(this.videoTelemetry.countRecvStreams(l[S.default.MODALITY.video]),this.sharingTelemetry.countRecvStreams(l[S.default.MODALITY.sharing]))},WebrtcStatistics.prototype.setMissedInitialPreferredResolution=function(){var l=this;y.forOwn(this.missedInitialPreferredResolution,(function(d,u){l.setPreferredResolution(u,d)})),this.missedInitialPreferredResolution={}},WebrtcStatistics.prototype.setPreferredResolution=function(l,d,u){if((u===S.default.MEDIA_TYPE.video&&!this.currentVideoRecvTrackId||u===S.default.MEDIA_TYPE.sharing&&!this.currentSharingRecvTrackId)&&(this.missedInitialPreferredResolution[l]=d),this.currentVideoRecvTrackId===l&&this.videoTelemetry.capturePreferredResolution(d,this.maxStoredPreferredResolutions),this.currentSharingRecvTrackId===l&&this.sharingTelemetry.capturePreferredResolution(d,this.maxStoredPreferredResolutions),this.isMultiViewVideoTelemetry){var p=this.multiViewVideoTelemetry[this.getSsrcIdFromMultipleVideoStream(l)];p&&p.capturePreferredResolution(d,this.maxStoredPreferredResolutions)}},WebrtcStatistics.prototype.setReportedSendBandwidth=function(l){this.extensions.ReportedSendBWMax||this.extensions.ReportedSendBWMin?l>this.extensions.ReportedSendBWMax?this.extensions.ReportedSendBWMax=l:l<this.extensions.ReportedSendBWMin&&(this.extensions.ReportedSendBWMin=l):(this.extensions.ReportedSendBWMax=l,this.extensions.ReportedSendBWMin=l)},WebrtcStatistics.prototype.setMaxSessionBandwidth=function(l){this.extensions.MaxSessionBandwidth=l},WebrtcStatistics.prototype.isSubscribed=function(l,d){var u=this.subscribedTrackIds.some((function(d){return d===l}));return!u&&this.configProvider.config.subscribeToSsrcForVideo&&(u=this.subscribedTrackSsrc.some((function(l){return l===\"\".concat(d)}))),u||!this.multiparty&&this.configProvider.config.subscribeToSsrcForVideo},WebrtcStatistics.prototype.getReport=function(l,d){var u,p,h,f,m=this;void 0===l&&(l=!1),void 0===d&&(d=!1);try{d&&this.resetPairValues(),l||(this.videoTelemetry.stopDataGathering(),this.sharingTelemetry.stopDataGathering());var v=this.videoTelemetry.getTotalDuration(S.default.MEDIA_DIRECTION.RECV),_=this.videoTelemetry.getTotalDuration(S.default.MEDIA_DIRECTION.SEND),C=this.sharingTelemetry.getTotalDuration(S.default.MEDIA_DIRECTION.RECV),E=this.sharingTelemetry.getTotalDuration(S.default.MEDIA_DIRECTION.SEND);if(v>=0&&(y.forOwn(this.videoTelemetry.getReport(S.default.MEDIA_DIRECTION.RECV,\"Video_recv_\",l),(function(l,d){return m.extensions[d]=l})),!y.isEmpty(this.multiViewVideoTelemetry))){var T=[],_loop_1=function(d){var u={id:d};y.forOwn(b.multiViewVideoTelemetry[d].getReport(S.default.MEDIA_DIRECTION.RECV,\"Video\",l),(function(l,d){void 0!==l&&(u[d]=l)})),T.push(u)},b=this;try{for(var I=g(Object.keys(this.multiViewVideoTelemetry)),A=I.next();!A.done;A=I.next()){_loop_1(A.value)}}catch(l){u={error:l}}finally{try{A&&!A.done&&(p=I.return)&&p.call(I)}finally{if(u)throw u.error}}this.extensions[S.default.MULTIPLE_RECV_STREAMS]=JSON.stringify(T)}C>=0&&y.forOwn(this.sharingTelemetry.getReport(S.default.MEDIA_DIRECTION.RECV,\"Sharing_recv_\",l),(function(l,d){return m.extensions[d]=l})),_>=0&&(y.forOwn(this.videoTelemetry.getReport(S.default.MEDIA_DIRECTION.SEND,\"Video_send_\",l),(function(l,d){return m.extensions[d]=l})),this.extensions.Bandwidth_jumpsHistogram=JSON.stringify(this.bandwidthTelemetry.getReport()),this.extensions.Bandwidth_stabilizationTime=JSON.stringify(this.stabilizationTelemetry.getReport(!0)),this.extensions.Video_send_CameraOpenWidth=this.cameraOpenResolution.width,this.extensions.Video_send_CameraOpenHeight=this.cameraOpenResolution.height),E>=0&&y.forOwn(this.sharingTelemetry.getReport(S.default.MEDIA_DIRECTION.SEND,\"Sharing_send_\",l),(function(l,d){return m.extensions[d]=l})),y.forOwn(this.dataTelemetry.getReport(\"Data_\"),(function(l,d){return m.extensions[d]=l})),l||(this.simulcastVideo.finish(),this.extensions.Video_send_Simulcast=JSON.stringify(this.simulcastVideo.collectedSessions),this.simulcastSharing.finish(),this.extensions.Sharing_send_Simulcast=JSON.stringify(this.simulcastSharing.collectedSessions)),this.iceCandidateErrors.length>0&&(this.extensions.iceCandidateErrors=JSON.stringify(this.iceCandidateErrors)),this.extensions.Audio_recv_jitterBufferAvgSize=this.audioTelemetry.getAvgJitterBuffer(),this.extensions.Audio_recv_googRttAvgSize=this.audioTelemetry.getAvgRtt(),this.extensions.Audio_recv_packetsLostRateMax=this.audioTelemetry.getPacketsLostRateMax(),this.extensions.Audio_recv_jitterMax=this.audioTelemetry.getJitterMax(),this.extensions.Video_SubscriptionEvents=JSON.stringify(this.videoTelemetry.getSubscriptionEvents()),this.extensions.Sharing_SubscriptionEvents=JSON.stringify(this.sharingTelemetry.getSubscriptionEvents()),this.extensions.Audio_recv_healedRatioMax=this.audioHealedRatioTelemetry.getHealedRatioMax(),this.extensions.Audio_recv_healedRatioAvg=this.audioHealedRatioTelemetry.getHealedRatioAvg(),this.extensions.Audio_recv_packetsLostAvg=this.audioTelemetry.getAvgPacketsLost();try{for(var R=g(Object.keys(this.extensions)),P=R.next();!P.done;P=R.next()){var O=P.value;void 0===this.extensions[O]&&delete this.extensions[O]}}catch(l){h={error:l}}finally{try{P&&!P.done&&(f=R.return)&&f.call(R)}finally{if(h)throw h.error}}return delete this.extensions.WebRTCStats[S.default.MULTIPLE_RECV_STREAMS],this.sessionInfo.fillExtensionInfo(this.extensions),Object.keys(this.extensions.WebRTCStats).length>0&&!this.extensions.WebRTCStats.hasStatsError&&this.calculateAverages(),this.extensions.H264_available_profiles=this.h264AvailableProfiles.join(),this.totalVideoControlMessages>0&&(this.extensions.totalVideoControlMessages=this.totalVideoControlMessages,this.extensions.outOfOrderVideoControlMessages=this.outOfOrderVideoControlMessages),y.deepClone(this.report)}catch(l){throw this.processStatsError(\"Report\",l),{error:l,partialReport:y.deepClone(this.report)}}},WebrtcStatistics.prototype.getAudioHwSilent=function(){return this.hwSilent},WebrtcStatistics.prototype.getSpeakingState=function(){return this.isSpeaking},WebrtcStatistics.prototype.getNetworkSendLevel=function(){return this.networkSendLevel},WebrtcStatistics.prototype.getNetworkRecvLevel=function(){return this.networkRecvLevel},WebrtcStatistics.prototype.addIceCandidateError=function(l){this.iceCandidateErrors.push(l)},WebrtcStatistics.prototype.clearIceCandidateErrors=function(){this.iceCandidateErrors=[]},WebrtcStatistics.prototype.addH264AvailableProfiles=function(l){this.h264AvailableProfiles=m([],f(new Set(this.h264AvailableProfiles.concat(l))),!1)},WebrtcStatistics.prototype.updateSendStream=function(l,d){this.audioTelemetry.updateSendStream(l,d)},WebrtcStatistics.prototype.resetPairValues=function(){var l=this;Object.keys(this.extensions.WebRTCStats).forEach((function(d){delete l.extensions.WebRTCStats[d].pair}))},WebrtcStatistics.prototype.limitCaptureAmount=function(l,d,u){void 0!==u&&(l[d]=Array.isArray(l[d])?l[d]:[],l[d].push(u),l[d].length>this.storedRecordsNumber&&l[d].shift())},WebrtcStatistics.prototype.setStartTime=function(l){var d=this.extensions.WebRTCStats;if(!d.ssrc_audio_send||!d.ssrc_audio_recv)return!1;var setupCounter=function(l,d){return!l||d&&-1===d?d:(new Date).getTime()};return this.extensions.TimerAudioPayloadRecvBitrate=_.hasReceiveDirectionality(l.audio)?setupCounter(d.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioPayloadRecvBitrate):-1,this.extensions.TimerAudioPayloadSendBitrate=_.hasSendDirectionality(l.audio)?setupCounter(d.ssrc_audio_send.bytesSent,this.extensions.TimerAudioPayloadSendBitrate):-1,this.extensions.TimerAudioTransportRecvBitrate=_.hasReceiveDirectionality(l.audio)?setupCounter(d.ssrc_audio_recv.bytesReceived,this.extensions.TimerAudioTransportRecvBitrate):-1,this.extensions.TimerAudioTransportSendBitrate=_.hasSendDirectionality(l.audio)?setupCounter(d.ssrc_audio_send.bytesSent,this.extensions.TimerAudioTransportSendBitrate):-1,!(!d.ssrc_video_send||!d.ssrc_video_recv)&&(this.extensions.TimerVideoPayloadRecvBitrate=_.hasReceiveDirectionality(l.video)?setupCounter(d.ssrc_video_recv.bytesReceived,this.extensions.TimerVideoPayloadRecvBitrate):-1,this.extensions.TimerVideoPayloadSendBitrate=_.hasSendDirectionality(l.video)?setupCounter(d.ssrc_video_send.bytesSent,this.extensions.TimerVideoSendBitrate):-1,!!(this.extensions.TimerVideoPayloadRecvBitrate&&this.extensions.TimerVideoPayloadSendBitrate&&this.extensions.TimerAudioPayloadRecvBitrate&&this.extensions.TimerAudioPayloadSendBitrate&&this.extensions.TimerAudioTransportRecvBitrate&&this.extensions.TimerAudioTransportSendBitrate))},WebrtcStatistics.prototype.calculateAverages=function(){var l=this,d=this.extensions.EndTime,doTheCalc=function(l,u){return l&&d-u>0&&0!==u&&-1!==u?Math.round(8*l/(d-u)):0},getCounter=function(d){var u=d.split(\".\").reduce((function(l,d){return null==l?l:l[d]}),l.extensions.WebRTCStats);return Array.isArray(u)?u[u.length-1]:u};this.extensions.AudioPayloadRecvBitrate=doTheCalc(getCounter(\"ssrc_audio_recv.bytesReceived\"),this.extensions.TimerAudioPayloadRecvBitrate),this.extensions.AudioPayloadSendBitrate=doTheCalc(getCounter(\"ssrc_audio_send.bytesSent\"),this.extensions.TimerAudioPayloadSendBitrate),this.extensions.VideoPayloadRecvBitrate=doTheCalc(getCounter(\"ssrc_video_recv.bytesReceived\"),this.extensions.TimerVideoPayloadRecvBitrate),this.extensions.VideoPayloadSendBitrate=doTheCalc(getCounter(\"ssrc_video_send.bytesSent\"),this.extensions.TimerVideoPayloadSendBitrate),this.extensions.AudioTransportRecvBitrate=doTheCalc(getCounter(\"ssrc_audio_send.pair.bytesReceived\"),this.extensions.TimerAudioTransportRecvBitrate),this.extensions.AudioTransportSendBitrate=doTheCalc(getCounter(\"ssrc_audio_send.pair.bytesSent\"),this.extensions.TimerAudioTransportSendBitrate)},WebrtcStatistics.prototype.addFilteredFields=function(l,d,u){for(var p in void 0===u&&(u=[]),d)if(d.hasOwnProperty(p)&&\"type\"!==p)if(-1!==u.indexOf(p)){var h=l[p]||[];h.push(this.formatFields(d,p)),h.length>this.storedRecordsNumber&&h.shift(),l[p]||(l[p]=h)}else l[p]=d[p]},WebrtcStatistics.prototype.formatFields=function(l,d){var u=l[d];switch(d){case\"audioInputLevel\":case\"audioOutputLevel\":return this.newStatsApi?Math.floor(65535*u):2*u;case\"googJitterBufferMs\":return parseInt(u);case\"healedRatio\":return y.round(parseFloat(u),this.configProvider.config.healedRatioPrecision);default:return u}},WebrtcStatistics.prototype.processSource=function(l,d,u){if(this.addFilteredFields(l,d,O),d.transportId){var p=u.googComponent[d.transportId];if(l.transport||(l.transport={}),this.addFilteredFields(l.transport,p),p.selectedCandidatePairId){var h=u.googCandidatePair[p.selectedCandidatePairId];l.pair||(l.pair={}),this.addFilteredFields(l.pair,h,M)}}},WebrtcStatistics.prototype.getWebrtcReport=function(l,d,u,p){var h=l.ssrc[u],g=p?h.id.replace(/[0-9]+/,p):h.id;d[g]?h.ssrc!==d[g].ssrc&&(g.endsWith(\"video_send\")?this.videoTelemetry.stopSendGathering():g.endsWith(\"video_recv\")?this.videoTelemetry.stopRecvGathering():g.endsWith(\"sharing_send\")?this.sharingTelemetry.stopSendGathering():g.endsWith(\"sharing_recv\")&&this.sharingTelemetry.stopRecvGathering()):d[g]={},this.processSource(d[g],h,l)},WebrtcStatistics.prototype.constructWebRTCDataReport=function(l,d){if(d.data&&d.data.length){var u=d.data.sort((function(l,d){return d.timestamp-l.timestamp})),p=u.find((function(l){return\"open\"===l.state}));l.data=p||u[0]}},WebrtcStatistics.prototype.constructWebRtcReportForSingleStream=function(l,d){var u=this;if(d.ssrc){var p=this.selectSsrcsToCollect(d.ssrc);l.recvCounters=p.recvCounters,delete p.recvCounters,delete p.multiRecv,y.forOwn(p,(function(p){y.forOwn(p,(function(p,h){u.getWebrtcReport(d,l,p,h)}))})),d.VideoBwe&&d.VideoBwe.bweforvideo&&(l.bweStat||(l.bweStat={}),this.addFilteredFields(l.bweStat,d.VideoBwe.bweforvideo,w))}},WebrtcStatistics.prototype.constructWebRtcReportForMultipleStreams=function(l,d){var u=this;d.ssrc&&this.selectSsrcsToCollect(d.ssrc).multiRecv.forEach((function(p){return u.getWebrtcReport(d,l,p)}))},WebrtcStatistics.prototype.getMediaType=function(l,d){var u,p=d?d.getModality():l.mediaType;return(null===(u=l.googTrackId)||void 0===u?void 0:u.match(\"applicationsharing\"))&&p!==S.default.MEDIA_TYPE.sharing&&(p=S.default.MEDIA_TYPE.sharing),p},WebrtcStatistics.prototype.selectSsrcsToCollect=function(l){var d,u,p=this,h={send:{},recv:{},recvCounters:{video:0,sharing:0},multiRecv:[]};if(!this.sessionInfo.activeModalities)return h;var f=[];try{for(var m=g(Object.keys(l)),v=m.next();!v.done;v=m.next()){var y=v.value,C=l[y],E=C.googTrackId;if(E||C.mediaType===S.default.MEDIA_TYPE.audio){var T=this.getMediaEntity(E,C),b=this.getMediaType(C,T);if(y.endsWith(\"send\"))switch(b){case S.default.MEDIA_TYPE.audio:_.hasSendDirectionality(this.sessionInfo.activeModalities.audio)&&(h.send.audio=y);break;case S.default.MEDIA_TYPE.video:if(this.simulcastVideo.highestFidelitySSRC){this.simulcastVideo.highestFidelitySSRC===C.ssrc&&(h.send.video=y);break}this.streamSenderStarted.Video&&_.hasSendDirectionality(this.sessionInfo.activeModalities.video)&&((null==T?void 0:T.getLocalTrackId())===C.googTrackId||this.configProvider.config.statsAllowAnyVideoSendTrack&&!h.send.video)&&(h.send.video=y);break;case S.default.MEDIA_TYPE.sharing:if(this.simulcastSharing.highestFidelitySSRC){this.simulcastSharing.highestFidelitySSRC===C.ssrc&&(h.send.sharing=y);break}this.streamSenderStarted.ScreenShare&&_.hasSendDirectionality(this.sessionInfo.activeModalities.sharing)&&(null==T?void 0:T.getLocalTrackId())===C.googTrackId&&(h.send.sharing=y);break;default:this.logger.warn(\"Unknown media type '\".concat(b,\"'\"))}else if(y.endsWith(\"recv\"))switch(b){case S.default.MEDIA_TYPE.audio:_.hasReceiveDirectionality(this.sessionInfo.activeModalities.audio)&&(h.recv.audio=y);break;case S.default.MEDIA_TYPE.video:this.isSubscribed(C.googTrackId,C.ssrc)&&_.hasReceiveDirectionality(this.sessionInfo.activeModalities.video)&&(f.push(C),+C.googFrameRateReceived>0&&h.recvCounters[S.default.MODALITY.video]++);break;case S.default.MEDIA_TYPE.sharing:this.isSubscribed(C.googTrackId,C.ssrc)&&_.hasReceiveDirectionality(this.sessionInfo.activeModalities.sharing)&&(h.recv.sharing=y,+C.googFrameRateReceived>0&&h.recvCounters[S.default.MODALITY.sharing]++);break;default:this.logger.warn(\"Unknown media type '\".concat(b,\"'\"))}}}}catch(l){d={error:l}}finally{try{v&&!v.done&&(u=m.return)&&u.call(m)}finally{if(d)throw d.error}}if(f.length>0){var I=(f=f.sort((function(l,d){return+d.googFrameHeightReceived-+l.googFrameHeightReceived}))).find((function(l){return l.mediaType===S.default.MEDIA_TYPE.video}));I&&(h.recv.video=I.id),this.multiparty&&this.configProvider.config.enableMultiViewStats&&(h.multiRecv=f.map((function(l){return l.id})),h.multiRecv.forEach((function(l){p.multiViewVideoTelemetry[l]||(p.multiViewVideoTelemetry[l]=new R.default(p.extensions.StartTime,p.configProvider,p.logger.createChild(\"Video[\".concat(l,\"]\"),\"Video\")))})))}return h},WebrtcStatistics.prototype.getMediaEntityForTrack=function(l){return l&&this.mediaManager.getMediaEntities().find((function(d){return d.getLocalTrackId()===l||d.getRemoteTrackId()===l}))},WebrtcStatistics.prototype.getMediaEntityByRemoteSsrc=function(l){return l&&this.mediaManager.getMediaEntities().find((function(d){return d.getRemoteSsrc()===+l}))},WebrtcStatistics.prototype.getMediaEntity=function(l,d){var u=\"\".concat(d.ssrc),p=d.id,h=this.getMediaEntityForTrack(l);return!h&&this.configProvider.config.subscribeToSsrcForVideo&&p.endsWith(\"recv\")&&(h=this.getMediaEntityByRemoteSsrc(u)),h},WebrtcStatistics.prototype.calculateHwSilentState=function(){var l=this.extensions.WebRTCStats.ssrc_audio_send&&this.extensions.WebRTCStats.ssrc_audio_send.audioInputLevel;if(l&&!(l.length<2*this.hwSilentDetectionDuration)){for(var d=!0,u=l.length-this.hwSilentDetectionDuration-1;u<l.length;u++)if(l[u]>this.hwSilentDetectionLevel){d=!1;break}this.hwSilent!==d&&(this.hwSilent=d,this.logger.safe.info(\"HW silent changed to \".concat(this.hwSilent)))}},WebrtcStatistics.prototype.calculateSpeakingState=function(){var l=this.newStatsApi&&this.configProvider.config.useAudioAnalyzer?this.extensions.Audio_send_RawInputVolume:this.extensions.WebRTCStats.ssrc_audio_send&&this.extensions.WebRTCStats.ssrc_audio_send.audioInputLevel;if(l&&!(l.length<=this.speakingWhileMutedBadDuration)){for(var d=!1,u=l.length-this.speakingWhileMutedBadDuration;u<l.length;u++)if(l[u]>this.speakingWhileMutedDetectionLevel){d=!0;break}this.isSpeaking=d}},WebrtcStatistics.prototype.calculateNetworkRecvQualityLevel=function(){var l,d,u,p,h;this.configProvider.config.enableNetworkRecvQualityUFD&&this.extensions.WebRTCStats.ssrc_audio_recv&&(this.networkRecvLevel=this.networkQualityTelemetry.calculateNetworkRecvQualityLevel({googDecodingCTN:null!==(l=this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingCTN)&&void 0!==l?l:[],googDecodingPLC:null!==(d=this.extensions.WebRTCStats.ssrc_audio_recv.googDecodingPLC)&&void 0!==d?d:[],concealedSamples:null!==(u=this.extensions.WebRTCStats.ssrc_audio_recv.concealedSamples)&&void 0!==u?u:[],silentConcealedSamples:null!==(p=this.extensions.WebRTCStats.ssrc_audio_recv.silentConcealedSamples)&&void 0!==p?p:[],totalSamplesReceived:null!==(h=this.extensions.WebRTCStats.ssrc_audio_recv.totalSamplesReceived)&&void 0!==h?h:[],oldNetworkLevel:this.networkRecvLevel}))},WebrtcStatistics.prototype.calculateNetworkSendQualityLevel=function(){this.configProvider.config.enableNetworkSendQualityUFD&&this.extensions.WebRTCStats.ssrc_audio_send&&(this.networkSendLevel=this.networkQualityTelemetry.calculateNetworkSendQualityLevel(this.extensions.WebRTCStats.ssrc_audio_send.packetsSent,this.extensions.WebRTCStats.ssrc_audio_send.packetsLost,this.extensions.WebRTCStats.ssrc_audio_send.jitter,this.networkSendLevel))},WebrtcStatistics.prototype.processStatsError=function(l,d){var u=y.stringifyObject(d);this.logger.safe.error(\"webrtcStatistics error [\".concat(l,\"]: \").concat(u));var p=this.statsErrors.find((function(d){return d.error===u&&d.origin===l}));p?p.count++:this.statsErrors.push({origin:l,error:u,count:1}),this.statsErrors.length>N&&this.statsErrors.splice(1)},WebrtcStatistics.prototype.getLastSampleInt=function(l){return\"number\"==typeof l?l:l&&parseInt(l[l.length-1])||0},WebrtcStatistics.prototype.getSsrcIdFromMultipleVideoStream=function(l){var d,u=this.extensions.WebRTCStats[S.default.MULTIPLE_RECV_STREAMS]||{};for(var p in u){var h=u[p];if(h&&h.googTrackId===l){d=p;break}}return d},p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"onDeviceEvent\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"onMaxCapabilitiesRequested\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"onMaxCapabilitiesApplied\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Number,String,Number,Error,Number]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"addSubscriptionEvent\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processSimulcastStats\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processBandwidthStats\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processAudioStats\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[R.default,Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processVideoStatsSend\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[R.default,Object,Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processVideoStatsRecv\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processSharingStats\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processStreamsCounters\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"setMissedInitialPreferredResolution\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[String,Object,String]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"setPreferredResolution\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Number]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"setReportedSendBandwidth\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Number]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"setMaxSessionBandwidth\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object]),h(\"design:returntype\",Boolean)],WebrtcStatistics.prototype,\"setStartTime\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"calculateAverages\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object,Object,Array]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"addFilteredFields\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object,String]),h(\"design:returntype\",Object)],WebrtcStatistics.prototype,\"formatFields\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object,Object,Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"processSource\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object,Object,String,String]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"getWebrtcReport\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object,Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"constructWebRTCDataReport\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object,Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"constructWebRtcReportForSingleStream\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object,Object]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"constructWebRtcReportForMultipleStreams\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[Object]),h(\"design:returntype\",Object)],WebrtcStatistics.prototype,\"selectSsrcsToCollect\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"calculateHwSilentState\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"calculateSpeakingState\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"calculateNetworkRecvQualityLevel\",null),p([catchStatsErrors,h(\"design:type\",Function),h(\"design:paramtypes\",[]),h(\"design:returntype\",void 0)],WebrtcStatistics.prototype,\"calculateNetworkSendQualityLevel\",null),WebrtcStatistics}();d.default=D},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(8),h=function(){function WebRTCAudioHealedRatioTelemetry(l){this.networkDetectionDuration=l,this.healedRatio=0,this.healedRatioMax=0,this.healedRatioDuration=0,this.healedRatioTotal=0,this.totalSamplesReceivedDiff=0}return WebRTCAudioHealedRatioTelemetry.prototype.captureHealedRatioSamples=function(l,d,u){!l||!d||!u||l.length<=this.networkDetectionDuration||d.length<=this.networkDetectionDuration||u.length<=this.networkDetectionDuration||this.setHealedRatioPerDuration(l,d,u)},WebRTCAudioHealedRatioTelemetry.prototype.getHealedRatioMax=function(){return this.healedRatioMax},WebRTCAudioHealedRatioTelemetry.prototype.getHealedRatioAvg=function(){return this.healedRatioDuration?this.healedRatioTotal/this.healedRatioDuration:0},WebRTCAudioHealedRatioTelemetry.prototype.getHealedRatio=function(){return this.healedRatio},WebRTCAudioHealedRatioTelemetry.prototype.getTotalSamplesReceivedDiff=function(){return this.totalSamplesReceivedDiff},WebRTCAudioHealedRatioTelemetry.prototype.setHealedRatioPerDuration=function(l,d,u){var h=-1-this.networkDetectionDuration,g=Math.max((0,p.last)(l)-(0,p.nth)(l,h),0),f=Math.max((0,p.last)(d)-(0,p.nth)(d,h),0);this.totalSamplesReceivedDiff=Math.max((0,p.last)(u)-(0,p.nth)(u,h),0),0!==this.totalSamplesReceivedDiff&&(this.healedRatio=(g-f)/this.totalSamplesReceivedDiff,this.healedRatioDuration++,this.healedRatioTotal+=this.healedRatio,this.healedRatioMax=Math.max(this.healedRatioMax,this.healedRatio))},WebRTCAudioHealedRatioTelemetry}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(150),h=u(1),g=u(3),f=u(151),m=function(){function WebRTCAudioTelemetry(l){this.configProvider=l,this.audioAnalyzers=new Map,this.jitterDuration=0,this.jitterBufferTotal=0,this.rttDuration=0,this.rttTotal=0,this.jitterMax=0,this.webrtcAudioPacketLossRate=new f.default(l.config.minPacketsReceivedToCalculatePacketLossRate)}return WebRTCAudioTelemetry.prototype.captureJitterBuffer=function(l){this.jitterDuration+=g.default.TIME_INTERVAL.SEC_1,this.jitterBufferTotal+=l},WebRTCAudioTelemetry.prototype.captureJitterMax=function(l){this.jitterMax=Math.max(l,this.jitterMax)},WebRTCAudioTelemetry.prototype.getAvgJitterBuffer=function(){return this.jitterDuration?Math.round(this.jitterBufferTotal/this.jitterDuration):0},WebRTCAudioTelemetry.prototype.capturePacketsLostAndPacketsReceived=function(l,d){this.webrtcAudioPacketLossRate.capturePacketsLostAndPacketsReceived(l,d)},WebRTCAudioTelemetry.prototype.getPacketsLostRateMax=function(){return this.webrtcAudioPacketLossRate.getPacketsLostRateMax()},WebRTCAudioTelemetry.prototype.getAvgPacketsLost=function(){return this.webrtcAudioPacketLossRate.getAvgPacketsLost()},WebRTCAudioTelemetry.prototype.captureRtt=function(l){if(null!==l){var d=parseInt(l);this.rttDuration+=g.default.TIME_INTERVAL.SEC_1,this.rttTotal+=d}},WebRTCAudioTelemetry.prototype.getAvgRtt=function(){return this.rttDuration?h.round(this.rttTotal/this.rttDuration,3):0},WebRTCAudioTelemetry.prototype.getJitterMax=function(){return this.jitterMax},WebRTCAudioTelemetry.prototype.updateSendStream=function(l,d){var u;if(this.configProvider.config.useAudioAnalyzer){var h=this.audioAnalyzers.get(d);h&&(h.dispose(),this.audioAnalyzers.delete(d)),(null===(u=null==l?void 0:l.rawStream)||void 0===u?void 0:u.getAudioTracks().length)&&this.audioAnalyzers.set(d,new p.AudioStreamAnalyzer(l.rawStream))}},WebRTCAudioTelemetry.prototype.getInputLevel=function(l){var d=this.audioAnalyzers.get(l);return null==d?void 0:d.getInputLevel()},WebRTCAudioTelemetry}();d.default=m},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRTCBandwidthTelemetry=void 0;var h=u(3),g=u(1),f=function(){function WebRTCBandwidthTelemetry(l,d){var u=this;this.dropBadBandwidth=l,this.dropGoodBandwidth=d,this.dropDurationCounts={},Object.keys(h.default.HISTOGRAM_BATCH).forEach((function(l){u.dropDurationCounts[l]=0}))}return WebRTCBandwidthTelemetry.prototype.recordSendBandwidth=function(l){this.currentDropDuration&&l<this.dropGoodBandwidth||l<this.dropBadBandwidth?this.initiateDrop():this.currentDropDuration&&l>this.dropGoodBandwidth&&this.recoverDrop()},WebRTCBandwidthTelemetry.prototype.getReport=function(){var l=g.shallowClone(this.dropDurationCounts);return this.currentDropDuration&&(l.ongoingDuration=this.currentDropDuration),l},WebRTCBandwidthTelemetry.prototype.initiateDrop=function(){this.currentDropDuration?this.currentDropDuration++:this.currentDropDuration=1},WebRTCBandwidthTelemetry.prototype.recoverDrop=function(){var l,d;try{for(var u=p(Object.keys(h.default.HISTOGRAM_BATCH)),g=u.next();!g.done;g=u.next()){var f=g.value;if(this.currentDropDuration<=h.default.HISTOGRAM_BATCH[f]){this.dropDurationCounts[f]+=1,this.currentDropDuration=0;break}}}catch(d){l={error:d}}finally{try{g&&!g.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}},WebRTCBandwidthTelemetry}();d.WebRTCBandwidthTelemetry=f},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRTCDataTelemetry=void 0;var h=u(1),g=function(){function WebRTCDataTelemetry(){this.messageCounters=new Map}return WebRTCDataTelemetry.prototype.recordDataChannelProtocolEvent=function(l){this.messageCounters.has(l.dataId)||this.messageCounters.set(l.dataId,{});var d=this.messageCounters.get(l.dataId);d[l.direction]||(d[l.direction]={successful:0,failed:0,fragmented:0,outOfOrder:0,dismissed:0}),l.parsedSuccessfully?d[l.direction].successful++:d[l.direction].failed++,l.isFragmented&&(d[l.direction].fragmented++,l.isComplete||d[l.direction].isComplete++),l.isOutOfOrder&&d[l.direction].outOfOrder++},WebRTCDataTelemetry.prototype.setSessionDataChannelState=function(l){this.sessionState=l.toString()},WebRTCDataTelemetry.prototype.recordDataChannelCreationFailure=function(l){this.createChannelFailReason=h.stringifyObject(l)},Object.defineProperty(WebRTCDataTelemetry.prototype,\"protocolCounters\",{get:function(){var l,d;if(this.messageCounters.size){var u={};try{for(var h=p(this.messageCounters.keys()),g=h.next();!g.done;g=h.next()){var f=g.value;u[f]=this.messageCounters.get(f)}}catch(d){l={error:d}}finally{try{g&&!g.done&&(d=h.return)&&d.call(h)}finally{if(l)throw l.error}}return u}},enumerable:!1,configurable:!0}),WebRTCDataTelemetry.prototype.getReport=function(l){var d={};return d[l+\"ProtocolCounters\"]=JSON.stringify(this.protocolCounters),d[l+\"SessionState\"]=this.sessionState,d[l+\"CreateChannelFailReason\"]=this.createChannelFailReason,d},WebRTCDataTelemetry}();d.WebRTCDataTelemetry=g},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(8),g=u(67),f=u(394),m=function(){function WebRTCNetworkQualityTelemetry(l,d,u){this.configProvider=l,this.newStatsApi=d,this.webrtcHealedRatio=u,this.jitterData=new g.SlidingWindow(this.configProvider.config.webrtcJitterWindowSize),this.packetsLostData=new g.SlidingWindow(this.configProvider.config.webrtcLossRateWindowSize);var p=Number(this.configProvider.config.webrtcStatNetworkDetectionHysteresis);this.networkDetectionBadLevelHigh=Number(this.configProvider.config.webrtcStatNetworkDetectionBadLevel)+p/2,this.networkDetectionBadLevelLow=this.networkDetectionBadLevelHigh-p,this.networkDetectionGoodLevelHigh=Number(this.configProvider.config.webrtcStatNetworkDetectionGoodLevel)+p/2,this.networkDetectionGoodLevelLow=this.networkDetectionGoodLevelHigh-p,this.jitterStateProcessor=new f.UfdTwoStateEventProcessor(l.config.webrtcJitterLowThreshold,l.config.webrtcJitterHighThreshold,!0,l.config.webrtcJitterSticknessTime),this.lossRateStateProcessor=new f.UfdTwoStateEventProcessor(l.config.webrtcLossRateLowThreshold,l.config.webrtcLossRateHighThreshold,!0,l.config.webrtcLossRateSticknessTime)}return WebRTCNetworkQualityTelemetry.prototype.calculateNetworkSendQualityLevel=function(l,d,u,g){if(!l||!d)return g;if(l.length<2||d.length<2||(0,h.last)(l)<this.configProvider.config.webrtcMinPacketsSentForNetworkSendQuality)return g;var f=Date.now(),m=this.getLatestSendQuality(u,this.jitterData,this.jitterStateProcessor,f,g),v=p(l.slice(-2),2),y=v[0],S=v[1],_=p(d.slice(-2),2),C=_[0],E=_[1],T=this.getAverageLossRate(S,y,E,C),b=this.getLatestSendQuality(T,this.packetsLostData,this.lossRateStateProcessor,f,g);return\"Good\"===m&&\"Good\"===b?\"Good\":\"Bad\"},WebRTCNetworkQualityTelemetry.prototype.calculateNetworkRecvQualityLevel=function(l){if(this.newStatsApi){var d=l;return this.calculateNetworkRecvQualityLevelNewStatsApi(d.concealedSamples,d.silentConcealedSamples,d.totalSamplesReceived,d.oldNetworkLevel)}var u=l;return this.calculateNetworkRecvQualityLevelLegacyStatsApi(u.googDecodingCTN,u.googDecodingPLC,u.oldNetworkLevel)},WebRTCNetworkQualityTelemetry.prototype.calculateNetworkRecvQualityLevelLegacyStatsApi=function(l,d,u){var p=this.configProvider.config.webrtcStatNetworkDetectionDuration;if(!l||!d||l.length<2*p)return u;for(var h=l.length-1-p,g=l[l.length-1];h>=0&&g-l[h]<100*p;)h--;if(h<0)return u;var f=g-l[h],m=d[d.length-1]-d[h];if(f<=0)return u;var v=m/f;return this.getRecvQuality(v,u)},WebRTCNetworkQualityTelemetry.prototype.calculateNetworkRecvQualityLevelNewStatsApi=function(l,d,u,p){var g=this.configProvider.config.webrtcStatNetworkDetectionDuration;return!l||l.length<=g||!d||d.length<=g||!u||u.length<=g||(0,h.last)(u)<this.configProvider.config.webrtcMinAudioSamplesRecvForNetworkRecvQuality||0===this.webrtcHealedRatio.getTotalSamplesReceivedDiff()?p:this.getRecvQuality(this.webrtcHealedRatio.getHealedRatio(),p)},WebRTCNetworkQualityTelemetry.prototype.getRecvQuality=function(l,d){return l<this.networkDetectionGoodLevelLow?\"Good\":l<this.networkDetectionGoodLevelHigh?\"Good\"===d?\"Good\":\"Poor\":l<this.networkDetectionBadLevelLow?\"Poor\":l<this.networkDetectionBadLevelHigh?\"Bad\"===d?\"Bad\":\"Poor\":\"Bad\"},WebRTCNetworkQualityTelemetry.prototype.getLatestSendQuality=function(l,d,u,p,g){if(d.add(l),d.isFull){var f=(0,h.mean)(d.items);return u.onSample(f,p)}return g},WebRTCNetworkQualityTelemetry.prototype.getAverageLossRate=function(l,d,u,p){var h=l-d,g=u-p;return h>0&&g>0?g/h:0},WebRTCNetworkQualityTelemetry}();d.default=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.UfdTwoStateEventProcessor=void 0;var p=function(){function UfdTwoStateEventProcessor(l,d,u,p){this.lowThreshold=l,this.highThreshold=d,this.isLowerBetter=u,this.curInLowerRange=u,this.stateTracker=new h(p)}return UfdTwoStateEventProcessor.prototype.onSample=function(l,d){var u=this.curInLowerRange;this.curInLowerRange?l>this.highThreshold&&(u=!1):l<this.lowThreshold&&(u=!0);var p=this.stateTracker.onNewState(this.getQuality(u),d);return p!==this.getQuality(this.curInLowerRange)&&(this.curInLowerRange=u),p},UfdTwoStateEventProcessor.prototype.getQuality=function(l){return l===this.isLowerBetter?\"Good\":\"Bad\"},UfdTwoStateEventProcessor}();d.UfdTwoStateEventProcessor=p;var h=function(){function UfdTwoStateTracker(l){this.sticknessTime=l}return UfdTwoStateTracker.prototype.onNewState=function(l,d){return\"Good\"!==l&&\"Bad\"!==l?this.curState:0===this.sticknessTime?l:l===this.curState?(this.stickTimerStarted=0,this.curState):(\"Bad\"===this.curState?0===this.stickTimerStarted?this.stickTimerStarted=d:d-this.stickTimerStarted>this.sticknessTime&&(this.curState=l,this.stickTimerStarted=0):(this.curState=l,this.stickTimerStarted=0),this.curState)},UfdTwoStateTracker}()},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebrtcStabilizationTelemetry=void 0;var p=u(67),h=u(1),g=u(3),f=u(9),m=function(){function WebrtcStabilizationTelemetry(l,d,u){this.slidingWindowSize=l,this.maxDeviation=d,this.minBandwidth=u,this.slidingWindow=new p.SlidingWindow(this.slidingWindowSize),this.currentModality=null,this.previousModality=null,this.inProcess=!1}return WebrtcStabilizationTelemetry.prototype.processSendBandwidth=function(l,d,u){this.currentModality?this.handleStopEvent(d,u):this.handleStartEvent(d,u),this.inProcess&&(this.stabilizationTime++,this.slidingWindow.add(l),this.inProcess=!this.slidingWindow.isFull||!this.isBandwidthStable())},WebrtcStabilizationTelemetry.prototype.getReport=function(l){if(void 0===l&&(l=!1),void 0!==this.stabilizationTime)return{time:this.inProcess?this.stabilizationTime:Math.max(this.stabilizationTime-this.slidingWindowSize,0),bandwidth:l?(0,h.round)(this.averageBandwidth,2):this.averageBandwidth,finished:!this.inProcess,modality:this.previousModality}},WebrtcStabilizationTelemetry.prototype.handleStartEvent=function(l,d){this.currentModality=this.GetModalityString(l),d&&this.currentModality&&!this.previousModality&&(this.previousModality=this.currentModality,this.stabilizationTime=0,this.slidingWindow.clear(),this.inProcess=!0)},WebrtcStabilizationTelemetry.prototype.handleStopEvent=function(l,d){d&&((0,f.hasSendDirectionality)(l.video)||(0,f.hasSendDirectionality)(l.sharing))||(this.currentModality=null,this.inProcess=!1)},WebrtcStabilizationTelemetry.prototype.GetModalityString=function(l){return[(0,f.hasSendDirectionality)(l.video)?g.default.MODALITY.video:null,(0,f.hasSendDirectionality)(l.sharing)?g.default.MODALITY.sharing:null].filter(Boolean).join(\", \")},WebrtcStabilizationTelemetry.prototype.isBandwidthStable=function(){if(this.averageBandwidth=(0,h.average)(this.slidingWindow.items),this.averageBandwidth<this.minBandwidth)return!1;var l=this.averageBandwidth*this.maxDeviation,d=this.averageBandwidth-l,u=this.averageBandwidth+l;return this.slidingWindow.items.every((function(l){return(0,h.isInRange)(l,d,u)}))},WebrtcStabilizationTelemetry}();d.WebrtcStabilizationTelemetry=m},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},g=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRTCQualityLimitationTelemetry=void 0;var f=function(){function WebRTCQualityLimitationTelemetry(l){this.configProvider=l,this.qualityLimitationReasonEvents=[]}return WebRTCQualityLimitationTelemetry.prototype.setQualityLimitationReason=function(l){this.lastQualityLimitationReason!==l&&this.qualityLimitationReasonEvents.push({event:l,startTime:Date.now(),endTime:Date.now()}),this.qualityLimitationReasonEvents.length>this.configProvider.config.maxStoredQualityLimitationReasonEvents&&this.qualityLimitationReasonEvents.shift(),this.lastQualityLimitationReason=l},WebRTCQualityLimitationTelemetry.prototype.getQualityLimitationReasonEvents=function(){var l=this;return this.qualityLimitationReasonEvents.reduce((function(d,u,f){var m,v;return\"none\"===u.event?d:g(g([],h(d),!1),[p(p({},u),{endTime:null!==(v=null===(m=l.qualityLimitationReasonEvents[f+1])||void 0===m?void 0:m.startTime)&&void 0!==v?v:Date.now()})],!1)}),[])},WebRTCQualityLimitationTelemetry}();d.WebRTCQualityLimitationTelemetry=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(3),h=function(){function WebRTCVideoBitrateTelemetry(){var l;this.bitrateData=((l={})[p.default.MEDIA_DIRECTION.SEND]={lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0,allocateBW:0,allocateBWSamples:0},l[p.default.MEDIA_DIRECTION.RECV]={lastBytes:0,lastTimestamp:0,maxSample:0,bitrateTotal:0,nSamples:0},l)}return WebRTCVideoBitrateTelemetry.prototype.captureSample=function(l,d){var u=Date.now()/1e3;if(0!==this.bitrateData[l].lastTimestamp&&d>this.bitrateData[l].lastBytes){var p=u-this.bitrateData[l].lastTimestamp,h=8*(d-this.bitrateData[l].lastBytes)/p;this.onBitrateSample(l,h)}this.bitrateData[l].lastTimestamp=u,this.bitrateData[l].lastBytes=d},WebRTCVideoBitrateTelemetry.prototype.getMax=function(l){return Math.round(this.bitrateData[l].maxSample)},WebRTCVideoBitrateTelemetry.prototype.getAvg=function(l){return 0===this.bitrateData[l].nSamples?0:Math.round(this.bitrateData[l].bitrateTotal/this.bitrateData[l].nSamples)},WebRTCVideoBitrateTelemetry.prototype.stopCapture=function(l){this.bitrateData[l].lastBytes=0,this.bitrateData[l].lastTimestamp=0},WebRTCVideoBitrateTelemetry.prototype.onBitrateSample=function(l,d){d>this.bitrateData[l].maxSample&&(this.bitrateData[l].maxSample=d),this.bitrateData[l].bitrateTotal+=d,this.bitrateData[l].nSamples++},WebRTCVideoBitrateTelemetry.prototype.captureAllocateBandwidth=function(l){if(l){var d=parseInt(l[l.length-1]);this.bitrateData[p.default.MEDIA_DIRECTION.SEND].allocateBW+=d,this.bitrateData[p.default.MEDIA_DIRECTION.SEND].allocateBWSamples+=1}},WebRTCVideoBitrateTelemetry.prototype.getAllocateBandwidthAvg=function(){var l=this.bitrateData[p.default.MEDIA_DIRECTION.SEND].allocateBW,d=this.bitrateData[p.default.MEDIA_DIRECTION.SEND].allocateBWSamples;if(l>0&&d>0)return Math.floor(l/d)},WebRTCVideoBitrateTelemetry}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.CapabilitiesApplicationSequence=void 0;var p=function(){function CapabilitiesApplicationSequence(l,d){this.maxAppliedCapabilitiesCount=d,this.events=[],this.events.push({eventType:\"req\",timestamp:Date.now(),capabilities:l.capabilities,isSimulcast:l.isSimulcastEnabled})}return CapabilitiesApplicationSequence.prototype.setMaxCapabilitiesApplied=function(l){this.events.push({eventType:\"app\",timestamp:Date.now(),capabilities:l.capabilities,error:l.error||\"none\"}),this.maxAppliedCapabilitiesCount&&this.events.length>this.maxAppliedCapabilitiesCount+1&&this.events.splice(1,1)},CapabilitiesApplicationSequence.prototype.getEvents=function(){return this.events},CapabilitiesApplicationSequence}();d.CapabilitiesApplicationSequence=p;var h=function(){function WebRTCVideoMaxCapabilitiesTelemetry(l,d){this.configProvider=l,this.logger=d,this.events=[]}return WebRTCVideoMaxCapabilitiesTelemetry.prototype.setMaxCapabilitesRequested=function(l){var d=new p(l,this.configProvider.config.webrtcLastAppliedVideoCapabilitiesCount);this.events.push({causeId:l.causeId,seq:d}),this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.length>this.configProvider.config.webrtcLastAppliedVideoCapabilitiesSequenceCount&&this.events.shift()},WebRTCVideoMaxCapabilitiesTelemetry.prototype.setMaxCapabilitesApplied=function(l){var d=this.events.find((function(d){return d.causeId===l.causeId}));d?d.seq.setMaxCapabilitiesApplied(l):this.logger.safe.warn(\"Requested capabilities with id \".concat(l.causeId,\" not found\"))},WebRTCVideoMaxCapabilitiesTelemetry.prototype.getEvents=function(){var l=[];return this.events.forEach((function(d){l.push({causeId:d.causeId,events:d.seq.getEvents()})})),l},WebRTCVideoMaxCapabilitiesTelemetry}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(3),h=function(){function WebRTCVideoDelayTelemetry(){this.delayCur=[],this.delayTotal=0,this.delayEventCount=0}return WebRTCVideoDelayTelemetry.prototype.analyzeDelay=function(l,d){if(d&&\"\"!==d){this.delayCur.length===l&&this.delayCur.shift();var u=parseInt(d);this.delayCur.push(u),this.delayTotal+=u,this.delayEventCount+=p.default.TIME_INTERVAL.SEC_1}},WebRTCVideoDelayTelemetry.prototype.getDelayCur=function(){if(this.delayCur.length>0){var l=this.delayCur.reduce((function(l,d){return l+d}))/this.delayCur.length;return l<0?0:l}},WebRTCVideoDelayTelemetry.prototype.getDelayAvg=function(){if(this.delayEventCount>0&&this.delayTotal>0){var l=this.delayTotal/this.delayEventCount;return l<0?0:l}},WebRTCVideoDelayTelemetry}();d.default=h},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(3),g=function(){function WebRTCVideoFreezeTelemetry(l,d){var u=this;this.configProvider=l,this.startTime=d,this.recvTotalFreezeDuration=-1,this.recvFreezeDurations=[],this.recvFreezeIsOngoing=!1,this.recvCurrentFreezeDuration=0,this.recvFreezeCount=0,this.receiveFreezeDurationCounts={},this.longestRecvFreezeDuration=0,this.sendCameraFreezeIntervalsCount=0,this.previousInputFrame=0,this.recvCurrentFreezeStartTimestamp=0,this.receiveFreezeDurationTimestamps={},this.finalFreezeIsOngoing=!1,this.finalRecvCurrentFreezeDuration=0,this.mediaStarted=!1,this.lastBytesRecv=0,this.currentLowBitrateDuration=0,Object.keys(h.default.HISTOGRAM_BATCH).forEach((function(l){u.receiveFreezeDurationCounts[l]=0,u.receiveFreezeDurationTimestamps[l]=[]}))}return WebRTCVideoFreezeTelemetry.prototype.gatherFreezeData=function(l){var d=l.frameRateDecoded,u=l.frameRateRecv,p=l.bytesReceived,g=l.mediaType;if(void 0!==p&&\"ScreenShare\"!==g&&this.configProvider.config.isBytesRecvUsedInIsRenderingCalculation&&!this.configProvider.config.isRenderingBasedOnRawStatistics&&this.calculateBitrate(p),d){var f=parseInt(d[d.length-1],10),m=(null==u?void 0:u.length)>0?parseInt(u[u.length-1],10):void 0;-1===this.recvTotalFreezeDuration&&(this.recvTotalFreezeDuration=0),f>0&&(this.mediaStarted=!0),0!==f&&0!==m||!this.mediaStarted?f>0&&(void 0===m||m>0)&&this.recvFreezeIsOngoing&&this.stopRecvDataGathering(!1):(this.recvFreezeIsOngoing||(this.recvCurrentFreezeStartTimestamp=Date.now()-this.startTime),this.recvFreezeIsOngoing=!0,this.recvCurrentFreezeDuration+=h.default.TIME_INTERVAL.SEC_1,this.recvTotalFreezeDuration+=h.default.TIME_INTERVAL.SEC_1)}},WebRTCVideoFreezeTelemetry.prototype.getIsRendering=function(l){return this.recvCurrentFreezeDuration<l&&this.currentLowBitrateDuration<l&&this.mediaStarted},WebRTCVideoFreezeTelemetry.prototype.detectCaptureFreeze=function(l){if(l){var d=parseInt(l[l.length-1],10);this.previousInputFrame>0&&0===d&&(this.sendCameraFreezeIntervalsCount+=1),this.previousInputFrame=d}},WebRTCVideoFreezeTelemetry.prototype.getSendCameraFreezeIntervals=function(){return this.sendCameraFreezeIntervalsCount>0?this.sendCameraFreezeIntervalsCount:void 0},WebRTCVideoFreezeTelemetry.prototype.stopRecvDataGathering=function(l){void 0===l&&(l=!0),this.finalFreezeIsOngoing=this.recvFreezeIsOngoing,this.recvFreezeIsOngoing=!1,l&&(this.mediaStarted=!1),this.recvCurrentFreezeDuration>0&&(this.populateLongestRecvFreezeDuration(),this.populateRecvFreezeDurationCounts(),this.recvFreezeDurations.push(this.recvCurrentFreezeDuration),this.recvFreezeCount+=1),this.finalRecvCurrentFreezeDuration=this.recvCurrentFreezeDuration,this.recvCurrentFreezeDuration=0},WebRTCVideoFreezeTelemetry.prototype.getRecvFreezeDurationCounts=function(){return this.recvFreezeCount>0?JSON.stringify(this.receiveFreezeDurationCounts):void 0},WebRTCVideoFreezeTelemetry.prototype.getRecvFreezeDurationTimestamps=function(l){var d=this;if(0!==this.recvFreezeCount){var u={};return Object.keys(this.receiveFreezeDurationTimestamps).forEach((function(p){var h=d.receiveFreezeDurationTimestamps[p].length;u[p]=h>l?d.receiveFreezeDurationTimestamps[p].slice(h-l):d.receiveFreezeDurationTimestamps[p]})),JSON.stringify(u)}},WebRTCVideoFreezeTelemetry.prototype.getRecvFreezeIsOngoing=function(l){return this.finalRecvCurrentFreezeDuration>=l&&this.finalFreezeIsOngoing},WebRTCVideoFreezeTelemetry.prototype.getRecvTotalFreezeDuration=function(){return this.recvTotalFreezeDuration>=0?this.recvTotalFreezeDuration:void 0},WebRTCVideoFreezeTelemetry.prototype.getRecvAvgFreezeDuration=function(){if(this.recvTotalFreezeDuration>0&&this.recvFreezeCount>0)return this.recvTotalFreezeDuration/this.recvFreezeCount},WebRTCVideoFreezeTelemetry.prototype.getLongestRecvFreezeDuration=function(){return this.longestRecvFreezeDuration>0?this.longestRecvFreezeDuration:void 0},WebRTCVideoFreezeTelemetry.prototype.populateRecvFreezeDurationCounts=function(){var l,d;try{for(var u=p(Object.keys(h.default.HISTOGRAM_BATCH)),g=u.next();!g.done;g=u.next()){var f=g.value;if(this.recvCurrentFreezeDuration<=h.default.HISTOGRAM_BATCH[f]){this.receiveFreezeDurationCounts[f]+=1,this.receiveFreezeDurationTimestamps[f].push(this.recvCurrentFreezeStartTimestamp);break}}}catch(d){l={error:d}}finally{try{g&&!g.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}this.recvCurrentFreezeStartTimestamp=0},WebRTCVideoFreezeTelemetry.prototype.populateLongestRecvFreezeDuration=function(){this.recvCurrentFreezeDuration>this.longestRecvFreezeDuration&&(this.longestRecvFreezeDuration=this.recvCurrentFreezeDuration)},WebRTCVideoFreezeTelemetry.prototype.calculateBitrate=function(l){var d=125,u=(l-this.lastBytesRecv)/d;this.lastBytesRecv=l,u<this.configProvider.config.notRenderingLowBitrateThreshold?this.currentLowBitrateDuration++:this.currentLowBitrateDuration=0},WebRTCVideoFreezeTelemetry}();d.default=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(3),h=function(){function WebRTCVideoGeneralTelemetry(){var l;this.mediaData=((l={})[p.default.MEDIA_DIRECTION.SEND]={totalMediaDuration:-1,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0},l[p.default.MEDIA_DIRECTION.RECV]={totalMediaDuration:-1,totalFrameCount:0,mediaStartTimestamp:new Date,mediaStarted:!1,timeSinceLastDecode:0,cameraFrameRate:0,lastDecodedFrameTime:-1,fpsHarmonicAverageSumDecFrameDeltaTs:0,fpsHarmonicAverageSumSquareDecFrameDeltaTs:0},l),this.gatheringSendData=!1}return WebRTCVideoGeneralTelemetry.prototype.captureMediaData=function(l,d,u){var h=this.mediaData[l];if(l===p.default.MEDIA_DIRECTION.SEND&&(this.gatheringSendData=!0),d){var g=parseInt(d[d.length-1],10);h.totalFrameCount+=g}if(u){-1===h.totalMediaDuration&&(h.totalMediaDuration=0);var f=parseInt(u[u.length-1],10);h.mediaStarted||f>0&&(h.mediaStarted=!0,h.mediaStartTimestamp=new Date)}if(l===p.default.MEDIA_DIRECTION.RECV){f=u&&parseInt(u[u.length-1],10);var m=Date.now();if(h.lastDecodedFrameTime<0&&(h.lastDecodedFrameTime=m-1e3),f>0){var v=(m-h.lastDecodedFrameTime)/f;h.fpsHarmonicAverageSumDecFrameDeltaTs+=v,h.fpsHarmonicAverageSumSquareDecFrameDeltaTs+=v*v,h.lastDecodedFrameTime=m}}h.mediaStarted&&(h.totalMediaDuration+=p.default.TIME_INTERVAL.SEC_1)},WebRTCVideoGeneralTelemetry.prototype.captureFrameRate=function(l){var d=this.mediaData[p.default.MEDIA_DIRECTION.SEND];if(l){var u=parseInt(l[l.length-1],10);d.cameraFrameRate+=u}},WebRTCVideoGeneralTelemetry.prototype.stopRecvDataGathering=function(){var l=this.mediaData[p.default.MEDIA_DIRECTION.RECV],d=(new Date).getTime();l.timeSinceLastDecode=l.totalMediaDuration>0?Math.round((d-l.mediaStartTimestamp.getTime())/1e3):0,l.mediaStarted=!1},WebRTCVideoGeneralTelemetry.prototype.isGatheringSendData=function(){return this.gatheringSendData},WebRTCVideoGeneralTelemetry.prototype.stopSendDataGathering=function(){var l=this.mediaData[p.default.MEDIA_DIRECTION.SEND],d=new Date;l.timeSinceLastDecode=l.totalMediaDuration>0?Math.round((d.getTime()-l.mediaStartTimestamp.getTime())/1e3):0,this.gatheringSendData=!1,l.mediaStarted=!1},WebRTCVideoGeneralTelemetry.prototype.getAvgFrameRate=function(l){var d=this.mediaData[l];if(d.totalMediaDuration>0&&d.totalFrameCount>0)return d.totalFrameCount/d.totalMediaDuration},WebRTCVideoGeneralTelemetry.prototype.getTotalDuration=function(l){var d=this.mediaData[l];return d.totalMediaDuration>=0?d.totalMediaDuration:void 0},WebRTCVideoGeneralTelemetry.prototype.getRecvFpsHarmonicAverage=function(){var l=this.mediaData[p.default.MEDIA_DIRECTION.RECV];return l.fpsHarmonicAverageSumSquareDecFrameDeltaTs>0?1e3*l.fpsHarmonicAverageSumDecFrameDeltaTs/l.fpsHarmonicAverageSumSquareDecFrameDeltaTs:void 0},WebRTCVideoGeneralTelemetry.prototype.getTimeSinceLastDecode=function(l){var d=this.mediaData[l];return d.timeSinceLastDecode>0?d.timeSinceLastDecode:void 0},WebRTCVideoGeneralTelemetry.prototype.getSendCameraFramerate=function(){var l=this.mediaData[p.default.MEDIA_DIRECTION.SEND];if(l.totalMediaDuration>0)return l.cameraFrameRate/l.totalMediaDuration},WebRTCVideoGeneralTelemetry}();d.default=h},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.KeyFrameEventHistBuilder=d.WebRTCVideoKeyFrameMonitor=void 0;var h=u(3),g=function(){function WebRTCVideoKeyFrameMonitor(l,d){this.configProvider=l,this.logger=d,this.statsBuilder=new f(this.configProvider),this.lastUnansweredRequestReason=\"None\",this.previousKeyFrameData={kfEncoded:0,fir:0,pli:0}}return WebRTCVideoKeyFrameMonitor.prototype.dispose=function(){this.lastUnansweredRequestTimestamp=null,this.lastUnansweredRequestReason=\"None\"},WebRTCVideoKeyFrameMonitor.prototype.setKeyFrameRequested=function(l){this.lastUnansweredRequestTimestamp||(this.lastUnansweredRequestTimestamp=Date.now(),this.lastUnansweredRequestReason=l,this.logger.safe.debug(\"Key frame requested for reason: \".concat(l)))},WebRTCVideoKeyFrameMonitor.prototype.setKeyFrameData=function(l){var d=this.getReasonIfKeyFrameRequested(l);\"None\"!==d&&this.setKeyFrameRequested(d),this.setKeyFramesEncoded(l.kfEncoded),this.previousKeyFrameData=l},WebRTCVideoKeyFrameMonitor.prototype.flush=function(){this.previousKeyFrameData={kfEncoded:0,fir:0,pli:0},this.setKeyFrameSent()},WebRTCVideoKeyFrameMonitor.prototype.getStats=function(){return this.flush(),this.statsBuilder.getStats()},WebRTCVideoKeyFrameMonitor.prototype.getKeyFrameLongestDelay=function(){return this.statsBuilder.keyFrameLongestDelay},WebRTCVideoKeyFrameMonitor.prototype.getReasonIfKeyFrameRequested=function(l){return l.fir-this.previousKeyFrameData.fir>0?\"FIR\":l.pli-this.previousKeyFrameData.pli>0?\"PLI\":\"None\"},WebRTCVideoKeyFrameMonitor.prototype.setKeyFramesEncoded=function(l){l-this.previousKeyFrameData.kfEncoded>0&&this.setKeyFrameSent()},WebRTCVideoKeyFrameMonitor.prototype.setKeyFrameSent=function(){if(\"None\"!==this.lastUnansweredRequestReason){var l={timestamp:this.lastUnansweredRequestTimestamp,reason:this.lastUnansweredRequestReason,duration:(Date.now()-this.lastUnansweredRequestTimestamp)/1e3};l.duration>=1&&(this.statsBuilder.append(l),this.statsBuilder.keyFrameLongestDelay=l.duration,this.logger.safe.debug(\"Key frame sent \".concat(JSON.stringify(l)))),this.lastUnansweredRequestTimestamp=null,this.lastUnansweredRequestReason=\"None\"}},WebRTCVideoKeyFrameMonitor}();d.WebRTCVideoKeyFrameMonitor=g;var f=function(){function KeyFrameEventHistBuilder(l){var d=this;this.configProvider=l,this.hist={},this.timestamps={},this.currentKeyFrameLongestDelay=0,Object.keys(h.default.HISTOGRAM_BATCH).forEach((function(l){d.hist[l]=0,d.timestamps[l]=[]}))}return Object.defineProperty(KeyFrameEventHistBuilder.prototype,\"keyFrameLongestDelay\",{get:function(){return this.currentKeyFrameLongestDelay},set:function(l){this.currentKeyFrameLongestDelay<l&&(this.currentKeyFrameLongestDelay=l)},enumerable:!1,configurable:!0}),KeyFrameEventHistBuilder.prototype.append=function(l){var d,u;try{for(var g=p(Object.keys(h.default.HISTOGRAM_BATCH)),f=g.next();!f.done;f=g.next()){var m=f.value;if(l.duration<=h.default.HISTOGRAM_BATCH[m]){this.hist[m]+=1,this.timestamps[m].push(l.timestamp),this.timestamps[m].length>this.configProvider.config.maxKeyFrameTimestampsInBucket&&this.timestamps[m].shift();break}}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=g.return)&&u.call(g)}finally{if(d)throw d.error}}},KeyFrameEventHistBuilder.prototype.getStats=function(){return{hist:this.hist,ts:this.timestamps}},KeyFrameEventHistBuilder}();d.KeyFrameEventHistBuilder=f},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(1),f={fs:0,fps:1},m=function(){function WebRTCVideoOvershootTelemetry(l){this.logger=l,this.allowed=new Map,this.lastParams=new Map,this.currentEvents=new Map,this.finishedEvents=[]}return WebRTCVideoOvershootTelemetry.prototype.setMaxCapabilities=function(l){var d=this;l.forEach((function(l){if(l.ssrc||0===l.ssrc){d.finishIfActive(l.ssrc),d.allowed.set(l.ssrc,{fs:l.maxFs+f.fs,fps:l.maxFps+f.fps});var u=d.lastParams.get(l.ssrc);u&&d.setCurrentParams(l.ssrc,u.fs,u.fps)}}))},WebRTCVideoOvershootTelemetry.prototype.setCurrentParams=function(l,d,u){this.lastParams.set(l,{fs:d,fps:u});var p=this.getAllowedParams(l);p&&(d>p.fs||u>p.fps)?(this.captureOvershoot(l,u,p.fps,\"fps\"),this.captureOvershoot(l,d,p.fs,\"fs\")):p&&this.finishIfActive(l)},WebRTCVideoOvershootTelemetry.prototype.flush=function(){var l=this;this.currentEvents.forEach((function(d,u){return l.finishIfActive(u)}))},WebRTCVideoOvershootTelemetry.prototype.getEvents=function(){var l=h([],p(g.deepClone(this.finishedEvents)),!1),d=Date.now();return this.currentEvents.forEach((function(u){return u.forEach((function(u){return l.push({ssrc:u.ssrc,timestamp:u.timestamp,duration:d-u.timestamp,overshootType:u.overshootType,amount:u.amount})}))})),l},WebRTCVideoOvershootTelemetry.prototype.captureOvershoot=function(l,d,u,p){var h=this.currentEvents.get(l)||[],g=h.findIndex((function(l){return l.overshootType===p})),m=h[g],v=d-u,y=f[p];v<=y&&m?(m.duration=Date.now()-m.timestamp,this.finishedEvents.push(m),this.logger.debug(\"stopped overshooting \".concat(p,\" by \").concat(m.amount)),h.splice(g,1)):v>y&&!m?(this.logger.safe.info(\"overshooting \".concat(p,\" by \").concat(d-u)),h.push({ssrc:l,timestamp:Date.now(),duration:-1,overshootType:p,amount:{min:v,max:v}})):v>y&&m&&(m.amount={min:Math.min(m.amount.min,v),max:Math.max(m.amount.max,v)}),h.length?this.currentEvents.set(l,h):this.currentEvents.has(l)&&this.currentEvents.delete(l)},WebRTCVideoOvershootTelemetry.prototype.getAllowedParams=function(l){var d=this.allowed.get(l);return d||this.allowed.get(0)},WebRTCVideoOvershootTelemetry.prototype.finishIfActive=function(l){var d=this,u=this.currentEvents.get(l);if(u){var p=Date.now();u.forEach((function(l){l.duration=p-l.timestamp,d.finishedEvents.push(l),d.logger.debug(\"finished overshooting \".concat(l.overshootType,\" by \").concat(l.amount))})),this.currentEvents.delete(l)}},WebRTCVideoOvershootTelemetry}();d.default=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(3),h=function(){function WebRTCVideoQPEvents(){var l;this.qpData=((l={})[p.default.MEDIA_DIRECTION.SEND]={frames:0,qpSum:0},l[p.default.MEDIA_DIRECTION.RECV]={frames:0,qpSum:0},l)}return WebRTCVideoQPEvents.prototype.captureQpData=function(l,d,u){var p=this.qpData[l];if(u&&u.length>0){var h=parseInt(u[u.length-1],10);h>0&&(p.frames=h)}if(d){var g=parseInt(d,10);g>0&&(p.qpSum=g)}},WebRTCVideoQPEvents.prototype.getQpAverage=function(l){var d=this.qpData[l];if(d.qpSum>0&&d.frames>0)return d.qpSum/d.frames},WebRTCVideoQPEvents}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=function(){function WebRTCVideoResolutionTelemetry(){this.resolutionChangedCount=0,this.resDurations={},this.preferredResolutionDurations={},this.preferredResolutions=[]}return Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,\"resolutionSwitchCount\",{get:function(){return this.resolutionChangedCount},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,\"resolutionDurationRatios\",{get:function(){return this.countResolutionDurationRatio(this.resDurations)},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,\"preferredResolutionDurationRatios\",{get:function(){return this.countResolutionDurationRatio(this.preferredResolutionDurations)},enumerable:!1,configurable:!0}),Object.defineProperty(WebRTCVideoResolutionTelemetry.prototype,\"preferredResolution\",{get:function(){return this.preferredResolutions},enumerable:!1,configurable:!0}),WebRTCVideoResolutionTelemetry.prototype.captureSample=function(l){l&&l.width&&l.height&&(this.isResolutionChanged(this.lastResolution,l)&&this.resolutionChanged(l),this.updateResolutionDuration(this.getResolutionKey(l),this.resDurations)),this.lastPreferredResolution&&this.updatePreferredResolutionDurations()},WebRTCVideoResolutionTelemetry.prototype.capturePreferredResolution=function(l,d){var u=this.getResolutionKey(l);this.preferredResolution.includes(u)||(this.preferredResolutions.length>=d&&this.preferredResolutions.shift(),this.preferredResolutions.push(u)),this.isResolutionChanged(this.lastPreferredResolution,l)&&(this.preferredResolutionChanged(l),this.updatePreferredResolutionDurations())},WebRTCVideoResolutionTelemetry.prototype.getResolutionKey=function(l){return\"\".concat(l.width,\"x\").concat(l.height)},WebRTCVideoResolutionTelemetry.prototype.isResolutionChanged=function(l,d){return!l||l.width!==d.width||l.height!==d.height},WebRTCVideoResolutionTelemetry.prototype.countResolutionDurationRatio=function(l){var d={},u=0;for(var h in l)u+=l[h];for(var h in l)d[h]=(0,p.round)(l[h]/u*100,2);return d},WebRTCVideoResolutionTelemetry.prototype.updatePreferredResolutionDurations=function(){this.updateResolutionDuration(this.getResolutionKey(this.lastPreferredResolution),this.preferredResolutionDurations)},WebRTCVideoResolutionTelemetry.prototype.updateResolutionDuration=function(l,d){d[l]||(d[l]=0),d[l]++},WebRTCVideoResolutionTelemetry.prototype.preferredResolutionChanged=function(l){this.lastPreferredResolution=l},WebRTCVideoResolutionTelemetry.prototype.resolutionChanged=function(l){this.lastResolution=l,this.resolutionChangedCount++},WebRTCVideoResolutionTelemetry}();d.default=h},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var g=function(){function WebRTCVideoStreamsCounters(){this.streamsTimers={}}return WebRTCVideoStreamsCounters.prototype.countRecvStreams=function(l){var d=\"\".concat(l);this.streamsTimers.hasOwnProperty(d)||(this.streamsTimers[d]=0),this.streamsTimers[d]++},WebRTCVideoStreamsCounters.prototype.getStreamCounts=function(){var l=this,d={min:void 0,max:void 0,mode:void 0},u=Object.keys(this.streamsTimers).map(Number);return 0===u.length||1===u.length&&0===u[0]||(d.min=Math.min.apply(Math,h([],p(u.filter((function(l){return l>0}))),!1)),d.max=Math.max.apply(Math,h([],p(u),!1)),d.mode=u.reduce((function(d,u){return l.streamsTimers[u]>l.streamsTimers[d]?u:d}),u[0])),d},WebRTCVideoStreamsCounters}();d.default=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function WebRTCVideoSubscriptionEvents(l){this.configProvider=l,this.subscriptionEvents=[]}return WebRTCVideoSubscriptionEvents.prototype.addSubscriptionEvent=function(l){this.subscriptionEvents.length>this.configProvider.config.webrtcSubscriptionEventLimit&&this.subscriptionEvents.shift(),this.subscriptionEvents.push(l)},WebRTCVideoSubscriptionEvents.prototype.getSubscriptionEvents=function(){return this.subscriptionEvents.length>0?{events:this.subscriptionEvents}:void 0},WebRTCVideoSubscriptionEvents}();d.default=p},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},g=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(3),m=u(1),v=u(152),y=Symbol(\"mslbase\"),S=Symbol(\"mslsamples\"),_=function(){function SimulcastStatistics(l,d){this.logger=l,this.configProvider=d,this.currentLayouts={},this.collectedModalitySessions=[],this.startTimestamp=Date.now()}return Object.defineProperty(SimulcastStatistics.prototype,\"collectedSessions\",{get:function(){return this.collectedModalitySessions},enumerable:!1,configurable:!0}),Object.defineProperty(SimulcastStatistics.prototype,\"highestFidelitySSRC\",{get:function(){if(this.currentModalitySession){var l;for(var d in this.currentLayouts)l=this.getHigherFidelitySSRC(d,l);return parseInt(l)}},enumerable:!1,configurable:!0}),SimulcastStatistics.prototype.processStats=function(l){var d,u=this,p=Object.values(null!==(d=l.ssrc)&&void 0!==d?d:{}).filter((function(l){var d;return l.rid&&l.googFrameHeightInput&&(null===(d=u.lastMaxCapabilitiesEvent)||void 0===d?void 0:d.capabilities.some((function(d){return d.rid===l.rid})))})),h=new Map(p.map((function(l){return[\"\".concat(l.ssrc),l.rid]})));for(var g in this.currentLayouts)h.has(g)||this.collectLayout(g);!this.currentModalitySession&&h.size>0&&(this.currentModalitySession={timestamp:Date.now()-this.startTimestamp,duration:0,numLayouts:0,layouts:[]},this.logger.safe.info(\"Modality session started\")),p.forEach((function(l){u.currentLayouts[\"\".concat(l.ssrc)]||u.addLayout(l)})),0===h.size&&this.currentModalitySession&&this.collectSession(),p.forEach((function(l){return l&&u.processLayoutData(l)}))},SimulcastStatistics.prototype.setMaxCapabilities=function(l,d){var u,g;if(this.lastMaxCapabilitiesEvent=l,Object.keys(this.currentLayouts).length){var _loop_1=function(u){var h=Object.values(f.currentLayouts).find((function(l){return l.rid===u.rid}));h&&(d?(m.arrayPushFixedSize(h.fmtp,p(p({},u),{timestamp:Date.now()-f.startTimestamp-f.currentModalitySession.timestamp-h.timestamp,causeId:l.causeId}),f.configProvider.config.simulcastTelemetryNumFMTP),h.gatherer.setMaxCapabilitesApplied(l)):h.gatherer.setMaxCapabilitesRequested(l),h.gatherer.setMaxCapabilitiesOvershoot([u]),h.gatherer.setKeyFrameRequested(u.keyframe))},f=this;try{for(var v=h(l.capabilities),y=v.next();!y.done;y=v.next()){_loop_1(y.value)}}catch(l){u={error:l}}finally{try{y&&!y.done&&(g=v.return)&&g.call(v)}finally{if(u)throw u.error}}}},SimulcastStatistics.prototype.finish=function(){for(var l in this.currentLayouts)this.collectLayout(l);this.currentModalitySession&&this.collectSession()},SimulcastStatistics.prototype.addLayout=function(l){var d,u,h=\"\".concat(l.ssrc),g=l.rid,f=null===(u=this.lastMaxCapabilitiesEvent)||void 0===u?void 0:u.capabilities.find((function(l){return l.rid===g}));this.logger.safe.info(\"Adding layout for ssrc \".concat(h,\" rid \").concat(g));var m=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp,_=new v.default(m,this.configProvider,this.logger.createChild(\"Telemetry#\".concat(h)));this.currentLayouts[h]=((d={ssrc:l.ssrc,rid:g,fmtp:[p(p({},f),{timestamp:m,causeId:this.lastMaxCapabilitiesEvent.causeId})],timestamp:m,duration:0,gatherer:_})[y]={firCount:l.googFirsReceived,nackCount:l.googNacksReceived,pliCount:l.googPlisReceived,framesEncoded:l.framesEncoded,bytesSent:l.bytesSent,packetsSent:l.packetsSent,packetsLost:l.packetsLost,qpSum:l.qpSum},d[S]={firCount:[],nackCount:[],pliCount:[],framesEncoded:[],bytesSent:[],packetsSent:[],packetsLost:[],qpSum:[],frameHeightInput:[],frameHeightSent:[],frameRateInput:[],frameRateSent:[]},d),_.setMaxCapabilitiesOvershoot([f]),_.setKeyFrameRequested(f.keyframe),this.currentModalitySession.numLayouts++},SimulcastStatistics.prototype.processLayoutData=function(l){var d=\"\".concat(l.ssrc),u=this.currentLayouts[d];this.processMediaStats(u,l),u.gatherer.captureMediaData(f.default.MEDIA_DIRECTION.SEND,[String(l.googFrameRateSent)],[String(l.framesEncoded)]),u.gatherer.captureFrameRate([String(l.googFrameRateInput)]),u.gatherer.captureQpData(f.default.MEDIA_DIRECTION.SEND,String(l.qpSum),[String(l.framesEncoded)]),u.gatherer.captureBitrateSample(f.default.MEDIA_DIRECTION.SEND,l.bytesSent),u.gatherer.detectCaptureFreeze([String(l.googFrameRateInput)]),u.gatherer.setCurrentParameters(l.ssrc,{width:l.googFrameWidthSent,height:l.googFrameHeightSent},l.googFrameRateSent);var p={kfEncoded:parseInt(String(l.keyFramesEncoded)),fir:parseInt(String(l.googFirsReceived)),pli:parseInt(String(l.googPlisReceived))};u.gatherer.setKeyFrameData(p)},SimulcastStatistics.prototype.processMediaStats=function(l,d){var u=l[y],p=d.googFirsReceived-u.firCount,h=d.googNacksReceived-u.nackCount,g=d.googPlisReceived-u.pliCount,f=d.framesEncoded-u.framesEncoded,v=d.bytesSent-u.bytesSent,_=d.packetsSent-u.packetsSent,C=d.packetsLost-u.packetsLost,E=d.qpSum-u.qpSum,T=l[S],b=this.configProvider.config.webrtcStatStoredRecordsNumber;m.arrayPushFixedSize(T.firCount,p,b),m.arrayPushFixedSize(T.nackCount,h,b),m.arrayPushFixedSize(T.pliCount,g,b),m.arrayPushFixedSize(T.framesEncoded,f,b),m.arrayPushFixedSize(T.bytesSent,v,b),m.arrayPushFixedSize(T.packetsSent,_,b),m.arrayPushFixedSize(T.packetsLost,C,b),m.arrayPushFixedSize(T.qpSum,E,b),m.arrayPushFixedSize(T.frameHeightInput,d.googFrameHeightInput,b),m.arrayPushFixedSize(T.frameHeightSent,d.googFrameHeightSent,b),m.arrayPushFixedSize(T.frameRateInput,d.googFrameRateInput,b),m.arrayPushFixedSize(T.frameRateSent,d.googFrameRateSent,b)},SimulcastStatistics.prototype.collectLayout=function(l){this.logger.safe.info(\"Collecting layout for ssrc \".concat(l)),this.currentLayouts[l].duration=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp-this.currentLayouts[l].timestamp,this.currentLayouts[l].gatherer.isSendGathering()&&this.currentLayouts[l].gatherer.stopSendGathering();var d=this.currentLayouts[l].gatherer.getReport(f.default.MEDIA_DIRECTION.SEND,\"\",!1);for(var u in d)this.currentLayouts[l][u]=d[u];for(var u in this.currentLayouts[l][S])this.currentLayouts[l][u]=m.sampleseries(this.currentLayouts[l][S][u],(function(l){return l}));delete this.currentLayouts[l].gatherer,m.arrayPushFixedSize(this.currentModalitySession.layouts,this.currentLayouts[l],this.configProvider.config.simulcastTelemetryLayoutsPerSession),delete this.currentLayouts[l]},SimulcastStatistics.prototype.collectSession=function(){for(var l in this.logger.safe.info(\"Collecting session\"),this.currentLayouts)this.collectLayout(l);this.currentModalitySession.duration=Date.now()-this.startTimestamp-this.currentModalitySession.timestamp,m.arrayPushFixedSize(this.collectedModalitySessions,this.currentModalitySession,this.configProvider.config.simulcastTelemetryNumModalitySessions),this.currentModalitySession=void 0,this.lastMaxCapabilitiesEvent=void 0},SimulcastStatistics.prototype.getHigherFidelitySSRC=function(l,d){var u,p;if(!l||!d)return l||d;var h=g(this.currentLayouts[l].fmtp.slice(-1),1)[0],f=g(this.currentLayouts[d].fmtp.slice(-1),1)[0];return(null!==(u=null==h?void 0:h.maxMbps)&&void 0!==u?u:0)>0&&(null!==(p=null==f?void 0:f.maxMbps)&&void 0!==p?p:0)>0?h.maxMbps>f.maxMbps?l:d:l||d},SimulcastStatistics}();d.default=_},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(15),h=u(410),g=u(154),f=u(412),m=function(){function UnifiedPlanAdapter(l){this.RTCPeerConnection=p.default.window.RTCPeerConnection,this.RTCSessionDescription=f.SessionDescriptionAdapter,this.SdpTransform=h.UnifiedPlanSdpTransform,this.RTCRtpReceiver=g.default.build(l)}return UnifiedPlanAdapter}();d.default=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.UnifiedPlanSdpTransform=void 0;var p=u(1),h=u(411),g=function(){function UnifiedPlanSdpTransform(l){this.context=l,this.cname=p.uniqueId()}return UnifiedPlanSdpTransform.prototype.toLocal=function(l,d,u){return this.modify({sdpSource:0,sdpType:u},l,d)},UnifiedPlanSdpTransform.prototype.toOffer=function(l,d,u){return this.modify({sdpSource:1,sdpType:\"offer\"},l,d,u)},UnifiedPlanSdpTransform.prototype.toAnswer=function(l,d,u){return this.modify({sdpSource:1,sdpType:\"answer\"},l,d,u)},UnifiedPlanSdpTransform.prototype.toRemote=function(l,d,u,p){return this.modify({sdpSource:2,sdpType:p},l,d,u)},UnifiedPlanSdpTransform.prototype.modify=function(l,d,u,g){var f=new h.SdpModifiersChainBuilder(this.context,u,g,this.cname).build(l),m=p.deepClone(d);return f.modify(m),m},UnifiedPlanSdpTransform}();d.UnifiedPlanSdpTransform=g},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SdpModifiersChainBuilder=void 0;var h=u(66),g=function(){function SdpModifiersChain(l){this.modifierList=l}return SdpModifiersChain.prototype.modify=function(l){var d,u;try{for(var h=p(this.modifierList),g=h.next();!g.done;g=h.next()){g.value.modify(l)}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}},SdpModifiersChain}(),f=function(){function SdpModifiersChainBuilder(l,d,u,p){this.context=l,this.mediaManager=d,this.modalities=u,this.cname=p}return SdpModifiersChainBuilder.prototype.build=function(l){switch(l.sdpSource){case 0:return new g([new h.InjectH264SpsPpsIdrInKeyframe(this.context.configProvider),new h.RemoveExtmapAllowMixed(this.context.configProvider),new h.AddVLAHeaderExtension(this.mediaManager,this.context.configProvider),new h.AddMsidFixup(this.mediaManager),new h.FilterCodecs(this.mediaManager,this.context.configProvider,l.sdpType)]);case 2:return new g([new h.DisabledMediaFixup(this.mediaManager,this.modalities),new h.RemoveMsRTCAttributes,new h.RollbackEntitiesFixup(this.mediaManager,!0),new h.NoBundleInAnswerFixup(this.context.configProvider,this.mediaManager),new h.SendOnlyModalityFixup(this.modalities),new h.NoAudioFixup,new h.ComfortNoiseFixup,new h.G722Fixup,new h.InOpusEnforcedFmtp(this.context.configProvider),new h.RemoveH264ParamsModifier(this.context.configProvider),new h.InSdpReceiveSsrcFixup,new h.IncomingSrtpFixup(this.context),new h.SimulcastFromMsSDPMediaFixup(this.mediaManager),new h.AddExtmapAllowMixed(this.context.configProvider),new h.ExtUriNormalizer,new h.RemoveNonAdvVLADecoratorExtension(this.context.configProvider),new h.RemoveVLAHeaderExtension(this.context.configProvider),new h.RemoveLabelsModifier,new h.InSdpBandwidthModifier(this.mediaManager,this.modalities,this.context.configProvider),new h.IncomingDataModalityFixup(this.context),new h.PartialIceRestartFixup(this.context.configProvider),new h.AddVideoOrientationExtension(this.context.configProvider),new h.FilterCodecs(this.mediaManager,this.context.configProvider,l.sdpType),new h.InjectTransportCCAudio(this.context.configProvider,this.context.getLogger()),new h.BundleGroupModifier(this.context.configProvider)]);case 1:return new g([new h.OutgoingDataModalityFixup(this.context,this.modalities.data),new h.RollbackEntitiesFixup(this.mediaManager,!1),new h.OutSdpBandwidthModifier(this.context.configProvider),new h.DisabledMediaFixup(this.mediaManager,this.modalities),new h.AddLabelsModifier(this.mediaManager),new h.ComfortNoiseFixup,new h.OutgoingDtlsRoleModifier(this.mediaManager,\"offer\"===l.sdpType,this.context.configProvider),new h.SimulcastToMsSDPMediaFixup(this.mediaManager,this.context.getLogger()),new h.AddNonAdvVLADecoratorExtension(this.context.configProvider),new h.OutSdpReceiveSsrcFixup(this.context.config.isConference,this.cname),new h.IceRestartChecker(this.mediaManager),new h.ExtensionsFixup,new h.RemoveH264SpsPpsIdrInKeyframe(this.context.configProvider),new h.RemoveVideoOrientationExtension(this.context.configProvider),new h.BundleGroupModifier(this.context.configProvider)])}},SdpModifiersChainBuilder}();d.SdpModifiersChainBuilder=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SessionDescriptionAdapter=void 0;var p=u(15),h=function(){function SessionDescriptionAdapter(l){this.originalDescription=new p.default.window.RTCSessionDescription(l)}return Object.defineProperty(SessionDescriptionAdapter.prototype,\"sdp\",{get:function(){return this.originalDescription.sdp},set:function(l){this.originalDescription=new p.default.window.RTCSessionDescription({sdp:l,type:this.originalDescription.type})},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDescriptionAdapter.prototype,\"type\",{get:function(){return this.originalDescription.type},set:function(l){this.originalDescription=new p.default.window.RTCSessionDescription({sdp:this.originalDescription.sdp,type:l})},enumerable:!1,configurable:!0}),SessionDescriptionAdapter.prototype.toJSON=function(){return this.originalDescription.toJSON()},SessionDescriptionAdapter}();d.SessionDescriptionAdapter=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebkitAdapter=void 0;var p=u(414),h=u(154),g=u(415),f=u(155),m=function(){function WebkitAdapter(l){var d=l.configProvider.config.useSdpCapabilities;this.RTCRtpReceiver=h.default.build(l,d),this.SdpTransform=p.WebkitSdpTransform,this.RTCPeerConnection=g.default.build(this.RTCRtpReceiver),this.RTCSessionDescription=f.default.build()}return WebkitAdapter}();d.WebkitAdapter=m},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebkitSdpTransform=void 0;var g=u(1),f=u(3),m=u(9),v=u(39),y=u(66),S=101,_=[48e3,32e3,24e3,16e3,12e3],C=function(){function WebkitSdpTransform(l){this.context=l,this.cname=g.uniqueId(),this.dataMedia={type:f.default.MEDIA_TYPE.data,protocol:f.default.PROFILES.rtpSavp,port:0},this.configProvider=l.configProvider,this.logger=l.getLogger().createChild(\"WebkitSdpTrans\")}return WebkitSdpTransform.prototype.fixTelephoneEvent=function(l){var d;return _.forEach((function(d){v.removeCodec(l,{codec:\"telephone-event\",rate:d})})),v.updatePayload(l,S,999),v.forCodec(l,{name:\"telephone-event\",rate:8e3},(function(l){return d=l.rtp.payload,l.rtp.payload=S,l})),v.updatePayload(l,999,d||S),d},WebkitSdpTransform.prototype.toLocal=function(l,d,u){var p,h=this,f=d.isEmpty(),_=g.deepClone(l);return _.media.forEach((function(l){if(\"audio\"===l.type)f&&(p=h.fixTelephoneEvent(l)),fixComfortNoise(l);else{p&&v.updatePayload(l,S,p);var g=d.getLocalSsrcs().get(v.getModality(l));h.enforceFixedSsrc(l,g)}var y=m.getAllowedCodecs(h.configProvider,l.type);\"offer\"===u&&filterCodecs(l,y,f,h.logger)})),new y.InjectH264SpsPpsIdrInKeyframe(this.configProvider).modify(_),delete _.extmapAllowMixed,_},WebkitSdpTransform.prototype.toOffer=function(l,d,u){return this.fromNative(l,d,u,!0)},WebkitSdpTransform.prototype.toAnswer=function(l,d,u){return this.fromNative(l,d,u,!1)},WebkitSdpTransform.prototype.toRemote=function(l,d,u,p){var h,y,S=g.deepClone(l),_=this.configProvider.mediaConfig.maxBandwidthInKbps;S.bandwidth&&(!_||_>l.bandwidth[0].limit)&&(_=l.bandwidth[0].limit),S.media.forEach((function(l,u){d.getMediaEntity(u).isDisabled()&&l.type!==f.default.MEDIA_TYPE.audio&&(l.port=0)}));var C=getBundle(S);if(!C){var E=!1;S.media.forEach((function(l,u){var p=d.getMediaEntity(u);!E&&p.isEnabled()?(l.mid=p.getMid(),E=!0):(p.disable(),l.port=0)})),E&&(S.groups||(S.groups=[]),C={type:\"BUNDLE\"},S.groups.push(C))}S.media.forEach((function(l){var d=v.getModality(l);u[d]===f.default.MEDIA_STATE.send&&(l.direction&&l.direction.toLowerCase()===f.default.MEDIA_STATE.receive||(l.direction=f.default.MEDIA_STATE.receive))}));var T=S.media.filter((function(l){return l.type===f.default.MEDIA_TYPE.video}));if(T.length>0){var b=T.filter((function(l){return 0!==l.port}));if(b.length>0){(y=g.deepClone(b[0])).bandwidth&&delete y.bandwidth;var I=this.configProvider.config.audioBandwidthInKbps?this.configProvider.config.audioBandwidthInKbps:0;_&&_-I>0&&(y.bandwidth=[{limit:_-I,type:\"AS\"}]),y.mid=\"video\",y.direction=null,delete y.label,y.ssrcs=[],y.ssrcGroups=[],delete y.msid,b.forEach((function(l){l.ssrcs&&(y.ssrcs=y.ssrcs.concat(l.ssrcs)),l.ssrcGroups&&(y.ssrcGroups=y.ssrcGroups.concat(l.ssrcGroups)),y.direction=mergeDirections(y.direction,l.direction||f.default.MEDIA_STATE.sendReceive)})),removeUnifiedPlanExtensions(y)}else y=disabledMedia(f.default.MEDIA_TYPE.video,void 0,T[0].protocol,T[0].payloads)}var A=S.media.find((function(l){return l.type===f.default.MEDIA_TYPE.audio}));if(A)if(0!==A.port)(h=g.deepClone(A)).mid=\"audio\",delete h.label,removeG722Codec(h),fixComfortNoise(h),removeUnifiedPlanExtensions(h);else{h=disabledMedia(f.default.MEDIA_TYPE.audio,void 0,A.protocol,A.payloads);var R=S.media.find((function(l){return!!l.iceUfrag}));R&&(h.port=9,h.direction=\"inactive\",h.mid=\"audio\",h.iceUfrag=R.iceUfrag,h.icePwd=R.icePwd,h.rtcpMux=\"rtcp-mux\",R.crypto&&(h.crypto=R.crypto),R.fingerprint&&(h.fingerprint=R.fingerprint,h.setup=R.setup),h.rtp=[{payload:0,codec:\"PCMU\",rate:8e3}],h.payloads=\"0\")}S.media.forEach((function(l,d){l.type===f.default.MEDIA_TYPE.data&&(l.type=f.default.MEDIA_TYPE.dataChannel,l.payloads=f.default.PAYLOAD_TYPE.DATA_CHANNEL,l.protocol=f.default.PROFILES.udpDtlsSctp,l.mid=\"data\",delete l.xDataProtocol,delete l.direction,0===l.port&&(S.media[d]=disabledMedia(l.type,void 0,l.protocol,l.payloads)))}));var P=m.allowDataChannel(this.context)?S.media.find((function(l){return l.type===f.default.MEDIA_TYPE.dataChannel})):null;S.media=[h,y,P].filter((function(l){return l})),d.getMediaEntities()[0].getModality()!==f.default.MODALITY.audio&&S.media.reverse();var O=m.preferSdesSrtp(this.context),M=m.getSrtpInfo(l);return S.media.forEach((function(l){l.type!==f.default.MEDIA_TYPE.dataChannel&&(!O&&l.fingerprint&&l.crypto&&delete l.crypto,l.protocol=!M.dtls||M.sdes&&O?f.default.PROFILES.rtpSavpf:f.default.PROFILES.udpTlsRtpSavpf)})),\"offer\"===p&&(filterCodecs(h,this.configProvider.config.allowedAudioCodecs,!1,this.logger),filterCodecs(y,this.configProvider.config.allowedVideoCodecs,!1,this.logger)),fixBundling(S,this.configProvider.mediaConfig.isTransportUnbundled),S},WebkitSdpTransform.prototype.splitMedia=function(l,d,u,m,y){var S=this,_=l.getMid(),C=l.getModality(),E=g.deepClone(d);if(E.label=v.getLabelForModality(C),E.direction=m,E.mid=_,E.ssrcs=[],E.ssrcGroups=[],l.getModality()===f.default.MODALITY.data)return E.type=f.default.MEDIA_TYPE.data,E.payloads=f.default.PAYLOAD_TYPE.X_DATA,E;var T=u.filter((function(l){return l.modality===C}));if(T&&T.length){var b=[];d.ssrcs&&(T.forEach((function(l){var u=d.ssrcs.filter((function(d){return\"msid\"===d.attribute&&l.trackId===getTrackId(d.value)})).map((function(l){return l.id}));b.push.apply(b,h([],p(u),!1))})),E.ssrcs=d.ssrcs.filter((function(l){return b.indexOf(l.id)>-1})),E.ssrcs.forEach((function(l){\"cname\"===l.attribute&&(l.value=S.cname)}))),d.ssrcGroups&&(E.ssrcGroups=d.ssrcGroups.filter((function(l){return l.ssrcs.split(\" \").find((function(l){return b.indexOf(+l)>-1}))})))}else{if(m===f.default.MEDIA_STATE.send||m===f.default.MEDIA_STATE.sendReceive)return disabledMedia(d.type,v.getLabelForModality(C),d.protocol,d.payloads);m!==f.default.MEDIA_STATE.receive&&m!==f.default.MEDIA_STATE.inactive||(y[d.type].ssrcs&&y[d.type].ssrcs[0]?E.ssrcs=[{id:y[d.type].ssrcs[0].id,attribute:\"cname\",value:this.cname}]:d.type===f.default.MEDIA_TYPE.audio?E.ssrcs=[{id:4195875351,attribute:\"cname\",value:this.cname}]:d.type===f.default.MEDIA_TYPE.video&&(E.ssrcs=[{id:1,attribute:\"cname\",value:this.cname}]))}return E},WebkitSdpTransform.prototype.fromNative=function(l,d,u,p){var h=this,m=g.deepClone(l),S=this.configProvider.mediaConfig.maxBandwidthInKbps;S&&(m.bandwidth=[{limit:S,type:\"CT\"}]),new y.RemoveH264SpsPpsIdrInKeyframe(this.configProvider).modify(m);var _=m.media.find((function(l){return l.type===f.default.MEDIA_TYPE.audio})),C=m.media.find((function(l){return l.type===f.default.MEDIA_TYPE.video})),E=m.media.find((function(l){return l.type===f.default.MEDIA_TYPE.dataChannel})),T={};T[f.default.MODALITY.audio]=_,T[f.default.MODALITY.video]=C,T[f.default.MODALITY.sharing]=C,T[f.default.MODALITY.data]=E||this.dataMedia;var b={};b[f.default.MEDIA_TYPE.audio]=_,b[f.default.MEDIA_TYPE.video]=C,b[f.default.MEDIA_TYPE.data]=E||this.dataMedia;var I={};return I[f.default.MODALITY.audio]=d.getMediaEntitiesByModality(f.default.MODALITY.audio)[0],I[f.default.MODALITY.video]=d.getMediaEntitiesByModality(f.default.MODALITY.video)[0],I[f.default.MODALITY.sharing]=d.getMediaEntitiesByModality(f.default.MODALITY.sharing)[0],I[f.default.MODALITY.data]=d.getMediaEntitiesByModality(f.default.MODALITY.data)[0],m.media=[],d.getMediaEntities().forEach((function(l){var g,y=u[l.getModality()];!l.isEnabled()||0===T[l.getModality()].port||l!==I[l.getModality()]&&y===f.default.MEDIA_STATE.send?(g=disabledMedia(l.getType(),v.getLabelForModality(l.getModality()),T[l.getModality()].protocol,T[l.getModality()].payloads),T[l.getModality()].payloads===f.default.PAYLOAD_TYPE.DATA_CHANNEL&&(g.payloads=f.default.PAYLOAD_TYPE.DATA_CHANNEL)):(y!==f.default.MEDIA_STATE.inactive&&l!==I[l.getModality()]&&(y=f.default.MEDIA_STATE.receive),g=h.splitMedia(l,T[l.getModality()],d.getLocalTracksInfo(),y,b),l!==I[l.getModality()]&&(g.candidates=[]));var S=T[l.getModality()].setup;S&&(\"actpass\"!==S?l.setExtension(\"setup\",S):p&&void 0!==l.getExtension(\"setup\")&&(g.setup=\"actpass\"!==l.getExtension(\"setup\")?l.getExtension(\"setup\"):S));var _=T[l.getModality()].iceUfrag,C=l.getExtension(\"iceUfrag\");l.setExtension(\"iceRestart\",!!_&&!!C&&C!==_),l.setExtension(\"iceUfrag\",_),0===g.port&&l.disable(),m.media.push(g)})),new y.OutgoingDataModalityFixup(this.context,u.data).modify(m),fixBundling(m,this.configProvider.mediaConfig.isTransportUnbundled),m},WebkitSdpTransform.prototype.enforceFixedSsrc=function(l,d){var u=this,p=-1;if(l.ssrcs){var h=[];if(l.ssrcs.forEach((function(l){\"msid\"===l.attribute&&h.push({ssrc:l.id,trackId:getTrackId(l.value)})})),l.ssrcs.forEach((function(l){\"cname\"===l.attribute&&p++,d&&(l.id=u.getVideoSSRC(p,d))})),l.ssrcGroups){var g=l.ssrcs.filter((function(l){return\"cname\"===l.attribute})).map((function(l){return l.id}));l.ssrcGroups.forEach((function(l,d){l.ssrcs=[g[2*d],g[2*d+1]].join(\" \")}))}}},WebkitSdpTransform.prototype.getVideoSSRC=function(l,d){return l%2==1?d+50:d},WebkitSdpTransform}();function removeG722Codec(l){v.removeCodec(l,{codec:\"g722\",rate:8e3,encoding:2})}function removeUnifiedPlanExtensions(l){var d=new Set([\"urn:ietf:params:rtp-hdrext:sdes:mid\",\"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id\",\"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id\"]);l.ext&&(l.ext=l.ext.filter((function(l){return!d.has(l.uri)})))}function fixComfortNoise(l){v.removeCodec(l,{codec:\"CN\",rate:16e3})}function getBundle(l){return l.groups?l.groups.find((function(l){return\"BUNDLE\"===l.type})):null}function fixBundling(l,d){var u,p=null===(u=l.groups)||void 0===u?void 0:u.findIndex((function(l){return\"BUNDLE\"===l.type})),h=l.groups?l.groups[p]:void 0;h&&(d?(h.mids=l.media.filter((function(l){return l.type===f.default.MEDIA_TYPE.video})).map((function(l){return l.mid})).filter((function(l){return l})).join(\" \"),h.mids||delete l.groups[p]):h.mids=l.media.map((function(l){return l.mid})).filter((function(l){return l})).join(\" \"))}function disabledMedia(l,d,u,p){return{type:l,port:0,label:d,payloads:p,protocol:u}}function getTrackId(l){return l.split(\" \")[1]}function mergeDirections(l,d){return l===f.default.MEDIA_STATE.sendReceive||d===f.default.MEDIA_STATE.sendReceive?f.default.MEDIA_STATE.sendReceive:l===d?l:l&&d&&l!==d?f.default.MEDIA_STATE.sendReceive:l||d}function filterCodecs(l,d,u,p){if(d.length&&(null==l?void 0:l.port)){var h=m.convertToCodecInfo(d);v.filterCodecs(l,h,u,p)}}d.WebkitSdpTransform=C},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(47),h=u(42),g=u(15),f=u(1),m=u(39),v=u(155),y=[{name:\"telephone-event\",rate:8e3},{name:\"cn\",rate:16e3}];function PeerConnection(l){var d=[],u=v.default.build(),S=[].slice.apply(arguments);S.splice(0,1,null),overrideSetting(\"iceTransportPolicy\",\"iceTransports\");var _=new(Function.prototype.bind.apply(g.default.window.webkitRTCPeerConnection,S));function overrideSetting(l,d){S[1]&&S[1][l]&&(S[1][d]=S[1][l])}function shim(){shimPromises(),shimSetRemoteDescription(),shimCreateAnswer(),shimCreateOffer(),shimSenders()}function shimPromises(){[{name:\"createOffer\",reverseArgs:!0},\"createAnswer\",\"setRemoteDescription\",\"setLocalDescription\"].forEach((function(l){var d=l.name||l,u=_[d];_[d]=function(){var d=arguments;return new Promise((function(p,h){var g=[p,h];d.length>0&&g.splice(l.reverseArgs?g.length:0,0,d[0]),u.apply(_,g)}))}}))}function Sender(l,d){var u;Object.defineProperty(this,\"dtmf\",{get:function(){return\"audio\"===l.kind?u=u||_.createDTMFSender(l):null}}),this.track=l,this._stream=d}function shimSenders(){_.getSenders&&_.addTrack&&_.removeTrack||(_.getSenders=function(){return d.slice()},_.addTrack=function(l,u){if(!l||!u)throw new Error(\"both media track and stream need to be provided\");_.getLocalStreams().some((function(l){return l.id===u.id}))||_.addStream(u);var p=d.find((function(d){return d.track.id===l.id}));return p||(p=new Sender(l,u),d.push(p)),p},_.removeTrack=function(l){_.getLocalStreams().filter((function(d){return d.id===l._stream.id})).forEach((function(l){_.removeStream(l)})),f.remove(d,(function(d){return d===l}))})}function shimCreateOffer(){var l=_.createOffer;_.createOffer=function(d){var u=arguments;return d&&d.offerToReceiveVideo>1&&(d.offerToReceiveVideo=1),l.apply(_,u)}}function shimSetRemoteDescription(){[\"createOffer\",\"createAnswer\",\"setLocalDescription\"].forEach((function(d){var u=_[d];_[d]=function(){var d=arguments;return l.getCapabilities(\"video\").then((function(){return u.apply(u,d)}))}}));var d=_.setRemoteDescription;_.setRemoteDescription=function(u){return l.getCapabilities(\"video\").then((function(l){var h=l.codecs,g=p.parse(u.sdp);return g.media.forEach((function(l){\"video\"===l.type&&(l.rtp.some((function(l){return h.some((function(d){return l.codec.toLowerCase()===d.mimeType}))}))?suppressH264FormatParameters(l):l.port=0);if(!hasDtls(l)){var d=m.getBundle(g);d?l.crypto=d.crypto:l.port||g.media.some((function(d){return!!d.port&&(l.crypto=d.crypto,!0)}))}})),u.sdp=p.write(g),d(u)}))}}function shimCreateAnswer(){var l=_.createAnswer;_.createAnswer=function(){var d=arguments;return l.apply(_,d).then((function(l){if(!_.localDescription||!_.localDescription.sdp)return l;var d=p.parse(_.localDescription.sdp),h=[];if(d.media.forEach((function(l){y.forEach((function(d){m.forCodec(l,d,(function(l){h.push(l)}))}))})),h.length){var g=p.parse(l.sdp),f=!1;g.media.forEach((function(l){h.forEach((function(d){m.forCodec(l,{name:d.rtp.codec,rate:d.rtp.rate},(function(l){l.rtp.payload!==d.rtp.payload&&(l.rtp.payload=d.rtp.payload,f=!0)}))}))})),f&&(l=new u({type:l.type,sdp:p.write(g)}))}return l}))}}function suppressH264FormatParameters(l){m.forCodec(l,{name:\"h264\",rate:9e4},(function(l){if(l.fmtp){var d=h.default.build(),u=h.default.build(l.fmtp.config);[\"level-asymmetry-allowed\",\"packetization-mode\",\"profile-level-id\"].forEach((function(l){if(u.contains(l)){var p=u.get(l);\"profile-level-id\"===l&&(p=\"42C02A\"),d.setIfMissing(l,p)}})),l.fmtp.config=d.toString()}}))}function hasDtls(l){return\"RTP/SAVPF\"!==l.protocol}return shim(),_}d.default={build:function(l){return PeerConnection.bind(null,l)}}},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},g=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},f=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},m=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.AdaptiveCapablitiesHandler=void 0;var v=u(30),y=u(49),S=u(127),_=u(1),C=u(3),E=u(417),T=function(){function AdaptiveCapablitiesHandler(l,d,u,p,h,g,f){this.listener=l,this.statisticsGatherer=d,this.diagnostics=u,this.logger=p,this.configProvider=h,this.isSimulcastEnabled=f,this.serialQueue=new v.PromiseQueue(this.logger),this.modality=C.default.MODALITY.video;var m=g.maxResolution?{maxFs:g.maxResolution.fs}:null;this.validator=new S.VideoCapabilitiesValidator(this.logger.createChild(\"CapsValidator\"),m),this.resolutionManager=new E.ResolutionManager(g,this,this.statisticsGatherer,this.logger.createChild(\"rm\"),h)}return AdaptiveCapablitiesHandler.prototype.setMaxCapabilities=function(l,d){var u;return f(this,void 0,void 0,(function(){var h,g;return m(this,(function(f){switch(f.label){case 0:return h={modality:this.modality,causeId:l,capabilities:d,isSimulcastEnabled:this.isSimulcastEnabled},this.statisticsGatherer.onMaxCapabilitiesRequested(h),null===(u=this.diagnostics)||void 0===u||u.onMaxCapabilitiesRequested(h),this.causeId=l,g=this.validator.ensureValidity(d[0]),this.streamSenderParams=p(p({},d[0]),g),this.resolutionManager.setMaxResolution(this.streamSenderParams.maxFs),this.configProvider.mediaConfig.simulcastSessionEnabled?[4,this.applyCapabilities(this.getParamsToApply())]:[3,2];case 1:f.sent(),f.label=2;case 2:return[2]}}))}))},AdaptiveCapablitiesHandler.prototype.resetCurrentResolution=function(){this.resolutionManager.resetCurrentResolution()},AdaptiveCapablitiesHandler.prototype.getCurrentResolution=function(){return this.resolutionManager.getCurrentResolution()},AdaptiveCapablitiesHandler.prototype.setCurrentResolution=function(l){this.resolutionManager.setCurrentResolution(l)},AdaptiveCapablitiesHandler.prototype.onResolutionChanged=function(l){return f(this,void 0,void 0,(function(){return m(this,(function(d){return[2,this.applyCapabilities(this.getParamsToApply(l))]}))}))},AdaptiveCapablitiesHandler.prototype.dispose=function(){this.resolutionManager.dispose(),this.resolutionManager=null},AdaptiveCapablitiesHandler.prototype.applyCapabilities=function(l){return f(this,void 0,void 0,(function(){return m(this,(function(d){return l?this.lastAppliedSenderParams===l?(this.logger.safe.info(\"Capabilities already applied: \".concat(JSON.stringify(l))),[2,!0]):(this.logger.safe.info(\"Capabilities to apply: \".concat(JSON.stringify(l))),this.lastAppliedSenderParams=l,[2,this.listener.onReceiveCapabilitiesChanged(this.modality,this.causeId,[l])]):(this.logger.safe.error(\"Send capabilities are not set. Cannot apply constraints\"),[2,!1])}))}))},AdaptiveCapablitiesHandler.prototype.getParamsToApply=function(l){if(!this.streamSenderParams)return null;var d=l||this.resolutionManager.getCurrentResolution();if(!d||this.streamSenderParams.maxFs<=d)return this.streamSenderParams;var u=_.shallowClone(this.streamSenderParams);return u.maxFs=d,u},h([(0,y.sequentialize)(),g(\"design:type\",Function),g(\"design:paramtypes\",[Object]),g(\"design:returntype\",Promise)],AdaptiveCapablitiesHandler.prototype,\"applyCapabilities\",null),AdaptiveCapablitiesHandler}();d.AdaptiveCapablitiesHandler=T},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.ResolutionManager=void 0;var p=u(26),h=15e3,g=5e3,f=function(){function ResolutionManager(l,d,u,h,g){var f=this;this.settings=l,this.listener=d,this.statsGatherer=u,this.logger=h,this.lastSendBW=0,this.coolingDown=!1,this.cooldownTimer=null,this.cooldownEnd=0,this.active=!1,this.resolutionTable=new p.default(g.config.resolutionTableOverride),this.maxResolution=this.settings.maxResolution,this.settings.scalingEnabled?(this.active=!0,this.statsSubscription=this.statsGatherer.on(\"onStatisticsChanged\",(function(l){return f.onStatisticsChanged(l)}))):this.logger.safe.info(\"Resolution management disabled: no resolution management for 1x1 calls\")}return ResolutionManager.prototype.dispose=function(){this.currentResolution=null,this.pendingResolution=null,this.maxResolution=null,this.listener=null,this.active=!1,clearTimeout(this.cooldownTimer),this.cooldownTimer=null,this.statsSubscription&&(this.statsSubscription.dispose(),this.statsSubscription=null),this.statsGatherer=null,this.listener=null},ResolutionManager.prototype.setMaxResolution=function(l){var d=this.resolutionTable.getResolutionByFs(l);d!==this.maxResolution&&(this.logger.safe.info(\"Setting max resolution: \".concat(d)),this.maxResolution=d,this.lastSendBW&&this.processEstimatedBandwidth(this.lastSendBW))},ResolutionManager.prototype.resetCurrentResolution=function(){this.currentResolution=null},ResolutionManager.prototype.getCurrentResolution=function(){return this.currentResolution&&this.currentResolution.fs},ResolutionManager.prototype.setCurrentResolution=function(l){this.currentResolution=l},ResolutionManager.prototype.applyRes=function(l){var d=this;this.pendingResolution=l,this.coolingDown&&(!this.currentResolution||l.fs>this.currentResolution.fs)||(this.coolingDown=!0,this.logger.safe.info(\"Changing resolution to \".concat(l)),this.listener&&this.listener.onResolutionChanged(l.fs).then((function(u){u?(l===d.pendingResolution&&(d.pendingResolution=null),d.coolingDown&&!d.currentResolution&&(d.coolingDown=!1),d.currentResolution=l,d.cooldown()):(d.logger.safe.info(\"Unable to apply resolution at the moment\"),d.cooldown(g))})).catch((function(l){d.logger.safe.error(\"Error while applying new resolution: \".concat(JSON.stringify(l))),d.pendingResolution=null})))},ResolutionManager.prototype.cooldown=function(l){var d=this;void 0===l&&(l=h),!this.active||this.coolingDown&&this.cooldownEnd-Date.now()>h||(this.cooldownTimer&&clearTimeout(this.cooldownTimer),this.coolingDown=!0,this.cooldownEnd=Date.now()+h,this.cooldownTimer=setTimeout((function(){d.logger.safe.debug(\"Resolution changer cooled down\"),d.coolingDown=!1,d.cooldownTimer=null,d.pendingResolution?d.proposeResolution(d.pendingResolution):d.processEstimatedBandwidth(d.lastSendBW)}),l))},ResolutionManager.prototype.proposeResolution=function(l){var d=l;this.maxResolution&&this.maxResolution.fs<d.fs&&(d=this.maxResolution),this.currentResolution&&d.fs===this.currentResolution.fs||this.applyRes(d)},ResolutionManager.prototype.processEstimatedBandwidth=function(l){var d=this.resolutionTable.getResolutionForBitrate(l),u=d.lowRes,p=d.highRes,h=l<this.lastSendBW?p:u;l<this.lastSendBW&&h&&this.currentResolution&&this.currentResolution.fs<h.fs||(h&&this.proposeResolution(h),this.lastSendBW=l)},ResolutionManager.prototype.onStatisticsChanged=function(l){var d=l.estimatedSendBandwidth;d!==this.lastSendBW&&(this.logger.safe.debug(\"Send BW: \".concat(d)),this.processEstimatedBandwidth(d))},ResolutionManager}();d.ResolutionManager=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.DirectCapabilitiesHandler=void 0;var p=function(){function DirectCapabilitiesHandler(l,d,u,p,h){this.modality=l,this.listener=d,this.statisticsGatherer=u,this.diagnostics=p,this.isSimulcastEnabled=h}return DirectCapabilitiesHandler.prototype.setMaxCapabilities=function(l,d){var u,p={modality:this.modality,causeId:l,capabilities:d,isSimulcastEnabled:this.isSimulcastEnabled};this.statisticsGatherer.onMaxCapabilitiesRequested(p),null===(u=this.diagnostics)||void 0===u||u.onMaxCapabilitiesRequested(p),this.listener.onReceiveCapabilitiesChanged(this.modality,l,d)},DirectCapabilitiesHandler.prototype.dispose=function(){},DirectCapabilitiesHandler.prototype.resetCurrentResolution=function(){},DirectCapabilitiesHandler.prototype.getCurrentResolution=function(){return null},DirectCapabilitiesHandler.prototype.setCurrentResolution=function(l){},DirectCapabilitiesHandler}();d.DirectCapabilitiesHandler=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.RemoteVideoRenderer=void 0;var h=u(1),g=u(3),f=u(51),m=u(420),v=u(123),y=u(421),S=u(79),_=u(144),C=function(l){function RemoteVideoRenderer(d,u,p,h,g){var f=l.call(this,g,d.createChild(\"remote\"))||this;return f.configProvider=u,f.diagnostics=p,f.subscriptionManager=h,f.disposed=!1,f.currentIsRendering=!1,f.configProvider.config.freezeIntervalFrequency&&(f.freezeTracker=new y.VideoFreezeTracker(f.getVideoElement(),f.configProvider,f.getTimeToFirstFrame.bind(f)),f.freezeTracker.on(\"onFreezeEnded\",(function(l){var d;null===(d=f.diagnostics)||void 0===d||d.addFreezeDuration(l),f.event(\"onFreezeEnded\").raise(l)})),f.diagnostics&&f.on(\"onVideoStarted\",(function(l){return f.diagnostics.timeToFirstFrame=l}))),f.configProvider.config.isRenderingBasedOnRawStatistics&&(f.isRenderingTracker=new m.IsRenderingTracker(f.configProvider,f.getModality.bind(f)),f.isRenderingChangedSubscription=f.isRenderingTracker.on(\"onIsRenderingChanged\",(function(l){f.event(\"onIsRenderingChanged\").raise(l)}))),f.overlayStats=(0,v.createRemoteRendererStatsOverlay)(f.configProvider.config.showStatsInCall,g,f),f}return p(RemoteVideoRenderer,l),RemoteVideoRenderer.prototype.getEndOfTheFreeze=function(){var l;return null===(l=this.freezeTracker)||void 0===l?void 0:l.getEndOfTheFreeze()},RemoteVideoRenderer.prototype.setIsRendering=function(l){this.currentIsRendering!==l&&(this.currentIsRendering=l,this.event(\"onIsRenderingChanged\").raise(l))},RemoteVideoRenderer.prototype.captureRawStatistics=function(l){var d;this.configProvider.config.isRenderingBasedOnRawStatistics&&(null===(d=this.isRenderingTracker)||void 0===d||d.captureRawStatistics(l)),-1!==l.id.indexOf(\"_recv\")&&this.overlayStats.setStats(l)},RemoteVideoRenderer.prototype.subscribeVideoAsync=function(l,d){var u=this;return new Promise((function(p,f){u.modality=d?g.default.MODALITY.sharing:g.default.MODALITY.video,u.diagnostics&&(u.diagnostics.msi=l,u.diagnostics.modality=u.modality),u.trackElementSizeChange(),u.unsubscribe();var m=u.subscriptionManager.subscribeVideo(u.modality,l);u.subscription=m,u.logger.safe.info(\"subscribing renderer to type: \".concat(m.getModality(),\" msi: \").concat(m.getMsi())),m.onMediaStreamChanged((function(l){var d,h=u.getMediaStream();u.attachMediaStream(l);var g=u.getTrackId();g&&u.diagnostics&&(u.diagnostics.trackId=g),u.logger.safe.info(\"subscribed renderer to type: \".concat(m.getModality(),\" msi: \").concat(m.getMsi(),\" on stream #\").concat(l?l.id:\"none\")),l&&h!==l&&(null===(d=u.sizeTracker)||void 0===d||d.triggerVideoElementSizeChange()),p()})),m.onError((function(l){u.logger.safe.error(\"failed to subscribe renderer \".concat(h.stringifyObject(l))),f(l)}))}))},RemoteVideoRenderer.prototype.dispose=function(){var d,u,p;this.disposed?this.logger.safe.warn(\"renderer already disposed\"):(this.disposed=!0,this.logger.safe.info(\"disposing\"),this.unsubscribe(),null===(d=this.sizeTracker)||void 0===d||d.dispose(),null===(u=this.freezeTracker)||void 0===u||u.dispose(),null===(p=this.isRenderingChangedSubscription)||void 0===p||p.dispose(),this.overlayStats.dispose(),this.event(\"onRendererDisposed\").raise(this),l.prototype.dispose.call(this))},RemoteVideoRenderer.prototype.getModality=function(){return this.modality},RemoteVideoRenderer.prototype.getMsi=function(){var l,d;return null!==(d=null===(l=this.subscription)||void 0===l?void 0:l.getMsi())&&void 0!==d?d:f.MediaSourceIdentifiers.SourceNone},RemoteVideoRenderer.prototype.getCurrentResolution=function(){var l;return null!==(l=this.resolution)&&void 0!==l?l:{width:0,height:0}},RemoteVideoRenderer.prototype.unsubscribeNow=function(){var l;null===(l=this.subscription)||void 0===l||l.disposeNow(),this.subscription=null},RemoteVideoRenderer.prototype.trackElementSizeChange=function(){var l=this,d=this.modality===g.default.MODALITY.sharing,u=d?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMin:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMin,p=d?this.configProvider.config.webrtcScreensharingCapabilityCheckIntervalMax:this.configProvider.config.webrtcVideoCapabilityCheckIntervalMax;u&&p?(this.sizeTracker=new _.VideoSizeTracker(this.getVideoElement(),u,p,this.configProvider.config.enableDevicePixelRatio),this.sizeTracker.changed((function(){return l.onSizeTrackerChanged()}))):this.logger.safe.info(\"skipping video size tracking\")},RemoteVideoRenderer.prototype.onSizeTrackerChanged=function(){this.resolution={width:this.sizeTracker.width,height:this.sizeTracker.height},this.logger.safe.info(\"video renderer size changed to \".concat(this.resolution.width,\"x\").concat(this.resolution.height)),this.diagnostics&&(this.diagnostics.rendererSize=this.resolution),this.event(\"onRendererSizeChanged\").raise(this,this.resolution)},RemoteVideoRenderer.prototype.unsubscribe=function(){var l;null===(l=this.subscription)||void 0===l||l.dispose(),this.subscription=null},RemoteVideoRenderer}(S.VideoRendererBase);d.RemoteVideoRenderer=C},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.IsRenderingTracker=void 0;var h=u(3),g=function(l){function IsRenderingTracker(d,u){var p=l.call(this)||this;return p.configProvider=d,p.getModality=u,p.isRendering=!1,p.currentFreezeDuration=0,p.mediaStarted=!1,p.lastBytesRecv=0,p.currentLowBitrateDuration=0,p}return p(IsRenderingTracker,l),IsRenderingTracker.prototype.captureRawStatistics=function(l){var d=l.googFrameRateDecoded,u=l.googFrameRateReceived,p=l.bytesReceived;void 0!==p&&this.getModality()!==h.default.MODALITY.sharing&&this.configProvider.config.isBytesRecvUsedInIsRenderingCalculation&&this.calculateBitrate(p),d>0&&(this.mediaStarted=!0),0===d||0===u?this.currentFreezeDuration+=h.default.TIME_INTERVAL.SEC_1:d>0&&(void 0===u||u>0)&&(this.currentFreezeDuration=0);var g=this.configProvider.config.notRenderingTimeInterval[this.getModality()];this.setIsRendering(g)},IsRenderingTracker.prototype.calculateBitrate=function(l){var d=125,u=(l-this.lastBytesRecv)/d;this.lastBytesRecv=l,u<this.configProvider.config.notRenderingLowBitrateThreshold?this.currentLowBitrateDuration++:this.currentLowBitrateDuration=0},IsRenderingTracker.prototype.setIsRendering=function(l){var d=this.currentFreezeDuration<l&&this.currentLowBitrateDuration<l&&this.mediaStarted;d!==this.isRendering&&(this.isRendering=d,this.event(\"onIsRenderingChanged\").raise(this.isRendering))},IsRenderingTracker}(u(7).default);d.IsRenderingTracker=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoFreezeTracker=void 0;var h=function(l){function VideoFreezeTracker(d,u,p){var h=l.call(this)||this;return h.videoElement=d,h.configProvider=u,h.getTimeToFirstFrame=p,h.prevCurrentTime=0,h.prevDecodedFrameCount=0,h.prevTimestamp=Date.now(),h.currentFreezeDuration=0,h.freezeDurationTimer=window.setInterval((function(){h.calcFreezeDurationMs()}),h.configProvider.config.freezeIntervalFrequency),h}return p(VideoFreezeTracker,l),VideoFreezeTracker.prototype.calcFreezeDurationMs=function(){var l=this.videoElement.currentTime,d=l===this.prevCurrentTime,u=this.videoElement.webkitDecodedFrameCount,p=void 0===u||u===this.prevDecodedFrameCount;if(this.prevCurrentTime=l,this.prevDecodedFrameCount=u,-1!==this.getTimeToFirstFrame())if(d&&p){var h=Date.now();this.currentFreezeDuration+=h-this.prevTimestamp,this.prevTimestamp=h}else{if(this.currentFreezeDuration>this.configProvider.config.freezeMinDuration){var g=this.calcFreeze();this.event(\"onFreezeEnded\").raise(g)}this.currentFreezeDuration=0}this.prevTimestamp=Date.now()},VideoFreezeTracker.prototype.getEndOfTheFreeze=function(){var l=0;return this.currentFreezeDuration>0&&(l=this.calcFreeze(),this.currentFreezeDuration=0),l},VideoFreezeTracker.prototype.dispose=function(){var l=this.getEndOfTheFreeze();this.event(\"onFreezeEnded\").raise(l),clearInterval(this.freezeDurationTimer)},VideoFreezeTracker.prototype.calcFreeze=function(){var l=Date.now()-this.prevTimestamp;return this.currentFreezeDuration+l},VideoFreezeTracker}(u(7).default);d.VideoFreezeTracker=h},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},g=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0});var m=u(13),v=u(48),y=u(83),S=u(30),_=u(64),C=u(26),E=u(29),T=u(51),b=u(145),I=u(146),A=u(1),R=u(3),P=u(86),O=u(84),M=u(9),w=u(153),N=u(156),D=u(423),L=u(424),k=u(159),x=u(160),F=u(162),U=u(163),j=u(427),B=u(169),V=u(165),H=u(429),G=u(166),W=u(167),q=u(168),z=u(430),K=u(431),J=u(444),Q=u(445),Y=u(148),$=u(446),X=u(139),Z=0,ee=function(){function WebRtcSession2(l,d,u){var p,h,g,f=this;this.context=l,this.callId=d,this.callback=u,this.callbacks={},this.multiParty=this.context.config&&this.context.config.isConference,this.configProvider=this.context.configProvider,this.logger=this.context.getLogger().createChild(\"webrtc2-\".concat(++Z)),this.deviceManager=this.context.getDeviceManager(),this.unifiedPlanEnabled=this.configProvider.config.webrtcUnifiedPlanEnabled,this.webrtcAdapter=w.default.build({global:this.context.maContext,configProvider:this.configProvider,unifiedPlanEnabled:this.unifiedPlanEnabled}),this.iceHostCandidateOnly=this.multiParty&&A.getFrom(\"iceHostCandidateOnly\",this.context.config,this.configProvider.config),this.mediaManager=L.MediaManagerFactory.build({logger:this.logger,configProvider:this.configProvider,numVideoChannels:this.multiParty&&this.configProvider.config.numVideoChannelsGvc||1,unifiedPlanEnabled:this.unifiedPlanEnabled,useSimulcast:this.multiParty}),this.sessionDescription=W.SessionDescriptionFactory.build({sdpTransform:new this.webrtcAdapter.SdpTransform(this.context),mediaManager:this.mediaManager,logger:this.logger,configProvider:this.configProvider,configuration:this.getStreamTransformConfiguration()}),this.allowedMediaContentType=A.getFrom(\"webrtcAllowedMediaContentType\",this.context.config,this.configProvider.config).concat(),this.receiveStreamCollection=new b.default({streamAdded:function(l){return f.streamAdded(l)},streamRemoved:function(l){return f.streamRemoved(l)}}),this.diagnostics=this.context.diagnostics,this.qmDiagnostics=null===(p=this.diagnostics)||void 0===p?void 0:p.newQualityManagerDiagnostics(),this.statsGatherer=new Y.StatisticsPoller(this.logger.createChild(\"stats\"),this.configProvider,this.diagnostics,this.mediaManager,this.multiParty),this.scalingEnabled=this.multiParty?this.configProvider.config.webrtcMultiPartyVideoScaling:this.configProvider.config.webrtcVideoScaling,this.qualityManager=new x.default(this.logger.createChild(\"qm\"),{scalingEnabled:this.scalingEnabled,customBwEstimationEnabled:!(this.multiParty&&!this.configProvider.config.webrtcEnabledCustomBwEstimationForVideo),sendBandwidthNotificationsEnabled:this.multiParty&&this.configProvider.config.webrtcSendBandwidthNotificationsEnabled},this,this.statsGatherer,this.qmDiagnostics,this.configProvider),this.activeSpeakerManager=new y.ActiveSpeakerManager(this.callback.onContributingSourcesChanged,this.callback.onDominantSpeakerChanged,this.logger.createChild(\"ActiveSpeakerManager\")),this.contributingSources=new N.ContributingSourcesHandler({activeSpeakerManager:this.activeSpeakerManager,logger:this.logger,configProvider:this.configProvider,provider:function(){if(!f.peerConnection)return[];if(f.peerConnection.getReceivers&&f.multiParty){var l=f.peerConnection.getReceivers().filter((function(l){return\"audio\"===l.track.kind}))[0];if(!l)return[];if(l.getContributingSources)return l.getContributingSources()}}}),this.passiveModalities=this.context.config.passiveModalities,this.negotiationQueue=new S.PromiseQueue(this.logger),this.negotiationEmulator=new k.default(this.logger.createChild(\"negotiationEmulator\"),this.webrtcAdapter,this.sessionDescription,this.negotiationQueue,this.mediaManager),this.extensionsManager=this.setupExtensionsManager(),this.wasConnected=!1,this.toBeCalledAfterConnected=[],this.iceTransportPolicy=this.configProvider.config.iceTransportPolicyForced||this.context.config.iceTransportPolicy||R.default.ICE_TRANSPORT_POLICY.all,this.peerConnection=null,this.doAudioMute=this.context.config.muted,this.iceCandidatesDeferred=new E.SettablePromise,this.iceCandidatesTimer=null,this.relayCandidateGathered=!1,this.iceCandidateReceived=!1,this.triggerRenegotiationFlag=!1,this.canTriggerRenegotiation=!0,this.noIceCandidates=!1,this.noRelayIceCandidates=!1,this.forceMediaStreamUpdate=!1,this.negotiatedModalities={},this.iceDisconnectedTimer=null,this.statisticsReport=Promise.resolve({}),this.terminated=!1,this.initiator=!1,this.streamsChangedListener=null,this.dtmfSender=G.default.build({logger:this.logger,configProvider:this.configProvider}),this.mediaContentType=A.getFrom(\"webrtcMediaContentType\",this.context.config,this.configProvider.config),this.streamsChangedNotificationScheduled=!1,this.subscriptionManager=new I.SubscriptionManager({logger:this.logger.createChild(\"subs\"),configProvider:this.configProvider,diagnostics:null===(h=this.diagnostics)||void 0===h?void 0:h.newSubscriptionManagerDiagnostics()},{getStreams:function(){return f.getStreams()},onStreamsChanged:function(l){return f.onStreamsChanged(l)}}),this.remoteVideoResolutionManager=new F.RemoteVideoResolutionManager(this.logger.createChild(\"rvrm\"),this.multiParty,new C.default(this.configProvider.config.recvResolutionTableOverride),this.configProvider,this.mediaManager),this.remoteVideoManager=new U.RemoteVideoManager(this.logger.createChild(\"RemoteVideoManager\"),this.configProvider,this.statsGatherer,null===(g=this.diagnostics)||void 0===g?void 0:g.newRemoteVideoManagerDiagnostics(),this.remoteVideoResolutionManager,this.context.maContext.domOverrides),this.transceiverManager=null,this.encStreamsManager=new z.EncodedStreamsManager(this.configProvider),this.streamSendersManager=new K.StreamSendersManager(this.mediaManager,this.logger.createChild(\"SSM\"),this.deviceManager,this.configProvider,this.statsGatherer,this.qmDiagnostics,this.multiParty,this.encStreamsManager),this.hwSilent=!1,this.configuredModalitiesPromise=Promise.resolve(),this.negotiationCompletedPromise=new E.SettablePromise,this.transportStateProvider=null,this.isMuteHold=!1,this.useNullAudioStream=!1,this.ufdManager=l.getUfdManager(),this.statsGatherer.on(\"onStatisticsChanged\",(function(l){f.updateQualityLevels(l)})),this.negotiationCompletedPromise.promise.catch((function(){})),this.negotiationCompletedPromise.reject(\"placeholder\"),this.remoteVideoResolutionManager.on(\"onNegotiationRequired\",(function(){return f.triggerRenegotiation(!0)})),this.remoteVideoResolutionManager.on(\"onSourceRequestRequired\",(function(l,d,u,p){return f.requestSource(l,d,u,p)})),this.setSubsForSubscriptionManager(),this.setSubsForStreamManagerEvents(),this.configProvider.mediaConfig.maxBandwidthInKbps&&(this.statsGatherer.setMaxSessionBandwidth(this.configProvider.mediaConfig.maxBandwidthInKbps),this.diagnostics&&(this.diagnostics.maxSessionBandwidth=this.configProvider.mediaConfig.maxBandwidthInKbps)),this.createAudioRenderer(),this.configProvider.config.allowAccessRawMediaStream&&(this.rawOutputAudioContextProvider=new Q.default(this.logger.createChild(\"RawOutputAudioContextProvider\"))),this.dmSub=this.deviceManager.on(\"onLocalRendererStarted\",(function(l){return l.setStatsProvider(f.statsGatherer)})),this.configProvider.config.enableActiveSpeakerBasedDSH&&this.activeSpeakerManager.setStrategy(new X.DSHGeneratingStrategy({configProvider:this.configProvider}))}return WebRtcSession2.prototype.getAcceptedTypes=function(){return this.allowedMediaContentType},WebRtcSession2.prototype.clone=function(l,d){var u,p=A.shallowClone(this.context);p.config=A.shallowClone(this.context.config),p.config.webrtcMediaContentType=this.mediaContentType,p.config.webrtcAllowedMediaContentType=this.allowedMediaContentType,p.configProvider=d,p.diagnostics=null===(u=this.context.diagnostics)||void 0===u?void 0:u.newNativeSession(!1),l?p.config.isConference=!0:(p.config.iceHostCandidateOnly=!1,this.configProvider.config.waitForRelayOnReconnect&&(p.config.webrtcIceGatheringTimeoutIncreased=!0));var h=new WebRtcSession2(p,this.callId,this.callback);return this.useNullAudioStream&&h.useNullAudioStreamClient(),this.relayManagerProvider&&(h.relayManagerProvider=this.relayManagerProvider),h.callbacks.onNegotiationRequired=this.callbacks.onNegotiationRequired,h},WebRtcSession2.prototype.enableRealTimeTelemetry=function(){this.logger.safe.info(\"enableRealTimeTelemetry is not implemented yet\")},WebRtcSession2.prototype.setInternals=function(l,d){var u,p,h,g,f=this;if(this.logger.safe.info(\"[\".concat(d,\"] Setting internals from previous session\")),null===(u=this.diagnostics)||void 0===u||u.commitNativeSession(),l.extensionsManager&&this.extensionsManager){var m=l.extensionsManager.getExtension(R.default.EXTENSION_TYPE.videoStreamControl);m&&m.getOptions()&&this.extensionsManager.configureExtension(R.default.EXTENSION_TYPE.videoStreamControl,m.getOptions())}l.subscriptionManager&&(null===(p=this.subscriptionManager)||void 0===p||p.dispose(),this.subscriptionManager=l.subscriptionManager,this.subscriptionManager.setDiagnostics(null===(h=this.diagnostics)||void 0===h?void 0:h.newSubscriptionManagerDiagnostics()),this.subscriptionManager.setStreamProvider({getStreams:function(){return f.getStreams()},onStreamsChanged:function(l){return f.onStreamsChanged(l)}}),this.setSubsForSubscriptionManager(),this.subscriptionManager.reriseSubscribeEvents(),this.notifyStreamsChanged()),l.audioRenderer&&(l.audioRenderer.play(this.audioRenderer.getStream()),this.audioRenderer=l.audioRenderer),null===(g=l.remoteVideoManager)||void 0===g||g.moveRenderers(this.remoteVideoManager),l.rawOutputAudioContextProvider&&(this.rawOutputAudioContextProvider.dispose(),this.rawOutputAudioContextProvider=l.rawOutputAudioContextProvider),l.injectedInputAudioStreamTrack&&(this.injectedInputAudioStreamTrack=l.injectedInputAudioStreamTrack)},WebRtcSession2.prototype.setSubsForSubscriptionManager=function(){var l=this;this.subscriptionManagerSubs=[this.subscriptionManager.on(\"onTrackIdsChanged\",(function(d){return l.statsGatherer.setSubscribedTrackIds(d)})),this.subscriptionManager.on(\"onTrackSsrcChanged\",(function(d){return l.statsGatherer.setSubscribedTrackSsrc(d)})),this.subscriptionManager.on(\"onSubscriptionChanged\",(function(d,u,p,h){return l.statsGatherer.addSubscriptionEvent(d,u,p,null,h)})),this.subscriptionManager.on(\"onSubscriptionFailed\",(function(d,u,p,h){return l.statsGatherer.addSubscriptionEvent(d,u,p,h)}))]},WebRtcSession2.prototype.setSubsForStreamManagerEvents=function(){var l=this;this.streamSendersManager.on(\"onSendStreamChanged\",(function(d,u){var p;l.statsGatherer.updateSendStream(d,u),(null==d?void 0:d.hasAudio())&&(null===(p=l.diagnostics)||void 0===p||p.setAudioSendStream(d,u))})),this.streamSendersManager.on(\"onVideoCaptureFreeze\",(function(d){l.isConnected()&&l.ufdManager.signalEvent(\"VideoCaptureDeviceFreeze\",d?\"Bad\":\"Good\",\"Video\")}))},WebRtcSession2.prototype.move=function(l,d){this.logger.safe.info(\"[\".concat(d,\"] moving to new session\")),l.setInternals({subscriptionManager:this.subscriptionManager,extensionsManager:this.extensionsManager,audioRenderer:this.audioRenderer,remoteVideoManager:this.remoteVideoManager,rawOutputAudioContextProvider:this.rawOutputAudioContextProvider,injectedInputAudioStreamTrack:this.injectedInputAudioStreamTrack},d),l.muteHold(this.isMuteHold,d),this.doAudioMute?l.muteInputAsync(d):l.unmuteInputAsync(d),this.injectedInputAudioStreamTrack&&l.setRawInputAudioStreamTrack(this.injectedInputAudioStreamTrack),this.subscriptionManager=null,this.audioRenderer=null,this.rawOutputAudioContextProvider=null,this.injectedInputAudioStreamTrack=null,this.callbacks.onTerminated=null},WebRtcSession2.prototype.setMute=function(l,d,u){this.logger.safe.info(\"[\".concat(u,\"] call setMute for \").concat(l,\" with mute state \").concat(d)),this.streamSendersManager.setMuted(l,d,u),this.updateQualityLevels(this.statsGatherer.getLastStatistics())},WebRtcSession2.prototype.configureModalitiesAsync=function(l,d){var u=this,p=this.configuredModalitiesPromise.then((function(){if(!l||!l.audio&&!l.video&&!l.sharing)throw new Error(\"Invalid parameters! \".concat(JSON.stringify(l)));var p=A.shallowClone(l),h=A.shallowClone(u.negotiatedModalities);u.configProvider.config.alwaysNegotiateDataChannel&&(delete p.data,delete h.data);var g=!u.configuredModalities||!M.areNegotiatedDirectionsFulfilled(p,h);if(u.configuredModalities=l,u.logger.safe.info(\"[\".concat(d,\"] configure modalities\"),\"audio: \".concat(l.audio),\"video: \".concat(l.video),\"sharing: \".concat(l.sharing),\"data: \".concat(l.data),\"peerconnection: \".concat(!!u.peerConnection),\"pc.signalingState: \".concat(u.peerConnection?u.peerConnection.signalingState:\"-\"),\"needNewRenegotiation: \".concat(g)),g){if(u.configProvider.config.enableReinviteless&&!A.isEmpty(u.negotiatedModalities)&&!M.isOnHold(u.negotiatedModalities)&&!M.isOnHold(u.configuredModalities))return u.updateSendStreams(d);u.triggerRenegotiation(!1,d)}return u.configuredModalities}));return this.configuredModalitiesPromise=p.catch((function(l){u.logger.safe.warn(\"[\".concat(d,\"] Error during configuring modalities: \").concat(A.stringifyObject(l)))})).then((function(){})),p.then((function(){}))},WebRtcSession2.prototype.getConfiguredModalities=function(){return this.configuredModalities},WebRtcSession2.prototype.createAudioElement=function(l){this.audioRenderer.assureAudioElement(l)},WebRtcSession2.prototype.useNullAudioStreamClient=function(){this.useNullAudioStream=!0,this.streamSendersManager.useNullAudioStreamClient()},WebRtcSession2.prototype.createOfferAsync=function(l){var d=this,u=this.negotiationQueue.add((function(){return new Promise((function(u){d.logger.safe.info(\"[\".concat(l,\"] create [offer] configured: \").concat(JSON.stringify(d.configuredModalities))),d.initiator=!0,d.throwIfModalitiesNotConfigured(\"no configured modalities to create offer for\"),d.canTriggerRenegotiation=!1,d.negotiatingModalities=M.excludePassiveModalities(d.configuredModalities,d.passiveModalities,d.offeredModalities),u(d.assurePeerConnectionAsync(l).then((function(){return d.logger.safe.info(\"[\".concat(l,\"] updatePeerConnectionStreamsAsync, pc state: \").concat(JSON.stringify(d.peerConnection.signalingState))),M.isOnHold(d.negotiatingModalities)&&!A.isEmpty(d.negotiatedModalities)&&Object.keys(d.negotiatingModalities).forEach((function(l){void 0===d.negotiatedModalities[l]&&delete d.negotiatingModalities[l]})),d.transceiverManager&&d.transceiverManager.assureTransceivers(d.negotiatingModalities),d.assureStreamsAndDataChannel(d.negotiatingModalities,l)})).then((function(u){d.offeredModalities=u,!M.allowDataChannel(d.context)&&d.configProvider.config.webrtcNegotiateDisabledDataModality&&!d.offeredModalities[R.default.MODALITY.data]&&d.multiParty&&(d.offeredModalities[R.default.MODALITY.data]=R.default.MEDIA_STATE.inactive);var p=d.transceiverManager?{}:d.createNegotiationConstraints(d.offeredModalities);return d.logger.safe.info(\"[\".concat(l,\"] create [offer] offered: \").concat(JSON.stringify(d.offeredModalities),\" constraints: \").concat(JSON.stringify(p))),d.peerConnection.createOffer(p)})).then((function(u){d.logger.unsafe.debug(\"[\".concat(l,\"] create [offer] offer from peer connection, sdp: \").concat(u.sdp));var p=d.sessionDescription.createLocalOffer(u.sdp);d.hasIceCandidates(p)||d.resetCandidateGathering(l),d.statsGatherer.startWaitingForStreamStart(d.offeredModalities);var h=new d.webrtcAdapter.RTCSessionDescription({sdp:p.toLocal(),type:\"offer\"});return d.setupIceGatheringTimeout(l),Promise.all([d.peerConnection.setLocalDescription(h),d.iceCandidatesDeferred.promise])})).then((function(){var u=d.sessionDescription.createLocalOffer(d.peerConnection.localDescription.sdp);d.fixLocalDescription(u),u.updateModalities(d.offeredModalities),d.checkIceCandidates(u);var p=u.toOffer();d.logger.unsafe.debug(\"[\".concat(l,\"] CREATE OFFER\"),\"sdp:\",p);var h={blob:p,contentType:d.mediaContentType};return\"\"===d.configProvider.mediaConfig.webrtcRequiredFeatures||d.multiParty||(h.requiredFeatures=d.configProvider.mediaConfig.webrtcRequiredFeatures),d.configProvider.countryCode&&(h.clientLocation=d.configProvider.countryCode),d.mediaManager.getMediaEntities().forEach((function(l){l.setExtension(\"midApplied\",!0)})),d.doRetargetIfNeeded(h,u,l),d.configProvider.config.enableReinviteless&&(h.mediaDescriptions=d.getMediaDescriptions(d.offeredModalities)),h})))}))}),l);return this.resetNegotiationQueue(l),u},WebRtcSession2.prototype.processOfferAsync=function(l,d){var u=this,p=this.negotiationQueue.add((function(){return new Promise((function(p){var h=l.blob;if(u.logger.unsafe.debug(\"[\".concat(d,\"] process [offer]\"),\"sdp:\",h),u.configProvider.config.webrtcCompareContentTypeInOffer&&(A.throwIfNotSupported(l.contentType,u.allowedMediaContentType),u.mediaContentType=l.contentType),l.requiredFeatures){var g=u.configProvider.mediaConfig.webrtcRejectedFeatures.split(\",\"),f=l.requiredFeatures.split(\",\");A.throwIfFeatureNotSupported(f,g)}u.initiator=!1,u.offeredDescription=u.sessionDescription.createRemoteOffer(h),u.canTriggerRenegotiation=!1,u.offeredModalities=M.invertModalities(u.offeredDescription.getModalities()),u.peerConnection||(u.context.configProvider.mediaConfig.isTransportUnbundled?u.context.configProvider.mediaConfig.isTransportUnbundled=u.offeredDescription.couldBeUnbundled():u.context.configProvider.mediaConfig.isTransportUnbundled=u.offeredDescription.isUnbundled());var m=Promise.resolve(u.offeredModalities);if(M.hasSendDirectionality(u.offeredModalities.video)||M.hasReceiveDirectionality(u.offeredModalities.video)||M.hasSendDirectionality(u.offeredModalities.sharing)||M.hasReceiveDirectionality(u.offeredModalities.sharing)){var v=u.offeredDescription.getVideoCodecs();m=u.webrtcAdapter.RTCRtpReceiver.getCapabilities(\"video\").then((function(l){if(!l.codecs.some((function(l){return v.some((function(d){return l.mimeType===d}))}))){u.logger.safe.warn(\"[\".concat(d,\"] offer doesn't contain any supported video codecs\"));var p=A.shallowClone(u.offeredModalities);return p.video=void 0,p.sharing=void 0,p}return u.offeredModalities})).catch((function(l){return u.logger.safe.error(\"[\".concat(d,\"] failed to get video capability \").concat(A.stringifyObject(l))),u.offeredModalities}))}(!M.allowDataChannel(u.context)&&(M.hasSendDirectionality(u.offeredModalities.data)||M.hasReceiveDirectionality(u.offeredModalities.data))||u.dataChannel&&\"Failed\"===u.dataChannel.state)&&(m=m.then((function(l){u.logger.safe.info(\"[\".concat(d,\"] Supressing data modality as data channel is not possible\"));var p=A.shallowClone(l);return delete p.data,p}))),p(m.then((function(l){return u.logger.safe.info(\"[\".concat(d,\"] process [offer] offered: \").concat(JSON.stringify(u.offeredModalities),\" acceptable: \").concat(JSON.stringify(l))),l})))}))}),d);return this.resetNegotiationQueue(d),p},WebRtcSession2.prototype.createAnswerAsync=function(l,d){var u=this;return new Promise((function(g){if(l)g({blob:\"\",contentType:u.mediaContentType});else{u.logger.safe.info(\"[\".concat(d,\"] create [answer] offered: \").concat(JSON.stringify(u.offeredModalities),\" configured: \").concat(JSON.stringify(u.configuredModalities))),u.throwIfModalitiesNotConfigured(\"no configured modalities to create answer for\"),u.negotiatingModalities=M.excludePassiveModalities(u.configuredModalities,u.passiveModalities,u.offeredModalities);var f=null,m=u.offeredDescription.clone();g(u.assurePeerConnectionAsync(d).then((function(){return u.logger.safe.info(\"[\".concat(d,\"] updatePeerConnectionStreamsAsync, pc state: \").concat(JSON.stringify(u.peerConnection.signalingState))),f=M.negotiateModalities(u.offeredModalities,u.negotiatingModalities),u.handleCodecSwitchUnsupported(d)})).then((function(){var l=u.offeredDescription.toRemote(f);return u.logger.unsafe.info(\"[\".concat(d,\"] create [answer] set remote description', 'negotiated:\"),f,\"sdp:\",l),u.peerConnection.setRemoteDescription(new u.webrtcAdapter.RTCSessionDescription({sdp:l,type:\"offer\"}))})).then((function(){return u.transceiverManager&&u.transceiverManager.syncTransceivers(f),u.mediaManager.getMediaEntities().forEach((function(l){l.setExtension(\"midApplied\",!0)})),u.assureStreamsAndDataChannel(f,d)})).then((function(){return u.mediaManager.updateMediaEntitiesWithLocalTracks(),u.configProvider.config.mapSsrcToTrackForStats&&u.statsGatherer.updateStatsWithLocalSsrcTrackInfo(),u.callbacks.onTransportInitialized&&u.callbacks.onTransportInitialized(),u.peerConnection.createAnswer()})).then((function(l){u.logger.unsafe.debug(\"[\".concat(d,\"] create [answer] answer from peer connection\"),\"sdp:\",l.sdp);var p=u.sessionDescription.createLocalAnswer(l.sdp);u.hasIceCandidates(p)||u.resetCandidateGathering(d),u.statsGatherer.startWaitingForStreamStart(f);var h=new u.webrtcAdapter.RTCSessionDescription({sdp:p.toLocal(),type:\"answer\"});return u.setupIceGatheringTimeout(d),u.logger.unsafe.debug(\"[\".concat(d,\"] create [answer] answer set local description\"),\"sdp:\",h.sdp),Promise.all([u.peerConnection.setLocalDescription(h),u.iceCandidatesDeferred.promise])})).then((function(){return p(u,void 0,void 0,(function(){var l,u,p,g;return h(this,(function(h){switch(h.label){case 0:return l=this.sessionDescription.createLocalAnswer(this.peerConnection.localDescription.sdp),this.fixLocalDescription(l),l.updateModalities(f),this.checkIceCandidates(l),u=l.toAnswer(),[4,this.streamSendersManager.activate()];case 1:return h.sent(),p=this.streamSendersManager.getLocalMediaSources(),this.qualityManager.updateRegisteredSources(p),this.applyReceiveCapabilities(m.getRecvCapabilities()),f=l.getModalities(),this.configProvider.config.enableReinviteless&&(f=M.removeChangedSendDirection(this.negotiatingModalities,f)),M.areNegotiatedDirectionsAcceptable(this.configuredModalities,this.negotiatingModalities,f)||this.triggerRenegotiation(!0,d),this.setNegotiatedModalities(f),this.statsGatherer.sessionInfo.setBweType(l.getBweType()),this.diagnostics&&(this.diagnostics.bweType=l.getBweType()),this.logger.unsafe.debug(\"[\".concat(d,\"] CREATE ANSWER\"),\"sdp:\",u),g={blob:u,contentType:this.mediaContentType},this.configProvider.countryCode&&(g.clientLocation=this.configProvider.countryCode),this.configProvider.config.enableReinviteless&&(g.mediaDescriptions=this.getMediaDescriptions(f)),[2,g]}}))}))})))}}))},WebRtcSession2.prototype.processAnswerAsync=function(l,d,u,g){return p(this,void 0,void 0,(function(){var p,g,f,m,v,y,S;return h(this,(function(h){switch(h.label){case 0:return p=l.blob,this.logger.unsafe.debug(\"[\".concat(d,u?\"] PROCESS PRANSWER\":\"] PROCESS ANSWER\"),\"sdp:\",p),g=u?\"pranswer\":\"answer\",u&&(!M.allowProvisionalAnswer(this.context)||\"have-local-offer\"!==this.peerConnection.signalingState)?(this.logger.safe.info(\"[\".concat(d,\"] process [\").concat(g,\"] ignored\")),[2,Promise.resolve()]):(f=this.sessionDescription.createRemoteAnswer(p),m=M.invertModalities(f.getModalities()),this.configProvider.config.enableReinviteless&&(m=M.removeChangedSendDirection(this.offeredModalities,m)),v=f.clone(),y=f.toRemote(m),this.logger.unsafe.info(\"[\".concat(d,\"] process [\").concat(g,\"] set remote description\"),\"negotiated:\",m,\"sdp:\",y),u||(this.mediaContentType=l.contentType,-1===this.allowedMediaContentType.indexOf(this.mediaContentType)&&this.allowedMediaContentType.push(this.mediaContentType),this.assureStreamsAndDataChannel(m,d),this.setNegotiatedModalities(m),this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.configProvider.config.mapSsrcToTrackForStats&&this.statsGatherer.updateStatsWithLocalSsrcTrackInfo(),S=this.streamSendersManager.getLocalMediaSources(),this.qualityManager.updateRegisteredSources(S),this.statsGatherer.sessionInfo.setBweType(f.getBweType()),this.diagnostics&&(this.diagnostics.bweType=f.getBweType())),[4,this.peerConnection.setRemoteDescription(new this.webrtcAdapter.RTCSessionDescription({sdp:y,type:g}))]);case 1:return h.sent(),u?[2]:[4,this.streamSendersManager.activate()];case 2:return h.sent(),this.applyReceiveCapabilities(v.getRecvCapabilities()),this.callbacks.onTransportInitialized&&this.callbacks.onTransportInitialized(),this.transceiverManager&&this.transceiverManager.syncTransceivers(m),[2]}}))}))},WebRtcSession2.prototype.completeNegotiationAsync=function(l){var d=this;return new Promise((function(u){var p,h;d.mediaManager.commit();var f=M.excludePassiveModalities(d.configuredModalities,d.passiveModalities,d.offeredModalities),m=d.forceMediaStreamUpdate&&!M.isOnHold(d.negotiatedModalities)||!M.areNegotiatedDirectionsAcceptable(f,d.negotiatingModalities,d.negotiatedModalities)||d.triggerRenegotiationFlag,v=!m;d.canTriggerRenegotiation=!0,d.logger.safe.info(\"[\".concat(l,\"] negotiation completed isComplete: \").concat(v,\" configured: \").concat(JSON.stringify(d.configuredModalities),\" negotiating: \").concat(JSON.stringify(d.negotiatingModalities),\" offered: \").concat(JSON.stringify(d.offeredModalities),\" negotiated: \").concat(JSON.stringify(d.negotiatedModalities))),m&&d.triggerRenegotiation(!1,l),d.negotiationCompletedPromise.resolve();var y={isComplete:v,activeModalities:d.negotiatedModalities,offeredModalities:d.offeredModalities,attemptedModalities:d.negotiatingModalities,configuredModalities:d.configuredModalities,initiator:d.initiator};try{for(var S=g(d.deviceManager.getLocalVideoRenderers()),_=S.next();!_.done;_=S.next()){_.value.setStatsProvider(d.statsGatherer)}}catch(l){p={error:l}}finally{try{_&&!_.done&&(h=S.return)&&h.call(S)}finally{if(p)throw p.error}}u(y)}))},WebRtcSession2.prototype.rejectNegotiationAsync=function(l,d,u){return void 0===u&&(u=!1),p(this,void 0,void 0,(function(){var p,g,f,m;return h(this,(function(h){switch(h.label){case 0:return this.mediaManager.rollback(),this.logger.safe.warn(\"[\".concat(d,\"] negotiation rejected isComplete: \").concat(!u,\" error: \").concat(A.stringifyObject(l),\" configured: \").concat(JSON.stringify(this.configuredModalities),\" negotiating: \").concat(JSON.stringify(this.negotiatingModalities),\" offered: \").concat(JSON.stringify(this.offeredModalities),\" negotiated: \").concat(JSON.stringify(this.negotiatedModalities))),g=this.getModalitiesForRollback(d),this.transceiverManager&&this.transceiverManager.syncTransceivers(g),[4,this.assureStreamsAndDataChannel(g,d)];case 1:if(h.sent(),!this.peerConnection)return[3,10];if(\"have-local-offer\"!==this.peerConnection.signalingState)return[3,9];p={},this.logger.safe.info(\"[\".concat(d,\"] rolling back local description\")),h.label=2;case 2:return h.trys.push([2,7,,8]),this.isRollbackSupported&&!this.configProvider.config.webrtcHandleRollback?[3,4]:(p.type=\"LocalRN\",this.logger.safe.info(\"[\".concat(d,\"] rolling back using local renegotiation\")),f=[],this.unifiedPlanEnabled&&f.push(new P.MediaRollbackModifier(this.peerConnection,this.configProvider,this.logger)),[4,this.negotiationEmulator.renegotiate(f,!0)]);case 3:return h.sent(),this.logger.safe.info(\"[\".concat(d,\"] rolling back using local complete\")),[3,6];case 4:return this.logger.safe.info(\"[\".concat(d,\"] rolling back using rollback\")),p.type=\"Rollback\",[4,this.peerConnection.setLocalDescription({type:\"rollback\"})];case 5:h.sent(),h.label=6;case 6:return[3,8];case 7:return m=h.sent(),this.logger.safe.error(m),p.error=m,[3,8];case 8:return[3,10];case 9:this.logger.safe.error(\"[\".concat(d,\"] cannot rollback local description in currrent state: \").concat(this.peerConnection.signalingState)),h.label=10;case 10:return this.canTriggerRenegotiation=!0,this.negotiationCompletedPromise.reject(\"negotiation rejected\"),u&&(this.logger.safe.info(\"[\".concat(d,\"] retrying failed negotiation\")),this.triggerRenegotiation(!1,d)),[2,{isComplete:!u,activeModalities:g,offeredModalities:this.offeredModalities,attemptedModalities:this.negotiatingModalities,configuredModalities:this.configuredModalities,initiator:this.initiator,rollback:p}]}}))}))},WebRtcSession2.prototype.createRemoteRenderer=function(l){return this.remoteVideoManager.createRenderer(l,this.subscriptionManager,this.logger)},WebRtcSession2.prototype.getStatsAsync=function(l){var d=this;return this.statsGatherer&&!this.statsGatherer.isDisposed&&(this.statisticsReport=this.statisticsReport.then((function(){return d.statsGatherer.getReport(l)})).catch((function(l){return d.logger.safe.error(\"getting statistics should never fail: \".concat(l.error)),l.partialReport}))),this.statisticsReport},WebRtcSession2.prototype.getLastKnownStats=function(l){return this.statsGatherer.getLastKnownReport(!1,l)},WebRtcSession2.prototype.isReconnectSupported=function(){return this.configProvider.config.enableReconnectChrome},WebRtcSession2.prototype.muteHold=function(l,d){var u,p,h=this;this.logger.safe.info(\"[\".concat(d,\"] set muteHold state \").concat(l)),this.isMuteHold=l;var f=[R.default.MODALITY.audio,R.default.MODALITY.video,R.default.MODALITY.sharing].filter((function(l){return M.hasSendDirectionality(h.negotiatedModalities[l])&&(l!==R.default.MODALITY.audio||!h.doAudioMute)}));try{for(var m=g(f),v=m.next();!v.done;v=m.next()){var y=v.value;this.setMute(M.modalityToMediaType(y),l,d)}}catch(l){u={error:l}}finally{try{v&&!v.done&&(p=m.return)&&p.call(m)}finally{if(u)throw u.error}}},WebRtcSession2.prototype.muteInputAsync=function(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){return this.doAudioMute=!0,this.setMute(\"Audio\",!0,l),[2]}))}))},WebRtcSession2.prototype.unmuteInputAsync=function(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){return this.doAudioMute=!1,this.setMute(\"Audio\",!1,l),[2]}))}))},WebRtcSession2.prototype.muteOutputAsync=function(l){return this.audioRenderer.setMuted(!0,l)},WebRtcSession2.prototype.unmuteOutputAsync=function(l){return this.audioRenderer.setMuted(!1,l)},WebRtcSession2.prototype.sendDtmf=function(l){return this.dtmfSender.sendDtmf(this.peerConnection,l)},WebRtcSession2.prototype.canSendDtmf=function(){return this.dtmfSender.canSendDtmf(this.peerConnection)},WebRtcSession2.prototype.pauseNegotiations=function(l){var d=this;void 0===l&&(l=(0,m.generateCauseId)());var u=new E.SettablePromise;return this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){d.setNegotiationPromise(u,l)})),u},WebRtcSession2.prototype.getExtensionsManager=function(){return this.extensionsManager},WebRtcSession2.prototype.onDeviceEvent=function(l){this.statsGatherer.onDeviceEvent(l)},WebRtcSession2.prototype._deviceSelectionChanged=function(){this.peerConnection&&this.audioRenderer&&this.audioRenderer.getStream()&&this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId())},WebRtcSession2.prototype.terminate=function(l,d,u){var g;return void 0===u&&(u=!0),p(this,void 0,void 0,(function(){var d;return h(this,(function(p){switch(p.label){case 0:this.logger.safe.info(\"[\".concat(l,\"] terminate\")),this.statsGatherer.setTerminated(),null===(g=this.diagnostics)||void 0===g||g.terminate(),this.terminated=!0,this.canTriggerRenegotiation=!1,this.cleanUp(l),p.label=1;case 1:return p.trys.push([1,4,5,6]),u?[4,this.getStatsAsync(!1)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[3,6];case 4:return d=p.sent(),this.logger.safe.error(\"[\".concat(l,\"] Error while gathering stats \").concat(A.stringifyObject(d))),[3,6];case 5:return this.statsGatherer.dispose(),[7];case 6:return[2]}}))}))},WebRtcSession2.prototype.getRawOutputAudioStream=function(){var l;return this.configProvider.config.allowAccessRawMediaStream?null===(l=this.rawOutputAudioContextProvider)||void 0===l?void 0:l.rawStream:(this.logger.safe.debug(\"allowAccessRawMediaStream is not enabled\"),null)},WebRtcSession2.prototype.setRawInputAudioStreamTrack=function(l){if(this.configProvider.config.allowAccessRawMediaStream)return this.injectedInputAudioStreamTrack=l,this.streamSendersManager.injectMediaStreamTrack(\"Audio\",this.injectedInputAudioStreamTrack);this.logger.safe.debug(\"allowAccessRawMediaStream is not enabled\")},WebRtcSession2.prototype.cleanUp=function(l){var d;this.activeSpeakerManager.dispose(),this.negotiationQueue.dispose(),null===(d=this.rawOutputAudioContextProvider)||void 0===d||d.dispose(),this.negotiationCompletedPromise.reject(\"webRtcSession cleanUp\"),this.remoteVideoManager.dispose(),this.dataChannel&&(this.dataChannel.dispose(),this.dataChannel=null),this.resetPeerConnection(l),this.subscriptionManagerSubs.forEach((function(l){return l.dispose()})),this.subscriptionManager&&this.subscriptionManager.dispose(),this.dmSub.dispose(),this.clearIceDisconnectedTimer(),this.extensionsManager&&this.extensionsManager.dispose(),this.callbacks.onTerminated&&this.callbacks.onTerminated(this)},WebRtcSession2.prototype.resetPeerConnection=function(l){this.logger.safe.info(\"[\".concat(l,\"] reset peer connection\")),this.contributingSources.stopPolling(),this.qualityManager&&(this.qualityManager.dispose(),this.qualityManager=null),this.audioRenderer&&this.audioRenderer.dispose(),this.dtmfSender&&(this.dtmfSender.dispose(),this.dtmfSender=null),this.streamSendersManager&&(this.streamSendersManager.dispose(),this.streamSendersManager=null),this.transceiverManager=null,this.encStreamsManager.dispose(),this.receiveStreamCollection.clear(),this.transportStateProvider&&(this.transportStateProvider.dispose(),this.transportStateProvider=null),this.peerConnection&&this.peerConnection.close(),this.toBeCalledAfterConnected=[],this.peerConnection=null,this.negotiationEmulator.configure(null),this.peerConnectionPromise=null,this.resetCandidateGathering(l),this.canTriggerRenegotiation=!0,this.negotiatedModalities={}},WebRtcSession2.prototype.resetNegotiationQueue=function(l){this.negotiationCompletedPromise.reject(\"promise expired\"),this.setNegotiationPromise(new E.SettablePromise,l)},WebRtcSession2.prototype.setNegotiationPromise=function(l,d){void 0===d&&(d=(0,m.generateCauseId)()),this.terminated||(this.negotiationCompletedPromise=l,this.negotiationQueue.add(this.negotiationCompletedPromise,d))},WebRtcSession2.prototype.setupExtensionsManager=function(){var l=this,d=new O.default(this.logger.createChild(\"ExtMgr\"));return d.addExtension(R.default.EXTENSION_TYPE.dominantSpeakerHistory,{logger:this.logger,callback:this.activeSpeakerManager.onDominantSpeakerHistoryChanged.bind(this.activeSpeakerManager)}),d.addExtension(R.default.EXTENSION_TYPE.videoStreamControl,{logger:this.logger,negotiationEmulator:this.negotiationEmulator,qualityManager:this.qualityManager,diagnostics:this.qmDiagnostics,configProvider:this.configProvider,statisticsGatherer:this.statsGatherer}),this.scalingEnabled&&d.addExtension(R.default.EXTENSION_TYPE.optimalVideoCount,{logger:this.logger,callback:function(d){return l.onOptimalVideoReceiversCountChanged(d)},statisticsGatherer:this.statsGatherer,configProvider:this.configProvider}),d},WebRtcSession2.prototype.updateQualityLevels=function(l){if(l){this.hwSilent!==l.audioHwSilent&&(this.hwSilent=l.audioHwSilent,this.callbacks.onAudioHwSilentChanged&&this.callbacks.onAudioHwSilentChanged(this.hwSilent)),this.ufdManager.signalEvent(\"NetworkRecvQuality\",l.networkRecvLevel),this.ufdManager.signalEvent(\"NetworkSendQuality\",this.doAudioMute?\"Good\":l.networkSendLevel);var d=!(!l.isSpeaking||!this.doAudioMute);this.ufdManager.signalEvent(\"DeviceSpeakWhileMuted\",d?\"Bad\":\"Good\")}},WebRtcSession2.prototype.triggerRenegotiation=function(l,d){void 0===d&&(d=(0,m.generateCauseId)()),this.canTriggerRenegotiation?(this.canTriggerRenegotiation=!1,this.triggerRenegotiationFlag=!1,this.logger.safe.info(\"[\".concat(d,\"] triggering renegotiation\")),this.mediaManager.backup(),this.callbacks.onNegotiationRequired&&this.callbacks.onNegotiationRequired(d)):l&&(this.logger.safe.info(\"[\".concat(d,\"] renegotiation postponed\")),this.triggerRenegotiationFlag=!0)},WebRtcSession2.prototype.throwIfModalitiesNotConfigured=function(l){if(!this.configuredModalities)throw new Error(l)},WebRtcSession2.prototype.handleCodecSwitchUnsupported=function(l){var d=this;return this.offeredDescription.isCodecSwitchSupported()?Promise.resolve():this.webrtcAdapter.RTCRtpReceiver.getCapabilities(R.default.MEDIA_TYPE.audio).then((function(l){var u=l.codecs.map((function(l){return l.mimeType}));d.offeredDescription.usePrimaryAudioCodecOnly(u)})).catch((function(u){d.logger.safe.error(\"[\".concat(l,\"] failed to set primary codec based on audio capability \").concat(A.stringifyObject(u)))}))},WebRtcSession2.prototype.assurePeerConnectionAsync=function(l){var d=this;if(!this.peerConnectionPromise){if(!this.relayManagerProvider)throw new Error(\"relay manager provider is not set!\");this.logger.safe.info(\"[\".concat(l,\"] fetching relay details from RelayManager...\"));var u={relayType:\"turn\",isRemoteClientLync:this.context.config.isRemoteClientLync};this.peerConnectionPromise=this.relayManagerProvider.getRelayManager().queryRelaysAsync(u).then((function(u){return p(d,void 0,void 0,(function(){var d,p,g,v,y,S,_,C,E,T=this;return h(this,(function(h){if(this.terminated)throw new Error(\"session already disposed\");return d={optional:[]},p=(0,q.createIceServers)(u,this.configProvider.config),g=this.configureCrypto(d),this.configureCpuThreshold(d),this.logger.safe.info(\"create peer connection\"),v=this.unifiedPlanEnabled?\"unified-plan\":\"plan-b\",y=this.context.configProvider.mediaConfig.isTransportUnbundled?\"balanced\":\"max-bundle\",S=this.peerConnection=new this.webrtcAdapter.RTCPeerConnection({iceServers:p,rtcpMuxPolicy:\"require\",iceTransportPolicy:this.iceTransportPolicy,iceCandidatePoolSize:this.configProvider.config.iceCandidatePoolSize,bundlePolicy:y,sdpSemantics:v,audioPortRange:this.configProvider.mediaConfig.audioPortRange,videoPortRange:this.configProvider.mediaConfig.videoPortRange,enableDtlsSrtp:1===g,encodedInsertableStreams:this.configProvider.config.useInsertableStreams},d),this.isRollbackSupported=1===g&&this.unifiedPlanEnabled&&this.context.configProvider.userAgentConfig.isBrowserRollbackSupported,this.negotiationEmulator.configure(S),this.statsGatherer.initialize(S),this.statsGatherer.sessionInfo.setIceServers(p),this.statsGatherer.sessionInfo.setIceTransportPolicy(this.iceTransportPolicy),this.statsGatherer.sessionInfo.setSdpSemantics(v),this.statsGatherer.sessionInfo.setBundlePolicy(y),this.diagnostics&&(this.diagnostics.iceServers=p,this.diagnostics.iceTransportPolicy=this.iceTransportPolicy,this.diagnostics.sdpSemantics=v,this.diagnostics.bundlePolicy=y),this.checkVideoCodecsSupport(),this.contributingSources.startPolling(),S.onnegotiationneeded=function(){T.logger.safe.info(\"onnegotiationneeded signalingState: \".concat(S.signalingState))},S.onsignalingstatechange=function(){T.statsGatherer.sessionInfo.setSignalingConnectionState(S.signalingState),T.diagnostics&&(T.diagnostics.signalingConnectionState=S.signalingState),T.logger.safe.info(\"onsignalingstatechange signalingState: \".concat(S.signalingState)),T.transportStateProvider&&T.transportStateProvider.subscribeForDtlsTransportState()},S.onicecandidateerror=function(l){var d,u=f([l.address,l.port],2),p=u[0],h=u[1];if(T.logger.safe.warn(\"On ICE candidate error \".concat(l.url,\" | \").concat(p,\":\").concat(h,\": code \").concat(l.errorCode,\": \").concat(l.errorText)),!T.isConnected()||T.iceCandidatesDeferred.isPending){var g={address:p,port:+h,url:l.url,errorCode:l.errorCode,errorText:l.errorText};T.statsGatherer.addIceCandidateError(g),null===(d=T.diagnostics)||void 0===d||d.addIceCandidateError(g)}},_=function(l){var d=l.track,u=l.receiver,p=l.transceiver,h=l.streams[0],g=h||new MediaStream([d]);if(!T.isConnected())return T.logger.safe.info(\"ontrack handling postponed till PC is connected\"),void T.toBeCalledAfterConnected.push((function(){return _(l)}));if(T.logger.safe.info(\"ontrack track \".concat(d.id,\", stream: \").concat(g&&g.id,\", transceiver=\").concat(null==p?void 0:p.mid)),g&&g.active&&\"stopped\"!==(null==p?void 0:p.currentDirection)&&!(null==p?void 0:p.stopped)){var f=T.mediaManager.getMediaEntityByRemoteStreamId(g.id);if(f||(T.logger.safe.info(\"cannot find media entity with stream id \".concat(g.id,\" trying to fallback\")),g.getAudioTracks()[0]&&(f=T.mediaManager.getMediaEntitiesByModality(R.default.MODALITY.audio)[0])),f){var m=T.createReceiveStream(g,d,f);T.unifiedPlanEnabled&&(f.setRemoteTrackId(d.id),T.addReceiveStreamTransforms(u,f.getModality())),T.receiveStreamCollection.add(m)}else T.logger.safe.error(\"could not find media entity for an added stream: \".concat(g.id))}else T.logger.safe.info(\"ontrack ignore non active stream\")},S.onaddstream=function(l){T.logger.safe.info(\"onaddstream stream: \".concat(l.stream.id))},S.ontrack=_,C=function(l){if(!T.isConnected())return T.logger.safe.info(\"onremovestream handling postponed till PC is connected\"),void T.toBeCalledAfterConnected.push((function(){return C(l)}));T.logger.safe.info(\"onremovestream stream: \".concat(l.stream)),T.receiveStreamCollection.remove(l.stream.id)},S.onremovestream=C,S.onicecandidate=function(d){var u,h,g,f=d.candidate;if(f){var m=M.parseCandidateString(f.candidate);if(T.logger.safe.info(\"[\".concat(l,\"] onicecandidate candidate: component:\").concat(m.component,\" protocol:\").concat(m.protocol,\" prio:\").concat(m.priority,\" type:\").concat(m.type,\" port:\").concat(m.port)),T.logger.unsafe.info(\"[\".concat(l,\"] candidate details: \").concat(f.candidate)),\"1\"!==m.component)return;if(T.iceCandidateReceived=!0,T.statsGatherer.sessionInfo.setCandidateDetails(m),null===(u=T.diagnostics)||void 0===u||u.setCandidateDetails(m),!T.relayCandidateGathered&&f.candidate.indexOf(\"typ relay\")>-1){var v={priority:(null===(h=f.priority)||void 0===h?void 0:h.toString())||m.priority,time:Date.now()-T.iceRelayCandidatesGatherStartTime};T.statsGatherer.sessionInfo.setRelayCandidateInfo(v),T.diagnostics&&(T.diagnostics.relayCandidateInfo=v),T.relayCandidateGathered=!0}}else T.logger.safe.info(\"[\".concat(l,\"] onicecandidate candidate: null\"));if(T.iceCandidatesDeferred.isPending){var y=!T.initiator||!T.context.config.webrtcIceGatheringTimeoutIncreased,_=T.iceHostCandidateOnly||0===p.length;if(!f&&y||_){f&&T.logger.safe.info(\"[\".concat(l,\"] Not waiting for ICE candidates, hoping that host/prflx is enough\")),T.logger.safe.info(\"[\".concat(l,\"] Is connected:\"),T.isConnected(),S.iceConnectionState,S.signalingState);var C=!0;if(T.context.configProvider.mediaConfig.isTransportUnbundled&&f)C=T.sessionDescription.createLocalOffer(S.localDescription.sdp).hasUnbundledIceCandidates();C&&T.completeCandidateGathering(l)}else if(T.relayCandidateGathered){C=!0;if(T.context.configProvider.mediaConfig.isTransportUnbundled)C=T.sessionDescription.createLocalOffer(S.localDescription.sdp).hasUnbundledRelayIceCandidates();C&&(T.statsGatherer.clearIceCandidateErrors(),null===(g=T.diagnostics)||void 0===g||g.clearIceCandidateErrors(),T.completeCandidateGathering(l))}}},S.onicegatheringstatechange=function(){T.logger.safe.info(\"onicegatheringstatechange iceGatheringState: \".concat(S.iceGatheringState))},E=function(d){if(!T.terminated){var u=T.wasConnected?(0,m.generateCauseId)():l,p=T.lastTransportConnectionState;if(T.lastTransportConnectionState=d,T.statsGatherer.sessionInfo.setIceConnectionState(d),T.diagnostics&&(T.diagnostics.iceConnectionState=d),\"connected\"===d||\"completed\"===d)T.onTransportConnected(u);else if(\"failed\"===d||\"closed\"===d&&\"failed\"!==p){if(T.iceCandidatesDeferred.isPending)return T.logger.safe.info(\"[\".concat(u,\"] ice failed while gathering candidates, suppressing error\")),void T.completeCandidateGathering(u);T.raiseError({type:R.default.MEDIA_ERROR.iceConnectionError,detail:\"ice transport failed\"},u),T.configProvider.config.webrtcCloseAfterIceFailure&&S.close(),T.onTransportFailed()}\"disconnected\"===d?(T.onTransportDisconnected(u),T.startIceDisconnectedTimer(u)):T.clearIceDisconnectedTimer()}},this.transportStateProvider=new J.TransportStateProvider(S,g,this.logger,this.configProvider,(function(l){return E(l)})),[2]}))}))})).then((function(){d.unifiedPlanEnabled&&(d.transceiverManager=new H.default(d.logger,d.peerConnection,d.mediaManager,d.context)),d.streamSendersManager.registerMediaConnection(D.default.build(d.peerConnection,d.transceiverManager)),M.allowDataChannel(d.context)&&!d.dataChannel&&(d.dataChannel=new j.SessionDataChannel(d.peerConnection,d.statsGatherer,d.logger),d.callback.onDataChannelUpdated(d.dataChannel))}))}return this.peerConnectionPromise},WebRtcSession2.prototype.configureCrypto=function(l){var d=!1,u=M.preferSdesSrtp(this.context);if(this.offeredDescription){var p=this.offeredDescription.getSrtpInfo();this.statsGatherer.sessionInfo.setOfferedSrtpInfo(p),this.diagnostics&&(this.diagnostics.offeredSrtp=p),d=!p.dtls||p.sdes&&u}else d=u;d&&(this.logger.safe.info(\"configuring peer connection to use sdes\"),l.optional.push({DtlsSrtpKeyAgreement:!1}));var h={dtls:!d,sdes:!!d};return this.statsGatherer.sessionInfo.setNegotiatedSrtpInfo(h),this.diagnostics&&(this.diagnostics.negotiatedSrtp=h),d?0:1},WebRtcSession2.prototype.configureCpuThreshold=function(l){this.configProvider.config.webrtcNativeCpuOveruseDisabled&&this.multiParty&&l.optional.push({googCpuOveruseDetection:!1})},WebRtcSession2.prototype.completeCandidateGathering=function(l){this.iceCandidatesDeferred.isPending&&(this.logger.safe.info(\"[\".concat(l,\"] ICE candidates gathered completely\")),this.iceCandidatesDeferred.resolve())},WebRtcSession2.prototype.onTransportConnected=function(l){var d;if(this.logger.safe.info(\"[\".concat(l,\"] audio transport connected\")),this.statsGatherer.clearIceCandidateErrors(),null===(d=this.diagnostics)||void 0===d||d.clearIceCandidateErrors(),!this.terminated){for(this.wasConnected=!0;this.toBeCalledAfterConnected.length;)this.toBeCalledAfterConnected.shift()();this.callbacks.onAudioStateChanged(R.default.STREAMING_STATE.active,l),this.callbacks.onTransportConnected&&this.callbacks.onTransportConnected(l)}},WebRtcSession2.prototype.onTransportDisconnected=function(l){this.callbacks.onTransportDisconnected&&this.callbacks.onTransportDisconnected(l)},WebRtcSession2.prototype.onTransportFailed=function(){this.callbacks.onTransportFailed&&this.callbacks.onTransportFailed()},WebRtcSession2.prototype.startIceDisconnectedTimer=function(l){var d=this;this.configProvider.config.iceDisconnectedTimeoutMs&&(this.iceDisconnectedTimer=setTimeout((function(){d.logger.safe.error(\"[\".concat(l,\"] ice disconnected for \").concat(d.configProvider.config.iceDisconnectedTimeoutMs,\"ms. Raise \").concat(R.default.MEDIA_ERROR.iceConnectionError)),d.raiseError({type:R.default.MEDIA_ERROR.iceConnectionError,detail:\"ice transport disconnected\"},l)}),this.configProvider.config.iceDisconnectedTimeoutMs))},WebRtcSession2.prototype.clearIceDisconnectedTimer=function(){this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null)},WebRtcSession2.prototype.raiseError=function(l,d){void 0===d&&(d=(0,m.generateCauseId)()),this.logger.safe.error(\"[\".concat(d,\"] Media error occurred type: \").concat(l.type,\" detail: \").concat(l.detail)),this.callbacks.onSessionErrorOccurred&&this.callbacks.onSessionErrorOccurred(l,d)},WebRtcSession2.prototype.createNegotiationConstraints=function(l){function canReceive(l){return!!l&&(M.hasReceiveDirectionality(l)||\"inactive\"===l)}return{offerToReceiveAudio:canReceive(l.audio),offerToReceiveVideo:canReceive(l.video)||canReceive(l.sharing)}},WebRtcSession2.prototype.resetCandidateGathering=function(l){this.logger.safe.info(\"[\".concat(l,\"] reset candidate gathering\")),this.iceCandidatesDeferred.promise.then((function(){}),(function(){})),this.iceCandidatesDeferred.reject(new Error(\"reset candidate gathering\")),this.iceCandidatesDeferred=new E.SettablePromise,this.iceCandidateReceived=!1},WebRtcSession2.prototype.checkIceCandidates=function(l){var d=this.hasIceCandidates(l);if(d===this.noIceCandidates&&(this.noIceCandidates=!this.noIceCandidates,this.ufdManager.signalEvent(\"NoNetwork\",this.noIceCandidates?\"Bad\":\"Good\"),this.noIceCandidates))throw{type:R.default.MEDIA_ERROR.noNetworkError,detail:\"no ice candidates\"};if(d){var u=this.hasRelayIceCandidates(l);if(u===this.noRelayIceCandidates){if(!u&&(\"connected\"===this.peerConnection.iceConnectionState||\"completed\"===this.peerConnection.iceConnectionState))return;this.noRelayIceCandidates=!this.noRelayIceCandidates,this.ufdManager.signalEvent(\"NetworkRelaysNotReachable\",this.noRelayIceCandidates?\"Bad\":\"Good\")}}},WebRtcSession2.prototype.hasIceCandidates=function(l){return this.configProvider.mediaConfig.isTransportUnbundled?l.hasUnbundledIceCandidates():l.hasIceCandidates()},WebRtcSession2.prototype.hasRelayIceCandidates=function(l){return this.configProvider.mediaConfig.isTransportUnbundled?l.hasUnbundledRelayIceCandidates():l.hasRelayIceCandidates()},WebRtcSession2.prototype.doRetargetIfNeeded=function(l,d,u){var p=d.isIceRestart();this.logger.safe.info(\"[\".concat(u,\"] ICE restart: \").concat(p)),this.context.configProvider.mediaConfig.isTransportUnbundled&&this.offeredDescription&&this.offeredDescription.isMSRTC()&&p&&!this.multiParty&&d.getSrtpInfo().sdes&&(l.newOffer=!0)},WebRtcSession2.prototype.getStreams=function(){return this.receiveStreamCollection.getStreams()},WebRtcSession2.prototype.onStreamsChanged=function(l){this.streamsChangedListener=l},WebRtcSession2.prototype.notifyStreamsChanged=function(){var l=this;this.logger.safe.info(\"Scheduling stream changed notification: \".concat(this.streamsChangedNotificationScheduled)),this.streamsChangedNotificationScheduled||this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){l.streamsChangedNotificationScheduled=!1,l.streamsChangedListener&&l.streamsChangedListener()}))},WebRtcSession2.prototype.streamAdded=function(l){var d;return p(this,void 0,void 0,(function(){var u;return h(this,(function(p){switch(p.label){case 0:return R.default.MODALITY.audio!==l.getModality()?[3,3]:[4,this.audioRenderer.setOutputDevice(this.deviceManager.getOutputDeviceId())];case 1:return p.sent(),[4,this.audioRenderer.play(l.getMediaStream())];case 2:p.sent(),null===(d=this.rawOutputAudioContextProvider)||void 0===d||d.setStreamToDestination(l.getMediaStream()),p.label=3;case 3:return this.configProvider.config.mapSsrcToTrackForStats&&(u=this.mediaManager.getMediaEntityByRemoteStreamId(l.getMediaStream().id),this.statsGatherer.setSsrcTrackPair(u.getRemoteSsrc(),u.getRemoteTrackId())),this.notifyStreamsChanged(),[2]}}))}))},WebRtcSession2.prototype.streamRemoved=function(l){R.default.MODALITY.audio===l.getModality()&&this.audioRenderer.getStream()===l.getMediaStream()&&this.audioRenderer.stop();var d=this.mediaManager.getMediaEntityByRemoteStreamId(l.getMediaStream().id);this.statsGatherer.setSsrcTrackPair(d.getRemoteSsrc(),null),l.dispose(),this.notifyStreamsChanged()},WebRtcSession2.prototype.setNegotiatedModalities=function(l){this.negotiatedModalities=l,this.statsGatherer.sessionInfo.setNegotiatedModalities(l),this.diagnostics&&(this.diagnostics.negotiatedModalities=l)},WebRtcSession2.prototype.setupIceGatheringTimeout=function(l){var d=this;this.iceRelayCandidatesGatherStartTime=Date.now();var u=this.context.config.webrtcIceGatheringTimeoutIncreased?this.configProvider.config.relayWaitSaneTimeoutMs:this.configProvider.config.webrtcIceGatheringTimeoutMs;if(u){this.iceCandidatesTimer>0&&clearTimeout(this.iceCandidatesTimer);var p=this.iceCandidatesDeferred;this.iceCandidatesTimer=setTimeout((function(){d.iceCandidatesTimer=0,p.isPending&&(d.logger.safe.warn(\"[\".concat(l,\"] ICE candidates gathering terminated due to timeout \").concat(u)),p.resolve())}),u)}},WebRtcSession2.prototype.isConnected=function(){return this.peerConnection&&(\"connected\"===this.lastTransportConnectionState||\"completed\"===this.lastTransportConnectionState)},WebRtcSession2.prototype.isFailed=function(){return this.peerConnection&&(\"failed\"===this.lastTransportConnectionState||\"closed\"===this.lastTransportConnectionState)},WebRtcSession2.prototype.createReceiveStream=function(l,d,u){var p=this.configProvider.config.addFmtpToInitialSubscription?u.getVideoCapabilities():null,h=new V.default(l,u.getModality(),+u.getXSourceStreamId(),this,p);return this.unifiedPlanEnabled?new $.default(h,d,this.receiveStreamCollection,this.logger.createChild(\"RecvStream\"),this.configProvider.config):h},WebRtcSession2.prototype.requestSource=function(l,d,u,p){var h=this;if(!this.multiParty)return Promise.resolve();if((this.isMuteHold||this.negotiatedModalities[l]===R.default.MEDIA_STATE.inactive)&&u!==T.MediaSourceIdentifiers.SourceNone)return v.delay(10).then((function(){return h.requestSource(l,d,u,p)}));if(this.negotiationCompletedPromise.isPending)return this.negotiationCompletedPromise.promise.catch((function(){})).then((function(){return h.requestSource(l,d,u,p)}));if(!this.isConnected()){this.logger.safe.info(\"requestSource is postponed till transport is connected\");var g=v.defer();return this.toBeCalledAfterConnected.push((function(){return g.resolve()})),g.promise.then((function(){return h.requestSource(l,d,u,p)}))}return Promise.resolve().then((function(){return h.extensionsManager.getExtension(R.default.EXTENSION_TYPE.videoStreamControl).sendSourceRequest(d,u,p)}))},WebRtcSession2.prototype.assureStreamsAndDataChannel=function(l,d){return p(this,void 0,void 0,(function(){var u;return h(this,(function(p){switch(p.label){case 0:return this.logger.safe.info(\"[\".concat(d,\"] assureStreamsAndDataChannel \"),this.negotiatedModalities,\"offered\",this.offeredModalities,\" mod \",l),this.dataChannel&&this.dataChannel.updateDataModalityState(l.data),[4,this.configureHold(this.negotiatedModalities,l,d)];case 1:return p.sent()?(this.logger.safe.info(\"[\".concat(d,\"] Hold is configured. Not updating streams\")),[2,l]):[4,this.streamSendersManager.update(l,d)];case 2:return u=p.sent(),this.dataChannel&&l.data&&(u.data=l.data),[2,u]}}))}))},WebRtcSession2.prototype.configureHold=function(l,d,u){return p(this,void 0,void 0,(function(){var p,g;return h(this,(function(h){switch(h.label){case 0:return p=M.isOnHold(l),g=M.isOnHold(d),p===g?[3,2]:[4,this.streamSendersManager.setHold(g,u)];case 1:h.sent(),h.label=2;case 2:return[2,g]}}))}))},WebRtcSession2.prototype.getStreamTransformConfiguration=function(){return{unifiedPlanEnabled:this.unifiedPlanEnabled,addPrefixForMsid:this.configProvider.config.addPrefixForMsidInSdp}},WebRtcSession2.prototype.applyReceiveCapabilities=function(l){this.multiParty||this.qualityManager.setMaxCapabilities(l)},WebRtcSession2.prototype.onReceiveCapabilitiesChanged=function(l,d,u){return p(this,void 0,void 0,(function(){return h(this,(function(p){switch(p.label){case 0:if(!this.streamSendersManager)return[2,!1];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.streamSendersManager.applyCapabilities(d,l,u)];case 2:return p.sent(),[2,!0];case 3:return p.sent(),[2,!1];case 4:return[2]}}))}))},WebRtcSession2.prototype.onOptimalVideoReceiversCountChanged=function(l){this.callback.onOptimalVideoReceiversCountChanged&&this.callback.onOptimalVideoReceiversCountChanged(l)},WebRtcSession2.prototype.onSendBandwidthChanged=function(l){return p(this,void 0,void 0,(function(){var d,u,p=this;return h(this,(function(h){return this.isConnected()?(d=this.extensionsManager.getExtension(R.default.EXTENSION_TYPE.videoStreamControl),0===(u=this.mediaManager.getMediaEntities().filter((function(l){return[R.default.MODALITY.video,R.default.MODALITY.sharing].indexOf(l.getModality())>-1})).filter((function(l){return l.isEnabled()})).map((function(l){return l.getMid()}))).length?[2]:[2,d.sendBandwidthInfo(u,l).then((function(){p.statsGatherer.setReportedSendBandwidth(l),p.diagnostics&&(p.diagnostics.reportedSendBandwidth=l)}))]):[2]}))}))},WebRtcSession2.prototype.onMaxVideoSendCapabilitiesChanged=function(l,d){var u=this;if(\"Video\"===l&&this.configProvider.config.maxSendVideoCapabilitiesReportingForVideoEnabled||\"ScreenShare\"===l&&this.configProvider.config.maxSendVideoCapabilitiesReportingForSharingEnabled)return this.isConnected()?void this.notifyMaxVideoCapabilitiesChanged(l,d):(this.logger.safe.info(\"sendMaxVideoSendCapabilities is postponed till transport is connected\"),void this.toBeCalledAfterConnected.push((function(){return u.notifyMaxVideoCapabilitiesChanged(l,d)})))},WebRtcSession2.prototype.notifyMaxVideoCapabilitiesChanged=function(l,d){var u=this.extensionsManager.getExtension(R.default.EXTENSION_TYPE.videoStreamControl),p=M.mediaTypeToModality(l),h=this.mediaManager.getMediaEntitiesByModality(p)[0];if(h){var g=h.getMid();u.sendMaxVideoSendCapabilities([g],d)}},WebRtcSession2.prototype.createAudioRenderer=function(){this.audioRenderer=new _.default(this.logger.createChild(\"AudioRenderer\"),this.configProvider),this.context.maContext.domOverrides.onMediaElementAdded&&this.audioRenderer.on(\"onAudioElementAdded\",this.context.maContext.domOverrides.onMediaElementAdded),this.context.maContext.domOverrides.onMediaElementRemoved&&this.audioRenderer.on(\"onAudioElementRemoved\",this.context.maContext.domOverrides.onMediaElementRemoved)},WebRtcSession2.prototype.getModalitiesForRollback=function(l){var d=M.removeChangedSendDirection(this.negotiatedModalities,this.negotiatingModalities);return this.logger.safe.debug(\"[\".concat(l,\"] configured modalities for rollback: \").concat(JSON.stringify(d))),d},WebRtcSession2.prototype.fixLocalDescription=function(l){this.configProvider.config.insertFakeCandidateIfNeeded&&(this.iceCandidateReceived||!this.iceCandidateReceived&&this.isConnected())&&l.insertFakeCandidateIfNeeded(this.statsGatherer.sessionInfo,this.diagnostics),this.unifiedPlanEnabled&&l.fixDataModality()},WebRtcSession2.prototype.getSessionConfig=function(){return this.configProvider},WebRtcSession2.prototype.getLocalMediaTrackId=function(l){var d=this.mediaManager.getLocalTracksInfo(),u=M.mediaTypeToModality(l),p=d.find((function(l){return l.modality===u}));return p?p.trackId:null},WebRtcSession2.prototype.addReceiveStreamTransforms=function(l,d){if(this.configProvider.config.useInsertableStreams){var u=[];d!==R.default.MODALITY.audio&&u.push(new B.VideoStreamAnalyzer(this.logger.createChild(\"RecvStreamAnalyzer [\".concat(d,\"/\").concat(l.track.id,\"]\")))),this.encStreamsManager.setupEncodedStream(l,u)}},WebRtcSession2.prototype.checkVideoCodecsSupport=function(){var l;return p(this,void 0,void 0,(function(){var d,u,p,f,m,v,y;return h(this,(function(h){switch(h.label){case 0:return[4,this.webrtcAdapter.RTCRtpReceiver.getCapabilities(\"video\")];case 1:d=h.sent(),this.statsGatherer.setH264AvailableProfiles(d),this.diagnostics&&(this.diagnostics.videoCapabilities=d),u=new Set((null===(l=null==d?void 0:d.codecs)||void 0===l?void 0:l.map((function(l){return l.mimeType.toLocaleLowerCase()})))||[]);try{for(p=g(this.configProvider.config.requiredVideoCodecs),f=p.next();!f.done;f=p.next())if(m=f.value,!u.has(m)){this.ufdManager.signalEvent(\"NoRequiredVideoCodecs\",\"Bad\",\"Video\");break}}catch(l){v={error:l}}finally{try{f&&!f.done&&(y=p.return)&&y.call(p)}finally{if(v)throw v.error}}return[2]}}))}))},WebRtcSession2.prototype.getMediaDescriptions=function(l){var d,u,p,h;if(M.isOnHold(l))return{};var m=[];try{for(var v=g([R.default.MODALITY.video,R.default.MODALITY.sharing]),y=v.next();!y.done;y=v.next()){var S=y.value;try{for(var _=(p=void 0,g(this.mediaManager.getMediaEntitiesByModality(S).entries())),C=_.next();!C.done;C=_.next()){var E=f(C.value,2),T=E[0],b={mid:E[1].getMid(),direction:0===T?l[S]:R.default.MEDIA_STATE.receive};m.push(b)}}catch(l){p={error:l}}finally{try{C&&!C.done&&(h=_.return)&&h.call(_)}finally{if(p)throw p.error}}}}catch(l){d={error:l}}finally{try{y&&!y.done&&(u=v.return)&&u.call(v)}finally{if(d)throw d.error}}return{descriptions:m}},WebRtcSession2.prototype.updateSendStreams=function(l){return p(this,void 0,void 0,(function(){var d,u;return h(this,(function(p){switch(p.label){case 0:return[4,this.assureStreamsAndDataChannel(this.configuredModalities,l)];case 1:return d=p.sent(),this.setNegotiatedModalities(d),u=this.getMediaDescriptions(d),this.callbacks.onUpdateMediaDescriptions&&this.callbacks.onUpdateMediaDescriptions(u,l),[2,d]}}))}))},WebRtcSession2}();d.default={build:function(l,d,u){return new ee(l,d,u)}}},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaConnection=void 0;var g=function(){function MediaConnection(l){this.peerConnection=l}return Object.defineProperty(MediaConnection.prototype,\"connectionState\",{get:function(){return this.peerConnection.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(MediaConnection.prototype,\"pc\",{get:function(){return this.peerConnection},enumerable:!1,configurable:!0}),MediaConnection.prototype.createSender=function(l,d,u){return p(this,void 0,void 0,(function(){return h(this,(function(u){return[2,this.peerConnection.addTrack(l,d)]}))}))},MediaConnection.prototype.removeSender=function(l){this.peerConnection.removeTrack(l)},MediaConnection}();d.MediaConnection=g;var f=function(){function TranscieverBasedConnection(l,d){this.peerConnection=l,this.tranceiverManager=d}return Object.defineProperty(TranscieverBasedConnection.prototype,\"connectionState\",{get:function(){return this.peerConnection.connectionState},enumerable:!1,configurable:!0}),Object.defineProperty(TranscieverBasedConnection.prototype,\"pc\",{get:function(){return this.peerConnection},enumerable:!1,configurable:!0}),TranscieverBasedConnection.prototype.createSender=function(l,d,u){return p(this,void 0,void 0,(function(){return h(this,(function(p){return[2,this.tranceiverManager.createSender(l,d,u)]}))}))},TranscieverBasedConnection.prototype.removeSender=function(l){return this.tranceiverManager.removeSender(l)},TranscieverBasedConnection}(),m=function(){function MediaConnectionFactory(){}return MediaConnectionFactory.build=function(l,d){return d?new f(l,d):new g(l)},MediaConnectionFactory}();d.default=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaManagerFactory=void 0;var p=u(157),h=u(425),g=function(){function MediaManagerFactory(){}return MediaManagerFactory.build=function(l){return l.unifiedPlanEnabled?new h.default(l):new p.default(l)},MediaManagerFactory}();d.MediaManagerFactory=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(65),h=u(3),g=u(9),f=u(426),m=u(158),v=u(39),y={toffset:\"toffset\",\"abs-send-time\":\"abs-send-time\",\"video-orientation\":\"video-orientation\",\"draft-holmer-rmcat-transport-wide-cc-extensions-01\":\"transport-cc\",\"video-content-type\":\"video-content-type\",\"video-timing\":\"video-timing\",\"color-space\":\"color-space\",\"video-layers-allocation00\":\"vla\",mid:\"mid\",\"rtp-stream-id\":\"rid\",\"repaired-rtp-stream-id\":\"rrid\",\"fast_bandwidth_feedback#version_3\":\"fast_bandwidth_feedback#version_3\",\"frame-counters-gvc\":\"frame-counters-gvc\"},S=function(){function MediaManager2(l){this.mediaEntities=[],this.mediaEntitiesBackup=[],this.mediaTracks=[],this.ssrcGenerator=new p.SsrcGenerator,this.logger=l.logger.createChild(\"MM2\"),this.configProvider=l.configProvider,this.useSimulcast=l.useSimulcast}return MediaManager2.prototype.fromOffer=function(l,d,u){var p=this;void 0===u&&(u=!1),this.updateMediaEntitiesFromModel(l,u),this.updateSharingEntity(!!d.sharing),l.media.forEach((function(l){var d=p.getMediaEntityByMid(l.mid);d&&p.saveLocalSsrc(d,l)}))},MediaManager2.prototype.fromRemote=function(l,d){var u=this;this.updateMediaEntitiesFromModel(l,!1),l.media.forEach((function(l,d){var p=u.getMediaEntityByMid(l.mid);if(p){u.saveRemoteMsid(p,l),u.saveRemoteSsrc(p,l),u.saveRtpHeaderExtensions(p,l);var h=l.xSourceStreamId||u.generateSourceStreamId(d);p.setXSourceStreamId(h)}}))},MediaManager2.prototype.isEmpty=function(){return 0===this.mediaEntities.length},MediaManager2.prototype.createMediaEntity=function(l,d){var u=m.default.create(this.configProvider,l,d);return this.useSimulcast&&!this.mediaEntities.find((function(d){return d.getModality()===l}))&&this.setSimulcastContext(u),this.mediaEntities.push(u),u},MediaManager2.prototype.getMediaEntities=function(){return this.mediaEntities},MediaManager2.prototype.getMediaEntity=function(l){return this.mediaEntities[l]},MediaManager2.prototype.getMediaEntityByMid=function(l){return this.mediaEntities.find((function(d){return d.getMid()===l}))},MediaManager2.prototype.getMediaEntitiesByModality=function(l){return this.mediaEntities.filter((function(d){return d.getModality()===l}))},MediaManager2.prototype.getMediaEntitiesByMediaType=function(l){var d=g.modalityToMediaType(l);return this.getMediaEntitiesByModality(d)},MediaManager2.prototype.getMediaEntityByRemoteStreamId=function(l){return this.mediaEntities.find((function(d){return d.getRemoteStreamId()===l}))},MediaManager2.prototype.getMediaEntityByLocalTrackId=function(l){return this.mediaEntities.find((function(d){return d.getLocalTrackId()===l}))},MediaManager2.prototype.getMediaEntityByXSourceStreamId=function(l){return this.mediaEntities.find((function(d){return d.getXSourceStreamId()===l}))},MediaManager2.prototype.reset=function(){this.mediaEntities=[]},MediaManager2.prototype.syncModalities=function(l,d,u){void 0===u&&(u=!1),this.fromOffer(l,d,u)},MediaManager2.prototype.setLocalTracksInfo=function(l){this.mediaTracks=l},MediaManager2.prototype.getLocalTracksInfo=function(){return this.mediaTracks},MediaManager2.prototype.backup=function(){var l=this;this.mediaEntitiesBackup=[],this.mediaEntities.forEach((function(d){l.mediaEntitiesBackup.push(d.clone())}))},MediaManager2.prototype.commit=function(){this.mediaEntitiesBackup=[],this.mediaEntities.forEach((function(l){l.setExtension(\"unnegotiatedModality\",!1)}))},MediaManager2.prototype.rollback=function(){var l=this;this.mediaEntitiesBackup.length&&this.mediaEntities.forEach((function(d,u){l.mediaEntitiesBackup[u]?l.mediaEntities[u]=l.mediaEntitiesBackup[u]:(d.disable(),d.setExtension(\"rollback\",!0))}))},MediaManager2.prototype.updateMediaEntitiesWithLocalTracks=function(){var l=this;this.mediaTracks&&(this.mediaEntities.forEach((function(l){return l.setLocalTrackId(null)})),this.mediaTracks.forEach((function(d){var u=l.getMediaEntitiesByModality(d.modality)[0];u?u.setLocalTrackId(d.trackId):l.logger.safe.error(\"Media entity is not found for modality: \".concat(JSON.stringify(d.modality)))})))},MediaManager2.prototype.updateMediaEntitiesWithActivityState=function(l,d){this.logger.safe.debug(\"Updating activity indexes for \".concat(l,\" to \").concat(JSON.stringify(d)));var u=g.mediaTypeToModality(l),p=this.getMediaEntitiesByModality(u)[0];if(p){var h=p.getSimulcastContext();h&&(h.activeRids=d)}else this.logger.safe.error(\"Media entity is not found for modality: \".concat(JSON.stringify(u)))},MediaManager2.prototype.saveRtpHeaderExtensions=function(l,d){var u,p=this,h=null===(u=d.ext)||void 0===u?void 0:u.map((function(l){return p.getHeaderExtension(l)}));this.logger.debug(\"RTP header ext: \".concat(JSON.stringify(h))),l.setRtpHeaderExtensions(h)},MediaManager2.prototype.getHeaderExtension=function(l){var d=\"unknown\";return Object.entries(y).forEach((function(u){var p=u[0],h=u[1];l.uri.includes(p)&&(d=h)})),{headerType:d,value:l.value}},MediaManager2.prototype.saveRemoteMsid=function(l,d){if(0===d.port)l.setRemoteStreamId(null);else if(d.msid)l.setRemoteStreamId(d.msid.split(\" \")[0]);else if(d.ssrcs){var u=d.ssrcs.find((function(l){return\"msid\"===l.attribute}));u?l.setRemoteStreamId(u.value.split(\" \")[0]):this.logger.safe.warn(\"No ssrc msid for media of type \".concat(d.type,\" with mid \").concat(d.mid))}},MediaManager2.prototype.saveRemoteSsrc=function(l,d){var u;if(null===(u=d.ssrcs)||void 0===u?void 0:u.length){var p=d.ssrcs[0];l.setRemoteSsrc(p.id)}},MediaManager2.prototype.saveLocalSsrc=function(l,d){var u,p,h=null===(p=null===(u=d.ssrcs)||void 0===u?void 0:u[0])||void 0===p?void 0:p.id;if(g.hasSendDirectionality(d.direction)){var f=h||l.getLocalSsrc()||this.ssrcGenerator.nextVideoStreamSsrc().min;l.setLocalSsrc(f)}else l.setLocalSsrc(h)},MediaManager2.prototype.updateMediaEntitiesFromModel=function(l,d){var u=this;l.media.forEach((function(l,p){u.mediaEntities[p]?0===l.port?u.mediaEntities[p].disable():u.mediaEntities[p].update(u.mediaEntities[p].getModality(),l.mid||u.mediaEntities[p].getMid()):d||u.createMediaEntity((0,v.getModality)(l),l.mid||p.toString())}))},MediaManager2.prototype.updateSharingEntity=function(l){if(l&&!this.getMediaEntitiesByModality(h.default.MODALITY.sharing).length){var d=this.getMediaEntitiesByModality(h.default.MODALITY.video).pop();d.update(h.default.MODALITY.sharing,d.getMid())}},MediaManager2.prototype.setSimulcastContext=function(l){if(l&&!l.getSimulcastContext()){var d=new f.SimulcastDataContext(l,this.logger.createChild(\"SimContext:\".concat(l.getModality())),this.configProvider);l.setSimulcastContext(d)}},MediaManager2.prototype.generateSourceStreamId=function(l){return l+10},MediaManager2}();d.default=S},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.SimulcastDataContext=void 0;var p=u(8),h=u(9),g=function(){function SimulcastDataContext(l,d,u){this.mediaEntity=l,this.logger=d,this.configProvider=u,this.activeRids=[],this.isLocalDescSet=!1,this.enabledLocally=!1,this.enabledRemotely=!1;var p=h.modalityToMediaType(this.mediaEntity.getModality());this.config=h.getSimulcastConfigForMediaType(p,this.configProvider),this.config?this.logger.safe.debug(\"Adding simulcast info to \".concat(l.getModality(),\" with mid: \").concat(l.getMid(),\", config: \").concat(JSON.stringify(this.config))):this.logger.safe.debug(\"Simulast is disabled for \".concat(l.getModality()))}return Object.defineProperty(SimulcastDataContext.prototype,\"ridList\",{get:function(){return this.config?(0,p.times)(this.config.layerScaleFactors.length,(function(l){return l+1})):[]},enumerable:!1,configurable:!0}),SimulcastDataContext.prototype.localDescriptionIsApplied=function(){this.isLocalDescSet=!0},SimulcastDataContext.prototype.enableInLocalDesc=function(){this.enabledLocally=!0},SimulcastDataContext.prototype.shouldBeEnabledInLocalDesc=function(){return!!this.config&&(this.config.enableLocally||this.enabledRemotely)},SimulcastDataContext.prototype.enableInRemoteDesc=function(){this.enabledRemotely=!0},SimulcastDataContext.prototype.shouldBeEnabledInRemoteDesc=function(){return!!this.config&&(this.enabledLocally||this.config.allowEnableRemotely&&this.isMidRidHeaderExtPresented()&&!this.isLocalDescSet)},SimulcastDataContext.prototype.shouldUseSimulcast=function(){return this.shouldBeEnabledInLocalDesc()},SimulcastDataContext.prototype.getSsrcRange=function(){return this.shouldUseSimulcast()?99:0},SimulcastDataContext.prototype.isMidRidHeaderExtPresented=function(){var l=this.mediaEntity.getRtpHeaderExtensions();return null==l?void 0:l.some((function(l){return\"mid\"===l.headerType||\"rid\"===l.headerType||\"rrid\"===l.headerType}))},SimulcastDataContext}();d.SimulcastDataContext=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.SessionDataChannel=void 0;var h=u(7),g=u(1),f=u(3),m=u(428),v=u(13),y=\"main-channel\",S=function(l){function SessionDataChannel(d,u,p){var h=l.call(this)||this;return h.pc=d,h.statsGatherer=u,h._state=\"Inactive\",h.logger=p.createChild(\"PluginlessDataChannel\"),h.subscribeOnDatachannel(),h}return p(SessionDataChannel,l),Object.defineProperty(SessionDataChannel.prototype,\"state\",{get:function(){return this._state},enumerable:!1,configurable:!0}),SessionDataChannel.prototype.getDataChannel=function(l){if(!this.dataChannel){this.logger.safe.info(\"[\".concat(l,\"] creating new dataChannel\"));try{var d={};this.dataChannel=new m.WebRtcDataChannel(this.pc.createDataChannel(y,d),this.statsGatherer,this.logger),this.subscribeForDataChannelEvents()}catch(d){return this.logger.safe.error(\"[\".concat(l,\"] createDataChannel failed: \").concat(g.stringifyObject(d))),this.statsGatherer.recordDataChannelCreationFailure(d),this.setState(\"Failed\"),null}}return this.dataChannel},SessionDataChannel.prototype.updateDataModalityState=function(l){\"Failed\"!==this._state&&(l===f.default.MEDIA_STATE.sendReceive?this.setState(\"Active\"):l===f.default.MEDIA_STATE.inactive&&this.setState(\"Inactive\"))},SessionDataChannel.prototype.dispose=function(){this.stopDataChannel(),this.pc=null,l.prototype.dispose.call(this)},SessionDataChannel.prototype.subscribeOnDatachannel=function(){var l=this;this.pc.ondatachannel=function(d){l.onDataChannel(d.channel)}},SessionDataChannel.prototype.onDataChannel=function(l){this.logger.safe.info(\"onDataChannel id=\".concat(l.id,\" label=\").concat(l.label)),l.id%2==0?this.dataChannel?(this.logger.safe.info(\"Found existing data channel, replacing\"),this.dataChannel.setDataChannel(l)):(this.dataChannel=new m.WebRtcDataChannel(l,this.statsGatherer,this.logger),this.subscribeForDataChannelEvents()):this.logger.safe.info(\"onDataChannel ignoring id \".concat(l.id))},SessionDataChannel.prototype.subscribeForDataChannelEvents=function(){var l=this;this.dataChannel.on(\"onStateChanged\",(function(){\"Closed\"===l.dataChannel.state&&(l.stopDataChannel(),l.setState(\"Inactive\"))}))},SessionDataChannel.prototype.setState=function(l){if(this._state!==l){this.statsGatherer.setSessionDataChannelState(l);var d=(0,v.generateCauseId)();this._state=l,this.logger.safe.info(\"[\".concat(d,\"] SessionDataChannelState changed, state=\").concat(this._state)),\"Inactive\"===this._state?this.stopDataChannel():\"Active\"===this._state&&this.getDataChannel(d),this.event(\"onStateChanged\").raise(this._state)}},SessionDataChannel.prototype.stopDataChannel=function(){this.dataChannel&&(this.logger.safe.info(\"stopDataChannel\"),this.dataChannel.dispose(),this.dataChannel=null)},SessionDataChannel}(h.default);d.SessionDataChannel=S},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.WebRtcDataChannel=void 0;var g=u(7),f=u(1),m=function(){function Depacketizer(l,d,u){this.dataId=l,this.statsGatherer=d,this.logger=u,this.pendingFragments=[]}return Depacketizer.prototype.depacketize=function(l){var d,u,p=63&l[2];if(p!==this.dataId)throw new Error(\"Invalid packet dataId: \".concat(this.dataId,\" !== \").concat(p));var g=11,f=((15&l[0])<<8)+l[1],m=128&l[2],v=(l[3]<<8>>>0)+l[4],y=l[5],S=(l[6]<<24>>>0)+(l[7]<<16>>>0)+(l[8]<<8>>>0)+l[9],_=l[10];if(this.nextSeqNum&&this.nextSeqNum!==v&&this.statsGatherer.recordDataChannelProtocolEvent({direction:\"recv\",dataId:p,isOutOfOrder:!0}),m){this.pendingFragments.length&&this.logger.warn(\"Unfinished message: dataId: \".concat(this.dataId,\" seqNum: \").concat(v)),this.remainingPackets=y,this.pendingFragments=[],this.sourceId=S,this.recipients=[];for(var C=0;C<_;C++){var E=g+4*C,T=(l[E]<<24>>>0)+(l[E+1]<<16>>>0)+(l[E+2]<<8>>>0)+l[E+3];this.recipients.push(T)}}else{if(this.statsGatherer.recordDataChannelProtocolEvent({direction:\"recv\",dataId:p,isFragmented:!0}),0===this.pendingFragments.length)throw new Error(\"No start flag dataId: \".concat(this.dataId,\" seqNum: \").concat(v));if(this.nextSeqNum!==v)throw new Error(\"Invalid sequence number: dataId: \".concat(this.dataId,\" seqNum: \").concat(v));this.remainingPackets-=1,this.remainingPackets!==y&&this.logger.warn(\"Invalid remainingPackets: dataId: \".concat(this.dataId,\" remainingPackets: \").concat(y,\" !== \").concat(this.remainingPackets))}if(this.nextSeqNum=v+1&65535,this.pendingFragments.push(l.slice(f)),0===this.remainingPackets){var b=this.pendingFragments.reduce((function(l,d){return l+d.length}),0),I=new Uint8Array(b),A=0;try{for(var R=h(this.pendingFragments),P=R.next();!P.done;P=R.next()){var O=P.value;I.set(O,A),A+=O.length}}catch(l){d={error:l}}finally{try{P&&!P.done&&(u=R.return)&&u.call(R)}finally{if(d)throw d.error}}return this.pendingFragments=[],{dataId:this.dataId,sourceId:this.sourceId,data:I,recipients:this.recipients}}return null},Depacketizer}(),v=function(){function Packetizer(l){this.seqNum=0,this.dataId=l}return Packetizer.prototype.packetize=function(l){if(l.dataId!==this.dataId)throw new Error(\"Invalid dataId: \".concat(this.dataId,\" !== \").concat(l.dataId));var d=11,u=d+4*l.recipients.length,p=new Uint8Array(l.data.length+u);p[0]=16+(u>>8),p[1]=255&u,p[2]=128|63&l.dataId,p[3]=255&this.seqNum,p[4]=this.seqNum>>8&255,p[5]=0,p[6]=l.sourceId>>24&255,p[7]=l.sourceId>>16&255,p[8]=l.sourceId>>8&255,p[9]=255&l.sourceId,p[10]=l.recipients.length;for(var h=0;h<l.recipients.length;h++){var g=d+4*h;p[g]=l.recipients[h]>>24&255,p[g+1]=l.recipients[h]>>16&255,p[g+2]=l.recipients[h]>>8&255,p[g+3]=255&l.recipients[h]}return p.set(l.data,u),this.seqNum+=1,[p]},Packetizer}(),y=function(l){function WebRtcDataChannel(d,u,p){var h=l.call(this)||this;return h.dataChannel=d,h.statsGatherer=u,h.stateInternal=\"Created\",h.packetizers=new Map,h.depacketizers=new Map,h.label=d.label,h.logger=p.createChild(\"[WebRtcDataChannel \".concat(h.label,\"]\")),h.subscribeOnDataChannelEvents(),h}return p(WebRtcDataChannel,l),Object.defineProperty(WebRtcDataChannel.prototype,\"state\",{get:function(){return this.stateInternal},enumerable:!1,configurable:!0}),WebRtcDataChannel.prototype.setDataChannel=function(l){this.dataChannel&&(this.logger.info(\"Replacing internal data channel \".concat(this.label,\":\").concat(this.dataChannel.id,\" with \").concat(l.label,\":\").concat(l.id)),this.unsubscribeOnDataChannelEvents(),this.dataChannel.close()),this.dataChannel=l,this.subscribeOnDataChannelEvents()},WebRtcDataChannel.prototype.dispose=function(){this.logger.info(\"dispose\"),this.dataChannel&&(this.logger.info(\"dataChannel.close \".concat(this.dataChannel.id)),this.dataChannel.close(),this.dataChannel=null,this.setState(\"Destroyed\"),l.prototype.dispose.call(this))},WebRtcDataChannel.prototype.sendMessage=function(l,d,u,p){var h=this;void 0===p&&(p=[]);var g=!1;try{this.packetizers.has(l)||this.packetizers.set(l,new v(l)),this.packetizers.get(l).packetize({dataId:l,sourceId:d,data:u,recipients:p}).forEach((function(l){h.dataChannel.send(l)}))}catch(l){this.logger.safe.warn(\"Failed to send or construct protocol message: \".concat(f.stringifyObject(l))),g=!0}this.statsGatherer.recordDataChannelProtocolEvent({direction:\"send\",parsedSuccessfully:!g,dataId:l})},WebRtcDataChannel.prototype.subscribeOnDataChannelEvents=function(){var l=this;this.dataChannel.binaryType=\"arraybuffer\",this.dataChannel.onmessage=function(d){var u=!1,p=new Uint8Array(d.data),h=63&p[2];try{l.depacketizers.has(h)||l.depacketizers.set(h,new m(h,l.statsGatherer,l.logger));var g=l.depacketizers.get(h).depacketize(p);g&&l.event(\"onmessage\").raise(h,g.sourceId,g.data)}catch(d){l.logger.safe.warn(\"Failed to parse incoming message: \".concat(f.stringifyObject(d))),u=!0}l.statsGatherer.recordDataChannelProtocolEvent({direction:\"recv\",parsedSuccessfully:!u,dataId:h})},this.dataChannel.onerror=function(d){var u,p=null==d?void 0:d.target;l.logger.safe.warn(\"onerror: label:\".concat(p.label,\" id:\").concat(p.id,\" \").concat(f.stringifyObject(null!==(u=null==d?void 0:d.error)&&void 0!==u?u:d),\" \"))},\"open\"===this.dataChannel.readyState&&this.dataChannel.id%2==0&&(this.logger.safe.info(\"readyState is already 'open' label:\".concat(this.dataChannel.label,\" id:\").concat(this.dataChannel.id)),this.setState(\"Connected\")),this.dataChannel.onopen=function(d){var u=d.target;l.logger.safe.info(\"onopen label:\".concat(u.label,\" id:\").concat(u.id)),u.id%2==0&&l.setState(\"Connected\")},this.dataChannel.onclose=function(d){var u=d.target;l.logger.safe.info(\"onclose label:\".concat(u.label,\" id:\").concat(u.id)),l.setState(\"Closed\")},this.dataChannel.onclosing=function(d){var u=d.target;l.logger.safe.debug(\"onclosing label:\".concat(u.label,\" id:\").concat(u.id)),l.setState(\"Closed\")}},WebRtcDataChannel.prototype.unsubscribeOnDataChannelEvents=function(){this.dataChannel.onmessage=null,this.dataChannel.onerror=null,this.dataChannel.onopen=null,this.dataChannel.onclose=null,this.dataChannel.onclosing=null,this.dataChannel.onbufferedamountlow=null},WebRtcDataChannel.prototype.setState=function(l){this.stateInternal=l,this.event(\"onStateChanged\").raise()},WebRtcDataChannel}(g.default);d.WebRtcDataChannel=y},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},g=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},m=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var v=u(8),y=u(15),S=u(3),_=u(9),C=u(27),E=[S.default.MODALITY.audio,S.default.MODALITY.video,S.default.MODALITY.sharing],T=function(){function TransceiverManager(l,d,u,p){this.peerConnection=d,this.mediaManager=u,this.entityTransceiverMap=new Map,this.logger=l.createChild(\"TM\"),this.configProvider=p.configProvider,this.isMultiparty=p.config.isConference,this.numVideoChannels=this.isMultiparty&&this.configProvider.config.numVideoChannelsGvc||1}return TransceiverManager.prototype.getTransceivers=function(){return this.peerConnection.getTransceivers().filter(isActiveTransceiver)},TransceiverManager.prototype.assureTransceivers=function(l){this.assureNegotiatedOrder(),this.addModalities(l),this.logTransceiversInfo(\"assureTransceivers\"),this.setDirections(l)},TransceiverManager.prototype.syncTransceivers=function(l){this.syncWithMediaEntities(),this.setDirections(l)},TransceiverManager.prototype.assureNegotiatedOrder=function(){var l=this,d=this.getTransceivers();this.mediaManager.getMediaEntities().forEach((function(u){-1!==E.indexOf(u.getModality())&&(isActiveTransceiverInPc(l.entityTransceiverMap.get(u),d)||l.createTransceiverForEntity(u))}))},TransceiverManager.prototype.addModalities=function(l){var d,u,p=this;!this.isMultiparty&&this.mediaManager.isEmpty()&&(l.video=l.video||\"inactive\",l.sharing=l.sharing||\"inactive\");var _loop_1=function(d){if(h.mediaManager.getMediaEntities().find((function(l){return d===l.getModality()}))||!l[d])return\"continue\";var u=d===S.default.MODALITY.video?h.numVideoChannels:1;v.times(u,(function(){p.createTransceiverForEntity(p.mediaManager.createMediaEntity(d))}))},h=this;try{for(var f=g(E),m=f.next();!m.done;m=f.next()){_loop_1(m.value)}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=f.return)&&u.call(f)}finally{if(d)throw d.error}}},TransceiverManager.prototype.createTransceiverForEntity=function(l){var d=l.getModality();this.logger.safe.info(\"createTransceiver: modality=\".concat(d));var u=d===S.default.MODALITY.audio?S.default.MEDIA_TYPE.audio:S.default.MEDIA_TYPE.video,p=l.getSimulcastContext(),h=this.createTransceiver(u,p);this.setCodecPreferences(h,u,!0),this.entityTransceiverMap.set(l,h),l.setExtension(\"unnegotiatedModality\",!0)},TransceiverManager.prototype.setCodecPreferences=function(l,d,u){var p,h,v,S,E=_.getAllowedCodecs(this.configProvider,d);if((null==E?void 0:E.length)&&C.UserAgentConfig.hasCapabilitiesApi()&&!this.configProvider.config.filterCodecsInSdp){var T=y.default.window.RTCRtpReceiver.getCapabilities(d);if(T){var b=[];if(u){var _loop_2=function(l){var d=T.codecs.filter((function(d){return isCodecsMatch(l,d)}));b.push.apply(b,m([],f(d),!1))};try{for(var I=g(E),A=I.next();!A.done;A=I.next()){_loop_2(A.value)}}catch(l){p={error:l}}finally{try{A&&!A.done&&(h=I.return)&&h.call(I)}finally{if(p)throw p.error}}}else{var _loop_3=function(l){E.some((function(d){return isCodecsMatch(d,l)}))&&b.push(l)};try{for(var R=g(T.codecs),P=R.next();!P.done;P=R.next()){_loop_3(P.value)}}catch(l){v={error:l}}finally{try{P&&!P.done&&(S=R.return)&&S.call(R)}finally{if(v)throw v.error}}}b.length&&l.setCodecPreferences&&l.setCodecPreferences(b)}}},TransceiverManager.prototype.createSender=function(l,d,u){return p(this,void 0,void 0,(function(){var p;return h(this,(function(h){switch(h.label){case 0:return[4,this.assosiateTrackWithTransceiver(l,d,u)];case 1:if(!(p=h.sent()))throw new Error(\"Transceiver for modality=\".concat(u,\" is not found\"));return p.direction=u===S.default.MODALITY.sharing?S.default.MEDIA_STATE.send:S.default.MEDIA_STATE.sendReceive,this.logger.safe.info(\"Replace track completed direction:\".concat(p.direction,\" for transceiver mid=\").concat(p.mid)),[2,p.sender]}}))}))},TransceiverManager.prototype.removeSender=function(l){var d,u,p=this.getTransceivers().find((function(d){return d.sender===l}));if(!p)throw new Error(\"Transceiver for sender with track=\".concat(null===(d=l.track)||void 0===d?void 0:d.id,\" is not found\"));this.logger.safe.info(\"Remove sender with track=\".concat(null===(u=l.track)||void 0===u?void 0:u.id,\" for transceiver mid=\").concat(p.mid)),this.peerConnection.removeTrack(l)},TransceiverManager.prototype.createTransceiver=function(l,d){var u={direction:\"inactive\"};return this.addSimulcastEnvelopeIfNeeded(u,d),this.peerConnection.addTransceiver(l,u)},TransceiverManager.prototype.addSimulcastEnvelopeIfNeeded=function(l,d){var u=this;(null==d?void 0:d.shouldUseSimulcast())&&(l.sendEncodings=v.times(d.config.layerScaleFactors.length,(function(l){var p=\"\".concat(d.ridList[l]),h=d.config.layerScaleFactors[l];return u.logger.safe.debug(\"Added layer \".concat(l,\" with rid: \").concat(p,\" SF: \").concat(h)),{rid:p,scaleResolutionDownBy:h}})))},TransceiverManager.prototype.assosiateTrackWithTransceiver=function(l,d,u){return p(this,void 0,void 0,(function(){var p,g;return h(this,(function(h){switch(h.label){case 0:if(!(p=this.findAvailableTransceiverToSend(u)))return[3,5];this.logger.safe.info(\"Associate track=\".concat(null==l?void 0:l.id,\" (\").concat(u,\") with existing transceiver mid=\").concat(p.mid)),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,p.sender.replaceTrack(l)];case 2:return h.sent(),this.configProvider.config.useSetStreamsForSender&&p.sender.setStreams&&p.sender.setStreams(d),[3,4];case 3:throw g=h.sent(),this.logger.safe.error(\"replaceTrack failed, err \".concat(JSON.stringify(g))),g;case 4:return[2,p];case 5:return[2,null]}}))}))},TransceiverManager.prototype.syncWithMediaEntities=function(){var l=this,d=this.getTransceivers();this.mediaManager.getMediaEntities().forEach((function(u){var p=l.entityTransceiverMap.get(u);p=isActiveTransceiverInPc(p,d)?p:d.find((function(l){return l.mid===u.getMid()})),l.entityTransceiverMap.set(u,p)})),this.logTransceiversInfo(\"syncWithMediaEntities\")},TransceiverManager.prototype.getTransceiversByModality=function(l){var d=this;return this.mediaManager.getMediaEntitiesByModality(l).map((function(l){return d.entityTransceiverMap.get(l)})).filter(isActiveTransceiver)},TransceiverManager.prototype.setDirections=function(l){var d,u,p=this.configProvider.config.enableReinviteless&&!_.isOnHold(l),_loop_4=function(d){h.getTransceiversByModality(d).forEach((function(u,h){if(p&&d!==S.default.MODALITY.audio)u.direction=\"sendrecv\";else{var g=l[d]||S.default.MEDIA_STATE.inactive;u.direction=0===h?g:removeSendDirectionality(g)}}))},h=this;try{for(var f=g(E),m=f.next();!m.done;m=f.next()){_loop_4(m.value)}}catch(l){d={error:l}}finally{try{m&&!m.done&&(u=f.return)&&u.call(f)}finally{if(d)throw d.error}}this.logTransceiversInfo(\"setDirections\")},TransceiverManager.prototype.findAvailableTransceiverToSend=function(l){var d=this.mediaManager.getMediaEntitiesByModality(l)[0];return this.entityTransceiverMap.get(d)},TransceiverManager.prototype.logTransceiversInfo=function(l){var d,u,p=\"\".concat(l,\": transceivers details:\");try{for(var h=g(E),f=h.next();!f.done;f=h.next()){var m=f.value,v=this.getTransceiversByModality(m);p+=\" \".concat(m,\"(\").concat(v.length,\") [\").concat(v.map((function(l){return\"mid=\".concat(l.mid,\", direction=\").concat(l.direction)})).join(\";\"),\"]\")}}catch(l){d={error:l}}finally{try{f&&!f.done&&(u=h.return)&&u.call(h)}finally{if(d)throw d.error}}this.logger.safe.debug(p)},TransceiverManager}();function isCodecsMatch(l,d){return!(!v.isUndefined(l.channels)&&l.channels!==d.channels)&&(!(!v.isUndefined(l.clockRate)&&l.clockRate!==d.clockRate)&&(!(!v.isUndefined(l.mimeType)&&l.mimeType.toLowerCase()!==d.mimeType.toLowerCase())&&!(!v.isUndefined(l.sdpFmtpLine)&&-1===d.sdpFmtpLine.toLowerCase().indexOf(l.sdpFmtpLine.toLowerCase()))))}function removeSendDirectionality(l){var d=l;return _.hasSendDirectionality(l)&&(d=_.removeSendDirectionality(l)),d||S.default.MEDIA_STATE.inactive}function isActiveTransceiver(l){return l&&\"stopped\"!==l.direction&&!l.stopped}function isActiveTransceiverInPc(l,d){return isActiveTransceiver(l)&&-1!==d.indexOf(l)}d.default=T},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.EncodedStreamsManager=void 0;var h=function(){function EncodedStreamsManager(l){this.configProvider=l,this.setupList=new Set}return EncodedStreamsManager.prototype.setupEncodedStream=function(l,d){var u,h;if(!this.configProvider.config.useInsertableStreams||!l.createEncodedStreams)return null;if(!this.setupList.has(l)){var g=l.createEncodedStreams();this.setupList.add(l);var f=g.readable;try{for(var m=p(d),v=m.next();!v.done;v=m.next()){var y=v.value;f=f.pipeThrough(y.getTransform())}}catch(l){u={error:l}}finally{try{v&&!v.done&&(h=m.return)&&h.call(m)}finally{if(u)throw u.error}}f.pipeTo(g.writable)}},EncodedStreamsManager.prototype.dispose=function(){this.setupList.clear()},EncodedStreamsManager}();d.EncodedStreamsManager=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},m=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))},v=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.StreamSendersManager=void 0;var y=u(7),S=u(30),_=u(140),C=u(1),E=u(3),T=u(9),b=u(164),I=u(432),A=u(438),R=u(141),P=function(l){function StreamSendersManager(d,u,p,h,g,f,m,v){var y,C=l.call(this)||this;return C.mediaManager=d,C.logger=u,C.configProvider=h,C.statisticsGatherer=g,C.diagnostics=f,C.isMultiparty=m,C.encStreamsManager=v,C.senders=new Map,C.previousMediaModalitites=((y={}).Audio=!1,y.Video=!1,y.ScreenShare=!1,y),C.serialQueue=new S.PromiseQueue(C.logger),C.muted=new Map([[\"Audio\",!1],[\"Video\",!1]]),C.subs=new Map,C.senderId=0,C.streamsProvider=new _.SessionStreamsProvider(p,C.serialQueue,C.logger.createChild(\"StreamsProvider\")),C.subscribeToStreamProviderEvents(),C.localVideoStreamWatcher=new b.LocalVideoStreamWatcher(g,C.logger,C.configProvider),C.subscribeToStreamWatcherEvents(),C.configProvider.config.useMediaQualityController&&(C.mediaQualityController=new I.MediaQualityController(C.statisticsGatherer,C.configProvider,C.logger.createChild(\"MQC\")),C.mediaQualityController.on(\"onLayoutsUpdated\",(function(l){return C.updateLayouts(l)}))),C}return p(StreamSendersManager,l),StreamSendersManager.prototype.dispose=function(){var d,u=this;this.senders.forEach((function(l,d){u.event(\"onSendStreamChanged\").raise(null,d),l.dispose()})),this.senders.clear(),this.subs.forEach((function(l){return l.forEach((function(l){return l.dispose()}))})),this.subs.clear(),this.mediaConnection=null,this.unsubscribeFromStreamProviderEvents(),this.streamsProvider.stop(),this.streamsProvider=null,this.localVideoStreamWatcher.dispose(),this.localVideoStreamWatcher=null,this.mediaManager=null,this.logger=null,null===(d=this.mediaQualityController)||void 0===d||d.dispose(),this.mediaQualityController=null,l.prototype.dispose.call(this)},StreamSendersManager.prototype.registerMediaConnection=function(l){this.mediaConnection=l},StreamSendersManager.prototype.useNullAudioStreamClient=function(){this.streamsProvider.useNullAudioStreamClient()},StreamSendersManager.prototype.injectMediaStreamTrack=function(l,d){if(\"Audio\"===l){var u=this.senders.get(\"Audio\");u?(u.injectStreamTrack(d),this.streamsProvider.requestStreamUpdate(l,!0)):this.logger.safe.debug(\"audioSender not found\")}else this.logger.safe.debug(\"Not implemented yet for \".concat(l))},StreamSendersManager.prototype.update=function(l,d){return h(this,void 0,void 0,(function(){var u,p;return g(this,(function(h){switch(h.label){case 0:return u=T.getSendMediaModalities(l),[4,this.updateStreams(u)];case 1:return p=h.sent(),[4,this.updateSenders()];case 2:return h.sent(),this.applyMuteState(d,!0),this.setAndUpdateLocalTracksInfo(!1),this.previousMediaModalitites=C.shallowClone(p),[2,T.mergeSendModalities(l,this.previousMediaModalitites)]}}))}))},StreamSendersManager.prototype.activate=function(){return h(this,void 0,void 0,(function(){var l=this;return g(this,(function(d){switch(d.label){case 0:return[4,Promise.all(m([],f(this.senders.values()),!1).map((function(d){return h(l,void 0,void 0,(function(){return g(this,(function(l){return[2,d.activate()]}))}))})))];case 1:return d.sent(),[2]}}))}))},StreamSendersManager.prototype.applyCapabilities=function(l,d,u){return h(this,void 0,void 0,(function(){var p,h;return g(this,(function(g){return this.logger.safe.info(\"[\".concat(l,\"] Applying incoming \").concat(d,\" FMTP: \").concat(JSON.stringify(u))),p=T.modalityToMediaType(d),this.lastCauseId=l,h=u,this.mediaQualityController&&(this.mediaQualityController.addReceiver(p,u),h=this.mediaQualityController.getLayouts(p)),[2,this.updateParameters(l,p,h)]}))}))},StreamSendersManager.prototype.getLocalMediaSources=function(){var l=this,d=this.getTracksInfo(),u=[];return d.forEach((function(d){u.some((function(l){return l.modality===d.modality}))||u.push({sourceId:l.getSourceIdForTrack(d),modality:d.modality})})),u},StreamSendersManager.prototype.setMuted=function(l,d,u){this.muted.set(l,d),this.applyMuteState(u,!1)},StreamSendersManager.prototype.setHold=function(l,d){return h(this,void 0,void 0,(function(){var u=this;return g(this,(function(p){switch(p.label){case 0:return[4,Promise.all(m([],f(this.senders.values()),!1).map((function(p){return h(u,void 0,void 0,(function(){return g(this,(function(u){return[2,p.setHold(l,d)]}))}))})))];case 1:return p.sent(),[2]}}))}))},StreamSendersManager.prototype.updateParameters=function(l,d,u){var p,f;return h(this,void 0,void 0,(function(){var h,m;return g(this,(function(g){switch(g.label){case 0:return g.trys.push([0,2,,3]),[4,this.applyCapabilitiesForMediaType(d,u)];case 1:return g.sent(),this.logger.safe.debug(\"[\".concat(l,\"] Capabilities completed\")),m={modality:T.mediaTypeToModality(d),causeId:l,capabilities:u},this.statisticsGatherer.onMaxCapabilitiesApplied(m),null===(p=this.diagnostics)||void 0===p||p.onMaxCapabilitiesApplied(m),[3,3];case 2:return h=g.sent(),this.logger.safe.error(\"[\".concat(l,\"] Error applying capabilities \").concat(C.stringifyObject(h))),m={modality:T.mediaTypeToModality(d),causeId:l,capabilities:u,error:h},this.statisticsGatherer.onMaxCapabilitiesApplied(m),null===(f=this.diagnostics)||void 0===f||f.onMaxCapabilitiesApplied(m),[3,3];case 3:return[2]}}))}))},StreamSendersManager.prototype.applyCapabilitiesForMediaType=function(l,d){return h(this,void 0,void 0,(function(){var u;return g(this,(function(p){return(u=this.senders.get(l))?[2,u.updateParameters(d)]:(this.logger.safe.info(\"[\".concat(this.lastCauseId,\"] Capabilities ignored \").concat(JSON.stringify(d),\" ignored, no sender for media type \").concat(JSON.stringify(l))),[2])}))}))},StreamSendersManager.prototype.applyMuteState=function(l,d){var u,p;try{for(var h=v(this.muted),g=h.next();!g.done;g=h.next()){var m=f(g.value,2),y=m[0],S=m[1];this.senders.get(y)&&this.senders.get(y).setMuted(S,l,d)}}catch(l){u={error:l}}finally{try{g&&!g.done&&(p=h.return)&&p.call(h)}finally{if(u)throw u.error}}},StreamSendersManager.prototype.setAndUpdateLocalTracksInfo=function(l){var d=this.getTracksInfo();this.mediaManager.setLocalTracksInfo(d),l&&(this.mediaManager.updateMediaEntitiesWithLocalTracks(),this.configProvider.config.mapSsrcToTrackForStats&&this.statisticsGatherer.updateStatsWithLocalSsrcTrackInfo())},StreamSendersManager.prototype.getTracksInfo=function(){var l=[];return this.senders.forEach((function(d){l.push(d.getTrackInfo())})),l},StreamSendersManager.prototype.updateStreams=function(l){return h(this,void 0,void 0,(function(){var d;return g(this,(function(u){switch(u.label){case 0:return[4,this.streamsProvider.start(l)];case 1:return d=u.sent(),this.logger.safe.info(\"Streams updated, modalities requested: \".concat(JSON.stringify(l),\", result: \").concat(JSON.stringify(d))),[2,d]}}))}))},StreamSendersManager.prototype.updateSenders=function(){return h(this,void 0,void 0,(function(){var l,d=this;return g(this,(function(u){switch(u.label){case 0:return l=T.sendStreamsToModalities(this.streamsProvider.streams),[4,Promise.all(C.keys(l).map((function(u){return h(d,void 0,void 0,(function(){var d,p,h;return g(this,(function(g){switch(g.label){case 0:return d=l[u],p=this.previousMediaModalitites[u],d===p?(this.logger.safe.info(\"Sender for mediaType: \".concat(JSON.stringify(u),\" are not changed\")),[2]):d?[3,2]:(this.logger.safe.info(\"Removing sender for mediaType: \".concat(JSON.stringify(u))),[4,this.removeSender(u)]);case 1:return g.sent(),[2];case 2:return h=this.streamsProvider.streams[u],[4,this.createAndStartSender(h,u)];case 3:return g.sent(),this.logger.safe.info(\"Sender for mediaType: \".concat(JSON.stringify(u),\" is added\")),this.addAudioSharingStream(h),this.event(\"onSendStreamChanged\").raise(h,u),[2]}}))}))})))];case 1:return u.sent(),this.logger.safe.info(\"Senders updated\"),[2]}}))}))},StreamSendersManager.prototype.createAndStartSender=function(l,d){var u=this;if(this.senders.get(d))throw new Error(\"Sender already created, modality: \".concat(JSON.stringify(d)));var p=this.mediaManager.getMediaEntitiesByModality(T.mediaTypeToModality(d))[0],h=null==p?void 0:p.getSimulcastContext(),g=\"Audio\"===d||!this.isMultiparty||!!(null==h?void 0:h.shouldUseSimulcast()),f=new A.SimulcastStreamSender(this.mediaConnection,l,new MediaStream,d,this.serialQueue,this.logger.createChild(\"Sender_\".concat(JSON.stringify(d),\":\").concat(this.senderId++)),this.configProvider,g,this.encStreamsManager,h);this.senders.set(d,f);var m=[f.on(\"onSendersChanged\",(function(l,d){return u.onSenderStateChanged(l,d)})),f.on(\"onNewStreamNeeded\",(function(){return u.streamsProvider.requestStreamUpdate(d,!0)}))];return this.subs.set(f,m),f.start()},StreamSendersManager.prototype.removeSender=function(l){var d;return h(this,void 0,void 0,(function(){var u;return g(this,(function(p){switch(p.label){case 0:return this.senders.has(l)?(this.event(\"onSendStreamChanged\").raise(null,l),[4,(u=this.senders.get(l)).dispose()]):[3,2];case 1:p.sent(),this.senders.delete(l),this.subs.get(u).forEach((function(l){return l.dispose()})),this.subs.delete(u),this.logger.safe.info(\"Removed sender with mediaType: \".concat(JSON.stringify(l))),p.label=2;case 2:return null===(d=this.mediaQualityController)||void 0===d||d.removeReceiver(l),[2]}}))}))},StreamSendersManager.prototype.updateLayouts=function(l){return h(this,void 0,void 0,(function(){var d;return g(this,(function(u){return d=this.mediaQualityController.getLayouts(l),this.logger.safe.debug(\"Update layouts for \".concat(l,\": \").concat(JSON.stringify(d))),[2,this.updateParameters(this.lastCauseId,l,d)]}))}))},StreamSendersManager.prototype.getSourceIdForTrack=function(l){var d=l.trackId,u=this.mediaManager.getMediaEntityByLocalTrackId(d);return u?(this.logger.safe.info(\"Media entity found: \".concat(JSON.stringify(u.getXSourceStreamId()))),u.getXSourceStreamId()):(this.logger.safe.error(\"Media entity is not found for stream: \".concat(JSON.stringify(d))),0)},StreamSendersManager.prototype.subscribeToStreamProviderEvents=function(){var l=this;this.streamProviderSubscriptions=[this.streamsProvider.on(\"onStreamAdded\",(function(d){return l.onStreamUpdated(d,!1)})),this.streamsProvider.on(\"onStreamUpdated\",(function(d){return l.onStreamUpdated(d,!0)}))]},StreamSendersManager.prototype.unsubscribeFromStreamProviderEvents=function(){this.streamProviderSubscriptions.forEach((function(l){return l.dispose()})),this.streamProviderSubscriptions=null},StreamSendersManager.prototype.subscribeToStreamWatcherEvents=function(){var l=this;this.localVideoStreamWatcher.on(\"onVideoCaptureFreeze\",(function(d){l.event(\"onVideoCaptureFreeze\").raise(d)}))},StreamSendersManager.prototype.onStreamUpdated=function(l,d){return h(this,void 0,void 0,(function(){var u;return g(this,(function(p){switch(p.label){case 0:return this.senders.has(l)?((u=this.streamsProvider.streams[l])||(this.logger.safe.info(\"Stream is missing for mediaType: \".concat(l,\", using fake stream...\")),u=new R.NullStreamClient(l,this.logger.createChild(\"NullStreamClient\"))),this.event(\"onSendStreamChanged\").raise(u,l),[4,this.senders.get(l).updateStream(u)]):(this.logger.safe.warn(\"Sender with media type \".concat(l,\" does not exist, do not update media stream\")),[2]);case 1:return p.sent(),this.setAndUpdateLocalTracksInfo(d),[2]}}))}))},StreamSendersManager.prototype.onSenderStateChanged=function(l,d){if(this.mediaManager&&this.mediaManager.updateMediaEntitiesWithActivityState(l.mediaType,l.getActiveStreamIndexes()),this.statisticsGatherer.onSendersChanged(l.mediaType,d),\"Video\"===l.mediaType)if(d){var u=this.getTracksInfo().filter((function(l){return l.modality===E.default.MODALITY.video}));this.localVideoStreamWatcher.startWatching(u)}else this.localVideoStreamWatcher.stopWatching()},StreamSendersManager.prototype.addAudioSharingStream=function(l){var d;\"ScreenShare\"===l.mediaType&&l.hasAudio()&&(null===(d=this.senders.get(\"Audio\"))||void 0===d||d.addAdditionalStream(l))},StreamSendersManager}(y.default);d.StreamSendersManager=P},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")},g=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f};Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaQualityController=void 0;var f=u(7),m=u(433),v=u(161),y=u(434),S=function(l){function MediaQualityController(d,u,p){var h=l.call(this)||this;return h.statisticsGatherer=d,h.configProvider=u,h.logger=p,h.bandwidthAllocator=null,h.bandwidthCalculator=new v.SendBandwidthCalculator(h.configProvider,h.statisticsGatherer,h.logger.createChild(\"SendBandwidthCalculator\")),h.layoutProviders=new Map,h.bandwidthAllocator=(0,m.createBandwidthAllocatorPerMediaType)(h.logger,h.configProvider),h.bandwidthCalculator.on(\"onSendBandwidthChanged\",(function(l){return h.bandwidthAllocator.setAvailableBandwidth(l)})),h.bandwidthAllocator.on(\"onBandwidthDistributionUpdated\",(function(){return h.updateBandwidthDistribution()})),h}return p(MediaQualityController,l),MediaQualityController.prototype.dispose=function(){var d,u;null===(d=this.bandwidthCalculator)||void 0===d||d.dispose(),this.bandwidthCalculator=null,null===(u=this.bandwidthAllocator)||void 0===u||u.dispose(),this.bandwidthAllocator=null,this.layoutProviders.forEach((function(l){return l.dispose()})),this.layoutProviders.clear(),this.layoutProviders=null,l.prototype.dispose.call(this)},MediaQualityController.prototype.addReceiver=function(l,d){this.logger.safe.debug(\"Set receiver max capabilities for \".concat(l,\": \").concat(JSON.stringify(d))),this.configureProviders(l,d.length);var u=d.map((function(l){return l.maxBr})).reduce((function(l,d){return l+d}));this.bandwidthAllocator.addReceiverCapabilty(l,u),this.layoutProviders.get(l).setLayouts(d)},MediaQualityController.prototype.removeReceiver=function(l){var d;this.logger.safe.debug(\"Removing receiver for \".concat(l)),this.bandwidthAllocator.removeReceiver(l),null===(d=this.layoutProviders.get(l))||void 0===d||d.dispose(),this.layoutProviders.delete(l)},MediaQualityController.prototype.getLayouts=function(l){return this.layoutProviders.get(l).getLayouts()},MediaQualityController.prototype.configureProviders=function(l,d){if(!this.layoutProviders.has(l)){var u=this.createProvider(l);this.layoutProviders.set(l,u)}this.layoutProviders.get(l).configure(d)},MediaQualityController.prototype.createProvider=function(l){var d=this,u=new y.LayoutGenerator(this.configProvider,this.logger.createChild(\"LG:\".concat(l)));return u.on(\"onLayoutsChanged\",(function(){var p=u.getLayouts();d.logger.safe.debug(\"New layouts generated: \".concat(JSON.stringify(p))),d.event(\"onLayoutsUpdated\").raise(l)})),u},MediaQualityController.prototype.updateBandwidthDistribution=function(){var l,d,u,p=this.bandwidthAllocator.getLayouts();try{for(var f=h(Object.entries(p)),m=f.next();!m.done;m=f.next()){var v=g(m.value,2),y=v[0],S=v[1];null===(u=this.layoutProviders.get(y))||void 0===u||u.setAvailableBandwidth(S)}}catch(d){l={error:d}}finally{try{m&&!m.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}},MediaQualityController}(f.default);d.MediaQualityController=S},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.BandwidthAllocator=d.createBandwidthAllocatorPerMediaType=void 0;var g=u(8),f=u(7),m=u(1),v=[5e4,1e6,15e5,2e6,25e5,375e4,4e6],y=[7e4,2e5,4e5,8e5,15e5,2499990,25e5];function createBandwidthAllocatorPerMediaType(l,d){var u=new S(l.createChild(\"BandwidthAllocator\"));return u.setLadder(\"ScreenShare\",d.config.sharingBitrateLadderOverride||v),u.setLadder(\"Video\",d.config.videoBitrateLadderOverride||y),u}d.createBandwidthAllocatorPerMediaType=createBandwidthAllocatorPerMediaType;var S=function(l){function BandwidthAllocator(d){var u=l.call(this)||this;return u.logger=d,u.availableBandwidth=0,u.receivers=new Map,u.currentLayout={},u.ladders={},u}return p(BandwidthAllocator,l),BandwidthAllocator.prototype.setAvailableBandwidth=function(l){this.availableBandwidth=l,this.logger.safe.debug(\"Total available bandwidth updated: \".concat(l)),this.updateLayoutAndNotify()},BandwidthAllocator.prototype.addReceiverCapabilty=function(l,d){this.logger.safe.debug(\"Receiver maxBr set: \".concat(l,\"/\").concat(d)),this.receivers.set(l,d),this.updateLayoutAndNotify()},BandwidthAllocator.prototype.removeReceiver=function(l){this.logger.safe.debug(\"Receiver maxBr removed: \".concat(l)),this.receivers.delete(l),this.updateLayoutAndNotify()},BandwidthAllocator.prototype.getLayouts=function(){return this.currentLayout},BandwidthAllocator.prototype.setLadder=function(l,d){this.ladders[l]=d},BandwidthAllocator.prototype.updateLayoutAndNotify=function(){var l=this.generateLayouts();g.isEqual(l,this.currentLayout)||(this.currentLayout=l,this.logger.safe.debug(\"Bandwidth distribution updated: \".concat((0,m.stringifyObject)(l))),this.event(\"onBandwidthDistributionUpdated\").raise())},BandwidthAllocator.prototype.generateLayouts=function(){var l,d,u,p,g={},f={};try{for(var m=h(Object.keys(this.ladders)),v=m.next();!v.done;v=m.next()){var y=v.value,S=this.receivers.get(y);S&&(f[y]=S||Number.MAX_SAFE_INTEGER,g[y]=0)}}catch(d){l={error:d}}finally{try{v&&!v.done&&(d=m.return)&&d.call(m)}finally{if(l)throw l.error}}for(var _=this.availableBandwidth,C=0,runLoop=function(){var l,d;if(!_)return!1;try{for(var u=h(Object.values(f)),p=u.next();!p.done;p=u.next()){if(p.value)return!0}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}return!1};runLoop();){try{for(var E=(u=void 0,h(Object.keys(g))),T=E.next();!T.done;T=E.next()){y=T.value;var b=this.ladders[y],I=b[C]||b[b.length-1];I=Math.min(I,_,f[y]),g[y]+=I,_-=I,f[y]-=I}}catch(l){u={error:l}}finally{try{T&&!T.done&&(p=E.return)&&p.call(E)}finally{if(u)throw u.error}}C++}return g},BandwidthAllocator}(f.default);d.BandwidthAllocator=S},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.LayoutGenerator=void 0;var h=u(7),g=u(435),f=u(436),m=u(1),v=function(l){function LayoutGenerator(d,u){var p=l.call(this)||this;return p.configProvider=d,p.logger=u,p.shouldBeControlled=!1,p.deferredOperation=new g.InitiallyDeferredOperation((function(){return p.updateStrategy()}),p.configProvider.config.layoutControlTimeout,p.logger.createChild(\"DeferredOperation\")),p.strategy=p.createStrategy(p.shouldBeControlled),p}return p(LayoutGenerator,l),LayoutGenerator.prototype.configure=function(l){var d=this.isBWEControlNeeded(l);this.shouldBeControlled!==d&&(this.shouldBeControlled=d,this.deferredOperation.invoke(this.shouldBeControlled))},LayoutGenerator.prototype.setLayouts=function(l){(0,m.deepEqual)(this.latestLayouts,l)?this.logger.safe.debug(\"Layouts are not changed. Skipping update\"):(this.latestLayouts=l,this.strategy.setLayouts(this.latestLayouts))},LayoutGenerator.prototype.setAvailableBandwidth=function(l){this.strategy.setAvailableBandwidth(l),this.latestBandwidth=l},LayoutGenerator.prototype.getLayouts=function(){return this.strategy.getLayouts()},LayoutGenerator.prototype.dispose=function(){this.strategy.dispose(),this.strategy=null,l.prototype.dispose.call(this)},LayoutGenerator.prototype.updateStrategy=function(){var l=this;this.strategy.dispose(),this.strategy=this.createStrategy(this.shouldBeControlled),this.strategy.on(\"onLayoutsChanged\",(function(){return l.event(\"onLayoutsChanged\").raise()})),this.latestBandwidth&&this.strategy.setAvailableBandwidth(this.latestBandwidth),this.latestLayouts&&this.strategy.setLayouts(this.latestLayouts)},LayoutGenerator.prototype.isBWEControlNeeded=function(l){return l>1},LayoutGenerator.prototype.createStrategy=function(l){return l?new f.BWEControlledStrategy(this.configProvider,this.logger.createChild(\"BWEControlledStrategy\")):new f.NoControlStrategy(this.logger.createChild(\"NoControlStrategy\"))},LayoutGenerator}(h.default);d.LayoutGenerator=v},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.InitiallyDeferredOperation=void 0;var p=u(48),h=function(){function InitiallyDeferredOperation(l,d,u){var p=this;this.timeout=d,this.logger=u,this.isFirstTimeDeferred=!0,this.internalCallback=function(d){p.logger.safe.debug(\"Trigger reason: \".concat(d)),l()}}return InitiallyDeferredOperation.prototype.invoke=function(l){if(this.logger.safe.debug(\"Schedule shouldDefer: \".concat(l)),this.createTimerIfNeeded(l),this.timer)return l?this.startTimer():this.stopTimerAndTrigger();this.internalCallback(\"request\")},InitiallyDeferredOperation.prototype.startTimer=function(){this.timer.isActive||(this.timer.start(this.timeout),this.logger.safe.debug(\"Timer started for : \".concat(this.timeout,\"ms\")))},InitiallyDeferredOperation.prototype.stopTimer=function(){this.timer.isActive&&(this.timer.stop(),this.logger.safe.debug(\"Timer stopped\"))},InitiallyDeferredOperation.prototype.stopTimerAndTrigger=function(){this.stopTimer(),this.internalCallback(\"request\")},InitiallyDeferredOperation.prototype.createTimerIfNeeded=function(l){var d=this;l&&this.isFirstTimeDeferred&&(this.isFirstTimeDeferred=!1,this.timer=new p.Timer((function(){d.internalCallback(\"timeout\"),d.timer=null})))},InitiallyDeferredOperation}();d.InitiallyDeferredOperation=h},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.NoControlStrategy=d.BWEControlledStrategy=void 0;var g=u(7),f=u(437),m=u(1),v=1e8,y=function(l){function BWEControlledStrategy(d,u){var p=l.call(this)||this;return p.configProvider=d,p.logger=u,p.totalBandwidth=v,p.resolutionManager=new f.BWEControlledResolutionManager(p.logger.createChild(\"BWEControlledResolutionManager\"),p.configProvider),p.logger.safe.debug(\"Created\"),p}return p(BWEControlledStrategy,l),BWEControlledStrategy.prototype.dispose=function(){this.logger.safe.debug(\"Disposed\"),this.resolutionManager=null,l.prototype.dispose.call(this)},BWEControlledStrategy.prototype.setAvailableBandwidth=function(l){this.logger.safe.debug(\"Set available bandwidth: \".concat(l)),this.totalBandwidth=l,this.inputLayouts?(this.recalculateLayouts(),this.checkForChangesAndNotify()):this.logger.safe.debug(\"Layouts are not set. Skip update\")},BWEControlledStrategy.prototype.setLayouts=function(l){2===l.length?(this.logger.safe.debug(\"Set layouts: \".concat(JSON.stringify(l))),this.inputLayouts=this.getPrioritizedLayouts(l),this.recalculateLayouts(),this.checkForChangesAndNotify()):this.logger.safe.warn(\"Incorrect number of layouts! \".concat(JSON.stringify(l)))},BWEControlledStrategy.prototype.getLayouts=function(){return this.hiFiLayout?[this.loFiLayout,this.hiFiLayout]:[this.loFiLayout]},BWEControlledStrategy.prototype.getHighLayoutBandwidth=function(l){var d,u=(null===(d=this.inputLayouts)||void 0===d?void 0:d[0].maxBr)||0,p=Math.max(l-u,0);return this.logger.safe.debug(\"Setting available bandwidth for layouts. High: \".concat(p,\", low: \").concat(u||\"not set\",\", total: \").concat(l)),p},BWEControlledStrategy.prototype.recalculateLayouts=function(){var l=this.hiFiLayout,d=this.getHighLayoutBandwidth(this.totalBandwidth);this.resolutionManager.setAvailableBandwidth(d),this.resolutionManager.setMaxFrameSize(this.inputLayouts[1].maxFs),this.loFiLayout=this.getMinimalLayoutParams(this.inputLayouts),this.hiFiLayout=this.getHighLayoutParams(this.inputLayouts,d,this.loFiLayout),this.loFiLayout=this.adjustLowLayoutBasedOnHighLayout(this.hiFiLayout,this.loFiLayout,l)},BWEControlledStrategy.prototype.adjustLowLayoutBasedOnHighLayout=function(l,d,u){return this.configProvider.config.useMediaQualityControllerForceKeyFrame&&!l&&u&&(this.logger.safe.debug(\"Forcing kayframe on low layout due to disabling high layout\"),d.keyframe=!0),l?(d.maxBr===l.maxBr&&d.maxBr--,d):d},BWEControlledStrategy.prototype.getPrioritizedLayouts=function(l){return l.sort((function(l,d){return l.maxFs-d.maxFs?l.maxFs-d.maxFs:l.maxFps-d.maxFps}))},BWEControlledStrategy.prototype.getHighLayoutParams=function(l,d,u){var p=l[1];if(p.maxBr<=d)return this.logger.safe.debug(\"High layout bandwidth suits requested caps. Applying as-is: \".concat(JSON.stringify(p))),p;var g=h(h({},l[1]),{maxFs:this.resolutionManager.getFrameSize(),maxBr:Math.min(d,l[1].maxBr),maxFps:l[1].maxFps}),f=g.maxBr<u.maxBr||g.maxFs<u.maxFs||g.maxFs===u.maxFs&&g.maxFps<=u.maxFps,v=\"Potential high layout: \".concat(JSON.stringify(g));return!this.hiFiLayout&&f?(this.logger.safe.debug(\"High layout is already disabled. Do nothing. \".concat(v)),null):this.hiFiLayout&&f?(this.logger.safe.debug(\"High layout gets disabled. \".concat(v)),null):(this.hiFiLayout&&m.deepEqual(g,this.hiFiLayout)?this.logger.safe.debug(\"High layout has not been changed. Do nothing. \".concat(v)):this.hiFiLayout?this.logger.safe.debug(\"High layout updated. \".concat(v)):this.logger.safe.debug(\"High layout enabled. \".concat(v)),g)},BWEControlledStrategy.prototype.getMinimalLayoutParams=function(l){return h(h({},l[0]),{maxBr:Math.min(l[0].maxBr,l[1].maxBr),maxFps:Math.min(l[0].maxFps,l[1].maxFps),maxFs:Math.min(l[0].maxFs,l[1].maxFs)})},BWEControlledStrategy.prototype.checkForChangesAndNotify=function(){var l=this.getLayouts();m.deepEqual(this.outputLayouts,l)?this.logger.safe.debug(\"Layout has not changed, skip update\"):(this.outputLayouts=l,this.event(\"onLayoutsChanged\").raise())},BWEControlledStrategy}(g.default);d.BWEControlledStrategy=y;var S=function(l){function NoControlStrategy(d){var u=l.call(this)||this;return u.logger=d,u.logger.safe.debug(\"Created\"),u}return p(NoControlStrategy,l),NoControlStrategy.prototype.dispose=function(){this.logger.safe.debug(\"Disposed\"),l.prototype.dispose.call(this)},NoControlStrategy.prototype.setAvailableBandwidth=function(l){this.logger.safe.debug(\"Available bandwidth updated \".concat(l))},NoControlStrategy.prototype.setLayouts=function(l){this.layouts=l},NoControlStrategy.prototype.getLayouts=function(){return this.layouts},NoControlStrategy}(g.default);d.NoControlStrategy=S},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.BWEControlledResolutionManager=void 0;var p=u(26),h=function(){function BWEControlledResolutionManager(l,d){this.logger=l,this.configProvider=d,this.resolutionTable=new p.default(this.configProvider.config.resolutionTableOverride),this.currentFrameSize=this.resolutionTable.initialResolution.fs}return BWEControlledResolutionManager.prototype.setAvailableBandwidth=function(l){l!==this.lastSendBW&&(this.logger.safe.debug(\"Available bandwidth updated \".concat(l)),this.processEstimatedBandwidth(l))},BWEControlledResolutionManager.prototype.setMaxFrameSize=function(l){l!==this.maxFrameSize?(this.maxFrameSize=l,this.lastSendBW?(this.logger.safe.debug(\"Setting max frame size: \".concat(l)),this.processEstimatedBandwidth(this.lastSendBW)):this.logger.safe.debug(\"Last send bwe is not defined. Do nothing\")):this.logger.safe.debug(\"Max frame size did not change. Do nothing, maxFs: \".concat(l))},BWEControlledResolutionManager.prototype.getFrameSize=function(){return this.currentFrameSize},BWEControlledResolutionManager.prototype.processEstimatedBandwidth=function(l){if(0===l)return this.lastSendBW=0,void this.proposeResolution(0);var d=this.resolutionTable.getResolutionForBitrate(l),u=d.lowRes,p=d.highRes,h=l<this.lastSendBW?p.fs:u.fs;l<this.lastSendBW&&this.currentFrameSize<h||(h&&this.proposeResolution(h),this.lastSendBW=l)},BWEControlledResolutionManager.prototype.proposeResolution=function(l){var d=this.maxFrameSize?Math.min(l,this.maxFrameSize):l;d!==this.currentFrameSize&&(this.currentFrameSize=d,this.logger.safe.debug(\"Proposed new frame size: \".concat(d,\" based on bandwidth: \").concat(this.lastSendBW)))},BWEControlledResolutionManager}();d.BWEControlledResolutionManager=h},function(l,d,u){var p,h=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),g=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},f=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},m=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},v=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SimulcastStreamSender=void 0;var y=u(7),S=u(49),_=u(1),C=u(439),E=u(440),T=u(441),b=u(9),I=function(l){function SimulcastStreamSender(d,u,p,h,g,f,m,v,y,S){var _=l.call(this)||this;return _.mediaConnection=d,_.mainStream=u,_.contextStream=p,_.mediaType=h,_.serialQueue=g,_.logger=f,_.configProvider=m,_.isAlwaysActive=v,_.encStreamsManager=y,_.simulcastContext=S,_.isMuted=!1,_.isHold=!1,_.previousParameters=[],_.state=new E.StateMachine(SimulcastStreamSender.transitionStates,\"NotStarted\",_.logger),_.pendingStream=null,_.subscribeOnQualityUpdates(_.mainStream),_}return h(SimulcastStreamSender,l),SimulcastStreamSender.prototype.injectStreamTrack=function(l){var d;return null===(d=this.sender)||void 0===d?void 0:d.injectStreamTrack(l)},SimulcastStreamSender.prototype.start=function(){return m(this,void 0,void 0,(function(){return v(this,(function(l){switch(l.label){case 0:return this.state.setState(\"Started\")?(this.sender=this.createSenderModel(),[4,this.sender.init()]):[2];case 1:return l.sent(),this.subscribeForSenderEvents(),this.capabilitiesManager=this.getCapabilitiesManager(this.simulcastContext),[2]}}))}))},SimulcastStreamSender.prototype.activate=function(){return m(this,void 0,void 0,(function(){return v(this,(function(l){switch(l.label){case 0:return this.state.setState(\"Active\")?this.pendingStream?[4,this.updateStreamInternal(this.pendingStream)]:[3,2]:[2];case 1:l.sent(),this.pendingStream=null,l.label=2;case 2:return this.isAlwaysActive?(this.event(\"onSendersChanged\").raise(this,!0),this.logger.safe.info(\"Sender set to always active. Do not stopping\"),[2]):[2,this.capabilitiesManager.stopSenders()]}}))}))},SimulcastStreamSender.prototype.updateStream=function(l){return this.updateStreamInternal(l)},SimulcastStreamSender.prototype.addAdditionalStream=function(l){return m(this,void 0,void 0,(function(){return v(this,(function(d){return[2,this.sender.addAdditionalStream(l)]}))}))},SimulcastStreamSender.prototype.updateParameters=function(l){return m(this,void 0,void 0,(function(){return v(this,(function(d){switch(d.label){case 0:return this.state.isCurrentStateMatchedWith(\"Active\")?[4,this.capabilitiesManager.setCapabilities(l)]:[2];case 1:return d.sent(),_.compareArraysBy(this.previousParameters,l,(function(l,d){return l.ssrc===d.ssrc}))||(this.previousParameters=l,this.event(\"onSendersChanged\").raise(this,!0)),[2]}}))}))},SimulcastStreamSender.prototype.dispose=function(){return m(this,void 0,void 0,(function(){return v(this,(function(d){switch(d.label){case 0:return this.state.setState(\"Disposed\")?(this.logger.safe.info(\"Disposing\"),[4,this.sender.dispose()]):[2];case 1:return d.sent(),this.unsubscribeFromQualityEvents(),this.mainStream.dispose(),this.mainStream=null,this.pendingStream&&this.pendingStream.dispose(),this.pendingStream=null,this.sender=null,this.contextStream=null,this.event(\"onSendersChanged\").raise(this,!1),l.prototype.dispose.call(this),[2]}}))}))},SimulcastStreamSender.prototype.setHold=function(l,d){return m(this,void 0,void 0,(function(){return v(this,(function(u){return this.isHold===l?(this.logger.safe.info(\"[\".concat(d,\"] Already in hold=\").concat(l,\" state\")),[2]):(this.logger.safe.info(\"[\".concat(d,\"] Setting hold to: \").concat(l)),this.isHold=l,[2,this.sender.setHold(l,d)])}))}))},SimulcastStreamSender.prototype.setMuted=function(l,d,u){this.logger.safe.info(\"[\".concat(d,\"] Setting muted to: \").concat(l)),this.isMuted=l,this.sender.setMuted(this.isMuted,d,u)},SimulcastStreamSender.prototype.getActiveStreamIndexes=function(){return this.sender?this.sender.getActiveStreamIndexes():[]},SimulcastStreamSender.prototype.getTrackInfo=function(){return{modality:b.mediaTypeToModality(this.mediaType),trackId:this.sender.trackId}},SimulcastStreamSender.prototype.createSenderModel=function(){return new T.StreamSender(this.mediaConnection,this.mainStream,this.contextStream,this.logger.createChild(\"Sender\"),this.configProvider,this.encStreamsManager)},SimulcastStreamSender.prototype.subscribeForSenderEvents=function(){var l=this;this.sender.on(\"onNewStreamNeeded\",(function(){return l.event(\"onNewStreamNeeded\").raise()}))},SimulcastStreamSender.prototype.getCapabilitiesManager=function(l){return(null==l?void 0:l.shouldUseSimulcast())?new C.SimulcastCapabilitiesManager(this.sender.rtpSender,this.mainStream.getResolution(),l.config.layerScaleFactors.length,this.logger.createChild(\"SimCapMgr\"),this.configProvider):new C.SinglecastCapabilitiesManager(this.sender,this.logger.createChild(\"SnglCapMgr\"))},SimulcastStreamSender.prototype.updateStreamInternal=function(l){return m(this,void 0,void 0,(function(){return v(this,(function(d){switch(d.label){case 0:return this.state.isCurrentStateMatchedWith(\"Active\")?this.mainStream===l?(this.logger.safe.info(\"Stream has not been changed. Skipping update\"),[2]):(this.logger.safe.debug(\"Switching streams: \".concat(this.mainStream.parentId,\":\").concat(this.mainStream.id,\" -> \").concat(l.parentId,\":\").concat(l.id)),this.unsubscribeFromQualityEvents(),this.mainStream.dispose(),this.mainStream=l,this.subscribeOnQualityUpdates(this.mainStream),[4,this.sender.setMainStream(this.mainStream)]):(this.logger.safe.info(\"Postponing stream update until sender is activated\"),this.setPendingStream(l),[2]);case 1:return d.sent(),this.capabilitiesManager.updateStreamQualityParams(this.mainStream.getResolution(),this.mainStream.getFrameRate()),[2]}}))}))},SimulcastStreamSender.prototype.setPendingStream=function(l){var d=this;this.pendingStream=l;var u=l.on(\"onStreamClientDisposing\",(function(){d.pendingStream===l&&(d.pendingStream=null,u.dispose())}))},SimulcastStreamSender.prototype.subscribeOnQualityUpdates=function(l){var d=this;this.sub=l.on(\"onStreamQualityChanged\",(function(l,u,p){return d.capabilitiesManager.updateStreamQualityParams(u,p)}))},SimulcastStreamSender.prototype.unsubscribeFromQualityEvents=function(){var l;null===(l=this.sub)||void 0===l||l.dispose(),this.sub=null},SimulcastStreamSender.transitionStates=((p={}).NotStarted=[\"Started\",\"Disposed\"],p.Started=[\"Active\",\"Disposed\"],p.Active=[\"NotStarted\",\"Disposed\"],p.Disposed=[],p),g([(0,S.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],SimulcastStreamSender.prototype,\"start\",null),g([(0,S.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],SimulcastStreamSender.prototype,\"activate\",null),g([(0,S.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],SimulcastStreamSender.prototype,\"updateStream\",null),g([(0,S.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],SimulcastStreamSender.prototype,\"addAdditionalStream\",null),g([(0,S.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Array]),f(\"design:returntype\",Promise)],SimulcastStreamSender.prototype,\"updateParameters\",null),g([(0,S.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],SimulcastStreamSender.prototype,\"dispose\",null),g([(0,S.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Boolean,String]),f(\"design:returntype\",Promise)],SimulcastStreamSender.prototype,\"setHold\",null),SimulcastStreamSender}(y.default);d.SimulcastStreamSender=I},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SinglecastCapabilitiesManager=d.SimulcastCapabilitiesManager=void 0;var g=u(1),f=u(26),m=function(){function SimulcastCapabilitiesManager(l,d,u,p,h){this.sender=l,this.initialResolution=d,this.maxSimulcastLayerCount=u,this.logger=p,this.configProvider=h,this.resTable=new f.default(this.configProvider.config.resolutionTableOverride)}return SimulcastCapabilitiesManager.prototype.setCapabilities=function(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){switch(d.label){case 0:return g.deepEqual(this.currentCapabilities,l)?(this.logger.safe.info(\"Capabilties already applied: \".concat(JSON.stringify(l),\". Do nothing\")),[2]):(this.currentCapabilities=g.deepClone(l),[4,this.generateKeyFrameIfNeeded(l)]);case 1:return d.sent(),[2,this.applyCapabilities(l)]}}))}))},SimulcastCapabilitiesManager.prototype.updateStreamQualityParams=function(l,d){return p(this,void 0,void 0,(function(){return h(this,(function(u){return!l||g.deepEqual(this.initialResolution,l)?(this.logger.safe.debug(\"Resolution is not defined or same: \".concat(JSON.stringify(l),\"@\").concat(d)),[2]):(this.logger.safe.debug(\"Stream params changed: \".concat(JSON.stringify(l),\"@\").concat(d)),this.initialResolution=l,[2,this.applyCapabilities(this.currentCapabilities)])}))}))},SimulcastCapabilitiesManager.prototype.stopSenders=function(){return p(this,void 0,void 0,(function(){return h(this,(function(l){return this.logger.safe.info(\"Stopping senders.\"),[2,this.deactivateSenders()]}))}))},SimulcastCapabilitiesManager.prototype.getScaleFactor=function(l){var d=this.resTable.getResolutionByFs(l),u=this.initialResolution,p=Math.min(u.width,u.height)/d.height;return this.logger.safe.debug(\"Scale factor is taken from resolution: \".concat(JSON.stringify(u),\" and new Fs: \").concat(l,\" as \").concat(p)),p<1&&(this.logger.safe.error(\"Scale factor cannot be less than 1! Limiting to 1\"),p=1),p},SimulcastCapabilitiesManager.prototype.deactivateSenders=function(){var l=this.sender.getParameters();return l.encodings.forEach((function(l){return l.active=!1})),this.logger.safe.info(\"Stopping senders. Encoding params to set: \".concat(JSON.stringify(l.encodings))),this.sender.setParameters(l)},SimulcastCapabilitiesManager.prototype.generateKeyFrameIfNeeded=function(l){return p(this,void 0,void 0,(function(){var d,u,p,g=this;return h(this,(function(h){return d=this.sender.getParameters(),u=[],l.forEach((function(l){var p=g.getEncondingIndexForRid(l.rid,d.encodings),h=d.encodings[p];l.keyframe&&h.active?(g.logger.safe.info(\"Keyframe is needed for encoder with index \".concat(p)),u.push(p)):g.logger.safe.info(\"Keyframe is not needed for index \".concat(p,\" because encoding is active: \").concat(h.active,\" or KF is requested: \").concat(l.keyframe))})),0===u.length?(this.logger.safe.info(\"No keyframes needed. Skipping\"),[2]):(p=this.getParamsForKeyFrame(d,u),this.logger.safe.info(\"Applying keyframe encoding params new: \".concat(JSON.stringify(p.encodings),\", old: \").concat(JSON.stringify(d.encodings))),[2,this.sender.setParameters(p)])}))}))},SimulcastCapabilitiesManager.prototype.applyCapabilities=function(l){return p(this,void 0,void 0,(function(){var d,u,p=this;return h(this,(function(h){return l?(d=this.sender.getParameters(),u=g.deepClone(d),l.forEach((function(l){var u=p.getEncondingIndexForRid(l.rid,d.encodings);p.updateEncodingsWithCaps(d.encodings[u],l)})),this.updateActiveStates(d,l),this.logger.safe.info(\"Encoding params new: \".concat(JSON.stringify(d.encodings),\", old: \").concat(JSON.stringify(u.encodings))),[2,this.sender.setParameters(d)]):(this.logger.safe.info(\"Capabilities are not set. Do nothing\"),[2])}))}))},SimulcastCapabilitiesManager.prototype.getEncondingIndexForRid=function(l,d){if(!l)return this.logger.safe.error(\"No RID found in incoming params. Returning index 0\"),0;var u=d.findIndex((function(d){return d.rid===l}));return u<0||u-1>this.maxSimulcastLayerCount?(this.logger.safe.error(\"Incorrect index deduced from requested RID. Returning index 0\"),0):u},SimulcastCapabilitiesManager.prototype.updateEncodingsWithCaps=function(l,d){l?(l.maxBitrate=d.maxBr,l.scaleResolutionDownBy=this.getScaleFactor(d.maxFs),l.maxFramerate=d.maxFps):this.logger.safe.error(\"SenderParams does not exist for caps: \".concat(JSON.stringify(d)))},SimulcastCapabilitiesManager.prototype.updateActiveStates=function(l,d){var u=this,p=l.encodings.map((function(l){return l.rid})),h=p.filter((function(l){return d.some((function(d){return l===d.rid}))})),f=g.subtractFrom(p,h);h.forEach((function(d){return u.changeEncodingState(l,d,!0)})),f.forEach((function(d){return u.changeEncodingState(l,d,!1)}))},SimulcastCapabilitiesManager.prototype.changeEncodingState=function(l,d,u){var p=l.encodings.find((function(l){return l.rid===d}));p?p.active=u:this.logger.safe.error(\"Encoding not found for RID: \".concat(d))},SimulcastCapabilitiesManager.prototype.getParamsForKeyFrame=function(l,d){var u=this,p=g.deepClone(l);return d.forEach((function(l){p.encodings[l].active&&p.encodings[l].scaleResolutionDownBy&&(p.encodings[l]=u.getEncodingParamsForKeyFrame(p.encodings[l]))})),p},SimulcastCapabilitiesManager.prototype.getEncodingParamsForKeyFrame=function(l){var d=g.deepClone(l);return d.scaleResolutionDownBy&&(d.scaleResolutionDownBy=1.1*l.scaleResolutionDownBy),d},SimulcastCapabilitiesManager}();d.SimulcastCapabilitiesManager=m;var v=function(){function SinglecastCapabilitiesManager(l,d){this.sender=l,this.logger=d}return SinglecastCapabilitiesManager.prototype.setCapabilities=function(l){return p(this,void 0,void 0,(function(){return h(this,(function(d){switch(d.label){case 0:return 0===l.length||1!==l.length?(this.logger.safe.error(\"Incorrect number of sender params!\"),[2]):[4,this.sender.setParameters(l[0])];case 1:return d.sent(),[4,this.sender.start()];case 2:return d.sent(),[2]}}))}))},SinglecastCapabilitiesManager.prototype.updateStreamQualityParams=function(l,d){return this.sender.updateStreamQualityParams(l,d)},SinglecastCapabilitiesManager.prototype.stopSenders=function(){return p(this,void 0,void 0,(function(){return h(this,(function(l){switch(l.label){case 0:return[4,this.sender.stop()];case 1:return l.sent(),[2]}}))}))},SinglecastCapabilitiesManager}();d.SinglecastCapabilitiesManager=v},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.StateMachine=void 0;var p=function(){function StateMachine(l,d,u){this.transitionStates=l,this.logger=u,this.stateInternal=d}return Object.defineProperty(StateMachine.prototype,\"state\",{get:function(){return this.stateInternal},enumerable:!1,configurable:!0}),StateMachine.prototype.isDestinationStateValid=function(l){return this.transitionStates[this.stateInternal].indexOf(l)>-1},StateMachine.prototype.setState=function(l){return this.isDestinationStateValid(l)?(this.stateInternal=l,!0):(this.logger.safe.info(\"Invalid state transition \".concat(this.stateInternal,\" -> \").concat(l)),!1)},StateMachine.prototype.isCurrentStateMatchedWith=function(l){return this.stateInternal===l||(this.logger.safe.info(\"State does not match. Current: \".concat(this.stateInternal,\" required: \").concat(l)),!1)},StateMachine}();d.StateMachine=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.StreamSender=void 0;var f=u(8),m=u(7),v=u(442),y=u(26),S=u(443),_=u(1),C=u(9),E=u(169),T=function(l){function StreamSender(d,u,p,h,g,f){var m=l.call(this)||this;return m.mediaConnection=d,m.contextStream=p,m.logger=h,m.configProvider=g,m.encStreamsManager=f,m.isActive=!1,m.isMuted=!1,m.resolutionTable=new y.default(m.configProvider.config.resolutionTableOverride),m.configProvider.config.renderThroughCanvas&&(m.videoThroughCanvas=new v.VideoThroughCanvas(m.logger.createChild(\"videoThroughCanvas\"))),m.stream=u.clone(\"streamSender ctor\"),m.streamResolution=m.stream.getResolution(),m}return p(StreamSender,l),Object.defineProperty(StreamSender.prototype,\"rtpSender\",{get:function(){return this.sender},enumerable:!1,configurable:!0}),Object.defineProperty(StreamSender.prototype,\"trackId\",{get:function(){var l=this.rawTrack;return null==l?void 0:l.id},enumerable:!1,configurable:!0}),Object.defineProperty(StreamSender.prototype,\"rawTrack\",{get:function(){var l;return this.injectedStreamTrack||(null===(l=this.audioMixer)||void 0===l?void 0:l.getDestinationTrack())||this.stream.rawTrack},enumerable:!1,configurable:!0}),Object.defineProperty(StreamSender.prototype,\"canvasedRawTrack\",{get:function(){var l,d;return this.configProvider.config.renderThroughCanvas?\"Video\"!==this.stream.mediaType?this.rawTrack:null!==(d=null===(l=this.videoThroughCanvas)||void 0===l?void 0:l.modify(this.rawTrack))&&void 0!==d?d:this.rawTrack:this.rawTrack},enumerable:!1,configurable:!0}),StreamSender.prototype.init=function(){return h(this,void 0,void 0,(function(){var l;return g(this,(function(d){switch(d.label){case 0:return l=this,[4,this.createSender()];case 1:return l.sender=d.sent(),this.isActive=!0,this.addStreamTransforms(),[2]}}))}))},StreamSender.prototype.start=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){switch(l.label){case 0:return this.isActive?(this.logger.safe.info(\"Already active. Do nothing\"),[2]):(this.logger.safe.info(\"Starting\"),this.isActive=!0,[4,this.wakeSender()]);case 1:return l.sent(),this.params?[4,this.applyParams(this.params)]:[3,3];case 2:l.sent(),l.label=3;case 3:return this.logger.safe.info(\"Started\"),[2]}}))}))},StreamSender.prototype.stop=function(){return h(this,void 0,void 0,(function(){var l;return g(this,(function(d){switch(d.label){case 0:return this.isActive?(this.logger.safe.info(\"Stopping\"),this.isActive=!1,l=this.configProvider.config.webrtcDisabledSenderBitrate,[4,this.applyBitrate(l,!1)]):(this.logger.safe.info(\"Already stopped. Do nothing\"),[2]);case 1:return d.sent(),[4,this.sleepSender()];case 2:return d.sent(),this.logger.safe.info(\"Stopped\"),[2]}}))}))},StreamSender.prototype.setMuted=function(l,d,u){this.isMuted=l,this.stream.setMuted(l,d),!this.configProvider.config.requestNewStreamOnUnmute||l||u||this.stream.isActive()||this.event(\"onNewStreamNeeded\").raise()},StreamSender.prototype.setHold=function(l,d){return h(this,void 0,void 0,(function(){return g(this,(function(u){return[2,this.activateSender(!l,d)]}))}))},StreamSender.prototype.setMainStream=function(l){var d;return h(this,void 0,void 0,(function(){var u;return g(this,(function(p){switch(p.label){case 0:return this.stream.dispose(),this.stream=l.clone(\"streamSender setMainStream\"),this.streamResolution=this.stream.getResolution(),this.stream.setMuted(this.isMuted),this.params?[4,this.applyCapabilities(this.params)]:[3,2];case 1:p.sent(),p.label=2;case 2:return null===(d=this.audioMixer)||void 0===d||d.addSourceStream(this.stream),this.isActive?(u=this.rawTrack&&this.rawTrack.id,this.logger.safe.info(\"Replace sender with track: \".concat(u)),[4,this.sender.replaceTrack(this.canvasedRawTrack)]):[3,4];case 3:p.sent(),this.logger.safe.info(\"Replace completed\"),p.label=4;case 4:return[2]}}))}))},StreamSender.prototype.addAdditionalStream=function(l){var d;return h(this,void 0,void 0,(function(){return g(this,(function(u){return this.audioMixer||this.logger.safe.error(\"addAdditionalStream is called when audioMixer is not created. Main stream type is \".concat(this.stream.mediaType,\".\")),null===(d=this.audioMixer)||void 0===d||d.addSourceStream(l),[2]}))}))},StreamSender.prototype.setParameters=function(l,d){return void 0===d&&(d=!1),h(this,void 0,void 0,(function(){return g(this,(function(u){return d||this.params!==l?(this.params=l,this.isActive?[2,this.applyParams(this.params)]:(this.logger.safe.info(\"Sender is not active, preserving params\"),[2])):[2]}))}))},StreamSender.prototype.dispose=function(){var d;return h(this,void 0,void 0,(function(){return g(this,(function(u){switch(u.label){case 0:return l.prototype.dispose.call(this),[4,this.disposeSender()];case 1:return u.sent(),this.sender=null,this.stream.dispose(),this.stream=null,this.isActive=!1,null===(d=this.videoThroughCanvas)||void 0===d||d.dispose(),[2]}}))}))},StreamSender.prototype.getActiveStreamIndexes=function(){return this.getSenderParameters().encodings.filter((function(l){return l.active})).map((function(l){return+l.rid}))},StreamSender.prototype.injectStreamTrack=function(l){this.injectedStreamTrack=l},StreamSender.prototype.updateStreamQualityParams=function(l,d){return h(this,void 0,void 0,(function(){return g(this,(function(u){return this.configProvider.config.useSetParametersToApplyCapabilities?l?(this.logger.safe.debug(\"Stream resolution has changed to \".concat(JSON.stringify(l),\"@\").concat(d,\", re-applying send parameters\")),this.streamResolution=l,this.params?[2,this.setParameters(this.params,!0)]:(this.logger.safe.debug(\"Params are not yet set, do nothing\"),[2])):(this.logger.safe.debug(\"Resolution is not defined: \".concat(JSON.stringify(l),\"@\").concat(d)),[2]):[2]}))}))},StreamSender.prototype.applyParams=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){switch(d.label){case 0:return this.logger.safe.info(\"Applying params: \".concat(JSON.stringify(l))),[4,this.applyCapabilities(l)];case 1:return d.sent(),[4,this.applyBitrate(l.maxBr)];case 2:return d.sent(),this.params.keyframe?[4,this.forceKeyframe()]:[3,4];case 3:d.sent(),d.label=4;case 4:return[2]}}))}))},StreamSender.prototype.applyBitrate=function(l,d){void 0===d&&(d=!0);var u=d?this.getAdjustedBitrate(l):l;return this.setEncodingParameters({maxBitrate:u},\"applyBitrate\")},StreamSender.prototype.getAdjustedBitrate=function(l){var d=l||0;if(\"Video\"===this.stream.mediaType){var u=this.resolutionTable.getResolutionRecord(this.streamResolution.width,this.streamResolution.height);d=Math.min(d||u.maxBitrate,u.maxBitrate)}return d},StreamSender.prototype.activateSender=function(l,d){return h(this,void 0,void 0,(function(){return g(this,(function(u){switch(u.label){case 0:return[4,this.setEncodingParameters({active:l},\"activateSender\")];case 1:return u.sent(),this.logger.safe.info(\"[\".concat(d,\"] Active state applied isActive = \").concat(l)),[2]}}))}))},StreamSender.prototype.forceKeyframe=function(){return h(this,void 0,void 0,(function(){var l;return g(this,(function(d){switch(d.label){case 0:return this.sender?this.sender.track?(this.logger.safe.info(\"Restoring keyframe starting\"),l=this.getSenderParameters().encodings[0].scaleResolutionDownBy||1,[4,this.setEncodingParameters({scaleResolutionDownBy:l*this.configProvider.config.forceKeyFrameV2ScaleFactor},\"forceKeyframe start\")]):(this.logger.safe.info(\"Sender track does not exist, not restoring keyframe\"),[2]):(this.logger.safe.error(\"No sender available\"),[2,null]);case 1:return d.sent(),[4,this.setEncodingParameters({scaleResolutionDownBy:l},\"forceKeyframe end\")];case 2:return d.sent(),this.logger.safe.info(\"Restoring keyframe finished\"),[2]}}))}))},StreamSender.prototype.disposeSender=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){if(\"closed\"!==this.mediaConnection.connectionState){this.logger.safe.info(\"Removing sender from pc\");try{this.mediaConnection.removeSender(this.sender)}catch(l){this.logger.safe.warn(\"Error removing sender: \".concat(_.stringifyObject(l)))}}else this.logger.safe.info(\"Not removing sender from pc, connectionState: \".concat(this.mediaConnection.connectionState,\", track exists: \").concat(!!this.sender.track));return[2]}))}))},StreamSender.prototype.createSender=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){return this.setupAudioMixer(),[2,this.mediaConnection.createSender(this.canvasedRawTrack,this.contextStream,C.mediaTypeToModality(this.stream.mediaType))]}))}))},StreamSender.prototype.wakeSender=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){switch(l.label){case 0:return this.logger.safe.info(\"Wake started\"),[4,this.sender.replaceTrack(this.canvasedRawTrack)];case 1:return l.sent(),this.logger.safe.info(\"Wake completed\"),[2]}}))}))},StreamSender.prototype.sleepSender=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){switch(l.label){case 0:return this.logger.safe.info(\"Sleep started\"),[4,this.sender.replaceTrack(null)];case 1:return l.sent(),this.logger.safe.info(\"Sleep completed\"),[2]}}))}))},StreamSender.prototype.addStreamTransforms=function(){if(this.configProvider.config.useInsertableStreams){var l=[];\"Audio\"!==this.stream.mediaType&&l.push(new E.VideoStreamAnalyzer(this.logger.createChild(\"SendStreamAnalyzer [\".concat(this.stream.mediaType,\"]\")))),this.encStreamsManager.setupEncodedStream(this.sender,l)}},StreamSender.prototype.setupAudioMixer=function(){\"Audio\"===this.stream.mediaType&&this.configProvider.config.enableAudioSharing&&(this.audioMixer=new S.AudioMixer(this.logger.createChild(\"AudioMixer\")),this.audioMixer.addSourceStream(this.stream))},StreamSender.prototype.getSenderParameters=function(){var l,d=this.sender.getParameters();return(null===(l=d.encodings)||void 0===l?void 0:l.length)||(d.encodings=[{}]),d},StreamSender.prototype.setEncodingParameters=function(l,d,u){return void 0===u&&(u=!1),h(this,void 0,void 0,(function(){var p,h;return g(this,(function(g){switch(g.label){case 0:p=this.getSenderParameters(),f.merge(p.encodings[0],l),0===p.encodings[0].maxBitrate&&(this.configProvider.config.setParametersMaxBitrateUndefined?p.encodings[0].maxBitrate=void 0:delete p.encodings[0].maxBitrate),g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.sender.setParameters(p)];case 2:return g.sent(),this.logger.safe.info(\"\".concat(d,\": Parameters applied for sender: \").concat(JSON.stringify(p.encodings[0]))),[3,4];case 3:if(h=g.sent(),this.logger.safe.error(\"\".concat(d,\": setParameters failed: \").concat(_.stringifyObject(h),\", parameters \").concat(JSON.stringify(p.encodings[0]))),u)throw h;return[3,4];case 4:return[2]}}))}))},StreamSender.prototype.applyCapabilities=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){switch(d.label){case 0:return this.configProvider.config.useSetParametersToApplyCapabilities?[4,this.setEncodingParameters({scaleResolutionDownBy:this.getScaleFactor(l.maxFs),maxFramerate:l.maxFps},\"applyCapabilities\",!0)]:[3,2];case 1:return d.sent(),[3,4];case 2:return[4,this.stream.applyCapabilities(l)];case 3:d.sent(),d.label=4;case 4:return[2]}}))}))},StreamSender.prototype.getScaleFactor=function(l){var d=this.resolutionTable.getResolutionByFs(l),u=this.streamResolution,p=u.width,h=u.height,g=Math.min(p,h)/d.height;return this.logger.safe.debug(\"Current stream resolution: \".concat(p,\"x\").concat(h,\", scale factor: \").concat(g)),g<1?(this.logger.safe.warn(\"Resolution scale factor is less than 1: \".concat(g)),1):g},StreamSender}(m.default);d.StreamSender=T},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoThroughCanvas=void 0;var p=function(){function VideoThroughCanvas(l,d){void 0===d&&(d=document.body);var u=this;this.logger=l,this.parentElement=d,this.container=this.createContainerElement(),this.video=this.createVideoElement(),this.canvas=this.createCanvasElement(),this.context=this.canvas.getContext(\"2d\"),this.medaiQuery=window.matchMedia(\"(orientation: portrait)\"),this.isPortrait=this.medaiQuery.matches,this.captureFrameRate=30,this.mediaQueryChangeListener=function(l){u.isPortrait=l.matches},this.container.append(this.video,this.canvas),this.parentElement.prepend(this.container),this.medaiQuery.addEventListener(\"change\",this.mediaQueryChangeListener)}return VideoThroughCanvas.prototype.modify=function(l){var d=this;this.logger.safe.info(\"modify()\"),this.clearAnimationFrames(),this.disposeStream(),this.stream=this.canvas.captureStream(this.captureFrameRate),this.video.srcObject=new MediaStream([l]),this.video.play();var u=l.getSettings(),p=0,h=0,requestFrame=function(){u=l.getSettings();var g=d.isPortrait?Math.min(u.width,u.height):Math.max(u.width,u.height),f=d.isPortrait?Math.max(u.width,u.height):Math.min(u.width,u.height);p===g&&h===f||(d.canvas.width=g,d.canvas.height=f,p=g,h=f),d.context.drawImage(d.video,0,0,g,f),d.animationFrame=requestAnimationFrame(requestFrame)};return this.animationFrame=requestAnimationFrame(requestFrame),this.stream.getVideoTracks()[0]},VideoThroughCanvas.prototype.dispose=function(){this.logger.safe.info(\"dispose()\"),this.clearAnimationFrames(),this.disposeStream(),this.container.parentElement.removeChild(this.container),this.medaiQuery.removeEventListener(\"change\",this.mediaQueryChangeListener)},VideoThroughCanvas.prototype.disposeStream=function(){this.stream&&(this.stream.getTracks().forEach((function(l){return l.stop()})),this.stream=void 0)},VideoThroughCanvas.prototype.createContainerElement=function(){var l=document.createElement(\"div\");return l.style.opacity=\"0\",l.style.position=\"fixed\",l.style.zIndex=\"-2147483648\",l.style.pointerEvents=\"none\",l.style.top=\"0\",l.style.left=\"0\",l.style.bottom=\"0\",l.style.right=\"0\",l},VideoThroughCanvas.prototype.createVideoElement=function(){var l=document.createElement(\"video\");return l.setAttribute(\"muted\",\"\"),l.setAttribute(\"playsinline\",\"\"),l.setAttribute(\"autoplay\",\"\"),l.style.top=\"0\",l.style.left=\"0\",l},VideoThroughCanvas.prototype.createCanvasElement=function(){var l=document.createElement(\"canvas\");return l.style.right=\"0\",l.style.bottom=\"0\",l},VideoThroughCanvas.prototype.clearAnimationFrames=function(){this.logger.safe.info(\"clearAnimationFrames()\"),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0)},VideoThroughCanvas}();d.VideoThroughCanvas=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.AudioMixer=void 0;var g=u(15),f=function(l){function AudioMixer(d){var u=l.call(this)||this;return u.logger=d,u.audioContext=new g.default.window.AudioContext,u.destination=u.audioContext.createMediaStreamDestination(),u.streamNodeMap=new Map,u.logger.safe.info(\"Destination stream: \".concat(u.destination.stream.id,\", track: \").concat(u.getDestinationTrack().id)),u.subscribeOnMediaTrackEvents(u.getDestinationTrack()),u}return p(AudioMixer,l),AudioMixer.prototype.addSourceStream=function(l){var d=this;if(l.rawStream&&!this.streamNodeMap.has(l.rawStream)){var u=l.on(\"onStreamClientDisposing\",(function(){d.removeSourceStream(l.rawStream),u.dispose()}));this.logger.safe.info(\"Add stream: \".concat(l.rawStream.id,\", track: \").concat(getTrack(l.rawStream).id)),this.addStream(l.rawStream,l.mediaType)}},AudioMixer.prototype.getDestinationTrack=function(){return getTrack(this.destination.stream)},AudioMixer.prototype.dispose=function(){var d,u;l.prototype.dispose.call(this),this.unsubscribeFromMediaTrackEvents(this.getDestinationTrack());try{for(var p=h(this.streamNodeMap.keys()),g=p.next();!g.done;g=p.next()){var f=g.value;this.removeSourceStream(f)}}catch(l){d={error:l}}finally{try{g&&!g.done&&(u=p.return)&&u.call(p)}finally{if(d)throw d.error}}},AudioMixer.prototype.addStream=function(l,d){void 0===d&&(d=\"Audio\");var u=this.audioContext.createMediaStreamSource(l);u.connect(this.destination),this.streamNodeMap.set(l,{mediaType:d,sourceNode:u})},AudioMixer.prototype.removeSourceStream=function(l){var d=this.streamNodeMap.get(l);d&&(this.logger.safe.info(\"Remove stream: \".concat(l.id,\", track: \").concat(getTrack(l).id)),d.sourceNode.disconnect(),this.streamNodeMap.delete(l))},AudioMixer.prototype.subscribeOnMediaTrackEvents=function(l){var d=this;l.onended=function(u){d.logger.safe.info(\"Track \".concat(l.id,\" ended: \").concat(JSON.stringify(u)))},l.onmute=function(){d.logger.safe.info(\"Track \".concat(l.id,\" muted\"))},l.onunmute=function(){d.logger.safe.info(\"Track \".concat(l.id,\" unmuted\"))}},AudioMixer.prototype.unsubscribeFromMediaTrackEvents=function(l){l.onended=null,l.onmute=null,l.onunmute=null},AudioMixer}(u(7).default);function getTrack(l){return l.getAudioTracks()[0]}d.AudioMixer=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.TransportStateProvider=void 0;var p=function(){function TransportStateProvider(l,d,u,p,h){this.pc=l,this.cryptoMethod=d,this.logger=u,this.configProvider=p,this.stateChangedCallback=h,this.logger=u.createChild(\"TransportStateProvider\"),this.subscribeForConnectionState()}return Object.defineProperty(TransportStateProvider.prototype,\"hasPcConnectionState\",{get:function(){return\"connectionState\"in this.pc&&this.configProvider.config.useConnectionState},enumerable:!1,configurable:!0}),TransportStateProvider.prototype.subscribeForConnectionState=function(){var l=this;this.pc.oniceconnectionstatechange=function(){l.logger.safe.info(\"RTCPeerConnection oniceconnectionstatechange iceConnectionState: \".concat(l.pc.iceConnectionState,\" pc.signalingState: \").concat(l.pc.signalingState)),l.shouldRaise(0)&&l.stateChangedCallback(l.pc.iceConnectionState)},1===this.cryptoMethod&&this.hasPcConnectionState&&(this.pc.onconnectionstatechange=function(){l.logger.safe.info(\"RTCPeerConnection onconnectionStatechange connectionState: \".concat(l.pc.connectionState,\" pc.signalingState: \").concat(l.pc.signalingState)),l.shouldRaise(1)&&l.stateChangedCallback(l.pc.connectionState)})},TransportStateProvider.prototype.subscribeForDtlsTransportState=function(){var l=this;if(this.configProvider.config.useDtlsTrasportConnectionCheck&&!this.transport&&1===this.cryptoMethod&&!this.hasPcConnectionState){var d=this.pc.getReceivers().find((function(l){return!!l.transport}));this.transport=d&&d.transport,this.transport&&(this.transport.onstatechange=function(){l.logger.safe.info(\"RTCDtlsTransport onstatechange state: \".concat(l.transport.state,\" pc.signalingState: \").concat(l.pc.signalingState)),l.shouldRaise(2)&&l.stateChangedCallback(l.transport.state)})}},TransportStateProvider.prototype.dispose=function(){this.pc.oniceconnectionstatechange=null,this.transport&&(this.transport.onstatechange=null,this.transport=null),this.pc.onconnectionstatechange&&(this.pc.onconnectionstatechange=null),this.pc=null,this.stateChangedCallback=null},TransportStateProvider.prototype.shouldRaise=function(l){var d;switch(l){case 2:if(1!==this.cryptoMethod)throw new Error(\"DTLS transport is used with cryptoMethod=\".concat(this.cryptoMethod));return!this.configProvider.config.ignoreClosedDtlsTransportState||\"closed\"!==this.transport.state;case 1:return 1===this.cryptoMethod&&!this.transport;case 0:return!(!this.configProvider.config.ignoreClosedDtlsTransportState||!this.transport||\"closed\"!==this.pc.iceConnectionState)||(0===this.cryptoMethod||!this.transport&&!this.hasPcConnectionState||this.transport&&\"disconnected\"===this.pc.iceConnectionState||\"connected\"===(null===(d=this.transport)||void 0===d?void 0:d.state)&&\"connected\"===this.pc.iceConnectionState);default:return this.logger.safe.error(\"unknown StateMethod=\".concat(l)),!1}},TransportStateProvider}();d.TransportStateProvider=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(15),h=function(){function RawAudioContextProvider(l){var d=this;this.logger=l,this.window=p.default.window,this.audioContext=new this.window.AudioContext,this.streamDestination=this.audioContext.createMediaStreamDestination(),this.streamAudioEl=this.window.document.createElement(\"audio\"),this.onAudioError=function(l){var u=((null==l?void 0:l.target)||d.streamAudioEl).error;if(u){var p=u.code,h=u.message;d.logger.safe.error(\"error with rendering audio code: \".concat(p,\", message: \").concat(h))}else d.logger.safe.error(\"error with audio rendering\")},this.streamAudioEl.addEventListener(\"error\",this.onAudioError),this.streamAudioEl.muted=!0}return Object.defineProperty(RawAudioContextProvider.prototype,\"rawAudioContext\",{get:function(){return this.audioContext},enumerable:!1,configurable:!0}),Object.defineProperty(RawAudioContextProvider.prototype,\"rawStream\",{get:function(){return this.streamDestination.stream},enumerable:!1,configurable:!0}),RawAudioContextProvider.prototype.setStreamToDestination=function(l){var d;l?(null===(d=this.streamSource)||void 0===d||d.disconnect(),this.streamAudioEl.srcObject=l,this.streamSource=this.audioContext.createMediaStreamSource(l),this.streamSource.connect(this.streamDestination)):this.logger.safe.error(\"no stream found to connect to destination\")},RawAudioContextProvider.prototype.dispose=function(){var l;null===(l=this.streamSource)||void 0===l||l.disconnect(),this.streamDestination.disconnect(),this.audioContext.close(),this.streamDestination=null,this.audioContext=null,this.streamAudioEl.removeEventListener(\"error\",this.onAudioError),this.streamAudioEl=null},RawAudioContextProvider}();d.default=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function WebRtcReceiveStreamStateDecorator(l,d,u,p,h){this.recvStream=l,this.mainTrack=d,this.receiveStreamCollection=u,this.logger=p,this.settings=h,this.removeOtherTracks(d),this.subscribeOnStreamEvents()}return Object.defineProperty(WebRtcReceiveStreamStateDecorator.prototype,\"stream\",{get:function(){return this.recvStream.getMediaStream()},enumerable:!1,configurable:!0}),WebRtcReceiveStreamStateDecorator.prototype.dispose=function(){this.unsubscribeFromStreamEvents(),this.receiveStreamCollection=null,this.mainTrack=null,this.recvStream.dispose()},WebRtcReceiveStreamStateDecorator.prototype.getId=function(){return this.recvStream.getId()},WebRtcReceiveStreamStateDecorator.prototype.getModality=function(){return this.recvStream.getModality()},WebRtcReceiveStreamStateDecorator.prototype.getMsi=function(){return this.recvStream.getMsi()},WebRtcReceiveStreamStateDecorator.prototype.getMediaStream=function(){return this.stream},WebRtcReceiveStreamStateDecorator.prototype.requestSource=function(l){return this.recvStream.requestSource(l)},WebRtcReceiveStreamStateDecorator.prototype.removeOtherTracks=function(l){var d=this;this.settings.onAddTrackRemoveOtherTracks&&this.stream.getTracks().forEach((function(u){u.id!==l.id&&d.stream.removeTrack(u)}))},WebRtcReceiveStreamStateDecorator.prototype.subscribeOnStreamEvents=function(){var l=this,logEvent=function(d){return l.logger.safe.info(\"\".concat(d,\" track: \").concat(l.mainTrack.id,\", stream: \").concat(l.stream.id))};this.stream.onremovetrack=function(){logEvent(\"onremovetrack\"),l.receiveStreamCollection.remove(l.stream.id)},this.mainTrack.onended=function(){logEvent(\"onended\"),l.settings.removeRecvStreamOnEnded&&l.receiveStreamCollection.remove(l.stream.id)},this.mainTrack.onmute=function(){return logEvent(\"onmute\")},this.mainTrack.onunmute=function(){return logEvent(\"onunmute\")}},WebRtcReceiveStreamStateDecorator.prototype.unsubscribeFromStreamEvents=function(){this.stream.onremovetrack=null,this.mainTrack.onended=null,this.mainTrack.onmute=null,this.mainTrack.onunmute=null},WebRtcReceiveStreamStateDecorator}();d.default=p},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},g=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},f=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},m=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},v=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},y=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.VideoEffectManager=void 0;var S=u(7),_=u(30),C=u(49),E=u(1),T=u(448),b=u(170),I=function(l){function VideoEffectManager(d,u,p){var h,g=l.call(this)||this;return g.webcvProvider=d,g.configProvider=u,g.logger=p,g.serialQueue=new _.PromiseQueue(g.logger),g.videoEffectToWebCVEffectMapping=((h={})[0]=\"off\",h[1]=\"blur\",h[16]=\"replacement\",h),g.effectType=0,g.isPortrait=!1,g.statistics=new b.EffectStatistics(g.configProvider.config.effectsTelemetryBufferSize),g.processorType=\"Webgl2\",g}return p(VideoEffectManager,l),Object.defineProperty(VideoEffectManager.prototype,\"isEffectEnabled\",{get:function(){return 0!==this.effectType},enumerable:!1,configurable:!0}),VideoEffectManager.prototype.init=function(){return m(this,void 0,void 0,(function(){var l,d;return v(this,(function(u){switch(u.label){case 0:if(this.effectProvider)return[2];this.logger.safe.debug(\"Init\"),u.label=1;case 1:return u.trys.push([1,3,,4]),l=this,[4,this.initializeVideoEffectProvider()];case 2:return l.effectProvider=u.sent(),[3,4];case 3:throw d=u.sent(),this.notifyError(\"FailedToInitialize\",\"Initialization failed, error:\".concat(E.stringifyObject(d))),d;case 4:return[2]}}))}))},VideoEffectManager.prototype.dispose=function(){return m(this,void 0,void 0,(function(){return v(this,(function(d){return this.logger.safe.debug(\"Dispose\"),this.effectProvider&&(this.effectProviderSubs.forEach((function(l){return l.dispose()})),this.effectProviderSubs=null),this.effectProvider&&this.effectProvider.disposeAsync(),l.prototype.dispose.call(this),[2]}))}))},VideoEffectManager.prototype.configure=function(l){return m(this,void 0,void 0,(function(){return v(this,(function(d){return this.logger.safe.debug(\"Set config: \".concat(JSON.stringify(l))),this.effectConfig={backgroundImageUrl:l.imagePath,headers:l.headers},this.effectProvider?[2,this.effectProvider.configureEffect(this.effectConfig)]:(this.logger.safe.debug(\"WebCV is not initialized. Do nothing\"),[2])}))}))},VideoEffectManager.prototype.setEffectAsync=function(l){return m(this,void 0,void 0,(function(){var d,u;return v(this,(function(p){switch(p.label){case 0:if(this.logger.safe.debug(\"Set effect: \".concat(l)),!(d=this.getWebCVEffect(l)))throw new Error(\"Effect with type \".concat(l,\" is not supported\"));if(this.effectType===l)return this.logger.safe.debug(\"Effect \".concat(this.effectType,\" is already set\")),[2];if(this.effectType=l,!this.effectProvider)return this.logger.safe.debug(\"WebCV is not initialized. Do nothing\"),[2];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.effectProvider.setEffectAsync(d)];case 2:return p.sent(),[3,4];case 3:throw u=p.sent(),this.handleFailedProcessing(),this.notifyError(\"FailedToInitialize\",\"Failed to apply \".concat(d,\", error:\").concat(E.stringifyObject(u))),u;case 4:return[2]}}))}))},VideoEffectManager.prototype.setSourceAsync=function(l){return m(this,void 0,void 0,(function(){var d,u,p;return v(this,(function(h){switch(h.label){case 0:if(this.logger.safe.debug(\"Set source: \".concat(l?l.id:\"no stream\")),!this.effectProvider)return this.logger.safe.debug(\"WebCV is not initialized. Do nothing\"),[2,l];l.getTracks().length>0&&(d=l.getVideoTracks()[0].getSettings(),this.isPortrait=d.height>d.width),u=l,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.effectProvider.setSourceAsync(l)];case 2:return u=h.sent(),[3,4];case 3:return p=h.sent(),this.handleFailedProcessing(),this.notifyError(\"FailedToInitialize\",\"Failed to set source, error:\".concat(E.stringifyObject(p))),[3,4];case 4:return[2,u]}}))}))},VideoEffectManager.prototype.removeSourceAsync=function(l){return m(this,void 0,void 0,(function(){return v(this,(function(d){return this.logger.safe.debug(\"Remove source: \".concat(l?l.id:\"no stream\")),this.effectProvider?[2,this.effectProvider.removeSourceAsync(l)]:(this.logger.safe.debug(\"WebCV is not initialized. Do nothing\"),[2])}))}))},VideoEffectManager.prototype.getEffectsCapability=function(){return m(this,void 0,void 0,(function(){var l,d,u,p,h,g,f,m;return v(this,(function(v){switch(v.label){case 0:return l=0,[4,this.getCapability()];case 1:d=v.sent(),this.logger.safe.debug(\"Get capabilty with return: \".concat(JSON.stringify(d)));try{for(u=y(d),p=u.next();!p.done;p=u.next()){if(h=p.value,!(g=this.getVideoEffectType(h)))throw new Error(\"Cannot convert WebCV effect to VideoEffect \".concat(h));l|=g}}catch(l){f={error:l}}finally{try{p&&!p.done&&(m=u.return)&&m.call(u)}finally{if(f)throw f.error}}return[2,l]}}))}))},VideoEffectManager.prototype.getStats=function(){if(this.effectProvider){var l=this.effectProvider.getStats();return h({timestamp:Date.now()},this.createTelemetryEvent(l))}},VideoEffectManager.prototype.getVersion=function(){return this.effectProvider&&this.effectProvider.getVersion?this.effectProvider.getVersion():\"Unknown\"},VideoEffectManager.prototype.resetOutputConstraints=function(l){var d,u;if(this.effectProvider&&l.video){var p=h({},this.configProvider.config.webcv.qualityConfig);this.isPortrait?p.outputResolution=null!==(d=l.video.maxWidth)&&void 0!==d?d:p.outputResolution:p.outputResolution=null!==(u=l.video.maxHeight)&&void 0!==u?u:p.outputResolution,this.effectProvider.configureStreamProcessor(p)}},VideoEffectManager.prototype.createTelemetryEvent=function(l){return{payload:h(h({version:this.getVersion()},this.statistics.getReport()),l)}},VideoEffectManager.prototype.notifyError=function(l,d){this.statistics.setError(l,d),this.notifyAboutLastSessionStats()},VideoEffectManager.prototype.notifyAboutLastSessionStats=function(){var l=this.getStats();this.event(\"onVideoEffectTelementyEvent\").raise(l)},VideoEffectManager.prototype.initializeVideoEffectProvider=function(){return m(this,void 0,void 0,(function(){var l,d,u=this;return v(this,(function(p){switch(p.label){case 0:return this.webcvProvider?(this.statistics.startLoadTimer(),[4,this.webcvProvider.getVideoEffectProvider()]):(this.logger.safe.debug(\"WebCV provider is not set\"),[2,null]);case 1:return l=p.sent(),this.statistics.stopLoadTimer(),l?(this.logger.safe.debug(\"WebCV v\".concat(l.getVersion&&l.getVersion(),\" is initialized\")),[4,this.webcvProvider.getModelConfig()]):(this.statistics.setError(\"FailedToInitialize\"),this.logger.safe.warn(\"WebCV is not initialized\"),[2,null]);case 2:return d=p.sent(),l.configureModel(d),[4,l.configure(h(h({},this.configProvider.config.webcv),{processorType:this.processorType}))];case 3:return p.sent(),this.effectConfig?[4,l.configureEffect(this.effectConfig)]:[3,5];case 4:p.sent(),p.label=5;case 5:return this.effectProviderSubs=[l.on(\"onEffectApplied\",(function(){return u.event(\"onMediaStreamUpdateRequested\").raise(\"Video\")})),l.on(\"onEffectStopped\",(function(){return u.notifyAboutLastSessionStats()})),l.on(\"onVideoEffectQualityChanged\",(function(l){return u.event(\"onVideoEffectQualityChanged\").raise(l)})),l.on(\"onVideoStreamQualityChanged\",(function(l){return u.event(\"onVideoStreamQualityChanged\").raise(l.resolution,l.fps)})),l.on(\"onCapabilitiesChanged\",(function(){return u.event(\"onVideoEffectCapabilitiesChanged\").raise()})),l.on(\"onFirstFrameProcessed\",(function(){return u.onPreheatCompleted()})),l.on(\"onErrorNotified\",(function(l){return u.notifyError(\"WebcvProccessorError\",l)}))],[2,l]}}))}))},VideoEffectManager.prototype.getCapability=function(){return m(this,void 0,void 0,(function(){var l,d;return v(this,(function(u){return this.configProvider.config.enableVideoEffects?this.webcvProvider?(l=new T.CapabilityChecker(this.configProvider,this.statistics,this.logger.createChild(\"CapabilityChecker\")),d=[\"off\"],l.isWasmEffectSupported()?(d=[\"off\",\"blur\",\"replacement\"],this.processorType=\"Wasm\"):l.isWebgl2EffectSupported()&&(d=[\"off\",\"blur\",\"replacement\"],this.processorType=\"Webgl2\"),[2,this.effectProvider?this.effectProvider.getCapability():d]):(this.logger.debug(\"WebCVProvider is not configured\"),[2,[\"off\"]]):(this.logger.debug(\"Video effects disabled\"),[2,[\"off\"]])}))}))},VideoEffectManager.prototype.getWebCVEffect=function(l){return this.videoEffectToWebCVEffectMapping[l]},VideoEffectManager.prototype.getVideoEffectType=function(l){var d=this;return E.keys(this.videoEffectToWebCVEffectMapping).find((function(u){return d.videoEffectToWebCVEffectMapping[u]===l}))},VideoEffectManager.prototype.onPreheatCompleted=function(){this.event(\"onVideoEffectApplied\").raise(),this.logger.safe.debug(\"onVideoEffectApplied event raised\")},VideoEffectManager.prototype.handleFailedProcessing=function(){return m(this,void 0,void 0,(function(){var l;return v(this,(function(d){switch(d.label){case 0:this.effectType=0,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.effectProvider.setEffectAsync(\"off\")];case 2:return d.sent(),[3,4];case 3:return l=d.sent(),this.notifyError(\"WebcvProccessorError\",\"Failed to handle error state, error:\".concat(E.stringifyObject(l))),[3,4];case 4:return[2]}}))}))},g([(0,C.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],VideoEffectManager.prototype,\"init\",null),g([(0,C.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],VideoEffectManager.prototype,\"dispose\",null),g([(0,C.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],VideoEffectManager.prototype,\"configure\",null),g([(0,C.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Number]),f(\"design:returntype\",Promise)],VideoEffectManager.prototype,\"setEffectAsync\",null),g([(0,C.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],VideoEffectManager.prototype,\"setSourceAsync\",null),g([(0,C.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],VideoEffectManager.prototype,\"removeSourceAsync\",null),g([(0,C.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],VideoEffectManager.prototype,\"getEffectsCapability\",null),VideoEffectManager}(S.default);d.VideoEffectManager=I},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.CapabilityChecker=void 0;var p=u(1),h=u(27),g=function(){function CapabilityChecker(l,d,u){this.configProvider=l,this.statistics=d,this.logger=u}return CapabilityChecker.prototype.isWasmEffectSupported=function(){return this.configProvider.config.webcv.useWasmEffects?!!window.MediaStreamTrackProcessor||(this.logger.info(\"wasmEffects disabled, insertable streams are not supported\"),!1):(this.logger.info(\"wasmEffects disabled by feature flag\"),!1)},CapabilityChecker.prototype.isWebgl2EffectSupported=function(){return this.isCurrentRendererSupported()&&this.isWebGL2Supported()},CapabilityChecker.prototype.isCurrentRendererSupported=function(){var l=this.configProvider.config.webcv.webGLUnsupportedRenderers,d=!1,u=h.UserAgentConfig.unmaskedGlRenderer;return this.statistics.setRenderer(u),u&&!l.some((function(l){return l===u}))?d=!0:(this.statistics.setError(\"RendererIsNotSupported\",\"Blacklisted from \".concat(JSON.stringify(l))),this.logger.info(\"Unsupported renderer: \".concat((0,p.stringifyObject)(u)))),d},CapabilityChecker.prototype.isWebGL2Supported=function(){try{var l=document.createElement(\"canvas\").getContext(\"webgl2\");if(!l)return this.statistics.setError(\"WebGL2IsNotSupported\"),this.logger.info(\"WebGL2 context is not supported\"),!1;var d=l.getSupportedExtensions(),u=this.configProvider.config.webcv.webGLRequiredExtensions.filter((function(l){return!d.includes(l)}));if(u.length>0)return this.statistics.setError(\"WebGL2RequiredExtensionsNotSupported\",\"Required WebGL2 extensions not supported.\"),this.logger.info(\"Unsupported WebGL2 extensions: \".concat((0,p.stringifyObject)(u))),!1}catch(l){return this.statistics.setError(\"WebGL2IsNotSupported\",\"Error: \".concat((0,p.stringifyObject)(l))),this.logger.error(\"isWebGL2Supported: \".concat((0,p.stringifyObject)(l))),!1}return!0},CapabilityChecker}();d.CapabilityChecker=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},g=this&&this.__decorate||function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},f=this&&this.__metadata||function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},m=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},v=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.AudioEffectManager=void 0;var y=u(7),S=u(30),_=u(49),C=u(1),E=u(170),T=function(l){function AudioEffectManager(d,u,p,h){var g,f,m=l.call(this)||this;return m.wasmdnsProvider=d,m.wasmaecProvider=u,m.configProvider=p,m.logger=h,m.serialQueue=new S.PromiseQueue(m.logger),m.statistics=new E.EffectStatistics(m.configProvider.config.effectsTelemetryBufferSize),m.currentEffect=\"Off\",m.currentEffectProvider=\"WasmDns\",m.currentEffectCapability=0,m.audioEffectToWasmDnsEffectMapping=((g={})[0]=\"Off\",g[1]=\"Deep NS\",g[2]=\"Classic NS\",g),m.noiseSuppressionModeToAudioEffectMapping=((f={}).Off=\"Off\",f.High=\"Deep NS\",f.Low=\"Classic NS\",f),m}return p(AudioEffectManager,l),AudioEffectManager.prototype.configureEffect=function(l){return m(this,void 0,void 0,(function(){var d,u,p;return v(this,(function(h){switch(h.label){case 0:return this.dnsProvider?[3,2]:(this.logger.safe.debug(\"Initializing DNS provider ...\"),d=this,[4,this.initializeAudioEffectProvider(1)]);case 1:d.dnsProvider=h.sent(),h.label=2;case 2:return this.aecProvider?[3,4]:(this.logger.safe.debug(\"Initializing AEC provider ...\"),u=this,[4,this.initializeAudioEffectProvider(2)]);case 3:u.aecProvider=h.sent(),h.label=4;case 4:if(!l.audioContext)return this.notifyError(\"FailedToInitialize\",\"Unable to configure audio effects: no audio context specified.\"),[2];l.noiseSuppressionMode||(this.logger.safe.debug(\"configureEffect was called without a noiseSuppressionMode. Using noiseSuppressionMode from config provider ...\"),l.noiseSuppressionMode=this.configProvider.mediaConfig.noiseSuppressionMode),this.currentEffect=this.noiseSuppressionModeToAudioEffectMapping[l.noiseSuppressionMode],this.logger.safe.debug(\"currentEffect is \".concat(this.currentEffect)),h.label=5;case 5:return h.trys.push([5,8,,9]),this.logger.safe.debug(\"Configuring audio effect for DNS ...\"),[4,this.dnsProvider.configureEffect(l)];case 6:return h.sent(),this.logger.safe.debug(\"Configuring audio effect for AEC ...\"),[4,this.aecProvider.configureEffect(l)];case 7:return h.sent(),this.logger.safe.debug(\"The audio effects were configured as follows: \".concat(C.stringifyObject(l))),[3,9];case 8:return p=h.sent(),this.notifyError(\"FailedToInitialize\",\"Audio effect provider configuration failed (\".concat(p,\"), while trying to use this configuration: \").concat(C.stringifyObject(l),\".\")),[3,9];case 9:return[2]}}))}))},AudioEffectManager.prototype.setSourceAsync=function(l){return m(this,void 0,void 0,(function(){var d,u,p=this;return v(this,(function(h){switch(h.label){case 0:if(this.logger.safe.debug(\"Set source: \".concat(l?l.id:\"no stream\",\", this.currentEffect = \").concat(this.currentEffect)),!this.dnsProvider||!this.aecProvider)return this.statistics.setError(\"FailedToInitialize\",\"setSourceAsync: audio effect provider not initialized (\".concat(this.dnsProvider?\"AEC\":\"DNS\",\").\")),this.logger.safe.warn(\"Unable to configure audio effects: audio effect provider not initialized (\".concat(this.dnsProvider?\"AEC\":\"DNS\",\").\")),[2,l];this.effectProviderSubs=[this.dnsProvider.on(\"onEffectStopped\",(function(){return p.notifyAboutLastSessionStats()})),this.dnsProvider.on(\"onErrorNotified\",(function(l){return p.notifyError(\"WasmDnsProccessorError\",l)})),this.aecProvider.on(\"onErrorNotified\",(function(l){return p.notifyError(\"WasmAecProccessorError\",l)}))],d=l,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.dnsProvider.setSourceAsync(l)];case 2:return d=h.sent(),[3,4];case 3:return u=h.sent(),this.notifyError(\"WasmDnsProccessorError\",\"setSourceAsync: Failed to asynchronously set source for DNS (\".concat(u,\")\")),[3,4];case 4:try{return[2,this.aecProvider.setSourceAsync(d)]}catch(l){return this.notifyError(\"WasmAecProccessorError\",\"setSourceAsync: Failed to asynchronously set source for AEC (\".concat(l,\")\")),[2,d]}return[2]}}))}))},AudioEffectManager.prototype.setEffectAsync=function(l){return m(this,void 0,void 0,(function(){var d,u;return v(this,(function(p){switch(p.label){case 0:if(d=this.getWasmDnsEffect(l),this.logger.safe.debug(\"Set effect: \".concat(l,\" (\").concat(d,\")\")),!d)throw this.notifyError(\"WasmDnsProccessorError\",\"setEffectAsync: Audio effect with type '\".concat(l,\"' is not supported\")),new Error(\"Audio effect with type '\".concat(l,\"' is not supported\"));if(!this.dnsProvider||!this.aecProvider)return this.notifyError(\"FailedToInitialize\",\"setEffectAsync: Audio effects provider not initialized (\".concat(this.dnsProvider?\"AEC\":\"DNS\",\").\")),this.logger.safe.debug(\"Audio effects provider not initialized (\".concat(this.dnsProvider?\"AEC\":\"DNS\",\").\")),[2];p.label=1;case 1:switch(p.trys.push([1,12,,13]),this.currentEffect=this.audioEffectToWasmDnsEffectMapping[l],this.logger.safe.debug(\"currentEffect is \".concat(this.currentEffect)),this.currentEffectProvider=\"WasmDns\",d){case\"Deep NS\":return[3,2];case\"Off\":return[3,5]}return[3,8];case 2:return[4,this.dnsProvider.setEffectAsync(d)];case 3:return p.sent(),[4,this.aecProvider.setEffectAsync(\"Off\")];case 4:return p.sent(),[3,11];case 5:return[4,this.dnsProvider.setEffectAsync(d)];case 6:return p.sent(),[4,this.aecProvider.setEffectAsync(d)];case 7:return p.sent(),[3,11];case 8:return this.currentEffectProvider=\"WasmAec\",[4,this.aecProvider.setEffectAsync(d)];case 9:return p.sent(),[4,this.dnsProvider.setEffectAsync(\"Off\")];case 10:p.sent(),p.label=11;case 11:return[3,13];case 12:throw u=p.sent(),this.notifyError(\"WasmDns\"===this.currentEffectProvider?\"WasmDnsProccessorError\":\"WasmAecProccessorError\",\"setEffectAsync: Failed to apply '\".concat(d,\"' audio effect, error: \").concat(C.stringifyObject(u))),u;case 13:return[2]}}))}))},AudioEffectManager.prototype.dispose=function(){var d,u,p;return m(this,void 0,void 0,(function(){return v(this,(function(h){try{null===(d=this.dnsProvider)||void 0===d||d.dispose(),null===(u=this.aecProvider)||void 0===u||u.dispose(),null===(p=this.effectProviderSubs)||void 0===p||p.forEach((function(l){return l.dispose()})),this.effectProviderSubs=null,l.prototype.dispose.call(this),this.logger.safe.debug(\"The audio effects provider was disposed.\")}catch(l){this.logger.safe.error(\"dispose: Failed to dispose the audio effects provider (\".concat(l,\")\"))}return[2]}))}))},AudioEffectManager.prototype.getEffectsCapability=function(){return m(this,void 0,void 0,(function(){return v(this,(function(l){return this.currentEffectCapability=0,this.configProvider.config.wasmdns.enableNoiseSuppression&&(this.currentEffectCapability|=2,this.currentEffectCapability|=1),[2,this.currentEffectCapability]}))}))},AudioEffectManager.prototype.getVersion=function(){var l,d,u,p,h=\"WasmDns \".concat(null!==(d=null===(l=this.dnsProvider)||void 0===l?void 0:l.getVersion())&&void 0!==d?d:\"Unknown\"),g=\"WasmAec \".concat(null!==(p=null===(u=this.aecProvider)||void 0===u?void 0:u.getVersion())&&void 0!==p?p:\"Unknown\");return\"\".concat(h,\" / \").concat(g)},AudioEffectManager.prototype.getStats=function(){var l;this.dnsProvider&&this.wasmaecProvider||this.statistics.setError(\"FailedToInitialize\",\"getStats: Unable to get stats from uninitialized audio effect provider (\".concat(this.dnsProvider?\"AEC\":\"DNS\",\").\"));var d=null===(l=this.dnsProvider)||void 0===l?void 0:l.getStats();return d||(this.statistics.setError(\"FailedToInitialize\",\"getStats: Empty stats from DNS provider.\"),d={}),h({timestamp:Date.now()},this.createTelemetryEvent(d))},AudioEffectManager.prototype.getWasmDnsEffect=function(l){return this.audioEffectToWasmDnsEffectMapping[l]},AudioEffectManager.prototype.initializeAudioEffectProvider=function(l){return m(this,void 0,void 0,(function(){var d,u,p;return v(this,(function(h){switch(h.label){case 0:if(1===l&&!this.wasmdnsProvider)return this.statistics.setError(\"FailedToInitialize\",\"initializeAudioEffectProvider: WasmDns package not available.\"),this.logger.safe.warn(\"WasmDns package not available.\"),[2,null];if(2===l&&!this.wasmaecProvider)return this.statistics.setError(\"FailedToInitialize\",\"initializeAudioEffectProvider: WasmAec package not available.\"),this.logger.safe.warn(\"WasmAec package not available.\"),[2,null];switch(l){case 1:case 0:this.currentEffectProvider=\"WasmDns\";break;default:this.currentEffectProvider=\"WasmAec\"}this.statistics.startLoadTimer(),h.label=1;case 1:return h.trys.push([1,6,,7]),\"WasmDns\"!==this.currentEffectProvider?[3,3]:[4,this.wasmdnsProvider.getAudioEffectProvider()];case 2:return u=h.sent(),[3,5];case 3:return[4,this.wasmaecProvider.getAudioEffectProvider()];case 4:u=h.sent(),h.label=5;case 5:return d=u,[3,7];case 6:return p=h.sent(),this.logger.safe.warn(\"initializeAudioEffectProvider: Failed to initialize \".concat(this.currentEffectProvider,\" audio effect provider (\").concat(p,\")\")),this.statistics.setError(\"FailedToInitialize\",\"initializeAudioEffectProvider: Failed to initialize \".concat(this.currentEffectProvider,\" audio effect provider (\").concat(p,\")\")),[3,7];case 7:return this.statistics.stopLoadTimer(),d?(this.logger.safe.debug(\"\".concat(this.currentEffectProvider,\" v\").concat(d.getVersion&&d.getVersion(),\" initialized!\")),[2,d]):(this.logger.safe.warn(\"Failed to initialize \".concat(this.currentEffectProvider,\" audio effect provider.\")),[2,null])}}))}))},AudioEffectManager.prototype.createTelemetryEvent=function(l){return this.logger.safe.debug(\"Telemetry report: \".concat(JSON.stringify(l),\" under version \").concat(this.getVersion(),\", and capability is \").concat(this.currentEffectCapability)),{payload:h(h({audioEffectsCapability:this.currentEffectCapability,version:this.getVersion()},this.statistics.getReport()),l)}},AudioEffectManager.prototype.notifyError=function(l,d){this.statistics.setError(l,d),this.notifyAboutLastSessionStats()},AudioEffectManager.prototype.notifyAboutLastSessionStats=function(){var l=this.getStats();this.event(\"onAudioEffectTelemetryEvent\").raise(l)},g([(0,_.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],AudioEffectManager.prototype,\"configureEffect\",null),g([(0,_.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Object]),f(\"design:returntype\",Promise)],AudioEffectManager.prototype,\"setSourceAsync\",null),g([(0,_.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[Number]),f(\"design:returntype\",Promise)],AudioEffectManager.prototype,\"setEffectAsync\",null),g([(0,_.sequentialize)(),f(\"design:type\",Function),f(\"design:paramtypes\",[]),f(\"design:returntype\",Promise)],AudioEffectManager.prototype,\"dispose\",null),AudioEffectManager}(y.default);d.AudioEffectManager=T},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.PermissionManager=void 0;var f=u(7),m=u(15),v=u(1),y=u(3),S=u(27),_=[y.default.MEDIA_STATE.inactive,y.default.MEDIA_STATE.receive,y.default.MEDIA_STATE.send,y.default.MEDIA_STATE.sendReceive],C=[y.default.MEDIA_STATE.inactive,y.default.MEDIA_STATE.receive],E=function(l){function PermissionManager(d,u,p){var h=l.call(this)||this;return h.configProvider=d,h.deviceManager=u,h.logger=p,h.currentState={microphone:\"unknown\",camera:\"unknown\"},h.lastGum={audio:!1,video:!1},h.registeredTrackers=new Set,h.window=m.default.window,h.permittedModalities={audio:_,video:_,sharing:_},h.initialize(),h}return p(PermissionManager,l),PermissionManager.prototype.initialize=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){switch(l.label){case 0:return!S.UserAgentConfig.hasPermissionsApi()||\"unknown\"!==this.currentState.microphone&&\"unknown\"!==this.currentState.camera?[3,3]:(this.logger.safe.info(\"Initializing\"),[4,this.registerPermissionTracker(\"microphone\")]);case 1:return l.sent(),[4,this.registerPermissionTracker(\"camera\")];case 2:return l.sent(),[3,4];case 3:\"unknown\"!==this.currentState.microphone&&\"unknown\"!==this.currentState.camera||this.logger.safe.warn(\"Permissions API is not supported in this browser. Microphone: \".concat(this.currentState.microphone,\", camera: \").concat(this.currentState.camera)),l.label=4;case 4:return[2]}}))}))},PermissionManager.prototype.getPermissionState=function(l){return this.currentState[l]||\"unknown\"},PermissionManager.prototype.isPermissionKnown=function(l){var d=this.getPermissionState(l);return\"unknown\"!==d&&\"prompt\"!==d},Object.defineProperty(PermissionManager.prototype,\"browserPermittedModalities\",{get:function(){return this.permittedModalities},enumerable:!1,configurable:!0}),Object.defineProperty(PermissionManager.prototype,\"knownPermissionStates\",{get:function(){return v.deepClone(this.currentState)},enumerable:!1,configurable:!0}),PermissionManager.prototype.update=function(l,d){var u=this,p=v.deepClone(d);l.audio||delete p.audio,l.video||delete p.video;var h=v.deepClone(this.permittedModalities);v.forOwn(p,(function(l,d){u.permittedModalities[d]=l?_:C})),v.deepEqual(h,this.permittedModalities)||this.event(\"onDevicesPermissionChanged\").raise()},PermissionManager.prototype.askDevicePermission=function(l){return h(this,void 0,void 0,(function(){var d,u,p,f,m,y,S,C=this;return g(this,(function(E){switch(E.label){case 0:if(d=l?v.deepClone(l):{audio:!0,video:this.deviceManager.hasCamera()},this.configProvider.config.permissions.rememberNegative&&(d.audio=d.audio&&this.permittedModalities.audio===_,d.video=d.video&&this.permittedModalities.video===_),d.sharing)throw new Error(\"askDevicePermission does not support sharing constraints.\");return u={audio:!1,video:!1},this.lastGum={audio:!1,video:!1},p=function(u,p,f){return h(C,void 0,void 0,(function(){var h;return g(this,(function(g){switch(g.label){case 0:return h={audio:!!u.audio,video:!!u.video,sharing:!0},!(this.configProvider.config.permissions.adpRequestAVLast&&d.audio&&d.video)||this.lastGum.audio&&this.lastGum.video?[3,2]:(this.logger.safe.info(\"Prompting for audio and video to ensure omnibar state\"),[4,this.askDevicePermissionPrompt({audio:!0,video:!0},!1)]);case 1:g.sent(),g.label=2;case 2:return this.update(d,h),this.deviceManager.raiseTelemetryEvent(\"ask_device_permission\",{constraints:l,resultConstraints:u,error:f,reason:p}),[2,h]}}))}))},[4,this.initialize()];case 1:return E.sent(),f=this.getPermissionState(\"microphone\"),m=this.getPermissionState(\"camera\"),this.logger.safe.info(\"Permission state { audio: \".concat(f,\", video: \").concat(m,\" }\")),!this.configProvider.config.permissions.useNegativeInAdp||d.audio&&\"denied\"!==f||d.video&&\"denied\"!==m?this.configProvider.config.permissions.usePositiveInAdp&&(!d.audio||d.audio&&\"granted\"===f)&&(!d.video||d.video&&\"granted\"===m)?[2,p(d,\"navigator_permissions_granted\")]:[3,2]:[2,p(u,\"navigator_permissions_denied\")];case 2:return E.trys.push([2,4,,5]),y=p,[4,this.askDevicePermissionPrompt(d,this.configProvider.config.permissions.adpFallback)];case 3:return[2,y.apply(void 0,[E.sent(),\"stream_acquisition\"])];case 4:return S=E.sent(),[2,p(u,\"stream_acquisition\",S)];case 5:return[2]}}))}))},PermissionManager.prototype.askDevicePermissionPrompt=function(l,d){return void 0===d&&(d=!0),h(this,void 0,void 0,(function(){var u,p,h,f,m,y,S;return g(this,(function(g){switch(g.label){case 0:u={audio:!1,video:!1},g.label=1;case 1:return g.trys.push([1,4,,16]),(p=this.deviceManager.getMediaStream(l))?(this.lastGum=v.deepClone(l),[4,p.start()]):[3,3];case 2:g.sent(),u.audio=p.hasAudio(),u.video=p.hasVideo(),this.disposeLater(p),g.label=3;case 3:return[2,u];case 4:if(h=g.sent(),!(l.audio&&l.video&&d))return[3,14];g.label=5;case 5:return g.trys.push([5,8,,9]),f=u,(m=this.configProvider.config.permissions.adpFallbackVideo)?[4,this.askDevicePermissionPrompt({video:!0})]:[3,7];case 6:m=g.sent().video,g.label=7;case 7:return f.video=m,[3,9];case 8:return g.sent(),[3,9];case 9:return g.trys.push([9,12,,13]),y=u,(S=this.configProvider.config.permissions.adpFallbackAudio)?[4,this.askDevicePermissionPrompt({audio:!0})]:[3,11];case 10:S=g.sent().audio,g.label=11;case 11:return y.audio=S,[3,13];case 12:return g.sent(),[3,13];case 13:return[3,15];case 14:if(d)throw h;g.label=15;case 15:return[2,u];case 16:return[2]}}))}))},PermissionManager.prototype.disposeLater=function(l){setTimeout((function(){l.dispose()}),this.configProvider.config.mediaStreamHoldInterval)},PermissionManager.prototype.registerPermissionTracker=function(l){return h(this,void 0,void 0,(function(){var d,u,p=this;return g(this,(function(h){switch(h.label){case 0:if(this.registeredTrackers.has(l))return[2];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.window.navigator.permissions.query({name:l})];case 2:return d=h.sent(),this.handlePermissionStateChanged(l,d.state),d.onchange=function(){return p.handlePermissionStateChanged(l,d.state)},this.registeredTrackers.add(l),[3,4];case 3:return u=h.sent(),this.logger.safe.error(\"Error querying permissions for \".concat(l,\": \").concat(v.stringifyObject(u))),[3,4];case 4:return[2]}}))}))},PermissionManager.prototype.handlePermissionStateChanged=function(l,d){this.logger.safe.info(\"Permission state for \".concat(l,\" changed \").concat(this.currentState[l],\" -> \").concat(d)),this.currentState[l]=d,this.deviceManager.raiseTelemetryEvent(\"permissions_state_changed\",this.knownPermissionStates),this.deviceManager.handlePermissionStateChange()},PermissionManager}(f.default);d.PermissionManager=E},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.DeviceManagerDiagnostics=void 0;var p=u(1),h=function(){function DeviceManagerDiagnostics(l){this.configProvider=l,this.data={deviceList:[],deviceSelectionChangeCount:0,deviceSelectionChangeCountFromInterface:0,permissionStates:{microphone:\"unknown\",camera:\"unknown\"},devicesCount:{microphone:0,camera:0,speaker:0,compositeAudio:0},devicesChangeCount:0,devicesPollChangeCount:0,deviceTelemetryEvents:[],videoEffectsEvents:[],audioEffectsEvents:[]}}return Object.defineProperty(DeviceManagerDiagnostics.prototype,\"permissionStates\",{set:function(l){this.data.permissionStates=l},enumerable:!1,configurable:!0}),DeviceManagerDiagnostics.prototype.setSelectedDevices=function(l,d){var u,h,g,f={microphone:p.scrubDeviceLabelPii(null===(u=l.microphone)||void 0===u?void 0:u.label,this.configProvider.config.devices.piiSafeWords),camera:p.scrubDeviceLabelPii(null===(h=l.camera)||void 0===h?void 0:h.label,this.configProvider.config.devices.piiSafeWords),speaker:p.scrubDeviceLabelPii(null===(g=l.speaker)||void 0===g?void 0:g.label,this.configProvider.config.devices.piiSafeWords)};this.data.usedDevices&&(this.data.deviceSelectionChangeCount++,d&&this.data.deviceSelectionChangeCountFromInterface++),this.data.usedDevices=f},DeviceManagerDiagnostics.prototype.setDeviceList=function(l,d,u){var h=this;this.data.deviceList=l.map((function(l){return{label:p.scrubDeviceLabelPii(l.label,h.configProvider.config.devices.piiSafeWords),kind:l.type}})),u&&(this.data.deviceDebugStrings=p.deepClone(u)),this.data.devicesCount.microphone=l.filter((function(l){return\"microphone\"===l.type})).length,this.data.devicesCount.camera=l.filter((function(l){return\"camera\"===l.type})).length,this.data.devicesCount.speaker=l.filter((function(l){return\"speaker\"===l.type})).length,this.data.devicesCount.compositeAudio=l.filter((function(l){return\"compositeAudio\"===l.type})).length,this.data.devicesChangeCount++,d&&this.data.devicesPollChangeCount++},DeviceManagerDiagnostics.prototype.registerDeviceTelemetryEvent=function(l){if(\"stream_acquired\"===l.eventType){var d=l.payload;\"Video\"===d.mediaType&&(this.data.latestCameraOpenResolution=d.resolution)}p.arrayPushFixedSize(this.data.deviceTelemetryEvents,l,this.configProvider.config.diagnostics.collectionLimits.numDeviceEvents)},DeviceManagerDiagnostics.prototype.registerVideoEffectsEvent=function(l){p.arrayPushFixedSize(this.data.videoEffectsEvents,l,this.configProvider.config.diagnostics.collectionLimits.numVideoEffectsEvents)},DeviceManagerDiagnostics.prototype.registerAudioEffectsEvent=function(l){p.arrayPushFixedSize(this.data.audioEffectsEvents,l,this.configProvider.config.diagnostics.collectionLimits.numAudioEffectsEvents)},DeviceManagerDiagnostics.prototype.getObjectRef=function(){return this.data},DeviceManagerDiagnostics}();d.DeviceManagerDiagnostics=h},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.MediaAgentDiagnostics=void 0;var p=u(453),h=u(1),g=u(457),f=u(27),m=u(19),v=function(){function MediaAgentDiagnostics(l,d){var u=this;this.configProvider=l,this.deviceManagerDiagnostics=d,this.root={creationTime:Date.now(),numTotalSessions:0,deviceManager:this.deviceManagerDiagnostics.getObjectRef(),configuration:{stackConfig:this.configProvider.stackConfig,defaultConfig:this.configProvider.defaultConfig,mediaConfig:{},userAgentConfig:{isAudioOutputSelectionSupported:this.configProvider.userAgentConfig.isAudioOutputSelectionSupported,isBrowserRollbackSupported:this.configProvider.userAgentConfig.isBrowserRollbackSupported,hardwareConcurrency:this.configProvider.userAgentConfig.hardwareConcurrency,unmaskedGlRenderer:this.configProvider.userAgentConfig.unmaskedGlRenderer,hasMediaApi:f.UserAgentConfig.hasMediaApi(),hasCapabilitiesApi:f.UserAgentConfig.hasCapabilitiesApi(),hasUnifiedPlanSupport:void 0},consoleOverrides:this.configProvider.consoleOverrides,fullConfig:h.deepClone(this.configProvider.config),ecsConfigUpdates:[]},browserInfo:(0,m.getBrowserInfo)(),sessions:[]},this.diagnosticsReport=new g.DiagnosticsReport(this.root,this.configProvider),this.configProvider.on(\"newConfigReceived\",(function(l,d,p){u.root.configuration.ecsConfigUpdates.push({timestamp:Date.now(),etag:d,configIds:p,config:l})})),this.configProvider.on(\"configUpdated\",(function(){u.root.configuration.consoleOverrides=u.configProvider.consoleOverrides,u.root.configuration.fullConfig=h.deepClone(u.configProvider.config)}))}return Object.defineProperty(MediaAgentDiagnostics.prototype,\"reportGenerator\",{get:function(){return this.diagnosticsReport},enumerable:!1,configurable:!0}),Object.defineProperty(MediaAgentDiagnostics.prototype,\"rootRef\",{get:function(){return this.root},enumerable:!1,configurable:!0}),Object.defineProperty(MediaAgentDiagnostics.prototype,\"mediaConfig\",{set:function(l){this.root.configuration.mediaConfig=l},enumerable:!1,configurable:!0}),MediaAgentDiagnostics.prototype.newSession=function(l,d,u){this.root.configuration.userAgentConfig.hasUnifiedPlanSupport=this.configProvider.mediaConfig.simulcastSessionEnabled;var g=new p.SessionDiagnostics(u,l,this.diagnosticsReport,this.root.deviceManager,++this.root.numTotalSessions,d);return h.arrayPushFixedSize(this.root.sessions,g.getObjectRef(),this.configProvider.config.diagnostics.collectionLimits.numSessions),g},MediaAgentDiagnostics}();d.MediaAgentDiagnostics=v},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.SessionDiagnostics=void 0;var h=u(1),g=u(9),f=u(454),m=RegExp(/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:[0-9]{2,5})?$/),v=RegExp(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/),y=RegExp(/^\\[(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\\](:[0-9]{2,5})$/),S=function(){function SessionDiagnostics(l,d,u,p,g,f){var m=this;this.logger=l,this.configProvider=d,this.diagnosticsReport=u,this.dmDiagnostics=p,this.data={creationTime:Date.now(),callNumber:0,sessionId:\"unknown\",isMultiParty:!1,dtmfSuccessCount:0,dtmfFailureCount:0,iceInitTime:0,iceConnectedStateTime:0,negotiationCount:0,rejectedNegotiationCount:0,initialNegotiationCompleted:!1,finalAnswerTime:0,transportReconnectedCount:0,rollbackNegotiation:[],allowedAudioSend:!0,allowedVideoSend:!0,allowedScreensharingSend:!0,noIceCandidatesEventCount:{good:0,bad:0},noRelayIceCandidatesEventCount:{good:0,bad:0},microphoneInUseEventCount:{good:0,bad:0},cameraInUseEventCount:{good:0,bad:0},cameraFreezeEventCount:{start:0,end:0},rawMedia:{audio:{recv:{numAttempts:0,durationRatio:0},send:{numAttempts:0,durationRatio:0}}},ufds:[],statsErrors:[],nativeSessions:[],isOngoing:!1,duration:0,callMutedRatio:0,callOsMuted:0,callHwSilent:0,callSwMuted:0,callSpeakerMuted:0,callIsSpeaking:0,networkRecvUFD:void 0,networkSendUFD:void 0,deviceManager:void 0,relayTimers:void 0},this.transportDisconnected=!1,this.commonMuteTracker=new C,this.swMuteTracker=new C,this.osMuteTracker=new C,this.speakerMuteTracker=new C,this.hwSilentTracker=new C,this.isSpeakingTracker=new C,this.networkRecv=new E,this.networkSend=new E,this.rawMediaTimers={audio:{send:new C,recv:new C}},this.dmFragmenter=new _(this.dmDiagnostics),this.data.callNumber=g,this.data.sessionId=f,h.addGetterFields(this.data,{isOngoing:function(){return void 0===m.data.terminationTime},duration:function(){return m.data.isOngoing?Date.now()-m.data.creationTime:m.data.terminationTime-m.data.creationTime},callMutedRatio:function(){return getDurationRatio(m.commonMuteTracker.elapsed,m.data.duration)},callOsMuted:function(){return m.osMuteTracker.elapsed},callHwSilent:function(){return m.hwSilentTracker.elapsed},callSwMuted:function(){return m.swMuteTracker.elapsed},callSpeakerMuted:function(){return m.speakerMuteTracker.elapsed},callIsSpeaking:function(){return m.isSpeakingTracker.elapsed},networkRecvUFD:function(){return{good:m.networkRecv.getCount(\"Good\"),poor:m.networkRecv.getCount(\"Poor\"),bad:m.networkRecv.getCount(\"Bad\"),goodRatio:getDurationRatio(m.networkRecv.getElapsed(\"Good\"),m.data.duration),poorRatio:getDurationRatio(m.networkRecv.getElapsed(\"Poor\"),m.data.duration),badRatio:getDurationRatio(m.networkRecv.getElapsed(\"Bad\"),m.data.duration)}},networkSendUFD:function(){return{good:m.networkSend.getCount(\"Good\"),poor:m.networkSend.getCount(\"Poor\"),bad:m.networkSend.getCount(\"Bad\"),goodRatio:getDurationRatio(m.networkSend.getElapsed(\"Good\"),m.data.duration),poorRatio:getDurationRatio(m.networkSend.getElapsed(\"Poor\"),m.data.duration),badRatio:getDurationRatio(m.networkSend.getElapsed(\"Bad\"),m.data.duration)}},deviceManager:function(){return m.dmFragmenter.getFragment(m.dmDiagnostics)},relayTimers:function(){var l;return null===(l=m.relayManagerTimers)||void 0===l?void 0:l.getStats()}}),h.addGetterFields(this.data.rawMedia.audio.recv,{durationRatio:function(){return getDurationRatio(m.rawMediaTimers.audio.recv.elapsed,m.data.duration)}}),h.addGetterFields(this.data.rawMedia.audio.send,{durationRatio:function(){return getDurationRatio(m.rawMediaTimers.audio.send.elapsed,m.data.duration)}})}return Object.defineProperty(SessionDiagnostics.prototype,\"telemetryReport\",{get:function(){var l=this,d=this.diagnosticsReport.getSessionTelemetry(this.data.sessionId);return h.forOwnRec(d,(function(d,u,p){p[u]=l.addPiiToStatsValue(d)})),{type:\"WebRtcMediaStats\",data:d}},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"relayManager\",{set:function(l){this.relayManagerTimers=l},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"isMultiParty\",{set:function(l){this.data.isMultiParty=l},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"mediaLegId\",{set:function(l){this.data.mediaLegId=l.process()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"ETag\",{set:function(l){this.data.ETag=l},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"configIds\",{set:function(l){this.data.configIds=l},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"reconnect\",{set:function(l){this.data.reconnect=l},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"relay\",{set:function(l){this.data.relay={address:l.addresses.join(),expires:l.expires,realm:l.realm,credentials:!(!l.username||!l.password),ports:[l.udpPort?\"udp:\".concat(l.udpPort):\"\",l.tcpPort?\"tcp:\".concat(l.tcpPort):\"\",l.tlsPort?\"tls:\".concat(l.tlsPort):\"\"].join(\",\"),fqdns:l.fqdns?l.fqdns.join():\"none\"}},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"sessionError\",{set:function(l){this.data.error=l},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"dtmfResult\",{set:function(l){l?this.data.dtmfSuccessCount++:this.data.dtmfFailureCount++},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"swMute\",{set:function(l){l?this.swMuteTracker.start():this.swMuteTracker.stop(),this.updateCommonMute()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"speakerMute\",{set:function(l){l?this.speakerMuteTracker.start():this.speakerMuteTracker.stop()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"hwSilent\",{set:function(l){l?this.hwSilentTracker.start():this.hwSilentTracker.stop()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"isSpeaking\",{set:function(l){l?this.isSpeakingTracker.start():this.isSpeakingTracker.stop()},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"iceInitTime\",{set:function(l){this.data.iceInitTime||(this.data.iceInitTime=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"finalAnswerTime\",{set:function(l){var d,u;null!==(d=(u=this.data).finalAnswerTime)&&void 0!==d||(u.finalAnswerTime=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"iceConnectedStateTimestamp\",{set:function(l){this.data.iceConnectedStateTime||(this.data.iceConnectedStateTime=l)},enumerable:!1,configurable:!0}),Object.defineProperty(SessionDiagnostics.prototype,\"allowedModalities\",{set:function(l){this.data.allowedAudioSend=l.audio.some((function(l){return g.hasSendDirectionality(l)})),this.data.allowedVideoSend=l.video.some((function(l){return g.hasSendDirectionality(l)})),this.data.allowedScreensharingSend=l.sharing.some((function(l){return g.hasSendDirectionality(l)}))},enumerable:!1,configurable:!0}),SessionDiagnostics.prototype.negotiationStart=function(l){var d,u;null!==(d=(u=this.data).initialNegotiationType)&&void 0!==d||(u.initialNegotiationType=l),this.data.negotiationCount++},SessionDiagnostics.prototype.negotiationCompleted=function(){this.data.initialNegotiationCompleted=!0,this.data.error=void 0},SessionDiagnostics.prototype.negotiationRejected=function(){this.data.rejectedNegotiationCount++},SessionDiagnostics.prototype.registerRollbackEvent=function(l){this.data.rollbackNegotiation.push({type:l.type,attempt:this.data.rollbackNegotiation.length+1,error:l.error})},SessionDiagnostics.prototype.registerRawMediaAccess=function(l,d,u){var p,h,g=null===(p=this.data.rawMedia[l])||void 0===p?void 0:p[d];if(g){g.numAttempts++;var f=null===(h=this.rawMediaTimers[l])||void 0===h?void 0:h[d];u?null==f||f.start():null==f||f.stop()}},SessionDiagnostics.prototype.registerQualityStateChangedEvent=function(l){switch(l.type){case\"NoNetwork\":\"Good\"===l.value?this.data.noIceCandidatesEventCount.good++:this.data.noIceCandidatesEventCount.bad++;break;case\"NetworkRelaysNotReachable\":\"Good\"===l.value?this.data.noRelayIceCandidatesEventCount.good++:this.data.noRelayIceCandidatesEventCount.bad++;break;case\"DeviceCaptureNotFunctioning\":\"Good\"===l.value?this.data.microphoneInUseEventCount.good++:this.data.microphoneInUseEventCount.bad++;break;case\"VideoCapturerDeviceStartFailed\":\"Good\"===l.value?this.data.cameraInUseEventCount.good++:this.data.cameraInUseEventCount.bad++;break;case\"DeviceCaptureMute\":\"Bad\"===l.value?this.osMuteTracker.start():this.osMuteTracker.stop(),this.updateCommonMute();break;case\"NetworkRecvQuality\":this.networkRecv.updateLevel(l.value);break;case\"NetworkSendQuality\":this.networkSend.updateLevel(l.value);break;case\"VideoCaptureDeviceFreeze\":\"Good\"===l.value?this.data.cameraFreezeEventCount.end++:this.data.cameraFreezeEventCount.start++}\"DeviceSpeakWhileMuted\"!==l.type&&h.arrayPushFixedSize(this.data.ufds,p(p({},l),{timestamp:Date.now()}),this.configProvider.config.diagnostics.collectionLimits.numUFDs)},SessionDiagnostics.prototype.registerTransportConnected=function(){this.transportDisconnected&&(this.transportDisconnected=!1,this.data.transportReconnectedCount++)},SessionDiagnostics.prototype.registerTransportDisconnected=function(){this.transportDisconnected=!0},SessionDiagnostics.prototype.registerTransportFailed=function(){this.transportDisconnected=!1},SessionDiagnostics.prototype.terminated=function(l){this.data.terminationReason=h.deepClone(l),this.data.terminationTime=Date.now(),this.swMuteTracker.stop(),this.speakerMuteTracker.stop(),this.hwSilentTracker.stop(),this.isSpeakingTracker.stop(),this.dmFragmenter.terminated(this.dmDiagnostics)},SessionDiagnostics.prototype.addStatsError=function(l,d){var u,p=this.data.statsErrors.find((function(u){return u.error===d&&u.origin===l}));this.logger.safe.error(\"Stats error from '\".concat(l,\"': \").concat(d,\" (\").concat(null!==(u=null==p?void 0:p.count)&&void 0!==u?u:1,\")\")),p?p.count++:h.arrayPushFixedSize(this.data.statsErrors,{origin:l,error:d,count:1},this.configProvider.config.diagnostics.collectionLimits.numStatsErrors)},SessionDiagnostics.prototype.newNativeSessionDiag=function(l){var d,u=this;return void 0===l&&(l=!0),d=new f.NativeSessionDiagnostics(this.configProvider,this.dmDiagnostics,(function(l,d){return u.addStatsError(l,d)}),(function(l){return u.newNativeSessionDiag(l)}),(function(){return u.pushNativeSessionDiag(d.getObjectRef())})),l&&h.arrayPushFixedSize(this.data.nativeSessions,d.getObjectRef(),this.configProvider.config.diagnostics.collectionLimits.numNativeSessions),d},SessionDiagnostics.prototype.pushNativeSessionDiag=function(l){h.arrayPushFixedSize(this.data.nativeSessions,l,this.configProvider.config.diagnostics.collectionLimits.numNativeSessions)},SessionDiagnostics.prototype.getObjectRef=function(){return this.data},SessionDiagnostics.prototype.addPiiToStatsValue=function(l){var d=0;return m.test(l)?d=13:(v.test(l)||y.test(l))&&(d=4),{type:d,value:l,__VALUE__:!0}},SessionDiagnostics.prototype.updateCommonMute=function(){this.swMuteTracker.isRunning||this.osMuteTracker.isRunning?this.commonMuteTracker.start():this.swMuteTracker.isRunning||this.osMuteTracker.isRunning||this.commonMuteTracker.stop()},SessionDiagnostics}();d.SessionDiagnostics=S;var _=function(){function DeviceManagerFragmenter(l){this.fragmentBase=this.sanitizeDiagnostics(l)}return DeviceManagerFragmenter.prototype.getFragment=function(l){var d,u=null!==(d=this.fragmentTerminated)&&void 0!==d?d:l;return{devicesChangeCount:u.devicesChangeCount-this.fragmentBase.devicesChangeCount,deviceSelectionChangeCount:u.deviceSelectionChangeCount-this.fragmentBase.deviceSelectionChangeCount,deviceSelectionChangeCountFromInterface:u.deviceSelectionChangeCountFromInterface-this.fragmentBase.deviceSelectionChangeCountFromInterface,devicesPollChangeCount:u.devicesPollChangeCount-this.fragmentBase.devicesPollChangeCount}},DeviceManagerFragmenter.prototype.terminated=function(l){this.fragmentTerminated=this.sanitizeDiagnostics(l)},DeviceManagerFragmenter.prototype.sanitizeDiagnostics=function(l){return{devicesChangeCount:l.devicesChangeCount,deviceSelectionChangeCount:l.deviceSelectionChangeCount,deviceSelectionChangeCountFromInterface:l.deviceSelectionChangeCountFromInterface,devicesPollChangeCount:l.devicesPollChangeCount}},DeviceManagerFragmenter}(),C=function(){function StopWatch(){this.startTime=0,this.elapsedInternal=0,this.countInternal=0}return Object.defineProperty(StopWatch.prototype,\"isRunning\",{get:function(){return!!this.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(StopWatch.prototype,\"elapsed\",{get:function(){return this.startTime?this.elapsedInternal+Date.now()-this.startTime:this.elapsedInternal},enumerable:!1,configurable:!0}),Object.defineProperty(StopWatch.prototype,\"count\",{get:function(){return this.countInternal},enumerable:!1,configurable:!0}),StopWatch.prototype.start=function(){this.startTime||(this.startTime=Date.now(),this.countInternal++)},StopWatch.prototype.stop=function(){this.startTime&&(this.elapsedInternal+=Date.now()-this.startTime,this.startTime=0)},StopWatch}(),E=function(){function QualityEventTracker(){this.currentLevel=\"Good\",this.stopWatches={},this.getStopWatch(this.currentLevel).start()}return QualityEventTracker.prototype.updateLevel=function(l){this.currentLevel!==l&&(this.getStopWatch(this.currentLevel).stop(),this.currentLevel=l,this.getStopWatch(this.currentLevel).start())},QualityEventTracker.prototype.getCount=function(l){var d=this.stopWatches[l];return d?d.count:0},QualityEventTracker.prototype.getElapsed=function(l){var d=this.stopWatches[l];return d?d.elapsed:0},QualityEventTracker.prototype.getStopWatch=function(l){var d=this.stopWatches[l];return d||(d=new C,this.stopWatches[l]=d),d},QualityEventTracker}();function getDurationRatio(l,d){return l/(0!==d?d:1)}},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},g=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0}),d.NativeSessionDiagnostics=void 0;var f=u(147),m=u(455),v=u(456),y=u(1),S=u(150),_=/profile-level-id=(.{6})/,C=function(){function NativeSessionDiagnostics(l,d,u,p,h){var g=this;this.configProvider=l,this.dmDiagnostics=d,this.addSessionStatsError=u,this.newNativeSession=p,this.commitNativeSession=h,this.data={startTime:Date.now(),duration:0,offeredSrtp:\"unknown\",negotiatedSrtp:\"unknown\",iceConnectionState:\"none\",iceConnectionStatePrevious:\"none\",signalingState:\"none\",signalingStatePrevious:\"none\",relayCandidate:\"none\",iceTransportPolicy:\"none\",iceServers:\"none\",fakeIceCandidate:!1,bweType:\"Unknown\",sdpSemantics:\"none\",bundlePolicy:\"none\",iceCandidateErrors:[],H264Profiles:[],numInterfaces:0,statsReports:[],aggregatedModalityStats:{},multiViewStats:[],networkInfo:[],statsErrors:[],recvVideoStreamCount:{min:0,max:0,mode:0}},y.addGetterFields(this.data,{duration:function(){return g.data.endTime?g.data.endTime-g.data.startTime:Date.now()-g.data.startTime}})}return Object.defineProperty(NativeSessionDiagnostics.prototype,\"deviceManager\",{get:function(){return this.dmDiagnostics},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"audioLevel\",{get:function(){var l;return null===(l=this.analyzer)||void 0===l?void 0:l.getInputLevel()},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"sharingAudioLevel\",{get:function(){var l;return null===(l=this.analyzerSharing)||void 0===l?void 0:l.getInputLevel()},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"offeredModalities\",{set:function(l){this.data.offeredModalities=l,this.data.activeModalities=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"negotiatedModalities\",{set:function(l){this.data.negotiatedModalities=l,this.data.activeModalities=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"offeredSrtp\",{set:function(l){this.data.offeredSrtp=getSrtpReport(l)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"negotiatedSrtp\",{set:function(l){this.data.negotiatedSrtp=getSrtpReport(l)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"iceConnectionState\",{set:function(l){this.data.iceConnectionStatePrevious=this.data.iceConnectionState,this.data.iceConnectionState=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"signalingConnectionState\",{set:function(l){this.data.signalingStatePrevious=this.data.signalingState,this.data.signalingState=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"relayCandidateInfo\",{set:function(l){this.data.relayCandidate=JSON.stringify(l)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"iceTransportPolicy\",{set:function(l){this.data.iceTransportPolicy=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"iceServers\",{set:function(l){var d=l.map((function(l){var d=p({},l);return d.username&&(d.username=\"true\"),d.credential&&(d.credential=\"true\"),d}));this.data.iceServers=JSON.stringify(d)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"fakeIceCandidate\",{set:function(l){this.data.fakeIceCandidate=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"bweType\",{set:function(l){this.data.bweType=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"sdpSemantics\",{set:function(l){this.data.sdpSemantics=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"bundlePolicy\",{set:function(l){this.data.bundlePolicy=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"latestRawReport\",{set:function(l){this.data.latestRawReport=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"recvVideoStreamsCount\",{set:function(l){this.data.recvVideoStreamCount=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"aggregatedStatsRef\",{set:function(l){this.data.aggregatedModalityStats=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"multiViewStatsRef\",{set:function(l){this.data.multiViewStats=l},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"videoCapabilities\",{set:function(l){if(null==l?void 0:l.codecs){var d=[];l.codecs.forEach((function(l){var u;if(\"h264\"===l.mimeType&&l.sdpFmtpLine){var p=null===(u=_.exec(l.sdpFmtpLine))||void 0===u?void 0:u[1];p&&d.push(p)}})),this.data.H264Profiles=g([],h(new Set(this.data.H264Profiles.concat(d))),!1)}},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"reportedSendBandwidth\",{set:function(l){this.data.reportedSendBandwidth=l,(!this.data.reportedSendBandwidthMin||this.data.reportedSendBandwidthMin>l)&&(this.data.reportedSendBandwidthMin=l),(!this.data.reportedSendBandwidthMax||this.data.reportedSendBandwidthMax<l)&&(this.data.reportedSendBandwidthMax=l)},enumerable:!1,configurable:!0}),Object.defineProperty(NativeSessionDiagnostics.prototype,\"maxSessionBandwidth\",{set:function(l){this.data.maxSessionBandwidth=l},enumerable:!1,configurable:!0}),NativeSessionDiagnostics.prototype.setCandidateDetails=function(l){\"host\"===l.type&&\"udp\"===l.protocol?(this.data.numInterfaces++,this.data.IPAddress||(this.data.IPAddress=l.ip)):\"srflx\"!==l.type||this.data.reflexiveLocalIP||(this.data.reflexiveLocalIP=l.ip)},NativeSessionDiagnostics.prototype.setAudioSendStream=function(l,d){var u,p,h=new S.AudioStreamAnalyzer(l.rawStream);\"ScreenShare\"===d&&l.hasAudio()?(null===(u=this.analyzerSharing)||void 0===u||u.dispose(),this.analyzerSharing=h):\"Audio\"===d&&(null===(p=this.analyzer)||void 0===p||p.dispose(),this.analyzer=h)},NativeSessionDiagnostics.prototype.addNetworkInfo=function(l){y.arrayPushFixedSize(this.data.networkInfo,l,this.configProvider.config.diagnostics.telemetryLimits.numAggregatedSamples)},NativeSessionDiagnostics.prototype.addIceCandidateError=function(l){this.data.iceCandidateErrors.push(l)},NativeSessionDiagnostics.prototype.clearIceCandidateErrors=function(){this.data.iceCandidateErrors=[]},NativeSessionDiagnostics.prototype.addStatsReport=function(l){y.arrayPushFixedSize(this.data.statsReports,l,this.configProvider.config.diagnostics.collectionLimits.numStatsReports)},NativeSessionDiagnostics.prototype.addStatsError=function(l,d){var u=this.data.statsErrors.find((function(u){return u.error===d&&u.origin===l}));u?u.count++:y.arrayPushFixedSize(this.data.statsErrors,{origin:l,error:d,count:1},this.configProvider.config.diagnostics.collectionLimits.numStatsErrors),this.addSessionStatsError(\"nativeSession:\".concat(l),d)},NativeSessionDiagnostics.prototype.terminate=function(){this.data.endTime=Date.now()},NativeSessionDiagnostics.prototype.newQualityManagerDiagnostics=function(){var l=this,d=new m.QualityManagerDiagnostics(this.configProvider,(function(d,u){return l.addStatsError(\"qualityManagerDiagnostics:\".concat(d),u)}));return this.data.qualityManager=d.getObjectRef(),d},NativeSessionDiagnostics.prototype.newRemoteVideoManagerDiagnostics=function(){var l=new v.RemoteVideoManagerDiagnostics;return this.data.remoteVideoManager=l.getObjectRef(),l},NativeSessionDiagnostics.prototype.newSubscriptionManagerDiagnostics=function(){var l=this,d=new f.SubscriptionManagerDiagnostics(this.configProvider,(function(d){return l.addStatsError(\"subscriptionManagerDiagnostics\",d)}));return this.data.subscriptionManager=d.getObjectRef(),d},NativeSessionDiagnostics.prototype.getObjectRef=function(){return this.data},NativeSessionDiagnostics}();function getSrtpReport(l){var d=\"\";return l.dtls&&(d+=\"dtls\"),l.sdes&&(d+=\"sdes\"),d}d.NativeSessionDiagnostics=C},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.QualityManagerDiagnostics=void 0;var h=u(3),g=u(1),f=function(){function QualityManagerDiagnostics(l,d){this.configProvider=l,this.addStatsError=d,this.data={videoMaxCapabilitiesEvents:[],sharingMaxCapabilitiesEvents:[],currentVideoSsrcRequestedCapabilities:{},currentVideoSsrcAppliedCapabilities:{},currentSharingSsrcRequestedCapabilities:{},currentSharingSsrcAppliedCapabilities:{},numVideoControlMessages:0,numOutOfOrderVideoControlMessages:0}}return QualityManagerDiagnostics.prototype.onMaxCapabilitiesRequested=function(l){var d,u,f,m,v,y,S,_={causeId:l.causeId,events:[{eventType:\"req\",timestamp:Date.now(),capabilities:l.capabilities,isSimulcast:l.isSimulcastEnabled}]};try{if(l.modality===h.default.MODALITY.video){g.arrayPushFixedSize(this.data.videoMaxCapabilitiesEvents,_,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesRequested);try{for(var C=p(l.capabilities),E=C.next();!E.done;E=C.next()){var T=E.value;this.data.currentVideoSsrcRequestedCapabilities[\"\".concat(null!==(v=T.ssrc)&&void 0!==v?v:0)]=T}}catch(l){d={error:l}}finally{try{E&&!E.done&&(u=C.return)&&u.call(C)}finally{if(d)throw d.error}}}else if(l.modality===h.default.MODALITY.sharing){g.arrayPushFixedSize(this.data.sharingMaxCapabilitiesEvents,_,this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesRequested);try{for(var b=p(l.capabilities),I=b.next();!I.done;I=b.next()){T=I.value;this.data.currentSharingSsrcRequestedCapabilities[\"\".concat(null!==(y=T.ssrc)&&void 0!==y?y:0)]=T}}catch(l){f={error:l}}finally{try{I&&!I.done&&(m=b.return)&&m.call(b)}finally{if(f)throw f.error}}}}catch(l){null===(S=this.addStatsError)||void 0===S||S.call(this,\"onMaxCapabilitiesRequested\",g.stringifyObject(l))}},QualityManagerDiagnostics.prototype.onMaxCapabilitiesApplied=function(l){var d,u,f,m,v,y,S;try{var _=this.getEventForCause(l.modality,l.causeId);if(_&&g.arrayPushFixedSize(_.events,{eventType:\"app\",timestamp:Date.now(),capabilities:l.capabilities,error:l.error||\"none\"},this.configProvider.config.diagnostics.collectionLimits.numCapabilitiesApplied,1),l.modality===h.default.MODALITY.video)try{for(var C=p(l.capabilities),E=C.next();!E.done;E=C.next()){var T=E.value;this.data.currentVideoSsrcAppliedCapabilities[\"\".concat(null!==(v=T.ssrc)&&void 0!==v?v:0)]=T}}catch(l){d={error:l}}finally{try{E&&!E.done&&(u=C.return)&&u.call(C)}finally{if(d)throw d.error}}else if(l.modality===h.default.MODALITY.sharing)try{for(var b=p(l.capabilities),I=b.next();!I.done;I=b.next()){T=I.value;this.data.currentSharingSsrcAppliedCapabilities[\"\".concat(null!==(y=T.ssrc)&&void 0!==y?y:0)]=T}}catch(l){f={error:l}}finally{try{I&&!I.done&&(m=b.return)&&m.call(b)}finally{if(f)throw f.error}}}catch(l){null===(S=this.addStatsError)||void 0===S||S.call(this,\"onMaxCapabilitiesApplied\",g.stringifyObject(l))}},QualityManagerDiagnostics.prototype.addVideoControlMessage=function(l){void 0===l&&(l=!1),this.data.numVideoControlMessages++,l&&this.data.numOutOfOrderVideoControlMessages++},QualityManagerDiagnostics.prototype.getObjectRef=function(){return this.data},QualityManagerDiagnostics.prototype.getEventForCause=function(l,d){return(l===h.default.MODALITY.video?this.data.videoMaxCapabilitiesEvents:this.data.sharingMaxCapabilitiesEvents).find((function(l){return l.causeId===d}))},QualityManagerDiagnostics}();d.QualityManagerDiagnostics=f},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.RemoteVideoRendererDiagnostics=d.RemoteVideoManagerDiagnostics=void 0;var h=u(7),g=u(28),f=function(){function RemoteVideoManagerDiagnostics(){this.data={renderers:[],firstTimeToFirstFrameVideo:-1,firstTimeToFirstFrameSharing:-1}}return RemoteVideoManagerDiagnostics.prototype.setTimeToFirstFrame=function(l,d){-1!==l&&(d===g.Constants.MODALITY.video&&-1===this.data.firstTimeToFirstFrameVideo?this.data.firstTimeToFirstFrameVideo=l:d===g.Constants.MODALITY.sharing&&-1===this.data.firstTimeToFirstFrameSharing&&(this.data.firstTimeToFirstFrameSharing=l))},RemoteVideoManagerDiagnostics.prototype.newRendererDiagnostics=function(){var l=this,d=new m(this),u=d.on(\"onDisposed\",(function(){l.removeDeadRenderers(),u.dispose()}));return this.data.renderers.push(d.getObjectRef()),d},RemoteVideoManagerDiagnostics.prototype.getObjectRef=function(){return this.data},RemoteVideoManagerDiagnostics.prototype.removeDeadRenderers=function(){this.data.renderers=this.data.renderers.filter((function(l){return l.alive}))},RemoteVideoManagerDiagnostics}();d.RemoteVideoManagerDiagnostics=f;var m=function(l){function RemoteVideoRendererDiagnostics(d){var u=l.call(this)||this;return u.managerDiagnostics=d,u.isAlive=!0,u.data={alive:!0,totalFreezeDuration:0,isRendering:!1,timeToFirstFrame:-1},delete u.data.alive,Object.defineProperty(u.data,\"alive\",{get:function(){return u.isAlive},enumerable:!1,configurable:!1}),u}return p(RemoteVideoRendererDiagnostics,l),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,\"trackId\",{set:function(l){this.data.trackId=l},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,\"rendererSize\",{set:function(l){this.data.rendererSize=l},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,\"msi\",{set:function(l){this.data.msi=l},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,\"modality\",{set:function(l){this.data.modality=l},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,\"isRendering\",{set:function(l){this.data.isRendering=l},enumerable:!1,configurable:!0}),Object.defineProperty(RemoteVideoRendererDiagnostics.prototype,\"timeToFirstFrame\",{set:function(l){this.data.timeToFirstFrame=l,this.managerDiagnostics.setTimeToFirstFrame(l,this.data.modality)},enumerable:!1,configurable:!0}),RemoteVideoRendererDiagnostics.prototype.addFreezeDuration=function(l){this.data.totalFreezeDuration+=l},RemoteVideoRendererDiagnostics.prototype.dispose=function(){this.isAlive=!1,this.event(\"onDisposed\").raise()},RemoteVideoRendererDiagnostics.prototype.getObjectRef=function(){return this.data},RemoteVideoRendererDiagnostics}(h.default);d.RemoteVideoRendererDiagnostics=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.DiagnosticsReport=void 0;var p=u(1),h=u(458),g=u(459),f=function(){function DiagnosticsReport(l,d){this.rootRef=l,this.configProvider=d}return Object.defineProperty(DiagnosticsReport.prototype,\"rootCopy\",{get:function(){return p.deepClone(this.rootRef)},enumerable:!1,configurable:!0}),Object.defineProperty(DiagnosticsReport.prototype,\"rawRootRef\",{get:function(){return this.rootRef},enumerable:!1,configurable:!0}),DiagnosticsReport.prototype.getSessionTelemetry=function(l){var d,u=this.rootRef.sessions.find((function(d){return d.sessionId===l}));if(u){var f=p.hptime(),m=u.callNumber>1?this.rootRef.sessions.find((function(l){return u.callNumber-1===l.callNumber})):void 0,v=null!==(d=null==m?void 0:m.terminationTime)&&void 0!==d?d:0,y=u.nativeSessions[u.nativeSessions.length-1],S={metrics:(0,h.compileMetricsTelemetryReport)(u,v,this.rootRef,this.configProvider),Extensions:(0,g.compileExtensionsTelemetryReport)(y,this.configProvider,u.statsErrors)};return S.metrics.ReportGenerationTimeMs=p.round(p.hptime()-f),S}},DiagnosticsReport}();d.DiagnosticsReport=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.compileMetricsTelemetryReport=void 0;var p=u(1),h=u(28);function compileMetricsTelemetryReport(l,d,u,g){var f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k,x,F,U;return p.removeUndefinedFields({MediaLegId:l.mediaLegId,CreationTime:getHpTimeFromMillis(l.creationTime),CallNumber:l.callNumber,SessionId:l.sessionId,MultiParty:l.isMultiParty,ErrorType:null!==(m=null===(f=l.error)||void 0===f?void 0:f.type)&&void 0!==m?m:\"none\",ErrorDetail:null!==(y=null===(v=l.error)||void 0===v?void 0:v.detail)&&void 0!==y?y:\"none\",IncompatibleOffer:(null===(S=l.error)||void 0===S?void 0:S.type)===h.Constants.MEDIA_ERROR.incompatibleOffer,TerminationTime:getHpTimeFromMillis(l.terminationTime),TerminationReason_code:null===(_=l.terminationReason)||void 0===_?void 0:_.code,TerminationReason_subCode:null===(C=l.terminationReason)||void 0===C?void 0:C.subCode,TerminationReason_phrase:null===(E=l.terminationReason)||void 0===E?void 0:E.phrase,TerminationReason_remoteTerminated:null===(T=l.terminationReason)||void 0===T?void 0:T.remoteTerminated,TerminationReason_clientReasonPhrase:null===(b=l.terminationReason)||void 0===b?void 0:b.clientReasonPhrase,TerminationReason_clientReasonSubCode:null===(I=l.terminationReason)||void 0===I?void 0:I.clientReasonSubCode,CallDuration:getHpTimeFromMillis(l.duration),IceInitTime:getHpTimeFromMillis(l.iceInitTime),IceConnectedStateTime:getHpTimeFromMillis(l.iceConnectedStateTime),NegotiationCount:l.negotiationCount,RejectedNegotiationCount:l.rejectedNegotiationCount,InitialNegotiationCompleted:l.initialNegotiationCompleted,InitialNegotiationType:l.initialNegotiationType,FinalAnswerTime:getHpTimeFromMillis(l.finalAnswerTime),TransportReconnectedCount:l.transportReconnectedCount,RollbackNegotiation:JSON.stringify(l.rollbackNegotiation),Relay:l.relay?JSON.stringify(l.relay):void 0,AllowedAudioSend:l.allowedAudioSend,AllowedVideoSend:l.allowedVideoSend,AllowedScreensharingSend:l.allowedScreensharingSend,RelayManager:JSON.stringify(l.relayTimers),CallMutedRatio:getHpTimeFromMillis(l.callMutedRatio),CallOsMuted:getHpTimeFromMillis(l.callOsMuted),CallHwSilent:getHpTimeFromMillis(l.callHwSilent),CallSwMuted:getHpTimeFromMillis(l.callSwMuted),CallSpeakerMuted:getHpTimeFromMillis(l.callSpeakerMuted),CallIsSpeaking:getHpTimeFromMillis(l.callIsSpeaking),DtmfSuccess:l.dtmfSuccessCount,DtmfFailure:l.dtmfFailureCount,ReconnectInProgress:null===(A=l.reconnect)||void 0===A?void 0:A.isReconnecting,RetargetIncomingCount:null===(R=l.reconnect)||void 0===R?void 0:R.retargetCount.incoming,RetargetOutgoingCount:null===(P=l.reconnect)||void 0===P?void 0:P.retargetCount.outgoing,RetargetCompletedCount:null===(O=l.reconnect)||void 0===O?void 0:O.retargetCount.completed,RetargetRejectedCount:null===(M=l.reconnect)||void 0===M?void 0:M.retargetCount.rejected,EscalationAttemptedCount:null===(w=l.reconnect)||void 0===w?void 0:w.escalationCount.attempted,EscalationCompletedCount:null===(N=l.reconnect)||void 0===N?void 0:N.escalationCount.completed,EscalationRejectedCount:null===(D=l.reconnect)||void 0===D?void 0:D.escalationCount.rejected,ReconnectAttemptedCount:null===(L=l.reconnect)||void 0===L?void 0:L.reconnectCount.attempted,ReconnectConnectedCount:null===(k=l.reconnect)||void 0===k?void 0:k.reconnectCount.connected,NoIceCandidatesGoodEventCount:l.noIceCandidatesEventCount.good,NoIceCandidatesBadEventCount:l.noIceCandidatesEventCount.bad,NoRelayIceCandidatesGoodEventCount:l.noRelayIceCandidatesEventCount.good,NoRelayIceCandidatesBadEventCount:l.noRelayIceCandidatesEventCount.bad,MicrophoneInUseGoodEventCount:l.microphoneInUseEventCount.good,MicrophoneInUseBadEventCount:l.microphoneInUseEventCount.bad,CameraInUseGoodEventCount:l.cameraInUseEventCount.good,CameraInUseBadEventCount:l.cameraInUseEventCount.bad,CameraFreezeStartEventCount:l.cameraFreezeEventCount.start,CameraFreezeEndEventCount:l.cameraFreezeEventCount.end,NetworkRecvGood:l.networkRecvUFD.good,NetworkRecvGoodRatio:l.networkRecvUFD.goodRatio,NetworkRecvPoor:l.networkRecvUFD.poor,NetworkRecvPoorRatio:l.networkRecvUFD.poorRatio,NetworkRecvBad:l.networkRecvUFD.bad,NetworkRecvBadRatio:l.networkRecvUFD.badRatio,NetworkSendGood:l.networkSendUFD.good,NetworkSendGoodRatio:l.networkSendUFD.goodRatio,NetworkSendPoor:l.networkSendUFD.poor,NetworkSendPoorRatio:l.networkSendUFD.poorRatio,NetworkSendBad:l.networkSendUFD.bad,NetworkSendBadRatio:l.networkSendUFD.badRatio,RawOutputAudioAccessAttempted:l.rawMedia.audio.recv.numAttempts,RawOutputAudioAccessDurationRatio:l.rawMedia.audio.recv.durationRatio,RawInputAudioOverrideAttempted:l.rawMedia.audio.send.numAttempts,RawInputAudioOverrideDurationRatio:l.rawMedia.audio.send.durationRatio,UFDs:JSON.stringify(p.rebaseTime(p.limitArraySize(l.ufds,g.config.diagnostics.telemetryLimits.numUFDs),\"timestamp\",l.creationTime)),MediaQosEnabled:null!==(F=null===(x=u.configuration.mediaConfig)||void 0===x?void 0:x.enableMediaQoS)&&void 0!==F&&F,PortRangeConfigured:!!(null===(U=u.configuration.mediaConfig)||void 0===U?void 0:U.mediaPortRanges),hardwareConcurrency:navigator.hardwareConcurrency,ETag:l.ETag,ConfigIds:l.configIds,PermissionStates:JSON.stringify(u.deviceManager.permissionStates),DeviceList:JSON.stringify(u.deviceManager.deviceList),DeviceListDebug:JSON.stringify(u.deviceManager.deviceDebugStrings),DevicesChangeCount:l.deviceManager.devicesChangeCount,DevicesPollChangeCount:l.deviceManager.devicesPollChangeCount,DeviceSelectionChangeCount:l.deviceManager.deviceSelectionChangeCount,DeviceSelectionChangeFromInterfaceCount:l.deviceManager.deviceSelectionChangeCountFromInterface,DevicesCount:JSON.stringify(u.deviceManager.devicesCount),UsedMicrophone:u.deviceManager.usedDevices.microphone,UsedSpeaker:u.deviceManager.usedDevices.speaker,UsedCamera:u.deviceManager.usedDevices.camera,DeviceEvents:JSON.stringify(p.rebaseTime(u.deviceManager.deviceTelemetryEvents.filter((function(l){return l.timestamp>d})),\"timestamp\",l.creationTime)),VideoEffects:JSON.stringify(p.rebaseTime(u.deviceManager.videoEffectsEvents.filter((function(l){return l.timestamp>d})),\"timestamp\",l.creationTime)),AudioEffects:JSON.stringify(p.rebaseTime(u.deviceManager.audioEffectsEvents.filter((function(l){return l.timestamp>d})),\"timestamp\",l.creationTime))})}function getHpTimeFromMillis(l){return 1e4*l}d.compileMetricsTelemetryReport=compileMetricsTelemetryReport},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.compileExtensionsTelemetryReport=void 0;var p=u(1),h=u(460),g=u(461);function compileExtensionsTelemetryReport(l,d,u){var f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k,x,F,U,j,B,V,H,G,W,q,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Ee,Te,be,Ie,Ae,Re,Pe,Oe,Me,we,Ne,De,Le,ke,xe,Fe,Ue,je,Be,Ve,He,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e,Xe=l.aggregatedModalityStats,Ze=p.getLast(null===(f=Xe.audio)||void 0===f?void 0:f.recv),et=p.getLast(null===(m=Xe.audio)||void 0===m?void 0:m.send),tt=p.getLast(null===(v=Xe.video)||void 0===v?void 0:v.recv),nt=p.getLast(null===(y=Xe.video)||void 0===y?void 0:y.send),it=p.getLast(null===(S=Xe.sharing)||void 0===S?void 0:S.recv),rt=p.getLast(null===(_=Xe.sharing)||void 0===_?void 0:_.send),ot=l.qualityManager&&p.limitArraySize(p.deepClone(l.qualityManager.videoMaxCapabilitiesEvents).map((function(u){return p.rebaseTime(p.limitArraySize(u.events,d.config.diagnostics.telemetryLimits.numCapabilitiesApplied,1),\"timestamp\",l.startTime)})),d.config.diagnostics.telemetryLimits.numCapabilitiesRequested),at=l.qualityManager&&p.limitArraySize(p.deepClone(l.qualityManager.sharingMaxCapabilitiesEvents).map((function(u){return p.rebaseTime(p.limitArraySize(u.events,d.config.diagnostics.telemetryLimits.numCapabilitiesApplied,1),\"timestamp\",l.startTime)})),d.config.diagnostics.telemetryLimits.numCapabilitiesRequested);return p.removeUndefinedFields({BundlePolicy:l.bundlePolicy,FakeIceCandidate:l.fakeIceCandidate,H264_available_profiles:JSON.stringify(l.H264Profiles),IceConnectionState:l.iceConnectionState,IceConnectionStatePrevious:l.iceConnectionStatePrevious,IceServers:l.iceServers,IceTransportPolicy:l.iceTransportPolicy,NegotiatedSrtp:JSON.stringify(l.negotiatedSrtp),OfferedSrtp:JSON.stringify(l.offeredSrtp),RelayCandidate:l.relayCandidate,SdpSemantics:l.sdpSemantics,iceCandidateErrors:JSON.stringify(l.iceCandidateErrors),SignalingState:l.signalingState,SignalingStatePrevious:l.signalingStatePrevious,WebRTCStats_statsErrors:JSON.stringify(u),MaxSessionBandwidth:l.maxSessionBandwidth,totalVideoControlMessages:null===(C=l.qualityManager)||void 0===C?void 0:C.numVideoControlMessages,outOfOrderVideoControlMessages:null===(E=l.qualityManager)||void 0===E?void 0:E.numOutOfOrderVideoControlMessages,Connection:p.removeUndefinedFields({DownLink:p.sampleseries(l.networkInfo,(function(l){return l.downlink})),EffectiveType:p.sampleseries(l.networkInfo,(function(l){return l.effectiveType})),Rtt:p.sampleseries(l.networkInfo,(function(l){return l.rtt})),SaveData:null===(T=p.getLast(l.networkInfo))||void 0===T?void 0:T.saveData}),IPAddress:null!==(b=l.IPAddress)&&void 0!==b?b:\"none\",ReflexiveLocalIP:null!==(I=l.reflexiveLocalIP)&&void 0!==I?I:\"none\",NumberOfInterfaces:l.numInterfaces,StartTime:l.startTime,EndTime:l.endTime,AudioTransportRecvBitrate:null===(R=null===(A=null==Ze?void 0:Ze.transport)||void 0===A?void 0:A.extensions)||void 0===R?void 0:R.recvBWAvg,AudioTransportSendBitrate:null===(O=null===(P=null==Ze?void 0:Ze.transport)||void 0===P?void 0:P.extensions)||void 0===O?void 0:O.sendBWAvg,AudioPayloadRecvBitrate:null===(M=null==Ze?void 0:Ze.extensions)||void 0===M?void 0:M.bitrateAvg,AudioPayloadSendBitrate:null===(w=null==et?void 0:et.extensions)||void 0===w?void 0:w.bitrateAvg,VideoPayloadRecvBitrate:null===(N=null==tt?void 0:tt.extensions)||void 0===N?void 0:N.bitrateAvg,VideoPayloadSendBitrate:null===(D=null==nt?void 0:nt.extensions)||void 0===D?void 0:D.bitrateAvg,WebRTCStats_bweStat_googAvailableReceiveBandwidth:null!==(k=p.sampleseries(null===(L=Xe.video)||void 0===L?void 0:L.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.availableIncomingBitrate})))&&void 0!==k?k:p.sampleseries(null===(x=Xe.video)||void 0===x?void 0:x.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.availableIncomingBitrate})),WebRTCStats_bweStat_googAvailableSendBandwidth:null!==(U=p.sampleseries(null===(F=Xe.video)||void 0===F?void 0:F.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.availableOutgoingBitrate})))&&void 0!==U?U:p.sampleseries(null===(j=Xe.video)||void 0===j?void 0:j.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.availableOutgoingBitrate})),ReportedSendBWMax:l.reportedSendBandwidthMax,ReportedSendBWMin:l.reportedSendBandwidthMin,Bandwidth_jumpsHistogram:(null===(B=null==nt?void 0:nt.transport)||void 0===B?void 0:B.extensions)&&JSON.stringify(null===(V=nt.transport)||void 0===V?void 0:V.extensions.bwJumpsHistogram),WebRTCStats_ssrc:p.removeUndefinedFields({audio:(0,h.compileAudioReport)(Xe,Ze,et),video:(0,g.compileVideoTelemetryReport)(\"video\",Xe,tt,nt),sharing:(0,g.compileVideoTelemetryReport)(\"sharing\",Xe,it,rt)}),Audio_recv_jitterBufferAvgSize:null===(H=null==Ze?void 0:Ze.extensions)||void 0===H?void 0:H.avgJitterBufferSize,Audio_recv_packetsLostRateMax:null===(G=null==Ze?void 0:Ze.extensions)||void 0===G?void 0:G.lossRateMax,Audio_recv_googRttAvgSize:(null===(W=null==et?void 0:et.extensions)||void 0===W?void 0:W.rttAvg)?p.round(1e3*(null===(q=null==et?void 0:et.extensions)||void 0===q?void 0:q.rttAvg)):void 0,Audio_send_RawInputVolume:p.sampleseries(null===(z=Xe.audio)||void 0===z?void 0:z.send,(function(l){var d;return null===(d=l.extensions)||void 0===d?void 0:d.rawInputVolume})),Audio_send_packetsLostRateMax:null===(K=null==et?void 0:et.extensions)||void 0===K?void 0:K.lossRateMax,Video_recv_DurationSeconds:null===(J=null==tt?void 0:tt.extensions)||void 0===J?void 0:J.duration,Video_recv_FreezeHistogram:JSON.stringify(null===(Q=null==tt?void 0:tt.extensions)||void 0===Q?void 0:Q.freezeCountHistogram),Video_recv_FreezeTimestamps:JSON.stringify(p.rebaseHistogramTimestamps(null===(Y=null==tt?void 0:tt.extensions)||void 0===Y?void 0:Y.freezeTimestampsHistogram,l.startTime)),Video_recv_LongestFreezeDuration:null===($=null==tt?void 0:tt.extensions)||void 0===$?void 0:$.longestFreeze,Video_recv_OngoingFreeze:null===(X=null==tt?void 0:tt.extensions)||void 0===X?void 0:X.isFrozen,Video_recv_TotalFreezeDuration:null===(Z=null==tt?void 0:tt.extensions)||void 0===Z?void 0:Z.totalFreezeDuration,Video_recv_RecvAvgFreezeDuration:null===(ee=null==tt?void 0:tt.extensions)||void 0===ee?void 0:ee.avgFreezeDuration,Video_recv_NumResolutionSwitches:null===(te=null==tt?void 0:tt.extensions)||void 0===te?void 0:te.numResolutionSwitches,Video_recv_ResolutionDurations:JSON.stringify(null===(ne=null==tt?void 0:tt.extensions)||void 0===ne?void 0:ne.resolutionDurations),Video_recv_StreamsMax:l.recvVideoStreamCount.max,Video_recv_StreamsMin:l.recvVideoStreamCount.min,Video_recv_StreamsMode:l.recvVideoStreamCount.mode,Video_recv_TimeToFirstFrame:l.remoteVideoManager.firstTimeToFirstFrameVideo,Video_recv_bitrateAvg:null===(ie=null==tt?void 0:tt.extensions)||void 0===ie?void 0:ie.bitrateAvg,Video_recv_bitrateMax:null===(re=null==tt?void 0:tt.extensions)||void 0===re?void 0:re.bitrateMax,Video_recv_frameRateAvg:null===(oe=null==tt?void 0:tt.extensions)||void 0===oe?void 0:oe.avgFrameRate,Video_recv_jitterBufferAvgSize:null===(ae=null==tt?void 0:tt.extensions)||void 0===ae?void 0:ae.avgJitterBufferSize,Video_recv_packetsLostRateMax:null===(se=null==tt?void 0:tt.extensions)||void 0===se?void 0:se.lossRateMax,Video_recv_FpsHarmonicAverage:null===(ce=null==tt?void 0:tt.extensions)||void 0===ce?void 0:ce.fpsHarmonicAverage,Video_SubscriptionEvents:JSON.stringify(p.rebaseTime(null===(le=l.subscriptionManager)||void 0===le?void 0:le.events.video,\"ts\",l.startTime)),Video_send_CaptureFramerateAvg:null===(de=null==nt?void 0:nt.extensions)||void 0===de?void 0:de.captureFramerateAvg,Video_send_DurationSeconds:null===(ue=null==nt?void 0:nt.extensions)||void 0===ue?void 0:ue.duration,Video_send_FreezeIntervals:null===(pe=null==nt?void 0:nt.extensions)||void 0===pe?void 0:pe.captureFreezeIntervalsCount,Video_send_MaxCapabilities:JSON.stringify(ot),Video_send_OvershootDurations:JSON.stringify({fs:null===(he=null==nt?void 0:nt.extensions)||void 0===he?void 0:he.totalFsOvershootDuration,fps:null===(ge=null==nt?void 0:nt.extensions)||void 0===ge?void 0:ge.totalFpsOvershootDuration,br:null===(fe=null==nt?void 0:nt.extensions)||void 0===fe?void 0:fe.totalBrOvershootDuration}),Video_send_OvershootEvents:JSON.stringify(p.rebaseTime(null==nt?void 0:nt.extensions.overshootEvents,\"timestamp\",l.startTime)),Video_send_QpAvg:null===(me=null==nt?void 0:nt.extensions)||void 0===me?void 0:me.qpAvg,Video_send_bitrateAvg:null===(ve=null==nt?void 0:nt.extensions)||void 0===ve?void 0:ve.bitrateAvg,Video_send_bitrateMax:null===(ye=null==nt?void 0:nt.extensions)||void 0===ye?void 0:ye.bitrateMax,Video_send_frameRateAvg:null===(Se=null==nt?void 0:nt.extensions)||void 0===Se?void 0:Se.frameRateAvg,Video_send_AllocateBWAvg:null===(_e=null==nt?void 0:nt.extensions)||void 0===_e?void 0:_e.bweAvg,Video_send_CameraOpenWidth:null===(Ee=null===(Ce=null==nt?void 0:nt.extensions)||void 0===Ce?void 0:Ce.cameraOpenResolution)||void 0===Ee?void 0:Ee.width,Video_send_CameraOpenHeight:null===(be=null===(Te=null==nt?void 0:nt.extensions)||void 0===Te?void 0:Te.cameraOpenResolution)||void 0===be?void 0:be.height,Video_send_packetsLostRateMax:null===(Ie=null==nt?void 0:nt.extensions)||void 0===Ie?void 0:Ie.lossRateMax,Sharing_recv_DurationSeconds:null===(Ae=null==it?void 0:it.extensions)||void 0===Ae?void 0:Ae.duration,Sharing_recv_FreezeHistogram:JSON.stringify(null===(Re=null==it?void 0:it.extensions)||void 0===Re?void 0:Re.freezeCountHistogram),Sharing_recv_FreezeTimestamps:JSON.stringify(p.rebaseHistogramTimestamps(null===(Pe=null==it?void 0:it.extensions)||void 0===Pe?void 0:Pe.freezeTimestampsHistogram,l.startTime)),Sharing_recv_LongestFreezeDuration:null===(Oe=null==it?void 0:it.extensions)||void 0===Oe?void 0:Oe.longestFreeze,Sharing_recv_OngoingFreeze:null===(Me=null==it?void 0:it.extensions)||void 0===Me?void 0:Me.isFrozen,Sharing_recv_TotalFreezeDuration:null===(we=null==it?void 0:it.extensions)||void 0===we?void 0:we.totalFreezeDuration,Sharing_recv_RecvAvgFreezeDuration:null===(Ne=null==it?void 0:it.extensions)||void 0===Ne?void 0:Ne.avgFreezeDuration,Sharing_recv_NumResolutionSwitches:null===(De=null==it?void 0:it.extensions)||void 0===De?void 0:De.numResolutionSwitches,Sharing_recv_ResolutionDurations:JSON.stringify(null===(Le=null==it?void 0:it.extensions)||void 0===Le?void 0:Le.resolutionDurations),Sharing_recv_StreamsMax:l.recvVideoStreamCount.max,Sharing_recv_StreamsMin:l.recvVideoStreamCount.min,Sharing_recv_StreamsMode:l.recvVideoStreamCount.mode,Sharing_recv_TimeToFirstFrame:l.remoteVideoManager.firstTimeToFirstFrameSharing,Sharing_recv_bitrateAvg:null===(ke=null==it?void 0:it.extensions)||void 0===ke?void 0:ke.bitrateAvg,Sharing_recv_bitrateMax:null===(xe=null==it?void 0:it.extensions)||void 0===xe?void 0:xe.bitrateMax,Sharing_recv_frameRateAvg:null===(Fe=null==it?void 0:it.extensions)||void 0===Fe?void 0:Fe.avgFrameRate,Sharing_recv_jitterBufferAvgSize:null===(Ue=null==it?void 0:it.extensions)||void 0===Ue?void 0:Ue.avgJitterBufferSize,Sharing_recv_packetsLostRateMax:null===(je=null==it?void 0:it.extensions)||void 0===je?void 0:je.lossRateMax,Sharing_SubscriptionEvents:JSON.stringify(p.rebaseTime(null===(Be=l.subscriptionManager)||void 0===Be?void 0:Be.events.sharing,\"ts\",l.startTime)),Sharing_send_CaptureFramerateAvg:null===(Ve=null==rt?void 0:rt.extensions)||void 0===Ve?void 0:Ve.captureFramerateAvg,Sharing_send_DurationSeconds:null===(He=null==rt?void 0:rt.extensions)||void 0===He?void 0:He.duration,Sharing_send_MaxCapabilities:JSON.stringify(at),Sharing_send_OvershootDurations:JSON.stringify({fs:null===(Ge=null==rt?void 0:rt.extensions)||void 0===Ge?void 0:Ge.totalFsOvershootDuration,fps:null===(We=null==rt?void 0:rt.extensions)||void 0===We?void 0:We.totalFpsOvershootDuration,br:null===(qe=null==rt?void 0:rt.extensions)||void 0===qe?void 0:qe.totalBrOvershootDuration}),Sharing_send_OvershootEvents:JSON.stringify(p.rebaseTime(null==rt?void 0:rt.extensions.overshootEvents,\"timestamp\",l.startTime)),Sharing_send_QpAvg:null===(ze=null==rt?void 0:rt.extensions)||void 0===ze?void 0:ze.qpAvg,Sharing_send_bitrateAvg:null===(Ke=null==rt?void 0:rt.extensions)||void 0===Ke?void 0:Ke.bitrateAvg,Sharing_send_bitrateMax:null===(Je=null==rt?void 0:rt.extensions)||void 0===Je?void 0:Je.bitrateMax,Sharing_send_frameRateAvg:null===(Qe=null==rt?void 0:rt.extensions)||void 0===Qe?void 0:Qe.frameRateAvg,Sharing_send_AllocateBWAvg:null===(Ye=null==rt?void 0:rt.extensions)||void 0===Ye?void 0:Ye.bweAvg,Sharing_send_packetsLostRateMax:null===($e=null==rt?void 0:rt.extensions)||void 0===$e?void 0:$e.lossRateMax,multipleVideoStreams:JSON.stringify(p.rebaseTime(l.multiViewStats,\"startTime\",l.startTime))})}d.compileExtensionsTelemetryReport=compileExtensionsTelemetryReport},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.compileAudioReport=void 0;var p=u(1);function compileAudioReport(l,d,u){var h,g,f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k,x,F,U,j,B,V,H,G,W,q,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Ee,Te,be,Ie,Ae,Re,Pe,Oe,Me,we,Ne,De,Le,ke,xe,Fe,Ue,je,Be,Ve,He,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e,Xe,Ze,et,tt,nt,it,rt,ot,at,st,ct,lt,dt,ut,pt,ht,gt,ft,mt,vt,yt,St,_t,Ct,Et,Tt,bt;return p.removeUndefinedFields({recv:p.removeUndefinedFields({id:null==d?void 0:d.inboundRTP.id,ssrc:null==d?void 0:d.inboundRTP.ssrc,mediaType:null!==(h=null==d?void 0:d.inboundRTP.mediaType)&&void 0!==h?h:null==d?void 0:d.inboundRTP.kind,bytesReceived:p.sampleseries(null===(g=l.audio)||void 0===g?void 0:g.recv,(function(l){return l.inboundRTP.bytesReceived})),packetsReceived:p.sampleseries(null===(f=l.audio)||void 0===f?void 0:f.recv,(function(l){return l.inboundRTP.packetsReceived})),packetsLost:p.sampleseries(null===(m=l.audio)||void 0===m?void 0:m.recv,(function(l){return l.inboundRTP.packetsLost})),googCodecName:null===(v=null==d?void 0:d.codec)||void 0===v?void 0:v.mimeType.split(\"/\")[1],googTrackId:null===(y=null==d?void 0:d.track)||void 0===y?void 0:y.trackIdentifier,transport_id:null===(S=null==d?void 0:d.transport)||void 0===S?void 0:S.id,transportId:null==d?void 0:d.inboundRTP.transportId,transport_selectedCandidatePairId:null===(_=null==d?void 0:d.transport)||void 0===_?void 0:_.selectedCandidatePairId,transport_localCertificateId:null===(C=null==d?void 0:d.transport)||void 0===C?void 0:C.localCertificateId,transport_remoteCertificateId:null===(E=null==d?void 0:d.transport)||void 0===E?void 0:E.remoteCertificateId,transport_dtlsCipher:null===(T=null==d?void 0:d.transport)||void 0===T?void 0:T.dtlsCipher,transport_srtpCipher:null===(b=null==d?void 0:d.transport)||void 0===b?void 0:b.srtpCipher,pair_id:null===(A=null===(I=null==d?void 0:d.transport)||void 0===I?void 0:I.selectedCandidatePair)||void 0===A?void 0:A.id,pair_responsesSent:p.sampleseries(null===(R=l.audio)||void 0===R?void 0:R.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesSent})),pair_requestsReceived:p.sampleseries(null===(P=l.audio)||void 0===P?void 0:P.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsReceived})),pair_googRemoteCandidateType:null===(w=null===(M=null===(O=null==d?void 0:d.transport)||void 0===O?void 0:O.selectedCandidatePair)||void 0===M?void 0:M.remoteCandidate)||void 0===w?void 0:w.candidateType,pair_consentRequestsSent:p.sampleseries(null===(N=l.audio)||void 0===N?void 0:N.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.consentRequestsSent})),pair_googTransportType:null===(k=null===(L=null===(D=null==d?void 0:d.transport)||void 0===D?void 0:D.selectedCandidatePair)||void 0===L?void 0:L.localCandidate)||void 0===k?void 0:k.protocol,pair_googLocalCandidateType:null===(U=null===(F=null===(x=null==d?void 0:d.transport)||void 0===x?void 0:x.selectedCandidatePair)||void 0===F?void 0:F.localCandidate)||void 0===U?void 0:U.candidateType,pair_googWritable:null===(B=null===(j=null==d?void 0:d.transport)||void 0===j?void 0:j.selectedCandidatePair)||void 0===B?void 0:B.writable,pair_requestsSent:p.sampleseries(null===(V=l.audio)||void 0===V?void 0:V.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsSent})),pair_googRtt:p.sampleseries(null===(H=l.audio)||void 0===H?void 0:H.recv,(function(l){var d,u;return 1e3*(null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(W=null===(G=null==d?void 0:d.transport)||void 0===G?void 0:G.selectedCandidatePair)||void 0===W?void 0:W.nominated,pair_packetsDiscardedOnSend:null===(z=null===(q=null==d?void 0:d.transport)||void 0===q?void 0:q.selectedCandidatePair)||void 0===z?void 0:z.packetsDiscardedOnSend,pair_bytesReceived:p.sampleseries(null===(K=l.audio)||void 0===K?void 0:K.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesReceived})),pair_responsesReceived:p.sampleseries(null===(J=l.audio)||void 0===J?void 0:J.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesReceived})),pair_remoteCandidateId:null===($=null===(Y=null===(Q=null==d?void 0:d.transport)||void 0===Q?void 0:Q.selectedCandidatePair)||void 0===Y?void 0:Y.remoteCandidate)||void 0===$?void 0:$.id,pair_localCandidateId:null===(ee=null===(Z=null===(X=null==d?void 0:d.transport)||void 0===X?void 0:X.selectedCandidatePair)||void 0===Z?void 0:Z.localCandidate)||void 0===ee?void 0:ee.id,pair_packetsSent:p.sampleseries(null===(te=l.audio)||void 0===te?void 0:te.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.packetsSent})),pair_googLocalAddress:null!==(oe=null===(re=null===(ie=null===(ne=null==d?void 0:d.transport)||void 0===ne?void 0:ne.selectedCandidatePair)||void 0===ie?void 0:ie.localCandidate)||void 0===re?void 0:re.ip)&&void 0!==oe?oe:null===(ce=null===(se=null===(ae=null==d?void 0:d.transport)||void 0===ae?void 0:ae.selectedCandidatePair)||void 0===se?void 0:se.localCandidate)||void 0===ce?void 0:ce.address,pair_googRemoteAddress:null!==(pe=null===(ue=null===(de=null===(le=null==d?void 0:d.transport)||void 0===le?void 0:le.selectedCandidatePair)||void 0===de?void 0:de.remoteCandidate)||void 0===ue?void 0:ue.ip)&&void 0!==pe?pe:null===(fe=null===(ge=null===(he=null==d?void 0:d.transport)||void 0===he?void 0:he.selectedCandidatePair)||void 0===ge?void 0:ge.remoteCandidate)||void 0===fe?void 0:fe.address,pair_bytesSent:p.sampleseries(null===(me=l.audio)||void 0===me?void 0:me.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesSent})),pair_googReadable:null===(ye=null===(ve=null==d?void 0:d.transport)||void 0===ve?void 0:ve.selectedCandidatePair)||void 0===ye?void 0:ye.nominated}),send:p.removeUndefinedFields({id:null==u?void 0:u.outboundRTP.id,ssrc:null==u?void 0:u.outboundRTP.ssrc,mediaType:null!==(Se=null==u?void 0:u.outboundRTP.mediaType)&&void 0!==Se?Se:null==u?void 0:u.outboundRTP.kind,bytesSent:p.sampleseries(null===(_e=l.audio)||void 0===_e?void 0:_e.send,(function(l){return l.outboundRTP.bytesSent})),packetsSent:p.sampleseries(null===(Ce=l.audio)||void 0===Ce?void 0:Ce.send,(function(l){return l.outboundRTP.packetsSent})),packetsLost:p.sampleseries(null===(Ee=l.audio)||void 0===Ee?void 0:Ee.send,(function(l){var d;return null===(d=l.remoteInboundRTP)||void 0===d?void 0:d.packetsLost})),googCodecName:null===(Te=null==u?void 0:u.codec)||void 0===Te?void 0:Te.mimeType.split(\"/\")[1],googTrackId:null===(be=null==u?void 0:u.track)||void 0===be?void 0:be.trackIdentifier,transport_id:null===(Ie=null==u?void 0:u.transport)||void 0===Ie?void 0:Ie.id,transportId:null==u?void 0:u.outboundRTP.transportId,transport_selectedCandidatePairId:null===(Ae=null==u?void 0:u.transport)||void 0===Ae?void 0:Ae.selectedCandidatePairId,transport_localCertificateId:null===(Re=null==u?void 0:u.transport)||void 0===Re?void 0:Re.localCertificateId,transport_remoteCertificateId:null===(Pe=null==u?void 0:u.transport)||void 0===Pe?void 0:Pe.remoteCertificateId,transport_dtlsCipher:null===(Oe=null==u?void 0:u.transport)||void 0===Oe?void 0:Oe.dtlsCipher,transport_srtpCipher:null===(Me=null==u?void 0:u.transport)||void 0===Me?void 0:Me.srtpCipher,pair_id:null===(Ne=null===(we=null==u?void 0:u.transport)||void 0===we?void 0:we.selectedCandidatePair)||void 0===Ne?void 0:Ne.id,pair_responsesSent:p.sampleseries(null===(De=l.audio)||void 0===De?void 0:De.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesSent})),pair_requestsReceived:p.sampleseries(null===(Le=l.audio)||void 0===Le?void 0:Le.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsReceived})),pair_googRemoteCandidateType:null===(Fe=null===(xe=null===(ke=null==u?void 0:u.transport)||void 0===ke?void 0:ke.selectedCandidatePair)||void 0===xe?void 0:xe.remoteCandidate)||void 0===Fe?void 0:Fe.candidateType,pair_consentRequestsSent:p.sampleseries(null===(Ue=l.audio)||void 0===Ue?void 0:Ue.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.consentRequestsSent})),pair_googTransportType:null===(Ve=null===(Be=null===(je=null==u?void 0:u.transport)||void 0===je?void 0:je.selectedCandidatePair)||void 0===Be?void 0:Be.localCandidate)||void 0===Ve?void 0:Ve.protocol,pair_googLocalCandidateType:null===(We=null===(Ge=null===(He=null==u?void 0:u.transport)||void 0===He?void 0:He.selectedCandidatePair)||void 0===Ge?void 0:Ge.localCandidate)||void 0===We?void 0:We.candidateType,pair_googWritable:null===(ze=null===(qe=null==u?void 0:u.transport)||void 0===qe?void 0:qe.selectedCandidatePair)||void 0===ze?void 0:ze.writable,pair_requestsSent:p.sampleseries(null===(Ke=l.audio)||void 0===Ke?void 0:Ke.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsSent})),pair_googRtt:p.sampleseries(null===(Je=l.audio)||void 0===Je?void 0:Je.send,(function(l){var d,u;return 1e3*(null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(Ye=null===(Qe=null==u?void 0:u.transport)||void 0===Qe?void 0:Qe.selectedCandidatePair)||void 0===Ye?void 0:Ye.nominated,pair_packetsDiscardedOnSend:null===(Xe=null===($e=null==u?void 0:u.transport)||void 0===$e?void 0:$e.selectedCandidatePair)||void 0===Xe?void 0:Xe.packetsDiscardedOnSend,pair_bytesReceived:p.sampleseries(null===(Ze=l.audio)||void 0===Ze?void 0:Ze.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesReceived})),pair_responsesReceived:p.sampleseries(null===(et=l.audio)||void 0===et?void 0:et.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesReceived})),pair_remoteCandidateId:null===(it=null===(nt=null===(tt=null==u?void 0:u.transport)||void 0===tt?void 0:tt.selectedCandidatePair)||void 0===nt?void 0:nt.remoteCandidate)||void 0===it?void 0:it.id,pair_localCandidateId:null===(at=null===(ot=null===(rt=null==u?void 0:u.transport)||void 0===rt?void 0:rt.selectedCandidatePair)||void 0===ot?void 0:ot.localCandidate)||void 0===at?void 0:at.id,pair_packetsSent:p.sampleseries(null===(st=l.audio)||void 0===st?void 0:st.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.packetsSent})),pair_googLocalAddress:null!==(ut=null===(dt=null===(lt=null===(ct=null==u?void 0:u.transport)||void 0===ct?void 0:ct.selectedCandidatePair)||void 0===lt?void 0:lt.localCandidate)||void 0===dt?void 0:dt.ip)&&void 0!==ut?ut:null===(gt=null===(ht=null===(pt=null==u?void 0:u.transport)||void 0===pt?void 0:pt.selectedCandidatePair)||void 0===ht?void 0:ht.localCandidate)||void 0===gt?void 0:gt.address,pair_googRemoteAddress:null!==(yt=null===(vt=null===(mt=null===(ft=null==u?void 0:u.transport)||void 0===ft?void 0:ft.selectedCandidatePair)||void 0===mt?void 0:mt.remoteCandidate)||void 0===vt?void 0:vt.ip)&&void 0!==yt?yt:null===(Ct=null===(_t=null===(St=null==u?void 0:u.transport)||void 0===St?void 0:St.selectedCandidatePair)||void 0===_t?void 0:_t.remoteCandidate)||void 0===Ct?void 0:Ct.address,pair_bytesSent:p.sampleseries(null===(Et=l.audio)||void 0===Et?void 0:Et.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesSent})),pair_googReadable:null===(bt=null===(Tt=null==u?void 0:u.transport)||void 0===Tt?void 0:Tt.selectedCandidatePair)||void 0===bt?void 0:bt.nominated})})}d.compileAudioReport=compileAudioReport},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.compileVideoTelemetryReport=void 0;var p=u(1);function compileVideoTelemetryReport(l,d,u,h){var g,f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k,x,F,U,j,B,V,H,G,W,q,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue,pe,he,ge,fe,me,ve,ye,Se,_e,Ce,Ee,Te,be,Ie,Ae,Re,Pe,Oe,Me,we,Ne,De,Le,ke,xe,Fe,Ue,je,Be,Ve,He,Ge,We,qe,ze,Ke,Je,Qe,Ye,$e,Xe,Ze,et,tt,nt,it,rt,ot,at,st,ct,lt,dt,ut,pt,ht,gt,ft,mt,vt,yt,St,_t,Ct,Et,Tt,bt,It,At,Rt,Pt,Ot,Mt,wt,Nt,Dt,Lt,kt,xt,Ft,Ut,jt,Bt,Vt,Ht,Gt,Wt,qt,zt,Kt,Jt,Qt,Yt;return p.removeUndefinedFields({recv:p.removeUndefinedFields({id:null==u?void 0:u.inboundRTP.id,ssrc:null==u?void 0:u.inboundRTP.ssrc,mediaType:null!==(g=null==u?void 0:u.inboundRTP.mediaType)&&void 0!==g?g:null==u?void 0:u.inboundRTP.kind,bytesReceived:p.sampleseries(null===(f=d[l])||void 0===f?void 0:f.recv,(function(l){return l.inboundRTP.bytesReceived})),packetsReceived:p.sampleseries(null===(m=d[l])||void 0===m?void 0:m.recv,(function(l){return l.inboundRTP.packetsReceived})),packetsLost:p.sampleseries(null===(v=d[l])||void 0===v?void 0:v.recv,(function(l){return l.inboundRTP.packetsLost})),googCodecName:null===(y=null==u?void 0:u.codec)||void 0===y?void 0:y.mimeType.split(\"/\")[1],codecImplementationName:null==u?void 0:u.inboundRTP.decoderImplementation,googTrackId:null===(S=null==u?void 0:u.track)||void 0===S?void 0:S.trackIdentifier,transport_id:null===(_=null==u?void 0:u.transport)||void 0===_?void 0:_.id,transportId:null==u?void 0:u.inboundRTP.transportId,transport_selectedCandidatePairId:null===(C=null==u?void 0:u.transport)||void 0===C?void 0:C.selectedCandidatePairId,transport_localCertificateId:null===(E=null==u?void 0:u.transport)||void 0===E?void 0:E.localCertificateId,transport_remoteCertificateId:null===(T=null==u?void 0:u.transport)||void 0===T?void 0:T.remoteCertificateId,transport_dtlsCipher:null===(b=null==u?void 0:u.transport)||void 0===b?void 0:b.dtlsCipher,transport_srtpCipher:null===(I=null==u?void 0:u.transport)||void 0===I?void 0:I.srtpCipher,pair_id:null===(R=null===(A=null==u?void 0:u.transport)||void 0===A?void 0:A.selectedCandidatePair)||void 0===R?void 0:R.id,pair_responsesSent:p.sampleseries(null===(P=d[l])||void 0===P?void 0:P.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesSent})),pair_requestsReceived:p.sampleseries(null===(O=d[l])||void 0===O?void 0:O.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsReceived})),pair_googRemoteCandidateType:null===(N=null===(w=null===(M=null==u?void 0:u.transport)||void 0===M?void 0:M.selectedCandidatePair)||void 0===w?void 0:w.remoteCandidate)||void 0===N?void 0:N.candidateType,pair_consentRequestsSent:p.sampleseries(null===(D=d[l])||void 0===D?void 0:D.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.consentRequestsSent})),pair_googTransportType:null===(x=null===(k=null===(L=null==u?void 0:u.transport)||void 0===L?void 0:L.selectedCandidatePair)||void 0===k?void 0:k.localCandidate)||void 0===x?void 0:x.protocol,pair_googLocalCandidateType:null===(j=null===(U=null===(F=null==u?void 0:u.transport)||void 0===F?void 0:F.selectedCandidatePair)||void 0===U?void 0:U.localCandidate)||void 0===j?void 0:j.candidateType,pair_googWritable:null===(V=null===(B=null==u?void 0:u.transport)||void 0===B?void 0:B.selectedCandidatePair)||void 0===V?void 0:V.writable,pair_requestsSent:p.sampleseries(null===(H=d[l])||void 0===H?void 0:H.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsSent})),pair_googRtt:p.sampleseries(null===(G=d[l])||void 0===G?void 0:G.recv,(function(l){var d,u;return 1e3*(null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(q=null===(W=null==u?void 0:u.transport)||void 0===W?void 0:W.selectedCandidatePair)||void 0===q?void 0:q.nominated,pair_packetsDiscardedOnSend:null===(K=null===(z=null==u?void 0:u.transport)||void 0===z?void 0:z.selectedCandidatePair)||void 0===K?void 0:K.packetsDiscardedOnSend,pair_bytesReceived:p.sampleseries(null===(J=d[l])||void 0===J?void 0:J.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesReceived})),pair_responsesReceived:p.sampleseries(null===(Q=d[l])||void 0===Q?void 0:Q.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesReceived})),pair_remoteCandidateId:null===(X=null===($=null===(Y=null==u?void 0:u.transport)||void 0===Y?void 0:Y.selectedCandidatePair)||void 0===$?void 0:$.remoteCandidate)||void 0===X?void 0:X.id,pair_localCandidateId:null===(te=null===(ee=null===(Z=null==u?void 0:u.transport)||void 0===Z?void 0:Z.selectedCandidatePair)||void 0===ee?void 0:ee.localCandidate)||void 0===te?void 0:te.id,pair_packetsSent:p.sampleseries(null===(ne=d[l])||void 0===ne?void 0:ne.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.packetsSent})),pair_googLocalAddress:null!==(ae=null===(oe=null===(re=null===(ie=null==u?void 0:u.transport)||void 0===ie?void 0:ie.selectedCandidatePair)||void 0===re?void 0:re.localCandidate)||void 0===oe?void 0:oe.ip)&&void 0!==ae?ae:null===(le=null===(ce=null===(se=null==u?void 0:u.transport)||void 0===se?void 0:se.selectedCandidatePair)||void 0===ce?void 0:ce.localCandidate)||void 0===le?void 0:le.address,pair_googRemoteAddress:null!==(he=null===(pe=null===(ue=null===(de=null==u?void 0:u.transport)||void 0===de?void 0:de.selectedCandidatePair)||void 0===ue?void 0:ue.remoteCandidate)||void 0===pe?void 0:pe.ip)&&void 0!==he?he:null===(me=null===(fe=null===(ge=null==u?void 0:u.transport)||void 0===ge?void 0:ge.selectedCandidatePair)||void 0===fe?void 0:fe.remoteCandidate)||void 0===me?void 0:me.address,pair_bytesSent:p.sampleseries(null===(ve=d[l])||void 0===ve?void 0:ve.recv,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesSent})),pair_googReadable:null===(Se=null===(ye=null==u?void 0:u.transport)||void 0===ye?void 0:ye.selectedCandidatePair)||void 0===Se?void 0:Se.nominated,framesDecoded:p.sampleseries(null===(_e=d[l])||void 0===_e?void 0:_e.recv,(function(l){return l.inboundRTP.framesDecoded})),googFrameHeightReceived:p.sampleseries(null===(Ce=d[l])||void 0===Ce?void 0:Ce.recv,(function(l){return l.inboundRTP.frameHeight})),googFrameWidthReceived:p.sampleseries(null===(Ee=d[l])||void 0===Ee?void 0:Ee.recv,(function(l){return l.inboundRTP.frameWidth})),googFrameRateReceived:p.sampleseries(null===(Te=d[l])||void 0===Te?void 0:Te.recv,(function(l){return l.inboundRTP.framesPerSecond})),googNacksSent:p.sampleseries(null===(be=d[l])||void 0===be?void 0:be.recv,(function(l){return l.inboundRTP.nackCount})),googPlisSent:p.sampleseries(null===(Ie=d[l])||void 0===Ie?void 0:Ie.recv,(function(l){return l.inboundRTP.pliCount})),keyFramesDecoded:p.sampleseries(null===(Ae=d[l])||void 0===Ae?void 0:Ae.recv,(function(l){return l.inboundRTP.keyFramesDecoded})),googFirsSent:p.sampleseries(null===(Re=d[l])||void 0===Re?void 0:Re.recv,(function(l){return l.inboundRTP.firCount})),googJitterBufferMs:p.sampleseries(null===(Pe=d[l])||void 0===Pe?void 0:Pe.recv,(function(l){var d;return null===(d=l.extensions)||void 0===d?void 0:d.jitterBufferMs})),googFrameRateDecoded:p.sampleseries(null===(Oe=d[l])||void 0===Oe?void 0:Oe.recv,(function(l){var d;return null===(d=l.extensions)||void 0===d?void 0:d.frameRateDecoded})),googFrameRateOutput:null===(Me=null==u?void 0:u.extensions)||void 0===Me?void 0:Me.trackRecvFps,jitter:null==u?void 0:u.inboundRTP.jitter}),send:p.removeUndefinedFields({id:null==h?void 0:h.outboundRTP.id,ssrc:null==h?void 0:h.outboundRTP.ssrc,mediaType:null!==(we=null==h?void 0:h.outboundRTP.mediaType)&&void 0!==we?we:null==h?void 0:h.outboundRTP.kind,bytesSent:p.sampleseries(null===(Ne=d[l])||void 0===Ne?void 0:Ne.send,(function(l){return l.outboundRTP.bytesSent})),packetsSent:p.sampleseries(null===(De=d[l])||void 0===De?void 0:De.send,(function(l){return l.outboundRTP.packetsSent})),packetsLost:p.sampleseries(null===(Le=d[l])||void 0===Le?void 0:Le.send,(function(l){var d;return null===(d=l.remoteInboundRTP)||void 0===d?void 0:d.packetsLost})),googCodecName:null===(ke=null==h?void 0:h.codec)||void 0===ke?void 0:ke.mimeType.split(\"/\")[1],codecImplementationName:null==h?void 0:h.outboundRTP.encoderImplementation,googTrackId:null===(xe=null==h?void 0:h.track)||void 0===xe?void 0:xe.trackIdentifier,transport_id:null===(Fe=null==h?void 0:h.transport)||void 0===Fe?void 0:Fe.id,transportId:null==h?void 0:h.outboundRTP.transportId,transport_selectedCandidatePairId:null===(Ue=null==h?void 0:h.transport)||void 0===Ue?void 0:Ue.selectedCandidatePairId,transport_localCertificateId:null===(je=null==h?void 0:h.transport)||void 0===je?void 0:je.localCertificateId,transport_remoteCertificateId:null===(Be=null==h?void 0:h.transport)||void 0===Be?void 0:Be.remoteCertificateId,transport_dtlsCipher:null===(Ve=null==h?void 0:h.transport)||void 0===Ve?void 0:Ve.dtlsCipher,transport_srtpCipher:null===(He=null==h?void 0:h.transport)||void 0===He?void 0:He.srtpCipher,pair_id:null===(We=null===(Ge=null==h?void 0:h.transport)||void 0===Ge?void 0:Ge.selectedCandidatePair)||void 0===We?void 0:We.id,pair_responsesSent:p.sampleseries(null===(qe=d[l])||void 0===qe?void 0:qe.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesSent})),pair_requestsReceived:p.sampleseries(null===(ze=d[l])||void 0===ze?void 0:ze.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsReceived})),pair_googRemoteCandidateType:null===(Qe=null===(Je=null===(Ke=null==h?void 0:h.transport)||void 0===Ke?void 0:Ke.selectedCandidatePair)||void 0===Je?void 0:Je.remoteCandidate)||void 0===Qe?void 0:Qe.candidateType,pair_consentRequestsSent:p.sampleseries(null===(Ye=d[l])||void 0===Ye?void 0:Ye.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.consentRequestsSent})),pair_googTransportType:null===(Ze=null===(Xe=null===($e=null==h?void 0:h.transport)||void 0===$e?void 0:$e.selectedCandidatePair)||void 0===Xe?void 0:Xe.localCandidate)||void 0===Ze?void 0:Ze.protocol,pair_googLocalCandidateType:null===(nt=null===(tt=null===(et=null==h?void 0:h.transport)||void 0===et?void 0:et.selectedCandidatePair)||void 0===tt?void 0:tt.localCandidate)||void 0===nt?void 0:nt.candidateType,pair_googWritable:null===(rt=null===(it=null==h?void 0:h.transport)||void 0===it?void 0:it.selectedCandidatePair)||void 0===rt?void 0:rt.writable,pair_requestsSent:p.sampleseries(null===(ot=d[l])||void 0===ot?void 0:ot.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.requestsSent})),pair_googRtt:p.sampleseries(null===(at=d[l])||void 0===at?void 0:at.send,(function(l){var d,u;return 1e3*(null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.currentRoundTripTime)}),!0),pair_googActiveConnection:null===(ct=null===(st=null==h?void 0:h.transport)||void 0===st?void 0:st.selectedCandidatePair)||void 0===ct?void 0:ct.nominated,pair_packetsDiscardedOnSend:null===(dt=null===(lt=null==h?void 0:h.transport)||void 0===lt?void 0:lt.selectedCandidatePair)||void 0===dt?void 0:dt.packetsDiscardedOnSend,pair_bytesReceived:p.sampleseries(null===(ut=d[l])||void 0===ut?void 0:ut.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesReceived})),pair_responsesReceived:p.sampleseries(null===(pt=d[l])||void 0===pt?void 0:pt.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.responsesReceived})),pair_remoteCandidateId:null===(ft=null===(gt=null===(ht=null==h?void 0:h.transport)||void 0===ht?void 0:ht.selectedCandidatePair)||void 0===gt?void 0:gt.remoteCandidate)||void 0===ft?void 0:ft.id,pair_localCandidateId:null===(yt=null===(vt=null===(mt=null==h?void 0:h.transport)||void 0===mt?void 0:mt.selectedCandidatePair)||void 0===vt?void 0:vt.localCandidate)||void 0===yt?void 0:yt.id,pair_packetsSent:p.sampleseries(null===(St=d[l])||void 0===St?void 0:St.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.packetsSent})),pair_googLocalAddress:null!==(Tt=null===(Et=null===(Ct=null===(_t=null==h?void 0:h.transport)||void 0===_t?void 0:_t.selectedCandidatePair)||void 0===Ct?void 0:Ct.localCandidate)||void 0===Et?void 0:Et.ip)&&void 0!==Tt?Tt:null===(At=null===(It=null===(bt=null==h?void 0:h.transport)||void 0===bt?void 0:bt.selectedCandidatePair)||void 0===It?void 0:It.localCandidate)||void 0===At?void 0:At.address,pair_googRemoteAddress:null!==(Mt=null===(Ot=null===(Pt=null===(Rt=null==h?void 0:h.transport)||void 0===Rt?void 0:Rt.selectedCandidatePair)||void 0===Pt?void 0:Pt.remoteCandidate)||void 0===Ot?void 0:Ot.ip)&&void 0!==Mt?Mt:null===(Dt=null===(Nt=null===(wt=null==h?void 0:h.transport)||void 0===wt?void 0:wt.selectedCandidatePair)||void 0===Nt?void 0:Nt.remoteCandidate)||void 0===Dt?void 0:Dt.address,pair_bytesSent:p.sampleseries(null===(Lt=d[l])||void 0===Lt?void 0:Lt.send,(function(l){var d,u;return null===(u=null===(d=l.transport)||void 0===d?void 0:d.selectedCandidatePair)||void 0===u?void 0:u.bytesSent})),pair_googReadable:null===(xt=null===(kt=null==h?void 0:h.transport)||void 0===kt?void 0:kt.selectedCandidatePair)||void 0===xt?void 0:xt.nominated,framesEncoded:p.sampleseries(null===(Ft=d[l])||void 0===Ft?void 0:Ft.send,(function(l){return l.outboundRTP.framesEncoded})),googNacksReceived:p.sampleseries(null===(Ut=d[l])||void 0===Ut?void 0:Ut.send,(function(l){return l.outboundRTP.nackCount})),googPlisReceived:p.sampleseries(null===(jt=d[l])||void 0===jt?void 0:jt.send,(function(l){return l.outboundRTP.pliCount})),googFirsReceived:p.sampleseries(null===(Bt=d[l])||void 0===Bt?void 0:Bt.send,(function(l){return l.outboundRTP.firCount})),keyFramesEncoded:p.sampleseries(null===(Vt=d[l])||void 0===Vt?void 0:Vt.send,(function(l){return l.outboundRTP.keyFramesEncoded})),googFrameHeightInput:null===(Ht=null==h?void 0:h.mediaSource)||void 0===Ht?void 0:Ht.height,googFrameWidthInput:null===(Gt=null==h?void 0:h.mediaSource)||void 0===Gt?void 0:Gt.width,googFrameRateInput:p.sampleseries(null===(Wt=d[l])||void 0===Wt?void 0:Wt.send,(function(l){var d;return null===(d=l.mediaSource)||void 0===d?void 0:d.framesPerSecond})),googFrameHeightSent:p.sampleseries(null===(qt=d[l])||void 0===qt?void 0:qt.send,(function(l){return l.outboundRTP.frameHeight})),googFrameWidthSent:p.sampleseries(null===(zt=d[l])||void 0===zt?void 0:zt.send,(function(l){return l.outboundRTP.frameWidth})),googFrameRateSent:p.sampleseries(null===(Kt=d[l])||void 0===Kt?void 0:Kt.send,(function(l){return l.outboundRTP.framesPerSecond})),googRtt:p.sampleseries(null===(Jt=d[l])||void 0===Jt?void 0:Jt.send,(function(l){var d,u;return 1e3*(null!==(u=null===(d=l.remoteInboundRTP)||void 0===d?void 0:d.roundTripTime)&&void 0!==u?u:0)}),!0),hugeFramesSent:null==h?void 0:h.outboundRTP.hugeFramesSent,qpSum:p.sampleseries(null===(Qt=d[l])||void 0===Qt?void 0:Qt.send,(function(l){return l.outboundRTP.qpSum})),qualityLimitationDurations:h?JSON.stringify(null==h?void 0:h.outboundRTP.qualityLimitationDurations):void 0,qualityLimitationReason:null==h?void 0:h.outboundRTP.qualityLimitationReason,qualityLimitationResolutionChanges:null==h?void 0:h.outboundRTP.qualityLimitationResolutionChanges,jitter:null===(Yt=null==h?void 0:h.remoteInboundRTP)||void 0===Yt?void 0:Yt.jitter})})}d.compileVideoTelemetryReport=compileVideoTelemetryReport},function(l,d,u){var p=this&&this.__read||function(l,d){var u=\"function\"==typeof Symbol&&l[Symbol.iterator];if(!u)return l;var p,h,g=u.call(l),f=[];try{for(;(void 0===d||d-- >0)&&!(p=g.next()).done;)f.push(p.value)}catch(l){h={error:l}}finally{try{p&&!p.done&&(u=g.return)&&u.call(g)}finally{if(h)throw h.error}}return f},h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var g=function(){function JamaLogger(l,d){this.safe=l,this.unsafe=d,this.safe||(this.safe=this.unsafe)}return JamaLogger.prototype.warn=function(){for(var l,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];(l=this.unsafe).warn.apply(l,h([],p(d),!1))},JamaLogger.prototype.error=function(){for(var l,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];(l=this.unsafe).error.apply(l,h([],p(d),!1))},JamaLogger.prototype.debug=function(){for(var l,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];(l=this.unsafe).debug.apply(l,h([],p(d),!1))},JamaLogger.prototype.info=function(){for(var l,d=[],u=0;u<arguments.length;u++)d[u]=arguments[u];(l=this.unsafe).info.apply(l,h([],p(d),!1))},JamaLogger.prototype.createChild=function(l){return new JamaLogger(this.safe.createChild(l),this.unsafe.createChild(l))},JamaLogger}();d.default=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.PlatformCallConstraintsProvider=void 0;var g=u(7),f=u(26),m=function(l){function PlatformCallConstraintsProvider(d){var u=l.call(this)||this;return u.logger=d,u.constraints={},u}return p(PlatformCallConstraintsProvider,l),PlatformCallConstraintsProvider.prototype.setConstraints=function(l){this.logger.debug(\"Setting new platform call constraints\",JSON.stringify(l)),this.constraints=l,this.raiseChanged()},PlatformCallConstraintsProvider.prototype.getSettings=function(l){var d=this.getFsFromResolution(l.resolutionTableOverride);return{numVideoChannelsGvc:this.getMin(l.numVideoChannelsGvc,this.constraints.maxIncomingStreams),webrtcCameraOpenFs:this.getMin(l.webrtcCameraOpenFs,d),webrtcMaxScalingFs:this.getMin(l.webrtcMaxScalingFs,d),specCompliantSimulcast:this.getMaxSimulcastLayers(l.specCompliantSimulcast),multiviewResolutionLimits:this.getMaxParticipantResolutions(l.multiviewResolutionLimits)}},PlatformCallConstraintsProvider.prototype.getMaxSimulcastLayers=function(l){if(void 0===this.constraints.maxSimulcastLayers)return l;var d=0===this.constraints.maxSimulcastLayers,u=l.video,p=l.sharing;return{video:d?h(h({},u),{enableLocally:!1,allowEnableRemotely:!1}):u,sharing:d?h(h({},p),{enableLocally:!1,allowEnableRemotely:!1}):p}},PlatformCallConstraintsProvider.prototype.getMaxParticipantResolutions=function(l){var d,u=this.constraints.maxParticipantResolutions;return Number.isInteger(u)?{more:u}:null!==(d=u)&&void 0!==d?d:l},PlatformCallConstraintsProvider.prototype.getFsFromResolution=function(l){var d;return null===(d=new f.default(l).getResolutionForHeight(this.constraints.maxOutgoingResolution))||void 0===d?void 0:d.fs},PlatformCallConstraintsProvider.prototype.getMin=function(l,d){var u=Math.min(null!=d?d:1/0,null!=l?l:1/0);return u===1/0?l:u},PlatformCallConstraintsProvider}(g.default);d.PlatformCallConstraintsProvider=m},function(l,d,u){!function webpackUniversalModuleDefinition(d,p){l.exports=p(u(8))}(window,(function(l){return function(l){var d={};function __webpack_require__(u){if(d[u])return d[u].exports;var p=d[u]={i:u,l:!1,exports:{}};return l[u].call(p.exports,p,p.exports,__webpack_require__),p.l=!0,p.exports}return __webpack_require__.m=l,__webpack_require__.c=d,__webpack_require__.d=function(l,d,u){__webpack_require__.o(l,d)||Object.defineProperty(l,d,{enumerable:!0,get:u})},__webpack_require__.r=function(l){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(l,\"__esModule\",{value:!0})},__webpack_require__.t=function(l,d){if(1&d&&(l=__webpack_require__(l)),8&d)return l;if(4&d&&\"object\"==typeof l&&l&&l.__esModule)return l;var u=Object.create(null);if(__webpack_require__.r(u),Object.defineProperty(u,\"default\",{enumerable:!0,value:l}),2&d&&\"string\"!=typeof l)for(var p in l)__webpack_require__.d(u,p,function(d){return l[d]}.bind(null,p));return u},__webpack_require__.n=function(l){var d=l&&l.__esModule?function getDefault(){return l.default}:function getModuleExports(){return l};return __webpack_require__.d(d,\"a\",d),d},__webpack_require__.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},__webpack_require__.p=\"\",__webpack_require__(__webpack_require__.s=0)}([function(l,d,u){l.exports=u(1)},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.ImageRenderer=d.ImageRendererProvider=void 0;var h,g=u(2),f=u(3),m=3e4,v=\"image renderer disposed\",y=1;!function(l){l[l.OK=200]=\"OK\",l[l.NoContent=204]=\"NoContent\",l[l.Unauthorized=401]=\"Unauthorized\",l[l.Forbidden=403]=\"Forbidden\",l[l.NotFound=404]=\"NotFound\",l[l.TooManyRequests=429]=\"TooManyRequests\",l[l.InternalServerError=500]=\"InternalServerError\"}(h||(h={}));var S=function(){function ImageRendererProvider(l){this.config=l,this.logger=this.config.callingLogger.createChild(\"ImageRenderer\")}return ImageRendererProvider.prototype.createRenderer=function(l){return new _(this.logger,this.config.tokenProvider,this.config.httpRequestDispatcher,this.config.appStateProvider,l)},ImageRendererProvider}();d.ImageRendererProvider=S;var _=function(l){function ImageRenderer(d,u,p,h,g){var f=l.call(this)||this;return f.logger=d,f.tokenProvider=u,f.httpRequestDispatcher=p,f.appStateProvider=h,f.options=g,f.frameRateInSeconds=0,f.frameUriIndex=0,f.frameTimeoutId=0,f.sequenceNumber=0,f.started=!1,f.currentQuality=1,f.frameUri=g.frameUris,f.id=g.id,f}return p(ImageRenderer,l),ImageRenderer.prototype.start=function(){return this.started?Promise.reject(\"ImageRenderer already started\"):(this.started=!0,this.event(\"onRendererStarted\").raise(this),this.logger.debug(\"Image based rendering starting for id: \".concat(this.id)),this.shouldUseBackgroundImage()?this.frameElement=document.createElement(\"div\"):this.frameElement=document.createElement(\"img\"),this.frameElement.classList.add(\"image-renderer\"),this.options.frameContainer.appendChild(this.frameElement),this.renderSafe())},ImageRenderer.prototype.dispose=function(){clearTimeout(this.frameTimeoutId),this.disposeOnlineSubscriptions(),this.getNextFrameResolve&&(this.getNextFrameResolve(),this.getNextFrameResolve=void 0),this.onlineReject&&(this.onlineReject(v),this.onlineReject=void 0),this.frameElement&&(this.frameElement.parentNode&&this.frameElement.parentNode.removeChild(this.frameElement),this.frameElement=void 0),this.started=!1,this.event(\"onRendererDisposed\").raise(this)},ImageRenderer.prototype.render=function(l){var d=this;return void 0===l&&(l=(0,g.default)()),this.waitForAppOnline().then((function(){return d.tokenProvider()})).then((function(u){var p={\"X-Skypetoken\":u,\"X-Microsoft-Skype-Chain-ID\":d.options.callParams.callId,\"X-Microsoft-Skype-Message-ID\":l};d.sequenceNumber&&(p[\"x-ms-sequencenumber\"]=d.sequenceNumber.toString());var h=d.httpRequestDispatcher.getRequestOptions(\"GET\",p,\"\",m,\"blob\");return d.sendRequestThrottled(d.frameUri[d.frameUriIndex],h,l).then((function(u){return d.started?d.handleRequestReceived(u,l):Promise.reject(v)}))}))},ImageRenderer.prototype.waitForAppOnline=function(){return!this.appStateProvider||this.appStateProvider.isOnline()?Promise.resolve():(this.logger.error(\"Teams is offline, waiting for network before continuing rendering\"),this.onQualityChanged(3),this.getAppOnlinePromise())},ImageRenderer.prototype.getAppOnlinePromise=function(){var l=this;return this.onlinePromise||(this.onlinePromise=new Promise((function(d,u){if(l.onlineReject=u,l.appStateProvider){var p=l.appStateProvider;l.onlineSubscription=p.on(\"onAppStateChanged\",(function(){p.isOnline()&&(d(),l.disposeOnlineSubscriptions())}))}else d()}))),this.onlinePromise},ImageRenderer.prototype.disposeOnlineSubscriptions=function(){this.onlineSubscription&&(this.onlineSubscription.dispose(),this.onlineSubscription=void 0),this.onlinePromise&&(this.onlinePromise=void 0)},ImageRenderer.prototype.handleRequestReceived=function(l,d){var u,p=this;if(!l||!l.status)return this.logger.warn(\"Received empty XHR, retrying. MessageId: \".concat(d)),this.render();switch(this.frameRateInSeconds=this.frameRateInSeconds||y,l.status){case h.OK:return this.handleFrameReceived(l,d).then((function(){p.renderSafe().catch((function(){}))})).catch((function(l){return p.render()}));case h.NoContent:break;case h.Unauthorized:case h.Forbidden:return this.onQualityChanged(3),Promise.reject(\"Request not authorized, status: \".concat(l.status));case h.NotFound:return this.onQualityChanged(3),Promise.reject(\"Meeting/session was not found, status: 404\");case h.TooManyRequests:if(this.onQualityChanged(3),u=l.getResponseHeader(\"retry-after\")){var g=parseInt(u,10);g&&(this.frameRateInSeconds=g)}break;default:if(l.status>=h.InternalServerError){if(this.frameUriIndex++,this.sequenceNumber=0,this.logger.error(\"Received internal server error \".concat(l.status,\", switching to next frameUrl. MessageId: \").concat(d)),this.frameUriIndex===this.frameUri.length)return this.onQualityChanged(3),Promise.reject(\"No more available frameUris\")}else this.logger.error(\"Received invalid error \".concat(l.status,\", retrying. MessageId: \").concat(d))}return this.render()},ImageRenderer.prototype.renderSafe=function(){var l=this,d=(0,g.default)();return this.render(d).catch((function(u){return l.logger.error(\"Getting frame failed with terminal error: \".concat(JSON.stringify(u),\". MessageId: \").concat(d)),l.dispose(),Promise.reject(u)}))},ImageRenderer.prototype.handleFrameReceived=function(l,d){var u=l.getResponseHeader(\"x-ms-sequencenumber\");if(!u)return this.logger.warn(\"sequenceNumberHeader not present. MessageId: \".concat(d)),this.onQualityChanged(3),this.renderFrame(l.response);var p=parseInt(u,10);if(p&&p>this.sequenceNumber)return this.logger.debug(\"Received frame number: \".concat(p,\". MessageId: \").concat(d)),this.sequenceNumber=p,this.onQualityChanged(1),this.renderFrame(l.response,d);if(p&&p===this.sequenceNumber)return Promise.resolve();var h=\"Received out of sequence frame: \".concat(p,\" current sequence: \").concat(this.sequenceNumber,\". MessageId: \").concat(d);return this.logger.error(h),this.onQualityChanged(3),Promise.reject(h)},ImageRenderer.prototype.renderFrame=function(l,d){var u=this;return new Promise((function(p,h){var g=new FileReader;g.readAsDataURL(l),g.onloadend=function(){return u.frameElement?(u.shouldUseBackgroundImage()?u.frameElement.style.backgroundImage=\"url('\".concat(g.result,\"')\"):u.frameElement.src=g.result,p()):h(\"No frameElement found. MessageId: \".concat(d))},g.onerror=function(l){var p=\"Failed rendering received image: \".concat(l,\". MessageId: \").concat(d);return u.logger.error(p),h(p)}}))},ImageRenderer.prototype.sendRequestThrottled=function(l,d,u){var p=this;return this.started?new Promise((function(h){p.getNextFrameResolve=h,p.frameTimeoutId=window.setTimeout((function(){var g=p.httpRequestDispatcher.getAsync(l,d).then((function(l){return l.request})).catch((function(l){return p.logger.error(\"Getting frame failed with error: \".concat(JSON.stringify(l),\", attempting recovery. MessageId: \").concat(u)),l?l.request:{}}));h(g)}),1e3*p.frameRateInSeconds)})):Promise.reject(v)},ImageRenderer.prototype.shouldUseBackgroundImage=function(){return-1!==navigator.userAgent.indexOf(\"Trident\")},ImageRenderer.prototype.onQualityChanged=function(l){if(this.currentQuality!==l){this.currentQuality=l;var d=this.options.callParams.imageRenderingEventCallbacks;d&&d.onImageRenderingQualityChanged&&d.onImageRenderingQualityChanged({type:51,value:l,isLocalSource:!1,mediaType:2})}},ImageRenderer}(f.default);d.ImageRenderer=_},function(l,d,u){function generateGuid(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,(function(l){var d=16*Math.random()|0;return(\"x\"===l?d:3&d|8).toString(16)}))}Object.defineProperty(d,\"__esModule\",{value:!0}),d.default=generateGuid},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__spreadArray||function(l,d,u){if(u||2===arguments.length)for(var p,h=0,g=d.length;h<g;h++)!p&&h in d||(p||(p=Array.prototype.slice.call(d,0,h)),p[h]=d[h]);return l.concat(p||Array.prototype.slice.call(d))};Object.defineProperty(d,\"__esModule\",{value:!0});var g=function(l){function ObservableBase(d){return l.call(this,d)||this}return p(ObservableBase,l),ObservableBase.prototype.changed=function(l,d){return this.subscribe({changed:{skipEventConfig:d,handler:l},on:void 0})},ObservableBase.prototype.on=function(l,d){return this.subscribe({changed:void 0,on:{name:String(l),handler:this._toEventCallback(d)}})},ObservableBase.prototype.once=function(l,d,u){var p,h=this,onceSubscription=function(){for(var l=[],g=0;g<arguments.length;g++)l[g]=arguments[g];p.dispose(u),h._toEventCallback(d).apply(void 0,l)};return p=this.on(l,this._fromEventCallback(onceSubscription))},ObservableBase.prototype.raiseChanged=function(l){var d=this;this.raiseEvents((function(u){if(u.changed){var p=u.changed,h=p.skipEventConfig,g=p.handler;!d.getShouldSkipChangedEvent(l,h)&&g()}}))},ObservableBase.prototype.event=function(l){var d=this;return{raise:this._fromEventCallback((function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];return d._raiseEventImpl.apply(d,h([String(l)],u,!1))}))}},ObservableBase.prototype._raiseEventImpl=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];this.raiseEvents((function(u){var p;return u.on&&u.on.name===l&&(p=u.on).handler.apply(p,d)}))},ObservableBase.prototype._toEventCallback=function(l){return l},ObservableBase.prototype._fromEventCallback=function(l){return l},ObservableBase.prototype.getShouldSkipChangedEvent=function(l,d){return!!(null==l?void 0:l.skipParticipantsUpdatesOnCall)&&!!(null==d?void 0:d.skipParticipantsUpdatesOnCall)},ObservableBase}(u(4).EventSourceImpl);d.default=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.EventSourceImpl=void 0;var p=u(5),h=u(6),g=function(){function EventSourceImpl(l){this.subscriptions=[],this.eventLogger=l}return EventSourceImpl.prototype.subscribe=function(l){return new f(this.subscriptions,l)},EventSourceImpl.prototype.dispose=function(l){this.subscriptions=[]},EventSourceImpl.prototype.raiseEvents=function(l){var d=this;this.subscriptions.slice().forEach((function(u){try{void 0!==u.eventHandler&&l(u.eventHandler)}catch(l){d.eventLogger&&d.eventLogger.warn&&d.eventLogger.warn(\"Event handler exception caught!\",(0,h.stringifyObject)(l))}}))},EventSourceImpl}();d.EventSourceImpl=g;var f=function(){function EventSubscriptionImpl(l,d){this.subscriptions=l,this.eventHandler=d,this.subscriptions.push(this)}return EventSubscriptionImpl.prototype.dispose=function(){var l=this;p.remove(this.subscriptions,(function(d){return d===l})),this.eventHandler=void 0},EventSubscriptionImpl}()},function(d,u){d.exports=l},function(l,d,u){function getRandomizedTimeout(l){var d=Math.floor(11*Math.random())+10;return Math.floor(l*(1-d/100))}function isStringBase64(l){if(!l)return!1;try{return atob(l),!0}catch(l){return!1}}function isPromiseLike(l){return!!l&&\"function\"==typeof l.then}function stringifyObject(l){if(!l)return\"\".concat(l);if(l instanceof Map)return mapToString(l);var d=l.toString();return d.endsWith(\"[object Object]\")?JSON.stringify(l):d}function mapToString(l){var d={};return l.forEach((function(l,u){d[u.toString()]=l})),JSON.stringify(d)}function stringToBuffer(l){for(var d=new ArrayBuffer(l.length),u=new Uint8Array(d),p=0;p<l.length;p++)u[p]=l.charCodeAt(p);return u}Object.defineProperty(d,\"__esModule\",{value:!0}),d.stringToBuffer=d.stringifyObject=d.isPromiseLike=d.isStringBase64=d.getRandomizedTimeout=void 0,d.getRandomizedTimeout=getRandomizedTimeout,d.isStringBase64=isStringBase64,d.isPromiseLike=isPromiseLike,d.stringifyObject=stringifyObject,d.stringToBuffer=stringToBuffer}])}))},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.LiveStreamClient=void 0;var g=u(466),f=u(473),m=function(){function LiveStreamClient(l,d,u){this.ecsConfig=l,this.logger=d,this.getTelemetryLogger=u}return LiveStreamClient.prototype.configure=function(l){this.configuration=l},LiveStreamClient.prototype.initialize=function(){return p(this,void 0,void 0,(function(){var l,d,u,p,g;return h(this,(function(h){l=\"MDN_MIDDLELANE_TEAMS\",d=\"liveStream\",u=this.ecsConfig.getString(l,d),p={};try{p=JSON.parse(u)}catch(u){this.logger.warn(\"failed to parse ECS configuration for \".concat(l,\"/\").concat(d))}return g=this.ecsConfig.getString(\"ConfigIDs\",l),this._configProvider=new f.LiveStreamConfigProvider(p,this.configuration,g,this.logger.createChild(\"LiveStreamConfigProvider\")),[2]}))}))},LiveStreamClient.prototype.createLiveStream=function(){return new g.LiveStream(this._configProvider,this.logger.createChild(\"LiveStream\"),this.getTelemetryLogger)},LiveStreamClient.prototype.dispose=function(l){},LiveStreamClient}();d.LiveStreamClient=m},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},f=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.LiveStream=void 0;var m=u(18),v=u(467),y=u(471),S=u(472),_=function(l){function LiveStream(d,u,p){var h=l.call(this)||this;return h.configProvider=d,h.logger=u,h.getTelemetryLogger=p,h.isAvailable=!0,h._isStreaming=!1,h.liveStreamStatistic=new S.LiveStreamStatistic(h.configProvider.config,h.logger.createChild(\"LiveStreamStatistic\")),h.playerSubs=[],h.isFinalTelemetrySent=!1,1===h.configProvider.playerConfig.playerType?h.player=new y.HlsLiveStreamPlayer(h.logger.createChild(\"HlsLiveStreamPlayer\"),h.liveStreamStatistic,h.configProvider):h.player=new v.AmpLiveStreamPlayer(h.logger.createChild(\"AmpLiveStreamPlayer\"),h.liveStreamStatistic,h.configProvider),h.subscribeForPlayerEvents(),h}return p(LiveStream,l),Object.defineProperty(LiveStream.prototype,\"isStreaming\",{get:function(){return this._isStreaming},enumerable:!1,configurable:!0}),LiveStream.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},LiveStream.prototype.start=function(l,d){return h(this,void 0,void 0,(function(){var u,p=this;return g(this,(function(h){switch(h.label){case 0:return[4,this.setOptions(d)];case 1:return h.sent(),this.isFinalTelemetrySent=!1,this.telemetryLogger=this.getTelemetryLogger(),[4,this.player.loadPlayer(l)];case 2:if(!(u=h.sent()).setupSucceeded)throw this.player.stop(),this.logger.error(\"playerLoadFailed\"),this.sendTelemetry(),new Error(JSON.stringify(u.playerSetupError));return this._isStreaming=!0,this.statsSub=window.setTimeout((function(){clearTimeout(p.statsSub),p.logger.debug(\"initial telemetry report after \".concat(p.configProvider.config.sendInitialTelemetryAfterMs,\" ms\")),p.sendTelemetry()}),this.configProvider.config.sendInitialTelemetryAfterMs),[2,this.player.getRenderer()]}}))}))},LiveStream.prototype.stop=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){return[2]}))}))},LiveStream.prototype.setOptions=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this.options=l,[2,this.player.configure(l)]}))}))},LiveStream.prototype.getStats=function(){return this.liveStreamStatistic.playerDiagnosticSnapshot},LiveStream.prototype.dispose=function(){this.unsubscribeFromPlayerEvents(),this.player.stop(),clearTimeout(this.statsSub),this.logger.debug(\"stopping live event\"),this.sendFinalTelemetry(),l.prototype.dispose.call(this)},LiveStream.prototype.sendFinalTelemetry=function(){this.isFinalTelemetrySent||(this.isFinalTelemetrySent=!0,this.sendTelemetry(!0))},LiveStream.prototype.sendTelemetry=function(l){if(this.configProvider.config.sendTelemetry&&this.telemetryLogger){var d={configIds:this.configProvider.configIds,correlationId:this.options&&this.options.correlationId,eTag:this.configProvider.etag,isFinal:l,overflow:this.options&&this.options.overflow,threadId:this.options&&this.options.threadId,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton},u=this.liveStreamStatistic.getReport(d);this.logger.debug(\"generated live stream report\",u),this.telemetryLogger.sendEvent({eventName:\"live_events\",props:u})}else this.logger.info(\"telemetry not sent\")},LiveStream.prototype.subscribeForPlayerEvents=function(){var l=this;this.playerSubs.push(this.player.on(\"playbackStateChanged\",(function(){l.onPlaybackStateChanged()}))),this.playerSubs.push(this.player.on(\"playbackError\",(function(d,u){l.onPlaybackError(d,u)}))),this.playerSubs.push(this.player.on(\"urlSwitched\",(function(d){l.onUrlSwitched(d)}))),this.playerSubs.push(this.player.on(\"sdnPluginLoadFailed\",(function(d){l.onSdnPluginLoadFailed(d)})))},LiveStream.prototype.unsubscribeFromPlayerEvents=function(){var l,d;try{for(var u=f(this.playerSubs),p=u.next();!p.done;p=u.next()){p.value.dispose()}}catch(d){l={error:d}}finally{try{p&&!p.done&&(d=u.return)&&d.call(u)}finally{if(l)throw l.error}}this.playerSubs=[]},LiveStream.prototype.onPlaybackStateChanged=function(){var l=this.player.getPlaybackState();switch(l){case\"Start\":this.event(\"playbackStarted\").raise();break;case\"Ended\":this.event(\"playbackNotLive\").raise(),this.sendFinalTelemetry();break;case\"Seeked\":this.event(\"playbackSeeked\").raise(this.player.getCaptionsTimestamp());break;default:this.logger.debug(\"playbackStateChanged: \".concat(l))}this.event(\"playbackStateChanged\").raise(this.player.getPlaybackState())},LiveStream.prototype.onPlaybackError=function(l,d){this.event(\"error\").raise(l,d)},LiveStream.prototype.onUrlSwitched=function(l){this.event(\"urlSwitched\").raise(l)},LiveStream.prototype.onSdnPluginLoadFailed=function(l){this.event(\"sdnPluginLoadFailed\").raise(l)},LiveStream}(m.default);d.LiveStream=_},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.AmpLiveStreamPlayer=void 0;var f=u(8),m=u(18),v=u(35),y=u(174),S=u(175),_=u(88),C=u(176),E=[2097152,2097552,2097556,2097557,2097564,2097652,2097654,2097655,2097656,2097752,3145728,4194305,4194306,4194307,4194308,4194309,5242880,5242881,5242882,5242884,5242885,5242886],T=2097753,b=function(l){function AmpLiveStreamPlayer(d,u,p){var h=l.call(this)||this;return h.logger=d,h.liveStreamStatistic=u,h.configProvider=p,h.playerState=\"Destroyed\",h.retryCount=0,h.captionsTimestamp=0,h.isSwitchStreamingUrlOngoing=!1,h.streamingUrlSwitchCount=0,h.isPlaybackUnsupported=!1,h}return p(AmpLiveStreamPlayer,l),AmpLiveStreamPlayer.prototype.configure=function(l){return h(this,void 0,void 0,(function(){var d;return g(this,(function(u){switch(u.label){case 0:return _.isStreamValid(l.stream)||_.isStreamValid(l.altStream)?(this.logger.info(\"Live Stream configuration provided\"),this.liveStreamOptions=l,d=_.isStreamValid(l.stream)?l.stream:l.altStream,!this.playerInstance||this.isPlaybackUnsupported?(this.selectedStreamDetails=d,[2]):[4,this.handleStreamInfoUpdate(d)]):(this.logger.error(\"Invalid Live Stream configuration provided: no valid primary or alternative stream\"),[2]);case 1:return u.sent(),[2]}}))}))},AmpLiveStreamPlayer.prototype.loadPlayer=function(l){return h(this,void 0,void 0,(function(){var d,u,p,h,f=this;return g(this,(function(g){switch(g.label){case 0:return this.playerInstance?(this.logger.error(\"playerLoadFailed: cannot load a player while current one is still active\"),[2,{setupSucceeded:!1,playerSetupError:{errorType:\"MultiplePlayerLoad\",errorMessage:\"cannot load a player while current one is still active\"}}]):this.liveStreamOptions&&this.selectedStreamDetails&&_.isStreamValid(this.selectedStreamDetails)?(this.playerInstance=new y.PlayerWrapper(this.logger),this.playerInstance.on(\"stateChanged\",(function(l,d){return f.ampStateChanged(l,d)})),this.playerInstance.on(\"captionsToggled\",(function(l,d,u){return f.captionsToggled(l,d,u)})),this.playerInstance.on(\"statsUpdated\",(function(l){return f.liveStreamStatistic.registerStatsUpdated(l)})),[4,this.playerInstance.initialize(l,this.liveStreamOptions,this.configProvider,0)]):(this.logger.error(\"playerLoadFailed: empty/invalid primary and alternate stream info configured\"),[2,{setupSucceeded:!1,playerSetupError:{errorType:\"InvalidStream\",errorMessage:\"empty/invalid primary and alternate stream info configured\"}}]);case 1:g.sent(),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.srcLoadPromise||(this.srcLoadPromise=this.playerInstance.message(\"loadPlayerScript\").send()),g.label=2;case 2:return g.trys.push([2,4,,5]),[4,this.srcLoadPromise];case 3:return g.sent(),[3,5];case 4:return d=g.sent(),h=(0,v.stringifyObject)(d),this.logger.error(\"playerLoadFailed: player scripts load failed: \".concat(h)),this.liveStreamStatistic.registerPlayerLoadFailed(\"player scripts load failed\"),this.srcLoadPromise=null,[2,{setupSucceeded:!1,playerSetupError:{errorType:\"PlayerScriptLoadFailed\",errorMessage:h}}];case 5:return[4,this.tryLoadSdnPlugin()];case 6:g.sent(),g.label=7;case 7:return g.trys.push([7,9,,10]),[4,this.playerInstance.message(\"createAmp\").send()];case 8:return g.sent(),[3,10];case 9:return u=g.sent(),h=(0,v.stringifyObject)(u),this.logger.error(\"playerLoadFailed: createAmp failed: \".concat(h)),this.liveStreamStatistic.registerPlayerLoadFailed(\"playerLoadFailed \".concat(h)),[2,{setupSucceeded:!1,playerSetupError:{errorType:\"PlayerInitializationFailed\",errorMessage:h}}];case 10:return g.trys.push([10,12,,13]),[4,this.setPlayerSource(this.selectedStreamDetails)];case 11:return g.sent(),this.loadSucceeded=!0,this.logger.info(\"loadPlayer succeeded: \".concat(this.loadSucceeded)),this.liveStreamStatistic.registerPlayerLoadSucceeded(),this.playerState=\"Initialized\",[2,{setupSucceeded:this.loadSucceeded}];case 12:return p=g.sent(),h=(0,v.stringifyObject)(p),this.loadSucceeded=!1,this.logger.error(\"loadPlayer succeeded: \".concat(this.loadSucceeded,\": setSource failed: \").concat(h)),this.liveStreamStatistic.registerPlayerLoadFailed(\"setPlayerSource failed\"),[2,{setupSucceeded:this.loadSucceeded,playerSetupError:{errorType:\"SetSourceFailed\",errorMessage:h}}];case 13:return[2]}}))}))},AmpLiveStreamPlayer.prototype.getRenderer=function(){return!this.renderer&&this.playerInstance&&(this.renderer=new S.LiveStreamRenderer(this,this.logger.createChild(\"LiveStreamRenderer\"))),this.renderer},AmpLiveStreamPlayer.prototype.stop=function(){this.destroy()},AmpLiveStreamPlayer.prototype.getPlaybackState=function(){return this.playerState},AmpLiveStreamPlayer.prototype.getCaptionsTimestamp=function(){return this.captionsTimestamp},AmpLiveStreamPlayer.prototype.getCaptionsControl=function(){if(!this.captionsControl&&this.playerInstance){var l=this.liveStreamOptions.supportedSubtitleLanguages?this.liveStreamOptions.supportedSubtitleLanguages.map((function(l){return l.culture})):[];this.captionsControl=new C.CaptionsControl(this.playerInstance,l)}return this.captionsControl},AmpLiveStreamPlayer.prototype.getStreamSize=function(){var l=this.playerInstance?this.playerInstance.getPlayerDiagnosticSnapshot():null;return l?{width:l.mediaWidth,height:l.mediaHeight}:{width:0,height:0}},AmpLiveStreamPlayer.prototype.isRendering=function(){var l=this.getStreamSize();return l.width>0&&l.height>0},AmpLiveStreamPlayer.prototype.ampStateChanged=function(l,d){switch(l){case\"error\":return this.handlePlaybackError(d);case\"canplaythrough\":return this.onCanplaythrough();case\"play\":return this.onPlay();case\"playing\":return this.onPlaying();case\"pause\":return this.onPause();case\"resume\":return this.onResume();case\"start\":return this.onStart();case\"ended\":return this.onEnded();case\"seeking\":return this.onSeeking();case\"seeked\":return this.onSeeked(d);case\"loadedmetadata\":return this.onMetadataLoaded();case\"waiting\":return this.onWaiting();case\"playbackbitratechanged\":return this.onPlaybackBitrateChanged(d);case\"downloadbitratechanged\":return this.onDownloadBitrateChanged(d);case\"fullscreenchange\":return this.onFullscreenChange(d);case\"potentialMediaFreeze\":return this.onPotentialMediaFreeze();case\"mute\":return this.onMute();case\"unmute\":return this.onUnmute();case\"volumechange\":return this.onVolumeChange(d);case\"loadstart\":return this.onLoadStart();case\"loadeddata\":return this.onLoadedData();default:this.logger.warn(\"Unknown amp event \".concat(l))}},AmpLiveStreamPlayer.prototype.captionsToggled=function(l,d,u){this.event(\"captionsToggled\").raise(l,d,u),this.liveStreamStatistic.registerCaptionToggle(l,d,u)},AmpLiveStreamPlayer.prototype.tryLoadSdnPlugin=function(){return h(this,void 0,void 0,(function(){var l,d;return g(this,(function(u){switch(u.label){case 0:if(this.sdnPluginLoadPromise||!this.liveStreamOptions.sdn||!this.configProvider.config.allowSdnPlugins)return[2];switch(this.liveStreamOptions.sdn.name){case\"hive\":case\"kollective\":case\"ramp\":case\"peer5\":break;default:return this.logger.warn(\"unsupported SDN provider: \".concat(this.liveStreamOptions.sdn.name)),this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!1),[2]}u.label=1;case 1:return u.trys.push([1,3,,4]),this.sdnPluginLoadPromise=this.playerInstance.message(\"tryLoadSdnPlugin\").send(),[4,this.sdnPluginLoadPromise];case 2:return u.sent(),[3,4];case 3:return l=u.sent(),d=(0,v.stringifyObject)(l),this.sdnPluginLoadPromise=void 0,this.logger.error(\"loadSdnPlugin failed: \".concat(d)),this.event(\"sdnPluginLoadFailed\").raise(d),[3,4];case 4:return this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!!this.sdnPluginLoadPromise),[2]}}))}))},AmpLiveStreamPlayer.prototype.setPlayerSource=function(l){return h(this,void 0,void 0,(function(){var d,u;return g(this,(function(p){switch(p.label){case 0:if(!this.playerInstance)throw this.logger.error(\"setPlayerSource: playerInstance is null\"),new Error(\"playerInstance is null\");this.logger.info(\"setPlayerSource: AMP source set to: [\".concat(l.url,\"]\")),this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,p.label=1;case 1:return p.trys.push([1,3,,4]),this.logger.info(\"setPlayerSource: src changed\"),this.selectedStreamDetails=l,this.liveStreamStatistic.registerSetSourceAttempt(),[4,this.playerInstance.message(\"setSource\").send(l)];case 2:return p.sent(),this.liveStreamStatistic.registerSetSourceSucceeded(),[3,4];case 3:throw d=p.sent(),u=(0,v.stringifyObject)(d),this.logger.error(\"setPlayerSource: failed with error [\".concat(u,\"]\")),this.liveStreamStatistic.registerSetSourcedFailed(u),d;case 4:return[2]}}))}))},AmpLiveStreamPlayer.prototype.handleStreamInfoUpdate=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){switch(d.label){case 0:return this.loadSucceeded&&l.url!==this.selectedStreamDetails.url?[4,this.setPlayerSource(l)]:[3,2];case 1:return d.sent(),[3,3];case 2:this.loadSucceeded&&this.playerInstance&&this.getCurrentTime()>0&&this.setPlaybackState(\"Start\"),d.label=3;case 3:return[2]}}))}))},AmpLiveStreamPlayer.prototype.switchStreamingUrl=function(l){return h(this,void 0,void 0,(function(){var d,u;return g(this,(function(p){return this.streamingUrlSwitchCount>=this.configProvider.config.streamingUrlSwitchMaxCount||!f.includes(this.configProvider.config.ampErrorCodesEligibleForStreamingUrlSwitch,l)?[2,!1]:(d=this.selectedStreamDetails.url===(this.liveStreamOptions.stream&&this.liveStreamOptions.stream.url),u=d?this.liveStreamOptions.altStream:this.liveStreamOptions.stream,_.isStreamValid(u)?(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,[2,this.setPlayerSource(u).then((function(){return!0})).catch((function(){return!1}))]):(this.logger.error(\"Stream to switch (\".concat(d?\"alternative\":\"primary\",\") is not valid\")),[2,!1]))}))}))},AmpLiveStreamPlayer.prototype.destroy=function(){this.srcLoadPromise=null,this.sdnPluginLoadPromise=null,this.renderer&&(this.renderer.dispose(),this.renderer=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.liveStreamStatistic.registerPlayerDestroyed(),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState(\"Destroyed\"))},AmpLiveStreamPlayer.prototype.getCurrentTime=function(){var l=this.playerInstance?this.playerInstance.getPlayerDiagnosticSnapshot():null;return l&&l.currentPlayPosition||0},AmpLiveStreamPlayer.prototype.onCanplaythrough=function(){this.setPlaybackState(\"Ready\")},AmpLiveStreamPlayer.prototype.onPlay=function(){(this.retryCount>0||this.lastKnownPlayTime)&&(this.logger.info(\"Playing after retry count \".concat(this.retryCount,\", Setting current time to \").concat(this.lastKnownPlayTime)),this.playerInstance.message(\"setPlayTime\").send(this.lastKnownPlayTime),this.retryCount=0,this.lastKnownPlayTime=void 0),this.setPlaybackState(\"Play\")},AmpLiveStreamPlayer.prototype.onPlaying=function(){this.setPlaybackState(\"Playing\")},AmpLiveStreamPlayer.prototype.onPause=function(){this.setPlaybackState(\"Paused\")},AmpLiveStreamPlayer.prototype.onResume=function(){this.setPlaybackState(\"Resume\")},AmpLiveStreamPlayer.prototype.onStart=function(){this.logger.info(\"Playback started, retry count: \".concat(this.retryCount)),this.setPlaybackState(\"Start\"),this.isSwitchStreamingUrlOngoing&&(this.logger.info(\"Playback started, switch count: \".concat(this.streamingUrlSwitchCount)),this.event(\"urlSwitched\").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)},AmpLiveStreamPlayer.prototype.onEnded=function(){this.setPlaybackState(\"Ended\")},AmpLiveStreamPlayer.prototype.onSeeking=function(){this.setPlaybackState(\"Seeking\")},AmpLiveStreamPlayer.prototype.onSeeked=function(l){this.captionsTimestamp=l.captionsTimestamp,this.setPlaybackState(\"Seeked\")},AmpLiveStreamPlayer.prototype.onMetadataLoaded=function(){this.setPlaybackState(\"LoadedMetadata\")},AmpLiveStreamPlayer.prototype.onWaiting=function(){this.setPlaybackState(\"Buffering\")},AmpLiveStreamPlayer.prototype.onLoadedData=function(){this.setPlaybackState(\"LoadedData\")},AmpLiveStreamPlayer.prototype.onLoadStart=function(){this.setPlaybackState(\"LoadStart\")},AmpLiveStreamPlayer.prototype.setPlaybackState=function(l){this.playerState=l,this.logger.debug(\"playback state changed: \".concat(l)),this.liveStreamStatistic.registerPlaybackStateChanged(l),this.event(\"playbackStateChanged\").raise()},AmpLiveStreamPlayer.prototype.onPlaybackBitrateChanged=function(l){this.liveStreamStatistic.registerPlaybackBitratechanged(l.bitrate)},AmpLiveStreamPlayer.prototype.onDownloadBitrateChanged=function(l){this.liveStreamStatistic.registerDownloadBitratechanged(l.bitrate)},AmpLiveStreamPlayer.prototype.onFullscreenChange=function(l){this.logger.debug(\"fullscreenchange, isFullscreen=\".concat(l.isFullscreen)),this.event(\"fullscreenToggled\").raise(l.isFullscreen),this.liveStreamStatistic.registerFullScreenChange(l.isFullscreen)},AmpLiveStreamPlayer.prototype.onPotentialMediaFreeze=function(){this.logger.warn(\"Player detected a potential media freeze\"),this.liveStreamStatistic.registerPotentialMediaFreeze()},AmpLiveStreamPlayer.prototype.onMute=function(){this.liveStreamStatistic.registerMute(!0)},AmpLiveStreamPlayer.prototype.onUnmute=function(){this.liveStreamStatistic.registerMute(!1)},AmpLiveStreamPlayer.prototype.onVolumeChange=function(l){this.liveStreamStatistic.registerVolumeChange(l.value)},AmpLiveStreamPlayer.prototype.handlePlaybackError=function(l){return h(this,void 0,void 0,(function(){var d,u,p,h,m=this;return g(this,(function(g){switch(g.label){case 0:return d=4194307,this.playerState=\"Error\",u=(0,v.stringifyObject)(l),this.logger.info(\"Playback error \".concat(u)),l.errorCode?(l.errorCode&d)===d?(this.isPlaybackUnsupported=!0,this.raisePlaybackError(\"UnsupportedPlatform\",u),this.destroy(),[2]):(this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,p=l.errorCode,h=268435455&p,this.logger.error(\"onError: errorCode: 0x\".concat(p.toString(16),\", errorCodeExcludingTech: 0x\").concat(h.toString(16),\", message: \").concat(l.message)),this.retryCount<this.configProvider.config.maxRetryCount&&-1!==f.indexOf(E,h)?(setTimeout((function(){m.logger.info(\"Retry loading stream because of error code: 0x\".concat(p.toString(16))),m.retryCount++,m.raisePlaybackError(\"PlaybackRetried\",u),m.setPlayerSource(m.selectedStreamDetails)}),this.configProvider.config.sourceResetTimeoutInMs),[3,4]):[3,1]):(this.logger.error(\"onError: error details are not available\"),this.raisePlaybackError(\"Unknown\",u),[2]);case 1:return h===T||l.message&&l.message.includes(T.toString(16))?(this.raisePlaybackError(\"NetworkError\",u),this.destroy(),[3,4]):[3,2];case 2:return[4,this.switchStreamingUrl(h)];case 3:g.sent()||(this.raisePlaybackError(\"PlaybackError\",u),this.destroy()),g.label=4;case 4:return[2]}}))}))},AmpLiveStreamPlayer.prototype.raisePlaybackError=function(l,d){this.liveStreamStatistic.registerPlaybackError(l,d),this.event(\"playbackError\").raise(l,d)},AmpLiveStreamPlayer}(m.default);d.AmpLiveStreamPlayer=b},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.setupHlsAndBuildPipe=d.setupAmpAndBuildPipe=void 0;var g=u(40),f=u(469),m=u(470),v=function(){function PlayerCommunicationDirect(){}return PlayerCommunicationDirect.prototype.sendMsg=function(l){this.peer.onMsg(l)},PlayerCommunicationDirect.prototype.registerObserver=function(l){this.observer=l},PlayerCommunicationDirect.prototype.onMsg=function(l){this.observer&&this.observer.processMessage(l)},PlayerCommunicationDirect.prototype.connect=function(l){this.peer=l},PlayerCommunicationDirect.prototype.dispose=function(){this.peer=null,this.observer=null},PlayerCommunicationDirect}(),y=function(){function IFrameWrapper(l){this.container=l}return Object.defineProperty(IFrameWrapper.prototype,\"contextWindow\",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),IFrameWrapper.prototype.sendMsg=function(l){var d,u;null===(u=null===(d=this.iframe)||void 0===d?void 0:d.contentWindow)||void 0===u||u.postMessage(l,\"*\")},IFrameWrapper.prototype.registerObserver=function(l){this.observer=l},IFrameWrapper.prototype.dispose=function(){this.contextWindow&&this.contextWindow.removeEventListener(\"message\",this.processMsg),this.iframe&&this.container.hasChildNodes()&&this.container.removeChild(this.iframe),this.iframe=null},IFrameWrapper.prototype.initializeAmpIframe=function(l){var d=this.initializeIframe();return this.setAmpIframeContent(l),this.finilizeIframe(d)},IFrameWrapper.prototype.initializeHlsIframe=function(l){var d=this.initializeIframe();return this.setHlsIframeContent(l),this.finilizeIframe(d)},IFrameWrapper.prototype.initializeIframe=function(){var l=g.defer();return this.iframe=this.container.ownerDocument.createElement(\"iframe\"),this.iframe.id=\"player-iframe\",this.iframe.sandbox.add(\"allow-scripts\"),this.iframe.allowFullscreen=!0,this.iframe.allow=\"autoplay\",this.iframe.style.height=\"100%\",this.iframe.style.width=\"100%\",this.iframe.style.border=\"none\",this.iframe.onload=function(){l.resolve()},this.iframe.onerror=function(){l.reject(\"iframe load failed\")},l},IFrameWrapper.prototype.finilizeIframe=function(l){return this.container.appendChild(this.iframe),this.processMsg=this.processMsg.bind(this),this.contextWindow.addEventListener(\"message\",this.processMsg),l.promise},IFrameWrapper.prototype.processMsg=function(l){\"null\"===l.origin&&l.source===this.iframe.contentWindow&&this.observer&&this.observer.processMessage(l.data)},IFrameWrapper.prototype.setAmpIframeContent=function(l){var d=(0,f.buildAmpEmbededSrc)(),u=l?\"<script nonce='\".concat(l,\"'> \").concat(d,\"<\\/script>\"):\"<script> \".concat(d,\"<\\/script>\"),p=\"\\n            <html class style='height: 100%; width: 100%; overflow: hidden'>\\n            <head></head>\\n            <body class style='height: 100%; width: 100%; margin: 0px'>\\n                \".concat(u,\"\\n            </body>\\n            </html>\\n        \");this.iframe.srcdoc=p},IFrameWrapper.prototype.setHlsIframeContent=function(l){var d=(0,m.buildHlsEmbededSrc)(),u=l?\"<script nonce='\".concat(l,\"'> \").concat(d,\"<\\/script>\"):\"<script> \".concat(d,\"<\\/script>\"),p=\"\\n            <html class style='height: 100%; width: 100%; overflow: hidden'>\\n            <head></head>\\n            <body class style='height: 100%; width: 100%; margin: 0px'>\\n                \".concat(u,\"\\n            </body>\\n            </html>\\n        \");this.iframe.srcdoc=p},IFrameWrapper}();function setupAmpAndBuildPipe(l,d,u){return p(this,void 0,void 0,(function(){var p,g,m;return h(this,(function(h){switch(h.label){case 0:return 0===d?(p=new v,g=new v,p.connect(g),g.connect(p),g.registerObserver(new f.AmpCommunicationHandler(g,l)),[2,p]):1!==d?[3,2]:[4,(m=new y(l)).initializeAmpIframe(u)];case 1:return h.sent(),[2,m];case 2:throw new Error(\"Unsupported communication type \".concat(d))}}))}))}function setupHlsAndBuildPipe(l,d,u){return p(this,void 0,void 0,(function(){var p,g,f;return h(this,(function(h){switch(h.label){case 0:return 0===d?(p=new v,g=new v,p.connect(g),g.connect(p),g.registerObserver(new m.HlsCommunicationHandler(g,l)),[2,p]):1!==d?[3,2]:[4,(f=new y(l)).initializeHlsIframe(u)];case 1:return h.sent(),[2,f];case 2:throw new Error(\"Unsupported communication type \".concat(d))}}))}))}d.setupAmpAndBuildPipe=setupAmpAndBuildPipe,d.setupHlsAndBuildPipe=setupHlsAndBuildPipe},function(l,d,u){function AmpPlayerF(){var l=AmpDiagnosticProviderF(),d=CaptionsControlToggleProviderF();return function(){function AmpPlayer(l,d){this.container=l,this.eventsHandler=d,this.playerEvents=[],this.maxMemoryTraceLogCount=1e4,this.videoSourceType=\"application/dash+xml\",this.sdnPluginLoaded=!1,this.statsTimer=-1,this.statsInterval=1e3}return Object.defineProperty(AmpPlayer.prototype,\"contextWindow\",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),AmpPlayer.prototype.configure=function(l,d){this.liveStreamOptions=l,this.configProvider=d,this.statsInterval=d.config.playerTelemetryTickMs||this.statsInterval,this.maxMemoryTraceLogCount=d.config.maxPlayerMemoryTraceLogCount||this.maxMemoryTraceLogCount},AmpPlayer.prototype.loadPlayerScript=function(){var l=this;this.log(\"loadPlayerScript started\");for(var d=Promise.resolve(),u=this.configProvider.playerConfig.nonce,p=this.configProvider.playerConfig.css,_loop_1=function(h){d=d.then((function(){return l.loadCss(l.container.ownerDocument,p[h],u)}))},h=0;h<p.length;h++)_loop_1(h);var g=this.configProvider.playerConfig.src,_loop_2=function(p){d=d.then((function(){return l.loadScript(l.container.ownerDocument,g[p],u)}))};for(h=0;h<g.length;h++)_loop_2(h);return d},AmpPlayer.prototype.tryLoadSdnPlugin=function(){var l=this;return this.sdnPluginLoaded||!this.liveStreamOptions.sdn?Promise.resolve():this.configProvider.config.allowSdnPlugins?(this.log(\"tryLoadSdnPlugin started\"),this.loadScript(this.container.ownerDocument,this.liveStreamOptions.sdn.url,this.configProvider.playerConfig.nonce).then((function(){l.sdnPluginLoaded=!0,l.log(\"tryLoadSdnPlugin done\")}))):(this.log(\"Loading SDN plugins is not allowed\"),Promise.reject(\"Loading SDN plugins is not allowed\"))},AmpPlayer.prototype.createAmp=function(){this.log(\"createAmp started\"),this.createVideoElement();var u=this.getAmpOptions();if(this.playerInstance=this.contextWindow.amp(this.video.id,u),!this.playerInstance)throw this.log(\"createAmp failed\",\"error\"),new Error(\"playerInstance is null\");this.diagnosticProvider=new l(this.playerInstance,this.contextWindow);var p={isOverflow:this.liveStreamOptions.overflow,logFn:this.log.bind(this),removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack};this.captionsControl=new d(this.playerInstance,this,p),this.registerPlayerEvents(),this.log(\"createAmp done\")},AmpPlayer.prototype.setSource=function(l){if(this.log(\"setSource started\"),!this.playerInstance)throw this.log(\"setSource failed: playerInstance is null\",\"error\"),new Error(\"playerInstance is null\");var d={src:l.url,type:this.videoSourceType,protectionInfo:l.decryptionToken?[{type:\"AES\",authenticationToken:l.decryptionToken}]:null};this.configureSdnSource(d,l),this.playerInstance.src([d],this.getTextTracks()),this.log(\"setSource done\")},AmpPlayer.prototype.setPlayTime=function(l){l&&(this.log(\"setPlayerTime: \".concat(l)),this.playerInstance.currentTime(l))},AmpPlayer.prototype.dispose=function(){this.log(\"dispose started\"),this.diagnosticProvider&&(this.stopStatsColletion(),this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.captionsControl&&(this.captionsControl.dispose(),this.captionsControl=null),this.playerInstance&&(this.removeEventListeners(),this.playerInstance.getMemoryLog(!0),this.playerInstance.dispose(),this.playerInstance=null),this.eventsHandler.ampDisposed(),this.video&&this.video.parentNode&&(this.video.parentNode.removeChild(this.video),this.video=null),this.log(\"dispose done\"),this.eventsHandler=null},AmpPlayer.prototype.showCaptions=function(l){this.log(\"showCaptions: \".concat(l)),this.captionsControl.showCaptions(l)},AmpPlayer.prototype.addCues=function(l){l=l.filter((function(l){return l.text&&0!==l.text.trim().length})),this.captionsControl.addCues(l)},AmpPlayer.prototype.clearCues=function(){this.captionsControl.clearCues()},AmpPlayer.prototype.captionsToggled=function(l,d,u){this.log(\"captionsToggled: \".concat(l,\" for culture \").concat(d,\" at \").concat(u)),this.eventsHandler.message(\"captionsToggled\").send(l,d,u)},AmpPlayer.prototype.createVideoElement=function(){this.log(\"createVideoElement started\"),this.video=this.container.ownerDocument.createElement(\"video\"),this.video.id=\"amp-player\",this.video.setAttribute(\"playsinline\",\"\");var l=this.configProvider.playerConfig.lang;l&&(this.video.setAttribute(\"lang\",l),this.log(\"createVideoElement: language set to \".concat(l)));for(var d=this.configProvider.playerConfig.styles,u=0;u<d.length;u++)this.video.classList.add(d[u]);this.container.appendChild(this.video),this.log(\"createVideoElement done\")},AmpPlayer.prototype.getAmpOptions=function(){var l=[];this.configProvider.config.debug?l.push({target:\"memory\",maxMemoryTraceCount:this.maxMemoryTraceLogCount}):l.push({target:\"console\"});var d={TraceTargets:l,maxLogLevel:this.configProvider.config.debug?3:2},u={techOrder:this.configProvider.config.techOrder,nativeControlsForTouch:!1,autoplay:!0,preload:\"auto\",controls:!this.liveStreamOptions.overflow,logo:{enabled:!1},height:\"100%\",width:\"100%\",traceConfig:d,disableFullscreenButton:this.configProvider.playerConfig.disableFullscreenButton,staleDataTimeLimitInSec:this.configProvider.config.staleDataTimeLimitInSec,heuristicProfile:this.contextWindow.amp.Player.HeuristicProfile.HighQuality,customPlayerSettings:{customHeuristicSettings:{bandwidthTestWithTimeThresholdDuringLive:!1,windowSizeHeuristics:this.configProvider.config.useBrowserWindowSizeForBitRate,useBrowserWindowForWindowSizeRule:this.configProvider.config.useBrowserWindowSizeForBitRate,useVariableFragmentSizeMode:!0}},plugins:{}};return this.initializePluginOptions(u),u},AmpPlayer.prototype.isStreamValid=function(l){return l&&!!l.url&&!!l.decryptionToken},AmpPlayer.prototype.initializePluginOptions=function(l){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn){var d=this.liveStreamOptions.correlationId,u=this.isStreamValid(this.liveStreamOptions.stream)?this.liveStreamOptions.stream:this.liveStreamOptions.altStream;try{switch(this.liveStreamOptions.sdn.name){case\"hive\":return void(l.plugins={hive:{debugLevel:this.configProvider.config.debug?\"debug\":\"notice\",telemetryId:d}});case\"kollective\":return void(u.sdnContext&&(l.plugins={kollectiveSDN:{playbackInfo:this.parseJson(u.sdnContext,\"kollective sdn context\"),reportSessionId:d}}));case\"ramp\":return void(u.sdnContext&&(l.plugins={RampMOPlugin:this.parseJson(u.sdnContext,\"ramp sdn context\")},this.configProvider.config.debug&&(l.plugins.RampMOPlugin.verbose=!0)));case\"peer5\":return void(u.sdnContext&&(l.plugins={peer5:this.parseJson(u.sdnContext,\"peer5 sdn context\")}));default:return}}catch(l){this.log(\"initializePluginOptions failed, error: \".concat(l),\"error\")}}},AmpPlayer.prototype.getTextTracks=function(){var l=[];if(this.liveStreamOptions.overflow)l.push({id:\"amp-player_default\",kind:\"captions\",label:\"default-text-track\",src:\"\",srclang:\"\"});else if(this.liveStreamOptions.supportedSubtitleLanguages)for(var d=this.liveStreamOptions.supportedSubtitleLanguages,u=0;u<d.length;u++)l.push({id:\"amp-player_\".concat(d[u].culture),kind:this.configProvider.config.textTrackKind,label:d[u].name||d[u].culture,src:\"\",srclang:d[u].culture.substr(0,2)});return l},AmpPlayer.prototype.configureSdnSource=function(l,d){if(this.sdnPluginLoaded&&this.liveStreamOptions.sdn)try{switch(this.liveStreamOptions.sdn.name){case\"hive\":d.sdnContext?l.sdnList=[{sdnName:\"hive\",sdnUrl:d.sdnContext}]:l.sdnList=[];break;case\"kollective\":d.sdnContext?l.sdnList=[{sdnName:\"kollectiveSDN\",playbackInfo:this.parseJson(d.sdnContext,\"kollective sdn list context\")}]:l.sdnList=[];break;case\"ramp\":case\"peer5\":l.sdnList=[];break;default:return}}catch(d){l.sdnList=[],this.log(\"configureSdnSource failed, error: \".concat(d),\"error\")}},AmpPlayer.prototype.registerPlayerEvents=function(){var l=this;this.registerPlayerEvent(this.contextWindow.amp.eventName.error,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.error)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.canplaythrough,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.canplaythrough)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.play,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.play)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.playing,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.playing)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.pause,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.pause)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.resume,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.resume)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.start,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.start)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.ended,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.ended)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeking,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.seeking)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.seeked,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.seeked)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadedmetadata,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.loadedmetadata)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.waiting,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.waiting)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.playbackbitratechanged,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.playbackbitratechanged)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.downloadbitratechanged,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.downloadbitratechanged)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.fullscreenchange,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.fullscreenchange)})),this.registerPlayerEvent(\"potentialMediaFreeze\",(function(){l.onAmpEvent(\"potentialMediaFreeze\")})),this.registerPlayerEvent(this.contextWindow.amp.eventName.mute,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.mute)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.unmute,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.unmute)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.volumechange,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.volumechange)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadeddata,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.loadeddata)})),this.registerPlayerEvent(this.contextWindow.amp.eventName.loadstart,(function(){l.onAmpEvent(l.contextWindow.amp.eventName.loadstart)}))},AmpPlayer.prototype.registerPlayerEvent=function(l,d){this.playerEvents.push(l),this.playerInstance.addEventListener(l,d)},AmpPlayer.prototype.removeEventListeners=function(){var l=this;this.playerEvents.forEach((function(d){l.playerInstance.removeEventListener(d)}))},AmpPlayer.prototype.onAmpEvent=function(l){var d,u;switch(l){case this.contextWindow.amp.eventName.error:u=this.playerInstance.error(),d={currentTime:this.playerInstance.currentTime(),errorCode:u?u.code:0,message:u?u.message:\"\"};break;case this.contextWindow.amp.eventName.canplaythrough:this.initializeStatsColletion();break;case this.contextWindow.amp.eventName.loadedmetadata:this.captionsControl.initialize();break;case this.contextWindow.amp.eventName.fullscreenchange:d={isFullscreen:this.playerInstance.isFullscreen()};break;case this.contextWindow.amp.eventName.playbackbitratechanged:d={bitrate:this.playerInstance.currentPlaybackBitrate()};break;case this.contextWindow.amp.eventName.downloadbitratechanged:d={bitrate:this.playerInstance.currentDownloadBitrate()};break;case this.contextWindow.amp.eventName.seeked:d={captionsTimestamp:this.liveStreamOptions.overflow?this.playerInstance.currentMediaTime():this.playerInstance.currentTime()};break;case this.contextWindow.amp.eventName.volumechange:d={value:this.playerInstance.volume()}}this.eventsHandler.message(\"statsUpdated\").send(this.getPlayerDiagnostics()),this.eventsHandler.message(\"stateChanged\").send(l,d)},AmpPlayer.prototype.initializeStatsColletion=function(){var l=this;this.diagnosticProvider.initialize(),this.statsTimer=window.setInterval((function(){l.eventsHandler&&l.eventsHandler.message(\"statsUpdated\").send(l.getPlayerDiagnostics())}),this.statsInterval)},AmpPlayer.prototype.stopStatsColletion=function(){this.eventsHandler.message(\"statsUpdated\").send(this.getPlayerDiagnostics()),-1!==this.statsTimer&&window.clearInterval(this.statsTimer),this.statsTimer=-1},AmpPlayer.prototype.getPlayerDiagnostics=function(){var l=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return l.statsInterval=this.statsInterval,this.configProvider.config.debug&&(l.memoryLog=this.playerInstance.getMemoryLog(!0)),l},AmpPlayer.prototype.log=function(l,d){void 0===d&&(d=\"info\");var u=\"[AmpPlayer\".concat(1===this.configProvider.config.loadType?\"IFrame\":\"\",\"]\"),p=\"\".concat(u,\": \").concat(l);this.configProvider.config.debug&&console.log(p),this.eventsHandler.message(\"log\").send(d,p)},AmpPlayer.prototype.getElementLoadPromise=function(l){return new Promise((function(d,u){l.onload=function(){d()},l.onerror=function(l){u(l)}}))},AmpPlayer.prototype.loadScript=function(l,d,u){var p=l.createElement(\"script\"),h=this.getElementLoadPromise(p);return p.src=d,u&&(p.nonce=u),l.head.appendChild(p),h},AmpPlayer.prototype.loadCss=function(l,d,u){var p=l.createElement(\"link\"),h=this.getElementLoadPromise(p);return p.href=d,p.rel=\"stylesheet\",u&&(p.nonce=u),l.head.appendChild(p),h},AmpPlayer.prototype.parseJson=function(l,d){try{return JSON.parse(l)}catch(l){throw this.log(\"Error parsing JSON for \".concat(d,\", error: \").concat(JSON.stringify(l))),l}},AmpPlayer}()}function AmpCommunicationHandlerF(){var l=AmpPlayerF();return function(){function AmpCommunicationHandler(d,u){this.pipe=d,this.amp=new l(u,this)}return AmpCommunicationHandler.prototype.processMessage=function(l){var d=this;\"Command\"===l.msgType&&Promise.resolve().then((function(){return d.amp[l.cmd].apply(d.amp,l.args)})).catch((function(l){return l})).then((function(u){d.pipe&&d.pipe.sendMsg({msgType:\"CommandResult\",cmd:l.cmd,error:u})}))},AmpCommunicationHandler.prototype.message=function(l){var d=this;return{send:this.fromMessage((function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];d.sendMessageImpl(l,u)}))}},AmpCommunicationHandler.prototype.ampDisposed=function(){this.pipe.dispose(),this.pipe=null,this.amp=null},AmpCommunicationHandler.prototype.fromMessage=function(l){return l},AmpCommunicationHandler.prototype.sendMessageImpl=function(l,d){this.pipe.sendMsg({msgType:\"PlayerNotification\",name:l,args:d})},AmpCommunicationHandler}()}function IFrameMessageHandlerF(){function isCmdResult(l){return\"CommandResult\"===l.msgType}function getErrorString(l){var d=\"unknown\";try{d=\"string\"==typeof l?l:\"toString\"in l&&0!==l.toString().indexOf(\"[object\")?l.toString():JSON.stringify(l)}catch(d){console.error(\"Failed to stringify error\",l)}return d}return function(){function IFrameMessageHandler(){this.processMsg=this.processMsg.bind(this),window.addEventListener(\"message\",this.processMsg)}return IFrameMessageHandler.prototype.sendMsg=function(l){try{var d=l;isCmdResult(l)&&l.error instanceof Event&&(console.debug(\"Stringifying error Event before trying to postMessage:\",l),d={msgType:l.msgType,cmd:l.cmd,error:\"Event: \".concat(getErrorString(l.error))}),this.postMessage(d)}catch(d){console.error(\"Unexpected exception caught from postMessage.\\n\",\"message:\",l,\"\\n\",\"exception:\",d);var u={msgType:\"PlayerNotification\",name:\"log\",args:[\"error\",\"Unexpected error with postMessage: \".concat(getErrorString(d))]};throw this.postMessage(u),d}},IFrameMessageHandler.prototype.registerObserver=function(l){this.observer=l},IFrameMessageHandler.prototype.dispose=function(){window.removeEventListener(\"message\",this.processMsg),this.observer=null},IFrameMessageHandler.prototype.processMsg=function(l){this.observer.processMessage(l.data)},IFrameMessageHandler.prototype.postMessage=function(l){window.parent.postMessage(l,\"*\")},IFrameMessageHandler}()}function AmpDiagnosticProviderF(){return function(){function AmpDiagnosticProvider(l,d){this.playerInstance=l,this.contextWindow=d,this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailures=[],this.videoDownloadFailures=[],this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=30,this.downloadFailuresLimit=10,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}return AmpDiagnosticProvider.prototype.initialize=function(){this.playerVideoBuffer=this.playerInstance.videoBufferData(),this.playerAudioBuffer=this.playerInstance.audioBufferData(),this.registerForPlayerBufferEvents()},AmpDiagnosticProvider.prototype.getPlayerDiagnosticSnapshot=function(){var l,d;if(!this.playerInstance)return null;var u=window.screen,p=this.playerInstance.error(),mean=function(l){var d=l.slice().sort();return d[Math.floor(d.length/2)]};return{errorCode:p&&p.code||0,currentPlayPosition:this.playerInstance.currentTime(),currentMediaTime:null!==(l=this.playerInstance.currentMediaTime())&&void 0!==l?l:this.playerInstance.currentTime(),currentAbsoluteTime:null!==(d=this.playerInstance.currentAbsoluteTime())&&void 0!==d?d:this.playerInstance.currentTime(),livePosition:this.playerInstance.duration(),playbackBitrate:this.playerInstance.currentPlaybackBitrate(),downloadBitrate:this.playerInstance.currentDownloadBitrate(),perceivedBandwidth:this.playerVideoBuffer?this.playerVideoBuffer.perceivedBandwidth:0,tech:this.playerInstance.currentTechName(),playerVersion:this.playerInstance.getAmpVersion(),isP2PSdnUsed:this.isP2PSdnUsed(),sdnName:this.sdnName(),heuristicProfile:this.playerInstance.currentHeuristicProfile(),encryption:this.playerInstance.currentProtectionInfo()?this.playerInstance.currentProtectionInfo().type:\"\",streamType:this.playerInstance.isLive()?\"LIVE\":\"DVR\",audioStream:this.getAudioStreamData(),videoStream:this.getVideoStreamData(),muted:this.playerInstance.muted(),volume:this.playerInstance.volume(),audioBufferLength:this.playerAudioBuffer?this.playerAudioBuffer.bufferLevel:0,videoBufferLength:this.playerVideoBuffer?this.playerVideoBuffer.bufferLevel:0,mediaHeight:this.playerInstance.videoHeight(),mediaWidth:this.playerInstance.videoWidth(),playerHeight:this.playerInstance.height(),playerWidth:this.playerInstance.width(),windowWidth:u?u.width:0,windowHeight:u?u.height:0,isFullscreen:this.playerInstance.isFullscreen(),avgAudioDownloadLatency:mean(this.audioDownloadLatencies),avgVideoDownloadLatency:mean(this.videoDownloadLatencies),avgAudioDownloadBytes:mean(this.audioDownloadBytes),avgVideoDownloadBytes:mean(this.videoDownloadBytes),maxVideoDownloadBytes:Math.max.apply(null,this.videoDownloadBytes),minVideoDownloadBytes:Math.min.apply(null,this.videoDownloadBytes),audioDownloadFailureCount:this.audioDownloadFailureCount,audioDownloadSuccessCount:this.audioDownloadSuccessCount,videoDownloadFailureCount:this.videoDownloadFailureCount,videoDownloadSuccessCount:this.videoDownloadSuccessCount,audioDownloadFailures:this.audioDownloadFailures,videoDownloadFailures:this.videoDownloadFailures}},AmpDiagnosticProvider.prototype.dispose=function(){this.unsubscribeFromPlayerBufferEvents()},AmpDiagnosticProvider.prototype.registerForPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.addEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},AmpDiagnosticProvider.prototype.unsubscribeFromPlayerBufferEvents=function(){this.playerVideoBuffer&&(this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onVideoDownloadCompleted),this.playerVideoBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onVideoDownloadError)),this.playerAudioBuffer&&(this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadcompleted,this.onAudioDownloadCompleted),this.playerAudioBuffer.removeEventListener(this.contextWindow.amp.bufferDataEventName.downloadfailed,this.onAudioDownloadError))},AmpDiagnosticProvider.prototype.isP2PSdnUsed=function(){return!!this.sdnName()},AmpDiagnosticProvider.prototype.sdnName=function(){var l=\"options_\";return this.playerInstance[l]&&this.playerInstance[l].sdn&&this.playerInstance[l].sdn.name},AmpDiagnosticProvider.prototype.onVideoDownloadCompleted=function(){this.videoDownloadSuccessCount++,this.addToList(this.videoDownloadLatencies,this.playerVideoBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.videoDownloadBytes,this.playerVideoBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes)},AmpDiagnosticProvider.prototype.onAudioDownloadCompleted=function(){this.audioDownloadSuccessCount++,this.addToList(this.audioDownloadLatencies,this.playerAudioBuffer.downloadCompleted.totalDownloadMs,this.slidingWindowLengthForLatency),this.addToList(this.audioDownloadBytes,this.playerAudioBuffer.downloadCompleted.totalBytes,this.slidingWindowLengthForDownloadBytes)},AmpDiagnosticProvider.prototype.addToList=function(l,d,u){l.push(d),l.length>u&&l.shift()},AmpDiagnosticProvider.prototype.onVideoDownloadError=function(){this.videoDownloadFailureCount++,this.addDownloadFailureInfo(this.playerVideoBuffer.downloadFailed,this.videoDownloadFailures)},AmpDiagnosticProvider.prototype.onAudioDownloadError=function(){this.audioDownloadFailureCount++,this.addDownloadFailureInfo(this.playerAudioBuffer.downloadFailed,this.audioDownloadFailures)},AmpDiagnosticProvider.prototype.addDownloadFailureInfo=function(l,d){var u={bitrate:l.mediaDownload.bitrate,errorCode:l.code,mediaTime:l.mediaDownload.mediaTime,message:l.message,timestamp:Date.now()};this.addToList(d,u,this.downloadFailuresLimit)},AmpDiagnosticProvider.prototype.getAudioStreamData=function(){var l=this.playerInstance.currentAudioStreamList();if(l)try{var d=l.streams[l.enabledIndices[0]];return{bitrate:d.bitrate,codec:d.codec,enabled:d.enabled,name:d.name,language:d.language}}catch(l){return}},AmpDiagnosticProvider.prototype.getVideoStreamData=function(){var l=this.playerInstance.currentVideoStreamList();if(l)try{var d=l.streams[l.selectedIndex],u=this.playerInstance.currentPlaybackBitrate(),mapTrackData=function(l){return{bitrate:l.bitrate,codec:l.codec,height:l.height,id:l.id,selectable:l.selectable,width:l.width}},p=d.tracks?d.tracks.map(mapTrackData).find((function(l){return l.bitrate===u})):null;return{codec:d.codec,name:d.name,currentTrack:p}}catch(l){return}},AmpDiagnosticProvider}()}function CaptionsControlToggleProviderF(){return function(){function CaptionsControlToggleProvider(l,d,u){var p;this.player=l,this.toggleListener=d,this.config=u,this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.isHtml5Tech=\"html5\"===(null===(p=this.player.currentTechName())||void 0===p?void 0:p.toLowerCase())}return CaptionsControlToggleProvider.prototype.dispose=function(){this.unsubscribeFromTrackEvents(),this.player=null,this.toggleListener=null},CaptionsControlToggleProvider.prototype.initialize=function(){var l=this.getPlayerTextTracksAsArray();if(this.config.isOverflow)l[0].mode=\"showing\";else for(var d=0;d<l.length;d++)l[d].mode=\"disabled\";this.subscribeOnTrackEvents()},CaptionsControlToggleProvider.prototype.addCues=function(l){var d=this.player.getCurrentTextTrack();if(d)for(var u=this.isHtml5Tech?this.getCurrentTime():this.player.currentAbsoluteTime()||1,p=this.getCurrentTime(),h=this.config.isOverflow?Math.max(u-p,0):u-p,g=this.isHtml5Tech?window.VTTCue:window.vttjs&&window.vttjs.VTTCue||window.VTTCue,f=0;f<l.length;f++){var m=l[f],v=m.start,y=m.end,S=m.text,_=6,C=new g(Number((v+h).toFixed(_)),Number((y+h).toFixed(_)),S);C.size=100,!this.containsCue(d,C)&&d.addCue(C)}},CaptionsControlToggleProvider.prototype.clearCues=function(){var l=this.player.getCurrentTextTrack();if(l)try{var d=\"setCues_\";if(l.cues[d]){l.cues_&&(l.cues_.length=0),l.cues[d]([]);for(var u=Object.getOwnPropertyNames(l.cues),p=0;p<u.length;p++)\"length\"!==u[p]&&\"length_\"!==u[p]&&\"cues_\"!==u[p]&&delete l.cues[u[p]]}}catch(l){}},CaptionsControlToggleProvider.prototype.showCaptions=function(l){this.config.logFn(\"[CaptionsControl]: showCaptions(\".concat(l,\")\")),l?this.show():this.hide()},CaptionsControlToggleProvider.prototype.hide=function(){this.previouslyVisibleTextTrack=this.player.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode=\"disabled\"),this.player.captionToggle&&this.player.captionToggle.hide&&this.player.captionToggle.hide(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.hide&&this.player.MoreOptionscaptionSubtitleButton.hide(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.hide&&this.player.MoreOptionscaptionSettingsButton.hide()},CaptionsControlToggleProvider.prototype.show=function(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode=\"showing\"),this.player.captionToggle&&this.player.captionToggle.show&&this.player.captionToggle.show(),this.player.MoreOptionscaptionSubtitleButton&&this.player.MoreOptionscaptionSubtitleButton.show&&this.player.MoreOptionscaptionSubtitleButton.show(),this.player.MoreOptionscaptionSettingsButton&&this.player.MoreOptionscaptionSettingsButton.show&&this.player.MoreOptionscaptionSettingsButton.show()},CaptionsControlToggleProvider.prototype.subscribeOnTrackEvents=function(){var l=this.player.textTracks(),d=\"addEventListener\";l&&l[d]&&(l[d](\"change\",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&l[d](\"addtrack\",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.unsubscribeFromTrackEvents=function(){var l=this.player.textTracks(),d=\"removeEventListener\";l&&l[d]&&(l[d](\"change\",this.onTextTrackChanged),this.isHtml5Tech&&this.config.removeEmptyDefaultTextTrack&&l[d](\"addtrack\",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.onTextTrackChanged=function(){var l=this.player.getCurrentTextTrack();if(!l||!this.currentTextTrack||this.currentTextTrack.label!==l.label||this.currentTextTrack.mode!==l.mode){if(l||this.currentTextTrack){var d=!!l&&\"showing\"===l.mode,u=this.getCulture(l||this.currentTextTrack),p=this.getCurrentTime();this.toggleListener.captionsToggled(d,u,p),this.config.logFn(\"[CaptionsControl]: track changed: culture '\".concat(u,\"', timestamp '\").concat(p,\"'\"))}this.currentTextTrack=l}},CaptionsControlToggleProvider.prototype.onAddTrack=function(l){var d,u,p=null==l?void 0:l.track;\"captions\"===(null==p?void 0:p.kind)&&!p.label&&!p.id&&(null===(u=null===(d=this.player)||void 0===d?void 0:d.textTracks_)||void 0===u||u.removeTrack_(p),this.config.logFn(\"[CaptionsControl]: removing default empty text track\"))},CaptionsControlToggleProvider.prototype.getCurrentTime=function(){return this.isHtml5Tech?this.player.currentTime():(this.config.isOverflow?this.player.currentMediaTime():this.player.currentTime())||1},CaptionsControlToggleProvider.prototype.getCulture=function(l){if(!l)return\"\";if(l.id){var d=l.id.split(\"_\")[1];if(d)return d}return\"\"},CaptionsControlToggleProvider.prototype.getPlayerTextTracksAsArray=function(){var l=this.player.textTracks();return l&&l[\"tracks_\"]||[]},CaptionsControlToggleProvider.prototype.containsCue=function(l,d){var u=this;return Array.from((null==l?void 0:l.cues)||[]).some((function(l){return u.areCueEquals(l,d)}))},CaptionsControlToggleProvider.prototype.areCueEquals=function(l,d){function getCueField(l){return{start:l.start?l.start:l.startTime,end:l.end?l.end:l.endTime,text:l.text}}var u=getCueField(l),p=getCueField(d);return u.start===p.start&&u.end===p.end&&u.text===p.text},CaptionsControlToggleProvider}()}function initIFrame(){var l=IFrameMessageHandlerF(),d=AmpCommunicationHandlerF(),u=new l,p=new d(u,document.body);u.registerObserver(p)}function buildAmpEmbededSrc(){var l=\"(\".concat(initIFrame.toString(),\")();\");return l+=AmpPlayerF.toString()+\";\",l+=IFrameMessageHandlerF.toString()+\";\",l+=AmpCommunicationHandlerF.toString()+\";\",l+=CaptionsControlToggleProviderF.toString()+\";\",l+=AmpDiagnosticProviderF.toString()+\";\",l+=\"//# sourceURL=TsCallingAmpPlayer.js\"}Object.defineProperty(d,\"__esModule\",{value:!0}),d.buildAmpEmbededSrc=d.CaptionsControlToggleProvider=d.AmpDiagnosticProvider=d.IFrameMessageHandler=d.AmpCommunicationHandler=d.AmpPlayer=void 0,d.AmpPlayer=AmpPlayerF(),d.AmpCommunicationHandler=AmpCommunicationHandlerF(),d.IFrameMessageHandler=IFrameMessageHandlerF(),d.AmpDiagnosticProvider=AmpDiagnosticProviderF(),d.CaptionsControlToggleProvider=CaptionsControlToggleProviderF(),d.buildAmpEmbededSrc=buildAmpEmbededSrc},function(l,d,u){function HlsPlayerF(){var l=HlsDiagnosticProviderF(),d=CaptionsControlToggleProviderF(),u=HlsMediaF(),p=Html5MediaF();return function(){function HlsPlayer(l,d){this.container=l,this.eventsHandler=d,this.maxMemoryTraceLogCount=1e4,this.sdnLoaded=!1,this.statsTimer=-1,this.statsInterval=1e3,this.nextScheduledCurrentTimeUpdate=Date.now(),this.nextScheduledSwitchingUrlTime=Date.now(),this.lastRecoveryWasTimeUpdate=!1}return Object.defineProperty(HlsPlayer.prototype,\"contextWindow\",{get:function(){return this.container.ownerDocument.defaultView},enumerable:!1,configurable:!0}),HlsPlayer.prototype.configure=function(l,d){this.liveStreamOptions=l,this.configProvider=d,this.statsInterval=d.config.playerTelemetryTickMs||this.statsInterval,this.maxMemoryTraceLogCount=d.config.maxPlayerMemoryTraceLogCount||this.maxMemoryTraceLogCount},HlsPlayer.prototype.loadPlayerScript=function(){var l=this;this.log(\"loadPlayerScript started\");for(var d=Promise.resolve(),u=this.configProvider.playerConfig.nonce,p=this.configProvider.playerConfig.css,_loop_1=function(h){d=d.then((function(){return l.loadCss(l.container.ownerDocument,p[h],u)}))},h=0;h<p.length;h++)_loop_1(h);var g=this.configProvider.playerConfig.src,_loop_2=function(p){d=d.then((function(){return l.loadScript(l.container.ownerDocument,g[p],u)}))};for(h=0;h<g.length;h++)_loop_2(h);return d},HlsPlayer.prototype.tryLoadSdnPlugin=function(){var l=this;if(this.sdnLoaded||!this.liveStreamOptions.sdn)return Promise.resolve();if(!this.configProvider.config.allowSdnPlugins)return this.log(\"Loading SDN plugins is not allowed\"),Promise.reject(\"Loading SDN plugins is not allowed\");Promise.resolve();return this.log(\"tryLoadSdn started\"),this.loadScript(this.container.ownerDocument,this.liveStreamOptions.sdn.url,this.configProvider.playerConfig.nonce).then((function(){return l.log(\"SDN script loaded\"),l.loadScript(l.container.ownerDocument,l.liveStreamOptions.sdn.plugin,l.configProvider.playerConfig.nonce).then((function(){l.log(\"SDN plugin loaded\"),l.sdnLoaded=!0,l.log(\"tryLoadSdn done\")}))}))},HlsPlayer.prototype.createHls=function(){if(this.log(\"createHls started\"),this.contextWindow.define=this.tempDefine,this.createVideoElement(),this.contextWindow.Hls.isSupported())this.media=new u(this.video,this.contextWindow,this.log.bind(this),this.getHlsConfig());else{if(!this.video.canPlayType(\"application/vnd.apple.mpegurl\")){var h=\"Your browser cannot support HLS streaming\";throw this.log(\"Error: \".concat(h),\"error\"),new Error(h)}this.media=new p(this.video,this.log.bind(this))}this.diagnosticProvider=new l(this.media.getPlayer(),this.contextWindow,this.video),this.addCaptionsTracks(this.liveStreamOptions.supportedSubtitleLanguages);var g={isOverflow:this.liveStreamOptions.overflow,logFn:this.log.bind(this),removeEmptyDefaultTextTrack:this.configProvider.config.removeEmptyDefaultTextTrack};this.captionsControl=new d(this.video,this,g),this.addFullScreenListener(),this.registerMediaEvents(),this.initialState=!0,this.log(\"createHls done\")},HlsPlayer.prototype.setSource=function(l){if(this.log(\"setSource started\"),!this.media)throw this.log(\"setSource failed: playerInstance is null\",\"error\"),new Error(\"playerInstance is null\");this.media.setSource(l)},HlsPlayer.prototype.switchStreamingUrl=function(l){if(this.video.readyState>2)this.log(\"Not switching as video is building\",\"warn\");else{if(!this.media)throw this.log(\"setSource failed: playerInstance is null\",\"error\"),new Error(\"playerInstance is null\");this.media.switchStreamingUrl(l)}},HlsPlayer.prototype.setPlayTime=function(l){l&&(this.log(\"setPlayerTime: \".concat(l)),this.video.currentTime=l)},HlsPlayer.prototype.dispose=function(){this.log(\"dispose started\"),this.diagnosticProvider&&(this.stopStatsColletion(),this.diagnosticProvider.dispose(),this.diagnosticProvider=null),this.media&&(this.media.destroy(),this.media=null),this.eventsHandler.hlsDisposed(),this.video&&this.video.parentNode&&(this.video.parentNode.removeChild(this.video),this.video=null),this.log(\"dispose done\"),this.eventsHandler=null},HlsPlayer.prototype.showCaptions=function(l){this.log(\"showCaptions: \".concat(l)),this.captionsControl.showCaptions(l)},HlsPlayer.prototype.addCues=function(l){this.captionsControl.addCues(l)},HlsPlayer.prototype.clearCues=function(){this.captionsControl.clearCues()},HlsPlayer.prototype.captionsToggled=function(l,d,u){this.log(\"captionsToggled: \".concat(l,\" for culture \").concat(d,\" at \").concat(u)),this.eventsHandler.message(\"captionsToggled\").send(l,d,u)},HlsPlayer.prototype.getHlsConfig=function(){var l=this,d={autoStartLoad:!1,fragLoadingMaxRetry:5,debug:this.configProvider.config.debug};return this.configProvider.config.hlsSettings&&(Object.keys(this.configProvider.config.hlsSettings).forEach((function(d){l.contextWindow.Hls.DefaultConfig.hasOwnProperty(d)||(l.log(\"Invalid property: \".concat(d)),delete l.configProvider.config.hlsSettings[d])})),Object.assign(d,this.configProvider.config.hlsSettings),this.log(\"Applying HLS config: \".concat(JSON.stringify(d)))),d},HlsPlayer.prototype.createVideoElement=function(){this.log(\"createVideoElement started\"),this.video=this.container.ownerDocument.createElement(\"video\"),this.video.controls=!0,this.video.id=\"hls-player\",this.video.setAttribute(\"playsinline\",\"\");var l=this.configProvider.playerConfig.lang;l&&(this.video.setAttribute(\"lang\",l),this.log(\"createVideoElement: language set to \".concat(l)));for(var d=this.configProvider.playerConfig.styles,u=0;u<d.length;u++)this.video.classList.add(d[u]);this.video.style.width=\"100%\",this.container.appendChild(this.video),this.log(\"createVideoElement done\")},HlsPlayer.prototype.addCaptionsTracks=function(l){var d=this;l&&l.forEach((function(l){d.log(\"addCaptionsTracks for \".concat(l.name)),d.video.addTextTrack(d.configProvider.config.textTrackKind,l.name,l.culture)}))},HlsPlayer.prototype.log=function(l,d){void 0===d&&(d=\"info\");var u=\"[HlsPlayer\".concat(1===this.configProvider.config.loadType?\"IFrame\":\"\",\"]\"),p=\"\".concat(u,\": \").concat(l);this.configProvider.config.debug&&console.log(p),this.eventsHandler.message(\"log\").send(d,p)},HlsPlayer.prototype.getElementLoadPromise=function(l){return new Promise((function(d,u){l.onload=function(){d()},l.onerror=function(l){u(l)}}))},HlsPlayer.prototype.loadScript=function(l,d,u){var p=l.createElement(\"script\"),h=this.getElementLoadPromise(p);return p.src=d,u&&(p.nonce=u),l.defaultView.define&&(this.tempDefine=l.defaultView.define,l.defaultView.define=null),l.head.appendChild(p),h},HlsPlayer.prototype.initializeStatsColletion=function(){var l=this;this.statsTimer=window.setInterval((function(){l.eventsHandler&&l.eventsHandler.message(\"statsUpdated\").send(l.getPlayerDiagnostics())}),this.statsInterval),this.contextWindow.peer5&&this.configProvider.config.debug&&this.contextWindow.peer5.showStats()},HlsPlayer.prototype.stopStatsColletion=function(){this.eventsHandler.message(\"statsUpdated\").send(this.getPlayerDiagnostics()),-1!==this.statsTimer&&window.clearInterval(this.statsTimer),this.statsTimer=-1},HlsPlayer.prototype.getPlayerDiagnostics=function(){var l=this.diagnosticProvider.getPlayerDiagnosticSnapshot();return l.statsInterval=this.statsInterval,l},HlsPlayer.prototype.registerMediaEvents=function(){var l=this,d={passive:!0};this.video.addEventListener(\"seeking\",(function(){l.onHlsEvent(\"seeking\")}),d),this.video.addEventListener(\"seeked\",(function(){l.onHlsEvent(\"seeked\")}),d),this.video.addEventListener(\"pause\",(function(){l.onHlsEvent(\"pause\")}),d),this.video.addEventListener(\"play\",(function(){l.onHlsEvent(\"play\")}),d),this.video.addEventListener(\"playing\",(function(){l.onHlsEvent(\"playing\"),l.initialState&&(l.onHlsEvent(\"start\"),l.initialState=!1)}),d),this.video.addEventListener(\"canplaythrough\",(function(){l.onHlsEvent(\"canplaythrough\")}),d),this.video.addEventListener(\"loadstart\",(function(){l.onHlsEvent(\"loadstart\")}),d),this.video.addEventListener(\"loadeddata\",(function(){l.onHlsEvent(\"loadeddata\"),l.video.readyState>=2&&(l.video.play(),l.initializeStatsColletion())}),d),this.video.addEventListener(\"loadedmetadata\",(function(){l.onHlsEvent(\"loadedmetadata\")}),d),this.video.addEventListener(\"volumechange\",(function(){l.onHlsEvent(\"volumechange\",{value:l.video.volume})}),d),this.video.addEventListener(\"waiting\",(function(){l.onHlsEvent(\"waiting\"),l.handleWaitingEvent()}),d),this.video.addEventListener(\"stalled\",(function(){l.onHlsEvent(\"stalled\")}),d),this.video.addEventListener(\"ended\",(function(){l.video.currentTime=0,l.onHlsEvent(\"ended\")}),d),this.video.addEventListener(this.contextWindow.Hls.Events.LEVEL_SWITCHED,(function(d){l.onHlsEvent(\"playbackbitratechanged\",d.detail),l.onHlsEvent(\"downloadbitratechanged\",d.detail)}),d),Object.keys(this.contextWindow.Hls.ErrorTypes).forEach((function(u){l.video.addEventListener(l.contextWindow.Hls.ErrorTypes[u],(function(d){l.emitError(d.type,d.detail.data.details,d.detail.data.fatal)}),d)})),this.video.addEventListener(this.contextWindow.Hls.ErrorTypes.NETWORK_ERROR,(function(d){l.diagnosticProvider.registerForPlayerFragDownloadEvents(d)}),d),this.video.addEventListener(this.contextWindow.Hls.Events.FRAG_LOADED,(function(d){l.diagnosticProvider.registerForPlayerFragDownloadEvents(d)}),d)},HlsPlayer.prototype.emitError=function(l,d,u){var p={currentTime:this.video?this.video.currentTime:0,message:d,type:l,errorCode:0,fatal:u};this.diagnosticProvider.setError(d,l),this.onHlsEvent(\"error\",p)},HlsPlayer.prototype.onHlsEvent=function(l,d){switch(l){case\"loadedmetadata\":this.captionsControl.initialize();break;default:this.eventsHandler.message(\"statsUpdated\").send(this.getPlayerDiagnostics()),this.eventsHandler.message(\"stateChanged\").send(l,d)}},HlsPlayer.prototype.loadCss=function(l,d,u){var p=l.createElement(\"link\"),h=this.getElementLoadPromise(p);return p.href=d,p.rel=\"stylesheet\",u&&(p.nonce=u),l.head.appendChild(p),h},HlsPlayer.prototype.elapsedTime=function(l,d){return d-l},HlsPlayer.prototype.handleWaitingEvent=function(){var l=Date.now(),d=Math.max(this.nextScheduledCurrentTimeUpdate,this.nextScheduledSwitchingUrlTime),u=d<l,p=this.video.currentTime;this.video.paused||this.video.ended||0===this.video.playbackRate||!this.video.buffered?this.log(\"No recovery for waiting event because video is paused:\".concat(this.video.paused,\", now:\").concat(l,\", currTime:\").concat(p,\" hasData:\").concat(!this.video.buffered),\"debug\"):(this.log(\"Waiting event currTime:\".concat(p,\", timestamp:\").concat(l,\", nextScheduledRecovery:\").concat(d,\" recoveryHasBeenPerformed:\").concat(u),\"warn\"),this.scheduleTimeout(this.lastRecoveryWasTimeUpdate),this.lastRecoveryWasTimeUpdate=!this.lastRecoveryWasTimeUpdate)},HlsPlayer.prototype.scheduleTimeout=function(l){var d,u,p=this,h=Date.now();l?(d=\"switchingUrl\",this.nextScheduledSwitchingUrlTime=Math.max(this.nextScheduledSwitchingUrlTime,h)+this.configProvider.config.timeoutForSwitchingUrl,u=this.elapsedTime(h,this.nextScheduledSwitchingUrlTime),setTimeout((function(){p.triggerSwitchUrl(h,p.video.currentTime)}),u)):(d=\"currentTimeUpdate\",this.nextScheduledCurrentTimeUpdate=Math.max(this.nextScheduledCurrentTimeUpdate,h)+this.configProvider.config.timeoutForSkippingSegments,u=this.elapsedTime(h,this.nextScheduledCurrentTimeUpdate),setTimeout((function(){p.updateVideoPlayTime(h,p.video.currentTime)}),u)),this.log(\"scheduling timeout for \".concat(d,\" at currentTime:\").concat(this.video.currentTime,\" timestamp:\").concat(h,\" timeoutDelay:\").concat(u),\"warn\")},HlsPlayer.prototype.triggerSwitchUrl=function(l,d){var u=Date.now(),p=this.elapsedTime(l,u),h=this.video.readyState;if(h<=2){var g=\"Switching url at currentTime:\".concat(d,\" after waiting:\").concat(p,\"ms videoState:\").concat(h,\" timestamp:\").concat(u);this.log(g,\"warn\"),this.emitError(\"networkError\",g,!0)}else this.log(\"No recovery needed at currentTime:\".concat(d,\" after waiting:\").concat(p,\"ms videoState:\").concat(h,\" timestamp:\").concat(u),\"debug\")},HlsPlayer.prototype.updateVideoPlayTime=function(l,d){var u=Date.now(),p=this.elapsedTime(l,u),h=this.video.readyState,g=this.video.currentTime;if(h<=2){this.setPlayTime(Math.max(d+Math.max(this.media.averageTargetDuration,this.configProvider.config.hlsCurrentTimeJumpDuration),g));var f=\"Updating currTime:\".concat(g,\" to \").concat(this.video.currentTime,\" after waiting:\").concat(p,\"ms videoState:\").concat(h,\" timestamp:\").concat(u);this.log(f,\"warn\"),this.scheduleTimeout(!0)}else this.log(\"No recovery needed at videoCurrentTime:\".concat(d,\" after waiting:\").concat(p,\"ms videoState:\").concat(h,\" timestamp:\").concat(u),\"debug\")},HlsPlayer.prototype.isSafariClient=function(){var l=window.navigator.userAgent,d=!!l.match(/iPad/i)||!!l.match(/iPhone/i),u=!!l.match(/WebKit/i);return d&&u},HlsPlayer.prototype.addFullScreenListener=function(){if(this.isSafariClient()){var l=this.video;window.screen.orientation.onchange=function(){this.type.startsWith(\"landscape\")&&l.webkitRequestFullscreen?l.webkitRequestFullscreen():l.webkitExitFullscreen&&l.webkitExitFullscreen()}}},HlsPlayer}()}function HlsCommunicationHandlerF(){var l=HlsPlayerF();return function(){function HlsCommunicationHandler(d,u){this.pipe=d,this.hls=new l(u,this)}return HlsCommunicationHandler.prototype.processMessage=function(l){var d=this;\"Command\"===l.msgType&&Promise.resolve().then((function(){return d.hls[l.cmd].apply(d.hls,l.args)})).catch((function(l){return l})).then((function(u){d.pipe&&d.pipe.sendMsg({msgType:\"CommandResult\",cmd:l.cmd,error:u})}))},HlsCommunicationHandler.prototype.message=function(l){var d=this;return{send:this.fromMessage((function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];d.sendMessageImpl(l,u)}))}},HlsCommunicationHandler.prototype.hlsDisposed=function(){this.pipe.dispose(),this.pipe=null,this.hls=null},HlsCommunicationHandler.prototype.fromMessage=function(l){return l},HlsCommunicationHandler.prototype.sendMessageImpl=function(l,d){this.pipe.sendMsg({msgType:\"PlayerNotification\",name:l,args:d})},HlsCommunicationHandler}()}function IFrameMessageHandlerF(){function isCmdResult(l){return\"CommandResult\"===l.msgType}function getErrorString(l){var d=\"unknown\";try{d=\"string\"==typeof l?l:\"toString\"in l&&0!==l.toString().indexOf(\"[object\")?l.toString():JSON.stringify(l)}catch(d){console.error(\"Failed to stringify error\",l)}return d}return function(){function IFrameMessageHandler(){this.processMsg=this.processMsg.bind(this),window.addEventListener(\"message\",this.processMsg)}return IFrameMessageHandler.prototype.sendMsg=function(l){try{var d=l;isCmdResult(l)&&l.error instanceof Event&&(console.debug(\"Stringifying error Event before trying to postMessage:\",l),d={msgType:l.msgType,cmd:l.cmd,error:\"Event: \".concat(getErrorString(l.error))}),this.postMessage(d)}catch(d){console.error(\"Unexpected exception caught from postMessage.\\n\",\"message:\",l,\"\\n\",\"exception:\",d);var u={msgType:\"PlayerNotification\",name:\"log\",args:[\"error\",\"Unexpected error with postMessage: \".concat(getErrorString(d))]};throw this.postMessage(u),d}},IFrameMessageHandler.prototype.registerObserver=function(l){this.observer=l},IFrameMessageHandler.prototype.dispose=function(){window.removeEventListener(\"message\",this.processMsg),this.observer=null},IFrameMessageHandler.prototype.processMsg=function(l){this.observer.processMessage(l.data)},IFrameMessageHandler.prototype.postMessage=function(l){window.parent.postMessage(l,\"*\")},IFrameMessageHandler}()}function HlsDiagnosticProviderF(){return function(){function HlsDiagnosticProvider(l,d,u){this.playerInstance=l,this.contextWindow=d,this.video=u,this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailures=[],this.videoDownloadFailures=[],this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=30,this.downloadFailuresLimit=10,this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this)}return HlsDiagnosticProvider.prototype.getPlayerDiagnosticSnapshot=function(){var l,d,u,p,h,g,f,m,v,y,S,_,C,E,T,b,I,A,R,P=window.screen,mean=function(l){var d=l.slice().sort();return d[Math.floor(d.length/2)]},O=this.video.getVideoPlaybackQuality();return{errorCode:0,errorMessage:this.errorMessage,errorType:this.errorType,playerType:1,currentPlayPosition:this.video.currentTime,currentMediaTime:this.video.currentTime,currentAbsoluteTime:this.video.currentTime,livePosition:null===(l=this.playerInstance)||void 0===l?void 0:l.liveSyncPosition,playbackBitrate:-1!==(null===(d=this.playerInstance)||void 0===d?void 0:d.currentLevel)?null===(u=this.playerInstance)||void 0===u?void 0:u.levels[this.playerInstance.currentLevel].bitrate:void 0,downloadBitrate:-1!==(null===(p=this.playerInstance)||void 0===p?void 0:p.currentLevel)?null===(h=this.playerInstance)||void 0===h?void 0:h.levels[this.playerInstance.currentLevel].bitrate:void 0,perceivedBandwidth:null===(g=this.playerInstance)||void 0===g?void 0:g.bandwidthEstimate,tech:this.playerInstance?\"hls\":\"html5\",playerVersion:this.contextWindow.Hls.version,isP2PSdnUsed:null===(f=this.contextWindow.peer5)||void 0===f?void 0:f.isEnabled(),sdnName:this.contextWindow.peer5?\"peer5\":void 0,sdnStats:null===(m=this.contextWindow.peer5)||void 0===m?void 0:m.getStats(),sdnVersion:null===(v=this.contextWindow.peer5)||void 0===v?void 0:v.version,heuristicProfile:\"HighQuality\",encryption:void 0,streamType:-1!==(null===(y=this.playerInstance)||void 0===y?void 0:y.currentLevel)?null===(S=this.playerInstance)||void 0===S?void 0:S.levels[this.playerInstance.currentLevel].details.type:void 0,audioStream:this.getAudioStreamData(),videoStream:this.getVideoStreamData(),muted:this.video.muted,volume:this.video.volume,audioBufferLength:this.video.buffered.length>0?this.video.buffered.end(0)-this.video.buffered.start(0):0,videoBufferLength:this.video.buffered.length>0?this.video.buffered.end(0)-this.video.buffered.start(0):0,mediaHeight:-1!==(null===(_=this.playerInstance)||void 0===_?void 0:_.currentLevel)?null===(C=this.playerInstance)||void 0===C?void 0:C.levels[this.playerInstance.currentLevel].height:void 0,mediaWidth:-1!==(null===(E=this.playerInstance)||void 0===E?void 0:E.currentLevel)?null===(T=this.playerInstance)||void 0===T?void 0:T.levels[this.playerInstance.currentLevel].width:void 0,playerHeight:-1!==(null===(b=this.playerInstance)||void 0===b?void 0:b.currentLevel)?null===(I=this.playerInstance)||void 0===I?void 0:I.levels[this.playerInstance.currentLevel].height:void 0,playerWidth:-1!==(null===(A=this.playerInstance)||void 0===A?void 0:A.currentLevel)?null===(R=this.playerInstance)||void 0===R?void 0:R.levels[this.playerInstance.currentLevel].width:void 0,windowWidth:P?P.width:0,windowHeight:P?P.height:0,isFullscreen:document.fullscreenElement===this.video,avgAudioDownloadLatency:mean(this.audioDownloadLatencies),avgVideoDownloadLatency:mean(this.videoDownloadLatencies),avgAudioDownloadBytes:mean(this.audioDownloadBytes),avgVideoDownloadBytes:mean(this.videoDownloadBytes),maxVideoDownloadBytes:Math.max.apply(null,this.videoDownloadBytes),minVideoDownloadBytes:Math.min.apply(null,this.videoDownloadBytes),audioDownloadFailureCount:this.audioDownloadFailureCount,audioDownloadSuccessCount:this.audioDownloadSuccessCount,videoDownloadFailureCount:this.videoDownloadFailureCount,videoDownloadSuccessCount:this.videoDownloadSuccessCount,audioDownloadFailures:this.audioDownloadFailures,videoDownloadFailures:this.videoDownloadFailures,corruptedVideoFrames:O.corruptedVideoFrames,creationTime:O.creationTime,droppedVideoFrames:O.droppedVideoFrames,totalVideoFrames:O.totalVideoFrames}},HlsDiagnosticProvider.prototype.setError=function(l,d){this.errorMessage=l,this.errorType=d},HlsDiagnosticProvider.prototype.dispose=function(){},HlsDiagnosticProvider.prototype.registerForPlayerFragDownloadEvents=function(l){var d=l.detail.data;if(d.details===this.contextWindow.Hls.ErrorDetails.FRAG_LOAD_ERROR){var u=l.detail.bitrate;switch(d.frag.type){case\"audio\":this.onAudioDownloadError(d.frag.duration,d.details,d.type,u);break;case\"main\":this.onVideoDownloadError(d.frag.duration,d.details,d.type,u)}}else if(l.type===this.contextWindow.Hls.Events.FRAG_LOADED)switch(d.frag.type){case\"audio\":this.onAudioDownloadCompleted(d.frag.duration,d.frag.stats.total);break;case\"main\":this.onVideoDownloadCompleted(d.frag.duration,d.frag.stats.total)}},HlsDiagnosticProvider.prototype.onVideoDownloadCompleted=function(l,d){this.videoDownloadSuccessCount++,this.addToList(this.videoDownloadLatencies,l,this.slidingWindowLengthForLatency),this.addToList(this.videoDownloadBytes,d,this.slidingWindowLengthForDownloadBytes)},HlsDiagnosticProvider.prototype.onAudioDownloadCompleted=function(l,d){this.audioDownloadSuccessCount++,this.addToList(this.audioDownloadLatencies,l,this.slidingWindowLengthForLatency),this.addToList(this.audioDownloadBytes,d,this.slidingWindowLengthForDownloadBytes)},HlsDiagnosticProvider.prototype.addToList=function(l,d,u){l.push(d),l.length>u&&l.shift()},HlsDiagnosticProvider.prototype.onVideoDownloadError=function(l,d,u,p){this.videoDownloadFailureCount++,this.addDownloadFailureInfo(l,d,u,this.videoDownloadFailures,p)},HlsDiagnosticProvider.prototype.onAudioDownloadError=function(l,d,u,p){this.audioDownloadFailureCount++,this.addDownloadFailureInfo(l,d,u,this.audioDownloadFailures,p)},HlsDiagnosticProvider.prototype.addDownloadFailureInfo=function(l,d,u,p,h){var g={bitrate:h,errorCode:0,mediaTime:l,message:d,type:u,timestamp:Date.now()};this.addToList(p,g,this.downloadFailuresLimit)},HlsDiagnosticProvider.prototype.getAudioStreamData=function(){var l;if(this.playerInstance&&-1!==(null===(l=this.playerInstance)||void 0===l?void 0:l.currentLevel))try{var d=this.playerInstance.levels[this.playerInstance.currentLevel];return{bitrate:d.bitrate,codec:d.audioCodec,enabled:!0,name:d.audioCodec,language:void 0}}catch(l){return}},HlsDiagnosticProvider.prototype.getVideoStreamData=function(){var l;if(this.playerInstance&&-1!==(null===(l=this.playerInstance)||void 0===l?void 0:l.currentLevel))try{var d=this.playerInstance.levels[this.playerInstance.currentLevel],u={bitrate:d.bitrate,codec:d.videoCodec,height:d.height,id:d.videoCodec,selectable:!0,width:d.width};return{codec:d.videoCodec,name:d.videoCodec,currentTrack:u}}catch(l){return}},HlsDiagnosticProvider}()}function CaptionsControlToggleProviderF(){return function(){function CaptionsControlToggleProvider(l,d,u){this.media=l,this.toggleListener=d,this.config=u,this.onTextTrackChanged=this.onTextTrackChanged.bind(this)}return CaptionsControlToggleProvider.prototype.dispose=function(){this.unsubscribeFromTrackEvents(),this.media=null,this.toggleListener=null},CaptionsControlToggleProvider.prototype.initialize=function(){for(var l=this.getTextTracks(),d=0;d<l.length;d++)l[d].mode=\"disabled\";this.subscribeOnTrackEvents()},CaptionsControlToggleProvider.prototype.addCues=function(l){var d=this.getCurrentTextTrack();if(d){var u=this.getCurrentTime()||1,p=this.getCurrentTime(),h=this.config.isOverflow?Math.max(u-p,0):u-p;this.config.logFn(\"[CaptionsControl]: addCues, captionOffsetTime => \".concat(h));for(var g=0;g<l.length;g++){var f=l[g],m=f.start,v=f.end,y=f.text,S=6,_=Number((m+h).toFixed(S)),C=Number((v+h).toFixed(S)),E=new VTTCue(_,C,y);!this.containsCue(d,E)&&d.addCue(E)}}},CaptionsControlToggleProvider.prototype.clearCues=function(){var removeAllCues=function(l){if(l&&l.cues)for(;l.cues.length;)l.removeCue(l.cues[0])};removeAllCues(this.previouslyVisibleTextTrack),removeAllCues(this.currentTextTrack)},CaptionsControlToggleProvider.prototype.getTextTracks=function(){return this.media.textTracks},CaptionsControlToggleProvider.prototype.getCurrentTime=function(){return this.media.currentTime},CaptionsControlToggleProvider.prototype.getCurrentTextTrack=function(){for(var l=this.getTextTracks(),d=0;l&&d<l.length;d++)if(\"showing\"===l[d].mode)return l[d];return null},CaptionsControlToggleProvider.prototype.showCaptions=function(l){this.config.logFn(\"[CaptionsControl]: showCaptions(\".concat(l,\")\")),l?this.show():this.hide()},CaptionsControlToggleProvider.prototype.hide=function(){this.previouslyVisibleTextTrack=this.getCurrentTextTrack(),this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode=\"disabled\")},CaptionsControlToggleProvider.prototype.show=function(){this.previouslyVisibleTextTrack&&(this.previouslyVisibleTextTrack.mode=\"showing\")},CaptionsControlToggleProvider.prototype.subscribeOnTrackEvents=function(){var l=this.getTextTracks(),d=\"addEventListener\";l&&l[d]&&(l[d](\"change\",this.onTextTrackChanged),this.config.removeEmptyDefaultTextTrack&&l[d](\"addtrack\",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.unsubscribeFromTrackEvents=function(){var l=this.getTextTracks(),d=\"removeEventListener\";l&&l[d]&&(l[d](\"change\",this.onTextTrackChanged),this.config.removeEmptyDefaultTextTrack&&l[d](\"addtrack\",this.onAddTrack.bind(this)))},CaptionsControlToggleProvider.prototype.onTextTrackChanged=function(){var l=this.getCurrentTextTrack();if(!l||!this.currentTextTrack||this.currentTextTrack.label!==l.label||this.currentTextTrack.mode!==l.mode){if(l||this.currentTextTrack){var d=!!l&&\"showing\"===l.mode,u=this.getCulture(l||this.currentTextTrack),p=this.getCurrentTime();this.toggleListener.captionsToggled(d,u,p),this.config.logFn(\"[CaptionsControl]: track changed: culture '\".concat(u,\"', timestamp '\").concat(p,\"'\"))}this.currentTextTrack=l}},CaptionsControlToggleProvider.prototype.onAddTrack=function(l){var d,u,p=null==l?void 0:l.track;\"captions\"===(null==p?void 0:p.kind)&&!p.label&&!p.id&&(null===(u=null===(d=this.media)||void 0===d?void 0:d.textTracks_)||void 0===u||u.removeTrack_(p),this.config.logFn(\"[CaptionsControl]: removing default empty text track\"))},CaptionsControlToggleProvider.prototype.getCulture=function(l){if(l&&l.id){var d=l.id.split(\"_\")[1];if(d)return d}else if(l&&l.language)return l.language;return\"\"},CaptionsControlToggleProvider.prototype.containsCue=function(l,d){var u=this;return Array.from((null==l?void 0:l.cues)||[]).some((function(l){return u.areCueEquals(l,d)}))},CaptionsControlToggleProvider.prototype.areCueEquals=function(l,d){return l.startTime===d.startTime&&l.endTime===d.endTime&&l.id===d.id&&l.text===d.text},CaptionsControlToggleProvider}()}function initIFrame(){var l=IFrameMessageHandlerF(),d=HlsCommunicationHandlerF(),u=new l,p=new d(u,document.body);u.registerObserver(p)}function Html5MediaF(){return function(){function Html5Media(l,d){this.element=l,this.logFn=d;var u={passive:!0};this._dispatchError=this._dispatchError.bind(this),this.element.addEventListener(\"error\",this._dispatchError,u),this.logFn(\"Created Html5Media\")}return Object.defineProperty(Html5Media.prototype,\"averageTargetDuration\",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(Html5Media.prototype,\"tech\",{get:function(){return\"NativeHls\"},enumerable:!1,configurable:!0}),Html5Media.prototype.setSource=function(l){this.element.src=l.url,this.logFn(\"Set Source completed\")},Html5Media.prototype.destroy=function(){this.element.removeEventListener(\"error\",this._dispatchError),this.logFn(\"Destroyed Html5Media\")},Html5Media.prototype.switchStreamingUrl=function(l){this.logFn(\"Switching streaming url from HTML5Media at now:\".concat(Date.now(),\" currTime:\").concat(this.element.currentTime),\"warn\"),this.setSource(l)},Html5Media.prototype.getPlayer=function(){return null},Html5Media.prototype._addEvent=function(l,d){var u={};return d&&d.detail&&(u={detail:d.detail}),new CustomEvent(l,u)},Html5Media.prototype._dispatchError=function(l){var d,u=l.target,p=null==u?void 0:u.error;switch(null==p?void 0:p.code){case null==p?void 0:p.MEDIA_ERR_ABORTED:d=\"Media playback aborted\";break;case null==p?void 0:p.MEDIA_ERR_NETWORK:d=\"Media download failed part-way due to a network error\";break;case null==p?void 0:p.MEDIA_ERR_DECODE:d=\"Media playback aborted due to a corruption problem or because the\\n                        media used features your browser did not support.\";break;case null==p?void 0:p.MEDIA_ERR_SRC_NOT_SUPPORTED:d=\"Media could not be loaded, either because the server or network failed\\n                        or because the format is not supported.\";break;default:d=\"Unknown error occurred.\"}this.logFn(\"Html5Media received \".concat(null==p?void 0:p.message,\" errCode: \").concat(null==p?void 0:p.code),\"error\");var h=this._addEvent(\"networkError\",{detail:{data:{fatal:!0,details:\"\".concat(d,\" errCode:\").concat(null==p?void 0:p.code)},bitrate:void 0}});this.element.dispatchEvent(h)},Html5Media}()}function HlsMediaF(){return function(){function HlsMedia(l,d,u,p){this.element=l,this.contextWindow=d,this.logFn=u,this.hlsConfig=p,this.recoverDecodingErrorDate=0,this.recoverSwapAudioCodecDate=0,this._create=this._create.bind(this),this._play=this._play.bind(this),this._pause=this._pause.bind(this),this._assign=this._assign.bind(this),this._handleError=this._handleError.bind(this),this.hlsConfig.xhrSetup=function(l,d){-1!==d.indexOf(\"keydelivery\")&&(l.withCredentials=!0)},this._create()}return Object.defineProperty(HlsMedia.prototype,\"averageTargetDuration\",{get:function(){var l,d,u,p;return(null===(p=null===(u=null===(l=this.player)||void 0===l?void 0:l.levels[null===(d=this.player)||void 0===d?void 0:d.currentLevel])||void 0===u?void 0:u.details)||void 0===p?void 0:p.averagetargetduration)||0},enumerable:!1,configurable:!0}),Object.defineProperty(HlsMedia.prototype,\"tech\",{get:function(){return\"Hls\"},enumerable:!1,configurable:!0}),HlsMedia.prototype.getPlayer=function(){return this.player},HlsMedia.prototype.setSource=function(l){if(-1===l.url.indexOf(\"m3u8\"))throw new Error(\"Invalid stream \".concat(l.url));this.player.loadSource(l.url),this.logFn(\"Set Source completed\")},HlsMedia.prototype.destroy=function(){this.player&&(this.logFn(\"destroying HlsMedia\"),this.player.destroy(),this.player=null)},HlsMedia.prototype.switchStreamingUrl=function(l){var d=Math.max(this.player.bandwidthEstimate||0,this.contextWindow.Hls.DefaultConfig.abrEwmaDefaultEstimate),u=Math.max(this.player.currentLevel,0);this.hlsConfig.startLevel=u,this.hlsConfig.abrEwmaDefaultEstimate=d,this.logFn(\"Switching streaming url from HlsMedia at now:\".concat(Date.now(),\" currTime:\").concat(this.element.currentTime,\", startLevel:\").concat(u,\", bandwidthEstimate:\").concat(d),\"warn\"),this.destroy(),this._create(),this.setSource(l)},HlsMedia.prototype._create=function(){var l=this;this.player=new this.contextWindow.Hls(this.hlsConfig),this.events=this.contextWindow.Hls.Events,Object.keys(this.events).forEach((function(d){l.player.on(l.events[d],(function(){for(var u=[],p=0;p<arguments.length;p++)u[p]=arguments[p];l._assign(l.events[d],u)}))})),this.player.attachMedia(this.element),this.logFn(\"Created HlsMedia\")},HlsMedia.prototype._play=function(){this.player&&(this.logFn(\"Started Playing\"),this.player.startLoad())},HlsMedia.prototype._pause=function(){this.player&&(this.logFn(\"Paused Playing\"),this.player.stopLoad())},HlsMedia.prototype._assign=function(l,d){switch(l){case this.contextWindow.Hls.Events.ERROR:this._handleError(d);break;case this.contextWindow.Hls.Events.MEDIA_ATTACHED:this.logFn(\"video and hls.js are now bound together ! Event:\".concat(l));break;case this.contextWindow.Hls.Events.MANIFEST_PARSED:this.logFn(\"Starting HLS load Event:\".concat(l)),this._play();break;case this.contextWindow.Hls.Events.LEVEL_SWITCHED:this.element.dispatchEvent(this._addEvent(l,{detail:{bitrate:this.player.levels[d[1].level].bitrate}}));break;case this.contextWindow.Hls.Events.FRAG_LOADED:this.element.dispatchEvent(this._addEvent(l,{detail:{data:d[1]}}))}},HlsMedia.prototype._addEvent=function(l,d){var u={};return d&&d.detail&&(u={detail:d.detail}),new CustomEvent(l,u)},HlsMedia.prototype._handleError=function(l){var d=l[1].type,u=l[1].fatal;this.logFn(\"HLS Error type: \".concat(d,\" details: \").concat(l[1].details,\" fatal: \").concat(u),\"error\");var p=-1!==this.player.currentLevel?this.player.levels[this.player.currentLevel].bitrate:void 0;if(u){var h=this._addEvent(d,{detail:{data:l[1]}});switch(d){case this.contextWindow.Hls.ErrorTypes.MEDIA_ERROR:this.handleMediaError(h);break;case this.contextWindow.Hls.ErrorTypes.NETWORK_ERROR:console.error(\"Network error type:\".concat(d,\" fatal:\").concat(u)),l[1].details===this.contextWindow.Hls.ErrorDetails.FRAG_LOAD_ERROR&&(l[1].fatal=!1,this.player.startLoad(this.element.currentTime)),this.element.dispatchEvent(this._addEvent(d,{detail:{data:l[1],bitrate:p}}));break;default:this.element.dispatchEvent(h)}}else if(l[1].details===this.contextWindow.Hls.ErrorDetails.FRAG_LOAD_ERROR){var g=this._addEvent(d,{detail:{data:l[1],bitrate:p}});this.element.dispatchEvent(g)}},HlsMedia.prototype.handleMediaError=function(l){var d=Date.now();!this.recoverDecodingErrorDate||d-this.recoverDecodingErrorDate>3e3?(this.logFn(\"Attempting to recover from media error at \".concat(d,\", currenTime:\").concat(this.element.currentTime),\"warn\"),this.recoverDecodingErrorDate=d,this.player.recoverMediaError()):!this.recoverSwapAudioCodecDate||d-this.recoverSwapAudioCodecDate>3e3?(this.recoverSwapAudioCodecDate=d,this.logFn(\"Attempting to swap Audio Codec and recover from media error at \".concat(d,\", currenTime:\").concat(this.element.currentTime),\"warn\"),this.player.swapAudioCodec(),this.player.recoverMediaError()):(this.logFn(\"Cannot recover, last media error recovery failed at \".concat(d,\", currenTime:\").concat(this.element.currentTime),\"error\"),this.element.dispatchEvent(l))},HlsMedia}()}function buildHlsEmbededSrc(){var l=\"(\".concat(initIFrame.toString(),\")();\");return l+=HlsPlayerF.toString()+\";\",l+=IFrameMessageHandlerF.toString()+\";\",l+=HlsCommunicationHandlerF.toString()+\";\",l+=CaptionsControlToggleProviderF.toString()+\";\",l+=HlsDiagnosticProviderF.toString()+\";\",l+=HlsMediaF.toString()+\";\",l+=Html5MediaF.toString()+\";\",l+=\"//# sourceURL=TsCallingHlsPlayer.js\"}Object.defineProperty(d,\"__esModule\",{value:!0}),d.buildHlsEmbededSrc=d.CaptionsControlToggleProvider=d.HlsDiagnosticProvider=d.IFrameMessageHandler=d.HlsCommunicationHandler=d.HlsPlayer=void 0,d.HlsPlayer=HlsPlayerF(),d.HlsCommunicationHandler=HlsCommunicationHandlerF(),d.IFrameMessageHandler=IFrameMessageHandlerF(),d.HlsDiagnosticProvider=HlsDiagnosticProviderF(),d.CaptionsControlToggleProvider=CaptionsControlToggleProviderF(),d.buildHlsEmbededSrc=buildHlsEmbededSrc},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.HlsLiveStreamPlayer=void 0;var f,m=u(18),v=u(35),y=u(174),S=u(175),_=u(88),C=u(176);!function(l){l.NETWORK_ERROR=\"networkError\",l.MEDIA_ERROR=\"mediaError\",l.KEY_SYSTEM_ERROR=\"keySystemError\",l.MUX_ERROR=\"muxError\",l.OTHER_ERROR=\"otherError\"}(f||(f={}));var E=function(l){function HlsLiveStreamPlayer(d,u,p){var h=l.call(this)||this;return h.logger=d,h.liveStreamStatistic=u,h.configProvider=p,h.playerState=\"Destroyed\",h.captionsTimestamp=0,h.isSwitchStreamingUrlOngoing=!1,h.streamingUrlSwitchCount=0,h}return p(HlsLiveStreamPlayer,l),HlsLiveStreamPlayer.prototype.configure=function(l){return h(this,void 0,void 0,(function(){var d;return g(this,(function(u){switch(u.label){case 0:return _.isStreamValid(l.stream)||_.isStreamValid(l.altStream)?(this.logger.info(\"Live Stream configuration provided\"),this.liveStreamOptions=l,d=_.isStreamValid(l.stream)?l.stream:l.altStream,this.playerInstance?[4,this.handleStreamInfoUpdate(d)]:(this.selectedStreamDetails=d,[2])):(this.logger.error(\"Invalid Live Stream configuration provided: no valid primary or alternative stream\"),[2]);case 1:return u.sent(),[2]}}))}))},HlsLiveStreamPlayer.prototype.loadPlayer=function(l){return h(this,void 0,void 0,(function(){var d,u,p,h,f=this;return g(this,(function(g){switch(g.label){case 0:return this.playerInstance?(this.logger.error(\"playerLoadFailed: cannot load a player while current one is still active\"),[2,{setupSucceeded:!1,playerSetupError:{errorType:\"MultiplePlayerLoad\",errorMessage:\"cannot load a player while current one is still active\"}}]):this.liveStreamOptions&&this.selectedStreamDetails&&_.isStreamValid(this.selectedStreamDetails)?(this.playerInstance=new y.PlayerWrapper(this.logger.createChild(\"PlayerWrapper\")),this.playerInstance.on(\"stateChanged\",(function(l,d){return f.hlsStateChanged(l,d)})),this.playerInstance.on(\"captionsToggled\",(function(l,d,u){return f.captionsToggled(l,d,u)})),this.playerInstance.on(\"statsUpdated\",(function(l){return f.liveStreamStatistic.registerStatsUpdated(l)})),[4,this.playerInstance.initialize(l,this.liveStreamOptions,this.configProvider,1)]):(this.logger.error(\"playerLoadFailed: empty/invalid primary and alternate stream info configured\"),[2,{setupSucceeded:!1,playerSetupError:{errorType:\"InvalidStream\",errorMessage:\"empty/invalid primary and alternate stream info configured\"}}]);case 1:g.sent(),this.liveStreamStatistic.registerPlayerLoadAttempt(),this.loadSucceeded=!1,this.srcLoadPromise||(this.srcLoadPromise=this.playerInstance.message(\"loadPlayerScript\").send()),g.label=2;case 2:return g.trys.push([2,4,,5]),[4,this.srcLoadPromise];case 3:return g.sent(),[3,5];case 4:return d=g.sent(),p=(0,v.stringifyObject)(d),this.logger.error(\"playerLoadFailed: player scripts load failed: \".concat(p)),this.liveStreamStatistic.registerPlayerLoadFailed(\"player scripts load failed\"),this.srcLoadPromise=null,[2,{setupSucceeded:!1,playerSetupError:{errorType:\"PlayerScriptLoadFailed\",errorMessage:p}}];case 5:return[4,this.tryLoadSdnPlugin()];case 6:g.sent(),g.label=7;case 7:return g.trys.push([7,9,,10]),[4,this.playerInstance.message(\"createHls\").send()];case 8:return g.sent(),[3,10];case 9:return u=g.sent(),p=(0,v.stringifyObject)(u),this.logger.error(\"playerLoadFailed \".concat(p)),this.liveStreamStatistic.registerPlayerLoadFailed(\"playerLoadFailed \".concat(p)),[2,{setupSucceeded:!1,playerSetupError:{errorType:\"PlayerInitializationFailed\",errorMessage:p}}];case 10:return h=this,[4,this.setPlayerSource(this.selectedStreamDetails,!1)];case 11:return h.loadSucceeded=g.sent(),this.logger.info(\"loadPlayer succeeded: \".concat(this.loadSucceeded)),this.loadSucceeded?(this.liveStreamStatistic.registerPlayerLoadSucceeded(),this.playerState=\"Initialized\",[2,{setupSucceeded:this.loadSucceeded}]):(this.liveStreamStatistic.registerPlayerLoadFailed(\"setPlayerSource failed\"),[2,{setupSucceeded:this.loadSucceeded,playerSetupError:{errorType:\"SetSourceFailed\",errorMessage:\"failed to set player source\"}}])}}))}))},HlsLiveStreamPlayer.prototype.getRenderer=function(){return!this.renderer&&this.playerInstance&&(this.renderer=new S.LiveStreamRenderer(this,this.logger.createChild(\"LiveStreamRenderer\"))),this.renderer},HlsLiveStreamPlayer.prototype.stop=function(){this.destroy()},HlsLiveStreamPlayer.prototype.getPlaybackState=function(){return this.playerState},HlsLiveStreamPlayer.prototype.getCaptionsTimestamp=function(){return this.captionsTimestamp},HlsLiveStreamPlayer.prototype.getCaptionsControl=function(){if(!this.captionsControl&&this.playerInstance){var l=this.liveStreamOptions.supportedSubtitleLanguages?this.liveStreamOptions.supportedSubtitleLanguages.map((function(l){return l.culture})):[\"en\",\"es\"];this.captionsControl=new C.CaptionsControl(this.playerInstance,l)}return this.captionsControl},HlsLiveStreamPlayer.prototype.getStreamSize=function(){var l=this.playerInstance?this.playerInstance.getPlayerDiagnosticSnapshot():null;return l?{width:l.mediaWidth,height:l.mediaHeight}:{width:0,height:0}},HlsLiveStreamPlayer.prototype.isRendering=function(){var l=this.getStreamSize();return l.width>0&&l.height>0},HlsLiveStreamPlayer.prototype.hlsStateChanged=function(l,d){switch(l){case\"error\":return this.handlePlaybackError(d);case\"canplaythrough\":return this.onCanplaythrough();case\"play\":return this.onPlay();case\"playing\":return this.onPlaying();case\"pause\":return this.onPause();case\"start\":return this.onStart();case\"ended\":return this.onEnded();case\"seeking\":return this.onSeeking();case\"seeked\":return this.onSeeked(d);case\"loadedmetadata\":return this.onMetadataLoaded();case\"waiting\":return this.onWaiting();case\"stalled\":return this.onStalled();case\"playbackbitratechanged\":return this.onPlaybackBitrateChanged(d);case\"downloadbitratechanged\":return this.onDownloadBitrateChanged(d);case\"volumechange\":return this.onVolumeChange(d);case\"loadstart\":return this.onLoadStart();case\"loadeddata\":return this.onLoadedData();case\"skippingSegment\":return this.onSkippingSegment(d);default:this.logger.warn(\"Unknown hls event \".concat(l))}},HlsLiveStreamPlayer.prototype.handlePlaybackError=function(l){return h(this,void 0,void 0,(function(){var d;return g(this,(function(u){switch(u.label){case 0:if(this.playerState=\"Error\",d=(0,v.stringifyObject)(l),this.logger.info(\"Playback error \".concat(d)),!l.message)return this.logger.error(\"onError: error details are not available\"),this.raisePlaybackError(\"Unknown\",d),[2];switch(l.type){case f.NETWORK_ERROR:this.raisePlaybackError(\"NetworkError\",d);break;case f.MEDIA_ERROR:case f.KEY_SYSTEM_ERROR:case f.MUX_ERROR:this.raisePlaybackError(\"PlaybackError\",d);break;default:this.raisePlaybackError(\"Unknown\",d)}return this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,l.fatal?[4,this.switchStreamingUrl()]:[3,2];case 1:u.sent()||(this.logger.error(\"Switching to alt streaming url failed. Destroying player\"),this.destroy()),u.label=2;case 2:return[2]}}))}))},HlsLiveStreamPlayer.prototype.raisePlaybackError=function(l,d){this.liveStreamStatistic.registerPlaybackError(l,d),this.event(\"playbackError\").raise(l,d)},HlsLiveStreamPlayer.prototype.captionsToggled=function(l,d,u){this.event(\"captionsToggled\").raise(l,d,u),this.liveStreamStatistic.registerCaptionToggle(l,d,u)},HlsLiveStreamPlayer.prototype.tryLoadSdnPlugin=function(){return h(this,void 0,void 0,(function(){var l,d;return g(this,(function(u){switch(u.label){case 0:if(this.sdnPluginLoadPromise||!this.liveStreamOptions.sdn||!this.configProvider.config.allowSdnPlugins)return[2];switch(this.liveStreamOptions.sdn.name){case\"peer5\":break;default:return this.logger.warn(\"unsupported SDN provider: \".concat(this.liveStreamOptions.sdn.name)),this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!1),[2]}u.label=1;case 1:return u.trys.push([1,3,,4]),this.sdnPluginLoadPromise=this.playerInstance.message(\"tryLoadSdnPlugin\").send(),[4,this.sdnPluginLoadPromise];case 2:return u.sent(),[3,4];case 3:return l=u.sent(),d=(0,v.stringifyObject)(l),this.sdnPluginLoadPromise=void 0,this.logger.error(\"loadSdnPlugin failed: \".concat(d)),this.event(\"sdnPluginLoadFailed\").raise(d),[3,4];case 4:return this.liveStreamStatistic.registerSdnPluginLoad(this.liveStreamOptions.sdn.name,!!this.sdnPluginLoadPromise),[2]}}))}))},HlsLiveStreamPlayer.prototype.setPlayerSource=function(l,d){return h(this,void 0,void 0,(function(){var u,p,h;return g(this,(function(g){switch(g.label){case 0:if(!this.playerInstance)return this.logger.error(\"setPlayerSource: playerInstance is null\"),[2,!1];this.logger.info(\"setPlayerSource: Hls source set to: [\".concat(l.url,\"]\")),this.lastKnownPlayTime=this.getCurrentTime()||this.lastKnownPlayTime,g.label=1;case 1:return g.trys.push([1,4,,7]),this.liveStreamStatistic.registerSetSourceAttempt(),this.logger.info(\"setPlayerSource: src changed\"),this.selectedStreamDetails=l,[4,this.setAuthCookieRequest(l)];case 2:return g.sent(),u=d?\"switchStreamingUrl\":\"setSource\",[4,this.playerInstance.message(u).send(l)];case 3:return g.sent(),this.liveStreamStatistic.registerSetSourceSucceeded(),[2,!0];case 4:return p=g.sent(),h=(0,v.stringifyObject)(p),this.logger.error(\"setPlayerSource: failed with error [\".concat(h,\"]\")),this.liveStreamStatistic.registerSetSourcedFailed(h),this.raisePlaybackError(\"NetworkError\",h),d?[3,6]:[4,this.switchStreamingUrl()];case 5:return[2,g.sent()];case 6:return[3,7];case 7:return[2,!1]}}))}))},HlsLiveStreamPlayer.prototype.setAuthCookieRequest=function(l){return h(this,void 0,void 0,(function(){var d;return g(this,(function(u){switch(u.label){case 0:-1!==l.url.indexOf(\"format=mpd-time-csf\")&&(l.url=l.url.substring(0,l.url.indexOf(\"(format=mpd-time-csf\"))),l.url.endsWith(\"/manifest\")&&(l.url+=\"(format=m3u8-aapl)\"),u.label=1;case 1:return u.trys.push([1,4,,5]),l.keyDeliveryUrl&&l.keyAuthorizationToken?[4,fetch(l.keyDeliveryUrl,{method:\"post\",credentials:\"include\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({keyAuthorizationToken:l.keyAuthorizationToken})}).then((function(l){if(200!==l.status)throw new Error(\"Unexpected KeyDelivery response status \".concat(l.status))}))]:[3,3];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:throw d=u.sent(),new Error(\"Setting authorization cookie failed \".concat(d));case 5:return[2]}}))}))},HlsLiveStreamPlayer.prototype.handleStreamInfoUpdate=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){switch(d.label){case 0:return this.loadSucceeded&&l.url!==this.selectedStreamDetails.url?[4,this.setPlayerSource(l,!0)]:[3,2];case 1:return d.sent(),[3,3];case 2:this.loadSucceeded&&this.playerInstance&&this.getCurrentTime()>0&&this.setPlaybackState(\"Start\"),d.label=3;case 3:return[2]}}))}))},HlsLiveStreamPlayer.prototype.switchStreamingUrl=function(){return h(this,void 0,void 0,(function(){var l,d;return g(this,(function(u){return this.streamingUrlSwitchCount>=this.configProvider.config.streamingUrlSwitchMaxCount?(this.logger.error(\"Switching to alt stream url failed. Number of switches reached maximum of configured \".concat(this.streamingUrlSwitchCount,\" number\")),[2,!1]):(l=this.selectedStreamDetails.url===(this.liveStreamOptions.stream&&this.liveStreamOptions.stream.url),d=l?this.liveStreamOptions.altStream:this.liveStreamOptions.stream,_.isStreamValid(d)?(this.isSwitchStreamingUrlOngoing=!0,this.streamingUrlSwitchCount++,this.logger.info(\"Playback switched and continues from \".concat(d.url,\" stream URL. Stream URL switch count:  \").concat(this.streamingUrlSwitchCount)),[2,this.setPlayerSource(d,!0)]):(this.logger.error(\"Stream to switch (\".concat(l?\"alternative\":\"primary\",\") is not valid\")),[2,!1]))}))}))},HlsLiveStreamPlayer.prototype.destroy=function(){this.srcLoadPromise=null,this.sdnPluginLoadPromise=null,this.renderer&&(this.renderer.dispose(),this.renderer=null),this.playerInstance&&(this.liveStreamStatistic.registerPlayerDestroyed(),this.playerInstance.dispose(),this.playerInstance=null,this.setPlaybackState(\"Destroyed\"))},HlsLiveStreamPlayer.prototype.getCurrentTime=function(){var l=this.playerInstance?this.playerInstance.getPlayerDiagnosticSnapshot():null;return l&&l.currentPlayPosition||0},HlsLiveStreamPlayer.prototype.onCanplaythrough=function(){this.setPlaybackState(\"Ready\")},HlsLiveStreamPlayer.prototype.onPlay=function(){this.lastKnownPlayTime&&(this.logger.info(\"Setting current time to \".concat(this.lastKnownPlayTime)),this.playerInstance.message(\"setPlayTime\").send(this.lastKnownPlayTime),this.lastKnownPlayTime=void 0),this.setPlaybackState(\"Play\")},HlsLiveStreamPlayer.prototype.onPlaying=function(){this.setPlaybackState(\"Playing\")},HlsLiveStreamPlayer.prototype.onPause=function(){this.setPlaybackState(\"Paused\")},HlsLiveStreamPlayer.prototype.onStart=function(){this.logger.info(\"Playback started\"),this.setPlaybackState(\"Start\"),this.isSwitchStreamingUrlOngoing&&(this.logger.info(\"Playback started, switch count: \".concat(this.streamingUrlSwitchCount)),this.event(\"urlSwitched\").raise(this.selectedStreamDetails===this.liveStreamOptions.altStream),this.isSwitchStreamingUrlOngoing=!1)},HlsLiveStreamPlayer.prototype.onEnded=function(){this.setPlaybackState(\"Ended\")},HlsLiveStreamPlayer.prototype.onSeeking=function(){this.setPlaybackState(\"Seeking\")},HlsLiveStreamPlayer.prototype.onSeeked=function(l){this.setPlaybackState(\"Seeked\")},HlsLiveStreamPlayer.prototype.onMetadataLoaded=function(){this.setPlaybackState(\"LoadedMetadata\")},HlsLiveStreamPlayer.prototype.onWaiting=function(){this.setPlaybackState(\"Buffering\")},HlsLiveStreamPlayer.prototype.onStalled=function(){this.setPlaybackState(\"Stalled\")},HlsLiveStreamPlayer.prototype.onLoadedData=function(){this.setPlaybackState(\"LoadedData\")},HlsLiveStreamPlayer.prototype.onLoadStart=function(){this.setPlaybackState(\"LoadStart\")},HlsLiveStreamPlayer.prototype.onSkippingSegment=function(l){this.setPlaybackState(\"SkippingSegment\"),this.liveStreamStatistic.registerPotentialMediaFreeze(l)},HlsLiveStreamPlayer.prototype.setPlaybackState=function(l){this.playerState=l,this.logger.debug(\"playback state changed: \".concat(l)),this.liveStreamStatistic.registerPlaybackStateChanged(l),this.event(\"playbackStateChanged\").raise()},HlsLiveStreamPlayer.prototype.onVolumeChange=function(l){this.liveStreamStatistic.registerVolumeChange(l.value)},HlsLiveStreamPlayer.prototype.onPlaybackBitrateChanged=function(l){this.liveStreamStatistic.registerPlaybackBitratechanged(l.bitrate)},HlsLiveStreamPlayer.prototype.onDownloadBitrateChanged=function(l){this.liveStreamStatistic.registerDownloadBitratechanged(l.bitrate)},HlsLiveStreamPlayer}(m.default);d.HlsLiveStreamPlayer=E},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.LiveStreamStatistic=void 0;var h=u(34),g=u(88),f=function(){function PlayerScenario(l,d){this.name=l,this.start(d)}return PlayerScenario.prototype.complete=function(){g.assert(this.startTime,\"not started\"),g.assert(void 0===this.duration,\"already completed\"),this.duration=Date.now()-this.startTime},PlayerScenario.prototype.fail=function(l){this.failReason=l,this.complete()},PlayerScenario.prototype.getTelemetryEvent=function(){g.assert(this.startTime,\"not started\"),g.assert(void 0!==this.duration,\"not completed\");var l={name:this.name,startTime:this.startTime,duration:this.duration};return this.failReason&&(l.failReason=this.failReason),this.details&&(l.details=this.details),l},PlayerScenario.prototype.start=function(l){g.assert(!this.startTime,\"already started\"),this.startTime=Date.now(),this.details=l},PlayerScenario}(),m=function(){function LiveStreamStatistic(l,d){this.config=l,this.logger=d,this.currentScenarioMap=new Map,this.playerEvents=[],this.playbackEvents=[],this.playerDiagnosticsLog={perceivedBandwidth:[],videoBufferLength:[],playerHeight:[],playerWidth:[],mediaHeight:[],mediaWidth:[],windowWidth:[],windowHeight:[],currentPlayPosition:[],currentMediaTime:[],statsInterval:-1},this.maxPlayerPlaybackEventCount=l.maxPlayerPlaybackEventCount||5,this.maxPlayerDiagnosticsCount=l.maxPlayerDiagnosticsCount||5,this.maxPlayerMemoryTraceLogCount=l.maxPlayerMemoryTraceLogCount||100,this.config.debug&&(this.playerDiagnosticsLog.memoryLog=[])}return Object.defineProperty(LiveStreamStatistic.prototype,\"playerDiagnosticSnapshot\",{get:function(){return this.currentPlayerDiagnosticSnapshot},enumerable:!1,configurable:!0}),LiveStreamStatistic.prototype.registerStatsUpdated=function(l){var d=this;this.currentPlayerDiagnosticSnapshot=l,Object.keys(this.playerDiagnosticsLog).forEach((function(u){var p=u,h=d.playerDiagnosticsLog[p];if(Array.isArray(h)){h.push(l[p]);var g=\"memoryLog\"===p&&h.length>d.maxPlayerMemoryTraceLogCount,f=\"memoryLog\"!==p&&h.length>d.maxPlayerDiagnosticsCount;(g||f)&&h.splice(0,1)}else d.playerDiagnosticsLog[p]=l[p]}))},LiveStreamStatistic.prototype.registerPlayerLoadAttempt=function(){this.registerScenario(\"Load\")},LiveStreamStatistic.prototype.registerPlayerLoadSucceeded=function(){this.completeScenario(\"Load\")},LiveStreamStatistic.prototype.registerPlayerLoadFailed=function(l){this.completeScenario(\"Load\",l)},LiveStreamStatistic.prototype.registerSetSourceAttempt=function(){this.registerScenario(\"SetSource\")},LiveStreamStatistic.prototype.registerSetSourceSucceeded=function(){this.completeScenario(\"SetSource\")},LiveStreamStatistic.prototype.registerSetSourcedFailed=function(l){this.completeScenario(\"SetSource\",l)},LiveStreamStatistic.prototype.registerSdnPluginLoad=function(l,d){this.registerScenario(\"SdnPluginLoad\",l);var u=d?void 0:\"script load failed\";this.completeScenario(\"SdnPluginLoad\",u)},LiveStreamStatistic.prototype.registerPlayerDestroyed=function(){this.registerScenario(\"Destroyed\"),this.completeScenario(\"Destroyed\")},LiveStreamStatistic.prototype.registerPlaybackStateChanged=function(l){this.registerPlaybackEvent(\"StateChanged\",l)},LiveStreamStatistic.prototype.registerPlaybackError=function(l,d){this.registerPlaybackEvent(\"Error\",{errorType:l,details:d})},LiveStreamStatistic.prototype.registerDownloadBitratechanged=function(l){this.registerPlaybackEvent(\"BitrateChangedDownload\",l)},LiveStreamStatistic.prototype.registerPlaybackBitratechanged=function(l){this.registerPlaybackEvent(\"BitrateChangedPlayback\",l)},LiveStreamStatistic.prototype.registerPotentialMediaFreeze=function(l){this.registerPlaybackEvent(\"PotentialMediaFreeze\",l)},LiveStreamStatistic.prototype.registerCaptionToggle=function(l,d,u){var p={isEnabled:l,culture:d,playerTime:u};this.registerPlaybackEvent(\"CaptionsToggled\",p)},LiveStreamStatistic.prototype.registerFullScreenChange=function(l){this.registerPlaybackEvent(\"FullscreenChanged\",l)},LiveStreamStatistic.prototype.registerMute=function(l){this.registerPlaybackEvent(\"Mute\",l)},LiveStreamStatistic.prototype.registerVolumeChange=function(l){this.registerPlaybackEvent(\"Volume\",l)},LiveStreamStatistic.prototype.getReport=function(l){var d,u,g;void 0===l&&(l={});var f=this.playerEvents.map((function(l){return l.getTelemetryEvent()})),m=this.playbackEvents;return p(p(p(p(p({configIds:l.configIds||\"\",correlationId:l.correlationId||\"\",eTag:l.eTag||\"\",isFinal:null!==(d=l.isFinal)&&void 0!==d&&d,isIframe:1===this.config.loadType,isOverflow:null!==(u=l.overflow)&&void 0!==u&&u,isFullscreenButtonDisabled:null!==(g=l.disableFullscreenButton)&&void 0!==g&&g,threadId:l.threadId||\"\",telemetryTickMs:this.playerDiagnosticSnapshot?this.playerDiagnosticSnapshot.statsInterval:-1,tsCallingVersion:(0,h.getTsCallingVersion)()||\"\"},this.getInitializationReport(f,m)),this.getPlaybackReport(m)),this.getBitrateReport(m)),this.getSdnReport(f)),this.getPlayerDiagnosticLog())},LiveStreamStatistic.prototype.registerPlaybackEvent=function(l,d){var u={eventType:l,timestamp:Date.now(),currentPlayPosition:this.playerDiagnosticSnapshot?this.playerDiagnosticSnapshot.currentPlayPosition:-1};void 0!==d&&(u.payload=this.prepareForTelemetry(d)),this.playbackEvents.push(u),this.playbackEvents.length>this.maxPlayerPlaybackEventCount&&this.playbackEvents.splice(0,1),this.logTelemetryEvent(u)},LiveStreamStatistic.prototype.getPlayerDiagnosticLog=function(){var l=this;if(!this.playerDiagnosticSnapshot)return{};var d=this.playerDiagnosticSnapshot,u=this.playerDiagnosticsLog,h=p(p({},d),u),g={};return Object.keys(h).forEach((function(d){g[\"player_\".concat(d)]=l.prepareForTelemetry(h[d])})),g},LiveStreamStatistic.prototype.getInitializationReport=function(l,d){var u=l.find((function(l){return\"Load\"===l.name})),p=d.find((function(l){return\"StateChanged\"===l.eventType&&\"Ready\"===l.payload}));return{init_timeLoadToReady:(u&&p?p.timestamp-u.startTime:-1)||-1,init_allEvents:this.prepareForTelemetry(l)}},LiveStreamStatistic.prototype.getPlaybackReport=function(l){var d=l.filter((function(l){return\"StateChanged\"===l.eventType})),u=d.find((function(l){return\"Ready\"===l.payload})),p=d.find((function(l){return\"Play\"===l.payload})),h=d.find((function(l){return\"Start\"===l.payload})),g=d.find((function(l){return\"Playing\"===l.payload})),f=u&&p?p.timestamp-u.timestamp:-1,m=p&&h?h.timestamp-p.timestamp:-1,v=h&&g?g.timestamp-h.timestamp:-1,y=d.filter((function(l){return\"Seeked\"===l.payload})),S=d.filter((function(l){return\"Seeking\"===l.payload})),_=d.filter((function(l){return\"Paused\"===l.payload})),C=d.filter((function(l){return\"Resume\"===l.payload})),E=d.filter((function(l){return\"Buffering\"===l.payload})),T=[\"BitrateChangedDownload\",\"BitrateChangedPlayback\",\"Error\",\"Mute\",\"StateChanged\",\"Volume\"],b=l.filter((function(l){return\"Error\"===l.eventType})),I=l.filter((function(l){return\"Volume\"===l.eventType||\"Mute\"===l.eventType})),A=l.filter((function(l){return!T.includes(l.eventType)}));return{playback_timeReadyToPlay:f,playback_timePlayToStart:m,playback_timeStartToPlaying:v,playback_bufferingEvents:this.prepareForTelemetry(E),playback_errorEvents:this.prepareForTelemetry(b),playback_pauseEvents:this.prepareForTelemetry(_),playback_resumeEvents:this.prepareForTelemetry(C),playback_otherEvents:this.prepareForTelemetry(A),playback_seekedEvents:this.prepareForTelemetry(y),playback_seekingEvents:this.prepareForTelemetry(S),playback_stateChangeEvents:this.prepareForTelemetry(d),playback_volumeEvents:this.prepareForTelemetry(I)}},LiveStreamStatistic.prototype.getBitrateReport=function(l){var d=l.filter((function(l){return\"BitrateChangedDownload\"===l.eventType})),u=d.sort((function(l){return Number(l.payload)})),h=d.length?{bitrate_downloadChanges:this.prepareForTelemetry(d),bitrate_downloadChangeCount:d.length||-1,bitrate_downloadMin:u[0].payload||-1,bitrate_downloadMax:u[u.length-1].payload||-1}:{},g=l.filter((function(l){return\"BitrateChangedPlayback\"===l.eventType})),f=g.sort((function(l){return Number(l.payload)})),m=g.length?{bitrate_playbackChanges:this.prepareForTelemetry(g),bitrate_playbackChangeCount:g.length||-1,bitrate_playbackMin:f[0].payload||-1,bitrate_playbackMax:f[f.length-1].payload||-1}:{};return p(p({},h),m)},LiveStreamStatistic.prototype.getSdnReport=function(l){var d=l.filter((function(l){return\"SdnPluginLoad\"===l.name})),u=d.length?d[d.length-1]:void 0;return{sdn_loaded:!(!u||void 0!==u.failReason),sdn_details:u&&u.details||\"\",sdn_error:u&&u.failReason||\"\",sdn_events:this.prepareForTelemetry(d)}},LiveStreamStatistic.prototype.registerScenario=function(l,d){g.assert(!this.currentScenarioMap.has(l),\"previous scenario is not completed\");var u=new f(l,d);this.currentScenarioMap.set(l,u),this.playerEvents.push(u)},LiveStreamStatistic.prototype.completeScenario=function(l,d){var u=this.currentScenarioMap.get(l);g.assert(u,\"no scenario to complete\"),d?u.fail(d):u.complete(),this.currentScenarioMap.delete(l)},LiveStreamStatistic.prototype.logTelemetryEvent=function(l){this.config.debug&&(this.logger.debug(\"PlayerTelemetryEvent: \".concat(JSON.stringify(l))),this.logger.debug(\"PlayerDiagnosticData: \".concat(JSON.stringify(this.playerDiagnosticSnapshot))))},LiveStreamStatistic.prototype.prepareForTelemetry=function(l){return\"boolean\"==typeof l?l:\"string\"==typeof l||void 0===l?l||\"\":\"number\"==typeof l?null!=l?l:-1:JSON.stringify(l)},LiveStreamStatistic}();d.LiveStreamStatistic=m},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.LiveStreamConfigProvider=void 0;var h=u(8),g=u(19),f={src:[\"//amp.azure.net/libs/amp/2.3.8.4/azuremediaplayer.min.js\",\"https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.js\"],css:[\"https://amsglob0cdnstream13.azureedge.net/1-0-3013-17/bundles/player-skin.min.css\",\"https://statics.teams.cdn.office.net/evergreen-assets/broadcast/video-player.css?v=2\"],styles:[\"azuremediaplayer\",\"amp-stream-skin\",\"amp-big-play-centered\"],lang:\"en-us\",disableFullscreenButton:!1},m=function(){function LiveStreamConfigProvider(l,d,u,p){this.clientSettings=d,this.configIds=u,this.logger=p,this.settings=getSettings(),this.logger.info(\"client settings: \".concat(JSON.stringify(this.clientSettings))),this.settings.debug=!!d&&d.debug,h.mergeWith(this.settings,l,arrayMergeCustomizer),this.logger.info(\"applied settings: \".concat(JSON.stringify(this.settings)))}return Object.defineProperty(LiveStreamConfigProvider.prototype,\"playerConfig\",{get:function(){return this.clientSettings&&this.clientSettings.playerConfig?this.clientSettings.playerConfig:f},enumerable:!1,configurable:!0}),Object.defineProperty(LiveStreamConfigProvider.prototype,\"config\",{get:function(){return this.settings},enumerable:!1,configurable:!0}),LiveStreamConfigProvider}();d.LiveStreamConfigProvider=m;var v=function(){function PlatfromSettings(){this.defaultSettings={staleDataTimeLimitInSec:30,loadType:1,allowSdnPlugins:!0,useBrowserWindowSizeForBitRate:!0,techOrder:[\"azureHtml5JS\",\"html5\"],textTrackKind:\"subtitles\",streamingUrlSwitchMaxCount:2,ampErrorCodesEligibleForStreamingUrlSwitch:[4194309,2097564,2097556,2097752,2097753,5242884],maxRetryCount:10,sourceResetTimeoutInMs:1e3,sendInitialTelemetryAfterMs:6e4,maxPlayerPlaybackEventCount:50,playerTelemetryTickMs:1e3,maxPlayerDiagnosticsCount:50,maxPlayerMemoryTraceLogCount:1e3,sendTelemetry:!0,removeEmptyDefaultTextTrack:!0,hlsCurrentTimeJumpDuration:2,timeoutForSkippingSegments:1e3,timeoutForSwitchingUrl:2e3}}return PlatfromSettings.prototype.getSettings=function(){return this.defaultSettings},PlatfromSettings}(),y=function(l){function SafariSettings(){var d=l.call(this)||this;return d.settings=l.prototype.getSettings.call(d),d.settings.loadType=0,d.settings.allowSdnPlugins=!1,d}return p(SafariSettings,l),SafariSettings.prototype.getSettings=function(){return this.settings},SafariSettings}(v);function getSettings(){var l;switch((0,g.getBrowserInfo)().engine){case\"Safari\":l=new y;break;default:l=new v}return l.getSettings()}function arrayMergeCustomizer(l,d){if(h.isArray(l))return d.slice()}},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var h=u(18),g=function(l){function NoopDeviceManager(){var d=null!==l&&l.apply(this,arguments)||this;return d.isAudioOutputSelectionSupported=!1,d}return p(NoopDeviceManager,l),NoopDeviceManager.prototype.createAudioRenderer=function(){return null},NoopDeviceManager.prototype.getRawInputAudioStreamTrack=function(){return Promise.resolve(null)},NoopDeviceManager.prototype.disposeRawInputStreamTrack=function(){},NoopDeviceManager.prototype.getRawInputVideoStreamTrack=function(){return Promise.resolve(null)},NoopDeviceManager.prototype.disposeRawInputVideoStreamTrack=function(){},NoopDeviceManager.prototype.askDevicePermission=function(){return Promise.resolve({audio:!1,video:!1})},NoopDeviceManager.prototype.getPermissionState=function(l){return\"granted\"},NoopDeviceManager.prototype.enumerateDevicesAsync=function(){return Promise.resolve([])},NoopDeviceManager.prototype.getPreferredCamera=function(){return null},NoopDeviceManager.prototype.selectDevices=function(){},NoopDeviceManager.prototype.getSelectedDevices=function(){return{}},NoopDeviceManager.prototype.createPreview=function(){return Promise.resolve(new f)},NoopDeviceManager.prototype.createPreviewRenderer=function(){return Promise.resolve(new f)},NoopDeviceManager.prototype.createScreenSharingPreviewRenderer=function(){return Promise.resolve(new f)},NoopDeviceManager.prototype.getDeviceNameAsync=function(){return Promise.resolve(\"\")},NoopDeviceManager.prototype.setDeviceEffectsAsync=function(){return Promise.resolve()},NoopDeviceManager.prototype.getDeviceEffectsCapabilityAsync=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.setBackgroundImageAsync=function(){return Promise.resolve()},NoopDeviceManager.prototype.getImagePropertyAsync=function(){return Promise.resolve({width:0,height:0,uri:\" \"})},NoopDeviceManager.prototype.getMicrophoneGeometryArrayInfoAsync=function(l){return Promise.resolve({})},NoopDeviceManager.prototype.transformImageAsync=function(){return Promise.resolve(!1)},NoopDeviceManager.prototype.sendMessageDeviceVideoEffectsAsync=function(){return Promise.resolve({code:0})},NoopDeviceManager.prototype.sendMessageDeviceVideoExtensibilityAsync=function(){return Promise.resolve({code:0,type:\"Error\",response:{details:\"The API has not been implemented.\"}})},NoopDeviceManager.prototype.setVideoCaptureConfigAsync=function(){return Promise.resolve()},NoopDeviceManager.prototype.setAudioProcessingFlags=function(l){},NoopDeviceManager.prototype.getSpeakerVolume=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.getSpeakerSystemVolume=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.setSpeakerVolume=function(l){return Promise.resolve()},NoopDeviceManager.prototype.setSpeakerSystemVolume=function(l){return Promise.resolve()},NoopDeviceManager.prototype.unmuteMicrophone=function(){return Promise.resolve()},NoopDeviceManager.prototype.unmuteSpeaker=function(){return Promise.resolve()},NoopDeviceManager.prototype.getNrgLevelsForDeviceTuner=function(l){return Promise.resolve(0)},NoopDeviceManager.prototype.getAudioFeatureCapability=function(l){return Promise.resolve(0)},NoopDeviceManager.prototype.getMicrophoneVolume=function(){return Promise.resolve(0)},NoopDeviceManager.prototype.setMicrophoneVolume=function(l){return Promise.resolve()},NoopDeviceManager.prototype.setDeviceTelemetryData=function(l,d,u){return Promise.resolve()},NoopDeviceManager.prototype.getSpeakerDeviceDomIdAsync=function(l,d){return Promise.reject()},NoopDeviceManager.prototype.getSourceFormats=function(l){return Promise.resolve([])},NoopDeviceManager.prototype.enableShellSharing=function(){return Promise.resolve()},NoopDeviceManager.prototype.disableShellSharing=function(){return Promise.resolve()},NoopDeviceManager.prototype.enableParticipantCameras=function(){return Promise.resolve()},NoopDeviceManager.prototype.startAudioLoopbackDevice=function(l){return Promise.resolve()},NoopDeviceManager}(h.default);d.default=g;var f=function(l){function NoopRenderer(){var d=null!==l&&l.apply(this,arguments)||this;return d.isRendering=!1,d.streamSize={width:0,height:0},d.rendererType=-1,d.frameType=-1,d}return p(NoopRenderer,l),NoopRenderer.prototype.captureFrame=function(){return Promise.resolve(new m)},NoopRenderer.prototype.getStats=function(){return Promise.resolve({framesDropped:0,framesTotal:0})},NoopRenderer.prototype.setScalingMode=function(){return Promise.resolve()},NoopRenderer.prototype.dumpVideoSourceImages=function(){return Promise.resolve(0)},NoopRenderer.prototype.cameraAutoControl=function(l){return Promise.resolve(!1)},NoopRenderer.prototype.getCameraManualControlStates=function(l){return Promise.resolve([])},NoopRenderer.prototype.setCameraManualControlStates=function(l){return Promise.resolve([])},NoopRenderer.prototype.enumerateCameraManualControls=function(){return Promise.resolve([])},NoopRenderer.prototype.dispose=function(){},NoopRenderer}(h.default),m=function(l){function NoopVideoFrame(){return null!==l&&l.apply(this,arguments)||this}return p(NoopVideoFrame,l),NoopVideoFrame.prototype.getSize=function(){return{width:0,height:0}},NoopVideoFrame.prototype.isMirrored=function(){return!1},NoopVideoFrame}(h.default)},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)},h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.build=d.RelayManager=void 0;var f=u(8),m=u(1),v='\"rtcmedia\"',y={Service:{url:\"https://edge.skype.com/trap\",tokenUrl:\"https://edge.skype.com/trap/tokens\",disabled:!1},Relay:{addresses:[\"13.107.8.2\"],tcpPort:443,udpPort:3478,Lync:{addresses:[\"mr.skype.net\"],fqdns:[],tcpPort:443,udpPort:3478},Skype:{addresses:[\"13.107.8.2\"],fqdns:[],tcpPort:443,udpPort:3478},Turn:{addresses:[\"52.113.193.12\"],fqdns:[\"euaz.relay.teams.microsoft.com\"],tcpPort:443,udpPort:3478,tlsPort:443,realm:\"rtcmedia\",url:\"https://eu.turn.skype.com/relay\"}},Token:{earlyRefreshMinutes:60,earlyRefreshPercentage:50}};function getRelayCredentials(l){return{expires:l.expires,username:l.username,password:l.password,realm:l.realm}}var S=function(){function TimeCounter(){this.reports={}}return TimeCounter.prototype.watch=function(l){var d={time:Date.now(),duration:-1};return this.reports[l]&&(l=\"\".concat(l,\"_last\")),this.reports[l]=d,{end:function(l){l?d.error=l:d.duration=Date.now()-d.time}}},TimeCounter.prototype.getReports=function(){return this.reports},TimeCounter}(),_=\"configFetch\",C=\"skypeTokenFetch\",E=\"trapTokenFetch\",T=function(){function RelayManager(l){this.updateRelaysPromise=null,this.config=f.cloneDeep(y),this.trapTokens={},this.timers=new S,this.context=l,this.logger=l.logger.createChild(\"RM\"),this.request=l.request}return RelayManager.prototype.initialize=function(){this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync(!0))},RelayManager.prototype.queryRelaysAsync=function(l){return void 0===l&&(l={}),h(this,void 0,void 0,(function(){var d;return g(this,(function(u){switch(u.label){case 0:return this.logger.info(\"query relays\"),this.updateRelaysPromise||(this.updateRelaysPromise=this.updateRelaysFromConfigAsync()),[4,this.updateRelaysPromise];case 1:return(d=u.sent())?\"turn\"===l.relayType?[2,d.Turn]:[2,l.isRemoteClientLync?d.Lync:d.Skype]:[2,[]]}}))}))},RelayManager.prototype.getStats=function(){return this.timers.getReports()},RelayManager.prototype.updateRelaysFromConfigAsync=function(l){var d=this;void 0===l&&(l=!1);var u=this.getConfigAsync().then((function(){return d.updateRelaysAsync()})).then((function(l){return d.updateRelaysPromise=u,l})).catch((function(u){return d.updateRelaysPromise=null,l?d.logger.warn(\"failed to retrieve relays\",m.stringifyObject(u)):d.logger.error(\"failed to retrieve relays\",m.stringifyObject(u)),null}));return u},RelayManager.prototype.refreshRelaysFromConfig=function(){this.request.isOnline()?this.updateRelaysFromConfigAsync():(this.updateRelaysPromise=null,this.logger.warn(\"not refreshing relays due to no network connection\"))},RelayManager.prototype.updateRelaysAsync=function(){var l,d=this,u=this.config.Service.tokenUrl,fetchTrapTokenThroughProvider=function(){return h(d,void 0,void 0,(function(){return g(this,(function(d){return l=this.timers.watch(E),[2,this.context.trapTokenCredentialsProvider()]}))}))},fetchTrapTokenDirectly=function(){return h(d,void 0,void 0,(function(){var d,p,h;return g(this,(function(g){switch(g.label){case 0:d=this.timers.watch(C),p=\"\",g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.context.tokenProvider()];case 2:return p=g.sent(),this.logger.info(\"skypeToken fetched\"),[3,4];case 3:throw h=g.sent(),d.end(m.stringifyObject(h)),h;case 4:return d.end(),l=this.timers.watch(E),[4,this.request.get(u,{headers:{\"X-Skypetoken\":p,\"api-version\":2}})];case 5:return[2,g.sent().response]}}))}))},f=this.context.trapTokenCredentialsProvider?fetchTrapTokenThroughProvider:fetchTrapTokenDirectly;return this.logger.info(\"Fetch TRAP token \".concat(this.context.trapTokenCredentialsProvider?\"with provider\":\"directly\")),f().then((function(u){l.end();var h=0,g=d.config.Token.earlyRefreshMinutes,f=d.config.Token.earlyRefreshPercentage;d.storeTrapTokens(u),h=Math.max(u.expires-60*g,u.expires*f/100),setTimeout(d.refreshRelaysFromConfig.bind(d),1e3*h);var m=d.config.Relay.Turn.realm?d.config.Relay.Turn.realm:v,y=getRelayCredentials(d.getTrapToken(m)),S={Skype:[p({addresses:d.config.Relay.Skype.addresses,fqdns:d.config.Relay.Skype.fqdns,tcpPort:d.config.Relay.Skype.tcpPort,udpPort:d.config.Relay.Skype.udpPort,type:\"msturn\"},y)],Lync:[p({addresses:d.config.Relay.Lync.addresses,fqdns:d.config.Relay.Lync.fqdns,tcpPort:d.config.Relay.Lync.tcpPort,udpPort:d.config.Relay.Lync.udpPort,type:\"msturn\"},y)],Turn:[p({addresses:d.config.Relay.Turn.addresses,fqdns:d.config.Relay.Turn.fqdns,tcpPort:d.config.Relay.Turn.tcpPort,udpPort:d.config.Relay.Turn.udpPort,tlsPort:d.config.Relay.Turn.tlsPort,type:\"turn\"},y)]};return d.logger.info(\"relays from trap\",S),S})).catch((function(d){throw l&&l.end(m.stringifyObject(d)),d}))},RelayManager.prototype.storeTrapTokens=function(l){if(l&&l.tokens){var d={};l.tokens.forEach((function(u){d[u.realm]={expires:l.expires,username:u.username,password:u.password,realm:u.realm}})),this.trapTokens=d}else this.logger.error(\"failed to get tokens from trap response\")},RelayManager.prototype.getTrapToken=function(l){if(\"string\"==typeof l){var d=l.replace(/^\"|\"$/g,\"\"),u='\"'.concat(d,'\"'),p=this.trapTokens[u]||this.trapTokens[d];if(p)return p}throw new Error(\"token for relay not found, realm: \".concat(l))},RelayManager.prototype.getConfigAsync=function(){var l=this;this.logger.info(\"retrieving configuration\");var d=this.timers.watch(_);return this.context.configProvider().then((function(u){d.end(),l.logger.info(\"retrieved configuration:\",u),l.config=f.cloneDeep(y),f.mergeWith(l.config,u,(function(d,u){if(f.isArray(u))return u.map((function(d){var u=f.trim(d);return d!==u&&l.logger.warn(\"MDN_TRAP config got santizied '\".concat(d,\"'->'\").concat(u,\"'\")),u}))})),l.logger.info(\"applied configuration:\",l.config)})).catch((function(u){l.logger.warn(\"failed to retrieve configuration\",m.stringifyObject(u)),d.end(m.stringifyObject(u))}))},RelayManager}();function build(l){return new T(l)}d.RelayManager=T,d.build=build},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.initLogger=void 0;var p=u(33),h=u(109),g=u(477),f=u(478);function initLogger(l,d){if(!p.RootToolsManager.isDelegateSet()){var u=new f.RootToolsManagerDelegate(l.telemetryService,d);if(p.RootToolsManager.setDelegate(u),l.logger){var m=new g.RedirectingLogAppender(l.logger);p.LogFactory.instance().addAppender(m)}}l.logger=new h.TsCallingLogger(\"JS.TsCalling.Pluginless\",!0),l.mediaAgentFactoryConfig.logger=new h.TsCallingLogger(\"JS.TsCalling.MediaAgentUnsafe\",!1),l.mediaAgentFactoryConfig.safeLogger=new h.TsCallingLogger(\"JS.TsCalling.MediaAgent\",!0),l.signalingAgentConfig.logger=new h.TsCallingLogger(\"JS.TsCalling.SignalingAgent\",!0)}d.initLogger=initLogger},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0}),d.RedirectingLogAppender=void 0;var h=u(33),g=function(l){function RedirectingLogAppender(d){var u=l.call(this,new h.StandardLogFormatter(h.SLF_Flags.Component))||this;return u._logger=d,u}return p(RedirectingLogAppender,l),RedirectingLogAppender.prototype.log=function(l,d,u,p){if(this._logger){var g=l.level<=h.LogLevel.Debug4?this._logger.debug:l.level<=h.LogLevel.Debug2?this._logger.log:l.level<=h.LogLevel.Debug1?this._logger.info:l.level<=h.LogLevel.Warning?this._logger.warn:this._logger.error;g&&g.apply(this._logger,[this.formatter().format(l,d,u,p)])}},RedirectingLogAppender}(h.AbstractLogAppender);d.RedirectingLogAppender=g},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.RootToolsManagerDelegate=void 0;var p=u(33),h=u(479),g=function(){function RootToolsManagerDelegate(l,d){this._telemetryService=l,this._ecsProvider=d,this._ecsProvider.on(\"OnECSChanged\",(function(){return p.RootToolsManager.OnEcsChange()}))}return RootToolsManagerDelegate.prototype.fetchEcsConfig=function(l,d){var u=this;return h.Resolved().then((function(){return u._ecsProvider.getEcsConfig(l,d)}))},RootToolsManagerDelegate.prototype.sendTelemetry=function(l,d){this._telemetryService.getGenericTelemetryLogger&&l?this._telemetryService.getGenericTelemetryLogger(l).sendEvent({eventName:\"rt_log\",props:d}):this._telemetryService.sendEvents([{eventName:\"rt_log\",props:d}])},RootToolsManagerDelegate}();d.RootToolsManagerDelegate=g},function(l,d,u){(function(l){function fromThenable(l){var d=Defer();return l.then((function(l){d.resolve(l)}),(function(l){d.reject(l)})),d.promise().thenAsync((function(l){return l}))}function isThenable(l){return null!=l&&\"function\"==typeof l.then}function isCancelable(l){return null!=l&&\"function\"==typeof l.cancel}function run(l,u){if(!d.config.catchExceptions)return l();try{return l()}catch(l){return u(l)}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(l){throw l}},d.fromThenable=fromThenable;var u,p=[],h=void 0!==l;function asyncCallback(d){p.push(d),1===p.length&&(h?l(resolveAsyncCallbacks):setTimeout(resolveAsyncCallbacks,0))}function resolveAsyncCallbacks(){var l=p;p=[];for(var d=0;d<l.length;d++)l[d]()}function all(l){if(0===l.length)return Resolved([]);var d,p=Defer(),h=l.length,g=Array(l.length);p.onCancel((function(d){l.forEach((function(l){isCancelable(l)&&u.SyncTask.cancelOtherInternal(l,d)}))}));var checkFinish=function(){0==--h&&(void 0!==d?p.reject(d):p.resolve(g))};return l.forEach((function(l,u){isThenable(l)?l.then((function(l){g[u]=l,checkFinish()}),(function(l){void 0===d&&(d=void 0===l||l),checkFinish()})):(g[u]=l,checkFinish())})),p.promise()}function Defer(){return new u.SyncTask}function Resolved(l){return(new u.SyncTask).resolve(l).promise()}function Rejected(l){return(new u.SyncTask).reject(l).promise()}function race(l){var d=Defer(),p=!1;return d.onCancel((function(d){l.forEach((function(l){isCancelable(l)&&u.SyncTask.cancelOtherInternal(l,d)}))})),l.forEach((function(l){isThenable(l)?l.then((function(l){p||(p=!0,d.resolve(l))}),(function(l){p||(p=!0,d.reject(l))})):p||(p=!0,d.resolve(l))})),d.promise()}function raceTimer(l,d){var u=Defer(),p=setTimeout((function(){u.resolve({timedOut:!0})}),d);return race([l.then((function(l){return clearTimeout(p),{timedOut:!1,result:l}})),u.promise()])}d.asyncCallback=asyncCallback,function(l){var u=function(){function SyncTask(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return SyncTask.prototype._addCallbackSet=function(l,d){var u=this,p=new SyncTask;return p.onCancel((function(d){l.wasCanceled=!0,l.cancelContext=d,u._cancelInternal(d)})),l.task=p,this._storedCallbackSets.push(l),d?this._mustHandleError=!1:p._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),p.promise()},SyncTask.prototype.onCancel=function(l){return this._completedSuccess||this._completedFail||(this._wasCanceled?l(this._cancelContext):this._cancelCallbacks.push(l)),this},SyncTask.prototype.then=function(l,d){return this._addCallbackSet({successFunc:l,failFunc:d},!0)},SyncTask.prototype.thenAsync=function(l,d){return this._addCallbackSet({successFunc:l,failFunc:d,asyncCallback:!0},!0)},SyncTask.prototype.catch=function(l){return this._addCallbackSet({failFunc:l},!0)},SyncTask.prototype.always=function(l){return this._addCallbackSet({successFunc:l,failFunc:l},!0)},SyncTask.prototype.setTracingEnabled=function(l){return this._traceEnabled=l,this},SyncTask.prototype.finally=function(l){return this._addCallbackSet({successFunc:l,failFunc:l},!1),this},SyncTask.prototype.done=function(l){return this._addCallbackSet({successFunc:l},!1),this},SyncTask.prototype.fail=function(l){return this._addCallbackSet({failFunc:l},!1),this},SyncTask.prototype.resolve=function(l){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=l,this._cancelCallbacks=[],this._resolveSuccesses(),this},SyncTask.prototype.reject=function(l){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=l,this._cancelCallbacks=[],this._resolveFailures(),SyncTask._enforceErrorHandled(this),this},SyncTask.prototype._checkState=function(l){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var u=\"Failed to \"+(l?\"resolve\":\"reject\")+\": the task is already \"+(this._completedSuccess?\"resolved\":\"rejected\");throw new Error(u)}(d.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error(\"resolve\"))},SyncTask._enforceErrorHandled=function(l){l._mustHandleError&&(SyncTask._rejectedTasks.push(l),SyncTask._enforceErrorHandledTimer||(SyncTask._enforceErrorHandledTimer=setTimeout((function(){SyncTask._enforceErrorHandledTimer=void 0;var l=SyncTask._rejectedTasks;SyncTask._rejectedTasks=[],l.forEach((function(l,u){l._mustHandleError&&d.config.unhandledErrorHandler(l._storedErrResolution)}))}),0)))},SyncTask.prototype.cancel=function(l){if(this._wasExplicitlyCanceled)throw new Error(\"Already Canceled\");this._wasExplicitlyCanceled=!0,this._cancelInternal(l)},SyncTask.prototype._cancelInternal=function(l){var d=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=l;var u=this._cancelCallbacks;this._cancelCallbacks=[],u.length>0&&u.forEach((function(l){d._completedSuccess||d._completedFail||l(d._cancelContext)}))}},SyncTask.cancelOtherInternal=function(l,d){var u=l;u._storedCallbackSets&&u._cancelInternal?u._cancelInternal(d):l.cancel(d)},SyncTask.prototype.promise=function(){return this},SyncTask.prototype._resolveSuccesses=function(){var l=this;for(this._resolving=!0;this._storedCallbackSets.length;){var d=this._storedCallbackSets;this._storedCallbackSets=[],d.forEach((function(d){d.asyncCallback?asyncCallback((function(){return l._resolveSuccessCallback(d)})):l._resolveSuccessCallback(d)}))}this._resolving=!1},SyncTask.prototype._resolveSuccessCallback=function(l){var d=this;l.successFunc?run((function(){var u=l.successFunc(d._storedResolution);isCancelable(u)&&(l.wasCanceled?SyncTask.cancelOtherInternal(u,l.cancelContext):l.task.onCancel((function(l){return SyncTask.cancelOtherInternal(u,l)}))),isThenable(u)?u.then((function(d){l.task.resolve(d)}),(function(d){l.task.reject(d)})):l.task.resolve(u)}),(function(u){d._handleException(u,\"SyncTask caught exception in success block: \"+u.toString()),l.task.reject(u)})):l.task.resolve(this._storedResolution)},SyncTask.prototype._resolveFailures=function(){var l=this;for(this._resolving=!0;this._storedCallbackSets.length;){var d=this._storedCallbackSets;this._storedCallbackSets=[],d.forEach((function(d){d.asyncCallback?asyncCallback((function(){return l._resolveFailureCallback(d)})):l._resolveFailureCallback(d)}))}this._resolving=!1},SyncTask.prototype._resolveFailureCallback=function(l){var d=this;l.failFunc?run((function(){var u=l.failFunc(d._storedErrResolution);isCancelable(u)&&(l.wasCanceled?SyncTask.cancelOtherInternal(u,l.cancelContext):l.task.onCancel((function(l){return SyncTask.cancelOtherInternal(u,l)}))),isThenable(u)?u.then((function(d){l.task.resolve(d)}),(function(d){l.task.reject(d)})):l.task.resolve(u)}),(function(u){d._handleException(u,\"SyncTask caught exception in failure block: \"+u.toString()),l.task.reject(u)})):l.task.reject(this._storedErrResolution)},SyncTask.prototype._handleException=function(l,u){d.config.exceptionsToConsole&&console.error(u),d.config.exceptionHandler&&d.config.exceptionHandler(l)},SyncTask.prototype.toEs6Promise=function(){var l=this;return new Promise((function(d,u){return l.then(d,u)}))},SyncTask._rejectedTasks=[],SyncTask}();l.SyncTask=u}(u||(u={})),d.all=all,d.Defer=Defer,d.Resolved=Resolved,d.Rejected=Rejected,d.race=race,d.raceTimer=raceTimer}).call(this,u(480).setImmediate)},function(l,d,u){(function(l){var p=void 0!==l&&l||\"undefined\"!=typeof self&&self||window,h=Function.prototype.apply;function Timeout(l,d){this._id=l,this._clearFn=d}d.setTimeout=function(){return new Timeout(h.call(setTimeout,p,arguments),clearTimeout)},d.setInterval=function(){return new Timeout(h.call(setInterval,p,arguments),clearInterval)},d.clearTimeout=d.clearInterval=function(l){l&&l.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(p,this._id)},d.enroll=function(l,d){clearTimeout(l._idleTimeoutId),l._idleTimeout=d},d.unenroll=function(l){clearTimeout(l._idleTimeoutId),l._idleTimeout=-1},d._unrefActive=d.active=function(l){clearTimeout(l._idleTimeoutId);var d=l._idleTimeout;d>=0&&(l._idleTimeoutId=setTimeout((function onTimeout(){l._onTimeout&&l._onTimeout()}),d))},u(481),d.setImmediate=\"undefined\"!=typeof self&&self.setImmediate||void 0!==l&&l.setImmediate||this&&this.setImmediate,d.clearImmediate=\"undefined\"!=typeof self&&self.clearImmediate||void 0!==l&&l.clearImmediate||this&&this.clearImmediate}).call(this,u(63))},function(l,d,u){(function(l,d){!function(l,u){if(!l.setImmediate){var p,h=1,g={},f=!1,m=l.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(l);v=v&&v.setTimeout?v:l,\"[object process]\"==={}.toString.call(l.process)?installNextTickImplementation():canUsePostMessage()?installPostMessageImplementation():l.MessageChannel?installMessageChannelImplementation():m&&\"onreadystatechange\"in m.createElement(\"script\")?installReadyStateChangeImplementation():installSetTimeoutImplementation(),v.setImmediate=setImmediate,v.clearImmediate=clearImmediate}function setImmediate(l){\"function\"!=typeof l&&(l=new Function(\"\"+l));for(var d=new Array(arguments.length-1),u=0;u<d.length;u++)d[u]=arguments[u+1];var f={callback:l,args:d};return g[h]=f,p(h),h++}function clearImmediate(l){delete g[l]}function run(l){var d=l.callback,p=l.args;switch(p.length){case 0:d();break;case 1:d(p[0]);break;case 2:d(p[0],p[1]);break;case 3:d(p[0],p[1],p[2]);break;default:d.apply(u,p)}}function runIfPresent(l){if(f)setTimeout(runIfPresent,0,l);else{var d=g[l];if(d){f=!0;try{run(d)}finally{clearImmediate(l),f=!1}}}}function installNextTickImplementation(){p=function(l){d.nextTick((function(){runIfPresent(l)}))}}function canUsePostMessage(){if(l.postMessage&&!l.importScripts){var d=!0,u=l.onmessage;return l.onmessage=function(){d=!1},l.postMessage(\"\",\"*\"),l.onmessage=u,d}}function installPostMessageImplementation(){var d=\"setImmediate$\"+Math.random()+\"$\",onGlobalMessage=function(u){u.source===l&&\"string\"==typeof u.data&&0===u.data.indexOf(d)&&runIfPresent(+u.data.slice(d.length))};l.addEventListener?l.addEventListener(\"message\",onGlobalMessage,!1):l.attachEvent(\"onmessage\",onGlobalMessage),p=function(u){l.postMessage(d+u,\"*\")}}function installMessageChannelImplementation(){var l=new MessageChannel;l.port1.onmessage=function(l){runIfPresent(l.data)},p=function(d){l.port2.postMessage(d)}}function installReadyStateChangeImplementation(){var l=m.documentElement;p=function(d){var u=m.createElement(\"script\");u.onreadystatechange=function(){runIfPresent(d),u.onreadystatechange=null,l.removeChild(u),u=null},l.appendChild(u)}}function installSetTimeoutImplementation(){p=function(l){setTimeout(runIfPresent,0,l)}}}(\"undefined\"==typeof self?void 0===l?this:l:self)}).call(this,u(63),u(104))},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(19),h=u(9),g=function(){function PlatformManager(){this.supportedPlatforms=new Map([[\"Chrome\",\"59.0\"],[\"Edge\",\"13.0\"],[\"EdgeAnaheim\",\"79.0\"],[\"Safari\",\"13.1\"],[\"Electron\",\"3.0\"]]),this.experimentalPlatforms=new Map([[\"Firefox\",\"96.0\"]]),this.lightweightSupported=new Set([\"Chrome\",\"Edge\",\"EdgeAnaheim\",\"Firefox\",\"Safari\",\"MSIE\",\"AppleWebView\"])}return PlatformManager.prototype.getPlatformSupportLevel=function(l){var d=(0,p.getBrowserInfo)(),u=this.supportedPlatforms.get(d.name);if(l&&u&&h.isVersionGreaterOrEqual(d.version,u))return 1;if(l&&!u){if(\"Chromium\"===d.engine)return 2;var g=this.experimentalPlatforms.get(d.name);if(g&&h.isVersionGreaterOrEqual(d.version,g))return 2}return this.lightweightSupported.has(d.name)?3:0},PlatformManager}();d.default=g},function(l,d,u){var p=this&&this.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])})(l,d)};return function(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\");function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),h=this&&this.__awaiter||function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(l){return function(d){return step([l,d])}}function step(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=f.trys,(h=h.length>0&&h[h.length-1])||6!==g[0]&&2!==g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(d,\"__esModule\",{value:!0}),d.PluginlessEcsProvider=void 0;var f=u(19),m=u(18),v=u(34),y=u(27),S=function(l){function PluginlessEcsProvider(){var d=null!==l&&l.apply(this,arguments)||this;return d.config=null,d}return p(PluginlessEcsProvider,l),Object.defineProperty(PluginlessEcsProvider.prototype,\"ETag\",{get:function(){return this.etag},enumerable:!1,configurable:!0}),PluginlessEcsProvider.prototype.setEcsConfig=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(d){return this.config=JSON.parse(l.ecsBlob),this.etag=l.etag,this.event(\"OnECSChanged\").raise(),[2]}))}))},PluginlessEcsProvider.prototype.getEcsQueryParameters=function(){return h(this,void 0,void 0,(function(){var l,d,u;return g(this,(function(p){return(l={}).CLRelease=(0,v.getTsCallingVersion)(),d=\"_TS_BUILC_VERSION_\".replace(\"C\",\"D\"),l.CLRelease===d&&(l.CLRelease=\"9999.99\"),u=(0,f.getBrowserInfo)(),l.BrowserName=u.name,l.BrowserEngine=u.engine,l.BrowserVersion=u.version,l.FormFactor=u.formFactor,y.UserAgentConfig.hardwareConcurrency&&(l.CPUCount=y.UserAgentConfig.hardwareConcurrency),[2,JSON.stringify(l)]}))}))},PluginlessEcsProvider.prototype.ecsGetUserQueryParameters=function(l){return h(this,void 0,void 0,(function(){return g(this,(function(l){return[2,this.getEcsQueryParameters()]}))}))},PluginlessEcsProvider.prototype.shouldTriggerCQF=function(l,d,u){return h(this,void 0,void 0,(function(){return g(this,(function(l){throw new Error(\"Not implemented\")}))}))},PluginlessEcsProvider.prototype.getEcsConfig=function(l,d){var u=this.config&&this.config[l];return d?u&&u[d]:u},PluginlessEcsProvider.prototype.createEcsConfiguration=function(){return new(function(){function class_1(l){this.provider=l}return class_1.prototype.getBoolean=function(l,d){return this.provider.getEcsConfig(l,d)},class_1.prototype.getNumber=function(l,d){return this.provider.getEcsConfig(l,d)},class_1.prototype.getString=function(l,d){var u=this.provider.getEcsConfig(l,d);return JSON.stringify(u)},class_1}())(this)},PluginlessEcsProvider}(m.default);d.PluginlessEcsProvider=S},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.signalingAgentProviderFactory=d.SignalingAgentProvider=d.callSignalingAgentEcsNS=void 0;var p=u(33),h=u(92),g=u(34),f=u(485);d.callSignalingAgentEcsNS=\"SkypeCalling\";var m=function(){function SignalingAgentProvider(l,d,u){var f=this;this.signalingAgentConfig=l,this.ecsProvider=d,this.logger=u,this.ecsProvider.on(\"OnECSChanged\",(function(){return f.onEcsUpdate()})),this.signalingAgentConfig.clientInformation+=\"/TsCallingVersion=\".concat((0,g.getTsCallingVersion)(),\"/Ovb=\").concat((0,g.getOvb)()),this.signalingAgentConfig.piiScrubber={omit:p.pii.Omit,mri:p.pii.Mri},this.signalingAgent=new h.SignalingAgent(this.getSignalingAgentConfig())}return SignalingAgentProvider.prototype.getSignalingAgent=function(){return this.signalingAgent},SignalingAgentProvider.prototype.onEcsUpdate=function(){var l=this.ecsProvider.getEcsConfig(d.callSignalingAgentEcsNS);this.logger.info(\"onEcsUpdate, ecsTag=\".concat(this.ecsProvider.ETag||\"\",\", ecsConfig=\").concat(JSON.stringify(l))),this.signalingAgentConfig=(0,f.updateSignalingAgentConfig)(this.signalingAgentConfig,l),this.signalingAgentConfig.ecsEtag=this.ecsProvider.ETag,this.signalingAgent.updateSignalingAgentConfig(this.getSignalingAgentConfig())},SignalingAgentProvider.prototype.getSignalingAgentConfig=function(){return this.signalingAgentConfig.handleRosterFromCreateAndJoin=!0,this.signalingAgentConfig},SignalingAgentProvider}();d.SignalingAgentProvider=m,d.signalingAgentProviderFactory={build:function(l,d,u){return new m(l,d,u)}}},function(l,d,u){var p=this&&this.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.updateSignalingAgentConfig=void 0;var updateSignalingAgentConfig=function(l,d){if(!d)return l;var u=p({},l);if(d.ngIncoming&&d.ngOutgoing){var h=convertScreenSharingFlag(d.ngIncoming.isVBSSEnabled,d.ngOutgoing.isVBSSEnabled);u.cloudScreenSharingFlag=getParam(h,l.cloudScreenSharingFlag)}return d.ngOutgoing&&(u.emergencyCallCountry=convertEmergencyCallCountryFlag(d.ngOutgoing.isEmergencyCallingEnabled,l.emergencyCallCountry),u.isGVCOutgoingEnabled=getParam(d.ngOutgoing.isGVCEnabled,l.isGVCOutgoingEnabled),u.brokerEnabledOutgoing=getParam(d.ngOutgoing.isBrokerEnabled,l.brokerEnabledOutgoing)),d.ngIncoming&&(u.isGVCJoiningEnabled=getParam(d.ngIncoming.isGVCEnabled,l.isGVCJoiningEnabled),u.brokerEnabledIncoming=getParam(d.ngIncoming.isBrokerEnabled,l.brokerEnabledIncoming)),u.conversationServiceUrl=getUrl(d.conversationServiceUrl,l.conversationServiceUrl),u.uploadLogRequestUrl=getUrl(d.uploadLogRequestUrl,l.uploadLogRequestUrl),u.isConversationServiceUrlFromEcs=!!d.conversationServiceUrl,u.isUploadLogRequestUrlFromEcs=!!d.uploadLogRequestUrl,u.doHostlessCalling=getParam(d.allowHostlessCalls,l.doHostlessCalling),u.supportsCompressedServicePayload=getParam(d.supportCompressedTrouterPayload,l.supportsCompressedServicePayload),u.brokerRequestBatching=getParam(d.allowBrokerSubscribeBatching,l.brokerRequestBatching),u.brokerExclusively=getParam(d.brokerExclusively,l.brokerExclusively),u.handleRosterFromCreateAndJoin=getParam(d.handleRosterFromCreateAndJoin,l.handleRosterFromCreateAndJoin),u.handleMediaOfferFromPushNotification=getParam(d.handleMediaOfferFromPushNotification,l.handleMediaOfferFromPushNotification),u.handleNewOfferRequest=getParam(d.handleNewOfferRequest,l.handleNewOfferRequest),u.sendProgressFromCC=getParam(d.sendProgressFromCC,l.sendProgressFromCC),u.handleUnmuteMuteFromResponse=getParam(d.handleUnmuteMuteFromResponse,l.handleUnmuteMuteFromResponse),u.useInternalHttpDispatcher=getParam(d.webInternalHttpDispatcher,l.useInternalHttpDispatcher),(d.webInternalHttpDispatcherConfigNetworkRequest||l.requestTypeHttpDispatcherConfigMap)&&(d.webInternalHttpDispatcherConfigNetworkRequest=d.webInternalHttpDispatcherConfigNetworkRequest||{},l.requestTypeHttpDispatcherConfigMap=l.requestTypeHttpDispatcherConfigMap||{},u.requestTypeHttpDispatcherConfigMap=p(p({},l.requestTypeHttpDispatcherConfigMap),d.webInternalHttpDispatcherConfigNetworkRequest)),(d.operationTypeHttpDispatcherConfigMap||l.operationTypeHttpDispatcherConfigMap)&&(d.operationTypeHttpDispatcherConfigMap=d.operationTypeHttpDispatcherConfigMap||{},l.operationTypeHttpDispatcherConfigMap=l.operationTypeHttpDispatcherConfigMap||{},u.operationTypeHttpDispatcherConfigMap=p(p({},l.operationTypeHttpDispatcherConfigMap),d.operationTypeHttpDispatcherConfigMap)),(d.csaTimeoutConfiguration||l.csaTimeoutConfiguration)&&(d.csaTimeoutConfiguration=d.csaTimeoutConfiguration||{},l.csaTimeoutConfiguration=l.csaTimeoutConfiguration||{},u.csaTimeoutConfiguration=p(p({},l.csaTimeoutConfiguration),d.csaTimeoutConfiguration)),u.overrideDisplayName=getParam(d.overrideDisplayName,l.overrideDisplayName),u.autoJoinOnConflict=getParam(d.autoJoinOnConflict,l.autoJoinOnConflict),u.enableDeltaRosterWeb=getParam(d.enableDeltaRosterWeb,l.enableDeltaRosterWeb),u.processSelfDataFromSubscribeResponse=getParam(d.processSelfDataFromSubscribeResponse,l.processSelfDataFromSubscribeResponse),u.enableMusicOnHoldV2=getParam(d.enableMusicOnHoldV2,l.enableMusicOnHoldV2),u.enablePstnMasking=getParam(d.enablePstnMasking,l.enablePstnMasking),u.enableQuickSendAcceptanceAck=getParam(d.enableQuickSendAcceptanceAck,l.enableQuickSendAcceptanceAck),u.supportMediaRetargetWhileIncomingRenegotiation=getParam(d.supportMediaRetargetWhileIncomingRenegotiation,l.supportMediaRetargetWhileIncomingRenegotiation),u.enableStaging=getParam(d.enableStaging,l.enableStaging),u.enableErrorCodeImprovementsForNetworkFailures=getParam(d.enableErrorCodeImprovementsForNetworkFailures,l.enableErrorCodeImprovementsForNetworkFailures),u.enableMergeParticipantLegsBatchSupport=getParam(d.enableMergeParticipantLegsBatchSupport,l.enableMergeParticipantLegsBatchSupport),u.callingServiceSupportsAADTokens=getParam(d.callingServiceSupportsAADTokens,l.callingServiceSupportsAADTokens),u.enableCallingTokenAPI=getParam(d.enableCallingTokenAPI,l.enableCallingTokenAPI),u.aadTokenExpirationTimeInSeconds=getParam(d.aadTokenExpirationTimeInSeconds,l.aadTokenExpirationTimeInSeconds),u.popTokenExpirationTimeInSeconds=getParam(d.popTokenExpirationTimeInSeconds,l.popTokenExpirationTimeInSeconds),u.refreshTimeBeforeTokenTimeoutInSeconds=getParam(d.refreshTimeBeforeTokenTimeoutInSeconds,l.refreshTimeBeforeTokenTimeoutInSeconds),u};function getParam(l,d){return null==l?d:l}function getUrl(l,d){return l||d}function convertScreenSharingFlag(l,d){return d&&l?\"enabled\":l?\"recvOnly\":!1===l&&!1===d?\"disabled\":void 0}function convertEmergencyCallCountryFlag(l,d){return!1===l?\"\":d}d.updateSignalingAgentConfig=updateSignalingAgentConfig},function(l,d,u){var p=this&&this.__values||function(l){var d=\"function\"==typeof Symbol&&Symbol.iterator,u=d&&l[d],p=0;if(u)return u.call(l);if(l&&\"number\"==typeof l.length)return{next:function(){return l&&p>=l.length&&(l=void 0),{value:l&&l[p++],done:!l}}};throw new TypeError(d?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")};Object.defineProperty(d,\"__esModule\",{value:!0}),d.OneDsTelemetryTransportLogger=void 0;var h=u(489),g=u(488),f=u(1),m=u(28),v=function(){function OneDsTelemetryTransportLogger(l){var d=this;this.settings=l,this.manager=new g.ApplicationInsightsManager,this.managerConfig=this.createConfigForManager(),this.currentTransmitProfile=m.Constants.REPORTING_PROFILE.RT_PROFILE,this.initManager(),this.uiVersion=this.getUiVersion(),this.settings.configProvider.on(\"configUpdated\",(function(){return d.updateChannelConfig()}))}return OneDsTelemetryTransportLogger.prototype.createLogger=function(l){return new y(l,this.manager,this.settings.configProvider,this.uiVersion,this.settings.contextProvider,this.settings.logger)},OneDsTelemetryTransportLogger.prototype.createConfigForManager=function(){var l={extensionConfig:{LocalStorage:{storageKey:\"TsCalling\"}},propertyConfiguration:{populateBrowserInfo:!0,populateOperatingSystemInfo:!0},channelConfiguration:{eventsLimitInMem:this.settings.configProvider.config.eventsLimitInMem},endpointUrl:this.settings.configProvider.config.collectorUrl,enableCompoundKey:this.settings.configProvider.config.enableCompoundKey};if(this.settings.configProvider.config.useLocalStorageForOneDs){var d=new h.LocalStorageChannel;l.channels=[[d]]}return l},OneDsTelemetryTransportLogger.prototype.getUiVersion=function(){var l=this.settings.clientInfo.match(/^.*?\\/(\\d+\\/)(.*?)\\/.*$/);return l?l[1]+l[2]:this.settings.clientInfo},OneDsTelemetryTransportLogger.prototype.updateChannelConfig=function(){this.settings.configProvider.config.eventsLimitInMem!==this.managerConfig.channelConfiguration.eventsLimitInMem&&this.manager.getPostChannel().setEventQueueLimits(this.settings.configProvider.config.eventsLimitInMem),this.setTransmitProfile()},OneDsTelemetryTransportLogger.prototype.initManager=function(){var l=this;this.manager.create(this.managerConfig,[]),this.manager.getPostChannel()._notificationManager.addNotificationListener({eventsDiscarded:function(d,u){return l.logDiscardedEvents(d,u)},eventsSent:function(d){return l.logSentEvents(d)}}),this.setTransmitProfile()},OneDsTelemetryTransportLogger.prototype.logDiscardedEvents=function(l,d){var u=\"discarded events:\";l.forEach((function(l){return u=\"\".concat(u+l.name,\";\")})),this.settings.logger.info(\"\".concat(u,\" reason:\").concat(d))},OneDsTelemetryTransportLogger.prototype.logSentEvents=function(l){var d=l[0]&&l[0].data&&l[0].data.CorrelationId&&f.getFrom(\"value\",l[0].data.CorrelationId),u=\"sent events: \".concat(d,\":\");l.forEach((function(l){u=\"\".concat(u+l.name,\";\")})),this.settings.logger.info(\"\".concat(u))},OneDsTelemetryTransportLogger.prototype.setTransmitProfile=function(){var l;this.settings.configProvider.config.transmitProfileTimings.length&&this.manager.getPostChannel()._loadTransmitProfiles(((l={})[this.settings.configProvider.config.transmitProfileName]=this.settings.configProvider.config.transmitProfileTimings,l)),this.settings.configProvider.config.transmitProfileName!==this.currentTransmitProfile&&this.manager.getPostChannel()._setTransmitProfile(this.settings.configProvider.config.transmitProfileName),this.currentTransmitProfile=this.settings.configProvider.config.transmitProfileName},OneDsTelemetryTransportLogger}();d.OneDsTelemetryTransportLogger=v;var y=function(){function OneDsTelemetryTransport(l,d,u,p,h,g){this.tenant=l,this.configProvider=u,this.uiVersion=p,this.contextProvider=h,this.logger=g,this.instanceConfig={extensions:[],extensionConfig:[]},this.manager=d,this.telemetryLoggerName=l}return OneDsTelemetryTransport.prototype.sendEvent=function(l){var d,u,h=l.props&&l.props.CorrelationId?l.props.CorrelationId:\"\";this.setEnvPropertiesToEveryEvent();var f=this.getLogger(),m=l.props,v={};this.logger.info(\"preparing event for delievery: \".concat(h,\"/\").concat(l.eventName)),\"signaling\"===this.tenant&&(m.SkypeId&&(this.addPropertiesToEvent(v,\"user_id\",m.SkypeId,10),this.addPropertiesToEvent(v,\"Skype_InitiatingUser_Username\",m.SkypeId,10),this.addPropertiesToEvent(v,\"SkypeId\",m.SkypeId,10),delete m.SkypeId),this.uiVersion&&this.addPropertiesToEvent(v,\"ui_version\",this.uiVersion,0)),\"media\"===this.tenant&&this.uiVersion&&this.addPropertiesToEvent(v,\"uiVersion\",this.uiVersion,0),\"tlePlayer\"===this.tenant&&this.uiVersion&&this.addPropertiesToEvent(v,\"uiVersion\",this.uiVersion,0);try{for(var y=p(Object.keys(m)),S=y.next();!S.done;S=y.next()){var _=S.value,C=m[_],E=C&&C.piiKind?C.piiKind:0,T=C&&C.hasOwnProperty(\"value\")?C.value:C;this.addPropertiesToEvent(v,_,T,E)}}catch(l){d={error:l}}finally{try{S&&!S.done&&(u=y.return)&&u.call(y)}finally{if(d)throw d.error}}var b={name:l.eventName,data:v,latency:g.EventLatency.Normal,persistence:g.EventPersistence.Normal};this.configProvider.config.useSendBeaconSync&&(b.sync=2),this.logger.info(\"about to send event \".concat(JSON.stringify(b))),f.track(b)},OneDsTelemetryTransport.prototype.setEnvPropertiesToEveryEvent=function(){var l=this,d=this.contextProvider&&this.contextProvider();f.deepEqual(this.ctx,d)||(this.ctx=d,f.keys(this.ctx).forEach((function(d){var u=l.ctx[d].piiKind?l.ctx[d].piiKind:0;l.manager.getPropertyManager().setProperty(d,{value:l.ctx[d].value,kind:u})})))},OneDsTelemetryTransport.prototype.addPropertiesToEvent=function(l,d,u,p){var h={value:u,kind:p};l[d]=h},OneDsTelemetryTransport.prototype.getLogger=function(){var l=this.configProvider.config.telemetryTenants[this.telemetryLoggerName],d=this.manager.getInst(l);return d||(d=this.manager.newInst(this.configProvider.config.telemetryTenants[this.telemetryLoggerName],this.instanceConfig,[]))},OneDsTelemetryTransport}()},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.generateCauseId=d.getVersion=d.getOvb=d.pluginlessStackFactory=d.HttpRequestDispatcherImplementation=void 0;var p=u(77);Object.defineProperty(d,\"HttpRequestDispatcherImplementation\",{enumerable:!0,get:function(){return p.HttpRequestDispatcher}});var h=u(173);Object.defineProperty(d,\"pluginlessStackFactory\",{enumerable:!0,get:function(){return h.pluginlessStackFactory}});var g=u(34);Object.defineProperty(d,\"getOvb\",{enumerable:!0,get:function(){return g.getOvb}}),Object.defineProperty(d,\"getVersion\",{enumerable:!0,get:function(){return g.getTsCallingVersion}});var f=u(13);Object.defineProperty(d,\"generateCauseId\",{enumerable:!0,get:function(){return f.generateCauseId}})},function(l,d,u){u.r(d),u.d(d,\"ApplicationInsightsManager\",(function(){return dn})),u.d(d,\"ApplicationInsights\",(function(){return un})),u.d(d,\"OverridePropertiesPlugin\",(function(){return cn})),u.d(d,\"PostChannel\",(function(){return Kt})),u.d(d,\"BE_PROFILE\",(function(){return je})),u.d(d,\"NRT_PROFILE\",(function(){return Ue})),u.d(d,\"RT_PROFILE\",(function(){return Fe})),u.d(d,\"PropertiesPlugin\",(function(){return xe})),u.d(d,\"Extensions\",(function(){return Re})),u.d(d,\"AppExtensionKeys\",(function(){return fe})),u.d(d,\"WebExtensionKeys\",(function(){return me})),u.d(d,\"UserExtensionKeys\",(function(){return ve})),u.d(d,\"OSExtKeys\",(function(){return ye})),u.d(d,\"DeviceExtKeys\",(function(){return be})),u.d(d,\"OperatingSystem\",(function(){return ae})),u.d(d,\"Application\",(function(){return W})),u.d(d,\"Device\",(function(){return pe})),u.d(d,\"Session\",(function(){return he})),u.d(d,\"defaultFlightIdNameSpaces\",(function(){return G})),u.d(d,\"TelemetryContext\",(function(){return ke})),u.d(d,\"Cloud\",(function(){return q})),u.d(d,\"Loc\",(function(){return ue})),u.d(d,\"AppInsightsCore\",(function(){return H})),u.d(d,\"InternalAppInsightsCore\",(function(){return U})),u.d(d,\"ValueKind\",(function(){return v.e})),u.d(d,\"EventLatency\",(function(){return v.a})),u.d(d,\"EventPersistence\",(function(){return v.b})),u.d(d,\"TraceLevel\",(function(){return v.d})),u.d(d,\"MinChannelPriorty\",(function(){return pn})),u.d(d,\"NotificationManager\",(function(){return f})),u.d(d,\"EventsDiscardedReason\",(function(){return F})),u.d(d,\"CoreUtils\",(function(){return j.a})),u.d(d,\"DiagnosticLogger\",(function(){return y.a})),u.d(d,\"isValueAssigned\",(function(){return j.m})),u.d(d,\"isArray\",(function(){return h.k})),u.d(d,\"isBeaconsSupported\",(function(){return _.m})),u.d(d,\"isBoolean\",(function(){return h.l})),u.d(d,\"isLatency\",(function(){return j.k})),u.d(d,\"isNumber\",(function(){return h.s})),u.d(d,\"isReactNative\",(function(){return _.p})),u.d(d,\"isString\",(function(){return h.u})),u.d(d,\"isUint8ArrayAvailable\",(function(){return j.l})),u.d(d,\"getISOString\",(function(){return h.J})),u.d(d,\"cookieAvailable\",(function(){return w.b})),u.d(d,\"BaseTelemetryPlugin\",(function(){return E.a})),u.d(d,\"LoggingSeverity\",(function(){return m.a})),u.d(d,\"_InternalLogMessage\",(function(){return y.b})),u.d(d,\"_InternalMessageId\",(function(){return m.b}));var p=u(178),h=u(0),g=u(6),f=function(){function NotificationManager(l){this.listeners=[];var d=!!(l||{}).perfEvtsSendAll;Object(g.a)(NotificationManager,this,(function(l){l.addNotificationListener=function(d){l.listeners.push(d)},l.removeNotificationListener=function(d){for(var u=Object(h.b)(l.listeners,d);u>-1;)l.listeners.splice(u,1),u=Object(h.b)(l.listeners,d)},l.eventsSent=function(d){Object(h.a)(l.listeners,(function(l){l&&l.eventsSent&&setTimeout((function(){return l.eventsSent(d)}),0)}))},l.eventsDiscarded=function(d,u){Object(h.a)(l.listeners,(function(l){l&&l.eventsDiscarded&&setTimeout((function(){return l.eventsDiscarded(d,u)}),0)}))},l.eventsSendRequest=function(d,u){Object(h.a)(l.listeners,(function(l){if(l&&l.eventsSendRequest)if(u)setTimeout((function(){return l.eventsSendRequest(d,u)}),0);else try{l.eventsSendRequest(d,u)}catch(l){}}))},l.perfEvent=function(u){u&&(!d&&u.isChildEvt()||Object(h.a)(l.listeners,(function(l){if(l&&l.perfEvent)if(u.isAsync)setTimeout((function(){return l.perfEvent(u)}),0);else try{l.perfEvent(u)}catch(l){}})))}}))}return NotificationManager}(),m=u(21),v=u(20),y=u(44),S=u(43),_=u(11),C=u(31),E=u(177),T=u(36),b=\"processTelemetry\",I=\"priority\",A=\"setNextPlugin\",R=\"isInitialized\";function initializePlugins(l,d){for(var u=[],p=null,g=l.getNext();g;){var f=g.getPlugin();f&&(p&&Object(h.o)(p[A])&&Object(h.o)(f[b])&&p[A](f),Object(h.o)(f[R])&&f[R]()||u.push(f),p=f,g=g.getNext())}Object(h.a)(u,(function(u){u.initialize(l.getCfg(),l.core(),d,l.getNext())}))}function sortPlugins(l){return l.sort((function(l,d){var u=0,p=Object(h.o)(d[b]);return Object(h.o)(l[b])?u=p?l[I]-d[I]:1:p&&(u=-1),u}))}var P=500,O=\"Channel has invalid priority\",M=function(l){function ChannelController(){var d,u=l.call(this)||this;function _checkQueuePriority(l){Object(h.a)(l,(function(l){l.priority<P&&Object(h.I)(O+l.identifier)}))}function _addChannelQueue(l){l&&l.length>0&&(_checkQueuePriority(l=l.sort((function(l,d){return l.priority-d.priority}))),d.push(l))}function _createChannelQueues(l,u){if(d=[],l&&Object(h.a)(l,(function(l){return _addChannelQueue(l)})),u){var p=[];Object(h.a)(u,(function(l){l.priority>P&&p.push(l)})),_addChannelQueue(p)}}return u.identifier=\"ChannelControllerPlugin\",u.priority=P,Object(g.a)(ChannelController,u,(function(l,p){l.setNextPlugin=function(l){},l.processTelemetry=function(l,p){d&&Object(h.a)(d,(function(d){d.length>0&&u._getTelCtx(p).createNew(d).processNext(l)}))},l.getChannelControls=function(){return d},l.initialize=function(u,g,f){l.isInitialized()||(p.initialize(u,g,f),_createChannelQueues((u||{}).channels,f),Object(h.a)(d,(function(l){return initializePlugins(new T.a(l,u,g),f)})))}})),u}var d;return Object(p.b)(ChannelController,l),ChannelController._staticInit=(d=ChannelController.prototype,Object(h.y)(d,\"ChannelControls\",d.getChannelControls),void Object(h.y)(d,\"channelQueue\",d.getChannelControls)),ChannelController}(E.a),w=u(24),N=u(52),D=u(69),L=\"Extensions must provide callback to initialize\",k=\"_notificationManager\";function _createPerfManager(l,d){return new S.a(d)}var x=function(){function BaseCore(){var l,d,u,f,v,_=!1;Object(g.a)(BaseCore,this,(function(g){g._extensions=new Array,d=new M,g.logger=new y.a({loggingLevelConsole:m.a.CRITICAL}),l=[],g.isInitialized=function(){return _},g.initialize=function(l,f,m,v){g.isInitialized()&&Object(h.I)(\"Core should not be initialized more than once\"),l&&!Object(h.r)(l.instrumentationKey)||Object(h.I)(\"Please provide instrumentation key\"),u=v,g[k]=v,g.config=l||{},v&&!0!==g.config.disableDbgExt&&v.addNotificationListener(Object(D.b)(l)),g.config.enablePerfMgr&&Object(h.D)(g.config,\"createPerfMgr\",_createPerfManager),l.extensions=Object(h.r)(l.extensions)?[]:l.extensions,Object(h.i)(l,N.a).NotificationManager=v,m&&(g.logger=m);var y=[];y.push.apply(y,Object(p.c)(Object(p.c)([],f,!1),l.extensions,!1)),y=sortPlugins(y);var S=[],C={};Object(h.a)(y,(function(l){(Object(h.r)(l)||Object(h.r)(l.initialize))&&Object(h.I)(L);var u=l.priority,p=l.identifier;l&&u&&(Object(h.r)(C[u])?C[u]=p:m.warnToConsole(\"Two extensions have same priority #\"+u+\" - \"+C[u]+\", \"+p)),(!u||u<d.priority)&&S.push(l)})),y.push(d),S.push(d),y=sortPlugins(y),g._extensions=y,initializePlugins(new T.a([d],l,g),y),initializePlugins(new T.a(S,l,g),y),g._extensions=S,0===g.getTransmissionControls().length&&Object(h.I)(\"No channels available\"),_=!0,g.releaseQueue()},g.getTransmissionControls=function(){return d.getChannelControls()},g.track=function(d){Object(h.D)(d,N.b,g.config.instrumentationKey,null,h.q),Object(h.D)(d,\"time\",Object(h.J)(new Date),null,h.q),Object(h.D)(d,\"ver\",\"4.0\",null,h.r),g.isInitialized()?g.getProcessTelContext().processNext(d):l.push(d)},g.getProcessTelContext=function(){var l=g._extensions,u=l;return l&&0!==l.length||(u=[d]),new T.a(u,g.config,g)},g.getNotifyMgr=function(){return u||(u=Object(C.b)({addNotificationListener:function(l){},removeNotificationListener:function(l){},eventsSent:function(l){},eventsDiscarded:function(l,d){},eventsSendRequest:function(l,d){}}),g[k]=u),u},g.getCookieMgr=function(){return v||(v=Object(w.c)(g.config,g.logger)),v},g.setCookieMgr=function(l){v=l},g.getPerfMgr=function(){return f||g.config&&g.config.enablePerfMgr&&Object(h.o)(g.config.createPerfMgr)&&(f=g.config.createPerfMgr(g,g.getNotifyMgr())),f||Object(S.c)()},g.setPerfMgr=function(l){f=l},g.eventCnt=function(){return l.length},g.releaseQueue=function(){l.length>0&&(Object(h.a)(l,(function(l){g.getProcessTelContext().processNext(l)})),l=[])}}))}return BaseCore}(),F={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},U=function(l){function AppInsightsCore(){var d=l.call(this)||this,u=0;return Object(g.a)(AppInsightsCore,d,(function(l,d){function _validateTelemetryItem(l){if(Object(h.r)(l.name))throw _notifyInvalidEvent(l),Error(\"telemetry name required\")}function _notifyInvalidEvent(d){var u=l.getNotifyMgr();u&&u.eventsDiscarded([d],F.InvalidEvent)}l.initialize=function(l,u,p,h){d.initialize(l,u,p||new y.a(l),h||new f(l))},l.track=function(u){Object(S.b)(l.getPerfMgr(),(function(){return\"AppInsightsCore:track\"}),(function(){null===u&&(_notifyInvalidEvent(u),Object(h.I)(\"Invalid telemetry item\")),_validateTelemetryItem(u),d.track(u)}),(function(){return{item:u}}),!u.sync)},l.addNotificationListener=function(d){var u=l.getNotifyMgr();u&&u.addNotificationListener(d)},l.removeNotificationListener=function(d){var u=l.getNotifyMgr();u&&u.removeNotificationListener(d)},l.pollInternalLogs=function(d){var p=l.config.diagnosticLogInterval;return p&&p>0||(p=1e4),u&&l.stopPollingInternalLogs(),u=setInterval((function(){var u=l.logger?l.logger.queue:[];Object(h.a)(u,(function(u){var p={name:d||\"InternalMessageId: \"+u.messageId,iKey:l.config.instrumentationKey,time:Object(h.J)(new Date),baseType:y.b.dataType,baseData:{message:u.message}};l.track(p)})),u.length=0}),p)},l.stopPollingInternalLogs=function(){u&&(clearInterval(u),u=0)}})),d}return Object(p.b)(AppInsightsCore,l),AppInsightsCore}(x),j=u(70),B=\"version\",V=\"properties\",H=function(l){function AppInsightsCore(){var d=l.call(this)||this;return d.pluginVersionStringArr=[],d.pluginVersionString=\"\",Object(g.a)(AppInsightsCore,d,(function(l,d){l.logger&&l.logger.queue||(l.logger=new y.a({loggingLevelConsole:m.a.CRITICAL})),l.initialize=function(u,p,g,f){Object(S.b)(l,(function(){return\"AppInsightsCore.initialize\"}),(function(){if(u){u.endpointUrl||(u.endpointUrl=\"https://browser.events.data.microsoft.com/OneCollector/1.0/\");var y=u.propertyStorageOverride;if(y&&(!y.getProperty||!y.setProperty))throw new Error(\"Invalid property storage override passed.\");u.channels&&Object(h.a)(u.channels,(function(d){d&&Object(h.a)(d,(function(d){if(d.identifier&&d.version){var u=d.identifier+\"=\"+d.version;l.pluginVersionStringArr.push(u)}}))}))}l.getWParam=function(){return\"undefined\"!=typeof document?0:-1},p&&Object(h.a)(p,(function(d){if(d&&d.identifier&&d.version){var u=d.identifier+\"=\"+d.version;l.pluginVersionStringArr.push(u)}})),l.pluginVersionString=l.pluginVersionStringArr.join(\";\");try{d.initialize(u,p,g,f),l.pollInternalLogs(\"InternalLog\")}catch(d){var S=l.logger,C=Object(_.a)(d);-1!==C.indexOf(\"channels\")&&(C+=\"\\n - Channels must be provided through config.channels only!\"),S.throwInternal(m.a.CRITICAL,v.f.FailedToInitializeSDK,\"SDK Initialization Failed - no telemetry will be sent: \"+C)}}),(function(){return{config:u,extensions:p,logger:g,notificationManager:f}}))},l.track=function(u){Object(S.b)(l,(function(){return\"AppInsightsCore.track\"}),(function(){var p=u;if(p){p.timings=p.timings||{},p.timings.trackStart=Object(j.i)(),Object(j.k)(p.latency)||(p.latency=v.a.Normal);var h=p.ext=p.ext||{};h.sdk=h.sdk||{},h.sdk.ver=j.b;var g=p.baseData=p.baseData||{};g[V]||(g[V]={});var f=g[V];f[B]||(f[B]=\"\"),\"\"!==l.pluginVersionString&&(f[B]=l.pluginVersionString)}d.track(p)}),(function(){return{item:u}}),!u.sync)}})),d}return Object(p.b)(AppInsightsCore,l),AppInsightsCore}(U),G=[\"AX\",\"EX\",\"SF\",\"CS\",\"CF\",\"CT\",\"CU\",\"DC\",\"DF\",\"H5\",\"HL\",\"WS\",\"WP\"];function _validateAppExpId(l,d){void 0===d&&(d=G);var u=null;if(l)for(var p=l.split(\",\"),h=0;h<p.length;h++)_isValidAppFlightId(p[h],d)&&(u?u+=\",\"+p[h]:u=p[h]);return u}function _isValidAppFlightId(l,d){if(void 0===d&&(d=G),!l||l.length<4)return!1;for(var u=!1,p=256,h=l.substring(0,3).toString().toUpperCase(),g=0;g<d.length;g++)if(d[g]+\":\"===h&&l.length<=p){u=!0;break}return u}var W=function(){function Application(l,d){this.core=d,this.appExpId=null,this.flightIdNameSpaces=G.slice(0),this.expIdCookieName=\"Treatments\",this._cookieMgr=Object(w.d)(d),this._propertiesConfig=l;var u=Object(_.d)();if(u){var p=u.documentElement;u&&(this.locale=p.lang)}this.env=l.env?l.env:this._getMetaDataFromDOM(\"awa-\").env}return Application.prototype.getExpId=function(){return this._propertiesConfig.expId?this._readExpIdFromCoreData(this._propertiesConfig.expId):this._readExpIdFromCookie()},Application.prototype._getMetaDataFromDOM=function(l){var d,u={},p=Object(_.d)();if(p){d=p&&p.querySelectorAll(\"meta\");for(var h=0;h<d.length;h++){var g=d[h];if(g.name)if(0===g.name.toLowerCase().indexOf(l))u[g.name.replace(l,\"\")]=g.content}}return u},Application.prototype._setAppExpId=function(l){l!==this.appExpId&&(this.appExpId=_validateAppExpId(l,this.flightIdNameSpaces))},Application.prototype._getAppExpId=function(){return this.appExpId},Application.prototype._readExpIdFromCookie=function(){var l=Object(j.g)(this._cookieMgr,this.expIdCookieName);return this._setAppExpId(l),this._getAppExpId()},Application.prototype._readExpIdFromCoreData=function(l){return this._setAppExpId(l),this._getAppExpId()},Application.validateAppExpId=_validateAppExpId,Application._staticInit=void Object(h.y)(Application.prototype,\"expId\",Application.prototype.getExpId),Application}(),q=function(){function Cloud(){}return Cloud}(),z=u(37),K=function(){function User(l,d,u){this.core=u,this._propertiesConfig=d;var p=this._cookieMgr=Object(w.d)(u,l);if(p&&p.isEnabled()){if(!this._propertiesConfig.hashIdentifiers&&!this._propertiesConfig.dropIdentifiers){var g=Object(j.g)(p,\"MUID\");g&&this.setLocalId(\"t:\"+g)}if(this._propertiesConfig.enableApplicationInsightsUser){var f=Object(j.g)(p,User.userCookieName);if(f){var m=f.split(User.cookieSeparator);m.length>0&&(this.id=m[0])}if(!this.id){this.id=Object(z.g)(l&&!Object(h.x)(l.idLength)?l.idLength:22);var v=new Date,y=Object(h.J)(v);this.accountAcquisitionDate=y;var S=[this.id,y],_=this._propertiesConfig.cookieDomain?this._propertiesConfig.cookieDomain:void 0;p.set(User.userCookieName,S.join(User.cookieSeparator),31536e3,_)}}}if(\"undefined\"!=typeof navigator){var C=navigator;this.locale=C.userLanguage||C.language}}return User.prototype.getLocalId=function(){if(this._customLocalId)return this._customLocalId;if(!this._propertiesConfig.hashIdentifiers&&!this._propertiesConfig.dropIdentifiers){var l=Object(j.g)(this._cookieMgr,\"MUID\");l&&this.setLocalId(\"t:\"+l)}},User.prototype.setLocalId=function(l){this._customLocalId=l},User.cookieSeparator=\"|\",User.userCookieName=\"ai_user\",User._staticInit=void Object(h.y)(User.prototype,\"localId\",User.prototype.getLocalId,User.prototype.setLocalId),User}(),J=\"([\\\\d,.]+)\",Q=\"Unknown\",Y=\"Edg/\",$=[{ua:\"OPR/\",b:\"Opera\"},{ua:\"PhantomJS\",b:\"PhantomJS\"},{ua:\"Edge\",b:\"Edge\"},{ua:Y,b:\"Edge\"},{ua:\"Electron\",b:\"Electron\"},{ua:\"Chrome\",b:\"Chrome\"},{ua:\"Trident\",b:\"MSIE\"},{ua:\"MSIE \",b:\"MSIE\"},{ua:\"Firefox\",b:\"Firefox\"},{ua:\"Safari\",b:\"Safari\"},{ua:\"SkypeShell\",b:\"SkypeShell\"}],X=[{br:\"Microsoft Edge\",b:\"Edge\"},{br:\"Google Chrome\",b:\"Chrome\"},{br:\"Opera\",b:\"Opera\"}];function _userAgentContainsString(l,d){return d.indexOf(l)>-1}function _getBrandVersion(l,d){for(var u=0;u<d.length;u++)if(l==d[u].brand)return d[u].version;return null}function _getBrowserName(l){if(l)for(var d=0;d<$.length;d++){if(_userAgentContainsString($[d].ua,l))return $[d].b}return Q}function _getBrowserVersion(l,d){return\"MSIE\"===d?_getIeVersion(l):_getOtherVersion(d,l)}function _getIeVersion(l){var d=l.match(new RegExp(\"MSIE \"+J));if(d)return d[1];var u=l.match(new RegExp(\"rv:\"+J));return u?u[1]:void 0}function _getOtherVersion(l,d){\"Safari\"===l?l=\"Version\":\"Edge\"===l&&_userAgentContainsString(Y,d)&&(l=\"Edg\");var u=d.match(new RegExp(l+\"/\"+J));return u||\"Opera\"===l&&(u=d.match(new RegExp(\"OPR/\"+J)))?u[1]:Q}function _getScreenResolution(){var l={h:0,w:0},d=Object(_.k)();return d&&d.screen&&(l.h=screen.height,l.w=screen.width),l}var Z=function(){function Web(l,d){var u=Object(w.d)(d),p=l||{};Object(g.a)(Web,this,(function(l){var d=Object(_.g)();if(d){var g=d.hostname;g&&(l.domain=\"file:\"===d.protocol?\"local\":g)}if(p.populateBrowserInfo){var f=p.userAgent,m=(p.userAgentData||{}).brands,v=Object(_.i)();v&&(f=f||v.userAgent||\"\",m=m||(v.userAgentData||{}).brands),_parseUserAgent(f,m);var y=_getScreenResolution();l.screenRes=y.w+\"X\"+y.h}function _parseUserAgent(d,u){if(Object(h.k)(u))try{for(var p=0;p<X.length;p++){var g=_getBrandVersion(X[p].br,u);if(g)return l.browser=X[p].b,void(l.browserVer=g)}}catch(l){}if(d){var f=_getBrowserName(d);l.browser=f,l.browserVer=_getBrowserVersion(d,f)}}l.getUserConsent=function(){return p.userConsented||!!Object(j.g)(u,p.userConsentCookieName||\"MSCC\")},l.getUserConsentDetails=function(){try{var l=p.callback;if(l&&l.userConsentDetails){var d=l.userConsentDetails();if(d)return JSON.stringify({Required:d.Required||!1,Analytics:d.Analytics||!1,SocialMedia:d.SocialMedia||!1,Advertising:d.Advertising||!1})}}catch(l){}return null},Object(h.y)(l,\"userConsent\",l.getUserConsent)}))}return Web._staticInit=void Object(h.y)(Web.prototype,\"userConsent\",Web.prototype.getUserConsent),Web}(),ee={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\\sphone\\s\\d+\\.\\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},te={5.1:\"XP\",\"6.0\":\"Vista\",6.1:\"7\",6.2:\"8\",6.3:\"8.1\",\"10.0\":\"10\"},ne=\"([\\\\d,.]+)\",ie=\"([\\\\d,_,.]+)\",re=\"Unknown\",oe=[{r:ee.WINPHONE,os:\"Windows Phone\"},{r:ee.WINRT,os:\"Windows RT\"},{r:ee.WIN,os:\"Windows\"},{r:ee.IOS,os:\"iOS\"},{r:ee.ANDROID,os:\"Android\"},{r:ee.LINUX,os:\"Linux\"},{r:ee.CROS,os:\"Chrome OS\"},{s:\"x11\",os:\"Unix\"},{s:\"blackberry\",os:\"BlackBerry\"},{s:\"symbian\",os:\"Symbian\"},{s:\"nokia\",os:\"Nokia\"},{r:ee.OSX,os:\"Mac OS X\"}];function _getOsName(l){for(var d=0;d<oe.length;d++){var u=oe[d];if(u.r&&l.match(u.r))return u.os;if(u.s&&-1!==l.indexOf(u.s))return u.os}return re}function _getOsVersion(l,d){return\"Windows\"===d?_getGenericOsVersion(l,\"Windows NT\"):\"Android\"===d?_getGenericOsVersion(l,d):\"Mac OS X\"===d?_getMacOsxVersion(l):\"iOS\"===d?_getIosVersion(l):re}function _getGenericOsVersion(l,d){var u=l.match(new RegExp(d+\" \"+ne));return u?te[u[1]]?te[u[1]]:u[1]:re}function _getMacOsxVersion(l){var d=l.match(new RegExp(\"Mac OS X \"+ie));if(d){var u=d[1].replace(/_/g,\".\");if(u){var p=_getDelimiter(u);return p?u.split(p)[0]:u}}return re}function _getIosVersion(l){var d=l.match(new RegExp(\"OS \"+ie));if(d){var u=d[1].replace(/_/g,\".\");if(u){var p=_getDelimiter(u);return p?u.split(p)[0]:u}}return re}function _getDelimiter(l){return l.indexOf(\".\")>-1?\".\":l.indexOf(\"_\")>-1?\"_\":null}var ae=function(){function OperatingSystem(l){if(l.populateOperatingSystemInfo){var d=Object(_.i)()||{},u=l.userAgent||d.userAgent||\"\",p=l.userAgentData||d.userAgentData||{};if(u){var g=_getOsName(u.toLowerCase());this.name=g,this.ver=_getOsVersion(u,g)}this.name&&this.name!==re||!Object(h.u)(p.platform)||(this.name=p.platform)}}return OperatingSystem}(),se=function(){function IntWeb(l,d){this.core=d,l.serviceName&&(this.serviceName=l.serviceName),this._cookieMgr=Object(w.d)(d)}return IntWeb.prototype.getMsfpc=function(){return Object(j.g)(this._cookieMgr,\"MSFPC\")},IntWeb.prototype.getAnid=function(){return Object(j.g)(this._cookieMgr,\"ANON\").slice(0,34)},IntWeb._staticInit=(Object(h.y)(IntWeb.prototype,\"msfpc\",IntWeb.prototype.getMsfpc),void Object(h.y)(IntWeb.prototype,\"anid\",IntWeb.prototype.getAnid)),IntWeb}(),ce=1048576,le=2097152,de=function(){function Utc(l){this.popSample=100,this.eventFlags=0,l.hashIdentifiers&&(this.eventFlags=this.eventFlags|ce),l.dropIdentifiers&&(this.eventFlags=this.eventFlags|le)}return Utc}(),ue=function(){function Loc(){var l=(new Date).getTimezoneOffset(),d=l%60,u=(l-d)/60,p=\"+\";u>0&&(p=\"-\"),u=Math.abs(u),d=Math.abs(d),this.tz=p+(u<10?\"0\"+u:u.toString())+\":\"+(d<10?\"0\"+d:d.toString())}return Loc}(),pe=function(){function Device(){}return Device}(),he=function(){function Session(){}return Session.prototype.setId=function(l){this.customId=l},Session.prototype.getId=function(){return Object(h.u)(this.customId)?this.customId:this.automaticId},Session._staticInit=void Object(h.y)(Session.prototype,\"id\",Session.prototype.getId,Session.prototype.setId),Session}(),ge=function(){function Trace(l,d,u,p){if(l.enableApplicationInsightsTrace){this.traceId=d||Object(z.e)(),this.parentId=u,this.name=p;var h=Object(_.g)();h&&h.pathname&&(this.name=h.pathname)}}return Trace}(),fe=Object(h.A)({id:\"id\",ver:\"ver\",appName:\"name\",locale:\"locale\",expId:\"expId\",env:\"env\"}),me=Object(h.A)({domain:\"domain\",browser:\"browser\",browserVer:\"browserVer\",screenRes:\"screenRes\",userConsent:\"userConsent\",consentDetails:\"consentDetails\"}),ve=Object(h.A)({locale:\"locale\",localId:\"localId\",id:\"id\"}),ye=Object(h.A)({osName:\"name\",ver:\"ver\"}),Se=Object(h.A)({ver:\"ver\",seq:\"seq\",installId:\"installId\",epoch:\"epoch\"}),_e=Object(h.A)({msfpc:\"msfpc\",anid:\"anid\",serviceName:\"serviceName\"}),Ce=Object(h.A)({popSample:\"popSample\",eventFlags:\"eventFlags\"}),Ee=Object(h.A)({tz:\"tz\"}),Te=Object(h.A)({sessionId:\"sesId\"}),be=Object(h.A)({localId:\"localId\",deviceClass:\"deviceClass\",make:\"make\",model:\"model\"}),Ie=Object(h.A)({role:\"role\",roleInstance:\"roleInstance\",roleVer:\"roleVer\"}),Ae=Object(h.A)({traceId:\"traceID\",traceName:\"name\",parentId:\"parentID\"}),Re=Object(h.A)({UserExt:\"user\",DeviceExt:\"device\",TraceExt:\"trace\",WebExt:\"web\",AppExt:\"app\",OSExt:\"os\",SdkExt:\"sdk\",IntWebExt:\"intweb\",UtcExt:\"utc\",LocExt:\"loc\",CloudExt:\"cloud\"}),Pe=u(22),Oe=\"MicrosoftApplicationsTelemetryDeviceId\";function _saveData(l,d,u,p){d?d.setProperty(u,p):l.set(u,p,31536e3)}function _getData(l,d,u){return d?d.getProperty(u)||\"\":Object(j.g)(l,u)}var Me,we,Ne=function(){function Sdk(l,d){this._sequenceId=0;var u=l.propertyStorageOverride;this.seq=this._sequenceId,this.epoch=Object(Pe.c)(!1).toString();var p=Object(w.d)(d,l);if(p.isEnabled()||u){var h=_getData(p,u,Oe);h||(h=Object(z.f)()),_saveData(p,u,Oe,h),this.installId=h}else p.purge(Oe)}return Sdk.prototype.getSequenceId=function(){return++this._sequenceId},Sdk}();function canUseLocalStorage(){return void 0===Me&&(Me=!!_getVerifiedStorageObject(we.LocalStorage)),Me}function _getLocalStorageObject(){return canUseLocalStorage()?_getVerifiedStorageObject(we.LocalStorage):null}function _getVerifiedStorageObject(l){var d,u,p=null;try{var g=Object(C.a)();if(!g)return null;u=new Date,(p=l===we.LocalStorage?g.localStorage:g.sessionStorage)&&Object(h.o)(p.setItem)&&(p.setItem(u,u),d=p.getItem(u)!==u,p.removeItem(u),d&&(p=null))}catch(l){p=null}return p}function setStorage(l,d,u){var p=_getLocalStorageObject();if(null!==p)try{return p.setItem(d,u),!0}catch(d){Me=!1,l.throwInternal(m.a.CRITICAL,v.f.BrowserCannotWriteLocalStorage,\"Browser failed write to local storage. \"+d)}return!1}function getStorage(l,d){var u=_getLocalStorageObject();if(null!==u)try{return u.getItem(d)}catch(d){Me=!1,l.throwInternal(m.a.CRITICAL,v.f.BrowserCannotReadLocalStorage,\"Browser failed read of local storage. \"+d)}return null}!function(l){l[l.LocalStorage=0]=\"LocalStorage\",l[l.SessionStorage=1]=\"SessionStorage\"}(we||(we={}));var De=function(){function SessionManager(l,d){var u,p,f=Object(y.c)(l),S=Object(w.d)(l);Object(g.a)(SessionManager,this,(function(l){var g=getDefaultConfig(d);function getDefaultConfig(l){return{sessionRenewalMs:l.sessionRenewalMs&&function(){return l.sessionRenewalMs},sessionExpirationMs:l.sessionExpirationMs&&function(){return l.sessionExpirationMs},cookieDomain:l.cookieDomain&&function(){return l.cookieDomain},namePrefix:l.namePrefix&&function(){return l.namePrefix},sessionAsGuid:function(){return l.sessionAsGuid},idLength:function(){return l.idLength?l.idLength:22}}}function _initializeAutomaticSession(){var d=Object(j.f)(p());if(d&&Object(h.o)(d.split))_initializeAutomaticSessionWithData(d);else{var u=getStorage(f,p());u&&_initializeAutomaticSessionWithData(u)}l.automaticSession.getId()||_renew()}function _initializeAutomaticSessionWithData(d){var u=l.automaticSession,p=d.split(\"|\");p.length>0&&u.setId(p[0]);try{if(p.length>1){var h=+p[1];u.acquisitionDate=+new Date(h),u.acquisitionDate=u.acquisitionDate>0?u.acquisitionDate:0}if(p.length>2){var g=+p[2];u.renewalDate=+new Date(g),u.renewalDate=u.renewalDate>0?u.renewalDate:0}}catch(l){f.throwInternal(m.a.CRITICAL,v.f.ErrorParsingAISessionCookie,\"Error parsing ai_session cookie, session will be reset: \"+l)}0===u.renewalDate&&f.throwInternal(m.a.WARNING,v.f.SessionRenewalDateIsZero,\"AI session renewal date is 0, session will be reset.\")}function _renew(){var d=l.automaticSession,u=(new Date).getTime(),p=l.config.sessionAsGuid();!Object(h.x)(p)&&p?Object(h.l)(p)?d.setId(Object(j.c)()):d.setId(Object(j.c)(p)):d.setId(Object(z.g)(g&&g.idLength?g.idLength():22)),d.acquisitionDate=u,d.renewalDate=u,_setCookie(d.getId(),d.acquisitionDate,d.renewalDate),canUseLocalStorage()||f.throwInternal(m.a.WARNING,v.f.BrowserDoesNotSupportLocalStorage,\"Browser does not support local storage. Session durations will be inaccurate.\")}function _setCookie(d,h,g){var f=h+l.config.sessionExpirationMs(),m=g+l.config.sessionRenewalMs(),v=new Date,y=[d,h,g];f<m?v.setTime(f):v.setTime(m);var _=l.config.cookieDomain?l.config.cookieDomain():null;S.set(p(),y.join(\"|\")+\";expires=\"+v.toUTCString(),null,_),u=(new Date).getTime()}function _setStorage(l,d,u){setStorage(f,p(),[l,d,u].join(\"|\"))}Object(h.o)(d.sessionExpirationMs)||(g.sessionExpirationMs=function(){return SessionManager.acquisitionSpan}),Object(h.o)(d.sessionRenewalMs)||(g.sessionRenewalMs=function(){return SessionManager.renewalSpan}),l.config=g,p=function(){return l.config.namePrefix&&l.config.namePrefix()?SessionManager.cookieNameConst+l.config.namePrefix():SessionManager.cookieNameConst},l.automaticSession=new he,l.update=function(){l.automaticSession.getId()||_initializeAutomaticSession();var d=l.automaticSession,p=l.config,h=(new Date).getTime(),g=h-d.acquisitionDate>p.sessionExpirationMs(),f=h-d.renewalDate>p.sessionRenewalMs();if(g||f)_renew();else{(!u||h-u>SessionManager.cookieUpdateInterval)&&(d.renewalDate=h,_setCookie(d.getId(),d.acquisitionDate,d.renewalDate))}},l.backup=function(){var d=l.automaticSession;_setStorage(d.getId(),d.acquisitionDate,d.renewalDate)}}))}return SessionManager.acquisitionSpan=864e5,SessionManager.renewalSpan=18e5,SessionManager.cookieUpdateInterval=6e4,SessionManager.cookieNameConst=\"ai_session\",SessionManager}(),Le=h.u,ke=function(){function TelemetryContext(l,d,u){var p=this;p.app=new W(d,u),p.cloud=new q,p.user=new K(l,d,u),p.os=new ae(d),p.web=new Z(d,u),p.sdk=new Ne(l,u),p.intWeb=new se(d,u),p.utc=new de(d),p.loc=new ue,p.device=new pe,p.telemetryTrace=new ge(d),p.sessionManager=new De(u,d),p.session=new he}return TelemetryContext.prototype.getSessionId=function(){var l=this.session;if(l&&Le(l.customId))return l.customId;var d=this.sessionManager;d.update();var u=d.automaticSession;if(u){var p=u.getId();p&&Le(p)&&(l.automaticId=p)}return l.automaticId},TelemetryContext.prototype.applyApplicationContext=function(l){var d=this.app,u=l.ext[Re.AppExt];Object(h.D)(u,fe.id,d.id,Le),Object(h.D)(u,fe.ver,d.ver,Le),Object(h.D)(u,fe.appName,d.name,Le),Object(h.D)(u,fe.locale,d.locale,Le),Object(h.D)(u,fe.expId,d.getExpId(),Le),Object(h.D)(u,fe.env,d.env,Le)},TelemetryContext.prototype.applyUserContext=function(l){var d=this.user,u=l.ext[Re.UserExt];Object(h.D)(u,ve.localId,d.getLocalId(),Le),Object(h.D)(u,ve.locale,d.locale,Le),Object(h.D)(u,ve.id,d.id,Le)},TelemetryContext.prototype.applyWebContext=function(l){var d=this.web,u=l.ext[Re.WebExt];Object(h.D)(u,me.domain,d.domain,Le),Object(h.D)(u,me.browser,d.browser,Le),Object(h.D)(u,me.browserVer,d.browserVer,Le),Object(h.D)(u,me.screenRes,d.screenRes,Le),u[me.userConsent]=d.getUserConsent(),u[me.consentDetails]=d.getUserConsentDetails()},TelemetryContext.prototype.applyOsContext=function(l){var d=this.os,u=l.ext[Re.OSExt];Object(h.D)(u,ye.osName,d.name,Le),Object(h.D)(u,ye.ver,d.ver,Le)},TelemetryContext.prototype.applySdkContext=function(l){var d=this.sdk,u=l.ext[Re.SdkExt];u[Se.seq]=d.getSequenceId(),u[Se.epoch]=d.epoch,Object(h.D)(u,Se.installId,d.installId,Le)},TelemetryContext.prototype.applyIntWebContext=function(l){var d=this.intWeb,u=l.ext[Re.IntWebExt];Object(h.D)(u,_e.msfpc,d.getMsfpc(),Le),Object(h.D)(u,_e.anid,d.getAnid(),Le),Object(h.D)(u,_e.serviceName,d.serviceName,Le)},TelemetryContext.prototype.applyUtcContext=function(l){var d=this.utc,u=l.ext[Re.UtcExt];u[Ce.popSample]=d.popSample,d.eventFlags>0&&(u[Ce.eventFlags]=d.eventFlags)},TelemetryContext.prototype.applyLocContext=function(l){l.ext[Re.LocExt][Ee.tz]=this.loc.tz},TelemetryContext.prototype.applySessionContext=function(l){l.ext[Re.AppExt][Te.sessionId]=this.getSessionId()},TelemetryContext.prototype.applyDeviceContext=function(l){var d=this.device,u=l.ext[Re.DeviceExt];Object(h.D)(u,be.localId,d.localId,Le),Object(h.D)(u,be.make,d.make,Le),Object(h.D)(u,be.model,d.model,Le),Object(h.D)(u,be.deviceClass,d.deviceClass,Le)},TelemetryContext.prototype.applyCloudContext=function(l){var d=this.cloud,u=l.ext[Re.CloudExt];Object(h.D)(u,Ie.role,d.role,Le),Object(h.D)(u,Ie.roleInstance,d.roleInstance,Le),Object(h.D)(u,Ie.roleVer,d.roleVer,Le)},TelemetryContext.prototype.applyAITraceContext=function(l){var d=this.telemetryTrace,u=l.ext[Re.TraceExt];Object(h.D)(u,Ae.traceId,d.traceId,Le),Object(h.D)(u,Ae.traceName,d.name,Le),Object(h.D)(u,Ae.parentId,d.parentId,Le)},TelemetryContext}(),xe=function(l){function PropertiesPlugin(){var d,u=l.call(this)||this;u.identifier=\"SystemPropertiesCollector\",u.priority=3,u.version=\"3.1.11\";var p={};return Object(g.a)(PropertiesPlugin,u,(function(g,f){function _addPropertiesIfAbsent(l,d){l&&Object(h.z)(l,(function(l,u){d[l]||(d[l]=u)}))}g.initialize=function(p,h,f){l.prototype.initialize.call(u,p,h,f),d=new ke(p,g._getTelCtx().getExtCfg(g.identifier),h)},g.processTelemetry=function(l,u){Object(j.q)(l,g.identifier),u=g._getTelCtx(u);var f=l.ext=l.ext?l.ext:{};l.data=l.data?l.data:{},f[Re.AppExt]=f[Re.AppExt]||{},f[Re.UserExt]=f[Re.UserExt]||{},f[Re.WebExt]=f[Re.WebExt]||{},f[Re.OSExt]=f[Re.OSExt]||{},f[Re.SdkExt]=f[Re.SdkExt]||{},f[Re.IntWebExt]=f[Re.IntWebExt]||{},f[Re.UtcExt]=f[Re.UtcExt]||{},f[Re.LocExt]=f[Re.LocExt]||{},f[Re.DeviceExt]=f[Re.DeviceExt]||{},f[Re.TraceExt]=f[Re.TraceExt]||{},f[Re.CloudExt]=f[Re.CloudExt]||{},d.applyApplicationContext(l),d.applyUserContext(l),d.applyWebContext(l),d.applyOsContext(l),d.applySdkContext(l),d.applyIntWebContext(l),d.applyUtcContext(l),d.applyLocContext(l),d.applySessionContext(l),d.applyDeviceContext(l),d.applyAITraceContext(l),d.applyCloudContext(l),Object(h.a)(Object(h.B)(f),(function(l){0===Object(h.B)(f[l]).length&&delete f[l]})),_addPropertiesIfAbsent(p,l.data),g.processNext(l,u)},g.getPropertiesContext=function(){return d},g.setProperty=function(l,d){p[l]=d}})),u}return Object(p.b)(PropertiesPlugin,l),PropertiesPlugin}(E.a),Fe=\"REAL_TIME\",Ue=\"NEAR_REAL_TIME\",je=\"BEST_EFFORT\",Be=\"POST\",Ve=\"Microsoft_ApplicationInsights_BypassAjaxInstrumentation\",He=\"drop\",Ge=\"send\",We=\"requeue\",qe=\"rspFail\",ze=\"oth\",Ke=\"no-cache, no-store\",Je=\"application/x-json-stream\",Qe=\"cache-control\",Ye=\"content-type\",$e=\"kill-tokens\",Xe=\"kill-duration\",Ze=\"kill-duration-seconds\",et=\"time-delta-millis\",tt=\"client-version\",nt=\"client-id\",it=\"time-delta-to-apply-millis\",rt=\"upload-time\",ot=\"apikey\",at=\"AuthMsaDeviceTicket\",st=\"NoResponseBody\",ct=\"msfpc\";function _getEventMsfpc(l){var d=(l.ext||{}).intweb;return d&&Object(j.m)(d[ct])?d[ct]:null}function EventBatch_getMsfpc(l){for(var d=null,u=0;null===d&&u<l.length;u++)d=_getEventMsfpc(l[u]);return d}var lt=function(){function EventBatch(l,d){var u=d?[].concat(d):[],p=this,g=EventBatch_getMsfpc(u);p.iKey=function(){return l},p.Msfpc=function(){return g||\"\"},p.count=function(){return u.length},p.events=function(){return u},p.addEvent=function(l){return!!l&&(u.push(l),g||(g=_getEventMsfpc(l)),!0)},p.split=function(d,p){var f;if(d<u.length){var m=u.length-d;Object(h.r)(p)||(m=p<m?p:m),f=u.splice(d,m),g=EventBatch_getMsfpc(u)}return new EventBatch(l,f)}}return EventBatch.create=function(l,d){return new EventBatch(l,d)},EventBatch}(),dt=u(2),ut=20,pt=3984588,ht=65e3,gt=2e6,ft=Math.min(gt,ht),mt=\"metadata\",vt=\"f\",yt=/\\./,St=function(){function Serializer(l,d,u,p){var f=\"data\",m=\"baseData\",v=\"ext\",y=!!p,_=!0,C=d,E={};Object(g.a)(Serializer,this,(function(d){function _isReservedField(l,d){var u=E[l];return void 0===u&&(l.length>=7&&(u=Object(h.G)(l,\"ext.metadata\")||Object(h.G)(l,\"ext.web\")),E[l]=u),u}function _processPathKeys(l,d,p,g,f,m,v){Object(h.z)(l,(function(l,S){var _=null;if(S||Object(j.m)(S)){var E=p,T=l,b=f,I=d;if(y&&!g&&yt.test(l)){var A=l.split(\".\"),R=A.length;if(R>1){b&&(b=b.slice());for(var P=0;P<R-1;P++){var O=A[P];I=I[O]=I[O]||{},E+=\".\"+O,b&&b.push(O)}T=A[R-1]}}if(_=!(g&&_isReservedField(E))&&C&&C.handleField(E,T)?C.value(E,T,S,u):Object(j.p)(T,S,u)){var M=_.value;if(I[T]=M,m&&m(b,T,_),v&&\"object\"==typeof M&&!Object(h.k)(M)){var w=b;w&&(w=w.slice()).push(T),_processPathKeys(S,M,E+\".\"+T,g,w,m,v)}}}}))}d.createPayload=function(l,d,u,p,h,g){return{apiKeys:[],payloadBlob:\"\",overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:l,isTeardown:d,isSync:u,isBeacon:p,sendType:g,sendReason:h}},d.appendPayload=function(u,p,g){var f=u&&p&&!u.overflow;return f&&Object(S.b)(l,(function(){return\"Serializer:appendPayload\"}),(function(){for(var l=p.events(),f=u.payloadBlob,m=u.numEvents,v=!1,y=[],S=[],_=u.isBeacon,C=_?ht:pt,E=_?ft:gt,T=0,b=0;T<l.length;){var I=l[T];if(I){if(m>=g){u.overflow=p.split(T);break}var A=d.getEventBlob(I);if(A&&A.length<=E){var R=A.length;if(f.length+R>C){u.overflow=p.split(T);break}f&&(f+=\"\\n\"),f+=A,++b>ut&&(f.substr(0,1),b=0),v=!0,m++}else A?y.push(I):S.push(I),l.splice(T,1),T--}T++}if(y&&y.length>0&&u.sizeExceed.push(lt.create(p.iKey(),y)),S&&S.length>0&&u.failedEvts.push(lt.create(p.iKey(),S)),v){u.batches.push(p),u.payloadBlob=f,u.numEvents=m;var P=p.iKey();-1===Object(h.b)(u.apiKeys,P)&&u.apiKeys.push(P)}}),(function(){return{payload:u,theBatch:{iKey:p.iKey(),evts:p.events()},max:g}})),f},d.getEventBlob=function(d){try{return Object(S.b)(l,(function(){return\"Serializer.getEventBlob\"}),(function(){var l={};l.name=d.name,l.time=d.time,l.ver=d.ver,l.iKey=\"o:\"+Object(j.h)(d.iKey);var u={},p=d[v];p&&(l[v]=u,Object(h.z)(p,(function(l,d){_processPathKeys(d,u[l]={},\"ext.\"+l,!0,null,null,!0)})));var g=l[f]={};g.baseType=d.baseType;var y=g[m]={};return _processPathKeys(d.baseData,y,m,!1,[m],(function(l,d,p){_addJSONPropertyMetaData(u,l,d,p)}),_),_processPathKeys(d.data,g,f,!1,[],(function(l,d,p){_addJSONPropertyMetaData(u,l,d,p)}),_),JSON.stringify(l)}),(function(){return{item:d}}))}catch(l){return null}}}))}return Serializer}();function _addJSONPropertyMetaData(l,d,u,p){if(p&&l){var g=Object(j.e)(p.value,p.kind,p.propertyType);if(g>-1){var f=l[mt];f||(f=l[mt]={f:{}});var m=f[vt];if(m||(m=f[vt]={}),d)for(var v=0;v<d.length;v++){var y=d[v];m[y]||(m[y]={f:{}});var S=m[y][vt];S||(S=m[y][vt]={}),m=S}m=m[u]={},Object(h.k)(p.value)?m.a={t:g}:m.t=g}}}var _t,Ct=.8,Et=1.2,Tt=3e3,bt=6e5,It=function(){function RetryPolicy(){}return RetryPolicy.shouldRetryForStatus=function(l){return!(l>=300&&l<500&&408!=l&&429!=l||501==l||505==l)},RetryPolicy.getMillisToBackoffForRetry=function(l){var d=0,u=Tt*Ct,p=Tt*Et,h=Math.floor(Math.random()*(p-u))+u;return d=Math.pow(2,l)*h,Math.min(d,bt)},RetryPolicy}(),At=1e3,Rt=function(){function KillSwitch(){var l={};function _normalizeTenants(l){var d=[];return l&&Object(h.a)(l,(function(l){d.push(Object(h.H)(l))})),d}Object(g.a)(KillSwitch,this,(function(d){d.setKillSwitchTenants=function(d,u){if(d&&u)try{var p=_normalizeTenants(d.split(\",\"));if(\"this-request-only\"===u)return p;for(var g=parseInt(u,10)*At,f=0;f<p.length;++f)l[p[f]]=Object(h.f)()+g}catch(l){return[]}return[]},d.isTenantKilled=function(d){var u=l,p=Object(h.H)(d);return void 0!==u[p]&&u[p]>Object(h.f)()||(delete u[p],!1)}}))}return KillSwitch}(),Pt=function(){function ClockSkewManager(){var l=!0,d=!0,u=!0,p=\"use-collector-delta\",h=!1;Object(g.a)(ClockSkewManager,this,(function(g){g.allowRequestSending=function(){return l},g.firstRequestSent=function(){u&&(u=!1,h||(l=!1))},g.shouldAddClockSkewHeaders=function(){return d},g.getClockSkewHeaderValue=function(){return p},g.setClockSkew=function(u){h||(u?(p=u,d=!0,h=!0):d=!1,l=!0)}}))}return ClockSkewManager}(),Ot=\"sendAttempt\",Mt=\"&\"+st+\"=true\",wt=((_t={})[1]=We,_t[100]=We,_t[200]=\"sent\",_t[8004]=He,_t[8003]=He,_t),Nt={};function _addCollectorHeaderQsMapping(l,d){Nt[l]=d}function _getResponseText(l){try{return l.responseText}catch(l){}return\"\"}function _hasHeader(l,d){var u=!1;if(l&&d){var p=Object(h.B)(l);if(p&&p.length>0)for(var g=d.toLowerCase(),f=0;f<p.length;f++){var m=p[f];if(m&&Object(h.j)(d,m)&&m.toLowerCase()===g){u=!0;break}}}return u}function _addRequestDetails(l,d,u,p){d&&u&&u.length>0&&(p&&Nt[d]?(l.hdrs[Nt[d]]=u,l.useHdrs=!0):l.url+=\"&\"+d+\"=\"+u)}_addCollectorHeaderQsMapping(at,at);var Dt=function(){function HttpManager(l,d,u,p){this._responseHandlers=[];var f,y,C,E,T,b,I=\"?cors=true&\"+Ye.toLowerCase()+\"=\"+Je,A=new Rt,R=!1,P=new Pt,O=!1,M=0,w=!0,N=[],D={},L=[],k=null,x=!1,F=!1,U=!1;Object(g.a)(HttpManager,this,(function(g){var B=!0;function _getSenderInterface(l,d){for(var u=0,p=null,h=0;null==p&&h<l.length;)1===(u=l[h])?Object(_.r)()?p=_xdrSendPost:Object(_.q)()&&(p=_xhrSendPost):2===u&&Object(_.n)(d)?p=_fetchSendPost:O&&3===u&&Object(_.m)()&&(p=_beaconSendPost),h++;return p?{_transport:u,_isSync:d,sendPOST:p}:null}function _xdrSendPost(l,d,u){var p=new XDomainRequest;p.open(Be,l.urlString),l.timeout&&(p.timeout=l.timeout),p.onload=function(){var l=_getResponseText(p);_doOnComplete(d,200,{},l),_handleCollectorResponse(l)},p.onerror=function(){_doOnComplete(d,400,{})},p.ontimeout=function(){_doOnComplete(d,500,{})},p.onprogress=function(){},u?p.send(l.data):f._setTimeoutOverride((function(){p.send(l.data)}),0)}function _fetchSendPost(l,d,u){var p,g=l.urlString,m=!1,v=!1,y=((p={body:l.data,method:Be})[Ve]=!0,p);u&&(y.keepalive=!0,2===l._sendReason&&(m=!0,g+=Mt)),B&&(y.credentials=\"include\"),l.headers&&Object(h.B)(l.headers).length>0&&(y.headers=l.headers),fetch(g,y).then((function(l){var u={},p=\"\";l.headers&&l.headers.forEach((function(l,d){u[d]=l})),l.body&&l.text().then((function(l){p=l})),v||(v=!0,_doOnComplete(d,l.status,u,p),_handleCollectorResponse(p))})).catch((function(l){v||(v=!0,_doOnComplete(d,0,{}))})),m&&!v&&(v=!0,_doOnComplete(d,200,{})),!v&&l.timeout>0&&f._setTimeoutOverride((function(){v||(v=!0,_doOnComplete(d,500,{}))}),l.timeout)}function _xhrSendPost(l,d,u){var p=l.urlString;function _appendHeader(l,d,u){if(!l[u]&&d&&d.getResponseHeader){var p=d.getResponseHeader(u);p&&(l[u]=Object(h.H)(p))}return l}function _getAllResponseHeaders(l){var d={};return l.getAllResponseHeaders?d=_convertAllHeadersToMap(l.getAllResponseHeaders()):(d=_appendHeader(d,l,et),d=_appendHeader(d,l,Xe),d=_appendHeader(d,l,Ze)),d}function xhrComplete(l,u){_doOnComplete(d,l.status,_getAllResponseHeaders(l),u)}u&&l.disableXhrSync&&(u=!1);var g=Object(j.o)(Be,p,B,!0,u,l.timeout);Object(h.z)(l.headers,(function(l,d){g.setRequestHeader(l,d)})),g.onload=function(){var l=_getResponseText(g);xhrComplete(g,l),_handleCollectorResponse(l)},g.onerror=function(){xhrComplete(g)},g.ontimeout=function(){xhrComplete(g)},g.send(l.data)}function _doOnComplete(l,d,u,p){try{l(d,u,p)}catch(l){f.diagLog().throwInternal(m.a.WARNING,v.f.SendPostOnCompleteFailure,Object(_.a)(l))}}function _beaconSendPost(l,d,u){var p=200,g=l._thePayload,m=l.urlString+Mt;try{var v=Object(_.i)();if(!v.sendBeacon(m,l.data))if(g){var y=[];Object(h.a)(g.batches,(function(l){if(y&&l&&l.count()>0){for(var d=l.events(),u=0;u<d.length;u++)if(!v.sendBeacon(m,k.getEventBlob(d[u]))){y.push(l.split(u));break}}else y.push(l.split(0))})),_sendBatchesNotification(y,8003,g.sendType,!0)}else p=0}catch(l){f.diagLog().warnToConsole(\"Failed to send telemetry using sendBeacon API. Ex:\"+l),p=0}finally{_doOnComplete(d,p,{},\"\")}}function _isBeaconPayload(l){return 2===l||3===l}function _adjustSendType(l){return F&&_isBeaconPayload(l)&&(l=2),l}function _hasIdleConnection(){return!R&&M<d}function _clearQueue(){var l=L;return L=[],l}function _canSendPayload(l,d,u){var p=!1;return l&&l.length>0&&!R&&y[d]&&k&&(p=0!==d||_hasIdleConnection()&&(u>0||P.allowRequestSending())),p}function _createDebugBatches(l){var d={};return l&&Object(h.a)(l,(function(l,u){d[u]={iKey:l.iKey(),evts:l.events()}})),d}function _sendBatches(d,u,p,h,g){if(d&&0!==d.length)if(R)_sendBatchesNotification(d,1,h);else{h=_adjustSendType(h);try{var E=d,T=0!==h;Object(S.b)(C,(function(){return\"HttpManager:_sendBatches\"}),(function(f){f&&(d=d.slice(0));for(var m=[],v=null,S=Object(j.i)(),_=y[h]||(T?y[1]:y[0]),C=(F||_isBeaconPayload(h)||_&&3===_._transport)&&_canUseSendBeaconApi();_canSendPayload(d,h,u);){var E=d.shift();E&&E.count()>0&&(A.isTenantKilled(E.iKey())?m.push(E):(v=v||k.createPayload(u,p,T,C,g,h),k.appendPayload(v,E,l)?null!==v.overflow&&(d=[v.overflow].concat(d),v.overflow=null,_doPayloadSend(v,S,Object(j.i)(),g),S=Object(j.i)(),v=null):(_doPayloadSend(v,S,Object(j.i)(),g),S=Object(j.i)(),d=[E].concat(d),v=null)))}v&&_doPayloadSend(v,S,Object(j.i)(),g),d.length>0&&(L=d.concat(L)),_sendBatchesNotification(m,8004,h)}),(function(){return{batches:_createDebugBatches(E),retryCount:u,isTeardown:p,isSynchronous:T,sendReason:g,useSendBeacon:_isBeaconPayload(h),sendType:h}}),!T)}catch(l){f.diagLog().throwInternal(m.a.WARNING,v.f.CannotSerializeObject,\"Unexpected Exception sending batch: \"+Object(_.a)(l))}}}function _buildRequestDetails(l,d){var u={url:I,hdrs:{},useHdrs:!1};u.hdrs=Object(j.d)(u.hdrs,D),u.useHdrs=Object(h.B)(u.hdrs).length>0,_addRequestDetails(u,nt,\"NO_AUTH\",d),_addRequestDetails(u,tt,j.b,d);var p=\"\";Object(h.a)(l.apiKeys,(function(l){p.length>0&&(p+=\",\"),p+=l})),_addRequestDetails(u,ot,p,d),_addRequestDetails(u,rt,Object(h.f)().toString(),d);var g=_getMsfpc(l);if(Object(j.m)(g)&&(u.url+=\"&ext.intweb.msfpc=\"+g),P.shouldAddClockSkewHeaders()&&_addRequestDetails(u,it,P.getClockSkewHeaderValue(),d),C.getWParam){var f=C.getWParam();f>=0&&(u.url+=\"&w=\"+f)}for(var m=0;m<N.length;m++)u.url+=\"&\"+N[m].name+\"=\"+N[m].value;return u}function _canUseSendBeaconApi(){return!w&&O&&Object(_.m)()}function _setTimingValue(l,d,u){l[d]=l[d]||{},l[d][f.identifier]=u}function _doPayloadSend(l,d,u,p){if(l&&l.payloadBlob&&l.payloadBlob.length>0){var m=!!g.sendHook,v=y[l.sendType];!_isBeaconPayload(l.sendType)&&l.isBeacon&&2===l.sendReason&&(v=y[2]||y[3]||v);var E=U;(l.isBeacon||3===v._transport)&&(E=!1);var I=_buildRequestDetails(l,E);E=E||I.useHdrs;var A=Object(j.i)();Object(S.b)(C,(function(){return\"HttpManager:_doPayloadSend\"}),(function(){for(var y=0;y<l.batches.length;y++)for(var R=l.batches[y].events(),O=0;O<R.length;O++){var N=R[O];if(x){var D=N.timings=N.timings||{};_setTimingValue(D,\"sendEventStart\",A),_setTimingValue(D,\"serializationStart\",d),_setTimingValue(D,\"serializationCompleted\",u)}N[Ot]>0?N[Ot]++:N[Ot]=1}_sendBatchesNotification(l.batches,1e3+(p||0),l.sendType,!0);var L={data:l.payloadBlob,urlString:I.url,headers:I.hdrs,_thePayload:l,_sendReason:p,timeout:T};Object(h.x)(b)||(L.disableXhrSync=!!b),E&&(_hasHeader(L.headers,Qe)||(L.headers[Qe]=Ke),_hasHeader(L.headers,Ye)||(L.headers[Ye]=Je));var k=null;v&&(k=function(d){P.firstRequestSent();var onComplete=function(d,u){_retryRequestIfNeeded(d,u,l,p)},u=l.isTeardown||l.isSync;try{v.sendPOST(d,onComplete,u),g.sendListener&&g.sendListener(L,d,u,l.isBeacon)}catch(l){f.diagLog().warnToConsole(\"Unexpected exception sending payload. Ex:\"+Object(_.a)(l)),_doOnComplete(onComplete,0,{})}}),Object(S.b)(C,(function(){return\"HttpManager:_doPayloadSend.sender\"}),(function(){if(k)if(0===l.sendType&&M++,m&&!l.isBeacon&&3!==v._transport){var d={data:L.data,urlString:L.urlString,headers:Object(j.d)({},L.headers),timeout:L.timeout,disableXhrSync:L.disableXhrSync},u=!1;Object(S.b)(C,(function(){return\"HttpManager:_doPayloadSend.sendHook\"}),(function(){try{g.sendHook(d,(function(l){u=!0,w||l._thePayload||(l._thePayload=l._thePayload||L._thePayload,l._sendReason=l._sendReason||L._sendReason),k(l)}),l.isSync||l.isTeardown)}catch(l){u||k(L)}}))}else k(L)}))}),(function(){return{thePayload:l,serializationStart:d,serializationCompleted:u,sendReason:p}}),l.isSync)}l.sizeExceed&&l.sizeExceed.length>0&&_sendBatchesNotification(l.sizeExceed,8003,l.sendType),l.failedEvts&&l.failedEvts.length>0&&_sendBatchesNotification(l.failedEvts,8002,l.sendType)}function _addEventCompletedTimings(l,d){x&&Object(h.a)(l,(function(l){_setTimingValue(l.timings=l.timings||{},\"sendEventCompleted\",d)}))}function _retryRequestIfNeeded(l,d,p,g){var f=9e3,m=null,v=!1,y=!1;try{var S=!0;if(typeof l!==dt.l){if(d){P.setClockSkew(d[et]);var _=d[Xe]||d[\"kill-duration-seconds\"];Object(h.a)(A.setKillSwitchTenants(d[$e],_),(function(l){Object(h.a)(p.batches,(function(d){if(d.iKey()===l){m=m||[];var u=d.split(0);p.numEvents-=u.count(),m.push(u)}}))}))}if(200==l||204==l)return void(f=200);(!It.shouldRetryForStatus(l)||p.numEvents<=0)&&(S=!1),f=9e3+l%1e3}if(S){f=100;var C=p.retryCnt;0===p.sendType&&(C<u?(v=!0,_doAction((function(){0===p.sendType&&M--,_sendBatches(p.batches,C+1,p.isTeardown,F?2:p.sendType,5)}),F,It.getMillisToBackoffForRetry(C))):(y=!0,F&&(f=8001)))}}finally{v||(P.setClockSkew(),_handleRequestFinished(p,f,g,y)),_sendBatchesNotification(m,8004,p.sendType)}}function _handleRequestFinished(l,d,u,p){try{p&&f._backOffTransmission(),200===d&&(p||l.isSync||f._clearBackOff(),_addCompleteTimings(l.batches)),_sendBatchesNotification(l.batches,d,l.sendType,!0)}finally{0===l.sendType&&(M--,5!==u&&g.sendQueuedRequests(l.sendType,u))}}function _addCompleteTimings(l){if(x){var d=Object(j.i)();Object(h.a)(l,(function(l){l&&l.count()>0&&_addEventCompletedTimings(l.events(),d)}))}}function _doAction(l,d,u){d?l():f._setTimeoutOverride(l,u)}function _convertAllHeadersToMap(l){var d={};if(Object(h.u)(l)){var u=Object(h.H)(l).split(/[\\r\\n]+/);Object(h.a)(u,(function(l){if(l){var u=l.indexOf(\": \");if(-1!==u){var p=Object(h.H)(l.substring(0,u)).toLowerCase(),g=Object(h.H)(l.substring(u+1));d[p]=g}else d[Object(h.H)(l)]=1}}))}return d}function _getMsfpc(l){for(var d=0;d<l.batches.length;d++){var u=l.batches[d].Msfpc();if(u)return encodeURIComponent(u)}return\"\"}function _handleCollectorResponse(l){var d=g._responseHandlers;try{for(var u=0;u<d.length;u++)try{d[u](l)}catch(l){f.diagLog().throwInternal(m.a.CRITICAL,v.f.PostResponseHandler,\"Response handler failed: \"+l)}if(l){var p=JSON.parse(l);Object(j.m)(p.webResult)&&Object(j.m)(p.webResult[ct])&&E.set(\"MSFPC\",p.webResult[ct],31536e3)}}catch(l){}}function _sendBatchesNotification(l,d,u,h){if(l&&l.length>0&&p){var g=p[_getNotificationAction(d)];if(g){var y=0!==u;Object(S.b)(C,(function(){return\"HttpManager:_sendBatchesNotification\"}),(function(){_doAction((function(){try{g.call(p,l,d,y,u)}catch(l){f.diagLog().throwInternal(m.a.CRITICAL,v.f.NotificationException,\"send request notification failed: \"+l)}}),h||y,0)}),(function(){return{batches:_createDebugBatches(l),reason:d,isSync:y,sendSync:h,sendType:u}}),!y)}}}function _getNotificationAction(l){var d=wt[l];return Object(j.m)(d)||(d=ze,l>=9e3&&l<=9999?d=qe:l>=8e3&&l<=8999?d=He:l>=1e3&&l<=1999&&(d=Ge)),d}g.initialize=function(l,d,u,p,g){var m;g||(g={}),I=l+I,U=!Object(h.x)(g.avoidOptions)&&!g.avoidOptions,C=d,E=d.getCookieMgr(),x=!C.config.disableEventTimings;var v=!!C.config.enableCompoundKey;f=u;var S=g.valueSanitizer,A=g.stringifyObjects;Object(h.x)(g.enableCompoundKey)||(v=!!g.enableCompoundKey),T=g.xhrTimeout,b=g.disableXhrSync,O=!Object(_.p)(),k=new St(C,S,A,v);var R=p,P=g.alwaysUseXhrOverride?p:null,M=g.alwaysUseXhrOverride?p:null;if(!p){w=!1;var N=Object(_.g)();N&&N.protocol&&\"file:\"===N.protocol.toLowerCase()&&(B=!1);var D=[];D=Object(_.p)()?[2,1]:[1,2,3];var L=g.transports;L&&(Object(h.s)(L)?D=[L].concat(D):Object(h.k)(L)&&(D=L.concat(D))),p=_getSenderInterface(D,!1),R=_getSenderInterface(D,!0),p||f.diagLog().warnToConsole(\"No available transport to send events\")}(m={})[0]=p,m[1]=R||_getSenderInterface([1,2,3],!0),m[2]=P||_getSenderInterface([3,2],!0)||R||_getSenderInterface([1],!0),m[3]=M||_getSenderInterface([2,3],!0)||R||_getSenderInterface([1],!0),y=m},g._getDbgPlgTargets=function(){return[y[0],A,k,y]},g.addQueryStringParameter=function(l,d){for(var u=0;u<N.length;u++)if(N[u].name===l)return void(N[u].value=d);N.push({name:l,value:d})},g.addHeader=function(l,d){D[l]=d},g.canSendRequest=function(){return _hasIdleConnection()&&P.allowRequestSending()},g.sendQueuedRequests=function(l,d){Object(h.x)(l)&&(l=0),F&&(l=_adjustSendType(l),d=2),_canSendPayload(L,l,0)&&_sendBatches(_clearQueue(),0,!1,l,d||0)},g.isCompletelyIdle=function(){return!R&&0===M&&0===L.length},g.setUnloading=function(l){F=l},g.addBatch=function(l){if(l&&l.count()>0){if(A.isTenantKilled(l.iKey()))return!1;L.push(l)}return!0},g.teardown=function(){L.length>0&&_sendBatches(_clearQueue(),0,!0,2,2)},g.pause=function(){R=!0},g.resume=function(){R=!1,g.sendQueuedRequests(0,4)},g.sendSynchronousBatch=function(l,d,u){l&&l.count()>0&&(Object(h.r)(d)&&(d=1),F&&(d=_adjustSendType(d),u=2),_sendBatches([l],0,!1,d,u||0))}}))}return HttpManager}(),Lt=.25,kt=500,xt=20,Ft=6,Ut=2,jt=4,Bt=j.n?window:void 0,Vt=2,Ht=1,Gt=\"eventsDiscarded\",Wt=\"overrideInstrumentationKey\",qt=\"maxEventRetryAttempts\",zt=\"maxUnloadEventRetryAttempts\",Kt=function(l){function PostChannel(){var d,u=l.call(this)||this;u.identifier=\"PostChannel\",u.priority=1011,u.version=\"3.1.11\";var p,f,y,C,E,T=!1,b=[],I=null,A=!1,R=0,P=500,O=0,M=1e4,w={},N=Fe,D=null,L=null,k=0,x=0,U={},B=-1,V=!0,H=!1,G=Ft,W=Ut;return Object(g.a)(PostChannel,u,(function(l,u){function _hookWParam(l){var u=l.getWParam;l.getWParam=function(){var l=0;return d.ignoreMc1Ms0CookieProcessing&&(l|=2),l|u()}}function _handleUnloadEvents(l){\"beforeunload\"!==(l||Object(_.k)().event).type&&(H=!0,f.setUnloading(H)),_releaseAllQueues(2,2)}function _handleShowEvents(l){H=!1,f.setUnloading(H)}function _addEventToQueues(l,d){if(l.sendAttempt||(l.sendAttempt=0),l.latency||(l.latency=v.a.Normal),l.ext&&l.ext.trace&&delete l.ext.trace,l.ext&&l.ext.user&&l.ext.user.id&&delete l.ext.user.id,V&&(l.ext=Object(h.C)(l.ext),l.baseData&&(l.baseData=Object(h.C)(l.baseData)),l.data&&(l.data=Object(h.C)(l.data))),l.sync)if(k||A)l.latency=v.a.RealTime,l.sync=!1;else if(f)return V&&(l=Object(h.C)(l)),void f.sendSynchronousBatch(lt.create(l.iKey,[l]),!0===l.sync?1:l.sync,3);var u=l.latency,p=O,g=M;u===v.a.Immediate&&(p=R,g=P);var m=!1;if(p<g)m=!_addEventToProperQueue(l,d);else{var y=v.a.Normal,S=xt;u===v.a.Immediate&&(y=v.a.Immediate,S=1),m=!0,_dropEventWithLatencyOrLess(l.iKey,l.latency,y,S)&&(m=!_addEventToProperQueue(l,d))}m&&_notifyEvents(Gt,[l],F.QueueFull)}function _sendEventsForLatencyAndAbove(l,d,u){var p=_queueBatches(l,d,u);return f.sendQueuedRequests(d,u),p}function _hasEvents(){return O>0}function _scheduleTimer(){if(B>=0&&_queueBatches(B,0,E)&&f.sendQueuedRequests(0,E),R>0&&!L&&!A){var l=w[N][2];l>=0&&(L=_createTimer((function(){L=null,_sendEventsForLatencyAndAbove(v.a.Immediate,0,1),_scheduleTimer()}),l))}var d=w[N][1];!D&&!I&&d>=0&&!A&&(_hasEvents()?D=_createTimer((function(){D=null,_sendEventsForLatencyAndAbove(0===x?v.a.RealTime:v.a.Normal,0,1),x++,x%=2,_scheduleTimer()}),d):x=0)}function _createTimer(d,u){0===u&&k&&(u=1);var p=1e3;return k&&(p=It.getMillisToBackoffForRetry(k-1)),l._setTimeoutOverride(d,u*p)}function _clearScheduledTimer(){null!==D&&(l._clearTimeoutOverride(D),D=null,x=0)}function _releaseAllQueues(d,u){_clearScheduledTimer(),I&&(l._clearTimeoutOverride(I),I=null),A||_sendEventsForLatencyAndAbove(v.a.Normal,d,u)}function _clearQueues(){U[v.a.Immediate]={batches:[],iKeyMap:{}},U[v.a.RealTime]={batches:[],iKeyMap:{}},U[v.a.CostDeferred]={batches:[],iKeyMap:{}},U[v.a.Normal]={batches:[],iKeyMap:{}}}function _getEventBatch(l,d,u){var p=U[d];p||(d=v.a.Normal,p=U[d]);var h=p.iKeyMap[l];return!h&&u&&(h=lt.create(l),p.batches.push(h),p.iKeyMap[l]=h),h}function _performAutoFlush(d,u){f.canSendRequest()&&!k&&(y>0&&O>y&&(u=!0),u&&null==I&&l.flush(d,null,20))}function _addEventToProperQueue(l,d){V&&(l=Object(h.C)(l));var u=l.latency,p=_getEventBatch(l.iKey,u,!0);return!!p.addEvent(l)&&(u!==v.a.Immediate?(O++,d&&0===l.sendAttempt&&_performAutoFlush(!l.sync,C>0&&p.count()>=C)):R++,!0)}function _dropEventWithLatencyOrLess(l,d,u,p){for(;u<=d;){var h=_getEventBatch(l,d,!0);if(h&&h.count()>0){var g=h.split(0,p),f=g.count();if(f>0)return u===v.a.Immediate?R-=f:O-=f,_notifyBatchEvents(Gt,[g],F.QueueFull),!0}u++}return _resetQueueCounts(),!1}function _resetQueueCounts(){for(var l=0,d=0,_loop_1=function(u){var p=U[u];p&&p.batches&&Object(h.a)(p.batches,(function(p){u===v.a.Immediate?l+=p.count():d+=p.count()}))},u=v.a.Normal;u<=v.a.Immediate;u++)_loop_1(u);O=d,R=l}function _queueBatches(d,u,p){var g=!1,m=0===u;return!m||f.canSendRequest()?Object(S.b)(l.core,(function(){return\"PostChannel._queueBatches\"}),(function(){for(var l=[],u=v.a.Immediate;u>=d;){var p=U[u];p&&p.batches&&p.batches.length>0&&(Object(h.a)(p.batches,(function(d){f.addBatch(d)?g=g||d&&d.count()>0:l=l.concat(d.events()),u===v.a.Immediate?R-=d.count():O-=d.count()})),p.batches=[],p.iKeyMap={}),u--}l.length>0&&_notifyEvents(Gt,l,F.KillSwitch),g&&B>=d&&(B=-1,E=0)}),(function(){return{latency:d,sendType:u,sendReason:p}}),!m):(B=B>=0?Math.min(B,d):d,E=Math.max(E,p)),g}function _flushImpl(l,d){_sendEventsForLatencyAndAbove(v.a.Normal,0,d),_waitForIdleManager((function(){l&&l(),b.length>0?I=_createTimer((function(){return _flushImpl(b.shift(),d)}),0):(I=null,_hasEvents()&&_scheduleTimer())}))}function _waitForIdleManager(l){f.isCompletelyIdle()?l():I=_createTimer((function(){_waitForIdleManager(l)}),Lt)}function _resetTransmitProfiles(){_clearScheduledTimer(),_initializeProfiles(),N=Fe,_scheduleTimer()}function _initializeProfiles(){(w={})[Fe]=[2,1,0],w[Ue]=[6,3,0],w[je]=[18,9,0]}function _requeueEvents(d,u){var p=[],g=G;H&&(g=W),Object(h.a)(d,(function(d){d&&d.count()>0&&Object(h.a)(d.events(),(function(d){d&&(d.sync&&(d.latency=v.a.Immediate,d.sync=!1),d.sendAttempt<g?(Object(j.q)(d,l.identifier),_addEventToQueues(d,!1)):p.push(d))}))})),p.length>0&&_notifyEvents(Gt,p,F.NonRetryableStatus),H&&_releaseAllQueues(2,2)}function _callNotification(d,u){var p=l._notificationManager||{},h=p[d];if(h)try{h.apply(p,u)}catch(u){l.diagLog().throwInternal(m.a.CRITICAL,v.f.NotificationException,d+\" notification failed: \"+u)}}function _notifyEvents(l,d){for(var u=[],p=2;p<arguments.length;p++)u[p-2]=arguments[p];d&&d.length>0&&_callNotification(l,[d].concat(u))}function _notifyBatchEvents(l,d){for(var u=[],p=2;p<arguments.length;p++)u[p-2]=arguments[p];d&&d.length>0&&Object(h.a)(d,(function(d){d&&d.count()>0&&_callNotification(l,[d.events()].concat(u))}))}function _sendingEvent(l,d,u){l&&l.length>0&&_callNotification(\"eventsSendRequest\",[d>=1e3&&d<=1999?d-1e3:0,!0!==u])}function _eventsSentEvent(l,d){_notifyBatchEvents(\"eventsSent\",l,d),_scheduleTimer()}function _eventsDropped(l,d){_notifyBatchEvents(Gt,l,d>=8e3&&d<=8999?d-8e3:F.Unknown)}function _eventsResponseFail(l){_notifyBatchEvents(Gt,l,F.NonRetryableStatus),_scheduleTimer()}function _otherEvent(l,d){_notifyBatchEvents(Gt,l,F.Unknown),_scheduleTimer()}function _setAutoLimits(){C=d&&d.disableAutoBatchFlushLimit?0:Math.max(kt*(Vt+1),M/6)}_initializeProfiles(),_clearQueues(),_setAutoLimits(),f=new Dt(kt,Vt,Ht,{requeue:_requeueEvents,send:_sendingEvent,sent:_eventsSentEvent,drop:_eventsDropped,rspFail:_eventsResponseFail,oth:_otherEvent}),l._getDbgPlgTargets=function(){return[f]},l.initialize=function(g,m,v){Object(S.b)(m,(function(){return\"PostChannel:initialize\"}),(function(){var S=m;u.initialize(g,m,v),l.setInitialized(!1);var _=l._getTelCtx();g.extensionConfig[l.identifier]=g.extensionConfig[l.identifier]||{},d=_.getExtCfg(l.identifier),l._setTimeoutOverride=d.setTimeoutOverride?d.setTimeoutOverride:setTimeout.bind(Bt),l._clearTimeoutOverride=d.clearTimeoutOverride?d.clearTimeoutOverride:clearTimeout.bind(Bt),V=!d.disableOptimizeObj&&Object(j.j)(),_hookWParam(S),d.eventsLimitInMem>0&&(M=d.eventsLimitInMem),d.immediateEventLimit>0&&(P=d.immediateEventLimit),d.autoFlushEventsLimit>0&&(y=d.autoFlushEventsLimit),d.disableXhrSync,Object(h.s)(d[qt])&&(G=d[qt]),Object(h.s)(d[zt])&&(W=d[zt]),_setAutoLimits(),d.httpXHROverride&&d.httpXHROverride.sendPOST&&(p=d.httpXHROverride),Object(j.m)(g.anonCookieName)&&f.addQueryStringParameter(\"anoncknm\",g.anonCookieName),f.sendHook=d.payloadPreprocessor,f.sendListener=d.payloadListener;var C=d.overrideEndpointUrl?d.overrideEndpointUrl:g.endpointUrl;l._notificationManager=g.extensionConfig.NotificationManager,f.initialize(C,l.core,l,p,d);var E=g.disablePageUnloadEvents||[];Object(z.d)(_handleUnloadEvents,E),Object(z.b)(_handleUnloadEvents,E),Object(z.c)(_handleShowEvents,g.disablePageShowEvents),l.setInitialized(!0)}),(function(){return{coreConfig:g,core:m,extensions:v}}))},l.processTelemetry=function(u,p){Object(j.q)(u,l.identifier);var h=(p=l._getTelCtx(p)).getExtCfg(l.identifier),g=!!d.disableTelemetry;h&&(g=g||!!h.disableTelemetry);var f=u;g||T||(d[Wt]&&(f.iKey=d[Wt]),h&&h[Wt]&&(f.iKey=h[Wt]),_addEventToQueues(f,!0),H?_releaseAllQueues(2,2):_scheduleTimer()),l.processNext(f,p)},l.setEventQueueLimits=function(l,d){M=l>0?l:1e4,y=d>0?d:0,_setAutoLimits();var u=O>l;if(!u&&C>0)for(var p=v.a.Normal;!u&&p<=v.a.RealTime;p++){var g=U[p];g&&g.batches&&Object(h.a)(g.batches,(function(l){l&&l.count()>=C&&(u=!0)}))}_performAutoFlush(!0,u)},l.teardown=function(){_releaseAllQueues(2,2),T=!0,f.teardown()},l.pause=function(){_clearScheduledTimer(),A=!0,f.pause()},l.resume=function(){A=!1,f.resume(),_scheduleTimer()},l.addResponseHandler=function(l){f._responseHandlers.push(l)},l._loadTransmitProfiles=function(l){_resetTransmitProfiles(),Object(h.z)(l,(function(l,d){var u=d.length;if(u>=2){var p=u>2?d[2]:0;if(d.splice(0,u-2),d[1]<0&&(d[0]=-1),d[1]>0&&d[0]>0){var h=d[0]/d[1];d[0]=Math.ceil(h)*d[1]}p>=0&&d[1]>=0&&p>d[1]&&(p=d[1]),d.push(p),w[l]=d}}))},l.flush=function(l,d,u){void 0===l&&(l=!0),A||(_clearScheduledTimer(),u=u||1,l?(_queueBatches(v.a.Normal,0,u),_resetQueueCounts(),null==I?I=_createTimer((function(){_flushImpl(d,u)}),0):b.push(d)):(_sendEventsForLatencyAndAbove(v.a.Normal,1,u),null!=d&&d()))},l.setMsaAuthTicket=function(l){f.addHeader(at,l)},l.hasEvents=_hasEvents,l._setTransmitProfile=function(l){N!==l&&void 0!==w[l]&&(_clearScheduledTimer(),N=l,_scheduleTimer())},l._backOffTransmission=function(){k<jt&&(k++,_clearScheduledTimer(),_scheduleTimer())},l._clearBackOff=function(){k&&(k=0,_clearScheduledTimer(),_scheduleTimer())}})),u}return Object(p.b)(PostChannel,l),PostChannel}(E.a),Jt=function(){function BaseContext(l){this._setOverride=function(d,u){l.setOverride(d,u)},this._getOverride=function(d){return l.getOverride(d)}}return BaseContext}(),Qt=function(l){function ApplicationContext(d,u){var p=l.call(this,d)||this,g=p;return g.setId=function(l){g._setOverride(fe.id,l)},g.getId=function(){return g._getOverride(fe.id)},g.setVer=function(l){g._setOverride(fe.ver,l)},g.getVer=function(){return g._getOverride(fe.ver)},g.setName=function(l){g._setOverride(fe.appName,l)},g.getName=function(){return g._getOverride(fe.appName)},g.setLocale=function(l){g._setOverride(fe.locale,l)},g.getLocale=function(){return g._getOverride(fe.locale)},g.setEnv=function(l){g._setOverride(fe.env,l)},g.getEnv=function(){return g._getOverride(fe.env)},g.setExpId=function(l){g._setOverride(fe.expId,W.validateAppExpId(l))},g.getExpId=function(){return g._getOverride(fe.expId)},u&&(Object(h.x)(u.env)||g.setEnv(u.env),Object(h.r)(u.expId)||g.setExpId(u.expId)),p}return Object(p.b)(ApplicationContext,l),ApplicationContext}(Jt),Yt=function(l){function CloudContext(d){var u=l.call(this,d)||this,p=u;return p.setRole=function(l){p._setOverride(Ie.role,l)},p.getRole=function(){return p._getOverride(Ie.role)},p.setRoleInstance=function(l){p._setOverride(Ie.roleInstance,l)},p.getRoleInstance=function(){return p._getOverride(Ie.roleInstance)},p.setRoleVer=function(l){p._setOverride(Ie.roleVer,l)},p.getRoleVer=function(){return p._getOverride(Ie.roleVer)},u}return Object(p.b)(CloudContext,l),CloudContext}(Jt),$t=function(l){function DataContext(d){var u=l.call(this,d)||this,p=u;return p.setProperty=function(l,d){p._setOverride(l,d)},p.getProperty=function(l){return p._getOverride(l)},u}return Object(p.b)(DataContext,l),DataContext}(Jt),Xt=function(l){function DeviceContext(d){var u=l.call(this,d)||this,p=u;return p.setLocalId=function(l){p._setOverride(be.localId,l)},p.getLocalId=function(){return p._getOverride(be.localId)},p.setDeviceClass=function(l){p._setOverride(be.deviceClass,l)},p.getDeviceClass=function(){return p._getOverride(be.deviceClass)},p.setMake=function(l){p._setOverride(be.make,l)},p.getMake=function(){return p._getOverride(be.make)},p.setModel=function(l){p._setOverride(be.model,l)},p.getModel=function(){return p._getOverride(be.model)},u}return Object(p.b)(DeviceContext,l),DeviceContext}(Jt),Zt=function(l){function LocContext(d){var u=l.call(this,d)||this,p=u;return p.setTz=function(l){p._setOverride(Ee.tz,l)},p.getTz=function(){return p._getOverride(Ee.tz)},u}return Object(p.b)(LocContext,l),LocContext}(Jt),en=function(l){function OperatingSystemContext(d,u){var p=l.call(this,d)||this,h=p;if(h.setOsName=function(l){h._setOverride(ye.osName,l)},h.getOsName=function(){return h._getOverride(ye.osName)},h.setVer=function(l){h._setOverride(ye.ver,l)},h.getVer=function(){return h._getOverride(ye.ver)},u&&u.userAgent&&u.populateOperatingSystemInfo){var g=new ae(u);h.setOsName(g.name),h.setVer(g.ver)}return p}return Object(p.b)(OperatingSystemContext,l),OperatingSystemContext}(Jt);function _getEventRoot(l,d){if(l)for(var u=0;u<d.length;u++){var p=d[u];Object(h.r)(l[p])&&(l[p]={}),l=l[p]}return l}function _setOverride(l,d,u){if(l&&d){var p=d.split(\".\"),g=p[p.length-1];p.length>1&&(l=_getEventRoot(l,p.slice(0,-1))),Object(h.r)(u)?Object(h.x)(l[g])||delete l[g]:l[g]=u}}var tn=function(){function OverrideContainer(l){var d=this,u=[];d.setOverride=function(l,d){l&&u.push({key:l,value:d})},d.hasOverride=function(l){var d=!1;return Object(h.a)(u,(function(u){u.key===l&&(d=!0)})),d},d.getOverride=function(l){var d;return Object(h.a)(u,(function(u){u.key===l&&(d=u.value)})),d},d.applyOverrides=function(d,p){if(u.length>0)try{var g=_getEventRoot(d,l);Object(h.a)(u,(function(l){_setOverride(g,l.key,l.value)}))}catch(l){}}}return OverrideContainer}(),nn=function(l){function UserContext(d){var u=l.call(this,d)||this,p=u;return p.setLocalId=function(l){p._setOverride(ve.localId,l)},p.getLocalId=function(){return p._getOverride(ve.localId)},p.setLocale=function(l){p._setOverride(ve.locale,l)},p.getLocale=function(){return p._getOverride(ve.locale)},p.setId=function(l){p._setOverride(ve.id,l)},p.getId=function(){return p._getOverride(ve.id)},u}return Object(p.b)(UserContext,l),UserContext}(Jt),rn=function(l){function WebContext(d,u){var p=l.call(this,d)||this,g=p;return g.setDomain=function(l){g._setOverride(me.domain,l)},g.getDomain=function(){return g._getOverride(me.domain)},g.setBrowser=function(l){g._setOverride(me.browser,l)},g.getBrowser=function(){return g._getOverride(me.browser)},g.setBrowserVer=function(l){g._setOverride(me.browserVer,l)},g.getBrowserVer=function(){return g._getOverride(me.browserVer)},g.setScreenRes=function(l){g._setOverride(me.screenRes,l)},g.getScreenRes=function(){return g._getOverride(me.screenRes)},g.setUserConsent=function(l){g._setOverride(me.userConsent,l)},g.getUserContext=function(){return g._getOverride(me.userConsent)},u&&(Object(h.x)(u.userConsented)||g.setUserConsent(u.userConsented)),p}return Object(p.b)(WebContext,l),WebContext}(Jt),on=(h.u,\"ext\"),an=\"data\",sn=function(){function OverrideContext(l,d,u){var p=this,g={};function _getContainer(l){for(var d=\"\",u=0;u<l.length;u++)d&&(d+=\"_\"),d+=l[u];return Object(h.x)(g[d])&&(g[d]=new tn(l)),d?g[d]:null}p.data=new $t(_getContainer([an])),p.app=new Qt(_getContainer([on,Re.AppExt]),d),p.user=new nn(_getContainer([on,Re.UserExt])),p.os=new en(_getContainer([on,Re.OSExt]),d),p.web=new rn(_getContainer([on,Re.WebExt]),d),p.device=new Xt(_getContainer([on,Re.DeviceExt])),p.loc=new Zt(_getContainer([on,Re.LocExt])),p.cloud=new Yt(_getContainer([on,Re.CloudExt])),p.applyOverrides=function(l,d){var u=Object(h.B)(g);u&&u.length>0&&Object(h.a)(u,(function(u){g[u].applyOverrides(l,d)}))}}return OverrideContext}(),cn=function(l){function OverridePropertiesPlugin(){var d=l.call(this)||this;d.identifier=\"OverridePropertiesPlugin\",d.priority=4,d.version=\"3.1.11\";var u=d,p=null;return u._baseInit=function(l,u,h){p=new sn(l,d._getTelCtx().getExtCfg(d.identifier),u)},u.setProperty=function(l,d){p&&p.data.setProperty(l,d)},u.getOverrideContext=function(){return p},d}return Object(p.b)(OverridePropertiesPlugin,l),OverridePropertiesPlugin.prototype.initialize=function(d,u,p){l.prototype.initialize.call(this,d,u,p),this._baseInit(d,u,p)},OverridePropertiesPlugin.prototype.processTelemetry=function(l,d){Object(j.q)(l,this.identifier),d=this._getTelCtx(d);var u=this.getOverrideContext();u&&u.applyOverrides(l,d),this.processNext(l,d)},OverridePropertiesPlugin}(E.a);function _copyObjProperties(l,d){if(d)for(var u=Object(h.B)(d),p=0;p<u.length;p++){var g=u[p];Object(h.j)(l,g)||(l[g]=d[g])}}function _isChannel(l){return l.pause&&l.teardown&&l.flush}function _getEndpointUrl(l,d){var u=null;if(d){d.endpointUrl&&(u=d.endpointUrl);var p=(d.extensionConfig||{})[l]||{};p.overrideEndpointUrl&&(u=p.overrideEndpointUrl)}return u}var ln=function(l){function ChildNotificationManager(d,u){var p=l.call(this)||this;return Object(g.a)(ChildNotificationManager,p,(function(l,p){function _getEvents(l){var u=[];return l&&Object(h.a)(l,(function(l){l.iKey===d&&u.push(l)})),u}function _hasListeners(d){if(l[d]&&l.listeners)for(var u=0;u<l.listeners.length;u++){var p=l.listeners[u];if(p&&p[d])return!0}return!1}var g={eventsSent:function(d){if(_hasListeners(\"eventsSent\")){var u=_getEvents(d);u.length>0&&l.eventsSent(u)}},eventsDiscarded:function(d,u){if(_hasListeners(\"eventsDiscarded\")){var p=_getEvents(d);p.length>0&&l.eventsDiscarded(p,u)}},eventsSendRequest:function(d,u){_hasListeners(\"eventsSendRequest\")&&l.eventsSendRequest(d,u)},perfEvent:function(d){_hasListeners(\"perfEvent\")&&l.perfEvent(d)}};u.addNotificationListener(g)})),p}return Object(p.b)(ChildNotificationManager,l),ChildNotificationManager}(f),dn=function(){function ApplicationInsightsManager(){var l,d,u,p,_,C,E,T={},b=[],I=null,A=[],R=[],P={};Object(g.a)(ApplicationInsightsManager,this,(function(g){function _registerPlugin(l,d){if(void 0===d&&(d=null),l){(_isChannel(l)?R:A).push(l);var u=l.identifier;T.extensionConfig[u]=T.extensionConfig[u]||{},_copyObjProperties(T.extensionConfig[u],d)}return l}function _initializeSharedChannels(){var l=T.channels||[[]],d=new Kt,g=d.identifier,f=!1;u=null,p=null,Object(h.a)(l,(function(l){Object(h.a)(l,(function(l){Object(h.o)(l)||(_registerPlugin(l),l.identifier===g&&(f=!0,u=l))}))})),f||(l[0].push(d),u=_registerPlugin(d,T.channelConfiguration)),T.channels=l}function _initializeSharedExtensions(l){b=[],d=_registerPlugin(new xe,T.propertyConfiguration),b.push(d),T.extensions&&Object(h.a)(T.extensions,(function(l){Object(h.o)(l)||_registerPlugin(l)})),l&&Object(h.a)(l,(function(l){l&&!Object(h.o)(l)&&b.push(_registerPlugin(l))}))}function _initializeSharedInstance(d){if(!I){g.diagLog().throwInternal(m.a.WARNING,v.f.SDKNotInitialized,\"The Shared Manager is not yet created, the returned shared instance will be overwritten\");var h=_createMergedConfig(d||T.instrumentationKey||\"_not_defined_\",{});l=new f,(I=new un(g,g.diagLog(),l)).initialize(h,b),I.isInitialized()&&u&&(p=_getEndpointUrl(u.identifier,h))}}function _createMergedConfig(l,d){var u={};return u.instrumentationKey=l,u.channels=_createMergedChannels(d),_populateMergedConfigExtensions(u),_copyObjProperties(u,d),_copyObjProperties(u,T),u}function _createMergedChannels(l){var d=[[]];return T.channels&&Object(h.a)(T.channels,(function(l,u){Object(h.o)(l)||(d[u]=d[u]||[],d[u]=d[u].concat(l))})),l&&l.channels&&Object(h.a)(l.channels,(function(l,u){Object(h.o)(l)||(d[u]=d[u]||[],d[u]=d[u].concat(l))})),d}function _populateMergedConfigExtensions(l){var d=[];T.extensions&&T.extensions.length>0&&(d=d.concat(T.extensions)),l&&l.extensions&&l.extensions.length>0&&(d=d.concat(l.extensions)),d.length>0&&(l.extensions=d),l.extensionConfig=l.extensionConfig||{},_copyObjProperties(l.extensionConfig,T.extensionConfig)}function _createMergedExtensions(l){var d=[];return b&&b.length>0&&(d=d.concat(b)),l&&l.length>0&&(d=d.concat(l)),d}g.diagLog=function(){return _||(_=new y.a(T)),_},g.getCookieMgr=function(){return _initializeSharedInstance(),I.getCookieMgr()},g.setCookieMgr=function(l){return _initializeSharedInstance(),I.setCookieMgr(l)},g.getPerfMgr=function(){return E||T&&T.enablePerfMgr&&(E=new S.a(g.getNotifyMgr())),E},g.setPerfMgr=function(l){E=l},g.create=function(l,d){T=l||{},I=null,_initializeSharedChannels(),_initializeSharedExtensions(d)},g.getInst=function(l){return(P[l]||{}).inst},g.newInst=function(d,h,f){var y=g.getInst(d);if(y)return g.diagLog().throwInternal(m.a.WARNING,v.f.FailedToInitializeSDK,\"Instance already exists for [\"+d+\"]\"),y;if(_initializeSharedInstance(d),I.isInitialized()){var S=_createMergedConfig(d,h);if(u){var _=_getEndpointUrl(u.identifier,S);p&&_&&p!==_&&g.diagLog().throwInternal(m.a.WARNING,v.f.ErrorProvidedChannels,\"The endpointUrl mismatch, shared Url [\"+p+\"] is different from configured [\"+_+\"] shared will be used!\")}var C=new ln(d,l);y=new un(g,g.diagLog(),C),P[d]={iKey:d,inst:y,notifyMgr:C},y.setPerfMgr(g.getPerfMgr()),y.initialize(S,_createMergedExtensions(f)),y.isInitialized()||(g.diagLog().throwInternal(m.a.WARNING,v.f.SDKNotInitialized,\"Failed to initialize new instance!\"),y=null,delete P[d])}return y},g.getSharedPlugin=function(l){_initializeSharedInstance();var d=null;return Object(h.a)(A,(function(u){l===u.identifier&&(d=u)})),d||Object(h.a)(R,(function(u){l===u.identifier&&(d=u)})),d},g.getPropertyManager=function(){return _initializeSharedInstance(),d},g.getPostChannel=function(){return _initializeSharedInstance(),u},g.getNotifyMgr=function(){return C||(C=new f),C}}))}return ApplicationInsightsManager}(),un=function(l){function ApplicationInsights(d,u,p){var h,f=l.call(this)||this,y=d;return Object(g.a)(ApplicationInsights,f,(function(l,d){l.getSharedPropertyManager=function(){return y.getPropertyManager()},l.getSharedPostChannel=function(){return y.getPostChannel()},l.getOverridePropertyManager=function(){return h},l.initialize=function(g,f){Object(S.b)(l,(function(){return\"ApplicationInsights:initialize\"}),(function(){var y=[h=new cn];f&&(y=y.concat(f)),g.extensionConfig=g.extensionConfig||[];var S=g.propertyConfiguration||{};g.propertyConfiguration&&delete g.propertyConfiguration,g.extensionConfig[h.identifier]=S;try{d.initialize(g,y,u,p)}catch(d){l.logger.throwInternal(m.a.CRITICAL,v.f.FailedToInitializeSDK,\"Failed to initialize SDK.\"+Object(_.a)(d))}}),(function(){return{config:g,extensions:f}}))}})),f}return Object(p.b)(ApplicationInsights,l),ApplicationInsights}(H),pn=100},function(l,d,u){u.r(d),u.d(d,\"LocalStorageChannel\",(function(){return Ce})),u.d(d,\"StorageProviders\",(function(){return b})),u.d(d,\"BaseTelemetryPlugin\",(function(){return M.a})),u.d(d,\"LoggingSeverity\",(function(){return Ee.a})),u.d(d,\"_InternalLogMessage\",(function(){return Te.b})),u.d(d,\"_InternalMessageId\",(function(){return Ee.b}));var p=u(178),h=u(43),g=u(0),f=u(6),m=g.o;function _createPromiseAllOnResolvedFunction(l,d,u){return function(p){l[d]=p,u()}}var v=function(){function ESPromise(l){var d=0,u=null,p=[];function _enqueue(l,h,g,f){p.push((function(){var p;try{(p=1===d?m(l)?l(u):u:m(h)?h(u):u)instanceof ESPromise?p.then(g,f):2!==d||m(h)?g(p):f(p)}catch(l){return void f(l)}})),0!==d&&_processQueue()}function _processQueue(){if(p.length>0){var l=p.slice();p=[],setTimeout((function(){for(var d=0,u=l.length;d<u;++d)try{l[d]()}catch(l){}}),0)}}function _resolve(l){0===d&&(u=l,d=1,_processQueue())}function _reject(l){0===d&&(u=l,d=2,_processQueue())}Object(f.a)(ESPromise,this,(function(l){l.then=function(l,d){return new ESPromise((function(u,p){_enqueue(l,d,u,p)}))},l.catch=function(d){return l.then(null,d)}})),function _initialize(){if(!m(l))throw new TypeError(\"ESPromise: resolvedFunc argument is not a Function\");try{l(_resolve,_reject)}catch(l){_reject(l)}}()}return ESPromise.resolve=function(l){return l instanceof ESPromise?l:l&&m(l.then)?new ESPromise((function(d,u){try{l.then(d,u)}catch(l){u(l)}})):new ESPromise((function(d){d(l)}))},ESPromise.reject=function(l){return new ESPromise((function(d,u){u(l)}))},ESPromise.all=function(l){if(l&&l.length)return new ESPromise((function(d,u){try{for(var p=[],h=0,g=0;g<l.length;g++){var f=l[g];f&&m(f.then)?(h++,f.then(_createPromiseAllOnResolvedFunction(p,g,(function(){0==--h&&d(p)})),u)):p[g]=f}0===h&&setTimeout((function(){d(p)}),0)}catch(l){u(l)}}))},ESPromise.race=function(l){return new ESPromise((function(d,u){if(l&&l.length)try{for(var _loop_1=function(p){var h=l[p];h&&m(h.then)?h.then(d,u):setTimeout((function(){d(h)}),0)},p=0;p<l.length;p++)_loop_1(p)}catch(l){u(l)}}))},ESPromise}(),y=u(31),S=6e5,_=0,C=[],E=[],T=[];function _getTime(){return(new Date).getTime()}var b,I=function(){function ESPromiseScheduler(l,d){var u=0,p=(l||\"<unnamed>\")+\".\"+_;function _debugLog(l){var d=Object(y.a)();d&&d.QUnit&&console&&console.log(\"ESPromiseScheduler[\"+p+\"] \"+l)}function _warnLog(l){d&&d.warnToConsole(\"ESPromiseScheduler[\"+p+\"] \"+l)}_++,Object(f.a)(ESPromiseScheduler,this,(function(l){var d=null,h=0;function _removeQueuedEvent(l,d){for(var u=0;u<l.length;u++)if(l[u].id===d)return l.splice(u,1)[0];return null}l.scheduleEvent=function(l,g,f){var m=p+\".\"+h;h++,g&&(m+=\"-(\"+g+\")\");var y=m+\"{\"+u+\"}\";u++;var _={evt:null,tm:_getTime(),id:y,isRunning:!1,isAborted:!1};return _.evt=d?_waitForPreviousEvent(_,d):_startWaitingEvent(_),(d=_).evt._schId=y,_.evt;function _abortAndRemoveOldEvents(l){for(var d=_getTime(),u=d-S,p=l.length,h=0;h<p;){var g=l[h];if(g&&g.tm<u){var f=null;g.abort?(f=\"Aborting [\"+g.id+\"] due to Excessive runtime (\"+(d-g.tm)+\" ms)\",g.abort(f)):f=\"Removing [\"+g.id+\"] due to Excessive runtime (\"+(d-g.tm)+\" ms)\",_warnLog(f),l.splice(h,1),p--}else h++}}function _cleanup(l,u){var p=!1,h=_removeQueuedEvent(C,l);if(h||(h=_removeQueuedEvent(T,l),p=!0),h){h.to&&(clearTimeout(h.to),h.to=null);var g=_getTime()-h.tm;u?p?_warnLog(\"Timed out event [\"+l+\"] finally complete -- \"+g+\" ms\"):_debugLog(\"Promise [\"+l+\"] Complete -- \"+g+\" ms\"):(T.push(h),_warnLog(\"Event [\"+l+\"] Timed out and removed -- \"+g+\" ms\"))}else _debugLog(\"Failed to remove [\"+l+\"] from running queue\");d&&d.id===l&&(d=null),_abortAndRemoveOldEvents(C),_abortAndRemoveOldEvents(E),_abortAndRemoveOldEvents(T)}function _removeScheduledEvent(l,d){return function(u){return _cleanup(l,!0),d&&d(u),u}}function _waitForFinalResult(l,d,u,p){d.then((function(d){return d instanceof v?(_debugLog(\"Event [\"+l+\"] returned a promise -- waiting\"),_waitForFinalResult(l,d,u,p),d):_removeScheduledEvent(l,u)(d)}),_removeScheduledEvent(l,p))}function _createScheduledEvent(l,d){var u=l.id;return new v((function(p,h){_debugLog(\"Event [\"+u+\"] Starting -- waited for \"+(l.wTm||\"--\")+\" ms\"),l.isRunning=!0,l.abort=function(d){l.abort=null,l.isAborted=!0,_cleanup(u,!1),h(new Error(d))};var g=d(u);g instanceof v?(f&&(l.to=setTimeout((function(){_cleanup(u,!1),h(new Error(\"Timed out after [\"+f+\"] ms\"))}),f)),_waitForFinalResult(u,g,(function(d){_debugLog(\"Event [\"+u+\"] Resolving after \"+(_getTime()-l.tm)+\" ms\"),p(d)}),h)):(_debugLog(\"Promise [\"+u+\"] Auto completed as the start action did not return a promise\"),p())}))}function _startWaitingEvent(d){var u=_getTime();return d.wTm=u-d.tm,d.tm=u,d.isAborted?v.reject(new Error(\"[\"+m+\"] was aborted\")):(C.push(d),_createScheduledEvent(d,l))}function _waitForPreviousEvent(l,d){var u=new v((function(u,p){var h=_getTime()-d.tm,g=d.id;_debugLog(\"[\"+m+\"] is waiting for [\"+g+\":\"+h+\" ms] to complete before starting -- [\"+E.length+\"] waiting and [\"+C.length+\"] running\"),l.abort=function(d){l.abort=null,_removeQueuedEvent(E,m),l.isAborted=!0,p(new Error(d))},d.evt.then((function(d){_removeQueuedEvent(E,m),_startWaitingEvent(l).then(u,p)}),(function(d){_removeQueuedEvent(E,m),_startWaitingEvent(l).then(u,p)}))}));return E.push(l),u}}}))}return ESPromiseScheduler.incomplete=function(){return C},ESPromiseScheduler.waitingToStart=function(){return E},ESPromiseScheduler}(),A=u(70),R=u(37),P=u(36),O=u(20),M=u(177);function isValidPersistenceLevel(l){return Object(g.s)(l)&&l>=O.b.Normal&&l<=O.b.Critical}!function(l){l[l.LocalStorage=1]=\"LocalStorage\",l[l.SessionStorage=2]=\"SessionStorage\",l[l.IndexedDb=3]=\"IndexedDb\"}(b||(b={}));var w=10,N=\"3\",D=\"Version\",L=6e5,k=\"AWTEvents\",x=5e6,F=1,U=2;function _isQuotaExceeded(l,d){var u=!1;return d instanceof DOMException&&(22!==d.code&&\"QuotaExceededError\"!==d.name&&1014!==d.code&&\"NS_ERROR_DOM_QUOTA_REACHED\"!==d.name||l&&0!==l.length&&(u=!0)),u}function _getAvailableStorage(l){var d=Object(y.a)()||{},u=null;try{if(u=d[l]){var p=\"__storage_test__\";u.setItem(p,p),u.removeItem(p)}}catch(l){_isQuotaExceeded(u,l)||(u=null)}return u}function _forEachMap(l,d){if(l)for(var u=Object(g.B)(l),p=0;p<u.length;p++){var h=u[p];if(!d(l[h],h))break}}function _isMapEmpty(l){var d=!0;return _forEachMap(l,(function(l,u){return l&&(d=!1),d})),d}function _dropEventsUpToPersistence(l,d){for(var u=F,p=0,_loop_1=function(){var l=[],h=d[u];if(_forEachMap(h,(function(d,u){return l.push(u),++p<w})),p>0){for(var g=0;g<l.length;g++)delete h[l[g]];return{value:!0}}u++};u<=l&&p<w;){var h=_loop_1();if(\"object\"==typeof h)return h.value}return p>0}var j=isValidPersistenceLevel,B=function(){function WebStorageProvider(l,d){Object(f.a)(WebStorageProvider,this,(function(u){var p=null,h=k,g=null,f=N,m=null,y=null,S=x,_=null,C=null;function _newStore(l,d){return{key:l,db:d}}function _fetchStoredDb(l,d){void 0===d&&(d=!0);var u=null;if(p){var h=p.getItem(l);if(h)try{u=JSON.parse(h)}catch(d){p.removeItem(l)}}return d&&!u&&(u={events:{1:{},2:{},3:{}},lastAccessTime:0}),_newStore(l,u)}function _updateStoredDb(l,d){void 0===d&&(d=!0);var u=!0,h=l.db;if(h){d&&(h.lastAccessTime=(new Date).getTime());for(var g=F;g<=U;g++)if(!_isMapEmpty(h.events[g])){u=!1;break}}try{if(u)p&&p.removeItem(l.key);else{var f=JSON.stringify(h);if(f.length>S)return!1;p&&p.setItem(l.key,f)}}catch(l){return!1}return!0}function _clearDatabase(l){var d=[],u=_fetchStoredDb(l,!1),h=u.db;if(h){var g=h.events;try{for(var f=F;f<=U;f++)_forEachMap(g[f],(function(l,u){return l&&d.push(l),!0}))}catch(l){}p&&p.removeItem(u.key)}return d}function _checkVersionAndMoveEventsToCurrentStorage(){if(p){for(var l=p.getItem(_),d=[],u=_fetchStoredDb(C),g=!1,m=0;m<p.length;m++){var v=p.key(m);if(0===v.indexOf(h)&&v!==_){if(l!==N){d.push(_newStore(v,null));continue}var S=_fetchStoredDb(v,!1),E=S.db;if(E){if((new Date).getTime()-E.lastAccessTime>L){for(var T=F,_loop_3=function(){var l=E.events[T],d=u.db.events[T];_forEachMap(l,(function(u,p){return(Object(A.h)(u.iKey)||u.iKey)===y&&(d[p]=u,delete l[p]),!0})),T++};T<=U;)_loop_3();g=!0,d.push(S)}}else d.push(_newStore(v,null))}}for(m=0;m<d.length;m++)_updateStoredDb(d[m],!1);g&&_updateStoredDb(u),p.setItem(_,f)}}u.id=d,p=_getAvailableStorage(l)||null,u.initialize=function(l){if(!p)return!1;var d=l.storageConfig||{};return S=d.maxStorageSizeInBytes>0?d.maxStorageSizeInBytes:S,h=d.storageKey||k,g=u.id||l.id||Object(R.f)(),C=h+\".\"+g,_=h+D,m=l.itemCtx.getCfg().instrumentationKey,y=Object(A.h)(m)||m,_checkVersionAndMoveEventsToCurrentStorage(),!0},u.supportsSyncRequests=function(){return!0},u.getAllEvents=function(){try{var l=[],d=_fetchStoredDb(C,!1).db;if(d)for(var u=d.events,p=U;p>=F;p--)_forEachMap(u[p],(function(d){d&&((Object(A.h)(d.iKey)||d.iKey)===y&&l.push(d));return!0}));return v.resolve(l)}catch(l){return v.reject(l)}},u.addEvent=function(l,d,u){try{var p=_fetchStoredDb(C);d.id=d.id||Object(R.f)(),j(d.persistence)||(d.persistence=F);for(var h=d.persistence,g=d.id,f=p.db.events;;){if(f[h][g]=d,_updateStoredDb(p))return v.resolve(d);if(delete f[h][g],!_dropEventsUpToPersistence(h,f))return v.reject(new Error(\"Unable to free up event space\"))}}catch(l){return v.reject(l)}},u.removeEvents=function(l){try{var d=_fetchStoredDb(C,!1),u=d.db;if(u){var p=u.events;try{for(var h=0;h<l.length;++h){var g=l[h];delete p[g.persistence][g.id]}if(_updateStoredDb(d))return v.resolve(l)}catch(l){}l=_clearDatabase(d.key)}return v.resolve(l)}catch(l){return v.reject(l)}},u.clear=function(){try{var l=[],d=_fetchStoredDb(C,!1),u=d.db;if(u){for(var p=u.events,_loop_2=function(d){var u=p[d];_forEachMap(u,(function(d){d&&((Object(A.h)(d.iKey)||d.iKey)===y&&(delete u[d.id],l.push(d)));return!0}))},h=U;h>=F;h--)_loop_2(h);_updateStoredDb(d)}return v.resolve(l)}catch(l){return v.reject(l)}},u.teardown=function(){try{var l=_fetchStoredDb(C,!1),d=l.db;d&&(d.lastAccessTime=0,_updateStoredDb(l,!1))}catch(l){}}}))}return WebStorageProvider}(),V=u(11),H=\"readwrite\",G=\"result\",W=\"DBError: Unable to open database\",q=\"Database is not open\",z=\"DBError: Failed to Open Cursor\",K=\"DBError: Failed to delete the database\",J=\"DBError: Database does not exist\",Q=\"DBError: Database upgrade required\",Y=\"DBError: Feature not supported\",$=[\"indexedDB\"],X=g.o,Z=g.u;function _getDbFactory(){var l=Object(y.a)()||{},d=null;if(l)try{for(var u=0;u<$.length;u++)if((d=l[$[u]])&&X(d.open))return d}catch(l){d=null}return d||null}function IndexedDbHelper_debugLog(l,d){Object(V.e)(\"QUnit\")&&console&&console.log(\"IndexedDbHelper [\"+l+\"] \"+d)}function IndexedDbHelper_warnLog(l,d,u){l&&l.warnToConsole(\"IndexedDbHelper [\"+d+\"] \"+u)}function _eventReject(l,d,u,p){return function(h){u(new Error(d)),IndexedDbHelper_debugLog(l,\"[\"+p+\"] event rejected\")}}var ee=[];function _getDbContext(l,d){for(var u=null,p=0;p<ee.length;p++)if((u=ee[p]).name===l)return u;return u={name:l,sch:new I(\"IndexedDbHelper[\"+l+\"]\",d),dbHdl:[],add:function(d){u.dbHdl.push(d),IndexedDbHelper_debugLog(l,\"- dbOpened (add) -- hdls [\"+u.dbHdl.length+\"]\")},remove:function(d){for(var p=u.dbHdl,h=0;h<p.length;h++)if(p[h]===d){p.splice(h,1);break}IndexedDbHelper_debugLog(l,\"- dbClosed (remove) -- hdls [\"+u.dbHdl.length+\"]\")},isOpen:function(){return u.dbHdl.length>0},openHdl:function(){return u.dbHdl.length>0?u.dbHdl[0]:null}},ee.push(u),u}var te=function(){function IndexedDbHelper(l){Object(f.a)(IndexedDbHelper,this,(function(d){var u=_getDbFactory()||null;function _createStoreContext(d,u){var p=d.db.transaction(u,H);return p.onabort=function(){IndexedDbHelper_warnLog(l,d.dbName,\"txn.onabort\")},p.onerror=function(){IndexedDbHelper_warnLog(l,d.dbName,\"txn.onerror\")},p.oncomplete=function(){IndexedDbHelper_debugLog(d.dbName,\"txn.oncomplete\")},{db:d,store:p.objectStore(u),tx:p,tbl:u,openCursor:function(l,p){return _openCursor(d,u,l,p)},newTransaction:function(l){return _openStore(d,u,l)}}}function _openStore(l,d,u){if(!l||!l.db)return v.reject(new Error(q));try{var p=u(_createStoreContext(l,d));return p instanceof v?p:v.resolve(p)}catch(l){return v.reject(l)}}function _openCursor(l,d,u,p){if(!l||!l.db)return v.reject(new Error(q));var h=null;return u&&Z(u)?h=new ne(u):u&&u.isMatch&&(h=u),new v((function(u,g){var f=[],m=null,v=null;h&&h.keyRange&&(v=h.keyRange());var y=_createStoreContext(l,d);(m=v?y.store.openCursor(v):y.store.openCursor()).onerror=_eventReject(y.db.dbName,z,g,\"openCursor\"),m.onsuccess=function(l){var d=l.target[G];if(d){var m={store:y,cursor:d,continue:function(){d.continue()},done:function(){u(f)}},v=d.value;if(!h||h.isMatch(v))if(p)try{switch(p(m,v,f)){case 2:u(f);break;case 1:break;case 0:default:m.continue()}}catch(l){g(l)}else f.push(v),m.continue();else m.continue()}else u(f)}}))}function _scheduleEvent(l,d,u,p){return _getDbContext(l).sch.scheduleEvent(u,d,p)}d.isAvailable=function(){return!!u},d.openDb=function(d,p,h,g){return _scheduleEvent(d,\"openDb\",(function(f){return new v((function(m,v){var y=!1;function _createDbCtx(l,u,h,g,f){var m={db:u,dbName:d,dbVersion:p,ctx:null,isNew:g,txn:h?h.transaction:null};return f||(m.openStore=function(l,d){return _openStore(m,l,d)},m.openCursor=function(l,d,u){return _openCursor(m,l,d,u)}),m}function _databaseUpgrade(l,d){var u=_createDbCtx(null,l,d,!0,!0);if(g)y=!0,g(u).then((function(){u.txn||(u.txn=d.transaction)}),(function(l){try{d.transaction&&d.transaction.abort()}finally{v(l)}}));else try{d.transaction&&d.transaction.abort()}finally{v(new Error(Q))}}function _databaseOpen(u,p){var g=_getDbContext(d);g.add(u),u.onabort=function(p){IndexedDbHelper_warnLog(l,d,\"onabort -- closing the Db\"),g.remove(u)},u.onerror=function(p){IndexedDbHelper_warnLog(l,d,\"onerror -- closing the Db\"),g.remove(u)},u.onclose=function(p){IndexedDbHelper_warnLog(l,d,\"onclose -- closing the Db\"),g.remove(u)},u.onversionchange=function(p){IndexedDbHelper_warnLog(l,d,\"onversionchange -- force closing the Db\"),u.close(),g.remove(u)};var f=null,S=null;g.dbHdl.length>0&&(S=g.dbHdl[0]),f=_createDbCtx(g,S,p,y);try{h(f).then((function(l){m(l)}),v)}catch(l){v(l)}}var S=_getDbContext(d);if(null==u)v(new Error(\"No available storage factory\"));else if(S.isOpen()){var _=_createDbCtx(S,S.openHdl(),null,!1);h(_).then(m,v)}else{var C=u.open(d,p);C.onblocked=function(u){IndexedDbHelper_warnLog(l,d,\"Db Open Blocked event [\"+f+\"] - \"+(C.error||\"\")),v(new Error(W))},C.onerror=function(u){IndexedDbHelper_warnLog(l,d,\"Db Open Error event [\"+f+\"] - \"+(C.error||\"\")),v(new Error(W))},C.onupgradeneeded=function(l){IndexedDbHelper_debugLog(d,\"Db Open Create/Upgrade needed event [\"+f+\"]\");try{var u=l.target[G];if(!u)return void v(new Error(W));_databaseUpgrade(u,C)}catch(l){_eventReject(d,W,v,f)(l)}},C.onsuccess=function(l){var d=l.target[G];d?_databaseOpen(d,C):v(new Error(W))}}}))}))},d.closeDb=function(l){_scheduleEvent(l,\"closeDb\",(function(d){var u=_getDbContext(l),p=u.dbHdl,h=p.length;if(h>0){for(var g=0;g<h;g++)p[g].close();u.dbHdl=[]}return v.resolve(1)}))},d.deleteDb=function(d){return null==u?v.resolve(!1):_scheduleEvent(d,\"deleteDb\",(function(p){var h=_getDbContext(d),g=h.dbHdl,f=g.length;if(f>0){IndexedDbHelper_warnLog(l,d,\"Db is open [\"+f+\"] force closing\");for(var m=0;m<f;m++)g[m].close();h.dbHdl=[]}return new v((function(h,g){setTimeout((function(){try{IndexedDbHelper_debugLog(d,\"[\"+p+\"] starting\");var f=u.deleteDatabase(d);f.onerror=function(u){IndexedDbHelper_warnLog(l,d,\"[\"+p+\"] error!!\"),g(new Error(K))},f.onblocked=function(u){IndexedDbHelper_warnLog(l,d,\"[\"+p+\"] blocked!!\"),g(new Error(K))},f.onupgradeneeded=function(u){IndexedDbHelper_warnLog(l,d,\"[\"+p+\"] upgrade needed!!\"),g(new Error(K))},f.onsuccess=function(l){IndexedDbHelper_debugLog(d,\"[\"+p+\"] complete\"),h(!0)},IndexedDbHelper_debugLog(d,\"[\"+p+\"] started\")}catch(u){IndexedDbHelper_warnLog(l,d,\"[\"+p+\"] threw - \"+u),g(new Error(K+\" - \"+u))}}),0)}))}))},d.getDbDetails=function(l){return _scheduleEvent(l,\"getDbDetails\",(function(d){return null!=u&&u.databases?new v((function(d,p){u.databases().then((function(u){for(var h=0;h<u.length;h++)if(u[h].name===l)return void d(u[h]);p(new Error(J))}),p)})):v.reject(new Error(Y))}),2e3)}}))}return IndexedDbHelper}(),ne=function(){function SimpleQuery(l){var d=[],u=null;Object(f.a)(SimpleQuery,this,(function(p){p.keyRange=function(){return u},p.parseQuery=function(l){if(d=[],l)for(var h=l.split(\";\"),g=0;g<h.length;g++){var f=h[g],m=f.indexOf(\"=\");if(-1!==m){var v=f.substring(0,m),y=f.substring(m+1);0===v.indexOf(\"#\")&&(v=v.substring(1),u||(u=IDBKeyRange.bound(y,y+\"\"))),p.startsWith(v,y)}}},p.startsWith=function(l,u){d.push({name:l,value:u,type:0})},p.contains=function(l,u){d.push({name:l,value:u,type:1})},p.isMatch=function(l){if(!d||0===d.length)return!0;if(!l)return!1;for(var u=0;u<d.length;u++){var p=d[u],h=l[p.name];if(h)if(0===p.type){if(0!==h.indexOf(p.value))return!1}else if(1===p.type&&-1===h.indexOf(p.value))return!1}return!0},l&&p.parseQuery(l)}))}return SimpleQuery}(),ie=10,re=1,oe=6e5,ae=1008e4,se=\"Unknown\",ce=-1,le=\"DBError: Unable to add event\",de=\"DBError: Unable to update iKey\",ue=\"AppInsightEvents.1\",pe=1,he=\"Evts\",ge=\"iKey\",fe=isValidPersistenceLevel;function IndexedDbProvider_getTime(){return(new Date).getTime()}function IndexedDbProvider_eventReject(l,d){return function(u){return d(new Error(l))}}function _createDb(l){l.objectStoreNames.contains(he)||l.createObjectStore(he,{keyPath:\"key\"}).createIndex(\"EvntId\",\"key\",{unique:!1});l.objectStoreNames.contains(ge)||l.createObjectStore(ge,{keyPath:\"iKey\"}).createIndex(\"iKey\",\"iKey\",{unique:!0})}function _updateiKey(l){return l.openStore(ge,(function(d){return new v((function(u,p){var h={iKey:l.ctx.iKey,tm:IndexedDbProvider_getTime()},g=d.store.put(h);g.onsuccess=function(l){u(g.result.toString())},g.onerror=function(l){p(new Error(le))},g.onerror=IndexedDbProvider_eventReject(de,p)}))}))}function _orderEventsByPriority(l){for(var d=[],u=O.b.Critical;u>=O.b.Normal;u--)for(var p=0;p<l.length;p++){var h=l[p];h&&h.evt.persistence===u&&d.push(h.evt)}return d}function _addEventByTime(l,d){for(var u=0;u<l.length;u++)if(d.tm<l[u].tm)return void l.splice(u,0,d);l.push(d)}function _getKeyIndex(l,d){for(var u=d.length,p=0;p<u;p++)if(l===d[p].id)return p;return-1}function _isOldItem(l,d){var u=l.tm;return IndexedDbProvider_getTime()-u>d}function _cursorContinueEvent(l){return function(d){return l.continue()}}function _cursorDeleteAndContinue(l){var d=l.cursor.delete();return d.onerror=_cursorContinueEvent(l),d.onsuccess=_cursorContinueEvent(l),1}function _getAllEventsForiKey(l,d){return l.openCursor(he,d,(function(l,d,u){return u.push(d),0}))}function _deleteEvents(l,d,u){return l.openCursor(he,d,(function(l,d,p){return u(d)?(p.push(d),_cursorDeleteAndContinue(l)):0}))}function _deleteOrphanedEvents(l){return new v((function(d,u){var p=!1;l.openCursor(ge,null,(function(l,d,u){var h=d.tm;return IndexedDbProvider_getTime()-h<ae?0:(p=!0,2)})).then((function(){if(p){var h={};_deleteEvents(l,null,(function(l){if(!l||!l.evt||!l.evt.iKey)return!0;var d=l.tm;return IndexedDbProvider_getTime()-d>ae||(h[l.evt.iKey]=1,!1)})).then((function(){var p=[];l.openCursor(ge,null,(function(l,d,u){var g=d.tm;return IndexedDbProvider_getTime()-g<ae||h[d.iKey]?0:(p.push(d),_cursorDeleteAndContinue(l))})).then((function(){d(p)}),u)}),u)}else d([])}),u)}))}function _moveOldEventsToCurrentStore(l){return l.openCursor(he,\"#key=\"+l.ctx.iKeyPrefix(),(function(d,u){var p=u.key;if(0===p.indexOf(l.ctx.iKeyPrefix())&&-1===p.indexOf(l.ctx.evtKeyPrefix())&&_isOldItem(u,oe)){u.key=l.ctx.evtKeyPrefix()+u.id;var h=d.store.store.put(u);return h.onerror=_cursorContinueEvent(d),h.onsuccess=function(l){try{_cursorDeleteAndContinue(d)}catch(l){d.continue()}},1}return 0}))}function IndexedDbProvider_checkVersionAndMoveEventsToCurrentStorage(l){return new v((function(d,u){_deleteOrphanedEvents(l).then((function(){_moveOldEventsToCurrentStore(l).then(d,d)}),u)}))}function IndexedDbProvider_dropEventsUpToPersistence(l,d){return new v((function(u,p){var h=0,g=l.ctx.evtKeyPrefix();function _resolveWithDroppedEvents(){u(h)}function _dropEvent(l,d){return new v((function(u){var p=l.store.delete(d.key);p.onsuccess=function(l){h++,u()},p.onerror=function(l){u()}}))}function _processCandidates(d){0!==d.length?l.openStore(he,(function(l){for(var u=[],p=0;p<d.length;p++)u.push(_dropEvent(l,d[p]));return v.all(u).then(_resolveWithDroppedEvents,_resolveWithDroppedEvents)})):_resolveWithDroppedEvents()}l.openCursor(he,\"#key=\"+g,(function(l,u,p){return u.evt.persistence<=d&&0===u.key.indexOf(g)&&(_addEventByTime(p,u),p.length>ie&&p.splice(p.length-1,1)),0})).then(_processCandidates,(function(){u(0)}))}))}var me=function(){function IndexedDbProvider(l){Object(f.a)(IndexedDbProvider,this,(function(d){var u=null,p=null,h=se,g=null,f=null,m=null,y=ce,S=0;function _openDb(l){function _handleDbUpgrade(l){return new v((function(d,u){_createDb(l.db),d()}))}function _handleDbOpen(d){return new v((function(u,p){var v={iKey:h,storageId:g,iKeyPrefix:function(){return f},evtKeyPrefix:function(){return m}};d.ctx=v,_updateiKey(d).then((function(){l(d).then(u,p)}),p)}))}return u.openDb(p,pe,_handleDbOpen,_handleDbUpgrade)}function _addDbEvent(l,d,u){return new v((function(p,h){function dropEvents(d,u){IndexedDbProvider_dropEventsUpToPersistence(l,d).then((function(l){l>0&&(S-=l),u(l)}),(function(l){u(0)}))}function resolveAddEvent(l){p(d.evt)}function _insertNewEvent(){l.openStore(he,(function(g){var f=g.store.put(d);f.onsuccess=function(h){u&&_updateiKey(l).then(resolveAddEvent,resolveAddEvent),S++,p(d.evt)},f.onerror=function(g){function _retryAddEvent(u){0===u&&h(new Error(le)),_addDbEvent(l,d,!1).then((function(l){p(d.evt)}),(function(){h(new Error(le))}))}u?dropEvents(O.b.Normal,(function(l){l>0?_retryAddEvent(l):d.evt.persistence>=O.b.Critical?dropEvents(O.b.Critical,(function(l){_retryAddEvent(l)})):h(new Error(le))})):h(new Error(le))}}))}y>0&&S>=y?dropEvents(O.b.Normal,(function(l){0===l?d.evt.persistence>=O.b.Critical?dropEvents(O.b.Critical,(function(l){_insertNewEvent()})):h(new Error(le)):_insertNewEvent()})):_insertNewEvent()}))}d.id=l,d.initialize=function(l){var S=l.itemCtx.diagLog();if(!(u=new te(S)).isAvailable())return u=null,!1;var _=l.itemCtx.getCfg(),C=l.storageConfig||{};return p=C.indexedDbName||ue,h=_.instrumentationKey||h,g=d.id||l.id||Object(R.f)(),m=(f=h+\"::\")+g+\"::\",y=C.maxStorageItems>0?C.maxStorageItems:y,_openDb((function(l){return l.isNew?v.resolve(!0):IndexedDbProvider_checkVersionAndMoveEventsToCurrentStorage(l)})).then((function(l){}),(function(l){S.warnToConsole(\"IndexedDbProvider failed to initialize - \"+(l||\"<unknown>\")),u=null})),!0},d.supportsSyncRequests=function(){return!1},d.getAllEvents=function(){return null!=u&&u.isAvailable()?_openDb((function(l){return new v((function(d,u){_getAllEventsForiKey(l,\"#key=\"+l.ctx.evtKeyPrefix()).then((function(l){S=l.length,d(_orderEventsByPriority(l))}),u)}))})):v.resolve([])},d.addEvent=function(l,d,p){return null!=u&&u.isAvailable()?(d.id=d.id||Object(R.f)(),fe(d.persistence)||(d.persistence=O.b.Normal),_openDb((function(u){var p=l||d.id,h={key:u.ctx.evtKeyPrefix()+p,id:p,evt:d,tm:IndexedDbProvider_getTime(),v:re};return _addDbEvent(u,h,!0)}))):v.resolve(d)},d.removeEvents=function(l){if(null==u||!u.isAvailable())return v.resolve([]);var d=[];return new v((function(u,p){_openDb((function(u){return u.openCursor(he,\"#key=\"+u.ctx.iKey,(function(u,p,h){if(-1!==_getKeyIndex(p.id,l)){var g=u.cursor.delete();return g.onerror=_cursorContinueEvent(u),g.onsuccess=function(){d.push(p.evt),u.continue()},1}return 0}))})).then((function(l){S-=d.length,u(d)}),(function(l){S-=d.length,u(d)}))}))},d.clear=function(){return null!=u&&u.isAvailable()?new v((function(l,d){_openDb((function(l){return _deleteEvents(l,\"#key=\"+l.ctx.evtKeyPrefix(),(function(d){return 0===d.key.indexOf(l.ctx.evtKeyPrefix())}))})).then((function(d){S=0,l(_orderEventsByPriority(d))}),d)})):v.resolve([])},d.teardown=function(){u&&u.closeDb(p)}}))}return IndexedDbProvider}(),ve=\"3.1.11\",ye=\"LocalStorage\",Se=5,_e=isValidPersistenceLevel,Ce=function(l){function LocalStorageChannel(){var d=l.call(this)||this;return d.identifier=ye,d.priority=1009,d.version=ve,Object(f.a)(LocalStorageChannel,d,(function(l,d){var u=!1,p=!1,f=null,m=[];function _queueStorageEvent(l,d){f||(f=new I(\"LocalStorage\")),f.scheduleEvent((function(l){return d(l)}),l)}function _sendStoredEventsToNextPlugin(d){Object(h.b)(l.core,(function(){return\"LocalStorageChannel:_sendStoredEventsToNextPlugin\"}),(function(){_queueStorageEvent(\"sendToNext\",(function(u){return d.provider.getAllEvents().then((function(u){for(var p=0;p<u.length;p++)try{var h=u[p];(Object(A.h)(h.iKey)||h.iKey)===d.tenantId&&l.processNext(h,d.coreRootCtx.createNew())}catch(l){}}))}))}),(function(){return{iKeyConfig:d}}))}function _removeEvents(d,u){Object(h.b)(l.core,(function(){return\"LocalStorageChannel:_removeEvents\"}),(function(){_queueStorageEvent(\"removeEvents\",(function(l){var p=[];return Object(g.a)(u,(function(l){(Object(A.h)(l.iKey)||l.iKey)===d.tenantId&&p.push(l)})),p.length>0?d.provider.removeEvents(p).then((function(l){})).catch((function(l){})):v.resolve()}))}),(function(){return{iKeyConfig:d,events:u}}))}function _shouldCacheEvent(l,d){return!(d.sync||d.persistence<l.minPersistenceCacheLevel)}function _tryGetIndexedDbProvider(l){var d=new me;return d.initialize(l)||(d=null),d}function _tryGetWebStorageProvider(l,d){var u=new B(l);return u.initialize(d)||(u=null),u}function _initializeProvider(l){for(var d=l.storageConfig.providers,u=null,p=0;!u&&p<d.length&&p<Se;)switch(d[p++]){case b.LocalStorage:u=_tryGetWebStorageProvider(\"localStorage\",l);break;case b.SessionStorage:u=_tryGetWebStorageProvider(\"sessionStorage\",l);break;case b.IndexedDb:u=_tryGetIndexedDbProvider(l)}return u}function _getCoreItemCtx(d,u,p,h){d&&(d.extensionConfig=d.extensionConfig||[]),!h&&u&&(h=u.getProcessTelContext().getNext());var g=null,f=l._getTelCtx().getNext();return f&&(g=f.getPlugin()),new P.a(h,d,u,g)}function _createIkeyConfig(d,u,p,h){var g=l.identifier,f=d.extensionConfig=d.extensionConfig||[],v=f[g]=f[g]||{};v.providers||(v.providers=[b.LocalStorage,b.IndexedDb]);var y=_getCoreItemCtx(d,u,p,h),S={itemCtx:y,storageConfig:v,id:l.id},_=_initializeProvider(S);if(_){var C={iKey:d.instrumentationKey,tenantId:Object(A.h)(d.instrumentationKey)||d.instrumentationKey,minPersistenceCacheLevel:O.b.Normal,coreRootCtx:y,providerContext:S,provider:_};_e(v.minPersistenceLevel||-1)&&(C.minPersistenceCacheLevel=v.minPersistenceLevel),m.push(C),u.addNotificationListener({eventsSent:function(l){_removeEvents(C,l)},eventsDiscarded:function(l,d){_removeEvents(C,l)}}),_sendStoredEventsToNextPlugin(C)}}l.initialize=function(l,p,g,m){Object(h.b)(p,(function(){return\"LocalStorageChannel.initialize\"}),(function(){u||(d.initialize(l,p,g),d.setInitialized(!1),u=!0,f=new I(\"LocalStorage\",p.logger)),_createIkeyConfig(l,p,g,m)}),(function(){return{coreConfig:l,core:p,extensions:g,pluginChain:m}}))},l.processTelemetry=function(d,u){u=l._getTelCtx(u),Object(A.q)(d,l.identifier);var h=null;Object(g.a)(m,(function(l){l.iKey===d.iKey&&(h=l)}));var f=p,v=h?h.provider:null,y=d;!y.sync&&v?(y.id=y.id||Object(R.f)(),isValidPersistenceLevel(y.persistence)||(y.persistence=1),_shouldCacheEvent(h,y)&&_queueStorageEvent(\"processTelemetry\",(function(l){return v.addEvent(y.id,y,u)})),f||l.processNext(y,u)):l.processNext(y,u)},l.pause=function(){p=!0},l.resume=function(){Object(h.b)(l.core,(function(){return\"LocalStorageChannel:resume\"}),(function(){p=!1,Object(g.a)(m,(function(l){l.provider&&_sendStoredEventsToNextPlugin(l)}))}))},l.teardown=function(){Object(g.a)(m,(function(l){var d=l.provider;d&&d.teardown()})),m=[]},l.flush=function(l,d){}})),d}return Object(p.b)(LocalStorageChannel,l),LocalStorageChannel}(M.a),Ee=u(21),Te=u(44)}])}))}));let R=\"3617\";const getPlatformId=()=>R,P=2e3,O=5e4,M=3e4,w=25e3,N=6e3,D=5e3,L=1e3,k=3,x=!1,F=500,U=6e3,j=2500,B=1500,V=5e3,H=12,G=2e4,W=6e4,q=\"4cf9ed87f7dc4e148f77855cd1f2fdca-61fb83a7-6672-4264-806f-7aded29f9b49-7618\",z=\"53fdaa090eb946b5a1d6cbdeb4f2ef66-bcbf6380-2590-41cc-ae60-9e467cd51835-7413\",K=\"1cae5691997646c98b01d15beddae7a3-ce16e198-bc32-420f-ac64-42bb916111af-6865\",J=\"708a9eb9fe2646fe8f4c37b7eee2e3da-9b97485a-57b9-43a8-8177-07ca7a653a30-6706\",Q=7e3,Y=10,$=\"28:8133db4c-c049-4346-9edd-273f164a9227\",X=\"ACS-Public\",Z=[\"en-us\"],ee=10,te=256,ne=\"0.0\",ie=\"8:\",re=\"28:\",oe=\"4:\",ae=\":\",se=ie+(\"orgid\"+ae),ce=ie+(\"dod\"+ae),le=ie+(\"gcch\"+ae),de=ie+(\"teamsvisitor\"+ae),ue=ie+(\"acs\"+ae),pe=ie+(\"spool\"+ae),he=ie+(\"dod-acs\"+ae),ge=ie+(\"gcch-acs\"+ae),fe={Extensions_WebRTCStats_bweStat_googAvailableSendBandwidth:{acs_name:\"sentBWEstimate\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_googRtt:{acs_name:\"audioSendRtt\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_pair_googRtt:{acs_name:\"audioSendPairRtt\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_recv_pair_googRtt:{acs_name:\"audioRecvPairRtt\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_googRtt:{acs_name:\"videoSendRtt\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_pair_googRtt:{acs_name:\"videoSendPairRtt\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_pair_googRtt:{acs_name:\"videoRecvPairRtt\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_recv_googJitterBufferMs:{acs_name:\"audioRecvJitterBufferMs\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_recv_jitter:{acs_name:\"audioRecvJitterMs\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_jitter:{acs_name:\"audioSendJitterMs\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_jitter:{acs_name:\"videoRecvJitterMs\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_jitter:{acs_name:\"videoSendJitterMs\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_googJitterBufferMs:{acs_name:\"videoRecvJitterBufferMs\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_googJitterBufferMs:{acs_name:\"screenSharingRecvJitterBufferMs\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_packetsSent:{acs_name:\"audioSendPackets\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_packetsSent:{acs_name:\"videoSendPackets\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_recv_packetsReceived:{acs_name:\"audioRecvPackets\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_packetsReceived:{acs_name:\"videoRecvPackets\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_recv_packetsLost:{acs_name:\"audioRecvPacketsLost\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_packetsLost:{acs_name:\"audioSendPacketsLost\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_packetsLost:{acs_name:\"videoRecvPacketsLost\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_packetsLost:{acs_name:\"videoSendPacketsLost\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_packetsLost:{acs_name:\"screenSharingRecvPacketsLost\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_packetsLost:{acs_name:\"screenSharingSendPacketsLost\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_bytesSent:{acs_name:\"audioSendBitrate\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_bytesSent:{acs_name:\"videoSendBitrate\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_recv_bytesReceived:{acs_name:\"audioRecvBitrate\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_bytesReceived:{acs_name:\"videoRecvBitrate\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_googCodecName:{acs_name:\"audioSendCodecName\",calculation_method:\"last1\",aggregation_needed:!1},Extensions_WebRTCStats_ssrc_video_send_googCodecName:{acs_name:\"videoSendCodecName\",calculation_method:\"last1\",aggregation_needed:!1},Extensions_WebRTCStats_ssrc_sharing_send_googCodecName:{acs_name:\"screenSharingSendCodecName\",calculation_method:\"last1\",aggregation_needed:!1},Extensions_WebRTCStats_ssrc_sharing_recv_googCodecName:{acs_name:\"screenSharingRecvCodecName\",calculation_method:\"last1\",aggregation_needed:!1},Extensions_WebRTCStats_ssrc_video_send_googFrameRateInput:{acs_name:\"videoSendFrameRateInput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_googFrameRateSent:{acs_name:\"videoSendFrameRateSent\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_googFrameRateReceived:{acs_name:\"videoRecvFrameRateReceived\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_googFrameRateDecoded:{acs_name:\"videoRecvFrameRateDecoded\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_googFrameRateOutput:{acs_name:\"videoRecvFrameRateOutput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_googFrameRateInput:{acs_name:\"screenSharingSendFrameRateInput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_googFrameRateSent:{acs_name:\"screenSharingSendFrameRateSent\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_googFrameRateReceived:{acs_name:\"screenSharingRecvFrameRateReceived\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_googFrameRateDecoded:{acs_name:\"screenSharingRecvFrameRateDecoded\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_googFrameRateOutput:{acs_name:\"screenSharingRecvFrameRateOutput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_googFrameWidthInput:{acs_name:\"videoSendFrameWidthInput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_googFrameHeightInput:{acs_name:\"videoSendFrameHeightInput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_googFrameWidthSent:{acs_name:\"videoSendFrameWidthSent\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_googFrameHeightSent:{acs_name:\"videoSendFrameHeightSent\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_googFrameWidthReceived:{acs_name:\"videoRecvFrameWidthReceived\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_googFrameHeightReceived:{acs_name:\"videoRecvFrameHeightReceived\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_googFrameWidthInput:{acs_name:\"screenSharingSendFrameWidthInput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_googFrameHeightInput:{acs_name:\"screenSharingSendFrameHeightInput\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_googFrameWidthSent:{acs_name:\"screenSharingSendFrameWidthSent\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_googFrameHeightSent:{acs_name:\"screenSharingSendFrameHeightSent\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_googFrameWidthReceived:{acs_name:\"screenSharingRecvFrameWidthReceived\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_googFrameHeightReceived:{acs_name:\"screenSharingRecvFrameHeightReceived\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_send_framesEncoded:{acs_name:\"videoSendFramesEncoded\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_send_framesEncoded:{acs_name:\"screenSharingSendFramesEncoded\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_video_recv_framesDecoded:{acs_name:\"videoRecvFramesDecoded\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_sharing_recv_framesDecoded:{acs_name:\"screenSharingRecvFramesDecoded\",calculation_method:\"last2\",aggregation_needed:!0},Extensions_Video_recv_LongestFreezeDuration:{acs_name:\"videoRecvLongestFreezeDuration\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_Video_recv_TotalFreezeDuration:{acs_name:\"videoRecvTotalFreezeDuration\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_Sharing_recv_LongestFreezeDuration:{acs_name:\"screenSharingRecvLongestFreezeDuration\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_Sharing_recv_TotalFreezeDuration:{acs_name:\"screenSharingRecvTotalFreezeDuration\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_send_audioInputLevel:{acs_name:\"audioSendAudioInputLevel\",calculation_method:\"last1\",aggregation_needed:!0},Extensions_WebRTCStats_ssrc_audio_recv_audioOutputLevel:{acs_name:\"audioRecvAudioOutputLevel\",calculation_method:\"last1\",aggregation_needed:!0}};var me;!function(l){l.GroupCall=\"joinGroupId\",l.GroupChatCall=\"joinThreadId\",l.TeamsCoordinates=\"joinMeetingCoordinates\",l.TeamsMeetingId=\"joinMeetingId\",l.TeamsMeetingLink=\"joinMeetingLink\"}(me||(me={}));const ve=400,ye=401,Se=404,_e=405,Ce=408,Ee=409,Te=412,be=422,Ie=500,Ae={Date:!0,RegExp:!0,String:!0,Number:!0};class CallingCommunicationError extends Error{constructor(l,d){if(super(),this._code=0,this._subCode=0,this.name=\"CallingCommunicationError\",d instanceof CallingCommunicationError)return this._code=d.code,this._subCode=d.subCode,this.message=d.message,void(this.stack=d.stack);this.message=l.message,this._code=l.code,l.subCode&&(this._subCode=l.subCode),d instanceof Error&&(this.stack=d.stack)}get code(){return this._code}get subCode(){return this._subCode}}const Re=Symbol(\"loggerKeySymbol\");var __awaiter=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};function syncOperation(l){return operationDecoratorFactory(l||\"\",!1)}function asyncOperation(l){return operationDecoratorFactory(l||\"\",!0)}const operationDecoratorFactory=(l,d)=>d?(d,u,p)=>{const h=p.value;return p.value=function(...d){return __awaiter(this,void 0,void 0,(function*(){let u;const p=+new Date;tryToLogAcsMessage(this,l,\"started\");try{u=yield h.apply(this,d),tryToLogAcsMessage(this,l,\"succeeded\",p)}catch(d){const u=new CallingCommunicationError({message:`${l} failed`,code:Ie},d);throw tryToLogAcsError(this,l,d,p),u}return u}))},p}:(d,u,p)=>{const h=p.value;return p.value=function(...d){let u;const p=+new Date;tryToLogAcsMessage(this,l,\"started\");try{u=h.apply(this,d),tryToLogAcsMessage(this,l,\"succeeded\",p)}catch(d){const u=new CallingCommunicationError({message:`${l} failed`,code:Ie},d);throw tryToLogAcsError(this,l,d,p),u}return u},p};function tryToLogAcsMessage(l,d,u,p){const h=getAcsLogger(l);if(h){const l=p?`in ${(+new Date-p)/1e3}s`:\"\";h.info(`op:${d}, ${u} ${l}`)}}function tryToLogAcsError(l,d,u,p){const h=getAcsLogger(l);try{if(h){const l=p?`in ${(+new Date-p)/1e3}s`:\"\";u&&u.code?h.error(`op:${d} failed, message=${u.message}, code=${u.code}${u.subCode?`, subCode=${u.subCode}`:\"\"} ${l}`):h.error(`op:${d} failed, message=${u.message} ${l}`)}}catch(u){}}function getAcsLogger(l){try{const d=Reflect.getMetadata(Re,l);if(d)return l[d]}catch(l){}}function loggerProperty(l,d){Reflect.defineMetadata(Re,d,l)}var Pe=\"function\",Oe=\"object\",Me=\"undefined\",we=\"prototype\",Ne=\"hasOwnProperty\",De=Object,Le=De[we],ke=De.assign,xe=De.create,Fe=De.defineProperty,Ue=Le[Ne];function getGlobal(){return typeof globalThis!==Me&&globalThis?globalThis:typeof self!==Me&&self?self:typeof window!==Me&&window?window:typeof global!==Me&&global?global:null}function throwTypeError(l){throw new TypeError(l)}function objCreateFn(l){if(xe)return xe(l);if(null==l)return{};var d=typeof l;function tmpFunc(){}return d!==Oe&&d!==Pe&&throwTypeError(\"Object prototype may only be an Object:\"+l),tmpFunc[we]=l,new tmpFunc}(getGlobal()||{}).Symbol,(getGlobal()||{}).Reflect;var je=ke||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Le[Ne].call(d,h)&&(l[h]=d[h]);return l},extendStaticsFn=function(l,d){return(extendStaticsFn=De.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d[Ne](u)&&(l[u]=d[u])})(l,d)};function __extendsFn(l,d){function __(){this.constructor=l}typeof d!==Pe&&null!==d&&throwTypeError(\"Class extends value \"+String(d)+\" is not a constructor or null\"),extendStaticsFn(l,d),l[we]=null===d?objCreateFn(d):(__[we]=d[we],new __)}var Be={Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5},Ve=\"constructor\",He=\"prototype\",Ge=\"function\",We=\"_dynInstFuncs\",qe=\"_isDynProxy\",ze=\"_dynClass\",Ke=\"_dynCls$\",Je=\"_dynInstChk\",Qe=Je,Ye=\"_dfOpts\",$e=\"_unknown_\",Xe=\"__proto__\",Ze=\"useBaseInst\",et=\"setInstFuncs\",tt=Object,nt=tt.getPrototypeOf,it=0;\r\n/*!\r\n\t * Microsoft Dynamic Proto Utility, 1.1.2\r\n\t * Copyright (c) Microsoft and contributors. All rights reserved.\r\n\t */function _hasOwnProperty(l,d){return l&&tt[He].hasOwnProperty.call(l,d)}function _isObjectOrArrayPrototype(l){return l&&(l===tt[He]||l===Array[He])}function _isObjectArrayOrFunctionPrototype(l){return _isObjectOrArrayPrototype(l)||l===Function[He]}function _getObjProto(l){if(l){if(nt)return nt(l);var d=l[Xe]||l[He]||(l[Ve]?l[Ve][He]:null);if(d)return d}return null}function _forEachProp(l,d){var u=[],p=tt.getOwnPropertyNames;if(p)u=p(l);else for(var h in l)\"string\"==typeof h&&_hasOwnProperty(l,h)&&u.push(h);if(u&&u.length>0)for(var g=0;g<u.length;g++)d(u[g])}function _isDynamicCandidate(l,d,u){return d!==Ve&&typeof l[d]===Ge&&(u||_hasOwnProperty(l,d))}function _throwTypeError(l){throw new TypeError(\"DynamicProto: \"+l)}function _getInstanceFuncs(l){var d={};return _forEachProp(l,(function(u){!d[u]&&_isDynamicCandidate(l,u,!1)&&(d[u]=l[u])})),d}function _hasVisited(l,d){for(var u=l.length-1;u>=0;u--)if(l[u]===d)return!0;return!1}function _getBaseFuncs(l,d,u,p){function _instFuncProxy(l,d,u){var h=d[u];if(h[qe]&&p){var g=l[We]||{};!1!==g[Qe]&&(h=(g[d[ze]]||{})[u]||h)}return function(){return h.apply(l,arguments)}}var h={};_forEachProp(u,(function(l){h[l]=_instFuncProxy(d,u,l)}));for(var g=_getObjProto(l),f=[];g&&!_isObjectArrayOrFunctionPrototype(g)&&!_hasVisited(f,g);)_forEachProp(g,(function(l){!h[l]&&_isDynamicCandidate(g,l,!nt)&&(h[l]=_instFuncProxy(d,g,l))})),f.push(g),g=_getObjProto(g);return h}function _getInstFunc(l,d,u,p){var h=null;if(l&&_hasOwnProperty(u,ze)){var g=l[We]||{};if((h=(g[u[ze]]||{})[d])||_throwTypeError(\"Missing [\"+d+\"] \"+Ge),!h[Je]&&!1!==g[Qe]){for(var f=!_hasOwnProperty(l,d),m=_getObjProto(l),v=[];f&&m&&!_isObjectArrayOrFunctionPrototype(m)&&!_hasVisited(v,m);){var y=m[d];if(y){f=y===p;break}v.push(m),m=_getObjProto(m)}try{f&&(l[d]=h),h[Je]=1}catch(l){g[Qe]=!1}}}return h}function _getProtoFunc(l,d,u){var p=d[l];return p===u&&(p=_getObjProto(d)[l]),typeof p!==Ge&&_throwTypeError(\"[\"+l+\"] is not a \"+Ge),p}function _populatePrototype(l,d,u,p,h){function _createDynamicPrototype(l,d){var dynProtoProxy=function(){return(_getInstFunc(this,d,l,dynProtoProxy)||_getProtoFunc(d,l,dynProtoProxy)).apply(this,arguments)};return dynProtoProxy[qe]=1,dynProtoProxy}if(!_isObjectOrArrayPrototype(l)){var g=u[We]=u[We]||{},f=g[d]=g[d]||{};!1!==g[Qe]&&(g[Qe]=!!h),_forEachProp(u,(function(d){_isDynamicCandidate(u,d,!1)&&u[d]!==p[d]&&(f[d]=u[d],delete u[d],(!_hasOwnProperty(l,d)||l[d]&&!l[d][qe])&&(l[d]=_createDynamicPrototype(l,d)))}))}}function _checkPrototype(l,d){if(nt)for(var u=[],p=_getObjProto(d);p&&!_isObjectArrayOrFunctionPrototype(p)&&!_hasVisited(u,p);){if(p===l)return!0;u.push(p),p=_getObjProto(p)}return!1}function _getObjName(l,d){return _hasOwnProperty(l,He)?l.name||d||$e:((l||{})[Ve]||{}).name||d||$e}function dynamicProto(l,d,u,p){_hasOwnProperty(l,He)||_throwTypeError(\"theClass is an invalid class definition.\");var h=l[He];_checkPrototype(h,d)||_throwTypeError(\"[\"+_getObjName(l)+\"] is not in class hierarchy of [\"+_getObjName(d)+\"]\");var g=null;_hasOwnProperty(h,ze)?g=h[ze]:(g=Ke+_getObjName(l,\"_\")+\"$\"+it,it++,h[ze]=g);var f=dynamicProto[Ye],m=!!f[Ze];m&&p&&void 0!==p[Ze]&&(m=!!p[Ze]);var v=_getInstanceFuncs(d);u(d,_getBaseFuncs(h,d,v,m));var y=!!nt&&!!f[et];y&&p&&(y=!!p[et]),_populatePrototype(h,g,d,v,!1!==y)}var rt,ot={setInstFuncs:!0,useBaseInst:!0};dynamicProto[Ye]=ot,function(l){l[l.CRITICAL=1]=\"CRITICAL\",l[l.WARNING=2]=\"WARNING\"}(rt||(rt={}));var at={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103},st=\"on\",ct=\"attachEvent\",lt=\"addEventListener\",dt=\"detachEvent\",ut=\"removeEventListener\",pt=Fe;function objToString(l){return Le.toString.call(l)}function isUndefined(l){return void 0===l||typeof l===Me}function isNullOrUndefined(l){return null===l||isUndefined(l)}function isNotNullOrUndefined(l){return!isNullOrUndefined(l)}function hasOwnProperty(l,d){return l&&Ue.call(l,d)}function isObject(l){return typeof l===Oe}function isFunction(l){return typeof l===Pe}function attachEvent(l,d,u,p){void 0===p&&(p=!1);var h=!1;if(!isNullOrUndefined(l))try{isNullOrUndefined(l[lt])?isNullOrUndefined(l[ct])||(l[ct](st+d,u),h=!0):(l[lt](d,u,p),h=!0)}catch(l){}return h}function detachEvent(l,d,u,p){if(void 0===p&&(p=!1),!isNullOrUndefined(l))try{isNullOrUndefined(l[ut])?isNullOrUndefined(l[dt])||l[dt](st+d,u):l[ut](d,u,p)}catch(l){}}function objForEachKey(l,d){if(l)for(var u in l)Ue.call(l,u)&&d.call(l,u,l[u])}function strEndsWith(l,d){if(l&&d){var u=d.length,p=l.length;if(l===d)return!0;if(p>=u){for(var h=p-1,g=u-1;g>=0;g--){if(l[h]!=d[g])return!1;h--}return!0}}return!1}function strStartsWith(l,d){var u=!1;if(l&&d){var p=d.length;if(l===d)return!0;if(l.length>=p){for(var h=0;h<p;h++)if(l[h]!==d[h])return!1;u=!0}}return u}function strContains(l,d){return!(!l||!d)&&-1!==l.indexOf(d)}function isDate(l){return\"[object Date]\"===objToString(l)}function isArray(l){return\"[object Array]\"===objToString(l)}function isError(l){return\"[object Error]\"===objToString(l)}function isString(l){return\"string\"==typeof l}function isNumber(l){return\"number\"==typeof l}function isBoolean(l){return\"boolean\"==typeof l}function toISOString(l){if(isDate(l)){var pad=function(l){var d=String(l);return 1===d.length&&(d=\"0\"+d),d};return l.getUTCFullYear()+\"-\"+pad(l.getUTCMonth()+1)+\"-\"+pad(l.getUTCDate())+\"T\"+pad(l.getUTCHours())+\":\"+pad(l.getUTCMinutes())+\":\"+pad(l.getUTCSeconds())+\".\"+String((l.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+\"Z\"}}function arrForEach(l,d,u){for(var p=l.length,h=0;h<p&&(!(h in l)||-1!==d.call(u||l,l[h],h,l));h++);}function arrIndexOf(l,d,u){for(var p=l.length,h=u||0,g=Math.max(h>=0?h:p-Math.abs(h),0);g<p;g++)if(g in l&&l[g]===d)return g;return-1}function strTrim(l){return\"string\"!=typeof l?l:l.replace(/^\\s+|\\s+$/g,\"\")}var ht=!{toString:null}.propertyIsEnumerable(\"toString\"),gt=[\"toString\",\"toLocaleString\",\"valueOf\",\"hasOwnProperty\",\"isPrototypeOf\",\"propertyIsEnumerable\",\"constructor\"];function objKeys(l){var d=typeof l;d===Pe||d===Oe&&null!==l||throwTypeError(\"objKeys called on non-object\");var u=[];for(var p in l)l&&Ue.call(l,p)&&u.push(p);if(ht)for(var h=gt.length,g=0;g<h;g++)l&&Ue.call(l,gt[g])&&u.push(gt[g]);return u}function objDefineAccessors(l,d,u,p){if(pt)try{var h={enumerable:!0,configurable:!0};return u&&(h.get=u),p&&(h.set=p),pt(l,d,h),!0}catch(l){}return!1}function dateNow(){var l=Date;return l.now?l.now():(new l).getTime()}function getExceptionName(l){return isError(l)?l.name:\"\"}function setValue(l,d,u,p,h){var g=u;return l&&((g=l[d])===u||h&&!h(g)||p&&!p(u)||(g=u,l[d]=g)),g}function getSetValue(l,d,u){var p;return l?!(p=l[d])&&isNullOrUndefined(p)&&(p=isUndefined(u)?{}:u,l[d]=p):p=isUndefined(u)?{}:u,p}function isNotTruthy(l){return!l}function isTruthy(l){return!!l}function throwError(l){throw new Error(l)}function optimizeObject(l){return l&&(l=De(ke?ke({},l):l)),l}var ft=\"window\",mt=\"document\",vt=\"navigator\",yt=\"location\",St=\"console\",_t=\"performance\",Ct=\"JSON\",Et=\"crypto\",Tt=\"msCrypto\",bt=\"ReactNative\",It=\"msie\",At=\"trident/\",Rt=null,Pt=null,Ot=!1;function getGlobalInst(l){var d=getGlobal();return d&&d[l]?d[l]:l===ft&&hasWindow()?window:null}function hasWindow(){return Boolean(typeof window===Oe&&window)}function getWindow(){return hasWindow()?window:getGlobalInst(ft)}function hasDocument(){return Boolean(typeof document===Oe&&document)}function getDocument(){return hasDocument()?document:getGlobalInst(mt)}function hasNavigator(){return Boolean(typeof navigator===Oe&&navigator)}function getNavigator(){return hasNavigator()?navigator:getGlobalInst(vt)}function getLocation(l){if(l&&Ot){var d=getGlobalInst(\"__mockLocation\");if(d)return d}return typeof location===Oe&&location?location:getGlobalInst(yt)}function getConsole(){return typeof console!==Me?console:getGlobalInst(St)}function getPerformance(){return getGlobalInst(_t)}function hasJSON(){return Boolean(typeof JSON===Oe&&JSON||null!==getGlobalInst(Ct))}function getJSON(){return hasJSON()?JSON||getGlobalInst(Ct):null}function getCrypto(){return getGlobalInst(Et)}function getMsCrypto(){return getGlobalInst(Tt)}function isReactNative(){var l=getNavigator();return!(!l||!l.product)&&l.product===bt}function isIE(){var l=getNavigator();if(l&&(l.userAgent!==Pt||null===Rt)){var d=((Pt=l.userAgent)||\"\").toLowerCase();Rt=strContains(d,It)||strContains(d,At)}return Rt}function dumpObj(l){var d=Object[we].toString.call(l),u=\"\";return\"[object Error]\"===d?u=\"{ stack: '\"+l.stack+\"', message: '\"+l.message+\"', name: '\"+l.name+\"'\":hasJSON()&&(u=getJSON().stringify(l)),d+u}var Mt=\"AI (Internal): \",wt=\"AI: \",Nt=\"AITR_\";function _sanitizeDiagnosticText(l){return l?'\"'+l.replace(/\\\"/g,\"\")+'\"':\"\"}var Dt=function(){function _InternalLogMessage(l,d,u,p){void 0===u&&(u=!1);var h=this;h.messageId=l,h.message=(u?wt:Mt)+l;var g=\"\";hasJSON()&&(g=getJSON().stringify(p));var f=(d?\" message:\"+_sanitizeDiagnosticText(d):\"\")+(p?\" props:\"+_sanitizeDiagnosticText(g):\"\");h.message+=f}return _InternalLogMessage.dataType=\"MessageData\",_InternalLogMessage}();function safeGetLogger(l,d){return(l||{}).logger||new Lt(d)}var Lt=function(){function DiagnosticLogger(l){this.identifier=\"DiagnosticLogger\",this.queue=[];var d=0,u={};dynamicProto(DiagnosticLogger,this,(function(p){function _getConfigValue(d,u){var p=l[d];return isNullOrUndefined(p)?u:p}function _areInternalMessagesThrottled(){return d>=p.maxInternalMessageLimit()}isNullOrUndefined(l)&&(l={}),p.consoleLoggingLevel=function(){return _getConfigValue(\"loggingLevelConsole\",0)},p.telemetryLoggingLevel=function(){return _getConfigValue(\"loggingLevelTelemetry\",1)},p.maxInternalMessageLimit=function(){return _getConfigValue(\"maxMessageLimit\",25)},p.enableDebugExceptions=function(){return _getConfigValue(\"enableDebugExceptions\",!1)},p.throwInternal=function(l,d,h,g,f){void 0===f&&(f=!1);var m=new Dt(d,h,f,g);if(p.enableDebugExceptions())throw m;if(!isUndefined(m)&&m&&!isUndefined(m.message)){var v=p.consoleLoggingLevel();if(f){var y=+m.messageId;!u[y]&&v>=rt.WARNING&&(p.warnToConsole(m.message),u[y]=!0)}else v>=rt.WARNING&&p.warnToConsole(m.message);p.logInternalMessage(l,m)}},p.warnToConsole=function(l){var d=getConsole();if(d){var u=\"log\";d.warn&&(u=\"warn\"),isFunction(d[u])&&d[u](l)}},p.resetInternalMessageCount=function(){d=0,u={}},p.logInternalMessage=function(l,h){if(!_areInternalMessagesThrottled()){var g=!0,f=Nt+h.messageId;if(u[f]?g=!1:u[f]=!0,g&&(l<=p.telemetryLoggingLevel()&&(p.queue.push(h),d++),d===p.maxInternalMessageLimit())){var m=\"Internal events throttle limit per PageView reached for this app.\",v=new Dt(at.MessageLimitPerPVExceeded,m,!1);p.queue.push(v),p.warnToConsole(m)}}}}))}return DiagnosticLogger}(),kt=\"ctx\",xt=function(){function PerfEvent(l,d,u){var p,h=this,g=!1;(h.start=dateNow(),h.name=l,h.isAsync=u,h.isChildEvt=function(){return!1},isFunction(d))&&(g=objDefineAccessors(h,\"payload\",(function(){return!p&&isFunction(d)&&(p=d(),d=null),p})));h.getCtx=function(l){return l?l===PerfEvent.ParentContextKey||l===PerfEvent.ChildrenContextKey?h[l]:(h[kt]||{})[l]:null},h.setCtx=function(l,d){if(l)if(l===PerfEvent.ParentContextKey)h[l]||(h.isChildEvt=function(){return!0}),h[l]=d;else if(l===PerfEvent.ChildrenContextKey)h[l]=d;else{(h[kt]=h[kt]||{})[l]=d}},h.complete=function(){var l=0,u=h.getCtx(PerfEvent.ChildrenContextKey);if(isArray(u))for(var p=0;p<u.length;p++){var f=u[p];f&&(l+=f.time)}h.time=dateNow()-h.start,h.exTime=h.time-l,h.complete=function(){},!g&&isFunction(d)&&(h.payload=d())}}return PerfEvent.ParentContextKey=\"parent\",PerfEvent.ChildrenContextKey=\"childEvts\",PerfEvent}(),Ft=function(){function PerfManager(l){this.ctx={},dynamicProto(PerfManager,this,(function(d){d.create=function(l,d,u){return new xt(l,d,u)},d.fire=function(d){d&&(d.complete(),l&&l.perfEvent(d))},d.setCtx=function(l,u){l&&((d[kt]=d[kt]||{})[l]=u)},d.getCtx=function(l){return(d[kt]||{})[l]}}))}return PerfManager}(),Ut=\"CoreUtils.doPerf\";function doPerf(l,d,u,p,h){if(l){var g=l;if(g&&isFunction(g.getPerfMgr)&&(g=g.getPerfMgr()),g){var f=void 0,m=g.getCtx(Ut);try{if(f=g.create(d(),p,h)){if(m&&f.setCtx&&(f.setCtx(xt.ParentContextKey,m),m.getCtx&&m.setCtx)){var v=m.getCtx(xt.ChildrenContextKey);v||(v=[],m.setCtx(xt.ChildrenContextKey,v)),v.push(f)}return g.setCtx(Ut,f),u(f)}}catch(l){f&&f.setCtx&&f.setCtx(\"exception\",l)}finally{f&&g.fire(f),g.setCtx(Ut,m)}}}return u()}var jt=function(){function TelemetryPluginChain(l,d){var u=this,p=null,h=isFunction(l.processTelemetry),g=isFunction(l.setNextPlugin);u._hasRun=!1,u.getPlugin=function(){return l},u.getNext=function(){return p},u.setNext=function(l){p=l},u.processTelemetry=function(f,m){m||(m=d);var v=l?l.identifier:\"TelemetryPluginChain\";doPerf(m?m.core():null,(function(){return v+\":processTelemetry\"}),(function(){if(l&&h){u._hasRun=!0;try{m.setNext(p),g&&l.setNextPlugin(p),p&&(p._hasRun=!1),l.processTelemetry(f,m)}catch(u){var d=p&&p._hasRun;p&&d||m.diagLog().throwInternal(rt.CRITICAL,at.PluginException,\"Plugin [\"+l.identifier+\"] failed during processTelemetry - \"+u),p&&!d&&p.processTelemetry(f,m)}}else p&&(u._hasRun=!0,p.processTelemetry(f,m))}),(function(){return{item:f}}),!f.sync)}}return TelemetryPluginChain}();function _createProxyChain(l,d){var u=[];if(l&&l.length>0)for(var p=null,h=0;h<l.length;h++){var g=l[h];if(g&&isFunction(g.processTelemetry)){var f=new jt(g,d);u.push(f),p&&p.setNext(f),p=f}}return u.length>0?u[0]:null}function _copyProxyChain(l,d,u){var p=[],h=!u;if(l)for(;l;){var g=l.getPlugin();(h||g===u)&&(h=!0,p.push(g)),l=l.getNext()}return h||p.push(u),_createProxyChain(p,d)}function _copyPluginChain(l,d,u){var p=l,h=!1;return u&&l&&(p=[],arrForEach(l,(function(l){(h||l===u)&&(h=!0,p.push(l))}))),u&&!h&&(p||(p=[]),p.push(u)),_createProxyChain(p,d)}var Bt=function(){function ProcessTelemetryContext(l,d,u,p){var h=this,g=null;null!==p&&(l&&isFunction(l.getPlugin)?g=_copyProxyChain(l,h,p||l.getPlugin()):p?g=_copyPluginChain(l,h,p):isUndefined(p)&&(g=_createProxyChain(l,h))),h.core=function(){return u},h.diagLog=function(){return safeGetLogger(u,d)},h.getCfg=function(){return d},h.getExtCfg=function(l,u){var p;if(void 0===u&&(u={}),d){var h=d.extensionConfig;h&&l&&(p=h[l])}return p||u},h.getConfig=function(l,u,p){var g;void 0===p&&(p=!1);var f=h.getExtCfg(l,null);return f&&!isNullOrUndefined(f[u])?g=f[u]:d&&!isNullOrUndefined(d[u])&&(g=d[u]),isNullOrUndefined(g)?p:g},h.hasNext=function(){return null!=g},h.getNext=function(){return g},h.setNext=function(l){g=l},h.processNext=function(l){var d=g;d&&(g=d.getNext(),d.processTelemetry(l,h))},h.createNew=function(l,p){return void 0===l&&(l=null),new ProcessTelemetryContext(l||g,d,u,p)}}return ProcessTelemetryContext}(),Vt=\"iKey\",Ht=\"extensionConfig\",Gt=\"getPlugin\",Wt=function(){function BaseTelemetryPlugin(){var l=this,d=!1,u=null,p=null;l.core=null,l.diagLog=function(d){return l._getTelCtx(d).diagLog()},l.isInitialized=function(){return d},l.setInitialized=function(l){d=l},l.setNextPlugin=function(l){p=l},l.processNext=function(l,d){d?d.processNext(l):p&&isFunction(p.processTelemetry)&&p.processTelemetry(l,null)},l._getTelCtx=function(d){void 0===d&&(d=null);var h=d;if(!h){var g=u||new Bt(null,{},l.core);h=p&&p[Gt]?g.createNew(null,p[Gt]):g.createNew(null,p)}return h},l._baseTelInit=function(h,g,f,m){h&&setValue(h,Ht,[],null,isNullOrUndefined),!m&&g&&(m=g.getProcessTelContext().getNext());var v=p;p&&p[Gt]&&(v=p[Gt]()),l.core=g,u=new Bt(m,h,g,v),d=!0}}return BaseTelemetryPlugin.prototype.initialize=function(l,d,u,p){this._baseTelInit(l,d,u,p)},BaseTelemetryPlugin}(),qt=\"processTelemetry\",zt=\"priority\",Kt=\"setNextPlugin\",Jt=\"isInitialized\";function initializePlugins(l,d){for(var u=[],p=null,h=l.getNext();h;){var g=h.getPlugin();g&&(p&&isFunction(p[Kt])&&isFunction(g[qt])&&p[Kt](g),isFunction(g[Jt])&&g[Jt]()||u.push(g),p=g,h=h.getNext())}arrForEach(u,(function(u){u.initialize(l.getCfg(),l.core(),d,l.getNext())}))}function sortPlugins(l){return l.sort((function(l,d){var u=0,p=isFunction(d[qt]);return isFunction(l[qt])?u=p?l[zt]-d[zt]:1:p&&(u=-1),u}))}var Qt=500,Yt=\"Channel has invalid priority\",$t=function(l){function ChannelController(){var d,u=l.call(this)||this;function _checkQueuePriority(l){arrForEach(l,(function(l){l.priority<Qt&&throwError(Yt+l.identifier)}))}function _addChannelQueue(l){l&&l.length>0&&(_checkQueuePriority(l=l.sort((function(l,d){return l.priority-d.priority}))),d.push(l))}function _createChannelQueues(l,u){if(d=[],l&&arrForEach(l,(function(l){return _addChannelQueue(l)})),u){var p=[];arrForEach(u,(function(l){l.priority>Qt&&p.push(l)})),_addChannelQueue(p)}}return u.identifier=\"ChannelControllerPlugin\",u.priority=Qt,dynamicProto(ChannelController,u,(function(l,p){l.setNextPlugin=function(l){},l.processTelemetry=function(l,p){d&&arrForEach(d,(function(d){d.length>0&&u._getTelCtx(p).createNew(d).processNext(l)}))},l.getChannelControls=function(){return d},l.initialize=function(u,h,g){l.isInitialized()||(p.initialize(u,h,g),_createChannelQueues((u||{}).channels,g),arrForEach(d,(function(l){return initializePlugins(new Bt(l,u,h),g)})))}})),u}var d;return __extendsFn(ChannelController,l),ChannelController._staticInit=(objDefineAccessors(d=ChannelController.prototype,\"ChannelControls\",d.getChannelControls),void objDefineAccessors(d,\"channelQueue\",d.getChannelControls)),ChannelController}(Wt),Xt=\"toGMTString\",Zt=\"toUTCString\",en=\"cookie\",tn=\"expires\",nn=\"enabled\",rn=\"isCookieUseDisabled\",on=\"disableCookiesUsage\",an=\"_ckMgr\",sn=\"\",cn=null,ln=null,dn=null,un=getDocument(),pn={},hn={};function _gblCookieMgr(l,d){var u=createCookieMgr[an]||hn[an];return u||(u=createCookieMgr[an]=createCookieMgr(l,d),hn[an]=u),u}function _isMgrEnabled(l){return!l||l.isEnabled()}function _createCookieMgrConfig(l){var d=l.cookieCfg=l.cookieCfg||{};if(setValue(d,\"domain\",l.cookieDomain,isNotNullOrUndefined,isNullOrUndefined),setValue(d,\"path\",l.cookiePath||\"/\",null,isNullOrUndefined),isNullOrUndefined(d[nn])){var u=void 0;isUndefined(l[rn])||(u=!l[rn]),isUndefined(l[on])||(u=!l[on]),d[nn]=u}return d}function safeGetCookieMgr(l,d){var u;if(l)u=l.getCookieMgr();else if(d){var p=(d||{}).cookieCfg;u=p[an]?p[an]:createCookieMgr(d)}return u||(u=_gblCookieMgr(d,(l||{}).logger)),u}function createCookieMgr(l,d){var u=_createCookieMgrConfig(l||hn),p=u.path||\"/\",h=u.domain,g=!1!==u[nn],f={isEnabled:function(){var l=g&&areCookiesSupported(d),u=hn[an];return l&&u&&f!==u&&(l=_isMgrEnabled(u)),l},setEnabled:function(l){g=!1!==l},set:function(l,d,g,m,v){if(_isMgrEnabled(f)){var y={},S=strTrim(d||sn),_=S.indexOf(\";\");if(-1!==_&&(S=strTrim(d.substring(0,_)),y=_extractParts(d.substring(_+1))),setValue(y,\"domain\",m||h,isTruthy,isUndefined),!isNullOrUndefined(g)){var C=isIE();if(isUndefined(y[tn])){var E=dateNow()+1e3*g;if(E>0){var T=new Date;T.setTime(E),setValue(y,tn,_formatDate(T,C?Xt:Zt)||_formatDate(T,C?Xt:Zt)||sn,isTruthy)}}C||setValue(y,\"max-age\",sn+g,null,isUndefined)}var b=getLocation();b&&\"https:\"===b.protocol&&(setValue(y,\"secure\",null,null,isUndefined),null===ln&&(ln=!uaDisallowsSameSiteNone((getNavigator()||{}).userAgent)),ln&&setValue(y,\"SameSite\",\"None\",null,isUndefined)),setValue(y,\"path\",v||p,null,isUndefined),(u.setCookie||_setCookieValue)(l,_formatCookieValue(S,y))}},get:function(l){var d=sn;return _isMgrEnabled(f)&&(d=(u.getCookie||_getCookieValue)(l)),d},del:function(l,d){_isMgrEnabled(f)&&f.purge(l,d)},purge:function(l,p){if(areCookiesSupported(d)){var h=((g={}).path=p||\"/\",g[tn]=\"Thu, 01 Jan 1970 00:00:01 GMT\",g);isIE()||(h[\"max-age\"]=\"0\"),(u.delCookie||_setCookieValue)(l,_formatCookieValue(sn,h))}var g}};return f[an]=f,f}function areCookiesSupported(l){if(null===cn){cn=!1;try{cn=void 0!==(un||{})[en]}catch(d){l&&l.throwInternal(rt.WARNING,at.CannotAccessCookie,\"Cannot access document.cookie - \"+getExceptionName(d),{exception:dumpObj(d)})}}return cn}function _extractParts(l){var d={};l&&l.length&&arrForEach(strTrim(l).split(\";\"),(function(l){if(l=strTrim(l||sn)){var u=l.indexOf(\"=\");-1===u?d[l]=null:d[strTrim(l.substring(0,u))]=strTrim(l.substring(u+1))}}));return d}function _formatDate(l,d){return isFunction(l[d])?l[d]():null}function _formatCookieValue(l,d){var u=l||sn;return objForEachKey(d,(function(l,d){u+=\"; \"+l+(isNullOrUndefined(d)?sn:\"=\"+d)})),u}function _getCookieValue(l){var d=sn;if(un){var u=un[en]||sn;dn!==u&&(pn=_extractParts(u),dn=u),d=strTrim(pn[l]||sn)}return d}function _setCookieValue(l,d){un&&(un[en]=l+\"=\"+d)}function uaDisallowsSameSiteNone(l){return!!isString(l)&&(!(!strContains(l,\"CPU iPhone OS 12\")&&!strContains(l,\"iPad; CPU OS 12\"))||(!!(strContains(l,\"Macintosh; Intel Mac OS X 10_14\")&&strContains(l,\"Version/\")&&strContains(l,\"Safari\"))||(!(!strContains(l,\"Macintosh; Intel Mac OS X 10_14\")||!strEndsWith(l,\"AppleWebKit/605.1.15 (KHTML, like Gecko)\"))||(!(!strContains(l,\"Chrome/5\")&&!strContains(l,\"Chrome/6\"))||(!(!strContains(l,\"UnrealEngine\")||strContains(l,\"Chrome\"))||!(!strContains(l,\"UCBrowser/12\")&&!strContains(l,\"UCBrowser/11\")))))))}var gn=\"Extensions must provide callback to initialize\",fn=\"_notificationManager\",mn=function(){function BaseCore(){var l,d,u,p,h,g=!1;dynamicProto(BaseCore,this,(function(f){f._extensions=new Array,d=new $t,f.logger=objCreateFn({throwInternal:function(l,d,u,p,h){},warnToConsole:function(l){},resetInternalMessageCount:function(){}}),l=[],f.isInitialized=function(){return g},f.initialize=function(l,p,h,m){f.isInitialized()&&throwError(\"Core should not be initialized more than once\"),l&&!isNullOrUndefined(l.instrumentationKey)||throwError(\"Please provide instrumentation key\"),u=m,f[fn]=m,f.config=l||{},l.extensions=isNullOrUndefined(l.extensions)?[]:l.extensions,getSetValue(l,Ht).NotificationManager=m,h&&(f.logger=h);var v=[];v.push.apply(v,p.concat(l.extensions)),v=sortPlugins(v);var y=[],S={};arrForEach(v,(function(l){(isNullOrUndefined(l)||isNullOrUndefined(l.initialize))&&throwError(gn);var u=l.priority,p=l.identifier;l&&u&&(isNullOrUndefined(S[u])?S[u]=p:h.warnToConsole(\"Two extensions have same priority #\"+u+\" - \"+S[u]+\", \"+p)),(!u||u<d.priority)&&y.push(l)})),v.push(d),y.push(d),v=sortPlugins(v),f._extensions=v,initializePlugins(new Bt([d],l,f),v),initializePlugins(new Bt(y,l,f),v),f._extensions=y,0===f.getTransmissionControls().length&&throwError(\"No channels available\"),g=!0,f.releaseQueue()},f.getTransmissionControls=function(){return d.getChannelControls()},f.track=function(d){setValue(d,Vt,f.config.instrumentationKey,null,isNotTruthy),setValue(d,\"time\",toISOString(new Date),null,isNotTruthy),setValue(d,\"ver\",\"4.0\",null,isNullOrUndefined),f.isInitialized()?f.getProcessTelContext().processNext(d):l.push(d)},f.getProcessTelContext=function(){var l=f._extensions,u=l;return l&&0!==l.length||(u=[d]),new Bt(u,f.config,f)},f.getNotifyMgr=function(){return u||(u=objCreateFn({addNotificationListener:function(l){},removeNotificationListener:function(l){},eventsSent:function(l){},eventsDiscarded:function(l,d){},eventsSendRequest:function(l,d){}}),f[fn]=u),u},f.getCookieMgr=function(){return h||(h=createCookieMgr(f.config,f.logger)),h},f.setCookieMgr=function(l){h=l},f.getPerfMgr=function(){return p||f.config&&f.config.enablePerfMgr&&(p=new Ft(f.getNotifyMgr())),p},f.setPerfMgr=function(l){p=l},f.eventCnt=function(){return l.length},f.releaseQueue=function(){l.length>0&&(arrForEach(l,(function(l){f.getProcessTelContext().processNext(l)})),l=[])}}))}return BaseCore}(),vn=function(){function NotificationManager(l){this.listeners=[];var d=!!(l||{}).perfEvtsSendAll;dynamicProto(NotificationManager,this,(function(l){l.addNotificationListener=function(d){l.listeners.push(d)},l.removeNotificationListener=function(d){for(var u=arrIndexOf(l.listeners,d);u>-1;)l.listeners.splice(u,1),u=arrIndexOf(l.listeners,d)},l.eventsSent=function(d){arrForEach(l.listeners,(function(l){l&&l.eventsSent&&setTimeout((function(){return l.eventsSent(d)}),0)}))},l.eventsDiscarded=function(d,u){arrForEach(l.listeners,(function(l){l&&l.eventsDiscarded&&setTimeout((function(){return l.eventsDiscarded(d,u)}),0)}))},l.eventsSendRequest=function(d,u){arrForEach(l.listeners,(function(l){if(l&&l.eventsSendRequest)if(u)setTimeout((function(){return l.eventsSendRequest(d,u)}),0);else try{l.eventsSendRequest(d,u)}catch(l){}}))},l.perfEvent=function(u){u&&(!d&&u.isChildEvt()||arrForEach(l.listeners,(function(l){if(l&&l.perfEvent)if(u.isAsync)setTimeout((function(){return l.perfEvent(u)}),0);else try{l.perfEvent(u)}catch(l){}})))}}))}return NotificationManager}(),yn=function(l){function AppInsightsCore(){var d=l.call(this)||this;return dynamicProto(AppInsightsCore,d,(function(l,d){function _validateTelemetryItem(l){if(isNullOrUndefined(l.name))throw _notifyInvalidEvent(l),Error(\"telemetry name required\")}function _notifyInvalidEvent(d){var u=l.getNotifyMgr();u&&u.eventsDiscarded([d],Be.InvalidEvent)}l.initialize=function(l,u,p,h){d.initialize(l,u,p||new Lt(l),h||new vn(l))},l.track=function(u){doPerf(l.getPerfMgr(),(function(){return\"AppInsightsCore:track\"}),(function(){null===u&&(_notifyInvalidEvent(u),throwError(\"Invalid telemetry item\")),_validateTelemetryItem(u),d.track(u)}),(function(){return{item:u}}),!u.sync)},l.addNotificationListener=function(d){var u=l.getNotifyMgr();u&&u.addNotificationListener(d)},l.removeNotificationListener=function(d){var u=l.getNotifyMgr();u&&u.removeNotificationListener(d)},l.pollInternalLogs=function(d){var u=l.config.diagnosticLogInterval;return u&&u>0||(u=1e4),setInterval((function(){var u=l.logger?l.logger.queue:[];arrForEach(u,(function(u){var p={name:d||\"InternalMessageId: \"+u.messageId,iKey:l.config.instrumentationKey,time:toISOString(new Date),baseType:Dt.dataType,baseData:{message:u.message}};l.track(p)})),u.length=0}),u)}})),d}return __extendsFn(AppInsightsCore,l),AppInsightsCore}(mn),Sn=4294967296,_n=4294967295,Cn=!1,En=123456789,Tn=987654321;function _mwcSeed(l){l<0&&(l>>>=0),En=123456789+l&_n,Tn=987654321-l&_n,Cn=!0}function _autoSeedMwc(){try{var l=2147483647&dateNow();_mwcSeed((Math.random()*Sn^l)+l)}catch(l){}}function randomValue(l){return l>0?Math.floor(random32()/_n*(l+1))>>>0:0}function random32(l){var d,u=getCrypto()||getMsCrypto();return u&&u.getRandomValues?d=u.getRandomValues(new Uint32Array(1))[0]&_n:isIE()?(Cn||_autoSeedMwc(),d=mwcRandom32()&_n):d=Math.floor(Sn*Math.random()|0),l||(d>>>=0),d}function mwcRandom32(l){var d=((Tn=36969*(65535&Tn)+(Tn>>16)&_n)<<16)+(65535&(En=18e3*(65535&En)+(En>>16)&_n))>>>0&_n|0;return l||(d>>>=0),d}function addEventHandler(l,d){var u=!1,p=getWindow();p&&(u=attachEvent(p,l,d),u=attachEvent(p.body,l,d)||u);var h=getDocument();return h&&(u=An.Attach(h,l,d)||u),u}function newGuid(){function randomHexDigit(){return randomValue(15)}return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(In,(function(l){var d=0|randomHexDigit();return(\"x\"===l?d:3&d|8).toString(16)}))}function perfNow(){var l=getPerformance();return l&&l.now?l.now():dateNow()}function newId(l){void 0===l&&(l=22);for(var d=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",u=random32()>>>0,p=0,h=\"\";h.length<l;)p++,h+=d.charAt(63&u),u>>>=6,5===p&&(u=(random32()<<2&4294967295|3&u)>>>0,p=0);return h}function generateW3CId(){for(var l,d=[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"a\",\"b\",\"c\",\"d\",\"e\",\"f\"],u=\"\",p=0;p<4;p++)u+=d[15&(l=random32())]+d[l>>4&15]+d[l>>8&15]+d[l>>12&15]+d[l>>16&15]+d[l>>20&15]+d[l>>24&15]+d[l>>28&15];var h=d[8+(3&random32())|0];return u.substr(0,8)+u.substr(9,4)+\"4\"+u.substr(13,3)+h+u.substr(16,3)+u.substr(19,12)}var bn,In=/[xy]/g,An={Attach:attachEvent,AttachEvent:attachEvent,Detach:detachEvent,DetachEvent:detachEvent},Rn={NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,CustomerContent_GenericContent:32},Pn={Normal:1,CostDeferred:2,RealTime:3,Immediate:4},On={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},Mn=je(je({},at),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520}),wn=\"1DS-Web-JS-\"+\"3.1.2\",Nn=((bn={})[0]=On.Unspecified,bn[2]=On.Double,bn[1]=On.String,bn[3]=On.Bool,bn[4098]=On.Double,bn[4097]=On.String,bn[4099]=On.Bool,bn),Dn=null,Ln=(Boolean(getDocument()),Boolean(getWindow()));function isValueAssigned(l){return!(\"\"===l||isNullOrUndefined(l))}function getTenantId(l){if(l){var d=l.indexOf(\"-\");if(d>-1)return l.substring(0,d)}return\"\"}function isBeaconsSupported(){return null===Dn&&(Dn=hasNavigator()&&Boolean(getNavigator().sendBeacon)),Dn}function isLatency(l){return!!(l&&isNumber(l)&&l>=Pn.Normal&&l<=Pn.Immediate)}function sanitizeProperty(l,d,u){if(!d&&!isValueAssigned(d)||\"string\"!=typeof l)return null;var p=typeof d;if(\"string\"===p||\"number\"===p||\"boolean\"===p||isArray(d))d={value:d};else if(\"object\"!==p||d.hasOwnProperty(\"value\")){if(isNullOrUndefined(d.value)||\"\"===d.value||!isString(d.value)&&!isNumber(d.value)&&!isBoolean(d.value)&&!isArray(d.value))return null}else d={value:u?JSON.stringify(d):d};if(isArray(d.value)&&!isArrayValid(d.value))return null;if(!isNullOrUndefined(d.kind)){if(isArray(d.value)||!isValueKind(d.kind))return null;d.value=d.value.toString()}return d}function useXDomainRequest(){if(void 0!==typeof XMLHttpRequest){var l=getGlobalInst(\"XMLHttpRequest\");if(l){var d=new l;return Boolean(isUndefined(d.withCredentials)&&void 0!==typeof XDomainRequest)}}}function getCommonSchemaMetaData(l,d,u){var p=-1;if(!isUndefined(l))if(d>0&&(32===d?p=8192:d<=13&&(p=d<<5)),isDataType(u))-1===p&&(p=0),p|=u;else{var h=Nn[getFieldValueType(l)]||-1;-1!==p&&-1!==h?p|=h:h===On.Double&&(p=h)}return p}function getCookie(l){return areCookiesSupported(null)?getCookieValue(safeGetCookieMgr(null),l):\"\"}function getCookieValue(l,d,u){var p;return void 0===u&&(u=!0),l&&(p=l.get(d),u&&p&&decodeURIComponent&&(p=decodeURIComponent(p))),p||\"\"}function createGuid(l){void 0===l&&(l=\"D\");var d=newGuid();return\"B\"===l?d=\"{\"+d+\"}\":\"P\"===l?d=\"(\"+d+\")\":\"N\"===l&&(d=d.replace(/-/g,\"\")),d}function extend(l,d,u,p,h){var g={},f=!1,m=0,v=arguments.length,y=arguments;for(\"[object Boolean]\"===Object[we].toString.call(y[0])&&(f=y[0],m++);m<v;m++){objForEachKey(y[m],(function(l,d){f&&d&&isObject(d)?isArray(d)?(g[l]=g[l]||[],arrForEach(d,(function(d,u){d&&isObject(d)?g[l][u]=extend(!0,g[l][u],d):g[l][u]=d}))):g[l]=extend(!0,g[l],d):g[l]=d}))}return g}var kn=perfNow;function isValueKind(l){return l===Rn.NotSet||l>Rn.NotSet&&l<=Rn.Pii_IPV4AddressLegacy||l===Rn.CustomerContent_GenericContent}function isDataType(l){return l>=0&&l<=9}function isArrayValid(l){return l.length>0}function addPageUnloadEventListener(l){var d=addEventHandler(\"beforeunload\",l);return d=addEventHandler(\"unload\",l)||d,d=addEventHandler(\"pagehide\",l)||d}function setProcessTelemetryTimings(l,d){var u=l;u.timings=u.timings||{},u.timings.processTelemetryStart=u.timings.processTelemetryStart||{},u.timings.processTelemetryStart[d]=kn()}function getFieldValueType(l){var d=0;if(null!=l){var u=typeof l;\"string\"===u?d=1:\"number\"===u?d=2:\"boolean\"===u?d=3:u===Oe&&(d=4,isArray(l)?(d=4096,l.length>0&&(d|=getFieldValueType(l[0]))):hasOwnProperty(l,\"value\")&&(d=8192|getFieldValueType(l.value)))}return d}function isChromium(){return!!getGlobalInst(\"chrome\")}var xn=\"version\",Fn=\"properties\",Un=function(l){function AppInsightsCore(){var d=l.call(this)||this;return d.pluginVersionStringArr=[],d.pluginVersionString=\"\",dynamicProto(AppInsightsCore,d,(function(l,d){l.initialize=function(u,p,h,g){doPerf(l,(function(){return\"AppInsightsCore.initialize\"}),(function(){if(u){u.endpointUrl||(u.endpointUrl=\"https://browser.events.data.microsoft.com/OneCollector/1.0/\");var f=u.propertyStorageOverride;if(f&&(!f.getProperty||!f.setProperty))throw new Error(\"Invalid property storage override passed.\");u.channels&&arrForEach(u.channels,(function(d){d&&arrForEach(d,(function(d){if(d.identifier&&d.version){var u=d.identifier+\"=\"+d.version;l.pluginVersionStringArr.push(u)}}))}))}l.getWParam=function(){return\"undefined\"!=typeof document?0:-1},p&&arrForEach(p,(function(d){if(d&&d.identifier&&d.version){var u=d.identifier+\"=\"+d.version;l.pluginVersionStringArr.push(u)}})),l.pluginVersionString=l.pluginVersionStringArr.join(\";\");try{d.initialize(u,p,h,g)}catch(d){l.logger.throwInternal(rt.CRITICAL,Mn.ErrorProvidedChannels,\"Channels must be provided through config.channels only\")}l.pollInternalLogs(\"InternalLog\")}),(function(){return{config:u,extensions:p,logger:h,notificationManager:g}}))},l.track=function(u){doPerf(l,(function(){return\"AppInsightsCore.track\"}),(function(){var p=u;if(p){p.timings=p.timings||{},p.timings.trackStart=kn(),isLatency(p.latency)||(p.latency=Pn.Normal);var h=p.ext=p.ext||{};h.sdk=h.sdk||{},h.sdk.ver=wn;var g=p.baseData=p.baseData||{};g[Fn]||(g[Fn]={});var f=g[Fn];f[xn]||(f[xn]=\"\"),\"\"!==l.pluginVersionString&&(f[xn]=l.pluginVersionString)}d.track(p)}),(function(){return{item:u}}),!u.sync)}})),d}return __extendsFn(AppInsightsCore,l),AppInsightsCore}(yn);function generateGuid(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,(l=>{const d=16*Math.random()|0;return(\"x\"===l?d:3&d|8).toString(16)}))}const jn=\"Skype\",Bn=\"ConfigIDs\",Vn=\"This type of config is not currently supported.\",Hn=\"Ecs Service has not yet responded. Try calling this API again in sometime.\",Gn=\"Possible duplicate call. Ecs already initialized for this confiugration definition.\";var Wn,qn,zn,Kn,Jn;!function(l){l.Public=\"https://ic3.events.data.microsoft.com/OneCollector/1.0/\",l.GccHigh=\"https://tb.events.data.microsoft.com/OneCollector/1.0/\",l.Dod=\"https://pf.events.data.microsoft.com/OneCollector/1.0/\",l.AirGap08=\"https://collector.azure.eaglex.ic.gov/OneCollector/1.0/\",l.AirGap09=\"https://collector.azure.microsoft.scloud/OneCollector/1.0/\",l.Enterprise=\"https://teams.events.data.microsoft.com/OneCollector/1.0\"}(Wn||(Wn={})),function(l){l.Public=\"Public\",l.GccHigh=\"GCCHigh\",l.Dod=\"DoD\",l.AirGap08=\"AirGap08\",l.AirGap09=\"AirGap09\"}(qn||(qn={})),function(l){l.OrgId=\"orgid\",l.Acs=\"acs\",l.Spool=\"spool\",l.GccHigh=\"gcch\",l.GccHighAcs=\"gcch-acs\",l.Dod=\"dod\",l.DodAcs=\"dod-acs\",l.AirGap08=\"ag08\",l.AirGap08Acs=\"ag08-acs\",l.AirGap09=\"ag09\",l.AirGap09Acs=\"ag09-acs\"}(zn||(zn={})),function(l){l.Public_EcsServer_Url=\"https://ecs.office.com\",l.GccHigh_EcsServer_Url=\"https://config.ecs.gov.teams.microsoft.us\",l.Dod_EcsServer_Url=\"https://config.ecs.dod.teams.microsoft.us\",l.AirGap08_EcsServer_Url=\"https://config.ecs.teams.eaglex.ic.go\",l.AirGap09_EcsServer_Url=\"https://config.ecs.teams.microsoft.scloud\",l.Enterprise_Ecs_ServerUrl=\"https://config.teams.microsoft.com\"}(Kn||(Kn={})),function(l){l.Public_ConversationServiceUrl=\"https://api.flightproxy.skype.com/api/v2/cpconv\",l.Public_TrouterServiceUrl=\"https://go.trouter.skype.com/v4/a\",l.Public_RegistrarServiceUrl=\"https://prod.registrar.skype.com/v3/registrations\",l.Public_MdnTrapServiceUrl=\"https://edge.skype.com/trap\",l.Public_MdnTrapServiceTokenUrl=\"https://edge.skype.com/trap/tokens\",l.Public_MdnTrapRelaySkypeFqdns=\"worldaz.tr.skype.com\",l.Public_MdnTrapRelayTurnFqdns=\"turn.azure.com\",l.Public_MdnTrapRelayTurnUrl=\"https://turn.azure.com/relay\",l.GccHigh_ConversationServiceUrl=\"https://api.cc.gov.teams.microsoft.us/conv/\",l.GccHigh_TrouterServiceUrl=\"https://go.trouter.gov.teams.microsoft.us/v4/a\",l.GccHigh_RegistrarServiceUrl=\"https://registrar.gov.teams.microsoft.us/v3/registrations\",l.GccHigh_MdnTrapServiceUrl=\"https://trap.gov.teams.microsoft.us\",l.GccHigh_MdnTrapServiceTokenUrl=\"https://trap.gov.teams.microsoft.us/tokens\",l.GccHigh_MdnTrapRelaySkypeFqdns=\"tr.gov.teams.microsoft.us\",l.GccHigh_MdnTrapRelayTurnFqdns=\"turn.gov.teams.microsoft.us\",l.GccHigh_MdnTrapRelayTurnUrl=\"https://turn.gov.teams.microsoft.us/relay\",l.Dod_ConversationServiceUrl=\"https://api.cc.dod.teams.microsoft.us/conv/\",l.Dod_TrouterServiceUrl=\"https://go.trouter.dod.teams.microsoft.us/v4/a\",l.Dod_RegistrarServiceUrl=\"https://registrar.dod.teams.microsoft.us/v3/registrations\",l.Dod_MdnTrapServiceUrl=\"https://trap.dod.teams.microsoft.us\",l.Dod_MdnTrapServiceTokenUrl=\"https://trap.dod.teams.microsoft.us/tokens\",l.Dod_MdnTrapRelaySkypeFqdns=\"tr.dod.teams.microsoft.us\",l.Dod_MdnTrapRelayTurnFqdns=\"turn.dod.teams.microsoft.us\",l.Dod_MdnTrapRelayTurnUrl=\"https://turn.dod.teams.microsoft.us/relay\",l.AirGap08_ConversationServiceUrl=\"https://api.cc.skype.com/conv/\",l.AirGap08_TrouterServiceUrl=\"https://go.trouter.teams.eaglex.ic.gov/v4/a\",l.AirGap08_RegistrarServiceUrl=\"https://api.registrar.teams.eaglex.ic.gov/v3/registrations\",l.AirGap09_ConversationServiceUrl=\"https://api.cc.skype.com/conv/\",l.AirGap09_TrouterServiceUrl=\"https://go.trouter.teams.microsoft.scloud/v4/a\",l.AirGap09_RegistrarServiceUrl=\"https://api.registrar.teams.microsoft.scloud/v3/registrations\",l.Enterprise_ConversationServiceUrl=\"https://api.flightproxy.teams.microsoft.com/api/v2/epconv\",l.Enterprise_TrouterServiceUrl=\"https://go.trouter.teams.microsoft.com/v4/a\",l.Enterprise_RegistrarServiceUrl=\"https://teams.microsoft.com/registrar/prod/v3/registrations\",l.Enterprise_MdnTrapServiceUrl=\"https://teams.microsoft.com/trap\",l.Enterprise_MdnTrapServiceTokenUrl=\"https://teams.microsoft.com/trap/tokens\",l.Enterprise_MdnTrapRelaySkypeFqdns=\"worldaz.tr.teams.microsoft.com\",l.Enterprise_MdnTrapRelayTurnFqdns=\"worldaz.turn.teams.microsoft.com\",l.Enterprise_MdnTrapRelayTurnUrl=\"\"}(Jn||(Jn={}));const Qn=Object.assign(Object.assign({},Jn),Kn);var Yn;!function(l){l.Consumer=\"consumer\",l.Enterprise=\"enterprise\"}(Yn||(Yn={}));const $n={AUDIO:{JITTER:{GOOD:30,AVERAGE:75},RTT:{GOOD:200,AVERAGE:350},PACKETS_LOSS_PERCENTAGE:{GOOD:3,AVERAGE:6}},VIDEO:{JITTER:{GOOD:20,AVERAGE:75},RTT:{GOOD:200,AVERAGE:350},PACKETS_LOSS_PERCENTAGE:{GOOD:3,AVERAGE:6}},BANDWIDTH:{GOOD:1500,AVERAGE:500},CALL:{DURATION_IN_SEC:30,GROUP_ID:generateGuid(),AGGREGATION:{INTERVAL:1e3,DATAPOINTS:1},VIDEO_SIZE:{heigth:720,width:1280},MEDIASTREAM_TIMEOUT_IN_SEC:15,CONNECT_TIMEOUT_IN_SEC:10}};let Xn,Zn={telemetry:{callStatsFlushTimeout:N,discardedTelemetryRetryTimeout:D,discardedEventsBufferMaxLength:L,discardedEventsMaxRetries:k,telemetryFlushTimeout:P,allowedEvents:[],blockedEvents:[\"acs_calling_feature_usage\"],telemetryBeforeUnload:!1,gzipTelemetryPayload:!0,localStorageEnable:!1,mediaStatsConfig:{enabled:!0,throttleTelemetry:1,fetchInterval:1,aggregationInterval:10,dataPointsPerAggregation:6,additionalStats:{},dataToSend:{raw:!1,min:!0,max:!0,sum:!0,count:!0}},reportSdkUaToService:!1},debugInfo:{enableLogDump:x,maxLogDumpLength:F,includeList:[],excludeList:[]},telemetryEvents:{eventNameToPriority:{eventName:[\"acs_calling_call_stats\"],priority:[Pn.Immediate]}},rendering:{remoteVideo:{createViewTimeout:U,createViewUnsubscribeTimeout:j,debounceTimeout:B,createViewSendMediaStats:!0,forceCheckIfVideoWasAttachedToDom:!0,checkIfVideoAttachedToDom_poll:!0,checkIfVideoAttachedToDom_intervalTime:V,checkIfVideoAttachedToDom_intervalMaxTries:H,checkIfVideoAttachedToDom_timeout:G,createViewSenderStatsEnabled:!1,createViewSenderStatsDuration:W}},captions:{botMri:$,clientInfo:X,availableLanguages:Z},calling:{doNotWaitForTrouter:!1,hangUpCallOnPageHide:!1,maxNumberOfTokenFetchRetries:10,deviceNotFunctioningMuted:!0,preventStopAudio:!1,preventFakeMute:!1,osAutoRecoverAudio:!1,deviceCaptureMuteRecover:!1,allowMuteOnBadUfd:!0,preventStopVideo:!0,mediaMetricsDeviceEventsEnabled:!1,allowAccessRawMediaStream:!1,applyViewLimit:!1,deviceCaptureMutedVideo:!0,removeLvsCheckOnCallStartAndCallAccept:!1,removeLocalAudioStreamCheckOnCallStartAndCallAccept:!1,devicePermissions:{splitAskAudioVideo:!1,timeoutInBetween:0,getCurrentState:!0},applicationSettingsUrls:{Public_ConversationServiceUrl:Qn.Public_ConversationServiceUrl,Public_TrouterServiceUrl:Qn.Public_TrouterServiceUrl,Public_RegistrarServiceUrl:Qn.Public_RegistrarServiceUrl,Public_MdnTrapServiceUrl:Qn.Public_MdnTrapServiceUrl,Public_MdnTrapServiceTokenUrl:Qn.Public_MdnTrapServiceTokenUrl,Public_MdnTrapRelaySkypeFqdns:Qn.Public_MdnTrapRelaySkypeFqdns,Public_MdnTrapRelayTurnFqdns:Qn.Public_MdnTrapRelayTurnFqdns,Public_MdnTrapRelayTurnUrl:Qn.Public_MdnTrapRelayTurnUrl,GccHigh_ConversationServiceUrl:Qn.GccHigh_ConversationServiceUrl,GccHigh_TrouterServiceUrl:Qn.GccHigh_TrouterServiceUrl,GccHigh_RegistrarServiceUrl:Qn.GccHigh_RegistrarServiceUrl,GccHigh_MdnTrapServiceUrl:Qn.GccHigh_MdnTrapServiceUrl,GccHigh_MdnTrapServiceTokenUrl:Qn.GccHigh_MdnTrapServiceTokenUrl,GccHigh_MdnTrapRelaySkypeFqdns:Qn.GccHigh_MdnTrapRelaySkypeFqdns,GccHigh_MdnTrapRelayTurnFqdns:Qn.GccHigh_MdnTrapRelayTurnFqdns,GccHigh_MdnTrapRelayTurnUrl:Qn.GccHigh_MdnTrapRelayTurnUrl,Dod_ConversationServiceUrl:Qn.Dod_ConversationServiceUrl,Dod_TrouterServiceUrl:Qn.Dod_TrouterServiceUrl,Dod_RegistrarServiceUrl:Qn.Dod_RegistrarServiceUrl,Dod_MdnTrapServiceUrl:Qn.Dod_MdnTrapServiceUrl,Dod_MdnTrapServiceTokenUrl:Qn.Dod_MdnTrapServiceTokenUrl,Dod_MdnTrapRelaySkypeFqdns:Qn.Dod_MdnTrapRelaySkypeFqdns,Dod_MdnTrapRelayTurnFqdns:Qn.Dod_MdnTrapRelayTurnFqdns,Dod_MdnTrapRelayTurnUrl:Qn.Dod_MdnTrapRelayTurnUrl,AirGap08_ConversationServiceUrl:Qn.AirGap08_ConversationServiceUrl,AirGap08_TrouterServiceUrl:Qn.AirGap08_TrouterServiceUrl,AirGap08_RegistrarServiceUrl:Qn.AirGap08_RegistrarServiceUrl,AirGap09_ConversationServiceUrl:Qn.AirGap09_ConversationServiceUrl,AirGap09_TrouterServiceUrl:Qn.AirGap09_TrouterServiceUrl,AirGap09_RegistrarServiceUrl:Qn.AirGap09_RegistrarServiceUrl,Enterprise_ConversationServiceUrl:Qn.Enterprise_ConversationServiceUrl,Enterprise_TrouterServiceUrl:Qn.Enterprise_TrouterServiceUrl,Enterprise_RegistrarServiceUrl:Qn.Enterprise_RegistrarServiceUrl,Enterprise_MdnTrapServiceUrl:Qn.Enterprise_MdnTrapServiceUrl,Enterprise_MdnTrapServiceTokenUrl:Qn.Enterprise_MdnTrapServiceTokenUrl,Enterprise_MdnTrapRelaySkypeFqdns:Qn.Enterprise_MdnTrapRelaySkypeFqdns,Enterprise_MdnTrapRelayTurnFqdns:Qn.Enterprise_MdnTrapRelayTurnFqdns,Enterprise_MdnTrapRelayTurnUrl:Qn.Enterprise_MdnTrapRelayTurnUrl},maxDisplayNameLength:256,callDiagnostics:$n},environments:{android:{chrome:{minVersion:ne}},ios:{safari:{minVersion:ne}},mac:{chrome:{minVersion:ne},safari:{minVersion:ne}},windows:{chrome:{minVersion:ne},chromium:{minVersion:ne},edgeanaheim:{minVersion:ne}},linux:{chrome:{minVersion:ne}}}};function setAcsEcsConfig(l,d){var u,p,h,g,f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k,x,F,U,j,B,V,H,G,W,q,z,K,J,Q,Y,$,X,Z,ee,te,ne,ie,re,oe,ae,se,ce,le,de,ue;if(!l)return;const pe=l.AcsCallingSDKWeb;try{void 0!==(null===(u=null==pe?void 0:pe.telemetry)||void 0===u?void 0:u.callStatsFlushTimeout)&&(Zn.telemetry.callStatsFlushTimeout=pe.telemetry.callStatsFlushTimeout)}catch(l){}try{void 0!==(null===(p=null==pe?void 0:pe.telemetry)||void 0===p?void 0:p.mediaStatsConfig)&&(void 0!==pe.telemetry.mediaStatsConfig.enabled&&(Zn.telemetry.mediaStatsConfig.enabled=pe.telemetry.mediaStatsConfig.enabled),void 0!==pe.telemetry.mediaStatsConfig.throttleTelemetry&&(Zn.telemetry.mediaStatsConfig.throttleTelemetry=pe.telemetry.mediaStatsConfig.throttleTelemetry),void 0!==pe.telemetry.mediaStatsConfig.fetchInterval&&(Zn.telemetry.mediaStatsConfig.fetchInterval=pe.telemetry.mediaStatsConfig.fetchInterval),void 0!==pe.telemetry.mediaStatsConfig.aggregationInterval&&(Zn.telemetry.mediaStatsConfig.aggregationInterval=pe.telemetry.mediaStatsConfig.aggregationInterval),void 0!==pe.telemetry.mediaStatsConfig.dataPointsPerAggregation&&(Zn.telemetry.mediaStatsConfig.dataPointsPerAggregation=pe.telemetry.mediaStatsConfig.dataPointsPerAggregation),void 0!==pe.telemetry.mediaStatsConfig.additionalStats&&(Zn.telemetry.mediaStatsConfig.additionalStats=pe.telemetry.mediaStatsConfig.additionalStats),void 0!==pe.telemetry.mediaStatsConfig.dataToSend&&(void 0!==pe.telemetry.mediaStatsConfig.dataToSend.raw&&(Zn.telemetry.mediaStatsConfig.dataToSend.raw=pe.telemetry.mediaStatsConfig.dataToSend.raw),void 0!==pe.telemetry.mediaStatsConfig.dataToSend.min&&(Zn.telemetry.mediaStatsConfig.dataToSend.min=pe.telemetry.mediaStatsConfig.dataToSend.min),void 0!==pe.telemetry.mediaStatsConfig.dataToSend.max&&(Zn.telemetry.mediaStatsConfig.dataToSend.max=pe.telemetry.mediaStatsConfig.dataToSend.max),void 0!==pe.telemetry.mediaStatsConfig.dataToSend.sum&&(Zn.telemetry.mediaStatsConfig.dataToSend.sum=pe.telemetry.mediaStatsConfig.dataToSend.sum),void 0!==pe.telemetry.mediaStatsConfig.dataToSend.count&&(Zn.telemetry.mediaStatsConfig.dataToSend.count=pe.telemetry.mediaStatsConfig.dataToSend.count)))}catch(l){}try{void 0!==(null===(h=null==pe?void 0:pe.telemetry)||void 0===h?void 0:h.telemetryFlushTimeout)&&(Zn.telemetry.telemetryFlushTimeout=pe.telemetry.telemetryFlushTimeout)}catch(l){}try{void 0!==(null===(g=null==pe?void 0:pe.telemetry)||void 0===g?void 0:g.discardedTelemetryRetryTimeout)&&(Zn.telemetry.discardedTelemetryRetryTimeout=pe.telemetry.discardedTelemetryRetryTimeout)}catch(l){}try{void 0!==(null===(f=null==pe?void 0:pe.telemetry)||void 0===f?void 0:f.discardedEventsBufferMaxLength)&&(Zn.telemetry.discardedEventsBufferMaxLength=pe.telemetry.discardedEventsBufferMaxLength)}catch(l){}try{void 0!==(null===(m=null==pe?void 0:pe.telemetry)||void 0===m?void 0:m.discardedEventsMaxRetries)&&(Zn.telemetry.discardedEventsMaxRetries=pe.telemetry.discardedEventsMaxRetries)}catch(l){}try{Array.isArray(null===(v=null==pe?void 0:pe.telemetry)||void 0===v?void 0:v.allowedEvents)&&(Zn.telemetry.allowedEvents=pe.telemetry.allowedEvents)}catch(l){}try{Array.isArray(null===(y=null==pe?void 0:pe.telemetry)||void 0===y?void 0:y.blockedEvents)&&(Zn.telemetry.blockedEvents=pe.telemetry.blockedEvents)}catch(l){}try{void 0!==(null===(S=null==pe?void 0:pe.telemetry)||void 0===S?void 0:S.telemetryBeforeUnload)&&(Zn.telemetry.telemetryBeforeUnload=pe.telemetry.telemetryBeforeUnload)}catch(l){}try{void 0!==(null==pe?void 0:pe.debugInfo)&&(Zn.debugInfo=Object.assign(Object.assign({},Zn.debugInfo),pe.debugInfo))}catch(l){}try{void 0!==(null===(_=null==pe?void 0:pe.telemetry)||void 0===_?void 0:_.gzipTelemetryPayload)&&(Zn.telemetry.gzipTelemetryPayload=pe.telemetry.gzipTelemetryPayload)}catch(l){}try{void 0!==(null===(C=null==pe?void 0:pe.telemetry)||void 0===C?void 0:C.localStorageEnable)&&(Zn.telemetry.localStorageEnable=pe.telemetry.localStorageEnable)}catch(l){}try{void 0!==(null===(E=null==pe?void 0:pe.telemetry)||void 0===E?void 0:E.reportSdkUaToService)&&(Zn.telemetry.reportSdkUaToService=pe.telemetry.reportSdkUaToService)}catch(l){}try{void 0!==(null==pe?void 0:pe.calling.applyViewLimit)&&(Zn.calling.applyViewLimit=pe.calling.applyViewLimit)}catch(l){}try{void 0!==(null===(b=null===(T=null==pe?void 0:pe.rendering)||void 0===T?void 0:T.remoteVideo)||void 0===b?void 0:b.createViewTimeout)&&(Zn.rendering.remoteVideo.createViewTimeout=pe.rendering.remoteVideo.createViewTimeout)}catch(l){}try{void 0!==(null===(A=null===(I=null==pe?void 0:pe.rendering)||void 0===I?void 0:I.remoteVideo)||void 0===A?void 0:A.createViewUnsubscribeTimeout)&&(Zn.rendering.remoteVideo.createViewUnsubscribeTimeout=pe.rendering.remoteVideo.createViewUnsubscribeTimeout)}catch(l){}try{void 0!==(null===(P=null===(R=null==pe?void 0:pe.rendering)||void 0===R?void 0:R.remoteVideo)||void 0===P?void 0:P.debounceTimeout)&&(Zn.rendering.remoteVideo.debounceTimeout=pe.rendering.remoteVideo.debounceTimeout)}catch(l){}try{void 0!==(null===(M=null===(O=null==pe?void 0:pe.rendering)||void 0===O?void 0:O.remoteVideo)||void 0===M?void 0:M.createViewSendMediaStats)&&(Zn.rendering.remoteVideo.createViewSendMediaStats=pe.rendering.remoteVideo.createViewSendMediaStats)}catch(l){}try{void 0!==(null===(N=null===(w=null==pe?void 0:pe.rendering)||void 0===w?void 0:w.remoteVideo)||void 0===N?void 0:N.forceCheckIfVideoWasAttachedToDom)&&(Zn.rendering.remoteVideo.forceCheckIfVideoWasAttachedToDom=pe.rendering.remoteVideo.forceCheckIfVideoWasAttachedToDom)}catch(l){}try{void 0!==(null===(L=null===(D=null==pe?void 0:pe.rendering)||void 0===D?void 0:D.remoteVideo)||void 0===L?void 0:L.checkIfVideoAttachedToDom_poll)&&(Zn.rendering.remoteVideo.checkIfVideoAttachedToDom_poll=pe.rendering.remoteVideo.checkIfVideoAttachedToDom_poll)}catch(l){}try{void 0!==(null===(x=null===(k=null==pe?void 0:pe.rendering)||void 0===k?void 0:k.remoteVideo)||void 0===x?void 0:x.checkIfVideoAttachedToDom_intervalTime)&&(Zn.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalTime=pe.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalTime)}catch(l){}try{void 0!==(null===(U=null===(F=null==pe?void 0:pe.rendering)||void 0===F?void 0:F.remoteVideo)||void 0===U?void 0:U.checkIfVideoAttachedToDom_intervalMaxTries)&&(Zn.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalMaxTries=pe.rendering.remoteVideo.checkIfVideoAttachedToDom_intervalMaxTries)}catch(l){}try{void 0!==(null===(B=null===(j=null==pe?void 0:pe.rendering)||void 0===j?void 0:j.remoteVideo)||void 0===B?void 0:B.checkIfVideoAttachedToDom_timeout)&&(Zn.rendering.remoteVideo.checkIfVideoAttachedToDom_timeout=pe.rendering.remoteVideo.checkIfVideoAttachedToDom_timeout)}catch(l){}try{void 0!==(null===(H=null===(V=null==pe?void 0:pe.rendering)||void 0===V?void 0:V.remoteVideo)||void 0===H?void 0:H.createViewSenderStatsEnabled)&&(Zn.rendering.remoteVideo.createViewSenderStatsEnabled=pe.rendering.remoteVideo.createViewSenderStatsEnabled)}catch(l){}try{void 0!==(null===(W=null===(G=null==pe?void 0:pe.rendering)||void 0===G?void 0:G.remoteVideo)||void 0===W?void 0:W.createViewSenderStatsDuration)&&(Zn.rendering.remoteVideo.createViewSenderStatsDuration=pe.rendering.remoteVideo.createViewSenderStatsDuration)}catch(l){}try{void 0!==(null==pe?void 0:pe.tsCalling)&&(Zn.tsCalling=pe.tsCalling)}catch(l){}try{void 0!==(null==pe?void 0:pe.captions)&&(Zn.captions.botMri=null!==(q=pe.captions.botMri)&&void 0!==q?q:Zn.captions.botMri,Zn.captions.clientInfo=null!==(z=pe.captions.clientInfo)&&void 0!==z?z:Zn.captions.clientInfo,Zn.captions.availableLanguages=null!==(K=pe.captions.availableLanguages)&&void 0!==K?K:Zn.captions.availableLanguages)}catch(l){}try{void 0!==(null===(J=null==pe?void 0:pe.calling)||void 0===J?void 0:J.maxNumberOfTokenFetchRetries)&&(Zn.calling.maxNumberOfTokenFetchRetries=pe.calling.maxNumberOfTokenFetchRetries)}catch(l){}try{void 0!==(null===(Q=null==pe?void 0:pe.calling)||void 0===Q?void 0:Q.deviceNotFunctioningMuted)&&(Zn.calling.deviceNotFunctioningMuted=pe.calling.deviceNotFunctioningMuted)}catch(l){}try{void 0!==(null===(Y=null==pe?void 0:pe.calling)||void 0===Y?void 0:Y.preventStopAudio)&&(Zn.calling.preventStopAudio=pe.calling.preventStopAudio)}catch(l){}try{void 0!==(null===($=null==pe?void 0:pe.calling)||void 0===$?void 0:$.preventFakeMute)&&(Zn.calling.preventFakeMute=pe.calling.preventFakeMute)}catch(l){}try{void 0!==(null===(X=null==pe?void 0:pe.calling)||void 0===X?void 0:X.osAutoRecoverAudio)&&(Zn.calling.osAutoRecoverAudio=pe.calling.osAutoRecoverAudio)}catch(l){}try{void 0!==(null===(Z=null==pe?void 0:pe.calling)||void 0===Z?void 0:Z.deviceCaptureMuteRecover)&&(Zn.calling.deviceCaptureMuteRecover=pe.calling.deviceCaptureMuteRecover)}catch(l){}try{void 0!==(null===(ee=null==pe?void 0:pe.calling)||void 0===ee?void 0:ee.allowMuteOnBadUfd)&&(Zn.calling.allowMuteOnBadUfd=pe.calling.allowMuteOnBadUfd)}catch(l){}try{void 0!==(null===(te=null==pe?void 0:pe.calling)||void 0===te?void 0:te.preventStopVideo)&&(Zn.calling.preventStopVideo=pe.calling.preventStopVideo)}catch(l){}try{void 0!==(null===(ne=null==pe?void 0:pe.calling)||void 0===ne?void 0:ne.mediaMetricsDeviceEventsEnabled)&&(Zn.calling.mediaMetricsDeviceEventsEnabled=pe.calling.mediaMetricsDeviceEventsEnabled)}catch(l){}try{void 0!==(null===(ie=null==pe?void 0:pe.calling)||void 0===ie?void 0:ie.allowAccessRawMediaStream)&&(Zn.calling.allowAccessRawMediaStream=pe.calling.allowAccessRawMediaStream)}catch(l){}try{void 0!==(null===(re=null==pe?void 0:pe.calling)||void 0===re?void 0:re.deviceCaptureMutedVideo)&&(Zn.calling.deviceCaptureMutedVideo=pe.calling.deviceCaptureMutedVideo)}catch(l){}try{void 0!==(null===(oe=null==pe?void 0:pe.calling)||void 0===oe?void 0:oe.removeLvsCheckOnCallStartAndCallAccept)&&(Zn.calling.removeLvsCheckOnCallStartAndCallAccept=pe.calling.removeLvsCheckOnCallStartAndCallAccept)}catch(l){}try{void 0!==(null===(ae=null==pe?void 0:pe.calling)||void 0===ae?void 0:ae.removeLocalAudioStreamCheckOnCallStartAndCallAccept)&&(Zn.calling.removeLocalAudioStreamCheckOnCallStartAndCallAccept=pe.calling.removeLocalAudioStreamCheckOnCallStartAndCallAccept)}catch(l){}try{void 0!==(null===(se=null==pe?void 0:pe.calling)||void 0===se?void 0:se.hangUpCallOnPageHide)&&(Zn.calling.hangUpCallOnPageHide=pe.calling.hangUpCallOnPageHide)}catch(l){}try{void 0!==(null===(ce=null==pe?void 0:pe.calling)||void 0===ce?void 0:ce.doNotWaitForTrouter)&&(Zn.calling.doNotWaitForTrouter=pe.calling.doNotWaitForTrouter)}catch(l){}try{if(void 0!==(null==pe?void 0:pe.telemetryEvents)){if(pe.telemetryEvents.eventNameToPriority.eventName.length!==pe.telemetryEvents.eventNameToPriority.priority.length)return;pe.telemetryEvents.eventNameToPriority.priority.forEach((l=>{[Pn.CostDeferred,Pn.Immediate,Pn.Normal,Pn.RealTime].includes(l)})),Zn.telemetryEvents.eventNameToPriority.eventName=pe.telemetryEvents.eventNameToPriority.eventName,Zn.telemetryEvents.eventNameToPriority.priority=pe.telemetryEvents.eventNameToPriority.priority}}catch(l){}try{void 0!==(null===(le=null==pe?void 0:pe.calling)||void 0===le?void 0:le.applicationSettingsUrls)&&(Zn.calling.applicationSettingsUrls=Object.assign(Object.assign({},Zn.calling.applicationSettingsUrls),pe.calling.applicationSettingsUrls))}catch(l){}try{void 0!==(null===(de=null==pe?void 0:pe.calling)||void 0===de?void 0:de.devicePermissions)&&(Zn.calling.devicePermissions=Object.assign(Object.assign({},Zn.calling.devicePermissions),pe.calling.devicePermissions))}catch(l){}try{void 0!==(null===(ue=null==pe?void 0:pe.calling)||void 0===ue?void 0:ue.callDiagnostics)&&(Zn.calling.callDiagnostics=Object.assign(Object.assign({},Zn.calling.callDiagnostics),pe.calling.callDiagnostics))}catch(l){}try{void 0!==(null==pe?void 0:pe.environments)&&(Zn.environments=Object.assign(Object.assign({},Zn.environments),pe.environments))}catch(l){}}function getAcsEcsConfig(){return Zn}function setMediaConfig(l){Xn=l}function getMediaConfig(){return Xn}var ei,ti=\"object\"==typeof Reflect?Reflect:null,ni=ti&&\"function\"==typeof ti.apply?ti.apply:function ReflectApply(l,d,u){return Function.prototype.apply.call(l,d,u)};function ProcessEmitWarning(l){console&&console.warn&&console.warn(l)}ei=ti&&\"function\"==typeof ti.ownKeys?ti.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:function ReflectOwnKeys(l){return Object.getOwnPropertyNames(l)};var ii=Number.isNaN||function NumberIsNaN(l){return l!=l};function EventEmitter(){EventEmitter.init.call(this)}var ri=EventEmitter,oi=once;EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var ai=10;function checkListener(l){if(\"function\"!=typeof l)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof l)}function _getMaxListeners(l){return void 0===l._maxListeners?EventEmitter.defaultMaxListeners:l._maxListeners}function _addListener(l,d,u,p){var h,g,f;if(checkListener(u),void 0===(g=l._events)?(g=l._events=Object.create(null),l._eventsCount=0):(void 0!==g.newListener&&(l.emit(\"newListener\",d,u.listener?u.listener:u),g=l._events),f=g[d]),void 0===f)f=g[d]=u,++l._eventsCount;else if(\"function\"==typeof f?f=g[d]=p?[u,f]:[f,u]:p?f.unshift(u):f.push(u),(h=_getMaxListeners(l))>0&&f.length>h&&!f.warned){f.warned=!0;var m=new Error(\"Possible EventEmitter memory leak detected. \"+f.length+\" \"+String(d)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");m.name=\"MaxListenersExceededWarning\",m.emitter=l,m.type=d,m.count=f.length,ProcessEmitWarning(m)}return l}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(l,d,u){var p={fired:!1,wrapFn:void 0,target:l,type:d,listener:u},h=onceWrapper.bind(p);return h.listener=u,p.wrapFn=h,h}function _listeners(l,d,u){var p=l._events;if(void 0===p)return[];var h=p[d];return void 0===h?[]:\"function\"==typeof h?u?[h.listener||h]:[h]:u?unwrapListeners(h):arrayClone(h,h.length)}function listenerCount(l){var d=this._events;if(void 0!==d){var u=d[l];if(\"function\"==typeof u)return 1;if(void 0!==u)return u.length}return 0}function arrayClone(l,d){for(var u=new Array(d),p=0;p<d;++p)u[p]=l[p];return u}function spliceOne(l,d){for(;d+1<l.length;d++)l[d]=l[d+1];l.pop()}function unwrapListeners(l){for(var d=new Array(l.length),u=0;u<d.length;++u)d[u]=l[u].listener||l[u];return d}function once(l,d){return new Promise((function(u,p){function eventListener(){void 0!==h&&l.removeListener(\"error\",h),u([].slice.call(arguments))}var h;\"error\"!==d&&(h=function errorListener(u){l.removeListener(d,eventListener),p(u)},l.once(\"error\",h)),l.once(d,eventListener)}))}Object.defineProperty(EventEmitter,\"defaultMaxListeners\",{enumerable:!0,get:function(){return ai},set:function(l){if(\"number\"!=typeof l||l<0||ii(l))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+l+\".\");ai=l}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(l){if(\"number\"!=typeof l||l<0||ii(l))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+l+\".\");return this._maxListeners=l,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(l){for(var d=[],u=1;u<arguments.length;u++)d.push(arguments[u]);var p=\"error\"===l,h=this._events;if(void 0!==h)p=p&&void 0===h.error;else if(!p)return!1;if(p){var g;if(d.length>0&&(g=d[0]),g instanceof Error)throw g;var f=new Error(\"Unhandled error.\"+(g?\" (\"+g.message+\")\":\"\"));throw f.context=g,f}var m=h[l];if(void 0===m)return!1;if(\"function\"==typeof m)ni(m,this,d);else{var v=m.length,y=arrayClone(m,v);for(u=0;u<v;++u)ni(y[u],this,d)}return!0},EventEmitter.prototype.addListener=function addListener(l,d){return _addListener(this,l,d,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(l,d){return _addListener(this,l,d,!0)},EventEmitter.prototype.once=function once(l,d){return checkListener(d),this.on(l,_onceWrap(this,l,d)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(l,d){return checkListener(d),this.prependListener(l,_onceWrap(this,l,d)),this},EventEmitter.prototype.removeListener=function removeListener(l,d){var u,p,h,g,f;if(checkListener(d),void 0===(p=this._events))return this;if(void 0===(u=p[l]))return this;if(u===d||u.listener===d)0==--this._eventsCount?this._events=Object.create(null):(delete p[l],p.removeListener&&this.emit(\"removeListener\",l,u.listener||d));else if(\"function\"!=typeof u){for(h=-1,g=u.length-1;g>=0;g--)if(u[g]===d||u[g].listener===d){f=u[g].listener,h=g;break}if(h<0)return this;0===h?u.shift():spliceOne(u,h),1===u.length&&(p[l]=u[0]),void 0!==p.removeListener&&this.emit(\"removeListener\",l,f||d)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(l){var d,u,p;if(void 0===(u=this._events))return this;if(void 0===u.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==u[l]&&(0==--this._eventsCount?this._events=Object.create(null):delete u[l]),this;if(0===arguments.length){var h,g=Object.keys(u);for(p=0;p<g.length;++p)\"removeListener\"!==(h=g[p])&&this.removeAllListeners(h);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"==typeof(d=u[l]))this.removeListener(l,d);else if(void 0!==d)for(p=d.length-1;p>=0;p--)this.removeListener(l,d[p]);return this},EventEmitter.prototype.listeners=function listeners(l){return _listeners(this,l,!0)},EventEmitter.prototype.rawListeners=function rawListeners(l){return _listeners(this,l,!1)},EventEmitter.listenerCount=function(l,d){return\"function\"==typeof l.listenerCount?l.listenerCount(d):listenerCount.call(l,d)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?ei(this._events):[]},ri.once=oi;class CallingEventEmitter extends ri.EventEmitter{constructor(l){super(),this._logger=l.createChild(\"CallingEventEmitter\")}on(l,d){return this._logger.info(`event:subscribe to ${l.toString()}`),super.on(l,d)}once(l,d){return this._logger.info(`event:subscribe once to ${l.toString()}`),super.once(l,d)}off(l,d){return this._logger.info(`event:unsubscribed ${l.toString()}`),super.off(l,d)}emit(l,...d){return this._logger.info(`event:emit ${l.toString()}`),super.emit(l,...d)}}const si=\"1.6.3.0_stable\",ci=\"1.6.3\";function getSdkInternalVersion(){const l=\"ACS_CLIENT_INTERNAL_SZK_VERSION\".replace(\"Z\",\"D\");return si===l?\"1.0.0.0\":si}function getSdkVersion(){const l=\"ACS_CLIENT_SZK_VERSION\".replace(\"Z\",\"D\");return ci===l?\"1.0.0.0\":ci}\r\n/*!\r\n\t * Microsoft Dynamic Proto Utility, 1.1.4\r\n\t * Copyright (c) Microsoft and contributors. All rights reserved.\r\n\t */var li=\"constructor\",di=\"prototype\",ui=\"function\",pi=\"_dynInstFuncs\",hi=\"_isDynProxy\",gi=\"_dynClass\",fi=\"_dynCls$\",mi=\"_dynInstChk\",vi=mi,yi=\"_dfOpts\",Si=\"_unknown_\",_i=\"__proto__\",Ci=\"useBaseInst\",Ei=\"setInstFuncs\",Ti=Object,bi=Ti.getPrototypeOf,Ii=0;function _hasOwnProperty$1(l,d){return l&&Ti[di].hasOwnProperty.call(l,d)}function _isObjectOrArrayPrototype$1(l){return l&&(l===Ti[di]||l===Array[di])}function _isObjectArrayOrFunctionPrototype$1(l){return _isObjectOrArrayPrototype$1(l)||l===Function[di]}function _getObjProto$1(l){if(l){if(bi)return bi(l);var d=l[_i]||l[di]||(l[li]?l[li][di]:null);if(d)return d}return null}function _forEachProp$1(l,d){var u=[],p=Ti.getOwnPropertyNames;if(p)u=p(l);else for(var h in l)\"string\"==typeof h&&_hasOwnProperty$1(l,h)&&u.push(h);if(u&&u.length>0)for(var g=0;g<u.length;g++)d(u[g])}function _isDynamicCandidate$1(l,d,u){return d!==li&&typeof l[d]===ui&&(u||_hasOwnProperty$1(l,d))}function _throwTypeError$1(l){throw new TypeError(\"DynamicProto: \"+l)}function _getInstanceFuncs$1(l){var d={};return _forEachProp$1(l,(function(u){!d[u]&&_isDynamicCandidate$1(l,u,!1)&&(d[u]=l[u])})),d}function _hasVisited$1(l,d){for(var u=l.length-1;u>=0;u--)if(l[u]===d)return!0;return!1}function _getBaseFuncs$1(l,d,u,p){function _instFuncProxy(l,d,u){var h=d[u];if(h[hi]&&p){var g=l[pi]||{};!1!==g[vi]&&(h=(g[d[gi]]||{})[u]||h)}return function(){return h.apply(l,arguments)}}var h={};_forEachProp$1(u,(function(l){h[l]=_instFuncProxy(d,u,l)}));for(var g=_getObjProto$1(l),f=[];g&&!_isObjectArrayOrFunctionPrototype$1(g)&&!_hasVisited$1(f,g);)_forEachProp$1(g,(function(l){!h[l]&&_isDynamicCandidate$1(g,l,!bi)&&(h[l]=_instFuncProxy(d,g,l))})),f.push(g),g=_getObjProto$1(g);return h}function _getInstFunc$1(l,d,u,p){var h=null;if(l&&_hasOwnProperty$1(u,gi)){var g=l[pi]||{};if((h=(g[u[gi]]||{})[d])||_throwTypeError$1(\"Missing [\"+d+\"] \"+ui),!h[mi]&&!1!==g[vi]){for(var f=!_hasOwnProperty$1(l,d),m=_getObjProto$1(l),v=[];f&&m&&!_isObjectArrayOrFunctionPrototype$1(m)&&!_hasVisited$1(v,m);){var y=m[d];if(y){f=y===p;break}v.push(m),m=_getObjProto$1(m)}try{f&&(l[d]=h),h[mi]=1}catch(l){g[vi]=!1}}}return h}function _getProtoFunc$1(l,d,u){var p=d[l];return p===u&&(p=_getObjProto$1(d)[l]),typeof p!==ui&&_throwTypeError$1(\"[\"+l+\"] is not a \"+ui),p}function _populatePrototype$1(l,d,u,p,h){function _createDynamicPrototype(l,d){var dynProtoProxy=function(){return(_getInstFunc$1(this,d,l,dynProtoProxy)||_getProtoFunc$1(d,l,dynProtoProxy)).apply(this,arguments)};return dynProtoProxy[hi]=1,dynProtoProxy}if(!_isObjectOrArrayPrototype$1(l)){var g=u[pi]=u[pi]||{},f=g[d]=g[d]||{};!1!==g[vi]&&(g[vi]=!!h),_forEachProp$1(u,(function(d){_isDynamicCandidate$1(u,d,!1)&&u[d]!==p[d]&&(f[d]=u[d],delete u[d],(!_hasOwnProperty$1(l,d)||l[d]&&!l[d][hi])&&(l[d]=_createDynamicPrototype(l,d)))}))}}function _checkPrototype$1(l,d){if(bi)for(var u=[],p=_getObjProto$1(d);p&&!_isObjectArrayOrFunctionPrototype$1(p)&&!_hasVisited$1(u,p);){if(p===l)return!0;u.push(p),p=_getObjProto$1(p)}return!1}function _getObjName$1(l,d){return _hasOwnProperty$1(l,di)?l.name||d||Si:((l||{})[li]||{}).name||d||Si}function dynamicProto$1(l,d,u,p){_hasOwnProperty$1(l,di)||_throwTypeError$1(\"theClass is an invalid class definition.\");var h=l[di];_checkPrototype$1(h,d)||_throwTypeError$1(\"[\"+_getObjName$1(l)+\"] is not in class hierarchy of [\"+_getObjName$1(d)+\"]\");var g=null;_hasOwnProperty$1(h,gi)?g=h[gi]:(g=fi+_getObjName$1(l,\"_\")+\"$\"+Ii,Ii++,h[gi]=g);var f=dynamicProto$1[yi],m=!!f[Ci];m&&p&&void 0!==p[Ci]&&(m=!!p[Ci]);var v=_getInstanceFuncs$1(d);u(d,_getBaseFuncs$1(h,d,v,m));var y=!!bi&&!!f[Ei];y&&p&&(y=!!p[Ei]),_populatePrototype$1(h,g,d,v,!1!==y)}var Ai,Ri={setInstFuncs:!0,useBaseInst:!0};dynamicProto$1[yi]=Ri,function(l){l[l.CRITICAL=1]=\"CRITICAL\",l[l.WARNING=2]=\"WARNING\"}(Ai||(Ai={}));var Pi={BrowserDoesNotSupportLocalStorage:0,BrowserCannotReadLocalStorage:1,BrowserCannotReadSessionStorage:2,BrowserCannotWriteLocalStorage:3,BrowserCannotWriteSessionStorage:4,BrowserFailedRemovalFromLocalStorage:5,BrowserFailedRemovalFromSessionStorage:6,CannotSendEmptyTelemetry:7,ClientPerformanceMathError:8,ErrorParsingAISessionCookie:9,ErrorPVCalc:10,ExceptionWhileLoggingError:11,FailedAddingTelemetryToBuffer:12,FailedMonitorAjaxAbort:13,FailedMonitorAjaxDur:14,FailedMonitorAjaxOpen:15,FailedMonitorAjaxRSC:16,FailedMonitorAjaxSend:17,FailedMonitorAjaxGetCorrelationHeader:18,FailedToAddHandlerForOnBeforeUnload:19,FailedToSendQueuedTelemetry:20,FailedToReportDataLoss:21,FlushFailed:22,MessageLimitPerPVExceeded:23,MissingRequiredFieldSpecification:24,NavigationTimingNotSupported:25,OnError:26,SessionRenewalDateIsZero:27,SenderNotInitialized:28,StartTrackEventFailed:29,StopTrackEventFailed:30,StartTrackFailed:31,StopTrackFailed:32,TelemetrySampledAndNotSent:33,TrackEventFailed:34,TrackExceptionFailed:35,TrackMetricFailed:36,TrackPVFailed:37,TrackPVFailedCalc:38,TrackTraceFailed:39,TransmissionFailed:40,FailedToSetStorageBuffer:41,FailedToRestoreStorageBuffer:42,InvalidBackendResponse:43,FailedToFixDepricatedValues:44,InvalidDurationValue:45,TelemetryEnvelopeInvalid:46,CreateEnvelopeError:47,CannotSerializeObject:48,CannotSerializeObjectNonSerializable:49,CircularReferenceDetected:50,ClearAuthContextFailed:51,ExceptionTruncated:52,IllegalCharsInName:53,ItemNotInArray:54,MaxAjaxPerPVExceeded:55,MessageTruncated:56,NameTooLong:57,SampleRateOutOfRange:58,SetAuthContextFailed:59,SetAuthContextFailedAccountName:60,StringValueTooLong:61,StartCalledMoreThanOnce:62,StopCalledWithoutStart:63,TelemetryInitializerFailed:64,TrackArgumentsNotSpecified:65,UrlTooLong:66,SessionStorageBufferFull:67,CannotAccessCookie:68,IdTooLong:69,InvalidEvent:70,FailedMonitorAjaxSetRequestHeader:71,SendBrowserInfoOnUserInit:72,PluginException:73,NotificationException:74,SnippetScriptLoadFailure:99,InvalidInstrumentationKey:100,CannotParseAiBlobValue:101,InvalidContentBlob:102,TrackPageActionEventFailed:103},Oi=Fe;function objToString$1(l){return Le.toString.call(l)}function isUndefined$1(l){return void 0===l||typeof l===Me}function isNullOrUndefined$1(l){return null===l||isUndefined$1(l)}function isFunction$1(l){return typeof l===Pe}function strContains$1(l,d){return!(!l||!d)&&-1!==l.indexOf(d)}function isArray$1(l){return\"[object Array]\"===objToString$1(l)}function isString$1(l){return\"string\"==typeof l}function isNumber$1(l){return\"number\"==typeof l}function arrForEach$1(l,d,u){for(var p=l.length,h=0;h<p&&(!(h in l)||-1!==d.call(u||l,l[h],h,l));h++);}var Mi=!{toString:null}.propertyIsEnumerable(\"toString\"),wi=[\"toString\",\"toLocaleString\",\"valueOf\",\"hasOwnProperty\",\"isPrototypeOf\",\"propertyIsEnumerable\",\"constructor\"];function objKeys$1(l){var d=typeof l;d===Pe||d===Oe&&null!==l||throwTypeError(\"objKeys called on non-object\");var u=[];for(var p in l)l&&Ue.call(l,p)&&u.push(p);if(Mi)for(var h=wi.length,g=0;g<h;g++)l&&Ue.call(l,wi[g])&&u.push(wi[g]);return u}function objDefineAccessors$1(l,d,u,p){if(Oi)try{var h={enumerable:!0,configurable:!0};return u&&(h.get=u),p&&(h.set=p),Oi(l,d,h),!0}catch(l){}return!1}function dateNow$1(){var l=Date;return l.now?l.now():(new l).getTime()}function setValue$1(l,d,u,p,h){var g=u;return l&&((g=l[d])===u||h&&!h(g)||p&&!p(u)||(g=u,l[d]=g)),g}var Ni=\"window\",Di=\"document\",Li=\"navigator\",ki=\"console\",xi=\"performance\",Fi=\"JSON\",Ui=\"crypto\",ji=\"msCrypto\",Bi=\"msie\",Vi=\"trident/\",Hi=null,Gi=null;function getGlobalInst$1(l){var d=getGlobal();return d&&d[l]?d[l]:l===Ni&&hasWindow$1()?window:null}function hasWindow$1(){return Boolean(typeof window===Oe&&window)}function getWindow$1(){return hasWindow$1()?window:getGlobalInst$1(Ni)}function hasDocument$1(){return Boolean(typeof document===Oe&&document)}function getDocument$1(){return hasDocument$1()?document:getGlobalInst$1(Di)}function hasNavigator$1(){return Boolean(typeof navigator===Oe&&navigator)}function getNavigator$1(){return hasNavigator$1()?navigator:getGlobalInst$1(Li)}function getConsole$1(){return typeof console!==Me?console:getGlobalInst$1(ki)}function getPerformance$1(){return getGlobalInst$1(xi)}function hasJSON$1(){return Boolean(typeof JSON===Oe&&JSON||null!==getGlobalInst$1(Fi))}function getJSON$1(){return hasJSON$1()?JSON||getGlobalInst$1(Fi):null}function getCrypto$1(){return getGlobalInst$1(Ui)}function getMsCrypto$1(){return getGlobalInst$1(ji)}function isIE$1(){var l=getNavigator$1();if(l&&(l.userAgent!==Gi||null===Hi)){var d=((Gi=l.userAgent)||\"\").toLowerCase();Hi=strContains$1(d,Bi)||strContains$1(d,Vi)}return Hi}var Wi=\"AI (Internal): \",qi=\"AI: \",zi=\"AITR_\";function _sanitizeDiagnosticText$1(l){return l?'\"'+l.replace(/\\\"/g,\"\")+'\"':\"\"}var Ki=function(){function _InternalLogMessage(l,d,u,p){void 0===u&&(u=!1);var h=this;h.messageId=l,h.message=(u?qi:Wi)+l;var g=\"\";hasJSON$1()&&(g=getJSON$1().stringify(p));var f=(d?\" message:\"+_sanitizeDiagnosticText$1(d):\"\")+(p?\" props:\"+_sanitizeDiagnosticText$1(g):\"\");h.message+=f}return _InternalLogMessage.dataType=\"MessageData\",_InternalLogMessage}();function safeGetLogger$1(l,d){return(l||{}).logger||new Ji(d)}var Ji=function(){function DiagnosticLogger(l){this.identifier=\"DiagnosticLogger\",this.queue=[];var d=0,u={};dynamicProto$1(DiagnosticLogger,this,(function(p){function _getConfigValue(d,u){var p=l[d];return isNullOrUndefined$1(p)?u:p}function _areInternalMessagesThrottled(){return d>=p.maxInternalMessageLimit()}isNullOrUndefined$1(l)&&(l={}),p.consoleLoggingLevel=function(){return _getConfigValue(\"loggingLevelConsole\",0)},p.telemetryLoggingLevel=function(){return _getConfigValue(\"loggingLevelTelemetry\",1)},p.maxInternalMessageLimit=function(){return _getConfigValue(\"maxMessageLimit\",25)},p.enableDebugExceptions=function(){return _getConfigValue(\"enableDebugExceptions\",!1)},p.throwInternal=function(l,d,h,g,f){void 0===f&&(f=!1);var m=new Ki(d,h,f,g);if(p.enableDebugExceptions())throw m;if(!isUndefined$1(m)&&m&&!isUndefined$1(m.message)){var v=p.consoleLoggingLevel();if(f){var y=+m.messageId;!u[y]&&v>=Ai.WARNING&&(p.warnToConsole(m.message),u[y]=!0)}else v>=Ai.WARNING&&p.warnToConsole(m.message);p.logInternalMessage(l,m)}},p.warnToConsole=function(l){var d=getConsole$1();if(d){var u=\"log\";d.warn&&(u=\"warn\"),isFunction$1(d[u])&&d[u](l)}},p.resetInternalMessageCount=function(){d=0,u={}},p.logInternalMessage=function(l,h){if(!_areInternalMessagesThrottled()){var g=!0,f=zi+h.messageId;if(u[f]?g=!1:u[f]=!0,g&&(l<=p.telemetryLoggingLevel()&&(p.queue.push(h),d++),d===p.maxInternalMessageLimit())){var m=\"Internal events throttle limit per PageView reached for this app.\",v=new Ki(Pi.MessageLimitPerPVExceeded,m,!1);p.queue.push(v),p.warnToConsole(m)}}}}))}return DiagnosticLogger}(),Qi=\"ctx\",Yi=function(){function PerfEvent(l,d,u){var p,h=this,g=!1;(h.start=dateNow$1(),h.name=l,h.isAsync=u,h.isChildEvt=function(){return!1},isFunction$1(d))&&(g=objDefineAccessors$1(h,\"payload\",(function(){return!p&&isFunction$1(d)&&(p=d(),d=null),p})));h.getCtx=function(l){return l?l===PerfEvent.ParentContextKey||l===PerfEvent.ChildrenContextKey?h[l]:(h[Qi]||{})[l]:null},h.setCtx=function(l,d){if(l)if(l===PerfEvent.ParentContextKey)h[l]||(h.isChildEvt=function(){return!0}),h[l]=d;else if(l===PerfEvent.ChildrenContextKey)h[l]=d;else{(h[Qi]=h[Qi]||{})[l]=d}},h.complete=function(){var l=0,u=h.getCtx(PerfEvent.ChildrenContextKey);if(isArray$1(u))for(var p=0;p<u.length;p++){var f=u[p];f&&(l+=f.time)}h.time=dateNow$1()-h.start,h.exTime=h.time-l,h.complete=function(){},!g&&isFunction$1(d)&&(h.payload=d())}}return PerfEvent.ParentContextKey=\"parent\",PerfEvent.ChildrenContextKey=\"childEvts\",PerfEvent}(),$i=\"CoreUtils.doPerf\";function doPerf$1(l,d,u,p,h){if(l){var g=l;if(g&&isFunction$1(g.getPerfMgr)&&(g=g.getPerfMgr()),g){var f=void 0,m=g.getCtx($i);try{if(f=g.create(d(),p,h)){if(m&&f.setCtx&&(f.setCtx(Yi.ParentContextKey,m),m.getCtx&&m.setCtx)){var v=m.getCtx(Yi.ChildrenContextKey);v||(v=[],m.setCtx(Yi.ChildrenContextKey,v)),v.push(f)}return g.setCtx($i,f),u(f)}}catch(l){f&&f.setCtx&&f.setCtx(\"exception\",l)}finally{f&&g.fire(f),g.setCtx($i,m)}}}return u()}var Xi=function(){function TelemetryPluginChain(l,d){var u=this,p=null,h=isFunction$1(l.processTelemetry),g=isFunction$1(l.setNextPlugin);u._hasRun=!1,u.getPlugin=function(){return l},u.getNext=function(){return p},u.setNext=function(l){p=l},u.processTelemetry=function(f,m){m||(m=d);var v=l?l.identifier:\"TelemetryPluginChain\";doPerf$1(m?m.core():null,(function(){return v+\":processTelemetry\"}),(function(){if(l&&h){u._hasRun=!0;try{m.setNext(p),g&&l.setNextPlugin(p),p&&(p._hasRun=!1),l.processTelemetry(f,m)}catch(u){var d=p&&p._hasRun;p&&d||m.diagLog().throwInternal(Ai.CRITICAL,Pi.PluginException,\"Plugin [\"+l.identifier+\"] failed during processTelemetry - \"+u),p&&!d&&p.processTelemetry(f,m)}}else p&&(u._hasRun=!0,p.processTelemetry(f,m))}),(function(){return{item:f}}),!f.sync)}}return TelemetryPluginChain}();function _createProxyChain$1(l,d){var u=[];if(l&&l.length>0)for(var p=null,h=0;h<l.length;h++){var g=l[h];if(g&&isFunction$1(g.processTelemetry)){var f=new Xi(g,d);u.push(f),p&&p.setNext(f),p=f}}return u.length>0?u[0]:null}function _copyProxyChain$1(l,d,u){var p=[],h=!u;if(l)for(;l;){var g=l.getPlugin();(h||g===u)&&(h=!0,p.push(g)),l=l.getNext()}return h||p.push(u),_createProxyChain$1(p,d)}function _copyPluginChain$1(l,d,u){var p=l,h=!1;return u&&l&&(p=[],arrForEach$1(l,(function(l){(h||l===u)&&(h=!0,p.push(l))}))),u&&!h&&(p||(p=[]),p.push(u)),_createProxyChain$1(p,d)}var Zi=function(){function ProcessTelemetryContext(l,d,u,p){var h=this,g=null;null!==p&&(l&&isFunction$1(l.getPlugin)?g=_copyProxyChain$1(l,h,p||l.getPlugin()):p?g=_copyPluginChain$1(l,h,p):isUndefined$1(p)&&(g=_createProxyChain$1(l,h))),h.core=function(){return u},h.diagLog=function(){return safeGetLogger$1(u,d)},h.getCfg=function(){return d},h.getExtCfg=function(l,u){var p;if(void 0===u&&(u={}),d){var h=d.extensionConfig;h&&l&&(p=h[l])}return p||u},h.getConfig=function(l,u,p){var g;void 0===p&&(p=!1);var f=h.getExtCfg(l,null);return f&&!isNullOrUndefined$1(f[u])?g=f[u]:d&&!isNullOrUndefined$1(d[u])&&(g=d[u]),isNullOrUndefined$1(g)?p:g},h.hasNext=function(){return null!=g},h.getNext=function(){return g},h.setNext=function(l){g=l},h.processNext=function(l){var d=g;d&&(g=d.getNext(),d.processTelemetry(l,h))},h.createNew=function(l,p){return void 0===l&&(l=null),new ProcessTelemetryContext(l||g,d,u,p)}}return ProcessTelemetryContext}(),er=\"extensionConfig\",tr=\"getPlugin\",nr=function(){function BaseTelemetryPlugin(){var l=this,d=!1,u=null,p=null;l.core=null,l.diagLog=function(d){return l._getTelCtx(d).diagLog()},l.isInitialized=function(){return d},l.setInitialized=function(l){d=l},l.setNextPlugin=function(l){p=l},l.processNext=function(l,d){d?d.processNext(l):p&&isFunction$1(p.processTelemetry)&&p.processTelemetry(l,null)},l._getTelCtx=function(d){void 0===d&&(d=null);var h=d;if(!h){var g=u||new Zi(null,{},l.core);h=p&&p[tr]?g.createNew(null,p[tr]):g.createNew(null,p)}return h},l._baseTelInit=function(h,g,f,m){h&&setValue$1(h,er,[],null,isNullOrUndefined$1),!m&&g&&(m=g.getProcessTelContext().getNext());var v=p;p&&p[tr]&&(v=p[tr]()),l.core=g,u=new Zi(m,h,g,v),d=!0}}return BaseTelemetryPlugin.prototype.initialize=function(l,d,u,p){this._baseTelInit(l,d,u,p)},BaseTelemetryPlugin}(),ir=4294967296,rr=4294967295,or=!1,ar=123456789,sr=987654321;function _mwcSeed$1(l){l<0&&(l>>>=0),ar=123456789+l&rr,sr=987654321-l&rr,or=!0}function _autoSeedMwc$1(){try{var l=2147483647&dateNow$1();_mwcSeed$1((Math.random()*ir^l)+l)}catch(l){}}function randomValue$1(l){return l>0?Math.floor(random32$1()/rr*(l+1))>>>0:0}function random32$1(l){var d,u=getCrypto$1()||getMsCrypto$1();return u&&u.getRandomValues?d=u.getRandomValues(new Uint32Array(1))[0]&rr:isIE$1()?(or||_autoSeedMwc$1(),d=mwcRandom32$1()&rr):d=Math.floor(ir*Math.random()|0),l||(d>>>=0),d}function mwcRandom32$1(l){var d=((sr=36969*(65535&sr)+(sr>>16)&rr)<<16)+(65535&(ar=18e3*(65535&ar)+(ar>>16)&rr))>>>0&rr|0;return l||(d>>>=0),d}function newGuid$1(){function randomHexDigit(){return randomValue$1(15)}return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(lr,(function(l){var d=0|randomHexDigit();return(\"x\"===l?d:3&d|8).toString(16)}))}function perfNow$1(){var l=getPerformance$1();return l&&l.now?l.now():dateNow$1()}var cr,lr=/[xy]/g,dr={Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9},ur={Normal:1,Critical:2};je(je({},Pi),{AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520}),(cr={})[0]=dr.Unspecified,cr[2]=dr.Double,cr[1]=dr.String,cr[3]=dr.Bool,cr[4098]=dr.Double,cr[4097]=dr.String,cr[4099]=dr.Bool,Boolean(getDocument$1()),Boolean(getWindow$1());function getTenantId$1(l){if(l){var d=l.indexOf(\"-\");if(d>-1)return l.substring(0,d)}return\"\"}var pr=perfNow$1;function setProcessTelemetryTimings$1(l,d){var u=l;u.timings=u.timings||{},u.timings.processTelemetryStart=u.timings.processTelemetryStart||{},u.timings.processTelemetryStart[d]=pr()}var hr=isFunction$1;function _createPromiseAllOnResolvedFunction(l,d,u){return function(p){l[d]=p,u()}}var gr=function(){function ESPromise(l){var d=0,u=null,p=[];function _enqueue(l,h,g,f){p.push((function(){var p;try{(p=1===d?hr(l)?l(u):u:hr(h)?h(u):u)instanceof ESPromise?p.then(g,f):2!==d||hr(h)?g(p):f(p)}catch(l){return void f(l)}})),0!==d&&_processQueue()}function _processQueue(){if(p.length>0){var l=p.slice();p=[],setTimeout((function(){for(var d=0,u=l.length;d<u;++d)try{l[d]()}catch(l){}}),0)}}function _resolve(l){0===d&&(u=l,d=1,_processQueue())}function _reject(l){0===d&&(u=l,d=2,_processQueue())}dynamicProto$1(ESPromise,this,(function(l){l.then=function(l,d){return new ESPromise((function(u,p){_enqueue(l,d,u,p)}))},l.catch=function(d){return l.then(null,d)}})),function _initialize(){if(!hr(l))throw new TypeError(\"ESPromise: resolvedFunc argument is not a Function\");try{l(_resolve,_reject)}catch(l){_reject(l)}}()}return ESPromise.resolve=function(l){return l instanceof ESPromise?l:l&&hr(l.then)?new ESPromise((function(d,u){try{l.then(d,u)}catch(l){u(l)}})):new ESPromise((function(d){d(l)}))},ESPromise.reject=function(l){return new ESPromise((function(d,u){u(l)}))},ESPromise.all=function(l){if(l&&l.length)return new ESPromise((function(d,u){try{for(var p=[],h=0,g=0;g<l.length;g++){var f=l[g];f&&hr(f.then)?(h++,f.then(_createPromiseAllOnResolvedFunction(p,g,(function(){0==--h&&d(p)})),u)):p[g]=f}0===h&&setTimeout((function(){d(p)}),0)}catch(l){u(l)}}))},ESPromise.race=function(l){return new ESPromise((function(d,u){if(l&&l.length)try{for(var _loop_1=function(p){var h=l[p];h&&hr(h.then)?h.then(d,u):setTimeout((function(){d(h)}),0)},p=0;p<l.length;p++)_loop_1(p)}catch(l){u(l)}}))},ESPromise}(),fr=6e5,mr=0,vr=[],yr=[],Sr=[];function _getTime(){return(new Date).getTime()}var _r,Cr=function(){function ESPromiseScheduler(l,d){var u=0,p=(l||\"<unnamed>\")+\".\"+mr;function _debugLog(l){var d=getGlobal();d&&d.QUnit&&console&&console.log(\"ESPromiseScheduler[\"+p+\"] \"+l)}function _warnLog(l){d&&d.warnToConsole(\"ESPromiseScheduler[\"+p+\"] \"+l)}mr++,dynamicProto$1(ESPromiseScheduler,this,(function(l){var d=null,h=0;function _removeQueuedEvent(l,d){for(var u=0;u<l.length;u++)if(l[u].id===d)return l.splice(u,1)[0];return null}l.scheduleEvent=function(l,g,f){var m=p+\".\"+h;h++,g&&(m+=\"-(\"+g+\")\");var v=m+\"{\"+u+\"}\";u++;var y={evt:null,tm:_getTime(),id:v,isRunning:!1,isAborted:!1};return y.evt=d?_waitForPreviousEvent(y,d):_startWaitingEvent(y),(d=y).evt._schId=v,y.evt;function _abortAndRemoveOldEvents(l){for(var d=_getTime(),u=d-fr,p=l.length,h=0;h<p;){var g=l[h];if(g&&g.tm<u){var f=null;g.abort?(f=\"Aborting [\"+g.id+\"] due to Excessive runtime (\"+(d-g.tm)+\" ms)\",g.abort(f)):f=\"Removing [\"+g.id+\"] due to Excessive runtime (\"+(d-g.tm)+\" ms)\",_warnLog(f),l.splice(h,1),p--}else h++}}function _cleanup(l,u){var p=!1,h=_removeQueuedEvent(vr,l);if(h||(h=_removeQueuedEvent(Sr,l),p=!0),h){h.to&&(clearTimeout(h.to),h.to=null);var g=_getTime()-h.tm;u?p?_warnLog(\"Timed out event [\"+l+\"] finally complete -- \"+g+\" ms\"):_debugLog(\"Promise [\"+l+\"] Complete -- \"+g+\" ms\"):(Sr.push(h),_warnLog(\"Event [\"+l+\"] Timed out and removed -- \"+g+\" ms\"))}else _debugLog(\"Failed to remove [\"+l+\"] from running queue\");d&&d.id===l&&(d=null),_abortAndRemoveOldEvents(vr),_abortAndRemoveOldEvents(yr),_abortAndRemoveOldEvents(Sr)}function _removeScheduledEvent(l,d){return function(u){return _cleanup(l,!0),d&&d(u),u}}function _waitForFinalResult(l,d,u,p){d.then((function(d){return d instanceof gr?(_debugLog(\"Event [\"+l+\"] returned a promise -- waiting\"),_waitForFinalResult(l,d,u,p),d):_removeScheduledEvent(l,u)(d)}),_removeScheduledEvent(l,p))}function _createScheduledEvent(l,d){var u=l.id;return new gr((function(p,h){_debugLog(\"Event [\"+u+\"] Starting -- waited for \"+(l.wTm||\"--\")+\" ms\"),l.isRunning=!0,l.abort=function(d){l.abort=null,l.isAborted=!0,_cleanup(u,!1),h(new Error(d))};var g=d(u);g instanceof gr?(f&&(l.to=setTimeout((function(){_cleanup(u,!1),h(new Error(\"Timed out after [\"+f+\"] ms\"))}),f)),_waitForFinalResult(u,g,(function(d){_debugLog(\"Event [\"+u+\"] Resolving after \"+(_getTime()-l.tm)+\" ms\"),p(d)}),h)):(_debugLog(\"Promise [\"+u+\"] Auto completed as the start action did not return a promise\"),p())}))}function _startWaitingEvent(d){var u=_getTime();return d.wTm=u-d.tm,d.tm=u,d.isAborted?gr.reject(new Error(\"[\"+m+\"] was aborted\")):(vr.push(d),_createScheduledEvent(d,l))}function _waitForPreviousEvent(l,d){var u=new gr((function(u,p){var h=_getTime()-d.tm,g=d.id;_debugLog(\"[\"+m+\"] is waiting for [\"+g+\":\"+h+\" ms] to complete before starting -- [\"+yr.length+\"] waiting and [\"+vr.length+\"] running\"),l.abort=function(d){l.abort=null,_removeQueuedEvent(yr,m),l.isAborted=!0,p(new Error(d))},d.evt.then((function(d){_removeQueuedEvent(yr,m),_startWaitingEvent(l).then(u,p)}),(function(d){_removeQueuedEvent(yr,m),_startWaitingEvent(l).then(u,p)}))}));return yr.push(l),u}}}))}return ESPromiseScheduler.incomplete=function(){return vr},ESPromiseScheduler.waitingToStart=function(){return yr},ESPromiseScheduler}();function isValidPersistenceLevel(l){return isNumber$1(l)&&l>=ur.Normal&&l<=ur.Critical}!function(l){l[l.LocalStorage=1]=\"LocalStorage\",l[l.SessionStorage=2]=\"SessionStorage\",l[l.IndexedDb=3]=\"IndexedDb\"}(_r||(_r={}));var Er=10,Tr=\"3\",br=\"Version\",Ir=6e5,Ar=\"AWTEvents\",Rr=5e6,Pr=1,Or=2;function _isQuotaExceeded(l,d){var u=!1;return d instanceof DOMException&&(22!==d.code&&\"QuotaExceededError\"!==d.name&&1014!==d.code&&\"NS_ERROR_DOM_QUOTA_REACHED\"!==d.name||l&&0!==l.length&&(u=!0)),u}function _getAvailableStorage(l){var d=getGlobal()||{},u=null;try{if(u=d[l]){var p=\"__storage_test__\";u.setItem(p,p),u.removeItem(p)}}catch(l){_isQuotaExceeded(u,l)||(u=null)}return u}function _forEachMap(l,d){if(l)for(var u=objKeys$1(l),p=0;p<u.length;p++){var h=u[p];if(!d(l[h],h))break}}function _isMapEmpty(l){var d=!0;return _forEachMap(l,(function(l,u){return l&&(d=!1),d})),d}function _dropEventsUpToPersistence(l,d){for(var u=Pr,p=0,_loop_1=function(){var l=[],h=d[u];if(_forEachMap(h,(function(d,u){return l.push(u),++p<Er})),p>0){for(var g=0;g<l.length;g++)delete h[l[g]];return{value:!0}}u++};u<=l&&p<Er;){var h=_loop_1();if(\"object\"==typeof h)return h.value}return p>0}var Mr=isValidPersistenceLevel,wr=function(){function WebStorageProvider(l,d){dynamicProto$1(WebStorageProvider,this,(function(u){var p=null,h=Ar,g=null,f=Tr,m=null,v=null,y=Rr,S=null,_=null;function _newStore(l,d){return{key:l,db:d}}function _fetchStoredDb(l,d){void 0===d&&(d=!0);var u=null;if(p){var h=p.getItem(l);if(h)try{u=JSON.parse(h)}catch(d){p.removeItem(l)}}return d&&!u&&(u={events:{1:{},2:{},3:{}},lastAccessTime:0}),_newStore(l,u)}function _updateStoredDb(l,d){void 0===d&&(d=!0);var u=!0,h=l.db;if(h){d&&(h.lastAccessTime=(new Date).getTime());for(var g=Pr;g<=Or;g++)if(!_isMapEmpty(h.events[g])){u=!1;break}}try{if(u)p&&p.removeItem(l.key);else{var f=JSON.stringify(h);if(f.length>y)return!1;p&&p.setItem(l.key,f)}}catch(l){return!1}return!0}function _clearDatabase(l){var d=[],u=_fetchStoredDb(l,!1),h=u.db;if(h){var g=h.events;try{for(var f=Pr;f<=Or;f++)_forEachMap(g[f],(function(l,u){return l&&d.push(l),!0}))}catch(l){}p&&p.removeItem(u.key)}return d}function _checkVersionAndMoveEventsToCurrentStorage(){if(p){for(var l=p.getItem(S),d=[],u=_fetchStoredDb(_),g=!1,m=0;m<p.length;m++){var y=p.key(m);if(0===y.indexOf(h)&&y!==S){if(l!==Tr){d.push(_newStore(y,null));continue}var C=_fetchStoredDb(y,!1),E=C.db;if(E){if((new Date).getTime()-E.lastAccessTime>Ir){for(var T=Pr,_loop_3=function(){var l=E.events[T],d=u.db.events[T];_forEachMap(l,(function(u,p){return(getTenantId$1(u.iKey)||u.iKey)===v&&(d[p]=u,delete l[p]),!0})),T++};T<=Or;)_loop_3();g=!0,d.push(C)}}else d.push(_newStore(y,null))}}for(m=0;m<d.length;m++)_updateStoredDb(d[m],!1);g&&_updateStoredDb(u),p.setItem(S,f)}}u.id=d,p=_getAvailableStorage(l)||null,u.initialize=function(l){if(!p)return!1;var d=l.storageConfig||{};return y=d.maxStorageSizeInBytes>0?d.maxStorageSizeInBytes:y,h=d.storageKey||Ar,g=u.id||l.id||newGuid$1(),_=h+\".\"+g,S=h+br,m=l.itemCtx.getCfg().instrumentationKey,v=getTenantId$1(m)||m,_checkVersionAndMoveEventsToCurrentStorage(),!0},u.supportsSyncRequests=function(){return!0},u.getAllEvents=function(){try{var l=[],d=_fetchStoredDb(_,!1).db;if(d)for(var u=d.events,p=Or;p>=Pr;p--)_forEachMap(u[p],(function(d){d&&((getTenantId$1(d.iKey)||d.iKey)===v&&l.push(d));return!0}));return gr.resolve(l)}catch(l){return gr.reject(l)}},u.addEvent=function(l,d,u){try{var p=_fetchStoredDb(_);d.id=d.id||newGuid$1(),Mr(d.persistence)||(d.persistence=Pr);for(var h=d.persistence,g=d.id,f=p.db.events;;){if(f[h][g]=d,_updateStoredDb(p))return gr.resolve(d);if(delete f[h][g],!_dropEventsUpToPersistence(h,f))return gr.reject(new Error(\"Unable to free up event space\"))}}catch(l){return gr.reject(l)}},u.removeEvents=function(l){try{var d=_fetchStoredDb(_,!1),u=d.db;if(u){var p=u.events;try{for(var h=0;h<l.length;++h){var g=l[h];delete p[g.persistence][g.id]}if(_updateStoredDb(d))return gr.resolve(l)}catch(l){}l=_clearDatabase(d.key)}return gr.resolve(l)}catch(l){return gr.reject(l)}},u.clear=function(){try{var l=[],d=_fetchStoredDb(_,!1),u=d.db;if(u){for(var p=u.events,_loop_2=function(d){var u=p[d];_forEachMap(u,(function(d){d&&((getTenantId$1(d.iKey)||d.iKey)===v&&(delete u[d.id],l.push(d)));return!0}))},h=Or;h>=Pr;h--)_loop_2(h);_updateStoredDb(d)}return gr.resolve(l)}catch(l){return gr.reject(l)}},u.teardown=function(){try{var l=_fetchStoredDb(_,!1),d=l.db;d&&(d.lastAccessTime=0,_updateStoredDb(l,!1))}catch(l){}}}))}return WebStorageProvider}(),Nr=\"readwrite\",Dr=\"result\",Lr=\"DBError: Unable to open database\",kr=\"Database is not open\",xr=\"DBError: Failed to Open Cursor\",Fr=\"DBError: Failed to delete the database\",Ur=\"DBError: Database does not exist\",jr=\"DBError: Database upgrade required\",Br=\"DBError: Feature not supported\",Vr=[\"indexedDB\"],Hr=isFunction$1,Gr=isString$1;function _getDbFactory(){var l=getGlobal()||{},d=null;if(l)try{for(var u=0;u<Vr.length;u++)if((d=l[Vr[u]])&&Hr(d.open))return d}catch(l){d=null}return d||null}function _debugLog(l,d){getGlobalInst$1(\"QUnit\")&&console&&console.log(\"IndexedDbHelper [\"+l+\"] \"+d)}function _warnLog(l,d,u){l&&l.warnToConsole(\"IndexedDbHelper [\"+d+\"] \"+u)}function _eventReject(l,d,u,p){return function(h){u(new Error(d)),_debugLog(l,\"[\"+p+\"] event rejected\")}}var Wr=[];function _getDbContext(l,d){for(var u=null,p=0;p<Wr.length;p++)if((u=Wr[p]).name===l)return u;return u={name:l,sch:new Cr(\"IndexedDbHelper[\"+l+\"]\",d),dbHdl:[],add:function(d){u.dbHdl.push(d),_debugLog(l,\"- dbOpened (add) -- hdls [\"+u.dbHdl.length+\"]\")},remove:function(d){for(var p=u.dbHdl,h=0;h<p.length;h++)if(p[h]===d){p.splice(h,1);break}_debugLog(l,\"- dbClosed (remove) -- hdls [\"+u.dbHdl.length+\"]\")},isOpen:function(){return u.dbHdl.length>0},openHdl:function(){return u.dbHdl.length>0?u.dbHdl[0]:null}},Wr.push(u),u}var qr=function(){function IndexedDbHelper(l){dynamicProto$1(IndexedDbHelper,this,(function(d){var u=_getDbFactory()||null;function _createStoreContext(d,u){var p=d.db.transaction(u,Nr);return p.onabort=function(){_warnLog(l,d.dbName,\"txn.onabort\")},p.onerror=function(){_warnLog(l,d.dbName,\"txn.onerror\")},p.oncomplete=function(){_debugLog(d.dbName,\"txn.oncomplete\")},{db:d,store:p.objectStore(u),tx:p,tbl:u,openCursor:function(l,p){return _openCursor(d,u,l,p)},newTransaction:function(l){return _openStore(d,u,l)}}}function _openStore(l,d,u){if(!l||!l.db)return gr.reject(new Error(kr));try{var p=u(_createStoreContext(l,d));return p instanceof gr?p:gr.resolve(p)}catch(l){return gr.reject(l)}}function _openCursor(l,d,u,p){if(!l||!l.db)return gr.reject(new Error(kr));var h=null;return u&&Gr(u)?h=new zr(u):u&&u.isMatch&&(h=u),new gr((function(u,g){var f=[],m=null,v=null;h&&h.keyRange&&(v=h.keyRange());var y=_createStoreContext(l,d);(m=v?y.store.openCursor(v):y.store.openCursor()).onerror=_eventReject(y.db.dbName,xr,g,\"openCursor\"),m.onsuccess=function(l){var d=l.target[Dr];if(d){var m={store:y,cursor:d,continue:function(){d.continue()},done:function(){u(f)}},v=d.value;if(!h||h.isMatch(v))if(p)try{switch(p(m,v,f)){case 2:u(f);break;case 1:break;case 0:default:m.continue()}}catch(l){g(l)}else f.push(v),m.continue();else m.continue()}else u(f)}}))}function _scheduleEvent(l,d,u,p){return _getDbContext(l).sch.scheduleEvent(u,d,p)}d.isAvailable=function(){return!!u},d.openDb=function(d,p,h,g){return _scheduleEvent(d,\"openDb\",(function(f){return new gr((function(m,v){var y=!1;function _createDbCtx(l,u,h,g,f){var m={db:u,dbName:d,dbVersion:p,ctx:null,isNew:g,txn:h?h.transaction:null};return f||(m.openStore=function(l,d){return _openStore(m,l,d)},m.openCursor=function(l,d,u){return _openCursor(m,l,d,u)}),m}function _databaseUpgrade(l,d){var u=_createDbCtx(null,l,d,!0,!0);if(g)y=!0,g(u).then((function(){u.txn||(u.txn=d.transaction)}),(function(l){try{d.transaction&&d.transaction.abort()}finally{v(l)}}));else try{d.transaction&&d.transaction.abort()}finally{v(new Error(jr))}}function _databaseOpen(u,p){var g=_getDbContext(d);g.add(u),u.onabort=function(p){_warnLog(l,d,\"onabort -- closing the Db\"),g.remove(u)},u.onerror=function(p){_warnLog(l,d,\"onerror -- closing the Db\"),g.remove(u)},u.onclose=function(p){_warnLog(l,d,\"onclose -- closing the Db\"),g.remove(u)},u.onversionchange=function(p){_warnLog(l,d,\"onversionchange -- force closing the Db\"),u.close(),g.remove(u)};var f=null,S=null;g.dbHdl.length>0&&(S=g.dbHdl[0]),f=_createDbCtx(g,S,p,y);try{h(f).then((function(l){m(l)}),v)}catch(l){v(l)}}var S=_getDbContext(d);if(null==u)v(new Error(\"No available storage factory\"));else if(S.isOpen()){var _=_createDbCtx(S,S.openHdl(),null,!1);h(_).then(m,v)}else{var C=u.open(d,p);C.onblocked=function(u){_warnLog(l,d,\"Db Open Blocked event [\"+f+\"] - \"+(C.error||\"\")),v(new Error(Lr))},C.onerror=function(u){_warnLog(l,d,\"Db Open Error event [\"+f+\"] - \"+(C.error||\"\")),v(new Error(Lr))},C.onupgradeneeded=function(l){_debugLog(d,\"Db Open Create/Upgrade needed event [\"+f+\"]\");try{var u=l.target[Dr];if(!u)return void v(new Error(Lr));_databaseUpgrade(u,C)}catch(l){_eventReject(d,Lr,v,f)(l)}},C.onsuccess=function(l){var d=l.target[Dr];d?_databaseOpen(d,C):v(new Error(Lr))}}}))}))},d.closeDb=function(l){_scheduleEvent(l,\"closeDb\",(function(d){var u=_getDbContext(l),p=u.dbHdl,h=p.length;if(h>0){for(var g=0;g<h;g++)p[g].close();u.dbHdl=[]}return gr.resolve(1)}))},d.deleteDb=function(d){return null==u?gr.resolve(!1):_scheduleEvent(d,\"deleteDb\",(function(p){var h=_getDbContext(d),g=h.dbHdl,f=g.length;if(f>0){_warnLog(l,d,\"Db is open [\"+f+\"] force closing\");for(var m=0;m<f;m++)g[m].close();h.dbHdl=[]}return new gr((function(h,g){setTimeout((function(){try{_debugLog(d,\"[\"+p+\"] starting\");var f=u.deleteDatabase(d);f.onerror=function(u){_warnLog(l,d,\"[\"+p+\"] error!!\"),g(new Error(Fr))},f.onblocked=function(u){_warnLog(l,d,\"[\"+p+\"] blocked!!\"),g(new Error(Fr))},f.onupgradeneeded=function(u){_warnLog(l,d,\"[\"+p+\"] upgrade needed!!\"),g(new Error(Fr))},f.onsuccess=function(l){_debugLog(d,\"[\"+p+\"] complete\"),h(!0)},_debugLog(d,\"[\"+p+\"] started\")}catch(u){_warnLog(l,d,\"[\"+p+\"] threw - \"+u),g(new Error(Fr+\" - \"+u))}}),0)}))}))},d.getDbDetails=function(l){return _scheduleEvent(l,\"getDbDetails\",(function(d){return null!=u&&u.databases?new gr((function(d,p){u.databases().then((function(u){for(var h=0;h<u.length;h++)if(u[h].name===l)return void d(u[h]);p(new Error(Ur))}),p)})):gr.reject(new Error(Br))}),2e3)}}))}return IndexedDbHelper}(),zr=function(){function SimpleQuery(l){var d=[],u=null;dynamicProto$1(SimpleQuery,this,(function(p){p.keyRange=function(){return u},p.parseQuery=function(l){if(d=[],l)for(var h=l.split(\";\"),g=0;g<h.length;g++){var f=h[g],m=f.indexOf(\"=\");if(-1!==m){var v=f.substring(0,m),y=f.substring(m+1);0===v.indexOf(\"#\")&&(v=v.substring(1),u||(u=IDBKeyRange.bound(y,y+\"\"))),p.startsWith(v,y)}}},p.startsWith=function(l,u){d.push({name:l,value:u,type:0})},p.contains=function(l,u){d.push({name:l,value:u,type:1})},p.isMatch=function(l){if(!d||0===d.length)return!0;if(!l)return!1;for(var u=0;u<d.length;u++){var p=d[u],h=l[p.name];if(h)if(0===p.type){if(0!==h.indexOf(p.value))return!1}else if(1===p.type&&-1===h.indexOf(p.value))return!1}return!0},l&&p.parseQuery(l)}))}return SimpleQuery}(),Kr=10,Jr=1,Qr=6e5,Yr=1008e4,$r=\"Unknown\",Xr=-1,Zr=\"DBError: Unable to add event\",eo=\"DBError: Unable to update iKey\",to=\"AppInsightEvents.1\",no=1,io=\"Evts\",ro=\"iKey\",oo=isValidPersistenceLevel;function _getTime$1(){return(new Date).getTime()}function _eventReject$1(l,d){return function(u){return d(new Error(l))}}function _createDb(l){l.objectStoreNames.contains(io)||l.createObjectStore(io,{keyPath:\"key\"}).createIndex(\"EvntId\",\"key\",{unique:!1});l.objectStoreNames.contains(ro)||l.createObjectStore(ro,{keyPath:\"iKey\"}).createIndex(\"iKey\",\"iKey\",{unique:!0})}function _updateiKey(l){return l.openStore(ro,(function(d){return new gr((function(u,p){var h={iKey:l.ctx.iKey,tm:_getTime$1()},g=d.store.put(h);g.onsuccess=function(l){u(g.result.toString())},g.onerror=function(l){p(new Error(Zr))},g.onerror=_eventReject$1(eo,p)}))}))}function _orderEventsByPriority(l){for(var d=[],u=ur.Critical;u>=ur.Normal;u--)for(var p=0;p<l.length;p++){var h=l[p];h&&h.evt.persistence===u&&d.push(h.evt)}return d}function _addEventByTime(l,d){for(var u=0;u<l.length;u++)if(d.tm<l[u].tm)return void l.splice(u,0,d);l.push(d)}function _getKeyIndex(l,d){for(var u=d.length,p=0;p<u;p++)if(l===d[p].id)return p;return-1}function _isOldItem(l,d){var u=l.tm;return _getTime$1()-u>d}function _cursorContinueEvent(l){return function(d){return l.continue()}}function _cursorDeleteAndContinue(l){var d=l.cursor.delete();return d.onerror=_cursorContinueEvent(l),d.onsuccess=_cursorContinueEvent(l),1}function _getAllEventsForiKey(l,d){return l.openCursor(io,d,(function(l,d,u){return u.push(d),0}))}function _deleteEvents(l,d,u){return l.openCursor(io,d,(function(l,d,p){return u(d)?(p.push(d),_cursorDeleteAndContinue(l)):0}))}function _deleteOrphanedEvents(l){return new gr((function(d,u){var p=!1;l.openCursor(ro,null,(function(l,d,u){var h=d.tm;return _getTime$1()-h<Yr?0:(p=!0,2)})).then((function(){if(p){var h={};_deleteEvents(l,null,(function(l){if(!l||!l.evt||!l.evt.iKey)return!0;var d=l.tm;return _getTime$1()-d>Yr||(h[l.evt.iKey]=1,!1)})).then((function(){var p=[];l.openCursor(ro,null,(function(l,d,u){var g=d.tm;return _getTime$1()-g<Yr||h[d.iKey]?0:(p.push(d),_cursorDeleteAndContinue(l))})).then((function(){d(p)}),u)}),u)}else d([])}),u)}))}function _moveOldEventsToCurrentStore(l){return l.openCursor(io,\"#key=\"+l.ctx.iKeyPrefix(),(function(d,u){var p=u.key;if(0===p.indexOf(l.ctx.iKeyPrefix())&&-1===p.indexOf(l.ctx.evtKeyPrefix())&&_isOldItem(u,Qr)){u.key=l.ctx.evtKeyPrefix()+u.id;var h=d.store.store.put(u);return h.onerror=_cursorContinueEvent(d),h.onsuccess=function(l){try{_cursorDeleteAndContinue(d)}catch(l){d.continue()}},1}return 0}))}function _checkVersionAndMoveEventsToCurrentStorage(l){return new gr((function(d,u){_deleteOrphanedEvents(l).then((function(){_moveOldEventsToCurrentStore(l).then(d,d)}),u)}))}function _dropEventsUpToPersistence$1(l,d){return new gr((function(u,p){var h=0,g=l.ctx.evtKeyPrefix();function _resolveWithDroppedEvents(){u(h)}function _dropEvent(l,d){return new gr((function(u){var p=l.store.delete(d.key);p.onsuccess=function(l){h++,u()},p.onerror=function(l){u()}}))}function _processCandidates(d){0!==d.length?l.openStore(io,(function(l){for(var u=[],p=0;p<d.length;p++)u.push(_dropEvent(l,d[p]));return gr.all(u).then(_resolveWithDroppedEvents,_resolveWithDroppedEvents)})):_resolveWithDroppedEvents()}l.openCursor(io,\"#key=\"+g,(function(l,u,p){return u.evt.persistence<=d&&0===u.key.indexOf(g)&&(_addEventByTime(p,u),p.length>Kr&&p.splice(p.length-1,1)),0})).then(_processCandidates,(function(){u(0)}))}))}var ao=function(){function IndexedDbProvider(l){dynamicProto$1(IndexedDbProvider,this,(function(d){var u=null,p=null,h=$r,g=null,f=null,m=null,v=Xr,y=0;function _openDb(l){function _handleDbUpgrade(l){return new gr((function(d,u){_createDb(l.db),d()}))}function _handleDbOpen(d){return new gr((function(u,p){var v={iKey:h,storageId:g,iKeyPrefix:function(){return f},evtKeyPrefix:function(){return m}};d.ctx=v,_updateiKey(d).then((function(){l(d).then(u,p)}),p)}))}return u.openDb(p,no,_handleDbOpen,_handleDbUpgrade)}function _addDbEvent(l,d,u){return new gr((function(p,h){function dropEvents(d,u){_dropEventsUpToPersistence$1(l,d).then((function(l){l>0&&(y-=l),u(l)}),(function(l){u(0)}))}function resolveAddEvent(l){p(d.evt)}function _insertNewEvent(){l.openStore(io,(function(g){var f=g.store.put(d);f.onsuccess=function(h){u&&_updateiKey(l).then(resolveAddEvent,resolveAddEvent),y++,p(d.evt)},f.onerror=function(g){function _retryAddEvent(u){0===u&&h(new Error(Zr)),_addDbEvent(l,d,!1).then((function(l){p(d.evt)}),(function(){h(new Error(Zr))}))}u?dropEvents(ur.Normal,(function(l){l>0?_retryAddEvent(l):d.evt.persistence>=ur.Critical?dropEvents(ur.Critical,(function(l){_retryAddEvent(l)})):h(new Error(Zr))})):h(new Error(Zr))}}))}v>0&&y>=v?dropEvents(ur.Normal,(function(l){0===l?d.evt.persistence>=ur.Critical?dropEvents(ur.Critical,(function(l){_insertNewEvent()})):h(new Error(Zr)):_insertNewEvent()})):_insertNewEvent()}))}d.id=l,d.initialize=function(l){var y=l.itemCtx.diagLog();if(!(u=new qr(y)).isAvailable())return u=null,!1;var S=l.itemCtx.getCfg(),_=l.storageConfig||{};return p=_.indexedDbName||to,h=S.instrumentationKey||h,g=d.id||l.id||newGuid$1(),m=(f=h+\"::\")+g+\"::\",v=_.maxStorageItems>0?_.maxStorageItems:v,_openDb((function(l){return l.isNew?gr.resolve(!0):_checkVersionAndMoveEventsToCurrentStorage(l)})).then((function(l){}),(function(l){y.warnToConsole(\"IndexedDbProvider failed to initialize - \"+(l||\"<unknown>\")),u=null})),!0},d.supportsSyncRequests=function(){return!1},d.getAllEvents=function(){return null!=u&&u.isAvailable()?_openDb((function(l){return new gr((function(d,u){_getAllEventsForiKey(l,\"#key=\"+l.ctx.evtKeyPrefix()).then((function(l){y=l.length,d(_orderEventsByPriority(l))}),u)}))})):gr.resolve([])},d.addEvent=function(l,d,p){return null!=u&&u.isAvailable()?(d.id=d.id||newGuid$1(),oo(d.persistence)||(d.persistence=ur.Normal),_openDb((function(u){var p=l||d.id,h={key:u.ctx.evtKeyPrefix()+p,id:p,evt:d,tm:_getTime$1(),v:Jr};return _addDbEvent(u,h,!0)}))):gr.resolve(d)},d.removeEvents=function(l){if(null==u||!u.isAvailable())return gr.resolve([]);var d=[];return new gr((function(u,p){_openDb((function(u){return u.openCursor(io,\"#key=\"+u.ctx.iKey,(function(u,p,h){if(-1!==_getKeyIndex(p.id,l)){var g=u.cursor.delete();return g.onerror=_cursorContinueEvent(u),g.onsuccess=function(){d.push(p.evt),u.continue()},1}return 0}))})).then((function(l){y-=d.length,u(d)}),(function(l){y-=d.length,u(d)}))}))},d.clear=function(){return null!=u&&u.isAvailable()?new gr((function(l,d){_openDb((function(l){return _deleteEvents(l,\"#key=\"+l.ctx.evtKeyPrefix(),(function(d){return 0===d.key.indexOf(l.ctx.evtKeyPrefix())}))})).then((function(d){y=0,l(_orderEventsByPriority(d))}),d)})):gr.resolve([])},d.teardown=function(){u&&u.closeDb(p)}}))}return IndexedDbProvider}(),so=\"3.1.3\",co=\"LocalStorage\",lo=5,uo=isValidPersistenceLevel,po=function(l){function LocalStorageChannel(){var d=l.call(this)||this;return d.identifier=co,d.priority=1009,d.version=so,dynamicProto$1(LocalStorageChannel,d,(function(l,d){var u=!1,p=!1,h=null,g=[];function _queueStorageEvent(l,d){h||(h=new Cr(\"LocalStorage\")),h.scheduleEvent((function(l){return d(l)}),l)}function _sendStoredEventsToNextPlugin(d){doPerf$1(l.core,(function(){return\"LocalStorageChannel:_sendStoredEventsToNextPlugin\"}),(function(){_queueStorageEvent(\"sendToNext\",(function(u){return d.provider.getAllEvents().then((function(u){for(var p=0;p<u.length;p++)try{var h=u[p];(getTenantId$1(h.iKey)||h.iKey)===d.tenantId&&l.processNext(h,d.coreRootCtx.createNew())}catch(l){}}))}))}),(function(){return{iKeyConfig:d}}))}function _removeEvents(d,u){doPerf$1(l.core,(function(){return\"LocalStorageChannel:_removeEvents\"}),(function(){_queueStorageEvent(\"removeEvents\",(function(l){var p=[];return arrForEach$1(u,(function(l){(getTenantId$1(l.iKey)||l.iKey)===d.tenantId&&p.push(l)})),p.length>0?d.provider.removeEvents(p).then((function(l){})).catch((function(l){})):gr.resolve()}))}),(function(){return{iKeyConfig:d,events:u}}))}function _shouldCacheEvent(l,d){return!(d.sync||d.persistence<l.minPersistenceCacheLevel)}function _tryGetIndexedDbProvider(l){var d=new ao;return d.initialize(l)||(d=null),d}function _tryGetWebStorageProvider(l,d){var u=new wr(l);return u.initialize(d)||(u=null),u}function _initializeProvider(l){for(var d=l.storageConfig.providers,u=null,p=0;!u&&p<d.length&&p<lo;)switch(d[p++]){case _r.LocalStorage:u=_tryGetWebStorageProvider(\"localStorage\",l);break;case _r.SessionStorage:u=_tryGetWebStorageProvider(\"sessionStorage\",l);break;case _r.IndexedDb:u=_tryGetIndexedDbProvider(l)}return u}function _getCoreItemCtx(d,u,p,h){d&&(d.extensionConfig=d.extensionConfig||[]),!h&&u&&(h=u.getProcessTelContext().getNext());var g=null,f=l._getTelCtx().getNext();return f&&(g=f.getPlugin()),new Zi(h,d,u,g)}function _createIkeyConfig(d,u,p,h){var f=l.identifier,m=d.extensionConfig=d.extensionConfig||[],v=m[f]=m[f]||{};v.providers||(v.providers=[_r.LocalStorage,_r.IndexedDb]);var y=_getCoreItemCtx(d,u,p,h),S={itemCtx:y,storageConfig:v,id:l.id},_=_initializeProvider(S);if(_){var C={iKey:d.instrumentationKey,tenantId:getTenantId$1(d.instrumentationKey)||d.instrumentationKey,minPersistenceCacheLevel:ur.Normal,coreRootCtx:y,providerContext:S,provider:_};uo(v.minPersistenceLevel||-1)&&(C.minPersistenceCacheLevel=v.minPersistenceLevel),g.push(C),u.addNotificationListener({eventsSent:function(l){_removeEvents(C,l)},eventsDiscarded:function(l,d){_removeEvents(C,l)}}),_sendStoredEventsToNextPlugin(C)}}l.initialize=function(l,p,g,f){doPerf$1(p,(function(){return\"LocalStorageChannel.initialize\"}),(function(){u||(d.initialize(l,p,g),d.setInitialized(!1),u=!0,h=new Cr(\"LocalStorage\",p.logger)),_createIkeyConfig(l,p,g,f)}),(function(){return{coreConfig:l,core:p,extensions:g,pluginChain:f}}))},l.processTelemetry=function(d,u){u=l._getTelCtx(u),setProcessTelemetryTimings$1(d,l.identifier);var h=null;arrForEach$1(g,(function(l){l.iKey===d.iKey&&(h=l)}));var f=p,m=h?h.provider:null,v=d;!v.sync&&m?(v.id=v.id||newGuid$1(),isValidPersistenceLevel(v.persistence)||(v.persistence=1),_shouldCacheEvent(h,v)&&_queueStorageEvent(\"processTelemetry\",(function(l){return m.addEvent(v.id,v,u)})),f||l.processNext(v,u)):l.processNext(v,u)},l.pause=function(){p=!0},l.resume=function(){doPerf$1(l.core,(function(){return\"LocalStorageChannel:resume\"}),(function(){p=!1,arrForEach$1(g,(function(l){l.provider&&_sendStoredEventsToNextPlugin(l)}))}))},l.teardown=function(){arrForEach$1(g,(function(l){var d=l.provider;d&&d.teardown()})),g=[]},l.flush=function(l,d){}})),d}return __extendsFn(LocalStorageChannel,l),LocalStorageChannel}(nr),ho=\"REAL_TIME\",go=\"NEAR_REAL_TIME\",fo=\"BEST_EFFORT\",mo=function(){function EventBatch(l,d){var u=d?[].concat(d):[],p=this;p.iKey=function(){return l},p.count=function(){return u.length},p.events=function(){return u},p.addEvents=function(l,d){return void 0===d&&(d=!0),l&&l.length>0?(u=d?u.concat(l):l.concat(u),l.length):0},p.split=function(d,p){var h=new EventBatch(l);if(d<u.length){var g=u.length-d;isNullOrUndefined(p)||(g=p<g?p:g),h.addEvents(u.splice(d,g),!0)}return h}}return EventBatch.create=function(l,d){return new EventBatch(l,d)},EventBatch}(),vo=20,yo=3984588,So=65e3,_o=2e6,Co=Math.min(_o,So),Eo=\"metadata\",To=\"f\",bo=/\\./,Io=function(){function Serializer(l,d,u,p){var h=\"data\",g=\"baseData\",f=\"ext\",m=!!p,v=!0,y=d,S={};dynamicProto(Serializer,this,(function(d){function _isReservedField(l,d){var u=S[l];return void 0===u&&(l.length>=7&&(u=strStartsWith(l,\"ext.metadata\")||strStartsWith(l,\"ext.web\")),S[l]=u),u}function _processPathKeys(l,d,p,h,g,f,v){objForEachKey(l,(function(l,S){var _=null;if(S||isValueAssigned(S)){var C=p,E=l,T=g,b=d;if(m&&!h&&bo.test(l)){var I=l.split(\".\"),A=I.length;if(A>1){T&&(T=T.slice());for(var R=0;R<A-1;R++){var P=I[R];b=b[P]=b[P]||{},C+=\".\"+P,T&&T.push(P)}E=I[A-1]}}if(_=!(h&&_isReservedField(C))&&y&&y.handleField(C,E)?y.value(C,E,S,u):sanitizeProperty(E,S,u)){var O=_.value;if(b[E]=O,f&&f(T,E,_),v&&\"object\"==typeof O&&!isArray(O)){var M=T;M&&(M=M.slice()).push(E),_processPathKeys(S,O,C+\".\"+E,h,M,f,v)}}}}))}d.createPayload=function(l,d,u,p,h){return{apiKeys:[],payloadBlob:\"\",overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:l,isTeardown:d,isSync:u,isBeacon:p,sendReason:h}},d.appendPayload=function(u,p,h){var g=u&&p&&!u.overflow;return g&&doPerf(l,(function(){return\"Serializer:appendPayload\"}),(function(){for(var l=p.events(),g=u.payloadBlob,f=u.numEvents,m=!1,v=[],y=[],S=u.isBeacon,_=S?So:yo,C=S?Co:_o,E=0,T=0;E<l.length;){var b=l[E];if(b){if(f>=h){u.overflow=p.split(E);break}var I=d.getEventBlob(b);if(I&&I.length<=C){var A=I.length;if(g.length+A>_){u.overflow=p.split(E);break}g&&(g+=\"\\n\"),g+=I,++T>vo&&(g.substr(0,1),T=0),m=!0,f++}else I?v.push(b):y.push(b),l.splice(E,1),E--}E++}if(v&&v.length>0&&u.sizeExceed.push(mo.create(p.iKey(),v)),y&&y.length>0&&u.failedEvts.push(mo.create(p.iKey(),y)),m){u.batches.push(p),u.payloadBlob=g,u.numEvents=f;var R=p.iKey();-1===arrIndexOf(u.apiKeys,R)&&u.apiKeys.push(R)}}),(function(){return{payload:u,theBatch:{iKey:p.iKey(),evts:p.events()},max:h}})),g},d.getEventBlob=function(d){try{return doPerf(l,(function(){return\"Serializer.getEventBlob\"}),(function(){var l={};l.name=d.name,l.time=d.time,l.ver=d.ver,l.iKey=\"o:\"+getTenantId(d.iKey);var u={},p=d[f];p&&(l[f]=u,objForEachKey(p,(function(l,d){_processPathKeys(d,u[l]={},\"ext.\"+l,!0,null,null,!0)})));var m=l[h]={};m.baseType=d.baseType;var y=m[g]={};return _processPathKeys(d.baseData,y,g,!1,[g],(function(l,d,p){_addJSONPropertyMetaData(u,l,d,p)}),v),_processPathKeys(d.data,m,h,!1,[],(function(l,d,p){_addJSONPropertyMetaData(u,l,d,p)}),v),JSON.stringify(l)}),(function(){return{item:d}}))}catch(l){return null}}}))}return Serializer}();function _addJSONPropertyMetaData(l,d,u,p){if(p&&l){var h=getCommonSchemaMetaData(p.value,p.kind,p.propertyType);if(h>-1){var g=l[Eo];g||(g=l[Eo]={f:{}});var f=g[To];if(f||(f=g[To]={}),d)for(var m=0;m<d.length;m++){var v=d[m];f[v]||(f[v]={f:{}});var y=f[v][To];y||(y=f[v][To]={}),f=y}f=f[u]={},isArray(p.value)?f.a={t:h}:f.t=h}}}var Ao,Ro=.8,Po=1.2,Oo=3e3,Mo=6e5,wo=function(){function RetryPolicy(){}return RetryPolicy.shouldRetryForStatus=function(l){return!(l>=300&&l<500&&408!==l&&429!==l||501===l||505===l)},RetryPolicy.getMillisToBackoffForRetry=function(l){var d=0,u=Oo*Ro,p=Oo*Po,h=Math.floor(Math.random()*(p-u))+u;return d=Math.pow(2,l)*h,Math.min(d,Mo)},RetryPolicy}(),No=1e3,Do=function(){function KillSwitch(){var l={};function _normalizeTenants(l){var d=[];return l&&arrForEach(l,(function(l){d.push(strTrim(l))})),d}dynamicProto(KillSwitch,this,(function(d){d.setKillSwitchTenants=function(d,u){if(d&&u)try{var p=_normalizeTenants(d.split(\",\"));if(\"this-request-only\"===u)return p;for(var h=parseInt(u,10)*No,g=0;g<p.length;++g)l[p[g]]=dateNow()+h}catch(l){return[]}return[]},d.isTenantKilled=function(d){var u=l,p=strTrim(d);return void 0!==u[p]&&u[p]>dateNow()||(delete u[p],!1)}}))}return KillSwitch}(),Lo=function(){function ClockSkewManager(){var l=!0,d=!0,u=!0,p=\"use-collector-delta\",h=!1;dynamicProto(ClockSkewManager,this,(function(g){g.allowRequestSending=function(){return l},g.firstRequestSent=function(){u&&(u=!1,h||(l=!1))},g.shouldAddClockSkewHeaders=function(){return d},g.getClockSkewHeaderValue=function(){return p},g.setClockSkew=function(u){h||(u?(p=u,d=!0,h=!0):d=!1,l=!0)}}))}return ClockSkewManager}(),ko=\"POST\",xo=\"Microsoft_ApplicationInsights_BypassAjaxInstrumentation\",Fo=\"drop\",Uo=\"send\",jo=\"requeue\",Bo=\"rspFail\",Vo=\"oth\",Ho=\"kill-tokens\",Go=\"kill-duration\",Wo=\"kill-duration-seconds\",qo=\"time-delta-millis\",zo=((Ao={})[1]=jo,Ao[100]=jo,Ao[200]=\"sent\",Ao[8004]=Fo,Ao[8003]=Fo,Ao);function _getResponseText(l){try{return l.responseText}catch(l){}return\"\"}var Ko=function(){function HttpManager(l,d,u,p){this._responseHandlers=[];var h,g,f,m,v,y=\"?cors=true&content-type=application/x-json-stream&client-id=NO_AUTH&client-version=\"+wn,S=new Do,_=!1,C=new Lo,E=!1,T=0,b=!0,I=[],A={},R=[],P=null,O=!1;dynamicProto(HttpManager,this,(function(M){var w=!0;function _getSenderInterface(l){for(var d=0,u=null,p=0;null==u&&p<l.length;)1===(d=l[p])?useXDomainRequest()?u=_xdrSendPost:\"undefined\"!=typeof XMLHttpRequest&&(u=_xhrSendPost):2===d?u=_fetchSendPost:E&&3===d&&isBeaconsSupported()&&(u=_beaconSendPost),p++;return u?{_transport:d,sendPOST:u}:null}function _xdrSendPost(l,d,u){var p=new XDomainRequest;p.open(ko,l.urlString),p.onload=function(){var l=_getResponseText(p);_doOnComplete(d,200,{},l),_handleCollectorResponse(l)},p.onerror=function(){_doOnComplete(d,400,{})},p.ontimeout=function(){_doOnComplete(d,500,{})},p.onprogress=function(){},u?p.send(l.data):h._setTimeoutOverride((function(){p.send(l.data)}),0)}function _fetchSendPost(l,d){var u,p=((u={body:l.data,method:ko})[xo]=!0,u);w&&(p.credentials=\"include\"),l.headers&&objKeys(l.headers).length>0&&(p.headers=l.headers),fetch(l.urlString,p).then((function(l){var u={},p=\"\";l.headers&&l.headers.forEach((function(l,d){u[d]=l})),l.body&&l.text().then((function(l){p=l})),_doOnComplete(d,l.status,u,p),_handleCollectorResponse(p)})).catch((function(l){_doOnComplete(d,0,{})}))}function _xhrSendPost(l,d,u){function _appendHeader(l,d,u){if(!l[u]&&d&&d.getResponseHeader){var p=d.getResponseHeader(u);p&&(l[u]=strTrim(p))}return l}function _getAllResponseHeaders(l){var d={};return l.getAllResponseHeaders?d=_convertAllHeadersToMap(l.getAllResponseHeaders()):(d=_appendHeader(d,l,qo),d=_appendHeader(d,l,Go),d=_appendHeader(d,l,Wo)),d}function xhrComplete(l,u){_doOnComplete(d,l.status,_getAllResponseHeaders(l),u)}var p=new XMLHttpRequest;try{p[xo]=!0}catch(l){}w&&(p.withCredentials=!0),p.open(ko,l.urlString,!u),objForEachKey(l.headers,(function(l,d){p.setRequestHeader(l,d)})),p.onload=function(){var l=_getResponseText(p);xhrComplete(p,l),_handleCollectorResponse(l)},p.onerror=function(){xhrComplete(p)},p.ontimeout=function(){xhrComplete(p)},p.send(l.data)}function _doOnComplete(l,d,u,p){try{l(d,u,p)}catch(l){h.diagLog().throwInternal(rt.WARNING,Mn.SendPostOnCompleteFailure,dumpObj(l))}}function _beaconSendPost(l,d,u){var p=200,g=l._thePayload;try{var f=getNavigator();if(!f.sendBeacon(l.urlString,l.data))if(g){var m=[];arrForEach(g.batches,(function(d){if(m&&d&&d.count()>0){for(var u=d.events(),p=0;p<u.length;p++)if(!f.sendBeacon(l.urlString,P.getEventBlob(u[p]))){m.push(d.split(p));break}}else m.push(d.split(0))})),_sendBatchesNotification(m,8003,g.isSync,!0)}else p=0}catch(l){h.diagLog().warnToConsole(\"Failed to send telemetry using sendBeacon API. Ex:\"+l),p=0}finally{_doOnComplete(d,p,{},\"\")}}function _hasIdleConnection(){return!_&&T<d}function _clearQueue(){var l=R;return R=[],l}function _canSendPayload(l,d,u){var p=!1;return l&&l.length>0&&!_&&g&&P&&(p=d||_hasIdleConnection()&&(u>0||C.allowRequestSending())),p}function _createDebugBatches(l){var d={};return l&&arrForEach(l,(function(l,u){d[u]={iKey:l.iKey(),evts:l.events()}})),d}function _sendBatches(d,u,p,f,v,y){if(d&&0!==d.length)if(_)_sendBatchesNotification(d,1,f);else try{var C=d;doPerf(m,(function(){return\"HttpManager:_sendBatches\"}),(function(h){h&&(d=d.slice(0));for(var m=[],_=null,C=kn(),E=(y||g&&3===g._transport)&&_canUseSendBeaconApi();_canSendPayload(d,f,u);){var T=d.shift();T&&T.count()>0&&(S.isTenantKilled(T.iKey())?m.push(T):(_=_||P.createPayload(u,p,f,E,v),P.appendPayload(_,T,l)?null!==_.overflow&&(d=[_.overflow].concat(d),_.overflow=null,_doPayloadSend(_,C,kn(),v),C=kn(),_=null):(_doPayloadSend(_,C,kn(),v),C=kn(),d=[T].concat(d),_=null)))}_&&_doPayloadSend(_,C,kn(),v),d.length>0&&(R=d.concat(R)),_sendBatchesNotification(m,8004,f)}),(function(){return{batches:_createDebugBatches(C),retryCount:u,isTeardown:p,isSynchronous:f,sendReason:v,useSendBeacon:y}}),!f)}catch(l){h.diagLog().throwInternal(rt.WARNING,Mn.CannotSerializeObject,\"Unexpected Exception sending batch: \"+dumpObj(l))}}function _buildQueryString(l){var d=y,u=\"\";arrForEach(l.apiKeys,(function(l){u.length>0&&(u+=\",\"),u+=l})),u.length>0&&(d+=\"&apikey=\"+u),d+=\"&upload-time=\"+dateNow().toString();var p=_getMsfpc(l);if(isValueAssigned(p)&&(d=d+\"&ext.intweb.msfpc=\"+p),C.shouldAddClockSkewHeaders()&&(d+=\"&time-delta-to-apply-millis=\"+C.getClockSkewHeaderValue()),m.getWParam){var h=m.getWParam();h>=0&&(d+=\"&w=\"+h)}for(var g=0;g<I.length;g++)d+=\"&\"+I[g].name+\"=\"+I[g].value;return d}function _canUseSendBeaconApi(){return!b&&E&&isBeaconsSupported()}function _setTimingValue(l,d,u){l[d]=l[d]||{},l[d][h.identifier]=u}function _doPayloadSend(l,d,u,p){if(l&&l.payloadBlob&&l.payloadBlob.length>0){var v=_buildQueryString(l),y=kn(),S=\"sendAttempt\";doPerf(m,(function(){return\"HttpManager:_doPayloadSend\"}),(function(){for(var _=0;_<l.batches.length;_++)for(var E=l.batches[_].events(),I=0;I<E.length;I++){var R=E[I];if(O){var P=R.timings=R.timings||{};_setTimingValue(P,\"sendEventStart\",y),_setTimingValue(P,\"serializationStart\",d),_setTimingValue(P,\"serializationCompleted\",u)}R[S]>0?R[S]++:R[S]=1}_sendBatchesNotification(l.batches,1e3+(p||0),l.isSync,!0);var w={data:l.payloadBlob,urlString:v,headers:extend({},A),_thePayload:l,_sendReason:p},N=null,D=!!M.sendHook,L=g;f&&l.isBeacon&&2===l.sendReason&&(L=f),L&&(N=function(d){C.firstRequestSent();var onComplete=function(d,u){_retryRequestIfNeeded(d,u,l,p)};try{L.sendPOST(d,onComplete,l.isTeardown||l.isSync),M.sendListener&&M.sendListener(w,d,l.isSync||l.isTeardown,l.isBeacon)}catch(l){h.diagLog().warnToConsole(\"Unexpected exception sending payload. Ex:\"+dumpObj(l)),_doOnComplete(onComplete,0,{})}}),doPerf(m,(function(){return\"HttpManager:_doPayloadSend.sender\"}),(function(){if(N)if(l.isSync||l.isBeacon||T++,D&&!l.isBeacon&&3!==L._transport){var d={data:w.data,urlString:w.urlString,headers:w.headers},u=!1;doPerf(m,(function(){return\"HttpManager:_doPayloadSend.sendHook\"}),(function(){try{M.sendHook(d,(function(l){u=!0,b||l._thePayload||(l._thePayload=l._thePayload||w._thePayload,l._sendReason=l._sendReason||w._sendReason),N(l)}),l.isSync||l.isTeardown)}catch(l){u||N(w)}}))}else N(w)}))}),(function(){return{thePayload:l,serializationStart:d,serializationCompleted:u,sendReason:p}}),l.isSync)}l.sizeExceed&&l.sizeExceed.length>0&&_sendBatchesNotification(l.sizeExceed,8003,l.isSync),l.failedEvts&&l.failedEvts.length>0&&_sendBatchesNotification(l.failedEvts,8002,l.isSync)}function _addEventCompletedTimings(l,d){O&&arrForEach(l,(function(l){_setTimingValue(l.timings=l.timings||{},\"sendEventCompleted\",d)}))}function _retryRequestIfNeeded(l,d,p,h){var g=9e3,f=null,m=!1,v=!1;try{var y=!0;if(typeof l!==Me){if(d){C.setClockSkew(d[qo]);var _=d[Go]||d[\"kill-duration-seconds\"];arrForEach(S.setKillSwitchTenants(d[Ho],_),(function(l){arrForEach(p.batches,(function(d){if(d.iKey()===l){f=f||[];var u=d.split(0);p.numEvents-=u.count(),f.push(u)}}))}))}if(200===l)return void(g=200);(!wo.shouldRetryForStatus(l)||p.numEvents<=0)&&(y=!1),g=9e3+l%1e3}if(y){g=100;var E=p.retryCnt;p.isSync||p.isBeacon||(E<u?(m=!0,_doAction((function(){p.isSync||p.isBeacon||T--,_sendBatches(p.batches,E+1,p.isTeardown,p.isSync,5,p.isBeacon)}),!0,wo.getMillisToBackoffForRetry(E))):v=!0)}}finally{m||(C.setClockSkew(),_handleRequestFinished(p,g,h,v)),_sendBatchesNotification(f,8004,p.isSync)}}function _handleRequestFinished(l,d,u,p){try{p&&h._backOffTransmission(),200===d&&(p||l.isSync||h._clearBackOff(),_addCompleteTimings(l.batches)),_sendBatchesNotification(l.batches,d,l.isSync,!0)}finally{l.isSync||l.isBeacon||(T--,5!==u&&M.sendQueuedRequests(u,!l.isSync,l.isBeacon))}}function _addCompleteTimings(l){if(O){var d=kn();arrForEach(l,(function(l){l&&l.count()>0&&_addEventCompletedTimings(l.events(),d)}))}}function _doAction(l,d,u){d?l():h._setTimeoutOverride(l,u)}function _convertAllHeadersToMap(l){var d={};isString(l)&&arrForEach(strTrim(l).split(/[\\r\\n]+/),(function(l){if(l){var u=l.indexOf(\": \");if(-1!==u){var p=strTrim(l.substring(0,u)).toLowerCase(),h=strTrim(l.substring(u+1));d[p]=h}else d[strTrim(l)]=1}}));return d}function _getMsfpc(l){for(var d=0;d<l.batches.length;d++)for(var u=l.batches[d].events(),p=0;p<u.length;p++){var h=(u[p].ext||{}).intweb||{};if(isValueAssigned(h.msfpc))return encodeURIComponent(h.msfpc)}return\"\"}function _handleCollectorResponse(l){var d=M._responseHandlers;try{for(var u=0;u<d.length;u++)try{d[u](l)}catch(l){h.diagLog().throwInternal(rt.CRITICAL,Mn.PostResponseHandler,\"Response handler failed: \"+l)}if(l){var p=JSON.parse(l);isValueAssigned(p.webResult)&&isValueAssigned(p.webResult.msfpc)&&v.set(\"MSFPC\",p.webResult.msfpc,31536e3)}}catch(l){}}function _sendBatchesNotification(l,d,u,g){if(l&&l.length>0&&p){var f=p[_getNotificationAction(d)];f&&doPerf(m,(function(){return\"HttpManager:_sendBatchesNotification\"}),(function(){_doAction((function(){try{f.call(p,l,d,u)}catch(l){h.diagLog().throwInternal(rt.CRITICAL,Mn.NotificationException,\"send request notification failed: \"+l)}}),g||u,0)}),(function(){return{batches:_createDebugBatches(l),reason:d,isSync:u,sendSync:g}}),!u)}}function _getNotificationAction(l){var d=zo[l];return isValueAssigned(d)||(d=Vo,l>=9e3&&l<=9999?d=Bo:l>=8e3&&l<=8999?d=Fo:l>=1e3&&l<=1999&&(d=Uo)),d}M.initialize=function(l,d,u,p,S){S||(S={}),y=l+y,m=d,v=d.getCookieMgr(),O=!m.config.disableEventTimings;var _=!!m.config.enableCompoundKey;h=u;var C=S.valueSanitizer,T=S.stringifyObjects;if(isUndefined(S.enableCompoundKey)||(_=!!S.enableCompoundKey),E=!isReactNative(),P=new Io(m,C,T,_),f=_getSenderInterface([3]),!(g=p)){b=!1;var I=getLocation();I&&I.protocol&&\"file:\"===I.protocol.toLowerCase()&&(w=!1);var A=[];A=isReactNative()?[2,1]:[1,2,3];var R=S.transports;R&&(isNumber(R)?A=[R].concat(A):isArray(R)&&(A=R.concat(A))),(g=_getSenderInterface(A))||h.diagLog().warnToConsole(\"No available transport to send events\")}},M._getDbgPlgTargets=function(){return[g,S,P]},M.addQueryStringParameter=function(l,d){for(var u=0;u<I.length;u++)if(I[u].name===l)return void(I[u].value=d);I.push({name:l,value:d})},M.addHeader=function(l,d){A[l]=d},M.canSendRequest=function(){return _hasIdleConnection()&&C.allowRequestSending()},M.sendQueuedRequests=function(l,d,u){var p=!isNullOrUndefined(d)&&!d;_canSendPayload(R,p,0)&&_sendBatches(_clearQueue(),0,!1,p,l||0,!!u)},M.isCompletelyIdle=function(){return!_&&0===T&&0===R.length},M.addBatch=function(l){if(l&&l.count()>0){if(S.isTenantKilled(l.iKey()))return!1;R.push(l)}return!0},M.teardown=function(){R.length>0&&_sendBatches(_clearQueue(),0,!0,!0,2,!0)},M.pause=function(){_=!0},M.resume=function(){_=!1,M.sendQueuedRequests(4,!1)},M.sendSynchronousBatch=function(l,d,u){l&&l.count()>0&&_sendBatches([l],0,!1,!0,d||0,!!u)}}))}return HttpManager}(),Jo=.25,Qo=500,Yo=20,$o=6,Xo=4,Zo=Ln?window:void 0,ea=2,ta=1,na=\"eventsDiscarded\",ia=\"overrideInstrumentationKey\",ra=function(l){function PostChannel(){var d,u=l.call(this)||this;u.identifier=\"PostChannel\",u.priority=1011,u.version=\"3.1.2\";var p,h,g,f,m,v=!1,y=[],S=null,_=!1,C=0,E=500,T=0,b=1e4,I={},A=ho,R=null,P=null,O=0,M=0,w={},N=-1,D=!0;return dynamicProto(PostChannel,u,(function(l,u){function _addEventToQueues(l,d){if(l.sendAttempt||(l.sendAttempt=0),l.latency||(l.latency=Pn.Normal),l.ext&&l.ext.trace&&delete l.ext.trace,l.ext&&l.ext.user&&l.ext.user.id&&delete l.ext.user.id,D&&(l.ext=optimizeObject(l.ext),l.baseData&&(l.baseData=optimizeObject(l.baseData)),l.data&&(l.data=optimizeObject(l.data))),l.sync)if(O||_)l.latency=Pn.RealTime,l.sync=!1;else if(h)return D&&(l=optimizeObject(l)),void h.sendSynchronousBatch(mo.create(l.iKey,[l]),3);var u=l.latency,p=T,g=b;u===Pn.Immediate&&(p=C,g=E);var f=!1;if(p<g)f=!_addEventToProperQueue(l,d);else{var m=Pn.Normal,v=Yo;u===Pn.Immediate&&(m=Pn.Immediate,v=1),f=!0,_dropEventWithLatencyOrLess(l.iKey,l.latency,m,v)&&(f=!_addEventToProperQueue(l,d))}f&&_notifyEvents(na,[l],Be.QueueFull)}function _sendEventsForLatencyAndAbove(l,d,u,p){var g=_queueBatches(l,d,u);return h.sendQueuedRequests(d,u,p),g}function _hasEvents(){return T>0}function _scheduleTimer(){if(N>=0&&_queueBatches(N,m,!0)&&h.sendQueuedRequests(m,!0,!1),C>0&&!P&&!_){var l=I[A][2];l>=0&&(P=_createTimer((function(){P=null,_sendEventsForLatencyAndAbove(Pn.Immediate,1,!0),_scheduleTimer()}),l))}var d=I[A][1];!R&&!S&&d>=0&&!_&&(_hasEvents()?R=_createTimer((function(){R=null,_sendEventsForLatencyAndAbove(0===M?Pn.RealTime:Pn.Normal,1,!0),M++,M%=2,_scheduleTimer()}),d):M=0)}function _createTimer(d,u){0===u&&O&&(u=1);var p=1e3;return O&&(p=wo.getMillisToBackoffForRetry(O-1)),l._setTimeoutOverride(d,u*p)}function _clearScheduledTimer(){null!==R&&(l._clearTimeoutOverride(R),R=null,M=0)}function _releaseAllQueuesUsingBeacons(d,u){_clearScheduledTimer(),S&&(l._clearTimeoutOverride(S),S=null),_||_sendEventsForLatencyAndAbove(Pn.Normal,d,u,!0)}function _clearQueues(){w[Pn.Immediate]={batches:[],iKeyMap:{}},w[Pn.RealTime]={batches:[],iKeyMap:{}},w[Pn.CostDeferred]={batches:[],iKeyMap:{}},w[Pn.Normal]={batches:[],iKeyMap:{}}}function _getEventBatch(l,d,u){var p=w[d];p||(d=Pn.Normal,p=w[d]);var h=p.iKeyMap[l];return!h&&u&&(h=mo.create(l),p.batches.push(h),p.iKeyMap[l]=h),h}function _performAutoFlush(d,u){h.canSendRequest()&&!O&&(g>0&&T>g&&(u=!0),u&&null==S&&l.flush(d,null,20))}function _addEventToProperQueue(l,d){D&&(l=optimizeObject(l));var u=l.latency,p=_getEventBatch(l.iKey,u,!0);return!!p.addEvents([l],d)&&(u!==Pn.Immediate?(T++,d&&0===l.sendAttempt&&_performAutoFlush(!l.sync,f>0&&p.count()>=f)):C++,!0)}function _dropEventWithLatencyOrLess(l,d,u,p){for(;u<=d;){var h=_getEventBatch(l,d,!0);if(h&&h.count()>0){var g=h.split(0,p),f=g.count();if(f>0)return u===Pn.Immediate?C-=f:T-=f,_notifyBatchEvents(na,[g],Be.QueueFull),!0}u++}return _resetQueueCounts(),!1}function _resetQueueCounts(){for(var l=0,d=0,_loop_1=function(u){var p=w[u];p&&p.batches&&arrForEach(p.batches,(function(p){u===Pn.Immediate?l+=p.count():d+=p.count()}))},u=Pn.Normal;u<=Pn.Immediate;u++)_loop_1(u);T=d,C=l}function _queueBatches(d,u,p){var g=!1;return!p||h.canSendRequest()?doPerf(l.core,(function(){return\"PostChannel._queueBatches\"}),(function(){for(var l=[],u=Pn.Immediate;u>=d;){var p=w[u];p&&p.batches&&(arrForEach(p.batches,(function(d){h.addBatch(d)?g=g||d&&d.count()>0:l=l.concat(d.events()),u===Pn.Immediate?C-=d.count():T-=d.count()})),p.batches=[],p.iKeyMap={}),u--}l.length>0&&_notifyEvents(na,l,Be.KillSwitch),g&&N>=d&&(N=-1,m=0)}),(function(){return{latency:d,sendReason:u}}),p):(N=N>=0?Math.min(N,d):d,m=Math.max(m,u)),g}function _flushImpl(l,d){_sendEventsForLatencyAndAbove(Pn.Normal,d,!0),_waitForIdleManager((function(){l&&l(),y.length>0?S=_createTimer((function(){return _flushImpl(y.shift(),d)}),0):(S=null,_hasEvents()&&_scheduleTimer())}))}function _waitForIdleManager(l){h.isCompletelyIdle()?l():S=_createTimer((function(){_waitForIdleManager(l)}),Jo)}function _resetTransmitProfiles(){_clearScheduledTimer(),_initializeProfiles(),A=ho,_scheduleTimer()}function _initializeProfiles(){(I={})[ho]=[2,1,0],I[go]=[6,3,0],I[fo]=[18,9,0]}function _requeueEvents(d,u){var p=[];arrForEach(d,(function(d){d&&d.count()>0&&arrForEach(d.events(),(function(d){d&&(d.sync&&(d.latency=Pn.RealTime,d.sync=!1),d.sendAttempt<$o?(setProcessTelemetryTimings(d,l.identifier),_addEventToQueues(d,!1)):p.push(d))}))})),p.length>0&&_notifyEvents(na,p,Be.NonRetryableStatus)}function _callNotification(d,u){var p=l._notificationManager||{},h=p[d];if(h)try{h.apply(p,u)}catch(u){l.diagLog().throwInternal(rt.CRITICAL,Mn.NotificationException,d+\" notification failed: \"+u)}}function _notifyEvents(l,d){for(var u=[],p=2;p<arguments.length;p++)u[p-2]=arguments[p];d&&d.length>0&&_callNotification(l,[d].concat(u))}function _notifyBatchEvents(l,d){for(var u=[],p=2;p<arguments.length;p++)u[p-2]=arguments[p];d&&d.length>0&&arrForEach(d,(function(d){d&&d.count()>0&&_callNotification(l,[d.events()].concat(u))}))}function _sendingEvent(l,d,u){l&&l.length>0&&_callNotification(\"eventsSendRequest\",[d>=1e3&&d<=1999?d-1e3:0,!0!==u])}function _eventsSentEvent(l,d){_notifyBatchEvents(\"eventsSent\",l,d),_scheduleTimer()}function _eventsDropped(l,d){_notifyBatchEvents(na,l,d>=8e3&&d<=8999?d-8e3:Be.Unknown)}function _eventsResponseFail(l){_notifyBatchEvents(na,l,Be.NonRetryableStatus),_scheduleTimer()}function _otherEvent(l,d){_notifyBatchEvents(na,l,Be.Unknown),_scheduleTimer()}function _setAutoLimits(){f=d&&d.disableAutoBatchFlushLimit?0:Math.max(Qo*(ea+1),b/6)}_initializeProfiles(),_clearQueues(),_setAutoLimits(),h=new Ko(Qo,ea,ta,{requeue:_requeueEvents,send:_sendingEvent,sent:_eventsSentEvent,drop:_eventsDropped,rspFail:_eventsResponseFail,oth:_otherEvent}),l._getDbgPlgTargets=function(){return[h]},l.initialize=function(f,m,v){doPerf(m,(function(){return\"PostChannel:initialize\"}),(function(){var y=m;u.initialize(f,m,v),l.setInitialized(!1);var S=l._getTelCtx();f.extensionConfig[l.identifier]=f.extensionConfig[l.identifier]||{},d=S.getExtCfg(l.identifier),l._setTimeoutOverride=d.setTimeoutOverride?d.setTimeoutOverride:setTimeout.bind(Zo),l._clearTimeoutOverride=d.clearTimeoutOverride?d.clearTimeoutOverride:clearTimeout.bind(Zo),D=!d.disableOptimizeObj&&isChromium();var _=y.getWParam;y.getWParam=function(){var l=0;return d.ignoreMc1Ms0CookieProcessing&&(l|=2),l|_()},d.eventsLimitInMem>0&&(b=d.eventsLimitInMem),d.immediateEventLimit>0&&(E=d.immediateEventLimit),d.autoFlushEventsLimit>0&&(g=d.autoFlushEventsLimit),_setAutoLimits(),d.httpXHROverride&&d.httpXHROverride.sendPOST&&(p=d.httpXHROverride),isValueAssigned(f.anonCookieName)&&h.addQueryStringParameter(\"anoncknm\",f.anonCookieName),h.sendHook=d.payloadPreprocessor,h.sendListener=d.payloadListener;var C=d.overrideEndpointUrl?d.overrideEndpointUrl:f.endpointUrl;l._notificationManager=f.extensionConfig.NotificationManager,h.initialize(C,l.core,l,p,d),addPageUnloadEventListener((function(){_releaseAllQueuesUsingBeacons(2,!1)})),l.setInitialized(!0)}),(function(){return{coreConfig:f,core:m,extensions:v}}))},l.processTelemetry=function(u,p){setProcessTelemetryTimings(u,l.identifier);var h=(p=l._getTelCtx(p)).getExtCfg(l.identifier),g=!!d.disableTelemetry;h&&(g=g||!!h.disableTelemetry);var f=u;g||v||(d[ia]&&(f.iKey=d[ia]),h&&h[ia]&&(f.iKey=h[ia]),_addEventToQueues(f,!0),_scheduleTimer()),l.processNext(f,p)},l.setEventQueueLimits=function(l,d){b=l>0?l:1e4,g=d>0?d:0,_setAutoLimits();var u=T>l;if(!u&&f>0)for(var p=Pn.Normal;!u&&p<=Pn.RealTime;p++){var h=w[p];h&&h.batches&&arrForEach(h.batches,(function(l){l&&l.count()>=f&&(u=!0)}))}_performAutoFlush(!0,u)},l.teardown=function(){_releaseAllQueuesUsingBeacons(2,!1),v=!0,h.teardown()},l.pause=function(){_clearScheduledTimer(),_=!0,h.pause()},l.resume=function(){_=!1,h.resume(),_scheduleTimer()},l.addResponseHandler=function(l){h._responseHandlers.push(l)},l._loadTransmitProfiles=function(l){_resetTransmitProfiles(),objForEachKey(l,(function(l,d){var u=d.length;if(u>=2){var p=u>2?d[2]:0;if(d.splice(0,u-2),d[1]<0&&(d[0]=-1),d[1]>0&&d[0]>0){var h=d[0]/d[1];d[0]=Math.ceil(h)*d[1]}p>=0&&d[1]>=0&&p>d[1]&&(p=d[1]),d.push(p),I[l]=d}}))},l.flush=function(l,d,u){void 0===l&&(l=!0),_||(_clearScheduledTimer(),u=u||1,l?(_queueBatches(Pn.Normal,u,l),_resetQueueCounts(),null==S?S=_createTimer((function(){_flushImpl(d,u)}),0):y.push(d)):(_sendEventsForLatencyAndAbove(Pn.Normal,u,!1),null!=d&&d()))},l.setMsaAuthTicket=function(l){h.addHeader(\"AuthMsaDeviceTicket\",l)},l.hasEvents=_hasEvents,l._setTransmitProfile=function(l){A!==l&&void 0!==I[l]&&(_clearScheduledTimer(),A=l,_scheduleTimer())},l._backOffTransmission=function(){O<Xo&&(O++,_clearScheduledTimer(),_scheduleTimer())},l._clearBackOff=function(){O&&(O=0,_clearScheduledTimer(),_scheduleTimer())}})),u}return __extendsFn(PostChannel,l),PostChannel}(Wt),oa=[\"AX\",\"EX\",\"SF\",\"CS\",\"CF\",\"CT\",\"CU\",\"DC\",\"DF\",\"H5\",\"HL\",\"WS\",\"WP\"];function _validateAppExpId(l,d){void 0===d&&(d=oa);var u=null;if(l)for(var p=l.split(\",\"),h=0;h<p.length;h++)_isValidAppFlightId(p[h],d)&&(u?u+=\",\"+p[h]:u=p[h]);return u}function _isValidAppFlightId(l,d){if(void 0===d&&(d=oa),!l||l.length<4)return!1;for(var u=!1,p=256,h=l.substring(0,3).toString().toUpperCase(),g=0;g<d.length;g++)if(d[g]+\":\"===h&&l.length<=p){u=!0;break}return u}var aa=function(){function Application(l,d){this.core=d,this.appExpId=null,this.flightIdNameSpaces=oa.slice(0),this.expIdCookieName=\"Treatments\",this._cookieMgr=safeGetCookieMgr(d),this._propertiesConfig=l;var u=getDocument();if(u){var p=u.documentElement;u&&(this.locale=p.lang)}this.env=l.env?l.env:this._getMetaDataFromDOM(\"awa-\").env}return Application.prototype.getExpId=function(){return this._propertiesConfig.expId?this._readExpIdFromCoreData(this._propertiesConfig.expId):this._readExpIdFromCookie()},Application.prototype._getMetaDataFromDOM=function(l){var d,u={},p=getDocument();if(p){d=p&&p.querySelectorAll(\"meta\");for(var h=0;h<d.length;h++){var g=d[h];if(g.name)if(0===g.name.toLowerCase().indexOf(l))u[g.name.replace(l,\"\")]=g.content}}return u},Application.prototype._setAppExpId=function(l){l!==this.appExpId&&(this.appExpId=_validateAppExpId(l,this.flightIdNameSpaces))},Application.prototype._getAppExpId=function(){return this.appExpId},Application.prototype._readExpIdFromCookie=function(){var l=getCookieValue(this._cookieMgr,this.expIdCookieName);return this._setAppExpId(l),this._getAppExpId()},Application.prototype._readExpIdFromCoreData=function(l){return this._setAppExpId(l),this._getAppExpId()},Application.validateAppExpId=_validateAppExpId,Application._staticInit=void objDefineAccessors(Application.prototype,\"expId\",Application.prototype.getExpId),Application}(),sa=function(){function Cloud(){}return Cloud}(),ca=function(){function User(l,d,u){this.core=u;var p=this._cookieMgr=safeGetCookieMgr(u,l);if(p&&p.isEnabled()){var h=getCookieValue(p,\"MUID\");if(h&&this.setLocalId(\"t:\"+h),d.enableApplicationInsightsUser){var g=getCookieValue(p,User.userCookieName);if(g){var f=g.split(User.cookieSeparator);f.length>0&&(this.id=f[0])}if(!this.id){this.id=newId(l&&!isUndefined(l.idLength)?l.idLength:22);var m=toISOString(new Date);this.accountAcquisitionDate=m;var v=[this.id,m],y=d.cookieDomain?d.cookieDomain:void 0;p.set(User.userCookieName,v.join(User.cookieSeparator),31536e3,y)}}}if(\"undefined\"!=typeof navigator){var S=navigator;this.locale=S.userLanguage||S.language}}return User.prototype.getLocalId=function(){if(this._customLocalId)return this._customLocalId;var l=getCookieValue(this._cookieMgr,\"MUID\");l&&this.setLocalId(\"t:\"+l)},User.prototype.setLocalId=function(l){this._customLocalId=l},User.cookieSeparator=\"|\",User.userCookieName=\"ai_user\",User._staticInit=void objDefineAccessors(User.prototype,\"localId\",User.prototype.getLocalId,User.prototype.setLocalId),User}(),la={MSIE:\"MSIE\",CHROME:\"Chrome\",FIREFOX:\"Firefox\",SAFARI:\"Safari\",EDGE:\"Edge\",ELECTRON:\"Electron\",SKYPE_SHELL:\"SkypeShell\",PHANTOMJS:\"PhantomJS\",OPERA:\"Opera\"},da=\"([\\\\d,.]+)\",ua=\"Unknown\",pa=\"Edg/\",ha=function(){function Web(l,d){this._cookieMgr=safeGetCookieMgr(d),this._propertiesConfig=l;var u=getLocation();if(u){var p=u.hostname;p&&(this.domain=\"file:\"===u.protocol?\"local\":p)}var h=\"undefined\"!=typeof navigator?navigator.userAgent:\"\";if(l.userAgent&&(h=l.userAgent),l.populateBrowserInfo){if(h){var g=this._getBrowserName(h);this.browser=g,this.browserVer=this._getBrowserVersion(h,g)}var f=this._getScreenResolution();this.screenRes=f.w+\"X\"+f.h}}return Web.prototype.getUserConsent=function(){return this._propertiesConfig.userConsented||!!getCookieValue(this._cookieMgr,this._propertiesConfig.userConsentCookieName||\"MSCC\")},Web.prototype.getUserConsentDetails=function(){try{if(this._propertiesConfig.callback&&this._propertiesConfig.callback.userConsentDetails){var l=this._propertiesConfig.callback.userConsentDetails();if(l)return JSON.stringify({Required:!!l.Required&&l.Required,Analytics:!!l.Analytics&&l.Analytics,SocialMedia:!!l.SocialMedia&&l.SocialMedia,Advertising:!!l.Advertising&&l.Advertising})}}catch(l){}return null},Web.prototype._getBrowserName=function(l){return this._userAgentContainsString(\"OPR/\",l)?la.OPERA:this._userAgentContainsString(la.PHANTOMJS,l)?la.PHANTOMJS:this._userAgentContainsString(la.EDGE,l)||this._userAgentContainsString(pa,l)?la.EDGE:this._userAgentContainsString(la.ELECTRON,l)?la.ELECTRON:this._userAgentContainsString(la.CHROME,l)?la.CHROME:this._userAgentContainsString(\"Trident\",l)?la.MSIE:this._userAgentContainsString(la.FIREFOX,l)?la.FIREFOX:this._userAgentContainsString(la.SAFARI,l)?la.SAFARI:this._userAgentContainsString(la.SKYPE_SHELL,l)?la.SKYPE_SHELL:ua},Web.prototype._userAgentContainsString=function(l,d){return d.indexOf(l)>-1},Web.prototype._getBrowserVersion=function(l,d){return d===la.MSIE?this._getIeVersion(l):this._getOtherVersion(d,l)},Web.prototype._getIeVersion=function(l){var d=l.match(new RegExp(la.MSIE+\" \"+da));if(d)return d[1];var u=l.match(new RegExp(\"rv:\"+da));return u?u[1]:void 0},Web.prototype._getOtherVersion=function(l,d){l===la.SAFARI?l=\"Version\":l===la.EDGE&&this._userAgentContainsString(pa,d)&&(l=\"Edg\");var u=d.match(new RegExp(l+\"/\"+da));return u?u[1]:ua},Web.prototype._getScreenResolution=function(){var l={h:0,w:0},d=getWindow();return d&&d.screen&&(l.h=screen.height,l.w=screen.width),l},Web._staticInit=void objDefineAccessors(Web.prototype,\"userConsent\",Web.prototype.getUserConsent),Web}(),ga={WINDOWS:\"Windows\",MACOSX:\"Mac OS X\",ANDROID:\"Android\",IOS:\"iOS\"},fa={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\\sphone\\s\\d+\\.\\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},ma={5.1:\"XP\",\"6.0\":\"Vista\",6.1:\"7\",6.2:\"8\",6.3:\"8.1\",\"10.0\":\"10\"},va=\"([\\\\d,.]+)\",ya=\"([\\\\d,_,.]+)\",Sa=\"Unknown\",_a=function(){function OperatingSystem(l){var d=\"undefined\"!=typeof navigator?navigator.userAgent:\"\";if(l.userAgent&&(d=l.userAgent),d&&l.populateOperatingSystemInfo){var u=this._getOsName(d.toLowerCase());this.name=u,this.ver=this._getOsVersion(d,u)}}return OperatingSystem.prototype._getOsName=function(l){return l.match(fa.WINPHONE)?\"Windows Phone\":l.match(fa.WINRT)?\"Windows RT\":l.match(fa.WIN)?ga.WINDOWS:l.match(fa.IOS)?ga.IOS:l.match(fa.ANDROID)?ga.ANDROID:l.match(fa.LINUX)?\"Linux\":l.match(fa.CROS)?\"Chrome OS\":-1!==l.indexOf(\"x11\")?\"Unix\":-1!==l.indexOf(\"blackberry\")?\"BlackBerry\":-1!==l.indexOf(\"symbian\")?\"Symbian\":-1!==l.indexOf(\"nokia\")?\"Nokia\":l.match(fa.OSX)?ga.MACOSX:Sa},OperatingSystem.prototype._getOsVersion=function(l,d){return d===ga.WINDOWS?this._getGenericOsVersion(l,\"Windows NT\"):d===ga.ANDROID?this._getGenericOsVersion(l,d):d===ga.MACOSX?this._getMacOsxVersion(l):d===ga.IOS?this._getIosVersion(l):Sa},OperatingSystem.prototype._getGenericOsVersion=function(l,d){var u=l.match(new RegExp(d+\" \"+va));return u?ma[u[1]]?ma[u[1]]:u[1]:Sa},OperatingSystem.prototype._getMacOsxVersion=function(l){var d=l.match(new RegExp(ga.MACOSX+\" \"+ya));if(d){var u=d[1].replace(/_/g,\".\");if(u){var p=this._getDelimiter(u);return p?u.split(p)[0]:u}}return Sa},OperatingSystem.prototype._getIosVersion=function(l){var d=l.match(new RegExp(\"OS \"+ya));if(d){var u=d[1].replace(/_/g,\".\");if(u){var p=this._getDelimiter(u);return p?u.split(p)[0]:u}}return Sa},OperatingSystem.prototype._getDelimiter=function(l){return l.indexOf(\".\")>-1?\".\":l.indexOf(\"_\")>-1?\"_\":null},OperatingSystem}(),Ca=function(){function IntWeb(l,d){this.core=d,l.serviceName&&(this.serviceName=l.serviceName),this._cookieMgr=safeGetCookieMgr(d)}return IntWeb.prototype.getMsfpc=function(){return getCookieValue(this._cookieMgr,\"MSFPC\")},IntWeb.prototype.getAnid=function(){return getCookieValue(this._cookieMgr,\"ANON\").slice(0,34)},IntWeb._staticInit=(objDefineAccessors(IntWeb.prototype,\"msfpc\",IntWeb.prototype.getMsfpc),void objDefineAccessors(IntWeb.prototype,\"anid\",IntWeb.prototype.getAnid)),IntWeb}(),Ea=1048576,Ta=2097152,ba=function(){function Utc(l){this.popSample=100,this.eventFlags=0,l.hashIdentifiers&&(this.eventFlags=this.eventFlags|Ea),l.dropIdentifiers&&(this.eventFlags=this.eventFlags|Ta)}return Utc}(),Ia=function(){function Loc(){var l=(new Date).getTimezoneOffset(),d=l%60,u=(l-d)/60,p=\"+\";u>0&&(p=\"-\"),u=Math.abs(u),d=Math.abs(d),this.tz=p+(u<10?\"0\"+u:u.toString())+\":\"+(d<10?\"0\"+d:d.toString())}return Loc}(),Aa=function(){function Device(){}return Device}(),Ra=function(){function Session(){}return Session.prototype.setId=function(l){this.customId=l},Session.prototype.getId=function(){return isString(this.customId)?this.customId:this.automaticId},Session._staticInit=void objDefineAccessors(Session.prototype,\"id\",Session.prototype.getId,Session.prototype.setId),Session}(),Pa=function(){function Trace(l,d,u,p){if(l.enableApplicationInsightsTrace){this.traceId=d||generateW3CId(),this.parentId=u,this.name=p;var h=getLocation();h&&h.pathname&&(this.name=h.pathname)}}return Trace}(),Oa=function(){function AppExtensionKeys(){}return AppExtensionKeys.id=\"id\",AppExtensionKeys.ver=\"ver\",AppExtensionKeys.appName=\"name\",AppExtensionKeys.locale=\"locale\",AppExtensionKeys.expId=\"expId\",AppExtensionKeys.env=\"env\",AppExtensionKeys}(),Ma=function(){function WebExtensionKeys(){}return WebExtensionKeys.domain=\"domain\",WebExtensionKeys.browser=\"browser\",WebExtensionKeys.browserVer=\"browserVer\",WebExtensionKeys.screenRes=\"screenRes\",WebExtensionKeys.userConsent=\"userConsent\",WebExtensionKeys.consentDetails=\"consentDetails\",WebExtensionKeys}(),wa=function(){function UserExtensionKeys(){}return UserExtensionKeys.locale=\"locale\",UserExtensionKeys.localId=\"localId\",UserExtensionKeys.id=\"id\",UserExtensionKeys}(),Na=function(){function OSExtKeys(){}return OSExtKeys.osName=\"name\",OSExtKeys.ver=\"ver\",OSExtKeys}(),Da=function(){function SDKExtKeys(){}return SDKExtKeys.ver=\"ver\",SDKExtKeys.seq=\"seq\",SDKExtKeys.installId=\"installId\",SDKExtKeys.epoch=\"epoch\",SDKExtKeys}(),La=function(){function IntWebExtKeys(){}return IntWebExtKeys.msfpc=\"msfpc\",IntWebExtKeys.anid=\"anid\",IntWebExtKeys.serviceName=\"serviceName\",IntWebExtKeys}(),ka=function(){function UtcExtKeys(){}return UtcExtKeys.popSample=\"popSample\",UtcExtKeys.eventFlags=\"eventFlags\",UtcExtKeys}(),xa=function(){function LocExtKeys(){}return LocExtKeys.tz=\"tz\",LocExtKeys}(),Fa=function(){function SessionExtKeys(){}return SessionExtKeys.sessionId=\"sesId\",SessionExtKeys}(),Ua=function(){function DeviceExtKeys(){}return DeviceExtKeys.localId=\"localId\",DeviceExtKeys.deviceClass=\"deviceClass\",DeviceExtKeys.make=\"make\",DeviceExtKeys.model=\"model\",DeviceExtKeys}(),ja=function(){function CloudExtKeys(){}return CloudExtKeys.role=\"role\",CloudExtKeys.roleInstance=\"roleInstance\",CloudExtKeys.roleVer=\"roleVer\",CloudExtKeys}(),Ba=function(){function TraceExtKeys(){}return TraceExtKeys.traceId=\"traceID\",TraceExtKeys.traceName=\"name\",TraceExtKeys.parentId=\"parentID\",TraceExtKeys}(),Va=function(){function Extensions(){}return Extensions.UserExt=\"user\",Extensions.DeviceExt=\"device\",Extensions.TraceExt=\"trace\",Extensions.WebExt=\"web\",Extensions.AppExt=\"app\",Extensions.OSExt=\"os\",Extensions.SdkExt=\"sdk\",Extensions.IntWebExt=\"intweb\",Extensions.UtcExt=\"utc\",Extensions.LocExt=\"loc\",Extensions.CloudExt=\"cloud\",Extensions}(),Ha=\"MicrosoftApplicationsTelemetryDeviceId\";function _saveData(l,d,u,p){d?d.setProperty(u,p):l.set(u,p,31536e3)}function _getData(l,d,u){return d?d.getProperty(u)||\"\":getCookieValue(l,u)}var Ga,Wa,qa=function(){function Sdk(l,d){this._sequenceId=0;var u=l.propertyStorageOverride;this.seq=this._sequenceId,this.epoch=random32(!1).toString();var p=safeGetCookieMgr(d,l);if(p.isEnabled()||u){var h=_getData(p,u,Ha);h||(h=newGuid()),_saveData(p,u,Ha,h),this.installId=h}else p.purge(Ha)}return Sdk.prototype.getSequenceId=function(){return++this._sequenceId},Sdk}();function canUseLocalStorage(){return void 0===Ga&&(Ga=!!_getVerifiedStorageObject(Wa.LocalStorage)),Ga}function _getLocalStorageObject(){return canUseLocalStorage()?_getVerifiedStorageObject(Wa.LocalStorage):null}function _getVerifiedStorageObject(l){var d,u,p=null;try{var h=getGlobal();if(!h)return null;u=new Date,(p=l===Wa.LocalStorage?h.localStorage:h.sessionStorage)&&isFunction(p.setItem)&&(p.setItem(u,u),d=p.getItem(u)!==u,p.removeItem(u),d&&(p=null))}catch(l){p=null}return p}function setStorage(l,d,u){var p=_getLocalStorageObject();if(null!==p)try{return p.setItem(d,u),!0}catch(d){Ga=!1,l.throwInternal(rt.CRITICAL,Mn.BrowserCannotWriteLocalStorage,\"Browser failed write to local storage. \"+d)}return!1}function getStorage(l,d){var u=_getLocalStorageObject();if(null!==u)try{return u.getItem(d)}catch(d){Ga=!1,l.throwInternal(rt.CRITICAL,Mn.BrowserCannotReadLocalStorage,\"Browser failed read of local storage. \"+d)}return null}!function(l){l[l.LocalStorage=0]=\"LocalStorage\",l[l.SessionStorage=1]=\"SessionStorage\"}(Wa||(Wa={}));var za,Ka,Ja,Qa,Ya,$a,Xa,Za,es,ts,ns,is,rs,os,as,ss,cs,ls=function(){function SessionManager(l,d){var u,p,h=safeGetLogger(l),g=safeGetCookieMgr(l);dynamicProto(SessionManager,this,(function(l){var f=getDefaultConfig(d);function getDefaultConfig(l){return{sessionRenewalMs:l.sessionRenewalMs&&function(){return l.sessionRenewalMs},sessionExpirationMs:l.sessionExpirationMs&&function(){return l.sessionExpirationMs},cookieDomain:l.cookieDomain&&function(){return l.cookieDomain},namePrefix:l.namePrefix&&function(){return l.namePrefix},sessionAsGuid:function(){return l.sessionAsGuid},idLength:function(){return l.idLength?l.idLength:22}}}function _initializeAutomaticSession(){var d=getCookie(p());if(d&&isFunction(d.split))_initializeAutomaticSessionWithData(d);else{var u=getStorage(h,p());u&&_initializeAutomaticSessionWithData(u)}l.automaticSession.getId()||_renew()}function _initializeAutomaticSessionWithData(d){var u=l.automaticSession,p=d.split(\"|\");p.length>0&&u.setId(p[0]);try{if(p.length>1){var g=+p[1];u.acquisitionDate=+new Date(g),u.acquisitionDate=u.acquisitionDate>0?u.acquisitionDate:0}if(p.length>2){var f=+p[2];u.renewalDate=+new Date(f),u.renewalDate=u.renewalDate>0?u.renewalDate:0}}catch(l){h.throwInternal(rt.CRITICAL,Mn.ErrorParsingAISessionCookie,\"Error parsing ai_session cookie, session will be reset: \"+l)}0===u.renewalDate&&h.throwInternal(rt.WARNING,Mn.SessionRenewalDateIsZero,\"AI session renewal date is 0, session will be reset.\")}function _renew(){var d=l.automaticSession,u=(new Date).getTime(),p=l.config.sessionAsGuid();!isUndefined(p)&&p?isBoolean(p)?d.setId(createGuid()):d.setId(createGuid(p)):d.setId(newId(f&&f.idLength?f.idLength():22)),d.acquisitionDate=u,d.renewalDate=u,_setCookie(d.getId(),d.acquisitionDate,d.renewalDate),canUseLocalStorage()||h.throwInternal(rt.WARNING,Mn.BrowserDoesNotSupportLocalStorage,\"Browser does not support local storage. Session durations will be inaccurate.\")}function _setCookie(d,h,f){var m=h+l.config.sessionExpirationMs(),v=f+l.config.sessionRenewalMs(),y=new Date,S=[d,h,f];m<v?y.setTime(m):y.setTime(v);var _=l.config.cookieDomain?l.config.cookieDomain():null;g.set(p(),S.join(\"|\")+\";expires=\"+y.toUTCString(),null,_),u=(new Date).getTime()}function _setStorage(l,d,u){setStorage(h,p(),[l,d,u].join(\"|\"))}isFunction(d.sessionExpirationMs)||(f.sessionExpirationMs=function(){return SessionManager.acquisitionSpan}),isFunction(d.sessionRenewalMs)||(f.sessionRenewalMs=function(){return SessionManager.renewalSpan}),l.config=f,p=function(){return l.config.namePrefix&&l.config.namePrefix()?SessionManager.cookieNameConst+l.config.namePrefix():SessionManager.cookieNameConst},l.automaticSession=new Ra,l.update=function(){l.automaticSession.getId()||_initializeAutomaticSession();var d=l.automaticSession,p=l.config,h=(new Date).getTime(),g=h-d.acquisitionDate>p.sessionExpirationMs(),f=h-d.renewalDate>p.sessionRenewalMs();if(g||f)_renew();else{(!u||h-u>SessionManager.cookieUpdateInterval)&&(d.renewalDate=h,_setCookie(d.getId(),d.acquisitionDate,d.renewalDate))}},l.backup=function(){var d=l.automaticSession;_setStorage(d.getId(),d.acquisitionDate,d.renewalDate)}}))}return SessionManager.acquisitionSpan=864e5,SessionManager.renewalSpan=18e5,SessionManager.cookieUpdateInterval=6e4,SessionManager.cookieNameConst=\"ai_session\",SessionManager}(),ds=isString,us=function(){function TelemetryContext(l,d,u){this.app=new aa(d,u),this.cloud=new sa,this.user=new ca(l,d,u),this.os=new _a(d),this.web=new ha(d,u),this.sdk=new qa(l,u),this.intWeb=new Ca(d,u),this.utc=new ba(d),this.loc=new Ia,this.device=new Aa,this.telemetryTrace=new Pa(d),this.sessionManager=new ls(u,d),this.session=new Ra}return TelemetryContext.prototype.getSessionId=function(){var l=this.session;if(l&&ds(l.customId))return l.customId;var d=this.sessionManager;d.update();var u=d.automaticSession;if(u){var p=u.getId();p&&ds(p)&&(l.automaticId=p)}return l.automaticId},TelemetryContext.prototype.applyApplicationContext=function(l){var d=this.app;ds(d.id)&&(l.ext[Va.AppExt][Oa.id]=d.id),ds(d.ver)&&(l.ext[Va.AppExt][Oa.ver]=d.ver),ds(d.name)&&(l.ext[Va.AppExt][Oa.appName]=d.name),ds(d.locale)&&(l.ext[Va.AppExt][Oa.locale]=d.locale);var u=d.getExpId();ds(u)&&(l.ext[Va.AppExt][Oa.expId]=u),ds(d.env)&&(l.ext[Va.AppExt][Oa.env]=d.env)},TelemetryContext.prototype.applyUserContext=function(l){var d=this.user,u=d.getLocalId();ds(u)&&(l.ext[Va.UserExt][wa.localId]=u),ds(d.locale)&&(l.ext[Va.UserExt][wa.locale]=d.locale),ds(d.id)&&(l.ext[Va.UserExt][wa.id]=d.id)},TelemetryContext.prototype.applyWebContext=function(l){var d=this.web;ds(d.domain)&&(l.ext[Va.WebExt][Ma.domain]=d.domain),ds(d.browser)&&(l.ext[Va.WebExt][Ma.browser]=d.browser),ds(d.browserVer)&&(l.ext[Va.WebExt][Ma.browserVer]=d.browserVer),ds(d.screenRes)&&(l.ext[Va.WebExt][Ma.screenRes]=d.screenRes),l.ext[Va.WebExt][Ma.userConsent]=d.getUserConsent(),l.ext[Va.WebExt][Ma.consentDetails]=d.getUserConsentDetails()},TelemetryContext.prototype.applyOsContext=function(l){var d=this.os;ds(d.name)&&(l.ext[Va.OSExt][Na.osName]=d.name),ds(d.ver)&&(l.ext[Va.OSExt][Na.ver]=d.ver)},TelemetryContext.prototype.applySdkContext=function(l){var d=this.sdk;l.ext[Va.SdkExt][Da.seq]=d.getSequenceId(),l.ext[Va.SdkExt][Da.epoch]=d.epoch,ds(d.installId)&&(l.ext[Va.SdkExt][Da.installId]=d.installId)},TelemetryContext.prototype.applyIntWebContext=function(l){var d=this.intWeb,u=d.getMsfpc();ds(u)&&(l.ext[Va.IntWebExt][La.msfpc]=u);var p=d.getAnid();ds(p)&&(l.ext[Va.IntWebExt][La.anid]=p),ds(d.serviceName)&&(l.ext[Va.IntWebExt][La.serviceName]=d.serviceName)},TelemetryContext.prototype.applyUtcContext=function(l){var d=this.utc;l.ext[Va.UtcExt][ka.popSample]=d.popSample,d.eventFlags>0&&(l.ext[Va.UtcExt][ka.eventFlags]=d.eventFlags)},TelemetryContext.prototype.applyLocContext=function(l){l.ext[Va.LocExt][xa.tz]=this.loc.tz},TelemetryContext.prototype.applySessionContext=function(l){l.ext[Va.AppExt][Fa.sessionId]=this.getSessionId()},TelemetryContext.prototype.applyDeviceContext=function(l){var d=this.device;ds(d.localId)&&(l.ext[Va.DeviceExt][Ua.localId]=d.localId),ds(d.make)&&(l.ext[Va.DeviceExt][Ua.make]=d.make),ds(d.model)&&(l.ext[Va.DeviceExt][Ua.model]=d.model),ds(d.deviceClass)&&(l.ext[Va.DeviceExt][Ua.deviceClass]=d.deviceClass)},TelemetryContext.prototype.applyCloudContext=function(l){var d=this.cloud;ds(d.role)&&(l.ext[Va.CloudExt][ja.role]=d.role),ds(d.roleInstance)&&(l.ext[Va.CloudExt][ja.roleInstance]=d.roleInstance),ds(d.roleVer)&&(l.ext[Va.CloudExt][ja.roleVer]=d.roleVer)},TelemetryContext.prototype.applyAITraceContext=function(l){var d=this.telemetryTrace;ds(d.traceId)&&(l.ext[Va.TraceExt][Ba.traceId]=d.traceId),ds(d.name)&&(l.ext[Va.TraceExt][Ba.traceName]=d.name),ds(d.parentId)&&(l.ext[Va.TraceExt][Ba.parentId]=d.parentId)},TelemetryContext}(),ps=function(l){function PropertiesPlugin(){var d,u=l.call(this)||this;u.identifier=\"SystemPropertiesCollector\",u.priority=3,u.version=\"3.1.2\";var p={};return dynamicProto(PropertiesPlugin,u,(function(h,g){function _addPropertiesIfAbsent(l,d){l&&objForEachKey(l,(function(l,u){d[l]||(d[l]=u)}))}h.initialize=function(p,g,f){l.prototype.initialize.call(u,p,g,f),d=new us(p,h._getTelCtx().getExtCfg(h.identifier),g)},h.processTelemetry=function(l,u){setProcessTelemetryTimings(l,h.identifier),u=h._getTelCtx(u);var g=l.ext=l.ext?l.ext:{};l.data=l.data?l.data:{},g[Va.AppExt]=g[Va.AppExt]||{},g[Va.UserExt]=g[Va.UserExt]||{},g[Va.WebExt]=g[Va.WebExt]||{},g[Va.OSExt]=g[Va.OSExt]||{},g[Va.SdkExt]=g[Va.SdkExt]||{},g[Va.IntWebExt]=g[Va.IntWebExt]||{},g[Va.UtcExt]=g[Va.UtcExt]||{},g[Va.LocExt]=g[Va.LocExt]||{},g[Va.DeviceExt]=g[Va.DeviceExt]||{},g[Va.TraceExt]=g[Va.TraceExt]||{},g[Va.CloudExt]=g[Va.CloudExt]||{},d.applyApplicationContext(l),d.applyUserContext(l),d.applyWebContext(l),d.applyOsContext(l),d.applySdkContext(l),d.applyIntWebContext(l),d.applyUtcContext(l),d.applyLocContext(l),d.applySessionContext(l),d.applyDeviceContext(l),d.applyAITraceContext(l),d.applyCloudContext(l),arrForEach(objKeys(g),(function(l){0===objKeys(g[l]).length&&delete g[l]})),_addPropertiesIfAbsent(p,l.data),h.processNext(l,u)},h.getPropertiesContext=function(){return d},h.setProperty=function(l,d){p[l]=d}})),u}return __extendsFn(PropertiesPlugin,l),PropertiesPlugin}(Wt);function getMriFromIdentifier(l){const d=u.getIdentifierKind(l);switch(d.kind){case\"communicationUser\":return d.communicationUserId;case\"phoneNumber\":if(d.rawId)return`${d.rawId}`;if(d.phoneNumber)return`${oe}${d.phoneNumber}`;throw new CallingCommunicationError({message:\"Unable to parse PhoneNumberIdentifier object\",code:be});case\"microsoftTeamsUser\":if(d.rawId)return d.rawId;if(d.microsoftTeamsUserId){if(d.isAnonymous)return`${de}${d.microsoftTeamsUserId}`;if(\"public\"===d.cloud)return`${se}${d.microsoftTeamsUserId}`;if(\"dod\"===d.cloud)return`${ce}${d.microsoftTeamsUserId}`;if(\"gcch\"===d.cloud)return`${le}${d.microsoftTeamsUserId}`;if(!d.cloud)return`${se}${d.microsoftTeamsUserId}`}throw new CallingCommunicationError({message:\"Unable to parse MicrosoftTeamsUserIdentifier object\",code:be});case\"unknown\":return d.id;default:throw new CallingCommunicationError({message:\"Unable to parse Identifier object, please check the syntax\",code:be})}}function constructIdentifierKindFromMri(l){return l.startsWith(se)?{kind:\"microsoftTeamsUser\",rawId:l,microsoftTeamsUserId:l.substring(8),isAnonymous:!1,cloud:\"public\"}:l.startsWith(ce)?{kind:\"microsoftTeamsUser\",rawId:l,microsoftTeamsUserId:l.substring(6),isAnonymous:!1,cloud:\"dod\"}:l.startsWith(le)?{kind:\"microsoftTeamsUser\",rawId:l,microsoftTeamsUserId:l.substring(7),isAnonymous:!1,cloud:\"gcch\"}:l.startsWith(de)?{kind:\"microsoftTeamsUser\",rawId:l,microsoftTeamsUserId:l.substring(15),isAnonymous:!0}:l.startsWith(oe)?{kind:\"phoneNumber\",rawId:l,phoneNumber:l.substring(2)}:l.startsWith(ue)||l.startsWith(pe)||l.startsWith(ge)||l.startsWith(he)?{kind:\"communicationUser\",communicationUserId:l}:{kind:\"unknown\",id:l}}function isCallingApplication(l){return!!l.startsWith(re)}function validateIdentifier(l){const d=u.getIdentifierKind(l);switch(d.kind){case\"communicationUser\":if(!(d.communicationUserId.startsWith(ue)||d.communicationUserId.startsWith(pe)||d.communicationUserId.startsWith(ge)||d.communicationUserId.startsWith(he)))throw new CallingCommunicationError({message:\"Invalid CommunicationUser identifier specified\",code:be});return;case\"phoneNumber\":return;case\"microsoftTeamsUser\":if(d.rawId&&!d.rawId.startsWith(se)&&!d.rawId.startsWith(ce)&&!d.rawId.startsWith(le)&&!d.rawId.startsWith(de))throw new CallingCommunicationError({message:\"Invalid MicrosoftTeamsUser rawId specified\",code:be});if(!d.microsoftTeamsUserId)throw new CallingCommunicationError({message:\"Invalid MicrosoftTeamsUser microsoftTeamsUserId specified\",code:be});return;case\"unknown\":if(!d.id)throw new CallingCommunicationError({message:\"Invalid identifier specified, please specify an id\",code:be});return;default:throw new CallingCommunicationError({message:\"Unable to parse Identifier object\",code:be})}}function assertIsArrayOfIdentifiers(l,d){if(!(l instanceof Array))throw new CallingCommunicationError({message:\"AssertIsArrayOfIdentifiers failed. \"+(void 0!==d?`: ${d}`:\"\"),code:be})}function getCloudTypeFromSkypeId(l){const d=l.substring(0,l.indexOf(\":\"));if(!d)throw new CallingCommunicationError({message:\"No cloud prefix found in identity\",code:Ee});switch(d){case zn.OrgId:case zn.Acs:case zn.Spool:return qn.Public;case zn.GccHigh:case zn.GccHighAcs:return qn.GccHigh;case zn.Dod:case zn.DodAcs:return qn.Dod;case zn.AirGap08:case zn.AirGap08Acs:return qn.AirGap08;case zn.AirGap09:case zn.AirGap09Acs:return qn.AirGap09;default:return qn.Public}}!function(l){l.Outgoing=\"Outgoing\",l.Incoming=\"Incoming\",l.TransferOutgoing=\"TransferOutgoing\"}(za||(za={})),function(l){l.CreateCallAgent=\"CreateCallAgent\",l.GetDeviceManager=\"GetDeviceManager\",l.GetSDKVersion=\"GetSDKVersion\",l.GetEnvironmentInfo=\"GetEnvironmentInfo\"}(Ka||(Ka={})),function(l){l.StartCall=\"StartCall\",l.Join=\"Join\",l.HandlePushNotifications=\"HandlePushNotification\",l.Initialize=\"Initialize\",l.Dispose=\"Dispose\",l.CreateCall=\"CreateCall\"}(Ja||(Ja={})),function(l){l.Call=\"Call\",l.StartCall=\"StartCall\",l.CallGroup=\"CallGroup\",l.JoinGroup=\"JoinGroup\",l.Accept=\"Accept\",l.Reject=\"Reject\",l.Mute=\"Mute\",l.Unmute=\"Unmute\",l.MuteIncomingAudio=\"MuteIncomingAudio\",l.UnmuteIncomingAudio=\"UnmuteIncomingAudio\",l.SendDtmf=\"SendDtmf\",l.HangUp=\"HangUp\",l.StartVideo=\"StartVideo\",l.startAudio=\"startAudio\",l.StopVideo=\"StopVideo\",l.AddParticipant=\"AddParticipant\",l.RemoveParticipant=\"RemoveParticipant\",l.Hold=\"Hold\",l.Resume=\"Resume\",l.StartScreenShare=\"StartScreenShare\",l.StopScreenShare=\"StopScreenShare\",l.Transfer=\"Transfer\",l.BindToCall=\"BindToCall\"}(Qa||(Qa={})),function(l){l.GetServerCallId=\"GetServerCallId\"}(Ya||(Ya={})),function(l){l.CreateStackBase=\"CreateStackBase\",l.GetDeviceManager=\"GetDeviceManager\",l.InitializeStackForUser=\"InitializeStackForUser\",l.InitializeEcsBase=\"InitializeEcsBase\",l.InitializeEcsForUser=\"InitializeEcsForUser\",l.Dispose=\"Dispose\"}($a||($a={})),function(l){l.GetDeviceManager=\"GetDeviceManager\",l.GetCameras=\"GetCameras\",l.GetMicrophones=\"GetMicrophones\",l.GetSpeakers=\"GetSpeakers\",l.GetCamera=\"GetCamera\",l.SelectCamera=\"SelectCamera\",l.GetSelectedMicrophone=\"GetSelectedMicrophone\",l.SelectMicrophone=\"SelectMicrophone\",l.GetSelectedSpeaker=\"GetSelectedSpeaker\",l.SelectSpeaker=\"SelectSpeaker\",l.RenderPreviewVideo=\"RenderPreviewVideo\",l.AskDevicePermission=\"AskDevicePermission\"}(Xa||(Xa={})),function(l){l.Dispose=\"Dispose\",l.UpdateScalingMode=\"UpdateScalingMode\",l.Render=\"Render\",l.RenderRemoteStream=\"RenderRemoteStream\",l.RenderLocalStream=\"RenderLocalStream\"}(Za||(Za={})),function(l){l.Dispose=\"Dispose\",l.CreateView=\"CreateView\"}(es||(es={})),function(l){l.SwitchSource=\"SwitchSource\",l.Render=\"Render\"}(ts||(ts={})),function(l){l.SwitchSource=\"SwitchSource\",l.GetMediaStreamTrack=\"GetMediaStreamTrack\"}(ns||(ns={})),function(l){l.SwitchVideo=\"SwitchVideo\"}(ts||(ts={})),function(l){l.SetScalingMode=\"SetScalingMode\",l.Start=\"Start\",l.Stop=\"Stop\",l.SwitchDevice=\"SwitchDevice\",l.Dispose=\"Dispose\"}(is||(is={})),function(l){l.Render=\"Render\"}(rs||(rs={})),function(l){l.Start=\"Start\",l.Resume=\"Resume\",l.Pause=\"Pause\",l.SetScalingMode=\"SetScalingMode\",l.Dispose=\"Dispose\"}(os||(os={})),function(l){l.Start=\"Start\",l.Resume=\"Resume\",l.Pause=\"Pause\",l.SetScalingMode=\"SetScalingMode\",l.Dispose=\"Dispose\"}(as||(as={})),function(l){l.SourceUnavailableError=\"SourceUnavailableError\",l.PermissionDeniedError=\"permissionDeniedError\",l.UnknownFailureForVideoOperation=\"UnknownFailureForVideoOperation\"}(ss||(ss={})),function(l){l.BrowserNotSupported=\"BrowserNotSupported\",l.IncompatibleVersions=\"IncompatibleVersions\"}(cs||(cs={}));var __awaiter$1=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};const hs=[\"response\",\"responseText\",\"responseURL\",\"status\",\"state\",\"statusText\",\"timeout\",\"withCredentials\",\"stack\",\"message\",\"name\",\"error\",\"piiSafe\",\"phase\",\"code\",\"participantId\",\"phrase\",\"subCode\",\"reason\"];function toTsScalingMode(l){switch(l){case\"Crop\":return 1;case\"Fit\":return 2;default:return 0}}function getSizeInBytes(l,d){try{return\"string\"==typeof l?new Blob([l]).size:l.byteLength}catch(l){return d.error(l),0}}function shallowEqual(l,d){const u=Object.keys(l);for(let p of u)if(l[p]!==d[p])return!1;return!0}function convertMapToFrozenJson(l){let d={};return l.forEach(((l,u)=>{d[u]=l})),Object.freeze(d)}function defer(){let l,d,u=!0,p=new Promise(((u,p)=>{l=u,d=p}));return{isPending:()=>u,promise:p,resolve:d=>{u&&(l(d),u=!1)},reject:l=>{u&&(d(l),u=!1)},dispose:()=>{p=void 0}}}function assertNotNull(l,d){if(null===l)throw new CallingCommunicationError({message:\"AssertNotNull failed. \"+(void 0!==d?`: ${d}`:\"\"),code:ve})}function assertIsObject(l,d){if(\"object\"!=typeof l)throw new CallingCommunicationError({message:\"AssertIsObject failed. \"+(void 0!==d?`: ${d}`:\"\"),code:ve})}function parseJWT(l){let[,d]=null==l?void 0:l.split(\".\");if(void 0===d)throw new CallingCommunicationError({message:\"Invalid token\",code:ve});return d=d.replace(/-/g,\"+\").replace(/_/g,\"/\"),JSON.parse(decodeURIComponent(escape(atob(d))))}function logErrorAndThrow(l,d,u){const p=l;throw u.error(p),new CallingCommunicationError({message:p,code:d})}function handleVideoOperationFailure(l,d){let u=400,p=d||`Video operation failure ${ss.UnknownFailureForVideoOperation}`;if(d&&d.type)switch(d.type){case ss.SourceUnavailableError:p=`Video operation failure ${ss.SourceUnavailableError}`,u=412;break;case ss.PermissionDeniedError:p=`Video operation failure ${ss.PermissionDeniedError}`,u=403;break;default:p=`Video operation failure ${ss.UnknownFailureForVideoOperation}`,u=500}return new CallingCommunicationError({message:p,code:u})}function noop(){}function parseTokenCredential(l,d){var u;return __awaiter$1(this,void 0,void 0,(function*(){try{if(!l)throw new CallingCommunicationError({message:\"No CommunicationTokenCredential provided\",code:ve});let p;try{p=null===(u=yield l.getToken(d))||void 0===u?void 0:u.token}catch(l){throw new CallingCommunicationError({message:\"Failed to get AccessToken\",code:ve})}if(!p)throw new CallingCommunicationError({message:\"AccessToken is empty\",code:ve});try{let l=parseJWT(p);if(!l)throw new CallingCommunicationError({message:\"Failed to parse AccessToken\",code:ve});let d=l.resourceId;const u=constructIdentifierKindFromMri(`8:${l.skypeid}`),h=\"microsoftTeamsUser\"===(null==u?void 0:u.kind);if(!d&&!h)throw new CallingCommunicationError({message:\"AccessToken does not contain ACS resource Id\",code:ye});let g=l.skypeid;if(!g)throw new CallingCommunicationError({message:\"AccessToken does not contain ACS user Id\",code:ye});return{jwtToken:p,acsResourceId:d,identityMri:g,cloudType:getCloudTypeFromSkypeId(g),isCte:!!l.tid}}catch(l){throw new CallingCommunicationError({message:\"Failed to parse AccessToken\",code:ve},l)}}catch(l){throw new CallingCommunicationError({message:\"AccessToken is invalid\",code:ye},l)}}))}function buildCallingUserAgent(l,d,u){var p,h,g,f,m,v,y,S;const _=`azsdk-js-communication-calling/${l}`;let C=\"\";if(null===(p=null==u?void 0:u.diagnostics)||void 0===p?void 0:p.appName){let l=null===(h=null==u?void 0:u.diagnostics)||void 0===h?void 0:h.appName.trim().replace(/\\s/g,\"_\");l.length>0&&(d.warn(\"appName is to long, max allowed length is 64 chars, appName was truncated to max length\"),l=l.substr(0,64)),C+=l?`${l}/`:\"default/\"}else C+=\"default/\";if(null===(g=null==u?void 0:u.diagnostics)||void 0===g?void 0:g.appVersion){let l=null===(f=null==u?void 0:u.diagnostics)||void 0===f?void 0:f.appVersion.trim().replace(/\\s/g,\"_\").substr(0,64);l.length>0&&(d.warn(\"appVersion is to long, max allowed length is 64 chars, appVersion was truncated to max length\"),l=l.substr(0,64)),C+=l||\"0.0.0\"}else C+=\"0.0.0\";if(C+=` ${_}`,(null===(m=null==u?void 0:u.diagnostics)||void 0===m?void 0:m.tags)&&Array.isArray(null===(v=null==u?void 0:u.diagnostics)||void 0===v?void 0:v.tags)&&(null===(y=null==u?void 0:u.diagnostics)||void 0===y?void 0:y.tags.length)>0){let l=null===(S=null==u?void 0:u.diagnostics)||void 0===S?void 0:S.tags.map((l=>l.trim().replace(/\\s/g,\"_\"))).filter((l=>!!l)).join(\";\");l.length>0&&(d.warn(\"tags are to long, max allowed length is 64 chars, tags were truncated to max length\"),l=l.substr(0,64),C+=\" (\"+l+\").\")}return`${C} ${navigator.userAgent}`}function getJoinContextDescription(l){return l?l.groupId?me.GroupCall:!l.threadId||l.organizerId||l.tenantId||l.messageId?l.threadId&&l.organizerId&&l.tenantId&&l.messageId?me.TeamsCoordinates:l.meetingId?me.TeamsMeetingId:l.meetingLink?me.TeamsMeetingLink:\"\":me.GroupChatCall:\"\"}function getPrintableObject(l,d=!1){const processStackTrace=l=>{try{return l.split(\"\\n\")[0]}catch(l){return\"invalid stack\"}};if(void 0===l)return\"void\";if(l instanceof Error)return l.toString();if(l instanceof String||l instanceof Number||l instanceof Boolean)return l.toString();try{return l.stack&&(l.stack=processStackTrace(l.stack)),(d?JSON.stringify(l):JSON.stringify(l,hs,4)).replace(/(\\r\\n\\t|\\n|\\r\\t|\\s)/gm,\"\")}catch(d){return`failed to get error information:${l&&\"function\"==typeof l.toString&&l.toString()} ${l&&l.response&&JSON.stringify(l.response)}`}}function permissionStateToBool(l,d){switch(d.info(\"permission state to boolean\",l),l){case\"granted\":return!0;case\"denied\":case\"prompt\":default:return!1}}function getSafeObjectDiff(l,d,u=[]){let p=[];try{const h=Array.isArray(l);for(const g in l){const f=l[g],m=h?+g:g;if(!(g in d)){p.push({type:\"REMOVE\",path:[m],oldValue:l[g]});continue}const v=d[g],y=\"object\"==typeof f&&\"object\"==typeof v;if(f&&v&&y&&!Ae[Object.getPrototypeOf(f).constructor.name]&&!u.includes(f)){const l=getSafeObjectDiff(f,v);p.push.apply(p,l.map((l=>(l.path.unshift(m),l))))}else f===v||y&&(isNaN(f)?f+\"\"==v+\"\":+f==+v)||p.push({path:[m],type:\"CHANGE\",value:v,oldValue:f})}const g=Array.isArray(d);for(const u in d)u in l||p.push({type:\"CREATE\",path:[g?+u:u],value:d[u]})}catch(l){}return p}var gs=createCommonjsModule((function(l,d){var u=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Int32Array;d.assign=function(l){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var u=d.shift();if(u){if(\"object\"!=typeof u)throw new TypeError(u+\"must be non-object\");for(var p in u)u.hasOwnProperty(p)&&(l[p]=u[p])}}return l},d.shrinkBuf=function(l,d){return l.length===d?l:l.subarray?l.subarray(0,d):(l.length=d,l)};var p={arraySet:function(l,d,u,p,h){if(d.subarray&&l.subarray)l.set(d.subarray(u,u+p),h);else for(var g=0;g<p;g++)l[h+g]=d[u+g]},flattenChunks:function(l){var d,u,p,h,g,f;for(p=0,d=0,u=l.length;d<u;d++)p+=l[d].length;for(f=new Uint8Array(p),h=0,d=0,u=l.length;d<u;d++)g=l[d],f.set(g,h),h+=g.length;return f}},h={arraySet:function(l,d,u,p,h){for(var g=0;g<p;g++)l[h+g]=d[u+g]},flattenChunks:function(l){return[].concat.apply([],l)}};d.setTyped=function(l){l?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,p)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,h))},d.setTyped(u)})),fs=4,ms=0,vs=1,ys=2;function zero(l){for(var d=l.length;--d>=0;)l[d]=0}var Ss=0,_s=1,Cs=2,Es=3,Ts=258,bs=29,Is=256,As=Is+1+bs,Rs=30,Ps=19,Os=2*As+1,Ms=15,ws=16,Ns=7,Ds=256,Ls=16,ks=17,xs=18,Fs=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Us=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],js=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Bs=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Vs=512,Hs=new Array(2*(As+2));zero(Hs);var Gs=new Array(2*Rs);zero(Gs);var Ws=new Array(Vs);zero(Ws);var qs=new Array(Ts-Es+1);zero(qs);var zs=new Array(bs);zero(zs);var Ks,Js,Qs,Ys=new Array(Rs);function StaticTreeDesc(l,d,u,p,h){this.static_tree=l,this.extra_bits=d,this.extra_base=u,this.elems=p,this.max_length=h,this.has_stree=l&&l.length}function TreeDesc(l,d){this.dyn_tree=l,this.max_code=0,this.stat_desc=d}function d_code(l){return l<256?Ws[l]:Ws[256+(l>>>7)]}function put_short(l,d){l.pending_buf[l.pending++]=255&d,l.pending_buf[l.pending++]=d>>>8&255}function send_bits(l,d,u){l.bi_valid>ws-u?(l.bi_buf|=d<<l.bi_valid&65535,put_short(l,l.bi_buf),l.bi_buf=d>>ws-l.bi_valid,l.bi_valid+=u-ws):(l.bi_buf|=d<<l.bi_valid&65535,l.bi_valid+=u)}function send_code(l,d,u){send_bits(l,u[2*d],u[2*d+1])}function bi_reverse(l,d){var u=0;do{u|=1&l,l>>>=1,u<<=1}while(--d>0);return u>>>1}function bi_flush(l){16===l.bi_valid?(put_short(l,l.bi_buf),l.bi_buf=0,l.bi_valid=0):l.bi_valid>=8&&(l.pending_buf[l.pending++]=255&l.bi_buf,l.bi_buf>>=8,l.bi_valid-=8)}function gen_bitlen(l,d){var u,p,h,g,f,m,v=d.dyn_tree,y=d.max_code,S=d.stat_desc.static_tree,_=d.stat_desc.has_stree,C=d.stat_desc.extra_bits,E=d.stat_desc.extra_base,T=d.stat_desc.max_length,b=0;for(g=0;g<=Ms;g++)l.bl_count[g]=0;for(v[2*l.heap[l.heap_max]+1]=0,u=l.heap_max+1;u<Os;u++)(g=v[2*v[2*(p=l.heap[u])+1]+1]+1)>T&&(g=T,b++),v[2*p+1]=g,p>y||(l.bl_count[g]++,f=0,p>=E&&(f=C[p-E]),m=v[2*p],l.opt_len+=m*(g+f),_&&(l.static_len+=m*(S[2*p+1]+f)));if(0!==b){do{for(g=T-1;0===l.bl_count[g];)g--;l.bl_count[g]--,l.bl_count[g+1]+=2,l.bl_count[T]--,b-=2}while(b>0);for(g=T;0!==g;g--)for(p=l.bl_count[g];0!==p;)(h=l.heap[--u])>y||(v[2*h+1]!==g&&(l.opt_len+=(g-v[2*h+1])*v[2*h],v[2*h+1]=g),p--)}}function gen_codes(l,d,u){var p,h,g=new Array(Ms+1),f=0;for(p=1;p<=Ms;p++)g[p]=f=f+u[p-1]<<1;for(h=0;h<=d;h++){var m=l[2*h+1];0!==m&&(l[2*h]=bi_reverse(g[m]++,m))}}function tr_static_init(){var l,d,u,p,h,g=new Array(Ms+1);for(u=0,p=0;p<bs-1;p++)for(zs[p]=u,l=0;l<1<<Fs[p];l++)qs[u++]=p;for(qs[u-1]=p,h=0,p=0;p<16;p++)for(Ys[p]=h,l=0;l<1<<Us[p];l++)Ws[h++]=p;for(h>>=7;p<Rs;p++)for(Ys[p]=h<<7,l=0;l<1<<Us[p]-7;l++)Ws[256+h++]=p;for(d=0;d<=Ms;d++)g[d]=0;for(l=0;l<=143;)Hs[2*l+1]=8,l++,g[8]++;for(;l<=255;)Hs[2*l+1]=9,l++,g[9]++;for(;l<=279;)Hs[2*l+1]=7,l++,g[7]++;for(;l<=287;)Hs[2*l+1]=8,l++,g[8]++;for(gen_codes(Hs,As+1,g),l=0;l<Rs;l++)Gs[2*l+1]=5,Gs[2*l]=bi_reverse(l,5);Ks=new StaticTreeDesc(Hs,Fs,Is+1,As,Ms),Js=new StaticTreeDesc(Gs,Us,0,Rs,Ms),Qs=new StaticTreeDesc(new Array(0),js,0,Ps,Ns)}function init_block(l){var d;for(d=0;d<As;d++)l.dyn_ltree[2*d]=0;for(d=0;d<Rs;d++)l.dyn_dtree[2*d]=0;for(d=0;d<Ps;d++)l.bl_tree[2*d]=0;l.dyn_ltree[2*Ds]=1,l.opt_len=l.static_len=0,l.last_lit=l.matches=0}function bi_windup(l){l.bi_valid>8?put_short(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0}function copy_block(l,d,u,p){bi_windup(l),p&&(put_short(l,u),put_short(l,~u)),gs.arraySet(l.pending_buf,l.window,d,u,l.pending),l.pending+=u}function smaller(l,d,u,p){var h=2*d,g=2*u;return l[h]<l[g]||l[h]===l[g]&&p[d]<=p[u]}function pqdownheap(l,d,u){for(var p=l.heap[u],h=u<<1;h<=l.heap_len&&(h<l.heap_len&&smaller(d,l.heap[h+1],l.heap[h],l.depth)&&h++,!smaller(d,p,l.heap[h],l.depth));)l.heap[u]=l.heap[h],u=h,h<<=1;l.heap[u]=p}function compress_block(l,d,u){var p,h,g,f,m=0;if(0!==l.last_lit)do{p=l.pending_buf[l.d_buf+2*m]<<8|l.pending_buf[l.d_buf+2*m+1],h=l.pending_buf[l.l_buf+m],m++,0===p?send_code(l,h,d):(send_code(l,(g=qs[h])+Is+1,d),0!==(f=Fs[g])&&send_bits(l,h-=zs[g],f),send_code(l,g=d_code(--p),u),0!==(f=Us[g])&&send_bits(l,p-=Ys[g],f))}while(m<l.last_lit);send_code(l,Ds,d)}function build_tree(l,d){var u,p,h,g=d.dyn_tree,f=d.stat_desc.static_tree,m=d.stat_desc.has_stree,v=d.stat_desc.elems,y=-1;for(l.heap_len=0,l.heap_max=Os,u=0;u<v;u++)0!==g[2*u]?(l.heap[++l.heap_len]=y=u,l.depth[u]=0):g[2*u+1]=0;for(;l.heap_len<2;)g[2*(h=l.heap[++l.heap_len]=y<2?++y:0)]=1,l.depth[h]=0,l.opt_len--,m&&(l.static_len-=f[2*h+1]);for(d.max_code=y,u=l.heap_len>>1;u>=1;u--)pqdownheap(l,g,u);h=v;do{u=l.heap[1],l.heap[1]=l.heap[l.heap_len--],pqdownheap(l,g,1),p=l.heap[1],l.heap[--l.heap_max]=u,l.heap[--l.heap_max]=p,g[2*h]=g[2*u]+g[2*p],l.depth[h]=(l.depth[u]>=l.depth[p]?l.depth[u]:l.depth[p])+1,g[2*u+1]=g[2*p+1]=h,l.heap[1]=h++,pqdownheap(l,g,1)}while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],gen_bitlen(l,d),gen_codes(g,y,l.bl_count)}function scan_tree(l,d,u){var p,h,g=-1,f=d[1],m=0,v=7,y=4;for(0===f&&(v=138,y=3),d[2*(u+1)+1]=65535,p=0;p<=u;p++)h=f,f=d[2*(p+1)+1],++m<v&&h===f||(m<y?l.bl_tree[2*h]+=m:0!==h?(h!==g&&l.bl_tree[2*h]++,l.bl_tree[2*Ls]++):m<=10?l.bl_tree[2*ks]++:l.bl_tree[2*xs]++,m=0,g=h,0===f?(v=138,y=3):h===f?(v=6,y=3):(v=7,y=4))}function send_tree(l,d,u){var p,h,g=-1,f=d[1],m=0,v=7,y=4;for(0===f&&(v=138,y=3),p=0;p<=u;p++)if(h=f,f=d[2*(p+1)+1],!(++m<v&&h===f)){if(m<y)do{send_code(l,h,l.bl_tree)}while(0!=--m);else 0!==h?(h!==g&&(send_code(l,h,l.bl_tree),m--),send_code(l,Ls,l.bl_tree),send_bits(l,m-3,2)):m<=10?(send_code(l,ks,l.bl_tree),send_bits(l,m-3,3)):(send_code(l,xs,l.bl_tree),send_bits(l,m-11,7));m=0,g=h,0===f?(v=138,y=3):h===f?(v=6,y=3):(v=7,y=4)}}function build_bl_tree(l){var d;for(scan_tree(l,l.dyn_ltree,l.l_desc.max_code),scan_tree(l,l.dyn_dtree,l.d_desc.max_code),build_tree(l,l.bl_desc),d=Ps-1;d>=3&&0===l.bl_tree[2*Bs[d]+1];d--);return l.opt_len+=3*(d+1)+5+5+4,d}function send_all_trees(l,d,u,p){var h;for(send_bits(l,d-257,5),send_bits(l,u-1,5),send_bits(l,p-4,4),h=0;h<p;h++)send_bits(l,l.bl_tree[2*Bs[h]+1],3);send_tree(l,l.dyn_ltree,d-1),send_tree(l,l.dyn_dtree,u-1)}function detect_data_type(l){var d,u=4093624447;for(d=0;d<=31;d++,u>>>=1)if(1&u&&0!==l.dyn_ltree[2*d])return ms;if(0!==l.dyn_ltree[18]||0!==l.dyn_ltree[20]||0!==l.dyn_ltree[26])return vs;for(d=32;d<Is;d++)if(0!==l.dyn_ltree[2*d])return vs;return ms}zero(Ys);var $s=!1;function _tr_init(l){$s||(tr_static_init(),$s=!0),l.l_desc=new TreeDesc(l.dyn_ltree,Ks),l.d_desc=new TreeDesc(l.dyn_dtree,Js),l.bl_desc=new TreeDesc(l.bl_tree,Qs),l.bi_buf=0,l.bi_valid=0,init_block(l)}function _tr_stored_block(l,d,u,p){send_bits(l,(Ss<<1)+(p?1:0),3),copy_block(l,d,u,!0)}function _tr_align(l){send_bits(l,_s<<1,3),send_code(l,Ds,Hs),bi_flush(l)}function _tr_flush_block(l,d,u,p){var h,g,f=0;l.level>0?(l.strm.data_type===ys&&(l.strm.data_type=detect_data_type(l)),build_tree(l,l.l_desc),build_tree(l,l.d_desc),f=build_bl_tree(l),h=l.opt_len+3+7>>>3,(g=l.static_len+3+7>>>3)<=h&&(h=g)):h=g=u+5,u+4<=h&&-1!==d?_tr_stored_block(l,d,u,p):l.strategy===fs||g===h?(send_bits(l,(_s<<1)+(p?1:0),3),compress_block(l,Hs,Gs)):(send_bits(l,(Cs<<1)+(p?1:0),3),send_all_trees(l,l.l_desc.max_code+1,l.d_desc.max_code+1,f+1),compress_block(l,l.dyn_ltree,l.dyn_dtree)),init_block(l),p&&bi_windup(l)}function _tr_tally(l,d,u){return l.pending_buf[l.d_buf+2*l.last_lit]=d>>>8&255,l.pending_buf[l.d_buf+2*l.last_lit+1]=255&d,l.pending_buf[l.l_buf+l.last_lit]=255&u,l.last_lit++,0===d?l.dyn_ltree[2*u]++:(l.matches++,d--,l.dyn_ltree[2*(qs[u]+Is+1)]++,l.dyn_dtree[2*d_code(d)]++),l.last_lit===l.lit_bufsize-1}var Xs={_tr_init:_tr_init,_tr_stored_block:_tr_stored_block,_tr_flush_block:_tr_flush_block,_tr_tally:_tr_tally,_tr_align:_tr_align};function adler32(l,d,u,p){for(var h=65535&l|0,g=l>>>16&65535|0,f=0;0!==u;){u-=f=u>2e3?2e3:u;do{g=g+(h=h+d[p++]|0)|0}while(--f);h%=65521,g%=65521}return h|g<<16|0}var Zs=adler32;function makeTable(){for(var l,d=[],u=0;u<256;u++){l=u;for(var p=0;p<8;p++)l=1&l?3988292384^l>>>1:l>>>1;d[u]=l}return d}var ec=makeTable();function crc32(l,d,u,p){var h=ec,g=p+u;l^=-1;for(var f=p;f<g;f++)l=l>>>8^h[255&(l^d[f])];return-1^l}var tc,nc=crc32,ic={2:\"need dictionary\",1:\"stream end\",0:\"\",\"-1\":\"file error\",\"-2\":\"stream error\",\"-3\":\"data error\",\"-4\":\"insufficient memory\",\"-5\":\"buffer error\",\"-6\":\"incompatible version\"},rc=0,oc=1,ac=3,sc=4,cc=5,lc=0,dc=1,uc=-2,pc=-3,hc=-5,gc=-1,fc=1,mc=2,vc=3,yc=4,Sc=0,_c=2,Cc=8,Ec=9,Tc=15,bc=8,Ic=256+1+29,Ac=30,Rc=19,Pc=2*Ic+1,Oc=15,Mc=3,wc=258,Nc=wc+Mc+1,Dc=32,Lc=42,kc=69,xc=73,Fc=91,Uc=103,jc=113,Bc=666,Vc=1,Hc=2,Gc=3,Wc=4,qc=3;function err(l,d){return l.msg=ic[d],d}function rank(l){return(l<<1)-(l>4?9:0)}function zero$1(l){for(var d=l.length;--d>=0;)l[d]=0}function flush_pending(l){var d=l.state,u=d.pending;u>l.avail_out&&(u=l.avail_out),0!==u&&(gs.arraySet(l.output,d.pending_buf,d.pending_out,u,l.next_out),l.next_out+=u,d.pending_out+=u,l.total_out+=u,l.avail_out-=u,d.pending-=u,0===d.pending&&(d.pending_out=0))}function flush_block_only(l,d){Xs._tr_flush_block(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,d),l.block_start=l.strstart,flush_pending(l.strm)}function put_byte(l,d){l.pending_buf[l.pending++]=d}function putShortMSB(l,d){l.pending_buf[l.pending++]=d>>>8&255,l.pending_buf[l.pending++]=255&d}function read_buf(l,d,u,p){var h=l.avail_in;return h>p&&(h=p),0===h?0:(l.avail_in-=h,gs.arraySet(d,l.input,l.next_in,h,u),1===l.state.wrap?l.adler=Zs(l.adler,d,h,u):2===l.state.wrap&&(l.adler=nc(l.adler,d,h,u)),l.next_in+=h,l.total_in+=h,h)}function longest_match(l,d){var u,p,h=l.max_chain_length,g=l.strstart,f=l.prev_length,m=l.nice_match,v=l.strstart>l.w_size-Nc?l.strstart-(l.w_size-Nc):0,y=l.window,S=l.w_mask,_=l.prev,C=l.strstart+wc,E=y[g+f-1],T=y[g+f];l.prev_length>=l.good_match&&(h>>=2),m>l.lookahead&&(m=l.lookahead);do{if(y[(u=d)+f]===T&&y[u+f-1]===E&&y[u]===y[g]&&y[++u]===y[g+1]){g+=2,u++;do{}while(y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&y[++g]===y[++u]&&g<C);if(p=wc-(C-g),g=C-wc,p>f){if(l.match_start=d,f=p,p>=m)break;E=y[g+f-1],T=y[g+f]}}}while((d=_[d&S])>v&&0!=--h);return f<=l.lookahead?f:l.lookahead}function fill_window(l){var d,u,p,h,g,f=l.w_size;do{if(h=l.window_size-l.lookahead-l.strstart,l.strstart>=f+(f-Nc)){gs.arraySet(l.window,l.window,f,f,0),l.match_start-=f,l.strstart-=f,l.block_start-=f,d=u=l.hash_size;do{p=l.head[--d],l.head[d]=p>=f?p-f:0}while(--u);d=u=f;do{p=l.prev[--d],l.prev[d]=p>=f?p-f:0}while(--u);h+=f}if(0===l.strm.avail_in)break;if(u=read_buf(l.strm,l.window,l.strstart+l.lookahead,h),l.lookahead+=u,l.lookahead+l.insert>=Mc)for(g=l.strstart-l.insert,l.ins_h=l.window[g],l.ins_h=(l.ins_h<<l.hash_shift^l.window[g+1])&l.hash_mask;l.insert&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[g+Mc-1])&l.hash_mask,l.prev[g&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=g,g++,l.insert--,!(l.lookahead+l.insert<Mc)););}while(l.lookahead<Nc&&0!==l.strm.avail_in)}function deflate_stored(l,d){var u=65535;for(u>l.pending_buf_size-5&&(u=l.pending_buf_size-5);;){if(l.lookahead<=1){if(fill_window(l),0===l.lookahead&&d===rc)return Vc;if(0===l.lookahead)break}l.strstart+=l.lookahead,l.lookahead=0;var p=l.block_start+u;if((0===l.strstart||l.strstart>=p)&&(l.lookahead=l.strstart-p,l.strstart=p,flush_block_only(l,!1),0===l.strm.avail_out))return Vc;if(l.strstart-l.block_start>=l.w_size-Nc&&(flush_block_only(l,!1),0===l.strm.avail_out))return Vc}return l.insert=0,d===sc?(flush_block_only(l,!0),0===l.strm.avail_out?Gc:Wc):(l.strstart>l.block_start&&(flush_block_only(l,!1),l.strm.avail_out),Vc)}function deflate_fast(l,d){for(var u,p;;){if(l.lookahead<Nc){if(fill_window(l),l.lookahead<Nc&&d===rc)return Vc;if(0===l.lookahead)break}if(u=0,l.lookahead>=Mc&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+Mc-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),0!==u&&l.strstart-u<=l.w_size-Nc&&(l.match_length=longest_match(l,u)),l.match_length>=Mc)if(p=Xs._tr_tally(l,l.strstart-l.match_start,l.match_length-Mc),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=Mc){l.match_length--;do{l.strstart++,l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+Mc-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart}while(0!=--l.match_length);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+1])&l.hash_mask;else p=Xs._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(p&&(flush_block_only(l,!1),0===l.strm.avail_out))return Vc}return l.insert=l.strstart<Mc-1?l.strstart:Mc-1,d===sc?(flush_block_only(l,!0),0===l.strm.avail_out?Gc:Wc):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?Vc:Hc}function deflate_slow(l,d){for(var u,p,h;;){if(l.lookahead<Nc){if(fill_window(l),l.lookahead<Nc&&d===rc)return Vc;if(0===l.lookahead)break}if(u=0,l.lookahead>=Mc&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+Mc-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=Mc-1,0!==u&&l.prev_length<l.max_lazy_match&&l.strstart-u<=l.w_size-Nc&&(l.match_length=longest_match(l,u),l.match_length<=5&&(l.strategy===fc||l.match_length===Mc&&l.strstart-l.match_start>4096)&&(l.match_length=Mc-1)),l.prev_length>=Mc&&l.match_length<=l.prev_length){h=l.strstart+l.lookahead-Mc,p=Xs._tr_tally(l,l.strstart-1-l.prev_match,l.prev_length-Mc),l.lookahead-=l.prev_length-1,l.prev_length-=2;do{++l.strstart<=h&&(l.ins_h=(l.ins_h<<l.hash_shift^l.window[l.strstart+Mc-1])&l.hash_mask,u=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart)}while(0!=--l.prev_length);if(l.match_available=0,l.match_length=Mc-1,l.strstart++,p&&(flush_block_only(l,!1),0===l.strm.avail_out))return Vc}else if(l.match_available){if((p=Xs._tr_tally(l,0,l.window[l.strstart-1]))&&flush_block_only(l,!1),l.strstart++,l.lookahead--,0===l.strm.avail_out)return Vc}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(p=Xs._tr_tally(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<Mc-1?l.strstart:Mc-1,d===sc?(flush_block_only(l,!0),0===l.strm.avail_out?Gc:Wc):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?Vc:Hc}function deflate_rle(l,d){for(var u,p,h,g,f=l.window;;){if(l.lookahead<=wc){if(fill_window(l),l.lookahead<=wc&&d===rc)return Vc;if(0===l.lookahead)break}if(l.match_length=0,l.lookahead>=Mc&&l.strstart>0&&(p=f[h=l.strstart-1])===f[++h]&&p===f[++h]&&p===f[++h]){g=l.strstart+wc;do{}while(p===f[++h]&&p===f[++h]&&p===f[++h]&&p===f[++h]&&p===f[++h]&&p===f[++h]&&p===f[++h]&&p===f[++h]&&h<g);l.match_length=wc-(g-h),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=Mc?(u=Xs._tr_tally(l,1,l.match_length-Mc),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(u=Xs._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),u&&(flush_block_only(l,!1),0===l.strm.avail_out))return Vc}return l.insert=0,d===sc?(flush_block_only(l,!0),0===l.strm.avail_out?Gc:Wc):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?Vc:Hc}function deflate_huff(l,d){for(var u;;){if(0===l.lookahead&&(fill_window(l),0===l.lookahead)){if(d===rc)return Vc;break}if(l.match_length=0,u=Xs._tr_tally(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,u&&(flush_block_only(l,!1),0===l.strm.avail_out))return Vc}return l.insert=0,d===sc?(flush_block_only(l,!0),0===l.strm.avail_out?Gc:Wc):l.last_lit&&(flush_block_only(l,!1),0===l.strm.avail_out)?Vc:Hc}function Config(l,d,u,p,h){this.good_length=l,this.max_lazy=d,this.nice_length=u,this.max_chain=p,this.func=h}function lm_init(l){l.window_size=2*l.w_size,zero$1(l.head),l.max_lazy_match=tc[l.level].max_lazy,l.good_match=tc[l.level].good_length,l.nice_match=tc[l.level].nice_length,l.max_chain_length=tc[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=Mc-1,l.match_available=0,l.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Cc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new gs.Buf16(2*Pc),this.dyn_dtree=new gs.Buf16(2*(2*Ac+1)),this.bl_tree=new gs.Buf16(2*(2*Rc+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new gs.Buf16(Oc+1),this.heap=new gs.Buf16(2*Ic+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new gs.Buf16(2*Ic+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(l){var d;return l&&l.state?(l.total_in=l.total_out=0,l.data_type=_c,(d=l.state).pending=0,d.pending_out=0,d.wrap<0&&(d.wrap=-d.wrap),d.status=d.wrap?Lc:jc,l.adler=2===d.wrap?0:1,d.last_flush=rc,Xs._tr_init(d),lc):err(l,uc)}function deflateReset(l){var d=deflateResetKeep(l);return d===lc&&lm_init(l.state),d}function deflateSetHeader(l,d){return l&&l.state?2!==l.state.wrap?uc:(l.state.gzhead=d,lc):uc}function deflateInit2(l,d,u,p,h,g){if(!l)return uc;var f=1;if(d===gc&&(d=6),p<0?(f=0,p=-p):p>15&&(f=2,p-=16),h<1||h>Ec||u!==Cc||p<8||p>15||d<0||d>9||g<0||g>yc)return err(l,uc);8===p&&(p=9);var m=new DeflateState;return l.state=m,m.strm=l,m.wrap=f,m.gzhead=null,m.w_bits=p,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=h+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+Mc-1)/Mc),m.window=new gs.Buf8(2*m.w_size),m.head=new gs.Buf16(m.hash_size),m.prev=new gs.Buf16(m.w_size),m.lit_bufsize=1<<h+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new gs.Buf8(m.pending_buf_size),m.d_buf=m.lit_bufsize>>1,m.l_buf=3*m.lit_bufsize,m.level=d,m.strategy=g,m.method=u,deflateReset(l)}function deflateInit(l,d){return deflateInit2(l,d,Cc,Tc,bc,Sc)}function deflate(l,d){var u,p,h,g;if(!l||!l.state||d>cc||d<0)return l?err(l,uc):uc;if(p=l.state,!l.output||!l.input&&0!==l.avail_in||p.status===Bc&&d!==sc)return err(l,0===l.avail_out?hc:uc);if(p.strm=l,u=p.last_flush,p.last_flush=d,p.status===Lc)if(2===p.wrap)l.adler=0,put_byte(p,31),put_byte(p,139),put_byte(p,8),p.gzhead?(put_byte(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),put_byte(p,255&p.gzhead.time),put_byte(p,p.gzhead.time>>8&255),put_byte(p,p.gzhead.time>>16&255),put_byte(p,p.gzhead.time>>24&255),put_byte(p,9===p.level?2:p.strategy>=mc||p.level<2?4:0),put_byte(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(put_byte(p,255&p.gzhead.extra.length),put_byte(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(l.adler=nc(l.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=kc):(put_byte(p,0),put_byte(p,0),put_byte(p,0),put_byte(p,0),put_byte(p,0),put_byte(p,9===p.level?2:p.strategy>=mc||p.level<2?4:0),put_byte(p,qc),p.status=jc);else{var f=Cc+(p.w_bits-8<<4)<<8;f|=(p.strategy>=mc||p.level<2?0:p.level<6?1:6===p.level?2:3)<<6,0!==p.strstart&&(f|=Dc),f+=31-f%31,p.status=jc,putShortMSB(p,f),0!==p.strstart&&(putShortMSB(p,l.adler>>>16),putShortMSB(p,65535&l.adler)),l.adler=1}if(p.status===kc)if(p.gzhead.extra){for(h=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>h&&(l.adler=nc(l.adler,p.pending_buf,p.pending-h,h)),flush_pending(l),h=p.pending,p.pending!==p.pending_buf_size));)put_byte(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>h&&(l.adler=nc(l.adler,p.pending_buf,p.pending-h,h)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=xc)}else p.status=xc;if(p.status===xc)if(p.gzhead.name){h=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>h&&(l.adler=nc(l.adler,p.pending_buf,p.pending-h,h)),flush_pending(l),h=p.pending,p.pending===p.pending_buf_size)){g=1;break}g=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,put_byte(p,g)}while(0!==g);p.gzhead.hcrc&&p.pending>h&&(l.adler=nc(l.adler,p.pending_buf,p.pending-h,h)),0===g&&(p.gzindex=0,p.status=Fc)}else p.status=Fc;if(p.status===Fc)if(p.gzhead.comment){h=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>h&&(l.adler=nc(l.adler,p.pending_buf,p.pending-h,h)),flush_pending(l),h=p.pending,p.pending===p.pending_buf_size)){g=1;break}g=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,put_byte(p,g)}while(0!==g);p.gzhead.hcrc&&p.pending>h&&(l.adler=nc(l.adler,p.pending_buf,p.pending-h,h)),0===g&&(p.status=Uc)}else p.status=Uc;if(p.status===Uc&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&flush_pending(l),p.pending+2<=p.pending_buf_size&&(put_byte(p,255&l.adler),put_byte(p,l.adler>>8&255),l.adler=0,p.status=jc)):p.status=jc),0!==p.pending){if(flush_pending(l),0===l.avail_out)return p.last_flush=-1,lc}else if(0===l.avail_in&&rank(d)<=rank(u)&&d!==sc)return err(l,hc);if(p.status===Bc&&0!==l.avail_in)return err(l,hc);if(0!==l.avail_in||0!==p.lookahead||d!==rc&&p.status!==Bc){var m=p.strategy===mc?deflate_huff(p,d):p.strategy===vc?deflate_rle(p,d):tc[p.level].func(p,d);if(m!==Gc&&m!==Wc||(p.status=Bc),m===Vc||m===Gc)return 0===l.avail_out&&(p.last_flush=-1),lc;if(m===Hc&&(d===oc?Xs._tr_align(p):d!==cc&&(Xs._tr_stored_block(p,0,0,!1),d===ac&&(zero$1(p.head),0===p.lookahead&&(p.strstart=0,p.block_start=0,p.insert=0))),flush_pending(l),0===l.avail_out))return p.last_flush=-1,lc}return d!==sc?lc:p.wrap<=0?dc:(2===p.wrap?(put_byte(p,255&l.adler),put_byte(p,l.adler>>8&255),put_byte(p,l.adler>>16&255),put_byte(p,l.adler>>24&255),put_byte(p,255&l.total_in),put_byte(p,l.total_in>>8&255),put_byte(p,l.total_in>>16&255),put_byte(p,l.total_in>>24&255)):(putShortMSB(p,l.adler>>>16),putShortMSB(p,65535&l.adler)),flush_pending(l),p.wrap>0&&(p.wrap=-p.wrap),0!==p.pending?lc:dc)}function deflateEnd(l){var d;return l&&l.state?(d=l.state.status)!==Lc&&d!==kc&&d!==xc&&d!==Fc&&d!==Uc&&d!==jc&&d!==Bc?err(l,uc):(l.state=null,d===jc?err(l,pc):lc):uc}function deflateSetDictionary(l,d){var u,p,h,g,f,m,v,y,S=d.length;if(!l||!l.state)return uc;if(2===(g=(u=l.state).wrap)||1===g&&u.status!==Lc||u.lookahead)return uc;for(1===g&&(l.adler=Zs(l.adler,d,S,0)),u.wrap=0,S>=u.w_size&&(0===g&&(zero$1(u.head),u.strstart=0,u.block_start=0,u.insert=0),y=new gs.Buf8(u.w_size),gs.arraySet(y,d,S-u.w_size,u.w_size,0),d=y,S=u.w_size),f=l.avail_in,m=l.next_in,v=l.input,l.avail_in=S,l.next_in=0,l.input=d,fill_window(u);u.lookahead>=Mc;){p=u.strstart,h=u.lookahead-(Mc-1);do{u.ins_h=(u.ins_h<<u.hash_shift^u.window[p+Mc-1])&u.hash_mask,u.prev[p&u.w_mask]=u.head[u.ins_h],u.head[u.ins_h]=p,p++}while(--h);u.strstart=p,u.lookahead=Mc-1,fill_window(u)}return u.strstart+=u.lookahead,u.block_start=u.strstart,u.insert=u.lookahead,u.lookahead=0,u.match_length=u.prev_length=Mc-1,u.match_available=0,l.next_in=m,l.input=v,l.avail_in=f,u.wrap=g,lc}tc=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];var zc={deflateInit:deflateInit,deflateInit2:deflateInit2,deflateReset:deflateReset,deflateResetKeep:deflateResetKeep,deflateSetHeader:deflateSetHeader,deflate:deflate,deflateEnd:deflateEnd,deflateSetDictionary:deflateSetDictionary,deflateInfo:\"pako deflate (from Nodeca project)\"},Kc=!0,Jc=!0;try{String.fromCharCode.apply(null,[0])}catch(l){Kc=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(l){Jc=!1}for(var Qc=new gs.Buf8(256),Yc=0;Yc<256;Yc++)Qc[Yc]=Yc>=252?6:Yc>=248?5:Yc>=240?4:Yc>=224?3:Yc>=192?2:1;function buf2binstring(l,d){if(d<65537&&(l.subarray&&Jc||!l.subarray&&Kc))return String.fromCharCode.apply(null,gs.shrinkBuf(l,d));for(var u=\"\",p=0;p<d;p++)u+=String.fromCharCode(l[p]);return u}Qc[254]=Qc[254]=1;var $c={string2buf:function(l){var d,u,p,h,g,f=l.length,m=0;for(h=0;h<f;h++)55296==(64512&(u=l.charCodeAt(h)))&&h+1<f&&56320==(64512&(p=l.charCodeAt(h+1)))&&(u=65536+(u-55296<<10)+(p-56320),h++),m+=u<128?1:u<2048?2:u<65536?3:4;for(d=new gs.Buf8(m),g=0,h=0;g<m;h++)55296==(64512&(u=l.charCodeAt(h)))&&h+1<f&&56320==(64512&(p=l.charCodeAt(h+1)))&&(u=65536+(u-55296<<10)+(p-56320),h++),u<128?d[g++]=u:u<2048?(d[g++]=192|u>>>6,d[g++]=128|63&u):u<65536?(d[g++]=224|u>>>12,d[g++]=128|u>>>6&63,d[g++]=128|63&u):(d[g++]=240|u>>>18,d[g++]=128|u>>>12&63,d[g++]=128|u>>>6&63,d[g++]=128|63&u);return d},buf2binstring:function(l){return buf2binstring(l,l.length)},binstring2buf:function(l){for(var d=new gs.Buf8(l.length),u=0,p=d.length;u<p;u++)d[u]=l.charCodeAt(u);return d},buf2string:function(l,d){var u,p,h,g,f=d||l.length,m=new Array(2*f);for(p=0,u=0;u<f;)if((h=l[u++])<128)m[p++]=h;else if((g=Qc[h])>4)m[p++]=65533,u+=g-1;else{for(h&=2===g?31:3===g?15:7;g>1&&u<f;)h=h<<6|63&l[u++],g--;g>1?m[p++]=65533:h<65536?m[p++]=h:(h-=65536,m[p++]=55296|h>>10&1023,m[p++]=56320|1023&h)}return buf2binstring(m,p)},utf8border:function(l,d){var u;for((d=d||l.length)>l.length&&(d=l.length),u=d-1;u>=0&&128==(192&l[u]);)u--;return u<0||0===u?d:u+Qc[l[u]]>d?u:d}};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=\"\",this.state=null,this.data_type=2,this.adler=0}var Xc=ZStream,Zc=Object.prototype.toString,el=0,tl=4,nl=0,il=1,rl=2,ol=-1,al=0,sl=8;function Deflate(l){if(!(this instanceof Deflate))return new Deflate(l);this.options=gs.assign({level:ol,method:sl,chunkSize:16384,windowBits:15,memLevel:8,strategy:al,to:\"\"},l||{});var d=this.options;d.raw&&d.windowBits>0?d.windowBits=-d.windowBits:d.gzip&&d.windowBits>0&&d.windowBits<16&&(d.windowBits+=16),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new Xc,this.strm.avail_out=0;var u=zc.deflateInit2(this.strm,d.level,d.method,d.windowBits,d.memLevel,d.strategy);if(u!==nl)throw new Error(ic[u]);if(d.header&&zc.deflateSetHeader(this.strm,d.header),d.dictionary){var p;if(p=\"string\"==typeof d.dictionary?$c.string2buf(d.dictionary):\"[object ArrayBuffer]\"===Zc.call(d.dictionary)?new Uint8Array(d.dictionary):d.dictionary,(u=zc.deflateSetDictionary(this.strm,p))!==nl)throw new Error(ic[u]);this._dict_set=!0}}function deflate$1(l,d){var u=new Deflate(d);if(u.push(l,!0),u.err)throw u.msg;return u.result}function deflateRaw(l,d){return(d=d||{}).raw=!0,deflate$1(l,d)}function gzip(l,d){return(d=d||{}).gzip=!0,deflate$1(l,d)}Deflate.prototype.push=function(l,d){var u,p,h=this.strm,g=this.options.chunkSize;if(this.ended)return!1;p=d===~~d?d:!0===d?tl:el,\"string\"==typeof l?h.input=$c.string2buf(l):\"[object ArrayBuffer]\"===Zc.call(l)?h.input=new Uint8Array(l):h.input=l,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new gs.Buf8(g),h.next_out=0,h.avail_out=g),(u=zc.deflate(h,p))!==il&&u!==nl)return this.onEnd(u),this.ended=!0,!1;0!==h.avail_out&&(0!==h.avail_in||p!==tl&&p!==rl)||(\"string\"===this.options.to?this.onData($c.buf2binstring(gs.shrinkBuf(h.output,h.next_out))):this.onData(gs.shrinkBuf(h.output,h.next_out)))}while((h.avail_in>0||0===h.avail_out)&&u!==il);return p===tl?(u=zc.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===nl):p!==rl||(this.onEnd(nl),h.avail_out=0,!0)},Deflate.prototype.onData=function(l){this.chunks.push(l)},Deflate.prototype.onEnd=function(l){l===nl&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=gs.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};var cl={Deflate:Deflate,deflate:deflate$1,deflateRaw:deflateRaw,gzip:gzip},ll=30,dl=12,ul=function inflate_fast(l,d){var u,p,h,g,f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k;u=l.state,p=l.next_in,L=l.input,h=p+(l.avail_in-5),g=l.next_out,k=l.output,f=g-(d-l.avail_out),m=g+(l.avail_out-257),v=u.dmax,y=u.wsize,S=u.whave,_=u.wnext,C=u.window,E=u.hold,T=u.bits,b=u.lencode,I=u.distcode,A=(1<<u.lenbits)-1,R=(1<<u.distbits)-1;e:do{T<15&&(E+=L[p++]<<T,T+=8,E+=L[p++]<<T,T+=8),P=b[E&A];t:for(;;){if(E>>>=O=P>>>24,T-=O,0===(O=P>>>16&255))k[g++]=65535&P;else{if(!(16&O)){if(0==(64&O)){P=b[(65535&P)+(E&(1<<O)-1)];continue t}if(32&O){u.mode=dl;break e}l.msg=\"invalid literal/length code\",u.mode=ll;break e}M=65535&P,(O&=15)&&(T<O&&(E+=L[p++]<<T,T+=8),M+=E&(1<<O)-1,E>>>=O,T-=O),T<15&&(E+=L[p++]<<T,T+=8,E+=L[p++]<<T,T+=8),P=I[E&R];n:for(;;){if(E>>>=O=P>>>24,T-=O,!(16&(O=P>>>16&255))){if(0==(64&O)){P=I[(65535&P)+(E&(1<<O)-1)];continue n}l.msg=\"invalid distance code\",u.mode=ll;break e}if(w=65535&P,T<(O&=15)&&(E+=L[p++]<<T,(T+=8)<O&&(E+=L[p++]<<T,T+=8)),(w+=E&(1<<O)-1)>v){l.msg=\"invalid distance too far back\",u.mode=ll;break e}if(E>>>=O,T-=O,w>(O=g-f)){if((O=w-O)>S&&u.sane){l.msg=\"invalid distance too far back\",u.mode=ll;break e}if(N=0,D=C,0===_){if(N+=y-O,O<M){M-=O;do{k[g++]=C[N++]}while(--O);N=g-w,D=k}}else if(_<O){if(N+=y+_-O,(O-=_)<M){M-=O;do{k[g++]=C[N++]}while(--O);if(N=0,_<M){M-=O=_;do{k[g++]=C[N++]}while(--O);N=g-w,D=k}}}else if(N+=_-O,O<M){M-=O;do{k[g++]=C[N++]}while(--O);N=g-w,D=k}for(;M>2;)k[g++]=D[N++],k[g++]=D[N++],k[g++]=D[N++],M-=3;M&&(k[g++]=D[N++],M>1&&(k[g++]=D[N++]))}else{N=g-w;do{k[g++]=k[N++],k[g++]=k[N++],k[g++]=k[N++],M-=3}while(M>2);M&&(k[g++]=k[N++],M>1&&(k[g++]=k[N++]))}break}}break}}while(p<h&&g<m);p-=M=T>>3,E&=(1<<(T-=M<<3))-1,l.next_in=p,l.next_out=g,l.avail_in=p<h?h-p+5:5-(p-h),l.avail_out=g<m?m-g+257:257-(g-m),u.hold=E,u.bits=T},pl=15,hl=852,gl=592,fl=0,ml=1,vl=2,yl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Sl=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Cl=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],El=function inflate_table(l,d,u,p,h,g,f,m){var v,y,S,_,C,E,T,b,I,A=m.bits,R=0,P=0,O=0,M=0,w=0,N=0,D=0,L=0,k=0,x=0,F=null,U=0,j=new gs.Buf16(pl+1),B=new gs.Buf16(pl+1),V=null,H=0;for(R=0;R<=pl;R++)j[R]=0;for(P=0;P<p;P++)j[d[u+P]]++;for(w=A,M=pl;M>=1&&0===j[M];M--);if(w>M&&(w=M),0===M)return h[g++]=20971520,h[g++]=20971520,m.bits=1,0;for(O=1;O<M&&0===j[O];O++);for(w<O&&(w=O),L=1,R=1;R<=pl;R++)if(L<<=1,(L-=j[R])<0)return-1;if(L>0&&(l===fl||1!==M))return-1;for(B[1]=0,R=1;R<pl;R++)B[R+1]=B[R]+j[R];for(P=0;P<p;P++)0!==d[u+P]&&(f[B[d[u+P]]++]=P);if(l===fl?(F=V=f,E=19):l===ml?(F=yl,U-=257,V=Sl,H-=257,E=256):(F=_l,V=Cl,E=-1),x=0,P=0,R=O,C=g,N=w,D=0,S=-1,_=(k=1<<w)-1,l===ml&&k>hl||l===vl&&k>gl)return 1;for(;;){T=R-D,f[P]<E?(b=0,I=f[P]):f[P]>E?(b=V[H+f[P]],I=F[U+f[P]]):(b=96,I=0),v=1<<R-D,O=y=1<<N;do{h[C+(x>>D)+(y-=v)]=T<<24|b<<16|I|0}while(0!==y);for(v=1<<R-1;x&v;)v>>=1;if(0!==v?(x&=v-1,x+=v):x=0,P++,0==--j[R]){if(R===M)break;R=d[u+f[P]]}if(R>w&&(x&_)!==S){for(0===D&&(D=w),C+=O,L=1<<(N=R-D);N+D<M&&!((L-=j[N+D])<=0);)N++,L<<=1;if(k+=1<<N,l===ml&&k>hl||l===vl&&k>gl)return 1;h[S=x&_]=w<<24|N<<16|C-g|0}}return 0!==x&&(h[C+x]=R-D<<24|64<<16|0),m.bits=w,0},Tl=0,bl=1,Il=2,Al=4,Rl=5,Pl=6,Ol=0,Ml=1,wl=2,Nl=-2,Dl=-3,Ll=-4,kl=-5,xl=8,Fl=1,Ul=2,jl=3,Bl=4,Vl=5,Hl=6,Gl=7,Wl=8,ql=9,zl=10,Kl=11,Jl=12,Ql=13,Yl=14,$l=15,Xl=16,Zl=17,ed=18,td=19,nd=20,id=21,rd=22,od=23,ad=24,sd=25,cd=26,ld=27,dd=28,ud=29,pd=30,hd=31,gd=32,fd=852,md=592,vd=15;function zswap32(l){return(l>>>24&255)+(l>>>8&65280)+((65280&l)<<8)+((255&l)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new gs.Buf16(320),this.work=new gs.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(l){var d;return l&&l.state?(d=l.state,l.total_in=l.total_out=d.total=0,l.msg=\"\",d.wrap&&(l.adler=1&d.wrap),d.mode=Fl,d.last=0,d.havedict=0,d.dmax=32768,d.head=null,d.hold=0,d.bits=0,d.lencode=d.lendyn=new gs.Buf32(fd),d.distcode=d.distdyn=new gs.Buf32(md),d.sane=1,d.back=-1,Ol):Nl}function inflateReset(l){var d;return l&&l.state?((d=l.state).wsize=0,d.whave=0,d.wnext=0,inflateResetKeep(l)):Nl}function inflateReset2(l,d){var u,p;return l&&l.state?(p=l.state,d<0?(u=0,d=-d):(u=1+(d>>4),d<48&&(d&=15)),d&&(d<8||d>15)?Nl:(null!==p.window&&p.wbits!==d&&(p.window=null),p.wrap=u,p.wbits=d,inflateReset(l))):Nl}function inflateInit2(l,d){var u,p;return l?(p=new InflateState,l.state=p,p.window=null,(u=inflateReset2(l,d))!==Ol&&(l.state=null),u):Nl}function inflateInit(l){return inflateInit2(l,vd)}var yd,Sd,_d=!0;function fixedtables(l){if(_d){var d;for(yd=new gs.Buf32(512),Sd=new gs.Buf32(32),d=0;d<144;)l.lens[d++]=8;for(;d<256;)l.lens[d++]=9;for(;d<280;)l.lens[d++]=7;for(;d<288;)l.lens[d++]=8;for(El(bl,l.lens,0,288,yd,0,l.work,{bits:9}),d=0;d<32;)l.lens[d++]=5;El(Il,l.lens,0,32,Sd,0,l.work,{bits:5}),_d=!1}l.lencode=yd,l.lenbits=9,l.distcode=Sd,l.distbits=5}function updatewindow(l,d,u,p){var h,g=l.state;return null===g.window&&(g.wsize=1<<g.wbits,g.wnext=0,g.whave=0,g.window=new gs.Buf8(g.wsize)),p>=g.wsize?(gs.arraySet(g.window,d,u-g.wsize,g.wsize,0),g.wnext=0,g.whave=g.wsize):((h=g.wsize-g.wnext)>p&&(h=p),gs.arraySet(g.window,d,u-p,h,g.wnext),(p-=h)?(gs.arraySet(g.window,d,u-p,p,0),g.wnext=p,g.whave=g.wsize):(g.wnext+=h,g.wnext===g.wsize&&(g.wnext=0),g.whave<g.wsize&&(g.whave+=h))),0}function inflate(l,d){var u,p,h,g,f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k=0,x=new gs.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!l||!l.state||!l.output||!l.input&&0!==l.avail_in)return Nl;(u=l.state).mode===Jl&&(u.mode=Ql),f=l.next_out,h=l.output,v=l.avail_out,g=l.next_in,p=l.input,m=l.avail_in,y=u.hold,S=u.bits,_=m,C=v,N=Ol;e:for(;;)switch(u.mode){case Fl:if(0===u.wrap){u.mode=Ql;break}for(;S<16;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(2&u.wrap&&35615===y){u.check=0,x[0]=255&y,x[1]=y>>>8&255,u.check=nc(u.check,x,2,0),y=0,S=0,u.mode=Ul;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&y)<<8)+(y>>8))%31){l.msg=\"incorrect header check\",u.mode=pd;break}if((15&y)!==xl){l.msg=\"unknown compression method\",u.mode=pd;break}if(S-=4,w=8+(15&(y>>>=4)),0===u.wbits)u.wbits=w;else if(w>u.wbits){l.msg=\"invalid window size\",u.mode=pd;break}u.dmax=1<<w,l.adler=u.check=1,u.mode=512&y?zl:Jl,y=0,S=0;break;case Ul:for(;S<16;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(u.flags=y,(255&u.flags)!==xl){l.msg=\"unknown compression method\",u.mode=pd;break}if(57344&u.flags){l.msg=\"unknown header flags set\",u.mode=pd;break}u.head&&(u.head.text=y>>8&1),512&u.flags&&(x[0]=255&y,x[1]=y>>>8&255,u.check=nc(u.check,x,2,0)),y=0,S=0,u.mode=jl;case jl:for(;S<32;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}u.head&&(u.head.time=y),512&u.flags&&(x[0]=255&y,x[1]=y>>>8&255,x[2]=y>>>16&255,x[3]=y>>>24&255,u.check=nc(u.check,x,4,0)),y=0,S=0,u.mode=Bl;case Bl:for(;S<16;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}u.head&&(u.head.xflags=255&y,u.head.os=y>>8),512&u.flags&&(x[0]=255&y,x[1]=y>>>8&255,u.check=nc(u.check,x,2,0)),y=0,S=0,u.mode=Vl;case Vl:if(1024&u.flags){for(;S<16;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}u.length=y,u.head&&(u.head.extra_len=y),512&u.flags&&(x[0]=255&y,x[1]=y>>>8&255,u.check=nc(u.check,x,2,0)),y=0,S=0}else u.head&&(u.head.extra=null);u.mode=Hl;case Hl:if(1024&u.flags&&((E=u.length)>m&&(E=m),E&&(u.head&&(w=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),gs.arraySet(u.head.extra,p,g,E,w)),512&u.flags&&(u.check=nc(u.check,p,E,g)),m-=E,g+=E,u.length-=E),u.length))break e;u.length=0,u.mode=Gl;case Gl:if(2048&u.flags){if(0===m)break e;E=0;do{w=p[g+E++],u.head&&w&&u.length<65536&&(u.head.name+=String.fromCharCode(w))}while(w&&E<m);if(512&u.flags&&(u.check=nc(u.check,p,E,g)),m-=E,g+=E,w)break e}else u.head&&(u.head.name=null);u.length=0,u.mode=Wl;case Wl:if(4096&u.flags){if(0===m)break e;E=0;do{w=p[g+E++],u.head&&w&&u.length<65536&&(u.head.comment+=String.fromCharCode(w))}while(w&&E<m);if(512&u.flags&&(u.check=nc(u.check,p,E,g)),m-=E,g+=E,w)break e}else u.head&&(u.head.comment=null);u.mode=ql;case ql:if(512&u.flags){for(;S<16;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(y!==(65535&u.check)){l.msg=\"header crc mismatch\",u.mode=pd;break}y=0,S=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),l.adler=u.check=0,u.mode=Jl;break;case zl:for(;S<32;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}l.adler=u.check=zswap32(y),y=0,S=0,u.mode=Kl;case Kl:if(0===u.havedict)return l.next_out=f,l.avail_out=v,l.next_in=g,l.avail_in=m,u.hold=y,u.bits=S,wl;l.adler=u.check=1,u.mode=Jl;case Jl:if(d===Rl||d===Pl)break e;case Ql:if(u.last){y>>>=7&S,S-=7&S,u.mode=ld;break}for(;S<3;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}switch(u.last=1&y,S-=1,3&(y>>>=1)){case 0:u.mode=Yl;break;case 1:if(fixedtables(u),u.mode=nd,d===Pl){y>>>=2,S-=2;break e}break;case 2:u.mode=Zl;break;case 3:l.msg=\"invalid block type\",u.mode=pd}y>>>=2,S-=2;break;case Yl:for(y>>>=7&S,S-=7&S;S<32;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){l.msg=\"invalid stored block lengths\",u.mode=pd;break}if(u.length=65535&y,y=0,S=0,u.mode=$l,d===Pl)break e;case $l:u.mode=Xl;case Xl:if(E=u.length){if(E>m&&(E=m),E>v&&(E=v),0===E)break e;gs.arraySet(h,p,g,E,f),m-=E,g+=E,v-=E,f+=E,u.length-=E;break}u.mode=Jl;break;case Zl:for(;S<14;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(u.nlen=257+(31&y),y>>>=5,S-=5,u.ndist=1+(31&y),y>>>=5,S-=5,u.ncode=4+(15&y),y>>>=4,S-=4,u.nlen>286||u.ndist>30){l.msg=\"too many length or distance symbols\",u.mode=pd;break}u.have=0,u.mode=ed;case ed:for(;u.have<u.ncode;){for(;S<3;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}u.lens[F[u.have++]]=7&y,y>>>=3,S-=3}for(;u.have<19;)u.lens[F[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,D={bits:u.lenbits},N=El(Tl,u.lens,0,19,u.lencode,0,u.work,D),u.lenbits=D.bits,N){l.msg=\"invalid code lengths set\",u.mode=pd;break}u.have=0,u.mode=td;case td:for(;u.have<u.nlen+u.ndist;){for(;A=(k=u.lencode[y&(1<<u.lenbits)-1])>>>16&255,R=65535&k,!((I=k>>>24)<=S);){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(R<16)y>>>=I,S-=I,u.lens[u.have++]=R;else{if(16===R){for(L=I+2;S<L;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(y>>>=I,S-=I,0===u.have){l.msg=\"invalid bit length repeat\",u.mode=pd;break}w=u.lens[u.have-1],E=3+(3&y),y>>>=2,S-=2}else if(17===R){for(L=I+3;S<L;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}S-=I,w=0,E=3+(7&(y>>>=I)),y>>>=3,S-=3}else{for(L=I+7;S<L;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}S-=I,w=0,E=11+(127&(y>>>=I)),y>>>=7,S-=7}if(u.have+E>u.nlen+u.ndist){l.msg=\"invalid bit length repeat\",u.mode=pd;break}for(;E--;)u.lens[u.have++]=w}}if(u.mode===pd)break;if(0===u.lens[256]){l.msg=\"invalid code -- missing end-of-block\",u.mode=pd;break}if(u.lenbits=9,D={bits:u.lenbits},N=El(bl,u.lens,0,u.nlen,u.lencode,0,u.work,D),u.lenbits=D.bits,N){l.msg=\"invalid literal/lengths set\",u.mode=pd;break}if(u.distbits=6,u.distcode=u.distdyn,D={bits:u.distbits},N=El(Il,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,D),u.distbits=D.bits,N){l.msg=\"invalid distances set\",u.mode=pd;break}if(u.mode=nd,d===Pl)break e;case nd:u.mode=id;case id:if(m>=6&&v>=258){l.next_out=f,l.avail_out=v,l.next_in=g,l.avail_in=m,u.hold=y,u.bits=S,ul(l,C),f=l.next_out,h=l.output,v=l.avail_out,g=l.next_in,p=l.input,m=l.avail_in,y=u.hold,S=u.bits,u.mode===Jl&&(u.back=-1);break}for(u.back=0;A=(k=u.lencode[y&(1<<u.lenbits)-1])>>>16&255,R=65535&k,!((I=k>>>24)<=S);){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(A&&0==(240&A)){for(P=I,O=A,M=R;A=(k=u.lencode[M+((y&(1<<P+O)-1)>>P)])>>>16&255,R=65535&k,!(P+(I=k>>>24)<=S);){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}y>>>=P,S-=P,u.back+=P}if(y>>>=I,S-=I,u.back+=I,u.length=R,0===A){u.mode=cd;break}if(32&A){u.back=-1,u.mode=Jl;break}if(64&A){l.msg=\"invalid literal/length code\",u.mode=pd;break}u.extra=15&A,u.mode=rd;case rd:if(u.extra){for(L=u.extra;S<L;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}u.length+=y&(1<<u.extra)-1,y>>>=u.extra,S-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=od;case od:for(;A=(k=u.distcode[y&(1<<u.distbits)-1])>>>16&255,R=65535&k,!((I=k>>>24)<=S);){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(0==(240&A)){for(P=I,O=A,M=R;A=(k=u.distcode[M+((y&(1<<P+O)-1)>>P)])>>>16&255,R=65535&k,!(P+(I=k>>>24)<=S);){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}y>>>=P,S-=P,u.back+=P}if(y>>>=I,S-=I,u.back+=I,64&A){l.msg=\"invalid distance code\",u.mode=pd;break}u.offset=R,u.extra=15&A,u.mode=ad;case ad:if(u.extra){for(L=u.extra;S<L;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}u.offset+=y&(1<<u.extra)-1,y>>>=u.extra,S-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){l.msg=\"invalid distance too far back\",u.mode=pd;break}u.mode=sd;case sd:if(0===v)break e;if(E=C-v,u.offset>E){if((E=u.offset-E)>u.whave&&u.sane){l.msg=\"invalid distance too far back\",u.mode=pd;break}E>u.wnext?(E-=u.wnext,T=u.wsize-E):T=u.wnext-E,E>u.length&&(E=u.length),b=u.window}else b=h,T=f-u.offset,E=u.length;E>v&&(E=v),v-=E,u.length-=E;do{h[f++]=b[T++]}while(--E);0===u.length&&(u.mode=id);break;case cd:if(0===v)break e;h[f++]=u.length,v--,u.mode=id;break;case ld:if(u.wrap){for(;S<32;){if(0===m)break e;m--,y|=p[g++]<<S,S+=8}if(C-=v,l.total_out+=C,u.total+=C,C&&(l.adler=u.check=u.flags?nc(u.check,h,C,f-C):Zs(u.check,h,C,f-C)),C=v,(u.flags?y:zswap32(y))!==u.check){l.msg=\"incorrect data check\",u.mode=pd;break}y=0,S=0}u.mode=dd;case dd:if(u.wrap&&u.flags){for(;S<32;){if(0===m)break e;m--,y+=p[g++]<<S,S+=8}if(y!==(4294967295&u.total)){l.msg=\"incorrect length check\",u.mode=pd;break}y=0,S=0}u.mode=ud;case ud:N=Ml;break e;case pd:N=Dl;break e;case hd:return Ll;case gd:default:return Nl}return l.next_out=f,l.avail_out=v,l.next_in=g,l.avail_in=m,u.hold=y,u.bits=S,(u.wsize||C!==l.avail_out&&u.mode<pd&&(u.mode<ld||d!==Al))&&updatewindow(l,l.output,l.next_out,C-l.avail_out),_-=l.avail_in,C-=l.avail_out,l.total_in+=_,l.total_out+=C,u.total+=C,u.wrap&&C&&(l.adler=u.check=u.flags?nc(u.check,h,C,l.next_out-C):Zs(u.check,h,C,l.next_out-C)),l.data_type=u.bits+(u.last?64:0)+(u.mode===Jl?128:0)+(u.mode===nd||u.mode===$l?256:0),(0===_&&0===C||d===Al)&&N===Ol&&(N=kl),N}function inflateEnd(l){if(!l||!l.state)return Nl;var d=l.state;return d.window&&(d.window=null),l.state=null,Ol}function inflateGetHeader(l,d){var u;return l&&l.state?0==(2&(u=l.state).wrap)?Nl:(u.head=d,d.done=!1,Ol):Nl}function inflateSetDictionary(l,d){var u,p=d.length;return l&&l.state?0!==(u=l.state).wrap&&u.mode!==Kl?Nl:u.mode===Kl&&Zs(1,d,p,0)!==u.check?Dl:updatewindow(l,d,p,p)?(u.mode=hd,Ll):(u.havedict=1,Ol):Nl}var Cd={inflateReset:inflateReset,inflateReset2:inflateReset2,inflateResetKeep:inflateResetKeep,inflateInit:inflateInit,inflateInit2:inflateInit2,inflate:inflate,inflateEnd:inflateEnd,inflateGetHeader:inflateGetHeader,inflateSetDictionary:inflateSetDictionary,inflateInfo:\"pako inflate (from Nodeca project)\"},Ed={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=\"\",this.comment=\"\",this.hcrc=0,this.done=!1}var Td=GZheader,bd=Object.prototype.toString;function Inflate(l){if(!(this instanceof Inflate))return new Inflate(l);this.options=gs.assign({chunkSize:16384,windowBits:0,to:\"\"},l||{});var d=this.options;d.raw&&d.windowBits>=0&&d.windowBits<16&&(d.windowBits=-d.windowBits,0===d.windowBits&&(d.windowBits=-15)),!(d.windowBits>=0&&d.windowBits<16)||l&&l.windowBits||(d.windowBits+=32),d.windowBits>15&&d.windowBits<48&&0==(15&d.windowBits)&&(d.windowBits|=15),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new Xc,this.strm.avail_out=0;var u=Cd.inflateInit2(this.strm,d.windowBits);if(u!==Ed.Z_OK)throw new Error(ic[u]);this.header=new Td,Cd.inflateGetHeader(this.strm,this.header)}function inflate$1(l,d){var u=new Inflate(d);if(u.push(l,!0),u.err)throw u.msg;return u.result}function inflateRaw(l,d){return(d=d||{}).raw=!0,inflate$1(l,d)}Inflate.prototype.push=function(l,d){var u,p,h,g,f,m,v=this.strm,y=this.options.chunkSize,S=this.options.dictionary,_=!1;if(this.ended)return!1;p=d===~~d?d:!0===d?Ed.Z_FINISH:Ed.Z_NO_FLUSH,\"string\"==typeof l?v.input=$c.binstring2buf(l):\"[object ArrayBuffer]\"===bd.call(l)?v.input=new Uint8Array(l):v.input=l,v.next_in=0,v.avail_in=v.input.length;do{if(0===v.avail_out&&(v.output=new gs.Buf8(y),v.next_out=0,v.avail_out=y),(u=Cd.inflate(v,Ed.Z_NO_FLUSH))===Ed.Z_NEED_DICT&&S&&(m=\"string\"==typeof S?$c.string2buf(S):\"[object ArrayBuffer]\"===bd.call(S)?new Uint8Array(S):S,u=Cd.inflateSetDictionary(this.strm,m)),u===Ed.Z_BUF_ERROR&&!0===_&&(u=Ed.Z_OK,_=!1),u!==Ed.Z_STREAM_END&&u!==Ed.Z_OK)return this.onEnd(u),this.ended=!0,!1;v.next_out&&(0!==v.avail_out&&u!==Ed.Z_STREAM_END&&(0!==v.avail_in||p!==Ed.Z_FINISH&&p!==Ed.Z_SYNC_FLUSH)||(\"string\"===this.options.to?(h=$c.utf8border(v.output,v.next_out),g=v.next_out-h,f=$c.buf2string(v.output,h),v.next_out=g,v.avail_out=y-g,g&&gs.arraySet(v.output,v.output,h,g,0),this.onData(f)):this.onData(gs.shrinkBuf(v.output,v.next_out)))),0===v.avail_in&&0===v.avail_out&&(_=!0)}while((v.avail_in>0||0===v.avail_out)&&u!==Ed.Z_STREAM_END);return u===Ed.Z_STREAM_END&&(p=Ed.Z_FINISH),p===Ed.Z_FINISH?(u=Cd.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===Ed.Z_OK):p!==Ed.Z_SYNC_FLUSH||(this.onEnd(Ed.Z_OK),v.avail_out=0,!0)},Inflate.prototype.onData=function(l){this.chunks.push(l)},Inflate.prototype.onEnd=function(l){l===Ed.Z_OK&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=gs.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};var Id={Inflate:Inflate,inflate:inflate$1,inflateRaw:inflateRaw,ungzip:inflate$1},Ad={};(0,gs.assign)(Ad,cl,Id,Ed);var Rd=Ad;function defer$1(){let l,d,u=!0;return{isPending:()=>u,promise:new Promise(((u,p)=>{l=u,d=p})),resolve:d=>{u&&(l(d),u=!1)},reject:l=>{u&&(d(l),u=!1)}}}function sleep(l){return new Promise((d=>_setTimeout(d,l)))}function _setTimeout(l,d){return void 0!==window?window.setTimeout(l,d):setTimeout(l,d)}function _clearTimeout(l){void 0!==window?window.clearTimeout(l):clearTimeout(l)}function wait(l,d){let u,p=defer$1();try{u=l()}catch(l){return Promise.reject(p.reject(l))}if(d<0)return u.finally((()=>{p.resolve(u)})),p.promise;const h=_setTimeout((()=>{p.isPending()&&p.reject(new CallingCommunicationError({message:\"Operation timed out\",code:Ce}))}),d);return u.catch((l=>{_clearTimeout(h),p.isPending()&&p.reject(l)})),u.finally((()=>{_clearTimeout(h),p.isPending()&&p.resolve(u)})),p.promise}function dictOrderGreaterFirst(l,d){var u=l.toString(),p=d.toString();return u>p?1:u<p?-1:0}var Pd=dictOrderGreaterFirst;function _classCallCheck(l,d){if(!(l instanceof d))throw new TypeError(\"Cannot call a class as a function\")}function _defineProperties(l,d){for(var u=0;u<d.length;u++){var p=d[u];p.enumerable=p.enumerable||!1,p.configurable=!0,\"value\"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}function _createClass(l,d,u){return d&&_defineProperties(l.prototype,d),u&&_defineProperties(l,u),l}function _defineProperty(l,d,u){return d in l?Object.defineProperty(l,d,{value:u,enumerable:!0,configurable:!0,writable:!0}):l[d]=u,l}function _typeof(l){return(_typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function _typeof(l){return typeof l}:function _typeof(l){return l&&\"function\"==typeof Symbol&&l.constructor===Symbol&&l!==Symbol.prototype?\"symbol\":typeof l})(l)}function _toConsumableArray(l){return _arrayWithoutHoles(l)||_iterableToArray(l)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function _iterableToArray(l){if(Symbol.iterator in Object(l)||\"[object Arguments]\"===Object.prototype.toString.call(l))return Array.from(l)}function _arrayWithoutHoles(l){if(Array.isArray(l)){for(var d=0,u=new Array(l.length);d<l.length;d++)u[d]=l[d];return u}}function _classCallCheck$1(l,d){if(!(l instanceof d))throw new TypeError(\"Cannot call a class as a function\")}function _defineProperties$1(l,d){for(var u=0;u<d.length;u++){var p=d[u];p.enumerable=p.enumerable||!1,p.configurable=!0,\"value\"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}function _createClass$1(l,d,u){return d&&_defineProperties$1(l.prototype,d),u&&_defineProperties$1(l,u),l}function _possibleConstructorReturn(l,d){return!d||\"object\"!==_typeof(d)&&\"function\"!=typeof d?_assertThisInitialized(l):d}function _getPrototypeOf(l){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(l){return l.__proto__||Object.getPrototypeOf(l)})(l)}function _assertThisInitialized(l){if(void 0===l)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return l}function _inherits(l,d){if(\"function\"!=typeof d&&null!==d)throw new TypeError(\"Super expression must either be null or a function\");l.prototype=Object.create(d&&d.prototype,{constructor:{value:l,writable:!0,configurable:!0}}),d&&_setPrototypeOf(l,d)}function _setPrototypeOf(l,d){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(l,d){return l.__proto__=d,l})(l,d)}function _defineProperty$1(l,d,u){return d in l?Object.defineProperty(l,d,{value:u,enumerable:!0,configurable:!0,writable:!0}):l[d]=u,l}function getLargestIndex(l,d,u){var p=2*d,h=2*d+1,g=d;return p<l.length&&u(l[g],l[p])<0&&(g=p),h<l.length&&u(l[g],l[h])<0&&(g=h),g}function heapify(l,d,u){var p=getLargestIndex(l,d,u);if(p!==d){var h=l[d];l[d]=l[p],l[p]=h,heapify(l,p,u)}}function heapifyAll(l){for(var d=Math.floor(l.collection.length/2)-1;d>=0;--d)heapify(l.collection,d,l.comparator)}var Od=function(l){function BinaryHeap(){var l,d;_classCallCheck$1(this,BinaryHeap);for(var u=arguments.length,p=new Array(u),h=0;h<u;h++)p[h]=arguments[h];return _defineProperty$1(_assertThisInitialized(d=_possibleConstructorReturn(this,(l=_getPrototypeOf(BinaryHeap)).call.apply(l,[this].concat(p)))),\"collection\",[]),d}return _inherits(BinaryHeap,l),_createClass$1(BinaryHeap,[{key:\"clear\",value:function clear(){this.collection.length=0}},{key:\"toArray\",value:function toArray(){return _toConsumableArray(this.collection).sort(this.comparator)}},{key:\"top\",value:function top(){if(0===this.length)throw new Error(\"invalid operation: top() called for empty BinaryHeap\");return this.collection[0]}},{key:\"pop\",value:function pop(){if(0===this.length)throw new Error(\"invalid operation: pop() called for empty BinaryHeap\");var l=this.collection[0];return this.collection.length>1?(this.collection[0]=this.collection.pop(),heapify(this.collection,0,this.comparator)):this.collection.pop(),l}},{key:\"push\",value:function push(l){this.collection.push(l);for(var d=this.collection,u=d.length-1,p=Math.floor(u/2);u>0&&this.comparator(d[p],d[u])<0;u=p,p=Math.floor(p/2)){var h=d[u];d[u]=d[p],d[p]=h}}},{key:\"merge\",value:function merge(l){this.collection=l instanceof BinaryHeap?this.collection.concat(l.collection):this.collection.concat(l.toArray()),heapifyAll(this),l.clear()}},{key:\"isEmpty\",value:function isEmpty(){return!this.collection.length}},{key:\"length\",get:function get(){return this.collection.length}}],[{key:\"from\",value:function from(l){var d=new BinaryHeap(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return d.collection=Array.from(l),heapifyAll(d),d}}]),BinaryHeap}(function(){function PriorityQueue(){var l=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).comparator,d=void 0===l?Pd:l;_classCallCheck(this,PriorityQueue),_defineProperty(this,\"comparator\",void 0),this.comparator=d}return _createClass(PriorityQueue,null,[{key:\"from\",value:function from(l,d){throw new Error(\"not implemented\")}}]),_createClass(PriorityQueue,[{key:\"clear\",value:function clear(){throw new Error(\"not implemented\")}},{key:\"toArray\",value:function toArray(){throw new Error(\"not implemented\")}},{key:\"push\",value:function push(l){throw new Error(\"not implemented\")}},{key:\"enqueue\",value:function enqueue(l){return this.push(l)}},{key:\"top\",value:function top(){throw new Error(\"not implemented\")}},{key:\"peek\",value:function peek(){return this.top()}},{key:\"pop\",value:function pop(){throw new Error(\"not implemented\")}},{key:\"dequeue\",value:function dequeue(){return this.pop()}},{key:\"merge\",value:function merge(l){throw new Error(\"not implemented\")}},{key:\"isEmpty\",value:function isEmpty(){throw new Error(\"not implemented\")}},{key:\"length\",get:function get(){throw new Error(\"not implemented\")}}]),PriorityQueue}());class NotificationManager$1{constructor(l,d){this._tenantId=l,this.listeners=[],this._logger=d.createChild(`TelemetryLogger[${l}]`);const u=this._tenantId;d.log(`Notification Manager Notification Manager logger initialized for tenant ${u}`),this._discardedEventsBufferPQ=new Od({comparator:(l,d)=>d.latency-l.latency})}addNotificationListener(l){this.listeners.push(l)}removeNotificationListener(l){this.listeners=this.listeners.filter((d=>d!==l))}eventsSent(l){const d=JSON.stringify(l);this._logger.log(`Notification Manager sent telemetry events ${d}`)}eventsDiscarded(l,d){this._logger.log(`Notification Manager discarded telemetry events ${JSON.stringify(l)}, reason ${d} adding to retry buffer`),l.forEach((l=>{l.latency=l.latency||Pn.Normal;const d=l;(d.sendAttempt||0)<=getAcsEcsConfig().telemetry.discardedEventsMaxRetries?this._discardedEventsBufferPQ.push(d):this._logger.log(`Notification Manager dropping event due to too many retries ${JSON.stringify(l)}`)}));const u=getAcsEcsConfig().telemetry.discardedEventsBufferMaxLength;for(;this._discardedEventsBufferPQ.length>u;)this._logger.log(` dropping event from retry buffer ${this._discardedEventsBufferPQ.dequeue()} due to overflow`)}getDiscardedEvents(){const l=[],d=this._discardedEventsBufferPQ.length;for(let u=0;u<d;u++)l.push(this._discardedEventsBufferPQ.dequeue());return this._logger.log(`Notification Manager get retry bag ${JSON.stringify(l)}`),l}}var Md=createCommonjsModule((function(l,d){!function(u,p){var h=\"1.0.2\",g=\"\",f=\"?\",m=\"function\",v=\"undefined\",y=\"object\",S=\"string\",_=\"major\",C=\"model\",E=\"name\",T=\"type\",b=\"vendor\",I=\"version\",A=\"architecture\",R=\"console\",P=\"mobile\",O=\"tablet\",M=\"smarttv\",w=\"wearable\",N=\"embedded\",D=255,L=\"Amazon\",k=\"Apple\",x=\"ASUS\",F=\"BlackBerry\",U=\"Browser\",j=\"Chrome\",B=\"Firefox\",V=\"Google\",H=\"Huawei\",G=\"LG\",W=\"Microsoft\",q=\"Motorola\",z=\"Opera\",K=\"Samsung\",J=\"Sony\",Q=\"Xiaomi\",Y=\"Zebra\",$=\"Facebook\",extend=function(l,d){var u={};for(var p in l)d[p]&&d[p].length%2==0?u[p]=d[p].concat(l[p]):u[p]=l[p];return u},enumerize=function(l){for(var d={},u=0;u<l.length;u++)d[l[u].toUpperCase()]=l[u];return d},has=function(l,d){return typeof l===S&&-1!==lowerize(d).indexOf(lowerize(l))},lowerize=function(l){return l.toLowerCase()},majorize=function(l){return typeof l===S?l.replace(/[^\\d\\.]/g,g).split(\".\")[0]:p},trim=function(l,d){if(typeof l===S)return l=l.replace(/^\\s\\s*/,g).replace(/\\s\\s*$/,g),typeof d===v?l:l.substring(0,D)},rgxMapper=function(l,d){for(var u,h,g,f,v,S,_=0;_<d.length&&!v;){var C=d[_],E=d[_+1];for(u=h=0;u<C.length&&!v;)if(v=C[u++].exec(l))for(g=0;g<E.length;g++)S=v[++h],typeof(f=E[g])===y&&f.length>0?2===f.length?typeof f[1]==m?this[f[0]]=f[1].call(this,S):this[f[0]]=f[1]:3===f.length?typeof f[1]!==m||f[1].exec&&f[1].test?this[f[0]]=S?S.replace(f[1],f[2]):p:this[f[0]]=S?f[1].call(this,S,f[2]):p:4===f.length&&(this[f[0]]=S?f[3].call(this,S.replace(f[1],f[2])):p):this[f]=S||p;_+=2}},strMapper=function(l,d){for(var u in d)if(typeof d[u]===y&&d[u].length>0){for(var h=0;h<d[u].length;h++)if(has(d[u][h],l))return u===f?p:u}else if(has(d[u],l))return u===f?p:u;return l},X={ME:\"4.90\",\"NT 3.11\":\"NT3.51\",\"NT 4.0\":\"NT4.0\",2e3:\"NT 5.0\",XP:[\"NT 5.1\",\"NT 5.2\"],Vista:\"NT 6.0\",7:\"NT 6.1\",8:\"NT 6.2\",8.1:\"NT 6.3\",10:[\"NT 6.4\",\"NT 10.0\"],RT:\"ARM\"},Z={browser:[[/\\b(?:crmo|crios)\\/([\\w\\.]+)/i],[I,[E,\"Chrome\"]],[/edg(?:e|ios|a)?\\/([\\w\\.]+)/i],[I,[E,\"Edge\"]],[/(opera mini)\\/([-\\w\\.]+)/i,/(opera [mobiletab]{3,6})\\b.+version\\/([-\\w\\.]+)/i,/(opera)(?:.+version\\/|[\\/ ]+)([\\w\\.]+)/i],[E,I],[/opios[\\/ ]+([\\w\\.]+)/i],[I,[E,z+\" Mini\"]],[/\\bopr\\/([\\w\\.]+)/i],[I,[E,z]],[/(kindle)\\/([\\w\\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\\/ ]?([\\w\\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\\/ ]?([\\w\\.]*)/i,/(ba?idubrowser)[\\/ ]?([\\w\\.]+)/i,/(?:ms|\\()(ie) ([\\w\\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\\/([-\\w\\.]+)/i,/(weibo)__([\\d\\.]+)/i],[E,I],[/(?:\\buc? ?browser|(?:juc.+)ucweb)[\\/ ]?([\\w\\.]+)/i],[I,[E,\"UC\"+U]],[/\\bqbcore\\/([\\w\\.]+)/i],[I,[E,\"WeChat(Win) Desktop\"]],[/micromessenger\\/([\\w\\.]+)/i],[I,[E,\"WeChat\"]],[/konqueror\\/([\\w\\.]+)/i],[I,[E,\"Konqueror\"]],[/trident.+rv[: ]([\\w\\.]{1,9})\\b.+like gecko/i],[I,[E,\"IE\"]],[/yabrowser\\/([\\w\\.]+)/i],[I,[E,\"Yandex\"]],[/(avast|avg)\\/([\\w\\.]+)/i],[[E,/(.+)/,\"$1 Secure \"+U],I],[/\\bfocus\\/([\\w\\.]+)/i],[I,[E,B+\" Focus\"]],[/\\bopt\\/([\\w\\.]+)/i],[I,[E,z+\" Touch\"]],[/coc_coc\\w+\\/([\\w\\.]+)/i],[I,[E,\"Coc Coc\"]],[/dolfin\\/([\\w\\.]+)/i],[I,[E,\"Dolphin\"]],[/coast\\/([\\w\\.]+)/i],[I,[E,z+\" Coast\"]],[/miuibrowser\\/([\\w\\.]+)/i],[I,[E,\"MIUI \"+U]],[/fxios\\/([-\\w\\.]+)/i],[I,[E,B]],[/\\bqihu|(qi?ho?o?|360)browser/i],[[E,\"360 \"+U]],[/(oculus|samsung|sailfish)browser\\/([\\w\\.]+)/i],[[E,/(.+)/,\"$1 \"+U],I],[/(comodo_dragon)\\/([\\w\\.]+)/i],[[E,/_/g,\" \"],I],[/(electron)\\/([\\w\\.]+) safari/i,/(tesla)(?: qtcarbrowser|\\/(20\\d\\d\\.[-\\w\\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\\/ ]?([\\w\\.]+)/i],[E,I],[/(metasr)[\\/ ]?([\\w\\.]+)/i,/(lbbrowser)/i],[E],[/((?:fban\\/fbios|fb_iab\\/fb4a)(?!.+fbav)|;fbav\\/([\\w\\.]+);)/i],[[E,$],I],[/safari (line)\\/([\\w\\.]+)/i,/\\b(line)\\/([\\w\\.]+)\\/iab/i,/(chromium|instagram)[\\/ ]([-\\w\\.]+)/i],[E,I],[/\\bgsa\\/([\\w\\.]+) .*safari\\//i],[I,[E,\"GSA\"]],[/headlesschrome(?:\\/([\\w\\.]+)| )/i],[I,[E,j+\" Headless\"]],[/ wv\\).+(chrome)\\/([\\w\\.]+)/i],[[E,j+\" WebView\"],I],[/droid.+ version\\/([\\w\\.]+)\\b.+(?:mobile safari|safari)/i],[I,[E,\"Android \"+U]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\\/v?([\\w\\.]+)/i],[E,I],[/version\\/([\\w\\.]+) .*mobile\\/\\w+ (safari)/i],[I,[E,\"Mobile Safari\"]],[/version\\/([\\w\\.]+) .*(mobile ?safari|safari)/i],[I,E],[/webkit.+?(mobile ?safari|safari)(\\/[\\w\\.]+)/i],[E,[I,strMapper,{\"1.0\":\"/8\",1.2:\"/1\",1.3:\"/3\",\"2.0\":\"/412\",\"2.0.2\":\"/416\",\"2.0.3\":\"/417\",\"2.0.4\":\"/419\",\"?\":\"/\"}]],[/(webkit|khtml)\\/([\\w\\.]+)/i],[E,I],[/(navigator|netscape\\d?)\\/([-\\w\\.]+)/i],[[E,\"Netscape\"],I],[/mobile vr; rv:([\\w\\.]+)\\).+firefox/i],[I,[E,B+\" Reality\"]],[/ekiohf.+(flow)\\/([\\w\\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\\/ ]?([\\w\\.\\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\\/([-\\w\\.]+)$/i,/(firefox)\\/([\\w\\.]+)/i,/(mozilla)\\/([\\w\\.]+) .+rv\\:.+gecko\\/\\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\\. ]?browser)[-\\/ ]?v?([\\w\\.]+)/i,/(links) \\(([\\w\\.]+)/i],[E,I]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\\)]/i],[[A,\"amd64\"]],[/(ia32(?=;))/i],[[A,lowerize]],[/((?:i[346]|x)86)[;\\)]/i],[[A,\"ia32\"]],[/\\b(aarch64|arm(v?8e?l?|_?64))\\b/i],[[A,\"arm64\"]],[/\\b(arm(?:v[67])?ht?n?[fl]p?)\\b/i],[[A,\"armhf\"]],[/windows (ce|mobile); ppc;/i],[[A,\"arm\"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\\))/i],[[A,/ower/,g,lowerize]],[/(sun4\\w)[;\\)]/i],[[A,\"sparc\"]],[/((?:avr32|ia64(?=;))|68k(?=\\))|\\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\\b|pa-risc)/i],[[A,lowerize]]],device:[[/\\b(sch-i[89]0\\d|shw-m380s|sm-[pt]\\w{2,4}|gt-[pn]\\d{2,4}|sgh-t8[56]9|nexus 10)/i],[C,[b,K],[T,O]],[/\\b((?:s[cgp]h|gt|sm)-\\w+|galaxy nexus)/i,/samsung[- ]([-\\w]+)/i,/sec-(sgh\\w+)/i],[C,[b,K],[T,P]],[/\\((ip(?:hone|od)[\\w ]*);/i],[C,[b,k],[T,P]],[/\\((ipad);[-\\w\\),; ]+apple/i,/applecoremedia\\/[\\w\\.]+ \\((ipad)/i,/\\b(ipad)\\d\\d?,\\d\\d?[;\\]].+ios/i],[C,[b,k],[T,O]],[/\\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\\d{2})\\b(?!.+d\\/s)/i],[C,[b,H],[T,O]],[/(?:huawei|honor)([-\\w ]+)[;\\)]/i,/\\b(nexus 6p|\\w{2,4}-[atu]?[ln][01259x][012359][an]?)\\b(?!.+d\\/s)/i],[C,[b,H],[T,P]],[/\\b(poco[\\w ]+)(?: bui|\\))/i,/\\b; (\\w+) build\\/hm\\1/i,/\\b(hm[-_ ]?note?[_ ]?(?:\\d\\w)?) bui/i,/\\b(redmi[\\-_ ]?(?:note|k)?[\\w_ ]+)(?: bui|\\))/i,/\\b(mi[-_ ]?(?:a\\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\\d?\\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\\))/i],[[C,/_/g,\" \"],[b,Q],[T,P]],[/\\b(mi[-_ ]?(?:pad)(?:[\\w_ ]+))(?: bui|\\))/i],[[C,/_/g,\" \"],[b,Q],[T,O]],[/; (\\w+) bui.+ oppo/i,/\\b(cph[12]\\d{3}|p(?:af|c[al]|d\\w|e[ar])[mt]\\d0|x9007|a101op)\\b/i],[C,[b,\"OPPO\"],[T,P]],[/vivo (\\w+)(?: bui|\\))/i,/\\b(v[12]\\d{3}\\w?[at])(?: bui|;)/i],[C,[b,\"Vivo\"],[T,P]],[/\\b(rmx[12]\\d{3})(?: bui|;|\\))/i],[C,[b,\"Realme\"],[T,P]],[/\\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\\b[\\w ]+build\\//i,/\\bmot(?:orola)?[- ](\\w*)/i,/((?:moto[\\w\\(\\) ]+|xt\\d{3,4}|nexus 6)(?= bui|\\)))/i],[C,[b,q],[T,P]],[/\\b(mz60\\d|xoom[2 ]{0,2}) build\\//i],[C,[b,q],[T,O]],[/((?=lg)?[vl]k\\-?\\d{3}) bui| 3\\.[-\\w; ]{10}lg?-([06cv9]{3,4})/i],[C,[b,G],[T,O]],[/(lm(?:-?f100[nv]?|-[\\w\\.]+)(?= bui|\\))|nexus [45])/i,/\\blg[-e;\\/ ]+((?!browser|netcast|android tv)\\w+)/i,/\\blg-?([\\d\\w]+) bui/i],[C,[b,G],[T,P]],[/(ideatab[-\\w ]+)/i,/lenovo ?(s[56]000[-\\w]+|tab(?:[\\w ]+)|yt[-\\d\\w]{6}|tb[-\\d\\w]{6})/i],[C,[b,\"Lenovo\"],[T,O]],[/(?:maemo|nokia).*(n900|lumia \\d+)/i,/nokia[-_ ]?([-\\w\\.]*)/i],[[C,/_/g,\" \"],[b,\"Nokia\"],[T,P]],[/(pixel c)\\b/i],[C,[b,V],[T,O]],[/droid.+; (pixel[\\daxl ]{0,6})(?: bui|\\))/i],[C,[b,V],[T,P]],[/droid.+ ([c-g]\\d{4}|so[-gl]\\w+|xq-a\\w[4-7][12])(?= bui|\\).+chrome\\/(?![1-6]{0,1}\\d\\.))/i],[C,[b,J],[T,P]],[/sony tablet [ps]/i,/\\b(?:sony)?sgp\\w+(?: bui|\\))/i],[[C,\"Xperia Tablet\"],[b,J],[T,O]],[/ (kb2005|in20[12]5|be20[12][59])\\b/i,/(?:one)?(?:plus)? (a\\d0\\d\\d)(?: b|\\))/i],[C,[b,\"OnePlus\"],[T,P]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\\))/i,/(kf[a-z]+)( bui|\\)).+silk\\//i],[C,[b,L],[T,O]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\\)).+silk\\//i],[[C,/(.+)/g,\"Fire Phone $1\"],[b,L],[T,P]],[/(playbook);[-\\w\\),; ]+(rim)/i],[C,b,[T,O]],[/\\b((?:bb[a-f]|st[hv])100-\\d)/i,/\\(bb10; (\\w+)/i],[C,[b,F],[T,P]],[/(?:\\b|asus_)(transfo[prime ]{4,10} \\w+|eeepc|slider \\w+|nexus 7|padfone|p00[cj])/i],[C,[b,x],[T,O]],[/ (z[bes]6[027][012][km][ls]|zenfone \\d\\w?)\\b/i],[C,[b,x],[T,P]],[/(nexus 9)/i],[C,[b,\"HTC\"],[T,O]],[/(htc)[-;_ ]{1,2}([\\w ]+(?=\\)| bui)|\\w+)/i,/(zte)[- ]([\\w ]+?)(?: bui|\\/|\\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\\w]*)/i],[b,[C,/_/g,\" \"],[T,P]],[/droid.+; ([ab][1-7]-?[0178a]\\d\\d?)/i],[C,[b,\"Acer\"],[T,O]],[/droid.+; (m[1-5] note) bui/i,/\\bmz-([-\\w]{2,})/i],[C,[b,\"Meizu\"],[T,P]],[/\\b(sh-?[altvz]?\\d\\d[a-ekm]?)/i],[C,[b,\"Sharp\"],[T,P]],[/(blackberry|benq|palm(?=\\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\\w]*)/i,/(hp) ([\\w ]+\\w)/i,/(asus)-?(\\w+)/i,/(microsoft); (lumia[\\w ]+)/i,/(lenovo)[-_ ]?([-\\w]+)/i,/(jolla)/i,/(oppo) ?([\\w ]+) bui/i],[b,C,[T,P]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\\/([\\w\\.]+)/i,/(nook)[\\w ]+build\\/(\\w+)/i,/(dell) (strea[kpr\\d ]*[\\dko])/i,/(le[- ]+pan)[- ]+(\\w{1,9}) bui/i,/(trinity)[- ]*(t\\d{3}) bui/i,/(gigaset)[- ]+(q\\w{1,9}) bui/i,/(vodafone) ([\\w ]+)(?:\\)| bui)/i],[b,C,[T,O]],[/(surface duo)/i],[C,[b,W],[T,O]],[/droid [\\d\\.]+; (fp\\du?)(?: b|\\))/i],[C,[b,\"Fairphone\"],[T,P]],[/(u304aa)/i],[C,[b,\"AT&T\"],[T,P]],[/\\bsie-(\\w*)/i],[C,[b,\"Siemens\"],[T,P]],[/\\b(rct\\w+) b/i],[C,[b,\"RCA\"],[T,O]],[/\\b(venue[\\d ]{2,7}) b/i],[C,[b,\"Dell\"],[T,O]],[/\\b(q(?:mv|ta)\\w+) b/i],[C,[b,\"Verizon\"],[T,O]],[/\\b(?:barnes[& ]+noble |bn[rt])([\\w\\+ ]*) b/i],[C,[b,\"Barnes & Noble\"],[T,O]],[/\\b(tm\\d{3}\\w+) b/i],[C,[b,\"NuVision\"],[T,O]],[/\\b(k88) b/i],[C,[b,\"ZTE\"],[T,O]],[/\\b(nx\\d{3}j) b/i],[C,[b,\"ZTE\"],[T,P]],[/\\b(gen\\d{3}) b.+49h/i],[C,[b,\"Swiss\"],[T,P]],[/\\b(zur\\d{3}) b/i],[C,[b,\"Swiss\"],[T,O]],[/\\b((zeki)?tb.*\\b) b/i],[C,[b,\"Zeki\"],[T,O]],[/\\b([yr]\\d{2}) b/i,/\\b(dragon[- ]+touch |dt)(\\w{5}) b/i],[[b,\"Dragon Touch\"],C,[T,O]],[/\\b(ns-?\\w{0,9}) b/i],[C,[b,\"Insignia\"],[T,O]],[/\\b((nxa|next)-?\\w{0,9}) b/i],[C,[b,\"NextBook\"],[T,O]],[/\\b(xtreme\\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[b,\"Voice\"],C,[T,P]],[/\\b(lvtel\\-)?(v1[12]) b/i],[[b,\"LvTel\"],C,[T,P]],[/\\b(ph-1) /i],[C,[b,\"Essential\"],[T,P]],[/\\b(v(100md|700na|7011|917g).*\\b) b/i],[C,[b,\"Envizen\"],[T,O]],[/\\b(trio[-\\w\\. ]+) b/i],[C,[b,\"MachSpeed\"],[T,O]],[/\\btu_(1491) b/i],[C,[b,\"Rotor\"],[T,O]],[/(shield[\\w ]+) b/i],[C,[b,\"Nvidia\"],[T,O]],[/(sprint) (\\w+)/i],[b,C,[T,P]],[/(kin\\.[onetw]{3})/i],[[C,/\\./g,\" \"],[b,W],[T,P]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\\)/i],[C,[b,Y],[T,O]],[/droid.+; (ec30|ps20|tc[2-8]\\d[kx])\\)/i],[C,[b,Y],[T,P]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[b,C,[T,R]],[/droid.+; (shield) bui/i],[C,[b,\"Nvidia\"],[T,R]],[/(playstation [345portablevi]+)/i],[C,[b,J],[T,R]],[/\\b(xbox(?: one)?(?!; xbox))[\\); ]/i],[C,[b,W],[T,R]],[/smart-tv.+(samsung)/i],[b,[T,M]],[/hbbtv.+maple;(\\d+)/i],[[C,/^/,\"SmartTV\"],[b,K],[T,M]],[/(nux; netcast.+smarttv|lg (netcast\\.tv-201\\d|android tv))/i],[[b,G],[T,M]],[/(apple) ?tv/i],[b,[C,k+\" TV\"],[T,M]],[/crkey/i],[[C,j+\"cast\"],[b,V],[T,M]],[/droid.+aft(\\w)( bui|\\))/i],[C,[b,L],[T,M]],[/\\(dtv[\\);].+(aquos)/i],[C,[b,\"Sharp\"],[T,M]],[/\\b(roku)[\\dx]*[\\)\\/]((?:dvp-)?[\\d\\.]*)/i,/hbbtv\\/\\d+\\.\\d+\\.\\d+ +\\([\\w ]*; *(\\w[^;]*);([^;]*)/i],[[b,trim],[C,trim],[T,M]],[/\\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\\b/i],[[T,M]],[/((pebble))app/i],[b,C,[T,w]],[/droid.+; (glass) \\d/i],[C,[b,V],[T,w]],[/droid.+; (wt63?0{2,3})\\)/i],[C,[b,Y],[T,w]],[/(quest( 2)?)/i],[C,[b,$],[T,w]],[/(tesla)(?: qtcarbrowser|\\/[-\\w\\.]+)/i],[b,[T,N]],[/droid .+?; ([^;]+?)(?: bui|\\) applew).+? mobile safari/i],[C,[T,P]],[/droid .+?; ([^;]+?)(?: bui|\\) applew).+?(?! mobile) safari/i],[C,[T,O]],[/\\b((tablet|tab)[;\\/]|focus\\/\\d(?!.+mobile))/i],[[T,O]],[/(phone|mobile(?:[;\\/]| safari)|pda(?=.+windows ce))/i],[[T,P]],[/(android[-\\w\\. ]{0,9});.+buil/i],[C,[b,\"Generic\"]]],engine:[[/windows.+ edge\\/([\\w\\.]+)/i],[I,[E,\"Edge\"+\"HTML\"]],[/webkit\\/537\\.36.+chrome\\/(?!27)([\\w\\.]+)/i],[I,[E,\"Blink\"]],[/(presto)\\/([\\w\\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\\/([\\w\\.]+)/i,/ekioh(flow)\\/([\\w\\.]+)/i,/(khtml|tasman|links)[\\/ ]\\(?([\\w\\.]+)/i,/(icab)[\\/ ]([23]\\.[\\d\\.]+)/i],[E,I],[/rv\\:([\\w\\.]{1,9})\\b.+(gecko)/i],[I,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,I],[/(windows) nt 6\\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\\/ ]?([\\d\\.\\w ]*)/i,/(windows)[\\/ ]?([ntce\\d\\. ]+\\w)(?!.+xbox)/i],[E,[I,strMapper,X]],[/(win(?=3|9|n)|win 9x )([nt\\d\\.]+)/i],[[E,\"Windows\"],[I,strMapper,X]],[/ip[honead]{2,4}\\b(?:.*os ([\\w]+) like mac|; opera)/i,/cfnetwork\\/.+darwin/i],[[I,/_/g,\".\"],[E,\"iOS\"]],[/(mac os x) ?([\\w\\. ]*)/i,/(macintosh|mac_powerpc\\b)(?!.+haiku)/i],[[E,\"Mac OS\"],[I,/_/g,\".\"]],[/droid ([\\w\\.]+)\\b.+(android[- ]x86)/i],[I,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\\/ ]?([\\w\\.]*)/i,/(blackberry)\\w*\\/([\\w\\.]*)/i,/(tizen|kaios)[\\/ ]([\\w\\.]+)/i,/\\((series40);/i],[E,I],[/\\(bb(10);/i],[I,[E,F]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\\/ ]?([\\w\\.]*)/i],[I,[E,\"Symbian\"]],[/mozilla\\/[\\d\\.]+ \\((?:mobile|tablet|tv|mobile; [\\w ]+); rv:.+ gecko\\/([\\w\\.]+)/i],[I,[E,B+\" OS\"]],[/web0s;.+rt(tv)/i,/\\b(?:hp)?wos(?:browser)?\\/([\\w\\.]+)/i],[I,[E,\"webOS\"]],[/crkey\\/([\\d\\.]+)/i],[I,[E,j+\"cast\"]],[/(cros) [\\w]+ ([\\w\\.]+\\w)/i],[[E,\"Chromium OS\"],I],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\\);]+)/i,/\\b(joli|palm)\\b ?(?:os)?\\/?([\\w\\.]*)/i,/(mint)[\\/\\(\\) ]?(\\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\\/ ]?(?!chrom|package)([-\\w\\.]*)/i,/(hurd|linux) ?([\\w\\.]*)/i,/(gnu) ?([\\w\\.]*)/i,/\\b([-frentopcghs]{0,5}bsd|dragonfly)[\\/ ]?(?!amd|[ix346]{1,2}86)([\\w\\.]*)/i,/(haiku) (\\w+)/i],[E,I],[/(sunos) ?([\\w\\.\\d]*)/i],[[E,\"Solaris\"],I],[/((?:open)?solaris)[-\\/ ]?([\\w\\.]*)/i,/(aix) ((\\d)(?=\\.|\\)| )[\\w\\.])*/i,/\\b(beos|os\\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\\w\\.]*)/i],[E,I]]},UAParser=function(l,d){if(typeof l===y&&(d=l,l=p),!(this instanceof UAParser))return new UAParser(l,d).getResult();var h=l||(typeof u!==v&&u.navigator&&u.navigator.userAgent?u.navigator.userAgent:g),f=d?extend(Z,d):Z;return this.getBrowser=function(){var l={};return l[E]=p,l[I]=p,rgxMapper.call(l,h,f.browser),l.major=majorize(l.version),l},this.getCPU=function(){var l={};return l[A]=p,rgxMapper.call(l,h,f.cpu),l},this.getDevice=function(){var l={};return l[b]=p,l[C]=p,l[T]=p,rgxMapper.call(l,h,f.device),l},this.getEngine=function(){var l={};return l[E]=p,l[I]=p,rgxMapper.call(l,h,f.engine),l},this.getOS=function(){var l={};return l[E]=p,l[I]=p,rgxMapper.call(l,h,f.os),l},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return h},this.setUA=function(l){return h=typeof l===S&&l.length>D?trim(l,D):l,this},this.setUA(h),this};UAParser.VERSION=h,UAParser.BROWSER=enumerize([E,I,_]),UAParser.CPU=enumerize([A]),UAParser.DEVICE=enumerize([C,b,T,R,P,M,O,w,N]),UAParser.ENGINE=UAParser.OS=enumerize([E,I]),l.exports&&(d=l.exports=UAParser),d.UAParser=UAParser;var ee=typeof u!==v&&(u.jQuery||u.Zepto);if(ee&&!ee.ua){var te=new UAParser;ee.ua=te.getResult(),ee.ua.get=function(){return te.getUA()},ee.ua.set=function(l){te.setUA(l);var d=te.getResult();for(var u in d)ee.ua[u]=d[u]}}}(\"object\"==typeof window?window:h)}));const wd=[{name:\"edge\",engine:\"Edge\",key:\"Edge\"},{name:\"edgeanaheim\",engine:\"Chromium\",key:\"Edg\"},{name:\"chromium\",engine:\"Chromium\",key:\"Chromium\"},{name:\"opera\",engine:\"Chromium\",key:\"OPR\"},{name:\"yandexbrowser\",engine:\"Chromium\",key:\"YaBrowser\"},{name:\"chrome\",engine:\"Chromium\",key:\"Chrome\"},{name:\"firefox\",engine:\"Firefox\",key:\"Firefox\"},{name:\"safari\",engine:\"Safari\",key:\"Safari\"},{name:\"ie\",engine:\"MSIE\",key:\"Trident\"}],Nd=\"0.0\",Dd=\"unknown\";function getFormFactor(l){return/iPhone|iPad|iPod|Android|Mobi/i.test(l)?\"Mobile\":\"Desktop\"}function isAndroid(l){const d=!/like android/i.test(l),u=/android/i.test(l);return d&&u}function getEnvironmentDetails(){return(new Md.UAParser).getResult()}function getPlatformName(){const l=getEnvironmentDetails().ua;return-1!==l.indexOf(\"Edge\")?\"edge\":-1!==l.indexOf(\"Chrome\")?\"chrome\":-1!==l.indexOf(\"Firefox\")?\"firefox\":-1!==l.indexOf(\"Safari\")?\"safari\":-1!==l.indexOf(\"Trident\")?\"ie\":\"unknown\"}function getEngine(l,d){let u=Dd;return d.some((d=>-1!==l.indexOf(d.key)&&(u=d.engine,!0))),u}function getBrowserName(l,d){let u=Dd;return d.some((d=>-1!==l.indexOf(d.key)&&(u=d.name,!0))),u}function getBrowserVersion(){const l=getEnvironmentDetails();return void 0!==l.browser.version?l.browser.version:Nd}function getBrowserInfo(){const l=getEnvironmentDetails().ua;return{name:getBrowserName(l,wd),engine:getEngine(l,wd),version:getBrowserVersion(),formFactor:getFormFactor(l)}}function getOS(){const l=getEnvironmentDetails().ua;return/windows phone/i.test(l)?\"windowsphone\":/windows /i.test(l)?\"windows\":/macintosh/i.test(l)?\"mac\":/(ipod|iphone|ipad)/i.test(l)?\"ios\":isAndroid(l)?\"android\":/(web|hpw)[o0]s/i.test(l)?\"webos\":/tizen/i.test(l)?\"tizen\":/headlesschrome(?:\\/([\\w\\.]+)| )/i.test(l)?\"headlesschrome\":/linux/i.test(l)?\"linux\":/CrOS/.test(l)?\"chrome\":\"other\"}function getOSVersion(){const l=getEnvironmentDetails();return void 0!==l.os.version?l.os.version:Nd}function isDigitMade(l){return/^\\d+$/.test(l)}function checkVersionSupport(l,d){l=l.trim(),d=d.trim();let u=l.split(\".\"),p=d.split(\".\"),h=0;try{if(!u.every(isDigitMade)||!p.every(isDigitMade))return-2;for(;u.length<p.length;)u.push(\"0\");for(;p.length<u.length;)p.push(\"0\");let l=u.map(Number),d=p.map(Number);for(var g=0;g<l.length;g++)if(l[g]!==d[g]){if(l[g]>d[g])return 1;if(l[g]<d[g])return-1}}catch(l){console.log(`Error in browser check version support: ${l}`)}return h}function checkOsSupport(l){var d;return!!(null===(d=getAcsEcsConfig())||void 0===d?void 0:d.environments).hasOwnProperty(l)}function checkOsBrowserSupport(l,d){var u;let p=null===(u=getAcsEcsConfig())||void 0===u?void 0:u.environments;return!(!checkOsSupport(l)||!p[l].hasOwnProperty(d))}function getMinBrowserVersion(l,d){var u;let p=null===(u=getAcsEcsConfig())||void 0===u?void 0:u.environments;return p.hasOwnProperty(l)&&p[l].hasOwnProperty(d)?p[l][d].minVersion:Nd}function getEnvironmentInfos(){let l,d,u=!1;const p=getOS(),h=getBrowserInfo().name,g=getBrowserInfo().version,f=checkOsSupport(p),m=checkOsBrowserSupport(p,h);if(m){checkVersionSupport(g,getMinBrowserVersion(p,h))>=0&&(u=!0)}return d={platform:p,browser:h,browserVersion:g},l={environment:d,isSupportedPlatform:f,isSupportedBrowser:m,isSupportedBrowserVersion:u,isSupportedEnvironment:f&&m&&u},l}var Ld,kd,xd,Fd,Ud,jd,__awaiter$2=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class TelemetryLogManager{constructor(l,d){this._telemetryLoggers=new Map,this._eventsBufferMap=new Map,this._initialized=!1,this._sdkUserAgent=\"\",this._mediaEventsReportedForTheCall={},this._logger=l.createChild(\"TelemetryLogManager\"),this._sdkUserAgent=d,this._sdkInternaVersion=getSdkInternalVersion()}getTelemetryLoggers(){return this._telemetryLoggers}getEventsBufferMap(){return this._eventsBufferMap}isInitialized(){return this._initialized}getCloudType(){var l;return null===(l=this._caConfigBag)||void 0===l?void 0:l.cloudType}getAcsResourceId(){var l;return null===(l=this._caConfigBag)||void 0===l?void 0:l.acsResourceId}getClientId(){var l;return null===(l=this._caConfigBag)||void 0===l?void 0:l.clientId}initialize(l){if(!l.cloudType)throw this._logger.error(\"Failed to initialize telemetry loggers, invalid cloud type provided.\"),new CallingCommunicationError({message:\"Failed to initialize telemetry\",code:Ie});if(this._initialized)throw this._logger.error(\"Failed to initialize telemetry loggers, telemetry log manager is already initialized.\"),new CallingCommunicationError({message:\"Failed to initialize telemetry\",code:Ie});this._telemetryLoggers.forEach(((d,u)=>{try{d.initialize(l),this._logger.log(`Initialized and flushed buffered telemetry logger for ${u}`)}catch(l){this._logger.warn(`Failed to initialize and flush buffered telemetry logger for ${u}`),this._telemetryLoggers.delete(u)}})),this._initialized=!0,this._caConfigBag=l,this._logger.log(`Telemetry log manager has been initialized for Call Client: ${this._caConfigBag.clientId}`)}clearTelemetryLoggers(){const l=this._telemetryLoggers.size;return this._telemetryLoggers=new Map,this._caConfigBag=void 0,this._initialized=!1,l}getMediaEventReportedPromise(l){if(!this._mediaEventsReportedForTheCall[l]){const d=defer();d.promise.catch(noop),this._mediaEventsReportedForTheCall[l]=d}return this._mediaEventsReportedForTheCall[l].promise}_reportMediaEventForTheCall(l){if(this._mediaEventsReportedForTheCall[l])this._mediaEventsReportedForTheCall[l].resolve();else{const d=defer();d.promise.catch(noop),d.resolve(),this._mediaEventsReportedForTheCall[l]=d}}sendEvent(l){var d,u,p;try{if(this._logger.debug(`sending event=${l.name}`),this.checkIfEventIsBlocked(null==l?void 0:l.name))return;const h={name:l.name,data:l.properties};if(\"mdsc_webrtc_session\"===(null==h?void 0:h.name)||\"mdsc_webrtc_session_initial\"===(null==h?void 0:h.name)){const p={};if(l.properties)for(const h of Object.keys(l.properties)){const g=l.properties[h];p[h]={value:null!==(d=null==g?void 0:g.value)&&void 0!==d?d:g,kind:null!==(u=null==g?void 0:g.piiKind)&&void 0!==u?u:0}}h.data=p}void 0===h.data&&(h.data={}),\"mdsc_webrtc_session\"===(null==h?void 0:h.name)&&this._reportMediaEventForTheCall(null===(p=null==h?void 0:h.data)||void 0===p?void 0:p.CorrelationId),void 0!==typeof l.priority?h.latency=l.priority:h.latency=Pn.Normal;const g=getAcsEcsConfig().telemetryEvents.eventNameToPriority.eventName.indexOf(l.name);-1!==g&&(h.latency=getAcsEcsConfig().telemetryEvents.eventNameToPriority.priority[g]),h.data.isSupportedEnvironment=getEnvironmentInfos().isSupportedEnvironment,h.data.sdkVersion=this._sdkInternaVersion,h.data.platformId=getPlatformId();const f=`${getPlatformId()}/${this._sdkInternaVersion}`;h.data.uiVersion=f,h.data.ui_version=f,h.data.Platform_Uiversion=f,h.data.userAgent=`${this._sdkUserAgent}`,h.data.clientTimestamp=+new Date;const m=l.tenant;let v=this._eventsBufferMap.get(m);v||(v=this._eventsBufferMap.set(m,[]).get(m));let y=this._telemetryLoggers.get(m);if(y||(y=new TelemetryLogger(m,this._logger,v),this._telemetryLoggers.set(m,y),this._logger.log(`Created telemetry logger for ${m}`)),this._initialized){if(!y.isInitialized())try{y.initialize(this._caConfigBag),this._logger.log(`Created and initialized telemetry logger for ${m}`)}catch(l){throw this._telemetryLoggers.delete(m),null==v||v.push(h),this._logger.error(`Failed to create and initialize telemetry logger for ${m}`),new CallingCommunicationError({message:`Failed to create and initialize telemetry logger for ${m}`,code:Ie})}y.sendEvent(h)}else null==v||v.push(h)}catch(d){this._logger.warn(`Failed to send event ${null==l?void 0:l.name}`)}}flushAllEvents(l){return __awaiter$2(this,void 0,void 0,(function*(){if(this._logger.debug(`flushing events: ${this._telemetryLoggers.size}`),-1!==getAcsEcsConfig().telemetry.telemetryFlushTimeout){const flushLogger=(d,u)=>{try{const p=defer();p.promise.catch(noop);const h=wait((()=>__awaiter$2(this,void 0,void 0,(function*(){return u===K&&(yield this.getMediaEventReportedPromise(l)),p.promise}))),getAcsEcsConfig().telemetry.telemetryFlushTimeout);return d.flushEvents((()=>{this._logger.debug(\"events flushed\"),p.resolve()})),h.then(noop)}catch(l){throw new CallingCommunicationError({message:\"Failed to flush telemetry\",code:Ie})}},d=[];return this._telemetryLoggers.forEach(((l,u)=>{d.push(flushLogger(l,u).catch((()=>{this._logger.warn(\"Failed to flush telemetry\")})))})),Promise.all(d)}this._telemetryLoggers.forEach((l=>{try{l.flushEvents()}catch(l){this._logger.warn(\"Failed to flush telemetry\")}}))}))}checkIfEventIsBlocked(l){var d,u,p,h;if(Array.isArray(null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.telemetry)||void 0===u?void 0:u.blockedEvents)){const d=null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.telemetry)||void 0===h?void 0:h.blockedEvents;return Array.isArray(d)&&(null==d?void 0:d.indexOf(l))>-1||!1}return!1}}TelemetryLogManager.telemetryPayloadBytesOriginal=0,TelemetryLogManager.telemetryPayloadBytesCompressed=0;class TelemetryLogger{constructor(l,d,u){this._tenantId=l,this._eventsBuffer=u,this._initialized=!1,this._networkOnline=!0,this._telemetryRetryIntervalRunning=!1,this._logger=d.createChild(`TelemetryLogger[${l}]`),window.addEventListener(\"online\",(l=>{this._networkOnline=l.detail,this._networkOnline&&this._initialized&&!this._telemetryRetryIntervalRunning&&(this._logger.log(\"browser network back online starting telemetry send retry\"),this.scheduleDiscardedTelemetryRetry())}))}initialize(l){var d;if(this._initialized)this._logger.warn(`Telemetry logger for tenant: ${this._tenantId}, already initialized`);else try{const u=new ps;this._appInsightsCore=new Un,this._postChannel=new ra;const p={instrumentationKey:this._tenantId,extensions:[this._postChannel,u],disableCookiesUsage:!0},h={populateBrowserInfo:!0,populateOperatingSystemInfo:!0};void 0===p.extensionConfig&&(p.extensionConfig={}),p.extensionConfig[u.identifier]=h;const g={overrideEndpointUrl:this.getAriaCollectorUrl(l),payloadPreprocessor:getAcsEcsConfig().telemetry.gzipTelemetryPayload?(l,d)=>{this.gzipPayload(l,d)}:void 0};if(p.extensionConfig[this._postChannel.identifier]=g,getAcsEcsConfig().telemetry.localStorageEnable){const l=new po;null===(d=p.extensions)||void 0===d||d.push(l);const u={storageKey:\"WebSdkTelemetry\"};p.extensionConfig[l.identifier]=u}this._NotificationManager=new NotificationManager$1(this._tenantId,this._logger),this._appInsightsCore.initialize(p,[],void 0,this._NotificationManager),this._caConfigBag=l,this.scheduleDiscardedTelemetryRetry(),this._initialized=!0,this._eventsBuffer.forEach((l=>{this.sendEvent(l)})),this._eventsBuffer.splice(0,this._eventsBuffer.length)}catch(l){throw this._logger.error(`Failed to initialize telemetry logger for tenant: ${this._tenantId}`),new CallingCommunicationError({message:\"Failed to iniztialize telemetry logger\",code:Ie})}}getCloudType(){var l;return null===(l=this._caConfigBag)||void 0===l?void 0:l.cloudType}getAcsResourceId(){var l;return null===(l=this._caConfigBag)||void 0===l?void 0:l.acsResourceId}getClientId(){var l;return null===(l=this._caConfigBag)||void 0===l?void 0:l.clientId}isInitialized(){return this._initialized}sendEvent(l){var d,u,p,h,g,f;this._initialized&&((null==l?void 0:l.data)&&(l.data.clientId=(null===(d=this._caConfigBag)||void 0===d?void 0:d.clientId)||\"\",0===(null===(u=null==l?void 0:l.name)||void 0===u?void 0:u.indexOf(\"mdsc_webrtc\"))?l.data.metrics_AcsResourceId=(null===(p=this._caConfigBag)||void 0===p?void 0:p.acsResourceId)||\"\":l.data.AcsResourceId=(null===(h=this._caConfigBag)||void 0===h?void 0:h.acsResourceId)||\"\",l.data.cloudType=(null===(g=this._caConfigBag)||void 0===g?void 0:g.cloudType)||\"\",l.data.identityType=(null===(f=this._caConfigBag)||void 0===f?void 0:f.identityType)||\"\"),this.sendAppInsightsCoreEvent(l))}scheduleDiscardedTelemetryRetry(){const l=getAcsEcsConfig().telemetry.discardedTelemetryRetryTimeout;let d=setInterval((l=>__awaiter$2(this,void 0,void 0,(function*(){var l;this._networkOnline?(null===(l=this._NotificationManager)||void 0===l||l.getDiscardedEvents().forEach((l=>{this.sendEvent(l)})),this._telemetryRetryIntervalRunning=!0):(this._logger.log(\"browser lost network access stopping telemetry send retry\"),clearInterval(d),this._telemetryRetryIntervalRunning=!1)}))),l)}sendAppInsightsCoreEvent(l){var d;null===(d=this._appInsightsCore)||void 0===d||d.track(l)}flushEvents(l){this._initialized&&this._postChannel&&this._postChannel.flush(!1,l)}getAriaCollectorUrl(l){if(l.identityType===Yn.Enterprise)return Wn.Enterprise;switch(l.cloudType){case qn.Public:return Wn.Public;case qn.GccHigh:return Wn.GccHigh;case qn.Dod:return Wn.Dod;case qn.AirGap08:return Wn.AirGap08;case qn.AirGap09:return Wn.AirGap09;default:return Wn.Public}}gzipPayload(l,d){try{TelemetryLogManager.telemetryPayloadBytesOriginal+=getSizeInBytes(l.data,this._logger),l.data=Rd.gzip(l.data),l.urlString+=\"&content-encoding=gzip\",TelemetryLogManager.telemetryPayloadBytesCompressed+=getSizeInBytes(l.data,this._logger)}catch(l){this._logger.warn(\"Failed to gzip with pako: \",l)}d(l)}}!function(l){l.remote_view=\"remote_view\",l.remote_stream=\"remote_stream\",l.network_quality=\"network_quality\",l.video_device_issue=\"video_device_issue\",l.other_diagnostic=\"other_diagnostic\",l.logger_event=\"logger_event\",l.number_of_participants=\"number_of_participants\",l.media_metrics_device_events=\"media_metrics_device_events\"}(Ld||(Ld={})),function(l){l.acs_calling_call_attempt=\"acs_calling_call_attempt\",l.acs_calling_call_connected=\"acs_calling_call_connected\",l.acs_calling_call_failed=\"acs_calling_call_failed\",l.acs_calling_call_accept_attempt=\"acs_calling_call_accept_attempt\",l.acs_calling_call_accept_connected=\"acs_calling_call_accept_connected\",l.acs_calling_call_accept_failed=\"acs_calling_call_accept_failed\",l.acs_calling_call_reject_attempt=\"acs_calling_call_reject_attempt\",l.acs_calling_call_reject_success=\"acs_calling_call_reject_success\",l.acs_calling_call_reject_failed=\"acs_calling_call_reject_failed\",l.acs_calling_call_hangup_attempt=\"acs_calling_call_hangup_attempt\",l.acs_calling_call_hangup_success=\"acs_calling_call_hangup_success\",l.acs_calling_call_hangup_failure=\"acs_calling_call_hangup_failure\",l.acs_calling_call_progress=\"acs_calling_call_progress\",l.acs_calling_stack_init=\"acs_calling_stack_init\",l.acs_calling_config_fetched_attempt=\"acs_calling_config_fetched_attempt\",l.acs_calling_config_fetched_success=\"acs_calling_config_fetched_success\",l.acs_calling_config_fetched_failure=\"acs_calling_config_fetched_failure\",l.acs_calling_signaling_init=\"acs_calling_signaling_init\",l.acs_calling_call_agent_init_attempt=\"acs_calling_call_agent_init_attempt\",l.acs_calling_call_agent_init_success=\"acs_calling_call_agent_init_success\",l.acs_calling_call_agent_init_failure=\"acs_calling_call_agent_init_failure\",l.acs_calling_create_view_attempt=\"acs_calling_create_view_attempt\",l.acs_calling_create_view_success=\"acs_calling_create_view_success\",l.acs_calling_create_view_failure=\"acs_calling_create_view_failure\",l.acs_calling_dispose_view_attempt=\"acs_calling_dispose_view_attempt\",l.acs_calling_dispose_view_success=\"acs_calling_dispose_view_success\",l.acs_calling_dispose_view_failure=\"acs_calling_dispose_view_failure\",l.acs_calling_start_video_attempt=\"acs_calling_start_video_attempt\",l.acs_calling_start_video_success=\"acs_calling_start_video_success\",l.acs_calling_start_video_failure=\"acs_calling_start_video_failure\",l.acs_calling_stop_video_on_ufd_attempt=\"acs_calling_stop_video_on_ufd_attempt\",l.acs_calling_stop_video_attempt=\"acs_calling_stop_video_attempt\",l.acs_calling_stop_video_success=\"acs_calling_stop_video_success\",l.acs_calling_stop_video_failure=\"acs_calling_stop_video_failure\",l.acs_calling_call_stats=\"acs_calling_call_stats\",l.acs_calling_participant_added_or_removed=\"acs_calling_participant_added_or_removed\",l.acs_calling_adp_attempt=\"acs_calling_adp_attempt\",l.acs_calling_adp_success=\"acs_calling_adp_success\",l.acs_calling_adp_failure=\"acs_calling_adp_failure\",l.acs_calling_device_permission_changed=\"acs_calling_device_permission_changed\",l.acs_calling_local_audio_source_changed_attempt=\"acs_calling_local_audio_source_changed_attempt\",l.acs_calling_start_audio_stream_track_attempt=\"acs_calling_start_audio_stream_track_attempt\",l.acs_calling_start_audio_stream_track_success=\"acs_calling_start_audio_stream_track_success\",l.acs_calling_start_audio_stream_track_failure=\"acs_calling_start_audio_stream_track_failure\",l.acs_calling_stop_audio_stream_track_attempt=\"acs_calling_stop_audio_stream_track_attempt\",l.acs_calling_stop_audio_stream_track_success=\"acs_calling_stop_audio_stream_track_success\",l.acs_calling_stop_audio_stream_track_failure=\"acs_calling_stop_audio_stream_track_failure\",l.acs_calling_get_remote_audio_stream_track_attempt=\"acs_calling_get_remote_audio_stream_track_attempt\",l.acs_calling_get_remote_audio_stream_track_success=\"acs_calling_get_remote_audio_stream_track_success\",l.acs_calling_get_remote_audio_stream_track_failure=\"acs_calling_get_remote_audio_stream_track_failure\",l.acs_calling_get_raw_input_audio_stream_track_attempt=\"acs_calling_get_raw_input_audio_stream_track_attempt\",l.acs_calling_get_raw_input_audio_stream_track_success=\"acs_calling_get_raw_input_audio_stream_track_success\",l.acs_calling_get_raw_input_audio_stream_track_failure=\"acs_calling_get_raw_input_audio_stream_track_failure\",l.acs_calling_dispose_raw_input_audio_stream_track_attempt=\"acs_calling_dispose_raw_input_audio_stream_track_attempt\",l.acs_calling_dispose_raw_input_audio_stream_track_success=\"acs_calling_dispose_raw_input_audio_stream_track_success\",l.acs_calling_dispose_raw_input_audio_stream_track_failure=\"acs_calling_dispose_raw_input_audio_stream_track_failure\",l.acs_calling_page_hidden=\"acs_calling_page_hidden\",l.acs_calling_orientation_changed=\"acs_calling_orientation_changed\",l.acs_calling_token_expiration_changed=\"acs_calling_token_expiration_changed\",l.acs_calling_token_expiration_changed_failure=\"acs_calling_token_expiration_changed_failure\",l.acs_calling_token_expired=\"acs_calling_token_expired\",l.acs_calling_mute_on_ufd_attempt=\"acs_calling_mute_on_ufd_attempt\",l.acs_calling_mute_attempt=\"acs_calling_mute_attempt\",l.acs_calling_mute_success=\"acs_calling_mute_success\",l.acs_calling_mute_failure=\"acs_calling_mute_failure\",l.acs_calling_unmute_attempt=\"acs_calling_unmute_attempt\",l.acs_calling_unmute_success=\"acs_calling_unmute_success\",l.acs_calling_unmute_failure=\"acs_calling_unmute_failure\",l.acs_calling_start_audio_attempt=\"acs_calling_start_audio_attempt\",l.acs_calling_start_audio_success=\"acs_calling_start_audio_success\",l.acs_calling_start_audio_failure=\"acs_calling_start_audio_failure\",l.acs_calling_unmute_speaker_attempt=\"acs_calling_unmute_speaker_attempt\",l.acs_calling_unmute_speaker_success=\"acs_calling_unmute_speaker_success\",l.acs_calling_unmute_speaker_failure=\"acs_calling_unmute_speaker_failure\",l.acs_calling_stop_audio_attempt=\"acs_calling_stop_audio_attempt\",l.acs_calling_stop_audio_success=\"acs_calling_stop_audio_success\",l.acs_calling_stop_audio_failure=\"acs_calling_stop_audio_failure\",l.acs_calling_prevent_stop_audio=\"acs_calling_prevent_stop_audio\",l.acs_calling_captions=\"acs_calling_captions\",l.acs_calling_mid_call_media_stats=\"acs_calling_mid_call_media_stats\",l.acs_calling_switch_video_source_attempt=\"acs_calling_switch_video_source_attempt\",l.acs_calling_switch_video_source_success=\"acs_calling_switch_video_source_success\",l.acs_calling_switch_video_source_failure=\"acs_calling_switch_video_source_failure\",l.acs_calling_diagnostics_test_attempt=\"acs_calling_diagnostics_test_attempt\",l.acs_calling_diagnostics_test_result=\"acs_calling_diagnostics_test_result\",l.acs_calling_diagnostics_device_access_attempt=\"acs_calling_diagnostics_device_access_attempt\",l.acs_calling_diagnostics_device_access_result=\"acs_calling_diagnostics_device_access_result\",l.acs_calling_diagnostics_device_enumeration_attempt=\"acs_calling_diagnostics_device_enumeration_attempt\",l.acs_calling_diagnostics_device_enumeration_result=\"acs_calling_diagnostics_device_enumeration_result\",l.acs_calling_diagnostics_in_callDiagnostics_attempt=\"acs_calling_diagnostics_in_callDiagnostics_attempt\",l.acs_calling_diagnostics_in_callDiagnostics_result=\"acs_calling_diagnostics_in_callDiagnostics_result\",l.acs_calling_diagnostics_broswer_support_attempt=\"acs_calling_diagnostics_broswer_support_attempt\",l.acs_calling_diagnostics_browser_support_result=\"acs_calling_diagnostics_browser_support_result\",l.acs_calling_feature_usage=\"acs_calling_feature_usage\",l.acs_calling_map_role_attempt=\"acs_calling_map_role_attempt\",l.acs_calling_map_role_success=\"acs_calling_map_role_success\",l.acs_calling_map_role_failure=\"acs_calling_map_role_failure\"}(kd||(kd={})),function(l){l.attempt=\"attempt\",l.success=\"success\",l.failure=\"failure\",l.getter=\"getter\",l.subscribe=\"subscribe\",l.unsubscribe=\"unsubscribe\",l.initialize=\"initialize\"}(xd||(xd={})),function(l){l.MuteMicrophone=\"MuteMicrophone\",l.UnmuteMicrophone=\"UnmuteMicrophone\",l.MuteIncomingAudio=\"MuteIncomingAudio\",l.UnmuteIncomingAudio=\"UnmuteIncomingAudio\"}(Fd||(Fd={})),function(l){l.InitializeCaptionsStarted=\"InitializeCaptionsStarted\",l.InitializeCaptionsFinished=\"InitializeCaptionsFinished\",l.StartCaptionsStarted=\"StartCaptionsStarted\",l.StartCaptionsFinished=\"StartCaptionsFinished\",l.SelectLanguageStarted=\"SelectLanguageStarted\",l.SelectLanguageFinished=\"SelectLanguageFinished\",l.StateChanged=\"StateChanged\",l.FirstCaptionReceived=\"FirstCaptionReceived\",l.FirstCaptionParsingError=\"FirstCaptionParsingError\",l.LanguageChanged=\"LanguageChanged\"}(Ud||(Ud={})),function(l){l[l.Success=0]=\"Success\",l[l.OperationInProgress=1]=\"OperationInProgress\",l[l.CaptionsAlreadyActive=2]=\"CaptionsAlreadyActive\",l[l.EmptyBotMri=3]=\"EmptyBotMri\",l[l.EmptyBotCommandUrl=4]=\"EmptyBotCommandUrl\",l[l.CallNotConnected=5]=\"CallNotConnected\",l[l.NullToken=6]=\"NullToken\",l[l.SelectedLanguageAlreadySet=7]=\"SelectedLanguageAlreadySet\",l[l.Failed=8]=\"Failed\"}(jd||(jd={}));class CallStats{constructor(l,d){this._eventBag=[],this.resetEventBag=()=>{this._eventBag=[]},this._logger=l.createChild(\"CallStats\"),this._telemetryLogManager=d}recordEvent(l){var d,u,p,h,g;try{if((null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.telemetry)||void 0===u?void 0:u.callStatsFlushTimeout)<0)return;if((null===(g=null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.telemetry)||void 0===h?void 0:h.blockedEvents)||void 0===g?void 0:g.indexOf(l.name))>-1)return;const f=Object.assign(Object.assign({},l),{timestamp:+new Date});this._logger.debug(`CallStat recorded=${l.name}`),this._eventBag.push(f),this.scheduleTelemtryFlush()}catch(l){this._logger.debug(\"Failed to record call stats\")}}flushEvents(){if(this._logger.debug(`CallStats sending telemetry, number of events=${this._eventBag.length}`),0!==this._eventBag.length)try{const l=this._eventBag.reduce(((l,d)=>(l[d.localParticipantId]?l[d.localParticipantId].events.push(Object.assign({name:d.name,timestamp:d.timestamp},d.data)):l[d.localParticipantId]={callId:d.callId,localParticipantId:d.localParticipantId,events:[Object.assign({name:d.name,timestamp:d.timestamp},d.data)]},l)),{});Object.keys(l).forEach((d=>{this._telemetryLogManager.sendEvent({name:kd.acs_calling_call_stats,tenant:q,properties:Object.assign({},l[d])})})),this.resetEventBag()}catch(l){this._logger.debug(\"Failed to send call stats\")}}scheduleTelemtryFlush(){this._callStatSendTimeout||(this._callStatSendTimeout=window.setTimeout((()=>{this.flushEvents(),this._callStatSendTimeout=void 0}),getAcsEcsConfig().telemetry.callStatsFlushTimeout))}}function parseMeetingUrl(l){try{const d=new URL(l),u=d.pathname.split(\"/\"),p=decodeURIComponent(u[3]),h=u[4],g=JSON.parse(decodeURIComponent(d.search.replace(\"?context=\",\"\"))),f=g.Oid;return{threadId:p,messageId:h,organizerId:f,tenantId:g.Tid}}catch(l){throw new CallingCommunicationError({message:\"Invalid meeting link\",code:be},l)}}function base64UrlEncoding(l){let d=btoa(l).replace(/=/g,\"\");d=d.replace(/\\+/g,\"-\"),d=d.replace(/\\//g,\"_\");for(const l of d)if(l.match(/[^A-Za-z0-9-_]/))throw new CallingCommunicationError({message:\"Failed to get server call Id\",code:Ie});return d}var Bd,__decorate=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$3=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class CallInfoImpl{constructor(l){this._tsCall=l;const d=this._tsCall.groupId;this._groupId=!d||d.startsWith(\"19:\")||d.startsWith(\"99:\")?void 0:d}get groupId(){return this._groupId}getServerCallId(){return __awaiter$3(this,void 0,void 0,(function*(){const l=JSON.parse(yield this._tsCall.getJoinBlob()),d=null==l?void 0:l.conversationUrl;if(!d)throw new CallingCommunicationError({message:\"Failed to get serverCallId, serverCallId is empty\",code:Se});return base64UrlEncoding(d)}))}}__decorate([asyncOperation(Ya.GetServerCallId),__metadata(\"design:type\",Function),__metadata(\"design:paramtypes\",[]),__metadata(\"design:returntype\",Promise)],CallInfoImpl.prototype,\"getServerCallId\",null);class BaseCallAgentFeature{constructor(l){this.disposed=!1,this.callAgent=l.callAgent,this.callClient=l.callClient,this.eventEmitter=new ri.EventEmitter}dispose(){this.disposed||(this.eventEmitter.removeAllListeners(),this.disposed=!0)}}class BaseCallClientFeature{constructor(l){this.disposed=!1,this.callClient=l.callClient,this.eventEmitter=new ri.EventEmitter}dispose(){this.disposed||(this.eventEmitter.removeAllListeners(),this.disposed=!0)}}class BaseCallFeature{constructor(l){this.disposed=!1,this.call=l.call,this.callAgent=l.callAgent,this.eventEmitter=new ri.EventEmitter}dispose(){this.disposed||(this.eventEmitter.removeAllListeners(),this.disposed=!0)}}class FirstPartyCallFeature extends BaseCallFeature{}class FirstPartyCallAgentFeature extends BaseCallAgentFeature{}class FirstPartyCallClientFeature extends BaseCallClientFeature{}!function(l){l.Transfer=\"Transfer\",l.StartCaptions=\"StartCaptions\",l.StopCaptions=\"StopCaptions\",l.SelectLanguage=\"SelectLanguage\",l.getMediaStatsCollector=\"getMediaStatsCollector\",l.disposeAllCollectors=\"disposeAllCollectors\"}(Bd||(Bd={}));class ExtensibleFeatureImpl{constructor(l,d,u){this._logger=l,this._featureCtorContext=d,this._featureInitContext=u,this._apiObjInstances=new Map}getApiObjectInstance(l){if(!this._apiObjInstances.has(l)){const d=new l(this._featureCtorContext);return(d instanceof FirstPartyCallFeature||d instanceof FirstPartyCallAgentFeature||d instanceof FirstPartyCallClientFeature)&&d.initialize(this._featureInitContext,this._logger),this._apiObjInstances.set(l,d),d}return this._apiObjInstances.get(l)}dispose(){for(const[,l]of this._apiObjInstances)l.dispose()}}class VideoDeviceInfoImpl{constructor(l,d,u,p){this._name=l,this._id=d,this._deviceType=u,this._deviceManager=p}get name(){return this._name}setName(l){this._name=l}get id(){return this._id}setId(l){this._id=l}get deviceType(){return this._deviceType}setDeviceType(l){this._deviceType=l}get deviceManager(){return this._deviceManager}}function getDateInIsoFormat(){return(new Date).toISOString()}function isNonEmptyArray(l){return Array.isArray(l)&&0!==l.length}function Deque(l){if(this._capacity=getCapacity(l),this._length=0,this._front=0,Vd(l)){for(var d=l.length,u=0;u<d;++u)this[u]=l[u];this._length=d}}Deque.prototype.toArray=function Deque$toArray(){for(var l=this._length,d=new Array(l),u=this._front,p=this._capacity,h=0;h<l;++h)d[h]=this[u+h&p-1];return d},Deque.prototype.push=function Deque$push(l){var d=arguments.length,u=this._length;if(d>1){var p=this._capacity;if(u+d>p){for(var h=0;h<d;++h){this._checkCapacity(u+1),this[g=this._front+u&this._capacity-1]=arguments[h],u++,this._length=u}return u}for(var g=this._front,h=0;h<d;++h)this[g+u&p-1]=arguments[h],g++;return this._length=u+d,u+d}return 0===d?u:(this._checkCapacity(u+1),this[h=this._front+u&this._capacity-1]=l,this._length=u+1,u+1)},Deque.prototype.pop=function Deque$pop(){var l=this._length;if(0!==l){var d=this._front+l-1&this._capacity-1,u=this[d];return this[d]=void 0,this._length=l-1,u}},Deque.prototype.shift=function Deque$shift(){var l=this._length;if(0!==l){var d=this._front,u=this[d];return this[d]=void 0,this._front=d+1&this._capacity-1,this._length=l-1,u}},Deque.prototype.unshift=function Deque$unshift(l){var d=this._length,u=arguments.length;if(u>1){if(d+u>(h=this._capacity)){for(var p=u-1;p>=0;p--){this._checkCapacity(d+1);var h=this._capacity;this[f=(this._front-1&h-1^h)-h]=arguments[p],d++,this._length=d,this._front=f}return d}var g=this._front;for(p=u-1;p>=0;p--){var f;this[f=(g-1&h-1^h)-h]=arguments[p],g=f}return this._front=g,this._length=d+u,d+u}if(0===u)return d;this._checkCapacity(d+1);h=this._capacity;return this[p=(this._front-1&h-1^h)-h]=l,this._length=d+1,this._front=p,d+1},Deque.prototype.peekBack=function Deque$peekBack(){var l=this._length;if(0!==l)return this[this._front+l-1&this._capacity-1]},Deque.prototype.peekFront=function Deque$peekFront(){if(0!==this._length)return this[this._front]},Deque.prototype.get=function Deque$get(l){var d=l;if(d===(0|d)){var u=this._length;if(d<0&&(d+=u),!(d<0||d>=u))return this[this._front+d&this._capacity-1]}},Deque.prototype.isEmpty=function Deque$isEmpty(){return 0===this._length},Deque.prototype.clear=function Deque$clear(){for(var l=this._length,d=this._front,u=this._capacity,p=0;p<l;++p)this[d+p&u-1]=void 0;this._length=0,this._front=0},Deque.prototype.toString=function Deque$toString(){return this.toArray().toString()},Deque.prototype.valueOf=Deque.prototype.toString,Deque.prototype.removeFront=Deque.prototype.shift,Deque.prototype.removeBack=Deque.prototype.pop,Deque.prototype.insertFront=Deque.prototype.unshift,Deque.prototype.insertBack=Deque.prototype.push,Deque.prototype.enqueue=Deque.prototype.push,Deque.prototype.dequeue=Deque.prototype.shift,Deque.prototype.toJSON=Deque.prototype.toArray,Object.defineProperty(Deque.prototype,\"length\",{get:function(){return this._length},set:function(){throw new RangeError(\"\")}}),Deque.prototype._checkCapacity=function Deque$_checkCapacity(l){this._capacity<l&&this._resizeTo(getCapacity(1.5*this._capacity+16))},Deque.prototype._resizeTo=function Deque$_resizeTo(l){var d=this._capacity;this._capacity=l;var u=this._front,p=this._length;u+p>d&&arrayMove(this,0,this,d,u+p&d-1)};var Vd=Array.isArray;function arrayMove(l,d,u,p,h){for(var g=0;g<h;++g)u[g+p]=l[g+d],l[g+d]=void 0}function pow2AtLeast(l){return l>>>=0,l-=1,l|=l>>1,l|=l>>2,l|=l>>4,l|=l>>8,(l|=l>>16)+1}function getCapacity(l){if(\"number\"!=typeof l){if(!Vd(l))return 16;l=l.length}return pow2AtLeast(Math.min(Math.max(16,l),1073741824))}var Hd,Gd,Wd=Deque,qd=createCommonjsModule((function(l,d){(function(){var u,p=\"4.17.20\",g=200,f=\"Unsupported core-js use. Try https://npms.io/search?q=ponyfill.\",m=\"Expected a function\",v=\"__lodash_hash_undefined__\",y=500,S=\"__lodash_placeholder__\",_=1,C=2,E=4,T=1,b=2,I=1,A=2,R=4,P=8,O=16,M=32,w=64,N=128,D=256,L=512,k=30,x=\"...\",F=800,U=16,j=1,B=2,V=3,H=1/0,G=9007199254740991,W=17976931348623157e292,q=NaN,z=4294967295,K=z-1,J=z>>>1,Q=[[\"ary\",N],[\"bind\",I],[\"bindKey\",A],[\"curry\",P],[\"curryRight\",O],[\"flip\",L],[\"partial\",M],[\"partialRight\",w],[\"rearg\",D]],Y=\"[object Arguments]\",$=\"[object Array]\",X=\"[object AsyncFunction]\",Z=\"[object Boolean]\",ee=\"[object Date]\",te=\"[object DOMException]\",ne=\"[object Error]\",ie=\"[object Function]\",re=\"[object GeneratorFunction]\",oe=\"[object Map]\",ae=\"[object Number]\",se=\"[object Null]\",ce=\"[object Object]\",le=\"[object Promise]\",de=\"[object Proxy]\",ue=\"[object RegExp]\",pe=\"[object Set]\",he=\"[object String]\",ge=\"[object Symbol]\",fe=\"[object Undefined]\",me=\"[object WeakMap]\",ve=\"[object WeakSet]\",ye=\"[object ArrayBuffer]\",Se=\"[object DataView]\",_e=\"[object Float32Array]\",Ce=\"[object Float64Array]\",Ee=\"[object Int8Array]\",Te=\"[object Int16Array]\",be=\"[object Int32Array]\",Ie=\"[object Uint8Array]\",Ae=\"[object Uint8ClampedArray]\",Re=\"[object Uint16Array]\",Pe=\"[object Uint32Array]\",Oe=/\\b__p \\+= '';/g,Me=/\\b(__p \\+=) '' \\+/g,we=/(__e\\(.*?\\)|\\b__t\\)) \\+\\n'';/g,Ne=/&(?:amp|lt|gt|quot|#39);/g,De=/[&<>\"']/g,Le=RegExp(Ne.source),ke=RegExp(De.source),xe=/<%-([\\s\\S]+?)%>/g,Fe=/<%([\\s\\S]+?)%>/g,Ue=/<%=([\\s\\S]+?)%>/g,je=/\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,Be=/^\\w*$/,Ve=/[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g,He=/[\\\\^$.*+?()[\\]{}|]/g,Ge=RegExp(He.source),We=/^\\s+|\\s+$/g,qe=/^\\s+/,ze=/\\s+$/,Ke=/\\{(?:\\n\\/\\* \\[wrapped with .+\\] \\*\\/)?\\n?/,Je=/\\{\\n\\/\\* \\[wrapped with (.+)\\] \\*/,Qe=/,? & /,Ye=/[^\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\x7f]+/g,$e=/\\\\(\\\\)?/g,Xe=/\\$\\{([^\\\\}]*(?:\\\\.[^\\\\}]*)*)\\}/g,Ze=/\\w*$/,et=/^[-+]0x[0-9a-f]+$/i,tt=/^0b[01]+$/i,nt=/^\\[object .+?Constructor\\]$/,it=/^0o[0-7]+$/i,rt=/^(?:0|[1-9]\\d*)$/,ot=/[\\xc0-\\xd6\\xd8-\\xf6\\xf8-\\xff\\u0100-\\u017f]/g,at=/($^)/,st=/['\\n\\r\\u2028\\u2029\\\\]/g,ct=\"\\\\ud800-\\\\udfff\",lt=\"\\\\u0300-\\\\u036f\"+\"\\\\ufe20-\\\\ufe2f\"+\"\\\\u20d0-\\\\u20ff\",dt=\"\\\\u2700-\\\\u27bf\",ut=\"a-z\\\\xdf-\\\\xf6\\\\xf8-\\\\xff\",pt=\"A-Z\\\\xc0-\\\\xd6\\\\xd8-\\\\xde\",ht=\"\\\\ufe0e\\\\ufe0f\",gt=\"\\\\xac\\\\xb1\\\\xd7\\\\xf7\"+\"\\\\x00-\\\\x2f\\\\x3a-\\\\x40\\\\x5b-\\\\x60\\\\x7b-\\\\xbf\"+\"\\\\u2000-\\\\u206f\"+\" \\\\t\\\\x0b\\\\f\\\\xa0\\\\ufeff\\\\n\\\\r\\\\u2028\\\\u2029\\\\u1680\\\\u180e\\\\u2000\\\\u2001\\\\u2002\\\\u2003\\\\u2004\\\\u2005\\\\u2006\\\\u2007\\\\u2008\\\\u2009\\\\u200a\\\\u202f\\\\u205f\\\\u3000\",ft=\"[']\",mt=\"[\"+ct+\"]\",vt=\"[\"+gt+\"]\",yt=\"[\"+lt+\"]\",St=\"\\\\d+\",_t=\"[\"+dt+\"]\",Ct=\"[\"+ut+\"]\",Et=\"[^\"+ct+gt+St+dt+ut+pt+\"]\",Tt=\"\\\\ud83c[\\\\udffb-\\\\udfff]\",bt=\"[^\"+ct+\"]\",It=\"(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}\",At=\"[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]\",Rt=\"[\"+pt+\"]\",Pt=\"\\\\u200d\",Ot=\"(?:\"+Ct+\"|\"+Et+\")\",Mt=\"(?:\"+Rt+\"|\"+Et+\")\",wt=\"(?:\"+ft+\"(?:d|ll|m|re|s|t|ve))?\",Nt=\"(?:\"+ft+\"(?:D|LL|M|RE|S|T|VE))?\",Dt=\"(?:\"+yt+\"|\"+Tt+\")\"+\"?\",Lt=\"[\"+ht+\"]?\",kt=\"\\\\d*(?:1st|2nd|3rd|(?![123])\\\\dth)(?=\\\\b|[A-Z_])\",xt=\"\\\\d*(?:1ST|2ND|3RD|(?![123])\\\\dTH)(?=\\\\b|[a-z_])\",Ft=Lt+Dt+(\"(?:\"+Pt+\"(?:\"+[bt,It,At].join(\"|\")+\")\"+Lt+Dt+\")*\"),Ut=\"(?:\"+[_t,It,At].join(\"|\")+\")\"+Ft,jt=\"(?:\"+[bt+yt+\"?\",yt,It,At,mt].join(\"|\")+\")\",Bt=RegExp(ft,\"g\"),Vt=RegExp(yt,\"g\"),Ht=RegExp(Tt+\"(?=\"+Tt+\")|\"+jt+Ft,\"g\"),Gt=RegExp([Rt+\"?\"+Ct+\"+\"+wt+\"(?=\"+[vt,Rt,\"$\"].join(\"|\")+\")\",Mt+\"+\"+Nt+\"(?=\"+[vt,Rt+Ot,\"$\"].join(\"|\")+\")\",Rt+\"?\"+Ot+\"+\"+wt,Rt+\"+\"+Nt,xt,kt,St,Ut].join(\"|\"),\"g\"),Wt=RegExp(\"[\"+Pt+ct+lt+ht+\"]\"),qt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,zt=[\"Array\",\"Buffer\",\"DataView\",\"Date\",\"Error\",\"Float32Array\",\"Float64Array\",\"Function\",\"Int8Array\",\"Int16Array\",\"Int32Array\",\"Map\",\"Math\",\"Object\",\"Promise\",\"RegExp\",\"Set\",\"String\",\"Symbol\",\"TypeError\",\"Uint8Array\",\"Uint8ClampedArray\",\"Uint16Array\",\"Uint32Array\",\"WeakMap\",\"_\",\"clearTimeout\",\"isFinite\",\"parseInt\",\"setTimeout\"],Kt=-1,Jt={};Jt[_e]=Jt[Ce]=Jt[Ee]=Jt[Te]=Jt[be]=Jt[Ie]=Jt[Ae]=Jt[Re]=Jt[Pe]=!0,Jt[Y]=Jt[$]=Jt[ye]=Jt[Z]=Jt[Se]=Jt[ee]=Jt[ne]=Jt[ie]=Jt[oe]=Jt[ae]=Jt[ce]=Jt[ue]=Jt[pe]=Jt[he]=Jt[me]=!1;var Qt={};Qt[Y]=Qt[$]=Qt[ye]=Qt[Se]=Qt[Z]=Qt[ee]=Qt[_e]=Qt[Ce]=Qt[Ee]=Qt[Te]=Qt[be]=Qt[oe]=Qt[ae]=Qt[ce]=Qt[ue]=Qt[pe]=Qt[he]=Qt[ge]=Qt[Ie]=Qt[Ae]=Qt[Re]=Qt[Pe]=!0,Qt[ne]=Qt[ie]=Qt[me]=!1;var Yt={\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"C\",\"\":\"c\",\"\":\"D\",\"\":\"d\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"N\",\"\":\"n\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"Y\",\"\":\"y\",\"\":\"y\",\"\":\"Ae\",\"\":\"ae\",\"\":\"Th\",\"\":\"th\",\"\":\"ss\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"D\",\"\":\"D\",\"\":\"d\",\"\":\"d\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"H\",\"\":\"H\",\"\":\"h\",\"\":\"h\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"J\",\"\":\"j\",\"\":\"K\",\"\":\"k\",\"\":\"k\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"W\",\"\":\"w\",\"\":\"Y\",\"\":\"y\",\"\":\"Y\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"IJ\",\"\":\"ij\",\"\":\"Oe\",\"\":\"oe\",\"\":\"'n\",\"\":\"s\"},$t={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\"},Xt={\"&amp;\":\"&\",\"&lt;\":\"<\",\"&gt;\":\">\",\"&quot;\":'\"',\"&#39;\":\"'\"},Zt={\"\\\\\":\"\\\\\",\"'\":\"'\",\"\\n\":\"n\",\"\\r\":\"r\",\"\\u2028\":\"u2028\",\"\\u2029\":\"u2029\"},en=parseFloat,tn=parseInt,nn=\"object\"==typeof h&&h&&h.Object===Object&&h,rn=\"object\"==typeof self&&self&&self.Object===Object&&self,on=nn||rn||Function(\"return this\")(),an=d&&!d.nodeType&&d,sn=an&&l&&!l.nodeType&&l,cn=sn&&sn.exports===an,ln=cn&&nn.process,dn=function(){try{var l=sn&&sn.require&&sn.require(\"util\").types;return l||ln&&ln.binding&&ln.binding(\"util\")}catch(l){}}(),un=dn&&dn.isArrayBuffer,pn=dn&&dn.isDate,hn=dn&&dn.isMap,gn=dn&&dn.isRegExp,fn=dn&&dn.isSet,mn=dn&&dn.isTypedArray;function apply(l,d,u){switch(u.length){case 0:return l.call(d);case 1:return l.call(d,u[0]);case 2:return l.call(d,u[0],u[1]);case 3:return l.call(d,u[0],u[1],u[2])}return l.apply(d,u)}function arrayAggregator(l,d,u,p){for(var h=-1,g=null==l?0:l.length;++h<g;){var f=l[h];d(p,f,u(f),l)}return p}function arrayEach(l,d){for(var u=-1,p=null==l?0:l.length;++u<p&&!1!==d(l[u],u,l););return l}function arrayEachRight(l,d){for(var u=null==l?0:l.length;u--&&!1!==d(l[u],u,l););return l}function arrayEvery(l,d){for(var u=-1,p=null==l?0:l.length;++u<p;)if(!d(l[u],u,l))return!1;return!0}function arrayFilter(l,d){for(var u=-1,p=null==l?0:l.length,h=0,g=[];++u<p;){var f=l[u];d(f,u,l)&&(g[h++]=f)}return g}function arrayIncludes(l,d){return!!(null==l?0:l.length)&&baseIndexOf(l,d,0)>-1}function arrayIncludesWith(l,d,u){for(var p=-1,h=null==l?0:l.length;++p<h;)if(u(d,l[p]))return!0;return!1}function arrayMap(l,d){for(var u=-1,p=null==l?0:l.length,h=Array(p);++u<p;)h[u]=d(l[u],u,l);return h}function arrayPush(l,d){for(var u=-1,p=d.length,h=l.length;++u<p;)l[h+u]=d[u];return l}function arrayReduce(l,d,u,p){var h=-1,g=null==l?0:l.length;for(p&&g&&(u=l[++h]);++h<g;)u=d(u,l[h],h,l);return u}function arrayReduceRight(l,d,u,p){var h=null==l?0:l.length;for(p&&h&&(u=l[--h]);h--;)u=d(u,l[h],h,l);return u}function arraySome(l,d){for(var u=-1,p=null==l?0:l.length;++u<p;)if(d(l[u],u,l))return!0;return!1}var vn=baseProperty(\"length\");function asciiToArray(l){return l.split(\"\")}function asciiWords(l){return l.match(Ye)||[]}function baseFindKey(l,d,u){var p;return u(l,(function(l,u,h){if(d(l,u,h))return p=u,!1})),p}function baseFindIndex(l,d,u,p){for(var h=l.length,g=u+(p?1:-1);p?g--:++g<h;)if(d(l[g],g,l))return g;return-1}function baseIndexOf(l,d,u){return d==d?strictIndexOf(l,d,u):baseFindIndex(l,baseIsNaN,u)}function baseIndexOfWith(l,d,u,p){for(var h=u-1,g=l.length;++h<g;)if(p(l[h],d))return h;return-1}function baseIsNaN(l){return l!=l}function baseMean(l,d){var u=null==l?0:l.length;return u?baseSum(l,d)/u:q}function baseProperty(l){return function(d){return null==d?u:d[l]}}function basePropertyOf(l){return function(d){return null==l?u:l[d]}}function baseReduce(l,d,u,p,h){return h(l,(function(l,h,g){u=p?(p=!1,l):d(u,l,h,g)})),u}function baseSortBy(l,d){var u=l.length;for(l.sort(d);u--;)l[u]=l[u].value;return l}function baseSum(l,d){for(var p,h=-1,g=l.length;++h<g;){var f=d(l[h]);f!==u&&(p=p===u?f:p+f)}return p}function baseTimes(l,d){for(var u=-1,p=Array(l);++u<l;)p[u]=d(u);return p}function baseToPairs(l,d){return arrayMap(d,(function(d){return[d,l[d]]}))}function baseUnary(l){return function(d){return l(d)}}function baseValues(l,d){return arrayMap(d,(function(d){return l[d]}))}function cacheHas(l,d){return l.has(d)}function charsStartIndex(l,d){for(var u=-1,p=l.length;++u<p&&baseIndexOf(d,l[u],0)>-1;);return u}function charsEndIndex(l,d){for(var u=l.length;u--&&baseIndexOf(d,l[u],0)>-1;);return u}function countHolders(l,d){for(var u=l.length,p=0;u--;)l[u]===d&&++p;return p}var yn=basePropertyOf(Yt),Sn=basePropertyOf($t);function escapeStringChar(l){return\"\\\\\"+Zt[l]}function getValue(l,d){return null==l?u:l[d]}function hasUnicode(l){return Wt.test(l)}function hasUnicodeWord(l){return qt.test(l)}function iteratorToArray(l){for(var d,u=[];!(d=l.next()).done;)u.push(d.value);return u}function mapToArray(l){var d=-1,u=Array(l.size);return l.forEach((function(l,p){u[++d]=[p,l]})),u}function overArg(l,d){return function(u){return l(d(u))}}function replaceHolders(l,d){for(var u=-1,p=l.length,h=0,g=[];++u<p;){var f=l[u];f!==d&&f!==S||(l[u]=S,g[h++]=u)}return g}function setToArray(l){var d=-1,u=Array(l.size);return l.forEach((function(l){u[++d]=l})),u}function setToPairs(l){var d=-1,u=Array(l.size);return l.forEach((function(l){u[++d]=[l,l]})),u}function strictIndexOf(l,d,u){for(var p=u-1,h=l.length;++p<h;)if(l[p]===d)return p;return-1}function strictLastIndexOf(l,d,u){for(var p=u+1;p--;)if(l[p]===d)return p;return p}function stringSize(l){return hasUnicode(l)?unicodeSize(l):vn(l)}function stringToArray(l){return hasUnicode(l)?unicodeToArray(l):asciiToArray(l)}var _n=basePropertyOf(Xt);function unicodeSize(l){for(var d=Ht.lastIndex=0;Ht.test(l);)++d;return d}function unicodeToArray(l){return l.match(Ht)||[]}function unicodeWords(l){return l.match(Gt)||[]}var Cn=function runInContext(l){var d,h=(l=null==l?on:Cn.defaults(on.Object(),l,Cn.pick(on,zt))).Array,Ye=l.Date,ct=l.Error,lt=l.Function,dt=l.Math,ut=l.Object,pt=l.RegExp,ht=l.String,gt=l.TypeError,ft=h.prototype,mt=lt.prototype,vt=ut.prototype,yt=l[\"__core-js_shared__\"],St=mt.toString,_t=vt.hasOwnProperty,Ct=0,Et=(d=/[^.]+$/.exec(yt&&yt.keys&&yt.keys.IE_PROTO||\"\"))?\"Symbol(src)_1.\"+d:\"\",Tt=vt.toString,bt=St.call(ut),It=on._,At=pt(\"^\"+St.call(_t).replace(He,\"\\\\$&\").replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g,\"$1.*?\")+\"$\"),Rt=cn?l.Buffer:u,Pt=l.Symbol,Ot=l.Uint8Array,Mt=Rt?Rt.allocUnsafe:u,wt=overArg(ut.getPrototypeOf,ut),Nt=ut.create,Dt=vt.propertyIsEnumerable,Lt=ft.splice,kt=Pt?Pt.isConcatSpreadable:u,xt=Pt?Pt.iterator:u,Ft=Pt?Pt.toStringTag:u,Ut=function(){try{var l=getNative(ut,\"defineProperty\");return l({},\"\",{}),l}catch(l){}}(),jt=l.clearTimeout!==on.clearTimeout&&l.clearTimeout,Ht=Ye&&Ye.now!==on.Date.now&&Ye.now,Gt=l.setTimeout!==on.setTimeout&&l.setTimeout,Wt=dt.ceil,qt=dt.floor,Yt=ut.getOwnPropertySymbols,$t=Rt?Rt.isBuffer:u,Xt=l.isFinite,Zt=ft.join,nn=overArg(ut.keys,ut),rn=dt.max,an=dt.min,sn=Ye.now,ln=l.parseInt,dn=dt.random,vn=ft.reverse,En=getNative(l,\"DataView\"),Tn=getNative(l,\"Map\"),bn=getNative(l,\"Promise\"),In=getNative(l,\"Set\"),An=getNative(l,\"WeakMap\"),Rn=getNative(ut,\"create\"),Pn=An&&new An,On={},Mn=toSource(En),wn=toSource(Tn),Nn=toSource(bn),Dn=toSource(In),Ln=toSource(An),kn=Pt?Pt.prototype:u,xn=kn?kn.valueOf:u,Fn=kn?kn.toString:u;function lodash(l){if(isObjectLike(l)&&!Vi(l)&&!(l instanceof LazyWrapper)){if(l instanceof LodashWrapper)return l;if(_t.call(l,\"__wrapped__\"))return wrapperClone(l)}return new LodashWrapper(l)}var Un=function(){function object(){}return function(l){if(!isObject(l))return{};if(Nt)return Nt(l);object.prototype=l;var d=new object;return object.prototype=u,d}}();function baseLodash(){}function LodashWrapper(l,d){this.__wrapped__=l,this.__actions__=[],this.__chain__=!!d,this.__index__=0,this.__values__=u}function LazyWrapper(l){this.__wrapped__=l,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=z,this.__views__=[]}function lazyClone(){var l=new LazyWrapper(this.__wrapped__);return l.__actions__=copyArray(this.__actions__),l.__dir__=this.__dir__,l.__filtered__=this.__filtered__,l.__iteratees__=copyArray(this.__iteratees__),l.__takeCount__=this.__takeCount__,l.__views__=copyArray(this.__views__),l}function lazyReverse(){if(this.__filtered__){var l=new LazyWrapper(this);l.__dir__=-1,l.__filtered__=!0}else(l=this.clone()).__dir__*=-1;return l}function lazyValue(){var l=this.__wrapped__.value(),d=this.__dir__,u=Vi(l),p=d<0,h=u?l.length:0,g=getView(0,h,this.__views__),f=g.start,m=g.end,v=m-f,y=p?m:f-1,S=this.__iteratees__,_=S.length,C=0,E=an(v,this.__takeCount__);if(!u||!p&&h==v&&E==v)return baseWrapperValue(l,this.__actions__);var T=[];e:for(;v--&&C<E;){for(var b=-1,I=l[y+=d];++b<_;){var A=S[b],R=A.iteratee,P=A.type,O=R(I);if(P==B)I=O;else if(!O){if(P==j)continue e;break e}}T[C++]=I}return T}function Hash(l){var d=-1,u=null==l?0:l.length;for(this.clear();++d<u;){var p=l[d];this.set(p[0],p[1])}}function hashClear(){this.__data__=Rn?Rn(null):{},this.size=0}function hashDelete(l){var d=this.has(l)&&delete this.__data__[l];return this.size-=d?1:0,d}function hashGet(l){var d=this.__data__;if(Rn){var p=d[l];return p===v?u:p}return _t.call(d,l)?d[l]:u}function hashHas(l){var d=this.__data__;return Rn?d[l]!==u:_t.call(d,l)}function hashSet(l,d){var p=this.__data__;return this.size+=this.has(l)?0:1,p[l]=Rn&&d===u?v:d,this}function ListCache(l){var d=-1,u=null==l?0:l.length;for(this.clear();++d<u;){var p=l[d];this.set(p[0],p[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(l){var d=this.__data__,u=assocIndexOf(d,l);return!(u<0)&&(u==d.length-1?d.pop():Lt.call(d,u,1),--this.size,!0)}function listCacheGet(l){var d=this.__data__,p=assocIndexOf(d,l);return p<0?u:d[p][1]}function listCacheHas(l){return assocIndexOf(this.__data__,l)>-1}function listCacheSet(l,d){var u=this.__data__,p=assocIndexOf(u,l);return p<0?(++this.size,u.push([l,d])):u[p][1]=d,this}function MapCache(l){var d=-1,u=null==l?0:l.length;for(this.clear();++d<u;){var p=l[d];this.set(p[0],p[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Tn||ListCache),string:new Hash}}function mapCacheDelete(l){var d=getMapData(this,l).delete(l);return this.size-=d?1:0,d}function mapCacheGet(l){return getMapData(this,l).get(l)}function mapCacheHas(l){return getMapData(this,l).has(l)}function mapCacheSet(l,d){var u=getMapData(this,l),p=u.size;return u.set(l,d),this.size+=u.size==p?0:1,this}function SetCache(l){var d=-1,u=null==l?0:l.length;for(this.__data__=new MapCache;++d<u;)this.add(l[d])}function setCacheAdd(l){return this.__data__.set(l,v),this}function setCacheHas(l){return this.__data__.has(l)}function Stack(l){var d=this.__data__=new ListCache(l);this.size=d.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(l){var d=this.__data__,u=d.delete(l);return this.size=d.size,u}function stackGet(l){return this.__data__.get(l)}function stackHas(l){return this.__data__.has(l)}function stackSet(l,d){var u=this.__data__;if(u instanceof ListCache){var p=u.__data__;if(!Tn||p.length<g-1)return p.push([l,d]),this.size=++u.size,this;u=this.__data__=new MapCache(p)}return u.set(l,d),this.size=u.size,this}function arrayLikeKeys(l,d){var u=Vi(l),p=!u&&Bi(l),h=!u&&!p&&Gi(l),g=!u&&!p&&!h&&Ji(l),f=u||p||h||g,m=f?baseTimes(l.length,ht):[],v=m.length;for(var y in l)!d&&!_t.call(l,y)||f&&(\"length\"==y||h&&(\"offset\"==y||\"parent\"==y)||g&&(\"buffer\"==y||\"byteLength\"==y||\"byteOffset\"==y)||isIndex(y,v))||m.push(y);return m}function arraySample(l){var d=l.length;return d?l[baseRandom(0,d-1)]:u}function arraySampleSize(l,d){return shuffleSelf(copyArray(l),baseClamp(d,0,l.length))}function arrayShuffle(l){return shuffleSelf(copyArray(l))}function assignMergeValue(l,d,p){(p!==u&&!eq(l[d],p)||p===u&&!(d in l))&&baseAssignValue(l,d,p)}function assignValue(l,d,p){var h=l[d];_t.call(l,d)&&eq(h,p)&&(p!==u||d in l)||baseAssignValue(l,d,p)}function assocIndexOf(l,d){for(var u=l.length;u--;)if(eq(l[u][0],d))return u;return-1}function baseAggregator(l,d,u,p){return jn(l,(function(l,h,g){d(p,l,u(l),g)})),p}function baseAssign(l,d){return l&&copyObject(d,keys(d),l)}function baseAssignIn(l,d){return l&&copyObject(d,keysIn(d),l)}function baseAssignValue(l,d,u){\"__proto__\"==d&&Ut?Ut(l,d,{configurable:!0,enumerable:!0,value:u,writable:!0}):l[d]=u}function baseAt(l,d){for(var p=-1,g=d.length,f=h(g),m=null==l;++p<g;)f[p]=m?u:get(l,d[p]);return f}function baseClamp(l,d,p){return l==l&&(p!==u&&(l=l<=p?l:p),d!==u&&(l=l>=d?l:d)),l}function baseClone(l,d,p,h,g,f){var m,v=d&_,y=d&C,S=d&E;if(p&&(m=g?p(l,h,g,f):p(l)),m!==u)return m;if(!isObject(l))return l;var T=Vi(l);if(T){if(m=initCloneArray(l),!v)return copyArray(l,m)}else{var b=$n(l),I=b==ie||b==re;if(Gi(l))return cloneBuffer(l,v);if(b==ce||b==Y||I&&!g){if(m=y||I?{}:initCloneObject(l),!v)return y?copySymbolsIn(l,baseAssignIn(m,l)):copySymbols(l,baseAssign(m,l))}else{if(!Qt[b])return g?l:{};m=initCloneByTag(l,b,v)}}f||(f=new Stack);var A=f.get(l);if(A)return A;f.set(l,m),Ki(l)?l.forEach((function(u){m.add(baseClone(u,d,p,u,l,f))})):qi(l)&&l.forEach((function(u,h){m.set(h,baseClone(u,d,p,h,l,f))}));var R=T?u:(S?y?getAllKeysIn:getAllKeys:y?keysIn:keys)(l);return arrayEach(R||l,(function(u,h){R&&(u=l[h=u]),assignValue(m,h,baseClone(u,d,p,h,l,f))})),m}function baseConforms(l){var d=keys(l);return function(u){return baseConformsTo(u,l,d)}}function baseConformsTo(l,d,p){var h=p.length;if(null==l)return!h;for(l=ut(l);h--;){var g=p[h],f=d[g],m=l[g];if(m===u&&!(g in l)||!f(m))return!1}return!0}function baseDelay(l,d,p){if(\"function\"!=typeof l)throw new gt(m);return ei((function(){l.apply(u,p)}),d)}function baseDifference(l,d,u,p){var h=-1,f=arrayIncludes,m=!0,v=l.length,y=[],S=d.length;if(!v)return y;u&&(d=arrayMap(d,baseUnary(u))),p?(f=arrayIncludesWith,m=!1):d.length>=g&&(f=cacheHas,m=!1,d=new SetCache(d));e:for(;++h<v;){var _=l[h],C=null==u?_:u(_);if(_=p||0!==_?_:0,m&&C==C){for(var E=S;E--;)if(d[E]===C)continue e;y.push(_)}else f(d,C,p)||y.push(_)}return y}lodash.templateSettings={escape:xe,evaluate:Fe,interpolate:Ue,variable:\"\",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=Un(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=Un(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var jn=createBaseEach(baseForOwn),Bn=createBaseEach(baseForOwnRight,!0);function baseEvery(l,d){var u=!0;return jn(l,(function(l,p,h){return u=!!d(l,p,h)})),u}function baseExtremum(l,d,p){for(var h=-1,g=l.length;++h<g;){var f=l[h],m=d(f);if(null!=m&&(v===u?m==m&&!isSymbol(m):p(m,v)))var v=m,y=f}return y}function baseFill(l,d,p,h){var g=l.length;for((p=toInteger(p))<0&&(p=-p>g?0:g+p),(h=h===u||h>g?g:toInteger(h))<0&&(h+=g),h=p>h?0:toLength(h);p<h;)l[p++]=d;return l}function baseFilter(l,d){var u=[];return jn(l,(function(l,p,h){d(l,p,h)&&u.push(l)})),u}function baseFlatten(l,d,u,p,h){var g=-1,f=l.length;for(u||(u=isFlattenable),h||(h=[]);++g<f;){var m=l[g];d>0&&u(m)?d>1?baseFlatten(m,d-1,u,p,h):arrayPush(h,m):p||(h[h.length]=m)}return h}var Vn=createBaseFor(),Hn=createBaseFor(!0);function baseForOwn(l,d){return l&&Vn(l,d,keys)}function baseForOwnRight(l,d){return l&&Hn(l,d,keys)}function baseFunctions(l,d){return arrayFilter(d,(function(d){return isFunction(l[d])}))}function baseGet(l,d){for(var p=0,h=(d=castPath(d,l)).length;null!=l&&p<h;)l=l[toKey(d[p++])];return p&&p==h?l:u}function baseGetAllKeys(l,d,u){var p=d(l);return Vi(l)?p:arrayPush(p,u(l))}function baseGetTag(l){return null==l?l===u?fe:se:Ft&&Ft in ut(l)?getRawTag(l):objectToString(l)}function baseGt(l,d){return l>d}function baseHas(l,d){return null!=l&&_t.call(l,d)}function baseHasIn(l,d){return null!=l&&d in ut(l)}function baseInRange(l,d,u){return l>=an(d,u)&&l<rn(d,u)}function baseIntersection(l,d,p){for(var g=p?arrayIncludesWith:arrayIncludes,f=l[0].length,m=l.length,v=m,y=h(m),S=1/0,_=[];v--;){var C=l[v];v&&d&&(C=arrayMap(C,baseUnary(d))),S=an(C.length,S),y[v]=!p&&(d||f>=120&&C.length>=120)?new SetCache(v&&C):u}C=l[0];var E=-1,T=y[0];e:for(;++E<f&&_.length<S;){var b=C[E],I=d?d(b):b;if(b=p||0!==b?b:0,!(T?cacheHas(T,I):g(_,I,p))){for(v=m;--v;){var A=y[v];if(!(A?cacheHas(A,I):g(l[v],I,p)))continue e}T&&T.push(I),_.push(b)}}return _}function baseInverter(l,d,u,p){return baseForOwn(l,(function(l,h,g){d(p,u(l),h,g)})),p}function baseInvoke(l,d,p){var h=null==(l=parent(l,d=castPath(d,l)))?l:l[toKey(last(d))];return null==h?u:apply(h,l,p)}function baseIsArguments(l){return isObjectLike(l)&&baseGetTag(l)==Y}function baseIsArrayBuffer(l){return isObjectLike(l)&&baseGetTag(l)==ye}function baseIsDate(l){return isObjectLike(l)&&baseGetTag(l)==ee}function baseIsEqual(l,d,u,p,h){return l===d||(null==l||null==d||!isObjectLike(l)&&!isObjectLike(d)?l!=l&&d!=d:baseIsEqualDeep(l,d,u,p,baseIsEqual,h))}function baseIsEqualDeep(l,d,u,p,h,g){var f=Vi(l),m=Vi(d),v=f?$:$n(l),y=m?$:$n(d),S=(v=v==Y?ce:v)==ce,_=(y=y==Y?ce:y)==ce,C=v==y;if(C&&Gi(l)){if(!Gi(d))return!1;f=!0,S=!1}if(C&&!S)return g||(g=new Stack),f||Ji(l)?equalArrays(l,d,u,p,h,g):equalByTag(l,d,v,u,p,h,g);if(!(u&T)){var E=S&&_t.call(l,\"__wrapped__\"),b=_&&_t.call(d,\"__wrapped__\");if(E||b){var I=E?l.value():l,A=b?d.value():d;return g||(g=new Stack),h(I,A,u,p,g)}}return!!C&&(g||(g=new Stack),equalObjects(l,d,u,p,h,g))}function baseIsMap(l){return isObjectLike(l)&&$n(l)==oe}function baseIsMatch(l,d,p,h){var g=p.length,f=g,m=!h;if(null==l)return!f;for(l=ut(l);g--;){var v=p[g];if(m&&v[2]?v[1]!==l[v[0]]:!(v[0]in l))return!1}for(;++g<f;){var y=(v=p[g])[0],S=l[y],_=v[1];if(m&&v[2]){if(S===u&&!(y in l))return!1}else{var C=new Stack;if(h)var E=h(S,_,y,l,d,C);if(!(E===u?baseIsEqual(_,S,T|b,h,C):E))return!1}}return!0}function baseIsNative(l){return!(!isObject(l)||isMasked(l))&&(isFunction(l)?At:nt).test(toSource(l))}function baseIsRegExp(l){return isObjectLike(l)&&baseGetTag(l)==ue}function baseIsSet(l){return isObjectLike(l)&&$n(l)==pe}function baseIsTypedArray(l){return isObjectLike(l)&&isLength(l.length)&&!!Jt[baseGetTag(l)]}function baseIteratee(l){return\"function\"==typeof l?l:null==l?identity:\"object\"==typeof l?Vi(l)?baseMatchesProperty(l[0],l[1]):baseMatches(l):property(l)}function baseKeys(l){if(!isPrototype(l))return nn(l);var d=[];for(var u in ut(l))_t.call(l,u)&&\"constructor\"!=u&&d.push(u);return d}function baseKeysIn(l){if(!isObject(l))return nativeKeysIn(l);var d=isPrototype(l),u=[];for(var p in l)(\"constructor\"!=p||!d&&_t.call(l,p))&&u.push(p);return u}function baseLt(l,d){return l<d}function baseMap(l,d){var u=-1,p=isArrayLike(l)?h(l.length):[];return jn(l,(function(l,h,g){p[++u]=d(l,h,g)})),p}function baseMatches(l){var d=getMatchData(l);return 1==d.length&&d[0][2]?matchesStrictComparable(d[0][0],d[0][1]):function(u){return u===l||baseIsMatch(u,l,d)}}function baseMatchesProperty(l,d){return isKey(l)&&isStrictComparable(d)?matchesStrictComparable(toKey(l),d):function(p){var h=get(p,l);return h===u&&h===d?hasIn(p,l):baseIsEqual(d,h,T|b)}}function baseMerge(l,d,p,h,g){l!==d&&Vn(d,(function(f,m){if(g||(g=new Stack),isObject(f))baseMergeDeep(l,d,m,p,baseMerge,h,g);else{var v=h?h(safeGet(l,m),f,m+\"\",l,d,g):u;v===u&&(v=f),assignMergeValue(l,m,v)}}),keysIn)}function baseMergeDeep(l,d,p,h,g,f,m){var v=safeGet(l,p),y=safeGet(d,p),S=m.get(y);if(S)assignMergeValue(l,p,S);else{var _=f?f(v,y,p+\"\",l,d,m):u,C=_===u;if(C){var E=Vi(y),T=!E&&Gi(y),b=!E&&!T&&Ji(y);_=y,E||T||b?Vi(v)?_=v:isArrayLikeObject(v)?_=copyArray(v):T?(C=!1,_=cloneBuffer(y,!0)):b?(C=!1,_=cloneTypedArray(y,!0)):_=[]:isPlainObject(y)||Bi(y)?(_=v,Bi(v)?_=toPlainObject(v):isObject(v)&&!isFunction(v)||(_=initCloneObject(y))):C=!1}C&&(m.set(y,_),g(_,y,h,f,m),m.delete(y)),assignMergeValue(l,p,_)}}function baseNth(l,d){var p=l.length;if(p)return isIndex(d+=d<0?p:0,p)?l[d]:u}function baseOrderBy(l,d,u){d=d.length?arrayMap(d,(function(l){return Vi(l)?function(d){return baseGet(d,1===l.length?l[0]:l)}:l})):[identity];var p=-1;return d=arrayMap(d,baseUnary(getIteratee())),baseSortBy(baseMap(l,(function(l,u,h){return{criteria:arrayMap(d,(function(d){return d(l)})),index:++p,value:l}})),(function(l,d){return compareMultiple(l,d,u)}))}function basePick(l,d){return basePickBy(l,d,(function(d,u){return hasIn(l,u)}))}function basePickBy(l,d,u){for(var p=-1,h=d.length,g={};++p<h;){var f=d[p],m=baseGet(l,f);u(m,f)&&baseSet(g,castPath(f,l),m)}return g}function basePropertyDeep(l){return function(d){return baseGet(d,l)}}function basePullAll(l,d,u,p){var h=p?baseIndexOfWith:baseIndexOf,g=-1,f=d.length,m=l;for(l===d&&(d=copyArray(d)),u&&(m=arrayMap(l,baseUnary(u)));++g<f;)for(var v=0,y=d[g],S=u?u(y):y;(v=h(m,S,v,p))>-1;)m!==l&&Lt.call(m,v,1),Lt.call(l,v,1);return l}function basePullAt(l,d){for(var u=l?d.length:0,p=u-1;u--;){var h=d[u];if(u==p||h!==g){var g=h;isIndex(h)?Lt.call(l,h,1):baseUnset(l,h)}}return l}function baseRandom(l,d){return l+qt(dn()*(d-l+1))}function baseRange(l,d,u,p){for(var g=-1,f=rn(Wt((d-l)/(u||1)),0),m=h(f);f--;)m[p?f:++g]=l,l+=u;return m}function baseRepeat(l,d){var u=\"\";if(!l||d<1||d>G)return u;do{d%2&&(u+=l),(d=qt(d/2))&&(l+=l)}while(d);return u}function baseRest(l,d){return ti(overRest(l,d,identity),l+\"\")}function baseSample(l){return arraySample(values(l))}function baseSampleSize(l,d){var u=values(l);return shuffleSelf(u,baseClamp(d,0,u.length))}function baseSet(l,d,p,h){if(!isObject(l))return l;for(var g=-1,f=(d=castPath(d,l)).length,m=f-1,v=l;null!=v&&++g<f;){var y=toKey(d[g]),S=p;if(\"__proto__\"===y||\"constructor\"===y||\"prototype\"===y)return l;if(g!=m){var _=v[y];(S=h?h(_,y,v):u)===u&&(S=isObject(_)?_:isIndex(d[g+1])?[]:{})}assignValue(v,y,S),v=v[y]}return l}var Gn=Pn?function(l,d){return Pn.set(l,d),l}:identity,Wn=Ut?function(l,d){return Ut(l,\"toString\",{configurable:!0,enumerable:!1,value:constant(d),writable:!0})}:identity;function baseShuffle(l){return shuffleSelf(values(l))}function baseSlice(l,d,u){var p=-1,g=l.length;d<0&&(d=-d>g?0:g+d),(u=u>g?g:u)<0&&(u+=g),g=d>u?0:u-d>>>0,d>>>=0;for(var f=h(g);++p<g;)f[p]=l[p+d];return f}function baseSome(l,d){var u;return jn(l,(function(l,p,h){return!(u=d(l,p,h))})),!!u}function baseSortedIndex(l,d,u){var p=0,h=null==l?p:l.length;if(\"number\"==typeof d&&d==d&&h<=J){for(;p<h;){var g=p+h>>>1,f=l[g];null!==f&&!isSymbol(f)&&(u?f<=d:f<d)?p=g+1:h=g}return h}return baseSortedIndexBy(l,d,identity,u)}function baseSortedIndexBy(l,d,p,h){var g=0,f=null==l?0:l.length;if(0===f)return 0;for(var m=(d=p(d))!=d,v=null===d,y=isSymbol(d),S=d===u;g<f;){var _=qt((g+f)/2),C=p(l[_]),E=C!==u,T=null===C,b=C==C,I=isSymbol(C);if(m)var A=h||b;else A=S?b&&(h||E):v?b&&E&&(h||!T):y?b&&E&&!T&&(h||!I):!T&&!I&&(h?C<=d:C<d);A?g=_+1:f=_}return an(f,K)}function baseSortedUniq(l,d){for(var u=-1,p=l.length,h=0,g=[];++u<p;){var f=l[u],m=d?d(f):f;if(!u||!eq(m,v)){var v=m;g[h++]=0===f?0:f}}return g}function baseToNumber(l){return\"number\"==typeof l?l:isSymbol(l)?q:+l}function baseToString(l){if(\"string\"==typeof l)return l;if(Vi(l))return arrayMap(l,baseToString)+\"\";if(isSymbol(l))return Fn?Fn.call(l):\"\";var d=l+\"\";return\"0\"==d&&1/l==-H?\"-0\":d}function baseUniq(l,d,u){var p=-1,h=arrayIncludes,f=l.length,m=!0,v=[],y=v;if(u)m=!1,h=arrayIncludesWith;else if(f>=g){var S=d?null:Kn(l);if(S)return setToArray(S);m=!1,h=cacheHas,y=new SetCache}else y=d?[]:v;e:for(;++p<f;){var _=l[p],C=d?d(_):_;if(_=u||0!==_?_:0,m&&C==C){for(var E=y.length;E--;)if(y[E]===C)continue e;d&&y.push(C),v.push(_)}else h(y,C,u)||(y!==v&&y.push(C),v.push(_))}return v}function baseUnset(l,d){return null==(l=parent(l,d=castPath(d,l)))||delete l[toKey(last(d))]}function baseUpdate(l,d,u,p){return baseSet(l,d,u(baseGet(l,d)),p)}function baseWhile(l,d,u,p){for(var h=l.length,g=p?h:-1;(p?g--:++g<h)&&d(l[g],g,l););return u?baseSlice(l,p?0:g,p?g+1:h):baseSlice(l,p?g+1:0,p?h:g)}function baseWrapperValue(l,d){var u=l;return u instanceof LazyWrapper&&(u=u.value()),arrayReduce(d,(function(l,d){return d.func.apply(d.thisArg,arrayPush([l],d.args))}),u)}function baseXor(l,d,u){var p=l.length;if(p<2)return p?baseUniq(l[0]):[];for(var g=-1,f=h(p);++g<p;)for(var m=l[g],v=-1;++v<p;)v!=g&&(f[g]=baseDifference(f[g]||m,l[v],d,u));return baseUniq(baseFlatten(f,1),d,u)}function baseZipObject(l,d,p){for(var h=-1,g=l.length,f=d.length,m={};++h<g;){var v=h<f?d[h]:u;p(m,l[h],v)}return m}function castArrayLikeObject(l){return isArrayLikeObject(l)?l:[]}function castFunction(l){return\"function\"==typeof l?l:identity}function castPath(l,d){return Vi(l)?l:isKey(l,d)?[l]:ni(toString(l))}var qn=baseRest;function castSlice(l,d,p){var h=l.length;return p=p===u?h:p,!d&&p>=h?l:baseSlice(l,d,p)}var zn=jt||function(l){return on.clearTimeout(l)};function cloneBuffer(l,d){if(d)return l.slice();var u=l.length,p=Mt?Mt(u):new l.constructor(u);return l.copy(p),p}function cloneArrayBuffer(l){var d=new l.constructor(l.byteLength);return new Ot(d).set(new Ot(l)),d}function cloneDataView(l,d){var u=d?cloneArrayBuffer(l.buffer):l.buffer;return new l.constructor(u,l.byteOffset,l.byteLength)}function cloneRegExp(l){var d=new l.constructor(l.source,Ze.exec(l));return d.lastIndex=l.lastIndex,d}function cloneSymbol(l){return xn?ut(xn.call(l)):{}}function cloneTypedArray(l,d){var u=d?cloneArrayBuffer(l.buffer):l.buffer;return new l.constructor(u,l.byteOffset,l.length)}function compareAscending(l,d){if(l!==d){var p=l!==u,h=null===l,g=l==l,f=isSymbol(l),m=d!==u,v=null===d,y=d==d,S=isSymbol(d);if(!v&&!S&&!f&&l>d||f&&m&&y&&!v&&!S||h&&m&&y||!p&&y||!g)return 1;if(!h&&!f&&!S&&l<d||S&&p&&g&&!h&&!f||v&&p&&g||!m&&g||!y)return-1}return 0}function compareMultiple(l,d,u){for(var p=-1,h=l.criteria,g=d.criteria,f=h.length,m=u.length;++p<f;){var v=compareAscending(h[p],g[p]);if(v)return p>=m?v:v*(\"desc\"==u[p]?-1:1)}return l.index-d.index}function composeArgs(l,d,u,p){for(var g=-1,f=l.length,m=u.length,v=-1,y=d.length,S=rn(f-m,0),_=h(y+S),C=!p;++v<y;)_[v]=d[v];for(;++g<m;)(C||g<f)&&(_[u[g]]=l[g]);for(;S--;)_[v++]=l[g++];return _}function composeArgsRight(l,d,u,p){for(var g=-1,f=l.length,m=-1,v=u.length,y=-1,S=d.length,_=rn(f-v,0),C=h(_+S),E=!p;++g<_;)C[g]=l[g];for(var T=g;++y<S;)C[T+y]=d[y];for(;++m<v;)(E||g<f)&&(C[T+u[m]]=l[g++]);return C}function copyArray(l,d){var u=-1,p=l.length;for(d||(d=h(p));++u<p;)d[u]=l[u];return d}function copyObject(l,d,p,h){var g=!p;p||(p={});for(var f=-1,m=d.length;++f<m;){var v=d[f],y=h?h(p[v],l[v],v,p,l):u;y===u&&(y=l[v]),g?baseAssignValue(p,v,y):assignValue(p,v,y)}return p}function copySymbols(l,d){return copyObject(l,Qn(l),d)}function copySymbolsIn(l,d){return copyObject(l,Yn(l),d)}function createAggregator(l,d){return function(u,p){var h=Vi(u)?arrayAggregator:baseAggregator,g=d?d():{};return h(u,l,getIteratee(p,2),g)}}function createAssigner(l){return baseRest((function(d,p){var h=-1,g=p.length,f=g>1?p[g-1]:u,m=g>2?p[2]:u;for(f=l.length>3&&\"function\"==typeof f?(g--,f):u,m&&isIterateeCall(p[0],p[1],m)&&(f=g<3?u:f,g=1),d=ut(d);++h<g;){var v=p[h];v&&l(d,v,h,f)}return d}))}function createBaseEach(l,d){return function(u,p){if(null==u)return u;if(!isArrayLike(u))return l(u,p);for(var h=u.length,g=d?h:-1,f=ut(u);(d?g--:++g<h)&&!1!==p(f[g],g,f););return u}}function createBaseFor(l){return function(d,u,p){for(var h=-1,g=ut(d),f=p(d),m=f.length;m--;){var v=f[l?m:++h];if(!1===u(g[v],v,g))break}return d}}function createBind(l,d,u){var p=d&I,h=createCtor(l);function wrapper(){return(this&&this!==on&&this instanceof wrapper?h:l).apply(p?u:this,arguments)}return wrapper}function createCaseFirst(l){return function(d){var p=hasUnicode(d=toString(d))?stringToArray(d):u,h=p?p[0]:d.charAt(0),g=p?castSlice(p,1).join(\"\"):d.slice(1);return h[l]()+g}}function createCompounder(l){return function(d){return arrayReduce(words(deburr(d).replace(Bt,\"\")),l,\"\")}}function createCtor(l){return function(){var d=arguments;switch(d.length){case 0:return new l;case 1:return new l(d[0]);case 2:return new l(d[0],d[1]);case 3:return new l(d[0],d[1],d[2]);case 4:return new l(d[0],d[1],d[2],d[3]);case 5:return new l(d[0],d[1],d[2],d[3],d[4]);case 6:return new l(d[0],d[1],d[2],d[3],d[4],d[5]);case 7:return new l(d[0],d[1],d[2],d[3],d[4],d[5],d[6])}var u=Un(l.prototype),p=l.apply(u,d);return isObject(p)?p:u}}function createCurry(l,d,p){var g=createCtor(l);function wrapper(){for(var f=arguments.length,m=h(f),v=f,y=getHolder(wrapper);v--;)m[v]=arguments[v];var S=f<3&&m[0]!==y&&m[f-1]!==y?[]:replaceHolders(m,y);return(f-=S.length)<p?createRecurry(l,d,createHybrid,wrapper.placeholder,u,m,S,u,u,p-f):apply(this&&this!==on&&this instanceof wrapper?g:l,this,m)}return wrapper}function createFind(l){return function(d,p,h){var g=ut(d);if(!isArrayLike(d)){var f=getIteratee(p,3);d=keys(d),p=function(l){return f(g[l],l,g)}}var m=l(d,p,h);return m>-1?g[f?d[m]:m]:u}}function createFlow(l){return flatRest((function(d){var p=d.length,h=p,g=LodashWrapper.prototype.thru;for(l&&d.reverse();h--;){var f=d[h];if(\"function\"!=typeof f)throw new gt(m);if(g&&!v&&\"wrapper\"==getFuncName(f))var v=new LodashWrapper([],!0)}for(h=v?h:p;++h<p;){var y=getFuncName(f=d[h]),S=\"wrapper\"==y?Jn(f):u;v=S&&isLaziable(S[0])&&S[1]==(N|P|M|D)&&!S[4].length&&1==S[9]?v[getFuncName(S[0])].apply(v,S[3]):1==f.length&&isLaziable(f)?v[y]():v.thru(f)}return function(){var l=arguments,u=l[0];if(v&&1==l.length&&Vi(u))return v.plant(u).value();for(var h=0,g=p?d[h].apply(this,l):u;++h<p;)g=d[h].call(this,g);return g}}))}function createHybrid(l,d,p,g,f,m,v,y,S,_){var C=d&N,E=d&I,T=d&A,b=d&(P|O),R=d&L,M=T?u:createCtor(l);function wrapper(){for(var u=arguments.length,I=h(u),A=u;A--;)I[A]=arguments[A];if(b)var P=getHolder(wrapper),O=countHolders(I,P);if(g&&(I=composeArgs(I,g,f,b)),m&&(I=composeArgsRight(I,m,v,b)),u-=O,b&&u<_){var w=replaceHolders(I,P);return createRecurry(l,d,createHybrid,wrapper.placeholder,p,I,w,y,S,_-u)}var N=E?p:this,D=T?N[l]:l;return u=I.length,y?I=reorder(I,y):R&&u>1&&I.reverse(),C&&S<u&&(I.length=S),this&&this!==on&&this instanceof wrapper&&(D=M||createCtor(D)),D.apply(N,I)}return wrapper}function createInverter(l,d){return function(u,p){return baseInverter(u,l,d(p),{})}}function createMathOperation(l,d){return function(p,h){var g;if(p===u&&h===u)return d;if(p!==u&&(g=p),h!==u){if(g===u)return h;\"string\"==typeof p||\"string\"==typeof h?(p=baseToString(p),h=baseToString(h)):(p=baseToNumber(p),h=baseToNumber(h)),g=l(p,h)}return g}}function createOver(l){return flatRest((function(d){return d=arrayMap(d,baseUnary(getIteratee())),baseRest((function(u){var p=this;return l(d,(function(l){return apply(l,p,u)}))}))}))}function createPadding(l,d){var p=(d=d===u?\" \":baseToString(d)).length;if(p<2)return p?baseRepeat(d,l):d;var h=baseRepeat(d,Wt(l/stringSize(d)));return hasUnicode(d)?castSlice(stringToArray(h),0,l).join(\"\"):h.slice(0,l)}function createPartial(l,d,u,p){var g=d&I,f=createCtor(l);function wrapper(){for(var d=-1,m=arguments.length,v=-1,y=p.length,S=h(y+m),_=this&&this!==on&&this instanceof wrapper?f:l;++v<y;)S[v]=p[v];for(;m--;)S[v++]=arguments[++d];return apply(_,g?u:this,S)}return wrapper}function createRange(l){return function(d,p,h){return h&&\"number\"!=typeof h&&isIterateeCall(d,p,h)&&(p=h=u),d=toFinite(d),p===u?(p=d,d=0):p=toFinite(p),baseRange(d,p,h=h===u?d<p?1:-1:toFinite(h),l)}}function createRelationalOperation(l){return function(d,u){return\"string\"==typeof d&&\"string\"==typeof u||(d=toNumber(d),u=toNumber(u)),l(d,u)}}function createRecurry(l,d,p,h,g,f,m,v,y,S){var _=d&P;d|=_?M:w,(d&=~(_?w:M))&R||(d&=~(I|A));var C=[l,d,g,_?f:u,_?m:u,_?u:f,_?u:m,v,y,S],E=p.apply(u,C);return isLaziable(l)&&Zn(E,C),E.placeholder=h,setWrapToString(E,l,d)}function createRound(l){var d=dt[l];return function(l,u){if(l=toNumber(l),(u=null==u?0:an(toInteger(u),292))&&Xt(l)){var p=(toString(l)+\"e\").split(\"e\");return+((p=(toString(d(p[0]+\"e\"+(+p[1]+u)))+\"e\").split(\"e\"))[0]+\"e\"+(+p[1]-u))}return d(l)}}var Kn=In&&1/setToArray(new In([,-0]))[1]==H?function(l){return new In(l)}:noop;function createToPairs(l){return function(d){var u=$n(d);return u==oe?mapToArray(d):u==pe?setToPairs(d):baseToPairs(d,l(d))}}function createWrap(l,d,p,h,g,f,v,y){var S=d&A;if(!S&&\"function\"!=typeof l)throw new gt(m);var _=h?h.length:0;if(_||(d&=~(M|w),h=g=u),v=v===u?v:rn(toInteger(v),0),y=y===u?y:toInteger(y),_-=g?g.length:0,d&w){var C=h,E=g;h=g=u}var T=S?u:Jn(l),b=[l,d,p,h,g,C,E,f,v,y];if(T&&mergeData(b,T),l=b[0],d=b[1],p=b[2],h=b[3],g=b[4],!(y=b[9]=b[9]===u?S?0:l.length:rn(b[9]-_,0))&&d&(P|O)&&(d&=~(P|O)),d&&d!=I)R=d==P||d==O?createCurry(l,d,y):d!=M&&d!=(I|M)||g.length?createHybrid.apply(u,b):createPartial(l,d,p,h);else var R=createBind(l,d,p);return setWrapToString((T?Gn:Zn)(R,b),l,d)}function customDefaultsAssignIn(l,d,p,h){return l===u||eq(l,vt[p])&&!_t.call(h,p)?d:l}function customDefaultsMerge(l,d,p,h,g,f){return isObject(l)&&isObject(d)&&(f.set(d,l),baseMerge(l,d,u,customDefaultsMerge,f),f.delete(d)),l}function customOmitClone(l){return isPlainObject(l)?u:l}function equalArrays(l,d,p,h,g,f){var m=p&T,v=l.length,y=d.length;if(v!=y&&!(m&&y>v))return!1;var S=f.get(l),_=f.get(d);if(S&&_)return S==d&&_==l;var C=-1,E=!0,I=p&b?new SetCache:u;for(f.set(l,d),f.set(d,l);++C<v;){var A=l[C],R=d[C];if(h)var P=m?h(R,A,C,d,l,f):h(A,R,C,l,d,f);if(P!==u){if(P)continue;E=!1;break}if(I){if(!arraySome(d,(function(l,d){if(!cacheHas(I,d)&&(A===l||g(A,l,p,h,f)))return I.push(d)}))){E=!1;break}}else if(A!==R&&!g(A,R,p,h,f)){E=!1;break}}return f.delete(l),f.delete(d),E}function equalByTag(l,d,u,p,h,g,f){switch(u){case Se:if(l.byteLength!=d.byteLength||l.byteOffset!=d.byteOffset)return!1;l=l.buffer,d=d.buffer;case ye:return!(l.byteLength!=d.byteLength||!g(new Ot(l),new Ot(d)));case Z:case ee:case ae:return eq(+l,+d);case ne:return l.name==d.name&&l.message==d.message;case ue:case he:return l==d+\"\";case oe:var m=mapToArray;case pe:var v=p&T;if(m||(m=setToArray),l.size!=d.size&&!v)return!1;var y=f.get(l);if(y)return y==d;p|=b,f.set(l,d);var S=equalArrays(m(l),m(d),p,h,g,f);return f.delete(l),S;case ge:if(xn)return xn.call(l)==xn.call(d)}return!1}function equalObjects(l,d,p,h,g,f){var m=p&T,v=getAllKeys(l),y=v.length;if(y!=getAllKeys(d).length&&!m)return!1;for(var S=y;S--;){var _=v[S];if(!(m?_ in d:_t.call(d,_)))return!1}var C=f.get(l),E=f.get(d);if(C&&E)return C==d&&E==l;var b=!0;f.set(l,d),f.set(d,l);for(var I=m;++S<y;){var A=l[_=v[S]],R=d[_];if(h)var P=m?h(R,A,_,d,l,f):h(A,R,_,l,d,f);if(!(P===u?A===R||g(A,R,p,h,f):P)){b=!1;break}I||(I=\"constructor\"==_)}if(b&&!I){var O=l.constructor,M=d.constructor;O==M||!(\"constructor\"in l)||!(\"constructor\"in d)||\"function\"==typeof O&&O instanceof O&&\"function\"==typeof M&&M instanceof M||(b=!1)}return f.delete(l),f.delete(d),b}function flatRest(l){return ti(overRest(l,u,flatten),l+\"\")}function getAllKeys(l){return baseGetAllKeys(l,keys,Qn)}function getAllKeysIn(l){return baseGetAllKeys(l,keysIn,Yn)}var Jn=Pn?function(l){return Pn.get(l)}:noop;function getFuncName(l){for(var d=l.name+\"\",u=On[d],p=_t.call(On,d)?u.length:0;p--;){var h=u[p],g=h.func;if(null==g||g==l)return h.name}return d}function getHolder(l){return(_t.call(lodash,\"placeholder\")?lodash:l).placeholder}function getIteratee(){var l=lodash.iteratee||iteratee;return l=l===iteratee?baseIteratee:l,arguments.length?l(arguments[0],arguments[1]):l}function getMapData(l,d){var u=l.__data__;return isKeyable(d)?u[\"string\"==typeof d?\"string\":\"hash\"]:u.map}function getMatchData(l){for(var d=keys(l),u=d.length;u--;){var p=d[u],h=l[p];d[u]=[p,h,isStrictComparable(h)]}return d}function getNative(l,d){var p=getValue(l,d);return baseIsNative(p)?p:u}function getRawTag(l){var d=_t.call(l,Ft),p=l[Ft];try{l[Ft]=u;var h=!0}catch(l){}var g=Tt.call(l);return h&&(d?l[Ft]=p:delete l[Ft]),g}var Qn=Yt?function(l){return null==l?[]:(l=ut(l),arrayFilter(Yt(l),(function(d){return Dt.call(l,d)})))}:stubArray,Yn=Yt?function(l){for(var d=[];l;)arrayPush(d,Qn(l)),l=wt(l);return d}:stubArray,$n=baseGetTag;function getView(l,d,u){for(var p=-1,h=u.length;++p<h;){var g=u[p],f=g.size;switch(g.type){case\"drop\":l+=f;break;case\"dropRight\":d-=f;break;case\"take\":d=an(d,l+f);break;case\"takeRight\":l=rn(l,d-f)}}return{start:l,end:d}}function getWrapDetails(l){var d=l.match(Je);return d?d[1].split(Qe):[]}function hasPath(l,d,u){for(var p=-1,h=(d=castPath(d,l)).length,g=!1;++p<h;){var f=toKey(d[p]);if(!(g=null!=l&&u(l,f)))break;l=l[f]}return g||++p!=h?g:!!(h=null==l?0:l.length)&&isLength(h)&&isIndex(f,h)&&(Vi(l)||Bi(l))}function initCloneArray(l){var d=l.length,u=new l.constructor(d);return d&&\"string\"==typeof l[0]&&_t.call(l,\"index\")&&(u.index=l.index,u.input=l.input),u}function initCloneObject(l){return\"function\"!=typeof l.constructor||isPrototype(l)?{}:Un(wt(l))}function initCloneByTag(l,d,u){var p=l.constructor;switch(d){case ye:return cloneArrayBuffer(l);case Z:case ee:return new p(+l);case Se:return cloneDataView(l,u);case _e:case Ce:case Ee:case Te:case be:case Ie:case Ae:case Re:case Pe:return cloneTypedArray(l,u);case oe:return new p;case ae:case he:return new p(l);case ue:return cloneRegExp(l);case pe:return new p;case ge:return cloneSymbol(l)}}function insertWrapDetails(l,d){var u=d.length;if(!u)return l;var p=u-1;return d[p]=(u>1?\"& \":\"\")+d[p],d=d.join(u>2?\", \":\" \"),l.replace(Ke,\"{\\n/* [wrapped with \"+d+\"] */\\n\")}function isFlattenable(l){return Vi(l)||Bi(l)||!!(kt&&l&&l[kt])}function isIndex(l,d){var u=typeof l;return!!(d=null==d?G:d)&&(\"number\"==u||\"symbol\"!=u&&rt.test(l))&&l>-1&&l%1==0&&l<d}function isIterateeCall(l,d,u){if(!isObject(u))return!1;var p=typeof d;return!!(\"number\"==p?isArrayLike(u)&&isIndex(d,u.length):\"string\"==p&&d in u)&&eq(u[d],l)}function isKey(l,d){if(Vi(l))return!1;var u=typeof l;return!(\"number\"!=u&&\"symbol\"!=u&&\"boolean\"!=u&&null!=l&&!isSymbol(l))||(Be.test(l)||!je.test(l)||null!=d&&l in ut(d))}function isKeyable(l){var d=typeof l;return\"string\"==d||\"number\"==d||\"symbol\"==d||\"boolean\"==d?\"__proto__\"!==l:null===l}function isLaziable(l){var d=getFuncName(l),u=lodash[d];if(\"function\"!=typeof u||!(d in LazyWrapper.prototype))return!1;if(l===u)return!0;var p=Jn(u);return!!p&&l===p[0]}function isMasked(l){return!!Et&&Et in l}(En&&$n(new En(new ArrayBuffer(1)))!=Se||Tn&&$n(new Tn)!=oe||bn&&$n(bn.resolve())!=le||In&&$n(new In)!=pe||An&&$n(new An)!=me)&&($n=function(l){var d=baseGetTag(l),p=d==ce?l.constructor:u,h=p?toSource(p):\"\";if(h)switch(h){case Mn:return Se;case wn:return oe;case Nn:return le;case Dn:return pe;case Ln:return me}return d});var Xn=yt?isFunction:stubFalse;function isPrototype(l){var d=l&&l.constructor;return l===(\"function\"==typeof d&&d.prototype||vt)}function isStrictComparable(l){return l==l&&!isObject(l)}function matchesStrictComparable(l,d){return function(p){return null!=p&&(p[l]===d&&(d!==u||l in ut(p)))}}function memoizeCapped(l){var d=memoize(l,(function(l){return u.size===y&&u.clear(),l})),u=d.cache;return d}function mergeData(l,d){var u=l[1],p=d[1],h=u|p,g=h<(I|A|N),f=p==N&&u==P||p==N&&u==D&&l[7].length<=d[8]||p==(N|D)&&d[7].length<=d[8]&&u==P;if(!g&&!f)return l;p&I&&(l[2]=d[2],h|=u&I?0:R);var m=d[3];if(m){var v=l[3];l[3]=v?composeArgs(v,m,d[4]):m,l[4]=v?replaceHolders(l[3],S):d[4]}return(m=d[5])&&(v=l[5],l[5]=v?composeArgsRight(v,m,d[6]):m,l[6]=v?replaceHolders(l[5],S):d[6]),(m=d[7])&&(l[7]=m),p&N&&(l[8]=null==l[8]?d[8]:an(l[8],d[8])),null==l[9]&&(l[9]=d[9]),l[0]=d[0],l[1]=h,l}function nativeKeysIn(l){var d=[];if(null!=l)for(var u in ut(l))d.push(u);return d}function objectToString(l){return Tt.call(l)}function overRest(l,d,p){return d=rn(d===u?l.length-1:d,0),function(){for(var u=arguments,g=-1,f=rn(u.length-d,0),m=h(f);++g<f;)m[g]=u[d+g];g=-1;for(var v=h(d+1);++g<d;)v[g]=u[g];return v[d]=p(m),apply(l,this,v)}}function parent(l,d){return d.length<2?l:baseGet(l,baseSlice(d,0,-1))}function reorder(l,d){for(var p=l.length,h=an(d.length,p),g=copyArray(l);h--;){var f=d[h];l[h]=isIndex(f,p)?g[f]:u}return l}function safeGet(l,d){if((\"constructor\"!==d||\"function\"!=typeof l[d])&&\"__proto__\"!=d)return l[d]}var Zn=shortOut(Gn),ei=Gt||function(l,d){return on.setTimeout(l,d)},ti=shortOut(Wn);function setWrapToString(l,d,u){var p=d+\"\";return ti(l,insertWrapDetails(p,updateWrapDetails(getWrapDetails(p),u)))}function shortOut(l){var d=0,p=0;return function(){var h=sn(),g=U-(h-p);if(p=h,g>0){if(++d>=F)return arguments[0]}else d=0;return l.apply(u,arguments)}}function shuffleSelf(l,d){var p=-1,h=l.length,g=h-1;for(d=d===u?h:d;++p<d;){var f=baseRandom(p,g),m=l[f];l[f]=l[p],l[p]=m}return l.length=d,l}var ni=memoizeCapped((function(l){var d=[];return 46===l.charCodeAt(0)&&d.push(\"\"),l.replace(Ve,(function(l,u,p,h){d.push(p?h.replace($e,\"$1\"):u||l)})),d}));function toKey(l){if(\"string\"==typeof l||isSymbol(l))return l;var d=l+\"\";return\"0\"==d&&1/l==-H?\"-0\":d}function toSource(l){if(null!=l){try{return St.call(l)}catch(l){}try{return l+\"\"}catch(l){}}return\"\"}function updateWrapDetails(l,d){return arrayEach(Q,(function(u){var p=\"_.\"+u[0];d&u[1]&&!arrayIncludes(l,p)&&l.push(p)})),l.sort()}function wrapperClone(l){if(l instanceof LazyWrapper)return l.clone();var d=new LodashWrapper(l.__wrapped__,l.__chain__);return d.__actions__=copyArray(l.__actions__),d.__index__=l.__index__,d.__values__=l.__values__,d}function chunk(l,d,p){d=(p?isIterateeCall(l,d,p):d===u)?1:rn(toInteger(d),0);var g=null==l?0:l.length;if(!g||d<1)return[];for(var f=0,m=0,v=h(Wt(g/d));f<g;)v[m++]=baseSlice(l,f,f+=d);return v}function compact(l){for(var d=-1,u=null==l?0:l.length,p=0,h=[];++d<u;){var g=l[d];g&&(h[p++]=g)}return h}function concat(){var l=arguments.length;if(!l)return[];for(var d=h(l-1),u=arguments[0],p=l;p--;)d[p-1]=arguments[p];return arrayPush(Vi(u)?copyArray(u):[u],baseFlatten(d,1))}var ii=baseRest((function(l,d){return isArrayLikeObject(l)?baseDifference(l,baseFlatten(d,1,isArrayLikeObject,!0)):[]})),ri=baseRest((function(l,d){var p=last(d);return isArrayLikeObject(p)&&(p=u),isArrayLikeObject(l)?baseDifference(l,baseFlatten(d,1,isArrayLikeObject,!0),getIteratee(p,2)):[]})),oi=baseRest((function(l,d){var p=last(d);return isArrayLikeObject(p)&&(p=u),isArrayLikeObject(l)?baseDifference(l,baseFlatten(d,1,isArrayLikeObject,!0),u,p):[]}));function drop(l,d,p){var h=null==l?0:l.length;return h?baseSlice(l,(d=p||d===u?1:toInteger(d))<0?0:d,h):[]}function dropRight(l,d,p){var h=null==l?0:l.length;return h?baseSlice(l,0,(d=h-(d=p||d===u?1:toInteger(d)))<0?0:d):[]}function dropRightWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3),!0,!0):[]}function dropWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3),!0):[]}function fill(l,d,u,p){var h=null==l?0:l.length;return h?(u&&\"number\"!=typeof u&&isIterateeCall(l,d,u)&&(u=0,p=h),baseFill(l,d,u,p)):[]}function findIndex(l,d,u){var p=null==l?0:l.length;if(!p)return-1;var h=null==u?0:toInteger(u);return h<0&&(h=rn(p+h,0)),baseFindIndex(l,getIteratee(d,3),h)}function findLastIndex(l,d,p){var h=null==l?0:l.length;if(!h)return-1;var g=h-1;return p!==u&&(g=toInteger(p),g=p<0?rn(h+g,0):an(g,h-1)),baseFindIndex(l,getIteratee(d,3),g,!0)}function flatten(l){return(null==l?0:l.length)?baseFlatten(l,1):[]}function flattenDeep(l){return(null==l?0:l.length)?baseFlatten(l,H):[]}function flattenDepth(l,d){return(null==l?0:l.length)?baseFlatten(l,d=d===u?1:toInteger(d)):[]}function fromPairs(l){for(var d=-1,u=null==l?0:l.length,p={};++d<u;){var h=l[d];p[h[0]]=h[1]}return p}function head(l){return l&&l.length?l[0]:u}function indexOf(l,d,u){var p=null==l?0:l.length;if(!p)return-1;var h=null==u?0:toInteger(u);return h<0&&(h=rn(p+h,0)),baseIndexOf(l,d,h)}function initial(l){return(null==l?0:l.length)?baseSlice(l,0,-1):[]}var ai=baseRest((function(l){var d=arrayMap(l,castArrayLikeObject);return d.length&&d[0]===l[0]?baseIntersection(d):[]})),si=baseRest((function(l){var d=last(l),p=arrayMap(l,castArrayLikeObject);return d===last(p)?d=u:p.pop(),p.length&&p[0]===l[0]?baseIntersection(p,getIteratee(d,2)):[]})),ci=baseRest((function(l){var d=last(l),p=arrayMap(l,castArrayLikeObject);return(d=\"function\"==typeof d?d:u)&&p.pop(),p.length&&p[0]===l[0]?baseIntersection(p,u,d):[]}));function join(l,d){return null==l?\"\":Zt.call(l,d)}function last(l){var d=null==l?0:l.length;return d?l[d-1]:u}function lastIndexOf(l,d,p){var h=null==l?0:l.length;if(!h)return-1;var g=h;return p!==u&&(g=(g=toInteger(p))<0?rn(h+g,0):an(g,h-1)),d==d?strictLastIndexOf(l,d,g):baseFindIndex(l,baseIsNaN,g,!0)}function nth(l,d){return l&&l.length?baseNth(l,toInteger(d)):u}var li=baseRest(pullAll);function pullAll(l,d){return l&&l.length&&d&&d.length?basePullAll(l,d):l}function pullAllBy(l,d,u){return l&&l.length&&d&&d.length?basePullAll(l,d,getIteratee(u,2)):l}function pullAllWith(l,d,p){return l&&l.length&&d&&d.length?basePullAll(l,d,u,p):l}var di=flatRest((function(l,d){var u=null==l?0:l.length,p=baseAt(l,d);return basePullAt(l,arrayMap(d,(function(l){return isIndex(l,u)?+l:l})).sort(compareAscending)),p}));function remove(l,d){var u=[];if(!l||!l.length)return u;var p=-1,h=[],g=l.length;for(d=getIteratee(d,3);++p<g;){var f=l[p];d(f,p,l)&&(u.push(f),h.push(p))}return basePullAt(l,h),u}function reverse(l){return null==l?l:vn.call(l)}function slice(l,d,p){var h=null==l?0:l.length;return h?(p&&\"number\"!=typeof p&&isIterateeCall(l,d,p)?(d=0,p=h):(d=null==d?0:toInteger(d),p=p===u?h:toInteger(p)),baseSlice(l,d,p)):[]}function sortedIndex(l,d){return baseSortedIndex(l,d)}function sortedIndexBy(l,d,u){return baseSortedIndexBy(l,d,getIteratee(u,2))}function sortedIndexOf(l,d){var u=null==l?0:l.length;if(u){var p=baseSortedIndex(l,d);if(p<u&&eq(l[p],d))return p}return-1}function sortedLastIndex(l,d){return baseSortedIndex(l,d,!0)}function sortedLastIndexBy(l,d,u){return baseSortedIndexBy(l,d,getIteratee(u,2),!0)}function sortedLastIndexOf(l,d){if(null==l?0:l.length){var u=baseSortedIndex(l,d,!0)-1;if(eq(l[u],d))return u}return-1}function sortedUniq(l){return l&&l.length?baseSortedUniq(l):[]}function sortedUniqBy(l,d){return l&&l.length?baseSortedUniq(l,getIteratee(d,2)):[]}function tail(l){var d=null==l?0:l.length;return d?baseSlice(l,1,d):[]}function take(l,d,p){return l&&l.length?baseSlice(l,0,(d=p||d===u?1:toInteger(d))<0?0:d):[]}function takeRight(l,d,p){var h=null==l?0:l.length;return h?baseSlice(l,(d=h-(d=p||d===u?1:toInteger(d)))<0?0:d,h):[]}function takeRightWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3),!1,!0):[]}function takeWhile(l,d){return l&&l.length?baseWhile(l,getIteratee(d,3)):[]}var ui=baseRest((function(l){return baseUniq(baseFlatten(l,1,isArrayLikeObject,!0))})),pi=baseRest((function(l){var d=last(l);return isArrayLikeObject(d)&&(d=u),baseUniq(baseFlatten(l,1,isArrayLikeObject,!0),getIteratee(d,2))})),hi=baseRest((function(l){var d=last(l);return d=\"function\"==typeof d?d:u,baseUniq(baseFlatten(l,1,isArrayLikeObject,!0),u,d)}));function uniq(l){return l&&l.length?baseUniq(l):[]}function uniqBy(l,d){return l&&l.length?baseUniq(l,getIteratee(d,2)):[]}function uniqWith(l,d){return d=\"function\"==typeof d?d:u,l&&l.length?baseUniq(l,u,d):[]}function unzip(l){if(!l||!l.length)return[];var d=0;return l=arrayFilter(l,(function(l){if(isArrayLikeObject(l))return d=rn(l.length,d),!0})),baseTimes(d,(function(d){return arrayMap(l,baseProperty(d))}))}function unzipWith(l,d){if(!l||!l.length)return[];var p=unzip(l);return null==d?p:arrayMap(p,(function(l){return apply(d,u,l)}))}var gi=baseRest((function(l,d){return isArrayLikeObject(l)?baseDifference(l,d):[]})),fi=baseRest((function(l){return baseXor(arrayFilter(l,isArrayLikeObject))})),mi=baseRest((function(l){var d=last(l);return isArrayLikeObject(d)&&(d=u),baseXor(arrayFilter(l,isArrayLikeObject),getIteratee(d,2))})),vi=baseRest((function(l){var d=last(l);return d=\"function\"==typeof d?d:u,baseXor(arrayFilter(l,isArrayLikeObject),u,d)})),yi=baseRest(unzip);function zipObject(l,d){return baseZipObject(l||[],d||[],assignValue)}function zipObjectDeep(l,d){return baseZipObject(l||[],d||[],baseSet)}var Si=baseRest((function(l){var d=l.length,p=d>1?l[d-1]:u;return p=\"function\"==typeof p?(l.pop(),p):u,unzipWith(l,p)}));function chain(l){var d=lodash(l);return d.__chain__=!0,d}function tap(l,d){return d(l),l}function thru(l,d){return d(l)}var _i=flatRest((function(l){var d=l.length,p=d?l[0]:0,h=this.__wrapped__,interceptor=function(d){return baseAt(d,l)};return!(d>1||this.__actions__.length)&&h instanceof LazyWrapper&&isIndex(p)?((h=h.slice(p,+p+(d?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:u}),new LodashWrapper(h,this.__chain__).thru((function(l){return d&&!l.length&&l.push(u),l}))):this.thru(interceptor)}));function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){this.__values__===u&&(this.__values__=toArray(this.value()));var l=this.__index__>=this.__values__.length;return{done:l,value:l?u:this.__values__[this.__index__++]}}function wrapperToIterator(){return this}function wrapperPlant(l){for(var d,p=this;p instanceof baseLodash;){var h=wrapperClone(p);h.__index__=0,h.__values__=u,d?g.__wrapped__=h:d=h;var g=h;p=p.__wrapped__}return g.__wrapped__=l,d}function wrapperReverse(){var l=this.__wrapped__;if(l instanceof LazyWrapper){var d=l;return this.__actions__.length&&(d=new LazyWrapper(this)),(d=d.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:u}),new LodashWrapper(d,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var Ci=createAggregator((function(l,d,u){_t.call(l,u)?++l[u]:baseAssignValue(l,u,1)}));function every(l,d,p){var h=Vi(l)?arrayEvery:baseEvery;return p&&isIterateeCall(l,d,p)&&(d=u),h(l,getIteratee(d,3))}function filter(l,d){return(Vi(l)?arrayFilter:baseFilter)(l,getIteratee(d,3))}var Ei=createFind(findIndex),Ti=createFind(findLastIndex);function flatMap(l,d){return baseFlatten(map(l,d),1)}function flatMapDeep(l,d){return baseFlatten(map(l,d),H)}function flatMapDepth(l,d,p){return p=p===u?1:toInteger(p),baseFlatten(map(l,d),p)}function forEach(l,d){return(Vi(l)?arrayEach:jn)(l,getIteratee(d,3))}function forEachRight(l,d){return(Vi(l)?arrayEachRight:Bn)(l,getIteratee(d,3))}var bi=createAggregator((function(l,d,u){_t.call(l,u)?l[u].push(d):baseAssignValue(l,u,[d])}));function includes(l,d,u,p){l=isArrayLike(l)?l:values(l),u=u&&!p?toInteger(u):0;var h=l.length;return u<0&&(u=rn(h+u,0)),isString(l)?u<=h&&l.indexOf(d,u)>-1:!!h&&baseIndexOf(l,d,u)>-1}var Ii=baseRest((function(l,d,u){var p=-1,g=\"function\"==typeof d,f=isArrayLike(l)?h(l.length):[];return jn(l,(function(l){f[++p]=g?apply(d,l,u):baseInvoke(l,d,u)})),f})),Ai=createAggregator((function(l,d,u){baseAssignValue(l,u,d)}));function map(l,d){return(Vi(l)?arrayMap:baseMap)(l,getIteratee(d,3))}function orderBy(l,d,p,h){return null==l?[]:(Vi(d)||(d=null==d?[]:[d]),Vi(p=h?u:p)||(p=null==p?[]:[p]),baseOrderBy(l,d,p))}var Ri=createAggregator((function(l,d,u){l[u?0:1].push(d)}),(function(){return[[],[]]}));function reduce(l,d,u){var p=Vi(l)?arrayReduce:baseReduce,h=arguments.length<3;return p(l,getIteratee(d,4),u,h,jn)}function reduceRight(l,d,u){var p=Vi(l)?arrayReduceRight:baseReduce,h=arguments.length<3;return p(l,getIteratee(d,4),u,h,Bn)}function reject(l,d){return(Vi(l)?arrayFilter:baseFilter)(l,negate(getIteratee(d,3)))}function sample(l){return(Vi(l)?arraySample:baseSample)(l)}function sampleSize(l,d,p){return d=(p?isIterateeCall(l,d,p):d===u)?1:toInteger(d),(Vi(l)?arraySampleSize:baseSampleSize)(l,d)}function shuffle(l){return(Vi(l)?arrayShuffle:baseShuffle)(l)}function size(l){if(null==l)return 0;if(isArrayLike(l))return isString(l)?stringSize(l):l.length;var d=$n(l);return d==oe||d==pe?l.size:baseKeys(l).length}function some(l,d,p){var h=Vi(l)?arraySome:baseSome;return p&&isIterateeCall(l,d,p)&&(d=u),h(l,getIteratee(d,3))}var Pi=baseRest((function(l,d){if(null==l)return[];var u=d.length;return u>1&&isIterateeCall(l,d[0],d[1])?d=[]:u>2&&isIterateeCall(d[0],d[1],d[2])&&(d=[d[0]]),baseOrderBy(l,baseFlatten(d,1),[])})),Oi=Ht||function(){return on.Date.now()};function after(l,d){if(\"function\"!=typeof d)throw new gt(m);return l=toInteger(l),function(){if(--l<1)return d.apply(this,arguments)}}function ary(l,d,p){return d=p?u:d,d=l&&null==d?l.length:d,createWrap(l,N,u,u,u,u,d)}function before(l,d){var p;if(\"function\"!=typeof d)throw new gt(m);return l=toInteger(l),function(){return--l>0&&(p=d.apply(this,arguments)),l<=1&&(d=u),p}}var Mi=baseRest((function(l,d,u){var p=I;if(u.length){var h=replaceHolders(u,getHolder(Mi));p|=M}return createWrap(l,p,d,u,h)})),wi=baseRest((function(l,d,u){var p=I|A;if(u.length){var h=replaceHolders(u,getHolder(wi));p|=M}return createWrap(d,p,l,u,h)}));function curry(l,d,p){var h=createWrap(l,P,u,u,u,u,u,d=p?u:d);return h.placeholder=curry.placeholder,h}function curryRight(l,d,p){var h=createWrap(l,O,u,u,u,u,u,d=p?u:d);return h.placeholder=curryRight.placeholder,h}function debounce(l,d,p){var h,g,f,v,y,S,_=0,C=!1,E=!1,T=!0;if(\"function\"!=typeof l)throw new gt(m);function invokeFunc(d){var p=h,f=g;return h=g=u,_=d,v=l.apply(f,p)}function leadingEdge(l){return _=l,y=ei(timerExpired,d),C?invokeFunc(l):v}function remainingWait(l){var u=d-(l-S);return E?an(u,f-(l-_)):u}function shouldInvoke(l){var p=l-S;return S===u||p>=d||p<0||E&&l-_>=f}function timerExpired(){var l=Oi();if(shouldInvoke(l))return trailingEdge(l);y=ei(timerExpired,remainingWait(l))}function trailingEdge(l){return y=u,T&&h?invokeFunc(l):(h=g=u,v)}function cancel(){y!==u&&zn(y),_=0,h=S=g=y=u}function flush(){return y===u?v:trailingEdge(Oi())}function debounced(){var l=Oi(),p=shouldInvoke(l);if(h=arguments,g=this,S=l,p){if(y===u)return leadingEdge(S);if(E)return zn(y),y=ei(timerExpired,d),invokeFunc(S)}return y===u&&(y=ei(timerExpired,d)),v}return d=toNumber(d)||0,isObject(p)&&(C=!!p.leading,f=(E=\"maxWait\"in p)?rn(toNumber(p.maxWait)||0,d):f,T=\"trailing\"in p?!!p.trailing:T),debounced.cancel=cancel,debounced.flush=flush,debounced}var Ni=baseRest((function(l,d){return baseDelay(l,1,d)})),Di=baseRest((function(l,d,u){return baseDelay(l,toNumber(d)||0,u)}));function flip(l){return createWrap(l,L)}function memoize(l,d){if(\"function\"!=typeof l||null!=d&&\"function\"!=typeof d)throw new gt(m);var memoized=function(){var u=arguments,p=d?d.apply(this,u):u[0],h=memoized.cache;if(h.has(p))return h.get(p);var g=l.apply(this,u);return memoized.cache=h.set(p,g)||h,g};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(l){if(\"function\"!=typeof l)throw new gt(m);return function(){var d=arguments;switch(d.length){case 0:return!l.call(this);case 1:return!l.call(this,d[0]);case 2:return!l.call(this,d[0],d[1]);case 3:return!l.call(this,d[0],d[1],d[2])}return!l.apply(this,d)}}function once(l){return before(2,l)}memoize.Cache=MapCache;var Li=qn((function(l,d){var u=(d=1==d.length&&Vi(d[0])?arrayMap(d[0],baseUnary(getIteratee())):arrayMap(baseFlatten(d,1),baseUnary(getIteratee()))).length;return baseRest((function(p){for(var h=-1,g=an(p.length,u);++h<g;)p[h]=d[h].call(this,p[h]);return apply(l,this,p)}))})),ki=baseRest((function(l,d){var p=replaceHolders(d,getHolder(ki));return createWrap(l,M,u,d,p)})),xi=baseRest((function(l,d){var p=replaceHolders(d,getHolder(xi));return createWrap(l,w,u,d,p)})),Fi=flatRest((function(l,d){return createWrap(l,D,u,u,u,d)}));function rest(l,d){if(\"function\"!=typeof l)throw new gt(m);return baseRest(l,d=d===u?d:toInteger(d))}function spread(l,d){if(\"function\"!=typeof l)throw new gt(m);return d=null==d?0:rn(toInteger(d),0),baseRest((function(u){var p=u[d],h=castSlice(u,0,d);return p&&arrayPush(h,p),apply(l,this,h)}))}function throttle(l,d,u){var p=!0,h=!0;if(\"function\"!=typeof l)throw new gt(m);return isObject(u)&&(p=\"leading\"in u?!!u.leading:p,h=\"trailing\"in u?!!u.trailing:h),debounce(l,d,{leading:p,maxWait:d,trailing:h})}function unary(l){return ary(l,1)}function wrap(l,d){return ki(castFunction(d),l)}function castArray(){if(!arguments.length)return[];var l=arguments[0];return Vi(l)?l:[l]}function clone(l){return baseClone(l,E)}function cloneWith(l,d){return baseClone(l,E,d=\"function\"==typeof d?d:u)}function cloneDeep(l){return baseClone(l,_|E)}function cloneDeepWith(l,d){return baseClone(l,_|E,d=\"function\"==typeof d?d:u)}function conformsTo(l,d){return null==d||baseConformsTo(l,d,keys(d))}function eq(l,d){return l===d||l!=l&&d!=d}var Ui=createRelationalOperation(baseGt),ji=createRelationalOperation((function(l,d){return l>=d})),Bi=baseIsArguments(function(){return arguments}())?baseIsArguments:function(l){return isObjectLike(l)&&_t.call(l,\"callee\")&&!Dt.call(l,\"callee\")},Vi=h.isArray,Hi=un?baseUnary(un):baseIsArrayBuffer;function isArrayLike(l){return null!=l&&isLength(l.length)&&!isFunction(l)}function isArrayLikeObject(l){return isObjectLike(l)&&isArrayLike(l)}function isBoolean(l){return!0===l||!1===l||isObjectLike(l)&&baseGetTag(l)==Z}var Gi=$t||stubFalse,Wi=pn?baseUnary(pn):baseIsDate;function isElement(l){return isObjectLike(l)&&1===l.nodeType&&!isPlainObject(l)}function isEmpty(l){if(null==l)return!0;if(isArrayLike(l)&&(Vi(l)||\"string\"==typeof l||\"function\"==typeof l.splice||Gi(l)||Ji(l)||Bi(l)))return!l.length;var d=$n(l);if(d==oe||d==pe)return!l.size;if(isPrototype(l))return!baseKeys(l).length;for(var u in l)if(_t.call(l,u))return!1;return!0}function isEqual(l,d){return baseIsEqual(l,d)}function isEqualWith(l,d,p){var h=(p=\"function\"==typeof p?p:u)?p(l,d):u;return h===u?baseIsEqual(l,d,u,p):!!h}function isError(l){if(!isObjectLike(l))return!1;var d=baseGetTag(l);return d==ne||d==te||\"string\"==typeof l.message&&\"string\"==typeof l.name&&!isPlainObject(l)}function isFinite(l){return\"number\"==typeof l&&Xt(l)}function isFunction(l){if(!isObject(l))return!1;var d=baseGetTag(l);return d==ie||d==re||d==X||d==de}function isInteger(l){return\"number\"==typeof l&&l==toInteger(l)}function isLength(l){return\"number\"==typeof l&&l>-1&&l%1==0&&l<=G}function isObject(l){var d=typeof l;return null!=l&&(\"object\"==d||\"function\"==d)}function isObjectLike(l){return null!=l&&\"object\"==typeof l}var qi=hn?baseUnary(hn):baseIsMap;function isMatch(l,d){return l===d||baseIsMatch(l,d,getMatchData(d))}function isMatchWith(l,d,p){return p=\"function\"==typeof p?p:u,baseIsMatch(l,d,getMatchData(d),p)}function isNaN(l){return isNumber(l)&&l!=+l}function isNative(l){if(Xn(l))throw new ct(f);return baseIsNative(l)}function isNull(l){return null===l}function isNil(l){return null==l}function isNumber(l){return\"number\"==typeof l||isObjectLike(l)&&baseGetTag(l)==ae}function isPlainObject(l){if(!isObjectLike(l)||baseGetTag(l)!=ce)return!1;var d=wt(l);if(null===d)return!0;var u=_t.call(d,\"constructor\")&&d.constructor;return\"function\"==typeof u&&u instanceof u&&St.call(u)==bt}var zi=gn?baseUnary(gn):baseIsRegExp;function isSafeInteger(l){return isInteger(l)&&l>=-G&&l<=G}var Ki=fn?baseUnary(fn):baseIsSet;function isString(l){return\"string\"==typeof l||!Vi(l)&&isObjectLike(l)&&baseGetTag(l)==he}function isSymbol(l){return\"symbol\"==typeof l||isObjectLike(l)&&baseGetTag(l)==ge}var Ji=mn?baseUnary(mn):baseIsTypedArray;function isUndefined(l){return l===u}function isWeakMap(l){return isObjectLike(l)&&$n(l)==me}function isWeakSet(l){return isObjectLike(l)&&baseGetTag(l)==ve}var Qi=createRelationalOperation(baseLt),Yi=createRelationalOperation((function(l,d){return l<=d}));function toArray(l){if(!l)return[];if(isArrayLike(l))return isString(l)?stringToArray(l):copyArray(l);if(xt&&l[xt])return iteratorToArray(l[xt]());var d=$n(l);return(d==oe?mapToArray:d==pe?setToArray:values)(l)}function toFinite(l){return l?(l=toNumber(l))===H||l===-H?(l<0?-1:1)*W:l==l?l:0:0===l?l:0}function toInteger(l){var d=toFinite(l),u=d%1;return d==d?u?d-u:d:0}function toLength(l){return l?baseClamp(toInteger(l),0,z):0}function toNumber(l){if(\"number\"==typeof l)return l;if(isSymbol(l))return q;if(isObject(l)){var d=\"function\"==typeof l.valueOf?l.valueOf():l;l=isObject(d)?d+\"\":d}if(\"string\"!=typeof l)return 0===l?l:+l;l=l.replace(We,\"\");var u=tt.test(l);return u||it.test(l)?tn(l.slice(2),u?2:8):et.test(l)?q:+l}function toPlainObject(l){return copyObject(l,keysIn(l))}function toSafeInteger(l){return l?baseClamp(toInteger(l),-G,G):0===l?l:0}function toString(l){return null==l?\"\":baseToString(l)}var $i=createAssigner((function(l,d){if(isPrototype(d)||isArrayLike(d))copyObject(d,keys(d),l);else for(var u in d)_t.call(d,u)&&assignValue(l,u,d[u])})),Xi=createAssigner((function(l,d){copyObject(d,keysIn(d),l)})),Zi=createAssigner((function(l,d,u,p){copyObject(d,keysIn(d),l,p)})),er=createAssigner((function(l,d,u,p){copyObject(d,keys(d),l,p)})),tr=flatRest(baseAt);function create(l,d){var u=Un(l);return null==d?u:baseAssign(u,d)}var nr=baseRest((function(l,d){l=ut(l);var p=-1,h=d.length,g=h>2?d[2]:u;for(g&&isIterateeCall(d[0],d[1],g)&&(h=1);++p<h;)for(var f=d[p],m=keysIn(f),v=-1,y=m.length;++v<y;){var S=m[v],_=l[S];(_===u||eq(_,vt[S])&&!_t.call(l,S))&&(l[S]=f[S])}return l})),ir=baseRest((function(l){return l.push(u,customDefaultsMerge),apply(cr,u,l)}));function findKey(l,d){return baseFindKey(l,getIteratee(d,3),baseForOwn)}function findLastKey(l,d){return baseFindKey(l,getIteratee(d,3),baseForOwnRight)}function forIn(l,d){return null==l?l:Vn(l,getIteratee(d,3),keysIn)}function forInRight(l,d){return null==l?l:Hn(l,getIteratee(d,3),keysIn)}function forOwn(l,d){return l&&baseForOwn(l,getIteratee(d,3))}function forOwnRight(l,d){return l&&baseForOwnRight(l,getIteratee(d,3))}function functions(l){return null==l?[]:baseFunctions(l,keys(l))}function functionsIn(l){return null==l?[]:baseFunctions(l,keysIn(l))}function get(l,d,p){var h=null==l?u:baseGet(l,d);return h===u?p:h}function has(l,d){return null!=l&&hasPath(l,d,baseHas)}function hasIn(l,d){return null!=l&&hasPath(l,d,baseHasIn)}var rr=createInverter((function(l,d,u){null!=d&&\"function\"!=typeof d.toString&&(d=Tt.call(d)),l[d]=u}),constant(identity)),or=createInverter((function(l,d,u){null!=d&&\"function\"!=typeof d.toString&&(d=Tt.call(d)),_t.call(l,d)?l[d].push(u):l[d]=[u]}),getIteratee),ar=baseRest(baseInvoke);function keys(l){return isArrayLike(l)?arrayLikeKeys(l):baseKeys(l)}function keysIn(l){return isArrayLike(l)?arrayLikeKeys(l,!0):baseKeysIn(l)}function mapKeys(l,d){var u={};return d=getIteratee(d,3),baseForOwn(l,(function(l,p,h){baseAssignValue(u,d(l,p,h),l)})),u}function mapValues(l,d){var u={};return d=getIteratee(d,3),baseForOwn(l,(function(l,p,h){baseAssignValue(u,p,d(l,p,h))})),u}var sr=createAssigner((function(l,d,u){baseMerge(l,d,u)})),cr=createAssigner((function(l,d,u,p){baseMerge(l,d,u,p)})),lr=flatRest((function(l,d){var u={};if(null==l)return u;var p=!1;d=arrayMap(d,(function(d){return d=castPath(d,l),p||(p=d.length>1),d})),copyObject(l,getAllKeysIn(l),u),p&&(u=baseClone(u,_|C|E,customOmitClone));for(var h=d.length;h--;)baseUnset(u,d[h]);return u}));function omitBy(l,d){return pickBy(l,negate(getIteratee(d)))}var dr=flatRest((function(l,d){return null==l?{}:basePick(l,d)}));function pickBy(l,d){if(null==l)return{};var u=arrayMap(getAllKeysIn(l),(function(l){return[l]}));return d=getIteratee(d),basePickBy(l,u,(function(l,u){return d(l,u[0])}))}function result(l,d,p){var h=-1,g=(d=castPath(d,l)).length;for(g||(g=1,l=u);++h<g;){var f=null==l?u:l[toKey(d[h])];f===u&&(h=g,f=p),l=isFunction(f)?f.call(l):f}return l}function set(l,d,u){return null==l?l:baseSet(l,d,u)}function setWith(l,d,p,h){return h=\"function\"==typeof h?h:u,null==l?l:baseSet(l,d,p,h)}var ur=createToPairs(keys),pr=createToPairs(keysIn);function transform(l,d,u){var p=Vi(l),h=p||Gi(l)||Ji(l);if(d=getIteratee(d,4),null==u){var g=l&&l.constructor;u=h?p?new g:[]:isObject(l)&&isFunction(g)?Un(wt(l)):{}}return(h?arrayEach:baseForOwn)(l,(function(l,p,h){return d(u,l,p,h)})),u}function unset(l,d){return null==l||baseUnset(l,d)}function update(l,d,u){return null==l?l:baseUpdate(l,d,castFunction(u))}function updateWith(l,d,p,h){return h=\"function\"==typeof h?h:u,null==l?l:baseUpdate(l,d,castFunction(p),h)}function values(l){return null==l?[]:baseValues(l,keys(l))}function valuesIn(l){return null==l?[]:baseValues(l,keysIn(l))}function clamp(l,d,p){return p===u&&(p=d,d=u),p!==u&&(p=(p=toNumber(p))==p?p:0),d!==u&&(d=(d=toNumber(d))==d?d:0),baseClamp(toNumber(l),d,p)}function inRange(l,d,p){return d=toFinite(d),p===u?(p=d,d=0):p=toFinite(p),baseInRange(l=toNumber(l),d,p)}function random(l,d,p){if(p&&\"boolean\"!=typeof p&&isIterateeCall(l,d,p)&&(d=p=u),p===u&&(\"boolean\"==typeof d?(p=d,d=u):\"boolean\"==typeof l&&(p=l,l=u)),l===u&&d===u?(l=0,d=1):(l=toFinite(l),d===u?(d=l,l=0):d=toFinite(d)),l>d){var h=l;l=d,d=h}if(p||l%1||d%1){var g=dn();return an(l+g*(d-l+en(\"1e-\"+((g+\"\").length-1))),d)}return baseRandom(l,d)}var hr=createCompounder((function(l,d,u){return d=d.toLowerCase(),l+(u?capitalize(d):d)}));function capitalize(l){return _r(toString(l).toLowerCase())}function deburr(l){return(l=toString(l))&&l.replace(ot,yn).replace(Vt,\"\")}function endsWith(l,d,p){l=toString(l),d=baseToString(d);var h=l.length,g=p=p===u?h:baseClamp(toInteger(p),0,h);return(p-=d.length)>=0&&l.slice(p,g)==d}function escape(l){return(l=toString(l))&&ke.test(l)?l.replace(De,Sn):l}function escapeRegExp(l){return(l=toString(l))&&Ge.test(l)?l.replace(He,\"\\\\$&\"):l}var gr=createCompounder((function(l,d,u){return l+(u?\"-\":\"\")+d.toLowerCase()})),fr=createCompounder((function(l,d,u){return l+(u?\" \":\"\")+d.toLowerCase()})),mr=createCaseFirst(\"toLowerCase\");function pad(l,d,u){l=toString(l);var p=(d=toInteger(d))?stringSize(l):0;if(!d||p>=d)return l;var h=(d-p)/2;return createPadding(qt(h),u)+l+createPadding(Wt(h),u)}function padEnd(l,d,u){l=toString(l);var p=(d=toInteger(d))?stringSize(l):0;return d&&p<d?l+createPadding(d-p,u):l}function padStart(l,d,u){l=toString(l);var p=(d=toInteger(d))?stringSize(l):0;return d&&p<d?createPadding(d-p,u)+l:l}function parseInt(l,d,u){return u||null==d?d=0:d&&(d=+d),ln(toString(l).replace(qe,\"\"),d||0)}function repeat(l,d,p){return d=(p?isIterateeCall(l,d,p):d===u)?1:toInteger(d),baseRepeat(toString(l),d)}function replace(){var l=arguments,d=toString(l[0]);return l.length<3?d:d.replace(l[1],l[2])}var vr=createCompounder((function(l,d,u){return l+(u?\"_\":\"\")+d.toLowerCase()}));function split(l,d,p){return p&&\"number\"!=typeof p&&isIterateeCall(l,d,p)&&(d=p=u),(p=p===u?z:p>>>0)?(l=toString(l))&&(\"string\"==typeof d||null!=d&&!zi(d))&&!(d=baseToString(d))&&hasUnicode(l)?castSlice(stringToArray(l),0,p):l.split(d,p):[]}var yr=createCompounder((function(l,d,u){return l+(u?\" \":\"\")+_r(d)}));function startsWith(l,d,u){return l=toString(l),u=null==u?0:baseClamp(toInteger(u),0,l.length),d=baseToString(d),l.slice(u,u+d.length)==d}function template(l,d,p){var h=lodash.templateSettings;p&&isIterateeCall(l,d,p)&&(d=u),l=toString(l),d=Zi({},d,h,customDefaultsAssignIn);var g,f,m=Zi({},d.imports,h.imports,customDefaultsAssignIn),v=keys(m),y=baseValues(m,v),S=0,_=d.interpolate||at,C=\"__p += '\",E=pt((d.escape||at).source+\"|\"+_.source+\"|\"+(_===Ue?Xe:at).source+\"|\"+(d.evaluate||at).source+\"|$\",\"g\"),T=\"//# sourceURL=\"+(_t.call(d,\"sourceURL\")?(d.sourceURL+\"\").replace(/\\s/g,\" \"):\"lodash.templateSources[\"+ ++Kt+\"]\")+\"\\n\";l.replace(E,(function(d,u,p,h,m,v){return p||(p=h),C+=l.slice(S,v).replace(st,escapeStringChar),u&&(g=!0,C+=\"' +\\n__e(\"+u+\") +\\n'\"),m&&(f=!0,C+=\"';\\n\"+m+\";\\n__p += '\"),p&&(C+=\"' +\\n((__t = (\"+p+\")) == null ? '' : __t) +\\n'\"),S=v+d.length,d})),C+=\"';\\n\";var b=_t.call(d,\"variable\")&&d.variable;b||(C=\"with (obj) {\\n\"+C+\"\\n}\\n\"),C=(f?C.replace(Oe,\"\"):C).replace(Me,\"$1\").replace(we,\"$1;\"),C=\"function(\"+(b||\"obj\")+\") {\\n\"+(b?\"\":\"obj || (obj = {});\\n\")+\"var __t, __p = ''\"+(g?\", __e = _.escape\":\"\")+(f?\", __j = Array.prototype.join;\\nfunction print() { __p += __j.call(arguments, '') }\\n\":\";\\n\")+C+\"return __p\\n}\";var I=Cr((function(){return lt(v,T+\"return \"+C).apply(u,y)}));if(I.source=C,isError(I))throw I;return I}function toLower(l){return toString(l).toLowerCase()}function toUpper(l){return toString(l).toUpperCase()}function trim(l,d,p){if((l=toString(l))&&(p||d===u))return l.replace(We,\"\");if(!l||!(d=baseToString(d)))return l;var h=stringToArray(l),g=stringToArray(d);return castSlice(h,charsStartIndex(h,g),charsEndIndex(h,g)+1).join(\"\")}function trimEnd(l,d,p){if((l=toString(l))&&(p||d===u))return l.replace(ze,\"\");if(!l||!(d=baseToString(d)))return l;var h=stringToArray(l);return castSlice(h,0,charsEndIndex(h,stringToArray(d))+1).join(\"\")}function trimStart(l,d,p){if((l=toString(l))&&(p||d===u))return l.replace(qe,\"\");if(!l||!(d=baseToString(d)))return l;var h=stringToArray(l);return castSlice(h,charsStartIndex(h,stringToArray(d))).join(\"\")}function truncate(l,d){var p=k,h=x;if(isObject(d)){var g=\"separator\"in d?d.separator:g;p=\"length\"in d?toInteger(d.length):p,h=\"omission\"in d?baseToString(d.omission):h}var f=(l=toString(l)).length;if(hasUnicode(l)){var m=stringToArray(l);f=m.length}if(p>=f)return l;var v=p-stringSize(h);if(v<1)return h;var y=m?castSlice(m,0,v).join(\"\"):l.slice(0,v);if(g===u)return y+h;if(m&&(v+=y.length-v),zi(g)){if(l.slice(v).search(g)){var S,_=y;for(g.global||(g=pt(g.source,toString(Ze.exec(g))+\"g\")),g.lastIndex=0;S=g.exec(_);)var C=S.index;y=y.slice(0,C===u?v:C)}}else if(l.indexOf(baseToString(g),v)!=v){var E=y.lastIndexOf(g);E>-1&&(y=y.slice(0,E))}return y+h}function unescape(l){return(l=toString(l))&&Le.test(l)?l.replace(Ne,_n):l}var Sr=createCompounder((function(l,d,u){return l+(u?\" \":\"\")+d.toUpperCase()})),_r=createCaseFirst(\"toUpperCase\");function words(l,d,p){return l=toString(l),(d=p?u:d)===u?hasUnicodeWord(l)?unicodeWords(l):asciiWords(l):l.match(d)||[]}var Cr=baseRest((function(l,d){try{return apply(l,u,d)}catch(l){return isError(l)?l:new ct(l)}})),Er=flatRest((function(l,d){return arrayEach(d,(function(d){d=toKey(d),baseAssignValue(l,d,Mi(l[d],l))})),l}));function cond(l){var d=null==l?0:l.length,u=getIteratee();return l=d?arrayMap(l,(function(l){if(\"function\"!=typeof l[1])throw new gt(m);return[u(l[0]),l[1]]})):[],baseRest((function(u){for(var p=-1;++p<d;){var h=l[p];if(apply(h[0],this,u))return apply(h[1],this,u)}}))}function conforms(l){return baseConforms(baseClone(l,_))}function constant(l){return function(){return l}}function defaultTo(l,d){return null==l||l!=l?d:l}var Tr=createFlow(),br=createFlow(!0);function identity(l){return l}function iteratee(l){return baseIteratee(\"function\"==typeof l?l:baseClone(l,_))}function matches(l){return baseMatches(baseClone(l,_))}function matchesProperty(l,d){return baseMatchesProperty(l,baseClone(d,_))}var Ir=baseRest((function(l,d){return function(u){return baseInvoke(u,l,d)}})),Ar=baseRest((function(l,d){return function(u){return baseInvoke(l,u,d)}}));function mixin(l,d,u){var p=keys(d),h=baseFunctions(d,p);null!=u||isObject(d)&&(h.length||!p.length)||(u=d,d=l,l=this,h=baseFunctions(d,keys(d)));var g=!(isObject(u)&&\"chain\"in u&&!u.chain),f=isFunction(l);return arrayEach(h,(function(u){var p=d[u];l[u]=p,f&&(l.prototype[u]=function(){var d=this.__chain__;if(g||d){var u=l(this.__wrapped__);return(u.__actions__=copyArray(this.__actions__)).push({func:p,args:arguments,thisArg:l}),u.__chain__=d,u}return p.apply(l,arrayPush([this.value()],arguments))})})),l}function noConflict(){return on._===this&&(on._=It),this}function noop(){}function nthArg(l){return l=toInteger(l),baseRest((function(d){return baseNth(d,l)}))}var Rr=createOver(arrayMap),Pr=createOver(arrayEvery),Or=createOver(arraySome);function property(l){return isKey(l)?baseProperty(toKey(l)):basePropertyDeep(l)}function propertyOf(l){return function(d){return null==l?u:baseGet(l,d)}}var Mr=createRange(),wr=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}function stubObject(){return{}}function stubString(){return\"\"}function stubTrue(){return!0}function times(l,d){if((l=toInteger(l))<1||l>G)return[];var u=z,p=an(l,z);d=getIteratee(d),l-=z;for(var h=baseTimes(p,d);++u<l;)d(u);return h}function toPath(l){return Vi(l)?arrayMap(l,toKey):isSymbol(l)?[l]:copyArray(ni(toString(l)))}function uniqueId(l){var d=++Ct;return toString(l)+d}var Nr=createMathOperation((function(l,d){return l+d}),0),Dr=createRound(\"ceil\"),Lr=createMathOperation((function(l,d){return l/d}),1),kr=createRound(\"floor\");function max(l){return l&&l.length?baseExtremum(l,identity,baseGt):u}function maxBy(l,d){return l&&l.length?baseExtremum(l,getIteratee(d,2),baseGt):u}function mean(l){return baseMean(l,identity)}function meanBy(l,d){return baseMean(l,getIteratee(d,2))}function min(l){return l&&l.length?baseExtremum(l,identity,baseLt):u}function minBy(l,d){return l&&l.length?baseExtremum(l,getIteratee(d,2),baseLt):u}var xr,Fr=createMathOperation((function(l,d){return l*d}),1),Ur=createRound(\"round\"),jr=createMathOperation((function(l,d){return l-d}),0);function sum(l){return l&&l.length?baseSum(l,identity):0}function sumBy(l,d){return l&&l.length?baseSum(l,getIteratee(d,2)):0}return lodash.after=after,lodash.ary=ary,lodash.assign=$i,lodash.assignIn=Xi,lodash.assignInWith=Zi,lodash.assignWith=er,lodash.at=tr,lodash.before=before,lodash.bind=Mi,lodash.bindAll=Er,lodash.bindKey=wi,lodash.castArray=castArray,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.concat=concat,lodash.cond=cond,lodash.conforms=conforms,lodash.constant=constant,lodash.countBy=Ci,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=nr,lodash.defaultsDeep=ir,lodash.defer=Ni,lodash.delay=Di,lodash.difference=ii,lodash.differenceBy=ri,lodash.differenceWith=oi,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatMap=flatMap,lodash.flatMapDeep=flatMapDeep,lodash.flatMapDepth=flatMapDepth,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flattenDepth=flattenDepth,lodash.flip=flip,lodash.flow=Tr,lodash.flowRight=br,lodash.fromPairs=fromPairs,lodash.functions=functions,lodash.functionsIn=functionsIn,lodash.groupBy=bi,lodash.initial=initial,lodash.intersection=ai,lodash.intersectionBy=si,lodash.intersectionWith=ci,lodash.invert=rr,lodash.invertBy=or,lodash.invokeMap=Ii,lodash.iteratee=iteratee,lodash.keyBy=Ai,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=sr,lodash.mergeWith=cr,lodash.method=Ir,lodash.methodOf=Ar,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=nthArg,lodash.omit=lr,lodash.omitBy=omitBy,lodash.once=once,lodash.orderBy=orderBy,lodash.over=Rr,lodash.overArgs=Li,lodash.overEvery=Pr,lodash.overSome=Or,lodash.partial=ki,lodash.partialRight=xi,lodash.partition=Ri,lodash.pick=dr,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=li,lodash.pullAll=pullAll,lodash.pullAllBy=pullAllBy,lodash.pullAllWith=pullAllWith,lodash.pullAt=di,lodash.range=Mr,lodash.rangeRight=wr,lodash.rearg=Fi,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.reverse=reverse,lodash.sampleSize=sampleSize,lodash.set=set,lodash.setWith=setWith,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=Pi,lodash.sortedUniq=sortedUniq,lodash.sortedUniqBy=sortedUniqBy,lodash.split=split,lodash.spread=spread,lodash.tail=tail,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=ur,lodash.toPairsIn=pr,lodash.toPath=toPath,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.unary=unary,lodash.union=ui,lodash.unionBy=pi,lodash.unionWith=hi,lodash.uniq=uniq,lodash.uniqBy=uniqBy,lodash.uniqWith=uniqWith,lodash.unset=unset,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=update,lodash.updateWith=updateWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.without=gi,lodash.words=words,lodash.wrap=wrap,lodash.xor=fi,lodash.xorBy=mi,lodash.xorWith=vi,lodash.zip=yi,lodash.zipObject=zipObject,lodash.zipObjectDeep=zipObjectDeep,lodash.zipWith=Si,lodash.entries=ur,lodash.entriesIn=pr,lodash.extend=Xi,lodash.extendWith=Zi,mixin(lodash,lodash),lodash.add=Nr,lodash.attempt=Cr,lodash.camelCase=hr,lodash.capitalize=capitalize,lodash.ceil=Dr,lodash.clamp=clamp,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.cloneDeepWith=cloneDeepWith,lodash.cloneWith=cloneWith,lodash.conformsTo=conformsTo,lodash.deburr=deburr,lodash.defaultTo=defaultTo,lodash.divide=Lr,lodash.endsWith=endsWith,lodash.eq=eq,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=Ei,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=Ti,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.floor=kr,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.get=get,lodash.gt=Ui,lodash.gte=ji,lodash.has=has,lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.invoke=ar,lodash.isArguments=Bi,lodash.isArray=Vi,lodash.isArrayBuffer=Hi,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=isBoolean,lodash.isBuffer=Gi,lodash.isDate=Wi,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isEqualWith=isEqualWith,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=qi,lodash.isMatch=isMatch,lodash.isMatchWith=isMatchWith,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNil=isNil,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=zi,lodash.isSafeInteger=isSafeInteger,lodash.isSet=Ki,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=Ji,lodash.isUndefined=isUndefined,lodash.isWeakMap=isWeakMap,lodash.isWeakSet=isWeakSet,lodash.join=join,lodash.kebabCase=gr,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lowerCase=fr,lodash.lowerFirst=mr,lodash.lt=Qi,lodash.lte=Yi,lodash.max=max,lodash.maxBy=maxBy,lodash.mean=mean,lodash.meanBy=meanBy,lodash.min=min,lodash.minBy=minBy,lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=stubObject,lodash.stubString=stubString,lodash.stubTrue=stubTrue,lodash.multiply=Fr,lodash.nth=nth,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=Oi,lodash.pad=pad,lodash.padEnd=padEnd,lodash.padStart=padStart,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.replace=replace,lodash.result=result,lodash.round=Ur,lodash.runInContext=runInContext,lodash.sample=sample,lodash.size=size,lodash.snakeCase=vr,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedIndexBy=sortedIndexBy,lodash.sortedIndexOf=sortedIndexOf,lodash.sortedLastIndex=sortedLastIndex,lodash.sortedLastIndexBy=sortedLastIndexBy,lodash.sortedLastIndexOf=sortedLastIndexOf,lodash.startCase=yr,lodash.startsWith=startsWith,lodash.subtract=jr,lodash.sum=sum,lodash.sumBy=sumBy,lodash.template=template,lodash.times=times,lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=toLower,lodash.toNumber=toNumber,lodash.toSafeInteger=toSafeInteger,lodash.toString=toString,lodash.toUpper=toUpper,lodash.trim=trim,lodash.trimEnd=trimEnd,lodash.trimStart=trimStart,lodash.truncate=truncate,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.upperCase=Sr,lodash.upperFirst=_r,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(xr={},baseForOwn(lodash,(function(l,d){_t.call(lodash.prototype,d)||(xr[d]=l)})),xr),{chain:!1}),lodash.VERSION=p,arrayEach([\"bind\",\"bindKey\",\"curry\",\"curryRight\",\"partial\",\"partialRight\"],(function(l){lodash[l].placeholder=lodash})),arrayEach([\"drop\",\"take\"],(function(l,d){LazyWrapper.prototype[l]=function(p){p=p===u?1:rn(toInteger(p),0);var h=this.__filtered__&&!d?new LazyWrapper(this):this.clone();return h.__filtered__?h.__takeCount__=an(p,h.__takeCount__):h.__views__.push({size:an(p,z),type:l+(h.__dir__<0?\"Right\":\"\")}),h},LazyWrapper.prototype[l+\"Right\"]=function(d){return this.reverse()[l](d).reverse()}})),arrayEach([\"filter\",\"map\",\"takeWhile\"],(function(l,d){var u=d+1,p=u==j||u==V;LazyWrapper.prototype[l]=function(l){var d=this.clone();return d.__iteratees__.push({iteratee:getIteratee(l,3),type:u}),d.__filtered__=d.__filtered__||p,d}})),arrayEach([\"head\",\"last\"],(function(l,d){var u=\"take\"+(d?\"Right\":\"\");LazyWrapper.prototype[l]=function(){return this[u](1).value()[0]}})),arrayEach([\"initial\",\"tail\"],(function(l,d){var u=\"drop\"+(d?\"\":\"Right\");LazyWrapper.prototype[l]=function(){return this.__filtered__?new LazyWrapper(this):this[u](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(l){return this.filter(l).head()},LazyWrapper.prototype.findLast=function(l){return this.reverse().find(l)},LazyWrapper.prototype.invokeMap=baseRest((function(l,d){return\"function\"==typeof l?new LazyWrapper(this):this.map((function(u){return baseInvoke(u,l,d)}))})),LazyWrapper.prototype.reject=function(l){return this.filter(negate(getIteratee(l)))},LazyWrapper.prototype.slice=function(l,d){l=toInteger(l);var p=this;return p.__filtered__&&(l>0||d<0)?new LazyWrapper(p):(l<0?p=p.takeRight(-l):l&&(p=p.drop(l)),d!==u&&(p=(d=toInteger(d))<0?p.dropRight(-d):p.take(d-l)),p)},LazyWrapper.prototype.takeRightWhile=function(l){return this.reverse().takeWhile(l).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(z)},baseForOwn(LazyWrapper.prototype,(function(l,d){var p=/^(?:filter|find|map|reject)|While$/.test(d),h=/^(?:head|last)$/.test(d),g=lodash[h?\"take\"+(\"last\"==d?\"Right\":\"\"):d],f=h||/^find/.test(d);g&&(lodash.prototype[d]=function(){var d=this.__wrapped__,m=h?[1]:arguments,v=d instanceof LazyWrapper,y=m[0],S=v||Vi(d),interceptor=function(l){var d=g.apply(lodash,arrayPush([l],m));return h&&_?d[0]:d};S&&p&&\"function\"==typeof y&&1!=y.length&&(v=S=!1);var _=this.__chain__,C=!!this.__actions__.length,E=f&&!_,T=v&&!C;if(!f&&S){d=T?d:new LazyWrapper(this);var b=l.apply(d,m);return b.__actions__.push({func:thru,args:[interceptor],thisArg:u}),new LodashWrapper(b,_)}return E&&T?l.apply(this,m):(b=this.thru(interceptor),E?h?b.value()[0]:b.value():b)})})),arrayEach([\"pop\",\"push\",\"shift\",\"sort\",\"splice\",\"unshift\"],(function(l){var d=ft[l],u=/^(?:push|sort|unshift)$/.test(l)?\"tap\":\"thru\",p=/^(?:pop|shift)$/.test(l);lodash.prototype[l]=function(){var l=arguments;if(p&&!this.__chain__){var h=this.value();return d.apply(Vi(h)?h:[],l)}return this[u]((function(u){return d.apply(Vi(u)?u:[],l)}))}})),baseForOwn(LazyWrapper.prototype,(function(l,d){var u=lodash[d];if(u){var p=u.name+\"\";_t.call(On,p)||(On[p]=[]),On[p].push({name:d,func:u})}})),On[createHybrid(u,A).name]=[{name:\"wrapper\",func:u}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.at=_i,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.next=wrapperNext,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.first=lodash.prototype.head,xt&&(lodash.prototype[xt]=wrapperToIterator),lodash}();sn?((sn.exports=Cn)._=Cn,an._=Cn):on._=Cn}).call(h)}));class DefaultLogger{constructor(l,d=[],u=DefaultLogger.defaultLogRedirect){this._azureLogger=l,this._namespace=d,this._logRedirectCallback=u}createChild(l){return new DefaultLogger(this._azureLogger,[...this._namespace,\"string\"==typeof l?()=>l:l])}createFnLogger(l,d,...u){return this.createChild(this.getPrefix(l,d)+u.join(\"\"))}log(...l){const d=this.getMessage(l);this._azureLogger.verbose(d),this._logRedirectCallback(`log:${d}`)}debug(...l){const d=this.getMessage(l);this._azureLogger.verbose(d),this._logRedirectCallback(`debug:${d}`)}info(...l){const d=this.getMessage(l);this._azureLogger.info(d),this._logRedirectCallback(`info:${d}`)}warn(...l){const d=this.getMessage(l);this._azureLogger.warning(d),this._logRedirectCallback(`warn:${d}`)}error(...l){const d=this.getMessage(l);this._azureLogger.error(this.getMessage(l)),this._logRedirectCallback(`error::${d}`)}getMessage(...l){return`${getDateInIsoFormat()} ${this.getNamespace()} ${l.join(\" \")}`}getNamespace(){return this._namespace.map((l=>l())).join(\":\")}getPrefix(l,d){let u=\"\";return d&&(u+=d),l&&(u+=l),u}redirectLog(l){this._logRedirectCallback=d=>{DefaultLogger.defaultLogRedirect(d),l(d)}}dumpAllLogs(){return[...DefaultLogger.logDump.toArray()]}}DefaultLogger.logDump=new Wd(null===(Gd=null===(Hd=getAcsEcsConfig())||void 0===Hd?void 0:Hd.debugInfo)||void 0===Gd?void 0:Gd.maxLogDumpLength),DefaultLogger.defaultLogRedirect=l=>{var d,u,p,h,g,f;if(null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.debugInfo)||void 0===u?void 0:u.enableLogDump){const sizeCheck=()=>{var l,d;DefaultLogger.logDump.length>(null===(d=null===(l=getAcsEcsConfig())||void 0===l?void 0:l.debugInfo)||void 0===d?void 0:d.maxLogDumpLength)&&DefaultLogger.logDump.shift()};if(null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.debugInfo)||void 0===h?void 0:h.includeList.some((d=>qd.includes(l,d))))return DefaultLogger.logDump.push(l),void sizeCheck();if(!(null===(f=null===(g=getAcsEcsConfig())||void 0===g?void 0:g.debugInfo)||void 0===f?void 0:f.excludeList.some((d=>qd.includes(l,d)))))return DefaultLogger.logDump.push(l),void sizeCheck()}};var __decorate$1=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$1=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$4=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class LocalVideoStream{constructor(l){if(this._disposed=!1,!(l instanceof VideoDeviceInfoImpl))throw new CallingCommunicationError({message:\"Failed to create local video stream, source was not of type VideoDeviceInfo\",code:be});const u=d.createClientLogger(\"ACS\");this.logger=new DefaultLogger(u,[()=>`LocalVideoStream:${l.id}`]),this.logger.info(\"created\"),this._telemetryLogManager=l.deviceManager.telemetryLogManager,this._source=l,this._mediaStreamType=\"Video\"}get source(){return this._source}get mediaStreamType(){return this._mediaStreamType}get telemetryLogManager(){return this._telemetryLogManager}switchSource(l){return __awaiter$4(this,void 0,void 0,(function*(){const d=this.logger.createFnLogger(ts.SwitchSource),u=+new Date,p=generateGuid();if(this.sendVideoStreamEvent({eventName:kd.acs_calling_switch_video_source_attempt,timestampInfo:{attemptTimestamp:u},correlationId:p}),!(l instanceof VideoDeviceInfoImpl)){const l=new CallingCommunicationError({message:\"Failed to switch source, source was not of type VideoDeviceInfo\",code:be});throw this.sendVideoStreamEvent({eventName:kd.acs_calling_switch_video_source_failure,timestampInfo:{attemptTimestamp:u},correlationId:p},l),l}if(this._source===l){const l=new CallingCommunicationError({message:\"Unable to switch to the same source\",code:ve}),d=+new Date;throw this.sendVideoStreamEvent({eventName:kd.acs_calling_switch_video_source_failure,timestampInfo:{deltaTimeInMs:d-u},correlationId:p},l),l}try{l.deviceManager.getTsDeviceManager().selectDevices({camera:l.id}),this._source=l;const d=+new Date;this.sendVideoStreamEvent({eventName:kd.acs_calling_switch_video_source_success,timestampInfo:{deltaTimeInMs:d-u},correlationId:p})}catch(l){const h=handleVideoOperationFailure(d,l),g=+new Date;throw this.sendVideoStreamEvent({eventName:kd.acs_calling_switch_video_source_failure,timestampInfo:{deltaTimeInMs:g-u},correlationId:p},h),h}}))}getStreamMetadata(){const l=this.source.deviceManager;return{source:\"local\",streamType:this.mediaStreamType,deviceType:this.source.deviceType,deviceManagerPermissionState:JSON.stringify({cameraPermission:l.getVideoDevicePermission(),microphonePermission:l.getAudioDevicePermission()}),acsResourceId:l.getAcsResourceId()||\"\",clientId:l.getClientId()}}dispose(){this.logger.log(\"dispose\"),this._disposed?this.logger.log(\"already disposed\"):this._disposed=!0}sendVideoStreamEvent(l,d){try{const u=this.source.deviceManager;let p=\"string\"==typeof(null==d?void 0:d.message)?null==d?void 0:d.message:void 0;l.eventName!==String(kd.acs_calling_switch_video_source_failure)&&(p=void 0),this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:{timestampInfo:l.timestampInfo,correlationId:l.correlationId,failureReason:p||\"\",acsResourceId:u.getAcsResourceId()||\"\",clientId:u.getClientId(),deviceType:this.source.deviceType}})}catch(l){this.logger.debug(\"Unable to send video stream telemetry\")}}}__decorate$1([loggerProperty,__metadata$1(\"design:type\",Object)],LocalVideoStream.prototype,\"logger\",void 0),__decorate$1([asyncOperation(ts.SwitchSource),__metadata$1(\"design:type\",Function),__metadata$1(\"design:paramtypes\",[Object]),__metadata$1(\"design:returntype\",Promise)],LocalVideoStream.prototype,\"switchSource\",null);class Debounce{constructor(l,d){this._debounce=void 0,this._updateFunction=l,this._timeout=d}debounce(){this._debounce?(clearTimeout(this._debounce),this._debounce=setTimeout((()=>{this._updateFunction(),this._debounce=void 0}),this._timeout)):(this._updateFunction(),this._debounce=setTimeout((()=>{this._debounce=void 0}),this._timeout))}}class RemoteVideoStreamImpl{constructor(l,d,u,p,h,g){this._isAvailable=!1,this._isReceiving=!1,this._mediaStreamType=\"Video\",this._renderers=[],this._disposed=!1,this._size={height:0,width:0},this._setIsAvailable=l=>{l!==this.isAvailable&&(this._isAvailable=!!l,this.logger.log(`isAvailable changed to ${this._isAvailable}`),this._eventEmitter.emit(\"isAvailableChanged\",this._isAvailable),this.sendRemoteVideoStreamTelemetry())},this._setType=l=>{0===l.type?this._mediaStreamType=\"Video\":1===l.type&&(this._mediaStreamType=\"ScreenSharing\")},this._disposeRenderer=l=>{this.logger.log(\"disposing renderer\");try{l.dispose(!0),this.logger.log(\"renderer disposed\")}catch(l){this.logger.log(\"failed to dispose renderer\")}},this.tsStream=l,this._setType(this.tsStream),this.logger=d.createChild((()=>`Stream:{id=${this.tsStream.id}}:{type=${this._mediaStreamType}}`)),this.telemetryLogManager=g,this._eventEmitter=new CallingEventEmitter(this.logger),this.call=u,this._tsParticipant=h,this.sendRemoteVideoStreamTelemetry(),this._setIsAvailable(this.tsStream.isAvailable),this._streamChangedHandler=this.tsStream.changed((()=>this._setIsAvailable(this.tsStream.isAvailable))),this._debounceSize=new Debounce((()=>{var l;let d={height:0,width:0};null===(l=this._renderers)||void 0===l||l.forEach((l=>{(null==l?void 0:l.isRendering)&&l.size.height>d.height&&l.size.width>d.width&&(d.height=l.size.height,d.width=l.size.width)}),getAcsEcsConfig().rendering.remoteVideo.debounceTimeout),this._size.height===d.height&&this._size.width===d.width||(this._size.height=d.height,this._size.width=d.width,this.logger.info(`stream size changed to { height: ${this._size.height}, width: ${this._size.width} }`),this._eventEmitter.emit(\"sizeChanged\"),this.sendRemoteVideoStreamTelemetry())}),getAcsEcsConfig().rendering.remoteVideo.debounceTimeout),this._debounceIsReceiving=new Debounce((()=>{var l;const d=(null===(l=this._renderers)||void 0===l?void 0:l.filter((l=>!!(null==l?void 0:l.isRendering))).length)>0;this._isReceiving!==d&&(this._isReceiving=d,this.logger.info(`isReceiving changed to ${this._isReceiving}`),this._eventEmitter.emit(\"isReceivingChanged\"),this.sendRemoteVideoStreamTelemetry())}),getAcsEcsConfig().rendering.remoteVideo.debounceTimeout),this.logger.info(\"created\")}get id(){return this.tsStream.id}get isAvailable(){return this._isAvailable}get isReceiving(){return this._isReceiving}get mediaStreamType(){return this._mediaStreamType}get size(){return{height:this._size.height,width:this._size.width}}on(l,d){if(\"isAvailableChanged\"!==l&&\"sizeChanged\"!==l&&\"isReceivingChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this._eventEmitter.on(l,d)}off(l,d){if(\"isAvailableChanged\"!==l&&\"sizeChanged\"!==l&&\"isReceivingChanged\"!==l)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${l}, unknown event name`,code:be});this._eventEmitter.off(l,d)}getStreamMetadata(){var l,d,u;let p=\"\";try{p=(null===(d=null===(l=this._tsParticipant)||void 0===l?void 0:l.streams[this.tsStream.type].find((l=>l.id===this.id)))||void 0===d?void 0:d.participantId)||\"\"}catch(l){p=\"\"}return{callId:null===(u=this.call)||void 0===u?void 0:u.id,streamType:this.mediaStreamType,localParticipantId:this.call.tsCall.participantId,remoteParticipantId:p,sourceId:this.id,source:\"remote\",rank:this.tsStream.rank,isAvailable:this.tsStream.isAvailable,isReceiving:this._isReceiving,isStreaming:this.tsStream.isStreaming,viewIdsRegistered:this._renderers.map((l=>l.viewId)).join(\", \"),height:this._size.height,width:this._size.width,isDisposed:this._disposed}}updateSize(){this._debounceSize.debounce()}updateIsReceiving(){this._debounceIsReceiving.debounce()}registerRenderer(l){this._renderers.push(l),this.logger.info(`Renderer registered, view id: ${l.viewId}`)}unregisterRenderer(l){const d=this._renderers.indexOf(l);-1!==d&&(this._renderers.splice(d,1),this.logger.info(`Renderer un-registered, view id: ${l.viewId}`))}dispose(){this.logger.log(\"dispose\"),this._disposed?this.logger.log(\"already disposed\"):(this._disposed=!0,this._setIsAvailable(!1),this._streamChangedHandler&&this._streamChangedHandler.dispose(),this._renderers.forEach((l=>this._disposeRenderer(l))),this._renderers=[],this._eventEmitter.removeAllListeners())}sendRemoteVideoStreamTelemetry(){this.call.stats.recordEvent({name:Ld.remote_stream,callId:this.call.id,localParticipantId:this.call.tsCall.participantId,data:Object.assign({},this.getStreamMetadata())})}}var __decorate$2=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$2=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)};class RemoteParticipantImpl{constructor(l,d,u,p,h){this._mappedStreams=new Map,this._state=\"Idle\",this._lastTsParticipantState=0,this._isMuted=!1,this._isSpeaking=!1,this._displayName=\"\",this.acsToTsStreamType=l=>\"Video\"===l?0:\"ScreenSharing\"===l?1:void 0,this._identifier=l,this.logger=d.createChild((()=>`RemoteParticipant{${this._identifier.kind}}`)),this._telemetryLogManager=h,this._eventEmitter=new CallingEventEmitter(this.logger),this._callAgent=p,this._call=u,this.logger.log(\"created\")}get identifier(){return this._identifier}get state(){return this._state}get videoStreams(){return[...this._mappedStreams.values()]}get isMuted(){return this._isMuted}get isSpeaking(){return this._isSpeaking}get callEndReason(){return this._callEndReason}get displayName(){return this._displayName}on(l,d){if(\"stateChanged\"!==l&&\"isMutedChanged\"!==l&&\"isSpeakingChanged\"!==l&&\"displayNameChanged\"!==l&&\"videoStreamsUpdated\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this._eventEmitter.on(l,d)}off(l,d){if(\"stateChanged\"!==l&&\"isMutedChanged\"!==l&&\"isSpeakingChanged\"!==l&&\"displayNameChanged\"!==l&&\"videoStreamsUpdated\"!==l)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${l}, unknown event name`,code:be});this._eventEmitter.off(l,d)}dispose(){this.logger.log(\"dispose\"),this._participantChangedHandler&&this._participantChangedHandler.dispose(),this._mappedStreams.forEach((l=>l.dispose())),this._mappedStreams.clear(),this._eventEmitter.removeAllListeners()}get tsRemoteParticipant(){return this._tsParticipant}setCallEndReason(l){this._callEndReason=l}observeParticipant(l){this._tsParticipant||(this._tsParticipant=l,this._displayName=l.displayName,this._participantChangedHandler=this._tsParticipant.changed((()=>{if(this._tsParticipant&&this._tsParticipant.state!==this._lastTsParticipantState&&(this._lastTsParticipantState=this._tsParticipant.state,this._mapTsParticipantState(this._tsParticipant.state)),this._mapStreams(),this._tsParticipant&&this._tsParticipant.isServerMuted!==this._isMuted&&(this._isMuted=this._tsParticipant.isServerMuted,this._eventEmitter.emit(\"isMutedChanged\")),this._tsParticipant&&this._tsParticipant.displayName!==this._displayName&&(this._displayName=l.displayName,this._eventEmitter.emit(\"displayNameChanged\")),this._tsParticipant){const l=0!==this._tsParticipant.voiceLevel;l!==this._isSpeaking&&(this._isSpeaking=l,this._eventEmitter.emit(\"isSpeakingChanged\"))}})),this._mapTsParticipantState(this._tsParticipant.state),this._mapStreams())}setParticipantState(l){l!==this._state&&(this.logger.log(`state changed ${this._state}=>${this.state}`),this._state=l,this._eventEmitter.emit(\"stateChanged\",this._state))}_mapTsParticipantState(l){let d;const u={0:\"Idle\",1:\"Connecting\",2:\"Ringing\",3:\"Connected\",4:\"Disconnected\",5:\"Hold\",7:\"InLobby\",6:\"EarlyMedia\"};u[l]?(d=u[l],this.logger.log(`mapped tsParticipant ${l}=>${this._state}`),this.setParticipantState(d)):this.logger.log(`unable to map tsCall state=${l} to call state`),\"Disconnected\"===this._state&&this.dispose()}_mapStreams(){const l=[],d=[],handleNewStream=l=>{this._mappedStreams.set(l.id,l)},handleRemovedStream=l=>{const d=this._mappedStreams.get(l.id);d&&(this.logger.log(`stream removed, type==${d.mediaStreamType} id=${l.id}`),this._mappedStreams.delete(l.id),d.dispose())},mapStreamsOfType=u=>{if(this._tsParticipant)if(isNonEmptyArray(this._tsParticipant.streams&&this._tsParticipant.streams[u])){let p=[];this._tsParticipant&&(p=this._tsParticipant.streams[u]),p.forEach((d=>{if(!this._mappedStreams.get(d.id)){const u=new RemoteVideoStreamImpl(d,this.logger,this._call,this._callAgent,this._tsParticipant,this._telemetryLogManager);this.logger.log(`stream created, type==${u.mediaStreamType} id=${d.id}`),l.push(u)}})),this._mappedStreams.forEach((l=>{if(this.acsToTsStreamType(l.mediaStreamType)===u){p.some((d=>d.id===l.id))||d.push(l)}}))}else this._mappedStreams.forEach((l=>{this.acsToTsStreamType(l.mediaStreamType)===u&&d.push(l)}))};mapStreamsOfType(0),mapStreamsOfType(1),(l.length>0||d.length>0)&&(l.forEach(handleNewStream),d.forEach(handleRemovedStream),this._eventEmitter.emit(\"videoStreamsUpdated\",{added:l,removed:d}))}}__decorate$2([loggerProperty,__metadata$2(\"design:type\",Object)],RemoteParticipantImpl.prototype,\"logger\",void 0);const zd={0:\"Undefined\",1:\"Success\",2:\"NoNgcEndpoint\",3:\"NetworkError\",4:\"MediaDroppedError\",5:\"BadRequest\",6:\"CallEstablishmentTimeout\",7:\"CallSetupError\",8:\"NoPermission\",9:\"Missed\",10:\"Declined\",11:\"Busy\",12:\"Cancelled\",13:\"Dropped\",14:\"PstnInsufficientFunds\",15:\"PstnSkypeoutAccountBlocked\",16:\"PstnCouldNotConnectToSkypeProxy\",17:\"PstnBlockedByUs\",18:\"PstnBlockedRegulatoryIndia\",19:\"PstnInvalidNumber\",20:\"PstnNumberForbidden\",21:\"PstnCallTerminated\",22:\"PstnNumberUnavailable\",23:\"PstnEmergencyCallDenied\",24:\"CallNotFound\",25:\"LocalError\",26:\"NotAcceptableHere\",27:\"CallForwarded\",28:\"CallForwardedToVoicemail\",29:\"SkypeTokenError\",30:\"CallAccepted\",31:\"LocalHttpStackError\",32:\"UnknownError\",33:\"PstnNoSubscriptionCover\",34:\"SessionNotFound\",35:\"SessionTimedOut\",36:\"PstnCreditExpired\",37:\"PstnCreditExpiredButEnough\",38:\"RetargetNotSupported\",39:\"EnterprisePstnInternalError\",40:\"EnterprisePstnUnavailable\",41:\"EnterprisePstnForbidden\",42:\"EnterprisePstnInvalidNumber\",43:\"EnterprisePstnMiscError\",44:\"Kicked\",45:\"NetworkRequestTimeoutError\",46:\"CallDoesNotExist\",47:\"MediaSetupFailure\",48:\"ServiceUnavailable\",49:\"SignalingError\",50:\"ConversationEstablishmentFailed\",51:\"TemporarilyUnavailable\",52:\"CannotConnectToNetworkError\",53:\"MediaRelayWhiteListingIssue\",54:\"NoSignalingFromPeer\",55:\"DeniedInLobby\",56:\"TimedOutInLobby\",57:\"CallFailedConflict\",58:\"DevicePermissionDenied\",59:\"ConfParticipantCountLimitReached\",60:\"ActionNotAllowed\",61:\"Abandoned\",62:\"ForbiddenDueToPolicy\",63:\"InsufficientCapabilitiesForCallee\",64:\"UserBlocked\",65:\"AccessDenied\",66:\"AnonymousJoinDisabledByPolicy\",67:\"NoLobbyForBroadcastJoin\",68:\"NotAllowedDueToInformationBarrier\",69:\"BroadcastLimitReached\",70:\"TeamParkPolicyDisabled\",71:\"B2bJoinDisabledByPolicy\",72:\"LocationBasedRoutingError\",73:\"ConfLobbyParticipantCountLimitReached\",74:\"DowngradeToStreamingClient\",75:\"CallRedirected\"},convertTerminatedReasonToString=l=>{const d=\"UnknownError\";return\"number\"==typeof l&&zd[l]||d},Kd={0:\"None\",1:\"AddingFailed\",2:\"NoResponse\",3:\"Declined\",4:\"NotReachable\",5:\"Blocked\",6:\"NotFriendOrAuthorized\",7:\"CallLimitReached\",8:\"CallNotFound\",9:\"NetworkError\",10:\"MediaDroppedError\",11:\"OtherError\",12:\"PstnInsufficientFunds\",13:\"PstnSkypeoutAccountBlocked\",14:\"PstnCouldNotConnectToSkypeProxy\",15:\"PstnBlockedByUs\",16:\"PstnBlockedRegulatoryIndia\",17:\"PstnInvalidNumber\",18:\"PstnNumberForbidden\",19:\"Busy\",20:\"PstnCallTerminated\",21:\"PstnNumberUnavailable\",22:\"PstnEmergencyCallDenied\",23:\"Cancelled\",24:\"Dropped\",25:\"PstnNoSubscriptionCover\",26:\"PstnCreditExpired\",27:\"PstnCreditExpiredButEnough\",28:\"EnterprisePstnInternalError\",29:\"EnterprisePstnUnavailable\",30:\"EnterprisePstnForbidden\",31:\"EnterprisePstnInvalidNumber\",32:\"EnterprisePstnMiscError\",33:\"Kicked\",34:\"NetworkRequestTimeoutError\",35:\"CallDoesNotExist\",36:\"MediaSetupFailure\",37:\"ServiceUnavailable\",38:\"SignalingError\",39:\"ConversationEstablishmentFailed\",40:\"TemporarilyUnavailable\",41:\"CannotConnectToNetworkError\",42:\"NoSignalingFromPeer\",43:\"ParticipantDoesNotExist\",44:\"DeniedInLobby\",45:\"TimedOutInLobby\",46:\"ConfParticipantCountLimitReached\",47:\"Abandoned\",48:\"ActionNotAllowed\",49:\"ForbiddenDueToPolicy\",50:\"InsufficientCapabilitiesForCallee\",51:\"AccessDenied\",52:\"NoPermission\",53:\"AnonymousJoinDisabledByPolicy\",54:\"NoLobbyForBroadcastJoin\",55:\"NotAllowedDueToInformationBarrier\",56:\"BroadcastLimitReached\",57:\"B2bJoinDisabledByPolicy\",58:\"LocationBasedRoutingError\",59:\"ConfLobbyParticipantCountLimitReached\",60:\"LobbyUserLeft\"},convertParticipantStateReasonToString=l=>{const d=\"UnknownError\";return\"number\"==typeof l&&Kd[l]||d};var Jd;(Jd=l.ResultType||(l.ResultType={}))[Jd.Intermediate=0]=\"Intermediate\",Jd[Jd.Final=1]=\"Final\";const Qd={commandUrl:\"\",processingModes:{closedCaptions:{state:\"Inactive\"},realTimeTranscript:{state:\"Inactive\"}}};class BaseLanguageCallFeatureImplOverTsCall{constructor(l){this._eventEmitter=l,this._captionsModeKey=\"closedCaptions\",this._transcriptModeKey=\"realTimeTranscript\",this._transcriptionDataId=3,this._isAcsBot=l=>l.id===this._acsCaptionsBotMri,this._getBotMetadata=l=>{var d,u,p;return null!==(p=null===(u=null===(d=null==l?void 0:l.endpoints)||void 0===d?void 0:d.endpointDetails[0])||void 0===u?void 0:u.endpointMetadata)&&void 0!==p?p:void 0},this._isCaptionsEnabled=l=>{var d,u;return\"Active\"===(null===(u=null===(d=null==l?void 0:l.processingModes)||void 0===d?void 0:d[this._captionsModeKey])||void 0===u?void 0:u.state)},this._isTranscriptionEnabled=l=>{var d,u;return\"Active\"===(null===(u=null===(d=null==l?void 0:l.processingModes)||void 0===d?void 0:d[this._transcriptModeKey])||void 0===u?void 0:u.state)},this._copyBotMetaData=l=>{const d=this._getBotMetadata(l)||Qd;return JSON.parse(JSON.stringify(d))};let d=getAcsEcsConfig();this._acsCaptionsBotMri=d.captions.botMri,this._clientInfo=d.captions.clientInfo}dispose(){this._acsMetadata=void 0}}function callFeatureFactory(l,d={activationEvent:\"OnFeatureAccess\"}){return{get callApiCtor(){return l},activationOptions:d,isCallFeature:!0}}function callClientFeatureFactory(l,d={activationEvent:\"OnFeatureAccess\"}){return{get callClientApiCtor(){return l},activationOptions:d,isCallClientFeature:!0}}function getRoundedAverage(l,d,u=100){return Math.round((l/d+Number.EPSILON)*u)/u}function sendCallFeatureUsageTelemetry(l,d,u){try{const u={callId:l.callId,localParticipantId:l.localParticipantId,featureName:l.featureName,featureType:l.featureType,initializationType:l.initializationType,featureDetails:l.featureDetails};d.sendEvent({name:kd.acs_calling_feature_usage,tenant:q,properties:u})}catch(d){u.debug(`Unable to send ${l.featureName} feature usage telemtery`)}}function sendCallClientFeatureUsageTelemetry(l,d,u){try{const u={featureName:l.featureName,featureType:l.featureType,initializationType:l.initializationType,featureDetails:l.featureDetails};d.sendEvent({name:kd.acs_calling_feature_usage,tenant:q,properties:u})}catch(d){u.debug(`Unable to send ${l.featureName} feature usage telemtery`)}}var __decorate$3=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$3=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$5=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};const Yd=Date.UTC(1900,0,1),$d=3;class CaptionsCallFeatureImpl extends FirstPartyCallFeature{constructor(l){super(l),this._impl=new CaptionsCallFeatureImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"Captions\"}initialize(l,d){this._logger=d,this._telemetryLogManager=l.telemetryLogManager,this._call=l.call,this._impl.initialize(l.tsCall,l.callAgent,l.callAgent.getHttpRequestHelper(),l.telemetryLogManager,d),this._sendFeatureUsage(\"initialize\",xd.initialize)}get isCaptionsActive(){return this._sendFeatureUsage(\"isCaptionsActive\",xd.getter),this._impl.isCaptionsActive}get availableLanguages(){return this._sendFeatureUsage(\"availableLanguages\",xd.getter),getAcsEcsConfig().captions.availableLanguages}startCaptions(l){return __awaiter$5(this,void 0,void 0,(function*(){yield this._impl.startCaptions(l)}))}selectLanguage(l){return __awaiter$5(this,void 0,void 0,(function*(){yield this._impl.selectLanguage(l)}))}on(l,d){this._sendFeatureUsage(l,xd.subscribe),this.eventEmitter.on(l,d)}off(l,d){this._sendFeatureUsage(l,xd.unsubscribe),this.eventEmitter.off(l,d)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:\"Captions\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class CaptionsCallFeatureImplOverTsCall extends BaseLanguageCallFeatureImplOverTsCall{constructor(d){super(d),this._botParticipantId=\"\",this._telemetryEventList=[],this._hasReportedCaptionParseFailure=!1,this._hasReceivedFirstCaption=!1,this._currentLanguage=\"\",this._sequenceId=0,this._participantSequenceIdMap={},this._addParticipantPromise=null,this._dataChannelHandler={onStarted:(l,d)=>__awaiter$5(this,void 0,void 0,(function*(){})),onStopped:l=>__awaiter$5(this,void 0,void 0,(function*(){})),onDataReceived:(d,u,p)=>__awaiter$5(this,void 0,void 0,(function*(){if(!this.isCaptionsActive)return;let d;try{d=JSON.parse(u.toString())}catch(l){try{if(void 0===this._textDecoder)throw new Error(\"TextDecoder undefined.\");d=JSON.parse(this._textDecoder.decode(u))}catch(l){return this._logger.error(\"Failed to parse Captions result\",l),void(this._hasReportedCaptionParseFailure||(this._hasReportedCaptionParseFailure=!0,this._addEvent(Ud.FirstCaptionParsingError,\"Could not decode data packet.\")))}}(null==d?void 0:d.recognitionResults)&&d.recognitionResults.forEach((d=>{var u,p;try{const[h,g]=d.id.split(\"/\");let f=parseInt(g,10);if(this._participantSequenceIdMap[d.userId]&&this._botParticipantId==h&&this._participantSequenceIdMap[d.userId]>f)return;this._botParticipantId=h,this._participantSequenceIdMap[d.userId]=f,this._sequenceId++;const m=(null===(u=this._tsCall.participants.find((l=>l.id===d.userId)))||void 0===u?void 0:u.displayName)||(this._internalCallAgent.getUserMri()===d.userId?null===(p=this._internalCallAgent)||void 0===p?void 0:p.displayName:void 0),v={resultType:d.isFinal?l.ResultType.Final:l.ResultType.Intermediate,text:d.text,timestamp:new Date(new Date(d.timestampAudioSent/1e4).getTime()+Yd),speaker:{identifier:constructIdentifierKindFromMri(d.userId),displayName:m},language:d.spokenLanguage};this._hasReceivedFirstCaption||(this._hasReceivedFirstCaption=!0,this._addEvent(Ud.FirstCaptionReceived)),this._currentLanguage!=d.spokenLanguage&&\"\"!=this._currentLanguage&&(this._currentLanguage=d.spokenLanguage,this._addEvent(Ud.LanguageChanged,`language=${d.spokenLanguage}`)),this._eventEmitter.emit(\"captionsReceived\",v)}catch(l){this._logger.error(\"Failed to parse Captions result\",l),this._hasReportedCaptionParseFailure||(this._hasReportedCaptionParseFailure=!0,this._addEvent(Ud.FirstCaptionParsingError,\"Error thrown during incoming caption result mapping.\"))}}))}))},this._handleBotRemoved=l=>{this._acsMetadata&&this._isAcsBot(l)&&(this._isCaptionsEnabled(this._acsMetadata)&&this._eventEmitter.emit(\"isCaptionsActiveChanged\"),this._acsMetadata=void 0)},this._telemetryStartTime=Date.now()}get isCaptionsActive(){return!!this._acsMetadata&&this._isCaptionsEnabled(this._acsMetadata)}initialize(l,d,u,p,h){this._logger=h.createChild((()=>`CaptionsFeature::Call(id='${l.callId}', state='${l.state}')`)),this._tsCall=l,this._internalCallAgent=d,this._httpRequestHelper=u,this._telemetryLogManager=p,this._initializationPromise=new Promise(((l,d)=>{this._initializeAsync().then((d=>l())).catch((l=>d(l)))}))}_initializeAsync(){return __awaiter$5(this,void 0,void 0,(function*(){try{this._addEvent(Ud.InitializeCaptionsStarted),this._textDecoder=new TextDecoder,yield this._tsCall.startDataChannel(),yield this._tsCall.dataChannelAdapter.addHandler(this._transcriptionDataId,this._dataChannelHandler),this._tsCall.on(\"participantAdded\",(l=>__awaiter$5(this,void 0,void 0,(function*(){this._isAcsBot(l)&&(this._acsMetadata||(this._acsMetadata=this._copyBotMetaData(l)))})))),this._tsCall.on(\"participantRemoved\",(l=>__awaiter$5(this,void 0,void 0,(function*(){this._isAcsBot(l)&&this._handleBotRemoved(l)})))),this._tsCall.on(\"participantUpdated\",(l=>__awaiter$5(this,void 0,void 0,(function*(){const d=this._getBotMetadata(l);if(d&&this._isAcsBot(l)&&this._acsMetadata){const u=this._isCaptionsEnabled(this._acsMetadata);this._acsMetadata=this._copyBotMetaData(l),this._isCaptionsEnabled(d)!==u&&(this._addEvent(Ud.StateChanged,\"state=\"+(u?0:1)),this._eventEmitter.emit(\"isCaptionsActiveChanged\"))}}))));const l=this._tsCall.participants.find((l=>l.id===this._acsCaptionsBotMri));l&&(this._acsMetadata=this._copyBotMetaData(l)),this._addEvent(Ud.InitializeCaptionsFinished,jd.Success)}catch(l){throw this._logger.error(\"Failed to initialize Captions.\"),this._addEvent(Ud.InitializeCaptionsFinished,jd.Failed),new CallingCommunicationError({message:\"Failed to initialize Captions.\",code:Ie})}}))}startCaptions(l){return __awaiter$5(this,void 0,void 0,(function*(){const d=(null==l?void 0:l.language)||\"en-us\";if(this._sendFeatureUsage(\"startCaptions\",xd.attempt),this._addEvent(Ud.StartCaptionsStarted,`language=${d}`),this._addParticipantPromise)return this._addEvent(Ud.StartCaptionsFinished,jd.OperationInProgress),void this._sendFeatureUsage(\"startCaptions\",xd.failure);if(yield this._initializationPromise,!this._acsCaptionsBotMri)throw this._logger.error(\"Could not start captions.\"),this._addEvent(Ud.StartCaptionsFinished,jd.EmptyBotMri),this._sendFeatureUsage(\"startCaptions\",xd.failure),new CallingCommunicationError({message:\"Could not start captions.\",code:Ie});if(this._acsMetadata)this._isCaptionsEnabled(this._acsMetadata)&&(this._addEvent(Ud.StartCaptionsFinished,jd.CaptionsAlreadyActive),this._sendFeatureUsage(\"startCaptions\",xd.failure));else try{const l={participantInvitationData:{botData:{clientInfo:this._clientInfo,consumerType:\"SkypeTokenClient\",initiatorUserToken:yield this._internalCallAgent.tokenProvider(),spokenLanguage:d,mode:\"Transcription\",transcriptionModes:[this._captionsModeKey]}}};this._addParticipantPromise=this._tsCall.addParticipant(this._acsCaptionsBotMri,l),yield this._addParticipantPromise,this._addParticipantPromise=null,this._addEvent(Ud.StartCaptionsFinished,jd.Success),this._sendFeatureUsage(\"startCaptions\",xd.success)}catch(l){throw this._logger.error(\"Could not start captions.\"),this._addEvent(Ud.StartCaptionsFinished,jd.Failed),this._sendFeatureUsage(\"startCaptions\",xd.failure),new CallingCommunicationError({message:\"Could not start captions.\",code:Ie})}}))}selectLanguage(l){var d,u;return __awaiter$5(this,void 0,void 0,(function*(){if(this._sendFeatureUsage(\"selectLanguage\",xd.attempt),this._addEvent(Ud.SelectLanguageStarted,`language=${l}`),yield this._initializationPromise,!(null===(d=this._acsMetadata)||void 0===d?void 0:d.commandUrl))throw this._addEvent(Ud.SelectLanguageFinished,jd.EmptyBotCommandUrl),this._sendFeatureUsage(\"selectLanguage\",xd.failure),this._logger.error(\"Cannot update language as captions have not started..\"),new CallingCommunicationError({message:\"Cannot update language as captions have not started.\",code:be});try{if(l==this._currentLanguage)return this._addEvent(Ud.SelectLanguageFinished,jd.SelectedLanguageAlreadySet),void this._sendFeatureUsage(\"selectLanguage\",xd.failure);const d=yield this._internalCallAgent.tokenProvider();if(!d)throw this._addEvent(Ud.SelectLanguageFinished,jd.NullToken),new CallingCommunicationError({message:\"Empty token. Unable to update language.\",code:Ie});const u={timestamp:(new Date).toISOString(),participantMri:this._internalCallAgent.getUserMri(),participantLegId:this._tsCall.participantId,action:\"setLanguage\",mode:\"transcription\",actionParameters:{type:\"setLanguage\",spokenLanguage:l}},p={headers:{\"X-Microsoft-Skype-Chain-ID\":this._tsCall.callId,Authorization:`Bearer ${d}`,\"x-skypetoken\":d},withCredentials:!0},h=yield this._httpRequestHelper.sendRequestWithRetry(\"post\",this._acsMetadata.commandUrl,u,p,$d);this._addEvent(Ud.SelectLanguageFinished,`statusCode=${h.status}`),this._sendFeatureUsage(\"selectLanguage\",xd.success)}catch(l){throw this._logger.error(\"Unable to update language.\"),this._addEvent(Ud.SelectLanguageFinished),this._sendFeatureUsage(\"selectLanguage\",xd.failure),new CallingCommunicationError({message:\"Unable to update language.\",code:(null===(u=null==l?void 0:l.response)||void 0===u?void 0:u.status)||Ie},l)}}))}dispose(){this._acsMetadata=void 0,this._textDecoder=void 0,this._eventEmitter.removeAllListeners(),this._sendEvents()}_addEvent(l,d){let u={[`${l}`]:Date.now()-this._telemetryStartTime};void 0!==d&&(u.data=\"string\"==typeof d?d:`result=${d}`),this._telemetryEventList.push(u)}_sendEvents(){let l={SequenceId:this._sequenceId,EventTimestampBag:{eventStart:this._telemetryStartTime,events:this._telemetryEventList}};this._telemetryLogManager.sendEvent({name:kd.acs_calling_captions,tenant:q,properties:l})}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._tsCall.callId,localParticipantId:this._tsCall.participantId,featureName:\"Captions\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}}__decorate$3([asyncOperation(Bd.StartCaptions),__metadata$3(\"design:type\",Function),__metadata$3(\"design:paramtypes\",[Object]),__metadata$3(\"design:returntype\",Promise)],CaptionsCallFeatureImplOverTsCall.prototype,\"startCaptions\",null),__decorate$3([asyncOperation(Bd.SelectLanguage),__metadata$3(\"design:type\",Function),__metadata$3(\"design:paramtypes\",[String]),__metadata$3(\"design:returntype\",Promise)],CaptionsCallFeatureImplOverTsCall.prototype,\"selectLanguage\",null);var Xd,bitwise=function(l){var d=0;if(0==l.length)return d;for(var u=0;u<l.length;u++){d=(d<<5)-d+l.charCodeAt(u),d&=d}return d},binaryTransfer=function(l,d){var u=\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";d=d||62;var p,h=[],g=\"\",f=l<0?\"-\":\"\";for(l=Math.abs(l);l>=d;)p=l%d,l=Math.floor(l/d),h.push(u[p]);l>0&&h.push(u[l]);for(var m=h.length-1;m>=0;m--)g+=h[m];return f+g},dist=function(l){var d=typeof l;if(\"string\"===d||\"number\"===d)return binaryTransfer(bitwise(String(l)),61).replace(\"-\",\"Z\");throw new Error(\"Unexpected input type\")};class DebugInfoCallClientFeatureImpl extends FirstPartyCallClientFeature{constructor(l){super(l),this._impl=new DebugInfoImplOverTsCall}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"DebugInfo\"}get lastLocalParticipantId(){return this._sendFeatureUsage(\"lastLocalParticipantId\",xd.getter),this._impl.lastLocalParticipantId}get logs(){return this._impl.logDump}get localParticipantIdMap(){return this._impl.localParticipantIdMap}get incommingCallIdMap(){return this._impl.incommingCallIdMap}get lastCallId(){if(this._sendFeatureUsage(\"lastCallId\",xd.getter),this.lastLocalParticipantId)return this._impl.localParticipantIdMap[this.lastLocalParticipantId].callIds.slice(-1)[0]}get userAgent(){return this._impl.userAgent}get sdkVersion(){return getSdkVersion()}get acsResourceId(){return this._impl.AcsResourceId}get clientId(){return this._impl.clientId}dumpDebugInfoAsJSONString(){try{return JSON.stringify(this.toZip())}catch(l){return`JSON.stringify threw: ${l}`}}toZip(){return{clientId:this.clientId,lastLocalParticipantId:this.lastLocalParticipantId,localParticipantIdMap:this.localParticipantIdMap,incommingCallMap:this.incommingCallIdMap,AcsResourceId:this.acsResourceId,userAgent:this.userAgent,sdkVersion:this.sdkVersion,logs:this.logs}}dumpDebugInfo(){this._sendFeatureUsage(\"dumpDebugInfo\",xd.attempt);try{const l=Rd.deflate(this.dumpDebugInfoAsJSONString(),{to:\"string\"}),d=dist(l);return this._sendFeatureUsage(\"dumpDebugInfo\",xd.success),{dump:l,dumpId:`${generateGuid()}-${d}`}}catch(l){const d=`failed to deflate, error: ${l}`;return this.logger.error(d),this._sendFeatureUsage(\"dumpDebugInfo\",xd.failure),{dump:Rd.deflate(d,{to:\"string\"}),dumpId:generateGuid()}}}initialize(l,d){this._impl.initialize(l,d),this.logger=d,this._telemetryLogManager=l.telemetryLogManager,this._sendFeatureUsage(\"initialize\",xd.initialize)}_sendFeatureUsage(l,d){sendCallClientFeatureUsageTelemetry({featureName:\"DebugInfo\",featureType:\"CallClient\",initializationType:\"OnExtendedObjectConstructor\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this.logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class DebugInfoImplOverTsCall{constructor(){this._localParticipantIdMap={},this._incommingCallIdMap={}}get userAgent(){return this._userAgent}get logDump(){return this._logger.log(\"Log dump requested\"),this._logger.dumpAllLogs()}get AcsResourceId(){var l;return null===(l=this._callAgent)||void 0===l?void 0:l.getAcsResourceId()}get lastLocalParticipantId(){return this._lastLocalParticipantId}get localParticipantIdMap(){return this._localParticipantIdMap}get incommingCallIdMap(){return this._incommingCallIdMap}get clientId(){var l;return null===(l=this._callAgent)||void 0===l?void 0:l.getClientId()}initialize(l,d){var u;this._logger=d,this._callAgent=null===(u=null==l?void 0:l.callClient)||void 0===u?void 0:u.callAgent,this._userAgent=null==l?void 0:l.callClient.userAgent,this._logger.info(\"waiting for call agent to be created\");const bindAndSubscribeToCallAgentEvents=()=>{this._callAgent=null==l?void 0:l.callClient.callAgent,this.subscribeToCallAgentEvents()};null==l||l.callClient.on(\"callAgentCreated\",bindAndSubscribeToCallAgentEvents)}dispose(){}subscribeToCallAgentEvents(){var l,d;try{null===(l=this._callAgent)||void 0===l||l.on(\"callsUpdated\",(l=>{[...l.added,...l.removed].forEach((l=>{this.updateLocalParticipantIdMap(l),l.on(\"idChanged\",(()=>{this.updateLocalParticipantIdMap(l)}))}))})),null===(d=this._callAgent)||void 0===d||d.on(\"incomingCall\",(l=>{var d;let u=l.incomingCall;u.on(\"callEnded\",(l=>{try{this._incommingCallIdMap[u.id]=JSON.stringify(l.callEndReason)}catch(l){this._incommingCallIdMap[u.id]=\"callEnd reason unknown\"}}));try{this._incommingCallIdMap[u.id]=JSON.stringify(null===(d=l.incomingCall.callerInfo.identifier)||void 0===d?void 0:d.kind)}catch(l){this._incommingCallIdMap[u.id]=\"identifier kind unknown\"}}))}catch(l){this._logger.info(\"failed to subscribe to call agent events, due to non initialized call agent\")}}updateLocalParticipantIdMap(l){var d,u,p;try{let h=null!==(u=null===(d=this._localParticipantIdMap[l.tsCall.participantId])||void 0===d?void 0:d.callIds.filter((d=>d!==l.tsCall.callId)).concat([l.tsCall.callId]))&&void 0!==u?u:[l.tsCall.callId],g=[],f=[],m=l.callEndReason?JSON.stringify(l.callEndReason):l.state,v=l.state;(null===(p=this._localParticipantIdMap[l.tsCall.participantId])||void 0===p?void 0:p.callEndReasons)?(this._localParticipantIdMap[l.tsCall.participantId].callEndReasons.slice(-1)[0]!==m?(this._localParticipantIdMap[l.tsCall.participantId].callEndReasons.push(m),g=this._localParticipantIdMap[l.tsCall.participantId].callEndReasons):g=this._localParticipantIdMap[l.tsCall.participantId].callEndReasons,this._localParticipantIdMap[l.tsCall.participantId].stateTransitions.slice(-1)[0]!==v?(this._localParticipantIdMap[l.tsCall.participantId].stateTransitions.push(v),f=this._localParticipantIdMap[l.tsCall.participantId].stateTransitions):f=this._localParticipantIdMap[l.tsCall.participantId].stateTransitions):(g=[m],f=[l.state]),this._localParticipantIdMap[l.tsCall.participantId]={callIds:h,callEndReasons:g,stateTransitions:f},this._logger.info(`localParticipantIdMap: ${JSON.stringify(this._localParticipantIdMap)}`),l.on(\"stateChanged\",(()=>{\"Connected\"===l.state&&(this._lastLocalParticipantId=l.tsCall.participantId,this._logger.info(`last patricipant id: ${this._lastLocalParticipantId}`)),this._localParticipantIdMap[l.tsCall.participantId].stateTransitions.slice(-1)[0]!==l.state&&this.localParticipantIdMap[l.tsCall.participantId].stateTransitions.push(l.state)}))}catch(l){this._logger.error(`exception occured while updating localParticipantId map: ${l}`)}}}(Xd=l.DiagnosticQuality||(l.DiagnosticQuality={}))[Xd.Good=1]=\"Good\",Xd[Xd.Poor=2]=\"Poor\",Xd[Xd.Bad=3]=\"Bad\";const Zd=\"networkReconnect\",eu=\"networkReceiveQuality\",tu=\"networkSendQuality\",nu=\"networkRelaysNotReachable\",iu=\"noNetwork\",ru=\"noSpeakerDevicesEnumerated\",ou=\"noMicrophoneDevicesEnumerated\",au=\"microphoneNotFunctioning\",su=\"microphoneMuteUnexpectedly\",cu=\"cameraStoppedUnexpectedly\",lu=\"capturerStoppedUnexpectedly\",du=\"speakingWhileMicrophoneIsMuted\",uu=\"cameraFreeze\",pu=\"cameraStartFailed\",hu=\"capturerStartFailed\",gu=\"cameraStartTimedOut\",fu=\"screenshareRecordingDisabled\",mu=\"microphonePermissionDenied\",vu=\"cameraPermissionDenied\";class UserFacingDiagnosticsFeatureImpl extends FirstPartyCallFeature{constructor(l){super(l),this._impl=new UserFacingDiagnosticsImplOverTsCall}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"Diagnostics\"}get network(){return this._sendFeatureUsage(\"network\",xd.getter),this._impl.network}get media(){return this._sendFeatureUsage(\"media\",xd.getter),this._impl.media}initialize(l,d){this._logger=d,this._telemetryLogManager=l.telemetryLogManager,this._call=l.call,this._impl.initialize(l,d),this._sendFeatureUsage(\"initialize\",xd.initialize)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:\"Diagnostics\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class UserFacingDiagnosticsImplOverTsCall{constructor(){}get network(){return this._network}get media(){return this._media}initialize(l,d){this._network=new NetworkDiagnosticsImpl(l,d),this._media=new MediaDiagnosticsImpl(l,d)}dispose(){}}class UserFacingDiagnosticsImpl{constructor(d,u){this.logger=u,this._tsUfdUnknownValue=0,this.tsQualityToAcsQualityMap={1:l.DiagnosticQuality.Good,2:l.DiagnosticQuality.Poor,3:l.DiagnosticQuality.Bad},this.tssQualityToAcsBooleanMap={3:!0,1:!1},this._tsCall=d.tsCall,this.eventEmitter=new ri.EventEmitter,this._tsCall.on(\"callQualityChanged\",(d=>{try{const u=this.mapTSQualityEventType(d.type,d.mediaType);if(u){if(d.value===this._tsUfdUnknownValue)return;const p=u,h=this.mapTSQualityLevel(u,d.value);let g;if(\"number\"!=typeof h||h!==l.DiagnosticQuality.Good&&h!==l.DiagnosticQuality.Poor&&h!==l.DiagnosticQuality.Bad){if(\"boolean\"!=typeof h)throw new CallingCommunicationError({message:`Mapped to an incorrect value type=${typeof h}, diagnostic value=${h}, for diagnostic ${p}`,code:Ie});g=\"DiagnosticFlag\"}else g=\"DiagnosticQuality\";let f={diagnostic:p,value:h,valueType:g};this.logger.log(`Call diagnostic changed, diagnostic='${f.diagnostic}', value='${f.value}'`);const m=\"DiagnosticFlag\"===f.valueType&&!0===f.value,v=\"DiagnosticQuality\"===f.valueType&&(f.value===l.DiagnosticQuality.Bad||f.value===l.DiagnosticQuality.Poor);(m||v)&&this.logger.warn(`Call diagnostic error raised!, diagnostic='${f.diagnostic}', value='${f.value}', value type='${f.valueType}'`),this.eventEmitter.emit(\"diagnosticChanged\",f)}}catch(l){this.logger.error(`${l.message})`)}}))}}class NetworkDiagnosticsImpl extends UserFacingDiagnosticsImpl{constructor(l,d){super(l,d.createChild((()=>`[UserFacingDiagnosticsFeature:NetworkDiagnostics:Call(id='${l.tsCall.callId}', state='${l.tsCall.state}')]`))),this.latestNetworkDiagnostics=new Map}on(l,d){if(\"diagnosticChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this.eventEmitter.on(l,d)}off(l,d){if(\"diagnosticChanged\"!==l&&\"diagnosticFlagChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this.eventEmitter.off(l,d)}getLatest(){try{return convertMapToFrozenJson(this.latestNetworkDiagnostics)}catch(l){return this.logger.error(\"Failed to get latest network diagnostics\"),{}}}mapTSQualityEventType(l){return{5:Zd,2:eu,1:tu,32:nu,37:iu}[l]}mapTSQualityLevel(l,d){let u,p;switch(l){case Zd:case eu:case tu:p=\"DiagnosticQuality\",u=this.tsQualityToAcsQualityMap[d];break;case nu:case iu:p=\"DiagnosticFlag\",u=this.tssQualityToAcsBooleanMap[d]}if(void 0===u)throw new CallingCommunicationError({message:`Cannot map ts quality level ${d} for ${l}`,code:Ie});return this.latestNetworkDiagnostics.set(l,{value:u,valueType:p}),u}}class MediaDiagnosticsImpl extends UserFacingDiagnosticsImpl{constructor(l,d){super(l,d.createChild((()=>`[UserFacingDiagnosticsFeature:MediaDiagnostics:Call(id='${l.tsCall.callId}', state='${l.tsCall.state}')]`))),this.latestMediaDiagnostics=new Map}on(l,d){if(\"diagnosticChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this.eventEmitter.on(l,d)}off(l,d){if(\"diagnosticChanged\"!==l&&\"diagnosticFlagChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this.eventEmitter.off(l,d)}getLatest(){try{return convertMapToFrozenJson(this.latestMediaDiagnostics)}catch(l){return this.logger.error(\"Failed to get latest media diagnostics\"),{}}}mapTSQualityEventType(l,d){const u={44:ru,43:ou,9:au,25:su,27:du,45:uu,33:pu,34:gu,55:fu,26:mu,47:vu};return this.overrideQualityEventsForMediaType(u[l],d)}overrideQualityEventsForMediaType(l,d){if(l===su)switch(d){case 1:return cu;case 2:return lu}return l===pu&&2===d?hu:l}mapTSQualityLevel(l,d){let u,p;switch(l){case ru:case ou:case au:case su:case du:case uu:case pu:case gu:case fu:case mu:case vu:case cu:case lu:case hu:p=\"DiagnosticFlag\",u=this.tssQualityToAcsBooleanMap[d]}if(void 0===u)throw new CallingCommunicationError({message:`Cannot map ts quality level ${d}`,code:Ie});return this.latestMediaDiagnostics.set(l,{value:u,valueType:p}),u}}class DominantSpeakersCallFeatureImpl extends FirstPartyCallFeature{constructor(l){super(l),this._impl=new DominantSpeakersCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"DominantSpeakers\"}initialize(l,d){this._logger=d,this._telemetryLogManager=l.telemetryLogManager,this._call=l.call,this._impl.initialize(l.tsCall,l.callAgent,l.telemetryLogManager,d),this._sendFeatureUsage(\"initialize\",xd.initialize)}get dominantSpeakers(){return this._sendFeatureUsage(\"dominantSpeakers\",xd.getter),this._impl.dominantSpeakers}on(l,d){this._sendFeatureUsage(\"dominantSpeakersChanged\",xd.subscribe),this.eventEmitter.on(l,d)}off(l,d){this._sendFeatureUsage(\"dominantSpeakersChanged\",xd.unsubscribe),this.eventEmitter.off(l,d)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:\"DominantSpeakers\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class DominantSpeakersCallImplOverTsCall{constructor(l){this._eventEmitter=l,this.localDominantList=[]}initialize(l,d,u,p){var h;this._logger=p.createChild((()=>`DominantSpeakersFeature::Call(id='${l.callId}')`)),this._tsCall=l,this.localDominantList=(null===(h=this._tsCall.dominantSpeakerInfo)||void 0===h?void 0:h.speakerList)||[],this._tsCall.changed((()=>{let l=!1;if(this.localDominantList.length!=this._tsCall.dominantSpeakerInfo.speakerList.length)l=!0;else for(let d in this._tsCall.dominantSpeakerInfo.speakerList)if(this._tsCall.dominantSpeakerInfo.speakerList[d]!==this.localDominantList[d]){l=!0;break}l&&(this._logger.info(\"Dominant speakers list change detected\"),this.localDominantList=this._tsCall.dominantSpeakerInfo.speakerList,this._eventEmitter.emit(\"dominantSpeakersChanged\"))}))}get dominantSpeakers(){let l=Array();return this._tsCall.dominantSpeakerInfo.speakerList.map((d=>{l.push(constructIdentifierKindFromMri(d))})),{speakersList:l,timestamp:this._tsCall.dominantSpeakerInfo.timestamp||new Date}}dispose(){}}class MediaStatsCollectorImpl{constructor(l,d,u,p,h){this._tsCall=l,this._mediaTelemetryEmitter=u,this._isInternalCollector=p,this._eventEmitter=new ri.EventEmitter,this._fetchInterval=0,this._emitInterval=0,this._aggregationInterval=0,this._dataPointsPerAggregation=0,this._mediaTelemetryEmitterListenerActive=!1,this._mediaStatsEmitEventSubscription=0,this._mediaStatsAggregateEventSubscription=0,this._aggregateWhenFetch=!1,this._aggregateWhenEmit=!1,this._mediaStatsData={},this._aggregationIndexes={},this._logger=d.createChild((()=>\"MediaStatsCollector\")),this._logger.log(\"created\"),this._acsEcsConfig=getAcsEcsConfig(),this._allMediaStats=Object.assign(Object.assign({},fe),this._acsEcsConfig.telemetry.mediaStatsConfig.additionalStats),this._fetchInterval=this._acsEcsConfig.telemetry.mediaStatsConfig.fetchInterval,this._aggregationInterval=this._acsEcsConfig.telemetry.mediaStatsConfig.aggregationInterval,this._dataPointsPerAggregation=this._acsEcsConfig.telemetry.mediaStatsConfig.dataPointsPerAggregation,this._isCollectorActive=!0,this.subscribeToMediaStats(h)}on(l,d){this._eventEmitter.on(l,d)}off(l,d){this._eventEmitter.off(l,d)}subscribeToMediaStats(l){if(l&&(l.aggregationInterval&&(this._aggregationInterval=l.aggregationInterval),l.dataPointsPerAggregation&&(this._dataPointsPerAggregation=l.dataPointsPerAggregation)),this._emitInterval=this._aggregationInterval*this._dataPointsPerAggregation,this._emitInterval<1)return void this._logger.error(\"Multiplication of aggregationIntervalMs and dataPointsPerAggregation must be greater than or equal to 1\");this._aggregationInterval===this._emitInterval&&(this._aggregateWhenEmit=!0),this._aggregationInterval===this._fetchInterval&&(this._aggregateWhenFetch=!0);const startSubscription=()=>{if(this._isCollectorActive){[3,10].includes(this._tsCall.state)?(this._mediaTelemetryEmittedListener=l=>{Object.keys(this._allMediaStats).forEach((d=>{var u,p;if(void 0!==l[d]){let h=!1;if(void 0!==this._allMediaStats[d].is_internal&&(h=this._allMediaStats[d].is_internal),!h||h&&this._isInternalCollector){const h=this._allMediaStats[d].acs_name,g=l[d];let f;const m=this._allMediaStats[d].calculation_method;if(\"string\"==typeof g)if(\"last2\"===m){if(f=this.getLastTwoElementsDifference(g),isNaN(f))return}else f=this.getLastElement(g);else f=g;if(h.includes(\"Bitrate\")&&\"number\"==typeof f&&(f*=8),h in this._mediaStatsData)null===(p=null===(u=this._mediaStatsData)||void 0===u?void 0:u[h])||void 0===p||p.raw.push(f);else{const l=this._allMediaStats[d].aggregation_needed;this._mediaStatsData[h]=!0===l?{timestamp:new Date,raw:[f],aggregation:{count:[],sum:[],min:[],max:[]}}:{timestamp:new Date,raw:[f]}}}}})),this._aggregateWhenFetch&&this.calculateAggregations()},this._mediaTelemetryEmitterListenerActive||(this._mediaTelemetryEmitter.on(\"mediaTelemetryEmitted\",this._mediaTelemetryEmittedListener),this._mediaTelemetryEmitterListenerActive=!0),this._mediaStatsEmitEventSubscription||(this._mediaStatsEmitEventSubscription=window.setInterval((()=>{this.sendMetrics()}),1e3*this._emitInterval)),this._aggregateWhenFetch||this._aggregateWhenEmit||this._mediaStatsAggregateEventSubscription||(this._mediaStatsAggregateEventSubscription=window.setInterval((()=>{this.calculateAggregations()}),1e3*this._aggregationInterval))):this.clearAllIntervals()}};this._tsCall.on(\"callStateChanged\",startSubscription),startSubscription()}sendMetrics(){if(window.clearInterval(this._mediaStatsAggregateEventSubscription),this._mediaStatsAggregateEventSubscription=0,this.calculateAggregations(),this._isCollectorActive){const l={stats:this._mediaStatsData,collectionInterval:this._fetchInterval,aggregationInterval:this._aggregationInterval};this._eventEmitter.emit(\"mediaStatsEmitted\",l)}this._mediaStatsData={},this._aggregationIndexes={},this._aggregateWhenFetch||this._aggregateWhenEmit||this._mediaStatsAggregateEventSubscription||(this._mediaStatsAggregateEventSubscription=window.setInterval((()=>{this.calculateAggregations()}),1e3*this._aggregationInterval))}calculateAggregations(){Object.keys(this._mediaStatsData).forEach((l=>{var d,u,p,h,g,f,m,v,y,S,_;const C=l;if(this._mediaStatsData&&this._mediaStatsData[C]){let l=0;this._aggregationIndexes[C]&&(l=this._aggregationIndexes[C]);const E=null===(d=this._mediaStatsData[C])||void 0===d?void 0:d.raw.length,T=null===(p=null===(u=this._mediaStatsData)||void 0===u?void 0:u[C])||void 0===p?void 0:p.raw.slice(l);E&&l<E&&T&&(null===(g=null===(h=this._mediaStatsData[C])||void 0===h?void 0:h.aggregation)||void 0===g||g.min.push(this.getMinimum(T)),null===(m=null===(f=this._mediaStatsData[C])||void 0===f?void 0:f.aggregation)||void 0===m||m.max.push(this.getMaximum(T)),null===(y=null===(v=this._mediaStatsData[C])||void 0===v?void 0:v.aggregation)||void 0===y||y.count.push(this.getCount(T)),null===(_=null===(S=this._mediaStatsData[C])||void 0===S?void 0:S.aggregation)||void 0===_||_.sum.push(this.getSum(T))),this._aggregationIndexes[C]=E}}))}getLastElement(l){const d=l.split(\",\"),u=parseInt(d[d.length-1]);return isNaN(u)?d[d.length-1]:u}getLastTwoElementsDifference(l){const d=l.split(\",\");return d.length<2?NaN:parseInt(d[d.length-1])-parseInt(d[d.length-2])}getMinimum(l){let d=Number.MAX_SAFE_INTEGER;return l.forEach((l=>{\"number\"==typeof l&&(d=Math.min(d,l))})),d}getMaximum(l){let d=Number.MIN_SAFE_INTEGER;return l.forEach((l=>{\"number\"==typeof l&&(d=Math.max(d,l))})),d}getCount(l){return l.length}getSum(l){let d=0;return l.forEach((l=>{\"number\"==typeof l&&(d+=l)})),d}clearAllIntervals(){this._mediaStatsEmitEventSubscription&&(window.clearInterval(this._mediaStatsEmitEventSubscription),this._mediaStatsEmitEventSubscription=0),this._mediaTelemetryEmitterListenerActive&&(this._mediaTelemetryEmitter.off(\"mediaTelemetryEmitted\",this._mediaTelemetryEmittedListener),this._mediaTelemetryEmitterListenerActive=!1),this._mediaStatsAggregateEventSubscription&&(window.clearInterval(this._mediaStatsAggregateEventSubscription),this._mediaStatsAggregateEventSubscription=0),Object.keys(this._mediaStatsData).length>0&&this.sendMetrics()}dispose(){this._isCollectorActive=!1,this.clearAllIntervals()}}var yu,__decorate$4=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$4=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$6=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class MediaStatsCallFeatureImpl extends FirstPartyCallFeature{constructor(l){super(l),this._impl=new MediaStatsCallFeatureImplOverTsCall}on(l,d){this._sendFeatureUsage(\"mediaStatsEmitted\",xd.subscribe),this.eventEmitter.on(l,d)}off(l,d){this._sendFeatureUsage(\"mediaStatsEmitted\",xd.unsubscribe),this.eventEmitter.off(l,d)}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"MediaStats\"}startCollector(l){return this._impl.getMediaStatsCollector(l)}disposeAllCollectors(){return this._impl.disposeAllCollectors()}initialize(l,d){this._logger=d,this._telemetryLogManager=l.telemetryLogManager,this._call=l.call,this._impl.initialize(l.tsCall,l.call,l.telemetryLogManager,d),this._sendFeatureUsage(\"initialize\",xd.initialize)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:\"MediaStats\",featureType:\"Call\",initializationType:\"OnExtendedObjectConstructor\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class MediaStatsCallFeatureImplOverTsCall{constructor(){this._collectors=[],this._throttleOnBadNetworkSendQualityUfd=!1,this._senderStatsExpireTime=0,this._senderStatsKeys={},this._isSendingVideo=!1}initialize(l,d,u,p){this._logger=p.createChild((()=>`MediaStatsFeature::Call(id='${l.callId}', state='${l.state}')`)),this._tsCall=l,this._acsCall=d,this._telemetryLogManager=u,this._mediaTelemetryEmitter=new MediaTelemetryEmitter(this._tsCall),this.sendInternalTelemetry(),this._setupSenderStats()}getMediaStatsCollector(l){this._sendFeatureUsage(\"startCollector\",xd.attempt);const d=new MediaStatsCollectorImpl(this._tsCall,this._logger,this._mediaTelemetryEmitter,!1,l);return this._collectors.push(d),this._sendFeatureUsage(\"startCollector\",xd.success),d}dispose(){this._mediaTelemetryEmitter.stop()}disposeAllCollectors(){this._sendFeatureUsage(\"disposeAllCollectors\",xd.attempt),this._collectors.forEach((l=>{l.dispose()})),this._collectors=[],this._sendFeatureUsage(\"disposeAllCollectors\",xd.success)}_setupSenderStats(){const l=getAcsEcsConfig(),d=l.rendering.remoteVideo.createViewSenderStatsEnabled,u=l.rendering.remoteVideo.createViewSenderStatsDuration;d&&([\"audioSendRtt\",\"audioSendPairRtt\",\"videoSendRtt\",\"videoSendPairRtt\",\"audioSendJitterMs\",\"videoSendJitterMs\",\"audioSendPackets\",\"videoSendPackets\",\"audioSendPacketsLost\",\"videoSendPacketsLost\",\"screenSharingSendPacketsLost\",\"audioSendBitrate\",\"videoSendBitrate\",\"videoSendFrameRateInput\",\"videoSendFrameRateSent\",\"screenSharingSendFrameRateInput\",\"screenSharingSendFrameRateSent\",\"videoSendFramesEncoded\",\"screenSharingSendFramesEncoded\"].forEach((l=>this._senderStatsKeys[l]=!0)),this._acsCall.on(\"remoteParticipantsUpdated\",(l=>{this._isSendingVideo=this._acsCall.localVideoStreams.length>0||this._acsCall.isScreenSharingOn,this._isSendingVideo&&l.added.length>0&&(this._senderStatsExpireTime=Date.now()+u)})))}sendInternalTelemetry(){const diagnosticChangedListener=d=>{\"DiagnosticQuality\"===d.valueType&&\"networkSendQuality\"===d.diagnostic&&(d.value===l.DiagnosticQuality.Bad||d.value===l.DiagnosticQuality.Poor?this._throttleOnBadNetworkSendQualityUfd=!0:this._throttleOnBadNetworkSendQualityUfd=!1)},d=getAcsEcsConfig(),u=d.rendering.remoteVideo.createViewSenderStatsEnabled,p=d.telemetry.mediaStatsConfig,h=d.rendering.remoteVideo.createViewSenderStatsDuration;if(this._acsCall.feature(bu.UserFacingDiagnostics).network.on(\"diagnosticChanged\",diagnosticChangedListener),p.enabled){new MediaStatsCollectorImpl(this._tsCall,this._logger,this._mediaTelemetryEmitter,!0).on(\"mediaStatsEmitted\",(l=>{var d,g,f,m,v,y,S,_;let C=l.stats;Object.keys(C).forEach((d=>{var u;const p=d;(null===(u=C[p])||void 0===u?void 0:u.raw.every((l=>0==l)))&&delete l.stats[p]}));const E=this._acsCall.localVideoStreams.length>0||this._acsCall.isScreenSharingOn;!this._isSendingVideo&&E&&(this._senderStatsExpireTime=Date.now()+h),this._isSendingVideo=E;let T={};Object.keys(C).forEach((l=>{var d,h,g,f,m,v,y,S,_,E,b;const I=l;if(void 0!==(null===(d=C[I])||void 0===d?void 0:d.aggregation)){T[I]={timestamp:null===(h=C[I])||void 0===h?void 0:h.timestamp};const shouldCollectSenderStats=()=>{var l;if(u){const d=(null===(l=C[I])||void 0===l?void 0:l.timestamp.getTime())||0;return d>0&&d<this._senderStatsExpireTime&&!0===this._senderStatsKeys[I]}return!1};(p.dataToSend.raw||shouldCollectSenderStats())&&(T[I].raw=null===(g=C[I])||void 0===g?void 0:g.raw),T[I].aggregation={},p.dataToSend.min&&(T[I].aggregation.min=null===(m=null===(f=C[I])||void 0===f?void 0:f.aggregation)||void 0===m?void 0:m.min),p.dataToSend.max&&(T[I].aggregation.max=null===(y=null===(v=C[I])||void 0===v?void 0:v.aggregation)||void 0===y?void 0:y.max),p.dataToSend.sum&&(T[I].aggregation.sum=null===(_=null===(S=C[I])||void 0===S?void 0:S.aggregation)||void 0===_?void 0:_.sum),p.dataToSend.count&&(T[I].aggregation.count=null===(b=null===(E=C[I])||void 0===E?void 0:E.aggregation)||void 0===b?void 0:b.count),0===Object.keys(T[I].aggregation).length&&(delete T[I].aggregation,void 0===T[I].raw&&delete T[I])}else T[I]=C[I]}));let b=T;if(1===p.throttleTelemetry||2===p.throttleTelemetry){let l=!1;if(1===p.throttleTelemetry&&C.videoSendBitrate){const u=null===(d=C.sentBWEstimate)||void 0===d?void 0:d.raw.length,p=null===(f=null===(g=C.sentBWEstimate)||void 0===g?void 0:g.aggregation)||void 0===f?void 0:f.count.length;if(u&&p){const d=null===(m=C.sentBWEstimate)||void 0===m?void 0:m.raw[u-1],h=null===(y=null===(v=C.videoSendBitrate)||void 0===v?void 0:v.aggregation)||void 0===y?void 0:y.sum[p-1],g=null===(_=null===(S=C.videoSendBitrate)||void 0===S?void 0:S.aggregation)||void 0===_?void 0:_.count[p-1];if(d&&h&&g&&g>0){const u=h/g;parseInt(d.toString())-u<1e5&&u<2e6&&(l=!0)}}}(2===p.throttleTelemetry||l||this._throttleOnBadNetworkSendQualityUfd)&&(b={},Object.keys(T).forEach((l=>{var d,u,h,g,f,m;const v=l;void 0!==(null===(d=C[v])||void 0===d?void 0:d.aggregation)?(b[v]={timestamp:null===(u=T[v])||void 0===u?void 0:u.timestamp,aggregation:{}},p.dataToSend.min&&(b[v].aggregation.min=null===(g=null===(h=T[v])||void 0===h?void 0:h.aggregation)||void 0===g?void 0:g.min),p.dataToSend.max&&(b[v].aggregation.max=null===(m=null===(f=T[v])||void 0===f?void 0:f.aggregation)||void 0===m?void 0:m.max),0===Object.keys(b[v].aggregation).length&&(delete b[v].aggregation,void 0===b[v].raw&&delete b[v])):b[v]=T[v]})))}l.stats=b,this._telemetryLogManager.sendEvent({name:kd.acs_calling_mid_call_media_stats,tenant:q,properties:Object.assign(Object.assign({},l),{callId:this._tsCall.callId||\"\",callType:this._tsCall.callType||\"\",callDirection:this._acsCall.direction,groupJoin:!!this._tsCall.groupId,meetingJoin:!!this._tsCall.meetingInfo,localParticipantId:this._tsCall.participantId||\"\"})})}))}}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._tsCall.callId,localParticipantId:this._tsCall.participantId,featureName:\"MediaStats\",featureType:\"Call\",initializationType:\"OnExtendedObjectConstructor\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}}__decorate$4([syncOperation(Bd.getMediaStatsCollector),__metadata$4(\"design:type\",Function),__metadata$4(\"design:paramtypes\",[Object]),__metadata$4(\"design:returntype\",Object)],MediaStatsCallFeatureImplOverTsCall.prototype,\"getMediaStatsCollector\",null),__decorate$4([syncOperation(Bd.disposeAllCollectors),__metadata$4(\"design:type\",Function),__metadata$4(\"design:paramtypes\",[]),__metadata$4(\"design:returntype\",void 0)],MediaStatsCallFeatureImplOverTsCall.prototype,\"disposeAllCollectors\",null);class MediaTelemetryEmitter{constructor(l){this._tsCall=l,this._eventEmitter=new ri.EventEmitter,this._fetchInterval=0,this._mediaStatsFetchEventSubscription=0,this._fetchInterval=getAcsEcsConfig().telemetry.mediaStatsConfig.fetchInterval;const d=[3,10],initialize=()=>{d.includes(this._tsCall.state)?this.start():this.stop()};this._tsCall.on(\"callStateChanged\",(()=>{initialize()})),initialize()}on(l,d){this._eventEmitter.on(l,d)}off(l,d){this._eventEmitter.off(l,d)}start(){this._mediaStatsFetchEventSubscription||(this._mediaStatsFetchEventSubscription=window.setInterval((()=>__awaiter$6(this,void 0,void 0,(function*(){const l=yield this._tsCall.getMediaTelemetry(!0);this._eventEmitter.emit(\"mediaTelemetryEmitted\",l)}))),1e3*this._fetchInterval))}stop(){this._mediaStatsFetchEventSubscription&&(window.clearInterval(this._mediaStatsFetchEventSubscription),this._mediaStatsFetchEventSubscription=0)}}(yu=l.RecordingState||(l.RecordingState={}))[yu.None=0]=\"None\",yu[yu.Started=1]=\"Started\",yu[yu.Paused=2]=\"Paused\",yu[yu.Ended=3]=\"Ended\";var __awaiter$7=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class RecordingCallFeatureImpl extends FirstPartyCallFeature{constructor(l){super(l),this._impl=new RecordingCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"Recording\"}initialize(l,d){this._logger=d,this._telemetryLogManager=l.telemetryLogManager,this._call=l.call,this._impl.initialize(l.tsCall,l.telemetryLogManager,d),this._sendFeatureUsage(\"initialize\",xd.initialize)}get isRecordingActive(){return this._sendFeatureUsage(\"isRecordingActive\",xd.getter),this._impl.isRecordingActive}get recordings(){return this._sendFeatureUsage(\"recordings\",xd.getter),this._impl.recordings}on(l,d){if(\"isRecordingActiveChanged\"!==l&&\"recordingsUpdated\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this._sendFeatureUsage(l,xd.subscribe),this.eventEmitter.on(l,d)}off(l,d){if(\"isRecordingActiveChanged\"!==l&&\"recordingsUpdated\"!==l)throw new CallingCommunicationError({message:`Not able to unsubscribe to event ${l}, unknown event name`,code:be});this._sendFeatureUsage(l,xd.unsubscribe),this.eventEmitter.off(l,d)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:\"Recording\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class RecordingCallImplOverTsCall{constructor(l){this._eventEmitter=l,this._recordingBots=new Map,this._recordingBotChangedSubs=new WeakMap,this._isRecordingActive=!1,this._updateIsCallRecorded=l=>this._isRecordingActive!==l&&(this._isRecordingActive=l,this._logger.info(`Updating isCallRecorded to ${l}`),!0),this._handleRecordingBotAdded=l=>{const handleRecordingBotChanged=()=>{var d,u;let p,h=!1,g=!1;if(this._hasRecordingState(l)){if(this._recordingBots.has(l.id)){let h=this._getRecordingBotEndpoint(l);p=this._recordingBots.get(l.id),h&&p&&(p.endpoint=h,g=null!==(u=null===(d=p.recordingInfo)||void 0===d?void 0:d.update(h))&&void 0!==u&&u)}else p=this._getRecordingBotInfo(l),p&&(this._logger.info(\"Adding recording bot\"),this._recordingBots.set(l.id,p),h=!0);this._sendEvents(g?[p]:void 0,h?[p]:void 0,void 0,this._updateIsCallRecorded(this._isRecordingEnabled()))}};handleRecordingBotChanged(),this._recordingBotChangedSubs.set(l,l.changed(handleRecordingBotChanged))},this._handleRecordingBotRemoved=l=>{var d,u,p;let h=this._recordingBots.get(l.id);this._recordingBots.delete(l.id),null===(d=this._recordingBotChangedSubs.get(l))||void 0===d||d.dispose(),this._recordingBotChangedSubs.delete(l),this._logger.info(`Updating recordingState to ${null===(u=null==h?void 0:h.endpoint)||void 0===u?void 0:u.state}`),null===(p=null==h?void 0:h.recordingInfo)||void 0===p||p.dispose(),this._sendEvents([h],void 0,[h],this._updateIsCallRecorded(this._isRecordingEnabled()))},this._sendEvents=(l,d,u,p)=>{l&&l.forEach((l=>{var d;return null===(d=null==l?void 0:l.recordingInfo)||void 0===d?void 0:d.sendRecordingStateChanged()}));let h=!!d&&d.length>0,g=!!u&&u.length>0;(h||g)&&this._eventEmitter.emit(\"recordingsUpdated\",{added:this._getRecordingInfos(d),removed:this._getRecordingInfos(u)}),p&&this._eventEmitter.emit(\"isRecordingActiveChanged\")},this._hasRecordingState=l=>{var d,u,p;return null!==(p=null===(u=null===(d=null==l?void 0:l.endpoints)||void 0===d?void 0:d.endpointDetails)||void 0===u?void 0:u.some((l=>{var d,u,p,h,g,f,m;return!!(null===(h=null===(p=null===(u=null===(d=null==l?void 0:l.endpointMetadata)||void 0===d?void 0:d.__platform)||void 0===u?void 0:u.recording)||void 0===p?void 0:p.compliance)||void 0===h?void 0:h.state)||!!(null===(m=null===(f=null===(g=null==l?void 0:l.endpointMetadata)||void 0===g?void 0:g.processingModes)||void 0===f?void 0:f.recording)||void 0===m?void 0:m.state)})))&&void 0!==p&&p},this._getRecordingInfos=l=>{if(l)return l.map((l=>null==l?void 0:l.recordingInfo)).filter((l=>!!l))},this._isRecordingEnabled=()=>{let l=!1;try{this._recordingBots.forEach((d=>{var u;l||(l=\"Active\"===(null===(u=null==d?void 0:d.endpoint)||void 0===u?void 0:u.state))}))}catch(l){this._logger.info(\"Unable to read recording state: \",l)}return l},this._getRecordingInfoImpl=l=>{if(null!=l&&(\"Active\"===l.state||\"Inactive\"===l.state))return new RecordingInfoImpl(l.state,this._eventEmitter)},this._getRecordingBotInfo=l=>{let d=this._getRecordingBotEndpoint(l);return d?{endpoint:d,recordingInfo:this._getRecordingInfoImpl(d)}:void 0},this._getRecordingBotEndpoint=l=>{var d;let u=null===(d=l.endpoints)||void 0===d?void 0:d.endpointDetails.map((l=>{var d,u,p,h,g,f,m;let v=null===(h=null===(p=null===(u=null===(d=null==l?void 0:l.endpointMetadata)||void 0===d?void 0:d.__platform)||void 0===u?void 0:u.recording)||void 0===p?void 0:p.compliance)||void 0===h?void 0:h.state,y=null===(m=null===(f=null===(g=null==l?void 0:l.endpointMetadata)||void 0===g?void 0:g.processingModes)||void 0===f?void 0:f.recording)||void 0===m?void 0:m.state;if(v||y)return{state:null!=v?v:y}})).filter((l=>null!=l));if(u&&0!=u.length)return u.length>1&&this._logger.log(`Unexpected: multiple recording endpoints: ${null==u?void 0:u.map((l=>{var d;return null!==(d=null==l?void 0:l.state)&&void 0!==d?d:\"undefined\"})).join(\", \")}`),u[0]}}get isRecordingActive(){return this._isRecordingActive}get recordings(){return Array.from(this._recordingBots.values()).map((l=>null==l?void 0:l.recordingInfo)).filter((l=>!!l))}initialize(l,d,u){this._logger=u.createChild((()=>`RecordingFeature::Call(id='${l.callId}', state='${l.state}')`)),l.on(\"participantAdded\",(l=>__awaiter$7(this,void 0,void 0,(function*(){isCallingApplication(l.id)&&this._handleRecordingBotAdded(l)})))),l.on(\"participantRemoved\",(l=>__awaiter$7(this,void 0,void 0,(function*(){isCallingApplication(l.id)&&this._handleRecordingBotRemoved(l)}))))}dispose(){let l=this._updateIsCallRecorded(!1),d=Array.from(this._recordingBots.values());d.forEach((l=>{var d;return null===(d=null==l?void 0:l.recordingInfo)||void 0===d?void 0:d.dispose()})),this._sendEvents(void 0,void 0,d,l)}}class RecordingInfoImpl{constructor(l,d){this.state=this.getRecordingState(l),this._eventEmitter=d}on(l,d){this._eventEmitter.on(l,d)}off(l,d){this._eventEmitter.off(l,d)}update(l){if(null==l)return!1;let d=this.getRecordingState(l.state);return d!=this.state&&(this.state=d,!0)}dispose(){this.state=l.RecordingState.Ended}sendRecordingStateChanged(){this._eventEmitter.emit(\"recordingStateChanged\")}getRecordingState(d){let u=l.RecordingState.None;switch(null==d?void 0:d.toLocaleLowerCase()){case\"active\":u=l.RecordingState.Started;break;case\"inactive\":u=l.RecordingState.Paused;break;default:u=l.RecordingState.None}return u}}var __awaiter$8=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class TranscriptionCallFeatureImpl extends FirstPartyCallFeature{constructor(l){super(l),this._impl=new TranscriptionCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"Transcription\"}initialize(l,d){this._logger=d,this._telemetryLogManager=l.telemetryLogManager,this._call=l.call,this._impl.initialize(l.tsCall,l.telemetryLogManager,d),this._sendFeatureUsage(\"initialize\",xd.initialize)}get isTranscriptionActive(){return this._sendFeatureUsage(\"isTranscriptionActive\",xd.getter),this._impl.isTranscriptionActive}on(l,d){this._sendFeatureUsage(\"isTranscriptionActiveChanged\",xd.subscribe),this.eventEmitter.on(l,d)}off(l,d){this._sendFeatureUsage(\"isTranscriptionActiveChanged\",xd.unsubscribe),this.eventEmitter.off(l,d)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:\"Transcription\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class TranscriptionCallImplOverTsCall{constructor(l){this._eventEmitter=l,this._transcriptionBotChangedSubs=new WeakMap,this._isTranscriptionActive=!1,this._updateIsCallTranscribed=l=>{this._isTranscriptionActive!==l&&(this._isTranscriptionActive=l,this._logger.info(`Updating isTranscriptionActive to ${l}`),this._eventEmitter.emit(\"isTranscriptionActiveChanged\"))},this._isCallingApplication=l=>isCallingApplication(l.id),this._handleTranscriptionBotRemoved=l=>{var d;this._isTranscriptionBot(l)&&(this._transcriptionBot=void 0),null===(d=this._transcriptionBotChangedSubs.get(l))||void 0===d||d.dispose(),this._transcriptionBotChangedSubs.delete(l),this._updateIsCallTranscribed(this._isTranscriptionEnabled())},this._handleTranscriptionBotAdded=l=>{const handleTranscriptionBotChanged=()=>{this._isTranscriptionBot(l)&&!this._transcriptionBot&&(this._logger.info(\"Adding transcription bot\"),this._transcriptionBot=l),this._updateIsCallTranscribed(this._isTranscriptionEnabled())};handleTranscriptionBotChanged(),this._transcriptionBotChangedSubs.set(l,l.changed(handleTranscriptionBotChanged))},this._isTranscriptionEnabled=()=>{var l,d,u,p;let h=!1;if(!this._transcriptionBot)return h;try{const g=null===(l=this._transcriptionBot.endpoints)||void 0===l?void 0:l.endpointDetails[0];h=\"Active\"===(null===(p=null===(u=null===(d=null==g?void 0:g.endpointMetadata)||void 0===d?void 0:d.processingModes)||void 0===u?void 0:u.realTimeTranscript)||void 0===p?void 0:p.state)}catch(l){this._logger.warn(\"Unable to read transcription state: \",l)}return h},this._isTranscriptionBot=l=>\"28:b1902c3e-b9f7-4650-9b23-5772bd429747\"===l.id}get isTranscriptionActive(){return this._isTranscriptionActive}initialize(l,d,u){this._logger=u.createChild((()=>`TranscriptionFeature::Call(id='${l.callId}', state='${l.state}')`)),l.on(\"participantAdded\",(l=>__awaiter$8(this,void 0,void 0,(function*(){this._isCallingApplication(l)&&this._handleTranscriptionBotAdded(l)})))),l.on(\"participantRemoved\",(l=>__awaiter$8(this,void 0,void 0,(function*(){this._isCallingApplication(l)&&this._handleTranscriptionBotRemoved(l)}))))}dispose(){this._updateIsCallTranscribed(!1)}}class TransferImpl{constructor(l,d,u=!0){return this._eventEmitter=new ri.EventEmitter,this._lastTsTransferState=0,this._getTransferEndReason=(l,d=0)=>{var u;let p=d,h=0,g=l||\"Unknown\";this._tsCall&&(p=this._tsCall.transferDiagnosticsInfo&&this._tsCall.transferDiagnosticsInfo.callControllerCode||d,h=this._tsCall.transferDiagnosticsInfo&&(null===(u=this._tsCall.transferDiagnosticsInfo)||void 0===u?void 0:u.callControllerSubCode)||0,g=convertTerminatedReasonToString(this._tsCall.terminatedReason));const f={code:p,subCode:h};return this._logger[0===p?\"info\":\"error\"](`Transfer end reason=${g}, code=${p}, subCode=${h}`),f},this._state=\"None\",this._logger=d.createChild((()=>\"Transfer\")),this._logger.log(\"created\"),this._tsCall=l,u?4!==l.state?(this._logger.error(\"Transfer end reason= call must be on hold before transfer\"),this._error={code:Te},void this.setTransferState(4)):(this._lastTsTransferState=this._tsCall.transferState,this.setTransferState(this._tsCall.transferState),void this._tsCall.changed((()=>{this._tsCall.transferState!==this._lastTsTransferState&&(this._logger.log(`tsCall transfer state changed=${this._tsCall.transferState}`),this._lastTsTransferState=this._tsCall.transferState,this.setTransferState(this._tsCall.transferState))}))):(this._logger.error(\"Transfer end reason= call was not found with this callId\"),this._error={code:Te},void this.setTransferState(4))}get state(){return this._state}get error(){return this._error}on(l,d){this._eventEmitter.on(l,d)}off(l,d){this._eventEmitter.off(l,d)}setTransferState(l){let d,u;const p={0:\"None\",1:\"Transferring\",2:\"Transferring\",3:\"Transferred\",4:\"Failed\"};p[l]?(d=p[l],\"Failed\"===d&&(u=this._getTransferEndReason(),this._error=u),this._logger.log(`Mapped ts transfer state:[${l}] to [${d}]`),this._setTransferState(d)):this._logger.warn(`unable to map tsCall state=[${l}] to transfer state`)}_setTransferState(l){l!==this._state&&(this._logger.log(`transfer state changed [${this._state}]=>[${this.state}]`),this._state=l,this._eventEmitter.emit(\"stateChanged\"))}}var __decorate$5=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$5=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)};class TransferCallFeatureImpl extends FirstPartyCallFeature{constructor(l){super(l),this._impl=new TransferCallImplOverTsCall(this.eventEmitter)}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"Transfer\"}transfer(l,d){return this._impl.transfer(l,d)}initialize(l,d){this._logger=d,this._telemetryLogManager=l.telemetryLogManager,this._call=l.call,this._impl.initialize(l.tsCall,l.callAgent,l.telemetryLogManager,d),this._sendFeatureUsage(\"initialize\",xd.initialize)}on(l,d){this._sendFeatureUsage(\"transferRequested\",xd.subscribe),this.eventEmitter.on(l,d)}off(l,d){this._sendFeatureUsage(\"transferRequested\",xd.unsubscribe),this.eventEmitter.off(l,d)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._call.id,localParticipantId:this._call.tsCall.participantId,featureName:\"Transfer\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class TransferCallImplOverTsCall{constructor(l){this._eventEmitter=l}initialize(l,d,u,p){this._logger=p.createChild((()=>`TransferFeature::Call(id='${l.callId}', state='${l.state}')`)),this._telemetryLogManager=u,this._tsCall=l,this._callAgent=d,l.on(\"transferRequested\",(l=>{try{const u=constructIdentifierKindFromMri(l.transferContext.targetMri);if(\"communicationUser\"!==u.kind&&\"phoneNumber\"!==u.kind&&\"microsoftTeamsUser\"!==u.kind&&\"unknown\"!==u.kind)throw new CallingCommunicationError({message:`Invalid target participant type detected:${u}`,code:be});{let p=!1;const h={targetParticipant:u,accept:u=>{let h;try{return h=d.createTransferTargetCall(l.transferContext),p?(this._logger.info(\"Transfer accept was called when transfer action is already in progress.\"),h):(p=!0,h.startCallInternal(u).then((()=>{l.onCompleted(1),this._logger.info(\"Transfer request has been accepted successfully from transferee.\")})).catch((d=>{p=!1,l.onCompleted(7),this._logger.error(\"Transfer to target failed at call start\")})),h)}catch(d){throw p=!1,l.onCompleted(7),this._logger.error(\"Transfer to target failed at call create\"),new CallingCommunicationError({message:\"Transfer to target failed\",code:Ie},d)}},reject:()=>{p?this._logger.info(\"Transfer reject was called when transfer action is already in progress.\"):(p=!0,l.onCompleted(10),this._logger.info(\"Transfer request has been decliend by transferee.\"))}};this._eventEmitter.emit(\"transferRequested\",h)}}catch(d){l.onCompleted(7),this._logger.error(d)}}))}transfer(l,d){if(this._sendFeatureUsage(\"transfer\",xd.attempt),!this.isTransferable(this._tsCall))throw this._sendFeatureUsage(\"transfer\",xd.failure),new CallingCommunicationError({message:\"Transfer can only be initiated from 1 on 1 call.\",code:ve});try{if(l.targetParticipant){const u=this.transferToParticipant(l.targetParticipant,d);return this._sendFeatureUsage(\"transfer\",xd.success),u}if(l.targetCallId){const u=this.transferToCall(l.targetCallId,d);return this._sendFeatureUsage(\"transfer\",xd.success),u}}catch(l){if(this._sendFeatureUsage(\"transfer\",xd.failure),l instanceof CallingCommunicationError)throw l}throw this._sendFeatureUsage(\"transfer\",xd.failure),new CallingCommunicationError({message:\"Transfer target is not recognized.\",code:be})}isTransferable(l){return 1===l.callType||l.participants.filter((l=>!isCallingApplication(l.id))).length<=2}transferToParticipant(l,d){let u=getMriFromIdentifier(l);4===this._tsCall.state&&this._tsCall.callSafeTransfer(u,void 0,d);return new TransferImpl(this._tsCall,this._logger)}transferToCall(l,d){const u=this._callAgent.getCallByCallId(l);if(u&&!this.isTransferable(u))throw new CallingCommunicationError({message:\"Transfer target call can only be 1 on 1 call.\",code:ve});u&&4===this._tsCall.state&&this._tsCall.callConsultativeTransfer(u,void 0,void 0,d);return new TransferImpl(this._tsCall,this._logger,!!u)}_sendFeatureUsage(l,d){sendCallFeatureUsageTelemetry({callId:this._tsCall.callId,localParticipantId:this._tsCall.participantId,featureName:\"Transfer\",featureType:\"Call\",initializationType:\"OnFeatureAccess\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){}}__decorate$5([syncOperation(Bd.Transfer),__metadata$5(\"design:type\",Function),__metadata$5(\"design:paramtypes\",[Object,Object]),__metadata$5(\"design:returntype\",Object)],TransferCallImplOverTsCall.prototype,\"transfer\",null);class AudioDeviceInfoImpl{constructor(l,d,u,p,h){this._name=l,this._id=d,this._isSystemDefault=u,this._deviceType=p,this._deviceManager=h}get name(){return this._name}setName(l){this._name=l}get id(){return this._id}setId(l){this._id=l}get isSystemDefault(){return this._isSystemDefault}setIsSystemDefault(l){this._isSystemDefault=l}get deviceType(){return this._deviceType}setDeviceType(l){this._deviceType=l}get deviceManager(){return this._deviceManager}}var Su,_u,__decorate$6=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$6=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$9=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class LocalAudioStream{constructor(l){const u=d.createClientLogger(\"ACS\");if(this.logger=new DefaultLogger(u,[()=>`LocalAudioStream for default device with source: ${!!l}`]),this._eventEmitter=new CallingEventEmitter(this.logger),!(l instanceof AudioDeviceInfoImpl||l instanceof MediaStreamTrack))throw new CallingCommunicationError({message:\"Failed to create local audio stream, source is not of type AudioDeviceInfo or MediaStreamTrack\",code:be});if(l instanceof AudioDeviceInfoImpl&&\"Microphone\"!==l.deviceType)throw new CallingCommunicationError({message:\"Failed to create local audio stream, source is not a microphone\",code:be});this._source=l,this._disposed=!1,this.logger.info(\"created\")}on(l,d){if(\"audioSourceChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this._eventEmitter.on(l,d)}off(l,d){if(\"audioSourceChanged\"!==l)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${l}, unknown event name`,code:be});this._eventEmitter.off(l,d)}get source(){return this._source}getMediaStreamTrack(){return __awaiter$9(this,void 0,void 0,(function*(){if(this.subscribeToRawStreamChangedIfNeeded(),this._source instanceof AudioDeviceInfoImpl)return this._source.deviceManager.getInputAudioStreamTrack();if(this._source instanceof MediaStreamTrack)return Promise.resolve(this._source);throw new CallingCommunicationError({message:\"Failed to get media stream track source is not AudioDeviceInfo or MediaStreamTrack\",code:be})}))}switchSource(l){return __awaiter$9(this,void 0,void 0,(function*(){if(!(l instanceof AudioDeviceInfoImpl||l instanceof MediaStreamTrack))throw new CallingCommunicationError({message:\"Failed to switch source on local audio stream, source is not of type AudioDeviceInfo or MediaStreamTrack\",code:be});if(l instanceof AudioDeviceInfoImpl&&\"Microphone\"!==l.deviceType)throw new CallingCommunicationError({message:\"Failed to create local audio stream, source is not a microphone\",code:be});this._source!==l&&(this._source=l,this._eventEmitter.emit(\"audioSourceChanged\",{source:this}))}))}dispose(){this.logger.log(\"LocalAudioStream disposing\"),this._disposed?this.logger.log(\"Already disposed\"):(this.disposeRawStream(),this._disposed=!0,this.logger.log(\"LocalAudioStream disposed\"))}subscribeToRawStreamChangedIfNeeded(){this._source instanceof AudioDeviceInfoImpl&&!this._audioSourceChangedSub&&(this._audioSourceChangedSub=this._source.deviceManager.getTsDeviceManager().on(\"onRawStreamChanged\",(l=>{0===l&&this._eventEmitter.emit(\"audioSourceChanged\",{source:this})})))}disposeRawStream(){var l;this._source instanceof AudioDeviceInfoImpl&&(null===(l=this._source)||void 0===l||l.deviceManager.disposeInputAudioStreamTrack()),this._audioSourceChangedSub&&this._audioSourceChangedSub.dispose(),this._audioSourceChangedSub=void 0}}__decorate$6([loggerProperty,__metadata$6(\"design:type\",Object)],LocalAudioStream.prototype,\"logger\",void 0),__decorate$6([asyncOperation(ns.GetMediaStreamTrack),__metadata$6(\"design:type\",Function),__metadata$6(\"design:paramtypes\",[]),__metadata$6(\"design:returntype\",Promise)],LocalAudioStream.prototype,\"getMediaStreamTrack\",null),__decorate$6([asyncOperation(ns.SwitchSource),__metadata$6(\"design:type\",Function),__metadata$6(\"design:paramtypes\",[Object]),__metadata$6(\"design:returntype\",Promise)],LocalAudioStream.prototype,\"switchSource\",null),function(l){l[l.JITTER=0]=\"JITTER\",l[l.RTT=1]=\"RTT\",l[l.PACKETS_LOSS=2]=\"PACKETS_LOSS\",l[l.BIT_RATE=3]=\"BIT_RATE\",l[l.BANDWIDTH=4]=\"BANDWIDTH\"}(Su||(Su={})),function(l){l[l.AUDIO=0]=\"AUDIO\",l[l.VIDEO=1]=\"VIDEO\"}(_u||(_u={}));const Cu=\"Unknown\";var Eu,Tu;!function(l){l.BeginTest=\"BeginTest\",l.DeviceAccess=\"DeviceAccess\",l.DeviceEnumerations=\"DeviceEnumerations\",l.InCallDiagnostics=\"InCallDiagnostics\",l.BroswerSupport=\"BroswerSupport\"}(Eu||(Eu={})),function(l){l.Supported=\"Supported\",l.NotSupported=\"NotSupported\",l.Unknown=\"Unknown\"}(Tu||(Tu={}));var __awaiter$a=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class PreCallDiagnosticsFeatureImpl extends FirstPartyCallClientFeature{constructor(l){super(l),this._impl=new PreCallDiagnosticsImpl}initialize(l,d){const u=l.callClient,p=l.telemetryLogManager;this._logger=d,this._telemetryLogManager=p,this._impl.intialize(u,d,p),this._sendFeatureUsage(\"initialize\",xd.initialize)}get name(){return this._sendFeatureUsage(\"name\",xd.getter),\"PreCallDiagnostics\"}startTest(l){return this._impl.startTest(l)}_sendFeatureUsage(l,d){sendCallClientFeatureUsageTelemetry({featureName:\"PreCallDiagnostics\",featureType:\"CallClient\",initializationType:\"OnExtendedObjectConstructor\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){this._sendFeatureUsage(\"dispose\",xd.attempt),this.disposed?this._sendFeatureUsage(\"dispose\",xd.failure):(this._impl.dispose(),super.dispose(),this._sendFeatureUsage(\"dispose\",xd.success))}}class PreCallDiagnosticsImpl{constructor(){this._printableObjectAll=!0,this._diagnosticsTestRunIds=[],this._callMediaStatistics=defer(),this._inCallDiagnostics={connected:!1,diagnostics:{audio:{jitter:Cu,packetLoss:Cu,rtt:Cu},video:{jitter:Cu,packetLoss:Cu,rtt:Cu}},bandWidth:Cu},this._diagnosticsMediaTelemetry={jitter:{audio:{inbound:0,outbound:0},video:{inbound:0,outbound:0}},rtt:{audio:0,video:0},packets:{audioSent:0,audioSentLost:0,audioReceived:0,audioReceivedLost:0,videoSent:0,videoSentLost:0,videoReceived:0,videoReceivedLost:0},bandWidth:0},this._isCreatingNewCallAgent=!1}intialize(l,d,u){this._mainCallClient=l,this._logger=d,this._telemetryLogManager=u}startTest(l){var d,u,p;return __awaiter$a(this,void 0,void 0,(function*(){this._sendFeatureUsage(\"startTest\",xd.attempt),this._currentTestRunId=generateGuid(),this._diagnosticsTestRunIds.push(this._currentTestRunId),this.telemetryLogAttemptEvents({eventName:kd.acs_calling_diagnostics_test_attempt,testName:Eu.BeginTest,runAttemptDetails:{info:\"Diagnostics test initiated.\"},diagnosticsTestRunId:this._currentTestRunId}),this._internalCallClient||(this._internalCallClient=new CallClient({diagnostics:{tags:[\"diagnostics\",`test-run-id:${this._currentTestRunId}`]}}));try{this._internalDeviceManager=yield this._internalCallClient.getDeviceManager();const l=this._internalCallClient.callAgent,h=yield this._mainCallClient.getDeviceManager();null===(d=null==l?void 0:l.tsStack)||void 0===d||d.getDeviceManager().selectDevices({speaker:null===(u=h.selectedSpeaker)||void 0===u?void 0:u.id,microphone:null===(p=h.selectedMicrophone)||void 0===p?void 0:p.id});const g=yield this._internalCallClient.getDeviceManager(),f={mic:(yield g.getMicrophones()).length,speaker:(yield g.getSpeakers()).length};this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_test_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.BeginTest,succeeded:!0,runResultDetails:{successInfo:`Device selection successful. Result: ${getPrintableObject(f,this._printableObjectAll)}`}})}catch(l){this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_test_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.BeginTest,succeeded:!1,runResultDetails:{errorInfo:\"Device selection failed.\"}});const d=\"Failed to set default microphone or speaker with error\";throw this._logger.warn(d,l),this._sendFeatureUsage(\"startTest\",xd.failure),new CallingCommunicationError({message:d,code:Te})}try{return this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_test_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.BeginTest,succeeded:!0,runResultDetails:{successInfo:`Call diagnostics successful. Result: ${getPrintableObject(this._inCallDiagnostics,this._printableObjectAll)}`}}),this._sendFeatureUsage(\"startTest\",xd.success),{deviceAccess:this.deviceAccess(),deviceEnumeration:this.deviceEnumeration(),inCallDiagnostics:this.getInCallDiagnostics(l),browserSupport:this.getBrowserSupport(),callMediaStatistics:this.getcallMediaStatistics(),id:this._currentTestRunId}}catch(l){const d=`Unable to return call diagnostic information, failed with error: ${getPrintableObject(l)}`;throw this._logger.error(d),this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_test_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.BeginTest,succeeded:!1,runResultDetails:{errorInfo:\"Call diagnostics failed.\"}}),this._sendFeatureUsage(\"startTest\",xd.failure),new CallingCommunicationError({message:d,code:Te})}}))}getBrowserSupport(){return __awaiter$a(this,void 0,void 0,(function*(){const l=generateGuid();let d;this.telemetryLogAttemptEvents({eventName:kd.acs_calling_diagnostics_broswer_support_attempt,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.BroswerSupport,runAttemptDetails:{info:\"Browser Support initiated.\"}});try{const u=yield this._mainCallClient.getEnvironmentInfo();d={browser:u.isSupportedBrowser?Tu.Supported:Tu.NotSupported,os:u.isSupportedPlatform?Tu.Supported:Tu.NotSupported},this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_browser_support_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.BroswerSupport,succeeded:!0,runResultDetails:{successInfo:`Browser support successful. Result: ${getPrintableObject(d,this._printableObjectAll)}`,subTestCorrelationId:l}})}catch(u){d={browser:Tu.Unknown,os:Tu.Unknown},this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_browser_support_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.BroswerSupport,succeeded:!1,runResultDetails:{errorInfo:\"Browser support failed.\",exceptionInfo:getPrintableObject(u),subTestCorrelationId:l}}),this._logger.error(`Browser support failed: ${u}`)}return new Promise((l=>l(d)))}))}renderHiddenVideoElement(l,d,u){return __awaiter$a(this,void 0,void 0,(function*(){let p,h=l.tsCall,g=h.mediaStreams;try{yield new Promise(((f,m)=>{p=h.changed((()=>{void 0!==g[0]&&g[0].length>0&&g[0][0].isAvailable&&(f(),null==p||p.dispose(),this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!0,callId:l.id,localParticipantId:d,runResultDetails:{successInfo:\"Call mediaStreams successful.\",subTestCorrelationId:u}}))})),setTimeout((()=>{this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!1,callId:l.id,localParticipantId:d,runResultDetails:{errorInfo:\"Call mediaStreams failed. Error: Timeout\",subTestCorrelationId:u}}),m(new CallingCommunicationError({message:\"Timeout in checking media stream status\",code:ve}))}),1e3*this._diagnosticsEcsConfig.CALL.MEDIASTREAM_TIMEOUT_IN_SEC)}));let f=h.mediaStreams[0][0],m=document.getElementById(\"_hiddenSelfRemoteStream\");m&&m.remove(),m=document.createElement(\"div\"),m.id=\"_hiddenSelfRemoteStream\",m.style.position=\"relative\",m.style.height=\"0px\",m.style.width=\"0px\";const v=document.createElement(\"div\");v.style.position=\"absolute\",v.style.height=this._diagnosticsEcsConfig.CALL.VIDEO_SIZE.heigth+\"px\",v.style.width=this._diagnosticsEcsConfig.CALL.VIDEO_SIZE.width+\"px\",v.style.bottom=\"0px\",v.style.left=\"-2000px\",m.appendChild(v),document.getElementsByTagName(\"body\")[0].appendChild(m),this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!0,callId:l.id,localParticipantId:d,runResultDetails:{successInfo:\"Video element rendering successful.\",subTestCorrelationId:u}}),yield f.start(v)}catch(p){this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!1,callId:l.id,localParticipantId:d,runResultDetails:{subTestCorrelationId:u,errorInfo:\"Call mediaStreams failed.\",exceptionInfo:getPrintableObject(p)}}),this._logger.warn(\"Failed to render hidden video element\")}}))}sineWaveAudioStream(){const l=new window.AudioContext,d=l.createMediaStreamDestination(),u=l.createOscillator();u.type=\"sine\",u.frequency.value=500,u.connect(d),u.start();const{stream:p}=d,h=p.getAudioTracks()[0];return new LocalAudioStream(h)}receiveAndPlayCallAudio(l,d,u){return __awaiter$a(this,void 0,void 0,(function*(){try{const d=new window.AudioContext,u=l.remoteAudioStreams[0],p=new MediaStream;p.addTrack(u.getMediaStreamTrack());d.createMediaStreamSource(p).connect(d.destination)}catch(p){this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!1,callId:l.id,localParticipantId:d,runResultDetails:{subTestCorrelationId:u,errorInfo:\"Call mediaStreams audio track failed.\",exceptionInfo:getPrintableObject(p)}}),this._logger.warn(\"Failed to send audio to call.\")}}))}getcallMediaStatistics(){return __awaiter$a(this,void 0,void 0,(function*(){return this._callMediaStatistics.promise}))}setEcsConfig(){var l,d;this._diagnosticsEcsConfig=null===(d=null===(l=getAcsEcsConfig())||void 0===l?void 0:l.calling)||void 0===d?void 0:d.callDiagnostics}getInCallDiagnostics(l){var d,u;return __awaiter$a(this,void 0,void 0,(function*(){const p=generateGuid();this.telemetryLogAttemptEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_attempt,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,runAttemptDetails:{info:\"In Call Diagnostics intiated.\"}}),this.setEcsConfig();const h={groupId:this._diagnosticsEcsConfig.CALL.GROUP_ID},g=yield this._internalDeviceManager.getCameras();let f,m=\"\";0!==g.length&&(f=[new LocalVideoStream(g[0])]);const v={videoOptions:{localVideoStreams:f},audioOptions:{muted:!1,localAudioStreams:[this.sineWaveAudioStream()]}};let y;try{y=yield null===(d=this._mainCallClient.callAgent)||void 0===d?void 0:d.getExistingCallAgentWithToken(l),y?this._internalCallClient.setCallAgent(y):(this._isCreatingNewCallAgent=!0,yield this._internalCallClient.createCallAgent(l)),this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!0,localParticipantId:m,runResultDetails:{successInfo:\"Create CallAgent successful.\",subTestCorrelationId:p}})}catch(l){this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!1,localParticipantId:m,runResultDetails:{subTestCorrelationId:p,errorInfo:\"Create CallAgent failed\",exceptionInfo:getPrintableObject(l)}}),this._logger.error(`Failed to get existing call agent or create a new one with error: ${l}`)}const S=null===(u=this._internalCallClient.callAgent)||void 0===u?void 0:u.join(h,v);if(S){try{yield this.waitCallConnected(S),m=S.tsCall.participantId,this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!0,callId:S.id,localParticipantId:m,runResultDetails:{successInfo:\"Call Connection successful.\",subTestCorrelationId:p}})}catch(l){this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!1,callId:S.id,localParticipantId:m,runResultDetails:{errorInfo:\"Call Connection failed.\",subTestCorrelationId:p}}),this._logger.error(`Test call failed to connect with error: ${l}`)}this.renderHiddenVideoElement(S,p,m),this.receiveAndPlayCallAudio(S,p,m);const l=S.feature(bu.MediaStats);this._callMediaStatistics.resolve(l);l.startCollector({aggregationInterval:this._diagnosticsEcsConfig.CALL.AGGREGATION.INTERVAL,dataPointsPerAggregation:this._diagnosticsEcsConfig.CALL.AGGREGATION.DATAPOINTS}).on(\"mediaStatsEmitted\",(l=>this.gatherCallStatistics(l)));try{yield sleep(1e3*this._diagnosticsEcsConfig.CALL.DURATION_IN_SEC),yield S.hangUp({forEveryone:!0}),this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!0,callId:S.id,localParticipantId:m,runResultDetails:{successInfo:`Call hangup successful. Result: ${getPrintableObject(this._inCallDiagnostics,this._printableObjectAll)}`,subTestCorrelationId:p}})}catch(l){this.telemetryLogInCallDiagnosticsResultEvents({eventName:kd.acs_calling_diagnostics_in_callDiagnostics_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.InCallDiagnostics,succeeded:!1,callId:S.id,localParticipantId:m,runResultDetails:{errorInfo:\"Call hangup failed.\",subTestCorrelationId:p}}),this._logger.error(`Test call failed hang up the call with error: ${l}`)}this.dispose()}return this._inCallDiagnostics}))}waitCallConnected(l){return __awaiter$a(this,void 0,void 0,(function*(){yield new Promise(((d,u)=>__awaiter$a(this,void 0,void 0,(function*(){l.on(\"stateChanged\",(()=>{\"Connected\"==l.state&&(this._inCallDiagnostics.connected=!0,d()),\"Disconnected\"==l.state&&u(\"Call disconnected\")}));const p=this._diagnosticsEcsConfig.CALL.CONNECT_TIMEOUT_IN_SEC;yield sleep(1e3*p),u({message:`Call timeout after ${p}`,code:Ce})}))))}))}qualityGrade(l,d,u){return l<=d?\"Good\":l>=u?\"Bad\":\"Average\"}bandwidthQualityGrade(l,d,u){return l>=d?\"Good\":l<=u?\"Bad\":\"Average\"}getQualityGradeForMetric(l,d,u){switch(l){case Su.JITTER:return u===_u.AUDIO?this.qualityGrade(d,this._diagnosticsEcsConfig.AUDIO.JITTER.GOOD,this._diagnosticsEcsConfig.AUDIO.JITTER.AVERAGE):this.qualityGrade(d,this._diagnosticsEcsConfig.VIDEO.JITTER.GOOD,this._diagnosticsEcsConfig.VIDEO.JITTER.AVERAGE);case Su.RTT:return u===_u.AUDIO?this.qualityGrade(d,this._diagnosticsEcsConfig.AUDIO.RTT.GOOD,this._diagnosticsEcsConfig.AUDIO.RTT.AVERAGE):this.qualityGrade(d,this._diagnosticsEcsConfig.VIDEO.RTT.GOOD,this._diagnosticsEcsConfig.VIDEO.RTT.AVERAGE);case Su.PACKETS_LOSS:return u===_u.AUDIO?this.qualityGrade(d,this._diagnosticsEcsConfig.AUDIO.PACKETS_LOSS_PERCENTAGE.GOOD,this._diagnosticsEcsConfig.AUDIO.PACKETS_LOSS_PERCENTAGE.AVERAGE):this.qualityGrade(d,this._diagnosticsEcsConfig.VIDEO.PACKETS_LOSS_PERCENTAGE.GOOD,this._diagnosticsEcsConfig.VIDEO.PACKETS_LOSS_PERCENTAGE.AVERAGE);case Su.BANDWIDTH:return this.bandwidthQualityGrade(d,this._diagnosticsEcsConfig.BANDWIDTH.GOOD,this._diagnosticsEcsConfig.BANDWIDTH.AVERAGE);default:return Cu}}gatherCallStatistics(l){var d,u,p,h,g,f,m,v,y,S,_,C,E,T,b,I,A,R,P,O,M,w,N,D,L,k,x,F,U,j,B,V,H,G,W,q,z,K,J,Q,Y,$,X,Z,ee,te;try{const ne=null===(u=null===(d=l.stats.audioRecvJitterMs)||void 0===d?void 0:d.aggregation)||void 0===u?void 0:u.sum[0],ie=null===(h=null===(p=l.stats.audioRecvJitterMs)||void 0===p?void 0:p.aggregation)||void 0===h?void 0:h.count[0];this._diagnosticsMediaTelemetry.jitter.audio.inbound=getRoundedAverage(ne,ie);const re=null===(f=null===(g=l.stats.audioSendJitterMs)||void 0===g?void 0:g.aggregation)||void 0===f?void 0:f.sum[0],oe=null===(v=null===(m=l.stats.audioSendJitterMs)||void 0===m?void 0:m.aggregation)||void 0===v?void 0:v.count[0];this._diagnosticsMediaTelemetry.jitter.audio.outbound=getRoundedAverage(re,oe);const ae=Math.max(null===(y=this._diagnosticsMediaTelemetry.jitter.audio)||void 0===y?void 0:y.inbound,null===(S=this._diagnosticsMediaTelemetry.jitter.audio)||void 0===S?void 0:S.outbound);this._inCallDiagnostics.diagnostics.audio.jitter=this.getQualityGradeForMetric(Su.JITTER,ae,_u.AUDIO);const se=null===(C=null===(_=l.stats.audioSendRtt)||void 0===_?void 0:_.aggregation)||void 0===C?void 0:C.sum[0],ce=null===(T=null===(E=l.stats.audioSendRtt)||void 0===E?void 0:E.aggregation)||void 0===T?void 0:T.count[0];this._diagnosticsMediaTelemetry.rtt.audio=getRoundedAverage(se,ce),this._inCallDiagnostics.diagnostics.audio.rtt=this.getQualityGradeForMetric(Su.JITTER,this._diagnosticsMediaTelemetry.rtt.audio,_u.AUDIO),this._diagnosticsMediaTelemetry.packets.audioSent=null===(I=null===(b=l.stats.audioSendPackets)||void 0===b?void 0:b.aggregation)||void 0===I?void 0:I.sum[0],this._diagnosticsMediaTelemetry.packets.audioSentLost=null===(R=null===(A=l.stats.audioSendPacketsLost)||void 0===A?void 0:A.aggregation)||void 0===R?void 0:R.sum[0],this._diagnosticsMediaTelemetry.packets.audioReceived=null===(O=null===(P=l.stats.audioRecvPackets)||void 0===P?void 0:P.aggregation)||void 0===O?void 0:O.sum[0],this._diagnosticsMediaTelemetry.packets.audioReceivedLost=null===(w=null===(M=l.stats.audioRecvPacketsLost)||void 0===M?void 0:M.aggregation)||void 0===w?void 0:w.sum[0];const le=this._diagnosticsMediaTelemetry.packets.audioSent-this._diagnosticsMediaTelemetry.packets.audioSentLost,de=this._diagnosticsMediaTelemetry.packets.audioReceived-this._diagnosticsMediaTelemetry.packets.audioReceivedLost,ue=Math.max(le,de)/this._diagnosticsMediaTelemetry.packets.audioSent*100;this._inCallDiagnostics.diagnostics.audio.packetLoss=this.getQualityGradeForMetric(Su.PACKETS_LOSS,ue,_u.AUDIO);const pe=null===(D=null===(N=l.stats.videoRecvJitterMs)||void 0===N?void 0:N.aggregation)||void 0===D?void 0:D.sum[0],he=null===(k=null===(L=l.stats.videoRecvJitterMs)||void 0===L?void 0:L.aggregation)||void 0===k?void 0:k.count[0];this._diagnosticsMediaTelemetry.jitter.video.inbound=getRoundedAverage(pe,he);const ge=null===(F=null===(x=l.stats.videoSendJitterMs)||void 0===x?void 0:x.aggregation)||void 0===F?void 0:F.sum[0],fe=null===(j=null===(U=l.stats.videoSendJitterMs)||void 0===U?void 0:U.aggregation)||void 0===j?void 0:j.count[0];this._diagnosticsMediaTelemetry.jitter.video.outbound=getRoundedAverage(ge,fe);const me=Math.max(this._diagnosticsMediaTelemetry.jitter.video.inbound,this._diagnosticsMediaTelemetry.jitter.video.outbound);this._inCallDiagnostics.diagnostics.video.jitter=this.getQualityGradeForMetric(Su.JITTER,me,_u.VIDEO);const ve=null===(V=null===(B=l.stats.videoSendRtt)||void 0===B?void 0:B.aggregation)||void 0===V?void 0:V.sum[0],ye=null===(G=null===(H=l.stats.videoSendRtt)||void 0===H?void 0:H.aggregation)||void 0===G?void 0:G.count[0];this._diagnosticsMediaTelemetry.rtt.video=getRoundedAverage(ve,ye),this._inCallDiagnostics.diagnostics.video.rtt=this.getQualityGradeForMetric(Su.RTT,this._diagnosticsMediaTelemetry.rtt.video,_u.VIDEO),this._diagnosticsMediaTelemetry.packets.videoSent=null===(q=null===(W=l.stats.videoSendPackets)||void 0===W?void 0:W.aggregation)||void 0===q?void 0:q.sum[0],this._diagnosticsMediaTelemetry.packets.videoSentLost=null===(K=null===(z=l.stats.videoSendPacketsLost)||void 0===z?void 0:z.aggregation)||void 0===K?void 0:K.sum[0],this._diagnosticsMediaTelemetry.packets.videoReceived=null===(Q=null===(J=l.stats.videoRecvPackets)||void 0===J?void 0:J.aggregation)||void 0===Q?void 0:Q.sum[0],this._diagnosticsMediaTelemetry.packets.videoReceivedLost=null===($=null===(Y=l.stats.videoRecvPacketsLost)||void 0===Y?void 0:Y.aggregation)||void 0===$?void 0:$.sum[0];const Se=this._diagnosticsMediaTelemetry.packets.videoSent-this._diagnosticsMediaTelemetry.packets.videoSentLost,_e=this._diagnosticsMediaTelemetry.packets.videoReceived-this._diagnosticsMediaTelemetry.packets.videoReceivedLost,Ce=Math.max(Se,_e)/this._diagnosticsMediaTelemetry.packets.videoSent*100;this._inCallDiagnostics.diagnostics.video.packetLoss=this.getQualityGradeForMetric(Su.PACKETS_LOSS,Ce,_u.VIDEO);const Ee=null===(Z=null===(X=l.stats.sentBWEstimate)||void 0===X?void 0:X.aggregation)||void 0===Z?void 0:Z.sum[0],Te=null===(te=null===(ee=l.stats.sentBWEstimate)||void 0===ee?void 0:ee.aggregation)||void 0===te?void 0:te.count[0];this._diagnosticsMediaTelemetry.bandWidth=getRoundedAverage(Ee,Te),this._inCallDiagnostics.bandWidth=this.getQualityGradeForMetric(Su.BANDWIDTH,this._diagnosticsMediaTelemetry.bandWidth,_u.AUDIO)}catch(l){const d=new CallingCommunicationError({message:\"Failed to get video call media stats\",code:Ie},l);this._logger.error(\"Failed to get audio call media stats\",l),this._callMediaStatistics.reject(d)}}deviceAccess(){return __awaiter$a(this,void 0,void 0,(function*(){const l=generateGuid();this.telemetryLogAttemptEvents({eventName:kd.acs_calling_diagnostics_device_access_attempt,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.DeviceAccess,runAttemptDetails:{info:\"Device Access initiated\"}});const d=this._internalDeviceManager.askDevicePermission({audio:!0,video:!0});try{const u=yield d;this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_device_access_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.DeviceAccess,succeeded:!0,runResultDetails:{successInfo:`Device Access successful. Result: ${getPrintableObject(u,this._printableObjectAll)}`,subTestCorrelationId:l}})}catch(d){this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_device_access_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.DeviceAccess,succeeded:!1,runResultDetails:{errorInfo:\"Device Access failed.\",subTestCorrelationId:l}})}return d}))}deviceEnumeration(){return __awaiter$a(this,void 0,void 0,(function*(){const l={microphone:Cu,camera:Cu,speaker:Cu},d=generateGuid();this.telemetryLogAttemptEvents({eventName:kd.acs_calling_diagnostics_device_enumeration_attempt,testName:Eu.DeviceEnumerations,diagnosticsTestRunId:this._currentTestRunId,runAttemptDetails:{info:\"Device Enumeration initiated.\"}});try{const u=0!==(yield this._internalDeviceManager.getMicrophones()).length,p=0!==(yield this._internalDeviceManager.getCameras()).length,h=0!==(yield this._internalDeviceManager.getSpeakers()).length;l.microphone=u?\"Available\":\"NotAvailable\",l.camera=p?\"Available\":\"NotAvailable\",l.speaker=h?\"Available\":\"NotAvailable\",this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_device_enumeration_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.DeviceEnumerations,succeeded:!0,runResultDetails:{successInfo:`Device Enumeration successful. Result: ${getPrintableObject(l,this._printableObjectAll)}`,subTestCorrelationId:d}})}catch(l){this.telemetryLogResultEvents({eventName:kd.acs_calling_diagnostics_device_enumeration_result,diagnosticsTestRunId:this._currentTestRunId,testName:Eu.DeviceEnumerations,succeeded:!1,runResultDetails:{errorInfo:\"Device Enumeration failed.\",subTestCorrelationId:d}}),this._logger.error(`Couldn't find mic, camera, or speaker: ${l}`)}return l}))}telemetryLogAttemptEvents(l){this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:{testName:l.testName,diagnosticsTestRunId:l.diagnosticsTestRunId,runAttemptDetails:l.runAttemptDetails}})}telemetryLogResultEvents(l){this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:{testName:l.testName,diagnosticsTestRunId:l.diagnosticsTestRunId,succeeded:l.succeeded,runResultDetails:l.runResultDetails}})}telemetryLogInCallDiagnosticsResultEvents(l){this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:{testName:l.testName,diagnosticsTestRunId:l.diagnosticsTestRunId,succeeded:l.succeeded,runResultDetails:l.runResultDetails,callId:l.callId||\"\",localParticipantId:l.localParticipantId}})}_sendFeatureUsage(l,d){sendCallClientFeatureUsageTelemetry({featureName:\"PreCallDiagnostics\",featureType:\"CallClient\",initializationType:\"OnExtendedObjectConstructor\",featureDetails:{name:l,step:d}},this._telemetryLogManager,this._logger)}dispose(){var l;this._isCreatingNewCallAgent&&(null===(l=this._internalCallClient.callAgent)||void 0===l||l.dispose())}}const bu={Recording:callFeatureFactory(RecordingCallFeatureImpl),Transfer:callFeatureFactory(TransferCallFeatureImpl),Transcription:callFeatureFactory(TranscriptionCallFeatureImpl),Captions:callFeatureFactory(CaptionsCallFeatureImpl),DominantSpeakers:callFeatureFactory(DominantSpeakersCallFeatureImpl),UserFacingDiagnostics:callFeatureFactory(UserFacingDiagnosticsFeatureImpl),MediaStats:callFeatureFactory(MediaStatsCallFeatureImpl,{activationEvent:\"OnExtendedObjectConstructor\"}),DebugInfo:callClientFeatureFactory(DebugInfoCallClientFeatureImpl,{activationEvent:\"OnExtendedObjectConstructor\"}),PreCallDiagnostics:callClientFeatureFactory(PreCallDiagnosticsFeatureImpl,{activationEvent:\"OnExtendedObjectConstructor\"})},Iu=[];function registerFeature(l){Iu.push(l)}for(const l of Object.entries(bu))registerFeature(l[1]);var __decorate$7=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$7=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)};class RemoteAudioStream{constructor(l){const u=d.createClientLogger(\"ACS\");if(this.logger=new DefaultLogger(u,[()=>\"RemoteAudioStream for media stream\"]),!(l instanceof MediaStreamTrack))throw new CallingCommunicationError({message:\"Failed to create remote audio stream, source is not of type of MediaStreamTrack\",code:be});this._source=l,this._disposed=!1,this.logger.info(\"created\")}getMediaStreamTrack(){return this._source}dispose(){this.logger.log(\"dispose\"),this._disposed?this.logger.log(\"already disposed\"):this._disposed=!0}}__decorate$7([loggerProperty,__metadata$7(\"design:type\",Object)],RemoteAudioStream.prototype,\"logger\",void 0);var __decorate$8=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$8=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$b=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class CallImpl{constructor(l,d,u,p){var h;this._callAgent=d,this._lastTsCallState=0,this._state=\"None\",this._isMuted=!1,this._isIncomingAudioMuted=!1,this._isSpeakerMuted=!1,this._isDeviceNotFunctioningMuted=!1,this._isServerMuted=!1,this._isMicrophoneMuted=!1,this._isScreenSharingOn=!1,this._totalParticipantCount=1,this.tsToAcsCallStateMap={0:\"None\",2:\"Connecting\",3:\"Connected\",4:\"LocalHold\",5:\"RemoteHold\",10:\"InLobby\",9:\"EarlyMedia\",6:\"Disconnecting\",7:\"Disconnected\"},this._disposed=!1,this._localVideoStreams=[],this._localAudioStreams=[],this._remoteAudioStreams=[],this._remoteParticipants=[],this._getCallEndReason=()=>{let l=0,d=0,u=\"Unknown\";this.tsCall&&(l=this.tsCall.callEndDiagnosticsInfo&&this.tsCall.callEndDiagnosticsInfo.callControllerCode||0,d=this.tsCall.callEndDiagnosticsInfo&&this.tsCall.callEndDiagnosticsInfo.callControllerSubCode||0,u=convertTerminatedReasonToString(this.tsCall.terminatedReason));const p={code:l,subCode:d};return this.logger[0===l?\"info\":\"error\"](`Call end reason=${u}, code=${l}, subCode=${d}`),p},this._handleCallOperationFailure=l=>{let d,u=0,p=0;return this.tsCall&&(u=this.tsCall.callEndDiagnosticsInfo?this.tsCall.callEndDiagnosticsInfo.callControllerCode||Ie:0,p=this.tsCall.callEndDiagnosticsInfo&&this.tsCall.callEndDiagnosticsInfo.callControllerSubCode||0),d=convertTerminatedReasonToString(l),this.logger.error(`Call operation failure=${d}, code=${u}, subCode=${p}`),new CallingCommunicationError({message:d,code:u,subCode:p},l)},this._handleParticipantOperationFailure=l=>{const d=convertParticipantStateReasonToString(l);return this.logger.error(`Participant operation failure=${d}`),new CallingCommunicationError({message:d,code:Ie,subCode:0},l)},this._handleMuteChanges=()=>{const l=this.tsCall.conversationType?!!(this._isMicrophoneMuted||this._isServerMuted||this._isDeviceNotFunctioningMuted):!(!this._isMicrophoneMuted&&!this._isDeviceNotFunctioningMuted);if(this._isMuted!=l){this.logger.info(`isMuted changed from ${this._isMuted} to ${l}`);let d=[];this._isMicrophoneMuted&&d.push(\"isMicrophoneMuted\"),this._isServerMuted&&d.push(\"isServerMuted\"),this._isDeviceNotFunctioningMuted&&d.push(\"isDeviceNotFunctioningMuted\");let u=\"\";d.length>=1&&(u=d.join(\", \")),this.sendCallProgressEvent({eventName:kd.acs_calling_call_progress,timestampInfo:{attemptTimestamp:+new Date},step:\"isMuted-changed\",additionalProperties:{oldIsMuted:this._isMuted,newIsMuted:l,reason:u}}),this._isMuted=l,this._eventEmitter.emit(\"isMutedChanged\")}},this._handleIncomingAudioMuteChanges=()=>{const l=this._isSpeakerMuted;this._isIncomingAudioMuted!=l&&(this.logger.info(`newIncomingAudioMuted changed from ${this._isIncomingAudioMuted} to ${l}`),this.sendCallProgressEvent({eventName:kd.acs_calling_call_progress,timestampInfo:{attemptTimestamp:+new Date},step:\"isIncomingAudioMuted-changed\",additionalProperties:{oldIsMuted:this._isIncomingAudioMuted,newIsMuted:l,reason:\"\"}}),this._isIncomingAudioMuted=l,this._eventEmitter.emit(\"isIncomingAudioMutedChanged\"))},this._handleCallingApplicationIdentifier=l=>{this._isClosedCaptionsBot(l)&&this.logger.info(\"Handle participant: Ignore closed captions application\")},this._isClosedCaptionsBot=l=>\"28:b1902c3e-b9f7-4650-9b23-5772bd429747\"===l.id,this._id=l.callId,this.tsCall=u,this._direction=l.isIncoming?\"Incoming\":\"Outgoing\",this.logger=this._callAgent.logger.createChild((()=>`Call:${this._id}:${this._state}`)),this._telemetryLogManager=p,this.stats=new CallStats(this.logger,this._telemetryLogManager),this._eventEmitter=new CallingEventEmitter(this.logger),this._info=new CallInfoImpl(u),this.activeRemoteVideoStreamViews=new Map,this._extensibleApi=new ExtensibleFeatureImpl(this.logger,{call:this,callAgent:this._callAgent},{tsCall:this.tsCall,callAgent:this._callAgent,call:this,telemetryLogManager:this._telemetryLogManager});for(const l of Iu)l.isCallFeature&&\"OnExtendedObjectConstructor\"===l.activationOptions.activationEvent&&this.feature(l);this._mediaMetricsDeviceEvents={},getAcsEcsConfig().calling.mediaMetricsDeviceEventsEnabled&&(this._dmDevicesChangedSub=null===(h=this._callAgent.tsStack)||void 0===h?void 0:h.getDeviceManager().on(\"devicesChanged\",(()=>{this.setOrUpdateMediaMetricsDeviceEvents()})))}get id(){return this._id}get callerInfo(){return{identifier:this._callerIdentity,displayName:this._callerDisplayName}}get state(){return this._state}get direction(){return this._direction}get isMuted(){return this._isMuted}get isIncomingAudioMuted(){return this._isIncomingAudioMuted}get isScreenSharingOn(){return this._isScreenSharingOn}get callEndReason(){return this._callEndReason}get localVideoStreams(){return this._localVideoStreams}get localAudioStreams(){return this._localAudioStreams}get remoteAudioStreams(){var l,d;const u=generateGuid(),p=+new Date;if(this.sendMediaAccessEvent({eventName:kd.acs_calling_get_remote_audio_stream_track_attempt,timestampInfo:{attemptTimestamp:p},correlationId:u,step:\"mid-call\"}),this._remoteAudioStreams.length>0||3!=this.tsCall.state)return this.sendMediaAccessEvent({eventName:kd.acs_calling_get_remote_audio_stream_track_success,timestampInfo:{deltaTimeInMs:+new Date-p},correlationId:u,step:\"mid-call\"}),this._remoteAudioStreams;if(!getAcsEcsConfig().calling.allowAccessRawMediaStream||!(null===(l=this.tsCall)||void 0===l?void 0:l.getRawOutputAudioStreamTrack)){const l=new CallingCommunicationError({message:\"Failed to get raw output audio stream track\",code:Ie});this.logger.error(\"Failed to get raw output audio stream track\");const d=+new Date;return this.sendMediaAccessEvent({eventName:kd.acs_calling_get_remote_audio_stream_track_failure,timestampInfo:{deltaTimeInMs:d-p},correlationId:u,step:\"mid-call\"},l),[]}let h=null===(d=this.tsCall)||void 0===d?void 0:d.getRawOutputAudioStreamTrack();const g=+new Date;return this.sendMediaAccessEvent({eventName:h?kd.acs_calling_get_remote_audio_stream_track_success:kd.acs_calling_get_remote_audio_stream_track_failure,timestampInfo:{deltaTimeInMs:g-p},correlationId:u,step:\"mid-call\"}),this._remoteAudioStreams.push(new RemoteAudioStream(h)),this._eventEmitter.emit(\"remoteAudioStreamsUpdated\",{added:this._remoteAudioStreams,removed:[]}),this._remoteAudioStreams}get remoteParticipants(){return this._remoteParticipants}get info(){return this._info}get totalParticipantCount(){return this._totalParticipantCount}feature(l){return this._extensibleApi.getApiObjectInstance(l.callApiCtor)}bindTsCall(){var l,d,u;void 0!==this.tsCall.callerMri&&(this._callerIdentity=constructIdentifierKindFromMri(this.tsCall.callerMri),this._callerDisplayName=null===(l=this.tsCall.participants.find((l=>l.id===this.tsCall.callerMri)))||void 0===l?void 0:l.displayName),this._lastTsCallState=this.tsCall.state,this.mapTsCallState(this.tsCall.state),this.tsCall.changed((()=>{this.tsCall.callId!==this._id&&(this.logger.log(`tsCall callId changed=${this.tsCall.callId}`),this.sendCallProgressEvent({eventName:kd.acs_calling_call_progress,timestampInfo:{attemptTimestamp:+new Date},step:\"id-changed\",additionalProperties:{oldCallId:this._id,newCallId:this.tsCall.callId}}),this._id=this.tsCall.callId,this._eventEmitter.emit(\"idChanged\")),this.tsCall.state!==this._lastTsCallState&&(this.logger.log(`tsCall state changed=${this.tsCall.state}`),this._lastTsCallState=this.tsCall.state,this.mapTsCallState(this.tsCall.state)),this._isScreenSharingOn!==this.tsCall.isScreenSharingOn&&(this.logger.log(`tsCall isScreenSharingOn changed=${this.tsCall.isScreenSharingOn}`),this._isScreenSharingOn=this.tsCall.isScreenSharingOn,this._eventEmitter.emit(\"isScreenSharingOnChanged\")),this._isMicrophoneMuted!==this.tsCall.isMuted&&(this.logger.log(`tsCall _isMicrophoneMuted changed=${this.tsCall.isMuted}`),this._isMicrophoneMuted=this.tsCall.isMuted,this._handleMuteChanges()),this._isSpeakerMuted!==this.tsCall.isSpeakerMuted&&(this.logger.log(`tsCall _isSpeakerMuted changed=${this.tsCall.isSpeakerMuted}`),this._isSpeakerMuted=this.tsCall.isSpeakerMuted,this._handleIncomingAudioMuteChanges())})),this._isServerMuted=this.tsCall.isServerMuted,this.tsCall.on(\"serverMutedChanged\",(()=>{this.tsCall.isServerMuted!==this._isServerMuted&&(this.logger.log(`tsCall isServerMuted changed=${this.tsCall.isServerMuted}`),this._isServerMuted=this.tsCall.isServerMuted,this._handleMuteChanges())})),this.tsCall.participantCounts&&(this._totalParticipantCount=this.tsCall.participantCounts.totalParticipants),this.tsCall.on(\"participantCountsUpdated\",(()=>{if(this.tsCall.participantCounts&&this._totalParticipantCount!==this.tsCall.participantCounts.totalParticipants){const l=this._totalParticipantCount;this._totalParticipantCount=this.tsCall.participantCounts.totalParticipants,this.logger.log(`tsCall totalParticipantCount changed from ${l} to ${this._totalParticipantCount}`),this._eventEmitter.emit(\"totalParticipantCountChanged\");try{this.stats.recordEvent({name:Ld.number_of_participants,callId:this.id,localParticipantId:this.tsCall.participantId,data:{totalParticipantCount:this._totalParticipantCount,previousParticipantCount:l}})}catch(l){this.logger.error(\"failed to send participant count change telemetry\")}}})),this.tsCall.on(\"callQualityChanged\",(l=>__awaiter$b(this,void 0,void 0,(function*(){var d,u,p,h,g,f;try{let m;m=5===l.type||32===l.type||2===l.type||1===l.type||37===l.type?Ld.network_quality:44===l.type||43===l.type||9===l.type||25===l.type||27===l.type||45===l.type||33===l.type||34===l.type||55===l.type||26===l.type||47===l.type?Ld.video_device_issue:Ld.other_diagnostic,3===l.value||2===l.value?(this.logger.warn(`Ufd error raised!, ufd=${l.type}, value=${l.value}, kind=${m}`),m===Ld.network_quality&&window.dispatchEvent(new CustomEvent(\"online\",{detail:!1}))):(this.logger.warn(`Ufd error recovered!, ufd=${l.type}, value=${l.value}, kind=${m}`),m===Ld.network_quality&&window.dispatchEvent(new CustomEvent(\"online\",{detail:!0})));const v={type:l.type.toString(),level:l.value,mediaType:l.mediaType};if(this.stats.recordEvent({name:m,callId:this.id,localParticipantId:this.tsCall.participantId,data:v}),this.shallStopVideo(l)){const d=+new Date,u=generateGuid();this.logger.warn(`Attempting to stop video gracefully due to video ufd being raised.UFD: ${l.type}, value: ${l.value}, call direction: ${this._direction}`),this.sendAudioEvent({eventName:kd.acs_calling_stop_video_on_ufd_attempt,timestampInfo:{attemptTimestamp:d},correlationId:u,step:\"mid-call\"});try{this.stopVideo(this.localVideoStreams[0])}catch(d){const u=`Failed to stop video on video device start failed or capture mute event ${l.type} with value ${l.value}`;this.logger.error(u)}}if(this.shallRemoveLocalVideoStreamOnBadUfd(l)){this.removeLocalVideoStream(this.localVideoStreams[0]);const d=new CallingCommunicationError({message:`Removing local video stream due to video fail UFD beign raised before call connected. UFD: ${l.type}, value: ${l.value}, call direction: ${this._direction}`,code:Ee});this.logger.error(d.message)}if(this.shallStopAudio(l)){const m=+new Date,v=generateGuid();if((null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling)||void 0===u?void 0:u.allowMuteOnBadUfd)&&!this.tsCall.isMuted){this.sendAudioEvent({eventName:kd.acs_calling_mute_on_ufd_attempt,timestampInfo:{attemptTimestamp:m},correlationId:v,step:\"mid-call\"});try{yield this.mute()}catch(d){const u=`Failed to mute on microphone device not functioning or capture mute event ${l.type} with value ${l.value}`;this.logger.error(u)}}if(null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.calling)||void 0===h?void 0:h.preventStopAudio)return this.sendAudioEvent({eventName:kd.acs_calling_prevent_stop_audio,timestampInfo:{attemptTimestamp:m},correlationId:v,step:\"mid-call\"}),void(!(null===(f=null===(g=getAcsEcsConfig())||void 0===g?void 0:g.calling)||void 0===f?void 0:f.preventFakeMute)&&this.markCallMuted());this.sendAudioEvent({eventName:kd.acs_calling_stop_audio_attempt,timestampInfo:{attemptTimestamp:m},correlationId:v,step:\"mid-call\"});try{yield this.tsCall.stopAudio(),this.markCallMuted();const l=+new Date;this.sendAudioEvent({eventName:kd.acs_calling_stop_audio_success,timestampInfo:{deltaTimeInMs:l-m},correlationId:v,step:\"mid-call\"})}catch(d){const u=`Failed to stop audio on microphone device not functioning or capture mute event ${l.type} with value ${l.value}`,p=new CallingCommunicationError({message:u,code:ve},d);this.logger.error(u);const h=+new Date;this.sendAudioEvent({eventName:kd.acs_calling_stop_audio_failure,timestampInfo:{deltaTimeInMs:h-m},correlationId:v,step:\"mid-call\"},p)}}this.audioDidAutoRecover(l)&&(this._isDeviceNotFunctioningMuted=!1,this._handleMuteChanges())}catch(l){this.logger.error(\"Failed to send ufd telemetry\")}})))),this.tsCall.on(\"participantAdded\",(l=>__awaiter$b(this,void 0,void 0,(function*(){var d;this.logger.debug(\"tsCall participant added\");const u=[];null===(d=l.endpoints)||void 0===d||d.endpointDetails.forEach((l=>u.push(l.participantId))),0===u.length&&u.push(\"remoteParticipantId unavailable\");const p=constructIdentifierKindFromMri(l.id);if(this.sendParticipantAddedOrRemovedEvent(!0,u),isCallingApplication(l.id))return this.logger.info(\"Add participant: Handle calling application\"),void this._handleCallingApplicationIdentifier(l);this._handleRemoteRingingForOutgoingCall(l);try{const d=this.getOrCreateRemoteParticipant(p);d.observeParticipant(l),this._eventEmitter.emit(\"remoteParticipantsUpdated\",{added:[d],removed:[]})}catch(l){this.logger.log(\"unable to map call participant to ACS user\")}})))),this.logger.debug(`tsCall current participant count=${null===(u=null===(d=this.tsCall)||void 0===d?void 0:d.participants)||void 0===u?void 0:u.length}`),this.tsCall.participants.forEach((l=>{const d=constructIdentifierKindFromMri(l.id),u=this.getOrCreateRemoteParticipant(d);this._handleRemoteRingingForOutgoingCall(l),u.observeParticipant(l)})),this.tsCall.on(\"participantRemoved\",(l=>__awaiter$b(this,void 0,void 0,(function*(){var d;this.logger.debug(\"tsCall participant removed\");const u=[];if(null===(d=l.endpoints)||void 0===d||d.endpointDetails.forEach((l=>u.push(l.participantId))),0===u.length&&u.push(\"remoteParticipantId unavailable\"),this.sendParticipantAddedOrRemovedEvent(!1,u),isCallingApplication(l.id))return void this.logger.info(\"Remove participant: Ignore calling application\");const p=l.id;if(p){const d=this._remoteParticipants.find((l=>getMriFromIdentifier(l.identifier)===p));d?(0!==l.stateReason&&d.setCallEndReason(this._getTsParticipantCallEndReason(l)),this._remoteParticipants.splice(this._remoteParticipants.indexOf(d),1),this._eventEmitter.emit(\"remoteParticipantsUpdated\",{added:[],removed:[d]})):this.logger.log(\"unable to find participant to remove\")}}))))}markCallMuted(){this._isDeviceNotFunctioningMuted=!0,this._handleMuteChanges()}sendParticipantAddedOrRemovedEvent(l,d){try{this._telemetryLogManager.sendEvent({name:kd.acs_calling_participant_added_or_removed,tenant:q,properties:{callId:this.id,remotePerticipantId:d||\"\",participantAddedOrRemoved:l?\"added\":\"removed\",localParticipantId:this.tsCall.participantId}})}catch(l){this.logger.debug(\"Unable to send participant added telemtery\")}}_getTsParticipantCallEndReason(l){let d=0,u=0,p=\"Unknown\";if(l){if(l.callEndDiagnosticsInfo)d=l.callEndDiagnosticsInfo&&l.callEndDiagnosticsInfo.callControllerCode||0,u=l.callEndDiagnosticsInfo&&l.callEndDiagnosticsInfo.callControllerSubCode||0;else{const l=this._getCallEndReason();d=l.code,u=l.subCode||0}p=convertParticipantStateReasonToString(l.stateReason)}return this.logger[0===d?\"info\":\"error\"](`Participant call end reason=${p}, code=${d}, subCode=${u}`),{code:d,subCode:u}}startCallInternal(l,d,u){var p,h,g;return __awaiter$b(this,void 0,void 0,(function*(){let f,m,v,y;const S=+new Date,_=generateGuid(),C={joinContextDescription:getJoinContextDescription(u),additionalProperties:{EmergencyCountryCode:(null===(p=this._callAgent._caConfigBag)||void 0===p?void 0:p.emergencyCountryCode)||\"\",IsUserEmergencyCountryCode:(null===(h=this._callAgent._caConfigBag)||void 0===h?void 0:h.IsUserEmergencyCountryCode)||!1,trouterState:this._callAgent.getTrouterState()}};this.sendCallStageEvent({eventName:kd.acs_calling_call_attempt,correlationId:_,timestampInfo:{attemptTimestamp:S},additionalPayload:C});try{f=!!(null===(g=null==l?void 0:l.audioOptions)||void 0===g?void 0:g.muted),void 0===f&&(f=!1),this._isMicrophoneMuted=f,(null==l?void 0:l.alternateCallerId)&&(y=getMriFromIdentifier(l.alternateCallerId)),m=this.getLocalVideoStreamFromCallOptions(l),this.setLocalVideoStream(m),v=this.getLocalAudioStreamFromCallOptions(l),this.setLocalAudioStream(v)}catch(l){const d=+new Date,u=new CallingCommunicationError({message:\"Failed to instantiate the Call.\",code:Ie},l);throw this.sendCallStageEvent({eventName:kd.acs_calling_call_failed,correlationId:_,timestampInfo:{deltaTimeInMs:d-S},additionalPayload:C},u),this.logger.error(u.message),u}try{m&&this.sendVideoEvent({correlationId:_,eventName:kd.acs_calling_start_video_attempt,timestampInfo:{attemptTimestamp:S},localVideoStream:m,step:\"start\"}),d?yield this.tsCall.startWithMeetingData(A.generateCauseId(),{withVideo:!!m,muted:f,ringOthers:!0,alternateId:y,shouldResurrect:\"resurrect\",forceAudioSendModalityWithNullStream:!!v}):yield this.tsCall.start({withVideo:!!m,muted:f,ringOthers:!0,alternateId:y,forceAudioSendModalityWithNullStream:!!v});const l=+new Date;this.sendCallStageEvent({eventName:kd.acs_calling_call_connected,correlationId:_,timestampInfo:{deltaTimeInMs:l-S},additionalPayload:C}),m&&this.shallRemoveLvsAfterConnectedSuccessfully(m,\"start\",_,l,S),v&&(yield this.audioSourceChanged({source:v}),this.shallRemoveLasAfterConnectedSuccessfully(v,\"start\",_,l,S))}catch(l){const d=+new Date,u=this._handleCallOperationFailure(l);throw m&&(this.sendVideoEvent({correlationId:_,eventName:kd.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:d-S},localVideoStream:m,step:\"start\"},u),this.removeLocalVideoStream(m)),v&&this.removeLocalAudioStream(v),this.sendCallStageEvent({eventName:kd.acs_calling_call_failed,correlationId:_,timestampInfo:{deltaTimeInMs:d-S},additionalPayload:C},u),this.logger.error(`Failed to start the call, code=${null==u?void 0:u.code}, subCode=${null==u?void 0:u.subCode}`),u}}))}shallRemoveLvsAfterConnectedSuccessfully(l,d,u,p,h){var g,f;if(this.tsCall.localMediaStreams.find((l=>1===l.mediaType)))this.sendVideoEvent({correlationId:u,eventName:kd.acs_calling_start_video_success,timestampInfo:{deltaTimeInMs:p-h},localVideoStream:l,step:d});else{if(!(null===(f=null===(g=getAcsEcsConfig())||void 0===g?void 0:g.calling)||void 0===f?void 0:f.removeLvsCheckOnCallStartAndCallAccept))return;this.removeLocalVideoStream(this.localVideoStreams[0]);const p=+new Date;this.logger.error(`Removing local video stream because video failed to start during call-${d} process.`),this.sendVideoEvent({correlationId:u,eventName:kd.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:p-h},localVideoStream:l,step:d},new CallingCommunicationError({message:`Video failed to start during call-${d} process.`,code:ve}))}}shallRemoveLasAfterConnectedSuccessfully(l,d,u,p,h){if(this.tsCall.localMediaStreams.find((l=>0===l.mediaType)))this.sendMediaAccessEvent({correlationId:u,eventName:kd.acs_calling_start_audio_success,timestampInfo:{deltaTimeInMs:p-h},localAudioStream:l,step:d});else{if(!getAcsEcsConfig().calling.removeLocalAudioStreamCheckOnCallStartAndCallAccept)return;this.removeLocalAudioStream(this.localAudioStreams[0]);const p=+new Date;this.logger.error(`Removing local audio stream because audio failed to start during call-${d} process.`),this.sendMediaAccessEvent({correlationId:u,eventName:kd.acs_calling_start_audio_failure,timestampInfo:{deltaTimeInMs:p-h},localAudioStream:l,step:d},new CallingCommunicationError({message:`Audio failed to start during call-${d} process.`,code:ve}))}}sendCallStageEvent(l,d){var u,p,h,g,f,m;try{const v=d instanceof CallingCommunicationError?d.message:\"\";let y;d&&(y=(null===(u=null==this?void 0:this.tsCall)||void 0===u?void 0:u.callEndDiagnosticsInfo)||{});const S=Object.assign({localParticipantId:(null===(p=null==this?void 0:this.tsCall)||void 0===p?void 0:p.participantId)||\"\",callId:(null===(h=null==this?void 0:this.tsCall)||void 0===h?void 0:h.callId)||\"\",callType:(null===(g=null==this?void 0:this.tsCall)||void 0===g?void 0:g.callType)||\"\",callDirection:this._direction,failureReason:v,callEndDiagnosticsInfo:y,groupJoin:!!(null===(f=null==this?void 0:this.tsCall)||void 0===f?void 0:f.groupId),meetingJoin:!!(null===(m=null==this?void 0:this.tsCall)||void 0===m?void 0:m.meetingInfo),correlationId:l.correlationId,timestampInfo:l.timestampInfo},l.additionalPayload);this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:S})}catch(l){}}sendCallProgressEvent(l,d){var u,p,h,g,f,m;try{const v=d instanceof CallingCommunicationError?d.message:\"\",y=this.tsToAcsCallStateMap[this.tsCall.state]?this.tsToAcsCallStateMap[this.tsCall.state]:`unmapped TsCall state at acs layer: ${JSON.stringify(this.tsCall.state)}`;let S;d&&(S=(null===(u=null==this?void 0:this.tsCall)||void 0===u?void 0:u.callEndDiagnosticsInfo)||{});const _=l.additionalProperties;getAcsEcsConfig().telemetry.gzipTelemetryPayload&&(_.diagnosticInfo?(_.diagnosticInfo.telemetryPayloadBytesOriginal=TelemetryLogManager.telemetryPayloadBytesOriginal,_.diagnosticInfo.telemetryPayloadBytesCompressed=TelemetryLogManager.telemetryPayloadBytesCompressed):_.diagnosticInfo={telemetryPayloadBytesOriginal:TelemetryLogManager.telemetryPayloadBytesOriginal,telemetryPayloadBytesCompressed:TelemetryLogManager.telemetryPayloadBytesCompressed},\"Connecting\"===_.newState&&(TelemetryLogManager.telemetryPayloadBytesOriginal=0,TelemetryLogManager.telemetryPayloadBytesCompressed=0));const C=Object.assign({localParticipantId:(null===(p=null==this?void 0:this.tsCall)||void 0===p?void 0:p.participantId)||\"\",callId:(null===(h=null==this?void 0:this.tsCall)||void 0===h?void 0:h.callId)||\"\",callType:(null===(g=null==this?void 0:this.tsCall)||void 0===g?void 0:g.callType)||\"\",callDirection:this._direction,failureReason:v,callEndDiagnosticsInfo:S,groupJoin:!!(null===(f=null==this?void 0:this.tsCall)||void 0===f?void 0:f.groupId),meetingJoin:!!(null===(m=null==this?void 0:this.tsCall)||void 0===m?void 0:m.meetingInfo),step:l.step,timestampInfo:l.timestampInfo,state:y},l.additionalProperties);this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:C})}catch(l){}}accept(l={}){return __awaiter$b(this,void 0,void 0,(function*(){if(1!==this.tsCall.state)throw new CallingCommunicationError({message:'Call cannot be accepted because call state is not \"Notified\"',code:ve});const d=+new Date,u=generateGuid();this.sendCallStageEvent({eventName:kd.acs_calling_call_accept_attempt,correlationId:u,timestampInfo:{attemptTimestamp:d}});const p=this.getLocalVideoStreamFromCallOptions(l);this.setLocalVideoStream(p);const h=this.getLocalAudioStreamFromCallOptions(l);return this.setLocalAudioStream(h),p&&this.sendVideoEvent({eventName:kd.acs_calling_start_video_attempt,timestampInfo:{attemptTimestamp:d},correlationId:u,step:\"accept\"}),this.tsCall.accept({withVideo:!!p,forceAudioSendModalityWithNullStream:!!h}).then((()=>__awaiter$b(this,void 0,void 0,(function*(){const l=+new Date;p&&this.shallRemoveLvsAfterConnectedSuccessfully(p,\"accept\",u,l,d),h&&(yield this.audioSourceChanged({source:h}),this.shallRemoveLasAfterConnectedSuccessfully(h,\"accept\",u,l,d)),this.sendCallStageEvent({eventName:kd.acs_calling_call_accept_connected,correlationId:u,timestampInfo:{deltaTimeInMs:l-d}})})))).catch((l=>{const g=+new Date,f=this._handleCallOperationFailure(l);this.sendCallStageEvent({eventName:kd.acs_calling_call_accept_failed,correlationId:u,timestampInfo:{deltaTimeInMs:g-d}},f),p&&(this.sendVideoEvent({correlationId:u,eventName:kd.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:g-d},localVideoStream:p,step:\"accept\"},f),this.removeLocalVideoStream(p)),h&&this.removeLocalAudioStream(h)})),this}))}reject(){return __awaiter$b(this,void 0,void 0,(function*(){const l=+new Date,d=generateGuid();if(this.sendCallStageEvent({eventName:kd.acs_calling_call_reject_attempt,correlationId:d,timestampInfo:{attemptTimestamp:l}}),1!==this.tsCall.state){const u=new CallingCommunicationError({message:\"Call cannot be rejectd because it is not incoming.\",code:ve}),p=+new Date;throw this.sendCallStageEvent({eventName:kd.acs_calling_call_reject_failed,correlationId:d,timestampInfo:{deltaTimeInMs:p-l}},u),u}return this.tsCall.reject().then((()=>{const u=+new Date;this.sendCallStageEvent({eventName:kd.acs_calling_call_reject_success,correlationId:d,timestampInfo:{deltaTimeInMs:u-l}})})).catch((u=>{const p=+new Date;throw this.sendCallStageEvent({eventName:kd.acs_calling_call_reject_failed,correlationId:d,timestampInfo:{deltaTimeInMs:p-l}},u),this._handleCallOperationFailure(u)}))}))}mute(){return __awaiter$b(this,void 0,void 0,(function*(){const l=this.logger.createFnLogger(Qa.Mute),d=+new Date,u=generateGuid();this.sendAudioEvent({eventName:kd.acs_calling_mute_attempt,eventType:Fd.MuteMicrophone,timestampInfo:{attemptTimestamp:d},correlationId:u,step:\"mid-call\"});try{l.info(\"mute\"),yield this.tsCall.mute(),l.info(\"mute success\");const p=+new Date;this.sendAudioEvent({eventName:kd.acs_calling_mute_success,eventType:Fd.MuteMicrophone,timestampInfo:{deltaTimeInMs:p-d},correlationId:u,step:\"mid-call\"})}catch(p){const h=new CallingCommunicationError({message:\"Failed to mute microphone\",code:ve});l.error(\"Failed to mute microphone\");const g=+new Date;throw this.sendAudioEvent({eventName:kd.acs_calling_mute_failure,eventType:Fd.MuteMicrophone,timestampInfo:{deltaTimeInMs:g-d},correlationId:u,step:\"mid-call\"},h),h}}))}unmute(){var l,d;return __awaiter$b(this,void 0,void 0,(function*(){const u=this.logger.createFnLogger(Qa.Unmute),p=+new Date,h=generateGuid();let g=!1;this.sendAudioEvent({eventName:kd.acs_calling_unmute_attempt,eventType:Fd.UnmuteMicrophone,timestampInfo:{attemptTimestamp:p},correlationId:h,step:\"mid-call\"});try{u.info(\"unmute\"),yield this.tsCall.unmute(),u.info(\"unmute success\");const f=+new Date;this.sendAudioEvent({eventName:kd.acs_calling_unmute_success,eventType:Fd.UnmuteMicrophone,timestampInfo:{deltaTimeInMs:f-p},correlationId:h,step:\"mid-call\"});const m=+new Date;if(!(null===(d=null===(l=getAcsEcsConfig())||void 0===l?void 0:l.calling)||void 0===d?void 0:d.preventStopAudio)&&this._isDeviceNotFunctioningMuted){this.sendAudioEvent({eventName:kd.acs_calling_start_audio_attempt,timestampInfo:{attemptTimestamp:m},correlationId:h,step:\"mid-call\"}),g=!0,u.info(\"start audio\"),yield this.tsCall.startAudio(),u.info(\"start audio success\");const l=+new Date;this._isDeviceNotFunctioningMuted=!1,this._handleMuteChanges(),this.sendAudioEvent({eventName:kd.acs_calling_start_audio_success,timestampInfo:{deltaTimeInMs:l-m},correlationId:h,step:\"mid-call\"})}}catch(l){const d=g?\"Failed to unmute and start audio, microphone device not functioning\":\"Failed to unmute microphone\",f=new CallingCommunicationError({message:d,code:ve},l);u.error(d);const m=+new Date;throw this.sendAudioEvent({eventName:g?kd.acs_calling_start_audio_failure:kd.acs_calling_unmute_failure,eventType:g?void 0:Fd.UnmuteMicrophone,timestampInfo:{deltaTimeInMs:m-p},correlationId:h,step:\"mid-call\"},f),f}}))}muteIncomingAudio(){return __awaiter$b(this,void 0,void 0,(function*(){const l=this.logger.createFnLogger(Qa.MuteIncomingAudio),d=+new Date,u=generateGuid();this.sendAudioEvent({eventName:kd.acs_calling_mute_attempt,eventType:Fd.MuteIncomingAudio,timestampInfo:{attemptTimestamp:d},correlationId:u,step:\"mid-call\"});try{yield this.tsCall.muteSpeaker();const l=+new Date;this.sendAudioEvent({eventName:kd.acs_calling_mute_success,eventType:Fd.MuteIncomingAudio,timestampInfo:{deltaTimeInMs:l-d},correlationId:u,step:\"mid-call\"})}catch(p){const h=\"Failed to mute incoming audio\",g=new CallingCommunicationError({message:h,code:ve},p);l.error(h);const f=+new Date;throw this.sendAudioEvent({eventName:kd.acs_calling_mute_failure,eventType:Fd.MuteIncomingAudio,timestampInfo:{deltaTimeInMs:f-d},correlationId:u,step:\"mid-call\"},g),g}}))}unmuteIncomingAudio(){return __awaiter$b(this,void 0,void 0,(function*(){const l=this.logger.createFnLogger(Qa.MuteIncomingAudio),d=+new Date,u=generateGuid();this.sendAudioEvent({eventName:kd.acs_calling_unmute_attempt,eventType:Fd.UnmuteIncomingAudio,timestampInfo:{attemptTimestamp:d},correlationId:u,step:\"mid-call\"});try{yield this.tsCall.unmuteSpeaker();const l=+new Date;this.sendAudioEvent({eventName:kd.acs_calling_unmute_success,eventType:Fd.UnmuteIncomingAudio,timestampInfo:{deltaTimeInMs:l-d},correlationId:u,step:\"mid-call\"})}catch(p){const h=\"Failed to unmute incoming audio\",g=new CallingCommunicationError({message:h,code:ve},p);l.error(h);const f=+new Date;throw this.sendAudioEvent({eventName:kd.acs_calling_unmute_failure,eventType:Fd.UnmuteIncomingAudio,timestampInfo:{deltaTimeInMs:f-d},correlationId:u,step:\"mid-call\"},g),g}}))}sendDtmf(l){return __awaiter$b(this,void 0,void 0,(function*(){const d=this._toDtmfTone(l);return this.tsCall.sendDtmfTone(d).catch((l=>{throw this.logger.error(\"Failed to send DTMF tone\"),new CallingCommunicationError({message:\"Failed to send DTMF tone\",code:ve})}))}))}startVideo(l){var d,u;return __awaiter$b(this,void 0,void 0,(function*(){const p=this.logger.createFnLogger(Qa.StartVideo),h=+new Date,g=generateGuid(),f=null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling)||void 0===u?void 0:u.preventStopAudio;if(this.sendVideoEvent({eventName:kd.acs_calling_start_video_attempt,timestampInfo:{attemptTimestamp:h},localVideoStream:l,correlationId:g,step:\"mid-call\"}),this._isDeviceNotFunctioningMuted&&!f){this.sendAudioEvent({eventName:kd.acs_calling_start_audio_attempt,timestampInfo:{attemptTimestamp:h},correlationId:g,step:\"mid-call\"});try{p.info(\"start audio before starting video\"),yield this.tsCall.startAudio(),p.info(\"start audio success before starting video\");const l=+new Date;this._isDeviceNotFunctioningMuted=!1,this._handleMuteChanges(),this.sendAudioEvent({eventName:kd.acs_calling_start_audio_success,timestampInfo:{deltaTimeInMs:l-h},correlationId:g,step:\"mid-call\"})}catch(l){const d=\"Failed to start audio before starting video\",u=new CallingCommunicationError({message:d,code:ve},l);p.error(d);const f=+new Date;throw this.sendAudioEvent({eventName:kd.acs_calling_start_audio_failure,timestampInfo:{deltaTimeInMs:f-h},correlationId:g,step:\"mid-call\"},u),u}}if(!l){const d=new CallingCommunicationError({message:\"Failed to start video, localVideoStream cannot be null\",code:ve});throw this.sendVideoEvent({correlationId:g,eventName:kd.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:h},localVideoStream:l,step:\"mid-call\"},d),d}if(!(l instanceof LocalVideoStream)){const d=new CallingCommunicationError({message:\"Failed to start video, localVideoStream is not an instance of LocalVideoStream\",code:ve});throw this.sendVideoEvent({correlationId:g,eventName:kd.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:h},localVideoStream:l,step:\"mid-call\"},d),d}if(this.tsCall.isVideoOn){const d=new CallingCommunicationError({message:\"Failed to start video, local video is already on\",code:ve});throw this.sendVideoEvent({correlationId:g,eventName:kd.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:h},localVideoStream:l,step:\"mid-call\"},d),d}if(this.localVideoStreams[0]){const d=new CallingCommunicationError({message:\"Local video is already on, stop it first\",code:ve});throw this.sendVideoEvent({correlationId:g,eventName:kd.acs_calling_start_video_failure,timestampInfo:{attemptTimestamp:h},localVideoStream:l,step:\"mid-call\"},d),d}this.setLocalVideoStream(l);try{p.info(\"start video\"),yield this.tsCall.startVideo();const d=+new Date;this.sendVideoEvent({correlationId:g,eventName:kd.acs_calling_start_video_success,timestampInfo:{deltaTimeInMs:d-h},localVideoStream:l,step:\"mid-call\"}),p.info(\"video started\")}catch(d){const u=+new Date,f=handleVideoOperationFailure(p,d);throw this.sendVideoEvent({correlationId:g,eventName:kd.acs_calling_start_video_failure,timestampInfo:{deltaTimeInMs:u-h},localVideoStream:l,step:\"mid-call\"},f),this.removeLocalVideoStream(l),f}}))}stopVideo(l){return __awaiter$b(this,void 0,void 0,(function*(){const d=this.logger.createFnLogger(Qa.StopVideo),u=+new Date,p=generateGuid();if(this.sendVideoEvent({correlationId:p,eventName:kd.acs_calling_stop_video_attempt,timestampInfo:{attemptTimestamp:u},localVideoStream:l,step:\"mid-call\"}),!this.tsCall.isVideoOn){const d=new CallingCommunicationError({message:\"Failed to stop video, local video is already off\",code:ve});throw this.sendVideoEvent({correlationId:p,eventName:kd.acs_calling_stop_video_failure,timestampInfo:{attemptTimestamp:u},localVideoStream:l,step:\"mid-call\"},d),d}if(this.localVideoStreams[0]!==l){const d=new CallingCommunicationError({message:\"Invalid LocalVideoStream, this LocalVideoStream is not being sent\",code:ve});throw this.sendVideoEvent({correlationId:p,eventName:kd.acs_calling_stop_video_failure,timestampInfo:{attemptTimestamp:u},localVideoStream:l,step:\"mid-call\"},d),d}try{d.info(\"stop video\"),yield this.tsCall.stopVideo();const h=+new Date;this.sendVideoEvent({correlationId:p,eventName:kd.acs_calling_stop_video_success,timestampInfo:{deltaTimeInMs:h-u},localVideoStream:l,step:\"mid-call\"}),d.info(\"video stopped\"),this.removeLocalVideoStream(l)}catch(h){const g=+new Date,f=handleVideoOperationFailure(d,h);throw this.sendVideoEvent({correlationId:p,eventName:kd.acs_calling_stop_video_failure,timestampInfo:{deltaTimeInMs:g-u},localVideoStream:l,step:\"mid-call\"},f),f}}))}startAudio(l){return this.startAudioInternal(l)}startAudioInternal(l,d=!1){var u,p,h,g;return __awaiter$b(this,void 0,void 0,(function*(){const f=generateGuid(),m=+new Date;let v;this.sendMediaAccessEvent({eventName:kd.acs_calling_start_audio_stream_track_attempt,timestampInfo:{attemptTimestamp:m},correlationId:f,isInternal:d,step:\"mid-call\"});try{v=yield l.getMediaStreamTrack()}catch(l){const u=new CallingCommunicationError({message:\"Failed to get MediaStreamTrack with error\",code:Ie});this.logger.error(`Failed to get MediaStreamTrack with error: ${l}`);const p=+new Date;throw this.sendMediaAccessEvent({eventName:kd.acs_calling_start_audio_stream_track_failure,timestampInfo:{deltaTimeInMs:p-m},correlationId:f,isInternal:d,step:\"mid-call\"},u),u}if(!(null===(p=null===(u=getAcsEcsConfig())||void 0===u?void 0:u.calling)||void 0===p?void 0:p.allowAccessRawMediaStream)||!(null===(h=this.tsCall)||void 0===h?void 0:h.setRawInputAudioStreamTrack)){const l=new CallingCommunicationError({message:\"Failed to set raw input audio stream track\",code:Ie});this.logger.error(\"Failed to set raw input audio stream track\");const u=+new Date;throw this.sendMediaAccessEvent({eventName:kd.acs_calling_start_audio_stream_track_failure,timestampInfo:{deltaTimeInMs:u-m},correlationId:f,isInternal:d,step:\"mid-call\"},l),l}null===(g=this.tsCall)||void 0===g||g.setRawInputAudioStreamTrack(v),this.removeLocalAudioStream(this.localAudioStreams[0]),this.setLocalAudioStream(l);const y=+new Date;this.sendMediaAccessEvent({eventName:kd.acs_calling_start_audio_stream_track_success,timestampInfo:{deltaTimeInMs:y-m},localAudioStream:this.localAudioStreams[0],correlationId:f,isInternal:d,step:\"mid-call\"})}))}stopAudio(){return this.stopAudioInternal()}stopAudioInternal(l=!1){var d,u,p,h;const g=generateGuid(),f=+new Date;if(this.sendMediaAccessEvent({eventName:kd.acs_calling_stop_audio_stream_track_attempt,timestampInfo:{attemptTimestamp:f},localAudioStream:this.localAudioStreams[0],correlationId:g,isInternal:l,step:\"mid-call\"}),!(null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling)||void 0===u?void 0:u.allowAccessRawMediaStream)||!(null===(p=this.tsCall)||void 0===p?void 0:p.unsetRawInputAudioStreamTrack)){const d=new CallingCommunicationError({message:\"Failed to unset raw input audio stream track\",code:Ie});this.logger.error(\"Failed to unset raw input audio stream track\");const u=+new Date;throw this.sendMediaAccessEvent({eventName:kd.acs_calling_stop_audio_stream_track_failure,timestampInfo:{deltaTimeInMs:u-f},localAudioStream:this.localAudioStreams[0],correlationId:g,isInternal:l,step:\"mid-call\"},d),d}null===(h=this.tsCall)||void 0===h||h.unsetRawInputAudioStreamTrack(),this.removeLocalAudioStream(this.localAudioStreams[0]);const m=+new Date;this.sendMediaAccessEvent({eventName:kd.acs_calling_stop_audio_stream_track_success,timestampInfo:{deltaTimeInMs:m-f},localAudioStream:this.localAudioStreams[0],correlationId:g,isInternal:l,step:\"mid-call\"})}addParticipant(l,d){let p,h,g=d,f=d,m=d;if(this._callAgent.isCteUser()){switch(this.validateThreadId(l,d),u.getIdentifierKind(l).kind){case\"communicationUser\":h=g.threadId;break;case\"microsoftTeamsUser\":h=m.threadId;break;case\"phoneNumber\":h=f.threadId;break;default:throw new CallingCommunicationError({message:\"Not able to add unkown participant.\",code:ve})}}if((null==f?void 0:f.alternateCallerId)&&(validateIdentifier(f.alternateCallerId),p=getMriFromIdentifier(f.alternateCallerId)),validateIdentifier(l),this._remoteParticipants.find((d=>getMriFromIdentifier(d.identifier)===getMriFromIdentifier(l))))throw new CallingCommunicationError({message:`${u.getIdentifierKind(l).kind} is already in the call`,code:ve});const v=this.getOrCreateRemoteParticipant(constructIdentifierKindFromMri(getMriFromIdentifier(l)));return this.tsCall.addParticipant(getMriFromIdentifier(l),{alternateId:p,threadId:h}).catch((d=>{if(this._remoteParticipants.find((d=>getMriFromIdentifier(d.identifier)===getMriFromIdentifier(l)))){this._remoteParticipants.splice(this._remoteParticipants.indexOf(v));const l=this._handleParticipantOperationFailure(d);v.setCallEndReason({code:l.code,subCode:l.subCode}),this._eventEmitter.emit(\"remoteParticipantsUpdated\",{added:[],removed:[v]})}})),v}removeParticipant(l,d){return __awaiter$b(this,void 0,void 0,(function*(){validateIdentifier(l);try{yield this.tsCall.removeParticipant(getMriFromIdentifier(l))}catch(l){throw this._handleParticipantOperationFailure(l)}}))}hold(){return __awaiter$b(this,void 0,void 0,(function*(){return this.tsCall.hold().catch((l=>{throw this.logger.error(\"Failed to hold call\"),new CallingCommunicationError({message:\"Failed to hold call\",code:ve})}))}))}resume(){return __awaiter$b(this,void 0,void 0,(function*(){return this.tsCall.unhold().catch((l=>{throw this.logger.error(\"Failed to resume call\"),new CallingCommunicationError({message:\"Failed to resume call\",code:ve})}))}))}hangUp(l){return __awaiter$b(this,void 0,void 0,(function*(){const d=+new Date,u=generateGuid();return this.sendCallStageEvent({eventName:kd.acs_calling_call_hangup_attempt,correlationId:u,timestampInfo:{attemptTimestamp:d}}),this.tsCall.stop(null==l?void 0:l.forEveryone).then((()=>{const l=+new Date;this.sendCallStageEvent({eventName:kd.acs_calling_call_hangup_success,correlationId:u,timestampInfo:{deltaTimeInMs:l-d}})})).catch((l=>{const p=+new Date,h=this._handleCallOperationFailure(l);throw this.sendCallStageEvent({eventName:kd.acs_calling_call_hangup_failure,correlationId:u,timestampInfo:{deltaTimeInMs:p-d}},h),h}))}))}startScreenSharing(){return __awaiter$b(this,void 0,void 0,(function*(){return this.tsCall.startScreenSharing().catch((l=>{throw this.logger.error(\"Failed to start screen share\"),new CallingCommunicationError({message:\"Failed to start screen share\",code:ve})}))}))}stopScreenSharing(){return __awaiter$b(this,void 0,void 0,(function*(){return this.tsCall.stopScreenSharing().catch((l=>{throw this.logger.error(\"Failed to stop screen share\"),new CallingCommunicationError({message:\"Failed to stop screen share\",code:ve})}))}))}on(l,d){if(\"stateChanged\"!==l&&\"idChanged\"!==l&&\"isMutedChanged\"!==l&&\"isIncomingAudioMutedChanged\"!==l&&\"isScreenSharingOnChanged\"!==l&&\"remoteParticipantsUpdated\"!==l&&\"localVideoStreamsUpdated\"!==l&&\"localAudioStreamsUpdated\"!==l&&\"remoteAudioStreamsUpdated\"!==l&&\"totalParticipantCountChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this._eventEmitter.on(l,d)}off(l,d){if(\"stateChanged\"!==l&&\"idChanged\"!==l&&\"isMutedChanged\"!==l&&\"isIncomingAudioMutedChanged\"!=l&&\"isScreenSharingOnChanged\"!==l&&\"remoteParticipantsUpdated\"!==l&&\"localVideoStreamsUpdated\"!==l&&\"localAudioStreamsUpdated\"!==l&&\"remoteAudioStreamsUpdated\"!==l&&\"totalParticipantCountChanged\"!=l)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${l}, unknown event name`,code:be});this._eventEmitter.off(l,d)}dispose(){this._disposed||(this._dmDevicesChangedSub&&this._dmDevicesChangedSub.dispose(),this._dmDevicesChangedSub=void 0,this._extensibleApi.dispose(),this._eventEmitter.removeAllListeners(),this._disposed=!0)}mapTsCallState(l){let d;if(this.tsToAcsCallStateMap[l])if(d=this.tsToAcsCallStateMap[l],\"Disconnected\"===d){this._callEndReason=this._getCallEndReason(),this._remoteParticipants.forEach((l=>{l.setParticipantState(\"Disconnected\"),l.setCallEndReason(this._getTsParticipantCallEndReason(l.tsRemoteParticipant))}));const u=this._remoteParticipants.map((l=>l));this._remoteParticipants=[],this._eventEmitter.emit(\"remoteParticipantsUpdated\",{added:[],removed:u}),this.localVideoStreams[0]&&this.removeLocalVideoStream(this.localVideoStreams[0]),getAcsEcsConfig().calling.allowAccessRawMediaStream&&this.localAudioStreams[0]&&this.removeLocalAudioStream(this.localAudioStreams[0]),getAcsEcsConfig().calling.allowAccessRawMediaStream&&this.remoteAudioStreams[0]&&this.removeRemoteAudioStream(this.remoteAudioStreams[0]),this._telemetryLogManager.flushAllEvents(this.id).then((()=>{this.logger.log(\"Telemetry flushed\")})).catch((l=>{this.logger.warn(\"Failed to flush telemetry log manager events\")})).then((()=>{this.logger.log(`Mapped tsCall state:${l} to ${d}`),this._setCallState(d)}))}else\"Connected\"===d?(this.logger.log(`Mapped tsCall state:${l} to ${d}`),this._setCallState(d),this.setOrUpdateMediaMetricsDeviceEvents(),getAcsEcsConfig().calling.allowAccessRawMediaStream&&this.remoteAudioStreams):(this.logger.log(`Mapped tsCall state:${l} to ${d}`),this._setCallState(d));else this.logger.log(`Unable to map tsCall state \\`${l}\\`, to ACS Call state`)}setOrUpdateMediaMetricsDeviceEvents(){return __awaiter$b(this,void 0,void 0,(function*(){if(getAcsEcsConfig().calling.mediaMetricsDeviceEventsEnabled)try{const l=yield this.tsCall.getMediaTelemetry(!0),d=JSON.parse(l.metrics_DeviceEvents),u=getSafeObjectDiff(this._mediaMetricsDeviceEvents||{},d);u.length>0&&(this._mediaMetricsDeviceEvents=d,this.stats.recordEvent({name:Ld.media_metrics_device_events,callId:this.id,localParticipantId:this.tsCall.participantId,data:{metricsDeviceEvents:u||{},metricsDevicesChangeCount:(null==d?void 0:d.metrics_DevicesChangeCount)||0,metricsDevicesCount:(null==d?void 0:d.metrics_DevicesCount)||{}}}))}catch(l){this.logger.error(\"Failed to set media metrics device events telemetry\")}}))}_setCallState(l){l!==this._state&&(this.logger.log(`state changed from ${this._state} to ${l}`),this.sendCallProgressEvent({eventName:kd.acs_calling_call_progress,step:\"state-changed\",timestampInfo:{attemptTimestamp:+new Date},additionalProperties:{oldState:this._state,newState:l,diagnosticInfo:this.tsCall.callEndDiagnosticsInfo?this.tsCall.callEndDiagnosticsInfo:\"\"}}),this._state=l,this._eventEmitter.emit(\"stateChanged\"))}_handleRemoteRingingForOutgoingCall(l){l.changed((()=>{2===l.state&&\"Connected\"!==this._state&&\"Outgoing\"==this._direction&&this._setCallState(\"Ringing\")}))}getOrCreateRemoteParticipant(l){let d=this._remoteParticipants.find((d=>getMriFromIdentifier(d.identifier)===getMriFromIdentifier(l)));return d||(d=new RemoteParticipantImpl(l,this.logger,this,this._callAgent,this._telemetryLogManager),this._remoteParticipants.push(d)),d}_toDtmfTone(l){switch(l){case\"Num0\":return 0;case\"Num1\":return 1;case\"Num2\":return 2;case\"Num3\":return 3;case\"Num4\":return 4;case\"Num5\":return 5;case\"Num6\":return 6;case\"Num7\":return 7;case\"Num8\":return 8;case\"Num9\":return 9;case\"Star\":return 10;case\"Pound\":return 11;case\"A\":return 12;case\"B\":return 13;case\"C\":return 14;case\"D\":return 15;case\"Flash\":return 16;default:throw new CallingCommunicationError({message:\"Invalid value passed to DtfmTone\",code:be})}}getLocalVideoStreamFromCallOptions(l){var d,u,p;let h;if(Array.isArray(null===(d=null==l?void 0:l.videoOptions)||void 0===d?void 0:d.localVideoStreams)){if(1!==(null===(u=null==l?void 0:l.videoOptions)||void 0===u?void 0:u.localVideoStreams.length))throw new CallingCommunicationError({message:\"Only single LocalVideoStream is supported currently\",code:ve});if(h=null===(p=null==l?void 0:l.videoOptions)||void 0===p?void 0:p.localVideoStreams[0],!(h instanceof LocalVideoStream))throw new CallingCommunicationError({message:`${h[0]} is not an instance of LocalVideoStream`,code:be})}return h}getLocalAudioStreamFromCallOptions(l){var d,u,p;let h;if(Array.isArray(null===(d=null==l?void 0:l.audioOptions)||void 0===d?void 0:d.localAudioStreams)){if(1!==(null===(u=null==l?void 0:l.audioOptions)||void 0===u?void 0:u.localAudioStreams.length))throw new CallingCommunicationError({message:\"Only single LocalAudioStream is supported currently\",code:ve});if(h=null===(p=null==l?void 0:l.audioOptions)||void 0===p?void 0:p.localAudioStreams[0],!(h instanceof LocalAudioStream))throw new CallingCommunicationError({message:`${h[0]} is not an instance of LocalAudioStream`,code:be})}return h}setLocalVideoStream(l){if(!this._callAgent.tsStack)throw new CallingCommunicationError({message:\"Failed to process video because of internal call stack error\",code:Ie});l&&(this._localVideoStreams.push(l),this._callAgent.tsStack.getDeviceManager().selectDevices({camera:l.source.id}),this._eventEmitter.emit(\"localVideoStreamsUpdated\",{added:[l],removed:[]}))}removeLocalVideoStream(l){if(l){this.logger.log(\"Attempting to remove local video stream\");if(0===this._localVideoStreams.splice(this._localVideoStreams.indexOf(l),1).length)return void this.logger.warn(\"Stream not found, failed to remove stream from localVideoStreams collection\");this.logger.log(\"Local video stream removed successfully\"),this._eventEmitter.emit(\"localVideoStreamsUpdated\",{added:[],removed:[l]})}}setLocalAudioStream(l){if(!this._callAgent.tsStack)throw new CallingCommunicationError({message:\"Failed to process audio because of internal call stack error\",code:Ie});getAcsEcsConfig().calling.allowAccessRawMediaStream&&l&&(l.on(\"audioSourceChanged\",this.audioSourceChanged),this._localAudioStreams.push(l),this._eventEmitter.emit(\"localAudioStreamsUpdated\",{added:[l],removed:[]}))}removeLocalAudioStream(l){if(l){this.logger.log(\"Attempting to remove local audio stream\"),l.off(\"audioSourceChanged\",this.audioSourceChanged);if(0===this._localAudioStreams.splice(this._localAudioStreams.indexOf(l),1).length)return void this.logger.warn(\"Stream not found, failed to remove stream from localAudioStreams collection\");this.logger.log(\"Local audio stream removed successfully\"),this._eventEmitter.emit(\"localAudioStreamsUpdated\",{added:[],removed:[l]})}}removeRemoteAudioStream(l){if(l){this.logger.log(\"Attempting to remove remote audio stream\");if(0===this._remoteAudioStreams.splice(this._remoteAudioStreams.indexOf(l),1).length)return void this.logger.warn(\"Stream not found, failed to remove stream from remoteAudioStreams collection\");this.logger.log(\"remote audio stream removed successfully\"),this._eventEmitter.emit(\"remoteAudioStreamsUpdated\",{added:[],removed:[l]})}}audioSourceChanged(l){var d;return __awaiter$b(this,void 0,void 0,(function*(){const u=generateGuid();this.sendMediaAccessEvent({eventName:kd.acs_calling_local_audio_source_changed_attempt,timestampInfo:+new Date,localAudioStream:l.source,correlationId:u,step:\"mid-call\"}),l.source instanceof AudioDeviceInfoImpl?(this.localAudioStreams[0]&&this.stopAudioInternal(!0),null===(d=this._callAgent.tsStack)||void 0===d||d.getDeviceManager().selectDevices({microphone:l.source.id})):yield this.startAudioInternal(l.source,!0)}))}shallStopVideo(l){var d,u,p,h,g,f;const m=null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling)||void 0===u?void 0:u.deviceNotFunctioningMuted,v=null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.calling)||void 0===h?void 0:h.deviceCaptureMutedVideo,y=null===(f=null===(g=getAcsEcsConfig())||void 0===g?void 0:g.calling)||void 0===f?void 0:f.preventStopVideo,S=25===l.type&&3===l.value,_=S&&1===l.mediaType,C=33===l.type&&3===l.value,E=\"ios\"===getOS()&&\"safari\"===getPlatformName(),T=\"android\"===getOS(),b=3===this.tsCall.state;return y?b&&this.tsCall.isVideoOn&&C:m&&b&&this.tsCall.isVideoOn&&(C||E&&S||v&&T&&_)}shallRemoveLocalVideoStreamOnBadUfd(l){var d,u;const p=this.tsCall.localMediaStreams.find((l=>1===l.mediaType)),h=1===l.mediaType&&3===l.value&&25===l.type,g=4==this.tsCall.state||5===this.tsCall.state;if(\"Mobile\"===getBrowserInfo().formFactor&&(h||\"hidden\"==document.visibilityState)&&this.localVideoStreams[0]&&g&&!p)return!1;if(!(null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling)||void 0===u?void 0:u.removeLvsCheckOnCallStartAndCallAccept))return!1;const f=3===this.tsCall.state;return 1===l.mediaType&&3===l.value&&(33===l.type||25===l.type||34===l.type)&&!!this.localVideoStreams[0]&&!f&&!p}shallStopAudio(l){var d,u,p,h;const g=null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling)||void 0===u?void 0:u.deviceNotFunctioningMuted,f=null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.calling)||void 0===h?void 0:h.osAutoRecoverAudio,m=25===l.type&&3===l.value&&0===l.mediaType,v=9===l.type&&3===l.value,y=\"ios\"===getOS()&&\"safari\"===getPlatformName(),S=3===this.tsCall.state;return f?g&&S&&v:g&&!this._isDeviceNotFunctioningMuted&&S&&(v||y&&m)}audioDidAutoRecover(l){var d,u,p,h;const g=(null===(u=null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling)||void 0===u?void 0:u.deviceCaptureMuteRecover)&&!(null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.calling)||void 0===h?void 0:h.preventFakeMute),f=25===l.type&&1===l.value&&0===l.mediaType,m=3===this.tsCall.state,v=\"ios\"===getOS()&&\"safari\"===getPlatformName(),y=9===l.type&&1===l.value;return g&&this._isDeviceNotFunctioningMuted&&m&&(y||v&&f)}sendAudioEvent(l,d){try{let u=\"string\"==typeof(null==d?void 0:d.message)?null==d?void 0:d.message:void 0;l.eventName!==String(kd.acs_calling_mute_failure)&&l.eventName!==String(kd.acs_calling_unmute_failure)&&(u=void 0);const p={callId:this.id,localParticipantId:this.tsCall.participantId,timestampInfo:l.timestampInfo,correlationId:l.correlationId,step:l.step||\"\",failureReason:u||\"\"};void 0!==l.eventType&&(p.eventType=l.eventType),this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:p})}catch(l){this.logger.debug(\"Unable to send audio telemetry\")}}sendVideoEvent(l,d){var u;try{let p,h;try{p=null===(u=l.localVideoStream)||void 0===u?void 0:u.getStreamMetadata()}catch(l){this.logger.error(\"Unable to get stream meta data on send video event\")}try{h=this.tsCall.mediaStreams[0][0].id}catch(l){}let g=\"string\"==typeof(null==d?void 0:d.message)?null==d?void 0:d.message:void 0;l.eventName!==String(kd.acs_calling_start_video_failure)&&l.eventName!==String(kd.acs_calling_stop_video_failure)&&(g=void 0),this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:Object.assign(Object.assign({callId:this.id,localParticipantId:this.tsCall.participantId,timestampInfo:l.timestampInfo,correlationId:l.correlationId,step:l.step||\"\"},p),{failureReason:g||\"\",sourceId:h||\"\"})})}catch(l){this.logger.debug(\"Unable to send video telemetry\")}}sendMediaAccessEvent(l,d){var u;try{let p=\"string\"==typeof(null==d?void 0:d.message)?null==d?void 0:d.message:void 0;l.eventName!==String(kd.acs_calling_get_remote_audio_stream_track_failure)&&l.eventName!==String(kd.acs_calling_start_audio_stream_track_failure)&&l.eventName!==String(kd.acs_calling_stop_audio_stream_track_failure)&&(p=void 0),this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:{callId:this.id,localParticipantId:this.tsCall.participantId,timestampInfo:l.timestampInfo,correlationId:l.correlationId,step:l.step||\"\",failureReason:p||\"\",localAudioStream:(null===(u=l.localAudioStream)||void 0===u?void 0:u.source)instanceof MediaStreamTrack?\"MediaStreamTrack\":\"Device\"}})}catch(l){this.logger.debug(\"Unable to send media access telemetry\")}}validateThreadId(l,d){if(!(null==d?void 0:d.threadId))throw new CallingCommunicationError({message:\"Add participant failed: thread ID is missing in options.\",code:ve})}}__decorate$8([loggerProperty,__metadata$8(\"design:type\",Object)],CallImpl.prototype,\"logger\",void 0),__decorate$8([syncOperation(Qa.BindToCall),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",void 0)],CallImpl.prototype,\"bindTsCall\",null),__decorate$8([asyncOperation(Qa.Mute),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"mute\",null),__decorate$8([asyncOperation(Qa.Unmute),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"unmute\",null),__decorate$8([asyncOperation(Qa.MuteIncomingAudio),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"muteIncomingAudio\",null),__decorate$8([asyncOperation(Qa.UnmuteIncomingAudio),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"unmuteIncomingAudio\",null),__decorate$8([asyncOperation(Qa.SendDtmf),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[String]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"sendDtmf\",null),__decorate$8([asyncOperation(Qa.StartVideo),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[LocalVideoStream]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"startVideo\",null),__decorate$8([asyncOperation(Qa.StopVideo),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[LocalVideoStream]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"stopVideo\",null),__decorate$8([asyncOperation(Qa.startAudio),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[LocalAudioStream]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"startAudio\",null),__decorate$8([syncOperation(Qa.AddParticipant),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[Object,Object]),__metadata$8(\"design:returntype\",Object)],CallImpl.prototype,\"addParticipant\",null),__decorate$8([asyncOperation(Qa.RemoveParticipant),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[Object,Object]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"removeParticipant\",null),__decorate$8([asyncOperation(Qa.Hold),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"hold\",null),__decorate$8([asyncOperation(Qa.Resume),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"resume\",null),__decorate$8([asyncOperation(Qa.HangUp),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[Object]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"hangUp\",null),__decorate$8([asyncOperation(Qa.StartScreenShare),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"startScreenSharing\",null),__decorate$8([asyncOperation(Qa.StopScreenShare),__metadata$8(\"design:type\",Function),__metadata$8(\"design:paramtypes\",[]),__metadata$8(\"design:returntype\",Promise)],CallImpl.prototype,\"stopScreenSharing\",null);var __decorate$9=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$9=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$c=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class IncomingCallImpl{constructor(l){this._callInternal=l,this._eventEmitter=new ri.EventEmitter,this._callInternal.on(\"stateChanged\",(()=>{\"Disconnected\"===this._callInternal.state&&this._eventEmitter.emit(\"callEnded\",{callEndReason:this._callInternal.callEndReason})}))}get id(){return this._callInternal.id}get info(){return this._callInternal.info}get callerInfo(){return this._callInternal.callerInfo}get callEndReason(){return this._callInternal.callEndReason}accept(l){return __awaiter$c(this,void 0,void 0,(function*(){return this._callInternal.accept(l)}))}reject(){return __awaiter$c(this,void 0,void 0,(function*(){return this._callInternal.reject()}))}on(l,d){this._eventEmitter.on(l,d)}off(l,d){this._eventEmitter.off(l,d)}}__decorate$9([asyncOperation(Qa.Accept),__metadata$9(\"design:type\",Function),__metadata$9(\"design:paramtypes\",[Object]),__metadata$9(\"design:returntype\",Promise)],IncomingCallImpl.prototype,\"accept\",null),__decorate$9([asyncOperation(Qa.Reject),__metadata$9(\"design:type\",Function),__metadata$9(\"design:paramtypes\",[]),__metadata$9(\"design:returntype\",Promise)],IncomingCallImpl.prototype,\"reject\",null);var Au=function bind(l,d){return function wrap(){for(var u=new Array(arguments.length),p=0;p<u.length;p++)u[p]=arguments[p];return l.apply(d,u)}},Ru=Object.prototype.toString;function isArray$3(l){return\"[object Array]\"===Ru.call(l)}function isUndefined$2(l){return void 0===l}function isBuffer(l){return null!==l&&!isUndefined$2(l)&&null!==l.constructor&&!isUndefined$2(l.constructor)&&\"function\"==typeof l.constructor.isBuffer&&l.constructor.isBuffer(l)}function isArrayBuffer(l){return\"[object ArrayBuffer]\"===Ru.call(l)}function isFormData(l){return\"undefined\"!=typeof FormData&&l instanceof FormData}function isArrayBufferView(l){return\"undefined\"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(l):l&&l.buffer&&l.buffer instanceof ArrayBuffer}function isString$2(l){return\"string\"==typeof l}function isNumber$2(l){return\"number\"==typeof l}function isObject$1(l){return null!==l&&\"object\"==typeof l}function isPlainObject(l){if(\"[object Object]\"!==Ru.call(l))return!1;var d=Object.getPrototypeOf(l);return null===d||d===Object.prototype}function isDate$1(l){return\"[object Date]\"===Ru.call(l)}function isFile(l){return\"[object File]\"===Ru.call(l)}function isBlob(l){return\"[object Blob]\"===Ru.call(l)}function isFunction$2(l){return\"[object Function]\"===Ru.call(l)}function isStream(l){return isObject$1(l)&&isFunction$2(l.pipe)}function isURLSearchParams(l){return\"undefined\"!=typeof URLSearchParams&&l instanceof URLSearchParams}function trim(l){return l.replace(/^\\s*/,\"\").replace(/\\s*$/,\"\")}function isStandardBrowserEnv(){return(\"undefined\"==typeof navigator||\"ReactNative\"!==navigator.product&&\"NativeScript\"!==navigator.product&&\"NS\"!==navigator.product)&&(\"undefined\"!=typeof window&&\"undefined\"!=typeof document)}function forEach(l,d){if(null!=l)if(\"object\"!=typeof l&&(l=[l]),isArray$3(l))for(var u=0,p=l.length;u<p;u++)d.call(null,l[u],u,l);else for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&d.call(null,l[h],h,l)}function merge(){var l={};function assignValue(d,u){isPlainObject(l[u])&&isPlainObject(d)?l[u]=merge(l[u],d):isPlainObject(d)?l[u]=merge({},d):isArray$3(d)?l[u]=d.slice():l[u]=d}for(var d=0,u=arguments.length;d<u;d++)forEach(arguments[d],assignValue);return l}function extend$1(l,d,u){return forEach(d,(function assignValue(d,p){l[p]=u&&\"function\"==typeof d?Au(d,u):d})),l}function stripBOM(l){return 65279===l.charCodeAt(0)&&(l=l.slice(1)),l}var Pu={isArray:isArray$3,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString$2,isNumber:isNumber$2,isObject:isObject$1,isPlainObject:isPlainObject,isUndefined:isUndefined$2,isDate:isDate$1,isFile:isFile,isBlob:isBlob,isFunction:isFunction$2,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend$1,trim:trim,stripBOM:stripBOM};function encode(l){return encodeURIComponent(l).replace(/%3A/gi,\":\").replace(/%24/g,\"$\").replace(/%2C/gi,\",\").replace(/%20/g,\"+\").replace(/%5B/gi,\"[\").replace(/%5D/gi,\"]\")}var Ou=function buildURL(l,d,u){if(!d)return l;var p;if(u)p=u(d);else if(Pu.isURLSearchParams(d))p=d.toString();else{var h=[];Pu.forEach(d,(function serialize(l,d){null!=l&&(Pu.isArray(l)?d+=\"[]\":l=[l],Pu.forEach(l,(function parseValue(l){Pu.isDate(l)?l=l.toISOString():Pu.isObject(l)&&(l=JSON.stringify(l)),h.push(encode(d)+\"=\"+encode(l))})))})),p=h.join(\"&\")}if(p){var g=l.indexOf(\"#\");-1!==g&&(l=l.slice(0,g)),l+=(-1===l.indexOf(\"?\")?\"?\":\"&\")+p}return l};function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(l,d){return this.handlers.push({fulfilled:l,rejected:d}),this.handlers.length-1},InterceptorManager.prototype.eject=function eject(l){this.handlers[l]&&(this.handlers[l]=null)},InterceptorManager.prototype.forEach=function forEach(l){Pu.forEach(this.handlers,(function forEachHandler(d){null!==d&&l(d)}))};var Mu=InterceptorManager,wu=function transformData(l,d,u){return Pu.forEach(u,(function transform(u){l=u(l,d)})),l},Nu=function isCancel(l){return!(!l||!l.__CANCEL__)},Du=function normalizeHeaderName(l,d){Pu.forEach(l,(function processHeader(u,p){p!==d&&p.toUpperCase()===d.toUpperCase()&&(l[d]=u,delete l[p])}))},Lu=function enhanceError(l,d,u,p,h){return l.config=d,u&&(l.code=u),l.request=p,l.response=h,l.isAxiosError=!0,l.toJSON=function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},l},ku=function createError(l,d,u,p,h){var g=new Error(l);return Lu(g,d,u,p,h)},xu=function settle(l,d,u){var p=u.config.validateStatus;u.status&&p&&!p(u.status)?d(ku(\"Request failed with status code \"+u.status,u.config,null,u.request,u)):l(u)},Fu=Pu.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(l,d,u,p,h,g){var f=[];f.push(l+\"=\"+encodeURIComponent(d)),Pu.isNumber(u)&&f.push(\"expires=\"+new Date(u).toGMTString()),Pu.isString(p)&&f.push(\"path=\"+p),Pu.isString(h)&&f.push(\"domain=\"+h),!0===g&&f.push(\"secure\"),document.cookie=f.join(\"; \")},read:function read(l){var d=document.cookie.match(new RegExp(\"(^|;\\\\s*)(\"+l+\")=([^;]*)\"));return d?decodeURIComponent(d[3]):null},remove:function remove(l){this.write(l,\"\",Date.now()-864e5)}}}():{write:function write(){},read:function read(){return null},remove:function remove(){}},Uu=function isAbsoluteURL(l){return/^([a-z][a-z\\d\\+\\-\\.]*:)?\\/\\//i.test(l)},ju=function combineURLs(l,d){return d?l.replace(/\\/+$/,\"\")+\"/\"+d.replace(/^\\/+/,\"\"):l},Bu=function buildFullPath(l,d){return l&&!Uu(d)?ju(l,d):d},Vu=[\"age\",\"authorization\",\"content-length\",\"content-type\",\"etag\",\"expires\",\"from\",\"host\",\"if-modified-since\",\"if-unmodified-since\",\"last-modified\",\"location\",\"max-forwards\",\"proxy-authorization\",\"referer\",\"retry-after\",\"user-agent\"],Hu=function parseHeaders(l){var d,u,p,h={};return l?(Pu.forEach(l.split(\"\\n\"),(function parser(l){if(p=l.indexOf(\":\"),d=Pu.trim(l.substr(0,p)).toLowerCase(),u=Pu.trim(l.substr(p+1)),d){if(h[d]&&Vu.indexOf(d)>=0)return;h[d]=\"set-cookie\"===d?(h[d]?h[d]:[]).concat([u]):h[d]?h[d]+\", \"+u:u}})),h):h},Gu=Pu.isStandardBrowserEnv()?function standardBrowserEnv(){var l,d=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement(\"a\");function resolveURL(l){var p=l;return d&&(u.setAttribute(\"href\",p),p=u.href),u.setAttribute(\"href\",p),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,\"\"):\"\",host:u.host,search:u.search?u.search.replace(/^\\?/,\"\"):\"\",hash:u.hash?u.hash.replace(/^#/,\"\"):\"\",hostname:u.hostname,port:u.port,pathname:\"/\"===u.pathname.charAt(0)?u.pathname:\"/\"+u.pathname}}return l=resolveURL(window.location.href),function isURLSameOrigin(d){var u=Pu.isString(d)?resolveURL(d):d;return u.protocol===l.protocol&&u.host===l.host}}():function isURLSameOrigin(){return!0},Wu=function xhrAdapter(l){return new Promise((function dispatchXhrRequest(d,u){var p=l.data,h=l.headers;Pu.isFormData(p)&&delete h[\"Content-Type\"];var g=new XMLHttpRequest;if(l.auth){var f=l.auth.username||\"\",m=l.auth.password?unescape(encodeURIComponent(l.auth.password)):\"\";h.Authorization=\"Basic \"+btoa(f+\":\"+m)}var v=Bu(l.baseURL,l.url);if(g.open(l.method.toUpperCase(),Ou(v,l.params,l.paramsSerializer),!0),g.timeout=l.timeout,g.onreadystatechange=function handleLoad(){if(g&&4===g.readyState&&(0!==g.status||g.responseURL&&0===g.responseURL.indexOf(\"file:\"))){var p=\"getAllResponseHeaders\"in g?Hu(g.getAllResponseHeaders()):null,h={data:l.responseType&&\"text\"!==l.responseType?g.response:g.responseText,status:g.status,statusText:g.statusText,headers:p,config:l,request:g};xu(d,u,h),g=null}},g.onabort=function handleAbort(){g&&(u(ku(\"Request aborted\",l,\"ECONNABORTED\",g)),g=null)},g.onerror=function handleError(){u(ku(\"Network Error\",l,null,g)),g=null},g.ontimeout=function handleTimeout(){var d=\"timeout of \"+l.timeout+\"ms exceeded\";l.timeoutErrorMessage&&(d=l.timeoutErrorMessage),u(ku(d,l,\"ECONNABORTED\",g)),g=null},Pu.isStandardBrowserEnv()){var y=(l.withCredentials||Gu(v))&&l.xsrfCookieName?Fu.read(l.xsrfCookieName):void 0;y&&(h[l.xsrfHeaderName]=y)}if(\"setRequestHeader\"in g&&Pu.forEach(h,(function setRequestHeader(l,d){void 0===p&&\"content-type\"===d.toLowerCase()?delete h[d]:g.setRequestHeader(d,l)})),Pu.isUndefined(l.withCredentials)||(g.withCredentials=!!l.withCredentials),l.responseType)try{g.responseType=l.responseType}catch(d){if(\"json\"!==l.responseType)throw d}\"function\"==typeof l.onDownloadProgress&&g.addEventListener(\"progress\",l.onDownloadProgress),\"function\"==typeof l.onUploadProgress&&g.upload&&g.upload.addEventListener(\"progress\",l.onUploadProgress),l.cancelToken&&l.cancelToken.promise.then((function onCanceled(l){g&&(g.abort(),u(l),g=null)})),p||(p=null),g.send(p)}))},qu={\"Content-Type\":\"application/x-www-form-urlencoded\"};function setContentTypeIfUnset(l,d){!Pu.isUndefined(l)&&Pu.isUndefined(l[\"Content-Type\"])&&(l[\"Content-Type\"]=d)}function getDefaultAdapter(){var l;return(\"undefined\"!=typeof XMLHttpRequest||\"undefined\"!=typeof process&&\"[object process]\"===Object.prototype.toString.call(process))&&(l=Wu),l}var zu={adapter:getDefaultAdapter(),transformRequest:[function transformRequest(l,d){return Du(d,\"Accept\"),Du(d,\"Content-Type\"),Pu.isFormData(l)||Pu.isArrayBuffer(l)||Pu.isBuffer(l)||Pu.isStream(l)||Pu.isFile(l)||Pu.isBlob(l)?l:Pu.isArrayBufferView(l)?l.buffer:Pu.isURLSearchParams(l)?(setContentTypeIfUnset(d,\"application/x-www-form-urlencoded;charset=utf-8\"),l.toString()):Pu.isObject(l)?(setContentTypeIfUnset(d,\"application/json;charset=utf-8\"),JSON.stringify(l)):l}],transformResponse:[function transformResponse(l){if(\"string\"==typeof l)try{l=JSON.parse(l)}catch(l){}return l}],timeout:0,xsrfCookieName:\"XSRF-TOKEN\",xsrfHeaderName:\"X-XSRF-TOKEN\",maxContentLength:-1,maxBodyLength:-1,validateStatus:function validateStatus(l){return l>=200&&l<300},headers:{common:{Accept:\"application/json, text/plain, */*\"}}};Pu.forEach([\"delete\",\"get\",\"head\"],(function forEachMethodNoData(l){zu.headers[l]={}})),Pu.forEach([\"post\",\"put\",\"patch\"],(function forEachMethodWithData(l){zu.headers[l]=Pu.merge(qu)}));var Ku=zu;function throwIfCancellationRequested(l){l.cancelToken&&l.cancelToken.throwIfRequested()}var Ju=function dispatchRequest(l){return throwIfCancellationRequested(l),l.headers=l.headers||{},l.data=wu(l.data,l.headers,l.transformRequest),l.headers=Pu.merge(l.headers.common||{},l.headers[l.method]||{},l.headers),Pu.forEach([\"delete\",\"get\",\"head\",\"post\",\"put\",\"patch\",\"common\"],(function cleanHeaderConfig(d){delete l.headers[d]})),(l.adapter||Ku.adapter)(l).then((function onAdapterResolution(d){return throwIfCancellationRequested(l),d.data=wu(d.data,d.headers,l.transformResponse),d}),(function onAdapterRejection(d){return Nu(d)||(throwIfCancellationRequested(l),d&&d.response&&(d.response.data=wu(d.response.data,d.response.headers,l.transformResponse))),Promise.reject(d)}))},Qu=function mergeConfig(l,d){d=d||{};var u={},p=[\"url\",\"method\",\"data\"],h=[\"headers\",\"auth\",\"proxy\",\"params\"],g=[\"baseURL\",\"transformRequest\",\"transformResponse\",\"paramsSerializer\",\"timeout\",\"timeoutMessage\",\"withCredentials\",\"adapter\",\"responseType\",\"xsrfCookieName\",\"xsrfHeaderName\",\"onUploadProgress\",\"onDownloadProgress\",\"decompress\",\"maxContentLength\",\"maxBodyLength\",\"maxRedirects\",\"transport\",\"httpAgent\",\"httpsAgent\",\"cancelToken\",\"socketPath\",\"responseEncoding\"],f=[\"validateStatus\"];function getMergedValue(l,d){return Pu.isPlainObject(l)&&Pu.isPlainObject(d)?Pu.merge(l,d):Pu.isPlainObject(d)?Pu.merge({},d):Pu.isArray(d)?d.slice():d}function mergeDeepProperties(p){Pu.isUndefined(d[p])?Pu.isUndefined(l[p])||(u[p]=getMergedValue(void 0,l[p])):u[p]=getMergedValue(l[p],d[p])}Pu.forEach(p,(function valueFromConfig2(l){Pu.isUndefined(d[l])||(u[l]=getMergedValue(void 0,d[l]))})),Pu.forEach(h,mergeDeepProperties),Pu.forEach(g,(function defaultToConfig2(p){Pu.isUndefined(d[p])?Pu.isUndefined(l[p])||(u[p]=getMergedValue(void 0,l[p])):u[p]=getMergedValue(void 0,d[p])})),Pu.forEach(f,(function merge(p){p in d?u[p]=getMergedValue(l[p],d[p]):p in l&&(u[p]=getMergedValue(void 0,l[p]))}));var m=p.concat(h).concat(g).concat(f),v=Object.keys(l).concat(Object.keys(d)).filter((function filterAxiosKeys(l){return-1===m.indexOf(l)}));return Pu.forEach(v,mergeDeepProperties),u};function Axios(l){this.defaults=l,this.interceptors={request:new Mu,response:new Mu}}Axios.prototype.request=function request(l){\"string\"==typeof l?(l=arguments[1]||{}).url=arguments[0]:l=l||{},(l=Qu(this.defaults,l)).method?l.method=l.method.toLowerCase():this.defaults.method?l.method=this.defaults.method.toLowerCase():l.method=\"get\";var d=[Ju,void 0],u=Promise.resolve(l);for(this.interceptors.request.forEach((function unshiftRequestInterceptors(l){d.unshift(l.fulfilled,l.rejected)})),this.interceptors.response.forEach((function pushResponseInterceptors(l){d.push(l.fulfilled,l.rejected)}));d.length;)u=u.then(d.shift(),d.shift());return u},Axios.prototype.getUri=function getUri(l){return l=Qu(this.defaults,l),Ou(l.url,l.params,l.paramsSerializer).replace(/^\\?/,\"\")},Pu.forEach([\"delete\",\"get\",\"head\",\"options\"],(function forEachMethodNoData(l){Axios.prototype[l]=function(d,u){return this.request(Qu(u||{},{method:l,url:d,data:(u||{}).data}))}})),Pu.forEach([\"post\",\"put\",\"patch\"],(function forEachMethodWithData(l){Axios.prototype[l]=function(d,u,p){return this.request(Qu(p||{},{method:l,url:d,data:u}))}}));var Yu=Axios;function Cancel(l){this.message=l}Cancel.prototype.toString=function toString(){return\"Cancel\"+(this.message?\": \"+this.message:\"\")},Cancel.prototype.__CANCEL__=!0;var $u=Cancel;function CancelToken(l){if(\"function\"!=typeof l)throw new TypeError(\"executor must be a function.\");var d;this.promise=new Promise((function promiseExecutor(l){d=l}));var u=this;l((function cancel(l){u.reason||(u.reason=new $u(l),d(u.reason))}))}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason)throw this.reason},CancelToken.source=function source(){var l;return{token:new CancelToken((function executor(d){l=d})),cancel:l}};var Xu=CancelToken,Zu=function spread(l){return function wrap(d){return l.apply(null,d)}},ep=function isAxiosError(l){return\"object\"==typeof l&&!0===l.isAxiosError};function createInstance(l){var d=new Yu(l),u=Au(Yu.prototype.request,d);return Pu.extend(u,Yu.prototype,d),Pu.extend(u,d),u}var tp=createInstance(Ku);tp.Axios=Yu,tp.create=function create(l){return createInstance(Qu(tp.defaults,l))},tp.Cancel=$u,tp.CancelToken=Xu,tp.isCancel=Nu,tp.all=function all(l){return Promise.all(l)},tp.spread=Zu,tp.isAxiosError=ep;var np=tp,ip=tp;np.default=ip;var rp=np,__awaiter$d=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class HttpRequestHelper{constructor(l){this.logger=l}sendRequestWithRetry(l,d,u,p,h,g=1,f){var m;return __awaiter$d(this,void 0,void 0,(function*(){if(g>h)throw new Error(\"Max retry reached\");p.timeout||(p.timeout=2e4),p.maxRedirects=0;try{switch(l){case\"post\":return yield rp.post(d,u,p);case\"get\":return yield rp.get(d,p);case\"put\":return yield rp.put(d,u,p);case\"delete\":return yield rp.delete(d,p);default:return yield rp.post(d,u,p)}}catch(v){let y=null===(m=null==v?void 0:v.response)||void 0===m?void 0:m.status;this.logger.error(`Found error for request ${l} ${d} ${y||\"\"}`);const S=g+1;if(S<=h){let g=d;if(v&&v.response)if(301===v.response.status||302===v.response.status||303===v.response.status||307===v.response.status||404===v.response.status)g=v.response.headers&&v.response.headers.location?v.response.headers.location:g;else if(v.response.status<500)throw v;return this.logger.error(`Retrying, attempt #${S} url=${g}`),yield new Promise((l=>setTimeout(l,f))),this.sendRequestWithRetry(l,g,u,p,h,S,f)}throw v}}))}}var __decorate$a=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$a=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$e=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};let op=1;const ap=new Map;class CallAgentImpl{constructor(l,d,u,p,h){var g,f,m,y;this._callClient=l,this._disposed=!1,this._calls=[],this.tokenProvider=l=>__awaiter$e(this,void 0,void 0,(function*(){var d,u;if(!this._communicationTokenCredential)throw new CallingCommunicationError({message:\"Attempted to get AccessToken before initialization\",code:be});const p=yield parseTokenCredential(this._communicationTokenCredential,{abortSignal:this._abortController.signal});return p.acsResourceId===(null===(d=this._parsedTokenCredential)||void 0===d?void 0:d.acsResourceId)&&p.identityMri===(null===(u=this._parsedTokenCredential)||void 0===u?void 0:u.identityMri)||logErrorAndThrow(\"Refreshed AccessToken User Id doesnt match initial User Id\",ve,this.logger),l?this._tokenFetchTries+=1:this._tokenFetchTries=0,this._tokenFetchTries>this._maxNmberOfRetries&&(this.sendTokenExpiredEvent(),this._disposed||(yield this.dispose()),logErrorAndThrow(\"Access token is expired and failed to fetch a valid one after retries\",ve,this.logger)),p.jwtToken})),this.sendTokenChangedEvent=(l,d)=>{try{this._telemetryLogManager.sendEvent({name:d?kd.acs_calling_token_expiration_changed:kd.acs_calling_token_expiration_changed_failure,tenant:q,properties:{deltaTimeInMs:l}})}catch(l){this.logger.debug(\"Unable to send token change telemetry\")}},this.sendTokenExpiredEvent=()=>{try{this._telemetryLogManager.sendEvent({name:kd.acs_calling_token_expired,tenant:q})}catch(l){this.logger.debug(\"Unable to send token expired telemetry\")}},this._handleCallAdded=l=>{if(!this._calls.find((d=>d.id===l.callId))){const d=l.on(\"callStateChanged\",(()=>{if(1===l.state){const u=l.callId;d.dispose();const p=new CallImpl({callId:u,isIncoming:!0},this,l,this._telemetryLogManager),h=new IncomingCallImpl(p);this._handleCallState(p),p.bindTsCall(),this._eventEmitter.emit(\"incomingCall\",{incomingCall:h})}}))}},this._handleCallState=l=>{l.on(\"stateChanged\",(()=>{try{if(\"Disconnected\"===l.state){this.tsStack?(this._tsCallRegistry.deleteCall(l.tsCall)||this.logger.error(`Failed to remove call from registry, call id: ${l.id}`),l.stats.flushEvents(),this._telemetryLogManager.flushAllEvents(l.id).catch((()=>{this.logger.error(\"Failed to flush telemetry log manager events\")}))):this.logger.info(\"Unable to remove call from registry\")}else\"Connecting\"===l.state&&\"Incoming\"==l.direction&&(this._calls.push(l),this._eventEmitter.emit(\"callsUpdated\",{added:[l],removed:[]}))}catch(l){this.logger.error(\"Failed to handle call state changed event\")}}))},this._handleCallRemoved=l=>{this.logger.info(`removing callId=${l.callId}`);const d=this._calls.find((d=>d.id===l.callId));if(d){const l=this._calls.indexOf(d);-1!==l&&this._calls.splice(l,1),d.dispose(),this._eventEmitter.emit(\"callsUpdated\",{added:[],removed:[d]}),this.logger.info(\"call removed\")}},this.logger=d.createChild(\"CallAgent\"+op++),this._telemetryLogManager=h,this._eventEmitter=new CallingEventEmitter(this.logger),this._callStack=u,this._httpRequestHelper=new HttpRequestHelper(this.logger),this.clientId=p,this._previousTokenExpiration=0,this._tokenFetchTries=0,this._maxNmberOfRetries=(null===(f=null===(g=getAcsEcsConfig())||void 0===g?void 0:g.calling)||void 0===f?void 0:f.maxNumberOfTokenFetchRetries)||ee,this._maxDisplayNameLength=(null===(y=null===(m=getAcsEcsConfig())||void 0===m?void 0:m.calling)||void 0===y?void 0:y.maxDisplayNameLength)||te,this._abortController=new v,this._extensibleApi=new ExtensibleFeatureImpl(this.logger,{callClient:this._callClient,callAgent:this},{tsStack:this.tsStack,callAgent:this,telemetryLogManager:this._telemetryLogManager});for(const l of Iu)l.isCallAgentFeature&&\"OnExtendedObjectConstructor\"===l.activationOptions.activationEvent&&this.feature(l)}get calls(){return this._calls}getExistingCallAgentWithToken(l){return __awaiter$e(this,void 0,void 0,(function*(){try{const d=yield parseTokenCredential(l);return ap.get(d.identityMri)}catch(l){throw new CallingCommunicationError({message:\"Failed to parse AccessToken\",code:ve})}}))}feature(l){return this._extensibleApi.getApiObjectInstance(l.callAgentApiCtor)}getClientId(){return this.clientId}getHttpRequestHelper(){return this._httpRequestHelper}initialize(l,d,u){var p,h,g,f,m;return __awaiter$e(this,void 0,void 0,(function*(){const v=+new Date;try{if(this.sendCallAgentInitializiedEvent(kd.acs_calling_call_agent_init_attempt,{attemptTimestamp:v}),this._communicationTokenCredential=l,this._parsedTokenCredential=yield parseTokenCredential(l,{abortSignal:this._abortController.signal}),ap.get(this._parsedTokenCredential.identityMri)&&logErrorAndThrow(\"Failed to create call agent, call agent for this ACS Id already exists\",Ee,this.logger),null==u?void 0:u.displayName){if(this.isCteUser())throw new CallingCommunicationError({message:\"Display name is not allowed to be set for Teams users.\",code:ve});if((null==u?void 0:u.displayName.length)>this._maxDisplayNameLength)throw new CallingCommunicationError({message:`Display name is too long, max length is ${this._maxDisplayNameLength} characters`,code:ve})}this._caConfigBag={clientId:this.clientId,acsResourceId:this._parsedTokenCredential.acsResourceId,identityMri:this._parsedTokenCredential.identityMri,cloudType:this._parsedTokenCredential.cloudType,identityType:this._parsedTokenCredential.isCte?Yn.Enterprise:Yn.Consumer,emergencyCountryCode:null===(p=null==u?void 0:u.emergencyCallOptions)||void 0===p?void 0:p.countryCode,IsUserEmergencyCountryCode:!!(null===(h=null==u?void 0:u.emergencyCallOptions)||void 0===h?void 0:h.countryCode)},ap.set(this._parsedTokenCredential.identityMri,this),this.onDisposedCallback=d;const g=this._communicationTokenCredential.getToken;this._disposed=!1;const wrappedGetToken=l=>__awaiter$e(this,void 0,void 0,(function*(){const d=+new Date;try{const u=yield g.apply(this._communicationTokenCredential,[l]),p=+new Date;return u.expiresOnTimestamp!==this._previousTokenExpiration&&(this.sendTokenChangedEvent(p-d,!0),this._previousTokenExpiration=u.expiresOnTimestamp),u}catch(l){const u=+new Date;this._previousTokenExpiration=0,this.sendTokenChangedEvent(u-d,!1),logErrorAndThrow(\"Failed to get token\",Ee,this.logger)}}));l.getToken=wrappedGetToken,this.tsStack=yield this._callStack.initializeStackForUser(this.tokenProvider,this._caConfigBag),this._telemetryLogManager.initialize(this._caConfigBag),this._tsCallRegistry=yield this.getCallRegistry(this.tsStack,this._parsedTokenCredential,this.tokenProvider),this.logger.info(`registry created for version number=${getSdkVersion()}`),(null==u?void 0:u.displayName)&&(this._tsCallRegistry.updateDisplayName(null==u?void 0:u.displayName),this.displayName=null==u?void 0:u.displayName);const f=+new Date;this.sendCallAgentInitializiedEvent(kd.acs_calling_call_agent_init_success,{deltaTimeInMs:f-v})}catch(l){this._caConfigBag&&!this._telemetryLogManager.isInitialized()&&this._telemetryLogManager.initialize(this._caConfigBag);const d=new CallingCommunicationError({message:\"Failed to create CallAgent\",code:Ie},l);(null===(g=this._parsedTokenCredential)||void 0===g?void 0:g.identityMri)&&ap.get(null===(f=this._parsedTokenCredential)||void 0===f?void 0:f.identityMri)===this&&ap.delete(null===(m=this._parsedTokenCredential)||void 0===m?void 0:m.identityMri);const u=+new Date;throw this.sendCallAgentInitializiedEvent(kd.acs_calling_call_agent_init_failure,{deltaTimeInMs:u-v},d),this._telemetryLogManager.clearTelemetryLoggers(),d}}))}on(l,d){if(\"incomingCall\"!==l&&\"callsUpdated\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this._eventEmitter.on(l,d)}off(l,d){if(\"incomingCall\"!==l&&\"callsUpdated\"!==l)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${l}, unknown event name`,code:be});this._eventEmitter.off(l,d)}getUserMri(){var l;return`8:${null===(l=this._parsedTokenCredential)||void 0===l?void 0:l.identityMri}`||\"\"}getAcsResourceId(){var l;return(null===(l=this._parsedTokenCredential)||void 0===l?void 0:l.acsResourceId)||\"\"}getTrouterState(){return this._callStack.getTrouterState()}createTransferTargetCall(l){const d=A.generateCauseId(),u=generateGuid(),p=generateGuid(),h=this._tsCallRegistry.createCall(\"\",u,p,void 0,d),g=new CallImpl({callId:u},this,h,this._telemetryLogManager);return this._calls.push(g),this._handleCallState(g),h.init({threadId:\"\",messageId:void 0,transferContext:l,mediaPeerType:0}),h.addParticipant(l.targetMri).catch((()=>{this.logger.error(\"Failed to add participant for transer call\")})),g.bindTsCall(),this._eventEmitter.emit(\"callsUpdated\",{added:[g],removed:[]}),g}getCallByCallId(l,d){var u;return d?this._tsCallRegistry.getCall(l,d):null===(u=this._tsCallRegistry.calls.filter((d=>d.callId===l)))||void 0===u?void 0:u[0]}isCteUser(){var l,d;return void 0!==(null===(l=this._parsedTokenCredential)||void 0===l?void 0:l.isCte)&&(null===(d=this._parsedTokenCredential)||void 0===d?void 0:d.isCte)}startCall(l,d){var u;if(this.assertCallUserIds(l),(null==d?void 0:d.alternateCallerId)&&validateIdentifier(d.alternateCallerId),this.isCteUser()&&l.length>1&&!(null==d?void 0:d.threadId))throw new CallingCommunicationError({message:\"Starting a group call with Teams users must include thread ID in StartCallOptions.\",code:ve});let p=null===(u=null==d?void 0:d.audioOptions)||void 0===u?void 0:u.muted;return void 0===p&&(p=!1),this.logger.info(`startCall with video=${!!(null==d?void 0:d.videoOptions)},muted=${p}`),this.createCall({participants:l,startCallOptions:d})}join(l,d){var u;if(this.isCteUser()&&l.groupId)throw new CallingCommunicationError({message:\"Join using group ID is not supported for Teams users.\",code:ve});this.assertCallContext(l);let p=null===(u=null==d?void 0:d.audioOptions)||void 0===u?void 0:u.muted;return void 0===p&&(p=!1),this.logger.info(`join with video=${!!(null==d?void 0:d.videoOptions)},muted=${p}`),this.createCall({callContext:l,startCallOptions:d})}dispose(){var l,d,u;return __awaiter$e(this,void 0,void 0,(function*(){if(this._disposed)throw new CallingCommunicationError({message:\"Call Agent is already disposed\",code:Ee});this._disposed=!0,this._abortController.abort(),this._extensibleApi.dispose(),(null===(l=this._parsedTokenCredential)||void 0===l?void 0:l.identityMri)&&ap.delete(null===(d=this._parsedTokenCredential)||void 0===d?void 0:d.identityMri);try{const l=this._tokenFetchTries>this._maxNmberOfRetries;yield null===(u=this._callStack)||void 0===u?void 0:u.dispose(l)}catch(l){this.logger.error(\"Call Agent failed to dispose to Call Stack\")}delete this._callStack,this._telemetryLogManager.clearTelemetryLoggers(),this.onDisposedCallback&&this.onDisposedCallback()}))}getCallRegistry(l,d,u){var p,h,g;return __awaiter$e(this,void 0,void 0,(function*(){const f={id:d.identityMri,displayName:this.displayName||\"\",tokenProvider:u},m=yield l.createCallRegistry(f);yield m.login(f);const v=(null===(g=null===(h=null===(p=getAcsEcsConfig())||void 0===p?void 0:p.tsCalling)||void 0===h?void 0:h.accountConfiguration)||void 0===g?void 0:g.ring)||void 0,y=d.isCte?Yn.Enterprise:Yn.Consumer,S=d.acsResourceId;return m.setConfiguration({acsResourceId:S,clientType:y,ring:v}),m.on(\"callAdded\",this._handleCallAdded),m.on(\"callRemoved\",this._handleCallRemoved),m}))}createCall(l){var d,u,p,h,g,f,m,v,y,S,_,C,E,T;let b,I,R,P=(null===(d=null==l?void 0:l.callContext)||void 0===d?void 0:d.threadId)||(null===(u=null==l?void 0:l.startCallOptions)||void 0===u?void 0:u.threadId),O=null===(p=null==l?void 0:l.callContext)||void 0===p?void 0:p.groupId;const M=null===(h=null==l?void 0:l.callContext)||void 0===h?void 0:h.roomId,w=null===(g=null==l?void 0:l.callContext)||void 0===g?void 0:g.meetingLink,N=null===(f=null==l?void 0:l.callContext)||void 0===f?void 0:f.meetingId;if(O&&O.startsWith(\"19:\")&&(P=O,O=\"\"),w&&(I=parseMeetingUrl(w)),(null===(m=null==l?void 0:l.callContext)||void 0===m?void 0:m.threadId)&&(null===(v=null==l?void 0:l.callContext)||void 0===v?void 0:v.organizerId)&&(null===(y=null==l?void 0:l.callContext)||void 0===y?void 0:y.tenantId)&&(I={threadId:null===(S=null==l?void 0:l.callContext)||void 0===S?void 0:S.threadId,messageId:(null===(_=null==l?void 0:l.callContext)||void 0===_?void 0:_.messageId)?null===(C=null==l?void 0:l.callContext)||void 0===C?void 0:C.messageId.toString():\"0\",organizerId:null===(E=null==l?void 0:l.callContext)||void 0===E?void 0:E.organizerId,tenantId:null===(T=null==l?void 0:l.callContext)||void 0===T?void 0:T.tenantId}),I&&(R={meetingType:\"0\"===I.messageId?1:2,tenantId:I.tenantId,organizerId:I.organizerId,replyChainMessageId:I.messageId}||void 0,P=I.threadId,b=I.messageId),this.tsStack){const d=A.generateCauseId(),u=generateGuid(),p=generateGuid();let h;h=O?this._tsCallRegistry.createCallWithGroupId(O,u,p,d):N?this._tsCallRegistry.createCallWithMeetingData({meetingCode:N,threadId:P},u,p,d):M?this._tsCallRegistry.createCallWithMeetingData({meetingCode:M},u,p,d):this._tsCallRegistry.createCall(P||\"\",u,p,b,d);const g=new CallImpl({callId:u},this,h,this._telemetryLogManager);return this._calls.push(g),this._handleCallState(g),h.init({threadId:P||\"\",messageId:b||\"\",meetingInfo:R,mediaPeerType:2}),(null==l?void 0:l.participants)&&(null==l||l.participants.forEach((l=>{h.addParticipant(getMriFromIdentifier(l)).catch((()=>{this.logger.error(\"Failed to add participant during call start\")}))}))),g.startCallInternal(null==l?void 0:l.startCallOptions,!!N||!!M,null==l?void 0:l.callContext).catch(noop),g.bindTsCall(),this._eventEmitter.emit(\"callsUpdated\",{added:[g],removed:[]}),g}throw new CallingCommunicationError({message:\"Failed to start or join call, call stack did not initialize\",code:Ie})}sendCallAgentInitializiedEvent(l,d,u){try{let p=\"string\"==typeof(null==u?void 0:u.message)?null==u?void 0:u.message:void 0;l!==kd.acs_calling_call_agent_init_failure&&(p=void 0),this._telemetryLogManager.sendEvent({name:l,tenant:q,properties:Object.assign(Object.assign({},d),{failureReason:p,additionalInformation:{trouterState:this._callStack.getTrouterState()}})})}catch(l){this.logger.debug(\"Unable to send telemtery\")}}assertCallContext(l){if(!l||this.checkForAtLeastOneValidCallConfig(l)||this.checkIfMultiplesConfigsWereSpecified(l)||this.checkForInvalidTeamsMeetingCoordinates(l))throw new CallingCommunicationError({message:\"Invalid call configuration\",code:ve})}checkForAtLeastOneValidCallConfig(l){return!(l.threadId||l.meetingLink||l.groupId||l.meetingId||l.roomId)}checkIfMultiplesConfigsWereSpecified(l){return l.threadId&&l.groupId||l.groupId&&l.meetingLink}checkForInvalidTeamsMeetingCoordinates(l){return!l.threadId&&l.tenantId&&l.organizerId||l.threadId&&(l.organizerId&&!l.tenantId||!l.organizerId&&l.tenantId)}assertCallUserIds(l){assertIsObject(l,\"userIds must be object\"),assertNotNull(l,\"userIds cannot be null\"),assertIsArrayOfIdentifiers(l,\"userIds must be array of CommunicationIdentifier\"),l.forEach((l=>{validateIdentifier(l)}))}}__decorate$a([loggerProperty,__metadata$a(\"design:type\",Object)],CallAgentImpl.prototype,\"logger\",void 0),__decorate$a([asyncOperation(Ja.Initialize),__metadata$a(\"design:type\",Function),__metadata$a(\"design:paramtypes\",[Object,Function,Object]),__metadata$a(\"design:returntype\",Promise)],CallAgentImpl.prototype,\"initialize\",null),__decorate$a([syncOperation(Ja.StartCall),__metadata$a(\"design:type\",Function),__metadata$a(\"design:paramtypes\",[Array,Object]),__metadata$a(\"design:returntype\",Object)],CallAgentImpl.prototype,\"startCall\",null),__decorate$a([syncOperation(Ja.Join),__metadata$a(\"design:type\",Function),__metadata$a(\"design:paramtypes\",[Object,Object]),__metadata$a(\"design:returntype\",Object)],CallAgentImpl.prototype,\"join\",null),__decorate$a([asyncOperation(Ja.Dispose),__metadata$a(\"design:type\",Function),__metadata$a(\"design:paramtypes\",[]),__metadata$a(\"design:returntype\",Promise)],CallAgentImpl.prototype,\"dispose\",null),__decorate$a([syncOperation(Ja.CreateCall),__metadata$a(\"design:type\",Function),__metadata$a(\"design:paramtypes\",[Object]),__metadata$a(\"design:returntype\",void 0)],CallAgentImpl.prototype,\"createCall\",null);class EcsProvider{constructor(l,d){this.setConfigOrDefault=(l,d)=>{l&&Object.keys(l).forEach((u=>{void 0!==l[u]&&(d[u]=l[u])}))},this._logger=l,this.sdkUserAgent=d;const u=getAcsEcsConfig().calling.applicationSettingsUrls;this._trouterSettings={version:`${getPlatformId()}/${getSdkInternalVersion()}`,productName:\"AcsWeb\",trouterServiceUrl:u.Public_TrouterServiceUrl,registrarServiceUrl:u.Public_RegistrarServiceUrl,maxRegistrationTimeInMs:36e5,pnhAppId:\"AcsWeb\",pnhTemplate:\"AcsWeb_2.0\",environment:\"Prod\",platform:getPlatformName()},this._JsCsaConfig={languageCode:\"en\",emergencyCallCountry:\"\",autoResolveConflictedCall:!1,handleRosterFromCreateAndJoin:!0,conversationServiceUrl:u.Public_ConversationServiceUrl,useInternalHttpDispatcher:!0,supportsHostlessGroupCalls:!0,doHostlessCalling:!0,shouldServiceSendCallEventMessages:!0,shouldServiceSendNGCUpgradeMessages:!0,supportsCompressedServicePayload:!0,handleNewOfferRequest:!0,handleMediaOfferFromPushNotification:!0,isWebRtcEnabled:!0,supportsSynchronousTrouterResponse:!0,autoJoinOnConflict:!0,brokerEnabledOutgoing:!0,brokerEnabledIncoming:!0,brokerExclusively:!1,brokerRequestBatching:!0,isGVCOutgoingEnabled:!0,isGVCJoiningEnabled:!0,enableTokenCache:!1},this._JamaSettingsMobile={webrtcCameraOpenFs:900,webrtcMultipartyMaxScalingFs:900,webrtcMaxScalingFs:900},this._JamaSettings={debug:!1,numVideoChannelsGvc:6,webrtcVideoCapabilityMaxFS:3600,webrtcCameraOpenFs:3600,webrtcMultipartyMaxScalingFs:3600,webrtcMaxScalingFs:3600,webrtcMultiPartyRecvVideoMaxFS:3600,webrtcRecvVideoMaxFS:3600,webrtcRejectedFeatures:\"byPass\",webrtcRequiredFeatures:\"nonByPass\",webrtcEnabledTransportCC:!0,webrtcSimulcastSessionEnabled:!0,webrtcFmtParamListSupported:!0,webrtcAllowRestoreKeyframe:!0,webrtcUnifiedPlanEnabledMultiparty:!0,webrtcUnifiedPlanEnabled1on1:!0,preferSdesSrtp1on1:!1,preferSdesSrtpPstn:!1,preferSdesSrtpMultiparty:!1},this._MDNTrapSettings={Service:{url:u.Public_MdnTrapServiceUrl,tokenUrl:u.Public_MdnTrapServiceTokenUrl},Relay:{Skype:{addresses:[],fqdns:[u.Public_MdnTrapRelaySkypeFqdns],tcpPort:443,udpPort:3478},Turn:{addresses:[],fqdns:[u.Public_MdnTrapRelayTurnFqdns],tcpPort:443,udpPort:3478,url:u.Public_MdnTrapRelayTurnUrl}},Http:{connectionTimeout:30,requestTimeout:60},Token:{earlyRefreshMinutes:1080,earlyRefreshPercentage:25}},this._TrouterJScriptClient={TelemetryEnabled:!1,ClientTelemetryEventEnabled:{trouter_js_client_connected:!1,trouter_js_client_disconnected:!1,trouter_js_client_error:!1,trouter_js_client_progress:!1,trouter_js_client_response:!1,trouter_js_client_check_connection:!1,trouter_js_client_registration:!1,trouter_js_client_unregistration:!1,logHealthCheckError:!1,logSendPingError:!1,numberOfStepsToMaintain:0,sendProgressTimeoutSecs:0}}}getTrouterTelemetryConfig(){return Object.assign({enabled:this._TrouterJScriptClient.TelemetryEnabled},this._TrouterJScriptClient.ClientTelemetryEventEnabled)}getJamaSettings(){const l=getBrowserInfo();let d=this._JamaSettings;return\"Mobile\"==l.formFactor&&(d=Object.assign(Object.assign({},d),this._JamaSettingsMobile)),d}getClientInformation(){const l=getAcsEcsConfig().telemetry.reportSdkUaToService;return`ACSWeb(${getPlatformId()}/${getSdkInternalVersion()})`+(l?`/(${this.sdkUserAgent})`:\"\")}getJsCsaConfig(){return Object.assign(Object.assign({},this._JsCsaConfig),{clientInformation:this.getClientInformation()})}getMdnTrapSettings(){return this._MDNTrapSettings}getTrouterSettings(){return this._trouterSettings}setConfig(l,d){this._logger.info(\"Update ECS settings\");const u=getAcsEcsConfig().calling.applicationSettingsUrls;if((null==l?void 0:l.identityType)==Yn.Enterprise)this._trouterSettings.trouterServiceUrl=u.Enterprise_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=u.Enterprise_RegistrarServiceUrl;else switch(null==l?void 0:l.cloudType){case qn.Public:break;case qn.GccHigh:this._trouterSettings.trouterServiceUrl=u.GccHigh_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=u.GccHigh_RegistrarServiceUrl;break;case qn.Dod:this._trouterSettings.trouterServiceUrl=u.Dod_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=u.Dod_RegistrarServiceUrl;break;case qn.AirGap08:this._trouterSettings.trouterServiceUrl=u.AirGap08_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=u.AirGap08_RegistrarServiceUrl;break;case qn.AirGap09:this._trouterSettings.trouterServiceUrl=u.AirGap09_TrouterServiceUrl,this._trouterSettings.registrarServiceUrl=u.AirGap09_RegistrarServiceUrl}if(d)this.setConfigOrDefault(null==d?void 0:d.SkypeCalling,this._JsCsaConfig),this.setConfigOrDefault(null==d?void 0:d.MDN_TRAP,this._MDNTrapSettings),this.setConfigOrDefault(null==d?void 0:d.SkypeWebMedia.mediaAgent,this._JamaSettings),this.setConfigOrDefault(null==d?void 0:d.TrouterJScriptClient,this._TrouterJScriptClient);else if((null==l?void 0:l.identityType)===Yn.Enterprise)this._JsCsaConfig.conversationServiceUrl=u.Enterprise_ConversationServiceUrl,this._MDNTrapSettings.Service.url=u.Enterprise_MdnTrapServiceUrl,this._MDNTrapSettings.Service.tokenUrl=u.Enterprise_MdnTrapServiceTokenUrl,this._MDNTrapSettings.Relay.Skype.fqdns=[u.Enterprise_MdnTrapRelaySkypeFqdns],this._MDNTrapSettings.Relay.Turn.fqdns=[u.Enterprise_MdnTrapRelayTurnFqdns],this._MDNTrapSettings.Relay.Turn.url=u.Enterprise_MdnTrapRelayTurnUrl;else switch(null==l?void 0:l.cloudType){case qn.Public:break;case qn.GccHigh:this._JsCsaConfig.conversationServiceUrl=u.GccHigh_ConversationServiceUrl,this._MDNTrapSettings.Service.url=u.GccHigh_MdnTrapServiceUrl,this._MDNTrapSettings.Service.tokenUrl=u.GccHigh_MdnTrapServiceTokenUrl,this._MDNTrapSettings.Relay.Skype.fqdns=[u.GccHigh_MdnTrapRelaySkypeFqdns],this._MDNTrapSettings.Relay.Turn.fqdns=[u.GccHigh_MdnTrapRelayTurnFqdns],this._MDNTrapSettings.Relay.Turn.url=u.GccHigh_MdnTrapRelayTurnUrl;break;case qn.Dod:this._JsCsaConfig.conversationServiceUrl=u.Dod_ConversationServiceUrl,this._MDNTrapSettings.Service.url=u.Dod_MdnTrapServiceUrl,this._MDNTrapSettings.Service.tokenUrl=u.Dod_MdnTrapServiceTokenUrl,this._MDNTrapSettings.Relay.Skype.fqdns=[u.Dod_MdnTrapRelaySkypeFqdns],this._MDNTrapSettings.Relay.Turn.fqdns=[u.Dod_MdnTrapRelayTurnFqdns],this._MDNTrapSettings.Relay.Turn.url=u.Dod_MdnTrapRelayTurnUrl;break;case qn.AirGap08:this._JsCsaConfig.conversationServiceUrl=u.AirGap08_ConversationServiceUrl;break;case qn.AirGap09:this._JsCsaConfig.conversationServiceUrl=u.AirGap09_ConversationServiceUrl}}}var sp=createCommonjsModule((function(l,d){var u;u=function(){return function(l){function e(u){if(d[u])return d[u].exports;var p=d[u]={i:u,l:!1,exports:{}};return l[u].call(p.exports,p,p.exports,e),p.l=!0,p.exports}var d={};return e.m=l,e.c=d,e.i=function(l){return l},e.d=function(l,d,u){e.o(l,d)||Object.defineProperty(l,d,{configurable:!1,enumerable:!0,get:u})},e.n=function(l){var d=l&&l.__esModule?function(){return l.default}:function(){return l};return e.d(d,\"a\",d),d},e.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},e.p=\"\",e(e.s=1)}([function(l,d,u){function n(l,d){var u,p=new Promise((function(d,p){fetch(l).then((function(l){clearTimeout(u),d(l)})).catch((function(l){clearTimeout(u),p(l)}))}));if(0!==d){var h=new Promise((function(p,h){u=setTimeout(h,d,new Error(\"Fetch for '\"+l.url+\"' timed out\"))}));return Promise.race([p,h])}return p}function i(l){try{return JSON.stringify(l)}catch(d){return\"Unable to serialize object of type \"+typeof l}}Object.defineProperty(d,\"__esModule\",{value:!0}),d.fetchWithTimeout=n,d.toJson=i;var p=function(){function t(){this.start=Date.now()}return Object.defineProperty(t.prototype,\"duration\",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"startTime\",{get:function(){return this.start},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.start=Date.now()},t}();d.Timespan=p},function(l,d,u){function n(l,d,u){return new y(l,d,u)}var p=this&&this.__extends||function(){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])};return function(d,u){function n(){this.constructor=d}l(d,u),d.prototype=null===u?Object.create(u):(n.prototype=u.prototype,new n)}}(),h=this&&this.__awaiter||function(l,d,u,p){return new(u||(u=Promise))((function(h,g){function s(l){try{c(p.next(l))}catch(l){g(l)}}function a(l){try{c(p.throw(l))}catch(l){g(l)}}function c(l){l.done?h(l.value):new u((function(d){d(l.value)})).then(s,a)}c((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){function r(l){return function(d){return n([l,d])}}function n(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=(h=f.trys).length>0&&h[h.length-1])&&(6===g[0]||2===g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:r(0),throw:r(1),return:r(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(0),m=function(l){function e(d){var u=l.call(this,d)||this;return u.name=\"CancelationError\",u}return p(e,l),e}(Error),v=function(){function t(l,d,u){this.logger=l,this.maxBackoffInMs=d,this.initialDelay=u,this.backoffCount=0,this.id=++t.idCounter}return t.prototype.delay=function(l){var d=this;if(void 0!==this.timerHandle)throw new Error(\"Retry sequence logical failure\");if(-1===this.backoffCount)return new Promise((function(l,d){d(new m(\"Cancelled\"))}));var u=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info(\"[RegistrarClient] Backing off \"+l+\" for \"+u+\" milliseconds with ID \"+this.id),new Promise((function(p,h){d.cancelFunc=h,d.timerHandle=setTimeout((function(){d.logger.info(\"[RegistrarClient] Back off for \"+l+\" with ID \"+d.id+\" complete\"),d.timerHandle=void 0,p()}),u)}))},t.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug(\"Resetting back off\"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new m(\"Cancelled\"))),this.backoffCount=-1},t.prototype.calculateNextBackoffMs=function(){var l=1+.4*(Math.random()-.5),d=this.initialDelay*Math.pow(2,this.backoffCount)*l;return d=Math.round(d),Math.min(this.maxBackoffInMs,d)},t.idCounter=0,t}(),y=function(){function t(l,d,u){this.logger=l,this.skypeTokenProvider=d,this.options=u,this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN=15,this.DEFAULT_MAX_BACKOFF_TIME_IN_MS=3e5,this.backoffs={},this.maxBackOffTime=this.options.maxRetryDelayMs>0?this.options.maxRetryDelayMs:this.DEFAULT_MAX_BACKOFF_TIME_IN_MS,this.maxRetriesForGetToken=void 0===u.maxRetriesForGetToken||null===u.maxRetriesForGetToken?this.DEFAULT_MAX_RETRIES_FOR_GET_TOKEN:u.maxRetriesForGetToken}return t.prototype.setTelemetryLogger=function(l){this.eventLogger=l},t.prototype.register=function(l,d){return h(this,void 0,void 0,(function(){return g(this,(function(u){switch(u.label){case 0:return[4,this.performRegistration(l,d,\"pr_set_registration\")];case 1:return u.sent(),this.cachedRegistrationParams=[l,d],[2]}}))}))},t.prototype.unregister=function(){return h(this,void 0,void 0,(function(){var l;return g(this,(function(d){switch(d.label){case 0:return this.logger.info(\"[RegistrarClient] sending unregister request\"),l=new Request(this.options.registrarUrl+\"/\"+this.options.registrationId,{method:\"DELETE\",mode:\"cors\",headers:new Headers({accept:\"application/json, text/javascript\"})}),[4,this.callRegistrar(l,\"pr_delete_registration\")];case 1:return d.sent(),[2]}}))}))},t.prototype.cancelPendingRequests=function(){var l=this;Object.keys(this.backoffs).forEach((function(d){l.backoffs[d].cancel()})),this.backoffs={}},t.prototype.resendRegistration=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){switch(l.label){case 0:if(!this.cachedRegistrationParams)throw new Error(\"Re-registration failed because there is no registration parameters cached\");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],\"pr_resend_registration\")];case 1:return l.sent(),[2]}}))}))},t.prototype.performRegistration=function(l,d,u){return h(this,void 0,void 0,(function(){var p,h;return g(this,(function(g){switch(g.label){case 0:return this.logger.info(\"[RegistrarClient] Sending register request\"),p={clientDescription:l,registrationId:this.options.registrationId,nodeId:\"\",transports:d},h=new Request(this.options.registrarUrl,{method:\"POST\",mode:\"cors\",headers:new Headers({\"content-type\":\"application/json\",accept:\"application/json, text/javascript\"}),body:f.toJson(p)}),[4,this.callRegistrar(h,u)];case 1:return g.sent(),[2]}}))}))},t.prototype.startBackoff=function(){var l=new v(this.logger,this.maxBackOffTime,this.options.initialRetryDelayMs);return this.backoffs[l.id]=l,l},t.prototype.stopBackoff=function(l){l.cancel(),delete this.backoffs[l.id]},t.prototype.getSkypeToken=function(){return h(this,void 0,void 0,(function(){var l,d,u,p,h,f,m;return g(this,(function(g){switch(g.label){case 0:l=this.startBackoff(),d=0,g.label=1;case 1:return g.trys.push([1,3,,8]),this.logger.info(\"[RegistrarClient] Asking for a new skypetoken\"),[4,this.skypeTokenProvider(!0)];case 2:return u=g.sent(),this.stopBackoff(l),[2,u];case 3:p=g.sent(),g.label=4;case 4:return g.trys.push([4,6,,7]),d++,h=JSON.stringify(p),d>this.maxRetriesForGetToken?(f=\"[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Error: \"+h,this.logger.error(f),this.stopBackoff(l),[2,Promise.reject(f)]):(this.logger.warn(\"[RegistrarClient] Retrying for a new skype token. Retry Count: \"+d+\" Error: \"+h),[4,l.delay(\"Fetching a new skypetoken\")]);case 5:return g.sent(),[3,8];case 6:throw m=g.sent(),this.stopBackoff(l),m;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},t.prototype.callRegistrar=function(l,d){return h(this,void 0,void 0,(function(){var u,p,h,m,v,y,S,_,C,E,T,b,I,A,R;return g(this,(function(g){switch(g.label){case 0:return u=this.startBackoff(),[4,this.skypeTokenProvider(!1)];case 1:p=g.sent(),this.setSkypeTokenHeader(l,p),h=new f.Timespan,m=0,g.label=2;case 2:v=void 0,g.label=3;case 3:return g.trys.push([3,8,13,14]),y=l.clone(),[4,f.fetchWithTimeout(y,this.options.requestTimeoutMs)];case 4:return 401!==(v=g.sent()).status?[3,6]:++m>this.maxRetriesForGetToken?(S=\"[RegistrarClient] getSkypeToken retry limit hit. Will not retry now. Request '\"+l.url+\"' failed with \"+v.status+\" \"+v.statusText,this.logger.error(S),this.stopBackoff(u),[2,Promise.reject(S)]):(this.logger.warn(\"[RegistrarClient] Retry Count \"+m+\". Request '\"+l.url+\"' failed with \"+v.status+\" \"+v.statusText),_=this.setSkypeTokenHeader,C=[l],[4,this.getSkypeToken()]);case 5:return _.apply(this,C.concat([g.sent()])),[3,20];case 6:if(v.status>=500&&v.status<600)throw new Error(\"Fetch for '\"+l.url+\"' failed with \"+v.status+\" \"+v.statusText);g.label=7;case 7:return[3,14];case 8:E=g.sent(),this.logger.error(\"[RegistrarClient] Request failed with \"+E),g.label=9;case 9:return g.trys.push([9,11,,12]),[4,u.delay(\"Registrar call retry\")];case 10:return g.sent(),[3,20];case 11:throw T=g.sent(),this.logger.error(\"[RegistrarClient] Request cancelled\"),this.stopBackoff(u),T;case 12:return[3,14];case 13:return this.sendTelemetryEvent(d,l,v,h),[7];case 14:return this.stopBackoff(u),v.ok?[2,v]:[3,15];case 15:b=void 0,g.label=16;case 16:return g.trys.push([16,18,,19]),A=(I=JSON).stringify,[4,v.json()];case 17:return b=A.apply(I,[g.sent()]),[3,19];case 18:return g.sent(),b=\"no details\",[3,19];case 19:throw R=\"Fetch for '\"+l.url+\"' failed with \"+v.status+\" \"+v.statusText+\" (\"+b+\", MS-CV: \"+v.headers.get(\"MS-CV\")+\")\",this.logger.error(\"[RegistrarClient] \"+R),new Error(R);case 20:return[3,2];case 21:return[2]}}))}))},t.prototype.setSkypeTokenHeader=function(l,d){l.headers.set(\"X-Skypetoken\",d)},t.prototype.sendTelemetryEvent=function(l,d,u,p){if(void 0!==this.eventLogger){var h={name:l,properties:{url:{value:d.url},result_code:{value:void 0!==u?u.status:0},begin_timestamp:{value:p.startTime},elapsed:{value:p.duration}}};this.eventLogger.logEvent(h)}},t}();d.RegistrarClient=y,d.createRegistrarClient=n}])},l.exports=u()})),cp=createCommonjsModule((function(l,d){var u;u=function(l){return function(l){function e(u){if(d[u])return d[u].exports;var p=d[u]={i:u,l:!1,exports:{}};return l[u].call(p.exports,p,p.exports,e),p.l=!0,p.exports}var d={};return e.m=l,e.c=d,e.i=function(l){return l},e.d=function(l,d,u){e.o(l,d)||Object.defineProperty(l,d,{configurable:!1,enumerable:!0,get:u})},e.n=function(l){var d=l&&l.__esModule?function(){return l.default}:function(){return l};return e.d(d,\"a\",d),d},e.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},e.p=\"\",e(e.s=17)}([function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function t(l,d){this.name=l,this.logger=d}return t.prototype.debug=function(l){this.logger.debug(\"[\"+this.name+\"] \"+l)},t.prototype.info=function(l){this.logger.info(\"[\"+this.name+\"] \"+l)},t.prototype.warn=function(l){this.logger.warn(\"[\"+this.name+\"] \"+l)},t.prototype.error=function(l){this.logger.error(\"[\"+this.name+\"] \"+l)},t}();d.Logger=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),d.constants={TROUTER_INIT:\"trouterinit\",TROUTER_READY_EVENT:\"trouterReadyEvent\",TROUTER_READY_TIMEOUT:\"trouterReadyTimeout\",TROUTER_TOKEN_REQUEST:\"trouterTokenRequest\",TROUTER_TOKEN_GET_SUCCEEDED:\"trouterTokenGetSucceeded\",TROUTER_TOKEN_GET_FAILED:\"trouterTokenGetFailed\",TROUTER_RECONNECTING:\"trouterReconnecting\",RENEWAL:\"renewal\",NEW_CONNECTION:\"newConnection\",ENDPOINT_REGISTRATION_FAILED:\"endpointRegistrationFailed\"},d.CLIENT_VERSION=\"2022.22.01.18\",d.HANDLED_MESSAGE_ACK=200,d.UNHANDLED_MESSAGE_ACK=404,d.FAILED_MESSAGE_ACK=500},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0}),function(l){l[l.Unknown=0]=\"Unknown\",l[l.Active=1]=\"Active\",l[l.Inactive=2]=\"Inactive\"}(d.UserActivityState||(d.UserActivityState={}));var p=function(){function t(){}return t}();d.HttpHeaders=p,function(l){l[l.Unknown=0]=\"Unknown\",l[l.Connected=2]=\"Connected\",l[l.Disconnected=3]=\"Disconnected\",l[l.Switching=9]=\"Switching\"}(d.TrouterState||(d.TrouterState={}))},function(l,d,u){function o(l){try{return JSON.stringify(l)}catch(d){return\"Unable to serialize object of type \"+typeof l}}function i(l){var d=Math.round((new Date).getTime()/1e3);return void 0!==l&&l>d?l-d:0}function r(l){return Math.round((new Date).getTime()/1e3)+l}function s(l,d){return p(this,void 0,void 0,(function(){var u,p,g;return h(this,(function(h){return p=new Promise((function(d,p){fetch(l).then((function(l){clearTimeout(u),d(l)})).catch((function(l){clearTimeout(u),p(l)}))})),0!==d?(g=new Promise((function(p,h){u=setTimeout(h,d,new Error(\"Fetch for '\"+l.url+\"' timed out\"))})),[2,Promise.race([p,g])]):[2,p]}))}))}var p=this&&this.__awaiter||function(l,d,u,p){return new(u||(u=Promise))((function(h,g){function s(l){try{a(p.next(l))}catch(l){g(l)}}function c(l){try{a(p.throw(l))}catch(l){g(l)}}function a(l){l.done?h(l.value):new u((function(d){d(l.value)})).then(s,c)}a((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){function n(l){return function(d){return o([l,d])}}function o(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=(h=f.trys).length>0&&h[h.length-1])&&(6===g[0]||2===g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:n(0),throw:n(1),return:n(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(d,\"__esModule\",{value:!0}),d.toJson=o,d.calculateTtlInSec=i,d.calculateExpireTsInSec=r,d.fetchWithTimeout=s;var g=function(){function t(l){this.base=void 0!==l?l:this.createCorrelationVectorBase(),this.extension=0}return t.extend=function(l){return new t(l)},t.prototype.increase=function(){this.extension++},t.prototype.value=function(){return this.base+\".\"+this.extension},t.prototype.createCorrelationVectorBase=function(){for(var l=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+\",d=\"AQgw\",u=\"\",p=0;p<21;p++)u+=l.charAt(Math.floor(Math.random()*l.length));return u+d.charAt(Math.floor(Math.random()*d.length))},t}();d.CorrelationVector=g;var f=function(){function t(){this.start=Date.now()}return Object.defineProperty(t.prototype,\"duration\",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,\"startTime\",{get:function(){return this.start},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.start=Date.now()},t}();d.Timespan=f},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(3),h=function(){function t(l,d,u,p,h,g,f){this.connectionId=l,this.connectedClientId=d,this.domId=u,this.unsecureUrl=p,this.url=h,this.c2cUrlBase=g,this.expirationTsSec=f}return t.prototype.getRemainingTtlInSec=function(){return p.calculateTtlInSec(this.expirationTsSec)},t}();d.ServerState=h,function(l){l[l.Unknown=0]=\"Unknown\",l[l.Modified=1]=\"Modified\",l[l.Snapshot=2]=\"Snapshot\",l[l.Connected=3]=\"Connected\"}(d.UserActivityEventReason||(d.UserActivityEventReason={}))},function(l,d,u){var p=this&&this.__assign||Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l};Object.defineProperty(d,\"__esModule\",{value:!0});var h,g=u(18),f=u(3),m=u(13),v=u(1),y=u(14),S=u(2),_=u(4),C=u(0),E=u(15),T=u(10),b=function(){function t(){this.cv=v.CLIENT_VERSION,this.ua=\"\",this.hr=\"\",this.v=\"\"}return t}(),I=function(){function t(){this[\"force new connection\"]=!0,this.reconnect=!1,this.query=\"\",this.ackTimeoutMs=5e3}return t}(),A=\"MS-CV\",R=function(){function t(l){this.cvCounter=0;var d=JSON.parse(l);this.startTS=d.hasOwnProperty(\"startTS\")?d.startTS:0,this.url=d.hasOwnProperty(\"url\")?d.url:\"\",this.shortUrl=d.hasOwnProperty(\"shortUrl\")?d.shortUrl:\"\",this.body=d.hasOwnProperty(\"body\")?d.body:\"\",this.headers=d.hasOwnProperty(\"headers\")?d.headers:{},this.id=d.hasOwnProperty(\"id\")&&\"number\"==typeof d.id?d.id:-1,this.method=d.hasOwnProperty(\"method\")?d.method:\"\",this.replied=!1,this.timedout=!1,this.timeoutTimerId=0,this.receivedCv=this.headers[A],this.updateCvHeader()}return Object.defineProperty(t.prototype,\"correlationVector\",{get:function(){return this.receivedCv?this.receivedCv+\".\"+this.cvCounter:\"\"},enumerable:!0,configurable:!0}),t.prototype.on=function(l,d){\"data\"===l?this.dataCallback=d:\"end\"===l&&(\"function\"==typeof this.dataCallback&&this.dataCallback(this.body),d())},t.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},t.prototype.updateCvHeader=function(){var l=this.correlationVector;l&&(this.headers[A]=l)},t}(),P=function(){function t(l,d,u){this.request=l,this.responseData=d,this.sendResponse=u}return t.prototype.writeHead=function(l,d){this.responseData.status=l,this.responseData.headers=d},t.prototype.write=function(l){this.responseData.body+=l},t.prototype.end=function(l){return l&&(this.responseData.body+=l),this.sendResponse(this.request,this.responseData)},t}(),O=function(){function t(l){this.name=l,this.args={},this.timeoutTimerId=0}return t}();!function(l){l[l.Configuration=0]=\"Configuration\",l[l.ServerInitiated=1]=\"ServerInitiated\"}(h=d.ReconnectReason||(d.ReconnectReason={}));var M=function(){function t(l,d,u,p,h){var f=this;this.options=d,this.manager=u,this.tokenProvider=p,this.connectionId=\"\",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId=\"\",this.c2cUrlBase=\"\",this.allocationErrorsInRow=0,this.unauthorizedErrorCount=0,this.pendingTimers={},this.lastDisconnectReason=\"\",this.UNKNOWN_TRANSPORT=\"unknown_transport\",this.logger=new C.Logger(\"Connection\",l),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new y.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new y.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),\"undefined\"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new b,this.clientInfo.cv=v.CLIENT_VERSION,this.clientInfo.ua=\"\",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new m.ConnectionTracker(l,this.clientID,this.clientInfo,(function(){return f.getServerState()}),this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(d);var S=this.options.incallModeTimeoutMs>0;if(this.fsm=new E.TrouterFsm(l,this,S),d.registration){var _={registrarUrl:d.registration.registrarUrl,registrationId:d.registration.registrationId,requestTimeoutMs:d.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:d.timeoutOptions.maxBackoffMs};this.registrarClient=g.createRegistrarClient(l,this.tokenProvider,_)}this.userActivityState=h}return t.prototype.start=function(l){this.logger.info(\"Starting\"),this.externalConnectParams=l,this.fsm.start()},t.prototype.stop=function(l){this.logger.info(\"Stopping\"),this.fsm.stop(l),this.connectionTracker.close()},t.prototype.configure=function(l){var d=this.options.trouterUrl!==l.trouterUrl;this.options=l,this.applyConnectionTrackerOptions(l),d&&(this.logger.info(\"Configuration changed. Reconnection required.\"),this.fsm.onReconnectRequired(!1,h.Configuration))},t.prototype.checkConnection=function(l){this.logger.info(\"checkConnection called with \"+l),this.fsm.checkConnection(l),l&&this.connectionTracker.sendTelemetry(m.ClientEventName.CheckConnection,{disconnectDetected:l},[])},t.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegisterTimer(),this.resetRegisterBackoff(),this.fsm.disableAutoReconnect()},t.prototype.getServerState=function(){return new _.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:\"\",this.allocateResult?this.allocateResult.url:\"\",this.allocateResult?this.allocateResult.surl:\"\",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},t.prototype.getToken=function(l,d,u){var p=this;void 0===u&&(u=0),this.logger.info(\"Getting token \"+(d?\"with backoff\":\"without backoff\"));var i=function(){p.connectionTracker.trackStart(\"token\"),p.tokenProvider(!l).then((function(l){p.logger.debug(\"token is received\"),p.connectionTracker.trackEnd(\"token\"),p.fsm.onTokenReceived(l)})).catch((function(d){var h=f.toJson(d.stack);if(p.logger.error(\"Getting token failed, will retry after timeout. Error: \"+h),p.connectionTracker.trackError(\"token\",h),!p.canRetryTokenFetchRequest(u+p.unauthorizedErrorCount))return p.connectionTracker.trackError(\"token\",\"getToken retry limit hit, reached terminal error state\"),p.resetTokenBackoff(),void p.fsm.onTerminalError();p.getToken(l,!0,u+1)}))};d?this.tokenBackoff.backoff(\"getting token\",i):(this.resetTokenBackoff(),i())},t.prototype.startConnectionTimer=function(){var l=this;this.stopConnectionTimer(),this.logger.debug(\"Starting connection timeout for \"+this.timeoutOptions.connectionTimeoutMs+\" ms\"),this.connectionTimeoutId=setTimeout((function(){l.logger.info(\"Connection timeout is fired\"),l.fsm.onConnectingTimeout()}),this.timeoutOptions.connectionTimeoutMs)},t.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug(\"Stopping connection timeout\"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},t.prototype.startPingTimer=function(){var l=this;\"websocket\"===this.transportTypeName?(this.logger.debug(\"Starting ping timeout for \"+this.timeoutOptions.pingTimeoutMs+\" ms\"),this.pingTimerId=setInterval((function(){l.logger.info(\"Ping interval fired\"),l.fsm.onPingInterval()}),this.timeoutOptions.pingTimeoutMs)):this.logger.debug(\"Not starting ping for transport \"+this.transportTypeName)},t.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug(\"Stopping ping timeout\"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},t.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},t.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},t.prototype.startRegisterTimer=function(){var l=this;void 0!==this.registrationTimerId&&this.stopRegisterTimer();var d=this.getRegistrationTtl(),u=d[0],p=(d[1],u-30);p<=0?this.logger.debug(\"Not starting registration timer, ttl too low(\"+u+\" sec)\"):(this.logger.debug(\"Starting registration timeout for \"+p+\" sec\"),this.registrationTimerId=setTimeout((function(){l.logger.info(\"Registration timeout is fired\"),l.registrationTimerId=setTimeout((function(){l.registrationTimerId=void 0,l.logger.debug(\"Re-registration did not happen in time\"),l.dispatchUnregistered()}),3e4),l.fsm.onRegistrationTimeout()}),1e3*p))},t.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug(\"Stopping registration timeout\"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},t.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error(\"Trouter Client not configured to handle registrations\");return this.registrarClient.resendRegistration()},t.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error(\"Allocate result is undefined in buildSocketIoUrlParams()\");for(var l={},d=this.allocateResult.connectparams,u=0,p=Object.keys(d);u<p.length;u++){var h=p[u];d.hasOwnProperty(h)&&void 0!==d[h]&&(l[h]=d[h])}return l.v=\"v4\",l.tc=encodeURI(f.toJson(this.clientInfo)),l.timeout=this.timeoutOptions.pingTimeoutMs/1e3,l.auth=\"true\",this.options.endpointId&&(l.epid=this.options.endpointId),this.userActivityState.state!==S.UserActivityState.Unknown&&(l.userActivity=encodeURI(f.toJson(this.userActivityState.toEventObject()))),this.appendConnectedClientIds(this.buildQuery(l),!0)},t.prototype.startSocketIo=function(){var l=this;if(this.logger.info(\"Starting socket io\"),this.connectionTracker.trackStart(\"connectSocket\"),!this.allocateResult)throw new Error(\"Allocate result is undefined in startSocketIo()\");var d=this.options.ioOptions||new I;if(d[\"force new connection\"]=!0,d.reconnect=!1,d.query=this.buildSocketIoUrlParams(),this.logger.info(\"connecting to \"+this.allocateResult.socketio+\"?\"+d.query),this.stopSocketIo(),this.socket=(this.options.io||T).connect(this.allocateResult.socketio,d),void 0===this.socket)throw new Error(\"Can't create Socket.io object\");this.socket.on(\"connecting\",(function(d){l.onSocketConnecting(d)})),this.socket.on(\"connect\",(function(){l.onSocketConnect()})),this.socket.on(\"connect_failed\",(function(d){l.onSocketConnectFailed(d)})),this.socket.on(\"disconnect\",(function(d){l.onSocketDisconnect(d)})),this.socket.on(\"reconnect\",(function(){l.onSocketReconnect()})),this.socket.on(\"reconnect_failed\",(function(d){l.onSocketReconnectFailed(d)})),this.socket.on(\"reconnecting\",(function(){l.onSocketReconnecting()})),this.socket.on(\"error\",(function(d){l.onSocketError(d)})),this.socket.on(\"message\",(function(d){l.onSocketMessage(d)})),this.socket.on(\"trouter.connected\",(function(d){l.onTrouterConnected(d)})),this.socket.on(\"trouter.reconnect\",(function(d){l.onTrouterReconnect(d)})),this.socket.on(\"trouter.message_loss\",(function(d){l.onTrouterMessageLoss(d)}))},t.prototype.stopSocketIo=function(){if(this.socket){this.logger.info(\"clearing socket.io\");try{for(var l=0,d=[\"connecting\",\"connect\",\"connect_failed\",\"disconnect\",\"reconnect\",\"reconnect_failed\",\"reconnecting\",\"error\",\"message\",\"trouter.connected\",\"trouter.reconnect\",\"trouter.message_loss\"];l<d.length;l++){var u=d[l];this.socket.removeAllListeners(u)}this.socket.disconnect(),this.logger.debug(\"cleared socket\"),this.socket=void 0}catch(l){this.logger.error(\"exception in disconnecting previous socket. Error: \"+f.toJson(l.stack))}}},t.prototype.dispatchConnected=function(){this.logger.info(\"dispatching connected\"),this.manager.onConnected(this)},t.prototype.dispatchRegistered=function(){this.logger.info(\"dispatching registered\"),this.manager.onRegistered(this)},t.prototype.dispatchUnregistered=function(){this.logger.info(\"dispatching unregistered\"),this.manager.onUnregistered(this)},t.prototype.dispatchDownstreamRequest=function(l){var d=this;this.logger.info(\"dispatching downstream request\");try{var u=new P(l,new m.ResponseData(l.id),(function(l,u){return d.logger.info(\"sending response to downstream\"),d.sendResponse(l,u)}));this.manager.onDownstreamRequest(this,l,u)}catch(l){this.logger.error(\"exception in socket.on message. Error : \"+f.toJson(l.stack))}},t.prototype.dispatchReconnecting=function(){this.logger.info(\"dispatching reconnecting\"),this.manager.onReconnecting(this)},t.prototype.dispatchReconnectIsRequired=function(l,d){this.logger.info(\"dispatching reconnect is required by server\"),this.manager.onReconnectIsRequired(this,l,d)},t.prototype.dispatchDisconnected=function(){this.logger.info(\"dispatching disconnected\"),this.manager.onDisconnected(this)},t.prototype.dispatchTrouterMessageLost=function(l){this.logger.info(\"dispatching trouter lost message\"),this.manager.onTrouterMessageLost(l)},t.prototype.sendProcessedDroppedIndicators=function(l){var d=this;try{this.logger.info(\"emitting processed flow tags to the server\");var u=new O(\"trouter.processed_message_loss\");u.args={droppedIndicators:l},this.sendDownstreamEvent(u,(function(){d.logger.info(\"emitted processed flow tags to the server\")}))}catch(l){var p=f.toJson(l.stack);this.logger.error(\"unable to send processed message loss event. Error: \"+p),this.connectionTracker.trackError(\"trouter.processed_message_loss\",p,!1)}},t.prototype.resetAllocationConnectionParams=function(){this.allocateResult&&(this.logger.info(\"Resetting allocation connection parameters\"),this.allocateResult=void 0)},t.prototype.sendAllocateRequest=function(l){var d=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var u,h=this.options.trouterUrl,g=h;if(this.allocateResult)g=this.getReconnectUrlFromAllocateResult(this.allocateResult),u=this.allocateResult.connectparams;else{var m=this.externalConnectParams;m&&m.se&&parseInt(m.se,10)<=Date.now()+36e5&&(this.logger.warn(\"Dropping expired cached connection parameters: \"+new Date(parseInt(m.se,10))),this.externalConnectParams=m=void 0),m&&m.serviceUrl!==g&&(this.logger.warn(\"Dropping cached connection parameters for a different environment (\"+m.serviceUrl+\", now \"+g+\")\"),this.externalConnectParams=m=void 0),m&&m.reconnectUrl?(g=m.reconnectUrl,u=p({},m,{reconnectUrl:void 0})):u=m}g=this.appendCorrelationIds(g,!1),g=this.appendEndpointId(g,!1),u&&(g+=\"&\"+this.buildQuery(u),u.v||(g+=\"&v=v4\"));var v=new Request(g,{method:\"POST\",mode:\"cors\",headers:new Headers({\"X-Skypetoken\":l,\"Content-Type\":\"text/plain\"})});this.logger.info(\"sendAllocateRequest: POST \"+g),this.connectionTracker.trackStart(\"allocation\");var y=-1;f.fetchWithTimeout(v,this.timeoutOptions.fetchTimeoutMs).then((function(l){if(y=l.status,!l.ok)throw new Error(l.statusText);var u=l.headers.get(\"content-type\");if(!u||\"application/json\"!==u&&\"application/json;\"!==u.substring(0,17))throw new Error(\"Content-type '\"+u+\"' is unexpected\");return d.connectionTracker.trackEnd(\"allocation\"),l.json()})).then((function(l){d.allocationErrorsInRow=0,d.unauthorizedErrorCount=0,d.onAllocationResponse(l,h)})).catch((function(l){d.allocationErrorsInRow++;var u=l+\", status code \"+y;if(d.logger.error(d.allocationErrorsInRow+\" failed allocation attempts in a row. Error: \"+u),d.connectionTracker.trackError(\"allocation\",u),d.allocationErrorsInRow>=2&&d.resetAllocationConnectionParams(),401===y&&d.unauthorizedErrorCount++,!d.canRetryTokenFetchRequest(d.unauthorizedErrorCount))return d.connectionTracker.trackError(\"allocation\",\"getToken retry limit hit, reached terminal error state\"),void d.fsm.onTerminalError();d.externalConnectParams&&d.connectionAttempt>2&&(y>=400&&y<=599?(d.logger.warn(d.connectionAttempt+\" connection attempts, server-side failure: erasing external connection parameters\"),d.externalConnectParams=void 0):d.externalConnectParams.reconnectUrl&&(d.logger.warn(d.connectionAttempt+\" connection attempts, erasing reconnect URL\"),delete d.externalConnectParams.reconnectUrl)),d.fsm.onAllocationFailed(401===y)}))},t.prototype.sendPingRequest=function(){var l=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info(\"emitting ping event\");var d=!1;this.socket.emit(\"ping\",(function(){!0!==d&&l.onPingResponse()})),this.pingResponseTimerId=setTimeout((function(){l.logger.error(\"Ping response timeout is fired\"),d=!0,l.clearPingResponseTimer(),l.fsm.onPingResponseTimeout()}),this.timeoutOptions.pongTimeoutMs)}catch(l){var u=f.toJson(l.stack);this.logger.error(\"unable to send ping. Error: \"+u),this.connectionTracker.trackError(\"ping\",u,!1)}},t.prototype.setUserActivityState=function(l){var d=l.state!==this.userActivityState.state;this.userActivityState=l,this.fsm.onSetUserActivityState(l,d)},t.prototype.sendUserActivityState=function(l,d){this.userActivityState.state!==S.UserActivityState.Unknown&&(\"websocket\"===this.transportTypeName&&d?l===_.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):\"xhr-polling\"===this.transportTypeName&&l===_.UserActivityEventReason.Modified&&this.fsm.forceReconnect(\"user activity/force reconnect\"))},t.prototype.sendRegisterRequest=function(){var l=this;if(!this.options.registration||!this.registrarClient)throw new Error(\"Internal error - options.registration is undefined\");if(!this.allocateResult)throw new Error(\"Allocate result is undefined in sendRegisterRequest()\");this.logger.info(\"sending register request\");var d=new f.Timespan;this.connectionTracker.trackStart(\"registration\");var u=this.getRegistrationTtl(),p=u[0],h=u[1];this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:\"\",languageId:\"en-US\",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:p}]}).then((function(){l.logger.info(\"Register request successful\"),l.connectionTracker.trackEnd(\"registration\"),l.fsm.onRegistrationSucceed(h),l.connectionTracker.sendTelemetry(m.ClientEventName.Registration,{duration:d.duration},[])})).catch((function(u){l.logger.error(\"Register request failed. Error: \"+u),l.connectionTracker.trackError(\"registration\",u.message),l.fsm.onRegistrationFailed(!1),l.connectionTracker.sendTelemetry(m.ClientEventName.Registration,{duration:d.duration},[])}))},t.prototype.sendUnregisterRequest=function(){var l=this;this.logger.info(\"sending unregister request\");var d=new f.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error(\"Internal error - options.registration is undefined\");this.connectionTracker.trackStart(\"unregistration\"),this.registrarClient.unregister().then((function(){l.logger.info(\"Unregister request successful\"),l.connectionTracker.trackEnd(\"unregistration\"),l.fsm.onUnregistrationSucceed(),l.connectionTracker.sendTelemetry(m.ClientEventName.Unregistration,{duration:d.duration},[])})).catch((function(u){l.logger.error(\"Unregister request failed. Error: \"+u),l.connectionTracker.trackError(\"unregistration\",u.message),l.fsm.onUnregistrationFailed(!1),l.connectionTracker.sendTelemetry(m.ClientEventName.Unregistration,{duration:d.duration},[])}))},t.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},t.prototype.resetRegisterBackoff=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},t.prototype.clearTimers=function(){this.logger.debug(\"Clearing all pending downstream events related timers\");for(var l=0,d=Object.keys(this.pendingTimers);l<d.length;l++){var u=d[l];this.clearTimer(Number(u))}},t.prototype.restartIncallModeTimer=function(){var l=this;this.clearIncallModeTimerId(),this.logger.debug(\"Restarting incall mode timer\"),this.incallModeTimerId=setTimeout((function(){l.logger.info(\"Call mode timer fired\"),l.fsm.onIncallModeTimer()}),this.options.incallModeTimeoutMs)},t.prototype.enterIncallMode=function(){this.logger.info(\"Entering incall mode\"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},t.prototype.exitIncallMode=function(){this.logger.info(\"Exiting incall mode\"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},t.prototype.isIncallMode=function(){return this.inIncallMode},t.prototype.sendDisconnectTelemetryEvent=function(l){var d={reason:l,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(d),this.connectionTracker.clearConnectedInfo()},t.prototype.onSocketConnecting=function(l){this.logger.info(\"onSocketConnecting(\"+l+\")\"),this.transportTypeName=l,this.connectionTracker.trackProgress(\"connecting\",this.transportTypeName),this.fsm.onConnecting()},t.prototype.onSocketConnect=function(){this.logger.info(\"onSocketConnect\")},t.prototype.onSocketConnectFailed=function(l){this.logger.error(\"onSocketConnectFailed\"),this.connectionTracker.trackError(\"connect_failed\",l,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},t.prototype.onSocketDisconnect=function(l){this.logger.error(\"onSocketDisconnect, reason: \"+l);var d=this.connectionTracker.getSessionLength()||0;\"dup\"===l&&\"dup\"===this.lastDisconnectReason&&d<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn(\"Socket was closed by server as Duplicate for the second time in a row after \"+d+\" ms which is below the threshold of \"+this.options.duplicateDisconnectThresholdMs+\" ms. Resetting cached connection parameters and making a new allocation.\"),this.resetAllocationConnectionParams()),this.lastDisconnectReason=l,this.fsm.onSocketDisconnect(l),this.connectionExpireTimestampInSecs=void 0},t.prototype.onSocketReconnect=function(){this.logger.error(\"onSocketReconnect\"),this.fsm.onTrouterConnected()},t.prototype.onSocketReconnectFailed=function(l){this.logger.error(\"onSocketReconnectFailed with '\"+l+\"'\"),this.fsm.onSocketDisconnect(\"string\"==typeof l?l:void 0)},t.prototype.onSocketReconnecting=function(){this.logger.error(\"onSocketReconnecting\")},t.prototype.onSocketError=function(l){this.logger.error(\"onSocketError with '\"+f.toJson(l)+\"'\"),this.connectionTracker.trackError(\"connectSocket\",l),this.fsm.onSocketDisconnect(\"string\"==typeof l?l:void 0)},t.prototype.onSocketMessage=function(l){var d,u=this;this.logger.info(\"onSocketMessage\");try{var p=(d=new R(l)).headers&&d.headers[\"X-Microsoft-Skype-Chain-ID\"],h=p?\" Chain-Id \"+p:\"\";this.logger.info(\"Received request N \"+d.id+h+\" CV \"+d.correlationVector+\" to '\"+d.url+\"'\"),d.startTS=Date.now(),d.url&&this.urlPath&&0===d.url.indexOf(this.urlPath)&&(d.shortUrl=d.url.substring(this.urlPath.length))}catch(l){var g=f.toJson(l.stack);return this.logger.error(\"unable to parse request. Error: \"+g),this.connectionTracker.trackRequest(void 0,g),void this.connectionTracker.sendResponseError(\"unable to parse request, error: \"+l)}d.timeoutTimerId=setTimeout((function(){if(!d.replied){u.logger.error(\"Request \"+d.id+\" timed out\");var l=new m.ResponseData(d.id);l.status=504,l.headers={\"Trouter-Responder\":\"ClientLib\"},u.sendResponse(d,l),d.timedout=!0}}),this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(d),this.fsm.onDownstreamRequest(d)}catch(l){this.logger.error(\"exception in socket.on message. Error: \"+f.toJson(l.stack)),this.connectionTracker.sendResponseError(l.message,d,void 0)}},t.prototype.onTrouterConnected=function(l){if(this.allocateResult){this.logger.info(\"onTrouterConnected: \"+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+=\"&connected=true\"),this.urlPath=this.allocateResult.url.replace(/https?:\\/\\/([A-z0-9\\:\\$\\-\\_\\.\\+\\!\\*\\\"\\(\\)\\,]*)\\//,\"/\");var d=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=f.calculateExpireTsInSec(l.ttl),this.connectionTracker.trackEnd(\"connectSocket\"),this.connectionTracker.trackConnected(d,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error(\"Invalid internal state - received onTrouterConnected while allocateResult is not set\")},t.prototype.onTrouterReconnect=function(l){var d=l.target;this.logger.info(\"onTrouterReconnect target: \"+d),\"self\"===d?this.fsm.onReconnectRequired(!0,h.ServerInitiated):this.fsm.onReconnectRequired(!1,h.ServerInitiated)},t.prototype.onTrouterMessageLoss=function(l){this.logger.info(\"onTrouterMessageLoss\"),this.fsm.onTrouterMessageLost(l.droppedIndicators)},t.prototype.getReconnectUrlFromAllocateResult=function(l){return l.socketio+\"v4/a\"},t.prototype.onAllocationResponse=function(l,d){this.logger.info(\"Received allocation response \"+JSON.stringify(l)),this.allocateResult=l,this.externalConnectParams=void 0;var u=+l.ttl;if(this.connectionExpireTimestampInSecs=f.calculateExpireTsInSec(u),this.connectionId=this.allocateResult.id||\"\",this.connectedClientId=this.allocateResult.ccid,this.logger.info(\"connected client id set {connectedClientId:\"+this.connectedClientId+\"}\"),this.c2cUrlBase=l.curlb||\"\",\"\"===this.c2cUrlBase){var h=l.surl.indexOf(\"://\");h>=0&&(h=l.surl.indexOf(\"/\",h+3))>=5&&\":3443\"===l.surl.substr(h-5,5)&&(this.c2cUrlBase=l.surl.substr(0,h-5))}var g=p({serviceUrl:d,reconnectUrl:this.getReconnectUrlFromAllocateResult(this.allocateResult)},l.connectparams);this.manager.onConnectionParametersUpdated(g),this.fsm.onAllocationSucceed()},t.prototype.onPingResponse=function(){this.logger.info(\"onPingResponse\"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},t.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},t.prototype.buildQuery=function(l){for(var d=[],u=0,p=Object.keys(l);u<p.length;u++){var h=p[u];l.hasOwnProperty(h)&&void 0!==l[h]&&d.push(h+\"=\"+l[h])}return d.join(\"&\")},t.prototype.appendConnectedClientIds=function(l,d){var u=\"\";l.indexOf(\"ccid=\")<0&&(u=\"ccid=\"+this.connectedClientId+\"&\"),this.domId&&(u+=\"dom=\"+this.domId+\"&\"),u.length>0&&(u=u.slice(0,-1));var p=d||-1!==l.indexOf(\"?\")?\"&\":\"?\";return this.appendCorrelationIds(l+p+u,d)},t.prototype.appendEndpointId=function(l,d){var u=d||-1!==l.indexOf(\"?\")?\"&\":\"?\";return l.indexOf(\"epid\")<0&&this.options.endpointId?\"\"+l+u+\"epid=\"+this.options.endpointId:l},t.prototype.appendCorrelationIds=function(l,d){var u=d||-1!==l.indexOf(\"?\")?\"&\":\"?\";return l.indexOf(\"cor_id\")<0?\"\"+l+u+\"cor_id=\"+this.options.clientCorrelationID+\"&con_num=\"+this.clientID+\"_\"+this.connectionAttempt:l},t.prototype.safeString=function(l){return\"string\"==typeof l?l:\"\"},t.prototype.sendResponse=function(l,d){if(l.timedout)return this.logger.error(\"Request \"+l.id+\" already timed out\"),1;if(l.replied)return this.logger.error(\"Response for request \"+l.id+\" already sent\"),2;clearTimeout(l.timeoutTimerId),l.timeoutTimerId=0,l.replied=!0,d.headers=d.headers||{};var u=l.correlationVector;this.logger.info(\"Sending response for request N \"+l.id+\" CV \"+u+\" with status \"+d.status),u&&(d.headers[A]=u),l.headers&&l.headers[\"trouter-request\"]&&!d.headers[\"trouter-request\"]&&(d.headers[\"trouter-request\"]=l.headers[\"trouter-request\"]);var p=Date.now()-l.startTS;if(d.headers[\"trouter-client\"]=f.toJson({cd:p}),this.logger.debug(\"response: \"+f.toJson(d)),!this.socket)return this.connectionTracker.sendResponseError(\"no socket\",l,d),4;try{return this.socket.send(f.toJson(d)),d.sentTS=Date.now(),l.incrementCorrelationVector(),this.connectionTracker.trackResponse(l,p,d),\"websocket\"===this.transportTypeName&&this.sendPingRequest(),0}catch(u){var h=\"unable to send data on response.end. Error: \"+f.toJson(u.stack);return this.logger.error(h),this.connectionTracker.sendResponseError(h,l,d),4}},t.prototype.sendUserActivityStateMultiple=function(l){var d=this,u=new O(\"user.activity\"),p=this.userActivityState.toEventObject();u.args=p,this.userActivityState.correlationVector.increase(),this.logger.debug(\"Sending user activity '\"+this.userActivityState.toEventJSON()+\"', remaining \"+(l-1));var h=!1;this.sendDownstreamEvent(u,(function(){if(!0!==h&&(d.logger.info(\"User activity state: \"+p.state+\", cv: \"+p.cv+\" accepted\"),d.manager.onUserActivityStateAccepted&&d.manager.onUserActivityStateAccepted(p.cv),d.clearTimer(u.timeoutTimerId),l>1)){var g=setTimeout((function(){d.clearTimer(g),d.sendUserActivityStateMultiple(l-1)}),d.options.userActivitySecondResendDelayMs);d.registerTimer(g,\"user.activity/resend\")}})),u.timeoutTimerId=setTimeout((function(){d.logger.error(\"Activity state response timeout is fired\"),h=!0,d.fsm.onActivityStateResponseTimeout(),d.clearTimer(u.timeoutTimerId)}),this.timeoutOptions.userActivityResponseTimeoutMs),this.registerTimer(u.timeoutTimerId,\"user.activity/response\")},t.prototype.sendDownstreamEvent=function(l,d){this.logger.info(\"Sending downstream event \"+l.name),this.socket&&this.socket.emit(l.name,l.args,d)},t.prototype.registerTimer=function(l,d){this.logger.debug(\"registering timer \"+l+\" -> \"+d),this.pendingTimers[l]=d},t.prototype.clearTimer=function(l){var d=this.pendingTimers[l];this.logger.debug(\"clearing timer \"+l+\" -> \"+d),delete this.pendingTimers[l],clearTimeout(l)},t.prototype.getRegistrationTtl=function(){var l=f.calculateTtlInSec(this.connectionExpireTimestampInSecs);if(this.logger.debug(\"Current connectionID will expire in \"+l+\" seconds\"),this.options.registration&&this.options.registration.registrarTtlSec&&l>0){var d=this.options.registration.registrarTtlSec<l;return[Math.min(this.options.registration.registrarTtlSec,l),d]}return this.options.registration&&this.options.registration.registrarTtlSec?[this.options.registration.registrarTtlSec,!1]:l>0?[l,!1]:[3600,!1]},t.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug(\"Clearing in-call mode timer\"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},t.prototype.applyConnectionTrackerOptions=function(l){try{l.eventLogger&&\"function\"==typeof l.eventLogger.logEvent?(this.connectionTracker.mergeSettings(l.telemetrySettings),this.connectionTracker.enable(l.eventLogger)):this.logger.warn(\"Trouter client event logging disabled due to invalid configuration.\")}catch(l){this.logger.warn(\"Trouter client event logging disabled. Error: \"+f.toJson(l.stack)),this.connectionTracker.disable()}},t.prototype.canRetryTokenFetchRequest=function(l){var d=this.options.retryLimitOnTokenFetch;return null==d||l<d||(this.logger.warn(\"Reached limit on maximum number of token fetch request. Current count: \"+l+\", retry limit: \"+d),!1)},t}();d.TrouterConnection=M},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(1),h=function(){function t(l){this.logger=l,this.messageHandlers=[]}return t.prototype.register=function(l){if(this.messageHandlers.some((function(d){return d===l})))throw new Error(\"Registering the same handler twice is not allowed\");this.messageHandlers.push(l)},t.prototype.clear=function(){this.logger.debug(\"Clearing message handlers\"),this.messageHandlers=[]},t.prototype.active=function(){return this.messageHandlers.length>0},t.prototype.handleMessage=function(l){for(var d={resultCode:p.UNHANDLED_MESSAGE_ACK,isHandled:!1},u=0,h=this.messageHandlers;u<h.length;u++){var g=h[u],f=this.safeExecuteHandle(g,l);if(void 0!==f&&(void 0===f.isHandled||f.isHandled))return void 0===f.resultCode&&(f.resultCode=p.HANDLED_MESSAGE_ACK),f}return d},t.prototype.safeExecuteHandle=function(l,d){try{return l.handleMessage(d)}catch(l){return void this.logger.warn(\"A trouter message handler is throwing exceptions. exception: \"+l)}},t}();d.MessageHandlerRegistry=h},function(l,d,u){function o(l){var d,u=this;return function(g){return p(u,void 0,void 0,(function(){return h(this,(function(u){return g&&(d=void 0),[2,new Promise((function(u,p){l(g).then((function(l){d=l,u(l)})).catch((function(l){void 0!==d&&d.length>0&&u(d),p(l)}))}))]}))}))}}var p=this&&this.__awaiter||function(l,d,u,p){return new(u||(u=Promise))((function(h,g){function s(l){try{a(p.next(l))}catch(l){g(l)}}function c(l){try{a(p.throw(l))}catch(l){g(l)}}function a(l){l.done?h(l.value):new u((function(d){d(l.value)})).then(s,c)}a((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){function n(l){return function(d){return o([l,d])}}function o(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=(h=f.trys).length>0&&h[h.length-1])&&(6===g[0]||2===g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:n(0),throw:n(1),return:n(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(d,\"__esModule\",{value:!0}),d.addCacheAsBackupTo=o},function(l,d,u){var p=this&&this.__awaiter||function(l,d,u,p){return new(u||(u=Promise))((function(h,g){function s(l){try{a(p.next(l))}catch(l){g(l)}}function c(l){try{a(p.throw(l))}catch(l){g(l)}}function a(l){l.done?h(l.value):new u((function(d){d(l.value)})).then(s,c)}a((p=p.apply(l,d||[])).next())}))},h=this&&this.__generator||function(l,d){function n(l){return function(d){return o([l,d])}}function o(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=(h=f.trys).length>0&&h[h.length-1])&&(6===g[0]||2===g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:n(0),throw:n(1),return:n(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(d,\"__esModule\",{value:!0});var g=u(3),f=u(2),m=u(0),v=u(5),y=u(16),S=function(){function t(l,d){this.state=l,this.correlationVector=void 0!==d?d:g.CorrelationVector.extend()}return t.prototype.getStateString=function(){switch(this.state){case f.UserActivityState.Active:return\"active\";case f.UserActivityState.Inactive:return\"inactive\";case f.UserActivityState.Unknown:return\"unknown\";default:return\"undefined\"}},t.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},t.prototype.toEventJSON=function(){return g.toJson(this.toEventObject())},t}();d.UserActivityObject=S;var _=function(){function t(l,d,u,p){this.logFunc=l,this.options=d,this.tokenProvider=u,this.listener=p,this.logger=new m.Logger(\"Manager\",l),this.logger.info(\"Created TrouterManager with options \"+g.toJson(this.options)),this.fsm=new y.TrouterManagerFsm(l,this),this.baseEndpointUrl=\"\",this.processedMessageLoss={},this.userActivityObject=new S(f.UserActivityState.Unknown)}return t.prototype.start=function(){this.fsm.start()},t.prototype.stop=function(l){this.fsm.stop(l)},t.prototype.configure=function(l){this.options=l,void 0!==this.firstConnection&&this.firstConnection.configure(l),void 0!==this.secondConnection&&this.secondConnection.configure(l),this.logger.info(\"Reconfigured TrouterManager with options \"+g.toJson(this.options))},t.prototype.checkConnection=function(l){void 0!==this.firstConnection&&this.firstConnection.checkConnection(l),void 0!==this.secondConnection&&this.secondConnection.checkConnection(l)},t.prototype.resendRegistration=function(){return p(this,void 0,void 0,(function(){return h(this,(function(l){return void 0!==this.secondConnection?(this.logger.info(\"Resending registration on the second/new connection\"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info(\"Resending registration on the first/current connection\"),[2,this.firstConnection.resendRegistration()]):(this.logger.info(\"No connection to resend registration on, will be done upon (re)connect\"),[2])}))}))},t.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},t.prototype.getState=function(){return this.fsm.getState()},t.prototype.startFirstConnection=function(){var l=new v.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject);this.firstConnection=l,this.getConnectionCache().then((function(d){l.start(d)})).catch()},t.prototype.startSecondConnection=function(l){var d=new v.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject);this.secondConnection=d,void 0!==this.firstConnection&&this.firstConnection.disableRegistrationsAndAutoReconnect(),l?this.getConnectionCache().then((function(l){d.start(l)})).catch():d.start()},t.prototype.stopFirstConnection=function(l){void 0!==this.firstConnection&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(l),this.firstConnection=void 0)},t.prototype.stopSecondConnection=function(l){void 0!==this.secondConnection&&(this.secondConnection.stop(l),this.secondConnection=void 0)},t.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var l=this.secondConnection;this.secondConnection=void 0,this.logger.info(\"Closing an inactive connection in \"+Math.round(this.options.lingeringConnectionDelayMs/1e3)+\"s\"),setTimeout((function(){l.stop(!0)}),this.options.lingeringConnectionDelayMs)}},t.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},t.prototype.switchConnections=function(){var l=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=l},t.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},t.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var l=this.firstConnection.getServerState(),d=\"/\"===l.url.slice(-1)?l.url.slice(0,-1):l.url,u={baseEndpointUrl:d,newEndpointUrl:d!==this.baseEndpointUrl,c2cUrlBase:l.c2cUrlBase,clientId:l.connectedClientId,connectionId:l.connectionId,connectionTtlSec:l.getRemainingTtlInSec()};this.baseEndpointUrl=d,this.listener.onTrouterConnected(l.url,u)}},t.prototype.dispatchReconnecting=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},t.prototype.dispatchStopped=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},t.prototype.dispatchRegistrationState=function(l){this.options.registrationStateCallback&&this.options.registrationStateCallback(l)},t.prototype.onDownstreamRequest=function(l,d,u){var p={id:d.id,method:d.method,path:\"/\"+d.shortUrl,body:d.body,headers:d.headers},h={id:d.id,status:0,headers:{},body:\"\",send:function(){return h.status<=100||h.status>=999?3:(u.writeHead(h.status,h.headers),u.end(h.body))}};this.listener.onTrouterRequest(p,h)},t.prototype.onConnected=function(l){this.fsm.onConnected(l===this.firstConnection)},t.prototype.onRegistered=function(l){this.fsm.onRegistered(l===this.firstConnection)},t.prototype.onUnregistered=function(l){this.fsm.onUnregistered(l===this.firstConnection||l===this.storedFirstConnection)},t.prototype.onReconnecting=function(l){this.fsm.onReconnecting(l===this.firstConnection)},t.prototype.onReconnectIsRequired=function(l,d,u){this.fsm.onReconnectionRequired(l===this.firstConnection,d,u)},t.prototype.onDisconnected=function(l){this.fsm.onDisconnected(l===this.storedFirstConnection),this.storedFirstConnection=void 0},t.prototype.onUserActivityStateAccepted=function(l){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(l)},t.prototype.onConnectionParametersUpdated=function(l){this.setConnectionCache(l)},t.prototype.setUserActivityState=function(l,d){return this.userActivityObject=new S(l,g.CorrelationVector.extend(d)),void 0!==this.secondConnection?(this.logger.info(\"Setting user activity \"+this.userActivityObject.toEventJSON()+\" on the second/new connection\"),void this.secondConnection.setUserActivityState(this.userActivityObject)):void 0!==this.firstConnection?(this.logger.info(\"Setting user activity \"+this.userActivityObject.toEventJSON()+\" on the first/current connection\"),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},t.prototype.onTrouterMessageLost=function(l){var d=this;if(this.listener.onTrouterMessageLoss)if(l&&l.length){var u=l.filter((function(l){return void 0!==d.processedMessageLoss[l.tag+\"-\"+l.etag]}));if(u.length&&(this.logger.warn(\"onTrouterMessageLoss - removing duplicates and sending event to server\"),this.sendProcessedDroppedIndicators(u),!(l=l.filter((function(l){return void 0===d.processedMessageLoss[l.tag+\"-\"+l.etag]}))).length))return void this.logger.warn(\"onTrouterMessageLoss - All the data are duplicated\");if(!this.listener.onTrouterMessageLoss(l.map((function(l){return l.tag}))))return void this.logger.warn(\"onTrouterMessageLoss - flow tags have not been processed by listeners\");l.forEach((function(l){d.processedMessageLoss[l.tag+\"-\"+l.etag]=\"\"})),this.sendProcessedDroppedIndicators(l)}else this.logger.warn(\"onTrouterMessageLoss - no flow tags have been provided\")},t.prototype.getConnectionCache=function(){var l=this;return this.options.connectionCache?(this.logger.debug(\"Querying host's connection cache\"),this.options.connectionCache.onGetTrouterConnectionCache().then((function(l){return l?JSON.parse(l):void 0})).catch((function(d){return l.logger.warn(\"Invalid connection cache content provided: \"+d),l.connectionCache}))):Promise.resolve(this.connectionCache)},t.prototype.setConnectionCache=function(l){if(this.connectionCache=l,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(l))}catch(l){this.logger.warn(\"Error setting external connection cache: \"+l)}},t.prototype.sendProcessedDroppedIndicators=function(l){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(l):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(l):void 0},t}();d.TrouterManager=_},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function t(l){this.logger=l}return t.prototype.getPromise=function(){var l=this;return void 0!==this.url?(this.logger.debug(\"[TrouterUrlPromise] returning previously resolved url: \"+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug(\"[TrouterUrlPromise] creating and returning promise\"),this.pendingPromise=new Promise((function(d,u){l.pendingPromiseResolveRef=d,l.pendingPromiseRejectRef=u}))):this.logger.debug(\"[TrouterUrlPromise] returning existing promise\"),this.pendingPromise)},t.prototype.resolveUrl=function(l){this.url=l,this.logger.debug(\"[TrouterUrlPromise] got url: \"+this.url);var d=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==d&&(this.logger.debug(\"[TrouterUrlPromise] resolving promise\"),d(l))},t.prototype.rejectUrl=function(l){this.logger.debug(\"[TrouterUrlPromise] aborting\");var d=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==d&&(this.logger.debug(\"[TrouterUrlPromise] rejecting promise\"),d(l))},t.prototype.resetUrl=function(){this.logger.debug(\"[TrouterUrlPromise] resetting url\"),this.url=void 0},t}();d.TrouterUrlPromise=p},function(l,d,u){(function(l,u){!function(l,d){var u=l;u.version=\"0.9.6\",u.protocol=1,u.transports=[],u.j=[],u.sockets={},u.connect=function(l,p){var h,g,f=u.util.parseUri(l);d&&d.location&&(f.protocol=f.protocol||d.location.protocol.slice(0,-1),f.host=f.host||(d.document?d.document.domain:d.location.hostname),f.port=f.port||d.location.port),h=u.util.uniqueUri(f);var m={host:f.host,secure:\"https\"==f.protocol,port:f.port||(\"https\"==f.protocol?443:80),query:f.query||\"\"};return u.util.merge(m,p),!m[\"force new connection\"]&&u.sockets[h]||(g=new u.Socket(m)),!m[\"force new connection\"]&&g&&(u.sockets[h]=g),(g=g||u.sockets[h]).of(f.path.length>1?f.path:\"\")}}(u.exports,void 0===l?window:l);var p=u.exports;!function(l,d){var u=l.util={},p=/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,h=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];u.parseUri=function(l){for(var d=p.exec(l||\"\"),u={},g=14;g--;)u[h[g]]=d[g]||\"\";return u},u.uniqueUri=function(l){var u=l.protocol,p=l.host,h=l.port;return\"document\"in d?(p=p||document.domain,h=h||(\"https\"==u&&\"https:\"!==document.location.protocol?443:document.location.port)):(p=p||\"localhost\",h||\"https\"!=u||(h=443)),(u||\"http\")+\"://\"+p+\":\"+(h||80)},u.query=function(l,d){var p=u.chunkQuery(l||\"\"),h=[];for(var g in u.merge(p,u.chunkQuery(d||\"\")),p)p.hasOwnProperty(g)&&h.push(g+\"=\"+p[g]);return h.length?\"?\"+h.join(\"&\"):\"\"},u.chunkQuery=function(l){for(var d,u={},p=l.split(\"&\"),h=0,g=p.length;h<g;++h)(d=p[h].split(\"=\"))[0]&&(u[d[0]]=d[1]);return u};var g=!1;u.load=function(l){if(\"document\"in d&&\"complete\"===document.readyState||g)return l();u.on(d,\"load\",l,!1)},u.on=function(l,d,u,p){l.attachEvent?l.attachEvent(\"on\"+d,u):l.addEventListener&&l.addEventListener(d,u,p)},u.request=function(l){if(l&&\"undefined\"!=typeof XDomainRequest)return new XDomainRequest;if(\"undefined\"!=typeof XMLHttpRequest&&(!l||u.ua.hasCORS))return new XMLHttpRequest;if(!l)try{return new(window[[\"Active\"].concat(\"Object\").join(\"X\")])(\"Microsoft.XMLHTTP\")}catch(l){}return null},\"undefined\"!=typeof window&&u.load((function(){g=!0})),u.defer=function(l){if(!u.ua.webkit||\"undefined\"!=typeof importScripts)return l();u.load((function(){setTimeout(l,100)}))},u.merge=function(l,d,p,h){var g,f=h||[],m=void 0===p?2:p;for(g in d)d.hasOwnProperty(g)&&u.indexOf(f,g)<0&&(\"object\"==typeof l[g]&&m?u.merge(l[g],d[g],m-1,f):(l[g]=d[g],f.push(d[g])));return l},u.mixin=function(l,d){u.merge(l.prototype,d.prototype)},u.inherit=function(l,d){function n(){}n.prototype=d.prototype,l.prototype=new n},u.isArray=Array.isArray||function(l){return\"[object Array]\"===Object.prototype.toString.call(l)},u.intersect=function(l,d){for(var p=[],h=l.length>d.length?l:d,g=l.length>d.length?d:l,f=0,m=g.length;f<m;f++)~u.indexOf(h,g[f])&&p.push(g[f]);return p},u.indexOf=function(l,d,u){var p=l.length;for(u=u<0?u+p<0?0:u+p:u||0;u<p&&l[u]!==d;u++);return p<=u?-1:u},u.toArray=function(l){for(var d=[],u=0,p=l.length;u<p;u++)d.push(l[u]);return d},u.ua={},u.ua.hasCORS=\"undefined\"!=typeof XMLHttpRequest&&function(){try{var l=new XMLHttpRequest}catch(l){return!1}return null!=l.withCredentials}(),u.ua.webkit=\"undefined\"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==p?p:u.exports,void 0===l?window:l),function(l,d){function n(){}l.EventEmitter=n,n.prototype.on=function(l,u){return this.$events||(this.$events={}),this.$events[l]?d.util.isArray(this.$events[l])?this.$events[l].push(u):this.$events[l]=[this.$events[l],u]:this.$events[l]=u,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(l,d){function n(){u.removeListener(l,n),d.apply(this,arguments)}var u=this;return n.listener=d,this.on(l,n),this},n.prototype.removeListener=function(l,u){if(this.$events&&this.$events[l]){var p=this.$events[l];if(d.util.isArray(p)){for(var h=-1,g=0,f=p.length;g<f;g++)if(p[g]===u||p[g].listener&&p[g].listener===u){h=g;break}if(h<0)return this;p.splice(h,1),p.length||delete this.$events[l]}else(p===u||p.listener&&p.listener===u)&&delete this.$events[l]}return this},n.prototype.removeAllListeners=function(l){return this.$events&&this.$events[l]&&(this.$events[l]=null),this},n.prototype.listeners=function(l){return this.$events||(this.$events={}),this.$events[l]||(this.$events[l]=[]),d.util.isArray(this.$events[l])||(this.$events[l]=[this.$events[l]]),this.$events[l]},n.prototype.emit=function(l){if(!this.$events)return!1;var u=this.$events[l];if(!u)return!1;var p=Array.prototype.slice.call(arguments,1);if(\"function\"==typeof u)u.apply(this,p);else{if(!d.util.isArray(u))return!1;for(var h=u.slice(),g=0,f=h.length;g<f;g++)h[g].apply(this,p)}return!0}}(void 0!==p?p:u.exports,void 0!==p?p:u.parent.exports),function(l,d){if(d&&d.parse)return l.JSON={parse:d.parse,stringify:d.stringify};throw new Error(\"JSON not available\")}(void 0!==p?p:u.exports,\"undefined\"!=typeof JSON?JSON:void 0),function(l,d){var u=l.parser={},p=u.packets=[\"disconnect\",\"connect\",\"heartbeat\",\"message\",\"json\",\"event\",\"ack\",\"error\",\"noop\"],h=u.reasons=[\"transport not supported\",\"client not handshaken\",\"unauthorized\"],g=u.advice=[\"reconnect\"],f=d.JSON,m=d.util.indexOf;u.encodePacket=function(l){var d=m(p,l.type),u=l.id||\"\",v=l.endpoint||\"\",y=l.ack,S=null;switch(l.type){case\"error\":var _=l.reason?m(h,l.reason):\"\",C=l.advice?m(g,l.advice):\"\";\"\"===_&&\"\"===C||(S=_+(\"\"!==C?\"+\"+C:\"\"));break;case\"message\":\"\"!==l.data&&(S=l.data);break;case\"event\":var E={name:l.name};l.args&&l.args.length&&(E.args=l.args),S=f.stringify(E);break;case\"json\":S=f.stringify(l.data);break;case\"connect\":l.qs&&(S=l.qs);break;case\"ack\":S=l.ackId+(l.args&&l.args.length?\"+\"+f.stringify(l.args):\"\")}var T=[d,u+(\"data\"==y?\"+\":\"\"),v];return null!=S&&T.push(S),T.join(\":\")},u.encodePayload=function(l){var d=\"\";if(1==l.length)return l[0];for(var u=0,p=l.length;u<p;u++)d+=\"\"+l[u].length+\"\"+l[u];return d};var v=/([^:]+):([0-9]+)?(\\+)?:([^:]+)?:?([\\s\\S]*)?/;u.decodePacket=function(l){if(!(m=l.match(v)))return{};var d=m[2]||\"\",u=(l=m[5]||\"\",{type:p[m[1]],endpoint:m[4]||\"\"});switch(d&&(u.id=d,m[3]?u.ack=\"data\":u.ack=!0),u.type){case\"error\":var m=l.split(\"+\");u.reason=h[m[0]]||\"\",u.advice=g[m[1]]||\"\";break;case\"message\":u.data=l||\"\";break;case\"event\":try{var y=f.parse(l);u.name=y.name,u.args=y.args}catch(l){}u.args=u.args||[];break;case\"json\":try{u.data=f.parse(l)}catch(l){}break;case\"connect\":u.qs=l||\"\";break;case\"ack\":if((m=l.match(/^([0-9]+)(\\+)?(.*)/))&&(u.ackId=m[1],u.args=[],m[3]))try{u.args=m[3]?f.parse(m[3]):[]}catch(l){}break;case\"disconnect\":u.reason=l}return u},u.decodePayload=function(l){if(\"\"==l.charAt(0)){for(var d=[],p=1,h=\"\";p<l.length;p++)\"\"==l.charAt(p)?(d.push(u.decodePacket(l.substr(p+1).substr(0,h))),p+=Number(h)+1,h=\"\"):h+=l.charAt(p);return d}return[u.decodePacket(l)]}}(void 0!==p?p:u.exports,void 0!==p?p:u.parent.exports),function(l,d){function n(l,d){this.socket=l,this.sessid=d,this.connectErrorCallback=void 0,this.isOpened=!1}l.Transport=n,d.util.mixin(n,d.EventEmitter),n.prototype.onData=function(l){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),\"\"!==l){var u=d.parser.decodePayload(l);if(u&&u.length)for(var p=0,h=u.length;p<h;p++)this.onPacket(u[p])}return this},n.prototype.onPacket=function(l){return this.socket.setHeartbeatTimeout(),\"heartbeat\"==l.type?this.onHeartbeat():(\"connect\"==l.type&&\"\"==l.endpoint&&this.onConnect(),\"error\"==l.type&&\"reconnect\"==l.advice&&(this.isOpened=!1),this.socket.onPacket(l),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var l=this;this.closeTimeout=setTimeout((function(){l.onDisconnect()}),this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(l){this.send(d.parser.encodePacket(l))},n.prototype.onHeartbeat=function(l){this.packet({type:\"heartbeat\"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var l=this.socket.options;return this.scheme()+\"://\"+l.host+\":\"+l.port+\"/\"+l.resource+\"/\"+d.protocol+\"/\"+this.name+\"/\"+this.sessid},n.prototype.ready=function(l,d){d.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==p?p:u.exports,void 0!==p?p:u.parent.exports),function(l,d,u){function o(l){if(this.options={port:80,secure:!1,document:\"document\"in u&&document,resource:\"socket.io\",transports:d.transports.slice(),\"connect timeout\":1e4,\"try multiple transports\":!0,reconnect:!0,\"reconnection delay\":500,\"reconnection limit\":1/0,\"reopen delay\":3e3,\"max reconnection attempts\":10,\"sync disconnect on unload\":!0,\"auto connect\":!0,\"flash policy port\":10843},d.util.merge(this.options,l),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options[\"sync disconnect on unload\"]&&(!this.isXDomain()||d.util.ua.hasCORS)){var p=this;d.util.on(u,\"unload\",(function(){p.disconnectSync()}),!1)}this.options[\"auto connect\"]&&this.connect()}function i(){}l.Socket=o,d.util.mixin(o,d.EventEmitter),o.prototype.of=function(l){return this.namespaces[l]||(this.namespaces[l]=new d.SocketNamespace(this,l),\"\"!==l&&this.namespaces[l].packet({type:\"connect\"})),this.namespaces[l]},o.prototype.publish=function(){var l;for(var d in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(d)&&(l=this.of(d)).$emit.apply(l,arguments)},o.prototype.handshake=function(l){function n(d){d instanceof Error?u.onError(d.message):l.apply(null,d.split(\":\"))}var u=this,p=this.options;if(!u.disconnected){var h=[\"http\"+(p.secure?\"s\":\"\")+\":/\",p.host+\":\"+p.port,p.resource,d.protocol,d.util.query(this.options.query,\"t=\"+ +new Date)].join(\"/\");if(this.isXDomain()&&!d.util.ua.hasCORS){var g=document.getElementsByTagName(\"script\")[0],f=document.createElement(\"script\");f.src=h+\"&jsonp=\"+d.j.length,g.parentNode.insertBefore(f,g),d.j.push((function(l){n(l),f.parentNode.removeChild(f)}))}else{var m=d.util.request();m.open(\"GET\",h,!0),m.withCredentials=!0,m.onreadystatechange=function(){4==m.readyState&&(m.onreadystatechange=i,200==m.status?n(m.responseText):!u.reconnecting&&u.onError(m.responseText))},m.send(null)}}},o.prototype.getTransport=function(l){for(var u,p=l||this.transports,h=0;u=p[h];h++)if(d.Transport[u]&&d.Transport[u].check(this)&&(!this.isXDomain()||d.Transport[u].xdomainCheck()))return new d.Transport[u](this,this.sessionid);return null},o.prototype.connect=function(l){if(this.connecting||this.disconnected)return this;var u=this;return this.handshake((function(p,h,g,f){function c(){if(!u.connected&&!u.disconnected)if(u.connecting=!1,clearTimeout(u.connectTimeoutTimer),u.options[\"try multiple transports\"]){for(;u.remainingTransports.length>0&&u.remainingTransports.splice(0,1)[0]!=u.transport.name;);u.remainingTransports.length?a(u.remainingTransports):u.publish(\"connect_failed\")}else u.publish(\"connect_failed\")}function a(l){if(u.transport&&(u.transport.clearTimeouts(),u.transport.clearEventHandlers()),u.transport=u.getTransport(l),!u.transport||u.disconnected)return u.publish(\"connect_failed\");u.transport.ready(u,(function(){u.connecting=!0,u.publish(\"connecting\",u.transport.name),u.transport.open(c),u.options[\"connect timeout\"]&&(u.connectTimeoutTimer=setTimeout((function(){c()}),u.options[\"connect timeout\"]))}))}u.sessionid=p,u.closeTimeout=1e3*g+2e3,u.heartbeatTimeout=1e3*h+2e3,u.transports=f?d.util.intersect(f.split(\",\"),u.options.transports):u.options.transports,u.setHeartbeatTimeout(),u.remainingTransports=u.transports.slice(0),a(u.transports),u.once(\"connect\",(function(){clearTimeout(u.connectTimeoutTimer),l&&\"function\"==typeof l&&l()}))})),this},o.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var l=this;this.heartbeatTimeoutTimer=setTimeout((function(){l.transport.onClose()}),this.heartbeatTimeout)},o.prototype.packet=function(l){return this.connected&&!this.doBuffer?this.transport.packet(l):this.buffer.push(l),this},o.prototype.setBuffer=function(l){this.doBuffer=l,!l&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},o.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of(\"\").packet({type:\"disconnect\"}),this.onDisconnect(\"booted\")),this.disconnected=!0,this},o.prototype.disconnectSync=function(){var l=d.util.request(),u=this.resource+\"/\"+d.protocol+\"/\"+this.sessionid;l.open(\"GET\",u,!0),this.onDisconnect(\"booted\")},o.prototype.isXDomain=function(){var l=u.location.port||(\"https:\"==u.location.protocol?443:80);return this.options.host!==u.location.hostname||this.options.port!=l},o.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit(\"connect\"))},o.prototype.onOpen=function(){this.open=!0},o.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},o.prototype.onPacket=function(l){this.of(l.endpoint).onPacket(l)},o.prototype.onError=function(l){l&&l.advice&&\"reconnect\"===l.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish(\"error\",l&&l.reason?l.reason:l)},o.prototype.onDisconnect=function(l){var d=this.connected,u=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(d||u)&&(this.transport.close(),this.transport.clearTimeouts(),d&&(this.publish(\"disconnect\",l),\"booted\"!=l&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},o.prototype.reconnect=function(){function t(){if(l.connected){for(var d in l.namespaces)l.namespaces.hasOwnProperty(d)&&\"\"!==d&&l.namespaces[d].packet({type:\"connect\"});l.publish(\"reconnect\",l.transport.name,l.reconnectionAttempts)}clearTimeout(l.reconnectionTimer),l.removeListener(\"connect_failed\",e),l.removeListener(\"connect\",e),l.reconnecting=!1,delete l.reconnectionAttempts,delete l.reconnectionDelay,delete l.reconnectionTimer,delete l.redoTransports,l.options[\"try multiple transports\"]=u}function e(){if(l.reconnecting)return l.connected?t():l.connecting&&l.reconnecting?l.reconnectionTimer=setTimeout(e,1e3):void(l.reconnectionAttempts++>=d?l.redoTransports?(l.publish(\"reconnect_failed\"),t()):(l.on(\"connect_failed\",e),l.options[\"try multiple transports\"]=!0,l.transport=l.getTransport(),l.redoTransports=!0,l.connect()):(l.reconnectionDelay<p&&(l.reconnectionDelay*=2),l.connect(),l.publish(\"reconnecting\",l.reconnectionDelay,l.reconnectionAttempts),l.reconnectionTimer=setTimeout(e,l.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options[\"reconnection delay\"];var l=this,d=this.options[\"max reconnection attempts\"],u=this.options[\"try multiple transports\"],p=this.options[\"reconnection limit\"];this.options[\"try multiple transports\"]=!1,this.reconnectionTimer=setTimeout(e,this.reconnectionDelay),this.on(\"connect\",e)}}(void 0!==p?p:u.exports,void 0!==p?p:u.parent.exports,void 0===l?window:l),function(l,d){function n(l,d){this.socket=l,this.name=d||\"\",this.flags={},this.json=new o(this,\"json\"),this.ackPackets=0,this.acks={}}function o(l,d){this.namespace=l,this.name=d}l.SocketNamespace=n,d.util.mixin(n,d.EventEmitter),n.prototype.$emit=d.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(l){return l.endpoint=this.name,this.socket.packet(l),this.flags={},this},n.prototype.send=function(l,d){var u={type:this.flags.json?\"json\":\"message\",data:l};return\"function\"==typeof d&&(u.id=++this.ackPackets,u.ack=!0,this.acks[u.id]=d),this.packet(u)},n.prototype.emit=function(l){var d=Array.prototype.slice.call(arguments,1),u=d[d.length-1],p={type:\"event\",name:l};return\"function\"==typeof u&&(p.id=++this.ackPackets,p.ack=\"data\",this.acks[p.id]=u,d=d.slice(0,d.length-1)),p.args=d,this.packet(p)},n.prototype.disconnect=function(){return\"\"===this.name?this.socket.disconnect():(this.packet({type:\"disconnect\"}),this.$emit(\"disconnect\")),this},n.prototype.onPacket=function(l){function n(){u.packet({type:\"ack\",args:d.util.toArray(arguments),ackId:l.id})}var u=this;switch(l.type){case\"connect\":this.$emit(\"connect\");break;case\"disconnect\":\"\"===this.name?this.socket.onDisconnect(l.reason||\"booted\"):this.$emit(\"disconnect\",l.reason||\"\");break;case\"message\":case\"json\":var p=[\"message\",l.data];\"data\"==l.ack?p.push(n):l.ack&&this.packet({type:\"ack\",ackId:l.id}),this.$emit.apply(this,p);break;case\"event\":p=[l.name].concat(l.args),\"data\"==l.ack&&p.push(n),this.$emit.apply(this,p);break;case\"ack\":this.acks[l.ackId]&&(this.acks[l.ackId].apply(this,l.args),delete this.acks[l.ackId]);break;case\"error\":l.advice?this.socket.onError(l):\"unauthorized\"==l.reason?this.$emit(\"connect_failed\",l.reason):this.$emit(\"error\",l.reason)}},o.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},o.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==p?p:u.exports,void 0!==p?p:u.parent.exports),function(l,d,u){function o(l){d.Transport.apply(this,arguments)}function i(){}l.websocket=o,d.util.inherit(o,d.Transport),o.prototype.name=\"websocket\",o.prototype.open=function(l){var p,h=d.util.query(this.socket.options.query),g=this;return this.connectErrorCallback=l,p||(p=u.MozWebSocket||u.WebSocket),this.websocket=new p(this.prepareUrl()+h),this.websocket.onopen=function(){g.onOpen(),g.socket.setBuffer(!1)},this.websocket.onmessage=function(l){g.onData(l.data)},this.websocket.onclose=function(){g.onClose(),g.socket.setBuffer(!0)},this.websocket.onerror=function(l){g.onError(l)},this},o.prototype.send=function(l){return this.websocket.send(l),this},o.prototype.payload=function(l){for(var d=0,u=l.length;d<u;d++)this.packet(l[d]);return this},o.prototype.close=function(){return this.websocket.close(),this},o.prototype.onError=function(l){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(l)},o.prototype.scheme=function(){return this.socket.options.secure?\"wss\":\"ws\"},o.check=function(){return\"WebSocket\"in u&&!(\"__addTask\"in WebSocket)||\"MozWebSocket\"in u},o.xdomainCheck=function(){return!0},o.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=i),this},d.transports.push(\"websocket\")}(void 0!==p?p.Transport:u.exports,void 0!==p?p:u.parent.exports,void 0===l?window:l),function(l,d,u){function o(l){l&&(d.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}l.XHR=o,d.util.inherit(o,d.Transport),o.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},o.prototype.payload=function(l){for(var u=[],p=0,h=l.length;p<h;p++)u.push(d.parser.encodePacket(l[p]));this.send(d.parser.encodePayload(u))},o.prototype.send=function(l){return this.post(l),this},o.prototype.post=function(l){function e(){4==this.readyState&&(this.onreadystatechange=i,d.posting=!1,200==this.status?(d.socket.setBuffer(!1),clearTimeout(d.sendXHR.ackTimeoutTimer)):d.onClose())}function o(){this.onload=i,d.socket.setBuffer(!1)}var d=this;this.socket.setBuffer(!0),this.sendXHR=this.request(\"POST\"),u.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=o:this.sendXHR.onreadystatechange=e,this.sendXHR.send(l),d.sendXHR.ackTimeoutTimer=setTimeout((function(){d.onClose()}),d.socket.options.ackTimeoutMs)},o.prototype.close=function(){return this.onClose(),this},o.prototype.request=function(l){var u=d.util.request(this.socket.isXDomain()),p=d.util.query(this.socket.options.query,\"t=\"+ +new Date);if(u.open(l||\"GET\",this.prepareUrl()+p,!0),\"POST\"==l)try{u.setRequestHeader?u.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\"):u.contentType=\"text/plain\"}catch(l){}return u},o.prototype.scheme=function(){return this.socket.options.secure?\"https\":\"http\"},o.check=function(l,p){try{var h=d.util.request(p),g=u.XDomainRequest&&h instanceof XDomainRequest,f=(l&&l.options&&l.options.secure?\"https:\":\"http:\")!=u.location.protocol;if(h&&(!g||!f))return!0}catch(l){}return!1},o.xdomainCheck=function(){return o.check(null,!0)},o.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=i),this}}(void 0!==p?p.Transport:u.exports,void 0!==p?p:u.parent.exports,void 0===l?window:l),function(l,d,u){function o(){d.Transport.XHR.apply(this,arguments)}function i(){}l[\"xhr-polling\"]=o,d.util.inherit(o,d.Transport.XHR),d.util.merge(o,d.Transport.XHR),o.prototype.name=\"xhr-polling\",o.prototype.open=function(l){var u=this;return u.connectErrorCallback=l,d.Transport.XHR.prototype.open.call(u),!1},o.prototype.get=function(){function t(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(l.connectErrorCallback=void 0,l.onData(this.responseText),l.get()):(l.onClose(),void 0!==l.connectErrorCallback&&(l.connectErrorCallback(),l.connectErrorCallback=void 0)))}function e(){l.connectErrorCallback=void 0,this.onload=i,this.onerror=i,l.onData(this.responseText),l.get()}function o(){l.onClose(),void 0!==l.connectErrorCallback&&(l.connectErrorCallback(),l.connectErrorCallback=void 0)}if(this.isOpened){var l=this;this.xhr=this.request(),u.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=e,this.xhr.onerror=o):this.xhr.onreadystatechange=t,this.xhr.send(null)}},o.prototype.onClose=function(){if(d.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(l){}this.xhr=null}},o.prototype.ready=function(l,u){var p=this;d.util.defer((function(){u.call(p)}))},o.prototype.clearEventHandlers=function(){return d.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i),this},d.transports.push(\"xhr-polling\")}(void 0!==p?p.Transport:u.exports,void 0!==p?p:u.parent.exports,void 0===l?window:l),d.io=p}).call(d,u(11),u(12)(l))},function(l,d){var u;u=function(){return this}();try{u=u||Function(\"return this\")()||(0,eval)(\"this\")}catch(l){\"object\"==typeof window&&(u=window)}l.exports=u},function(l,d){l.exports=function(l){return l.webpackPolyfill||(l.deprecate=function(){},l.paths=[],l.children||(l.children=[]),Object.defineProperty(l,\"loaded\",{enumerable:!0,get:function(){return l.l}}),Object.defineProperty(l,\"id\",{enumerable:!0,get:function(){return l.i}}),l.webpackPolyfill=1),l}},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p,h=u(3),g=u(1),f=u(0),m=function(){function t(l){this.id=l,this.status=200,this.headers={},this.body=\"\"}return t}();d.ResponseData=m,function(l){l.Connected=\"trouter_js_client_connected\",l.Disconnected=\"trouter_js_client_disconnected\",l.Error=\"trouter_js_client_error\",l.Progress=\"trouter_js_client_progress\",l.Response=\"trouter_js_client_response\",l.Request=\"trouter_js_client_request\",l.CheckConnection=\"trouter_js_client_check_connection\",l.Registration=\"trouter_js_client_registration\",l.Unregistration=\"trouter_js_client_unregistration\"}(p=d.ClientEventName||(d.ClientEventName={}));var v=function(){function t(l,d,u,p,h){this.stepName=l,this.operation=d,this.delta=u,this.ts=p,this.error=h}return t}();d.TrackerStep=v;var y=function(){function t(){}return t}();d.Properties=y;var S=function(){function t(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType=\"\",this.connectionNumber=0}return t}(),_=function(){function t(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0}return t}(),C=function(){function t(l,d,u,p,g,m,v){this.clientId=d,this.clientInfo=u,this.getServerState=p,this.endpointId=g,this.clientCorrelationID=m,this.environment=v,this.logger=new f.Logger(\"ConnectionTracker\",l),this.clientCorrelationID=void 0!==m?m:\"\",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new h.Timespan,this.eventLogSettings=new _,this.connectedInfo=new S}return t.prototype.enable=function(l){this.eventLogSettings.enabled=!0,this.eventLogger=l},t.prototype.disable=function(){this.eventLogSettings.enabled=!1},t.prototype.sendProgress=function(l){this.steps.length>0&&this.sendTelemetry(p.Progress,l,this.steps)},t.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},t.prototype.resetProgressSendTimer=function(){var l=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout((function(){l.sendProgress({reason:\"timeout\",timeoutSecs:l.eventLogSettings.sendProgressTimeoutSecs})}),1e3*this.eventLogSettings.sendProgressTimeoutSecs))},t.prototype.setConnectedInfo=function(l,d){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=l,this.connectedInfo.transportType=d,++this.connectedInfo.connectionNumber},t.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=\"\"},t.prototype.copyProperties=function(l,d){for(var u=0,p=Object.keys(d);u<p.length;u++){var h=p[u];d.hasOwnProperty(h)&&void 0!==d[h]&&(l[h.replace(/-/g,\"_\")]={value:d[h]})}},t.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},t.prototype.sendTelemetry=function(l,d,u){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[l]&&void 0!==this.eventLogger){var p=this.getServerState(),f={name:l,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:h.toJson(u)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:g.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:p.connectionId},connectedClientId:{value:p.connectedClientId},domId:{value:p.domId},url:{value:p.unsecureUrl},surl:{value:p.url},ttlInSecs:{value:p.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(f.properties,d),this.eventLogger.logEvent(f)}}catch(d){this.logger.warn(\"error in sending event \"+l+\": \"+h.toJson(d))}},t.prototype.createStep=function(l,d,u){return new v(l,d,this.beginTimestamp.duration,Date.now(),u)},t.prototype.addStep=function(l,d,u){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(l,d,u)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var h=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(p.Progress,{reason:\"flush\"},h)}},t.prototype.trackStart=function(l){this.addStep(l,\"start\")},t.prototype.trackEnd=function(l){this.addStep(l,\"end\")},t.prototype.trackError=function(l,d,u,h){void 0===u&&(u=!0),\"health\"===l&&!0!==this.eventLogSettings.logHealthCheckError||\"ping\"===l&&!1===this.eventLogSettings.logSendPingError||(void 0===h&&(h=\"error\"),!0===u&&this.addStep(l,h,d),this.sendTelemetry(p.Error,{},[this.createStep(l,h,d)]))},t.prototype.trackProgress=function(l,d){this.addStep(l,d)},t.prototype.trackConnected=function(l,d){this.setConnectedInfo(l,d);var u=this.steps.slice(0),h=this.totalStepCount,g=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(p.Connected,{stepCount:u.length,totalStepCount:h,connectionEstablishmentMs_Total:g},u),this.cancelProgressTimer()},t.prototype.getSessionLength=function(){return Date.now()-this.connectedInfo.connectedTimestamp},t.prototype.trackDisconnected=function(l){l.sessionLengthMS=this.getSessionLength(),this.sendTelemetry(p.Disconnected,l,[]),this.resetProgressSendTimer()},t.prototype.trackNewConnection=function(){++this.connectionAttempt},t.prototype.trackRequest=function(l,d){var u={};void 0!==d&&(u.hasError=!0,u.error=d);try{if(l){u.requestID=l.id,u.httpMethod=l.method,u.url=l.url,u.bodyLength=l.body.length,u.shortUrl=l.shortUrl,u.requestTimeStamp=l.startTS,u.correlationVector=l.correlationVector;for(var g=l.headers,f=0,m=Object.keys(g);f<m.length;f++){var v=m[f];g.hasOwnProperty(v)&&(u[v]=g[v])}}}catch(l){u.hasError=!0,u.error=u.error+\" error creating request context \"+h.toJson(l)}this.sendTelemetry(p.Request,u,[])},t.prototype.trackResponse=function(l,d,u,g){var f={};void 0!==g&&(f.hasError=!0,f.error=g);try{if(f.responseTimestamp=void 0!==u?u.sentTS:Date.now(),l){f.requestID=l.id,f.httpMethod=l.method,f.shortUrl=l.shortUrl,f.correlationVector=l.correlationVector;for(var m=l.headers,v=0,y=Object.keys(m);v<y.length;v++){var S=y[v];m.hasOwnProperty(S)&&(f[S]=m[S])}}u&&(f.latencyMS=d,f.responseCode=u.status,f.responseLength=u.body.length)}catch(l){f.hasError=!0,f.error=f.error+\" error creating response context \"+h.toJson(l)}this.sendTelemetry(p.Response,f,[])},t.prototype.sendResponseError=function(l,d,u){this.trackResponse(d,void 0,u,l)},t.prototype.close=function(){this.sendProgress({reason:\"closed\"}),this.steps.length=0,this.cancelProgressTimer()},t.prototype.mergeSettings=function(l){if(l){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==l.numberOfStepsToMaintain?l.numberOfStepsToMaintain:0));var d=Math.min(3600,Math.max(55,void 0!==l.sendProgressTimeoutSecs?l.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=l.logHealthCheckError,this.eventLogSettings.logSendPingError=l.logSendPingError;for(var u=0,h=Object.keys(p).map((function(l){return p[l]}));u<h.length;u++){var g=h[u];l.hasOwnProperty(g)&&void 0!==l[g]&&(this.eventLogSettings[g]=l[g])}this.eventLogSettings.sendProgressTimeoutSecs!==d&&(this.eventLogSettings.sendProgressTimeoutSecs=d,this.resetProgressSendTimer())}},t}();d.ConnectionTracker=C},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function t(l,d){this.logger=l,this.maxBackoffInMs=d,this.backoffId=0,this.backoffCount=0}return t.calculateNextBackoffMs=function(l,d){var u=1+.4*(Math.random()-.5),p=1e3*Math.pow(2,l)*u;return p=Math.round(p),Math.min(d,p)},t.prototype.setMaxBackoffMs=function(l){this.maxBackoffInMs=l},t.prototype.backoff=function(l,d){var u=this;void 0!==this.timerHandle&&(this.logger.debug(\"Clearing current back off\"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var p=t.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info(\"Backing off \"+l+\" for \"+p+\" milliseconds with ID \"+this.backoffId),this.timerHandle=setTimeout((function(){u.logger.info(\"Back off for \"+l+\" with ID \"+u.backoffId+\" complete, invoking handler\"),u.timerHandle=void 0,d()}),p)},t.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug(\"Resetting back off\"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},t}();d.ExponentialBackoff=p},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p,h,g=u(4),f=u(0);!function(l){l[l.Initial=0]=\"Initial\",l[l.RetrievingToken=1]=\"RetrievingToken\",l[l.Allocating=2]=\"Allocating\",l[l.Handshaking=3]=\"Handshaking\",l[l.Connecting=4]=\"Connecting\",l[l.Connected=5]=\"Connected\",l[l.UnregisteringRetrievingToken=6]=\"UnregisteringRetrievingToken\",l[l.Unregistering=7]=\"Unregistering\",l[l.TerminalError=8]=\"TerminalError\"}(p=d.State||(d.State={})),function(l){l[l.Initial=0]=\"Initial\",l[l.RetrievingToken=1]=\"RetrievingToken\",l[l.Registering=2]=\"Registering\",l[l.Registered=3]=\"Registered\",l[l.NotRegistered=4]=\"NotRegistered\"}(h||(h={}));var m=function(){function t(l,d,u){this.worker=d,this.incallModeEnabled=u,this.state=p.Initial,this.connectionErrors=0,this.autoReconnect=!0,this.logger=new f.Logger(\"ConnectionFsm\",l),this.connectedSubstate=h.Initial}return t.prototype.getState=function(){return this.state},t.prototype.isActive=function(){return this.state===p.Allocating||this.state===p.Connected||this.state===p.Handshaking||this.state===p.Connecting||this.state===p.RetrievingToken},t.prototype.start=function(){return this.state===p.Initial?(this.setState(p.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored(\"start\"),!1)},t.prototype.stop=function(l){l&&(this.connectedSubstate=h.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.resetRegisterBackoff(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopRegisterTimer(),this.state!==p.Connecting&&this.state!==p.Handshaking&&this.state!==p.Connected||(this.worker.stopSocketIo(),this.state===p.Connected&&this.worker.sendDisconnectTelemetryEvent(\"connection stopped\")),this.isRegistered()&&this.state!==p.UnregisteringRetrievingToken&&this.state!==p.Unregistering?(this.setState(p.UnregisteringRetrievingToken),this.worker.getToken(!0,!1)):(this.setState(p.Initial),this.worker.dispatchDisconnected())},t.prototype.onTokenReceived=function(l){this.state===p.RetrievingToken?(this.setState(p.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(l)):this.state===p.Connected&&this.connectedSubstate===h.RetrievingToken?(this.connectedSubstate=h.Registering,this.worker.sendRegisterRequest()):this.state===p.UnregisteringRetrievingToken?(this.setState(p.Unregistering),this.worker.sendUnregisterRequest()):this.showIgnored(\"onTokenReceived\")},t.prototype.checkConnection=function(l){l&&this.onPingInterval()},t.prototype.onAllocationSucceed=function(){return this.state===p.Allocating?(this.setState(p.Handshaking),this.connectedSubstate===h.Registered&&this.worker.dispatchUnregistered(),this.connectedSubstate=h.Initial,this.worker.startSocketIo(),!0):(this.showIgnored(\"onAllocationSucceed\"),!1)},t.prototype.onAllocationFailed=function(l){this.state===p.Allocating?(this.setState(p.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!l,!0)):this.showIgnored(\"onAllocationFailed\")},t.prototype.onConnectingTimeout=function(){this.state===p.Allocating||this.state===p.Connecting||this.state===p.Handshaking?(this.setState(p.RetrievingToken),this.resetAllocationIfNecessary(void 0),this.worker.stopSocketIo(),this.worker.getToken(!0,!1)):this.showIgnored(\"onConnectingTimeout\")},t.prototype.onConnecting=function(){this.state===p.Handshaking?this.setState(p.Connecting):this.showIgnored(\"onConnecting\")},t.prototype.onConnectingFailed=function(){this.state===p.Connecting?this.onConnectingTimeout():this.state===p.Handshaking?(this.logger.error(\"Unexpected error in Socket.io - no valid transports\"),this.onConnectingTimeout()):this.showIgnored(\"onConnectingFailed\")},t.prototype.onSocketDisconnect=function(l){this.state===p.Handshaking||this.state===p.Connected?(this.worker.stopSocketIo(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopConnectionTimer(),this.state===p.Connected?this.worker.sendDisconnectTelemetryEvent(l):this.worker.resetAllocationConnectionParams(),this.autoReconnect?(this.setState(p.RetrievingToken),this.worker.resetRegisterBackoff(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):(this.logger.debug(\"Socket error/disconnect occurred and automatic reconnect is disabled. Connection will stop.\"),this.stop(!0))):this.showIgnored(\"onSocketDisconnect\")},t.prototype.onTrouterConnected=function(){this.state===p.Connecting?(this.setState(p.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(g.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.connectionErrors=0,this.worker.shouldSkipRegistration()?(this.connectedSubstate=h.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=h.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored(\"onTrouterConnected\")},t.prototype.onReconnectRequired=function(l,d){this.worker.dispatchReconnectIsRequired(l,d)},t.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},t.prototype.onDownstreamRequest=function(l){this.state===p.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(l)):this.showIgnored(\"onDownstreamRequest\")},t.prototype.onTrouterMessageLost=function(l){this.state===p.Connected?this.worker.dispatchTrouterMessageLost(l):this.showIgnored(\"onTrouterMessageLost\")},t.prototype.onPingInterval=function(){this.state===p.Connected?this.worker.sendPingRequest():this.showIgnored(\"onPingInterval\")},t.prototype.onPingResponseTimeout=function(){this.onMissedResponse(\"onPingResponseTimeout\")},t.prototype.onPingResponse=function(){this.state===p.Connected||this.showIgnored(\"onPingResponse\")},t.prototype.onRegistrationFailed=function(l){this.state===p.Connected&&this.connectedSubstate===h.Registering?(this.connectedSubstate=h.RetrievingToken,this.worker.getToken(!l,!0)):this.showIgnored(\"onRegistrationFailed\")},t.prototype.onRegistrationSucceed=function(l){this.state===p.Connected?(this.connectedSubstate===h.Registering&&(this.connectedSubstate=h.Registered,this.worker.dispatchRegistered()),l&&this.worker.startRegisterTimer()):this.showIgnored(\"onRegistrationSucceed\")},t.prototype.onRegistrationTimeout=function(){this.state===p.Connected&&this.connectedSubstate!==h.NotRegistered?(this.connectedSubstate=h.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored(\"onRegistrationTimeout\")},t.prototype.onUnregistrationFailed=function(l){this.state===p.Unregistering?(this.setState(p.UnregisteringRetrievingToken),this.worker.getToken(!l,!l)):this.showIgnored(\"onUnregistrationFailed\")},t.prototype.onUnregistrationSucceed=function(){this.state===p.Unregistering?(this.setState(p.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored(\"onUnregistrationSucceed\")},t.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===p.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored(\"onIncallModeTimer\")},t.prototype.onSetUserActivityState=function(l,d){d?(this.logger.info(\"Changing user activity state to '\"+l.toEventJSON()+\"'\"),this.worker.sendUserActivityState(g.UserActivityEventReason.Modified,this.state===p.Connected)):this.logger.debug(\"Not changing the same user activity state '\"+l.toEventJSON()+\"'\")},t.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse(\"onActivityStateResponseTimeout\")},t.prototype.forceReconnect=function(l){this.state===p.Connected&&this.worker.sendDisconnectTelemetryEvent(l),this.setState(p.RetrievingToken),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.resetRegisterBackoff(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)},t.prototype.onTerminalError=function(){this.logger.error(\"Cannot proceed, reached terminal state. Switching from state '\"+p[this.state]+\"' to \"+p[p.TerminalError]),this.setState(p.TerminalError)},t.prototype.onMissedResponse=function(l){this.state===p.Connected?(this.setState(p.RetrievingToken),this.worker.resetRegisterBackoff(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.sendDisconnectTelemetryEvent(l),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):this.showIgnored(l)},t.prototype.showIgnored=function(l){this.logger.debug(\"Ignoring event '\"+l+\"' in state '\"+p[this.state]+\"'\")},t.prototype.setState=function(l){this.logger.info(\"Switching from state '\"+p[this.state]+\"' to state '\"+p[l]+\"'\"),this.state!==l?this.state=l:this.logger.error(\"Attempt to switching into the current state '\"+p[l]+\"'\")},t.prototype.resetAllocationIfNecessary=function(l){this.connectionErrors++,this.connectionErrors>=2||void 0!==l&&/^4\\d\\d /.test(l)?(this.logger.error(\"Connection error count is \"+this.connectionErrors+\" - will reset allocation\"),this.connectionErrors=0):this.logger.info(\"Connection error count is \"+this.connectionErrors+\" - will NOT reset allocation\")},t.prototype.isRegistered=function(){return this.connectedSubstate===h.Registered||this.connectedSubstate===h.Registering},t.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},t}();d.TrouterFsm=m},function(l,d,u){Object.defineProperty(d,\"__esModule\",{value:!0});var p=u(2),h=u(0),g=u(5),f=function(){function t(l,d){this.worker=d,this.state=p.TrouterState.Unknown,this.logger=new h.Logger(\"ManagerFsm\",l)}return t.prototype.start=function(){this.state===p.TrouterState.Unknown?(this.setState(p.TrouterState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):this.showIgnored(\"start\")},t.prototype.stop=function(l){this.state!==p.TrouterState.Unknown?(this.setState(p.TrouterState.Unknown),this.worker.stopFirstConnection(!0===l),this.worker.stopSecondConnection(!0===l)):this.showIgnored(\"stop\")},t.prototype.getState=function(){return this.state},t.prototype.onConnected=function(l){this.state===p.TrouterState.Disconnected&&l?this.worker.doesSecondConnectionExist()?this.setState(p.TrouterState.Switching):(this.setState(p.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored(\"onConnected(\"+l+\")\")},t.prototype.onRegistered=function(l){this.state!==p.TrouterState.Disconnected||l?this.state!==p.TrouterState.Switching||l||(this.setState(p.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(p.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},t.prototype.onUnregistered=function(l){l&&this.worker.dispatchRegistrationState(!1)},t.prototype.onReconnecting=function(l){this.state===p.TrouterState.Connected&&l||this.state===p.TrouterState.Switching&&l?(this.setState(p.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored(\"onReconnecting(\"+l+\")\")},t.prototype.onReconnectionRequired=function(l,d,u){this.state===p.TrouterState.Connected&&l?(this.setState(p.TrouterState.Switching),this.worker.startSecondConnection(d)):this.state===p.TrouterState.Disconnected&&l?this.worker.startSecondConnection(d):this.state===p.TrouterState.Switching&&l&&u===g.ReconnectReason.Configuration?(this.logger.debug(\"onReconnectionRequired: switch requested while already in Switching state\"),this.worker.stopSecondConnection(!0),this.worker.startSecondConnection(d)):this.showIgnored(\"onReconnectionRequired(\"+l+\")\")},t.prototype.onDisconnected=function(l){this.state===p.TrouterState.Unknown&&l?this.worker.dispatchStopped():this.showIgnored(\"onDisconnected(\"+l+\")\")},t.prototype.showIgnored=function(l){this.logger.info(\"Ignoring event '\"+l+\"' in state '\"+p.TrouterState[this.state]+\"'\")},t.prototype.setState=function(l){this.logger.info(\"Switching from state '\"+p.TrouterState[this.state]+\"' to state '\"+p.TrouterState[l]+\"'\"),this.state!==l?this.state=l:this.logger.error(\"Attempt to switching into the current state '\"+p.TrouterState[l]+\"'\")},t}();d.TrouterManagerFsm=f},function(l,d,u){function o(l,d){if(!d)return l;var u=p({},l,{enabled:d.TelemetryEnabled});return void 0!==d.ClientTelemetryEventEnabled&&(u=p({},u,d.ClientTelemetryEventEnabled)),u}function i(l,d){return{clientInfo:{ua:l.trouterSettings.productName,v:l.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:l.trouterSettings.sessionId,environment:l.trouterSettings.environment,telemetrySettings:o(l.telemetryConfig.settings,d),eventLogger:l.telemetryConfig.eventLogger,endpointId:l.trouterSettings.registrationId,trouterUrl:d&&d.TrouterConnectionUrl||l.trouterSettings.trouterServiceUrl,registration:l.trouterSettings.registrarServiceUrl?{registrarUrl:l.trouterSettings.registrarServiceUrl,registrationId:l.trouterSettings.registrationId||\"\",pnhAppId:l.trouterSettings.pnhAppId||\"\",platform:l.trouterSettings.platform||\"\",pnhTemplateKey:l.trouterSettings.pnhTemplate||\"\",platformUIVersion:l.trouterSettings.platformUIVersion||\"\",productContext:l.trouterSettings.pnhProductContext||void 0,context:l.trouterSettings.pnhContext||\"\",registrarTtlSec:(l.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:p({connectionTimeoutMs:l.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:\"TeamsCDL\"===l.trouterSettings.productName?3e5:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},l.trouterSettings.timeoutOptions),incallTimeoutOptions:p({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:\"TeamsCDL\"===l.trouterSettings.productName?3e5:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},l.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:l.trouterSettings.incallModeTimeoutMs||0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:l.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:l.connectionCache,registrationStateCallback:l.registrationStateCallbackForAcsDoNotUse,retryLimitOnTokenFetch:\"TeamsCDL\"===l.trouterSettings.productName?15:l.trouterSettings.retryLimitOnTokenFetch}}function r(l){return new E(l)}function s(){return f.CLIENT_VERSION}function c(l,d){var u=l.indexOf(\"://\");if(u>=0){var p=l.indexOf(\"/\",u+3);if(p>=0)return d+l.substr(p)}return\"\"}var p=this&&this.__assign||Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l},h=this&&this.__awaiter||function(l,d,u,p){return new(u||(u=Promise))((function(h,g){function s(l){try{a(p.next(l))}catch(l){g(l)}}function c(l){try{a(p.throw(l))}catch(l){g(l)}}function a(l){l.done?h(l.value):new u((function(d){d(l.value)})).then(s,c)}a((p=p.apply(l,d||[])).next())}))},g=this&&this.__generator||function(l,d){function n(l){return function(d){return o([l,d])}}function o(g){if(u)throw new TypeError(\"Generator is already executing.\");for(;f;)try{if(u=1,p&&(h=2&g[0]?p.return:g[0]?p.throw||((h=p.return)&&h.call(p),0):p.next)&&!(h=h.call(p,g[1])).done)return h;switch(p=0,h&&(g=[2&g[0],h.value]),g[0]){case 0:case 1:h=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,p=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(!(h=(h=f.trys).length>0&&h[h.length-1])&&(6===g[0]||2===g[0])){f=0;continue}if(3===g[0]&&(!h||g[1]>h[0]&&g[1]<h[3])){f.label=g[1];break}if(6===g[0]&&f.label<h[1]){f.label=h[1],h=g;break}if(h&&f.label<h[2]){f.label=h[2],f.ops.push(g);break}h[2]&&f.ops.pop(),f.trys.pop();continue}g=d.call(l,f)}catch(l){g=[6,l],p=0}finally{u=h=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}var u,p,h,g,f={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return g={next:n(0),throw:n(1),return:n(2)},\"function\"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(d,\"__esModule\",{value:!0});var f=u(1),m=u(2);d.TrouterState=m.TrouterState,d.UserActivityState=m.UserActivityState;var v=u(0),y=u(6),S=u(7),_=u(8),C=u(9),E=function(){function t(l){this.logProvider=l,this.stateChangedListeners=[],this.logger=new v.Logger(\"Trouter\",l),this.trouterUrlPromise=new C.TrouterUrlPromise(l),this.messageHandlers=new y.MessageHandlerRegistry(l),this.listeners={},this.connectionInfo=null,this.logger.info(\"Created TrouterService version \"+f.CLIENT_VERSION)}return t.prototype.start=function(l){if(this.logger.info(\"Start\"),!l.trouterSettings.disableInternalSkypeTokenCache){var d=l.skypeTokenProvider;l.skypeTokenProvider=S.addCacheAsBackupTo(d)}this.trouterCfg=l;var u=i(l,this.ecsCfg);void 0===this.trouterServer&&(this.trouterServer=new _.TrouterManager(this.logProvider,u,l.skypeTokenProvider,this)),this.trouterServer.start()},t.prototype.stop=function(l){this.logger.info(\"close connection\"),this.trouterUrlPromise.rejectUrl(new Error(\"TrouterService is stopped\")),void 0!==this.trouterServer&&this.trouterServer.stop(l)},t.prototype.setEcsConfig=function(l){return h(this,void 0,void 0,(function(){var d=this;return g(this,(function(u){return[2,new Promise((function(u,p){if(d.ecsCfg=l.TrouterJScriptClient,d.logger.info(\"Setting ECS configuration to \"+JSON.stringify(d.ecsCfg)),void 0!==d.trouterServer&&void 0!==d.trouterCfg){var h=i(d.trouterCfg,d.ecsCfg);d.trouterServer.configure(h)}u()}))]}))}))},t.prototype.checkConnection=function(l){void 0!==this.trouterServer&&this.trouterServer.checkConnection(l||!1)},t.prototype.resendRegistration=function(){return h(this,void 0,void 0,(function(){return g(this,(function(l){if(!this.trouterServer)throw new Error(\"resendRegistration called too early\");return[2,this.trouterServer.resendRegistration()]}))}))},t.prototype.registerListener=function(l,d){return\"\"===d||\"/\"!==d[0]||d.indexOf(\"?\")>=0||d.indexOf(\"#\")>=0?(this.logger.error(\"Listener path '\"+d+\"' is not valid\"),!1):this.listeners[d]?(this.logger.error(\"Another listener is already registered for path '\"+d+\"'\"),!1):(this.listeners[d]=l,this.logger.debug(\"Listener for path '\"+d+\"' registered\"),this.connectionInfo&&l.onTrouterConnected(this.connectionInfo.baseEndpointUrl+d,this.connectionInfo),!0)},t.prototype.unregisterListener=function(l){for(var d=[],u=0,p=Object.keys(this.listeners);u<p.length;u++){var h=p[u];this.listeners[h]===l&&d.push(h)}if(0===d.length)return!1;for(var g=0,f=d;g<f.length;g++)h=f[g],delete this.listeners[h];return this.logger.debug(\"Listener for path(s) '\"+d.join(\"', '\")+\"' unregistered\"),!0},t.prototype.onTrouterConnected=function(l,d){this.logger.debug(\"Trouter is now connected\");for(var u=0,p=Object.keys(this.listeners);u<p.length;u++){var h=p[u];try{this.listeners[h].onTrouterConnected(d.baseEndpointUrl+h,d)}catch(l){this.logger.error(\"Listener '\"+h+\"' threw an exception from onTrouterConnected(): \"+l)}}this.connectionInfo=d,this.trouterUrlPromise.resolveUrl(l),this.notifyStateChanged(m.TrouterState.Connected,{url:l,getRemainingTtlInSec:function(){return d.connectionTtlSec}})},t.prototype.onTrouterDisconnected=function(){this.logger.debug(\"Trouter is now disconnected\"),this.connectionInfo=null;for(var l=0,d=Object.keys(this.listeners);l<d.length;l++){var u=d[l],p=this.listeners[u];if(p.onTrouterDisconnected)try{p.onTrouterDisconnected()}catch(l){this.logger.error(\"Listener '\"+u+\"' threw an exception from onTrouterDisconnected(): \"+l)}}this.notifyStateChanged(m.TrouterState.Disconnected)},t.prototype.onTrouterRequest=function(l,d){for(var u=\"\",p=0,h=Object.keys(this.listeners);p<h.length;p++){var g=h[p];l.path.substring(0,g.length)===g&&g.length>u.length&&(u=g)}if(\"\"===u)this.tryMessageHandlers(l,d)||(d.status=404,d.headers={\"Trouter-Responder\":\"ClientLib\"},d.send());else try{this.listeners[u].onTrouterRequest(l,d)}catch(l){this.logger.error(\"Listener '\"+u+\"' threw an exception from onTrouterRequest(): \"+l),d.status=500,d.headers={\"Trouter-Responder\":\"ClientLib\"},d.send()}},t.prototype.onTrouterMessageLoss=function(l){this.logger.info(\"onTrouterMessageLoss called with value \"+l);for(var d=!0,u=0,p=Object.keys(this.listeners);u<p.length;u++){var h=p[u],g=this.listeners[h];if(g.onTrouterMessageLoss)try{void 0===(d=g.onTrouterMessageLoss(l)&&d)&&(this.logger.error(\"Listener '\"+h+\"' did not response with boolean value onTrouterMessageLoss()\"),d=!1)}catch(l){this.logger.error(\"Listener '\"+h+\"' threw an exception from onTrouterMessageLoss(): \"+l),d=!1}}return d},t.prototype.onTrouterUserActivityStateAccepted=function(l){this.logger.debug(\"onTrouterUserActivityStateAccepted cv: \"+l);for(var d=0,u=Object.keys(this.listeners);d<u.length;d++){var p=u[d],h=this.listeners[p];if(h.onTrouterUserActivityStateAccepted)try{h.onTrouterUserActivityStateAccepted(l)}catch(l){this.logger.error(\"Listener '\"+p+\"' threw an exception from onTrouterUserActivityStateAccepted(): \"+l)}}},t.prototype.setUserActivityState=function(l,d){if(l!==m.UserActivityState.Active&&l!==m.UserActivityState.Inactive)throw new Error(\"setUserActivityState called with unsupported value \"+l);if(this.logger.info(\"setUserActivityState called with value \"+m.UserActivityState[l]),!this.trouterServer||this.state()===m.TrouterState.Unknown)throw new Error(\"setUserActivityState called too early\");this.trouterServer.setUserActivityState(l,d)},t.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():m.TrouterState.Unknown},t.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},t.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error(\"TrouterService has not been started\"))},t.prototype.onStateChanged=function(l){if(this.logger.info(\"onStateChanged called\"),void 0===l)this.stateChangedListeners=this.stateChangedListeners.filter((function(l){return void 0===l.wrappedCallback}));else{this.offStateChanged(l);var e=function(d,u){l(d,u?u.url:\"\")};e.wrappedCallback=l,this.stateChangedListeners.push(e)}},t.prototype.offStateChanged=function(l){this.logger.info(\"offStateChanged called\");var d=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter((function(d){return d.wrappedCallback!==l})),d>this.stateChangedListeners.length},t.prototype.addCallback=function(l){this.logger.info(\"addListener called\"),-1===this.stateChangedListeners.indexOf(l,0)&&void 0!==l&&this.stateChangedListeners.push(l)},t.prototype.removeCallback=function(l){this.logger.info(\"removeListener called\");var d=this.stateChangedListeners.indexOf(l,0);return d>-1&&(this.stateChangedListeners.splice(d,1),!0)},t.prototype.registerMessageHandler=function(l){this.logger.info(\"registerMessageHandler is called\"),this.messageHandlers.register(l)},t.prototype.clearMessageHandlers=function(){this.logger.info(\"clearMessageHandlers is called\"),this.messageHandlers.clear()},t.prototype.notifyStateChanged=function(l,d){var u=this;this.logger.info(\"notifyStateChanged called, will forward to \"+this.stateChangedListeners.length+\" listeners\"),this.stateChangedListeners.forEach((function(p){try{p(l,d)}catch(l){u.logger.error(\"Error in callback \"+l)}}))},t.prototype.tryMessageHandlers=function(l,d){if(!this.messageHandlers.active())return!1;var u,p=null;try{p=(u=JSON.parse(l.body))&&(u.evt||u.eventId)||null}catch(l){}var h={eventId:p,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:\"\")+l.path,body:u,rawBody:l.body,headers:l.headers},g=this.messageHandlers.handleMessage(h);return!!g.isHandled&&(d.status=g.resultCode,g.responseHeaders&&(d.headers=g.responseHeaders),g.responseBody&&(d.body=g.responseBody),d.send(),!0)},t}();d.TrouterService=E,d.createTrouterService=r,d.getTrouterServiceVersion=s,d.replaceTrouterUrlBase=c},function(d,u){d.exports=l}])},l.exports=u(sp)})),__awaiter$f=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class TelemetrySender{constructor(l,d){this.logEvent=l=>{this._logger.debug(l),this._telemetryLogManager.sendEvent({name:l.name,tenant:J,properties:Object.assign({},l.properties)})},this._logger=l.createChild(\"TelemetrySender\"),this._telemetryLogManager=d}}class Trouter{constructor(l,d,u,p){this._ecsProvider=d,this._tokenProvider=u,this._isRegistered=!1,this._logger=l.createChild(\"Trouter\"),this._logger.info(\"init\"),this._initialRegistrationCompleteDefer=defer$1(),this._telemetryLogManager=p}start(l){return __awaiter$f(this,void 0,void 0,(function*(){if(this._trouterService)throw this._logger.error(\"Trouterservice already initialized\"),new CallingCommunicationError({message:\"Signaling service already initialized\",code:Ie});{const d=new Promise(((d,u)=>__awaiter$f(this,void 0,void 0,(function*(){try{if(this._logger.info(\"Trouterservice start\"),this._trouterService=cp.createTrouterService(this._logger),!this._trouterService)throw this._logger.error(\"Failed to create trouter service\"),new CallingCommunicationError({message:\"Failed to create trouter service\",code:Ie});this._options=this._getTrouterConfig(this._logger,this._tokenProvider),l&&(this._options.trouterSettings.environment=l.environment||\"\",this._options.trouterSettings.sessionId=l.sessionId),this._trouterService.start(this._options),yield this._initialRegistrationCompleteDefer.promise,d()}catch(l){u(l)}}))));try{const l=wait((()=>d),w);yield l}catch(l){throw 408===(null==l?void 0:l.code)?(this._logger.error(\"Signaling init timeout\"),new CallingCommunicationError({message:`Signaling init timeout, request took longer than ${w} ms`,code:Ce})):(this._logger.error(\"Signaling init failed\"),new CallingCommunicationError({message:\"Signaling init failed\",code:Ie}))}}}))}isRegistered(){return this._isRegistered}stop(l){this._logger.info(\"Trouterservice stop\"),this._trouterService?(this._trouterService.onStateChanged(void 0),this._trouterService.stop(l),this._trouterService=void 0):this._logger.error(\"Trouterservice not inited\")}registerMessageHandler(l){this._logger.info(\"Trouterservice registerMessageHandler\"),this._trouterService&&this._trouterService.registerMessageHandler(l)}clearMessageHandlers(){this._trouterService&&this._trouterService.clearMessageHandlers()}checkConnection(){this._trouterService&&this._trouterService.checkConnection()}state(){return this._logger.info(\"Trouterservice state\"),this._trouterService?this._trouterService.state():cp.TrouterState.Unknown}onStateChanged(l){this._logger.info(\"Trouterservice onStateChanged\"),this._trouterService&&this._trouterService.onStateChanged(l)}offStateChanged(l){this._logger.info(\"Trouterservice offStateChanged\"),this._trouterService&&this._trouterService.offStateChanged(l)}getTrouterUrlAsync(){return this._trouterService?(this._logger.info(\"getTrouterUrlAsync called\"),this._trouterService.getTrouterUrlAsync()):Promise.reject(\"Trouterservice not started yet\")}_getSettings(){return{registrationId:generateGuid(),registrarServiceUrl:this._ecsProvider.getTrouterSettings().registrarServiceUrl,registrarTtlInSeconds:this._ecsProvider.getTrouterSettings().registrarTtlInSeconds,maxRegistrationTimeInMs:this._ecsProvider.getTrouterSettings().maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:this._ecsProvider.getTrouterSettings().registrarRefreshTimeoutInMs,pnhAppId:this._ecsProvider.getTrouterSettings().pnhAppId,pnhTemplate:this._ecsProvider.getTrouterSettings().pnhTemplate,platform:this._ecsProvider.getTrouterSettings().platform,platformUIVersion:this._ecsProvider.getTrouterSettings().version,trouterServiceUrl:this._ecsProvider.getTrouterSettings().trouterServiceUrl,version:this._ecsProvider.getTrouterSettings().version,trouterConnectTimeoutInMs:this._ecsProvider.getTrouterSettings().trouterConnectTimeoutInMs,productName:this._ecsProvider.getTrouterSettings().productName,sessionId:generateGuid(),environment:this._ecsProvider.getTrouterSettings().environment,timeoutOptions:this._ecsProvider.getTrouterSettings().timeoutOptions}}_createTrouterTelemetryConfig(l){return{eventLogger:new TelemetrySender(l.createChild(\"TrouterTelemetry\"),this._telemetryLogManager),settings:{enabled:this._ecsProvider.getTrouterTelemetryConfig().enabled,logHealthCheckError:this._ecsProvider.getTrouterTelemetryConfig().logHealthCheckError,trouter_js_client_connected:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_connected,trouter_js_client_disconnected:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_disconnected,trouter_js_client_error:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_error,trouter_js_client_progress:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_progress,trouter_js_client_response:this._ecsProvider.getTrouterTelemetryConfig().trouter_js_client_response,numberOfStepsToMaintain:this._ecsProvider.getTrouterTelemetryConfig().numberOfStepsToMaintain,sendProgressTimeoutSecs:this._ecsProvider.getTrouterTelemetryConfig().sendProgressTimeoutSecs}}}_getTrouterConfig(l,d){return{trouterSettings:this._getSettings(),skypeTokenProvider:d,telemetryConfig:this._createTrouterTelemetryConfig(l),registrationStateCallbackForAcsDoNotUse:l=>{this._isRegistered=l,this._initialRegistrationCompleteDefer.isPending()&&this._isRegistered?this._initialRegistrationCompleteDefer.resolve():this._isRegistered?this._logger.info(\"Signaling service is currently registered\"):this._logger.error(\"Signaling service is currently not registered. Unable to receive incoming calls\")}}}}class TelemetryService{constructor(l){this._eventToTenantId={skypecosi_concore_web_csa_conversation_httprequest:z,skypecosi_concore_web_ts_calling_in_call_session:z,skypecosi_concore_web_ts_calling_call_setup_session:z,skypecosi_concore_native_ts_calling_in_call_session:z,skypecosi_concore_native_ts_calling_call_setup_session:z,skypecosi_concore_web_pluginless_call_session:z,skypecosi_concore_web_pluginless_modality_session:z,skypecosi_concore_web_csa_conversation_callmodality:z,skypecosi_concore_web_ts_calling_registry:z,mdsc_webrtc_session:K,mdsc_webrtc_session_initial:K,mdsc_ortc_reports:K,mdsc_ortc_reports_initial:K,mdsc_rt_log:K},this.getTenant=l=>this._eventToTenantId[l]?this._eventToTenantId[l]:\"\",this.getCallingAdapter=()=>({sendEvent:(l,d)=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(l),name:l,properties:d})}}),this.getGenericTelemetryLogger=l=>({sendEvent:l=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(l.eventName),name:l.eventName,properties:l.props})}}),this.getMediaAdapter=()=>({sendEvent:(l,d)=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(l),name:l,properties:d})}}),this.sendEvents=l=>(l.forEach((l=>{this._telemetryLogManager.sendEvent({tenant:this.getTenant(l.eventName),name:l.eventName,properties:l.props})})),Promise.resolve()),this._telemetryLogManager=l}}var lp,dp=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0});var u=function(){function AllowBackgroundFetchData(){this._isAllowed=!1}return AllowBackgroundFetchData.prototype.putBackgroundFetchAllowed=function(l){if(this._isAllowed=l,this.isBackgroundFetchAllowed()&&this._isAllowedDeferral){var d=this._isAllowedDeferral;this._isAllowedDeferral=void 0,d.resolve(void 0)}},AllowBackgroundFetchData.prototype.isBackgroundFetchAllowed=function(){return this._isAllowed},AllowBackgroundFetchData.prototype.waitForBackgroundFetchAllowed=function(){return this.isBackgroundFetchAllowed()?C.Resolved():(this._isAllowedDeferral||(this._isAllowedDeferral=C.Defer()),this._isAllowedDeferral.promise())},AllowBackgroundFetchData}();d.default=u})),up=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0});var u=function(){function AppActiveData(){this._isActive=!1}return AppActiveData.prototype.putAppActive=function(l){if(this._isActive=l,this.isAppActive()&&this._appActiveDeferral){var d=this._appActiveDeferral;this._appActiveDeferral=void 0,d.resolve(void 0)}},AppActiveData.prototype.isAppActive=function(){return this._isActive},AppActiveData.prototype.waitForAppActive=function(){return this.isAppActive()?C.Resolved():(this._appActiveDeferral||(this._appActiveDeferral=C.Defer()),this._appActiveDeferral.promise())},AppActiveData}();d.default=u})),pp=function(){function SubscriptionToken(l,d){this._event=l,this._callback=d}return SubscriptionToken.prototype.unsubscribe=function(){this._event.unsubscribe(this._callback)},SubscriptionToken}(),hp=function(){function SubscribableEvent(l){void 0===l&&(l=!1);var d=this;this._allowStopPropagation=l,this.fire=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];for(var p=d._subscribers,h=p.length-1;h>=0;h--){var g=p[h].apply(null,l);if(d._allowStopPropagation&&g)return!0}return!1},this._subscribers=[]}return SubscribableEvent.prototype.dispose=function(){this._subscribers=[]},SubscribableEvent.prototype.subscribe=function(l){return this._subscribers=this._subscribers.concat(l),new pp(this,l)},SubscribableEvent.prototype.unsubscribe=function(l){this._subscribers=this._subscribers.filter((function(d){return d!==l}))},SubscribableEvent}(),gp=Object.freeze({__proto__:null,SubscriptionToken:pp,default:hp}),fp=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0}),function(l){l[l.Default=0]=\"Default\",l[l.User=1]=\"User\"}(d.EcsConfigType||(d.EcsConfigType={}))})),mp=getAugmentedNamespace(gp),vp=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0});var u=function(){function Cache(l){this._config=l,this.configUpdated=new mp.default,this._cachedConfigs={}}return Cache.prototype.initialize=function(){return this.updateConfigsToFetch()},Cache.prototype.updateConfigsToFetch=function(){var l=this,d=this._config.getConfig(),u=d.databaseInterface,p=d.configsToFetch;if(!u)return C.Resolved();for(var h=[],_loop_1=function(d){if(g._cachedConfigs[d])return\"continue\";h.push(u.getData(d).then((function(u){u&&(l._cachedConfigs[d]=u)})).catch((function(){return C.Resolved()})))},g=this,f=0,m=p;f<m.length;f++){_loop_1(m[f])}return C.all(h).then((function(){h.length>0&&l.configUpdated.fire()}))},Cache.prototype.getEcsConfig=function(){return this._cachedConfigs[fp.EcsConfigType.User]||this._cachedConfigs[fp.EcsConfigType.Default]},Cache.prototype.getEcsConfigByType=function(l){return this._cachedConfigs[l]},Cache.prototype.putConfig=function(l){var d=this.getEcsConfig();this._cachedConfigs[l.configType]=l;var u=this.getEcsConfig();(u&&u.configType===l.configType||d&&u&&d.configType!==u.configType)&&this.configUpdated.fire();var p=this._config.getConfig().databaseInterface;return p?p.putData(l.configType,l):C.Resolved()},Cache}();d.default=u})),yp=createCommonjsModule((function(l,d){var u=h&&h.__assign||function(){return(u=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function Config(){}return Config.prototype.initialize=function(l){if(this._config)throw\"ECS Configuration already initialized\";this._config=l},Config.prototype.getConfig=function(){if(!this._config)throw\"ECS Configuration not yet initialized\";return this._config},Config.prototype.setConfigsToFetch=function(l){if(!this._config)throw\"ECS Configuration not yet initialized\";this._config=u({},this._config,{configsToFetch:l})},Config.prototype.setFetchTimeout=function(l){if(!this._config)throw\"ECS Configuration not yet initialized\";this._config=u({},this._config,{fetchTimeout:l})},Config}();d.default=p})),Sp=createCommonjsModule((function(l,d){var u=h&&h.__assign||function(){return(u=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0}),d.assert=function(l,d){if(!l)throw new Error(d)},d.isObject=function(l){return null!==l&&\"object\"==typeof l},d.isString=function(l){return\"string\"==typeof l},d.attempt=function(l){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];try{return l.apply(void 0,d)}catch(l){return new Error(l)}},d.remove=function(l,d){for(var u=l.length-1;u>=0;u--)l[u]===d&&l.splice(u,1)},d.clone=function(l){return Array.isArray(l)?l.map(d.clone):d.isObject(l)?Object.keys(l).reduce((function(p,h){var g;return u(u({},p),((g={})[h]=d.clone(l[h]),g))}),{}):l}})),_p=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0}),d.DEFAULT_TIME_GROW_FACTOR=2.718281828459045,d.DEFAULT_TIME_JITTER=.11962656472;var u=function(){function ExponentialTime(l,u,p,h){void 0===p&&(p=d.DEFAULT_TIME_GROW_FACTOR),void 0===h&&(h=d.DEFAULT_TIME_JITTER),this._initialTime=l,this._maxTime=u,this._growFactor=p,this._jitterFactor=h,Sp.assert(this._initialTime>0,\"Initial delay must be positive\"),Sp.assert(this._maxTime>0,\"Delay upper bound must be positive\"),Sp.assert(this._growFactor>=0,\"Ratio must be non-negative\"),Sp.assert(this._jitterFactor>=0,\"Jitter factor must be non-negative\"),this.reset()}return ExponentialTime.prototype.reset=function(){this._incrementCount=0,this._currentTime=Math.round(this._initialTime*(1+Math.random()*this._jitterFactor))},ExponentialTime.prototype.getTime=function(){return this._currentTime},ExponentialTime.prototype.getIncrementCount=function(){return this._incrementCount},ExponentialTime.prototype.calculateNext=function(){var l=this._currentTime*this._growFactor;return l>this._maxTime&&(l=this._maxTime),this._jitterFactor<1e-5?this._currentTime=l:this._currentTime=Math.round(Math.random()*l*this._jitterFactor+l),this._currentTime<this._initialTime&&(this._currentTime=this._initialTime),this._currentTime>this._maxTime&&(this._currentTime=this._maxTime),this._incrementCount++,this._currentTime},ExponentialTime.prototype.getTimeAndCalculateNext=function(){var l=this.getTime();return this.calculateNext(),l},ExponentialTime}();d.ExponentialTime=u})),Cp=createCommonjsModule((function(l,d){var u,p,g=h&&h.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])})(l,d)};return function(l,d){function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),f=h&&h.__assign||function(){return(f=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};function isJsonContentType(l){return!!l&&0===l.indexOf(\"application/json\")}function isFormContentType(l){return!!l&&0===l.indexOf(\"application/x-www-form-urlencoded\")}function isFormDataContentType(l){return!!l&&0===l.indexOf(\"multipart/form-data\")}function DefaultErrorHandler(l,d){return d.canceled||!d.statusCode||d.statusCode>=400&&d.statusCode<600?p.DoNotRetry:p.RetryCountedWithBackoff}Object.defineProperty(d,\"__esModule\",{value:!0}),function(l){l[l.DontCare=0]=\"DontCare\",l[l.Low=1]=\"Low\",l[l.Normal=2]=\"Normal\",l[l.High=3]=\"High\",l[l.Critical=4]=\"Critical\"}(u=d.WebRequestPriority||(d.WebRequestPriority={})),function(l){l[l.DoNotRetry=0]=\"DoNotRetry\",l[l.RetryUncountedImmediately=1]=\"RetryUncountedImmediately\",l[l.RetryUncountedWithBackoff=2]=\"RetryUncountedWithBackoff\",l[l.RetryCountedWithBackoff=3]=\"RetryCountedWithBackoff\",l[l.PauseUntilResumed=4]=\"PauseUntilResumed\"}(p=d.ErrorHandlingType||(d.ErrorHandlingType={})),d.DefaultOptions={priority:u.Normal},d.SimpleWebRequestOptions={MaxSimultaneousRequests:5,HungRequestCleanupIntervalMs:1e4,setTimeout:function(l,d){return setTimeout(l,d)},clearTimeout:function(l){return clearTimeout(l)}},d.DefaultErrorHandler=DefaultErrorHandler;var m,v=[],y=[],S=[],_=0,E=0,T=function(){function SimpleWebRequestBase(l,u,p,h,g){this._action=l,this._url=u,this.options=p,this._getHeaders=h,this._blockRequestUntil=g,this._aborted=!1,this._timedOut=!1,this._paused=!1,this._created=Date.now(),this._finishHandled=!1,this._retryExponentialTime=new _p.ExponentialTime(1e3,3e5),this._options=f(f({},d.DefaultOptions),p)}return SimpleWebRequestBase.prototype.getPriority=function(){return this._options.priority||u.DontCare},SimpleWebRequestBase.checkQueueProcessing=function(){for(var _loop_1=function(){var l=v.shift();y.push(l),(l._blockRequestUntil&&l._blockRequestUntil()||C.Resolved()).finally((function(){Sp.remove(y,l)})).then((function(){S.length<d.SimpleWebRequestOptions.MaxSimultaneousRequests&&!l._aborted?(S.push(l),b._scheduleHungRequestCleanupIfNeeded(),l._fire()):l._enqueue()}),(function(d){l._respond(\"_blockRequestUntil rejected: \"+d)}))};v.length>0&&S.length<d.SimpleWebRequestOptions.MaxSimultaneousRequests;)_loop_1()},SimpleWebRequestBase._scheduleHungRequestCleanupIfNeeded=function(){S.length>0&&void 0===m?m=d.SimpleWebRequestOptions.setTimeout(this._hungRequestCleanupTimerCallback,d.SimpleWebRequestOptions.HungRequestCleanupIntervalMs):0===S.length&&m&&(d.SimpleWebRequestOptions.clearTimeout(m),m=void 0)},SimpleWebRequestBase.prototype._removeFromQueue=function(){Sp.remove(S,this),Sp.remove(v,this)},SimpleWebRequestBase.prototype._assertAndClean=function(l,d){l||(this._removeFromQueue(),console.error(d),Sp.assert(l,d))},SimpleWebRequestBase.prototype._fire=function(){var l=this;this._xhr=new XMLHttpRequest,this._xhrRequestHeaders={};var u=Sp.attempt((function(){l._xhr.open(l._action,l._url,!0)}));if(u)this._respond(u.toString());else{if(this._options.timeout){var p=E;3!==p&&(this._assertAndClean(!this._requestTimeoutTimer,\"Double-fired requestTimeoutTimer\"),this._requestTimeoutTimer=d.SimpleWebRequestOptions.setTimeout((function(){l._requestTimeoutTimer=void 0,l._timedOut=!0,l.abort()}),this._options.timeout)),(3===p||p<=1)&&(this._xhr.timeout=this._options.timeout,this._xhr.ontimeout=function(){E=3,3===p&&(l._timedOut=!0,l._aborted=!0,l._respond(\"TimedOut\"))})}var h=_;3!==h?(0===h&&(_=1),this._xhr.onreadystatechange=function(){l._xhr&&(3!==l._xhr.readyState||!l._options.streamingDownloadProgress||l._aborted?4===l._xhr.readyState&&(0===h&&1===_&&d.SimpleWebRequestOptions.setTimeout((function(){3!==_&&(_=2)}),1e4),l._respond()):l._options.streamingDownloadProgress(l._xhr.responseText))}):this._options.streamingDownloadProgress&&(this._xhr.onreadystatechange=function(){l._xhr&&3===l._xhr.readyState&&l._options.streamingDownloadProgress&&!l._aborted&&l._options.streamingDownloadProgress(l._xhr.responseText)}),2!==h&&(this._xhr.onload=function(){_=3,3===h&&l._respond()},this._xhr.onerror=function(){_=3,3===h&&l._respond()}),this._xhr.onabort=function(){l._aborted=!0,l._respond(\"Aborted\")},this._xhr.upload&&this._options.onProgress&&(this._xhr.upload.onprogress=this._options.onProgress);var g=this._options.acceptType||\"json\",f=this._options.customResponseType||SimpleWebRequestBase._getResponseType(g),m=Sp.attempt((function(){l._xhr.responseType=f}));if(m&&\"json\"!==f)throw m;b._setRequestHeader(this._xhr,this._xhrRequestHeaders,\"Accept\",SimpleWebRequestBase.mapContentType(g)),this._xhr.withCredentials=!!this._options.withCredentials;var v=this.getRequestHeaders(),y={};if(Object.keys(v).forEach((function(d){var u=v[d],p=d.toLowerCase();\"content-type\"!==p?\"accept\"!==p?(l._assertAndClean(!y[p],\"Setting duplicate header key: \"+y[p]+\" and \"+d),null!=u?(y[p]=!0,b._setRequestHeader(l._xhr,l._xhrRequestHeaders,d,u)):console.warn('Tried to set header \"'+d+'\" on request with \"'+u+'\" value, header will be dropped')):l._assertAndClean(!1,\"Don't set Accept with options.headers -- use it with the options.acceptType property\"):l._assertAndClean(!1,\"Don't set Content-Type with options.headers -- use it with the options.contentType property\")})),this._options.sendData){var S=SimpleWebRequestBase.mapContentType(this._options.contentType||\"json\");b._setRequestHeader(this._xhr,this._xhrRequestHeaders,\"Content-Type\",S);var C=SimpleWebRequestBase.mapBody(this._options.sendData,S);this._xhr.send(C)}else this._xhr.send()}},SimpleWebRequestBase._setRequestHeader=function(l,d,u,p){l.setRequestHeader(u,p),d[u]=p},SimpleWebRequestBase.mapContentType=function(l){return\"json\"===l?\"application/json\":\"form\"===l?\"application/x-www-form-urlencoded\":l},SimpleWebRequestBase.mapBody=function(l,d){if(isJsonContentType(d)){if(!Sp.isString(l))return JSON.stringify(l)}else if(isFormContentType(d)){if(!Sp.isString(l)&&Sp.isObject(l)){var u=l;return Object.keys(u).map((function(l){return encodeURIComponent(l)+(u[l]?\"=\"+encodeURIComponent(u[l].toString()):\"\")})).join(\"&\")}}else if(isFormDataContentType(d)){if(Sp.isObject(l)){var p=new FormData,h=l;return Object.keys(h).forEach((function(l){return p.append(l,h[l])})),p}Sp.assert(!1,\"contentType multipart/form-data must include an object as sendData\")}return l},SimpleWebRequestBase.prototype.setUrl=function(l){this._url=l},SimpleWebRequestBase.prototype.setHeader=function(l,d){this._options.augmentHeaders||(this._options.augmentHeaders={}),d?this._options.augmentHeaders[l]=d:delete this._options.augmentHeaders[l]},SimpleWebRequestBase.prototype.getRequestHeaders=function(){var l={};return!this._getHeaders||this._options.overrideGetHeaders||this._options.headers||(l=f(f({},l),this._getHeaders())),this._options.overrideGetHeaders&&(l=f(f({},l),this._options.overrideGetHeaders)),this._options.headers&&(l=f(f({},l),this._options.headers)),this._options.augmentHeaders&&(l=f(f({},l),this._options.augmentHeaders)),l},SimpleWebRequestBase.prototype.getOptions=function(){return Sp.clone(this._options)},SimpleWebRequestBase.prototype.setPriority=function(l){this._options.priority!==l&&(this._options.priority=l,this._paused||this._xhr||(Sp.remove(v,this),this._enqueue()))},SimpleWebRequestBase.prototype.resumeRetrying=function(){this._paused?(this._paused=!1,this._enqueue()):Sp.assert(!1,\"resumeRetrying() called but not paused!\")},SimpleWebRequestBase.prototype._enqueue=function(){var l=this;if(!this._aborted&&!(S.indexOf(this)>=0||y.indexOf(this)>=0||v.indexOf(this)>=0)){var d=v.findIndex((function(d){return d.getPriority()===l.getPriority()&&d._created>l._created||d.getPriority()<l.getPriority()}));d>-1?v.splice(d,0,this):v.push(this),SimpleWebRequestBase.checkQueueProcessing()}},SimpleWebRequestBase._getResponseType=function(l){return\"blob\"===l?\"arraybuffer\":\"text/xml\"===l||\"application/xml\"===l?\"document\":\"text/plain\"===l?\"text\":\"json\"},SimpleWebRequestBase._hungRequestCleanupTimerCallback=function(){m=void 0,S.filter((function(l){return!(!l._xhr||4!==l._xhr.readyState)&&(console.warn(\"SimpleWebRequests found a completed XHR that hasn't invoked it's callback functions, manually responding\"),!0)})).forEach((function(l){l._respond()})),b._scheduleHungRequestCleanupIfNeeded()},SimpleWebRequestBase}();d.SimpleWebRequestBase=T;var b=function(l){function SimpleWebRequest(d,u,p,h,g){return l.call(this,d,u,p,h,g)||this}return g(SimpleWebRequest,l),SimpleWebRequest.prototype.abort=function(){this._aborted?Sp.assert(!1,\"Already aborted \"+this._action+\" request to \"+this._url):(this._aborted=!0,this._retryTimer&&(d.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(d.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._deferred?(this._respond(\"Aborted\"),this._xhr&&this._xhr.abort()):Sp.assert(!1,\"Haven't even fired start() yet -- can't abort\"))},SimpleWebRequest.prototype.start=function(){var l=this;return this._deferred?(Sp.assert(!1,\"WebRequest already started\"),C.Rejected(\"WebRequest already started\")):(this._deferred=C.Defer(),this._deferred.onCancel((function(){l.abort()})),this._enqueue(),this._deferred.promise())},SimpleWebRequest.prototype._respond=function(l){var u=this;if(!this._finishHandled){this._finishHandled=!0,this._removeFromQueue(),this._retryTimer&&(d.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(d.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0);var h,g=0;if(this._xhr)try{g=this._xhr.status,h=this._xhr.statusText||l}catch(l){}else h=l||\"Browser Error - Possible CORS or Connectivity Issue\";var f,m,v={};if(this._xhr){if((this._xhr.getAllResponseHeaders()||\"\").split(/\\r?\\n/).forEach((function(l){if(0!==l.length){var d=l.indexOf(\":\");-1===d?v[l]=\"\":v[l.substr(0,d).toLowerCase()]=l.substr(d+1).trim()}})),!v[\"content-type\"]){var y=this._xhr.getResponseHeader(\"content-type\");y&&(v[\"content-type\"]=y)}if(f=this._xhr.response,v[\"content-type\"]&&isJsonContentType(v[\"content-type\"])&&(!f||!Sp.isObject(f))&&(\"text\"===this._xhr.responseType||\"\"===this._xhr.responseType)&&this._xhr.responseText)try{f=JSON.parse(this._xhr.responseText)}catch(l){m=l,console.warn(\"Failed to parse XHR JSON response\")}}if(this._xhr&&4===this._xhr.readyState&&(g>=200&&g<300||304===g)){var S={url:this._xhr.responseURL||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:g,statusText:h,headers:v,body:f,responseParsingException:m};this._deferred.resolve(S)}else{var _={url:(this._xhr?this._xhr.responseURL:void 0)||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:g,statusText:h,headers:v,body:f,canceled:this._aborted,timedOut:this._timedOut,responseParsingException:m};this._options.augmentErrorResponse&&this._options.augmentErrorResponse(_);var C=this._options.customErrorHandler?this._options.customErrorHandler(this,_):DefaultErrorHandler(this,_);C!==p.DoNotRetry&&(this._options.retries&&this._options.retries>0||C===p.PauseUntilResumed||C===p.RetryUncountedImmediately||C===p.RetryUncountedWithBackoff)?(C===p.RetryCountedWithBackoff&&this._options.retries--,this._requestTimeoutTimer&&(d.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._aborted=!1,this._timedOut=!1,this._finishHandled=!1,this._xhr&&(this._xhr.onabort=null,this._xhr.onerror=null,this._xhr.onload=null,this._xhr.onprogress=null,this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=void 0,this._xhrRequestHeaders=void 0),C===p.PauseUntilResumed?this._paused=!0:C===p.RetryUncountedImmediately?this._enqueue():this._retryTimer=d.SimpleWebRequestOptions.setTimeout((function(){u._retryTimer=void 0,u._enqueue()}),this._retryExponentialTime.getTimeAndCalculateNext())):this._deferred.reject(_)}T.checkQueueProcessing()}},SimpleWebRequest}(T);d.SimpleWebRequest=b})),Ep=createCommonjsModule((function(l,d){var u=h&&h.__assign||function(){return(u=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(){function GenericRestClient(l){this._defaultOptions={excludeEndpointUrl:!1,withCredentials:!1,retries:0},this._endpointUrl=l}return GenericRestClient.prototype._performApiCall=function(l,d,p,h){var g=this;void 0===h&&(h={});var f=u(u({},this._defaultOptions),h);p&&(f.sendData=p),f.eTag&&(f.augmentHeaders||(f.augmentHeaders={}),f.augmentHeaders[\"If-None-Match\"]=f.eTag),f.contentType||(f.contentType=Sp.isString(f.sendData)?\"form\":\"json\");var m=f.excludeEndpointUrl?l:this._endpointUrl+l;return new Cp.SimpleWebRequest(d,m,f,(function(){return g._getHeaders(f)}),(function(){return g._blockRequestUntil(f)})).start().then((function(l){return g._processSuccessResponse(l),l}))},GenericRestClient.prototype._getHeaders=function(l){return{}},GenericRestClient.prototype._blockRequestUntil=function(l){},GenericRestClient.prototype._processSuccessResponse=function(l){},GenericRestClient.prototype.performApiGet=function(l,d){return this.performApiGetDetailed(l,d).then((function(l){return l.body}))},GenericRestClient.prototype.performApiGetDetailed=function(l,d){return this._performApiCall(l,\"GET\",void 0,d)},GenericRestClient.prototype.performApiPost=function(l,d,u){return this.performApiPostDetailed(l,d,u).then((function(l){return l.body}))},GenericRestClient.prototype.performApiPostDetailed=function(l,d,u){return this._performApiCall(l,\"POST\",d,u)},GenericRestClient.prototype.performApiPatch=function(l,d,u){return this.performApiPatchDetailed(l,d,u).then((function(l){return l.body}))},GenericRestClient.prototype.performApiPatchDetailed=function(l,d,u){return this._performApiCall(l,\"PATCH\",d,u)},GenericRestClient.prototype.performApiPut=function(l,d,u){return this.performApiPutDetailed(l,d,u).then((function(l){return l.body}))},GenericRestClient.prototype.performApiPutDetailed=function(l,d,u){return this._performApiCall(l,\"PUT\",d,u)},GenericRestClient.prototype.performApiDelete=function(l,d,u){return this.performApiDeleteDetailed(l,d,u).then((function(l){return l.body}))},GenericRestClient.prototype.performApiDeleteDetailed=function(l,d,u){return this._performApiCall(l,\"DELETE\",d,u)},GenericRestClient}();d.GenericRestClient=p})),Tp=createCommonjsModule((function(l,d){function __export(l){for(var u in l)d.hasOwnProperty(u)||(d[u]=l[u])}Object.defineProperty(d,\"__esModule\",{value:!0}),__export(_p),__export(Ep),__export(Cp)})),bp=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0});var u=function(){function TelemetryEventBase(){}return TelemetryEventBase.prototype.getAttributes=function(){return{Source:\"ecs_client\"}},TelemetryEventBase}();d.TelemetryEventBase=u})),Ip=createCommonjsModule((function(l,d){var u=h&&h.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])})(l,d)};return function(l,d){function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}();Object.defineProperty(d,\"__esModule\",{value:!0});var p=function(l){function EcsConfigFetchResponse(d,u,p,h,g,f,m,v,y,S,_,C,E){var T=l.call(this)||this;return T._responseTime=d,T._responseCode=u,T._fetchAttempts=p,T._hasValidToken=h,T._serverEndpoint=g,T._etag=f,T._fetchDurationValid=m,T._cacheAvailable=v,T._responseSize=y,T._configAge=S,T._configExpired=_,T._fetchStart=C,T._fetchEnd=E,T}return u(EcsConfigFetchResponse,l),EcsConfigFetchResponse.prototype.getEventName=function(){return\"ecs_tsclient_fetch_config\"},EcsConfigFetchResponse.prototype.getAttributes=function(){var d=l.prototype.getAttributes.call(this);return d.fetch_delay_ms=this._responseTime,d.fetch_response_code=this._responseCode,d.fetch_attempts=this._fetchAttempts,d.authenticated_user=this._hasValidToken,d.url=this._serverEndpoint,d.fetched_etag=this._etag,d.fetch_duration_valid=this._fetchDurationValid,d.cache_available=this._cacheAvailable,d.response_size=this._responseSize,d.config_age=this._configAge,d.config_expired=this._configExpired,d.fetch_start=this._fetchStart,d.fetch_end=this._fetchEnd,d},EcsConfigFetchResponse}(bp.TelemetryEventBase);d.EcsConfigFetchResponse=p})),Ap=createCommonjsModule((function(l,d){var u=h&&h.__extends||function(){var extendStatics=function(l,d){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var u in d)d.hasOwnProperty(u)&&(l[u]=d[u])})(l,d)};return function(l,d){function __(){this.constructor=l}extendStatics(l,d),l.prototype=null===d?Object.create(d):(__.prototype=d.prototype,new __)}}(),p=h&&h.__assign||function(){return(p=Object.assign||function(l){for(var d,u=1,p=arguments.length;u<p;u++)for(var h in d=arguments[u])Object.prototype.hasOwnProperty.call(d,h)&&(l[h]=d[h]);return l}).apply(this,arguments)};Object.defineProperty(d,\"__esModule\",{value:!0});var g,f,m=1728e5,v=18e5,y=31536e6,S=3e4,_=function(l){function EcsFetcher(d,u,p,h,g,f,m,v){var y=l.call(this,d)||this;if(y._config=u,y._skypeTokenData=p,y._appActiveData=h,y._allowBackgroundFetchData=g,y._etag=f,y._getUserConfig=m,y._apiPath=\"/config/v1/\"+y._config.getConfig().clientName+\"/\"+y._config.getConfig().clientVersion,v){var S=Object.keys(v).map((function(l){return encodeURIComponent(l)+\"=\"+encodeURIComponent(v[l].toString())}));S&&(y._apiPath+=\"?\"+S.join(\"&\"))}return y}return u(EcsFetcher,l),EcsFetcher.prototype._blockRequestUntil=function(l){var d=this;if(this._getUserConfig&&!this._skypeTokenData.isSkypeTokenValid()&&console.log(\"ECS - Delaying User config fetch until we have a valid SkypeToken\"),!this._appActiveData.isAppActive()&&!this._allowBackgroundFetchData.isBackgroundFetchAllowed()){var u=this._getUserConfig?\"User config\":\"config\";console.log(\"ECS - Delaying \"+u+\" fetch until the app is active (or background fetch is allowed)\")}return C.race([this._appActiveData.waitForAppActive(),this._allowBackgroundFetchData.waitForBackgroundFetchAllowed()]).then((function(){if(d._getUserConfig)return d._skypeTokenData.waitForValidSkypeToken()})).then((function(){f=Date.now()}))},EcsFetcher.prototype._getHeaders=function(){var l={};return this._etag&&(l[\"If-None-Match\"]=this._etag),this._getUserConfig&&(l.Authorization=this._skypeTokenData.getSkypeToken()),l},EcsFetcher.prototype.getConfig=function(){var d=this._config.getConfig().fetchTimeout;return void 0!==d&&(d<0?d=0:d>0&&d<S&&(d=S)),l.prototype.performApiGetDetailed.call(this,this._apiPath,{timeout:d})},EcsFetcher}(Tp.GenericRestClient),E=function(){function EcsClient(l,d,u,p,h){this._config=l,this._skypeTokenData=d,this._appActiveData=u,this._allowBackgroundFetchData=p,this._telemetryManager=h,this._ecsFailureBackoffTimer=new Tp.ExponentialTime(1e3,3e5),this._cacheMaxAgeRegex=/.*max-age=(\\d+).*/gi,this._serverIndex=NaN}return EcsClient.prototype.getConfig=function(l,d,u){var h=this,m=this._config.getConfig().hosts;if((isNaN(this._serverIndex)||this._serverIndex>m.length-1)&&(this._serverIndex=Math.floor(Math.random()*m.length)),!m||!m.length)return C.Rejected(new Error(\"no configuration service endpoint\"));var v=C.Defer(),S=0,callConfigServer=function(){var E=l&&l.eTag?l.eTag:void 0,T=new _(m[h._serverIndex],h._config,h._skypeTokenData,h._appActiveData,h._allowBackgroundFetchData,E,d,u);S++,T.getConfig().then((function(u){var _=u.headers.etag,T=u.headers.expires;if(u.body&&u.body.Headers&&(_||(_=u.body.Headers.ETag),T||(T=u.body.Headers.Expires)),g=Date.now(),!_||!T)return console.warn(\"ECS - Service returned an empty ETag or Expiration header: \"+JSON.stringify(u)),C.Rejected();var b,I=new Date(h._calculateExpirationDate(u.headers)).getTime();if(304===u.statusCode&&l)(b=p({},l)).eTag=_,b.expiration=I,b.cacheUpdateTime=g,b.lastFetchTokenHash=h._skypeTokenData.getSkypeTokenHash(u.requestHeaders.Authorization);else{if(\"object\"!=typeof u.body)return console.warn(\"ECS - Service returned invalid response \"+JSON.stringify(u)),C.Rejected();b={config:u.body,configType:d?fp.EcsConfigType.User:fp.EcsConfigType.Default,eTag:_,expiration:I,cacheUpdateTime:f,lastFetchTokenHash:h._skypeTokenData.getSkypeTokenHash(u.requestHeaders.Authorization),appVersion:h._config.getConfig().clientVersion}}var A=g-f,R=!(A<0||A>y),P=l?Date.now()-l.cacheUpdateTime:0;h._telemetryManager.sendTelemetryEvent(new Ip.EcsConfigFetchResponse(A,u.statusCode,S,h._skypeTokenData.isSkypeTokenValid(),m[h._serverIndex],_,R,!!E,JSON.stringify(u).length,P,!(l&&l.expiration-Date.now()>0),f,g)),h._ecsFailureBackoffTimer.reset(),v.resolve(b)})).catch((function(){h._serverIndex=(h._serverIndex+1)%m.length,setTimeout((function(){callConfigServer()}),h._ecsFailureBackoffTimer.getTimeAndCalculateNext())}))};return callConfigServer(),v.promise()},EcsClient.prototype._calculateExpirationDate=function(l){var d=Date.now()+m;if(l.date&&l.expires){var u=new Date(l.date).getTime(),p=Date.now()-u,h=new Date(l.expires).getTime();return isNaN(h)?d:Math.min(d,h+p)}var g=this._cacheMaxAgeRegex.exec(l[\"cache-control\"]);return this._cacheMaxAgeRegex.lastIndex=0,g&&2===g.length?Math.min(d,Date.now()+1e3*Number(g[1])):Date.now()+v},EcsClient}();d.default=E})),Rp=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0});var u=function(){function Scheduler(l,d,u,p,h,g){var f=this;this._config=l,this._skypeTokenData=d,this._cache=u,this._isFetchingSettings={},this._pendingFetch={},this._paused=!1,this._fetchEcsSettingsIfNeeded=function(l){var d=f._config.getConfig(),u=f._cache.getEcsConfigByType(l);if(-1!==d.configsToFetch.indexOf(l)&&!f._isFetchingSettings[l])if(u||!f._pendingFetch[l]){var p=u?u.expiration-Date.now():-1;p<=0||u&&l===fp.EcsConfigType.User&&f._skypeTokenData.isSkypeTokenValid()&&u.lastFetchTokenHash!==f._skypeTokenData.getSkypeTokenHash(f._skypeTokenData.getSkypeToken())?f._fetchSkypeEcsSettings(l):setTimeout((function(){return f._fetchEcsSettingsIfNeeded(l)}),p)}else f._fetchSkypeEcsSettings(l)},this._fetchSkypeEcsSettings=function(l,d){(void 0===d&&(d=!1),f._isFetchingSettings[l]||f._paused&&!d)?f._pendingFetch[l]=!0:(f._pendingFetch[l]=!1,f._isFetchingSettings[l]=!0,f._config.getConfig().getEcsParameters().catch((function(){return console.warn(\"ECS - Failed to fetch ECS fetching parameters\"),{}})).then((function(d){return f._ecsClient.getConfig(f._cache.getEcsConfig(),l===fp.EcsConfigType.User,d)})).then((function(d){console.log(\"ECS - Config fetch complete\"),f._isFetchingSettings[l]=!1,f._cache.putConfig(d),f._fetchEcsSettingsIfNeeded(l)})))},this._ecsClient=new Ap.default(this._config,this._skypeTokenData,p,h,g)}return Scheduler.prototype.initialize=function(){var l=this;this.updateConfigsToFetch(),this._skypeTokenData.skypeTokenChanged.subscribe((function(){return l._fetchEcsSettingsIfNeeded(fp.EcsConfigType.User)}))},Scheduler.prototype.updateConfigsToFetch=function(){for(var l=this._config.getConfig(),d=0,u=l.configsToFetch;d<u.length;d++){(g=u[d])in this._isFetchingSettings||(this._isFetchingSettings[g]=!1),g in this._isFetchingSettings||(this._pendingFetch[g]=!1)}for(var p=0,h=l.configsToFetch;p<h.length;p++){var g=h[p],f=this._cache.getEcsConfigByType(g);!f||f.appVersion&&f.appVersion!==l.clientVersion?this._fetchSkypeEcsSettings(g,!0):this._fetchEcsSettingsIfNeeded(g)}},Scheduler.prototype.requestUpdate=function(){for(var l=0,d=this._config.getConfig().configsToFetch;l<d.length;l++){var u=d[l];this._fetchSkypeEcsSettings(u)}},Scheduler.prototype.pause=function(){this._paused=!0},Scheduler.prototype.resume=function(){this._paused=!1;for(var l=0,d=this._config.getConfig().configsToFetch;l<d.length;l++){var u=d[l];this._fetchEcsSettingsIfNeeded(u)}},Scheduler}();d.default=u})),Pp=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0});var u=function(){function SkypeTokenData(){this.skypeTokenChanged=new mp.default}return SkypeTokenData.prototype.putSkypeTokenData=function(l){if(this._data=l,this.isSkypeTokenValid()&&this.skypeTokenChanged.fire(),this.isSkypeTokenValid()&&this._validSkypeTokenDeferral){var d=this._validSkypeTokenDeferral;this._validSkypeTokenDeferral=void 0,d.resolve(void 0)}},SkypeTokenData.prototype.isSkypeTokenValid=function(){var l=this._data;return!!l&&!!l.skypeToken&&l.skypeTokenExpiration>Date.now()},SkypeTokenData.prototype.getSkypeToken=function(){var l=this._data;if(!l||!l.skypeToken)throw\"No Skype Token provided\";return l.skypeToken},SkypeTokenData.prototype.getSkypeTokenHash=function(l){return void 0===l?0:l.split(\"\").reduce((function(l,d){return(101*l+d.charCodeAt(0))%999727999}),l.length)},SkypeTokenData.prototype.waitForValidSkypeToken=function(){return this.isSkypeTokenValid()?C.Resolved():(this._validSkypeTokenDeferral||(this._validSkypeTokenDeferral=C.Defer()),this._validSkypeTokenDeferral.promise())},SkypeTokenData}();d.default=u})),Op=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0});var u=function(){function TelemetryManager(l){this._cache=l,this.telemetryEventAdded=new mp.default}return TelemetryManager.prototype.sendTelemetryEvent=function(l){var d=l.getEventName(),u=l.getAttributes(),p=!1,h=this._cache.getEcsConfig();if(h&&TelemetryManager._containsEcsClientTelemetryConfig(h.config)){var g=h.config.ECSCONFIG;g&&g.ecsClientTelemetry&&(p=!!g.ecsClientTelemetry[d])}p&&this.telemetryEventAdded.fire(d,u)},TelemetryManager._containsEcsClientTelemetryConfig=function(l){return!!l&&!!l.ECSCONFIG&&!!l.ECSCONFIG.ecsClientTelemetry},TelemetryManager}();d.default=u})),Mp=createCommonjsModule((function(l,d){Object.defineProperty(d,\"__esModule\",{value:!0}),d.Models=fp;var u=function(){function EcsClient(){this._allowBackgroundFetchData=new dp.default,this._appActiveData=new up.default,this._config=new yp.default,this._cache=new vp.default(this._config),this._skypeTokenData=new Pp.default,this._telemetryManager=new Op.default(this._cache),this._scheduler=new Rp.default(this._config,this._skypeTokenData,this._cache,this._appActiveData,this._allowBackgroundFetchData,this._telemetryManager),this.telemetryEventAdded=this._telemetryManager.telemetryEventAdded,this.configUpdated=this._cache.configUpdated}return EcsClient.prototype.initialize=function(l){var d=this;return this._config.initialize(l),this._skypeTokenData.putSkypeTokenData(l.initialSkypeTokenData),this._appActiveData.putAppActive(l.initialAppActiveState),this._cache.initialize().then((function(){d._scheduler.initialize()}))},EcsClient.prototype.getConfig=function(){return this._cache.getEcsConfig()},EcsClient.prototype.getConfigType=function(){var l=this._cache.getEcsConfig();if(l)return l.configType},EcsClient.prototype.requestUpdate=function(){this._scheduler.requestUpdate()},EcsClient.prototype.pause=function(){this._scheduler.pause()},EcsClient.prototype.resume=function(){this._scheduler.resume()},EcsClient.prototype.setAllowBackgroundFetch=function(l){this._allowBackgroundFetchData.putBackgroundFetchAllowed(l)},EcsClient.prototype.useSkypeToken=function(l,d){this._skypeTokenData.putSkypeTokenData({skypeToken:l,skypeTokenExpiration:d})},EcsClient.prototype.setAppActive=function(l){this._appActiveData.putAppActive(l)},EcsClient.prototype.setConfigsToFetch=function(l){var d=this;return this._config.setConfigsToFetch(l),this._cache.updateConfigsToFetch().then((function(){d._scheduler.updateConfigsToFetch()}))},EcsClient.prototype.setFetchTimeout=function(l){this._config.setFetchTimeout(l)},EcsClient}();d.default=u})),wp=getDefaultExportFromCjs(Mp);!function(l){l[l.Default=0]=\"Default\",l[l.User=1]=\"User\"}(lp||(lp={}));class EcsSkypeToken{constructor(l,d){this.skypeToken=l,this.skypeTokenExpiration=d}}class EcsConfigFetcher{constructor(l,d){this._logger=l,this._ecsClient=d||new wp,this._isSubscribed=this._initialized=!1}subscribeEcsConfig(l){return l.configType!==lp.Default&&l.configType!==lp.User?Promise.reject(Vn):(this._resetConfigCache(l),this._initialized||this._isSubscribed?Promise.reject(Gn):Promise.resolve(this._initializeEcsConfig(l).then((()=>{this._ecsClient.configUpdated.subscribe((()=>{this._isSubscribed=!0,this._config=this._ecsClient.getConfig(),void 0!==l.ecsConfigReceiver&&this._config&&l.ecsConfigReceiver(this._config.config)}))})).catch((l=>{this._logger.warn(\"Failed to initialize ECS config because: \"+l)}))))}setConfigsToFetch(l){return this._ecsClient.setConfigsToFetch(l)}dispose(){try{this._ecsClient.configUpdated.dispose()}catch(l){this._logger.warn(`Failed to dispose ECS config update, e=${l}`)}}getConfigType(){if(void 0!==this._configDefCache)return this._ecsClient.getConfigType()}getETag(){return void 0===this._config?\"\":this._config.eTag}getConfigId(l){return void 0===this._config?Promise.reject(Hn):Promise.resolve(this._config.config[Bn][l])}setAllowBackgroundFetch(l){return this._ecsClient.setAllowBackgroundFetch(l),Promise.resolve()}setSkypeToken(l,d){return this._ecsClient.useSkypeToken(l,d),Promise.resolve()}setAppActiveState(l){return this._ecsClient.setAppActive(l),Promise.resolve()}_resetConfigCache(l){void 0===l||void 0===this._configDefCache||l.queryParameters===this._configDefCache.queryParameters&&l.configType===this._configDefCache.configType||(this._isSubscribed=!1,this._initialized=!1,this._config=void 0),this._configDefCache=l}_initializeEcsConfig(l){this._initialized=!0;const d={hosts:l.ecsHosts?l.ecsHosts:this._getHostUrls(l.caConfigBag),clientName:jn,clientVersion:this._getClientVersion(l.platformId),configsToFetch:this._getLibConfigType(l.configType),getEcsParameters:()=>this._getQueryParameterPromise(l.queryParameters),initialAppActiveState:l.isAppInitiallyInForeground,initialSkypeTokenData:new EcsSkypeToken(l.userRawSkypeToken,l.userSkypeTokenExpiration)};return new Promise(((l,u)=>{this._ecsClient.initialize(d).then(l,u)}))}_getHostUrls(l){if(!l)return[Qn.Public_EcsServer_Url];if(l.identityType===Yn.Enterprise)return[Qn.Enterprise_Ecs_ServerUrl];switch(l.cloudType){case qn.Public:return[Qn.Public_EcsServer_Url];case qn.Dod:return[Qn.Dod_EcsServer_Url];case qn.GccHigh:return[Qn.GccHigh_EcsServer_Url];case qn.AirGap08:return[Qn.AirGap08_EcsServer_Url];case qn.AirGap09:return[Qn.AirGap09_EcsServer_Url];default:return[Qn.Public_EcsServer_Url]}}_getClientVersion(l){let d=\"\";return d+=l||getPlatformId(),d+=\"_\",d+=getSdkInternalVersion(),d}_getLibConfigType(l){return[l===lp.Default?Mp.Models.EcsConfigType.Default:Mp.Models.EcsConfigType.User]}_getQueryParameterPromise(l={}){return C.Resolved(l)}}class EcsConfigObj{constructor(l,d,u,p,h,g=!0,f,m,v,y){this.configType=l,this.caConfigBag=d,this.queryParameters=u,this.ecsConfigReceiver=p,this.platformId=h,this.isAppInitiallyInForeground=g,this.userRawSkypeToken=f,this.userSkypeTokenExpiration=m,this.projectName=v,this.ecsHosts=y}}var __decorate$b=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$b=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$g=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class CallStack{constructor(l,d,u,p){if(this._disposed=!1,this.clientId=d,this._sdkUserAgent=p,this.logger=l.createChild(\"CallStack\"),this._telemetryLogManager=u,\"https:\"!==location.protocol&&\"file:\"!==location.protocol&&\"localhost\"!==location.hostname)throw new CallingCommunicationError({message:\"ACS Web Calling SDK must be used through https, file:, or localhost\",code:ve});const h=getBrowserInfo();if(\"chrome\"!==h.name&&\"chromium\"!==h.name&&\"edgeanaheim\"!==h.name&&\"safari\"!==h.name)throw new CallingCommunicationError({message:cs.BrowserNotSupported,code:_e});this._telemetryService=new TelemetryService(this._telemetryLogManager),this._ecsProvider=new EcsProvider(this.logger,this._sdkUserAgent),this._ecsFetcher=new EcsConfigFetcher(this.logger)}getClientId(){return this.clientId}getTrouterState(){var l;const d=null===(l=null==this?void 0:this._trouterService)||void 0===l?void 0:l.state();let u=\"Uninitialized\";if(void 0!==d)switch(d){case 0:u=\"Unknown\";break;case 2:u=\"Connected\";break;case 3:u=\"Disconnected\";break;case 9:u=\"Switching\";break;default:u=d.toString()}return u}createStackBase(l){return __awaiter$g(this,void 0,void 0,(function*(){if(this._createStackBaseWaitPromise)return this._createStackBaseWaitPromise;const d=new Promise(((d,u)=>__awaiter$g(this,void 0,void 0,(function*(){try{const u=this._getBaseStackConfig();this._tsStack=yield A.pluginlessStackFactory.buildBaseStack(u),yield this.initializeEcsBase(l),d(this._tsStack)}catch(l){u(l)}}))));try{this._createStackBaseWaitPromise=wait((()=>d),O);const l=yield this._createStackBaseWaitPromise;return this.logger.log(\"Base stack init success\"),l}catch(l){throw yield this.dispose(),l.code===Ce?new CallingCommunicationError({message:\"Failed to create stack base due to timeout during initialization\",code:Ce}):new CallingCommunicationError({message:\"Failed to create stack base due to failure in intialization\",code:Ie},l)}}))}initializeStackForUser(l,d){return __awaiter$g(this,void 0,void 0,(function*(){if(this.caConfigBag=d,this._initializeStackForUserWaitPromise)return this._initializeStackForUserWaitPromise;this._tsStack=yield this.createStackBase(d),this._disposed=!1;const u=new Promise(((u,p)=>__awaiter$g(this,void 0,void 0,(function*(){try{this._tsStack?(this._telemetryService=new TelemetryService(this._telemetryLogManager),this._ecsProvider=new EcsProvider(this.logger,this._sdkUserAgent),this._ecsFetcher=new EcsConfigFetcher(this.logger),yield this.initializeEcsBase(d),yield this.initializeEcsForUser(l),getAcsEcsConfig().calling.doNotWaitForTrouter?this._initTrouter(l,d).catch((()=>{this.logger.warn(\"Signaling failed to initialize\")})):yield this._initTrouter(l,d),this.logger.log(\"Trouter initialized successfully\"),yield this._tsStack.initializeMediaAgent({httpRequestDispatcher:new A.HttpRequestDispatcherImplementation,tokenProvider:l,configProvider:{getSkypeConfig:()=>Promise.resolve({}),getRelayConfig:()=>{const l=this._ecsProvider.getMdnTrapSettings();return Promise.resolve(l)}},appStateProvider:this._getAppStateProvider(),clientInformation:this._ecsProvider.getJsCsaConfig().clientInformation}),yield this._tsStack.initializeSignalingAgentProvider({signalingAgentConfig:this._getSignalingConfig(l),trouterService:this._trouterService}),yield this._tsStack.init(),u(this._tsStack)):(this.logger.error(\"Base stack failed to create\"),p(new CallingCommunicationError({message:\"Base stack failed to create\",code:Ie})))}catch(l){p(l)}}))));try{this._initializeStackForUserWaitPromise=wait((()=>u),M);const l=yield this._initializeStackForUserWaitPromise;return this.sendStackInitEvent(!0),this.logger.log(\"User stack init success\"),l}catch(l){throw yield this.dispose(),l.code===Ce?(this.sendStackInitEvent(!1,\"User stack init timeout\",l),new CallingCommunicationError({message:\"User stack init timeout\",code:Ce})):(this.sendStackInitEvent(!1,\"User stack init failed\",l),new CallingCommunicationError({message:\"User stack init failed\",code:Ie},l))}}))}initializeEcsBase(l){return __awaiter$g(this,void 0,void 0,(function*(){const d=defer(),u=this.getEcsQueryParameters(l),p=new EcsConfigObj(lp.Default,l,u,(u=>{var p,h;if((null===(p=null==u?void 0:u.Headers)||void 0===p?void 0:p.CountryCode)&&this.updateEmergencyCallCountry(null===(h=null==u?void 0:u.Headers)||void 0===h?void 0:h.CountryCode),d.resolve(),this._ecsFetcher.getConfigType()===lp.User&&this._ecsSetupCompleteForUser.resolve(),this._ecsFetcher&&this._tsStack&&void 0!==u){let d;try{setAcsEcsConfig(u,this._telemetryLogManager),this._ecsProvider.setConfig(l,u),setMediaConfig(this._ecsProvider.getJamaSettings()),d=JSON.stringify(u),this._tsStack.getEcsProvider().setEcsConfig({ecsBlob:d,userIdentity:\"\",etag:this._ecsFetcher.getETag()})}catch(l){this.logger.error(\"Unable to parse configuration\")}}}),getPlatformId());yield this._ecsFetcher.subscribeEcsConfig(p);const h=+new Date;try{this.sendEcsSettingsFetchedDataEvent(kd.acs_calling_config_fetched_attempt,{attemptTimestamp:h});const l=wait((()=>d.promise),Q);yield l;const u=+new Date;this.sendEcsSettingsFetchedDataEvent(kd.acs_calling_config_fetched_success,{deltaTimeInMs:u-h})}catch(d){const u=+new Date;this.sendEcsSettingsFetchedDataEvent(kd.acs_calling_config_fetched_failure,{deltaTimeInMs:u-h},d),this.logger.warn(\"Failed to fetch base settings. Stack will initialize without default settings\",d),this._ecsProvider.setConfig(l,void 0)}}))}initializeEcsForUser(l){return __awaiter$g(this,void 0,void 0,(function*(){const d=yield l();this._ecsSetupCompleteForUser=defer();try{yield this._ecsFetcher.setConfigsToFetch([lp.User]),yield this._ecsFetcher.setSkypeToken(d,1e3*parseJWT(d).exp)}catch(l){throw this.logger.error(\"Unable to set skype token for user ecs config\"),new CallingCommunicationError({message:\"Failed to set configuration for stack\",code:Ie})}const u=+new Date;try{this.sendEcsSettingsFetchedDataEvent(kd.acs_calling_config_fetched_attempt,{attemptTimestamp:u});const l=wait((()=>this._ecsSetupCompleteForUser.promise),Q);yield l;const d=+new Date;this.sendEcsSettingsFetchedDataEvent(kd.acs_calling_config_fetched_success,{deltaTimeInMs:d-u})}catch(l){const d=+new Date;this.sendEcsSettingsFetchedDataEvent(kd.acs_calling_config_fetched_failure,{deltaTimeInMs:d-u},l),this.logger.warn(\"Failed to fetch user settings. Stack will initialize without user settings\",l)}}))}getDeviceManager(){return __awaiter$g(this,void 0,void 0,(function*(){if(!this._createStackBaseWaitPromise)throw new CallingCommunicationError({message:\"Failed to get device manager due to internal call stack undefined\",code:Ie});return(yield this._createStackBaseWaitPromise).getDeviceManager()}))}dispose(l){return __awaiter$g(this,void 0,void 0,(function*(){if(!this._disposed){if(this._disposed=!0,this._trouterService)try{this._trouterService.clearMessageHandlers(),this._trouterService.stop(l),this._trouterService=void 0}catch(l){this.logger.error(\"Failed to dispose signaling\")}if(this._tsStack)try{yield this._tsStack.dispose(),this._tsStack=void 0}catch(l){this.logger.error(\"Failed to dispose calling stack\")}this._ecsFetcher.dispose(),this._createStackBaseWaitPromise=void 0,this._initializeStackForUserWaitPromise=void 0,this._tsStack=void 0,this.logger.info(\"Calling stack disposed\")}}))}getEcsQueryParameters(l){const d={};try{d.CLRelease=A.getVersion();const u=getBrowserInfo();d.BrowserName=u.name,d.BrowserEngine=u.engine,d.BrowserVersion=u.version,d.FormFactor=u.formFactor,d.IdentityType=Yn.Consumer,d.Cloud=qn.Public,d.OSVer=`${getOS()}-${getOSVersion()}`,l&&(d.Cloud=l.cloudType,d.IdentityType=l.identityType);const p=\"_TS_BUILC_VERSION_\".replace(\"C\",\"D\");d.CLRelease===p?d.CLRelease=\"9999.99\":d.CLRelease.match(/^\\d+\\.\\d+\\.\\d+\\.\\d+$/)||delete d.CLRelease}catch(l){throw this.logger.error(l),new CallingCommunicationError({message:\"Failed to initialize callclient\",code:Ie},l)}return d}sendEcsSettingsFetchedDataEvent(l,d,u){let p=\"string\"==typeof(null==u?void 0:u.message)?null==u?void 0:u.message:void 0;l!==kd.acs_calling_config_fetched_failure&&(p=void 0),this._telemetryLogManager.sendEvent({name:l,tenant:q,properties:Object.assign(Object.assign({},d),{failureReason:p})})}updateEmergencyCallCountry(l){this.caConfigBag&&!this.caConfigBag.emergencyCountryCode&&!this.caConfigBag.IsUserEmergencyCountryCode&&l&&(this.caConfigBag.emergencyCountryCode=l)}_initTrouter(l,d){return __awaiter$g(this,void 0,void 0,(function*(){let d=+new Date;try{return this._trouterService=new Trouter(this.logger,this._ecsProvider,(d=>l(d)),this._telemetryLogManager),d=+new Date,yield this._trouterService.start(),void this.sendSignalingInitEvent(!0,+new Date-d)}catch(l){throw this.sendSignalingInitEvent(!1,+new Date-d,l),l}}))}_getBaseStackConfig(){const l=this._getMediaProviderConfig();return{clientInformation:this._ecsProvider.getClientInformation(),logger:this.logger,mediaSettings:l.mediaSettings,platformType:getPlatformName(),callSettings:{useLwjForAllCalls:!1},usePlatformSupportApi:!0,telemetryTenants:{media:\"mediaAgent\",signaling:\"signalingAgent\"},telemetryService:this._telemetryService}}_getSignalingConfig(l){var d,u;const p=Object.assign(Object.assign({},this._ecsProvider.getJsCsaConfig()),{httpRequestDispatcher:new A.HttpRequestDispatcherImplementation,telemetryManager:this._telemetryService.getCallingAdapter(),logger:this.logger,skypeToken:()=>l(),trouterServiceProvider:this._trouterService,ecsEtag:this._ecsFetcher.getETag()});return(null===(d=this.caConfigBag)||void 0===d?void 0:d.emergencyCountryCode)&&(p.emergencyCallCountry=null===(u=this.caConfigBag)||void 0===u?void 0:u.emergencyCountryCode),p}_getMediaProviderConfig(){return{logger:this.logger,mediaSettings:this._getMediaAgentConfig()}}_getMediaAgentConfig(){return Object.assign({},this._ecsProvider.getJamaSettings())}_getAppStateProvider(){return{isOnline:()=>!0}}sendStackInitEvent(l,d,u){try{const p=u instanceof CallingCommunicationError?u.message:\"unknown\";this._telemetryLogManager.sendEvent({name:kd.acs_calling_stack_init,tenant:q,properties:{success:l,reason:d,failureReason:p}})}catch(l){}}sendSignalingInitEvent(l,d,u){try{const p=u instanceof CallingCommunicationError?u.message:\"unknown\";this._telemetryLogManager.sendEvent({name:kd.acs_calling_signaling_init,tenant:q,properties:{success:l,failureReason:p,timestampInfo:{deltaTimeInMs:d}}})}catch(l){}}}__decorate$b([loggerProperty,__metadata$b(\"design:type\",Object)],CallStack.prototype,\"logger\",void 0),__decorate$b([asyncOperation($a.CreateStackBase),__metadata$b(\"design:type\",Function),__metadata$b(\"design:paramtypes\",[Object]),__metadata$b(\"design:returntype\",Promise)],CallStack.prototype,\"createStackBase\",null),__decorate$b([asyncOperation($a.InitializeStackForUser),__metadata$b(\"design:type\",Function),__metadata$b(\"design:paramtypes\",[Function,Object]),__metadata$b(\"design:returntype\",Promise)],CallStack.prototype,\"initializeStackForUser\",null),__decorate$b([asyncOperation($a.InitializeEcsBase),__metadata$b(\"design:type\",Function),__metadata$b(\"design:paramtypes\",[Object]),__metadata$b(\"design:returntype\",Promise)],CallStack.prototype,\"initializeEcsBase\",null),__decorate$b([asyncOperation($a.InitializeEcsForUser),__metadata$b(\"design:type\",Function),__metadata$b(\"design:paramtypes\",[Function]),__metadata$b(\"design:returntype\",Promise)],CallStack.prototype,\"initializeEcsForUser\",null),__decorate$b([asyncOperation($a.GetDeviceManager),__metadata$b(\"design:type\",Function),__metadata$b(\"design:paramtypes\",[]),__metadata$b(\"design:returntype\",Promise)],CallStack.prototype,\"getDeviceManager\",null),__decorate$b([asyncOperation($a.Dispose),__metadata$b(\"design:type\",Function),__metadata$b(\"design:paramtypes\",[Boolean]),__metadata$b(\"design:returntype\",Promise)],CallStack.prototype,\"dispose\",null);class ObservableSubjects{constructor(){this._eventEmitter=new ri.EventEmitter}notifyAll(l){this._eventEmitter.emit(l)}waitFor(l,d){let u=!1;const listener=()=>{u=!0},handle=(d,p)=>{try{u&&d(),p({reason:\"timeout\"})}catch(l){p({reason:\"error\",error:l})}finally{this._eventEmitter.off(l,listener)}},p=new Promise(((l,p)=>{u?handle(l,p):setTimeout((()=>{handle(l,p)}),d)}));return this._eventEmitter.once(l,listener),p}}var __decorate$c=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$c=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$h=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class DeviceManagerImpl{constructor(l,d,u){this._callStack=d,this._videoDevices=[],this._audioDevices=[],this._tsDeviceTypeToAudioDeviceType={2:\"Microphone\",3:\"Speaker\",4:\"CompositeAudioDevice\"},this.logger=l.createChild(\"DeviceManager\"),this._telemetryLogManager=u,this._eventEmitter=new CallingEventEmitter(this.logger),this._browserInfo=getBrowserInfo(),this._safariVideoPermissionState=\"unknown\",this._combinedDevicePermission=new Map,this._deviceSelectionNotifications=new ObservableSubjects}get telemetryLogManager(){return this._telemetryLogManager}getInputAudioStreamTrack(){var l,d;return __awaiter$h(this,void 0,void 0,(function*(){const u=generateGuid(),p=+new Date;if(this._telemetryLogManager.sendEvent({name:kd.acs_calling_get_raw_input_audio_stream_track_attempt,tenant:q,properties:{timestampInfo:{attemptTimestamp:p},correlationId:u}}),!(null===(l=this._tsDeviceManager)||void 0===l?void 0:l.getRawInputAudioStreamTrack)){const l=new CallingCommunicationError({message:\"Failed to get raw input audio stream track\",code:Ie});this.logger.error(\"Failed to get raw input audio stream track\");const d=+new Date;throw this._telemetryLogManager.sendEvent({name:kd.acs_calling_get_raw_input_audio_stream_track_failure,tenant:q,properties:{timestampInfo:{deltaTimeInMs:d-p},correlationId:u,failureReason:getPrintableObject(l)}}),l}let h;try{h=yield null===(d=this._tsDeviceManager)||void 0===d?void 0:d.getRawInputAudioStreamTrack();const l=+new Date;return this._telemetryLogManager.sendEvent({name:kd.acs_calling_get_raw_input_audio_stream_track_success,tenant:q,properties:{timestampInfo:{deltaTimeInMs:l-p},correlationId:u}}),h}catch(l){const d=new CallingCommunicationError({message:\"Failed to get raw input audio stream track, make sure there is available microphone\",code:Te});this.logger.error(\"Failed to get raw input audio stream track\");const h=+new Date;throw this._telemetryLogManager.sendEvent({name:kd.acs_calling_get_raw_input_audio_stream_track_failure,tenant:q,properties:{timestampInfo:{deltaTimeInMs:h-p},correlationId:u,failureReason:getPrintableObject(l)}}),d}}))}disposeInputAudioStreamTrack(){var l,d;const u=generateGuid(),p=+new Date;if(this._telemetryLogManager.sendEvent({name:kd.acs_calling_dispose_raw_input_audio_stream_track_attempt,tenant:q,properties:{timestampInfo:{attemptTimestamp:p},correlationId:u}}),!(null===(l=this._tsDeviceManager)||void 0===l?void 0:l.disposeRawInputAudioStreamTrack)){const l=new CallingCommunicationError({message:\"Failed to dispose raw input audio stream track\",code:Ie});this.logger.error(\"Failed to dispose raw input audio stream track\");const d=+new Date;throw this._telemetryLogManager.sendEvent({name:kd.acs_calling_dispose_raw_input_audio_stream_track_failure,tenant:q,properties:{timestampInfo:{deltaTimeInMs:d-p},correlationId:u,failureReason:getPrintableObject(l)}}),l}null===(d=this._tsDeviceManager)||void 0===d||d.disposeRawInputAudioStreamTrack();const h=+new Date;this._telemetryLogManager.sendEvent({name:kd.acs_calling_dispose_raw_input_audio_stream_track_success,tenant:q,properties:{timestampInfo:{deltaTimeInMs:h-p},correlationId:u}})}getClientId(){return this._callStack.getClientId()}getDeviceManager(){var l,d;return __awaiter$h(this,void 0,void 0,(function*(){if(this._tsDeviceManager)return;yield this._callStack.createStackBase(),this._tsDeviceManager=yield this._callStack.getDeviceManager();const u=yield this._tsDeviceManager.enumerateDevicesAsync();this.logger.info(`tsDevicesList:${JSON.stringify(u)}`),u.forEach((l=>{if(1===l.kind){const d=l;this._videoDevices.push(new VideoDeviceInfoImpl(d.label,d.id,\"UsbCamera\",this))}else if(2===l.kind||3===l.kind){const d=l,u=new AudioDeviceInfoImpl(d.label,d.id,d.isSystemDefault,this._tsDeviceTypeToAudioDeviceType[d.kind],this);2===l.kind&&d.isSystemDefault&&(this._selectedMicrophone=u),3===l.kind&&d.isSystemDefault&&(this._selectedSpeaker=u),this._audioDevices.push(u)}})),this._dmDevicesChangedSub=this._tsDeviceManager.on(\"devicesChanged\",(()=>__awaiter$h(this,void 0,void 0,(function*(){var l;try{yield this.syncDeviceList(yield null===(l=this._tsDeviceManager)||void 0===l?void 0:l.enumerateDevicesAsync()),this.checkForSelectedDevicesChanges()}catch(l){this.logger.warn(`Unable to handle devicesChanged, error=${null==l?void 0:l.message}, code=${null==l?void 0:l.code}`)}})))),getAcsEcsConfig().calling.devicePermissions.getCurrentState&&(this._audioDevicePermission=permissionStateToBool(null===(l=this._tsDeviceManager)||void 0===l?void 0:l.getPermissionState(\"microphone\"),this.logger),this._videoDevicePermission=permissionStateToBool(null===(d=this._tsDeviceManager)||void 0===d?void 0:d.getPermissionState(\"camera\"),this.logger)),this.logger.info(\"Initial permission state audio:\",this._audioDevicePermission,\"video:\",this._videoDevicePermission),this._dmDevicesPermissionChangedSub=this._tsDeviceManager.on(\"onPermissionStateChanged\",this.permissionsChanged.bind(this))}))}on(l,d){if(\"videoDevicesUpdated\"!==l&&\"audioDevicesUpdated\"!==l&&\"selectedMicrophoneChanged\"!==l&&\"selectedSpeakerChanged\"!==l)throw new CallingCommunicationError({message:`Not able to subscribe to event ${l}, unknown event name`,code:be});this._eventEmitter.on(l,d)}off(l,d){if(\"videoDevicesUpdated\"!==l&&\"audioDevicesUpdated\"!==l&&\"selectedMicrophoneChanged\"!==l&&\"selectedSpeakerChanged\"!==l)throw new CallingCommunicationError({message:`Not able to unsubscribe event ${l}, unknown event name`,code:be});this._eventEmitter.off(l,d)}getTsDeviceManager(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:\"Unable to access device manager\",code:Ie});return this._tsDeviceManager}getSafariPermissionState(){return\"safari\"===this._browserInfo.name?this._safariVideoPermissionState:\"unknown\"}getAcsResourceId(){var l,d;return null===(d=null===(l=this._callStack)||void 0===l?void 0:l.caConfigBag)||void 0===d?void 0:d.acsResourceId}getAudioDevicePermission(){return this._audioDevicePermission}getVideoDevicePermission(){return this._videoDevicePermission}permissionsChanged(l){var d,u;const p=this._audioDevicePermission,h=this._videoDevicePermission;let g,f;getAcsEcsConfig().calling.devicePermissions.getCurrentState?(g=permissionStateToBool(null===(d=this._tsDeviceManager)||void 0===d?void 0:d.getPermissionState(\"microphone\"),this.logger),f=permissionStateToBool(null===(u=this._tsDeviceManager)||void 0===u?void 0:u.getPermissionState(\"camera\"),this.logger)):(g=p,f=h),this._audioDevicePermission=g||!!(null==l?void 0:l.audio),this._videoDevicePermission=f||!!(null==l?void 0:l.video),p===this._audioDevicePermission&&h===this._videoDevicePermission||(this.logger.info(`permission state changed from audio: ${p}, video: ${h}\\n                          to audio: ${this._audioDevicePermission}, video: ${this._videoDevicePermission}`),this._telemetryLogManager.sendEvent({name:kd.acs_calling_device_permission_changed,tenant:q,properties:{previousAudioDevicePermission:this.nullHandler(p),previousVideoDevicePermission:this.nullHandler(h),newAudioDevicePermission:this.nullHandler(this._audioDevicePermission),newVideoDevicePermission:this.nullHandler(this._videoDevicePermission)}}))}checkForSelectedDevicesChanges(){var l,d;if(this.logger.info(\"checkForSelectedDevicesChanges\"),this._tsDeviceManager){const u=this._tsDeviceManager.getSelectedDevices();u.microphone!==(null===(l=this._selectedMicrophone)||void 0===l?void 0:l.id)&&(this._selectedMicrophone=this._audioDevices.find((l=>l.id===u.microphone)),this._eventEmitter.emit(\"selectedMicrophoneChanged\"),void 0!==u.microphone&&this._deviceSelectionNotifications.notifyAll(u.microphone)),u.speaker!==(null===(d=this._selectedSpeaker)||void 0===d?void 0:d.id)&&(this._selectedSpeaker=this._audioDevices.find((l=>l.id===u.speaker)),this._eventEmitter.emit(\"selectedSpeakerChanged\"),void 0!==u.speaker&&this._deviceSelectionNotifications.notifyAll(u.speaker))}else this.logger.warn(\"DeviceManager is undefined, Unable to check selected devices\")}isACSDeviceEqualToTSDevice(l,d){return l.id===d.id}syncDeviceList(l){return __awaiter$h(this,void 0,void 0,(function*(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:\"Unable to access device manager\",code:Ie});this.logger.info(\"syncDeviceList\"),void 0===l&&(l=yield this._tsDeviceManager.enumerateDevicesAsync());const d=[];let u=[];const p=[];let h=[];l.map((l=>{if(1===l.kind){const u=this._videoDevices.find((d=>this.isACSDeviceEqualToTSDevice(d,l)));if(u)u.setName(l.label),u.setId(l.id),u.setDeviceType(\"UsbCamera\");else{const u=new VideoDeviceInfoImpl(l.label,l.id,\"UsbCamera\",this);d.push(u),this._videoDevices.push(u)}}else if(2===l.kind||3===l.kind){const d=this._audioDevices.find((d=>this.isACSDeviceEqualToTSDevice(d,l)));if(d){const u=l;d.setName(u.label),d.setId(u.id),d.setIsSystemDefault(u.isSystemDefault),d.setDeviceType(this._tsDeviceTypeToAudioDeviceType[u.kind])}else{const d=new AudioDeviceInfoImpl(l.label,l.id,l.isSystemDefault,this._tsDeviceTypeToAudioDeviceType[l.kind],this);p.push(d),this._audioDevices.push(d)}}}));const calculateRemovedDiffs=d=>{const u=d.filter((d=>!l.find((l=>this.isACSDeviceEqualToTSDevice(d,l)))));return u.map((l=>{d.splice(d.indexOf(l),1)})),u};u=calculateRemovedDiffs(this._videoDevices),h=calculateRemovedDiffs(this._audioDevices),(d.length>0||u.length>0)&&this._eventEmitter.emit(\"videoDevicesUpdated\",{added:d,removed:u}),(p.length>0||h.length>0)&&this._eventEmitter.emit(\"audioDevicesUpdated\",{added:p,removed:h})}))}get isSpeakerSelectionAvailable(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:\"Unable to access device manager\",code:Ie});return this._tsDeviceManager.isAudioOutputSelectionSupported}get selectedMicrophone(){return this._selectedMicrophone}get selectedSpeaker(){return this._selectedSpeaker}getCameras(){return __awaiter$h(this,void 0,void 0,(function*(){return yield this.syncDeviceList(),this._videoDevices}))}getMicrophones(){return __awaiter$h(this,void 0,void 0,(function*(){return yield this.syncDeviceList(),this._audioDevices.filter((l=>\"Microphone\"===l.deviceType))}))}getSpeakers(){return __awaiter$h(this,void 0,void 0,(function*(){if(this.isSpeakerSelectionAvailable)return yield this.syncDeviceList(),this._audioDevices.filter((l=>\"Speaker\"===l.deviceType));throw new CallingCommunicationError({message:\"This device does not support speaker enumeration.\",code:_e})}))}selectMicrophone(l){return __awaiter$h(this,void 0,void 0,(function*(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:\"Unable to access device manager\",code:Ie});if(this.logger.info(\"selectMicrophone called\"),this._selectedMicrophone!==l){const d=this._deviceSelectionNotifications.waitFor(l.id,3e3);this._tsDeviceManager.selectDevices({microphone:l.id});try{yield d}catch(l){throw new CallingCommunicationError({message:\"There was an issue in selecting microphone\",code:Ce})}}else this.logger.warn(\"microphoneDevice is already active\")}))}selectSpeaker(l){return __awaiter$h(this,void 0,void 0,(function*(){const d=this.logger.createFnLogger(Xa.SelectSpeaker);if(!this._tsDeviceManager)throw new CallingCommunicationError({message:\"Unable to access device manager\",code:Ie});if(!this.isSpeakerSelectionAvailable)throw new CallingCommunicationError({message:\"This device does not support speaker selection.\",code:_e});if(d.info(\"selectSpeaker called\"),this._selectedSpeaker!==l){const d=this._deviceSelectionNotifications.waitFor(l.id,3e3);this._tsDeviceManager.selectDevices({speaker:l.id});try{yield d}catch(l){throw new CallingCommunicationError({message:\"There was an issue in selecting speaker\",code:Ce})}}else d.warn(\"device is already selected\")}))}askDevicePermission(l){return __awaiter$h(this,void 0,void 0,(function*(){const d={audio:!!l.audio,video:!!l.video},u=generateGuid();if(this.sendAudioVideoPermissionEvent({eventName:kd.acs_calling_adp_attempt,correlationId:u,audioPermissionRequested:d.audio,videoPermissionRequested:d.video}),!this._tsDeviceManager){const l=new CallingCommunicationError({message:\"Unable to access device manager\",code:Ie});throw this.sendAudioVideoPermissionEvent({eventName:kd.acs_calling_adp_failure,correlationId:u,audioPermissionRequested:d.audio,videoPermissionRequested:d.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission},l),l}if(!l.audio&&!l.video){const l=new CallingCommunicationError({message:\"At least one permission must be requested\",code:ve});throw this.sendAudioVideoPermissionEvent({eventName:kd.acs_calling_adp_failure,correlationId:u,audioPermissionRequested:d.audio,videoPermissionRequested:d.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission},l),l}const p=this._combinedDevicePermission.get(this.getKeyForConstrains(d));if(p)return this.sendAudioVideoPermissionEvent({eventName:kd.acs_calling_adp_attempt,correlationId:u,audioPermissionRequested:d.audio,videoPermissionRequested:d.video,adpInProgress:!0}),this.logger.info(`askDevicePermission attempt: audio:${d.audio}, video:${d.video} on pending existing request ${getPrintableObject(p)}`),p;const h=this.askDevicePermissionInternal(d);return this._combinedDevicePermission.set(this.getKeyForConstrains(d),h),h}))}getKeyForConstrains(l){return Object.keys(l).filter((d=>l[d])).toString()}askDevicePermissionInternal(l){return __awaiter$h(this,void 0,void 0,(function*(){if(!this._tsDeviceManager)throw new CallingCommunicationError({message:\"Unable to access device manager\",code:Ie});this.logger.info(`askDevicePermission attempt: audio:${l.audio}, video:${l.video}`);const d=generateGuid(),u=+new Date;let p=[];try{if(getAcsEcsConfig().calling.devicePermissions.splitAskAudioVideo){this.logger.info(\"askDevicePermission, split permission check\");const d=[];if(l.audio&&(this.logger.info(\"askDevicePermission, split permission audio\"),d.push(this._tsDeviceManager.askDevicePermission({audio:l.audio,video:!1}))),l.video){const askDevicePermissionVideoWithDelay=d=>__awaiter$h(this,void 0,void 0,(function*(){return new Promise(((u,p)=>{const askDevicePermissionVideo=()=>__awaiter$h(this,void 0,void 0,(function*(){if(this.logger.info(\"askDevicePermission, split permission video\"),!this._tsDeviceManager){const l=\"askDevicePermission, split permission video failed device manager not found\";return this.logger.error(l),void p(l)}try{const d=yield this._tsDeviceManager.askDevicePermission({audio:!1,video:l.video});u(d)}catch(l){p(l)}}));d?window.setTimeout(askDevicePermissionVideo,d):askDevicePermissionVideo()}))}));d.push(askDevicePermissionVideoWithDelay(getAcsEcsConfig().calling.devicePermissions.timeoutInBetween))}const u=yield Promise.allSettled(d);let h={audio:!1,video:!1};u.forEach((l=>{var d,u;\"fulfilled\"===l.status&&(null==l?void 0:l.value)&&(h={audio:h.audio||!!(null===(d=null==l?void 0:l.value)||void 0===d?void 0:d.audio),video:h.video||!!(null===(u=null==l?void 0:l.value)||void 0===u?void 0:u.video)}),\"rejected\"===l.status&&(null==l?void 0:l.reason)&&p.push(l.reason)})),this.permissionsChanged(h),this._safariVideoPermissionState=this._videoDevicePermission?\"granted\":\"denied\"}else{const d=yield this._tsDeviceManager.askDevicePermission({audio:l.audio,video:l.video});this.permissionsChanged(d)}if((null==l?void 0:l.audio)&&!this._audioDevicePermission||(null==l?void 0:l.video)&&!this._videoDevicePermission)this.sendAudioVideoPermissionEvent({eventName:kd.acs_calling_adp_failure,correlationId:d,audioPermissionRequested:l.audio,videoPermissionRequested:l.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission},{name:\"Permissions not granted or failed\",message:`${getPrintableObject(p)}}`});else{const p=+new Date;this.sendAudioVideoPermissionEvent({eventName:kd.acs_calling_adp_success,correlationId:d,audioPermissionRequested:l.audio,videoPermissionRequested:l.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission,deltaTimeInMs:p-u})}}catch(p){this.logger.error(`Failed to get audio video permissions with error ${getPrintableObject(p)}`);const h=+new Date;this.sendAudioVideoPermissionEvent({eventName:kd.acs_calling_adp_failure,correlationId:d,audioPermissionRequested:l.audio,videoPermissionRequested:l.video,audioPermissionGranted:this._audioDevicePermission,videoPermissionGranted:this._videoDevicePermission,deltaTimeInMs:h-u},p)}return this._combinedDevicePermission.delete(this.getKeyForConstrains(l)),{audio:!!this._audioDevicePermission,video:!!this._videoDevicePermission}}))}sendAudioVideoPermissionEvent(l,d){try{let u,p=\"string\"==typeof(null==d?void 0:d.message)?null==d?void 0:d.message:void 0;l.eventName!==String(kd.acs_calling_adp_success)&&l.eventName!==String(kd.acs_calling_adp_failure)&&(p=void 0),l.deltaTimeInMs&&(u=l.deltaTimeInMs>25e3),this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:{audioPermissionGranted:this.nullHandler(l.audioPermissionGranted),videoPermissionGranted:this.nullHandler(l.videoPermissionGranted),audioPermissionRequested:l.audioPermissionRequested,videoPermissionRequested:l.videoPermissionRequested,correlationId:l.correlationId||\"\",failureReason:p||\"\",deltaTimeInMs:l.deltaTimeInMs||\"\",deltaTimeGreaterThanJAMATimeout:this.nullHandler(u)}})}catch(l){this.logger.debug(\"Unable to send audio video permission failure success telemtery\")}}nullHandler(l){return void 0===l?\"\":l}dispose(){this._dmDevicesChangedSub&&this._dmDevicesChangedSub.dispose(),this._dmDevicesPermissionChangedSub&&this._dmDevicesPermissionChangedSub.dispose(),this._dmDevicesPermissionChangedSub=void 0,this._dmDevicesChangedSub=void 0}}__decorate$c([loggerProperty,__metadata$c(\"design:type\",Object)],DeviceManagerImpl.prototype,\"logger\",void 0),__decorate$c([asyncOperation(Xa.GetDeviceManager),__metadata$c(\"design:type\",Function),__metadata$c(\"design:paramtypes\",[]),__metadata$c(\"design:returntype\",Promise)],DeviceManagerImpl.prototype,\"getDeviceManager\",null),__decorate$c([asyncOperation(Xa.GetCameras),__metadata$c(\"design:type\",Function),__metadata$c(\"design:paramtypes\",[]),__metadata$c(\"design:returntype\",Promise)],DeviceManagerImpl.prototype,\"getCameras\",null),__decorate$c([asyncOperation(Xa.GetMicrophones),__metadata$c(\"design:type\",Function),__metadata$c(\"design:paramtypes\",[]),__metadata$c(\"design:returntype\",Promise)],DeviceManagerImpl.prototype,\"getMicrophones\",null),__decorate$c([syncOperation(Xa.GetSpeakers),__metadata$c(\"design:type\",Function),__metadata$c(\"design:paramtypes\",[]),__metadata$c(\"design:returntype\",Promise)],DeviceManagerImpl.prototype,\"getSpeakers\",null),__decorate$c([asyncOperation(Xa.SelectMicrophone),__metadata$c(\"design:type\",Function),__metadata$c(\"design:paramtypes\",[Object]),__metadata$c(\"design:returntype\",Promise)],DeviceManagerImpl.prototype,\"selectMicrophone\",null),__decorate$c([asyncOperation(Xa.SelectSpeaker),__metadata$c(\"design:type\",Function),__metadata$c(\"design:paramtypes\",[Object]),__metadata$c(\"design:returntype\",Promise)],DeviceManagerImpl.prototype,\"selectSpeaker\",null),__decorate$c([asyncOperation(Xa.AskDevicePermission),__metadata$c(\"design:type\",Function),__metadata$c(\"design:paramtypes\",[Object]),__metadata$c(\"design:returntype\",Promise)],DeviceManagerImpl.prototype,\"askDevicePermission\",null);var __decorate$d=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$d=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$i=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};let Np=1;class CallClient{constructor(l){this.sendTelemetry=()=>{try{if(getAcsEcsConfig().telemetry.telemetryBeforeUnload&&this._callAgent&&this._callAgent._calls)for(const l of this._callAgent._calls){l.tsCall.sendLastKnownStats()}}catch(l){this.logger.debug(\"Error logging telemetry\",l)}},this.handleVisibilityChange=()=>{\"hidden\"===document.visibilityState?(this.logger.debug(\"Visibility changed to hidden\"),this.sendPageVisibilityInfoEvent(\"visibilityChange\",!0),this.hangupCalls()):(this.logger.debug(\"Visibility changed to visible\"),this.sendPageVisibilityInfoEvent(\"visibilityChange\",!1))},this.handlePageShow=()=>{this.logger.debug(\"Page show\"),this.sendPageVisibilityInfoEvent(\"pageShow\",!0)},this.handlePageHide=()=>{this.logger.debug(\"Page hide\"),this.sendPageVisibilityInfoEvent(\"pageHide\",!1)},this.handleOrientationChange=()=>{this.logger.debug(`Orientation changed to ${screen.orientation.type}`),this.sendOrientationChangeEvent(screen.orientation.type)},this.getOrientationBasedOnWindowSize=()=>window.innerHeight>window.innerWidth?\"portrait-primary\":\"landscape-primary\",this.handleResize=()=>{const l=this.getOrientationBasedOnWindowSize();this._previousOrientation!==l&&(this._previousOrientation=l,this.sendOrientationChangeEvent(l))},this.clientId=generateGuid();const u=(null==l?void 0:l.logger)||d.createClientLogger(\"ACS\"),p=Np++;this.logger=new DefaultLogger(u,[()=>`CallClient${p}`]),this._eventEmitter=new CallingEventEmitter(this.logger),this._sdkUserAgent=buildCallingUserAgent(getSdkVersion(),this.logger,l),this._telemetryLogManager=new TelemetryLogManager(this.logger,this._sdkUserAgent),this.logger.info(\"created\"),this._callStack=new CallStack(this.logger,this.clientId,this._telemetryLogManager,this._sdkUserAgent),this._deviceManager=new DeviceManagerImpl(this.logger,this._callStack,this._telemetryLogManager),this._previousOrientation=\"\",this.sendInitialOrientation(),window.addEventListener(\"beforeunload\",this.sendTelemetry),window.addEventListener(\"visibilitychange\",this.handleVisibilityChange,!1),window.addEventListener(\"pageshow\",this.handlePageShow,!1),window.addEventListener(\"pagehide\",this.handlePageHide,!1),screen.orientation?screen.orientation.addEventListener(\"change\",this.handleOrientationChange):window.addEventListener(\"resize\",this.handleResize,!1),this._extensibleApi=new ExtensibleFeatureImpl(this.logger,{callClient:this},{callClient:this,telemetryLogManager:this._telemetryLogManager});for(const l of Iu)l.isCallClientFeature&&\"OnExtendedObjectConstructor\"===l.activationOptions.activationEvent&&this.feature(l)}get callAgent(){return this._callAgent}get userAgent(){return this._sdkUserAgent}setCallAgent(l){this._callAgent=l}on(l,d){this._eventEmitter.on(l,d)}off(l,d){this._eventEmitter.off(l,d)}feature(l){return this._extensibleApi.getApiObjectInstance(l.callClientApiCtor)}createCallAgent(l,d){return __awaiter$i(this,void 0,void 0,(function*(){this._callAgent&&logErrorAndThrow(\"CallClient instance can support only one CallAgentcreate new CallClient instance to create new CallAgent\",Ie,this.logger),this.validateEmergencyCountryCode(d);try{const onDisposedCallback=()=>{this._callAgent=void 0};return this._callAgent=new CallAgentImpl(this,this.logger,this._callStack,this.clientId,this._telemetryLogManager),yield this._callAgent.initialize(l,onDisposedCallback,d),this._eventEmitter.emit(\"callAgentCreated\"),this._callAgent}catch(l){throw this._callAgent=void 0,new CallingCommunicationError({message:\"Failed to create CallAgent\",code:Ee},l)}}))}getDeviceManager(){return __awaiter$i(this,void 0,void 0,(function*(){return yield this._deviceManager.getDeviceManager(),this._deviceManager}))}getEnvironmentInfo(){return __awaiter$i(this,void 0,void 0,(function*(){return yield this._callStack.createStackBase(),getEnvironmentInfos()}))}getSDKVersion(){return getSdkVersion()}validateEmergencyCountryCode(l){var d,u;(null===(d=null==l?void 0:l.emergencyCallOptions)||void 0===d?void 0:d.countryCode)&&(null===(u=l.emergencyCallOptions)||void 0===u?void 0:u.countryCode.length)>Y&&logErrorAndThrow(\"EmergencyCountryCode is invalid, max length is 10\",ve,this.logger)}sendOrientationChangeEvent(l,d=!1){try{this._telemetryLogManager.sendEvent({name:kd.acs_calling_orientation_changed,tenant:q,properties:{orientation:l,isInitial:d}})}catch(l){this.logger.debug(\"Unable to send orientation change telemtery\")}}sendInitialOrientation(){let l=screen.orientation&&screen.orientation.type;l||(l=this.getOrientationBasedOnWindowSize()),this.sendOrientationChangeEvent(l,!0)}hangupCalls(){var l;try{\"Mobile\"===getBrowserInfo().formFactor&&getAcsEcsConfig().calling.hangUpCallOnPageHide&&(null===(l=this._callAgent)||void 0===l||l.calls.forEach((l=>l.hangUp())))}catch(l){try{this.logger.error(`Unable to hangup call on page hide due to ${JSON.stringify(l)}`)}catch(l){this.logger.error(\"Unable to hangup call on page hide due to unknown error\")}}}sendPageVisibilityInfoEvent(l,d){try{this._telemetryLogManager.sendEvent({name:kd.acs_calling_page_hidden,tenant:q,properties:{eventName:l,pageHidden:d}})}catch(l){this.logger.debug(\"Unable to send page hide telemtery\")}}}__decorate$d([loggerProperty,__metadata$d(\"design:type\",Object)],CallClient.prototype,\"logger\",void 0),__decorate$d([asyncOperation(Ka.CreateCallAgent),__metadata$d(\"design:type\",Function),__metadata$d(\"design:paramtypes\",[Object,Object]),__metadata$d(\"design:returntype\",Promise)],CallClient.prototype,\"createCallAgent\",null),__decorate$d([asyncOperation(Ka.GetDeviceManager),__metadata$d(\"design:type\",Function),__metadata$d(\"design:paramtypes\",[]),__metadata$d(\"design:returntype\",Promise)],CallClient.prototype,\"getDeviceManager\",null),__decorate$d([asyncOperation(Ka.GetEnvironmentInfo),__metadata$d(\"design:type\",Function),__metadata$d(\"design:paramtypes\",[]),__metadata$d(\"design:returntype\",Promise)],CallClient.prototype,\"getEnvironmentInfo\",null),__decorate$d([syncOperation(Ka.GetSDKVersion),__metadata$d(\"design:type\",Function),__metadata$d(\"design:paramtypes\",[]),__metadata$d(\"design:returntype\",String)],CallClient.prototype,\"getSDKVersion\",null);var __decorate$e=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$e=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$j=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))},__rest=function(l,d){var u={};for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&d.indexOf(p)<0&&(u[p]=l[p]);if(null!=l&&\"function\"==typeof Object.getOwnPropertySymbols){var h=0;for(p=Object.getOwnPropertySymbols(l);h<p.length;h++)d.indexOf(p[h])<0&&Object.prototype.propertyIsEnumerable.call(l,p[h])&&(u[p[h]]=l[p[h]])}return u};let Dp=1;class RemoteStreamRenderer{constructor(l,d,u,p,h,g){this._target=l,this._viewId=d,this._videoStream=u,this._onDisposedCallback=h,this._eventEmitter=new ri.EventEmitter,this._isRendering=!1,this._scalingMode=\"Stretch\",this._isMirrored=!1,this._size={height:0,width:0},this._disposed=!1,this._handleTsRendererChanged=l=>{var d;if(this.logger.debug(`rendering state is ${this._isRendering}, changed to ${null===(d=this._tsRenderer)||void 0===d?void 0:d.isRendering}`),this._tsRenderer)if(this._tsRenderer.isRendering!==this._isRendering&&(this._isRendering=this._tsRenderer.isRendering,this._videoStream.updateIsReceiving(),this._isRendering&&this._renderingDeferred&&this._renderingDeferred.isPending()&&this._renderingDeferred.resolve(),l.log(`isRendering change to ${this._isRendering}`)),this._tsRenderer.isRendering){const l=this._tsRenderer.streamSize.height,d=this._tsRenderer.streamSize.width;l===this._size.height&&d===this._size.width||(this._size.height=l,this._size.width=d,this._videoStream.updateSize())}else this._size.height=0,this._size.width=0,this._videoStream.updateSize();this.sendRendererTelemetry()},this.sendRendererTelemetry=()=>{var l,d;if(this._tsRenderer)try{const u={isRendering:this._tsRenderer.isRendering,streamWidth:this._tsRenderer.streamSize.width,streamHeight:this._tsRenderer.streamSize.height,isVideoAttached:this._target.isConnected,rendererWidth:null===(l=this._target)||void 0===l?void 0:l.offsetWidth,rendererHeight:null===(d=this._target)||void 0===d?void 0:d.offsetHeight};if(this.previousStats){if(shallowEqual(this.previousStats,u))return}else this.previousStats=u;this.previousStats=u;const p=this._videoStream.getStreamMetadata(),{callId:h,localParticipantId:g,isDisposed:f,viewIdsRegistered:m,height:v,width:y}=p,S=__rest(p,[\"callId\",\"localParticipantId\",\"isDisposed\",\"viewIdsRegistered\",\"height\",\"width\"]),_=Object.assign(Object.assign(Object.assign({},u),S),{viewId:this._viewId,disposed:this._disposed});this._videoStream.call.stats.recordEvent({name:Ld.remote_view,callId:h,localParticipantId:g,data:_})}catch(l){}},this._unsubscribeAvailabilityCallback=()=>{var l;this._availableCallback&&(null===(l=this._videoStream)||void 0===l||l.off(\"isAvailableChanged\",this._availableCallback),this._availableCallback=void 0)},this._disposeTsRendererChangedObservable=()=>{this._tsRendererChanged&&(this._tsRendererChanged.dispose(),this._tsRendererChanged=void 0)},this._attemptToDisposeTsRenderer=()=>{var l;if(this.logger.debug(\"attempt to dispose underlying renderer\"),this._tsRenderer){this.logger.debug(\"disposing underlying renderer\");try{null===(l=this._tsRenderer)||void 0===l||l.dispose(),this._tsRenderer=void 0}catch(l){this.logger.warn(`tsRenderer dispose failed with ${l.message} error`)}}},this.logger=p.createChild(\"RemoteStreamRenderer\"+Dp++),this.logger.log(\"created\"),void 0!==(null==g?void 0:g.scalingMode)&&(this._scalingMode=g.scalingMode),void 0!==(null==g?void 0:g.isMirrored)&&(this._isMirrored=g.isMirrored)}get isRendering(){return this._isRendering}get scalingMode(){return this._scalingMode}get isMirrored(){return this._isMirrored}get target(){return this._target}get viewId(){return this._viewId}get size(){return{height:this._size.height,width:this._size.width}}start(){return __awaiter$j(this,void 0,void 0,(function*(){const l=this.logger.createFnLogger(os.Start);if(this._disposed)throw this.logger.warn(\"already disposed\"),new CallingCommunicationError({message:\"Failed to start stream, already disposed\",code:_e});try{return l.info(`scalingMode=${toTsScalingMode(this._scalingMode)}`),this._videoStream.registerRenderer(this),this._renderingDeferred=defer$1(),this._renderingDeferred.promise.catch(noop),this._availableCallback=()=>{var d,u;this._videoStream.isAvailable||(l.warn(\"stream isAvailable changed to false, attempting to reject operation\"),(null===(d=this._renderingDeferred)||void 0===d?void 0:d.isPending())&&!this._disposed&&(null===(u=this._renderingDeferred)||void 0===u||u.reject(new CallingCommunicationError({message:\"Failed to start stream, stream became unavailable\",code:Se}))))},this._videoStream.on(\"isAvailableChanged\",this._availableCallback),this._videoStream.tsStream.start(this._target,{scalingMode:toTsScalingMode(this._scalingMode),transparent:!1}).then((d=>{var u;if(this._isMirrored&&(this._target.style.transform=\"rotateY(180deg)\",this._target.style.webkitTransform=\"rotateY(180deg)\"),this._tsRenderer=d,this.logger.info(\"subscribed to video, waiting for the first frame\"),this._disposed)throw this.logger.warn(\"already disposed, dispose underlying renderer\"),this._attemptToDisposeTsRenderer(),new CallingCommunicationError({message:\"Failed to start stream, already disposed\",code:_e});this.logger.info(`current state of rendering is ${this._tsRenderer.isRendering}`),this.sendRendererTelemetry(),-1!==getAcsEcsConfig().rendering.remoteVideo.createViewTimeout&&setTimeout((()=>{var l;if(null===(l=this._renderingDeferred)||void 0===l?void 0:l.isPending())try{this._renderingDeferred.reject(new CallingCommunicationError({message:\"Failed to render stream, timeout\",code:Ce}))}catch(l){}}),getAcsEcsConfig().rendering.remoteVideo.createViewTimeout),this._tsRendererChanged=this._tsRenderer.changed((()=>this._handleTsRendererChanged(l))),this._tsRenderer.isRendering&&(null===(u=this._renderingDeferred)||void 0===u?void 0:u.isPending())&&(this._isRendering=!0,this._videoStream.updateIsReceiving(),this._renderingDeferred.resolve())})).catch((l=>{var d;if(this.logger.info(\"Failed to subscribe to video\"),null===(d=this._renderingDeferred)||void 0===d?void 0:d.isPending()){const d=new CallingCommunicationError({message:\"Failed to start stream, fail to subscribe\",code:Ie},l);this._renderingDeferred.reject(d)}})),yield this._renderingDeferred.promise,this._unsubscribeAvailabilityCallback(),getAcsEcsConfig().rendering.remoteVideo.forceCheckIfVideoWasAttachedToDom&&this._checkIfVideoWasAttachedToDom(),this}catch(l){this.logger.warn(`Failed to render, message=${l}`);try{this.dispose()}catch(l){this.logger.warn(`dispose failed with ${l.message} error`)}throw new CallingCommunicationError({message:\"Failed to start stream, internal error\",code:Ie},l)}}))}setScalingMode(l){return __awaiter$j(this,void 0,void 0,(function*(){if(!this._tsRenderer)throw new CallingCommunicationError({message:\"Failed to change scaling mode\",code:Ie});yield this._tsRenderer.setScalingMode(toTsScalingMode(l)),this._scalingMode=l}))}dispose(l=!1){var d;if(this._disposed)throw new CallingCommunicationError({message:\"Failed to dispose stream, already disposed\",code:Se});this._disposed=!0,this._disposeTsRendererChangedObservable(),this._unsubscribeAvailabilityCallback(),this._attemptToDisposeTsRenderer(),(null===(d=this._renderingDeferred)||void 0===d?void 0:d.isPending())&&this._renderingDeferred.reject(new CallingCommunicationError({message:\"Failed to start stream, disposing stream\",code:_e})),this._target&&this._target.remove();try{l&&this._onDisposedCallback()}catch(l){this.logger.debug(`dispose callback failed with ${l.message} error`)}this._videoStream.unregisterRenderer(this),this._videoStream.updateSize(),this._videoStream.updateIsReceiving(),this._eventEmitter.removeAllListeners(),this._renderingDeferred=void 0}_checkIfVideoWasAttachedToDom(){if(getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_poll){let l=getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_intervalMaxTries;const check=()=>{this._target.isConnected||l<=0?this.sendRendererTelemetry():(l--,l>=0&&setTimeout((()=>check),getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_intervalTime))};check()}else setTimeout((()=>{this._target.isConnected&&this.sendRendererTelemetry()}),getAcsEcsConfig().rendering.remoteVideo.checkIfVideoAttachedToDom_timeout)}}__decorate$e([loggerProperty,__metadata$e(\"design:type\",Object)],RemoteStreamRenderer.prototype,\"logger\",void 0),__decorate$e([asyncOperation(os.Start),__metadata$e(\"design:type\",Function),__metadata$e(\"design:paramtypes\",[]),__metadata$e(\"design:returntype\",Promise)],RemoteStreamRenderer.prototype,\"start\",null),__decorate$e([syncOperation(os.Dispose),__metadata$e(\"design:type\",Function),__metadata$e(\"design:paramtypes\",[Object]),__metadata$e(\"design:returntype\",void 0)],RemoteStreamRenderer.prototype,\"dispose\",null);var __decorate$f=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$f=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$k=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class LocalStreamRenderer{constructor(l,d,u,p,h){this._target=l,this._videoStream=d,this._onDisposed=p,this._eventEmitter=new ri.EventEmitter,this._isRendering=!1,this._scalingMode=\"Stretch\",this._isMirrored=!0,this._disposed=!1,this.logger=u.createChild(\"LocalStreamRenderer\"),this.logger.log(\"created\"),void 0!==(null==h?void 0:h.scalingMode)&&(this._scalingMode=h.scalingMode),void 0!==(null==h?void 0:h.isMirrored)&&(this._isMirrored=h.isMirrored)}get isRendering(){return this._isRendering}get scalingMode(){return this._scalingMode}get isMirrored(){return this._isMirrored}get target(){return this._target}on(l,d){this._eventEmitter.on(l,d)}off(l,d){this._eventEmitter.off(l,d)}start(){return __awaiter$k(this,void 0,void 0,(function*(){const l=this.logger.createFnLogger(os.Start);try{l.info(\"attempting to select new device as a source\");const d=this._videoStream.source.deviceManager.getTsDeviceManager();return d.selectDevices({camera:this._videoStream.source.id}),l.info(\"device selected\"),l.info(\"creating preview\"),this._tsRenderer=yield d.createPreview(this._target,{kind:\"camera\"},{scalingMode:toTsScalingMode(this._scalingMode),transparent:!1,ignoreMirroring:!1,disposeRendererWhenStreamisNotAvailable:()=>!0}),this._isMirrored&&(this._target.style.transform=\"rotateY(180deg)\",this._target.style.webkitTransform=\"rotateY(180deg)\"),this}catch(d){this.dispose();throw handleVideoOperationFailure(l,d)}}))}setScalingMode(l){if(!this._tsRenderer)throw new CallingCommunicationError({message:\"Failed to change scaling mode\",code:ve});this._tsRenderer.setScalingMode(toTsScalingMode(l)),this._scalingMode=l}dispose(){this._disposed||(this._tsRenderer&&(this.logger.log(\"dispose\"),this._tsRenderer.dispose(),this._tsRenderer=void 0),this._target.remove(),this._onDisposed&&this._onDisposed(this),this._eventEmitter.removeAllListeners(),this._disposed=!0)}}__decorate$f([loggerProperty,__metadata$f(\"design:type\",Object)],LocalStreamRenderer.prototype,\"logger\",void 0),__decorate$f([asyncOperation(as.Start),__metadata$f(\"design:type\",Function),__metadata$f(\"design:paramtypes\",[]),__metadata$f(\"design:returntype\",Promise)],LocalStreamRenderer.prototype,\"start\",null),__decorate$f([syncOperation(as.SetScalingMode),__metadata$f(\"design:type\",Function),__metadata$f(\"design:paramtypes\",[String]),__metadata$f(\"design:returntype\",void 0)],LocalStreamRenderer.prototype,\"setScalingMode\",null),__decorate$f([syncOperation(as.Dispose),__metadata$f(\"design:type\",Function),__metadata$f(\"design:paramtypes\",[]),__metadata$f(\"design:returntype\",void 0)],LocalStreamRenderer.prototype,\"dispose\",null);var __decorate$g=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$g=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$l=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};let Lp=1;class VideoStreamRendererViewImpl{constructor(l,d,u,p){if(this.videoStream=l,this._viewId=u,this.options=p,this._disposed=!1,this.attemptToDisposeStreamRenderer=()=>{this.logger.debug(\"attempt to dispose stream renderer\");try{this._streamRenderer.dispose()}catch(l){this.logger.warn(`Failed to dispose stream renderer, message=${l.message}`)}},this._deleteActiveRemoteVideoStreamView=(l,d)=>{var u,p,h;if(null===(u=l.call.activeRemoteVideoStreamViews)||void 0===u?void 0:u.has(l.id)){let u=null===(p=l.call.activeRemoteVideoStreamViews)||void 0===p?void 0:p.get(l.id);null==u||u.delete(d),0==(null==u?void 0:u.size)&&(null===(h=l.call.activeRemoteVideoStreamViews)||void 0===h||h.delete(l.id))}},this.logger=d.createChild(\"VideoStreamRendererView\"+Lp++),this.target=document.createElement(\"div\"),this.target.style.width=\"100%\",this.target.style.height=\"100%\",this.videoStream instanceof RemoteVideoStreamImpl)this._streamRenderer=new RemoteStreamRenderer(this.target,this._viewId,this.videoStream,this.logger,(()=>this.dispose),this.options);else{if(!(this.videoStream instanceof LocalVideoStream))throw new CallingCommunicationError({message:\"Failed to create VideoStreamRendererView, videoStream must be either LocalVideoStream or RemoteVideoStream type\",code:be});this._streamRenderer=new LocalStreamRenderer(this.target,this.videoStream,this.logger,(()=>this.dispose),this.options)}this._telemetryLogManager=this.videoStream.telemetryLogManager,this.logger.info(\"created\")}get scalingMode(){return this._streamRenderer.scalingMode}get isMirrored(){return this._streamRenderer.isMirrored}render(){return __awaiter$l(this,void 0,void 0,(function*(){const l=this.logger.createFnLogger(this.videoStream instanceof RemoteVideoStreamImpl?Za.RenderRemoteStream:Za.RenderLocalStream);if(this._disposed)throw l.log(\"failed, stream disposed!\"),new CallingCommunicationError({message:\"Failed to render, stream disposed\",code:Se});try{yield this._streamRenderer.start()}catch(d){l.error(\"failed\");try{this.dispose()}catch(l){this.logger.warn(`Failed to dispose, message=${l.message}`)}throw d}}))}updateScalingMode(l){return __awaiter$l(this,void 0,void 0,(function*(){if(this._disposed)throw new CallingCommunicationError({message:\"Failed to updateScalingMode, VideoStreamRendererView is disposed\",code:Se});if(\"Crop\"!==l&&\"Fit\"!==l&&\"Stretch\"!==l)throw new CallingCommunicationError({message:\"Failed to updateScalingMode, wrong scalingMode value\",code:ve});try{yield this._streamRenderer.setScalingMode(l)}catch(l){throw new CallingCommunicationError({message:\"Failed to updateScalingMode, failed to update\",code:Ie},l)}}))}dispose(){var l;if(this._disposed)throw new CallingCommunicationError({message:\"Failed to dispose, VideoStreamRendererView is disposed\",code:Se});this._disposed=!0;const d=+new Date,u=generateGuid();try{this.sendDisposeViewEvent({eventName:kd.acs_calling_dispose_view_attempt,correlationId:u,timestampInfo:{attemptTimestamp:d}}),this.videoStream instanceof RemoteVideoStreamImpl&&this._deleteActiveRemoteVideoStreamView(this.videoStream,this._viewId),this.attemptToDisposeStreamRenderer(),null===(l=this.target)||void 0===l||l.remove();const p=+new Date;this.sendDisposeViewEvent({eventName:kd.acs_calling_dispose_view_success,correlationId:u,timestampInfo:{deltaTimeInMs:p-d}})}catch(l){const p=+new Date;throw this.sendDisposeViewEvent({eventName:kd.acs_calling_dispose_view_failure,correlationId:u,timestampInfo:{deltaTimeInMS:p-d}},l),new CallingCommunicationError({message:\"Failed to dispose view\",code:Ie},l)}}sendDisposeViewEvent(l,d){var u,p;try{let h;this.videoStream instanceof RemoteVideoStreamImpl&&(h=null===(u=this.videoStream)||void 0===u?void 0:u.getStreamMetadata()),this.videoStream instanceof LocalVideoStream&&(h=null===(p=this.videoStream)||void 0===p?void 0:p.getStreamMetadata());let g=\"string\"==typeof(null==d?void 0:d.message)?null==d?void 0:d.message:\"\";l.eventName!==kd.acs_calling_dispose_view_failure&&(g=\"\"),this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:Object.assign(Object.assign({viewId:this._viewId,correlationId:l.correlationId,timestampInfo:l.timestampInfo},h),{failureReason:g})})}catch(l){this.logger.debug(\"Unable to send telemtery\")}}}function filterMediaStatsForCreateView(l,d){const u={Extensions_WebRTCStats_ssrc_audio_recv_ssrc:\"ssrc\",Extensions_WebRTCStats_ssrc_audio_recv_packetsLost:\"packetsLost\",Extensions_WebRTCStats_ssrc_audio_recv_packetsReceived:\"packetsReceived\",Extensions_WebRTCStats_ssrc_audio_recv_bytesReceived:\"bytesReceived\",Extensions_WebRTCStats_ssrc_audio_recv_totalSamplesReceived:\"totalSamplesReceived\",Extensions_WebRTCStats_ssrc_audio_recv_concealedSamples:\"concealedSamples\",Extensions_WebRTCStats_ssrc_audio_recv_fecPacketsReceived:\"fecPacketsReceived\",Extensions_WebRTCStats_ssrc_audio_recv_fecPacketsDiscarded:\"fecPacketsDiscarded\",Extensions_WebRTCStats_ssrc_audio_recv_googCodecName:\"googCodecName\",Extensions_WebRTCStats_ssrc_audio_recv_jitter:\"jitter\",Extensions_WebRTCStats_ssrc_audio_recv_pair_googRtt:\"pair_googRtt\",Extensions_WebRTCStats_ssrc_audio_recv_pair_googActiveConnection:\"pair_googActiveConnection\"},p={Extensions_WebRTCStats_ssrc_video_recv_ssrc:\"ssrc\",Extensions_WebRTCStats_ssrc_video_recv_packetsLost:\"packetsLost\",Extensions_WebRTCStats_ssrc_video_recv_packetsReceived:\"packetsReceived\",Extensions_WebRTCStats_ssrc_video_recv_bytesReceived:\"bytesReceived\",Extensions_WebRTCStats_ssrc_video_recv_framesDecoded:\"framesDecoded\",Extensions_WebRTCStats_ssrc_video_recv_keyFramesDecoded:\"keyFramesDecoded\",Extensions_WebRTCStats_ssrc_video_recv_googFrameRateDecoded:\"googFrameRateDecoded\",Extensions_WebRTCStats_ssrc_video_recv_googFrameRateReceived:\"googFrameRateReceived\",Extensions_WebRTCStats_ssrc_video_recv_googFrameHeightReceived:\"googFrameHeightReceived\",Extensions_WebRTCStats_ssrc_video_recv_googFrameWidthReceived:\"googFrameWidthReceived\",Extensions_WebRTCStats_ssrc_video_recv_googFirsSent:\"googFirsSent\",Extensions_WebRTCStats_ssrc_video_recv_googNacksSent:\"googNacksSent\",Extensions_WebRTCStats_ssrc_video_recv_googPlisSent:\"googPlisSent\",Extensions_WebRTCStats_ssrc_video_recv_codecImplementationName:\"codecImplementationName\",Extensions_WebRTCStats_ssrc_video_recv_googCodecName:\"googCodecName\",Extensions_WebRTCStats_ssrc_video_recv_jitter:\"jitter\",Extensions_WebRTCStats_ssrc_video_recv_pair_googRtt:\"pair_googRtt\",Extensions_WebRTCStats_ssrc_video_recv_pair_googActiveConnection:\"pair_googActiveConnection\"},h={Extensions_WebRTCStats_ssrc_sharing_recv_ssrc:\"ssrc\",Extensions_WebRTCStats_ssrc_sharing_recv_packetsLost:\"packetsLost\",Extensions_WebRTCStats_ssrc_sharing_recv_packetsReceived:\"packetsReceived\",Extensions_WebRTCStats_ssrc_sharing_recv_bytesReceived:\"bytesReceived\",Extensions_WebRTCStats_ssrc_sharing_recv_framesDecoded:\"framesDecoded\",Extensions_WebRTCStats_ssrc_sharing_recv_keyFramesDecoded:\"keyFramesDecoded\",Extensions_WebRTCStats_ssrc_sharing_recv_googFrameRateDecoded:\"googFrameRateDecoded\",Extensions_WebRTCStats_ssrc_sharing_recv_googFrameRateReceived:\"googFrameRateReceived\",Extensions_WebRTCStats_ssrc_sharing_recv_googFrameHeightReceived:\"googFrameHeightReceived\",Extensions_WebRTCStats_ssrc_sharing_recv_googFrameWidthReceived:\"googFrameWidthReceived\",Extensions_WebRTCStats_ssrc_sharing_recv_googFirsSent:\"googFirsSent\",Extensions_WebRTCStats_ssrc_sharing_recv_googNacksSent:\"googNacksSent\",Extensions_WebRTCStats_ssrc_sharing_recv_googPlisSent:\"googPlisSent\",Extensions_WebRTCStats_ssrc_sharing_recv_codecImplementationName:\"codecImplementationName\",Extensions_WebRTCStats_ssrc_sharing_recv_googCodecName:\"googCodecName\",Extensions_WebRTCStats_ssrc_sharing_recv_jitter:\"jitter\",Extensions_WebRTCStats_ssrc_sharing_recv_pair_googRtt:\"pair_googRtt\",Extensions_WebRTCStats_ssrc_sharing_recv_pair_googActiveConnection:\"pair_googActiveConnection\"},g={},f={},m={};for(const[d,p]of Object.entries(u))void 0!==l[d]&&(g[p]=l[d]);if(\"Video\"===d)for(const[d,u]of Object.entries(p))void 0!==l[d]&&(f[u]=l[d]);else if(\"ScreenSharing\"===d)for(const[d,u]of Object.entries(h))void 0!==l[d]&&(m[u]=l[d]);return{audio:g,video:f,screenShare:m}}__decorate$g([loggerProperty,__metadata$g(\"design:type\",Object)],VideoStreamRendererViewImpl.prototype,\"logger\",void 0),__decorate$g([asyncOperation(Za.Render),__metadata$g(\"design:type\",Function),__metadata$g(\"design:paramtypes\",[]),__metadata$g(\"design:returntype\",Promise)],VideoStreamRendererViewImpl.prototype,\"render\",null),__decorate$g([asyncOperation(Za.UpdateScalingMode),__metadata$g(\"design:type\",Function),__metadata$g(\"design:paramtypes\",[String]),__metadata$g(\"design:returntype\",Promise)],VideoStreamRendererViewImpl.prototype,\"updateScalingMode\",null),__decorate$g([syncOperation(Za.Dispose),__metadata$g(\"design:type\",Function),__metadata$g(\"design:paramtypes\",[]),__metadata$g(\"design:returntype\",void 0)],VideoStreamRendererViewImpl.prototype,\"dispose\",null);var __decorate$h=function(l,d,u,p){var h,g=arguments.length,f=g<3?d:null===p?p=Object.getOwnPropertyDescriptor(d,u):p;if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.decorate)f=Reflect.decorate(l,d,u,p);else for(var m=l.length-1;m>=0;m--)(h=l[m])&&(f=(g<3?h(f):g>3?h(d,u,f):h(d,u))||f);return g>3&&f&&Object.defineProperty(d,u,f),f},__metadata$h=function(l,d){if(\"object\"==typeof Reflect&&\"function\"==typeof Reflect.metadata)return Reflect.metadata(l,d)},__awaiter$m=function(l,d,u,p){function adopt(l){return l instanceof u?l:new u((function(d){d(l)}))}return new(u||(u=Promise))((function(u,h){function fulfilled(l){try{step(p.next(l))}catch(l){h(l)}}function rejected(l){try{step(p.throw(l))}catch(l){h(l)}}function step(l){l.done?u(l.value):adopt(l.value).then(fulfilled,rejected)}step((p=p.apply(l,d||[])).next())}))};class VideoStreamRenderer{constructor(l){this.videoStream=l,this.size={height:0,width:0},this.views=new Map,this.disposed=!1,this._attemptToDisposeView=l=>{try{null==l||l.dispose()}catch(l){this.logger.warn((null==l?void 0:l.message)||\"Failed to dispose, unknown error\")}},this._addActiveRemoteVideoStreamView=(l,d,u)=>{var p,h,g;if(null===(p=l.call.activeRemoteVideoStreamViews)||void 0===p?void 0:p.has(l.id)){let p=null===(h=l.call.activeRemoteVideoStreamViews)||void 0===h?void 0:h.get(l.id);p&&p.set(d,u)}else{let p=new Map;p.set(d,u),null===(g=l.call.activeRemoteVideoStreamViews)||void 0===g||g.set(l.id,p)}};const u=d.createClientLogger(\"ACS\");if(!(l instanceof LocalVideoStream||l instanceof RemoteVideoStreamImpl))throw new CallingCommunicationError({message:\"Failed to create VideoStreamRenderer, videoStream must be either LocalVideoStream or RemoteVideoStream type\",code:be});this._telemetryLogManager=l.telemetryLogManager,this.logger=new DefaultLogger(u,l instanceof LocalVideoStream?[()=>{var d;return`VideoStreamRenderer:LocalVideoStream:${I.pii.Omit(null===(d=null==l?void 0:l.source)||void 0===d?void 0:d.id)}`}]:[()=>`VideoStreamRenderer:RemoteVideoStream:${null==l?void 0:l.id}`]),this.logger.info(\"created\")}createView(l){var d,u,p,h;return __awaiter$m(this,void 0,void 0,(function*(){if(this.disposed)throw new CallingCommunicationError({message:\"Failed to create view, VideoStreamRenderer is disposed\",code:Se});const g=+new Date,f=generateGuid(),m=generateGuid();let v;try{if(this.sendCreateViewEvent({eventName:kd.acs_calling_create_view_attempt,viewId:f,correlationId:m,timestampInfo:{attemptTimestamp:g}}),this.videoStream instanceof RemoteVideoStreamImpl&&(null===(d=getAcsEcsConfig())||void 0===d?void 0:d.calling.applyViewLimit)&&(null===(u=getMediaConfig())||void 0===u?void 0:u.numVideoChannelsGvc)){let l=getMediaConfig().numVideoChannelsGvc;if(!(null===(p=this.videoStream.call.activeRemoteVideoStreamViews)||void 0===p?void 0:p.has(this.videoStream.id))&&(null===(h=this.videoStream.call.activeRemoteVideoStreamViews)||void 0===h?void 0:h.size)>=l){const d=new CallingCommunicationError({message:`Failed to create view, maximum number of ${l} active RemoteVideoStream has been reached`,code:Te}),u=+new Date;throw this.sendCreateViewEvent({eventName:kd.acs_calling_create_view_failure,viewId:f,correlationId:m,timestampInfo:{deltaTimeInMs:u-g}},d),d}}v=new VideoStreamRendererViewImpl(this.videoStream,this.logger,f,l),this.views.set(f,v),yield v.render(),this.videoStream instanceof RemoteVideoStreamImpl&&this._addActiveRemoteVideoStreamView(this.videoStream,f,v);const y=+new Date;return this.sendCreateViewEvent({eventName:kd.acs_calling_create_view_success,viewId:f,correlationId:m,timestampInfo:{deltaTimeInMs:y-g}}),v}catch(l){this.views.delete(f),this._attemptToDisposeView(v);const d=+new Date;throw this.sendCreateViewEvent({eventName:kd.acs_calling_create_view_failure,viewId:f,correlationId:m,timestampInfo:{deltaTimeInMs:d-g}},l),new CallingCommunicationError({message:\"Failed to create view\",code:Ie},l)}}))}sendCreateViewEvent(l,d){var u,p,h;return __awaiter$m(this,void 0,void 0,(function*(){try{let g;g=this.videoStream instanceof RemoteVideoStreamImpl?null===(u=this.videoStream)||void 0===u?void 0:u.getStreamMetadata():null===(p=this.videoStream)||void 0===p?void 0:p.getStreamMetadata();let f=\"string\"==typeof(null==d?void 0:d.message)?null==d?void 0:d.message:\"\";l.eventName!==kd.acs_calling_create_view_failure&&(f=\"\");let m={},v={};if((null===(h=getAcsEcsConfig())||void 0===h?void 0:h.rendering.remoteVideo.createViewSendMediaStats)&&(l.eventName===kd.acs_calling_create_view_failure||l.eventName===kd.acs_calling_create_view_success)&&this.videoStream instanceof RemoteVideoStreamImpl){const d=yield this.videoStream.call.tsCall.getMediaTelemetry(!0);m={videoSubscriptionEvents:d.Extensions_Video_SubscriptionEvents,screenSharingSubscriptionEvents:d.Extensions_Sharing_SubscriptionEvents,videoSendMaxCapabilities:d.Extensions_Video_send_MaxCapabilities,screenSharingSendMaxCapabilities:d.Extensions_Sharing_send_MaxCapabilities,iceConnectedStateTime:d.metrics_IceConnectedStateTime,relayCandidate:d.Extensions_RelayCandidate,videoRecvTimeToFirstFrame:d.Extensions_Video_recv_TimeToFirstFrame,screenSharingRecvTimeToFirstFrame:d.Extensions_Sharing_recv_TimeToFirstFrame},l.eventName===kd.acs_calling_create_view_failure&&\"string\"==typeof f&&f.includes(\"timeout\")&&(v=filterMediaStatsForCreateView(d,g.streamType))}this._telemetryLogManager.sendEvent({name:l.eventName,tenant:q,properties:Object.assign(Object.assign({viewId:l.viewId,correlationId:l.correlationId,timestampInfo:l.timestampInfo},g),{failureReason:f,additionalProperties:m,stats:v})})}catch(l){this.logger.debug(\"Unable to send telemtery\")}}))}dispose(){if(this.disposed)throw new CallingCommunicationError({message:\"Failed to dispose, VideoStreamRendererView is already disposed\",code:Se});this.disposed=!0,this.views.forEach(this._attemptToDisposeView),this.views.clear()}}__decorate$h([loggerProperty,__metadata$h(\"design:type\",Object)],VideoStreamRenderer.prototype,\"logger\",void 0),__decorate$h([asyncOperation(es.CreateView),__metadata$h(\"design:type\",Function),__metadata$h(\"design:paramtypes\",[Object]),__metadata$h(\"design:returntype\",Promise)],VideoStreamRenderer.prototype,\"createView\",null),__decorate$h([syncOperation(es.Dispose),__metadata$h(\"design:type\",Function),__metadata$h(\"design:paramtypes\",[]),__metadata$h(\"design:returntype\",void 0)],VideoStreamRenderer.prototype,\"dispose\",null),l.CallClient=CallClient,l.Features=bu,l.LocalAudioStream=LocalAudioStream,l.LocalVideoStream=LocalVideoStream,l.VideoStreamRenderer=VideoStreamRenderer,l.registerFeature=registerFeature,l.registeredFeatures=Iu,Object.defineProperty(l,\"__esModule\",{value:!0})}));\r\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../../webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\"), __webpack_require__(/*! ./../../../process/browser.js */ \"./node_modules/process/browser.js\"), __webpack_require__(/*! ./../../../timers-browserify/main.js */ \"./node_modules/timers-browserify/main.js\").setImmediate))\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-calling/dist/sdk.bundle.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/autoRefreshTokenCredential.js":
/*!*********************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/autoRefreshTokenCredential.js ***!
  \*********************************************************************************************/
/*! exports provided: AutoRefreshTokenCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AutoRefreshTokenCredential\", function() { return AutoRefreshTokenCredential; });\n/* harmony import */ var _tokenParser__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./tokenParser */ \"./node_modules/@azure/communication-common/dist-esm/src/tokenParser.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst expiredToken = { token: \"\", expiresOnTimestamp: -10 };\nconst minutesToMs = (minutes) => minutes * 1000 * 60;\nconst defaultExpiringSoonInterval = minutesToMs(10);\nconst defaultRefreshAfterLifetimePercentage = 0.5;\nclass AutoRefreshTokenCredential {\n    constructor(refreshArgs) {\n        this.expiringSoonIntervalInMs = defaultExpiringSoonInterval;\n        this.refreshAfterLifetimePercentage = defaultRefreshAfterLifetimePercentage;\n        this.activeTokenFetching = null;\n        this.activeTokenUpdating = null;\n        this.disposed = false;\n        const { tokenRefresher, token, refreshProactively } = refreshArgs;\n        this.refresh = tokenRefresher;\n        this.currentToken = token ? Object(_tokenParser__WEBPACK_IMPORTED_MODULE_0__[\"parseToken\"])(token) : expiredToken;\n        this.refreshProactively = refreshProactively !== null && refreshProactively !== void 0 ? refreshProactively : false;\n        if (this.refreshProactively) {\n            this.scheduleRefresh();\n        }\n    }\n    async getToken(options) {\n        if (!this.isTokenExpiringSoon(this.currentToken)) {\n            return this.currentToken;\n        }\n        if (!this.isTokenValid(this.currentToken)) {\n            const updatePromise = this.updateTokenAndReschedule(options === null || options === void 0 ? void 0 : options.abortSignal);\n            await updatePromise;\n        }\n        return this.currentToken;\n    }\n    dispose() {\n        this.disposed = true;\n        this.activeTokenFetching = null;\n        this.activeTokenUpdating = null;\n        this.currentToken = expiredToken;\n        if (this.activeTimeout) {\n            clearTimeout(this.activeTimeout);\n        }\n    }\n    async updateTokenAndReschedule(abortSignal) {\n        if (this.activeTokenUpdating) {\n            return this.activeTokenUpdating;\n        }\n        this.activeTokenUpdating = this.refreshTokenAndReschedule(abortSignal);\n        try {\n            await this.activeTokenUpdating;\n        }\n        finally {\n            this.activeTokenUpdating = null;\n        }\n    }\n    async refreshTokenAndReschedule(abortSignal) {\n        const newToken = await this.refreshToken(abortSignal);\n        if (!this.isTokenValid(newToken)) {\n            throw new Error(\"The token returned from the tokenRefresher is expired.\");\n        }\n        this.currentToken = newToken;\n        if (this.refreshProactively) {\n            this.scheduleRefresh();\n        }\n    }\n    async refreshToken(abortSignal) {\n        try {\n            if (!this.activeTokenFetching) {\n                this.activeTokenFetching = this.refresh(abortSignal);\n            }\n            return Object(_tokenParser__WEBPACK_IMPORTED_MODULE_0__[\"parseToken\"])(await this.activeTokenFetching);\n        }\n        finally {\n            this.activeTokenFetching = null;\n        }\n    }\n    scheduleRefresh() {\n        if (this.disposed) {\n            return;\n        }\n        if (this.activeTimeout) {\n            clearTimeout(this.activeTimeout);\n        }\n        const tokenTtlInMs = this.currentToken.expiresOnTimestamp - Date.now();\n        let timespanInMs = null;\n        if (this.isTokenExpiringSoon(this.currentToken)) {\n            // Schedule the next refresh for when it reaches a certain percentage of the remaining lifetime.\n            timespanInMs = tokenTtlInMs * this.refreshAfterLifetimePercentage;\n        }\n        else {\n            // Schedule the next refresh for when it gets in to the soon-to-expire window.\n            timespanInMs = tokenTtlInMs - this.expiringSoonIntervalInMs;\n        }\n        this.activeTimeout = setTimeout(() => this.updateTokenAndReschedule(), timespanInMs);\n    }\n    isTokenValid(token) {\n        return token && Date.now() < token.expiresOnTimestamp;\n    }\n    isTokenExpiringSoon(token) {\n        return !token || Date.now() >= token.expiresOnTimestamp - this.expiringSoonIntervalInMs;\n    }\n}\n//# sourceMappingURL=autoRefreshTokenCredential.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/autoRefreshTokenCredential.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/azureCommunicationTokenCredential.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/azureCommunicationTokenCredential.js ***!
  \****************************************************************************************************/
/*! exports provided: AzureCommunicationTokenCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AzureCommunicationTokenCredential\", function() { return AzureCommunicationTokenCredential; });\n/* harmony import */ var _autoRefreshTokenCredential__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./autoRefreshTokenCredential */ \"./node_modules/@azure/communication-common/dist-esm/src/autoRefreshTokenCredential.js\");\n/* harmony import */ var _staticTokenCredential__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./staticTokenCredential */ \"./node_modules/@azure/communication-common/dist-esm/src/staticTokenCredential.js\");\n/* harmony import */ var _tokenParser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./tokenParser */ \"./node_modules/@azure/communication-common/dist-esm/src/tokenParser.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n/**\n * The CommunicationTokenCredential implementation with support for proactive token refresh.\n */\nclass AzureCommunicationTokenCredential {\n    constructor(tokenOrRefreshOptions) {\n        this.disposed = false;\n        if (typeof tokenOrRefreshOptions === \"string\") {\n            this.tokenCredential = new _staticTokenCredential__WEBPACK_IMPORTED_MODULE_1__[\"StaticTokenCredential\"](Object(_tokenParser__WEBPACK_IMPORTED_MODULE_2__[\"parseToken\"])(tokenOrRefreshOptions));\n        }\n        else {\n            this.tokenCredential = new _autoRefreshTokenCredential__WEBPACK_IMPORTED_MODULE_0__[\"AutoRefreshTokenCredential\"](tokenOrRefreshOptions);\n        }\n    }\n    /**\n     * Gets an `AccessToken` for the user. Throws if already disposed.\n     * @param abortSignal - An implementation of `AbortSignalLike` to cancel the operation.\n     */\n    async getToken(options) {\n        this.throwIfDisposed();\n        const token = await this.tokenCredential.getToken(options);\n        this.throwIfDisposed();\n        return token;\n    }\n    /**\n     * Disposes the CommunicationTokenCredential and cancels any internal auto-refresh operation.\n     */\n    dispose() {\n        this.disposed = true;\n        this.tokenCredential.dispose();\n    }\n    throwIfDisposed() {\n        if (this.disposed) {\n            throw new Error(\"User credential is disposed\");\n        }\n    }\n}\n//# sourceMappingURL=azureCommunicationTokenCredential.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/azureCommunicationTokenCredential.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/credential/clientArguments.js":
/*!*********************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/credential/clientArguments.js ***!
  \*********************************************************************************************/
/*! exports provided: isKeyCredential, parseClientArguments */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isKeyCredential\", function() { return isKeyCredential; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parseClientArguments\", function() { return parseClientArguments; });\n/* harmony import */ var _azure_core_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/core-auth */ \"./node_modules/@azure/core-auth/dist-esm/src/index.js\");\n/* harmony import */ var _connectionString__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./connectionString */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/connectionString.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\nconst isValidEndpoint = (host) => {\n    var _a;\n    const url = new URL(host);\n    return (!!((_a = url.protocol) === null || _a === void 0 ? void 0 : _a.match(/^http[s]?/)) &&\n        url.host !== undefined &&\n        url.host !== \"\" &&\n        (url.pathname === undefined || url.pathname === \"\" || url.pathname === \"/\"));\n};\nconst assertValidEndpoint = (host) => {\n    if (!isValidEndpoint(host)) {\n        throw new Error(`Invalid endpoint url ${host}`);\n    }\n};\n/**\n * Checks whether a value is a KeyCredential.\n *\n * @param credential - The credential being checked.\n */\nconst isKeyCredential = (credential) => {\n    const castCredential = credential;\n    return (castCredential &&\n        typeof castCredential.key === \"string\" &&\n        castCredential.getToken === undefined);\n};\n/**\n * Parses arguments passed to a communication client.\n * @hidden\n */\nconst parseClientArguments = (connectionStringOrUrl, credentialOrOptions) => {\n    if (isKeyCredential(credentialOrOptions) || Object(_azure_core_auth__WEBPACK_IMPORTED_MODULE_0__[\"isTokenCredential\"])(credentialOrOptions)) {\n        assertValidEndpoint(connectionStringOrUrl);\n        return { url: connectionStringOrUrl, credential: credentialOrOptions };\n    }\n    else {\n        const { endpoint: host, credential } = Object(_connectionString__WEBPACK_IMPORTED_MODULE_1__[\"parseConnectionString\"])(connectionStringOrUrl);\n        assertValidEndpoint(host);\n        return { url: host, credential };\n    }\n};\n//# sourceMappingURL=clientArguments.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/credential/clientArguments.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAccessKeyCredentialPolicy.js":
/*!********************************************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAccessKeyCredentialPolicy.js ***!
  \********************************************************************************************************************/
/*! exports provided: createCommunicationAccessKeyCredentialPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createCommunicationAccessKeyCredentialPolicy\", function() { return createCommunicationAccessKeyCredentialPolicy; });\n/* harmony import */ var _cryptoUtils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./cryptoUtils */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/cryptoUtils.browser.js\");\n/* harmony import */ var _azure_core_util__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @azure/core-util */ \"./node_modules/@azure/core-util/dist-esm/src/index.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n/**\n * CommunicationKeyCredentialPolicy provides a means of signing requests made through\n * the SmsClient.\n */\nconst communicationAccessKeyCredentialPolicy = \"CommunicationAccessKeyCredentialPolicy\";\n/**\n * Creates an HTTP pipeline policy to authenticate a request using a `KeyCredential`.\n * @hidden\n *\n * @param credential - The key credential.\n */\nfunction createCommunicationAccessKeyCredentialPolicy(credential) {\n    return {\n        name: communicationAccessKeyCredentialPolicy,\n        async sendRequest(request, next) {\n            var _a;\n            const verb = request.method.toUpperCase();\n            const utcNow = new Date().toUTCString();\n            const contentHash = await Object(_cryptoUtils__WEBPACK_IMPORTED_MODULE_0__[\"shaHash\"])(((_a = request.body) === null || _a === void 0 ? void 0 : _a.toString()) || \"\");\n            const dateHeader = \"x-ms-date\";\n            const signedHeaders = `${dateHeader};host;x-ms-content-sha256`;\n            const url = new URL(request.url);\n            const query = url.searchParams;\n            const urlPathAndQuery = query ? `${url.pathname}?${query}` : url.pathname;\n            const port = url.port;\n            const hostAndPort = port ? `${url.host}:${port}` : url.host;\n            const stringToSign = `${verb}\\n${urlPathAndQuery}\\n${utcNow};${hostAndPort};${contentHash}`;\n            const signature = await Object(_cryptoUtils__WEBPACK_IMPORTED_MODULE_0__[\"shaHMAC\"])(credential.key, stringToSign);\n            if (_azure_core_util__WEBPACK_IMPORTED_MODULE_1__[\"isNode\"]) {\n                request.headers.set(\"Host\", hostAndPort || \"\");\n            }\n            request.headers.set(dateHeader, utcNow);\n            request.headers.set(\"x-ms-content-sha256\", contentHash);\n            request.headers.set(\"Authorization\", `HMAC-SHA256 SignedHeaders=${signedHeaders}&Signature=${signature}`);\n            return next(request);\n        },\n    };\n}\n//# sourceMappingURL=communicationAccessKeyCredentialPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAccessKeyCredentialPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAuthPolicy.js":
/*!*****************************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAuthPolicy.js ***!
  \*****************************************************************************************************/
/*! exports provided: createCommunicationAuthPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createCommunicationAuthPolicy\", function() { return createCommunicationAuthPolicy; });\n/* harmony import */ var _azure_core_rest_pipeline__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/core-rest-pipeline */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/index.js\");\n/* harmony import */ var _azure_core_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @azure/core-auth */ \"./node_modules/@azure/core-auth/dist-esm/src/index.js\");\n/* harmony import */ var _communicationAccessKeyCredentialPolicy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./communicationAccessKeyCredentialPolicy */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAccessKeyCredentialPolicy.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n/**\n * Creates a pipeline policy to authenticate request based\n * on the credential passed in.\n * @hidden\n *\n * @param credential - The KeyCredential or TokenCredential.\n */\nfunction createCommunicationAuthPolicy(credential) {\n    if (Object(_azure_core_auth__WEBPACK_IMPORTED_MODULE_1__[\"isTokenCredential\"])(credential)) {\n        const policyOptions = {\n            credential: credential,\n            scopes: [\"https://communication.azure.com//.default\"],\n        };\n        return Object(_azure_core_rest_pipeline__WEBPACK_IMPORTED_MODULE_0__[\"bearerTokenAuthenticationPolicy\"])(policyOptions);\n    }\n    else {\n        return Object(_communicationAccessKeyCredentialPolicy__WEBPACK_IMPORTED_MODULE_2__[\"createCommunicationAccessKeyCredentialPolicy\"])(credential);\n    }\n}\n//# sourceMappingURL=communicationAuthPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAuthPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/credential/connectionString.js":
/*!**********************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/credential/connectionString.js ***!
  \**********************************************************************************************/
/*! exports provided: parseConnectionString */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parseConnectionString\", function() { return parseConnectionString; });\n/* harmony import */ var _azure_core_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/core-auth */ \"./node_modules/@azure/core-auth/dist-esm/src/index.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n// TODO: update when connection string format is finalized\nconst CONNECTION_STRING_REGEX = /endpoint=(.*);accesskey=(.*)/i;\nconst tryParseConnectionString = (s) => {\n    const match = s.match(CONNECTION_STRING_REGEX);\n    if ((match === null || match === void 0 ? void 0 : match[1]) && match[2]) {\n        return { endpoint: match[1], credential: new _azure_core_auth__WEBPACK_IMPORTED_MODULE_0__[\"AzureKeyCredential\"](match[2]) };\n    }\n    return undefined;\n};\n/**\n * Returns an EndpointCredential to easily access properties of the connection string.\n * @hidden\n *\n * @param connectionString - The connection string to parse\n * @returns Object to access the endpoint and the credentials\n */\nconst parseConnectionString = (connectionString) => {\n    const parsedConnectionString = tryParseConnectionString(connectionString);\n    if (parsedConnectionString) {\n        return parsedConnectionString;\n    }\n    else {\n        throw new Error(`Invalid connection string ${connectionString}`);\n    }\n};\n//# sourceMappingURL=connectionString.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/credential/connectionString.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/credential/cryptoUtils.browser.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/credential/cryptoUtils.browser.js ***!
  \*************************************************************************************************/
/*! exports provided: shaHash, shaHMAC */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"shaHash\", function() { return shaHash; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"shaHMAC\", function() { return shaHMAC; });\n/* harmony import */ var _encodeUtils_browser__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./encodeUtils.browser */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/encodeUtils.browser.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nvar _a;\n/// <reference lib=\"dom\" />\n\nconst subtle = (_a = globalThis === null || globalThis === void 0 ? void 0 : globalThis.crypto) === null || _a === void 0 ? void 0 : _a.subtle;\nconst shaHash = async (content) => {\n    const data = Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_0__[\"encodeUTF8\"])(content);\n    const hash = await subtle.digest(\"SHA-256\", data);\n    return Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_0__[\"encodeBase64\"])(hash);\n};\nconst shaHMAC = async (secret, content) => {\n    const importParams = { name: \"HMAC\", hash: { name: \"SHA-256\" } };\n    const encodedMessage = Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_0__[\"encodeUTF8\"])(content);\n    const encodedKey = Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_0__[\"encodeUTF8fromBase64\"])(secret);\n    const crypto = subtle;\n    const cryptoKey = await crypto.importKey(\"raw\", encodedKey, importParams, false, [\"sign\"]);\n    const signature = await crypto.sign(importParams, cryptoKey, encodedMessage);\n    return Object(_encodeUtils_browser__WEBPACK_IMPORTED_MODULE_0__[\"encodeBase64\"])(signature);\n};\n//# sourceMappingURL=cryptoUtils.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/credential/cryptoUtils.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/credential/encodeUtils.browser.js":
/*!*************************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/credential/encodeUtils.browser.js ***!
  \*************************************************************************************************/
/*! exports provided: encodeUTF8, encodeUTF8fromBase64, encodeBase64 */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"encodeUTF8\", function() { return encodeUTF8; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"encodeUTF8fromBase64\", function() { return encodeUTF8fromBase64; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"encodeBase64\", function() { return encodeBase64; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nconst encodeUTF8 = (str) => new TextEncoder().encode(str);\nfunction encodeUTF8fromBase64(str) {\n    if (typeof atob !== \"function\") {\n        throw new Error(\"Your browser environment is missing the global `atob` function\");\n    }\n    const binary = atob(str);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n}\nfunction encodeBase64(value) {\n    if (typeof btoa !== \"function\") {\n        throw new Error(\"Your browser environment is missing the global `btoa` function\");\n    }\n    const bytes = new Uint8Array(value);\n    let binary = \"\";\n    for (const byte of bytes) {\n        binary += String.fromCharCode(byte);\n    }\n    return btoa(binary);\n}\n//# sourceMappingURL=encodeUtils.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/credential/encodeUtils.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/credential/index.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/credential/index.js ***!
  \***********************************************************************************/
/*! exports provided: createCommunicationAccessKeyCredentialPolicy, createCommunicationAuthPolicy, isKeyCredential, parseClientArguments, parseConnectionString */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _communicationAccessKeyCredentialPolicy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./communicationAccessKeyCredentialPolicy */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAccessKeyCredentialPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createCommunicationAccessKeyCredentialPolicy\", function() { return _communicationAccessKeyCredentialPolicy__WEBPACK_IMPORTED_MODULE_0__[\"createCommunicationAccessKeyCredentialPolicy\"]; });\n\n/* harmony import */ var _communicationAuthPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./communicationAuthPolicy */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/communicationAuthPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createCommunicationAuthPolicy\", function() { return _communicationAuthPolicy__WEBPACK_IMPORTED_MODULE_1__[\"createCommunicationAuthPolicy\"]; });\n\n/* harmony import */ var _clientArguments__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./clientArguments */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/clientArguments.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isKeyCredential\", function() { return _clientArguments__WEBPACK_IMPORTED_MODULE_2__[\"isKeyCredential\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"parseClientArguments\", function() { return _clientArguments__WEBPACK_IMPORTED_MODULE_2__[\"parseClientArguments\"]; });\n\n/* harmony import */ var _connectionString__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./connectionString */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/connectionString.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"parseConnectionString\", function() { return _connectionString__WEBPACK_IMPORTED_MODULE_3__[\"parseConnectionString\"]; });\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n//# sourceMappingURL=index.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/credential/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/identifierModelSerializer.js":
/*!********************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/identifierModelSerializer.js ***!
  \********************************************************************************************/
/*! exports provided: serializeCommunicationIdentifier, deserializeCommunicationIdentifier */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"serializeCommunicationIdentifier\", function() { return serializeCommunicationIdentifier; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"deserializeCommunicationIdentifier\", function() { return deserializeCommunicationIdentifier; });\n/* harmony import */ var _identifierModels__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./identifierModels */ \"./node_modules/@azure/communication-common/dist-esm/src/identifierModels.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst assertNotNullOrUndefined = (obj, prop) => {\n    const subObjName = Object.keys(obj)[0];\n    const subObj = obj[subObjName];\n    if (prop in subObj) {\n        return subObj[prop];\n    }\n    throw new Error(`Property ${prop} is required for identifier of type ${subObjName}.`);\n};\nconst assertMaximumOneNestedModel = (identifier) => {\n    const presentProperties = [];\n    if (identifier.communicationUser !== undefined) {\n        presentProperties.push(\"communicationUser\");\n    }\n    if (identifier.microsoftTeamsUser !== undefined) {\n        presentProperties.push(\"microsoftTeamsUser\");\n    }\n    if (identifier.phoneNumber !== undefined) {\n        presentProperties.push(\"phoneNumber\");\n    }\n    if (presentProperties.length > 1) {\n        throw new Error(`Only one of the properties in ${JSON.stringify(presentProperties)} should be present.`);\n    }\n};\n/**\n * @hidden\n * Translates a CommunicationIdentifier to its serialized format for sending a request.\n * @param identifier - The CommunicationIdentifier to be serialized.\n */\nconst serializeCommunicationIdentifier = (identifier) => {\n    var _a, _b, _c, _d;\n    const identifierKind = Object(_identifierModels__WEBPACK_IMPORTED_MODULE_0__[\"getIdentifierKind\"])(identifier);\n    switch (identifierKind.kind) {\n        case \"communicationUser\":\n            return {\n                rawId: Object(_identifierModels__WEBPACK_IMPORTED_MODULE_0__[\"getIdentifierRawId\"])(identifierKind),\n                communicationUser: { id: identifierKind.communicationUserId },\n            };\n        case \"phoneNumber\":\n            return {\n                rawId: (_a = identifierKind.rawId) !== null && _a !== void 0 ? _a : Object(_identifierModels__WEBPACK_IMPORTED_MODULE_0__[\"getIdentifierRawId\"])(identifierKind),\n                phoneNumber: {\n                    value: identifierKind.phoneNumber,\n                },\n            };\n        case \"microsoftTeamsUser\":\n            return {\n                rawId: (_b = identifierKind.rawId) !== null && _b !== void 0 ? _b : Object(_identifierModels__WEBPACK_IMPORTED_MODULE_0__[\"getIdentifierRawId\"])(identifierKind),\n                microsoftTeamsUser: {\n                    userId: identifierKind.microsoftTeamsUserId,\n                    isAnonymous: (_c = identifierKind.isAnonymous) !== null && _c !== void 0 ? _c : false,\n                    cloud: (_d = identifierKind.cloud) !== null && _d !== void 0 ? _d : \"public\",\n                },\n            };\n        case \"unknown\":\n            return { rawId: identifierKind.id };\n        default:\n            throw new Error(`Can't serialize an identifier with kind ${identifierKind.kind}`);\n    }\n};\nconst getKind = (serializedIdentifier) => {\n    if (serializedIdentifier.communicationUser) {\n        return \"communicationUser\";\n    }\n    if (serializedIdentifier.phoneNumber) {\n        return \"phoneNumber\";\n    }\n    if (serializedIdentifier.microsoftTeamsUser) {\n        return \"microsoftTeamsUser\";\n    }\n    return \"unknown\";\n};\n/**\n * @hidden\n * Translates the serialized format of a communication identifier to CommunicationIdentifier.\n * @param serializedIdentifier - The SerializedCommunicationIdentifier to be deserialized.\n */\nconst deserializeCommunicationIdentifier = (serializedIdentifier) => {\n    var _a;\n    assertMaximumOneNestedModel(serializedIdentifier);\n    const { communicationUser, microsoftTeamsUser, phoneNumber } = serializedIdentifier;\n    const kind = (_a = serializedIdentifier.kind) !== null && _a !== void 0 ? _a : getKind(serializedIdentifier);\n    if (kind === \"communicationUser\" && communicationUser) {\n        return {\n            kind: \"communicationUser\",\n            communicationUserId: assertNotNullOrUndefined({ communicationUser }, \"id\"),\n        };\n    }\n    if (kind === \"phoneNumber\" && phoneNumber) {\n        return {\n            kind: \"phoneNumber\",\n            phoneNumber: assertNotNullOrUndefined({ phoneNumber }, \"value\"),\n            rawId: assertNotNullOrUndefined({ phoneNumber: serializedIdentifier }, \"rawId\"),\n        };\n    }\n    if (kind === \"microsoftTeamsUser\" && microsoftTeamsUser) {\n        return {\n            kind: \"microsoftTeamsUser\",\n            microsoftTeamsUserId: assertNotNullOrUndefined({ microsoftTeamsUser }, \"userId\"),\n            isAnonymous: assertNotNullOrUndefined({ microsoftTeamsUser }, \"isAnonymous\"),\n            cloud: assertNotNullOrUndefined({ microsoftTeamsUser }, \"cloud\"),\n            rawId: assertNotNullOrUndefined({ microsoftTeamsUser: serializedIdentifier }, \"rawId\"),\n        };\n    }\n    return {\n        kind: \"unknown\",\n        id: assertNotNullOrUndefined({ unknown: serializedIdentifier }, \"rawId\"),\n    };\n};\n//# sourceMappingURL=identifierModelSerializer.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/identifierModelSerializer.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/identifierModels.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/identifierModels.js ***!
  \***********************************************************************************/
/*! exports provided: isCommunicationUserIdentifier, isPhoneNumberIdentifier, isMicrosoftTeamsUserIdentifier, isUnknownIdentifier, getIdentifierKind, getIdentifierRawId, createIdentifierFromRawId */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isCommunicationUserIdentifier\", function() { return isCommunicationUserIdentifier; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isPhoneNumberIdentifier\", function() { return isPhoneNumberIdentifier; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isMicrosoftTeamsUserIdentifier\", function() { return isMicrosoftTeamsUserIdentifier; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isUnknownIdentifier\", function() { return isUnknownIdentifier; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getIdentifierKind\", function() { return getIdentifierKind; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getIdentifierRawId\", function() { return getIdentifierRawId; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createIdentifierFromRawId\", function() { return createIdentifierFromRawId; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Tests an Identifier to determine whether it implements CommunicationUserIdentifier.\n *\n * @param identifier - The assumed CommunicationUserIdentifier to be tested.\n */\nconst isCommunicationUserIdentifier = (identifier) => {\n    return typeof identifier.communicationUserId === \"string\";\n};\n/**\n * Tests an Identifier to determine whether it implements PhoneNumberIdentifier.\n *\n * @param identifier - The assumed PhoneNumberIdentifier to be tested.\n */\nconst isPhoneNumberIdentifier = (identifier) => {\n    return typeof identifier.phoneNumber === \"string\";\n};\n/**\n * Tests an Identifier to determine whether it implements MicrosoftTeamsUserIdentifier.\n *\n * @param identifier - The assumed available to be tested.\n */\nconst isMicrosoftTeamsUserIdentifier = (identifier) => {\n    return typeof identifier.microsoftTeamsUserId === \"string\";\n};\n/**\n * Tests an Identifier to determine whether it implements UnknownIdentifier.\n *\n * @param identifier - The assumed UnknownIdentifier to be tested.\n */\nconst isUnknownIdentifier = (identifier) => {\n    return typeof identifier.id === \"string\";\n};\n/**\n * Returns the CommunicationIdentifierKind for a given CommunicationIdentifier. Returns undefined if the kind couldn't be inferred.\n *\n * @param identifier - The identifier whose kind is to be inferred.\n */\nconst getIdentifierKind = (identifier) => {\n    if (isCommunicationUserIdentifier(identifier)) {\n        return Object.assign(Object.assign({}, identifier), { kind: \"communicationUser\" });\n    }\n    if (isPhoneNumberIdentifier(identifier)) {\n        return Object.assign(Object.assign({}, identifier), { kind: \"phoneNumber\" });\n    }\n    if (isMicrosoftTeamsUserIdentifier(identifier)) {\n        return Object.assign(Object.assign({}, identifier), { kind: \"microsoftTeamsUser\" });\n    }\n    return Object.assign(Object.assign({}, identifier), { kind: \"unknown\" });\n};\n/**\n * Returns the rawId for a given CommunicationIdentifier. You can use the rawId for encoding the identifier and then use it as a key in a database.\n *\n * @param identifier - The identifier to be translated to its rawId.\n */\nconst getIdentifierRawId = (identifier) => {\n    const identifierKind = getIdentifierKind(identifier);\n    switch (identifierKind.kind) {\n        case \"communicationUser\":\n            return identifierKind.communicationUserId;\n        case \"microsoftTeamsUser\": {\n            const { microsoftTeamsUserId, rawId, cloud, isAnonymous } = identifierKind;\n            if (rawId)\n                return rawId;\n            if (isAnonymous)\n                return `8:teamsvisitor:${microsoftTeamsUserId}`;\n            switch (cloud) {\n                case \"dod\":\n                    return `8:dod:${microsoftTeamsUserId}`;\n                case \"gcch\":\n                    return `8:gcch:${microsoftTeamsUserId}`;\n                case \"public\":\n                    return `8:orgid:${microsoftTeamsUserId}`;\n            }\n            return `8:orgid:${microsoftTeamsUserId}`;\n        }\n        case \"phoneNumber\": {\n            const { phoneNumber, rawId } = identifierKind;\n            if (rawId)\n                return rawId;\n            return `4:${phoneNumber}`;\n        }\n        case \"unknown\": {\n            return identifierKind.id;\n        }\n    }\n};\n/**\n * Creates a CommunicationIdentifierKind from a given rawId. When storing rawIds use this function to restore the identifier that was encoded in the rawId.\n *\n * @param rawId - The rawId to be translated to its identifier representation.\n */\nconst createIdentifierFromRawId = (rawId) => {\n    if (rawId.startsWith(\"4:\")) {\n        return { kind: \"phoneNumber\", phoneNumber: `${rawId.substring(\"4:\".length)}` };\n    }\n    const segments = rawId.split(\":\");\n    if (segments.length < 3)\n        return { kind: \"unknown\", id: rawId };\n    const prefix = `${segments[0]}:${segments[1]}:`;\n    const suffix = rawId.substring(prefix.length);\n    switch (prefix) {\n        case \"8:teamsvisitor:\":\n            return { kind: \"microsoftTeamsUser\", microsoftTeamsUserId: suffix, isAnonymous: true };\n        case \"8:orgid:\":\n            return {\n                kind: \"microsoftTeamsUser\",\n                microsoftTeamsUserId: suffix,\n                isAnonymous: false,\n                cloud: \"public\",\n            };\n        case \"8:dod:\":\n            return {\n                kind: \"microsoftTeamsUser\",\n                microsoftTeamsUserId: suffix,\n                isAnonymous: false,\n                cloud: \"dod\",\n            };\n        case \"8:gcch:\":\n            return {\n                kind: \"microsoftTeamsUser\",\n                microsoftTeamsUserId: suffix,\n                isAnonymous: false,\n                cloud: \"gcch\",\n            };\n        case \"8:acs:\":\n        case \"8:spool:\":\n        case \"8:dod-acs:\":\n        case \"8:gcch-acs:\":\n            return { kind: \"communicationUser\", communicationUserId: rawId };\n    }\n    return { kind: \"unknown\", id: rawId };\n};\n//# sourceMappingURL=identifierModels.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/identifierModels.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/index.js":
/*!************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/index.js ***!
  \************************************************************************/
/*! exports provided: AzureCommunicationTokenCredential, createCommunicationAccessKeyCredentialPolicy, createCommunicationAuthPolicy, isKeyCredential, parseClientArguments, parseConnectionString, isCommunicationUserIdentifier, isPhoneNumberIdentifier, isMicrosoftTeamsUserIdentifier, isUnknownIdentifier, getIdentifierKind, getIdentifierRawId, createIdentifierFromRawId, serializeCommunicationIdentifier, deserializeCommunicationIdentifier */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _azureCommunicationTokenCredential__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./azureCommunicationTokenCredential */ \"./node_modules/@azure/communication-common/dist-esm/src/azureCommunicationTokenCredential.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"AzureCommunicationTokenCredential\", function() { return _azureCommunicationTokenCredential__WEBPACK_IMPORTED_MODULE_0__[\"AzureCommunicationTokenCredential\"]; });\n\n/* harmony import */ var _credential__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./credential */ \"./node_modules/@azure/communication-common/dist-esm/src/credential/index.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createCommunicationAccessKeyCredentialPolicy\", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__[\"createCommunicationAccessKeyCredentialPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createCommunicationAuthPolicy\", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__[\"createCommunicationAuthPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isKeyCredential\", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__[\"isKeyCredential\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"parseClientArguments\", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__[\"parseClientArguments\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"parseConnectionString\", function() { return _credential__WEBPACK_IMPORTED_MODULE_1__[\"parseConnectionString\"]; });\n\n/* empty/unused harmony star reexport *//* harmony import */ var _identifierModels__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./identifierModels */ \"./node_modules/@azure/communication-common/dist-esm/src/identifierModels.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isCommunicationUserIdentifier\", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__[\"isCommunicationUserIdentifier\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isPhoneNumberIdentifier\", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__[\"isPhoneNumberIdentifier\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isMicrosoftTeamsUserIdentifier\", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__[\"isMicrosoftTeamsUserIdentifier\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isUnknownIdentifier\", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__[\"isUnknownIdentifier\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"getIdentifierKind\", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__[\"getIdentifierKind\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"getIdentifierRawId\", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__[\"getIdentifierRawId\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createIdentifierFromRawId\", function() { return _identifierModels__WEBPACK_IMPORTED_MODULE_2__[\"createIdentifierFromRawId\"]; });\n\n/* harmony import */ var _identifierModelSerializer__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./identifierModelSerializer */ \"./node_modules/@azure/communication-common/dist-esm/src/identifierModelSerializer.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"serializeCommunicationIdentifier\", function() { return _identifierModelSerializer__WEBPACK_IMPORTED_MODULE_3__[\"serializeCommunicationIdentifier\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"deserializeCommunicationIdentifier\", function() { return _identifierModelSerializer__WEBPACK_IMPORTED_MODULE_3__[\"deserializeCommunicationIdentifier\"]; });\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n\n//# sourceMappingURL=index.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/staticTokenCredential.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/staticTokenCredential.js ***!
  \****************************************************************************************/
/*! exports provided: StaticTokenCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"StaticTokenCredential\", function() { return StaticTokenCredential; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * StaticTokenCredential\n */\nclass StaticTokenCredential {\n    constructor(token) {\n        this.token = token;\n    }\n    async getToken() {\n        return this.token;\n    }\n    dispose() {\n        /* intentionally empty */\n    }\n}\n//# sourceMappingURL=staticTokenCredential.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/staticTokenCredential.js?");

            /***/
}),

/***/ "./node_modules/@azure/communication-common/dist-esm/src/tokenParser.js":
/*!******************************************************************************!*\
  !*** ./node_modules/@azure/communication-common/dist-esm/src/tokenParser.js ***!
  \******************************************************************************/
/*! exports provided: parseToken */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parseToken\", function() { return parseToken; });\n/* harmony import */ var jwt_decode__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jwt-decode */ \"./node_modules/jwt-decode/build/jwt-decode.esm.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst parseToken = (token) => {\n    const { exp } = Object(jwt_decode__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(token);\n    return {\n        token,\n        expiresOnTimestamp: exp * 1000,\n    };\n};\n//# sourceMappingURL=tokenParser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/communication-common/dist-esm/src/tokenParser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-auth/dist-esm/src/azureKeyCredential.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@azure/core-auth/dist-esm/src/azureKeyCredential.js ***!
  \**************************************************************************/
/*! exports provided: AzureKeyCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AzureKeyCredential\", function() { return AzureKeyCredential; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * A static-key-based credential that supports updating\n * the underlying key value.\n */\nclass AzureKeyCredential {\n    /**\n     * Create an instance of an AzureKeyCredential for use\n     * with a service client.\n     *\n     * @param key - The initial value of the key to use in authentication\n     */\n    constructor(key) {\n        if (!key) {\n            throw new Error(\"key must be a non-empty string\");\n        }\n        this._key = key;\n    }\n    /**\n     * The value of the key to be used in authentication\n     */\n    get key() {\n        return this._key;\n    }\n    /**\n     * Change the value of the key.\n     *\n     * Updates will take effect upon the next request after\n     * updating the key value.\n     *\n     * @param newKey - The new key value to be used\n     */\n    update(newKey) {\n        this._key = newKey;\n    }\n}\n//# sourceMappingURL=azureKeyCredential.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-auth/dist-esm/src/azureKeyCredential.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-auth/dist-esm/src/azureNamedKeyCredential.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@azure/core-auth/dist-esm/src/azureNamedKeyCredential.js ***!
  \*******************************************************************************/
/*! exports provided: AzureNamedKeyCredential, isNamedKeyCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AzureNamedKeyCredential\", function() { return AzureNamedKeyCredential; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isNamedKeyCredential\", function() { return isNamedKeyCredential; });\n/* harmony import */ var _typeguards__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./typeguards */ \"./node_modules/@azure/core-auth/dist-esm/src/typeguards.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * A static name/key-based credential that supports updating\n * the underlying name and key values.\n */\nclass AzureNamedKeyCredential {\n    /**\n     * Create an instance of an AzureNamedKeyCredential for use\n     * with a service client.\n     *\n     * @param name - The initial value of the name to use in authentication.\n     * @param key - The initial value of the key to use in authentication.\n     */\n    constructor(name, key) {\n        if (!name || !key) {\n            throw new TypeError(\"name and key must be non-empty strings\");\n        }\n        this._name = name;\n        this._key = key;\n    }\n    /**\n     * The value of the key to be used in authentication.\n     */\n    get key() {\n        return this._key;\n    }\n    /**\n     * The value of the name to be used in authentication.\n     */\n    get name() {\n        return this._name;\n    }\n    /**\n     * Change the value of the key.\n     *\n     * Updates will take effect upon the next request after\n     * updating the key value.\n     *\n     * @param newName - The new name value to be used.\n     * @param newKey - The new key value to be used.\n     */\n    update(newName, newKey) {\n        if (!newName || !newKey) {\n            throw new TypeError(\"newName and newKey must be non-empty strings\");\n        }\n        this._name = newName;\n        this._key = newKey;\n    }\n}\n/**\n * Tests an object to determine whether it implements NamedKeyCredential.\n *\n * @param credential - The assumed NamedKeyCredential to be tested.\n */\nfunction isNamedKeyCredential(credential) {\n    return (Object(_typeguards__WEBPACK_IMPORTED_MODULE_0__[\"isObjectWithProperties\"])(credential, [\"name\", \"key\"]) &&\n        typeof credential.key === \"string\" &&\n        typeof credential.name === \"string\");\n}\n//# sourceMappingURL=azureNamedKeyCredential.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-auth/dist-esm/src/azureNamedKeyCredential.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-auth/dist-esm/src/azureSASCredential.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@azure/core-auth/dist-esm/src/azureSASCredential.js ***!
  \**************************************************************************/
/*! exports provided: AzureSASCredential, isSASCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AzureSASCredential\", function() { return AzureSASCredential; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isSASCredential\", function() { return isSASCredential; });\n/* harmony import */ var _typeguards__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./typeguards */ \"./node_modules/@azure/core-auth/dist-esm/src/typeguards.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * A static-signature-based credential that supports updating\n * the underlying signature value.\n */\nclass AzureSASCredential {\n    /**\n     * Create an instance of an AzureSASCredential for use\n     * with a service client.\n     *\n     * @param signature - The initial value of the shared access signature to use in authentication\n     */\n    constructor(signature) {\n        if (!signature) {\n            throw new Error(\"shared access signature must be a non-empty string\");\n        }\n        this._signature = signature;\n    }\n    /**\n     * The value of the shared access signature to be used in authentication\n     */\n    get signature() {\n        return this._signature;\n    }\n    /**\n     * Change the value of the signature.\n     *\n     * Updates will take effect upon the next request after\n     * updating the signature value.\n     *\n     * @param newSignature - The new shared access signature value to be used\n     */\n    update(newSignature) {\n        if (!newSignature) {\n            throw new Error(\"shared access signature must be a non-empty string\");\n        }\n        this._signature = newSignature;\n    }\n}\n/**\n * Tests an object to determine whether it implements SASCredential.\n *\n * @param credential - The assumed SASCredential to be tested.\n */\nfunction isSASCredential(credential) {\n    return (Object(_typeguards__WEBPACK_IMPORTED_MODULE_0__[\"isObjectWithProperties\"])(credential, [\"signature\"]) && typeof credential.signature === \"string\");\n}\n//# sourceMappingURL=azureSASCredential.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-auth/dist-esm/src/azureSASCredential.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-auth/dist-esm/src/index.js":
/*!*************************************************************!*\
  !*** ./node_modules/@azure/core-auth/dist-esm/src/index.js ***!
  \*************************************************************/
/*! exports provided: AzureKeyCredential, AzureNamedKeyCredential, isNamedKeyCredential, AzureSASCredential, isSASCredential, isTokenCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _azureKeyCredential__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./azureKeyCredential */ \"./node_modules/@azure/core-auth/dist-esm/src/azureKeyCredential.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"AzureKeyCredential\", function() { return _azureKeyCredential__WEBPACK_IMPORTED_MODULE_0__[\"AzureKeyCredential\"]; });\n\n/* harmony import */ var _azureNamedKeyCredential__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./azureNamedKeyCredential */ \"./node_modules/@azure/core-auth/dist-esm/src/azureNamedKeyCredential.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"AzureNamedKeyCredential\", function() { return _azureNamedKeyCredential__WEBPACK_IMPORTED_MODULE_1__[\"AzureNamedKeyCredential\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isNamedKeyCredential\", function() { return _azureNamedKeyCredential__WEBPACK_IMPORTED_MODULE_1__[\"isNamedKeyCredential\"]; });\n\n/* harmony import */ var _azureSASCredential__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./azureSASCredential */ \"./node_modules/@azure/core-auth/dist-esm/src/azureSASCredential.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"AzureSASCredential\", function() { return _azureSASCredential__WEBPACK_IMPORTED_MODULE_2__[\"AzureSASCredential\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isSASCredential\", function() { return _azureSASCredential__WEBPACK_IMPORTED_MODULE_2__[\"isSASCredential\"]; });\n\n/* harmony import */ var _tokenCredential__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./tokenCredential */ \"./node_modules/@azure/core-auth/dist-esm/src/tokenCredential.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isTokenCredential\", function() { return _tokenCredential__WEBPACK_IMPORTED_MODULE_3__[\"isTokenCredential\"]; });\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n//# sourceMappingURL=index.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-auth/dist-esm/src/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-auth/dist-esm/src/tokenCredential.js":
/*!***********************************************************************!*\
  !*** ./node_modules/@azure/core-auth/dist-esm/src/tokenCredential.js ***!
  \***********************************************************************/
/*! exports provided: isTokenCredential */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isTokenCredential\", function() { return isTokenCredential; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Tests an object to determine whether it implements TokenCredential.\n *\n * @param credential - The assumed TokenCredential to be tested.\n */\nfunction isTokenCredential(credential) {\n    // Check for an object with a 'getToken' function and possibly with\n    // a 'signRequest' function.  We do this check to make sure that\n    // a ServiceClientCredentials implementor (like TokenClientCredentials\n    // in ms-rest-nodeauth) doesn't get mistaken for a TokenCredential if\n    // it doesn't actually implement TokenCredential also.\n    const castCredential = credential;\n    return (castCredential &&\n        typeof castCredential.getToken === \"function\" &&\n        (castCredential.signRequest === undefined || castCredential.getToken.length > 0));\n}\n//# sourceMappingURL=tokenCredential.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-auth/dist-esm/src/tokenCredential.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-auth/dist-esm/src/typeguards.js":
/*!******************************************************************!*\
  !*** ./node_modules/@azure/core-auth/dist-esm/src/typeguards.js ***!
  \******************************************************************/
/*! exports provided: isObjectWithProperties */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isObjectWithProperties\", function() { return isObjectWithProperties; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Helper TypeGuard that checks if something is defined or not.\n * @param thing - Anything\n * @internal\n */\nfunction isDefined(thing) {\n    return typeof thing !== \"undefined\" && thing !== null;\n}\n/**\n * Helper TypeGuard that checks if the input is an object with the specified properties.\n * Note: The properties may be inherited.\n * @param thing - Anything.\n * @param properties - The name of the properties that should appear in the object.\n * @internal\n */\nfunction isObjectWithProperties(thing, properties) {\n    if (!isDefined(thing) || typeof thing !== \"object\") {\n        return false;\n    }\n    for (const property of properties) {\n        if (!objectHasProperty(thing, property)) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Helper TypeGuard that checks if the input is an object with the specified property.\n * Note: The property may be inherited.\n * @param thing - Any object.\n * @param property - The name of the property that should appear in the object.\n * @internal\n */\nfunction objectHasProperty(thing, property) {\n    return typeof thing === \"object\" && property in thing;\n}\n//# sourceMappingURL=typeguards.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-auth/dist-esm/src/typeguards.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js ***!
  \**************************************************************************/
/*! exports provided: SDK_VERSION, DEFAULT_RETRY_POLICY_COUNT */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SDK_VERSION\", function() { return SDK_VERSION; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DEFAULT_RETRY_POLICY_COUNT\", function() { return DEFAULT_RETRY_POLICY_COUNT; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nconst SDK_VERSION = \"1.10.0\";\nconst DEFAULT_RETRY_POLICY_COUNT = 3;\n//# sourceMappingURL=constants.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/createPipelineFromOptions.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/createPipelineFromOptions.js ***!
  \******************************************************************************************/
/*! exports provided: createPipelineFromOptions */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createPipelineFromOptions\", function() { return createPipelineFromOptions; });\n/* harmony import */ var _policies_logPolicy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./policies/logPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/logPolicy.js\");\n/* harmony import */ var _pipeline__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./pipeline */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipeline.js\");\n/* harmony import */ var _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./policies/redirectPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/redirectPolicy.js\");\n/* harmony import */ var _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./policies/userAgentPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/userAgentPolicy.js\");\n/* harmony import */ var _policies_decompressResponsePolicy__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./policies/decompressResponsePolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/decompressResponsePolicy.browser.js\");\n/* harmony import */ var _policies_defaultRetryPolicy__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./policies/defaultRetryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/defaultRetryPolicy.js\");\n/* harmony import */ var _policies_formDataPolicy__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./policies/formDataPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/formDataPolicy.browser.js\");\n/* harmony import */ var _azure_core_util__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @azure/core-util */ \"./node_modules/@azure/core-util/dist-esm/src/index.js\");\n/* harmony import */ var _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./policies/proxyPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/proxyPolicy.browser.js\");\n/* harmony import */ var _policies_setClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./policies/setClientRequestIdPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/setClientRequestIdPolicy.js\");\n/* harmony import */ var _policies_tlsPolicy__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./policies/tlsPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tlsPolicy.js\");\n/* harmony import */ var _policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./policies/tracingPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tracingPolicy.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Create a new pipeline with a default set of customizable policies.\n * @param options - Options to configure a custom pipeline.\n */\nfunction createPipelineFromOptions(options) {\n    const pipeline = Object(_pipeline__WEBPACK_IMPORTED_MODULE_1__[\"createEmptyPipeline\"])();\n    if (_azure_core_util__WEBPACK_IMPORTED_MODULE_7__[\"isNode\"]) {\n        if (options.tlsOptions) {\n            pipeline.addPolicy(Object(_policies_tlsPolicy__WEBPACK_IMPORTED_MODULE_10__[\"tlsPolicy\"])(options.tlsOptions));\n        }\n        pipeline.addPolicy(Object(_policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_8__[\"proxyPolicy\"])(options.proxyOptions));\n        pipeline.addPolicy(Object(_policies_decompressResponsePolicy__WEBPACK_IMPORTED_MODULE_4__[\"decompressResponsePolicy\"])());\n    }\n    pipeline.addPolicy(Object(_policies_formDataPolicy__WEBPACK_IMPORTED_MODULE_6__[\"formDataPolicy\"])());\n    pipeline.addPolicy(Object(_policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_3__[\"userAgentPolicy\"])(options.userAgentOptions));\n    pipeline.addPolicy(Object(_policies_setClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_9__[\"setClientRequestIdPolicy\"])());\n    pipeline.addPolicy(Object(_policies_defaultRetryPolicy__WEBPACK_IMPORTED_MODULE_5__[\"defaultRetryPolicy\"])(options.retryOptions), { phase: \"Retry\" });\n    pipeline.addPolicy(Object(_policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_11__[\"tracingPolicy\"])(options.userAgentOptions), { afterPhase: \"Retry\" });\n    if (_azure_core_util__WEBPACK_IMPORTED_MODULE_7__[\"isNode\"]) {\n        // Both XHR and Fetch expect to handle redirects automatically,\n        // so only include this policy when we're in Node.\n        pipeline.addPolicy(Object(_policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_2__[\"redirectPolicy\"])(options.redirectOptions), { afterPhase: \"Retry\" });\n    }\n    pipeline.addPolicy(Object(_policies_logPolicy__WEBPACK_IMPORTED_MODULE_0__[\"logPolicy\"])(options.loggingOptions), { afterPhase: \"Sign\" });\n    return pipeline;\n}\n//# sourceMappingURL=createPipelineFromOptions.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/createPipelineFromOptions.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/defaultHttpClient.browser.js":
/*!******************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/defaultHttpClient.browser.js ***!
  \******************************************************************************************/
/*! exports provided: createDefaultHttpClient */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createDefaultHttpClient\", function() { return createDefaultHttpClient; });\n/* harmony import */ var _fetchHttpClient__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fetchHttpClient */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/fetchHttpClient.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * Create the correct HttpClient for the current environment.\n */\nfunction createDefaultHttpClient() {\n    return Object(_fetchHttpClient__WEBPACK_IMPORTED_MODULE_0__[\"createFetchHttpClient\"])();\n}\n//# sourceMappingURL=defaultHttpClient.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/defaultHttpClient.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/fetchHttpClient.js":
/*!********************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/fetchHttpClient.js ***!
  \********************************************************************************/
/*! exports provided: createFetchHttpClient */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createFetchHttpClient\", function() { return createFetchHttpClient; });\n/* harmony import */ var _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/abort-controller */ \"./node_modules/@azure/abort-controller/dist-esm/src/index.js\");\n/* harmony import */ var _restError__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./restError */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/restError.js\");\n/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./httpHeaders */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/httpHeaders.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n/**\n * Checks if the body is a NodeReadable stream which is not supported in Browsers\n */\nfunction isNodeReadableStream(body) {\n    return body && typeof body.pipe === \"function\";\n}\n/**\n * Checks if the body is a ReadableStream supported by browsers\n */\nfunction isReadableStream(body) {\n    return Boolean(body &&\n        typeof body.getReader === \"function\" &&\n        typeof body.tee === \"function\");\n}\n/**\n * A HttpClient implementation that uses window.fetch to send HTTP requests.\n * @internal\n */\nclass FetchHttpClient {\n    /**\n     * Makes a request over an underlying transport layer and returns the response.\n     * @param request - The request to be made.\n     */\n    async sendRequest(request) {\n        const url = new URL(request.url);\n        const isInsecure = url.protocol !== \"https:\";\n        if (isInsecure && !request.allowInsecureConnection) {\n            throw new Error(`Cannot connect to ${request.url} while allowInsecureConnection is false.`);\n        }\n        if (request.proxySettings) {\n            throw new Error(\"HTTP proxy is not supported in browser environment\");\n        }\n        try {\n            return await makeRequest(request);\n        }\n        catch (e) {\n            throw getError(e, request);\n        }\n    }\n}\n/**\n * Sends a request\n */\nasync function makeRequest(request) {\n    const { abortController, abortControllerCleanup } = setupAbortSignal(request);\n    try {\n        const headers = buildFetchHeaders(request.headers);\n        const requestBody = buildRequestBody(request);\n        /**\n         * Developers of the future:\n         * Do not set redirect: \"manual\" as part\n         * of request options.\n         * It will not work as you expect.\n         */\n        const response = await fetch(request.url, {\n            body: requestBody,\n            method: request.method,\n            headers: headers,\n            signal: abortController.signal,\n            credentials: request.withCredentials ? \"include\" : \"same-origin\",\n            cache: \"no-store\",\n        });\n        return buildPipelineResponse(response, request);\n    }\n    finally {\n        if (abortControllerCleanup) {\n            abortControllerCleanup();\n        }\n    }\n}\n/**\n * Creates a pipeline response from a Fetch response;\n */\nasync function buildPipelineResponse(httpResponse, request) {\n    var _a, _b;\n    const headers = buildPipelineHeaders(httpResponse);\n    const response = {\n        request,\n        headers,\n        status: httpResponse.status,\n    };\n    const bodyStream = isReadableStream(httpResponse.body)\n        ? buildBodyStream(httpResponse.body, request.onDownloadProgress)\n        : httpResponse.body;\n    if (\n    // Value of POSITIVE_INFINITY in streamResponseStatusCodes is considered as any status code\n    ((_a = request.streamResponseStatusCodes) === null || _a === void 0 ? void 0 : _a.has(Number.POSITIVE_INFINITY)) ||\n        ((_b = request.streamResponseStatusCodes) === null || _b === void 0 ? void 0 : _b.has(response.status))) {\n        if (request.enableBrowserStreams) {\n            response.browserStreamBody = bodyStream !== null && bodyStream !== void 0 ? bodyStream : undefined;\n        }\n        else {\n            const responseStream = new Response(bodyStream);\n            response.blobBody = responseStream.blob();\n        }\n    }\n    else {\n        const responseStream = new Response(bodyStream);\n        response.bodyAsText = await responseStream.text();\n    }\n    return response;\n}\nfunction setupAbortSignal(request) {\n    const abortController = new AbortController();\n    // Cleanup function\n    let abortControllerCleanup;\n    /**\n     * Attach an abort listener to the request\n     */\n    let abortListener;\n    if (request.abortSignal) {\n        if (request.abortSignal.aborted) {\n            throw new _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__[\"AbortError\"](\"The operation was aborted.\");\n        }\n        abortListener = (event) => {\n            if (event.type === \"abort\") {\n                abortController.abort();\n            }\n        };\n        request.abortSignal.addEventListener(\"abort\", abortListener);\n        abortControllerCleanup = () => {\n            var _a;\n            if (abortListener) {\n                (_a = request.abortSignal) === null || _a === void 0 ? void 0 : _a.removeEventListener(\"abort\", abortListener);\n            }\n        };\n    }\n    // If a timeout was passed, call the abort signal once the time elapses\n    if (request.timeout > 0) {\n        setTimeout(() => {\n            abortController.abort();\n        }, request.timeout);\n    }\n    return { abortController, abortControllerCleanup };\n}\n/**\n * Gets the specific error\n */\nfunction getError(e, request) {\n    var _a;\n    if (e && (e === null || e === void 0 ? void 0 : e.name) === \"AbortError\") {\n        return e;\n    }\n    else {\n        return new _restError__WEBPACK_IMPORTED_MODULE_1__[\"RestError\"](`Error sending request: ${e.message}`, {\n            code: (_a = e === null || e === void 0 ? void 0 : e.code) !== null && _a !== void 0 ? _a : _restError__WEBPACK_IMPORTED_MODULE_1__[\"RestError\"].REQUEST_SEND_ERROR,\n            request,\n        });\n    }\n}\n/**\n * Converts PipelineRequest headers to Fetch headers\n */\nfunction buildFetchHeaders(pipelineHeaders) {\n    const headers = new Headers();\n    for (const [name, value] of pipelineHeaders) {\n        headers.append(name, value);\n    }\n    return headers;\n}\nfunction buildPipelineHeaders(httpResponse) {\n    const responseHeaders = Object(_httpHeaders__WEBPACK_IMPORTED_MODULE_2__[\"createHttpHeaders\"])();\n    for (const [name, value] of httpResponse.headers) {\n        responseHeaders.set(name, value);\n    }\n    return responseHeaders;\n}\nfunction buildRequestBody(request) {\n    const body = typeof request.body === \"function\" ? request.body() : request.body;\n    if (isNodeReadableStream(body)) {\n        throw new Error(\"Node streams are not supported in browser environment.\");\n    }\n    return isReadableStream(body) ? buildBodyStream(body, request.onUploadProgress) : body;\n}\n/**\n * Reads the request/response original stream and stream it through a new\n * ReadableStream, this is done to be able to report progress in a way that\n * all modern browsers support. TransformStreams would be an alternative,\n * however they are not yet supported by all browsers i.e Firefox\n */\nfunction buildBodyStream(readableStream, onProgress) {\n    let loadedBytes = 0;\n    // If the current browser supports pipeThrough we use a TransformStream\n    // to report progress\n    if (isTransformStreamSupported(readableStream)) {\n        return readableStream.pipeThrough(new TransformStream({\n            transform(chunk, controller) {\n                if (chunk === null) {\n                    controller.terminate();\n                    return;\n                }\n                controller.enqueue(chunk);\n                loadedBytes += chunk.length;\n                if (onProgress) {\n                    onProgress({ loadedBytes });\n                }\n            },\n        }));\n    }\n    else {\n        // If we can't use transform streams, wrap the original stream in a new readable stream\n        // and use pull to enqueue each chunk and report progress.\n        const reader = readableStream.getReader();\n        return new ReadableStream({\n            async pull(controller) {\n                var _a;\n                const { done, value } = await reader.read();\n                // When no more data needs to be consumed, break the reading\n                if (done || !value) {\n                    // Close the stream\n                    controller.close();\n                    reader.releaseLock();\n                    return;\n                }\n                loadedBytes += (_a = value === null || value === void 0 ? void 0 : value.length) !== null && _a !== void 0 ? _a : 0;\n                // Enqueue the next data chunk into our target stream\n                controller.enqueue(value);\n                if (onProgress) {\n                    onProgress({ loadedBytes });\n                }\n            },\n        });\n    }\n}\n/**\n * Create a new HttpClient instance for the browser environment.\n * @internal\n */\nfunction createFetchHttpClient() {\n    return new FetchHttpClient();\n}\nfunction isTransformStreamSupported(readableStream) {\n    return readableStream.pipeThrough !== undefined && self.TransformStream !== undefined;\n}\n//# sourceMappingURL=fetchHttpClient.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/fetchHttpClient.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/httpHeaders.js":
/*!****************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/httpHeaders.js ***!
  \****************************************************************************/
/*! exports provided: createHttpHeaders */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createHttpHeaders\", function() { return createHttpHeaders; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nfunction normalizeName(name) {\n    return name.toLowerCase();\n}\nfunction* headerIterator(map) {\n    for (const entry of map.values()) {\n        yield [entry.name, entry.value];\n    }\n}\nclass HttpHeadersImpl {\n    constructor(rawHeaders) {\n        this._headersMap = new Map();\n        if (rawHeaders) {\n            for (const headerName of Object.keys(rawHeaders)) {\n                this.set(headerName, rawHeaders[headerName]);\n            }\n        }\n    }\n    /**\n     * Set a header in this collection with the provided name and value. The name is\n     * case-insensitive.\n     * @param name - The name of the header to set. This value is case-insensitive.\n     * @param value - The value of the header to set.\n     */\n    set(name, value) {\n        this._headersMap.set(normalizeName(name), { name, value: String(value) });\n    }\n    /**\n     * Get the header value for the provided header name, or undefined if no header exists in this\n     * collection with the provided name.\n     * @param name - The name of the header. This value is case-insensitive.\n     */\n    get(name) {\n        var _a;\n        return (_a = this._headersMap.get(normalizeName(name))) === null || _a === void 0 ? void 0 : _a.value;\n    }\n    /**\n     * Get whether or not this header collection contains a header entry for the provided header name.\n     * @param name - The name of the header to set. This value is case-insensitive.\n     */\n    has(name) {\n        return this._headersMap.has(normalizeName(name));\n    }\n    /**\n     * Remove the header with the provided headerName.\n     * @param name - The name of the header to remove.\n     */\n    delete(name) {\n        this._headersMap.delete(normalizeName(name));\n    }\n    /**\n     * Get the JSON object representation of this HTTP header collection.\n     */\n    toJSON(options = {}) {\n        const result = {};\n        if (options.preserveCase) {\n            for (const entry of this._headersMap.values()) {\n                result[entry.name] = entry.value;\n            }\n        }\n        else {\n            for (const [normalizedName, entry] of this._headersMap) {\n                result[normalizedName] = entry.value;\n            }\n        }\n        return result;\n    }\n    /**\n     * Get the string representation of this HTTP header collection.\n     */\n    toString() {\n        return JSON.stringify(this.toJSON({ preserveCase: true }));\n    }\n    /**\n     * Iterate over tuples of header [name, value] pairs.\n     */\n    [Symbol.iterator]() {\n        return headerIterator(this._headersMap);\n    }\n}\n/**\n * Creates an object that satisfies the `HttpHeaders` interface.\n * @param rawHeaders - A simple object representing initial headers\n */\nfunction createHttpHeaders(rawHeaders) {\n    return new HttpHeadersImpl(rawHeaders);\n}\n//# sourceMappingURL=httpHeaders.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/httpHeaders.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/index.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/index.js ***!
  \**********************************************************************/
/*! exports provided: createEmptyPipeline, createPipelineFromOptions, createDefaultHttpClient, createHttpHeaders, createPipelineRequest, RestError, isRestError, decompressResponsePolicy, decompressResponsePolicyName, exponentialRetryPolicy, exponentialRetryPolicyName, setClientRequestIdPolicy, setClientRequestIdPolicyName, logPolicy, logPolicyName, proxyPolicy, proxyPolicyName, getDefaultProxySettings, redirectPolicy, redirectPolicyName, systemErrorRetryPolicy, systemErrorRetryPolicyName, throttlingRetryPolicy, throttlingRetryPolicyName, retryPolicy, tracingPolicy, tracingPolicyName, defaultRetryPolicy, userAgentPolicy, userAgentPolicyName, tlsPolicy, tlsPolicyName, formDataPolicy, formDataPolicyName, bearerTokenAuthenticationPolicy, bearerTokenAuthenticationPolicyName, ndJsonPolicy, ndJsonPolicyName */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _pipeline__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pipeline */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipeline.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createEmptyPipeline\", function() { return _pipeline__WEBPACK_IMPORTED_MODULE_0__[\"createEmptyPipeline\"]; });\n\n/* harmony import */ var _createPipelineFromOptions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./createPipelineFromOptions */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/createPipelineFromOptions.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createPipelineFromOptions\", function() { return _createPipelineFromOptions__WEBPACK_IMPORTED_MODULE_1__[\"createPipelineFromOptions\"]; });\n\n/* harmony import */ var _defaultHttpClient__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./defaultHttpClient */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/defaultHttpClient.browser.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createDefaultHttpClient\", function() { return _defaultHttpClient__WEBPACK_IMPORTED_MODULE_2__[\"createDefaultHttpClient\"]; });\n\n/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./httpHeaders */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/httpHeaders.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createHttpHeaders\", function() { return _httpHeaders__WEBPACK_IMPORTED_MODULE_3__[\"createHttpHeaders\"]; });\n\n/* harmony import */ var _pipelineRequest__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pipelineRequest */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipelineRequest.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createPipelineRequest\", function() { return _pipelineRequest__WEBPACK_IMPORTED_MODULE_4__[\"createPipelineRequest\"]; });\n\n/* harmony import */ var _restError__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./restError */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/restError.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"RestError\", function() { return _restError__WEBPACK_IMPORTED_MODULE_5__[\"RestError\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isRestError\", function() { return _restError__WEBPACK_IMPORTED_MODULE_5__[\"isRestError\"]; });\n\n/* harmony import */ var _policies_decompressResponsePolicy__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./policies/decompressResponsePolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/decompressResponsePolicy.browser.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"decompressResponsePolicy\", function() { return _policies_decompressResponsePolicy__WEBPACK_IMPORTED_MODULE_6__[\"decompressResponsePolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"decompressResponsePolicyName\", function() { return _policies_decompressResponsePolicy__WEBPACK_IMPORTED_MODULE_6__[\"decompressResponsePolicyName\"]; });\n\n/* harmony import */ var _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./policies/exponentialRetryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/exponentialRetryPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"exponentialRetryPolicy\", function() { return _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_7__[\"exponentialRetryPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"exponentialRetryPolicyName\", function() { return _policies_exponentialRetryPolicy__WEBPACK_IMPORTED_MODULE_7__[\"exponentialRetryPolicyName\"]; });\n\n/* harmony import */ var _policies_setClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./policies/setClientRequestIdPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/setClientRequestIdPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"setClientRequestIdPolicy\", function() { return _policies_setClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_8__[\"setClientRequestIdPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"setClientRequestIdPolicyName\", function() { return _policies_setClientRequestIdPolicy__WEBPACK_IMPORTED_MODULE_8__[\"setClientRequestIdPolicyName\"]; });\n\n/* harmony import */ var _policies_logPolicy__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./policies/logPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/logPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"logPolicy\", function() { return _policies_logPolicy__WEBPACK_IMPORTED_MODULE_9__[\"logPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"logPolicyName\", function() { return _policies_logPolicy__WEBPACK_IMPORTED_MODULE_9__[\"logPolicyName\"]; });\n\n/* harmony import */ var _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./policies/proxyPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/proxyPolicy.browser.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"proxyPolicy\", function() { return _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_10__[\"proxyPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"proxyPolicyName\", function() { return _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_10__[\"proxyPolicyName\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"getDefaultProxySettings\", function() { return _policies_proxyPolicy__WEBPACK_IMPORTED_MODULE_10__[\"getDefaultProxySettings\"]; });\n\n/* harmony import */ var _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./policies/redirectPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/redirectPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"redirectPolicy\", function() { return _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_11__[\"redirectPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"redirectPolicyName\", function() { return _policies_redirectPolicy__WEBPACK_IMPORTED_MODULE_11__[\"redirectPolicyName\"]; });\n\n/* harmony import */ var _policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./policies/systemErrorRetryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/systemErrorRetryPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"systemErrorRetryPolicy\", function() { return _policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_12__[\"systemErrorRetryPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"systemErrorRetryPolicyName\", function() { return _policies_systemErrorRetryPolicy__WEBPACK_IMPORTED_MODULE_12__[\"systemErrorRetryPolicyName\"]; });\n\n/* harmony import */ var _policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./policies/throttlingRetryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/throttlingRetryPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"throttlingRetryPolicy\", function() { return _policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_13__[\"throttlingRetryPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"throttlingRetryPolicyName\", function() { return _policies_throttlingRetryPolicy__WEBPACK_IMPORTED_MODULE_13__[\"throttlingRetryPolicyName\"]; });\n\n/* harmony import */ var _policies_retryPolicy__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./policies/retryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"retryPolicy\", function() { return _policies_retryPolicy__WEBPACK_IMPORTED_MODULE_14__[\"retryPolicy\"]; });\n\n/* harmony import */ var _policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./policies/tracingPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tracingPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"tracingPolicy\", function() { return _policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_15__[\"tracingPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"tracingPolicyName\", function() { return _policies_tracingPolicy__WEBPACK_IMPORTED_MODULE_15__[\"tracingPolicyName\"]; });\n\n/* harmony import */ var _policies_defaultRetryPolicy__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./policies/defaultRetryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/defaultRetryPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"defaultRetryPolicy\", function() { return _policies_defaultRetryPolicy__WEBPACK_IMPORTED_MODULE_16__[\"defaultRetryPolicy\"]; });\n\n/* harmony import */ var _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./policies/userAgentPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/userAgentPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"userAgentPolicy\", function() { return _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_17__[\"userAgentPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"userAgentPolicyName\", function() { return _policies_userAgentPolicy__WEBPACK_IMPORTED_MODULE_17__[\"userAgentPolicyName\"]; });\n\n/* harmony import */ var _policies_tlsPolicy__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./policies/tlsPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tlsPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"tlsPolicy\", function() { return _policies_tlsPolicy__WEBPACK_IMPORTED_MODULE_18__[\"tlsPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"tlsPolicyName\", function() { return _policies_tlsPolicy__WEBPACK_IMPORTED_MODULE_18__[\"tlsPolicyName\"]; });\n\n/* harmony import */ var _policies_formDataPolicy__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./policies/formDataPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/formDataPolicy.browser.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"formDataPolicy\", function() { return _policies_formDataPolicy__WEBPACK_IMPORTED_MODULE_19__[\"formDataPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"formDataPolicyName\", function() { return _policies_formDataPolicy__WEBPACK_IMPORTED_MODULE_19__[\"formDataPolicyName\"]; });\n\n/* harmony import */ var _policies_bearerTokenAuthenticationPolicy__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./policies/bearerTokenAuthenticationPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/bearerTokenAuthenticationPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"bearerTokenAuthenticationPolicy\", function() { return _policies_bearerTokenAuthenticationPolicy__WEBPACK_IMPORTED_MODULE_20__[\"bearerTokenAuthenticationPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"bearerTokenAuthenticationPolicyName\", function() { return _policies_bearerTokenAuthenticationPolicy__WEBPACK_IMPORTED_MODULE_20__[\"bearerTokenAuthenticationPolicyName\"]; });\n\n/* harmony import */ var _policies_ndJsonPolicy__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./policies/ndJsonPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/ndJsonPolicy.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"ndJsonPolicy\", function() { return _policies_ndJsonPolicy__WEBPACK_IMPORTED_MODULE_21__[\"ndJsonPolicy\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"ndJsonPolicyName\", function() { return _policies_ndJsonPolicy__WEBPACK_IMPORTED_MODULE_21__[\"ndJsonPolicyName\"]; });\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//# sourceMappingURL=index.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/log.js":
/*!********************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/log.js ***!
  \********************************************************************/
/*! exports provided: logger */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"logger\", function() { return logger; });\n/* harmony import */ var _azure_logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/logger */ \"./node_modules/@azure/logger/dist-esm/src/index.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst logger = Object(_azure_logger__WEBPACK_IMPORTED_MODULE_0__[\"createClientLogger\"])(\"core-rest-pipeline\");\n//# sourceMappingURL=log.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/log.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipeline.js":
/*!*************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipeline.js ***!
  \*************************************************************************/
/*! exports provided: createEmptyPipeline */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createEmptyPipeline\", function() { return createEmptyPipeline; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nconst ValidPhaseNames = new Set([\"Deserialize\", \"Serialize\", \"Retry\", \"Sign\"]);\n/**\n * A private implementation of Pipeline.\n * Do not export this class from the package.\n * @internal\n */\nclass HttpPipeline {\n    constructor(policies) {\n        var _a;\n        this._policies = [];\n        this._policies = (_a = policies === null || policies === void 0 ? void 0 : policies.slice(0)) !== null && _a !== void 0 ? _a : [];\n        this._orderedPolicies = undefined;\n    }\n    addPolicy(policy, options = {}) {\n        if (options.phase && options.afterPhase) {\n            throw new Error(\"Policies inside a phase cannot specify afterPhase.\");\n        }\n        if (options.phase && !ValidPhaseNames.has(options.phase)) {\n            throw new Error(`Invalid phase name: ${options.phase}`);\n        }\n        if (options.afterPhase && !ValidPhaseNames.has(options.afterPhase)) {\n            throw new Error(`Invalid afterPhase name: ${options.afterPhase}`);\n        }\n        this._policies.push({\n            policy,\n            options,\n        });\n        this._orderedPolicies = undefined;\n    }\n    removePolicy(options) {\n        const removedPolicies = [];\n        this._policies = this._policies.filter((policyDescriptor) => {\n            if ((options.name && policyDescriptor.policy.name === options.name) ||\n                (options.phase && policyDescriptor.options.phase === options.phase)) {\n                removedPolicies.push(policyDescriptor.policy);\n                return false;\n            }\n            else {\n                return true;\n            }\n        });\n        this._orderedPolicies = undefined;\n        return removedPolicies;\n    }\n    sendRequest(httpClient, request) {\n        const policies = this.getOrderedPolicies();\n        const pipeline = policies.reduceRight((next, policy) => {\n            return (req) => {\n                return policy.sendRequest(req, next);\n            };\n        }, (req) => httpClient.sendRequest(req));\n        return pipeline(request);\n    }\n    getOrderedPolicies() {\n        if (!this._orderedPolicies) {\n            this._orderedPolicies = this.orderPolicies();\n        }\n        return this._orderedPolicies;\n    }\n    clone() {\n        return new HttpPipeline(this._policies);\n    }\n    static create() {\n        return new HttpPipeline();\n    }\n    orderPolicies() {\n        /**\n         * The goal of this method is to reliably order pipeline policies\n         * based on their declared requirements when they were added.\n         *\n         * Order is first determined by phase:\n         *\n         * 1. Serialize Phase\n         * 2. Policies not in a phase\n         * 3. Deserialize Phase\n         * 4. Retry Phase\n         * 5. Sign Phase\n         *\n         * Within each phase, policies are executed in the order\n         * they were added unless they were specified to execute\n         * before/after other policies or after a particular phase.\n         *\n         * To determine the final order, we will walk the policy list\n         * in phase order multiple times until all dependencies are\n         * satisfied.\n         *\n         * `afterPolicies` are the set of policies that must be\n         * executed before a given policy. This requirement is\n         * considered satisfied when each of the listed policies\n         * have been scheduled.\n         *\n         * `beforePolicies` are the set of policies that must be\n         * executed after a given policy. Since this dependency\n         * can be expressed by converting it into a equivalent\n         * `afterPolicies` declarations, they are normalized\n         * into that form for simplicity.\n         *\n         * An `afterPhase` dependency is considered satisfied when all\n         * policies in that phase have scheduled.\n         *\n         */\n        const result = [];\n        // Track all policies we know about.\n        const policyMap = new Map();\n        function createPhase(name) {\n            return {\n                name,\n                policies: new Set(),\n                hasRun: false,\n                hasAfterPolicies: false,\n            };\n        }\n        // Track policies for each phase.\n        const serializePhase = createPhase(\"Serialize\");\n        const noPhase = createPhase(\"None\");\n        const deserializePhase = createPhase(\"Deserialize\");\n        const retryPhase = createPhase(\"Retry\");\n        const signPhase = createPhase(\"Sign\");\n        // a list of phases in order\n        const orderedPhases = [serializePhase, noPhase, deserializePhase, retryPhase, signPhase];\n        // Small helper function to map phase name to each Phase\n        function getPhase(phase) {\n            if (phase === \"Retry\") {\n                return retryPhase;\n            }\n            else if (phase === \"Serialize\") {\n                return serializePhase;\n            }\n            else if (phase === \"Deserialize\") {\n                return deserializePhase;\n            }\n            else if (phase === \"Sign\") {\n                return signPhase;\n            }\n            else {\n                return noPhase;\n            }\n        }\n        // First walk each policy and create a node to track metadata.\n        for (const descriptor of this._policies) {\n            const policy = descriptor.policy;\n            const options = descriptor.options;\n            const policyName = policy.name;\n            if (policyMap.has(policyName)) {\n                throw new Error(\"Duplicate policy names not allowed in pipeline\");\n            }\n            const node = {\n                policy,\n                dependsOn: new Set(),\n                dependants: new Set(),\n            };\n            if (options.afterPhase) {\n                node.afterPhase = getPhase(options.afterPhase);\n                node.afterPhase.hasAfterPolicies = true;\n            }\n            policyMap.set(policyName, node);\n            const phase = getPhase(options.phase);\n            phase.policies.add(node);\n        }\n        // Now that each policy has a node, connect dependency references.\n        for (const descriptor of this._policies) {\n            const { policy, options } = descriptor;\n            const policyName = policy.name;\n            const node = policyMap.get(policyName);\n            if (!node) {\n                throw new Error(`Missing node for policy ${policyName}`);\n            }\n            if (options.afterPolicies) {\n                for (const afterPolicyName of options.afterPolicies) {\n                    const afterNode = policyMap.get(afterPolicyName);\n                    if (afterNode) {\n                        // Linking in both directions helps later\n                        // when we want to notify dependants.\n                        node.dependsOn.add(afterNode);\n                        afterNode.dependants.add(node);\n                    }\n                }\n            }\n            if (options.beforePolicies) {\n                for (const beforePolicyName of options.beforePolicies) {\n                    const beforeNode = policyMap.get(beforePolicyName);\n                    if (beforeNode) {\n                        // To execute before another node, make it\n                        // depend on the current node.\n                        beforeNode.dependsOn.add(node);\n                        node.dependants.add(beforeNode);\n                    }\n                }\n            }\n        }\n        function walkPhase(phase) {\n            phase.hasRun = true;\n            // Sets iterate in insertion order\n            for (const node of phase.policies) {\n                if (node.afterPhase && (!node.afterPhase.hasRun || node.afterPhase.policies.size)) {\n                    // If this node is waiting on a phase to complete,\n                    // we need to skip it for now.\n                    // Even if the phase is empty, we should wait for it\n                    // to be walked to avoid re-ordering policies.\n                    continue;\n                }\n                if (node.dependsOn.size === 0) {\n                    // If there's nothing else we're waiting for, we can\n                    // add this policy to the result list.\n                    result.push(node.policy);\n                    // Notify anything that depends on this policy that\n                    // the policy has been scheduled.\n                    for (const dependant of node.dependants) {\n                        dependant.dependsOn.delete(node);\n                    }\n                    policyMap.delete(node.policy.name);\n                    phase.policies.delete(node);\n                }\n            }\n        }\n        function walkPhases() {\n            for (const phase of orderedPhases) {\n                walkPhase(phase);\n                // if the phase isn't complete\n                if (phase.policies.size > 0 && phase !== noPhase) {\n                    if (!noPhase.hasRun) {\n                        // Try running noPhase to see if that unblocks this phase next tick.\n                        // This can happen if a phase that happens before noPhase\n                        // is waiting on a noPhase policy to complete.\n                        walkPhase(noPhase);\n                    }\n                    // Don't proceed to the next phase until this phase finishes.\n                    return;\n                }\n                if (phase.hasAfterPolicies) {\n                    // Run any policies unblocked by this phase\n                    walkPhase(noPhase);\n                }\n            }\n        }\n        // Iterate until we've put every node in the result list.\n        let iteration = 0;\n        while (policyMap.size > 0) {\n            iteration++;\n            const initialResultLength = result.length;\n            // Keep walking each phase in order until we can order every node.\n            walkPhases();\n            // The result list *should* get at least one larger each time\n            // after the first full pass.\n            // Otherwise, we're going to loop forever.\n            if (result.length <= initialResultLength && iteration > 1) {\n                throw new Error(\"Cannot satisfy policy dependencies due to requirements cycle.\");\n            }\n        }\n        return result;\n    }\n}\n/**\n * Creates a totally empty pipeline.\n * Useful for testing or creating a custom one.\n */\nfunction createEmptyPipeline() {\n    return HttpPipeline.create();\n}\n//# sourceMappingURL=pipeline.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipeline.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipelineRequest.js":
/*!********************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipelineRequest.js ***!
  \********************************************************************************/
/*! exports provided: createPipelineRequest */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createPipelineRequest\", function() { return createPipelineRequest; });\n/* harmony import */ var _httpHeaders__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./httpHeaders */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/httpHeaders.js\");\n/* harmony import */ var _util_uuid__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util/uuid */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/uuid.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\nclass PipelineRequestImpl {\n    constructor(options) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        this.url = options.url;\n        this.body = options.body;\n        this.headers = (_a = options.headers) !== null && _a !== void 0 ? _a : Object(_httpHeaders__WEBPACK_IMPORTED_MODULE_0__[\"createHttpHeaders\"])();\n        this.method = (_b = options.method) !== null && _b !== void 0 ? _b : \"GET\";\n        this.timeout = (_c = options.timeout) !== null && _c !== void 0 ? _c : 0;\n        this.formData = options.formData;\n        this.disableKeepAlive = (_d = options.disableKeepAlive) !== null && _d !== void 0 ? _d : false;\n        this.proxySettings = options.proxySettings;\n        this.streamResponseStatusCodes = options.streamResponseStatusCodes;\n        this.withCredentials = (_e = options.withCredentials) !== null && _e !== void 0 ? _e : false;\n        this.abortSignal = options.abortSignal;\n        this.tracingOptions = options.tracingOptions;\n        this.onUploadProgress = options.onUploadProgress;\n        this.onDownloadProgress = options.onDownloadProgress;\n        this.requestId = options.requestId || Object(_util_uuid__WEBPACK_IMPORTED_MODULE_1__[\"generateUuid\"])();\n        this.allowInsecureConnection = (_f = options.allowInsecureConnection) !== null && _f !== void 0 ? _f : false;\n        this.enableBrowserStreams = (_g = options.enableBrowserStreams) !== null && _g !== void 0 ? _g : false;\n    }\n}\n/**\n * Creates a new pipeline request with the given options.\n * This method is to allow for the easy setting of default values and not required.\n * @param options - The options to create the request with.\n */\nfunction createPipelineRequest(options) {\n    return new PipelineRequestImpl(options);\n}\n//# sourceMappingURL=pipelineRequest.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/pipelineRequest.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/bearerTokenAuthenticationPolicy.js":
/*!*********************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/bearerTokenAuthenticationPolicy.js ***!
  \*********************************************************************************************************/
/*! exports provided: bearerTokenAuthenticationPolicyName, bearerTokenAuthenticationPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bearerTokenAuthenticationPolicyName\", function() { return bearerTokenAuthenticationPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bearerTokenAuthenticationPolicy\", function() { return bearerTokenAuthenticationPolicy; });\n/* harmony import */ var _util_tokenCycler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../util/tokenCycler */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/tokenCycler.js\");\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../log */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/log.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n/**\n * The programmatic identifier of the bearerTokenAuthenticationPolicy.\n */\nconst bearerTokenAuthenticationPolicyName = \"bearerTokenAuthenticationPolicy\";\n/**\n * Default authorize request handler\n */\nasync function defaultAuthorizeRequest(options) {\n    const { scopes, getAccessToken, request } = options;\n    const getTokenOptions = {\n        abortSignal: request.abortSignal,\n        tracingOptions: request.tracingOptions,\n    };\n    const accessToken = await getAccessToken(scopes, getTokenOptions);\n    if (accessToken) {\n        options.request.headers.set(\"Authorization\", `Bearer ${accessToken.token}`);\n    }\n}\n/**\n * We will retrieve the challenge only if the response status code was 401,\n * and if the response contained the header \"WWW-Authenticate\" with a non-empty value.\n */\nfunction getChallenge(response) {\n    const challenge = response.headers.get(\"WWW-Authenticate\");\n    if (response.status === 401 && challenge) {\n        return challenge;\n    }\n    return;\n}\n/**\n * A policy that can request a token from a TokenCredential implementation and\n * then apply it to the Authorization header of a request as a Bearer token.\n */\nfunction bearerTokenAuthenticationPolicy(options) {\n    var _a;\n    const { credential, scopes, challengeCallbacks } = options;\n    const logger = options.logger || _log__WEBPACK_IMPORTED_MODULE_1__[\"logger\"];\n    const callbacks = Object.assign({ authorizeRequest: (_a = challengeCallbacks === null || challengeCallbacks === void 0 ? void 0 : challengeCallbacks.authorizeRequest) !== null && _a !== void 0 ? _a : defaultAuthorizeRequest, authorizeRequestOnChallenge: challengeCallbacks === null || challengeCallbacks === void 0 ? void 0 : challengeCallbacks.authorizeRequestOnChallenge }, challengeCallbacks);\n    // This function encapsulates the entire process of reliably retrieving the token\n    // The options are left out of the public API until there's demand to configure this.\n    // Remember to extend `BearerTokenAuthenticationPolicyOptions` with `TokenCyclerOptions`\n    // in order to pass through the `options` object.\n    const getAccessToken = credential\n        ? Object(_util_tokenCycler__WEBPACK_IMPORTED_MODULE_0__[\"createTokenCycler\"])(credential /* , options */)\n        : () => Promise.resolve(null);\n    return {\n        name: bearerTokenAuthenticationPolicyName,\n        /**\n         * If there's no challenge parameter:\n         * - It will try to retrieve the token using the cache, or the credential's getToken.\n         * - Then it will try the next policy with or without the retrieved token.\n         *\n         * It uses the challenge parameters to:\n         * - Skip a first attempt to get the token from the credential if there's no cached token,\n         *   since it expects the token to be retrievable only after the challenge.\n         * - Prepare the outgoing request if the `prepareRequest` method has been provided.\n         * - Send an initial request to receive the challenge if it fails.\n         * - Process a challenge if the response contains it.\n         * - Retrieve a token with the challenge information, then re-send the request.\n         */\n        async sendRequest(request, next) {\n            if (!request.url.toLowerCase().startsWith(\"https://\")) {\n                throw new Error(\"Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.\");\n            }\n            await callbacks.authorizeRequest({\n                scopes: Array.isArray(scopes) ? scopes : [scopes],\n                request,\n                getAccessToken,\n                logger,\n            });\n            let response;\n            let error;\n            try {\n                response = await next(request);\n            }\n            catch (err) {\n                error = err;\n                response = err.response;\n            }\n            if (callbacks.authorizeRequestOnChallenge &&\n                (response === null || response === void 0 ? void 0 : response.status) === 401 &&\n                getChallenge(response)) {\n                // processes challenge\n                const shouldSendRequest = await callbacks.authorizeRequestOnChallenge({\n                    scopes: Array.isArray(scopes) ? scopes : [scopes],\n                    request,\n                    response,\n                    getAccessToken,\n                    logger,\n                });\n                if (shouldSendRequest) {\n                    return next(request);\n                }\n            }\n            if (error) {\n                throw error;\n            }\n            else {\n                return response;\n            }\n        },\n    };\n}\n//# sourceMappingURL=bearerTokenAuthenticationPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/bearerTokenAuthenticationPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/decompressResponsePolicy.browser.js":
/*!**********************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/decompressResponsePolicy.browser.js ***!
  \**********************************************************************************************************/
/*! exports provided: decompressResponsePolicyName, decompressResponsePolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"decompressResponsePolicyName\", function() { return decompressResponsePolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"decompressResponsePolicy\", function() { return decompressResponsePolicy; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/*\n * NOTE: When moving this file, please update \"browser\" section in package.json\n */\nconst NotSupported = new Error(\"decompressResponsePolicy is not supported in browser environment\");\nconst decompressResponsePolicyName = \"decompressResponsePolicy\";\n/**\n * decompressResponsePolicy is not supported in the browser and attempting\n * to use it will raise an error.\n */\nfunction decompressResponsePolicy() {\n    throw NotSupported;\n}\n//# sourceMappingURL=decompressResponsePolicy.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/decompressResponsePolicy.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/defaultRetryPolicy.js":
/*!********************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/defaultRetryPolicy.js ***!
  \********************************************************************************************/
/*! exports provided: defaultRetryPolicyName, defaultRetryPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"defaultRetryPolicyName\", function() { return defaultRetryPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"defaultRetryPolicy\", function() { return defaultRetryPolicy; });\n/* harmony import */ var _retryStrategies_exponentialRetryStrategy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../retryStrategies/exponentialRetryStrategy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/exponentialRetryStrategy.js\");\n/* harmony import */ var _retryStrategies_throttlingRetryStrategy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../retryStrategies/throttlingRetryStrategy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/throttlingRetryStrategy.js\");\n/* harmony import */ var _retryPolicy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./retryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../constants */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n/**\n * Name of the {@link defaultRetryPolicy}\n */\nconst defaultRetryPolicyName = \"defaultRetryPolicy\";\n/**\n * A policy that retries according to three strategies:\n * - When the server sends a 429 response with a Retry-After header.\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails, it will retry with an exponentially increasing delay.\n */\nfunction defaultRetryPolicy(options = {}) {\n    var _a;\n    return {\n        name: defaultRetryPolicyName,\n        sendRequest: Object(_retryPolicy__WEBPACK_IMPORTED_MODULE_2__[\"retryPolicy\"])([Object(_retryStrategies_throttlingRetryStrategy__WEBPACK_IMPORTED_MODULE_1__[\"throttlingRetryStrategy\"])(), Object(_retryStrategies_exponentialRetryStrategy__WEBPACK_IMPORTED_MODULE_0__[\"exponentialRetryStrategy\"])(options)], {\n            maxRetries: (_a = options.maxRetries) !== null && _a !== void 0 ? _a : _constants__WEBPACK_IMPORTED_MODULE_3__[\"DEFAULT_RETRY_POLICY_COUNT\"],\n        }).sendRequest,\n    };\n}\n//# sourceMappingURL=defaultRetryPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/defaultRetryPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/exponentialRetryPolicy.js":
/*!************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/exponentialRetryPolicy.js ***!
  \************************************************************************************************/
/*! exports provided: exponentialRetryPolicyName, exponentialRetryPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"exponentialRetryPolicyName\", function() { return exponentialRetryPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"exponentialRetryPolicy\", function() { return exponentialRetryPolicy; });\n/* harmony import */ var _retryStrategies_exponentialRetryStrategy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../retryStrategies/exponentialRetryStrategy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/exponentialRetryStrategy.js\");\n/* harmony import */ var _retryPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./retryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n/**\n * The programmatic identifier of the exponentialRetryPolicy.\n */\nconst exponentialRetryPolicyName = \"exponentialRetryPolicy\";\n/**\n * A policy that attempts to retry requests while introducing an exponentially increasing delay.\n * @param options - Options that configure retry logic.\n */\nfunction exponentialRetryPolicy(options = {}) {\n    var _a;\n    return Object(_retryPolicy__WEBPACK_IMPORTED_MODULE_1__[\"retryPolicy\"])([\n        Object(_retryStrategies_exponentialRetryStrategy__WEBPACK_IMPORTED_MODULE_0__[\"exponentialRetryStrategy\"])(Object.assign(Object.assign({}, options), { ignoreSystemErrors: true })),\n    ], {\n        maxRetries: (_a = options.maxRetries) !== null && _a !== void 0 ? _a : _constants__WEBPACK_IMPORTED_MODULE_2__[\"DEFAULT_RETRY_POLICY_COUNT\"],\n    });\n}\n//# sourceMappingURL=exponentialRetryPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/exponentialRetryPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/formDataPolicy.browser.js":
/*!************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/formDataPolicy.browser.js ***!
  \************************************************************************************************/
/*! exports provided: formDataPolicyName, formDataPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"formDataPolicyName\", function() { return formDataPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"formDataPolicy\", function() { return formDataPolicy; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * The programmatic identifier of the formDataPolicy.\n */\nconst formDataPolicyName = \"formDataPolicy\";\n/**\n * A policy that encodes FormData on the request into the body.\n */\nfunction formDataPolicy() {\n    return {\n        name: formDataPolicyName,\n        async sendRequest(request, next) {\n            if (request.formData) {\n                const formData = request.formData;\n                const requestForm = new FormData();\n                for (const formKey of Object.keys(formData)) {\n                    const formValue = formData[formKey];\n                    if (Array.isArray(formValue)) {\n                        for (const subValue of formValue) {\n                            requestForm.append(formKey, subValue);\n                        }\n                    }\n                    else {\n                        requestForm.append(formKey, formValue);\n                    }\n                }\n                request.body = requestForm;\n                request.formData = undefined;\n                const contentType = request.headers.get(\"Content-Type\");\n                if (contentType && contentType.indexOf(\"application/x-www-form-urlencoded\") !== -1) {\n                    request.body = new URLSearchParams(requestForm).toString();\n                }\n                else if (contentType && contentType.indexOf(\"multipart/form-data\") !== -1) {\n                    // browser will automatically apply a suitable content-type header\n                    request.headers.delete(\"Content-Type\");\n                }\n            }\n            return next(request);\n        },\n    };\n}\n//# sourceMappingURL=formDataPolicy.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/formDataPolicy.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/logPolicy.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/logPolicy.js ***!
  \***********************************************************************************/
/*! exports provided: logPolicyName, logPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"logPolicyName\", function() { return logPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"logPolicy\", function() { return logPolicy; });\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../log */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/log.js\");\n/* harmony import */ var _util_sanitizer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/sanitizer */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/sanitizer.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n/**\n * The programmatic identifier of the logPolicy.\n */\nconst logPolicyName = \"logPolicy\";\n/**\n * A policy that logs all requests and responses.\n * @param options - Options to configure logPolicy.\n */\nfunction logPolicy(options = {}) {\n    var _a;\n    const logger = (_a = options.logger) !== null && _a !== void 0 ? _a : _log__WEBPACK_IMPORTED_MODULE_0__[\"logger\"].info;\n    const sanitizer = new _util_sanitizer__WEBPACK_IMPORTED_MODULE_1__[\"Sanitizer\"]({\n        additionalAllowedHeaderNames: options.additionalAllowedHeaderNames,\n        additionalAllowedQueryParameters: options.additionalAllowedQueryParameters,\n    });\n    return {\n        name: logPolicyName,\n        async sendRequest(request, next) {\n            if (!logger.enabled) {\n                return next(request);\n            }\n            logger(`Request: ${sanitizer.sanitize(request)}`);\n            const response = await next(request);\n            logger(`Response status code: ${response.status}`);\n            logger(`Headers: ${sanitizer.sanitize(response.headers)}`);\n            return response;\n        },\n    };\n}\n//# sourceMappingURL=logPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/logPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/ndJsonPolicy.js":
/*!**************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/ndJsonPolicy.js ***!
  \**************************************************************************************/
/*! exports provided: ndJsonPolicyName, ndJsonPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ndJsonPolicyName\", function() { return ndJsonPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ndJsonPolicy\", function() { return ndJsonPolicy; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * The programmatic identifier of the ndJsonPolicy.\n */\nconst ndJsonPolicyName = \"ndJsonPolicy\";\n/**\n * ndJsonPolicy is a policy used to control keep alive settings for every request.\n */\nfunction ndJsonPolicy() {\n    return {\n        name: ndJsonPolicyName,\n        async sendRequest(request, next) {\n            // There currently isn't a good way to bypass the serializer\n            if (typeof request.body === \"string\" && request.body.startsWith(\"[\")) {\n                const body = JSON.parse(request.body);\n                if (Array.isArray(body)) {\n                    request.body = body.map((item) => JSON.stringify(item) + \"\\n\").join(\"\");\n                }\n            }\n            return next(request);\n        },\n    };\n}\n//# sourceMappingURL=ndJsonPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/ndJsonPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/proxyPolicy.browser.js":
/*!*********************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/proxyPolicy.browser.js ***!
  \*********************************************************************************************/
/*! exports provided: proxyPolicyName, getDefaultProxySettings, proxyPolicy, resetCachedProxyAgents */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"proxyPolicyName\", function() { return proxyPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDefaultProxySettings\", function() { return getDefaultProxySettings; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"proxyPolicy\", function() { return proxyPolicy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"resetCachedProxyAgents\", function() { return resetCachedProxyAgents; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/*\n * NOTE: When moving this file, please update \"browser\" section in package.json\n */\nconst NotSupported = new Error(\"proxyPolicy is not supported in browser environment\");\nconst proxyPolicyName = \"proxyPolicy\";\nfunction getDefaultProxySettings() {\n    throw NotSupported;\n}\n/**\n * proxyPolicy is not supported in the browser and attempting\n * to use it will raise an error.\n */\nfunction proxyPolicy() {\n    throw NotSupported;\n}\n/**\n * A function to reset the cached agents.\n * proxyPolicy is not supported in the browser and attempting\n * to use it will raise an error.\n * @internal\n */\nfunction resetCachedProxyAgents() {\n    throw NotSupported;\n}\n//# sourceMappingURL=proxyPolicy.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/proxyPolicy.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/redirectPolicy.js":
/*!****************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/redirectPolicy.js ***!
  \****************************************************************************************/
/*! exports provided: redirectPolicyName, redirectPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"redirectPolicyName\", function() { return redirectPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"redirectPolicy\", function() { return redirectPolicy; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * The programmatic identifier of the redirectPolicy.\n */\nconst redirectPolicyName = \"redirectPolicy\";\n/**\n * Methods that are allowed to follow redirects 301 and 302\n */\nconst allowedRedirect = [\"GET\", \"HEAD\"];\n/**\n * A policy to follow Location headers from the server in order\n * to support server-side redirection.\n * In the browser, this policy is not used.\n * @param options - Options to control policy behavior.\n */\nfunction redirectPolicy(options = {}) {\n    const { maxRetries = 20 } = options;\n    return {\n        name: redirectPolicyName,\n        async sendRequest(request, next) {\n            const response = await next(request);\n            return handleRedirect(next, response, maxRetries);\n        },\n    };\n}\nasync function handleRedirect(next, response, maxRetries, currentRetries = 0) {\n    const { request, status, headers } = response;\n    const locationHeader = headers.get(\"location\");\n    if (locationHeader &&\n        (status === 300 ||\n            (status === 301 && allowedRedirect.includes(request.method)) ||\n            (status === 302 && allowedRedirect.includes(request.method)) ||\n            (status === 303 && request.method === \"POST\") ||\n            status === 307) &&\n        currentRetries < maxRetries) {\n        const url = new URL(locationHeader, request.url);\n        request.url = url.toString();\n        // POST request with Status code 303 should be converted into a\n        // redirected GET request if the redirect url is present in the location header\n        if (status === 303) {\n            request.method = \"GET\";\n            request.headers.delete(\"Content-Length\");\n            delete request.body;\n        }\n        request.headers.delete(\"Authorization\");\n        const res = await next(request);\n        return handleRedirect(next, res, maxRetries, currentRetries + 1);\n    }\n    return response;\n}\n//# sourceMappingURL=redirectPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/redirectPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js ***!
  \*************************************************************************************/
/*! exports provided: retryPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"retryPolicy\", function() { return retryPolicy; });\n/* harmony import */ var _util_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../util/helpers */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/helpers.js\");\n/* harmony import */ var _azure_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @azure/logger */ \"./node_modules/@azure/logger/dist-esm/src/index.js\");\n/* harmony import */ var _azure_abort_controller__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @azure/abort-controller */ \"./node_modules/@azure/abort-controller/dist-esm/src/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../constants */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\nconst retryPolicyLogger = Object(_azure_logger__WEBPACK_IMPORTED_MODULE_1__[\"createClientLogger\"])(\"core-rest-pipeline retryPolicy\");\n/**\n * The programmatic identifier of the retryPolicy.\n */\nconst retryPolicyName = \"retryPolicy\";\n/**\n * retryPolicy is a generic policy to enable retrying requests when certain conditions are met\n */\nfunction retryPolicy(strategies, options = { maxRetries: _constants__WEBPACK_IMPORTED_MODULE_3__[\"DEFAULT_RETRY_POLICY_COUNT\"] }) {\n    const logger = options.logger || retryPolicyLogger;\n    return {\n        name: retryPolicyName,\n        async sendRequest(request, next) {\n            var _a, _b;\n            let response;\n            let responseError;\n            let retryCount = -1;\n            // eslint-disable-next-line no-constant-condition\n            retryRequest: while (true) {\n                retryCount += 1;\n                response = undefined;\n                responseError = undefined;\n                try {\n                    logger.info(`Retry ${retryCount}: Attempting to send request`, request.requestId);\n                    response = await next(request);\n                    logger.info(`Retry ${retryCount}: Received a response from request`, request.requestId);\n                }\n                catch (e) {\n                    logger.error(`Retry ${retryCount}: Received an error from request`, request.requestId);\n                    // RestErrors are valid targets for the retry strategies.\n                    // If none of the retry strategies can work with them, they will be thrown later in this policy.\n                    // If the received error is not a RestError, it is immediately thrown.\n                    responseError = e;\n                    if (!e || responseError.name !== \"RestError\") {\n                        throw e;\n                    }\n                    response = responseError.response;\n                }\n                if ((_a = request.abortSignal) === null || _a === void 0 ? void 0 : _a.aborted) {\n                    logger.error(`Retry ${retryCount}: Request aborted.`);\n                    const abortError = new _azure_abort_controller__WEBPACK_IMPORTED_MODULE_2__[\"AbortError\"]();\n                    throw abortError;\n                }\n                if (retryCount >= ((_b = options.maxRetries) !== null && _b !== void 0 ? _b : _constants__WEBPACK_IMPORTED_MODULE_3__[\"DEFAULT_RETRY_POLICY_COUNT\"])) {\n                    logger.info(`Retry ${retryCount}: Maximum retries reached. Returning the last received response, or throwing the last received error.`);\n                    if (responseError) {\n                        throw responseError;\n                    }\n                    else if (response) {\n                        return response;\n                    }\n                    else {\n                        throw new Error(\"Maximum retries reached with no response or error to throw\");\n                    }\n                }\n                logger.info(`Retry ${retryCount}: Processing ${strategies.length} retry strategies.`);\n                strategiesLoop: for (const strategy of strategies) {\n                    const strategyLogger = strategy.logger || retryPolicyLogger;\n                    strategyLogger.info(`Retry ${retryCount}: Processing retry strategy ${strategy.name}.`);\n                    const modifiers = strategy.retry({\n                        retryCount,\n                        response,\n                        responseError,\n                    });\n                    if (modifiers.skipStrategy) {\n                        strategyLogger.info(`Retry ${retryCount}: Skipped.`);\n                        continue strategiesLoop;\n                    }\n                    const { errorToThrow, retryAfterInMs, redirectTo } = modifiers;\n                    if (errorToThrow) {\n                        strategyLogger.error(`Retry ${retryCount}: Retry strategy ${strategy.name} throws error:`, errorToThrow);\n                        throw errorToThrow;\n                    }\n                    if (retryAfterInMs || retryAfterInMs === 0) {\n                        strategyLogger.info(`Retry ${retryCount}: Retry strategy ${strategy.name} retries after ${retryAfterInMs}`);\n                        await Object(_util_helpers__WEBPACK_IMPORTED_MODULE_0__[\"delay\"])(retryAfterInMs, undefined, { abortSignal: request.abortSignal });\n                        continue retryRequest;\n                    }\n                    if (redirectTo) {\n                        strategyLogger.info(`Retry ${retryCount}: Retry strategy ${strategy.name} redirects to ${redirectTo}`);\n                        request.url = redirectTo;\n                        continue retryRequest;\n                    }\n                }\n                if (responseError) {\n                    logger.info(`None of the retry strategies could work with the received error. Throwing it.`);\n                    throw responseError;\n                }\n                if (response) {\n                    logger.info(`None of the retry strategies could work with the received response. Returning it.`);\n                    return response;\n                }\n                // If all the retries skip and there's no response,\n                // we're still in the retry loop, so a new request will be sent\n                // until `maxRetries` is reached.\n            }\n        },\n    };\n}\n//# sourceMappingURL=retryPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/setClientRequestIdPolicy.js":
/*!**************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/setClientRequestIdPolicy.js ***!
  \**************************************************************************************************/
/*! exports provided: setClientRequestIdPolicyName, setClientRequestIdPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setClientRequestIdPolicyName\", function() { return setClientRequestIdPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setClientRequestIdPolicy\", function() { return setClientRequestIdPolicy; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * The programmatic identifier of the setClientRequestIdPolicy.\n */\nconst setClientRequestIdPolicyName = \"setClientRequestIdPolicy\";\n/**\n * Each PipelineRequest gets a unique id upon creation.\n * This policy passes that unique id along via an HTTP header to enable better\n * telemetry and tracing.\n * @param requestIdHeaderName - The name of the header to pass the request ID to.\n */\nfunction setClientRequestIdPolicy(requestIdHeaderName = \"x-ms-client-request-id\") {\n    return {\n        name: setClientRequestIdPolicyName,\n        async sendRequest(request, next) {\n            if (!request.headers.has(requestIdHeaderName)) {\n                request.headers.set(requestIdHeaderName, request.requestId);\n            }\n            return next(request);\n        },\n    };\n}\n//# sourceMappingURL=setClientRequestIdPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/setClientRequestIdPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/systemErrorRetryPolicy.js":
/*!************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/systemErrorRetryPolicy.js ***!
  \************************************************************************************************/
/*! exports provided: systemErrorRetryPolicyName, systemErrorRetryPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"systemErrorRetryPolicyName\", function() { return systemErrorRetryPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"systemErrorRetryPolicy\", function() { return systemErrorRetryPolicy; });\n/* harmony import */ var _retryStrategies_exponentialRetryStrategy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../retryStrategies/exponentialRetryStrategy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/exponentialRetryStrategy.js\");\n/* harmony import */ var _retryPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./retryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n/**\n * Name of the {@link systemErrorRetryPolicy}\n */\nconst systemErrorRetryPolicyName = \"systemErrorRetryPolicy\";\n/**\n * A retry policy that specifically seeks to handle errors in the\n * underlying transport layer (e.g. DNS lookup failures) rather than\n * retryable error codes from the server itself.\n * @param options - Options that customize the policy.\n */\nfunction systemErrorRetryPolicy(options = {}) {\n    var _a;\n    return {\n        name: systemErrorRetryPolicyName,\n        sendRequest: Object(_retryPolicy__WEBPACK_IMPORTED_MODULE_1__[\"retryPolicy\"])([\n            Object(_retryStrategies_exponentialRetryStrategy__WEBPACK_IMPORTED_MODULE_0__[\"exponentialRetryStrategy\"])(Object.assign(Object.assign({}, options), { ignoreHttpStatusCodes: true })),\n        ], {\n            maxRetries: (_a = options.maxRetries) !== null && _a !== void 0 ? _a : _constants__WEBPACK_IMPORTED_MODULE_2__[\"DEFAULT_RETRY_POLICY_COUNT\"],\n        }).sendRequest,\n    };\n}\n//# sourceMappingURL=systemErrorRetryPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/systemErrorRetryPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/throttlingRetryPolicy.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/throttlingRetryPolicy.js ***!
  \***********************************************************************************************/
/*! exports provided: throttlingRetryPolicyName, throttlingRetryPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"throttlingRetryPolicyName\", function() { return throttlingRetryPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"throttlingRetryPolicy\", function() { return throttlingRetryPolicy; });\n/* harmony import */ var _retryStrategies_throttlingRetryStrategy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../retryStrategies/throttlingRetryStrategy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/throttlingRetryStrategy.js\");\n/* harmony import */ var _retryPolicy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./retryPolicy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/retryPolicy.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n/**\n * Name of the {@link throttlingRetryPolicy}\n */\nconst throttlingRetryPolicyName = \"throttlingRetryPolicy\";\n/**\n * A policy that retries when the server sends a 429 response with a Retry-After header.\n *\n * To learn more, please refer to\n * https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-request-limits,\n * https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits and\n * https://docs.microsoft.com/en-us/azure/virtual-machines/troubleshooting/troubleshooting-throttling-errors\n *\n * @param options - Options that configure retry logic.\n */\nfunction throttlingRetryPolicy(options = {}) {\n    var _a;\n    return {\n        name: throttlingRetryPolicyName,\n        sendRequest: Object(_retryPolicy__WEBPACK_IMPORTED_MODULE_1__[\"retryPolicy\"])([Object(_retryStrategies_throttlingRetryStrategy__WEBPACK_IMPORTED_MODULE_0__[\"throttlingRetryStrategy\"])()], {\n            maxRetries: (_a = options.maxRetries) !== null && _a !== void 0 ? _a : _constants__WEBPACK_IMPORTED_MODULE_2__[\"DEFAULT_RETRY_POLICY_COUNT\"],\n        }).sendRequest,\n    };\n}\n//# sourceMappingURL=throttlingRetryPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/throttlingRetryPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tlsPolicy.js":
/*!***********************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tlsPolicy.js ***!
  \***********************************************************************************/
/*! exports provided: tlsPolicyName, tlsPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"tlsPolicyName\", function() { return tlsPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"tlsPolicy\", function() { return tlsPolicy; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Name of the TLS Policy\n */\nconst tlsPolicyName = \"tlsPolicy\";\n/**\n * Gets a pipeline policy that adds the client certificate to the HttpClient agent for authentication.\n */\nfunction tlsPolicy(tlsSettings) {\n    return {\n        name: tlsPolicyName,\n        sendRequest: async (req, next) => {\n            // Users may define a request tlsSettings, honor those over the client level one\n            if (!req.tlsSettings) {\n                req.tlsSettings = tlsSettings;\n            }\n            return next(req);\n        },\n    };\n}\n//# sourceMappingURL=tlsPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tlsPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tracingPolicy.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tracingPolicy.js ***!
  \***************************************************************************************/
/*! exports provided: tracingPolicyName, tracingPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"tracingPolicyName\", function() { return tracingPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"tracingPolicy\", function() { return tracingPolicy; });\n/* harmony import */ var _azure_core_tracing__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/core-tracing */ \"./node_modules/@azure/core-tracing/dist-esm/src/index.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js\");\n/* harmony import */ var _util_userAgent__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/userAgent */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgent.js\");\n/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../log */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/log.js\");\n/* harmony import */ var _azure_core_util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @azure/core-util */ \"./node_modules/@azure/core-util/dist-esm/src/index.js\");\n/* harmony import */ var _restError__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../restError */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/restError.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n\n\n/**\n * The programmatic identifier of the tracingPolicy.\n */\nconst tracingPolicyName = \"tracingPolicy\";\n/**\n * A simple policy to create OpenTelemetry Spans for each request made by the pipeline\n * that has SpanOptions with a parent.\n * Requests made without a parent Span will not be recorded.\n * @param options - Options to configure the telemetry logged by the tracing policy.\n */\nfunction tracingPolicy(options = {}) {\n    const userAgent = Object(_util_userAgent__WEBPACK_IMPORTED_MODULE_2__[\"getUserAgentValue\"])(options.userAgentPrefix);\n    const tracingClient = tryCreateTracingClient();\n    return {\n        name: tracingPolicyName,\n        async sendRequest(request, next) {\n            var _a, _b;\n            if (!tracingClient || !((_a = request.tracingOptions) === null || _a === void 0 ? void 0 : _a.tracingContext)) {\n                return next(request);\n            }\n            const { span, tracingContext } = (_b = tryCreateSpan(tracingClient, request, userAgent)) !== null && _b !== void 0 ? _b : {};\n            if (!span || !tracingContext) {\n                return next(request);\n            }\n            try {\n                const response = await tracingClient.withContext(tracingContext, next, request);\n                tryProcessResponse(span, response);\n                return response;\n            }\n            catch (err) {\n                tryProcessError(span, err);\n                throw err;\n            }\n        },\n    };\n}\nfunction tryCreateTracingClient() {\n    try {\n        return Object(_azure_core_tracing__WEBPACK_IMPORTED_MODULE_0__[\"createTracingClient\"])({\n            namespace: \"\",\n            packageName: \"@azure/core-rest-pipeline\",\n            packageVersion: _constants__WEBPACK_IMPORTED_MODULE_1__[\"SDK_VERSION\"],\n        });\n    }\n    catch (e) {\n        _log__WEBPACK_IMPORTED_MODULE_3__[\"logger\"].warning(`Error when creating the TracingClient: ${Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_4__[\"getErrorMessage\"])(e)}`);\n        return undefined;\n    }\n}\nfunction tryCreateSpan(tracingClient, request, userAgent) {\n    try {\n        // As per spec, we do not need to differentiate between HTTP and HTTPS in span name.\n        const { span, updatedOptions } = tracingClient.startSpan(`HTTP ${request.method}`, { tracingOptions: request.tracingOptions }, {\n            spanKind: \"client\",\n            spanAttributes: {\n                \"http.method\": request.method,\n                \"http.url\": request.url,\n                requestId: request.requestId,\n            },\n        });\n        // If the span is not recording, don't do any more work.\n        if (!span.isRecording()) {\n            span.end();\n            return undefined;\n        }\n        if (userAgent) {\n            span.setAttribute(\"http.user_agent\", userAgent);\n        }\n        // set headers\n        const headers = tracingClient.createRequestHeaders(updatedOptions.tracingOptions.tracingContext);\n        for (const [key, value] of Object.entries(headers)) {\n            request.headers.set(key, value);\n        }\n        return { span, tracingContext: updatedOptions.tracingOptions.tracingContext };\n    }\n    catch (e) {\n        _log__WEBPACK_IMPORTED_MODULE_3__[\"logger\"].warning(`Skipping creating a tracing span due to an error: ${Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_4__[\"getErrorMessage\"])(e)}`);\n        return undefined;\n    }\n}\nfunction tryProcessError(span, error) {\n    try {\n        span.setStatus({\n            status: \"error\",\n            error: Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_4__[\"isError\"])(error) ? error : undefined,\n        });\n        if (Object(_restError__WEBPACK_IMPORTED_MODULE_5__[\"isRestError\"])(error) && error.statusCode) {\n            span.setAttribute(\"http.status_code\", error.statusCode);\n        }\n        span.end();\n    }\n    catch (e) {\n        _log__WEBPACK_IMPORTED_MODULE_3__[\"logger\"].warning(`Skipping tracing span processing due to an error: ${Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_4__[\"getErrorMessage\"])(e)}`);\n    }\n}\nfunction tryProcessResponse(span, response) {\n    try {\n        span.setAttribute(\"http.status_code\", response.status);\n        const serviceRequestId = response.headers.get(\"x-ms-request-id\");\n        if (serviceRequestId) {\n            span.setAttribute(\"serviceRequestId\", serviceRequestId);\n        }\n        span.setStatus({\n            status: \"success\",\n        });\n        span.end();\n    }\n    catch (e) {\n        _log__WEBPACK_IMPORTED_MODULE_3__[\"logger\"].warning(`Skipping tracing span processing due to an error: ${Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_4__[\"getErrorMessage\"])(e)}`);\n    }\n}\n//# sourceMappingURL=tracingPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/tracingPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/userAgentPolicy.js":
/*!*****************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/userAgentPolicy.js ***!
  \*****************************************************************************************/
/*! exports provided: userAgentPolicyName, userAgentPolicy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"userAgentPolicyName\", function() { return userAgentPolicyName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"userAgentPolicy\", function() { return userAgentPolicy; });\n/* harmony import */ var _util_userAgent__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../util/userAgent */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgent.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst UserAgentHeaderName = Object(_util_userAgent__WEBPACK_IMPORTED_MODULE_0__[\"getUserAgentHeaderName\"])();\n/**\n * The programmatic identifier of the userAgentPolicy.\n */\nconst userAgentPolicyName = \"userAgentPolicy\";\n/**\n * A policy that sets the User-Agent header (or equivalent) to reflect\n * the library version.\n * @param options - Options to customize the user agent value.\n */\nfunction userAgentPolicy(options = {}) {\n    const userAgentValue = Object(_util_userAgent__WEBPACK_IMPORTED_MODULE_0__[\"getUserAgentValue\"])(options.userAgentPrefix);\n    return {\n        name: userAgentPolicyName,\n        async sendRequest(request, next) {\n            if (!request.headers.has(UserAgentHeaderName)) {\n                request.headers.set(UserAgentHeaderName, userAgentValue);\n            }\n            return next(request);\n        },\n    };\n}\n//# sourceMappingURL=userAgentPolicy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/policies/userAgentPolicy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/restError.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/restError.js ***!
  \**************************************************************************/
/*! exports provided: RestError, isRestError */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RestError\", function() { return RestError; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isRestError\", function() { return isRestError; });\n/* harmony import */ var _azure_core_util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/core-util */ \"./node_modules/@azure/core-util/dist-esm/src/index.js\");\n/* harmony import */ var _util_inspect__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util/inspect */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/inspect.browser.js\");\n/* harmony import */ var _util_sanitizer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util/sanitizer */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/sanitizer.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\nconst errorSanitizer = new _util_sanitizer__WEBPACK_IMPORTED_MODULE_2__[\"Sanitizer\"]();\n/**\n * A custom error type for failed pipeline requests.\n */\nclass RestError extends Error {\n    constructor(message, options = {}) {\n        super(message);\n        this.name = \"RestError\";\n        this.code = options.code;\n        this.statusCode = options.statusCode;\n        this.request = options.request;\n        this.response = options.response;\n        Object.setPrototypeOf(this, RestError.prototype);\n    }\n    /**\n     * Logging method for util.inspect in Node\n     */\n    [_util_inspect__WEBPACK_IMPORTED_MODULE_1__[\"custom\"]]() {\n        return `RestError: ${this.message} \\n ${errorSanitizer.sanitize(this)}`;\n    }\n}\n/**\n * Something went wrong when making the request.\n * This means the actual request failed for some reason,\n * such as a DNS issue or the connection being lost.\n */\nRestError.REQUEST_SEND_ERROR = \"REQUEST_SEND_ERROR\";\n/**\n * This means that parsing the response from the server failed.\n * It may have been malformed.\n */\nRestError.PARSE_ERROR = \"PARSE_ERROR\";\n/**\n * Typeguard for RestError\n * @param e - Something caught by a catch clause.\n */\nfunction isRestError(e) {\n    if (e instanceof RestError) {\n        return true;\n    }\n    return Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_0__[\"isError\"])(e) && e.name === \"RestError\";\n}\n//# sourceMappingURL=restError.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/restError.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/exponentialRetryStrategy.js":
/*!*********************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/exponentialRetryStrategy.js ***!
  \*********************************************************************************************************/
/*! exports provided: exponentialRetryStrategy, isExponentialRetryResponse, isSystemError */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"exponentialRetryStrategy\", function() { return exponentialRetryStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isExponentialRetryResponse\", function() { return isExponentialRetryResponse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isSystemError\", function() { return isSystemError; });\n/* harmony import */ var _azure_core_util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/core-util */ \"./node_modules/@azure/core-util/dist-esm/src/index.js\");\n/* harmony import */ var _throttlingRetryStrategy__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./throttlingRetryStrategy */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/throttlingRetryStrategy.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n// intervals are in milliseconds\nconst DEFAULT_CLIENT_RETRY_INTERVAL = 1000;\nconst DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 64;\n/**\n * A retry strategy that retries with an exponentially increasing delay in these two cases:\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails (408, greater or equal than 500, except for 501 and 505).\n */\nfunction exponentialRetryStrategy(options = {}) {\n    var _a, _b;\n    const retryInterval = (_a = options.retryDelayInMs) !== null && _a !== void 0 ? _a : DEFAULT_CLIENT_RETRY_INTERVAL;\n    const maxRetryInterval = (_b = options.maxRetryDelayInMs) !== null && _b !== void 0 ? _b : DEFAULT_CLIENT_MAX_RETRY_INTERVAL;\n    let retryAfterInMs = retryInterval;\n    return {\n        name: \"exponentialRetryStrategy\",\n        retry({ retryCount, response, responseError }) {\n            const matchedSystemError = isSystemError(responseError);\n            const ignoreSystemErrors = matchedSystemError && options.ignoreSystemErrors;\n            const isExponential = isExponentialRetryResponse(response);\n            const ignoreExponentialResponse = isExponential && options.ignoreHttpStatusCodes;\n            const unknownResponse = response && (Object(_throttlingRetryStrategy__WEBPACK_IMPORTED_MODULE_1__[\"isThrottlingRetryResponse\"])(response) || !isExponential);\n            if (unknownResponse || ignoreExponentialResponse || ignoreSystemErrors) {\n                return { skipStrategy: true };\n            }\n            if (responseError && !matchedSystemError && !isExponential) {\n                return { errorToThrow: responseError };\n            }\n            // Exponentially increase the delay each time\n            const exponentialDelay = retryAfterInMs * Math.pow(2, retryCount);\n            // Don't let the delay exceed the maximum\n            const clampedExponentialDelay = Math.min(maxRetryInterval, exponentialDelay);\n            // Allow the final value to have some \"jitter\" (within 50% of the delay size) so\n            // that retries across multiple clients don't occur simultaneously.\n            retryAfterInMs =\n                clampedExponentialDelay / 2 + Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_0__[\"getRandomIntegerInclusive\"])(0, clampedExponentialDelay / 2);\n            return { retryAfterInMs };\n        },\n    };\n}\n/**\n * A response is a retry response if it has status codes:\n * - 408, or\n * - Greater or equal than 500, except for 501 and 505.\n */\nfunction isExponentialRetryResponse(response) {\n    return Boolean(response &&\n        response.status !== undefined &&\n        (response.status >= 500 || response.status === 408) &&\n        response.status !== 501 &&\n        response.status !== 505);\n}\n/**\n * Determines whether an error from a pipeline response was triggered in the network layer.\n */\nfunction isSystemError(err) {\n    if (!err) {\n        return false;\n    }\n    return (err.code === \"ETIMEDOUT\" ||\n        err.code === \"ESOCKETTIMEDOUT\" ||\n        err.code === \"ECONNREFUSED\" ||\n        err.code === \"ECONNRESET\" ||\n        err.code === \"ENOENT\");\n}\n//# sourceMappingURL=exponentialRetryStrategy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/exponentialRetryStrategy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/throttlingRetryStrategy.js":
/*!********************************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/throttlingRetryStrategy.js ***!
  \********************************************************************************************************/
/*! exports provided: isThrottlingRetryResponse, throttlingRetryStrategy */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isThrottlingRetryResponse\", function() { return isThrottlingRetryResponse; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"throttlingRetryStrategy\", function() { return throttlingRetryStrategy; });\n/* harmony import */ var _util_helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../util/helpers */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/helpers.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * The header that comes back from Azure services representing\n * the amount of time (minimum) to wait to retry (in seconds or timestamp after which we can retry).\n */\nconst RetryAfterHeader = \"Retry-After\";\n/**\n * The headers that come back from Azure services representing\n * the amount of time (minimum) to wait to retry.\n *\n * \"retry-after-ms\", \"x-ms-retry-after-ms\" : milliseconds\n * \"Retry-After\" : seconds or timestamp\n */\nconst AllRetryAfterHeaders = [\"retry-after-ms\", \"x-ms-retry-after-ms\", RetryAfterHeader];\n/**\n * A response is a throttling retry response if it has a throttling status code (429 or 503),\n * as long as one of the [ \"Retry-After\" or \"retry-after-ms\" or \"x-ms-retry-after-ms\" ] headers has a valid value.\n *\n * Returns the `retryAfterInMs` value if the response is a throttling retry response.\n * If not throttling retry response, returns `undefined`.\n *\n * @internal\n */\nfunction getRetryAfterInMs(response) {\n    if (!(response && [429, 503].includes(response.status)))\n        return undefined;\n    try {\n        // Headers: \"retry-after-ms\", \"x-ms-retry-after-ms\", \"Retry-After\"\n        for (const header of AllRetryAfterHeaders) {\n            const retryAfterValue = Object(_util_helpers__WEBPACK_IMPORTED_MODULE_0__[\"parseHeaderValueAsNumber\"])(response, header);\n            if (retryAfterValue === 0 || retryAfterValue) {\n                // \"Retry-After\" header ==> seconds\n                // \"retry-after-ms\", \"x-ms-retry-after-ms\" headers ==> milli-seconds\n                const multiplyingFactor = header === RetryAfterHeader ? 1000 : 1;\n                return retryAfterValue * multiplyingFactor; // in milli-seconds\n            }\n        }\n        // RetryAfterHeader (\"Retry-After\") has a special case where it might be formatted as a date instead of a number of seconds\n        const retryAfterHeader = response.headers.get(RetryAfterHeader);\n        if (!retryAfterHeader)\n            return;\n        const date = Date.parse(retryAfterHeader);\n        const diff = date - Date.now();\n        // negative diff would mean a date in the past, so retry asap with 0 milliseconds\n        return Number.isFinite(diff) ? Math.max(0, diff) : undefined;\n    }\n    catch (e) {\n        return undefined;\n    }\n}\n/**\n * A response is a retry response if it has a throttling status code (429 or 503),\n * as long as one of the [ \"Retry-After\" or \"retry-after-ms\" or \"x-ms-retry-after-ms\" ] headers has a valid value.\n */\nfunction isThrottlingRetryResponse(response) {\n    return Number.isFinite(getRetryAfterInMs(response));\n}\nfunction throttlingRetryStrategy() {\n    return {\n        name: \"throttlingRetryStrategy\",\n        retry({ response }) {\n            const retryAfterInMs = getRetryAfterInMs(response);\n            if (!Number.isFinite(retryAfterInMs)) {\n                return { skipStrategy: true };\n            }\n            return {\n                retryAfterInMs,\n            };\n        },\n    };\n}\n//# sourceMappingURL=throttlingRetryStrategy.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/throttlingRetryStrategy.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/helpers.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/helpers.js ***!
  \*****************************************************************************/
/*! exports provided: delay, parseHeaderValueAsNumber */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"delay\", function() { return delay; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"parseHeaderValueAsNumber\", function() { return parseHeaderValueAsNumber; });\n/* harmony import */ var _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/abort-controller */ \"./node_modules/@azure/abort-controller/dist-esm/src/index.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst StandardAbortMessage = \"The operation was aborted.\";\n/**\n * A wrapper for setTimeout that resolves a promise after delayInMs milliseconds.\n * @param delayInMs - The number of milliseconds to be delayed.\n * @param value - The value to be resolved with after a timeout of t milliseconds.\n * @param options - The options for delay - currently abort options\n *                  - abortSignal - The abortSignal associated with containing operation.\n *                  - abortErrorMsg - The abort error message associated with containing operation.\n * @returns Resolved promise\n */\nfunction delay(delayInMs, value, options) {\n    return new Promise((resolve, reject) => {\n        let timer = undefined;\n        let onAborted = undefined;\n        const rejectOnAbort = () => {\n            return reject(new _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__[\"AbortError\"]((options === null || options === void 0 ? void 0 : options.abortErrorMsg) ? options === null || options === void 0 ? void 0 : options.abortErrorMsg : StandardAbortMessage));\n        };\n        const removeListeners = () => {\n            if ((options === null || options === void 0 ? void 0 : options.abortSignal) && onAborted) {\n                options.abortSignal.removeEventListener(\"abort\", onAborted);\n            }\n        };\n        onAborted = () => {\n            if (timer) {\n                clearTimeout(timer);\n            }\n            removeListeners();\n            return rejectOnAbort();\n        };\n        if ((options === null || options === void 0 ? void 0 : options.abortSignal) && options.abortSignal.aborted) {\n            return rejectOnAbort();\n        }\n        timer = setTimeout(() => {\n            removeListeners();\n            resolve(value);\n        }, delayInMs);\n        if (options === null || options === void 0 ? void 0 : options.abortSignal) {\n            options.abortSignal.addEventListener(\"abort\", onAborted);\n        }\n    });\n}\n/**\n * @internal\n * @returns the parsed value or undefined if the parsed value is invalid.\n */\nfunction parseHeaderValueAsNumber(response, headerName) {\n    const value = response.headers.get(headerName);\n    if (!value)\n        return;\n    const valueAsNum = Number(value);\n    if (Number.isNaN(valueAsNum))\n        return;\n    return valueAsNum;\n}\n//# sourceMappingURL=helpers.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/helpers.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/inspect.browser.js":
/*!*************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/inspect.browser.js ***!
  \*************************************************************************************/
/*! exports provided: custom */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"custom\", function() { return custom; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nconst custom = {};\n//# sourceMappingURL=inspect.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/inspect.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/sanitizer.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/sanitizer.js ***!
  \*******************************************************************************/
/*! exports provided: Sanitizer */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Sanitizer\", function() { return Sanitizer; });\n/* harmony import */ var _azure_core_util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/core-util */ \"./node_modules/@azure/core-util/dist-esm/src/index.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst RedactedString = \"REDACTED\";\n// Make sure this list is up-to-date with the one under core/logger/Readme#Keyconcepts\nconst defaultAllowedHeaderNames = [\n    \"x-ms-client-request-id\",\n    \"x-ms-return-client-request-id\",\n    \"x-ms-useragent\",\n    \"x-ms-correlation-request-id\",\n    \"x-ms-request-id\",\n    \"client-request-id\",\n    \"ms-cv\",\n    \"return-client-request-id\",\n    \"traceparent\",\n    \"Access-Control-Allow-Credentials\",\n    \"Access-Control-Allow-Headers\",\n    \"Access-Control-Allow-Methods\",\n    \"Access-Control-Allow-Origin\",\n    \"Access-Control-Expose-Headers\",\n    \"Access-Control-Max-Age\",\n    \"Access-Control-Request-Headers\",\n    \"Access-Control-Request-Method\",\n    \"Origin\",\n    \"Accept\",\n    \"Accept-Encoding\",\n    \"Cache-Control\",\n    \"Connection\",\n    \"Content-Length\",\n    \"Content-Type\",\n    \"Date\",\n    \"ETag\",\n    \"Expires\",\n    \"If-Match\",\n    \"If-Modified-Since\",\n    \"If-None-Match\",\n    \"If-Unmodified-Since\",\n    \"Last-Modified\",\n    \"Pragma\",\n    \"Request-Id\",\n    \"Retry-After\",\n    \"Server\",\n    \"Transfer-Encoding\",\n    \"User-Agent\",\n    \"WWW-Authenticate\",\n];\nconst defaultAllowedQueryParameters = [\"api-version\"];\n/**\n * @internal\n */\nclass Sanitizer {\n    constructor({ additionalAllowedHeaderNames: allowedHeaderNames = [], additionalAllowedQueryParameters: allowedQueryParameters = [], } = {}) {\n        allowedHeaderNames = defaultAllowedHeaderNames.concat(allowedHeaderNames);\n        allowedQueryParameters = defaultAllowedQueryParameters.concat(allowedQueryParameters);\n        this.allowedHeaderNames = new Set(allowedHeaderNames.map((n) => n.toLowerCase()));\n        this.allowedQueryParameters = new Set(allowedQueryParameters.map((p) => p.toLowerCase()));\n    }\n    sanitize(obj) {\n        const seen = new Set();\n        return JSON.stringify(obj, (key, value) => {\n            // Ensure Errors include their interesting non-enumerable members\n            if (value instanceof Error) {\n                return Object.assign(Object.assign({}, value), { name: value.name, message: value.message });\n            }\n            if (key === \"headers\") {\n                return this.sanitizeHeaders(value);\n            }\n            else if (key === \"url\") {\n                return this.sanitizeUrl(value);\n            }\n            else if (key === \"query\") {\n                return this.sanitizeQuery(value);\n            }\n            else if (key === \"body\") {\n                // Don't log the request body\n                return undefined;\n            }\n            else if (key === \"response\") {\n                // Don't log response again\n                return undefined;\n            }\n            else if (key === \"operationSpec\") {\n                // When using sendOperationRequest, the request carries a massive\n                // field with the autorest spec. No need to log it.\n                return undefined;\n            }\n            else if (Array.isArray(value) || Object(_azure_core_util__WEBPACK_IMPORTED_MODULE_0__[\"isObject\"])(value)) {\n                if (seen.has(value)) {\n                    return \"[Circular]\";\n                }\n                seen.add(value);\n            }\n            return value;\n        }, 2);\n    }\n    sanitizeHeaders(obj) {\n        const sanitized = {};\n        for (const key of Object.keys(obj)) {\n            if (this.allowedHeaderNames.has(key.toLowerCase())) {\n                sanitized[key] = obj[key];\n            }\n            else {\n                sanitized[key] = RedactedString;\n            }\n        }\n        return sanitized;\n    }\n    sanitizeQuery(value) {\n        if (typeof value !== \"object\" || value === null) {\n            return value;\n        }\n        const sanitized = {};\n        for (const k of Object.keys(value)) {\n            if (this.allowedQueryParameters.has(k.toLowerCase())) {\n                sanitized[k] = value[k];\n            }\n            else {\n                sanitized[k] = RedactedString;\n            }\n        }\n        return sanitized;\n    }\n    sanitizeUrl(value) {\n        if (typeof value !== \"string\" || value === null) {\n            return value;\n        }\n        const url = new URL(value);\n        if (!url.search) {\n            return value;\n        }\n        for (const [key] of url.searchParams) {\n            if (!this.allowedQueryParameters.has(key.toLowerCase())) {\n                url.searchParams.set(key, RedactedString);\n            }\n        }\n        return url.toString();\n    }\n}\n//# sourceMappingURL=sanitizer.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/sanitizer.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/tokenCycler.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/tokenCycler.js ***!
  \*********************************************************************************/
/*! exports provided: DEFAULT_CYCLER_OPTIONS, createTokenCycler */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DEFAULT_CYCLER_OPTIONS\", function() { return DEFAULT_CYCLER_OPTIONS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createTokenCycler\", function() { return createTokenCycler; });\n/* harmony import */ var _helpers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./helpers */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/helpers.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n// Default options for the cycler if none are provided\nconst DEFAULT_CYCLER_OPTIONS = {\n    forcedRefreshWindowInMs: 1000,\n    retryIntervalInMs: 3000,\n    refreshWindowInMs: 1000 * 60 * 2, // Start refreshing 2m before expiry\n};\n/**\n * Converts an an unreliable access token getter (which may resolve with null)\n * into an AccessTokenGetter by retrying the unreliable getter in a regular\n * interval.\n *\n * @param getAccessToken - A function that produces a promise of an access token that may fail by returning null.\n * @param retryIntervalInMs - The time (in milliseconds) to wait between retry attempts.\n * @param refreshTimeout - The timestamp after which the refresh attempt will fail, throwing an exception.\n * @returns - A promise that, if it resolves, will resolve with an access token.\n */\nasync function beginRefresh(getAccessToken, retryIntervalInMs, refreshTimeout) {\n    // This wrapper handles exceptions gracefully as long as we haven't exceeded\n    // the timeout.\n    async function tryGetAccessToken() {\n        if (Date.now() < refreshTimeout) {\n            try {\n                return await getAccessToken();\n            }\n            catch (_a) {\n                return null;\n            }\n        }\n        else {\n            const finalToken = await getAccessToken();\n            // Timeout is up, so throw if it's still null\n            if (finalToken === null) {\n                throw new Error(\"Failed to refresh access token.\");\n            }\n            return finalToken;\n        }\n    }\n    let token = await tryGetAccessToken();\n    while (token === null) {\n        await Object(_helpers__WEBPACK_IMPORTED_MODULE_0__[\"delay\"])(retryIntervalInMs);\n        token = await tryGetAccessToken();\n    }\n    return token;\n}\n/**\n * Creates a token cycler from a credential, scopes, and optional settings.\n *\n * A token cycler represents a way to reliably retrieve a valid access token\n * from a TokenCredential. It will handle initializing the token, refreshing it\n * when it nears expiration, and synchronizes refresh attempts to avoid\n * concurrency hazards.\n *\n * @param credential - the underlying TokenCredential that provides the access\n * token\n * @param tokenCyclerOptions - optionally override default settings for the cycler\n *\n * @returns - a function that reliably produces a valid access token\n */\nfunction createTokenCycler(credential, tokenCyclerOptions) {\n    let refreshWorker = null;\n    let token = null;\n    let tenantId;\n    const options = Object.assign(Object.assign({}, DEFAULT_CYCLER_OPTIONS), tokenCyclerOptions);\n    /**\n     * This little holder defines several predicates that we use to construct\n     * the rules of refreshing the token.\n     */\n    const cycler = {\n        /**\n         * Produces true if a refresh job is currently in progress.\n         */\n        get isRefreshing() {\n            return refreshWorker !== null;\n        },\n        /**\n         * Produces true if the cycler SHOULD refresh (we are within the refresh\n         * window and not already refreshing)\n         */\n        get shouldRefresh() {\n            var _a;\n            return (!cycler.isRefreshing &&\n                ((_a = token === null || token === void 0 ? void 0 : token.expiresOnTimestamp) !== null && _a !== void 0 ? _a : 0) - options.refreshWindowInMs < Date.now());\n        },\n        /**\n         * Produces true if the cycler MUST refresh (null or nearly-expired\n         * token).\n         */\n        get mustRefresh() {\n            return (token === null || token.expiresOnTimestamp - options.forcedRefreshWindowInMs < Date.now());\n        },\n    };\n    /**\n     * Starts a refresh job or returns the existing job if one is already\n     * running.\n     */\n    function refresh(scopes, getTokenOptions) {\n        var _a;\n        if (!cycler.isRefreshing) {\n            // We bind `scopes` here to avoid passing it around a lot\n            const tryGetAccessToken = () => credential.getToken(scopes, getTokenOptions);\n            // Take advantage of promise chaining to insert an assignment to `token`\n            // before the refresh can be considered done.\n            refreshWorker = beginRefresh(tryGetAccessToken, options.retryIntervalInMs, \n            // If we don't have a token, then we should timeout immediately\n            (_a = token === null || token === void 0 ? void 0 : token.expiresOnTimestamp) !== null && _a !== void 0 ? _a : Date.now())\n                .then((_token) => {\n                refreshWorker = null;\n                token = _token;\n                tenantId = getTokenOptions.tenantId;\n                return token;\n            })\n                .catch((reason) => {\n                // We also should reset the refresher if we enter a failed state.  All\n                // existing awaiters will throw, but subsequent requests will start a\n                // new retry chain.\n                refreshWorker = null;\n                token = null;\n                tenantId = undefined;\n                throw reason;\n            });\n        }\n        return refreshWorker;\n    }\n    return async (scopes, tokenOptions) => {\n        //\n        // Simple rules:\n        // - If we MUST refresh, then return the refresh task, blocking\n        //   the pipeline until a token is available.\n        // - If we SHOULD refresh, then run refresh but don't return it\n        //   (we can still use the cached token).\n        // - Return the token, since it's fine if we didn't return in\n        //   step 1.\n        //\n        // If the tenantId passed in token options is different to the one we have\n        // Or if we are in claim challenge and the token was rejected and a new access token need to be issued, we need to\n        // refresh the token with the new tenantId or token.\n        const mustRefresh = tenantId !== tokenOptions.tenantId || Boolean(tokenOptions.claims) || cycler.mustRefresh;\n        if (mustRefresh)\n            return refresh(scopes, tokenOptions);\n        if (cycler.shouldRefresh) {\n            refresh(scopes, tokenOptions);\n        }\n        return token;\n    };\n}\n//# sourceMappingURL=tokenCycler.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/tokenCycler.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgent.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgent.js ***!
  \*******************************************************************************/
/*! exports provided: getUserAgentHeaderName, getUserAgentValue */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getUserAgentHeaderName\", function() { return getUserAgentHeaderName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getUserAgentValue\", function() { return getUserAgentValue; });\n/* harmony import */ var _userAgentPlatform__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./userAgentPlatform */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgentPlatform.browser.js\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../constants */ \"./node_modules/@azure/core-rest-pipeline/dist-esm/src/constants.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\nfunction getUserAgentString(telemetryInfo) {\n    const parts = [];\n    for (const [key, value] of telemetryInfo) {\n        const token = value ? `${key}/${value}` : key;\n        parts.push(token);\n    }\n    return parts.join(\" \");\n}\n/**\n * @internal\n */\nfunction getUserAgentHeaderName() {\n    return Object(_userAgentPlatform__WEBPACK_IMPORTED_MODULE_0__[\"getHeaderName\"])();\n}\n/**\n * @internal\n */\nfunction getUserAgentValue(prefix) {\n    const runtimeInfo = new Map();\n    runtimeInfo.set(\"core-rest-pipeline\", _constants__WEBPACK_IMPORTED_MODULE_1__[\"SDK_VERSION\"]);\n    Object(_userAgentPlatform__WEBPACK_IMPORTED_MODULE_0__[\"setPlatformSpecificData\"])(runtimeInfo);\n    const defaultAgent = getUserAgentString(runtimeInfo);\n    const userAgentValue = prefix ? `${prefix} ${defaultAgent}` : defaultAgent;\n    return userAgentValue;\n}\n//# sourceMappingURL=userAgent.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgent.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgentPlatform.browser.js":
/*!***********************************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgentPlatform.browser.js ***!
  \***********************************************************************************************/
/*! exports provided: getHeaderName, setPlatformSpecificData */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getHeaderName\", function() { return getHeaderName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setPlatformSpecificData\", function() { return setPlatformSpecificData; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/*\n * NOTE: When moving this file, please update \"browser\" section in package.json.\n */\n/**\n * @internal\n */\nfunction getHeaderName() {\n    return \"x-ms-useragent\";\n}\n/**\n * @internal\n */\nfunction setPlatformSpecificData(map) {\n    const navigator = self.navigator;\n    map.set(\"OS\", (navigator.oscpu || navigator.platform).replace(\" \", \"\"));\n}\n//# sourceMappingURL=userAgentPlatform.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/userAgentPlatform.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/uuid.js":
/*!**************************************************************************!*\
  !*** ./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/uuid.js ***!
  \**************************************************************************/
/*! exports provided: generateUuid */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"generateUuid\", function() { return generateUuid; });\n/* harmony import */ var uuid__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! uuid */ \"./node_modules/uuid/dist/esm-browser/index.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * Generated Universally Unique Identifier\n *\n * @returns RFC4122 v4 UUID.\n * @internal\n */\nfunction generateUuid() {\n    return Object(uuid__WEBPACK_IMPORTED_MODULE_0__[\"v4\"])();\n}\n//# sourceMappingURL=uuid.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-rest-pipeline/dist-esm/src/util/uuid.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-tracing/dist-esm/src/index.js":
/*!****************************************************************!*\
  !*** ./node_modules/@azure/core-tracing/dist-esm/src/index.js ***!
  \****************************************************************/
/*! exports provided: useInstrumenter, createTracingClient */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _instrumenter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./instrumenter */ \"./node_modules/@azure/core-tracing/dist-esm/src/instrumenter.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"useInstrumenter\", function() { return _instrumenter__WEBPACK_IMPORTED_MODULE_0__[\"useInstrumenter\"]; });\n\n/* harmony import */ var _tracingClient__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tracingClient */ \"./node_modules/@azure/core-tracing/dist-esm/src/tracingClient.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"createTracingClient\", function() { return _tracingClient__WEBPACK_IMPORTED_MODULE_1__[\"createTracingClient\"]; });\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n//# sourceMappingURL=index.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-tracing/dist-esm/src/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-tracing/dist-esm/src/instrumenter.js":
/*!***********************************************************************!*\
  !*** ./node_modules/@azure/core-tracing/dist-esm/src/instrumenter.js ***!
  \***********************************************************************/
/*! exports provided: createDefaultTracingSpan, createDefaultInstrumenter, useInstrumenter, getInstrumenter */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createDefaultTracingSpan\", function() { return createDefaultTracingSpan; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createDefaultInstrumenter\", function() { return createDefaultInstrumenter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"useInstrumenter\", function() { return useInstrumenter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getInstrumenter\", function() { return getInstrumenter; });\n/* harmony import */ var _tracingContext__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./tracingContext */ \"./node_modules/@azure/core-tracing/dist-esm/src/tracingContext.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nfunction createDefaultTracingSpan() {\n    return {\n        end: () => {\n            // noop\n        },\n        isRecording: () => false,\n        recordException: () => {\n            // noop\n        },\n        setAttribute: () => {\n            // noop\n        },\n        setStatus: () => {\n            // noop\n        },\n    };\n}\nfunction createDefaultInstrumenter() {\n    return {\n        createRequestHeaders: () => {\n            return {};\n        },\n        parseTraceparentHeader: () => {\n            return undefined;\n        },\n        startSpan: (_name, spanOptions) => {\n            return {\n                span: createDefaultTracingSpan(),\n                tracingContext: Object(_tracingContext__WEBPACK_IMPORTED_MODULE_0__[\"createTracingContext\"])({ parentContext: spanOptions.tracingContext }),\n            };\n        },\n        withContext(_context, callback, ...callbackArgs) {\n            return callback(...callbackArgs);\n        },\n    };\n}\n/** @internal */\nlet instrumenterImplementation;\n/**\n * Extends the Azure SDK with support for a given instrumenter implementation.\n *\n * @param instrumenter - The instrumenter implementation to use.\n */\nfunction useInstrumenter(instrumenter) {\n    instrumenterImplementation = instrumenter;\n}\n/**\n * Gets the currently set instrumenter, a No-Op instrumenter by default.\n *\n * @returns The currently set instrumenter\n */\nfunction getInstrumenter() {\n    if (!instrumenterImplementation) {\n        instrumenterImplementation = createDefaultInstrumenter();\n    }\n    return instrumenterImplementation;\n}\n//# sourceMappingURL=instrumenter.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-tracing/dist-esm/src/instrumenter.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-tracing/dist-esm/src/tracingClient.js":
/*!************************************************************************!*\
  !*** ./node_modules/@azure/core-tracing/dist-esm/src/tracingClient.js ***!
  \************************************************************************/
/*! exports provided: createTracingClient */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createTracingClient\", function() { return createTracingClient; });\n/* harmony import */ var _instrumenter__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./instrumenter */ \"./node_modules/@azure/core-tracing/dist-esm/src/instrumenter.js\");\n/* harmony import */ var _tracingContext__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tracingContext */ \"./node_modules/@azure/core-tracing/dist-esm/src/tracingContext.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n/**\n * Creates a new tracing client.\n *\n * @param options - Options used to configure the tracing client.\n * @returns - An instance of {@link TracingClient}.\n */\nfunction createTracingClient(options) {\n    const { namespace, packageName, packageVersion } = options;\n    function startSpan(name, operationOptions, spanOptions) {\n        var _a;\n        const startSpanResult = Object(_instrumenter__WEBPACK_IMPORTED_MODULE_0__[\"getInstrumenter\"])().startSpan(name, Object.assign(Object.assign({}, spanOptions), { packageName: packageName, packageVersion: packageVersion, tracingContext: (_a = operationOptions === null || operationOptions === void 0 ? void 0 : operationOptions.tracingOptions) === null || _a === void 0 ? void 0 : _a.tracingContext }));\n        let tracingContext = startSpanResult.tracingContext;\n        const span = startSpanResult.span;\n        if (!tracingContext.getValue(_tracingContext__WEBPACK_IMPORTED_MODULE_1__[\"knownContextKeys\"].namespace)) {\n            tracingContext = tracingContext.setValue(_tracingContext__WEBPACK_IMPORTED_MODULE_1__[\"knownContextKeys\"].namespace, namespace);\n        }\n        span.setAttribute(\"az.namespace\", tracingContext.getValue(_tracingContext__WEBPACK_IMPORTED_MODULE_1__[\"knownContextKeys\"].namespace));\n        const updatedOptions = Object.assign({}, operationOptions, {\n            tracingOptions: Object.assign(Object.assign({}, operationOptions === null || operationOptions === void 0 ? void 0 : operationOptions.tracingOptions), { tracingContext }),\n        });\n        return {\n            span,\n            updatedOptions,\n        };\n    }\n    async function withSpan(name, operationOptions, callback, spanOptions) {\n        const { span, updatedOptions } = startSpan(name, operationOptions, spanOptions);\n        try {\n            const result = await withContext(updatedOptions.tracingOptions.tracingContext, () => Promise.resolve(callback(updatedOptions, span)));\n            span.setStatus({ status: \"success\" });\n            return result;\n        }\n        catch (err) {\n            span.setStatus({ status: \"error\", error: err });\n            throw err;\n        }\n        finally {\n            span.end();\n        }\n    }\n    function withContext(context, callback, ...callbackArgs) {\n        return Object(_instrumenter__WEBPACK_IMPORTED_MODULE_0__[\"getInstrumenter\"])().withContext(context, callback, ...callbackArgs);\n    }\n    /**\n     * Parses a traceparent header value into a span identifier.\n     *\n     * @param traceparentHeader - The traceparent header to parse.\n     * @returns An implementation-specific identifier for the span.\n     */\n    function parseTraceparentHeader(traceparentHeader) {\n        return Object(_instrumenter__WEBPACK_IMPORTED_MODULE_0__[\"getInstrumenter\"])().parseTraceparentHeader(traceparentHeader);\n    }\n    /**\n     * Creates a set of request headers to propagate tracing information to a backend.\n     *\n     * @param tracingContext - The context containing the span to serialize.\n     * @returns The set of headers to add to a request.\n     */\n    function createRequestHeaders(tracingContext) {\n        return Object(_instrumenter__WEBPACK_IMPORTED_MODULE_0__[\"getInstrumenter\"])().createRequestHeaders(tracingContext);\n    }\n    return {\n        startSpan,\n        withSpan,\n        withContext,\n        parseTraceparentHeader,\n        createRequestHeaders,\n    };\n}\n//# sourceMappingURL=tracingClient.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-tracing/dist-esm/src/tracingClient.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-tracing/dist-esm/src/tracingContext.js":
/*!*************************************************************************!*\
  !*** ./node_modules/@azure/core-tracing/dist-esm/src/tracingContext.js ***!
  \*************************************************************************/
/*! exports provided: knownContextKeys, createTracingContext, TracingContextImpl */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"knownContextKeys\", function() { return knownContextKeys; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createTracingContext\", function() { return createTracingContext; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TracingContextImpl\", function() { return TracingContextImpl; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/** @internal */\nconst knownContextKeys = {\n    span: Symbol.for(\"@azure/core-tracing span\"),\n    namespace: Symbol.for(\"@azure/core-tracing namespace\"),\n};\n/**\n * Creates a new {@link TracingContext} with the given options.\n * @param options - A set of known keys that may be set on the context.\n * @returns A new {@link TracingContext} with the given options.\n *\n * @internal\n */\nfunction createTracingContext(options = {}) {\n    let context = new TracingContextImpl(options.parentContext);\n    if (options.span) {\n        context = context.setValue(knownContextKeys.span, options.span);\n    }\n    if (options.namespace) {\n        context = context.setValue(knownContextKeys.namespace, options.namespace);\n    }\n    return context;\n}\n/** @internal */\nclass TracingContextImpl {\n    constructor(initialContext) {\n        this._contextMap =\n            initialContext instanceof TracingContextImpl\n                ? new Map(initialContext._contextMap)\n                : new Map();\n    }\n    setValue(key, value) {\n        const newContext = new TracingContextImpl(this);\n        newContext._contextMap.set(key, value);\n        return newContext;\n    }\n    getValue(key) {\n        return this._contextMap.get(key);\n    }\n    deleteValue(key) {\n        const newContext = new TracingContextImpl(this);\n        newContext._contextMap.delete(key);\n        return newContext;\n    }\n}\n//# sourceMappingURL=tracingContext.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-tracing/dist-esm/src/tracingContext.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/base64.browser.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/base64.browser.js ***!
  \**********************************************************************/
/*! exports provided: base64ToBytes, bufferToBase64 */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"base64ToBytes\", function() { return base64ToBytes; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bufferToBase64\", function() { return bufferToBase64; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Converts a base64 string into a byte array.\n * @param content - The base64 string to convert.\n * @internal\n */\nfunction base64ToBytes(content) {\n    if (typeof atob !== \"function\") {\n        throw new Error(`Your browser environment is missing the global \"atob\" function.`);\n    }\n    const binary = atob(content);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n}\n/**\n * Converts an ArrayBuffer to base64 string.\n * @param buffer - Raw binary data.\n * @internal\n */\nfunction bufferToBase64(buffer) {\n    if (typeof btoa !== \"function\") {\n        throw new Error(`Your browser environment is missing the global \"btoa\" function.`);\n    }\n    const bytes = new Uint8Array(buffer);\n    let binary = \"\";\n    for (const byte of bytes) {\n        binary += String.fromCharCode(byte);\n    }\n    return btoa(binary);\n}\n//# sourceMappingURL=base64.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/base64.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/delay.js":
/*!*************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/delay.js ***!
  \*************************************************************/
/*! exports provided: delay */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"delay\", function() { return delay; });\n/* harmony import */ var _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/abort-controller */ \"./node_modules/@azure/abort-controller/dist-esm/src/index.js\");\n/* harmony import */ var _typeGuards__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./typeGuards */ \"./node_modules/@azure/core-util/dist-esm/src/typeGuards.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\nconst StandardAbortMessage = \"The operation was aborted.\";\n/**\n * A wrapper for setTimeout that resolves a promise after timeInMs milliseconds.\n * @param timeInMs - The number of milliseconds to be delayed.\n * @param options - The options for delay - currently abort options\n * @returns Promise that is resolved after timeInMs\n */\nfunction delay(timeInMs, options) {\n    return new Promise((resolve, reject) => {\n        let timer = undefined;\n        let onAborted = undefined;\n        const rejectOnAbort = () => {\n            var _a;\n            return reject(new _azure_abort_controller__WEBPACK_IMPORTED_MODULE_0__[\"AbortError\"]((_a = options === null || options === void 0 ? void 0 : options.abortErrorMsg) !== null && _a !== void 0 ? _a : StandardAbortMessage));\n        };\n        const removeListeners = () => {\n            if ((options === null || options === void 0 ? void 0 : options.abortSignal) && onAborted) {\n                options.abortSignal.removeEventListener(\"abort\", onAborted);\n            }\n        };\n        onAborted = () => {\n            if (Object(_typeGuards__WEBPACK_IMPORTED_MODULE_1__[\"isDefined\"])(timer)) {\n                clearTimeout(timer);\n            }\n            removeListeners();\n            return rejectOnAbort();\n        };\n        if ((options === null || options === void 0 ? void 0 : options.abortSignal) && options.abortSignal.aborted) {\n            return rejectOnAbort();\n        }\n        timer = setTimeout(() => {\n            removeListeners();\n            resolve();\n        }, timeInMs);\n        if (options === null || options === void 0 ? void 0 : options.abortSignal) {\n            options.abortSignal.addEventListener(\"abort\", onAborted);\n        }\n    });\n}\n//# sourceMappingURL=delay.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/delay.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/error.js":
/*!*************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/error.js ***!
  \*************************************************************/
/*! exports provided: isError, getErrorMessage */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isError\", function() { return isError; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getErrorMessage\", function() { return getErrorMessage; });\n/* harmony import */ var _object__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./object */ \"./node_modules/@azure/core-util/dist-esm/src/object.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n/**\n * Typeguard for an error object shape (has name and message)\n * @param e - Something caught by a catch clause.\n */\nfunction isError(e) {\n    if (Object(_object__WEBPACK_IMPORTED_MODULE_0__[\"isObject\"])(e)) {\n        const hasName = typeof e.name === \"string\";\n        const hasMessage = typeof e.message === \"string\";\n        return hasName && hasMessage;\n    }\n    return false;\n}\n/**\n * Given what is thought to be an error object, return the message if possible.\n * If the message is missing, returns a stringified version of the input.\n * @param e - Something thrown from a try block\n * @returns The error message or a string of the input\n */\nfunction getErrorMessage(e) {\n    if (isError(e)) {\n        return e.message;\n    }\n    else {\n        let stringified;\n        try {\n            if (typeof e === \"object\" && e) {\n                stringified = JSON.stringify(e);\n            }\n            else {\n                stringified = String(e);\n            }\n        }\n        catch (err) {\n            stringified = \"[unable to stringify input]\";\n        }\n        return `Unknown error ${stringified}`;\n    }\n}\n//# sourceMappingURL=error.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/error.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/hex.js":
/*!***********************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/hex.js ***!
  \***********************************************************/
/*! exports provided: bufferToHex */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bufferToHex\", function() { return bufferToHex; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Converts an ArrayBuffer to a hexadecimal string.\n * @param buffer - Raw binary data.\n * @internal\n */\nfunction bufferToHex(buffer) {\n    const bytes = new Uint8Array(buffer);\n    return Array.prototype.map.call(bytes, byteToHex).join(\"\");\n}\n/**\n * Converts a byte to a hexadecimal string.\n * @param byte - An integer representation of a byte.\n * @internal\n */\nfunction byteToHex(byte) {\n    const hex = byte.toString(16);\n    return hex.length === 2 ? hex : `0${hex}`;\n}\n//# sourceMappingURL=hex.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/hex.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/index.js":
/*!*************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/index.js ***!
  \*************************************************************/
/*! exports provided: isNode, delay, getRandomIntegerInclusive, isObject, isError, getErrorMessage, computeSha256Hash, computeSha256Hmac, isDefined, isObjectWithProperties, objectHasProperty */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _isNode__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./isNode */ \"./node_modules/@azure/core-util/dist-esm/src/isNode.browser.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isNode\", function() { return _isNode__WEBPACK_IMPORTED_MODULE_0__[\"isNode\"]; });\n\n/* harmony import */ var _delay__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./delay */ \"./node_modules/@azure/core-util/dist-esm/src/delay.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"delay\", function() { return _delay__WEBPACK_IMPORTED_MODULE_1__[\"delay\"]; });\n\n/* harmony import */ var _random__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./random */ \"./node_modules/@azure/core-util/dist-esm/src/random.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"getRandomIntegerInclusive\", function() { return _random__WEBPACK_IMPORTED_MODULE_2__[\"getRandomIntegerInclusive\"]; });\n\n/* harmony import */ var _object__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./object */ \"./node_modules/@azure/core-util/dist-esm/src/object.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isObject\", function() { return _object__WEBPACK_IMPORTED_MODULE_3__[\"isObject\"]; });\n\n/* harmony import */ var _error__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./error */ \"./node_modules/@azure/core-util/dist-esm/src/error.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isError\", function() { return _error__WEBPACK_IMPORTED_MODULE_4__[\"isError\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"getErrorMessage\", function() { return _error__WEBPACK_IMPORTED_MODULE_4__[\"getErrorMessage\"]; });\n\n/* harmony import */ var _sha256__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./sha256 */ \"./node_modules/@azure/core-util/dist-esm/src/sha256.browser.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"computeSha256Hash\", function() { return _sha256__WEBPACK_IMPORTED_MODULE_5__[\"computeSha256Hash\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"computeSha256Hmac\", function() { return _sha256__WEBPACK_IMPORTED_MODULE_5__[\"computeSha256Hmac\"]; });\n\n/* harmony import */ var _typeGuards__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./typeGuards */ \"./node_modules/@azure/core-util/dist-esm/src/typeGuards.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isDefined\", function() { return _typeGuards__WEBPACK_IMPORTED_MODULE_6__[\"isDefined\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"isObjectWithProperties\", function() { return _typeGuards__WEBPACK_IMPORTED_MODULE_6__[\"isObjectWithProperties\"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"objectHasProperty\", function() { return _typeGuards__WEBPACK_IMPORTED_MODULE_6__[\"objectHasProperty\"]; });\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\n\n\n\n\n//# sourceMappingURL=index.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/isNode.browser.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/isNode.browser.js ***!
  \**********************************************************************/
/*! exports provided: isNode */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isNode\", function() { return isNode; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * A constant that indicates whether the environment the code is running is Node.JS.\n */\nconst isNode = false;\n//# sourceMappingURL=isNode.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/isNode.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/object.js":
/*!**************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/object.js ***!
  \**************************************************************/
/*! exports provided: isObject */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isObject\", function() { return isObject; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Helper to determine when an input is a generic JS object.\n * @returns true when input is an object type that is not null, Array, RegExp, or Date.\n */\nfunction isObject(input) {\n    return (typeof input === \"object\" &&\n        input !== null &&\n        !Array.isArray(input) &&\n        !(input instanceof RegExp) &&\n        !(input instanceof Date));\n}\n//# sourceMappingURL=object.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/object.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/random.js":
/*!**************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/random.js ***!
  \**************************************************************/
/*! exports provided: getRandomIntegerInclusive */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getRandomIntegerInclusive\", function() { return getRandomIntegerInclusive; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Returns a random integer value between a lower and upper bound,\n * inclusive of both bounds.\n * Note that this uses Math.random and isn't secure. If you need to use\n * this for any kind of security purpose, find a better source of random.\n * @param min - The smallest integer value allowed.\n * @param max - The largest integer value allowed.\n */\nfunction getRandomIntegerInclusive(min, max) {\n    // Make sure inputs are integers.\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    // Pick a random offset from zero to the size of the range.\n    // Since Math.random() can never return 1, we have to make the range one larger\n    // in order to be inclusive of the maximum value after we take the floor.\n    const offset = Math.floor(Math.random() * (max - min + 1));\n    return offset + min;\n}\n//# sourceMappingURL=random.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/random.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/sha256.browser.js":
/*!**********************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/sha256.browser.js ***!
  \**********************************************************************/
/*! exports provided: computeSha256Hmac, computeSha256Hash */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"computeSha256Hmac\", function() { return computeSha256Hmac; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"computeSha256Hash\", function() { return computeSha256Hash; });\n/* harmony import */ var _base64_browser__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./base64.browser */ \"./node_modules/@azure/core-util/dist-esm/src/base64.browser.js\");\n/* harmony import */ var _hex__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hex */ \"./node_modules/@azure/core-util/dist-esm/src/hex.js\");\n/* harmony import */ var _utf8_browser__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utf8.browser */ \"./node_modules/@azure/core-util/dist-esm/src/utf8.browser.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\n\n\nlet subtleCrypto;\n/**\n * Returns a cached reference to the Web API crypto.subtle object.\n * @internal\n */\nfunction getCrypto() {\n    if (subtleCrypto) {\n        return subtleCrypto;\n    }\n    if (!self.crypto || !self.crypto.subtle) {\n        throw new Error(\"Your browser environment does not support cryptography functions.\");\n    }\n    subtleCrypto = self.crypto.subtle;\n    return subtleCrypto;\n}\n/**\n * Generates a SHA-256 HMAC signature.\n * @param key - The HMAC key represented as a base64 string, used to generate the cryptographic HMAC hash.\n * @param stringToSign - The data to be signed.\n * @param encoding - The textual encoding to use for the returned HMAC digest.\n */\nasync function computeSha256Hmac(key, stringToSign, encoding) {\n    const crypto = getCrypto();\n    const keyBytes = Object(_base64_browser__WEBPACK_IMPORTED_MODULE_0__[\"base64ToBytes\"])(key);\n    const stringToSignBytes = Object(_utf8_browser__WEBPACK_IMPORTED_MODULE_2__[\"utf8ToBytes\"])(stringToSign);\n    const cryptoKey = await crypto.importKey(\"raw\", keyBytes, {\n        name: \"HMAC\",\n        hash: { name: \"SHA-256\" },\n    }, false, [\"sign\"]);\n    const signature = await crypto.sign({\n        name: \"HMAC\",\n        hash: { name: \"SHA-256\" },\n    }, cryptoKey, stringToSignBytes);\n    switch (encoding) {\n        case \"base64\":\n            return Object(_base64_browser__WEBPACK_IMPORTED_MODULE_0__[\"bufferToBase64\"])(signature);\n        case \"hex\":\n            return Object(_hex__WEBPACK_IMPORTED_MODULE_1__[\"bufferToHex\"])(signature);\n    }\n}\n/**\n * Generates a SHA-256 hash.\n * @param content - The data to be included in the hash.\n * @param encoding - The textual encoding to use for the returned hash.\n */\nasync function computeSha256Hash(content, encoding) {\n    const contentBytes = Object(_utf8_browser__WEBPACK_IMPORTED_MODULE_2__[\"utf8ToBytes\"])(content);\n    const digest = await getCrypto().digest({ name: \"SHA-256\" }, contentBytes);\n    switch (encoding) {\n        case \"base64\":\n            return Object(_base64_browser__WEBPACK_IMPORTED_MODULE_0__[\"bufferToBase64\"])(digest);\n        case \"hex\":\n            return Object(_hex__WEBPACK_IMPORTED_MODULE_1__[\"bufferToHex\"])(digest);\n    }\n}\n//# sourceMappingURL=sha256.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/sha256.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/typeGuards.js":
/*!******************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/typeGuards.js ***!
  \******************************************************************/
/*! exports provided: isDefined, isObjectWithProperties, objectHasProperty */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isDefined\", function() { return isDefined; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isObjectWithProperties\", function() { return isObjectWithProperties; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"objectHasProperty\", function() { return objectHasProperty; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n/**\n * Helper TypeGuard that checks if something is defined or not.\n * @param thing - Anything\n */\nfunction isDefined(thing) {\n    return typeof thing !== \"undefined\" && thing !== null;\n}\n/**\n * Helper TypeGuard that checks if the input is an object with the specified properties.\n * @param thing - Anything.\n * @param properties - The name of the properties that should appear in the object.\n */\nfunction isObjectWithProperties(thing, properties) {\n    if (!isDefined(thing) || typeof thing !== \"object\") {\n        return false;\n    }\n    for (const property of properties) {\n        if (!objectHasProperty(thing, property)) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Helper TypeGuard that checks if the input is an object with the specified property.\n * @param thing - Any object.\n * @param property - The name of the property that should appear in the object.\n */\nfunction objectHasProperty(thing, property) {\n    return (isDefined(thing) && typeof thing === \"object\" && property in thing);\n}\n//# sourceMappingURL=typeGuards.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/typeGuards.js?");

            /***/
}),

/***/ "./node_modules/@azure/core-util/dist-esm/src/utf8.browser.js":
/*!********************************************************************!*\
  !*** ./node_modules/@azure/core-util/dist-esm/src/utf8.browser.js ***!
  \********************************************************************/
/*! exports provided: utf8ToBytes */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"utf8ToBytes\", function() { return utf8ToBytes; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nlet encoder;\n/**\n * Returns a cached TextEncoder.\n * @internal\n */\nfunction getTextEncoder() {\n    if (encoder) {\n        return encoder;\n    }\n    if (typeof TextEncoder === \"undefined\") {\n        throw new Error(`Your browser environment is missing \"TextEncoder\".`);\n    }\n    encoder = new TextEncoder();\n    return encoder;\n}\n/**\n * Converts a utf8 string into a byte array.\n * @param content - The utf8 string to convert.\n * @internal\n */\nfunction utf8ToBytes(content) {\n    return getTextEncoder().encode(content);\n}\n//# sourceMappingURL=utf8.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/core-util/dist-esm/src/utf8.browser.js?");

            /***/
}),

/***/ "./node_modules/@azure/logger/dist-esm/src/debug.js":
/*!**********************************************************!*\
  !*** ./node_modules/@azure/logger/dist-esm/src/debug.js ***!
  \**********************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* WEBPACK VAR INJECTION */(function(process) {/* harmony import */ var _log__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./log */ \"./node_modules/@azure/logger/dist-esm/src/log.browser.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst debugEnvVariable = (typeof process !== \"undefined\" && process.env && process.env.DEBUG) || undefined;\nlet enabledString;\nlet enabledNamespaces = [];\nlet skippedNamespaces = [];\nconst debuggers = [];\nif (debugEnvVariable) {\n    enable(debugEnvVariable);\n}\nconst debugObj = Object.assign((namespace) => {\n    return createDebugger(namespace);\n}, {\n    enable,\n    enabled,\n    disable,\n    log: _log__WEBPACK_IMPORTED_MODULE_0__[\"log\"]\n});\nfunction enable(namespaces) {\n    enabledString = namespaces;\n    enabledNamespaces = [];\n    skippedNamespaces = [];\n    const wildcard = /\\*/g;\n    const namespaceList = namespaces.split(\",\").map((ns) => ns.trim().replace(wildcard, \".*?\"));\n    for (const ns of namespaceList) {\n        if (ns.startsWith(\"-\")) {\n            skippedNamespaces.push(new RegExp(`^${ns.substr(1)}$`));\n        }\n        else {\n            enabledNamespaces.push(new RegExp(`^${ns}$`));\n        }\n    }\n    for (const instance of debuggers) {\n        instance.enabled = enabled(instance.namespace);\n    }\n}\nfunction enabled(namespace) {\n    if (namespace.endsWith(\"*\")) {\n        return true;\n    }\n    for (const skipped of skippedNamespaces) {\n        if (skipped.test(namespace)) {\n            return false;\n        }\n    }\n    for (const enabledNamespace of enabledNamespaces) {\n        if (enabledNamespace.test(namespace)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction disable() {\n    const result = enabledString || \"\";\n    enable(\"\");\n    return result;\n}\nfunction createDebugger(namespace) {\n    const newDebugger = Object.assign(debug, {\n        enabled: enabled(namespace),\n        destroy,\n        log: debugObj.log,\n        namespace,\n        extend\n    });\n    function debug(...args) {\n        if (!newDebugger.enabled) {\n            return;\n        }\n        if (args.length > 0) {\n            args[0] = `${namespace} ${args[0]}`;\n        }\n        newDebugger.log(...args);\n    }\n    debuggers.push(newDebugger);\n    return newDebugger;\n}\nfunction destroy() {\n    const index = debuggers.indexOf(this);\n    if (index >= 0) {\n        debuggers.splice(index, 1);\n        return true;\n    }\n    return false;\n}\nfunction extend(namespace) {\n    const newDebugger = createDebugger(`${this.namespace}:${namespace}`);\n    newDebugger.log = this.log;\n    return newDebugger;\n}\n/* harmony default export */ __webpack_exports__[\"default\"] = (debugObj);\n//# sourceMappingURL=debug.js.map\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../../../process/browser.js */ \"./node_modules/process/browser.js\")))\n\n//# sourceURL=webpack:///./node_modules/@azure/logger/dist-esm/src/debug.js?");

            /***/
}),

/***/ "./node_modules/@azure/logger/dist-esm/src/index.js":
/*!**********************************************************!*\
  !*** ./node_modules/@azure/logger/dist-esm/src/index.js ***!
  \**********************************************************/
/*! exports provided: AzureLogger, setLogLevel, getLogLevel, createClientLogger */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* WEBPACK VAR INJECTION */(function(process) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AzureLogger\", function() { return AzureLogger; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"setLogLevel\", function() { return setLogLevel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getLogLevel\", function() { return getLogLevel; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"createClientLogger\", function() { return createClientLogger; });\n/* harmony import */ var _debug__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./debug */ \"./node_modules/@azure/logger/dist-esm/src/debug.js\");\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nconst registeredLoggers = new Set();\nconst logLevelFromEnv = (typeof process !== \"undefined\" && process.env && process.env.AZURE_LOG_LEVEL) || undefined;\nlet azureLogLevel;\n/**\n * The AzureLogger provides a mechanism for overriding where logs are output to.\n * By default, logs are sent to stderr.\n * Override the `log` method to redirect logs to another location.\n */\nconst AzureLogger = Object(_debug__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(\"azure\");\nAzureLogger.log = (...args) => {\n    _debug__WEBPACK_IMPORTED_MODULE_0__[\"default\"].log(...args);\n};\nconst AZURE_LOG_LEVELS = [\"verbose\", \"info\", \"warning\", \"error\"];\nif (logLevelFromEnv) {\n    // avoid calling setLogLevel because we don't want a mis-set environment variable to crash\n    if (isAzureLogLevel(logLevelFromEnv)) {\n        setLogLevel(logLevelFromEnv);\n    }\n    else {\n        console.error(`AZURE_LOG_LEVEL set to unknown log level '${logLevelFromEnv}'; logging is not enabled. Acceptable values: ${AZURE_LOG_LEVELS.join(\", \")}.`);\n    }\n}\n/**\n * Immediately enables logging at the specified log level.\n * @param level - The log level to enable for logging.\n * Options from most verbose to least verbose are:\n * - verbose\n * - info\n * - warning\n * - error\n */\nfunction setLogLevel(level) {\n    if (level && !isAzureLogLevel(level)) {\n        throw new Error(`Unknown log level '${level}'. Acceptable values: ${AZURE_LOG_LEVELS.join(\",\")}`);\n    }\n    azureLogLevel = level;\n    const enabledNamespaces = [];\n    for (const logger of registeredLoggers) {\n        if (shouldEnable(logger)) {\n            enabledNamespaces.push(logger.namespace);\n        }\n    }\n    _debug__WEBPACK_IMPORTED_MODULE_0__[\"default\"].enable(enabledNamespaces.join(\",\"));\n}\n/**\n * Retrieves the currently specified log level.\n */\nfunction getLogLevel() {\n    return azureLogLevel;\n}\nconst levelMap = {\n    verbose: 400,\n    info: 300,\n    warning: 200,\n    error: 100\n};\n/**\n * Creates a logger for use by the Azure SDKs that inherits from `AzureLogger`.\n * @param namespace - The name of the SDK package.\n * @hidden\n */\nfunction createClientLogger(namespace) {\n    const clientRootLogger = AzureLogger.extend(namespace);\n    patchLogMethod(AzureLogger, clientRootLogger);\n    return {\n        error: createLogger(clientRootLogger, \"error\"),\n        warning: createLogger(clientRootLogger, \"warning\"),\n        info: createLogger(clientRootLogger, \"info\"),\n        verbose: createLogger(clientRootLogger, \"verbose\")\n    };\n}\nfunction patchLogMethod(parent, child) {\n    child.log = (...args) => {\n        parent.log(...args);\n    };\n}\nfunction createLogger(parent, level) {\n    const logger = Object.assign(parent.extend(level), {\n        level\n    });\n    patchLogMethod(parent, logger);\n    if (shouldEnable(logger)) {\n        const enabledNamespaces = _debug__WEBPACK_IMPORTED_MODULE_0__[\"default\"].disable();\n        _debug__WEBPACK_IMPORTED_MODULE_0__[\"default\"].enable(enabledNamespaces + \",\" + logger.namespace);\n    }\n    registeredLoggers.add(logger);\n    return logger;\n}\nfunction shouldEnable(logger) {\n    if (azureLogLevel && levelMap[logger.level] <= levelMap[azureLogLevel]) {\n        return true;\n    }\n    else {\n        return false;\n    }\n}\nfunction isAzureLogLevel(logLevel) {\n    return AZURE_LOG_LEVELS.includes(logLevel);\n}\n//# sourceMappingURL=index.js.map\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../../../process/browser.js */ \"./node_modules/process/browser.js\")))\n\n//# sourceURL=webpack:///./node_modules/@azure/logger/dist-esm/src/index.js?");

            /***/
}),

/***/ "./node_modules/@azure/logger/dist-esm/src/log.browser.js":
/*!****************************************************************!*\
  !*** ./node_modules/@azure/logger/dist-esm/src/log.browser.js ***!
  \****************************************************************/
/*! exports provided: log */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"log\", function() { return log; });\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nfunction log(...args) {\n    if (args.length > 0) {\n        const firstArg = String(args[0]);\n        if (firstArg.includes(\":error\")) {\n            console.error(...args);\n        }\n        else if (firstArg.includes(\":warning\")) {\n            console.warn(...args);\n        }\n        else if (firstArg.includes(\":info\")) {\n            console.info(...args);\n        }\n        else if (firstArg.includes(\":verbose\")) {\n            console.debug(...args);\n        }\n        else {\n            console.debug(...args);\n        }\n    }\n}\n//# sourceMappingURL=log.browser.js.map\n\n//# sourceURL=webpack:///./node_modules/@azure/logger/dist-esm/src/log.browser.js?");

            /***/
}),

/***/ "./node_modules/jwt-decode/build/jwt-decode.esm.js":
/*!*********************************************************!*\
  !*** ./node_modules/jwt-decode/build/jwt-decode.esm.js ***!
  \*********************************************************/
/*! exports provided: default, InvalidTokenError */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"InvalidTokenError\", function() { return n; });\nfunction e(e){this.message=e}e.prototype=new Error,e.prototype.name=\"InvalidCharacterError\";var r=\"undefined\"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,\"\");if(t.length%4==1)throw new e(\"'atob' failed: The string to be decoded is not correctly encoded.\");for(var n,o,a=0,i=0,c=\"\";o=t.charAt(i++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\".indexOf(o);return c};function t(e){var t=e.replace(/-/g,\"+\").replace(/_/g,\"/\");switch(t.length%4){case 0:break;case 2:t+=\"==\";break;case 3:t+=\"=\";break;default:throw\"Illegal base64url string!\"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,r){var t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t=\"0\"+t),\"%\"+t})))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,r){if(\"string\"!=typeof e)throw new n(\"Invalid token specified\");var o=!0===(r=r||{}).header?0:1;try{return JSON.parse(t(e.split(\".\")[o]))}catch(e){throw new n(\"Invalid token specified: \"+e.message)}}n.prototype=new Error,n.prototype.name=\"InvalidTokenError\";/* harmony default export */ __webpack_exports__[\"default\"] = (o);\n//# sourceMappingURL=jwt-decode.esm.js.map\n\n\n//# sourceURL=webpack:///./node_modules/jwt-decode/build/jwt-decode.esm.js?");

            /***/
}),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function (module, exports) {

            eval("// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n//# sourceURL=webpack:///./node_modules/process/browser.js?");

            /***/
}),

/***/ "./node_modules/setimmediate/setImmediate.js":
/*!***************************************************!*\
  !*** ./node_modules/setimmediate/setImmediate.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function (module, exports, __webpack_require__) {

            eval("/* WEBPACK VAR INJECTION */(function(global, process) {(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\"), __webpack_require__(/*! ./../process/browser.js */ \"./node_modules/process/browser.js\")))\n\n//# sourceURL=webpack:///./node_modules/setimmediate/setImmediate.js?");

            /***/
}),

/***/ "./node_modules/timers-browserify/main.js":
/*!************************************************!*\
  !*** ./node_modules/timers-browserify/main.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function (module, exports, __webpack_require__) {

            eval("/* WEBPACK VAR INJECTION */(function(global) {var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\n__webpack_require__(/*! setimmediate */ \"./node_modules/setimmediate/setImmediate.js\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\")))\n\n//# sourceURL=webpack:///./node_modules/timers-browserify/main.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/index.js ***!
  \*****************************************************/
/*! exports provided: v1, v3, v4, v5, NIL, version, validate, stringify, parse */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _v1_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./v1.js */ \"./node_modules/uuid/dist/esm-browser/v1.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"v1\", function() { return _v1_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"]; });\n\n/* harmony import */ var _v3_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./v3.js */ \"./node_modules/uuid/dist/esm-browser/v3.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"v3\", function() { return _v3_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]; });\n\n/* harmony import */ var _v4_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./v4.js */ \"./node_modules/uuid/dist/esm-browser/v4.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"v4\", function() { return _v4_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]; });\n\n/* harmony import */ var _v5_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./v5.js */ \"./node_modules/uuid/dist/esm-browser/v5.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"v5\", function() { return _v5_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"]; });\n\n/* harmony import */ var _nil_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./nil.js */ \"./node_modules/uuid/dist/esm-browser/nil.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"NIL\", function() { return _nil_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"]; });\n\n/* harmony import */ var _version_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./version.js */ \"./node_modules/uuid/dist/esm-browser/version.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"version\", function() { return _version_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"]; });\n\n/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./validate.js */ \"./node_modules/uuid/dist/esm-browser/validate.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"validate\", function() { return _validate_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"]; });\n\n/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./stringify.js */ \"./node_modules/uuid/dist/esm-browser/stringify.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"stringify\", function() { return _stringify_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"]; });\n\n/* harmony import */ var _parse_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./parse.js */ \"./node_modules/uuid/dist/esm-browser/parse.js\");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, \"parse\", function() { return _parse_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"]; });\n\n\n\n\n\n\n\n\n\n\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/index.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/md5.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/md5.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/*\n * Browser-compatible JavaScript MD5\n *\n * Modification of JavaScript MD5\n * https://github.com/blueimp/JavaScript-MD5\n *\n * Copyright 2011, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n *\n * Based on\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\nfunction md5(bytes) {\n  if (typeof bytes === 'string') {\n    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = new Uint8Array(msg.length);\n\n    for (var i = 0; i < msg.length; ++i) {\n      bytes[i] = msg.charCodeAt(i);\n    }\n  }\n\n  return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes), bytes.length * 8));\n}\n/*\n * Convert an array of little-endian words to an array of bytes\n */\n\n\nfunction md5ToHexEncodedArray(input) {\n  var output = [];\n  var length32 = input.length * 32;\n  var hexTab = '0123456789abcdef';\n\n  for (var i = 0; i < length32; i += 8) {\n    var x = input[i >> 5] >>> i % 32 & 0xff;\n    var hex = parseInt(hexTab.charAt(x >>> 4 & 0x0f) + hexTab.charAt(x & 0x0f), 16);\n    output.push(hex);\n  }\n\n  return output;\n}\n/**\n * Calculate output length with padding and bit length\n */\n\n\nfunction getOutputLength(inputLength8) {\n  return (inputLength8 + 64 >>> 9 << 4) + 14 + 1;\n}\n/*\n * Calculate the MD5 of an array of little-endian words, and a bit length.\n */\n\n\nfunction wordsToMd5(x, len) {\n  /* append padding */\n  x[len >> 5] |= 0x80 << len % 32;\n  x[getOutputLength(len) - 1] = len;\n  var a = 1732584193;\n  var b = -271733879;\n  var c = -1732584194;\n  var d = 271733878;\n\n  for (var i = 0; i < x.length; i += 16) {\n    var olda = a;\n    var oldb = b;\n    var oldc = c;\n    var oldd = d;\n    a = md5ff(a, b, c, d, x[i], 7, -680876936);\n    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);\n    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);\n    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);\n    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);\n    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);\n    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);\n    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);\n    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);\n    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);\n    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);\n    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);\n    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);\n    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);\n    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);\n    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);\n    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);\n    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);\n    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);\n    b = md5gg(b, c, d, a, x[i], 20, -373897302);\n    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);\n    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);\n    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);\n    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);\n    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);\n    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);\n    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);\n    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);\n    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);\n    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);\n    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);\n    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);\n    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);\n    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);\n    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);\n    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);\n    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);\n    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);\n    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);\n    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);\n    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);\n    d = md5hh(d, a, b, c, x[i], 11, -358537222);\n    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);\n    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);\n    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);\n    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);\n    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);\n    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);\n    a = md5ii(a, b, c, d, x[i], 6, -198630844);\n    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);\n    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);\n    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);\n    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);\n    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);\n    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);\n    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);\n    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);\n    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);\n    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);\n    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);\n    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);\n    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);\n    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);\n    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);\n    a = safeAdd(a, olda);\n    b = safeAdd(b, oldb);\n    c = safeAdd(c, oldc);\n    d = safeAdd(d, oldd);\n  }\n\n  return [a, b, c, d];\n}\n/*\n * Convert an array bytes to an array of little-endian words\n * Characters >255 have their high-byte silently ignored.\n */\n\n\nfunction bytesToWords(input) {\n  if (input.length === 0) {\n    return [];\n  }\n\n  var length8 = input.length * 8;\n  var output = new Uint32Array(getOutputLength(length8));\n\n  for (var i = 0; i < length8; i += 8) {\n    output[i >> 5] |= (input[i / 8] & 0xff) << i % 32;\n  }\n\n  return output;\n}\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\n\n\nfunction safeAdd(x, y) {\n  var lsw = (x & 0xffff) + (y & 0xffff);\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return msw << 16 | lsw & 0xffff;\n}\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\n\n\nfunction bitRotateLeft(num, cnt) {\n  return num << cnt | num >>> 32 - cnt;\n}\n/*\n * These functions implement the four basic operations the algorithm uses.\n */\n\n\nfunction md5cmn(q, a, b, x, s, t) {\n  return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);\n}\n\nfunction md5ff(a, b, c, d, x, s, t) {\n  return md5cmn(b & c | ~b & d, a, b, x, s, t);\n}\n\nfunction md5gg(a, b, c, d, x, s, t) {\n  return md5cmn(b & d | c & ~d, a, b, x, s, t);\n}\n\nfunction md5hh(a, b, c, d, x, s, t) {\n  return md5cmn(b ^ c ^ d, a, b, x, s, t);\n}\n\nfunction md5ii(a, b, c, d, x, s, t) {\n  return md5cmn(c ^ (b | ~d), a, b, x, s, t);\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (md5);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/md5.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/nil.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/nil.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony default export */ __webpack_exports__[\"default\"] = ('00000000-0000-0000-0000-000000000000');\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/nil.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/parse.js":
/*!*****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/parse.js ***!
  \*****************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validate.js */ \"./node_modules/uuid/dist/esm-browser/validate.js\");\n\n\nfunction parse(uuid) {\n  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  var v;\n  var arr = new Uint8Array(16); // Parse ########-....-....-....-............\n\n  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;\n  arr[1] = v >>> 16 & 0xff;\n  arr[2] = v >>> 8 & 0xff;\n  arr[3] = v & 0xff; // Parse ........-####-....-....-............\n\n  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;\n  arr[5] = v & 0xff; // Parse ........-....-####-....-............\n\n  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;\n  arr[7] = v & 0xff; // Parse ........-....-....-####-............\n\n  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;\n  arr[9] = v & 0xff; // Parse ........-....-....-....-############\n  // (Use \"/\" to avoid 32-bit truncation when bit-shifting high-order bytes)\n\n  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;\n  arr[11] = v / 0x100000000 & 0xff;\n  arr[12] = v >>> 24 & 0xff;\n  arr[13] = v >>> 16 & 0xff;\n  arr[14] = v >>> 8 & 0xff;\n  arr[15] = v & 0xff;\n  return arr;\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (parse);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/parse.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/regex.js":
/*!*****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/regex.js ***!
  \*****************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony default export */ __webpack_exports__[\"default\"] = (/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/regex.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/rng.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/rng.js ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return rng; });\n// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nfunction rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/rng.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/sha1.js":
/*!****************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/sha1.js ***!
  \****************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n// Adapted from Chris Veness' SHA1 code at\n// http://www.movable-type.co.uk/scripts/sha1.html\nfunction f(s, x, y, z) {\n  switch (s) {\n    case 0:\n      return x & y ^ ~x & z;\n\n    case 1:\n      return x ^ y ^ z;\n\n    case 2:\n      return x & y ^ x & z ^ y & z;\n\n    case 3:\n      return x ^ y ^ z;\n  }\n}\n\nfunction ROTL(x, n) {\n  return x << n | x >>> 32 - n;\n}\n\nfunction sha1(bytes) {\n  var K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];\n  var H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n\n  if (typeof bytes === 'string') {\n    var msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = [];\n\n    for (var i = 0; i < msg.length; ++i) {\n      bytes.push(msg.charCodeAt(i));\n    }\n  } else if (!Array.isArray(bytes)) {\n    // Convert Array-like to Array\n    bytes = Array.prototype.slice.call(bytes);\n  }\n\n  bytes.push(0x80);\n  var l = bytes.length / 4 + 2;\n  var N = Math.ceil(l / 16);\n  var M = new Array(N);\n\n  for (var _i = 0; _i < N; ++_i) {\n    var arr = new Uint32Array(16);\n\n    for (var j = 0; j < 16; ++j) {\n      arr[j] = bytes[_i * 64 + j * 4] << 24 | bytes[_i * 64 + j * 4 + 1] << 16 | bytes[_i * 64 + j * 4 + 2] << 8 | bytes[_i * 64 + j * 4 + 3];\n    }\n\n    M[_i] = arr;\n  }\n\n  M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);\n  M[N - 1][14] = Math.floor(M[N - 1][14]);\n  M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;\n\n  for (var _i2 = 0; _i2 < N; ++_i2) {\n    var W = new Uint32Array(80);\n\n    for (var t = 0; t < 16; ++t) {\n      W[t] = M[_i2][t];\n    }\n\n    for (var _t = 16; _t < 80; ++_t) {\n      W[_t] = ROTL(W[_t - 3] ^ W[_t - 8] ^ W[_t - 14] ^ W[_t - 16], 1);\n    }\n\n    var a = H[0];\n    var b = H[1];\n    var c = H[2];\n    var d = H[3];\n    var e = H[4];\n\n    for (var _t2 = 0; _t2 < 80; ++_t2) {\n      var s = Math.floor(_t2 / 20);\n      var T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[_t2] >>> 0;\n      e = d;\n      d = c;\n      c = ROTL(b, 30) >>> 0;\n      b = a;\n      a = T;\n    }\n\n    H[0] = H[0] + a >>> 0;\n    H[1] = H[1] + b >>> 0;\n    H[2] = H[2] + c >>> 0;\n    H[3] = H[3] + d >>> 0;\n    H[4] = H[4] + e >>> 0;\n  }\n\n  return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (sha1);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/sha1.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/stringify.js":
/*!*********************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/stringify.js ***!
  \*********************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validate.js */ \"./node_modules/uuid/dist/esm-browser/validate.js\");\n\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (stringify);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/stringify.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/v1.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v1.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _rng_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rng.js */ \"./node_modules/uuid/dist/esm-browser/rng.js\");\n/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stringify.js */ \"./node_modules/uuid/dist/esm-browser/stringify.js\");\n\n // **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\n\nvar _clockseq; // Previous uuid creation time\n\n\nvar _lastMSecs = 0;\nvar _lastNSecs = 0; // See https://github.com/uuidjs/uuid for API details\n\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || new Array(16);\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq; // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n\n  if (node == null || clockseq == null) {\n    var seedBytes = options.random || (options.rng || _rng_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [seedBytes[0] | 0x01, seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]];\n    }\n\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  } // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n\n\n  var msecs = options.msecs !== undefined ? options.msecs : Date.now(); // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1; // Time since last uuid creation (in msecs)\n\n  var dt = msecs - _lastMSecs + (nsecs - _lastNSecs) / 10000; // Per 4.2.1.2, Bump clockseq on clock regression\n\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  } // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n\n\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  } // Per 4.2.1.2 Throw error if too many uuids are requested\n\n\n  if (nsecs >= 10000) {\n    throw new Error(\"uuid.v1(): Can't create more than 10M uuids/sec\");\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq; // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n\n  msecs += 12219292800000; // `time_low`\n\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff; // `time_mid`\n\n  var tmh = msecs / 0x100000000 * 10000 & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff; // `time_high_and_version`\n\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n\n  b[i++] = tmh >>> 16 & 0xff; // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n\n  b[i++] = clockseq >>> 8 | 0x80; // `clock_seq_low`\n\n  b[i++] = clockseq & 0xff; // `node`\n\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf || Object(_stringify_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(b);\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (v1);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/v1.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/v3.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v3.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _v35_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./v35.js */ \"./node_modules/uuid/dist/esm-browser/v35.js\");\n/* harmony import */ var _md5_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./md5.js */ \"./node_modules/uuid/dist/esm-browser/md5.js\");\n\n\nvar v3 = Object(_v35_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])('v3', 0x30, _md5_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]);\n/* harmony default export */ __webpack_exports__[\"default\"] = (v3);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/v3.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/v35.js":
/*!***************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v35.js ***!
  \***************************************************/
/*! exports provided: DNS, URL, default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DNS\", function() { return DNS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"URL\", function() { return URL; });\n/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./stringify.js */ \"./node_modules/uuid/dist/esm-browser/stringify.js\");\n/* harmony import */ var _parse_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./parse.js */ \"./node_modules/uuid/dist/esm-browser/parse.js\");\n\n\n\nfunction stringToBytes(str) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n\n  var bytes = [];\n\n  for (var i = 0; i < str.length; ++i) {\n    bytes.push(str.charCodeAt(i));\n  }\n\n  return bytes;\n}\n\nvar DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nvar URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\n/* harmony default export */ __webpack_exports__[\"default\"] = (function (name, version, hashfunc) {\n  function generateUUID(value, namespace, buf, offset) {\n    if (typeof value === 'string') {\n      value = stringToBytes(value);\n    }\n\n    if (typeof namespace === 'string') {\n      namespace = Object(_parse_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(namespace);\n    }\n\n    if (namespace.length !== 16) {\n      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');\n    } // Compute hash of namespace and value, Per 4.3\n    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =\n    // hashfunc([...namespace, ... value])`\n\n\n    var bytes = new Uint8Array(16 + value.length);\n    bytes.set(namespace);\n    bytes.set(value, namespace.length);\n    bytes = hashfunc(bytes);\n    bytes[6] = bytes[6] & 0x0f | version;\n    bytes[8] = bytes[8] & 0x3f | 0x80;\n\n    if (buf) {\n      offset = offset || 0;\n\n      for (var i = 0; i < 16; ++i) {\n        buf[offset + i] = bytes[i];\n      }\n\n      return buf;\n    }\n\n    return Object(_stringify_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(bytes);\n  } // Function#name is not settable on some platforms (#270)\n\n\n  try {\n    generateUUID.name = name; // eslint-disable-next-line no-empty\n  } catch (err) {} // For CommonJS default export support\n\n\n  generateUUID.DNS = DNS;\n  generateUUID.URL = URL;\n  return generateUUID;\n});\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/v35.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/v4.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v4.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _rng_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rng.js */ \"./node_modules/uuid/dist/esm-browser/rng.js\");\n/* harmony import */ var _stringify_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./stringify.js */ \"./node_modules/uuid/dist/esm-browser/stringify.js\");\n\n\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || _rng_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return Object(_stringify_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(rnds);\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (v4);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/v4.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/v5.js":
/*!**************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/v5.js ***!
  \**************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _v35_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./v35.js */ \"./node_modules/uuid/dist/esm-browser/v35.js\");\n/* harmony import */ var _sha1_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sha1.js */ \"./node_modules/uuid/dist/esm-browser/sha1.js\");\n\n\nvar v5 = Object(_v35_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])('v5', 0x50, _sha1_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]);\n/* harmony default export */ __webpack_exports__[\"default\"] = (v5);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/v5.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/validate.js":
/*!********************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/validate.js ***!
  \********************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _regex_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./regex.js */ \"./node_modules/uuid/dist/esm-browser/regex.js\");\n\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && _regex_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].test(uuid);\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (validate);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/validate.js?");

            /***/
}),

/***/ "./node_modules/uuid/dist/esm-browser/version.js":
/*!*******************************************************!*\
  !*** ./node_modules/uuid/dist/esm-browser/version.js ***!
  \*******************************************************/
/*! exports provided: default */
/***/ (function (module, __webpack_exports__, __webpack_require__) {

            "use strict";
            eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _validate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./validate.js */ \"./node_modules/uuid/dist/esm-browser/validate.js\");\n\n\nfunction version(uuid) {\n  if (!Object(_validate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  return parseInt(uuid.substr(14, 1), 16);\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (version);\n\n//# sourceURL=webpack:///./node_modules/uuid/dist/esm-browser/version.js?");

            /***/
}),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function (module, exports) {

            eval("var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n\n//# sourceURL=webpack:///(webpack)/buildin/global.js?");

            /***/
})

    /******/
});